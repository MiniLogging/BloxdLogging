/*! For license information please see b4gs58.32.2523c663.chunk.js.LICENSE.txt */
(self.uji65st81d=self.uji65st81d||[]).push([[32],{14357:(V,h,mV)=>{"use strict";var t=mV(14363),L=mV(14370),N=mV(14375);mV.g.__TYPEDARRAY_POOL||(mV.g.__TYPEDARRAY_POOL={UINT8:L([32,0]),UINT16:L([32,0]),UINT32:L([32,0]),INT8:L([32,0]),INT16:L([32,0]),INT32:L([32,0]),FLOAT:L([32,0]),DOUBLE:L([32,0]),DATA:L([32,0]),UINT8C:L([32,0]),BUFFER:L([32,0])});var A="undefined"!==typeof Uint8ClampedArray,k=mV.g.__TYPEDARRAY_POOL;k.UINT8C||(k.UINT8C=L([32,0])),k.BUFFER||(k.BUFFER=L([32,0]));var C=k.DATA,K=k.BUFFER;function o(V){if(V){var h=V.length||V.byteLength,mV=t.log2(h);C[mV].push(V)}}function n(V){V=t.nextPow2(V);var h=t.log2(V),mV=C[h];return mV.length>0?mV.pop():new ArrayBuffer(V)}function q(V){return new Uint8Array(n(V),0,V)}function x(V){return new Uint16Array(n(2*V),0,V)}function R(V){return new Uint32Array(n(4*V),0,V)}function d(V){return new Int8Array(n(V),0,V)}function s(V){return new Int16Array(n(2*V),0,V)}function M(V){return new Int32Array(n(4*V),0,V)}function c(V){return new Float32Array(n(4*V),0,V)}function z(V){return new Float64Array(n(8*V),0,V)}function Q(V){return A?new Uint8ClampedArray(n(V),0,V):q(V)}function J(V){return new DataView(n(V),0,V)}h.free=function(V){if(N(V))K[t.log2(V.length)].push(V);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(V)&&(V=V.buffer),!V)return;var h=V.length||V.byteLength,mV=0|t.log2(h);C[mV].push(V)}},h.freeUint8=h.freeUint16=h.freeUint32=h.freeInt8=h.freeInt16=h.freeInt32=h.freeFloat32=h.freeFloat=h.freeFloat64=h.freeDouble=h.freeUint8Clamped=h.freeDataView=function(V){o(V.buffer)},h.freeArrayBuffer=o,h.freeBuffer=function(V){K[t.log2(V.length)].push(V)},h.malloc=function(V,h){if(void 0===h||"arraybuffer"===h)return n(V);switch(h){case"uint8":return q(V);case"uint16":return x(V);case"uint32":return R(V);case"int8":return d(V);case"int16":return s(V);case"int32":return M(V);case"float":case"float32":return c(V);case"double":case"float64":return z(V);case"uint8_clamped":return Q(V);case"buffer":throw"Buffer not supported";case"data":case"dataview":return J(V);default:return null}return null},h.mallocArrayBuffer=n,h.mallocUint8=q,h.mallocUint16=x,h.mallocUint32=R,h.mallocInt8=d,h.mallocInt16=s,h.mallocInt32=M,h.mallocFloat32=h.mallocFloat=c,h.mallocFloat64=h.mallocDouble=z,h.mallocUint8Clamped=Q,h.mallocDataView=J,h.clearCache=function(){for(var V=0;V<32;++V)k.UINT8[V].length=0,k.UINT16[V].length=0,k.UINT32[V].length=0,k.INT8[V].length=0,k.INT16[V].length=0,k.INT32[V].length=0,k.FLOAT[V].length=0,k.DOUBLE[V].length=0,k.UINT8C[V].length=0,C[V].length=0,K[V].length=0}},14461:(V,h,mV)=>{V.exports=L;var t=mV(13215);function L(V,h){if(!(this instanceof L))return new L(V,h);var mV=t.create();t.add(mV,V,h),this.base=t.min(t.create(),V,mV),this.ho=t.clone(h),this.max=t.max(t.create(),V,mV),this.mag=t.length(this.ho)}var N=L.prototype;N.width=function(){return this.ho[0]},N.height=function(){return this.ho[1]},N.depth=function(){return this.ho[2]},N.x0=function(){return this.base[0]},N.y0=function(){return this.base[1]},N.z0=function(){return this.base[2]},N.x1=function(){return this.max[0]},N.y1=function(){return this.max[1]},N.z1=function(){return this.max[2]},N.translate=function(V){return t.add(this.max,this.max,V),t.add(this.base,this.base,V),this},N.setPosition=function(V){return t.add(this.max,V,this.ho),t.i(this.base,V),this},N.expand=function(V){var h=t.create(),mV=t.create();return t.max(h,V.max,this.max),t.min(mV,V.base,this.base),t.Mh(h,h,mV),new L(mV,h)},N.intersects=function(V){return!(V.base[0]>this.max[0])&&(!(V.base[1]>this.max[1])&&(!(V.base[2]>this.max[2])&&(!(V.max[0]<this.base[0])&&(!(V.max[1]<this.base[1])&&!(V.max[2]<this.base[2])))))},N.touches=function(V){var h=this.union(V);return null!==h&&(0==h.width()||0==h.height()||0==h.depth())},N.union=function(V){if(!this.intersects(V))return null;var h=Math.max(V.base[0],this.base[0]),mV=Math.max(V.base[1],this.base[1]),t=Math.max(V.base[2],this.base[2]);return new L([h,mV,t],[Math.min(V.max[0],this.max[0])-h,Math.min(V.max[1],this.max[1])-mV,Math.min(V.max[2],this.max[2])-t])}},14363:(V,h)=>{"use strict";function mV(V){var h=32;return(V&=-V)&&h--,65535&V&&(h-=16),16711935&V&&(h-=8),252645135&V&&(h-=4),858993459&V&&(h-=2),1431655765&V&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(V){return(V>0)-(V<0)},h.abs=function(V){var h=V>>31;return(V^h)-h},h.min=function(V,h){return h^(V^h)&-(V<h)},h.max=function(V,h){return V^(V^h)&-(V<h)},h.isPow2=function(V){return!(V&V-1)&&!!V},h.log2=function(V){var h,mV;return h=(V>65535)<<4,h|=mV=((V>>>=h)>255)<<3,h|=mV=((V>>>=mV)>15)<<2,(h|=mV=((V>>>=mV)>3)<<1)|(V>>>=mV)>>1},h.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},h.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},h.countTrailingZeros=mV,h.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},h.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},h.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var t=new Array(256);!function(V){for(var h=0;h<256;++h){var mV=h,t=h,L=7;for(mV>>>=1;mV;mV>>>=1)t<<=1,t|=1&mV,--L;V[h]=t<<L&255}}(t),h.reverse=function(V){return t[255&V]<<24|t[V>>>8&255]<<16|t[V>>>16&255]<<8|t[V>>>24&255]},h.interleave2=function(V,h){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(V,h){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>h&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},h.interleave3=function(V,h,mV){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(mV=1227133513&((mV=3272356035&((mV=251719695&((mV=4278190335&((mV&=1023)|mV<<16))|mV<<8))|mV<<4))|mV<<2))<<2},h.deinterleave3=function(V,h){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>h&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},h.nextCombination=function(V){var h=V|V-1;return h+1|(~h&-~h)-1>>>mV(V)+1}},14351:(V,h,mV)=>{"use strict";V.exports=function(V,h,mV){switch(arguments.length){case 1:return t=[],K(L=V,L,o,!0),t;case 2:return"function"===typeof h?K(V,V,h,!0):function(V,h){return t=[],K(V,h,o,!1),t}(V,h);case 3:return K(V,h,mV,!1);default:throw new Error("box-intersect: Invalid arguments")}var L};var t,L=mV(14357),N=mV(14381),A=mV(14397);function k(V,h){for(var mV=0;mV<V;++mV)if(!(h[mV]<=h[mV+V]))return!0;return!1}function C(V,h,mV,t){for(var L=0,N=0,A=0,C=V.length;A<C;++A){var K=V[A];if(!k(h,K)){for(var o=0;o<2*h;++o)mV[L++]=K[o];t[N++]=A}}return N}function K(V,h,mV,t){var k=V.length,K=h.length;if(!(k<=0||K<=0)){var o=V[0].length>>>1;if(!(o<=0)){var n,q=L.mallocDouble(2*o*k),x=L.mallocInt32(k);if((k=C(V,o,q,x))>0){if(1===o&&t)N.init(k),n=N.sweepComplete(o,mV,0,k,q,x,0,k,q,x);else{var R=L.mallocDouble(2*o*K),d=L.mallocInt32(K);(K=C(h,o,R,d))>0&&(N.init(k+K),n=1===o?N.sweepBipartite(o,mV,0,k,q,x,0,K,R,d):A(o,mV,t,k,q,x,K,R,d),L.free(R),L.free(d))}L.free(q),L.free(x)}return n}}}function o(V,h){t.push([V,h])}},14402:(V,h)=>{"use strict";var mV="d",t="ax",L="fp",N="es",A="rs",k="re",C="rb",K="bs",o="be",n="bb",q=[mV,t,"vv",A,k,C,"ri",K,o,n,"bi"];function x(V){var h="bruteForce"+(V?"Full":"Partial"),t=[],A=q.slice();V||A.splice(3,0,L);var k=["function "+h+"("+A.join()+"){"];function C(h,L){var A=function(V,h,t){var L="bruteForce"+(V?"Red":"Blue")+(h?"Flip":"")+(t?"Full":""),A=["function ",L,"(",q.join(),"){","var ",N,"=2*",mV,";"],k="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",C="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(t?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return V?A.push(k,"Q",":",C):A.push(C,"Q",":",k),t?A.push("if(y1<x0||x1<y0)continue;"):h?A.push("if(y0<=x0||x1<y0)continue;"):A.push("if(y0<x0||x1<y0)continue;"),A.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),h?A.push("yi,xi"):A.push("xi,yi"),A.push(");if(rv!==void 0)return rv;}}}"),{name:L,code:A.join("")}}(h,L,V);t.push(A.code),k.push("return "+A.name+"("+q.join()+");")}k.push("if(re-rs>be-bs){"),V?(C(!0,!1),k.push("}else{"),C(!1,!1)):(k.push("if(fp){"),C(!0,!0),k.push("}else{"),C(!0,!1),k.push("}}else{if(fp){"),C(!1,!0),k.push("}else{"),C(!1,!1),k.push("}")),k.push("}}return "+h);var K=t.join("")+k.join("");return new Function(K)()}h.partial=x(!1),h.full=x(!0)},14397:(V,h,mV)=>{"use strict";V.exports=function(V,h,mV,N,o,G,y,O,I){!function(V,h){var mV=8*L.log2(h+1)*(V+1)|0,N=L.nextPow2(Q*mV);v.length<N&&(t.free(v),v=t.mallocInt32(N));var A=L.nextPow2(J*mV);D.length<A&&(t.free(D),D=t.mallocDouble(A))}(V,N+y);var r,T=0,F=2*V;H(T++,0,0,N,0,y,mV?16:0,-1/0,1/0),mV||H(T++,0,0,y,0,N,1,-1/0,1/0);for(;T>0;){var p=(T-=1)*Q,Z=v[p],f=v[p+1],S=v[p+2],Y=v[p+3],w=v[p+4],E=v[p+5],g=T*J,i=D[g],b=D[g+1],P=1&E,U=!!(16&E),u=o,e=G,W=O,X=I;if(P&&(u=O,e=I,W=o,X=G),!(2&E&&f>=(S=s(V,Z,f,S,u,e,b)))&&!(4&E&&(f=M(V,Z,f,S,u,e,i))>=S)){var a=S-f,B=w-Y;if(U){if(V*a*(a+B)<x){if(void 0!==(r=C.scanComplete(V,Z,h,f,S,u,e,Y,w,W,X)))return r;continue}}else{if(V*Math.min(a,B)<n){if(void 0!==(r=A(V,Z,h,P,f,S,u,e,Y,w,W,X)))return r;continue}if(V*a*B<q){if(void 0!==(r=C.scanBipartite(V,Z,h,P,f,S,u,e,Y,w,W,X)))return r;continue}}var VV=R(V,Z,f,S,u,e,i,b);if(f<VV)if(V*(VV-f)<n){if(void 0!==(r=k(V,Z+1,h,f,VV,u,e,Y,w,W,X)))return r}else if(Z===V-2){if(void 0!==(r=P?C.sweepBipartite(V,h,Y,w,W,X,f,VV,u,e):C.sweepBipartite(V,h,f,VV,u,e,Y,w,W,X)))return r}else H(T++,Z+1,f,VV,Y,w,P,-1/0,1/0),H(T++,Z+1,Y,w,f,VV,1^P,-1/0,1/0);if(VV<S){var hV=K(V,Z,Y,w,W,X),mh=W[F*hV+Z],tV=d(V,Z,hV,w,W,X,mh);if(tV<w&&H(T++,Z,VV,S,tV,w,(4|P)+(U?16:0),mh,b),Y<hV&&H(T++,Z,VV,S,Y,hV,(2|P)+(U?16:0),i,mh),hV+1===tV){if(void 0!==(r=U?l(V,Z,h,VV,S,u,e,hV,W,X[hV]):j(V,Z,h,P,VV,S,u,e,hV,W,X[hV])))return r}else if(hV<tV){var LV;if(U){if(VV<(LV=c(V,Z,VV,S,u,e,mh))){var NV=d(V,Z,VV,LV,u,e,mh);if(Z===V-2){if(VV<NV&&void 0!==(r=C.sweepComplete(V,h,VV,NV,u,e,hV,tV,W,X)))return r;if(NV<LV&&void 0!==(r=C.sweepBipartite(V,h,NV,LV,u,e,hV,tV,W,X)))return r}else VV<NV&&H(T++,Z+1,VV,NV,hV,tV,16,-1/0,1/0),NV<LV&&(H(T++,Z+1,NV,LV,hV,tV,0,-1/0,1/0),H(T++,Z+1,hV,tV,NV,LV,1,-1/0,1/0))}}else VV<(LV=P?z(V,Z,VV,S,u,e,mh):c(V,Z,VV,S,u,e,mh))&&(Z===V-2?r=P?C.sweepBipartite(V,h,hV,tV,W,X,VV,LV,u,e):C.sweepBipartite(V,h,VV,LV,u,e,hV,tV,W,X):(H(T++,Z+1,VV,LV,hV,tV,P,-1/0,1/0),H(T++,Z+1,hV,tV,VV,LV,1^P,-1/0,1/0)))}}}}};var t=mV(14357),L=mV(14363),N=mV(14402),A=N.partial,k=N.full,C=mV(14381),K=mV(14407),o=mV(14414),n=128,q=1<<22,x=1<<22,R=o("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),d=o("lo===p0",["p0"]),s=o("lo<p0",["p0"]),M=o("hi<=p0",["p0"]),c=o("lo<=p0&&p0<=hi",["p0"]),z=o("lo<p0&&p0<=hi",["p0"]),Q=6,J=2,v=t.mallocInt32(1024),D=t.mallocDouble(1024);function H(V,h,mV,t,L,N,A,k,C){var K=Q*V;v[K]=h,v[K+1]=mV,v[K+2]=t,v[K+3]=L,v[K+4]=N,v[K+5]=A;var o=J*V;D[o]=k,D[o+1]=C}function j(V,h,mV,t,L,N,A,k,C,K,o){var n=2*V,q=C*n,x=K[q+h];V:for(var R=L,d=L*n;R<N;++R,d+=n){var s=A[d+h],M=A[d+h+V];if(!(x<s||M<x)&&(!t||x!==s)){for(var c,z=k[R],Q=h+1;Q<V;++Q){s=A[d+Q],M=A[d+Q+V];var J=K[q+Q],v=K[q+Q+V];if(M<J||v<s)continue V}if(void 0!==(c=t?mV(o,z):mV(z,o)))return c}}}function l(V,h,mV,t,L,N,A,k,C,K){var o=2*V,n=k*o,q=C[n+h];V:for(var x=t,R=t*o;x<L;++x,R+=o){var d=A[x];if(d!==K){var s=N[R+h],M=N[R+h+V];if(!(q<s||M<q)){for(var c=h+1;c<V;++c){s=N[R+c],M=N[R+c+V];var z=C[n+c],Q=C[n+c+V];if(M<z||Q<s)continue V}var J=mV(d,K);if(void 0!==J)return J}}}}},14407:(V,h,mV)=>{"use strict";V.exports=function(V,h,mV,A,k,C){if(A<=mV+1)return mV;var K=mV,o=A,n=A+mV>>>1,q=2*V,x=n,R=k[q*n+h];for(;K<o;){if(o-K<L){N(V,h,K,o,k,C),R=k[q*n+h];break}var d=o-K,s=Math.random()*d+K|0,M=k[q*s+h],c=Math.random()*d+K|0,z=k[q*c+h],Q=Math.random()*d+K|0,J=k[q*Q+h];M<=z?J>=z?(x=c,R=z):M>=J?(x=s,R=M):(x=Q,R=J):z>=J?(x=c,R=z):J>=M?(x=s,R=M):(x=Q,R=J);for(var v=q*(o-1),D=q*x,H=0;H<q;++H,++v,++D){var j=k[v];k[v]=k[D],k[D]=j}var l=C[o-1];C[o-1]=C[x],C[x]=l;for(v=q*(o-1),D=q*(x=t(V,h,K,o-1,k,C,R)),H=0;H<q;++H,++v,++D){j=k[v];k[v]=k[D],k[D]=j}l=C[o-1];if(C[o-1]=C[x],C[x]=l,n<x){for(o=x-1;K<o&&k[q*(o-1)+h]===R;)o-=1;o+=1}else{if(!(x<n))break;for(K=x+1;K<o&&k[q*K+h]===R;)K+=1}}return t(V,h,mV,n,k,C,k[q*n+h])};var t=mV(14414)("lo<p0",["p0"]),L=8;function N(V,h,mV,t,L,N){for(var A=2*V,k=A*(mV+1)+h,C=mV+1;C<t;++C,k+=A)for(var K=L[k],o=C,n=A*(C-1);o>mV&&L[n+h]>K;--o,n-=A){for(var q=n,x=n+A,R=0;R<A;++R,++q,++x){var d=L[q];L[q]=L[x],L[x]=d}var s=N[o];N[o]=N[o-1],N[o-1]=s}}},14414:V=>{"use strict";V.exports=function(V,mV){var t="abcdef".split("").concat(mV),L=[];V.indexOf("lo")>=0&&L.push("lo=e[k+n]");V.indexOf("hi")>=0&&L.push("hi=e[k+o]");return t.push(h.replace("_",L.join()).replace("$",V)),Function.apply(void 0,t)};var h="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14388:V=>{"use strict";V.exports=function(V,t){t<=4*h?mV(0,t-1,V):K(0,t-1,V)};var h=32;function mV(V,h,mV){for(var t=2*(V+1),L=V+1;L<=h;++L){for(var N=mV[t++],A=mV[t++],k=L,C=t-2;k-- >V;){var K=mV[C-2],o=mV[C-1];if(K<N)break;if(K===N&&o<A)break;mV[C]=K,mV[C+1]=o,C-=2}mV[C]=N,mV[C+1]=A}}function t(V,h,mV){h*=2;var t=mV[V*=2],L=mV[V+1];mV[V]=mV[h],mV[V+1]=mV[h+1],mV[h]=t,mV[h+1]=L}function L(V,h,mV){h*=2,mV[V*=2]=mV[h],mV[V+1]=mV[h+1]}function N(V,h,mV,t){h*=2,mV*=2;var L=t[V*=2],N=t[V+1];t[V]=t[h],t[V+1]=t[h+1],t[h]=t[mV],t[h+1]=t[mV+1],t[mV]=L,t[mV+1]=N}function A(V,h,mV,t,L){h*=2,L[V*=2]=L[h],L[h]=mV,L[V+1]=L[h+1],L[h+1]=t}function k(V,h,mV){h*=2;var t=mV[V*=2],L=mV[h];return!(t<L)&&(t!==L||mV[V+1]>mV[h+1])}function C(V,h,mV,t){var L=t[V*=2];return L<h||L===h&&t[V+1]<mV}function K(V,o,n){var q=(o-V+1)/6|0,x=V+q,R=o-q,d=V+o>>1,s=d-q,M=d+q,c=x,z=s,Q=d,J=M,v=R,D=V+1,H=o-1,j=0;k(c,z,n)&&(j=c,c=z,z=j),k(J,v,n)&&(j=J,J=v,v=j),k(c,Q,n)&&(j=c,c=Q,Q=j),k(z,Q,n)&&(j=z,z=Q,Q=j),k(c,J,n)&&(j=c,c=J,J=j),k(Q,J,n)&&(j=Q,Q=J,J=j),k(z,v,n)&&(j=z,z=v,v=j),k(z,Q,n)&&(j=z,z=Q,Q=j),k(J,v,n)&&(j=J,J=v,v=j);for(var l=n[2*z],G=n[2*z+1],y=n[2*J],O=n[2*J+1],I=2*c,r=2*Q,T=2*v,F=2*x,p=2*d,Z=2*R,f=0;f<2;++f){var S=n[I+f],Y=n[r+f],w=n[T+f];n[F+f]=S,n[p+f]=Y,n[Z+f]=w}L(s,V,n),L(M,o,n);for(var E=D;E<=H;++E)if(C(E,l,G,n))E!==D&&t(E,D,n),++D;else if(!C(E,y,O,n))for(;;){if(C(H,y,O,n)){C(H,l,G,n)?(N(E,D,H,n),++D,--H):(t(E,H,n),--H);break}if(--H<E)break}A(V,D-1,l,G,n),A(o,H+1,y,O,n),D-2-V<=h?mV(V,D-2,n):K(V,D-2,n),o-(H+2)<=h?mV(H+2,o,n):K(H+2,o,n),H-D<=h?mV(D,H,n):K(D,H,n)}},14381:(V,h,mV)=>{"use strict";V.exports={init:function(V){var h=L.nextPow2(V);C.length<h&&(t.free(C),C=t.mallocInt32(h));K.length<h&&(t.free(K),K=t.mallocInt32(h));o.length<h&&(t.free(o),o=t.mallocInt32(h));n.length<h&&(t.free(n),n=t.mallocInt32(h));q.length<h&&(t.free(q),q=t.mallocInt32(h));x.length<h&&(t.free(x),x=t.mallocInt32(h));var mV=8*h;R.length<mV&&(t.free(R),R=t.mallocDouble(mV))},sweepBipartite:function(V,h,mV,t,L,k,q,x,M,c){for(var z=0,Q=2*V,J=V-1,v=Q-1,D=mV;D<t;++D){var H=k[D],j=Q*D;R[z++]=L[j+J],R[z++]=-(H+1),R[z++]=L[j+v],R[z++]=H}for(D=q;D<x;++D){H=c[D]+A;var l=Q*D;R[z++]=M[l+J],R[z++]=-H,R[z++]=M[l+v],R[z++]=H}var G=z>>>1;N(R,G);var y=0,O=0;for(D=0;D<G;++D){var I=0|R[2*D+1];if(I>=A)d(o,n,O--,I=I-A|0);else if(I>=0)d(C,K,y--,I);else if(I<=-A){I=-I-A|0;for(var r=0;r<y;++r){if(void 0!==(T=h(C[r],I)))return T}s(o,n,O++,I)}else{I=-I-1|0;for(r=0;r<O;++r){var T;if(void 0!==(T=h(I,o[r])))return T}s(C,K,y++,I)}}},sweepComplete:function(V,h,mV,t,L,A,k,M,c,z){for(var Q=0,J=2*V,v=V-1,D=J-1,H=mV;H<t;++H){var j=A[H]+1<<1,l=J*H;R[Q++]=L[l+v],R[Q++]=-j,R[Q++]=L[l+D],R[Q++]=j}for(H=k;H<M;++H){j=z[H]+1<<1;var G=J*H;R[Q++]=c[G+v],R[Q++]=1|-j,R[Q++]=c[G+D],R[Q++]=1|j}var y=Q>>>1;N(R,y);var O=0,I=0,r=0;for(H=0;H<y;++H){var T=0|R[2*H+1],F=1&T;if(H<y-1&&T>>1===R[2*H+3]>>1&&(F=2,H+=1),T<0){for(var p=-(T>>1)-1,Z=0;Z<r;++Z){if(void 0!==(f=h(q[Z],p)))return f}if(0!==F)for(Z=0;Z<O;++Z){if(void 0!==(f=h(C[Z],p)))return f}if(1!==F)for(Z=0;Z<I;++Z){var f;if(void 0!==(f=h(o[Z],p)))return f}0===F?s(C,K,O++,p):1===F?s(o,n,I++,p):2===F&&s(q,x,r++,p)}else{p=(T>>1)-1;0===F?d(C,K,O--,p):1===F?d(o,n,I--,p):2===F&&d(q,x,r--,p)}}},scanBipartite:function(V,h,mV,t,L,k,o,n,q,x,M,c){var z=0,Q=2*V,J=h,v=h+V,D=1,H=1;t?H=A:D=A;for(var j=L;j<k;++j){var l=j+D,G=Q*j;R[z++]=o[G+J],R[z++]=-l,R[z++]=o[G+v],R[z++]=l}for(j=q;j<x;++j){l=j+H;var y=Q*j;R[z++]=M[y+J],R[z++]=-l}var O=z>>>1;N(R,O);var I=0;for(j=0;j<O;++j){var r=0|R[2*j+1];if(r<0){var T=!1;if((l=-r)>=A?(T=!t,l-=A):(T=!!t,l-=1),T)s(C,K,I++,l);else{var F=c[l],p=Q*l,Z=M[p+h+1],f=M[p+h+1+V];V:for(var S=0;S<I;++S){var Y=C[S],w=Q*Y;if(!(f<o[w+h+1]||o[w+h+1+V]<Z)){for(var E=h+2;E<V;++E)if(M[p+E+V]<o[w+E]||o[w+E+V]<M[p+E])continue V;var g,i=n[Y];if(void 0!==(g=t?mV(F,i):mV(i,F)))return g}}}}else d(C,K,I--,r-D)}},scanComplete:function(V,h,mV,t,L,k,K,o,n,q,x){for(var d=0,s=2*V,M=h,c=h+V,z=t;z<L;++z){var Q=z+A,J=s*z;R[d++]=k[J+M],R[d++]=-Q,R[d++]=k[J+c],R[d++]=Q}for(z=o;z<n;++z){Q=z+1;var v=s*z;R[d++]=q[v+M],R[d++]=-Q}var D=d>>>1;N(R,D);var H=0;for(z=0;z<D;++z){var j=0|R[2*z+1];if(j<0){if((Q=-j)>=A)C[H++]=Q-A;else{var l=x[Q-=1],G=s*Q,y=q[G+h+1],O=q[G+h+1+V];V:for(var I=0;I<H;++I){var r=C[I],T=K[r];if(T===l)break;var F=s*r;if(!(O<k[F+h+1]||k[F+h+1+V]<y)){for(var p=h+2;p<V;++p)if(q[G+p+V]<k[F+p]||k[F+p+V]<q[G+p])continue V;var Z=mV(T,l);if(void 0!==Z)return Z}}}}else{for(Q=j-A,I=H-1;I>=0;--I)if(C[I]===Q){for(p=I+1;p<H;++p)C[p-1]=C[p];break}--H}}}};var t=mV(14357),L=mV(14363),N=mV(14388),A=1<<28,k=1024,C=t.mallocInt32(k),K=t.mallocInt32(k),o=t.mallocInt32(k),n=t.mallocInt32(k),q=t.mallocInt32(k),x=t.mallocInt32(k),R=t.mallocDouble(8192);function d(V,h,mV,t){var L=h[t],N=V[mV-1];V[L]=N,h[N]=L}function s(V,h,mV,t){V[mV]=t,h[t]=mV}},14370:V=>{"use strict";function h(V,mV,t){var L=0|V[t];if(L<=0)return[];var N,A=new Array(L);if(t===V.length-1)for(N=0;N<L;++N)A[N]=mV;else for(N=0;N<L;++N)A[N]=h(V,mV,t+1);return A}V.exports=function(V,mV){switch("undefined"===typeof mV&&(mV=0),typeof V){case"number":if(V>0)return function(V,h){var mV,t;for(mV=new Array(V),t=0;t<V;++t)mV[t]=h;return mV}(0|V,mV);break;case"object":if("number"===typeof V.length)return h(V,mV,0)}return[]}},14331:(V,h,mV)=>{V.exports=function(){var V=this;this.components={},this.comps=this.components;var h=this.components,mV=1,L={},N=[],A=[],k={timeout:!1,removals:[],multiComps:[]};function C(V,mV){var t=h[mV],N=L[mV],A=N.hash[V];A&&(N.remove(V),t.nh&&(t.multi?(A.forEach((h=>{h&&t.nh(V,h)})),A.length=0):t.nh(V,A)),k.removals.push(N),K())}function K(){k.timeout||(k.timeout=!0,setTimeout(o,1))}function o(){k.timeout=!1,n()}function n(){k.multiComps.length&&function(V){for(var h=0;h<V.length;h++){var{entID:mV,data:t}=V[h],L=t.hash[mV];if(L){for(var N=0;N<L.length;N++)L[N]||(L.splice(N,1),N--);0===L.length&&(t.remove(mV),k.removals.push(t))}}V.length=0}(k.multiComps),k.removals.length&&function(V){for(var h=0;h<V.length;h++){V[h].flush()}V.length=0}(k.removals)}this.zn=L,this._systems=N,this._renderSystems=A,this.No=function(h){var t=mV++;return Array.isArray(h)&&h.forEach((h=>V.wC(t,h))),t},this.deleteEntity=function(h){return Object.keys(L).forEach((V=>{L[V].hash[h]&&C(h,V)})),V},this.Qo=function(V){if(!V)throw new Error("Missing component definition");var mV=V.name;if(!mV)throw new Error("Component definition must have a name property.");if("string"!==typeof mV)throw new Error("Component name must be a string.");if(""===mV)throw new Error("Component name must be a non-empty string.");if(L[mV])throw new Error(`Component ${mV} already exists.`);var k={};return k.name=mV,k.multi=!!V.multi,k.order=isNaN(V.order)?99:V.order,k.stateConstructor=V.stateConstructor||null,k.state=V.state||{},k.Sk=V.Sk||null,k.nh=V.nh||null,k.system=V.system||null,k.bk=V.bk||null,h[mV]=k,L[mV]=new t,L[mV]._pendingMultiCleanup=!1,L[mV]._multiCleanupIDs=k.multi?[]:null,k.system&&(N.push(mV),N.sort(((V,mV)=>h[V].order-h[mV].order))),k.bk&&(A.push(mV),A.sort(((V,mV)=>h[V].order-h[mV].order))),mV},this.overwriteComponent=function(V,mV){var t=h[V];if(!t)throw new Error(`Unknown component: ${V}`);if(!mV)throw new Error("Missing component definition");if(t.name!==mV.name)throw new Error("Overwriting component must use the same name property.");var k={};k.name=V,k.multi=!!mV.multi,k.order=isNaN(mV.order)?99:mV.order,k.state=mV.state||{},k.Sk=mV.Sk||null,k.nh=mV.nh||null,k.system=mV.system||null,k.bk=mV.bk||null,h[V]=k,L[V]._pendingMultiCleanup=!1,L[V]._multiCleanupIDs=k.multi?[]:null;var C=N.indexOf(V);k.system&&C<0&&N.push(V),!k.system&&C>=0&&N.splice(C,1),N.sort(((V,mV)=>h[V].order-h[mV].order));var K=A.indexOf(V);k.bk&&K<0&&A.push(V),!k.bk&&K>=0&&A.splice(K,1),A.sort(((V,mV)=>h[V].order-h[mV].order));var o=k.state;return this.YK(V).forEach((V=>{for(var h in o)h in V||(V[h]=o[h]);k.Sk&&k.Sk(V.gk,V)})),V},this.deleteComponent=function(mV){var t=L[mV];if(!t)throw new Error(`Unknown component: ${mV}`);t.flush(),t.list.forEach((V=>{V&&C(V.gk||V[0].gk,mV)}));var k=N.indexOf(mV),K=A.indexOf(mV);return k>-1&&N.splice(k,1),K>-1&&A.splice(K,1),L[mV].dispose(),delete L[mV],delete h[mV],V},this.wC=function(V,mV,t){var N,A=h[mV],k=L[mV];if(!k)throw new Error(`Unknown component: ${mV}.`);if(k.hash[V]&&!A.multi)throw new Error(`Entity ${V} already has component: ${mV}.`);if(A.stateConstructor){if(!(N=new A.stateConstructor).hasOwnProperty("gk"))throw new Error(`Component ${A.name} stateConstructor type does not have property __id`)}else N=Object.assign({},{gk:V},A.state,t);if(N.gk=V,A.multi){var C=k.hash[V];C||(C=[],k.add(V,C)),C.push(N)}else k.add(V,N);return A.Sk&&A.Sk(V,N),this},this.XC=function(V,h){var mV=L[h];if(!mV)throw new Error(`Unknown component: ${h}.`);return!!mV.hash[V]},this.bC=function(h,mV){if(!L[mV])throw new Error(`Unknown component: ${mV}.`);return C(h,mV),V},this.getState=function(V,h){var mV=L[h];if(!mV)throw new Error(`Unknown component: ${h}.`);return mV.hash[V]},this.YK=function(V){var h=L[V];if(!h)throw new Error(`Unknown component: ${V}.`);return n(),h.list},this.Cx=function(V){if(!L[V])throw new Error(`Unknown component: ${V}.`);var h=L[V].hash;return V=>h[V]},this.qx=function(V){if(!L[V])throw new Error(`Unknown component: ${V}.`);var h=L[V].hash;return V=>!!h[V]},this.kk=function(mV){n();for(var t=0;t<N.length;t++){var A=N[t],k=h[A],C=L[A];k.system(mV,C.list),n()}return V},this.render=function(mV){n();for(var t=0;t<A.length;t++){var N=A[t],k=h[N],C=L[N];k.bk(mV,C.list),n()}return V},this.removeMultiComponent=function(mV,t,N){var A=h[t],C=L[t];if(!C)throw new Error(`Unknown component: ${t}.`);if(!A.multi)throw new Error("removeMultiComponent called on non-multi component");return function(V,h,mV,t){var L=mV.hash[V];if(L){var N=L[t];N&&(L[t]=null,h.nh&&h.nh(V,N),k.multiComps.push({entID:V,data:mV}),K())}}(mV,A,C,N),V}};var t=mV(14336)},14336:V=>{function h(V,h){var mV=V._map[h];if(delete V.hash[h],delete V._map[h],mV===V.list.length-1)V.list.pop();else{var t=V.list.pop();if(V.list[mV]=t,null===t||null===t[0]){var L=V.list.length;for(var N in V._map)if(V._map[N]===L)return void(V._map[N]=mV)}else{var A=t.gk||t[0].gk;V._map[A]=mV}}}V.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(V,h){if("number"===typeof this._map[V]){var mV=this._map[V];this.hash[V]=h,this.list[mV]=h}else this._map[V]=this.list.length,this.hash[V]=h,this.list.push(h)}remove(V){var h=this._map[V];this.hash[V]=null,this.list[h]=null,this._pendingRemovals.push(V)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var V=0;V<this._pendingRemovals.length;V++){var mV=this._pendingRemovals[V];null===this.hash[mV]&&h(this,mV)}this._pendingRemovals.length=0}}},14292:V=>{"use strict";var h,mV="object"===typeof Reflect?Reflect:null,t=function(V,h,mV){return Function.prototype.apply.call(V,h,mV)};h=mV&&"function"===typeof mV.ownKeys?mV.ownKeys:Object.getOwnPropertySymbols?function(V){return Object.getOwnPropertyNames(V).concat(Object.getOwnPropertySymbols(V))}:function(V){return Object.getOwnPropertyNames(V)};var L=Number.isNaN||function(V){return V!==V};function N(){N.init.call(this)}V.exports=N,V.exports.once=function(V,h){return new Promise((function(mV,t){function L(mV){V.removeListener(h,N),t(mV)}function N(){"function"===typeof V.removeListener&&V.removeListener("error",L),mV([].slice.call(arguments))}d(V,h,N,{once:!0}),"error"!==h&&function(V,h,mV){"function"===typeof V.on&&d(V,"error",h,mV)}(V,L,{once:!0})}))},N.EventEmitter=N,N.prototype._events=void 0,N.prototype._eventsCount=0,N.prototype._maxListeners=void 0;var A=10;function k(V){if("function"!==typeof V)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof V)}function C(V){return void 0===V._maxListeners?N.defaultMaxListeners:V._maxListeners}function K(V,h,mV,t){var L,N,A,K;if(k(mV),void 0===(N=V._events)?(N=V._events=Object.create(null),V._eventsCount=0):(void 0!==N.newListener&&(V.emit("newListener",h,mV.listener?mV.listener:mV),N=V._events),A=N[h]),void 0===A)A=N[h]=mV,++V._eventsCount;else if("function"===typeof A?A=N[h]=t?[mV,A]:[A,mV]:t?A.unshift(mV):A.push(mV),(L=C(V))>0&&A.length>L&&!A.warned){A.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(h)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.Lh=V,o.type=h,o.count=A.length,K=o,console&&console.warn&&console.warn(K)}return V}function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function n(V,h,mV){var t={fired:!1,wrapFn:void 0,target:V,type:h,listener:mV},L=o.bind(t);return L.listener=mV,t.wrapFn=L,L}function q(V,h,mV){var t=V._events;if(void 0===t)return[];var L=t[h];return void 0===L?[]:"function"===typeof L?mV?[L.listener||L]:[L]:mV?function(V){for(var h=new Array(V.length),mV=0;mV<h.length;++mV)h[mV]=V[mV].listener||V[mV];return h}(L):R(L,L.length)}function x(V){var h=this._events;if(void 0!==h){var mV=h[V];if("function"===typeof mV)return 1;if(void 0!==mV)return mV.length}return 0}function R(V,h){for(var mV=new Array(h),t=0;t<h;++t)mV[t]=V[t];return mV}function d(V,h,mV,t){if("function"===typeof V.on)t.once?V.once(h,mV):V.on(h,mV);else{if("function"!==typeof V.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof V);V.addEventListener(h,(function L(N){t.once&&V.removeEventListener(h,L),mV(N)}))}}Object.defineProperty(N,"defaultMaxListeners",{enumerable:!0,get:function(){return A},set:function(V){if("number"!==typeof V||V<0||L(V))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+V+".");A=V}}),N.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},N.prototype.setMaxListeners=function(V){if("number"!==typeof V||V<0||L(V))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+V+".");return this._maxListeners=V,this},N.prototype.getMaxListeners=function(){return C(this)},N.prototype.emit=function(V){for(var h=[],mV=1;mV<arguments.length;mV++)h.push(arguments[mV]);var L="error"===V,N=this._events;if(void 0!==N)L=L&&void 0===N.error;else if(!L)return!1;if(L){var A;if(h.length>0&&(A=h[0]),A instanceof Error)throw A;var k=new Error("Unhandled error."+(A?" ("+A.message+")":""));throw k.context=A,k}var C=N[V];if(void 0===C)return!1;if("function"===typeof C)t(C,this,h);else{var K=C.length,o=R(C,K);for(mV=0;mV<K;++mV)t(o[mV],this,h)}return!0},N.prototype.addListener=function(V,h){return K(this,V,h,!1)},N.prototype.on=N.prototype.addListener,N.prototype.prependListener=function(V,h){return K(this,V,h,!0)},N.prototype.once=function(V,h){return k(h),this.on(V,n(this,V,h)),this},N.prototype.prependOnceListener=function(V,h){return k(h),this.prependListener(V,n(this,V,h)),this},N.prototype.removeListener=function(V,h){var mV,t,L,N,A;if(k(h),void 0===(t=this._events))return this;if(void 0===(mV=t[V]))return this;if(mV===h||mV.listener===h)0===--this._eventsCount?this._events=Object.create(null):(delete t[V],t.removeListener&&this.emit("removeListener",V,mV.listener||h));else if("function"!==typeof mV){for(L=-1,N=mV.length-1;N>=0;N--)if(mV[N]===h||mV[N].listener===h){A=mV[N].listener,L=N;break}if(L<0)return this;0===L?mV.shift():function(V,h){for(;h+1<V.length;h++)V[h]=V[h+1];V.pop()}(mV,L),1===mV.length&&(t[V]=mV[0]),void 0!==t.removeListener&&this.emit("removeListener",V,A||h)}return this},N.prototype.off=N.prototype.removeListener,N.prototype.Nh=function(V){var h,mV,t;if(void 0===(mV=this._events))return this;if(void 0===mV.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==mV[V]&&(0===--this._eventsCount?this._events=Object.create(null):delete mV[V]),this;if(0===arguments.length){var L,N=Object.keys(mV);for(t=0;t<N.length;++t)"removeListener"!==(L=N[t])&&this.Nh(L);return this.Nh("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(h=mV[V]))this.removeListener(V,h);else if(void 0!==h)for(t=h.length-1;t>=0;t--)this.removeListener(V,h[t]);return this},N.prototype.listeners=function(V){return q(this,V,!0)},N.prototype.rawListeners=function(V){return q(this,V,!1)},N.listenerCount=function(V,h){return"function"===typeof V.listenerCount?V.listenerCount(h):x.call(V,h)},N.prototype.listenerCount=x,N.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]}},14584:V=>{"use strict";V.exports=function(V,h,mV,t,L,N){var A=+h[0],k=+h[1],C=+h[2],K=+mV[0],o=+mV[1],n=+mV[2],q=Math.sqrt(K*K+o*o+n*n);if(0===q)throw new Error("Can't raycast along a zero vector");return function(V,h,mV,t,L,N,A,k,C,K){for(var o=0,n=Math.floor,q=0|n(h),x=0|n(mV),R=0|n(t),d=L>0?1:-1,s=N>0?1:-1,M=A>0?1:-1,c=Math.abs(1/L),z=Math.abs(1/N),Q=Math.abs(1/A),J=c<1/0?c*(d>0?q+1-h:h-q):1/0,v=z<1/0?z*(s>0?x+1-mV:mV-x):1/0,D=Q<1/0?Q*(M>0?R+1-t:t-R):1/0,H=-1;o<=k;){var j=V(q,x,R);if(j)return C&&(C[0]=h+o*L,C[1]=mV+o*N,C[2]=t+o*A),K&&(K[0]=K[1]=K[2]=0,0===H&&(K[0]=-d),1===H&&(K[1]=-s),2===H&&(K[2]=-M)),j;J<v?J<D?(q+=d,o=J,J+=c,H=0):(R+=M,o=D,D+=Q,H=2):v<D?(x+=s,o=v,v+=z,H=1):(R+=M,o=D,D+=Q,H=2)}return C&&(C[0]=h+o*L,C[1]=mV+o*N,C[2]=t+o*A),K&&(K[0]=K[1]=K[2]=0),0}(V,A,k,C,K/=q,o/=q,n/=q,t="undefined"===typeof t?64:+t,L,N)}},14618:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>N});var t=mV(14292);function L(){this.Kq=!1,this.stopPropagation=!1,this.oq=!1,this.disabled=!1}class N{constructor(V,h){this.version="0.7.0";var mV=Object.assign({},new L,h||{});this.element=V||document,this.Kq=!!mV.Kq,this.stopPropagation=!!mV.stopPropagation,this.oq=!!mV.oq,this.disabled=!!mV.disabled,this.filterEvents=(V,h)=>!0,this.down=new t.EventEmitter,this.up=new t.EventEmitter,this.state={},this.TK={dx:0,dy:0,Bq:0,rK:0,Vx:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?k(this):document.addEventListener("DOMContentLoaded",(V=>{k(this)}),{once:!0})}bind(V){for(var h=arguments.length,mV=new Array(h>1?h-1:0),t=1;t<h;t++)mV[t-1]=arguments[t];mV.forEach((h=>{var mV=this._keyBindmap[h]||[];mV.includes(V)||(mV.push(V),this._keyBindmap[h]=mV)})),this.state[V]=!!this.state[V],this.pressCount[V]=this.pressCount[V]||0,this.releaseCount[V]=this.releaseCount[V]||0}unbind(V){for(var h in this._keyBindmap){var mV=this._keyBindmap[h],t=mV.indexOf(V);t>-1&&mV.splice(t,1)}}getBindings(){var V={};for(var h in this._keyBindmap){this._keyBindmap[h].forEach((mV=>{V[mV]=V[mV]||[],V[mV].push(h)}))}return V}kk(){A(this.TK),A(this.pressCount),A(this.releaseCount)}}function A(V){for(var h in V)V[h]=0}function k(V){window.addEventListener("keydown",R.bind(null,V,!0),!1),window.addEventListener("keyup",R.bind(null,V,!1),!1);var h={passive:!0};V.element.addEventListener("touchstart",n.bind(void 0,V),{passive:!1}),V.element.addEventListener("touchend",x.bind(void 0,V),h),V.element.addEventListener("mousedown",d.bind(null,V,!0),h),window.document.addEventListener("mouseup",d.bind(null,V,!1),h),V.element.addEventListener("touchmove",s.bind(null,V),h),V.element.addEventListener("mousemove",s.bind(null,V),h),window.PointerEvent,V.element.addEventListener("wheel",M.bind(null,V),h),V.element.addEventListener("contextmenu",c.bind(null,V),!1),window.addEventListener("blur",z.bind(null,V),!1)}var C=0,K=0,o=null;function n(V,h){h.preventDefault(),q(h)}function q(V){let h=!1;for(let mV=0;mV<V.touches.length;++mV)if(V.touches[mV].identifier===o){h=!0;break}if(!h){const h=V.changedTouches[0];C=h.clientX,K=h.clientY,o=h.identifier}}function x(V,h){for(var mV=h.changedTouches,t=0;t<mV.length;++t)mV[t].identifier===o&&(o=null)}function R(V,h,mV){Q(mV.code,h,V,mV)}function d(V,h,mV){if("pointerId"in mV)if(h){if(null!==V._touches.currID)return;V._touches.currID=mV.pointerId}else{if(V._touches.currID!==mV.pointerId)return;V._touches.currID=null}return Q("Mouse"+("button"in mV?mV.button+1:1),h,V,mV),!1}function s(V,h){var mV=h.movementX||h.mozMovementX||0,t=h.movementY||h.mozMovementY||0;if(h.touches&&0===(mV|t)){var L=function(V){q(V);for(let h=0;h<V.changedTouches.length;++h)if(V.changedTouches[h].identifier==o){const mV=V.changedTouches[h],t=[mV.clientX-C,mV.clientY-K];return C=mV.clientX,K=mV.clientY,t}return console.error(`Did not find touch id ${o}`),[0,0]}(h);mV=L[0],t=L[1]}V.TK.dx+=mV,V.TK.dy+=t}function M(V,h){var mV=1;switch(h.deltaMode){case 0:mV=1;break;case 1:mV=12;break;case 2:mV=V.element.clientHeight||window.innerHeight}V.TK.Bq+=(h.deltaX||0)*mV,V.TK.rK+=(h.deltaY||0)*mV,V.TK.Vx+=(h.deltaZ||0)*mV}function c(V,h){if(!V.oq)return h.preventDefault(),!1}function z(V){for(var h in V._keyStates)V._keyStates[h]&&(/^Mouse\d/.test(h)||Q(h,!1,V,{code:h,note:"btyzrhd4moc",preventDefault:()=>{},stopPropagation:()=>{}}))}function Q(V,h,mV,t){var L=mV._keyBindmap[V];L&&(J(mV._keyStates[V],h)&&(mV._keyStates[V]=h,L.forEach((V=>{(!mV.filterEvents||mV.filterEvents(t,V))&&function(V,h,mV,t){var L=h?mV.pressCount:mV.releaseCount;L[V]=(L[V]||0)+1;var N=mV._bindPressCount[V]||0;(N+=h?1:-1)<0&&(N=0);mV._bindPressCount[V]=N;var A=mV.state[V];if(J(A,N)){mV.state[V]=N>0;var k=h?mV.down:mV.up;mV.disabled||k.emit(V,t)}}(V,h,mV,t)}))),"button"in t||(mV.Kq&&!t.defaultPrevented&&t.preventDefault(),mV.stopPropagation&&t.stopPropagation()))}function J(V,h){return V?!h:h}},13291:V=>{V.exports=function(V,h,mV){return V[0]=h[0]+mV[0],V[1]=h[1]+mV[1],V[2]=h[2]+mV[2],V}},13243:(V,h,mV)=>{V.exports=function(V,h){var mV=t(V[0],V[1],V[2]),A=t(h[0],h[1],h[2]);L(mV,mV),L(A,A);var k=N(mV,A);return k>1?0:Math.acos(k)};var t=mV(13246),L=mV(13253),N=mV(13260)},13358:V=>{V.exports=function(V,h){return V[0]=Math.ceil(h[0]),V[1]=Math.ceil(h[1]),V[2]=Math.ceil(h[2]),V}},13236:V=>{V.exports=function(V){var h=new Float32Array(3);return h[0]=V[0],h[1]=V[1],h[2]=V[2],h}},13268:V=>{V.exports=function(V,h){return V[0]=h[0],V[1]=h[1],V[2]=h[2],V}},13229:V=>{V.exports=function(){var V=new Float32Array(3);return V[0]=0,V[1]=0,V[2]=0,V}},13429:V=>{V.exports=function(V,h,mV){var t=h[0],L=h[1],N=h[2],A=mV[0],k=mV[1],C=mV[2];return V[0]=L*C-N*k,V[1]=N*A-t*C,V[2]=t*k-L*A,V}},13374:(V,h,mV)=>{V.exports=mV(13372)},13372:V=>{V.exports=function(V,h){var mV=h[0]-V[0],t=h[1]-V[1],L=h[2]-V[2];return Math.sqrt(mV*mV+t*t+L*L)}},13331:(V,h,mV)=>{V.exports=mV(13325)},13325:V=>{V.exports=function(V,h,mV){return V[0]=h[0]/mV[0],V[1]=h[1]/mV[1],V[2]=h[2]/mV[2],V}},13260:V=>{V.exports=function(V,h){return V[0]*h[0]+V[1]*h[1]+V[2]*h[2]}},13222:V=>{V.exports=1e-6},13279:(V,h,mV)=>{V.exports=function(V,h){var mV=V[0],L=V[1],N=V[2],A=h[0],k=h[1],C=h[2];return Math.abs(mV-A)<=t*Math.max(1,Math.abs(mV),Math.abs(A))&&Math.abs(L-k)<=t*Math.max(1,Math.abs(L),Math.abs(k))&&Math.abs(N-C)<=t*Math.max(1,Math.abs(N),Math.abs(C))};var t=mV(13222)},13286:V=>{V.exports=function(V,h){return V[0]===h[0]&&V[1]===h[1]&&V[2]===h[2]}},13353:V=>{V.exports=function(V,h){return V[0]=Math.floor(h[0]),V[1]=Math.floor(h[1]),V[2]=Math.floor(h[2]),V}},13484:(V,h,mV)=>{V.exports=function(V,h,mV,L,N,A){var k,C;h||(h=3);mV||(mV=0);C=L?Math.min(L*h+mV,V.length):V.length;for(k=mV;k<C;k+=h)t[0]=V[k],t[1]=V[k+1],t[2]=V[k+2],N(t,t,A),V[k]=t[0],V[k+1]=t[1],V[k+2]=t[2];return V};var t=mV(13229)()},13246:V=>{V.exports=function(V,h,mV){var t=new Float32Array(3);return t[0]=V,t[1]=h,t[2]=mV,t}},13215:(V,h,mV)=>{V.exports={EPSILON:mV(13222),create:mV(13229),clone:mV(13236),angle:mV(13243),aA:mV(13246),i:mV(13268),set:mV(13275),equals:mV(13279),exactEquals:mV(13286),add:mV(13291),Mh:mV(13297),sub:mV(13306),multiply:mV(13314),mul:mV(13317),divide:mV(13325),div:mV(13331),min:mV(13339),max:mV(13348),floor:mV(13353),ceil:mV(13358),round:mV(13364),scale:mV(13367),BA:mV(13369),distance:mV(13372),k:mV(13374),squaredDistance:mV(13381),sqrDist:mV(13389),length:mV(13396),len:mV(13400),squaredLength:mV(13405),Vk:mV(13414),negate:mV(13420),inverse:mV(13425),normalize:mV(13253),dot:mV(13260),cross:mV(13429),eA:mV(13436),random:mV(13442),transformMat4:mV(13451),transformMat3:mV(13456),transformQuat:mV(13463),hk:mV(13467),mC:mV(13475),tk:mV(13481),forEach:mV(13484)}},13425:V=>{V.exports=function(V,h){return V[0]=1/h[0],V[1]=1/h[1],V[2]=1/h[2],V}},13400:(V,h,mV)=>{V.exports=mV(13396)},13396:V=>{V.exports=function(V){var h=V[0],mV=V[1],t=V[2];return Math.sqrt(h*h+mV*mV+t*t)}},13436:V=>{V.exports=function(V,h,mV,t){var L=h[0],N=h[1],A=h[2];return V[0]=L+t*(mV[0]-L),V[1]=N+t*(mV[1]-N),V[2]=A+t*(mV[2]-A),V}},13348:V=>{V.exports=function(V,h,mV){return V[0]=Math.max(h[0],mV[0]),V[1]=Math.max(h[1],mV[1]),V[2]=Math.max(h[2],mV[2]),V}},13339:V=>{V.exports=function(V,h,mV){return V[0]=Math.min(h[0],mV[0]),V[1]=Math.min(h[1],mV[1]),V[2]=Math.min(h[2],mV[2]),V}},13317:(V,h,mV)=>{V.exports=mV(13314)},13314:V=>{V.exports=function(V,h,mV){return V[0]=h[0]*mV[0],V[1]=h[1]*mV[1],V[2]=h[2]*mV[2],V}},13420:V=>{V.exports=function(V,h){return V[0]=-h[0],V[1]=-h[1],V[2]=-h[2],V}},13253:V=>{V.exports=function(V,h){var mV=h[0],t=h[1],L=h[2],N=mV*mV+t*t+L*L;N>0&&(N=1/Math.sqrt(N),V[0]=h[0]*N,V[1]=h[1]*N,V[2]=h[2]*N);return V}},13442:V=>{V.exports=function(V,h){h=h||1;var mV=2*Math.random()*Math.PI,t=2*Math.random()-1,L=Math.sqrt(1-t*t)*h;return V[0]=Math.cos(mV)*L,V[1]=Math.sin(mV)*L,V[2]=t*h,V}},13467:V=>{V.exports=function(V,h,mV,t){var L=mV[1],N=mV[2],A=h[1]-L,k=h[2]-N,C=Math.sin(t),K=Math.cos(t);return V[0]=h[0],V[1]=L+A*K-k*C,V[2]=N+A*C+k*K,V}},13475:V=>{V.exports=function(V,h,mV,t){var L=mV[0],N=mV[2],A=h[0]-L,k=h[2]-N,C=Math.sin(t),K=Math.cos(t);return V[0]=L+k*C+A*K,V[1]=h[1],V[2]=N+k*K-A*C,V}},13481:V=>{V.exports=function(V,h,mV,t){var L=mV[0],N=mV[1],A=h[0]-L,k=h[1]-N,C=Math.sin(t),K=Math.cos(t);return V[0]=L+A*K-k*C,V[1]=N+A*C+k*K,V[2]=h[2],V}},13364:V=>{V.exports=function(V,h){return V[0]=Math.round(h[0]),V[1]=Math.round(h[1]),V[2]=Math.round(h[2]),V}},13367:V=>{V.exports=function(V,h,mV){return V[0]=h[0]*mV,V[1]=h[1]*mV,V[2]=h[2]*mV,V}},13369:V=>{V.exports=function(V,h,mV,t){return V[0]=h[0]+mV[0]*t,V[1]=h[1]+mV[1]*t,V[2]=h[2]+mV[2]*t,V}},13275:V=>{V.exports=function(V,h,mV,t){return V[0]=h,V[1]=mV,V[2]=t,V}},13389:(V,h,mV)=>{V.exports=mV(13381)},13414:(V,h,mV)=>{V.exports=mV(13405)},13381:V=>{V.exports=function(V,h){var mV=h[0]-V[0],t=h[1]-V[1],L=h[2]-V[2];return mV*mV+t*t+L*L}},13405:V=>{V.exports=function(V){var h=V[0],mV=V[1],t=V[2];return h*h+mV*mV+t*t}},13306:(V,h,mV)=>{V.exports=mV(13297)},13297:V=>{V.exports=function(V,h,mV){return V[0]=h[0]-mV[0],V[1]=h[1]-mV[1],V[2]=h[2]-mV[2],V}},13456:V=>{V.exports=function(V,h,mV){var t=h[0],L=h[1],N=h[2];return V[0]=t*mV[0]+L*mV[3]+N*mV[6],V[1]=t*mV[1]+L*mV[4]+N*mV[7],V[2]=t*mV[2]+L*mV[5]+N*mV[8],V}},13451:V=>{V.exports=function(V,h,mV){var t=h[0],L=h[1],N=h[2],A=mV[3]*t+mV[7]*L+mV[11]*N+mV[15];return A=A||1,V[0]=(mV[0]*t+mV[4]*L+mV[8]*N+mV[12])/A,V[1]=(mV[1]*t+mV[5]*L+mV[9]*N+mV[13])/A,V[2]=(mV[2]*t+mV[6]*L+mV[10]*N+mV[14])/A,V}},13463:V=>{V.exports=function(V,h,mV){var t=h[0],L=h[1],N=h[2],A=mV[0],k=mV[1],C=mV[2],K=mV[3],o=K*t+k*N-C*L,n=K*L+C*t-A*N,q=K*N+A*L-k*t,x=-A*t-k*L-C*N;return V[0]=o*K+x*-A+n*-C-q*-k,V[1]=n*K+x*-k+q*-A-o*-C,V[2]=q*K+x*-C+o*-k-n*-A,V}},14319:V=>{"use strict";V.exports=function(V){for(var h=new Array(V),mV=0;mV<V;++mV)h[mV]=mV;return h}},14375:V=>{V.exports=function(V){return null!=V&&null!=V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}},14592:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>t});class t{constructor(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.io=!1,this.bo=!1,this.wo=30,this.Eo=0,this.Bo=!1,this.fullscreen=!1,this.Uo=function(V){},this.uo=function(){},this.Xo=function(){},this.jh=function(){},this.eo=function(V){},this.onFullscreenChanged=function(V){},K((()=>{!function(V,h){V._nowObject=performance||Date,V._lastTick=0,V._renderAccum=0,V._rt=0,V._frameCB=k.bind(null,V),requestAnimationFrame(V._frameCB),h>0&&(V._intervalCB=A.bind(null,V),V._interval=setInterval(V._intervalCB,Math.max(h,1e3/V.wo/2)))}(this,h),function(V,h){if(!h)return;var mV=!1,t=!1;document.addEventListener("pointerlockchange",(t=>{mV=document.pointerLockElement===h,V.eo(mV)})),document.addEventListener("fullscreenchange",(mV=>{t=document.fullscreenElement===h,V.onFullscreenChanged(t)})),Object.defineProperty(V,"Bo",{get:()=>mV,set:V=>{V&&!mV?C(h):mV&&!V&&function(V){V.exitPointerLock&&V.exitPointerLock()}(document)}}),Object.defineProperty(V,"fullscreen",{get:()=>t,set:V=>{V&&!t?h.requestFullscreen():t&&!V&&document.exitFullscreen()}}),h.addEventListener("click",(L=>{V.io&&!mV&&C(h),V.bo&&!t&&h.requestFullscreen()}));var L=()=>V.jh();if(window.ResizeObserver){new ResizeObserver(L).observe(h)}else window.addEventListener("resize",L)}(this,V),this.Xo()}))}}var L=3,N=20;function A(V){for(var h=1e3/V.wo,mV=V._nowObject.now()+N,t=0;V._nowObject.now()>=V._lastTick+h&&V._nowObject.now()<mV&&++t<=L;)V.Uo(h),V._lastTick+=h;var A=5*(h+5),k=V._nowObject.now();if(k-V._lastTick>A)for(;k>=V._lastTick+h;)V._lastTick+=h}function k(V){requestAnimationFrame(V._frameCB),A(V);var h=V._nowObject.now(),mV=h-V._rt;if(V._rt=h,V.Eo>0){V._renderAccum+=mV;var t=1e3/V.Eo;if(V._renderAccum<t)return;V._renderAccum=Math.min(V._renderAccum-t,t)}var L=1e3/V.wo,N=(h-V._lastTick)/L;V.uo(mV,N,L)}function C(V){V.requestPointerLock&&V.requestPointerLock()}var K=V=>{if("loading"===document.readyState){var h=()=>{document.removeEventListener("readystatechange",h),V()};document.addEventListener("readystatechange",h)}else setTimeout(V,1)}},14312:(V,h,mV)=>{var t=mV(14319),L=mV(14321),N="undefined"!==typeof Float64Array;function A(V,h){return V[0]-h[0]}function k(){var V,h=this.stride,mV=new Array(h.length);for(V=0;V<mV.length;++V)mV[V]=[Math.abs(h[V]),V];mV.sort(A);var t=new Array(mV.length);for(V=0;V<t.length;++V)t[V]=mV[V][1];return t}function C(V,h){var mV=["View",h,"d",V].join("");h<0&&(mV="View_Nil"+V);var L="generic"===V;if(-1===h){var N="function "+mV+"(a){this.data=a;};var proto="+mV+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+mV+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+mV+"(a){return new "+mV+"(a);}";return new Function(N)()}if(0===h){N="function "+mV+"(a,d) {this.data = a;this.offset = d};var proto="+mV+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+mV+"_copy() {return new "+mV+"(this.data,this.offset)};proto.pick=function "+mV+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+mV+"_get(){return "+(L?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+mV+"_set(v){return "+(L?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+mV+"(a,b,c,d){return new "+mV+"(a,d)}";return new Function("TrivialArray",N)(K[V][0])}N=["'use strict'"];var A=t(h),C=A.map((function(V){return"i"+V})),o="this.offset+"+A.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),n=A.map((function(V){return"b"+V})).join(","),q=A.map((function(V){return"c"+V})).join(",");N.push("function "+mV+"(a,"+n+","+q+",d){this.data=a","this.shape=["+n+"]","this.stride=["+q+"]","this.offset=d|0}","var proto="+mV+".prototype","proto.dtype='"+V+"'","proto.dimension="+h),N.push("Object.defineProperty(proto,'size',{get:function "+mV+"_size(){return "+A.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===h?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),h<4?(N.push("function "+mV+"_order(){"),2===h?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+mV+"_set("+C.join(",")+",v){"),L?N.push("return this.data.set("+o+",v)}"):N.push("return this.data["+o+"]=v}"),N.push("proto.get=function "+mV+"_get("+C.join(",")+"){"),L?N.push("return this.data.get("+o+")}"):N.push("return this.data["+o+"]}"),N.push("proto.index=function "+mV+"_index(",C.join(),"){return "+o+"}"),N.push("proto.hi=function "+mV+"_hi("+C.join(",")+"){return new "+mV+"(this.data,"+A.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+A.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var x=A.map((function(V){return"a"+V+"=this.shape["+V+"]"})),R=A.map((function(V){return"c"+V+"=this.stride["+V+"]"}));N.push("proto.lo=function "+mV+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+R.join(","));for(var d=0;d<h;++d)N.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");N.push("return new "+mV+"(this.data,"+A.map((function(V){return"a"+V})).join(",")+","+A.map((function(V){return"c"+V})).join(",")+",b)}"),N.push("proto.step=function "+mV+"_step("+C.join(",")+"){var "+A.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+A.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<h;++d)N.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");N.push("return new "+mV+"(this.data,"+A.map((function(V){return"a"+V})).join(",")+","+A.map((function(V){return"b"+V})).join(",")+",c)}");var s=new Array(h),M=new Array(h);for(d=0;d<h;++d)s[d]="a[i"+d+"]",M[d]="b[i"+d+"]";N.push("proto.transpose=function "+mV+"_transpose("+C+"){"+C.map((function(V,h){return V+"=("+V+"===undefined?"+h+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+mV+"(this.data,"+s.join(",")+","+M.join(",")+",this.offset)}"),N.push("proto.pick=function "+mV+"_pick("+C+"){var a=[],b=[],c=this.offset");for(d=0;d<h;++d)N.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+mV+"(data,shape,stride,offset){return new "+mV+"(data,"+A.map((function(V){return"shape["+V+"]"})).join(",")+","+A.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(K[V],k)}var K={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,h,mV,t){if(void 0===V)return(0,K.array[0])([]);"number"===typeof V&&(V=[V]),void 0===h&&(h=[V.length]);var A=h.length;if(void 0===mV){mV=new Array(A);for(var k=A-1,o=1;k>=0;--k)mV[k]=o,o*=h[k]}if(void 0===t){t=0;for(k=0;k<A;++k)mV[k]<0&&(t-=(h[k]-1)*mV[k])}for(var n=function(V){if(L(V))return"buffer";if(N)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),q=K[n];q.length<=A+1;)q.push(C(n,q.length-1));return(0,q[A+1])(V,h,mV,t)}},14321:V=>{function h(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(h(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&h(V.slice(0,0))}(V)||!!V._isBuffer)}},14466:V=>{"use strict";var h=[],mV=[],t=[],L=[],N=[],A=[],k=[],C=[],K=[],o=[],n=[],q=[];V.exports=function(V,x,R,d,s,M){for(var c=k,z=K,Q=o,J=q,v=0;v<3;v++)c[v]=+R[v],Q[v]=+x.max[v],z[v]=+x.base[v];M||(M=1e-10);var D=function(V,k,K,o,q,x){var R=h,d=mV,s=t,M=L,c=N,z=A,Q=C,J=Math.floor,v=0,D=0,H=0,j=0,l=0;if(G(),0===H)return 0;for(j=I();D<=H;){if(y(j)&&O())return v;j=I()}for(v+=H,l=0;l<3;l++)o[l]+=K[l],q[l]+=K[l];return v;function G(){if(D=0,0!==(H=Math.sqrt(K[0]*K[0]+K[1]*K[1]+K[2]*K[2])))for(var V=0;V<3;V++){var h=K[V]>=0;M[V]=h?1:-1;var mV=h?q[V]:o[V];R[V]=h?o[V]:q[V],d[V]=r(mV,M[V]),s[V]=T(R[V],M[V]),Q[V]=K[V]/H,c[V]=Math.abs(1/Q[V]);var t=h?d[V]+1-mV:mV-d[V];z[V]=c[V]<1/0?c[V]*t:1/0}}function y(h){for(var mV=M[0],t=0===h?d[0]:s[0],L=d[0]+mV,N=M[1],A=1===h?d[1]:s[1],k=d[1]+N,C=M[2],K=2===h?d[2]:s[2],o=d[2]+C,n=t;n!=L;n+=mV)for(var q=A;q!=k;q+=N)for(var x=K;x!=o;x+=C)if(V(n,q,x))return!0;return!1}function O(){v+=D;var V=M[j],h=D/H,mV=n;for(l=0;l<3;l++){var t=K[l]*h;o[l]+=t,q[l]+=t,mV[l]=K[l]-t}if(V>0?q[j]=Math.round(q[j]):o[j]=Math.round(o[j]),k(v,j,V,mV))return!0;for(l=0;l<3;l++)K[l]=mV[l];return G(),0===H}function I(){var V=z[0]<z[1]?z[0]<z[2]?0:2:z[1]<z[2]?1:2,h=z[V]-D;for(D=z[V],d[V]+=M[V],z[V]+=c[V],l=0;l<3;l++)R[l]+=h*Q[l],s[l]=T(R[l],M[l]);return V}function r(V,h){return J(V-h*x)}function T(V,h){return J(V+h*x)}}(V,d,c,z,Q,M);if(!s){for(v=0;v<3;v++)J[v]=R[v]>0?Q[v]-x.max[v]:z[v]-x.base[v];x.translate(J)}return D}},14621:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>n});var t=mV(14461),L=mV(13215);class N{constructor(V,h,mV,N,A,k,C){this.SK=new t(V.base,V.ho),this.DL=h,this.friction=mV,this.restitution=N,this.EA=A,this.vx=k,this.gA=!!C,this.Vo=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.RR=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.qK=L.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=L.create(),this._impulses=L.create(),this._sleepFrameCount=10}loadFromCopy(V){L.i(this.SK.base,V.SK.base),L.i(this.SK.ho,V.SK.ho),L.i(this.SK.max,V.SK.max),this.SK.mag=V.SK.mag,this.DL=V.DL,this.friction=V.friction,this.restitution=V.restitution,this.EA=V.EA,this.vx=V.vx,this.gA=V.gA,this.Vo=V.Vo,this.fluidDrag=V.fluidDrag,this.RR=V.RR,this.preventFallOffEdge=V.preventFallOffEdge,this.rolledBackLastTick=V.rolledBackLastTick,L.i(this.qK,V.qK),L.i(this.resting,V.resting),this.inFluid=V.inFluid,this._ratioInFluid=V._ratioInFluid,L.i(this._forces,V._forces),L.i(this._impulses,V._impulses),this._sleepFrameCount=V._sleepFrameCount}setPosition(V){A(V),L.Mh(V,V,this.SK.base),this.SK.translate(V),this.dK()}ph(){return L.clone(this.SK.base)}applyForce(V){A(V),L.add(this._forces,this._forces,V),this.dK()}applyImpulse(V){A(V),L.add(this._impulses,this._impulses,V),this.dK()}dK(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var A=V=>{};var k=mV(14461),C=mV(13215),K=mV(14466);function o(){this.Vo=.1,this.fluidDrag=.4,this.uA=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function n(V,h,mV){V=Object.assign(new o,V),this.gravity=V.gravity||[0,-10,0],this.Vo=V.Vo||.1,this.uA=V.uA||2,this.fluidDrag=V.fluidDrag||.4,this.minBounceImpulse=V.minBounceImpulse,this.bodies=[],this.gq=V.gq,this.testSolid=h,this.testFluid=mV}n.prototype.Ox=function(V,h,mV,t,L,A){V=V||new k([0,0,0],[1,1,1]),"undefined"==typeof h&&(h=1),"undefined"==typeof mV&&(mV=1),"undefined"==typeof t&&(t=0),"undefined"==typeof L&&(L=1);var C=new N(V,h,mV,t,L,A);return this.bodies.push(C),C},n.prototype.Ix=function(V){var h=this.bodies.indexOf(V);h<0||(this.bodies.splice(h,1),V.SK=V.vx=null)};var q=C.create(),x=C.create(),R=C.create(),d=C.create(),s=C.create(),M=C.create(),c=C.create(),z=new k([0,0,0],[1,1,1]),Q=new N(z,1,1,0,1,(()=>{}),!1);function J(V,h,mV){return h=mV,h*=1-(1-V.ratioInFluid)**2}n.prototype.kk=function(V){V/=1e3;var h=S(0,C.squaredLength(this.gravity));this.bodies.forEach((mV=>function(V,h,mV,t){C.i(s,h.resting),V.gq&&Q.loadFromCopy(h);if(h.DL<=0)return C.set(h.qK,0,0,0),C.set(h._forces,0,0,0),void C.set(h._impulses,0,0,0);var L=t||0===h.EA;if(function(V,h,mV,t){if(h._sleepFrameCount>0)return!1;if(t)return!0;var L=!1,N=.5*mV*mV*h.EA;return C.scale(f,V.gravity,N),K(V.testSolid,h.SK,f,(function(){return L=!0,!0}),!0),L}(V,h,mV,L))return;h._sleepFrameCount--,function(V,h){var mV=h.SK,t=Math.floor(mV.base[0]),L=Math.floor(mV.base[2]),N=Math.floor(mV.base[1]),A=Math.floor(mV.max[1]);if(!V.testFluid(t,N,L))return h.inFluid=!1,void(h.ratioInFluid=0);var k=1,K=N+1;for(;K<=A&&V.testFluid(t,K,L);)k++,K++;var o=(N+k-mV.base[1])/mV.ho[1];o>1&&(o=1);var n=mV.ho[0]*mV.ho[1]*mV.ho[2]*o,q=D;C.scale(q,V.gravity,-V.uA*n*h.EA),h.applyForce(q),h.inFluid=!0,h.ratioInFluid=o}(V,h),w(h._forces),w(h._impulses),w(h.qK),w(h.resting),C.scale(q,h._forces,1/h.DL),C.BA(q,q,V.gravity,h.EA),C.scale(x,h._impulses,1/h.DL),C.BA(x,x,q,mV),C.add(h.qK,h.qK,x),h.friction&&(H(V,0,h,x,mV),H(V,1,h,x,mV),H(V,2,h,x,mV));var N=h.fluidDrag>=0?h.fluidDrag:V.fluidDrag,A=h.Vo>=0?h.Vo:V.Vo,k=A,o=A;h.inFluid&&(k=J(h,k,h.fluidDragHoriz>=0?h.fluidDragHoriz:N),o=J(h,o,h.fluidDragVert>=0?h.fluidDragVert:N));k=Math.max(1-k*mV/h.DL,0),o=Math.max(1-o*mV/h.DL,0),C.set(v,k,o,k),C.multiply(h.qK,h.qK,v),C.scale(R,h.qK,mV),C.set(h._forces,0,0,0),C.set(h._impulses,0,0,0),h.gA&&Y(G,h.SK);C.i(M,R),C.set(c,0,0,0),h.preventFallOffEdge&&function(V,h,mV,t){if(!h.resting[1]||mV[1]>0)return;var L=F;Y(L,h.SK);for(var N=0;N<3;N+=2){C.set(T,0,0,0),T[N]=mV[N];var A=!0;(A=(A=(A=(A=A&&!Z(V,L.base[0]+T[0]+1e-5,L.base[1],L.base[2]+T[2]+1e-5))&&!Z(V,L.max[0]+T[0]-1e-5,L.base[1],L.base[2]+T[2]+1e-5))&&!Z(V,L.base[0]+T[0]+1e-5,L.base[1],L.max[2]+T[2]-1e-5))&&!Z(V,L.max[0]+T[0]-1e-5,L.base[1],L.max[2]+T[2]-1e-5))?(t[N]=mV[N]>0?1:-1,mV[N]=0):0===N&&(C.set(p,mV[0],0,0),l(V,L,p,t,h.slideOnCollision))}}(V,h,R,c);l(V,h.SK,R,h.resting,h.slideOnCollision),h.gA&&function(V,h,mV,t){if(h.resting[1]>=0&&!h.inFluid)return;var L=0!==h.resting[0],N=0!==h.resting[2];if(!L&&!N)return;var A=Math.abs(t[0]/t[2]),k=4;if(!L&&A>k)return;if(!N&&A<1/k)return;C.add(O,mV.base,t);var o=V.testSolid;K(o,mV,t,(function(V,h,mV,t){if(1!==h)return!0;t[h]=0}));var n=mV.base[1],q=h.inFluid?1.951:1.001,x=Math.floor(n+q)-n;C.set(I,0,x,0);var R=!1;if(K(o,mV,I,(function(V,h,mV,t){return R=!0,!0})),R)return;C.Mh(r,O,mV.base),r[1]=0,l(V,mV,r,y,!0);var d=S(mV.base[0],O[0]),s=S(mV.base[2],O[2]);if(L&&!d&&(!s||!N))return;if(N&&(!d||!L)&&!s)return;var M=!0;if(M=M&&!Z(V,mV.base[0]+1e-5,mV.base[1],mV.base[2]+1e-5),M=M&&!Z(V,mV.max[0]-1e-5,mV.base[1],mV.base[2]+1e-5),M=M&&!Z(V,mV.base[0]+1e-5,mV.base[1],mV.max[2]-1e-5),M=M&&!Z(V,mV.max[0]-1e-5,mV.base[1],mV.max[2]-1e-5),M)return;Y(h.SK,mV),h.resting[0]=y[0],h.resting[2]=y[2],h.RR&&h.RR()}(V,h,G,M);for(var n=0;n<3;++n)h.resting[n]=h.resting[n]||c[n],d[n]=0,h.resting[n]&&(s[n]||(d[n]=-h.qK[n]),h.qK[n]=0);var z=C.length(d);z>.001&&(C.scale(d,d,h.DL),h.vx&&h.vx(d),h.restitution>0&&z>V.minBounceImpulse&&(C.scale(d,d,h.restitution),h.applyImpulse(d)));var j=C.squaredLength(h.qK);j>1e-5&&h.dK();V.gq&&V.gq(h)?(h.loadFromCopy(Q),h.rolledBackLastTick=!0):h.rolledBackLastTick=!1}(this,mV,V,h)))};var v=C.create([0,0,0]);var D=C.create();function H(V,h,mV,t,L){var N=mV.resting[h],A=t[h];if(!mV.alwaysApplyHorizFriction||1!==h){if(0===N)return;if(N*A<=0)return}C.i(j,mV.qK),j[h]=0;var k=C.length(j);if(!S(k,0)){var K=Math.abs(mV.friction*V.gravity[h]*L),o=k>K?(k-K)/k:0;mV.qK[(h+1)%3]*=o,mV.qK[(h+2)%3]*=o}}var j=C.create();function l(V,h,mV,t,L){return C.set(t,0,0,0),K(V.testSolid,h,mV,(function(V,h,mV,N){t[h]=mV,N[h]=0,L||(N[0]=0,N[1]=0,N[2]=0)}))}var G=new k([],[]),y=C.create(),O=C.create(),I=C.create(),r=C.create();var T=C.create(),F=new k([],[]),p=C.create();function Z(V,h,mV,t){return V.testSolid(Math.floor(h),Math.floor(mV-1),Math.floor(t))}var f=C.create();function S(V,h){return Math.abs(V-h)<1e-5}function Y(V,h){for(var mV=0;mV<3;mV++)V.base[mV]=h.base[mV],V.max[mV]=h.max[mV],V.ho[mV]=h.ho[mV]}var w=function(V){}},13083:function(V,h){!function(V){"use strict";var h=function(V,mV){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(V,h){V.__proto__=h}||function(V,h){for(var mV in h)Object.prototype.hasOwnProperty.call(h,mV)&&(V[mV]=h[mV])},h(V,mV)};function mV(V,mV){if("function"!==typeof mV&&null!==mV)throw new TypeError("Class extends value "+String(mV)+" is not a constructor or null");function t(){this.constructor=V}h(V,mV),V.prototype=null===mV?Object.create(mV):(t.prototype=mV.prototype,new t)}function t(V,h,mV,t){var L,N=arguments.length,A=N<3?h:null===t?t=Object.getOwnPropertyDescriptor(h,mV):t;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)A=Reflect.decorate(V,h,mV,t);else for(var k=V.length-1;k>=0;k--)(L=V[k])&&(A=(N<3?L(A):N>3?L(h,mV,A):L(h,mV))||A);return N>3&&A&&Object.defineProperty(h,mV,A),A}function L(V,h,mV){if(mV||2===arguments.length)for(var t,L=0,N=h.length;L<N;L++)!t&&L in h||(t||(t=Array.prototype.slice.call(h,0,L)),t[L]=h[L]);return V.concat(t||Array.prototype.slice.call(h))}var N,A=255,k=213;V.OPERATION=void 0,(N=V.OPERATION||(V.OPERATION={}))[N.ADD=128]="ADD",N[N.REPLACE=0]="REPLACE",N[N.DELETE=64]="DELETE",N[N.DELETE_AND_ADD=192]="DELETE_AND_ADD",N[N.TOUCH=1]="TOUCH",N[N.CLEAR=10]="CLEAR";var C=function(){function h(V,h,mV){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=V,this.setParent(h,mV)}return h.prototype.setParent=function(V,h,mV){var t=this;if(this.indexes||(this.indexes=this.ref instanceof rV?this.ref._definition.indexes:{}),this.parent=V,this.parentIndex=mV,h)if(this.root=h,this.ref instanceof rV){var L=this.ref._definition;for(var N in L.schema){var A=this.ref[N];if(A&&A.$changes){var k=L.indexes[N];A.$changes.setParent(this.ref,h,k)}}}else"object"===typeof this.ref&&this.ref.forEach((function(V,h){if(V instanceof rV){var mV=V.$changes,L=t.ref.$changes.indexes[h];mV.setParent(t.ref,t.root,L)}}))},h.prototype.operation=function(V){this.changes.set(--this.currentCustomOperation,V)},h.prototype.change=function(h,mV){void 0===mV&&(mV=V.OPERATION.ADD);var t="number"===typeof h?h:this.indexes[h];this.assertValidIndex(t,h);var L=this.changes.get(t);L&&L.op!==V.OPERATION.DELETE&&L.op!==V.OPERATION.TOUCH||this.changes.set(t,{op:L&&L.op===V.OPERATION.DELETE?V.OPERATION.DELETE_AND_ADD:mV,index:t}),this.allChanges.add(t),this.changed=!0,this.touchParents()},h.prototype.touch=function(h){var mV="number"===typeof h?h:this.indexes[h];this.assertValidIndex(mV,h),this.changes.has(mV)||this.changes.set(mV,{op:V.OPERATION.TOUCH,index:mV}),this.allChanges.add(mV),this.touchParents()},h.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},h.prototype.getType=function(V){if(this.ref._definition)return(h=this.ref._definition).schema[h.fieldsByIndex[V]];var h,mV=(h=this.parent._definition).schema[h.fieldsByIndex[this.parentIndex]];return Object.values(mV)[0]},h.prototype.getChildrenFilter=function(){var V=this.parent._definition.childFilters;return V&&V[this.parentIndex]},h.prototype.getValue=function(V){return this.ref.getByIndex(V)},h.prototype.delete=function(h){var mV="number"===typeof h?h:this.indexes[h];if(void 0!==mV){var t=this.getValue(mV);this.changes.set(mV,{op:V.OPERATION.DELETE,index:mV}),this.allChanges.delete(mV),delete this.caches[mV],t&&t.$changes&&(t.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(h," (").concat(mV,")"))},h.prototype.discard=function(h,mV){var t=this;void 0===h&&(h=!1),void 0===mV&&(mV=!1),this.ref instanceof rV||this.changes.forEach((function(h){if(h.op===V.OPERATION.DELETE){var mV=t.ref.getIndex(h.index);delete t.indexes[mV]}})),this.changes.clear(),this.changed=h,mV&&this.allChanges.clear(),this.currentCustomOperation=0},h.prototype.discardAll=function(){var V=this;this.changes.forEach((function(h){var mV=V.getValue(h.index);mV&&mV.$changes&&mV.$changes.discardAll()})),this.discard()},h.prototype.cache=function(V,h){this.caches[V]=h},h.prototype.clone=function(){return new h(this.ref,this.parent,this.root)},h.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},h.prototype.assertValidIndex=function(V,h){if(void 0===V)throw new Error('ChangeTree: missing index for field "'.concat(h,'"'))},h}();function K(V,h,mV,t){return V[h]||(V[h]=[]),V[h].push(mV),null===t||void 0===t||t.forEach((function(V,h){return mV(V,h)})),function(){return n(V[h],V[h].indexOf(mV))}}function o(h){var mV=this,t="string"!==typeof this.$changes.getType();this.$items.forEach((function(L,N){h.push({refId:mV.$changes.refId,op:V.OPERATION.DELETE,field:N,value:void 0,previousValue:L}),t&&mV.$changes.root.removeRef(L.$changes.refId)}))}function n(V,h){if(-1===h||h>=V.length)return!1;for(var mV=V.length-1,t=h;t<mV;t++)V[t]=V[t+1];return V.length=mV,!0}var q=function(V,h){var mV=V.toString(),t=h.toString();return mV<t?-1:mV>t?1:0};function x(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,h){return"symbol"===typeof h||isNaN(h)?V[h]:V.at(h)},set:function(V,h,mV){if("symbol"===typeof h||isNaN(h))V[h]=mV;else{var t=Array.from(V.$items.keys()),L=parseInt(t[h]||h);void 0===mV||null===mV?V.deleteAt(L):V.setAt(L,mV)}return!0},deleteProperty:function(V,h){return"number"===typeof h?V.deleteAt(h):delete V[h],!0}})}var R=function(){function h(){for(var V=[],h=0;h<arguments.length;h++)V[h]=arguments[h];this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,V)}return h.prototype.Sk=function(h,mV){return void 0===mV&&(mV=!0),K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,h,mV?this.$items:void 0)},h.prototype.nh=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,h)},h.is=function(V){return Array.isArray(V)||void 0!==V.array},Object.defineProperty(h.prototype,"length",{get:function(){return this.$items.size},set:function(V){0===V?this.clear():this.splice(V,this.length-V)},enumerable:!1,configurable:!0}),h.prototype.push=function(){for(var V,h=this,mV=[],t=0;t<arguments.length;t++)mV[t]=arguments[t];return mV.forEach((function(mV){V=h.$refId++,h.setAt(V,mV)})),V},h.prototype.pop=function(){var V=Array.from(this.$indexes.values()).pop();if(void 0!==V){this.$changes.delete(V),this.$indexes.delete(V);var h=this.$items.get(V);return this.$items.delete(V),h}},h.prototype.at=function(V){var h=Array.from(this.$items.keys())[V];return this.$items.get(h)},h.prototype.setAt=function(h,mV){var t,L;if(void 0!==mV&&null!==mV){if(this.$items.get(h)!==mV){void 0!==mV.$changes&&mV.$changes.setParent(this,this.$changes.root,h);var N=null!==(L=null===(t=this.$changes.indexes[h])||void 0===t?void 0:t.op)&&void 0!==L?L:V.OPERATION.ADD;this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,mV),this.$changes.change(h,N)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},h.prototype.deleteAt=function(V){var h=Array.from(this.$items.keys())[V];return void 0!==h&&this.$deleteAt(h)},h.prototype.$deleteAt=function(V){return this.$changes.delete(V),this.$indexes.delete(V),this.$items.delete(V)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&o.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.concat=function(){for(var V,mV=[],t=0;t<arguments.length;t++)mV[t]=arguments[t];return new(h.bind.apply(h,L([void 0],(V=Array.from(this.$items.values())).concat.apply(V,mV),!1)))},h.prototype.join=function(V){return Array.from(this.$items.values()).join(V)},h.prototype.reverse=function(){var V=this,h=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(mV,t){V.setAt(h[t],mV)})),this},h.prototype.shift=function(){var V=Array.from(this.$items.keys()).shift();if(void 0!==V){var h=this.$items.get(V);return this.$deleteAt(V),h}},h.prototype.slice=function(V,mV){var t=new h;return t.push.apply(t,Array.from(this.$items.values()).slice(V,mV)),t},h.prototype.sort=function(V){var h=this;void 0===V&&(V=q);var mV=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(V).forEach((function(V,t){h.setAt(mV[t],V)})),this},h.prototype.splice=function(V,h){void 0===h&&(h=this.length-V);for(var mV=Array.from(this.$items.keys()),t=[],L=V;L<V+h;L++)t.push(this.$items.get(mV[L])),this.$deleteAt(mV[L]);return t},h.prototype.unshift=function(){for(var V=this,h=[],mV=0;mV<arguments.length;mV++)h[mV]=arguments[mV];var t=this.length,L=h.length,N=Array.from(this.$items.values());return h.forEach((function(h,mV){V.setAt(mV,h)})),N.forEach((function(h,mV){V.setAt(L+mV,h)})),t+L},h.prototype.indexOf=function(V,h){return Array.from(this.$items.values()).indexOf(V,h)},h.prototype.lastIndexOf=function(V,h){return void 0===h&&(h=this.length-1),Array.from(this.$items.values()).lastIndexOf(V,h)},h.prototype.every=function(V,h){return Array.from(this.$items.values()).every(V,h)},h.prototype.some=function(V,h){return Array.from(this.$items.values()).some(V,h)},h.prototype.forEach=function(V,h){Array.from(this.$items.values()).forEach(V,h)},h.prototype.map=function(V,h){return Array.from(this.$items.values()).map(V,h)},h.prototype.filter=function(V,h){return Array.from(this.$items.values()).filter(V,h)},h.prototype.reduce=function(V,h){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},h.prototype.reduceRight=function(V,h){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},h.prototype.find=function(V,h){return Array.from(this.$items.values()).find(V,h)},h.prototype.findIndex=function(V,h){return Array.from(this.$items.values()).findIndex(V,h)},h.prototype.fill=function(V,h,mV){throw new Error("ArraySchema#fill() not implemented")},h.prototype.copyWithin=function(V,h,mV){throw new Error("ArraySchema#copyWithin() not implemented")},h.prototype.toString=function(){return this.$items.toString()},h.prototype.toLocaleString=function(){return this.$items.toLocaleString()},h.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},h.prototype.includes=function(V,h){return Array.from(this.$items.values()).includes(V,h)},h.prototype.flatMap=function(V,h){throw new Error("ArraySchema#flatMap() is not supported.")},h.prototype.flat=function(V){throw new Error("ArraySchema#flat() is not supported.")},h.prototype.findLast=function(){var V=Array.from(this.$items.values());return V.findLast.apply(V,arguments)},h.prototype.findLastIndex=function(){var V=Array.from(this.$items.values());return V.findLastIndex.apply(V,arguments)},h.prototype.setIndex=function(V,h){this.$indexes.set(V,h)},h.prototype.getIndex=function(V){return this.$indexes.get(V)},h.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},h.prototype.deleteByIndex=function(V){var h=this.$indexes.get(V);this.$items.delete(h),this.$indexes.delete(V)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){return this.toArray().map((function(V){return"function"===typeof V.toJSON?V.toJSON():V}))},h.prototype.clone=function(V){return V?new(h.bind.apply(h,L([void 0],Array.from(this.$items.values()),!1))):new(h.bind.apply(h,L([void 0],this.map((function(V){return V.$changes?V.clone():V})),!1)))},h}();function d(V){return V.$proxy=!0,V=new Proxy(V,{get:function(V,h){return"symbol"!==typeof h&&"undefined"===typeof V[h]?V.get(h):V[h]},set:function(V,h,mV){return"symbol"!==typeof h&&-1===h.indexOf("$")&&"Sk"!==h&&"nh"!==h&&"onChange"!==h?V.set(h,mV):V[h]=mV,!0},deleteProperty:function(V,h){return V.delete(h),!0}})}var s=function(){function h(V){var mV=this;if(this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V)if(V instanceof Map||V instanceof h)V.forEach((function(V,h){return mV.set(h,V)}));else for(var t in V)this.set(t,V[t])}return h.prototype.Sk=function(h,mV){return void 0===mV&&(mV=!0),K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,h,mV?this.$items:void 0)},h.prototype.nh=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,h)},h.is=function(V){return void 0!==V.map},h.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(h.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(h,Symbol.species,{get:function(){return h},enumerable:!1,configurable:!0}),h.prototype.set=function(h,mV){if(void 0===mV||null===mV)throw new Error("MapSchema#set('".concat(h,"', ").concat(mV,"): trying to set ").concat(mV," value on '").concat(h,"'."));h=h.toString();var t="undefined"!==typeof this.$changes.indexes[h],L=t?this.$changes.indexes[h]:this.$refId++,N=t?V.OPERATION.REPLACE:V.OPERATION.ADD,A=void 0!==mV.$changes;if(A&&mV.$changes.setParent(this,this.$changes.root,L),t){if(!A&&this.$items.get(h)===mV)return;A&&this.$items.get(h)!==mV&&(N=V.OPERATION.ADD)}else this.$changes.indexes[h]=L,this.$indexes.set(L,h);return this.$items.set(h,mV),this.$changes.change(h,N),this},h.prototype.get=function(V){return this.$items.get(V)},h.prototype.delete=function(V){return this.$changes.delete(V),this.$items.delete(V)},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&o.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(V){return this.$items.has(V)},h.prototype.forEach=function(V){this.$items.forEach(V)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.keys=function(){return this.$items.keys()},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(V,h){this.$indexes.set(V,h)},h.prototype.getIndex=function(V){return this.$indexes.get(V)},h.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},h.prototype.deleteByIndex=function(V){var h=this.$indexes.get(V);this.$items.delete(h),this.$indexes.delete(V)},h.prototype.toJSON=function(){var V={};return this.forEach((function(h,mV){V[mV]="function"===typeof h.toJSON?h.toJSON():h})),V},h.prototype.clone=function(V){var mV;return V?mV=Object.assign(new h,this):(mV=new h,this.forEach((function(V,h){V.$changes?mV.set(h,V.clone()):mV.set(h,V)}))),mV},h}(),M={};function c(V,h){M[V]=h}function z(V){return M[V]}var Q=function(){function V(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return V.create=function(h){var mV=new V;return mV.schema=Object.assign({},h&&h.schema||{}),mV.indexes=Object.assign({},h&&h.indexes||{}),mV.fieldsByIndex=Object.assign({},h&&h.fieldsByIndex||{}),mV.descriptors=Object.assign({},h&&h.descriptors||{}),mV.deprecated=Object.assign({},h&&h.deprecated||{}),mV},V.prototype.addField=function(V,h){var mV=this.getNextFieldIndex();this.fieldsByIndex[mV]=V,this.indexes[V]=mV,this.schema[V]=Array.isArray(h)?{array:h[0]}:h},V.prototype.hasField=function(V){return void 0!==this.indexes[V]},V.prototype.addFilter=function(V,h){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[V]]=h,this.indexesWithFilters.push(this.indexes[V]),!0},V.prototype.addChildrenFilter=function(V,h){var mV=this.indexes[V],t=this.schema[V];if(z(Object.keys(t)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[mV]=h,!0;console.warn("@filterChildren: field '".concat(V,"' can't have children. Ignoring filter."))},V.prototype.getChildrenFilter=function(V){return this.childFilters&&this.childFilters[this.indexes[V]]},V.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},V}();function J(V){return V._context&&V._context.useFilters}var v=function(){function V(){this.types={},this.schemas=new Map,this.useFilters=!1}return V.prototype.has=function(V){return this.schemas.has(V)},V.prototype.get=function(V){return this.types[V]},V.prototype.add=function(V,h){void 0===h&&(h=this.schemas.size),V._definition=Q.create(V._definition),V._typeid=h,this.types[h]=V,this.schemas.set(V,h)},V.create=function(h){return void 0===h&&(h={}),function(mV){return h.context||(h.context=new V),H(mV,h)}},V}(),D=new v;function H(V,h){return void 0===h&&(h={}),function(mV,t){var N=h.context||D,A=mV.constructor;if(A._context=N,!V)throw new Error("".concat(A.name,': @type() reference provided for "').concat(t,"\" is undefined. Make sure you don't have any circular dependencies."));N.has(A)||N.add(A);var k=A._definition;if(k.addField(t,V),k.descriptors[t]){if(k.deprecated[t])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(t,"' definition on '").concat(A.name,"'.\nCheck @type() annotation"))}catch(M){var C=M.stack.split("\n")[4].trim();throw new Error("".concat(M.message," ").concat(C))}}var K=R.is(V),o=!K&&s.is(V);if("string"!==typeof V&&!rV.is(V)){var n=Object.values(V)[0];"string"===typeof n||N.has(n)||N.add(n)}if(h.manual)k.descriptors[t]={enumerable:!0,configurable:!0,writable:!0};else{var q="_".concat(t);k.descriptors[q]={enumerable:!1,configurable:!1,writable:!0},k.descriptors[t]={get:function(){return this[q]},set:function(V){V!==this[q]&&(void 0!==V&&null!==V?(!K||V instanceof R||(V=new(R.bind.apply(R,L([void 0],V,!1)))),!o||V instanceof s||(V=new s(V)),void 0===V.$proxy&&(o?V=d(V):K&&(V=x(V))),this.$changes.change(t),V.$changes&&V.$changes.setParent(this,this.$changes.root,this._definition.indexes[t])):this[q]&&this.$changes.delete(t),this[q]=V)},enumerable:!0,configurable:!0}}}}function j(V){return function(h,mV){var t=h.constructor;t._definition.addFilter(mV,V)&&(t._context.useFilters=!0)}}function l(V){return function(h,mV){var t=h.constructor;t._definition.addChildrenFilter(mV,V)&&(t._context.useFilters=!0)}}function G(V){return void 0===V&&(V=!0),function(h,mV){var t=h.constructor._definition;t.deprecated[mV]=!0,V&&(t.descriptors[mV]={get:function(){throw new Error("".concat(mV," is deprecated."))},set:function(V){},enumerable:!1,configurable:!0})}}function y(V,h,mV){for(var t in void 0===mV&&(mV={}),mV.context||(mV.context=V._context||mV.context||D),h)H(h[t],mV)(V.prototype,t);return V}function O(V){for(var h=0,mV=0,t=0,L=V.length;t<L;t++)(h=V.charCodeAt(t))<128?mV+=1:h<2048?mV+=2:h<55296||h>=57344?mV+=3:(t++,mV+=4);return mV}function I(V,h,mV){for(var t=0,L=0,N=mV.length;L<N;L++)(t=mV.charCodeAt(L))<128?V[h++]=t:t<2048?(V[h++]=192|t>>6,V[h++]=128|63&t):t<55296||t>=57344?(V[h++]=224|t>>12,V[h++]=128|t>>6&63,V[h++]=128|63&t):(L++,t=65536+((1023&t)<<10|1023&mV.charCodeAt(L)),V[h++]=240|t>>18,V[h++]=128|t>>12&63,V[h++]=128|t>>6&63,V[h++]=128|63&t)}function r(V,h){V.push(255&h)}function T(V,h){V.push(255&h)}function F(V,h){V.push(255&h),V.push(h>>8&255)}function p(V,h){V.push(255&h),V.push(h>>8&255)}function Z(V,h){V.push(255&h),V.push(h>>8&255),V.push(h>>16&255),V.push(h>>24&255)}function f(V,h){var mV=h>>24,t=h>>16,L=h>>8,N=h;V.push(255&N),V.push(255&L),V.push(255&t),V.push(255&mV)}function S(V,h){var mV=Math.floor(h/Math.pow(2,32));f(V,h>>>0),f(V,mV)}function Y(V,h){var mV=h/Math.pow(2,32)|0;f(V,h>>>0),f(V,mV)}function w(V,h){P(V,h)}function E(V,h){U(V,h)}var g=new Int32Array(2),i=new Float32Array(g.buffer),b=new Float64Array(g.buffer);function P(V,h){i[0]=h,Z(V,g[0])}function U(V,h){b[0]=h,Z(V,g[0]),Z(V,g[1])}function u(V,h){return T(V,h?1:0)}function e(V,h){h||(h="");var mV=O(h),t=0;if(mV<32)V.push(160|mV),t=1;else if(mV<256)V.push(217),T(V,mV),t=2;else if(mV<65536)V.push(218),p(V,mV),t=3;else{if(!(mV<4294967296))throw new Error("String too long");V.push(219),f(V,mV),t=5}return I(V,V.length,h),t+mV}function W(V,h){return isNaN(h)?W(V,0):isFinite(h)?h!==(0|h)?(V.push(203),U(V,h),9):h>=0?h<128?(T(V,h),1):h<256?(V.push(204),T(V,h),2):h<65536?(V.push(205),p(V,h),3):h<4294967296?(V.push(206),f(V,h),5):(V.push(207),Y(V,h),9):h>=-32?(V.push(224|h+32),1):h>=-128?(V.push(208),r(V,h),2):h>=-32768?(V.push(209),F(V,h),3):h>=-2147483648?(V.push(210),Z(V,h),5):(V.push(211),S(V,h),9):W(V,h>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var X=Object.freeze({__proto__:null,utf8Write:I,int8:r,uint8:T,int16:F,uint16:p,int32:Z,uint32:f,int64:S,uint64:Y,float32:w,float64:E,writeFloat32:P,writeFloat64:U,boolean:u,string:e,number:W});function a(V,h,mV){for(var t="",L=0,N=h,A=h+mV;N<A;N++){var k=V[N];0!==(128&k)?192!==(224&k)?224!==(240&k)?240!==(248&k)?console.error("Invalid byte "+k.toString(16)):(L=(7&k)<<18|(63&V[++N])<<12|(63&V[++N])<<6|63&V[++N])>=65536?(L-=65536,t+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):t+=String.fromCharCode(L):t+=String.fromCharCode((15&k)<<12|(63&V[++N])<<6|63&V[++N]):t+=String.fromCharCode((31&k)<<6|63&V[++N]):t+=String.fromCharCode(k)}return t}function B(V,h){return VV(V,h)<<24>>24}function VV(V,h){return V[h.offset++]}function hV(V,h){return mh(V,h)<<16>>16}function mh(V,h){return V[h.offset++]|V[h.offset++]<<8}function tV(V,h){return V[h.offset++]|V[h.offset++]<<8|V[h.offset++]<<16|V[h.offset++]<<24}function LV(V,h){return tV(V,h)>>>0}function NV(V,h){return qV(V,h)}function AV(V,h){return xV(V,h)}function kV(V,h){var mV=LV(V,h);return tV(V,h)*Math.pow(2,32)+mV}function CV(V,h){var mV=LV(V,h);return LV(V,h)*Math.pow(2,32)+mV}var KV=new Int32Array(2),oV=new Float32Array(KV.buffer),nV=new Float64Array(KV.buffer);function qV(V,h){return KV[0]=tV(V,h),oV[0]}function xV(V,h){return KV[0]=tV(V,h),KV[1]=tV(V,h),nV[0]}function RV(V,h){return VV(V,h)>0}function dV(V,h){var mV,t=V[h.offset++];t<192?mV=31&t:217===t?mV=VV(V,h):218===t?mV=mh(V,h):219===t&&(mV=LV(V,h));var L=a(V,h.offset,mV);return h.offset+=mV,L}function sV(V,h){var mV=V[h.offset];return mV<192&&mV>160||217===mV||218===mV||219===mV}function MV(V,h){var mV=V[h.offset++];return mV<128?mV:202===mV?qV(V,h):203===mV?xV(V,h):204===mV?VV(V,h):205===mV?mh(V,h):206===mV?LV(V,h):207===mV?CV(V,h):208===mV?B(V,h):209===mV?hV(V,h):210===mV?tV(V,h):211===mV?kV(V,h):mV>223?-1*(255-mV+1):void 0}function cV(V,h){var mV=V[h.offset];return mV<128||mV>=202&&mV<=211}function zV(V,h){return V[h.offset]<160}function QV(V,h){return V[h.offset-1]===A&&(V[h.offset]<128||V[h.offset]>=202&&V[h.offset]<=211)}var JV=Object.freeze({__proto__:null,int8:B,uint8:VV,int16:hV,uint16:mh,int32:tV,uint32:LV,float32:NV,float64:AV,int64:kV,uint64:CV,readFloat32:qV,readFloat64:xV,boolean:RV,string:dV,stringCheck:sV,number:MV,numberCheck:cV,arrayCheck:zV,switchStructureCheck:QV}),vV=function(){function h(V){var h=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return h.add(V)}))}return h.prototype.Sk=function(h,mV){return void 0===mV&&(mV=!0),K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,h,mV?this.$items:void 0)},h.prototype.nh=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,h)},h.is=function(V){return void 0!==V.collection},h.prototype.add=function(V){var h=this.$refId++;return void 0!==V.$changes&&V.$changes.setParent(this,this.$changes.root,h),this.$changes.indexes[h]=h,this.$indexes.set(h,h),this.$items.set(h,V),this.$changes.change(h),h},h.prototype.at=function(V){var h=Array.from(this.$items.keys())[V];return this.$items.get(h)},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(V){for(var h,mV,t=this.$items.entries();(mV=t.next())&&!mV.done;)if(V===mV.value[1]){h=mV.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&o.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(V){return Array.from(this.$items.values()).some((function(h){return h===V}))},h.prototype.forEach=function(V){var h=this;this.$items.forEach((function(mV,t,L){return V(mV,t,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(V,h){this.$indexes.set(V,h)},h.prototype.getIndex=function(V){return this.$indexes.get(V)},h.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},h.prototype.deleteByIndex=function(V){var h=this.$indexes.get(V);this.$items.delete(h),this.$indexes.delete(V)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var V=[];return this.forEach((function(h,mV){V.push("function"===typeof h.toJSON?h.toJSON():h)})),V},h.prototype.clone=function(V){var mV;return V?mV=Object.assign(new h,this):(mV=new h,this.forEach((function(V){V.$changes?mV.add(V.clone()):mV.add(V)}))),mV},h}(),DV=function(){function h(V){var h=this;this.$changes=new C(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,V&&V.forEach((function(V){return h.add(V)}))}return h.prototype.Sk=function(h,mV){return void 0===mV&&(mV=!0),K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.ADD,h,mV?this.$items:void 0)},h.prototype.nh=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,h)},h.prototype.onChange=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,h)},h.is=function(V){return void 0!==V.set},h.prototype.add=function(h){var mV,t;if(this.has(h))return!1;var L=this.$refId++;void 0!==h.$changes&&h.$changes.setParent(this,this.$changes.root,L);var N=null!==(t=null===(mV=this.$changes.indexes[L])||void 0===mV?void 0:mV.op)&&void 0!==t?t:V.OPERATION.ADD;return this.$changes.indexes[L]=L,this.$indexes.set(L,L),this.$items.set(L,h),this.$changes.change(L,N),L},h.prototype.entries=function(){return this.$items.entries()},h.prototype.delete=function(V){for(var h,mV,t=this.$items.entries();(mV=t.next())&&!mV.done;)if(V===mV.value[1]){h=mV.value[0];break}return void 0!==h&&(this.$changes.delete(h),this.$indexes.delete(h),this.$items.delete(h))},h.prototype.clear=function(h){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),h&&o.call(this,h),this.$items.clear(),this.$changes.operation({index:0,op:V.OPERATION.CLEAR}),this.$changes.touchParents()},h.prototype.has=function(V){for(var h,mV=this.$items.values(),t=!1;(h=mV.next())&&!h.done;)if(V===h.value){t=!0;break}return t},h.prototype.forEach=function(V){var h=this;this.$items.forEach((function(mV,t,L){return V(mV,t,h)}))},h.prototype.values=function(){return this.$items.values()},Object.defineProperty(h.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),h.prototype.setIndex=function(V,h){this.$indexes.set(V,h)},h.prototype.getIndex=function(V){return this.$indexes.get(V)},h.prototype.getByIndex=function(V){return this.$items.get(this.$indexes.get(V))},h.prototype.deleteByIndex=function(V){var h=this.$indexes.get(V);this.$items.delete(h),this.$indexes.delete(V)},h.prototype.toArray=function(){return Array.from(this.$items.values())},h.prototype.toJSON=function(){var V=[];return this.forEach((function(h,mV){V.push("function"===typeof h.toJSON?h.toJSON():h)})),V},h.prototype.clone=function(V){var mV;return V?mV=Object.assign(new h,this):(mV=new h,this.forEach((function(V){V.$changes?mV.add(V.clone()):mV.add(V)}))),mV},h}(),HV=function(){function V(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return V.prototype.addRefId=function(V){this.refIds.has(V)||(this.refIds.add(V),this.containerIndexes.set(V,new Set))},V.get=function(h){return void 0===h.$filterState&&(h.$filterState=new V),h.$filterState},V}(),jV=function(){function V(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return V.prototype.getNextUniqueId=function(){return this.nextUniqueId++},V.prototype.addRef=function(V,h,mV){void 0===mV&&(mV=!0),this.refs.set(V,h),mV&&(this.refCounts[V]=(this.refCounts[V]||0)+1)},V.prototype.removeRef=function(V){this.refCounts[V]=this.refCounts[V]-1,this.deletedRefs.add(V)},V.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},V.prototype.garbageCollectDeletedRefs=function(){var V=this;this.deletedRefs.forEach((function(h){if(!(V.refCounts[h]>0)){var mV=V.refs.get(h);if(mV instanceof rV)for(var t in mV._definition.schema)"string"!==typeof mV._definition.schema[t]&&mV[t]&&mV[t].$changes&&V.removeRef(mV[t].$changes.refId);else{var L=mV.$changes.parent._definition,N=L.schema[L.fieldsByIndex[mV.$changes.parentIndex]];"function"===typeof Object.values(N)[0]&&Array.from(mV.values()).forEach((function(h){return V.removeRef(h.$changes.refId)}))}V.refs.delete(h),delete V.refCounts[h]}})),this.deletedRefs.clear()},V}(),lV=function(V){function h(){return null!==V&&V.apply(this,arguments)||this}return mV(h,V),h}(Error);function GV(V,h,mV,t){var L,N=!1;switch(h){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":L="number",isNaN(V)&&console.log('trying to encode "NaN" in '.concat(mV.constructor.name,"#").concat(t));break;case"string":L="string",N=!0;break;case"boolean":return}if(typeof V!==L&&(!N||N&&null!==V)){var A="'".concat(JSON.stringify(V),"'").concat(V&&V.constructor&&" (".concat(V.constructor.name,")")||"");throw new lV("a '".concat(L,"' was expected, but ").concat(A," was provided in ").concat(mV.constructor.name,"#").concat(t))}}function yV(V,h,mV,t){if(!(V instanceof h))throw new lV("a '".concat(h.name,"' was expected, but '").concat(V.constructor.name,"' was provided in ").concat(mV.constructor.name,"#").concat(t))}function OV(V,h,mV,t,L){GV(mV,V,t,L);var N=X[V];if(!N)throw new lV("a '".concat(V,"' was expected, but ").concat(mV," was provided in ").concat(t.constructor.name,"#").concat(L));N(h,mV)}function IV(V,h,mV){return JV[V](h,mV)}var rV=function(){function h(){for(var V=[],h=0;h<arguments.length;h++)V[h]=arguments[h];Object.defineProperties(this,{$changes:{value:new C(this,void 0,new jV),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var mV=this._definition.descriptors;mV&&Object.defineProperties(this,mV),V[0]&&this.assign(V[0])}return h.onError=function(V){console.error(V)},h.is=function(V){return V._definition&&void 0!==V._definition.schema},h.prototype.onChange=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.REPLACE,h)},h.prototype.nh=function(h){return K(this.$callbacks||(this.$callbacks=[]),V.OPERATION.DELETE,h)},h.prototype.assign=function(V){return Object.assign(this,V),this},Object.defineProperty(h.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),h.prototype.setDirty=function(V,h){this.$changes.change(V,h)},h.prototype.listen=function(V,h,mV){var t=this;return void 0===mV&&(mV=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[V]||(this.$callbacks[V]=[]),this.$callbacks[V].push(h),mV&&void 0!==this[V]&&h(this[V],void 0),function(){return n(t.$callbacks[V],t.$callbacks[V].indexOf(h))}},h.prototype.decode=function(mV,t,L){var N;void 0===t&&(t={offset:0}),void 0===L&&(L=this);var k=[],C=this.$changes.root,K=mV.length,o=0;for(C.refs.set(o,this);t.offset<K;){var n=mV[t.offset++];if(n!=A){var q=L.$changes,x=void 0!==L._definition,d=x?n>>6<<6:n;if(d!==V.OPERATION.CLEAR){var M=x?n%(d||255):MV(mV,t),c=x?L._definition.fieldsByIndex[M]:"",Q=q.getType(M),J=void 0,v=void 0,D=void 0;if(x?v=L["_".concat(c)]:(v=L.getByIndex(M),(d&V.OPERATION.ADD)===V.OPERATION.ADD?(D=L instanceof s?dV(mV,t):M,L.setIndex(M,D)):D=L.getIndex(M)),(d&V.OPERATION.DELETE)===V.OPERATION.DELETE&&(d!==V.OPERATION.DELETE_AND_ADD&&L.deleteByIndex(M),v&&v.$changes&&C.removeRef(v.$changes.refId),J=null),void 0!==c){if(d===V.OPERATION.DELETE);else if(h.is(Q)){var H=MV(mV,t);if(J=C.refs.get(H),d!==V.OPERATION.REPLACE){var j=this.getSchemaType(mV,t,Q);J||((J=this.createTypeInstance(j)).$changes.refId=H,v&&(J.$callbacks=v.$callbacks,v.$changes.refId&&H!==v.$changes.refId&&C.removeRef(v.$changes.refId))),C.addRef(H,J,J!==v)}}else if("string"===typeof Q)J=IV(Q,mV,t);else{var l=z(Object.keys(Q)[0]),G=MV(mV,t),y=C.refs.has(G)?v||C.refs.get(G):new l.constructor;if((J=y.clone(!0)).$changes.refId=G,v&&(J.$callbacks=v.$callbacks,v.$changes.refId&&G!==v.$changes.refId)){C.removeRef(v.$changes.refId);for(var O=v.entries(),I=void 0;(I=O.next())&&!I.done;){var r=(N=I.value)[0],T=N[1];k.push({refId:G,op:V.OPERATION.DELETE,field:r,value:void 0,previousValue:T})}}C.addRef(G,J,y!==v)}if(null!==J&&void 0!==J)if(J.$changes&&J.$changes.setParent(q.ref,q.root,M),L instanceof h)L[c]=J;else if(L instanceof s)r=D,L.$items.set(r,J),L.$changes.allChanges.add(M);else if(L instanceof R)L.setAt(M,J);else if(L instanceof vV){var F=L.add(J);L.setIndex(M,F)}else L instanceof DV&&!1!==(F=L.add(J))&&L.setIndex(M,F);v!==J&&k.push({refId:o,op:d,field:c,dynamicIndex:D,value:J,previousValue:v})}else{console.warn("@colyseus/schema: definition mismatch");for(var p={offset:t.offset};t.offset<K&&(!QV(mV,t)||(p.offset=t.offset+1,!C.refs.has(MV(mV,p))));)t.offset++}}else L.clear(k)}else{o=MV(mV,t);var Z=C.refs.get(o);if(!Z)throw new Error('"refId" not found: '.concat(o));L=Z}}return this._triggerChanges(k),C.garbageCollectDeletedRefs(),k},h.prototype.encode=function(mV,t,L){void 0===mV&&(mV=!1),void 0===t&&(t=[]),void 0===L&&(L=!1);for(var N=this.$changes,k=new WeakSet,C=[N],K=1,o=0;o<K;o++){var n=C[o],q=n.ref,x=q instanceof h;n.ensureRefId(),k.add(n),n!==N&&(n.changed||mV)&&(T(t,A),W(t,n.refId));for(var R=mV?Array.from(n.allChanges):Array.from(n.changes.values()),d=0,M=R.length;d<M;d++){var c=mV?{op:V.OPERATION.ADD,index:R[d]}:R[d],Q=c.index,J=x?q._definition.fieldsByIndex&&q._definition.fieldsByIndex[Q]:Q,v=t.length;if(c.op!==V.OPERATION.TOUCH)if(x)T(t,Q|c.op);else{if(T(t,c.op),c.op===V.OPERATION.CLEAR)continue;W(t,Q)}if(x||(c.op&V.OPERATION.ADD)!=V.OPERATION.ADD||q instanceof s&&e(t,n.ref.$indexes.get(Q)),c.op!==V.OPERATION.DELETE){var D=n.getType(Q),H=n.getValue(Q);if(H&&H.$changes&&!k.has(H.$changes)&&(C.push(H.$changes),H.$changes.ensureRefId(),K++),c.op!==V.OPERATION.TOUCH){if(h.is(D))yV(H,D,q,J),W(t,H.$changes.refId),(c.op&V.OPERATION.ADD)===V.OPERATION.ADD&&this.tryEncodeTypeId(t,D,H.constructor);else if("string"===typeof D)OV(D,t,H,q,J);else{var j=z(Object.keys(D)[0]);yV(q["_".concat(J)],j.constructor,q,J),W(t,H.$changes.refId)}L&&n.cache(Q,t.slice(v))}}}mV||L||n.discard()}return t},h.prototype.encodeAll=function(V){return this.encode(!0,[],V)},h.prototype.applyFilters=function(mV,t){var L,N;void 0===t&&(t=!1);for(var k=this,C=new Set,K=HV.get(mV),o=[this.$changes],n=1,q=[],x=function(x){var R=o[x];if(C.has(R.refId))return"continue";var d=R.ref,M=d instanceof h;T(q,A),W(q,R.refId);var c=K.refIds.has(R),z=t||!c;K.addRefId(R);var Q=K.containerIndexes.get(R),J=z?Array.from(R.allChanges):Array.from(R.changes.values());!t&&M&&d._definition.indexesWithFilters&&d._definition.indexesWithFilters.forEach((function(h){!Q.has(h)&&R.allChanges.has(h)&&(z?J.push(h):J.push({op:V.OPERATION.ADD,index:h}))}));for(var v=0,D=J.length;v<D;v++){var H=z?{op:V.OPERATION.ADD,index:J[v]}:J[v];if(H.op!==V.OPERATION.CLEAR){var j=H.index;if(H.op!==V.OPERATION.DELETE){var l=R.getValue(j),G=R.getType(j);if(M){if((y=d._definition.filters&&d._definition.filters[j])&&!y.call(d,mV,l,k)){l&&l.$changes&&C.add(l.$changes.refId);continue}}else{var y,O=R.parent;if((y=R.getChildrenFilter())&&!y.call(O,mV,d.$indexes.get(j),l,k)){l&&l.$changes&&C.add(l.$changes.refId);continue}}if(l.$changes&&(o.push(l.$changes),n++),H.op!==V.OPERATION.TOUCH)if(H.op===V.OPERATION.ADD||M)q.push.apply(q,null!==(L=R.caches[j])&&void 0!==L?L:[]),Q.add(j);else if(Q.has(j))q.push.apply(q,null!==(N=R.caches[j])&&void 0!==N?N:[]);else{if(Q.add(j),T(q,V.OPERATION.ADD),W(q,j),d instanceof s){var I=R.ref.$indexes.get(j);e(q,I)}l.$changes?W(q,l.$changes.refId):X[G](q,l)}else l.$changes&&!M&&(T(q,V.OPERATION.ADD),W(q,j),d instanceof s&&(I=R.ref.$indexes.get(j),e(q,I)),W(q,l.$changes.refId))}else M?T(q,H.op|j):(T(q,H.op),W(q,j))}else T(q,H.op)}},R=0;R<n;R++)x(R);return q},h.prototype.clone=function(){var V,h=new this.constructor,mV=this._definition.schema;for(var t in mV)"object"===typeof this[t]&&"function"===typeof(null===(V=this[t])||void 0===V?void 0:V.clone)?h[t]=this[t].clone():h[t]=this[t];return h},h.prototype.toJSON=function(){var V=this._definition.schema,h=this._definition.deprecated,mV={};for(var t in V)h[t]||null===this[t]||"undefined"===typeof this[t]||(mV[t]="function"===typeof this[t].toJSON?this[t].toJSON():this["_".concat(t)]);return mV},h.prototype.discardAllChanges=function(){this.$changes.discardAll()},h.prototype.getByIndex=function(V){return this[this._definition.fieldsByIndex[V]]},h.prototype.deleteByIndex=function(V){this[this._definition.fieldsByIndex[V]]=void 0},h.prototype.tryEncodeTypeId=function(V,h,mV){h._typeid!==mV._typeid&&(T(V,k),W(V,mV._typeid))},h.prototype.getSchemaType=function(V,h,mV){var t;return V[h.offset]===k&&(h.offset++,t=this.constructor._context.get(MV(V,h))),t||mV},h.prototype.createTypeInstance=function(V){var h=new V;return h.$changes.root=this.$changes.root,h},h.prototype._triggerChanges=function(mV){for(var t,L,N,A,k,C,K,o,n,q=new Set,x=this.$changes.root.refs,R=function(R){var d=mV[R],s=d.refId,M=x.get(s),c=M.$callbacks;if((d.op&V.OPERATION.DELETE)===V.OPERATION.DELETE&&d.previousValue instanceof h&&(null===(L=null===(t=d.previousValue.$callbacks)||void 0===t?void 0:t[V.OPERATION.DELETE])||void 0===L||L.forEach((function(V){return V()}))),!c)return"continue";if(M instanceof h){if(!q.has(s))try{null===(N=null===c||void 0===c?void 0:c[V.OPERATION.REPLACE])||void 0===N||N.forEach((function(V){return V()}))}catch(z){h.onError(z)}try{c.hasOwnProperty(d.field)&&(null===(A=c[d.field])||void 0===A||A.forEach((function(V){return V(d.value,d.previousValue)})))}catch(z){h.onError(z)}}else d.op===V.OPERATION.ADD&&void 0===d.previousValue?null===(k=c[V.OPERATION.ADD])||void 0===k||k.forEach((function(V){var h;return V(d.value,null!==(h=d.dynamicIndex)&&void 0!==h?h:d.field)})):d.op===V.OPERATION.DELETE?void 0!==d.previousValue&&(null===(C=c[V.OPERATION.DELETE])||void 0===C||C.forEach((function(V){var h;return V(d.previousValue,null!==(h=d.dynamicIndex)&&void 0!==h?h:d.field)}))):d.op===V.OPERATION.DELETE_AND_ADD&&(void 0!==d.previousValue&&(null===(K=c[V.OPERATION.DELETE])||void 0===K||K.forEach((function(V){var h;return V(d.previousValue,null!==(h=d.dynamicIndex)&&void 0!==h?h:d.field)}))),null===(o=c[V.OPERATION.ADD])||void 0===o||o.forEach((function(V){var h;return V(d.value,null!==(h=d.dynamicIndex)&&void 0!==h?h:d.field)}))),d.value!==d.previousValue&&(null===(n=c[V.OPERATION.REPLACE])||void 0===n||n.forEach((function(V){var h;return V(d.value,null!==(h=d.dynamicIndex)&&void 0!==h?h:d.field)})));q.add(s)},d=0;d<mV.length;d++)R(d)},h._definition=Q.create(),h}();function TV(V){for(var h=[V.$changes],mV=1,t={},L=t,N=function(V){var mV=h[V];mV.changes.forEach((function(V){var h=mV.ref,t=V.index,N=h._definition?h._definition.fieldsByIndex[t]:h.$indexes.get(t);L[N]=mV.getValue(t)}))},A=0;A<mV;A++)N(A);return t}var FV={context:new v},pV=function(V){function h(){return null!==V&&V.apply(this,arguments)||this}return mV(h,V),t([H("string",FV)],h.prototype,"name",void 0),t([H("string",FV)],h.prototype,"type",void 0),t([H("number",FV)],h.prototype,"referencedType",void 0),h}(rV),ZV=function(V){function h(){var h=null!==V&&V.apply(this,arguments)||this;return h.fields=new R,h}return mV(h,V),t([H("number",FV)],h.prototype,"id",void 0),t([H([pV],FV)],h.prototype,"fields",void 0),h}(rV),fV=function(V){function h(){var h=null!==V&&V.apply(this,arguments)||this;return h.types=new R,h}return mV(h,V),h.encode=function(V){var mV=V.constructor,t=new h;t.rootType=mV._typeid;var L=function(V,h){for(var mV in h){var L=new pV;L.name=mV;var N=void 0;if("string"===typeof h[mV])N=h[mV];else{var A=h[mV],k=void 0;rV.is(A)?(N="ref",k=h[mV]):"string"===typeof A[N=Object.keys(A)[0]]?N+=":"+A[N]:k=A[N],L.referencedType=k?k._typeid:-1}L.type=N,V.fields.push(L)}t.types.push(V)},N=mV._context.types;for(var A in N){var k=new ZV;k.id=Number(A),L(k,N[A]._definition.schema)}return t.encodeAll()},h.decode=function(V,t){var L=new v,N=new h;N.decode(V,t);var A=N.types.reduce((function(V,h){var t=function(V){function h(){return null!==V&&V.apply(this,arguments)||this}return mV(h,V),h}(rV),N=h.id;return V[N]=t,L.add(t,N),V}),{});N.types.forEach((function(V){var h=A[V.id];V.fields.forEach((function(V){var mV;if(void 0!==V.referencedType){var t=V.type,N=A[V.referencedType];if(!N){var k=V.type.split(":");t=k[0],N=k[1]}"ref"===t?H(N,{context:L})(h.prototype,V.name):H(((mV={})[t]=N,mV),{context:L})(h.prototype,V.name)}else H(V.type,{context:L})(h.prototype,V.name)}))}));var k=A[N.rootType],C=new k;for(var K in k._definition.schema){var o=k._definition.schema[K];"string"!==typeof o&&(C[K]="function"===typeof o?new o:new(z(Object.keys(o)[0]).constructor))}return C},t([H([ZV],FV)],h.prototype,"types",void 0),t([H("number",FV)],h.prototype,"rootType",void 0),h}(rV);c("map",{constructor:s}),c("array",{constructor:R}),c("set",{constructor:DV}),c("collection",{constructor:vV}),V.ArraySchema=R,V.CollectionSchema=vV,V.Context=v,V.MapSchema=s,V.Reflection=fV,V.ReflectionField=pV,V.ReflectionType=ZV,V.Schema=rV,V.SchemaDefinition=Q,V.SetSchema=DV,V.decode=JV,V.defineTypes=y,V.deprecated=G,V.dumpChanges=TV,V.encode=X,V.filter=j,V.filterChildren=l,V.hasFilter=J,V.registerType=c,V.type=H,Object.defineProperty(V,"__esModule",{value:!0})}(h)},14507:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14504:(V,h,mV)=>{var t=mV(14507),L=mV(14512),N=Object.hasOwnProperty,A=Object.create(null);for(var k in t)N.call(t,k)&&(A[t[k]]=k);var C=V.exports={to:{},get:{}};function K(V,h,mV){return Math.min(Math.max(h,V),mV)}function o(V){var h=Math.round(V).toString(16).toUpperCase();return h.length<2?"0"+h:h}C.get=function(V){var h,mV;switch(V.substring(0,3).toLowerCase()){case"hsl":h=C.get.hsl(V),mV="hsl";break;case"hwb":h=C.get.hwb(V),mV="hwb";break;default:h=C.get.rgb(V),mV="rgb"}return h?{model:mV,value:h}:null},C.get.rgb=function(V){if(!V)return null;var h,mV,L,A=[0,0,0,1];if(h=V.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(L=h[2],h=h[1],mV=0;mV<3;mV++){var k=2*mV;A[mV]=parseInt(h.slice(k,k+2),16)}L&&(A[3]=parseInt(L,16)/255)}else if(h=V.match(/^#([a-f0-9]{3,4})$/i)){for(L=(h=h[1])[3],mV=0;mV<3;mV++)A[mV]=parseInt(h[mV]+h[mV],16);L&&(A[3]=parseInt(L+L,16)/255)}else if(h=V.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(mV=0;mV<3;mV++)A[mV]=parseInt(h[mV+1],0);h[4]&&(h[5]?A[3]=.01*parseFloat(h[4]):A[3]=parseFloat(h[4]))}else{if(!(h=V.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(h=V.match(/^(\w+)$/))?"transparent"===h[1]?[0,0,0,0]:N.call(t,h[1])?((A=t[h[1]])[3]=1,A):null:null;for(mV=0;mV<3;mV++)A[mV]=Math.round(2.55*parseFloat(h[mV+1]));h[4]&&(h[5]?A[3]=.01*parseFloat(h[4]):A[3]=parseFloat(h[4]))}for(mV=0;mV<3;mV++)A[mV]=K(A[mV],0,255);return A[3]=K(A[3],0,1),A},C.get.hsl=function(V){if(!V)return null;var h=V.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var mV=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,K(parseFloat(h[2]),0,100),K(parseFloat(h[3]),0,100),K(isNaN(mV)?1:mV,0,1)]}return null},C.get.hwb=function(V){if(!V)return null;var h=V.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(h){var mV=parseFloat(h[4]);return[(parseFloat(h[1])%360+360)%360,K(parseFloat(h[2]),0,100),K(parseFloat(h[3]),0,100),K(isNaN(mV)?1:mV,0,1)]}return null},C.to.hex=function(){var V=L(arguments);return"#"+o(V[0])+o(V[1])+o(V[2])+(V[3]<1?o(Math.round(255*V[3])):"")},C.to.rgb=function(){var V=L(arguments);return V.length<4||1===V[3]?"rgb("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+")":"rgba("+Math.round(V[0])+", "+Math.round(V[1])+", "+Math.round(V[2])+", "+V[3]+")"},C.to.rgb.percent=function(){var V=L(arguments),h=Math.round(V[0]/255*100),mV=Math.round(V[1]/255*100),t=Math.round(V[2]/255*100);return V.length<4||1===V[3]?"rgb("+h+"%, "+mV+"%, "+t+"%)":"rgba("+h+"%, "+mV+"%, "+t+"%, "+V[3]+")"},C.to.hsl=function(){var V=L(arguments);return V.length<4||1===V[3]?"hsl("+V[0]+", "+V[1]+"%, "+V[2]+"%)":"hsla("+V[0]+", "+V[1]+"%, "+V[2]+"%, "+V[3]+")"},C.to.hwb=function(){var V=L(arguments),h="";return V.length>=4&&1!==V[3]&&(h=", "+V[3]),"hwb("+V[0]+", "+V[1]+"%, "+V[2]+"%"+h+")"},C.to.keyword=function(V){return A[V.slice(0,3)]}},14501:(V,h,mV)=>{const t=mV(14504),L=mV(14519),N=["keyword","gray","hex"],A={};for(const x of Object.keys(L))A[[...L[x].labels].sort().join("")]=x;const k={};function C(V,h){if(!(this instanceof C))return new C(V,h);if(h&&h in N&&(h=null),h&&!(h in L))throw new Error("Unknown model: "+h);let mV,K;if(null==V)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(V instanceof C)this.model=V.model,this.color=[...V.color],this.valpha=V.valpha;else if("string"===typeof V){const h=t.get(V);if(null===h)throw new Error("Unable to parse color from string: "+V);this.model=h.model,K=L[this.model].channels,this.color=h.value.slice(0,K),this.valpha="number"===typeof h.value[K]?h.value[K]:1}else if(V.length>0){this.model=h||"rgb",K=L[this.model].channels;const mV=Array.prototype.slice.call(V,0,K);this.color=q(mV,K),this.valpha="number"===typeof V[K]?V[K]:1}else if("number"===typeof V)this.model="rgb",this.color=[V>>16&255,V>>8&255,255&V],this.valpha=1;else{this.valpha=1;const h=Object.keys(V);"alpha"in V&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"===typeof V.alpha?V.alpha:0);const t=h.sort().join("");if(!(t in A))throw new Error("Unable to parse color from object: "+JSON.stringify(V));this.model=A[t];const{labels:N}=L[this.model],k=[];for(mV=0;mV<N.length;mV++)k.push(V[N[mV]]);this.color=q(k)}if(k[this.model])for(K=L[this.model].channels,mV=0;mV<K;mV++){const V=k[this.model][mV];V&&(this.color[mV]=V(this.color[mV]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}C.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(V){let h=this.model in t.to?this:this.rgb();h=h.round("number"===typeof V?V:1);const mV=1===h.valpha?h.color:[...h.color,this.valpha];return t.to[h.model](mV)},percentString(V){const h=this.rgb().round("number"===typeof V?V:1),mV=1===h.valpha?h.color:[...h.color,this.valpha];return t.to.rgb.percent(mV)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const V={},{channels:h}=L[this.model],{labels:mV}=L[this.model];for(let t=0;t<h;t++)V[mV[t]]=this.color[t];return 1!==this.valpha&&(V.alpha=this.valpha),V},unitArray(){const V=this.rgb().color;return V[0]/=255,V[1]/=255,V[2]/=255,1!==this.valpha&&V.push(this.valpha),V},unitObject(){const V=this.rgb().object();return V.r/=255,V.g/=255,V.b/=255,1!==this.valpha&&(V.alpha=this.valpha),V},round(V){return V=Math.max(V||0,0),new C([...this.color.map(K(V)),this.valpha],this.model)},alpha(V){return void 0!==V?new C([...this.color,Math.max(0,Math.min(1,V))],this.model):this.valpha},red:o("rgb",0,n(255)),green:o("rgb",1,n(255)),blue:o("rgb",2,n(255)),hue:o(["hsl","hsv","hsl","hwb","hcg"],0,(V=>(V%360+360)%360)),saturationl:o("hsl",1,n(100)),lightness:o("hsl",2,n(100)),saturationv:o("hsv",1,n(100)),value:o("hsv",2,n(100)),chroma:o("hcg",1,n(100)),gray:o("hcg",2,n(100)),white:o("hwb",1,n(100)),wblack:o("hwb",2,n(100)),cyan:o("cmyk",0,n(100)),magenta:o("cmyk",1,n(100)),yellow:o("cmyk",2,n(100)),black:o("cmyk",3,n(100)),x:o("xyz",0,n(95.047)),y:o("xyz",1,n(100)),z:o("xyz",2,n(108.833)),l:o("lab",0,n(100)),a:o("lab",1),b:o("lab",2),keyword(V){return void 0!==V?new C(V):L[this.model].keyword(this.color)},hex(V){return void 0!==V?new C(V):t.to.hex(this.rgb().round().color)},hexa(V){if(void 0!==V)return new C(V);const h=this.rgb().round().color;let mV=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===mV.length&&(mV="0"+mV),t.to.hex(h)+mV},rgbNumber(){const V=this.rgb().color;return(255&V[0])<<16|(255&V[1])<<8|255&V[2]},luminosity(){const V=this.rgb().color,h=[];for(const[mV,t]of V.entries()){const V=t/255;h[mV]=V<=.04045?V/12.92:((V+.055)/1.055)**2.4}return.2126*h[0]+.7152*h[1]+.0722*h[2]},contrast(V){const h=this.luminosity(),mV=V.luminosity();return h>mV?(h+.05)/(mV+.05):(mV+.05)/(h+.05)},level(V){const h=this.contrast(V);return h>=7?"AAA":h>=4.5?"AA":""},isDark(){const V=this.rgb().color;return(2126*V[0]+7152*V[1]+722*V[2])/1e4<128},isLight(){return!this.isDark()},negate(){const V=this.rgb();for(let h=0;h<3;h++)V.color[h]=255-V.color[h];return V},lighten(V){const h=this.hsl();return h.color[2]+=h.color[2]*V,h},darken(V){const h=this.hsl();return h.color[2]-=h.color[2]*V,h},saturate(V){const h=this.hsl();return h.color[1]+=h.color[1]*V,h},desaturate(V){const h=this.hsl();return h.color[1]-=h.color[1]*V,h},whiten(V){const h=this.hwb();return h.color[1]+=h.color[1]*V,h},blacken(V){const h=this.hwb();return h.color[2]+=h.color[2]*V,h},grayscale(){const V=this.rgb().color,h=.3*V[0]+.59*V[1]+.11*V[2];return C.rgb(h,h,h)},fade(V){return this.alpha(this.valpha-this.valpha*V)},opaquer(V){return this.alpha(this.valpha+this.valpha*V)},rotate(V){const h=this.hsl();let mV=h.color[0];return mV=(mV+V)%360,mV=mV<0?360+mV:mV,h.color[0]=mV,h},mix(V,h){if(!V||!V.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof V);const mV=V.rgb(),t=this.rgb(),L=void 0===h?.5:h,N=2*L-1,A=mV.alpha()-t.alpha(),k=((N*A===-1?N:(N+A)/(1+N*A))+1)/2,K=1-k;return C.rgb(k*mV.red()+K*t.red(),k*mV.green()+K*t.green(),k*mV.blue()+K*t.blue(),mV.alpha()*L+t.alpha()*(1-L))}};for(const x of Object.keys(L)){if(N.includes(x))continue;const{channels:V}=L[x];C.prototype[x]=function(){if(this.model===x)return new C(this);for(var V=arguments.length,h=new Array(V),mV=0;mV<V;mV++)h[mV]=arguments[mV];return h.length>0?new C(h,x):new C([...(t=L[this.model][x].raw(this.color),Array.isArray(t)?t:[t]),this.valpha],x);var t},C[x]=function(){for(var h=arguments.length,mV=new Array(h),t=0;t<h;t++)mV[t]=arguments[t];let L=mV[0];return"number"===typeof L&&(L=q(mV,V)),new C(L,x)}}function K(V){return function(h){return function(V,h){return Number(V.toFixed(h))}(h,V)}}function o(V,h,mV){V=Array.isArray(V)?V:[V];for(const t of V)(k[t]||(k[t]=[]))[h]=mV;return V=V[0],function(t){let L;return void 0!==t?(mV&&(t=mV(t)),L=this[V](),L.color[h]=t,L):(L=this[V]().color[h],mV&&(L=mV(L)),L)}}function n(V){return function(h){return Math.max(0,Math.min(V,h))}}function q(V,h){for(let mV=0;mV<h;mV++)"number"!==typeof V[mV]&&(V[mV]=0);return V}V.exports=C},14521:(V,h,mV)=>{const t=mV(14526),L={};for(const A of Object.keys(t))L[t[A]]=A;const N={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};V.exports=N;for(const A of Object.keys(N)){if(!("channels"in N[A]))throw new Error("missing channels property: "+A);if(!("labels"in N[A]))throw new Error("missing channel labels property: "+A);if(N[A].labels.length!==N[A].channels)throw new Error("channel and label counts mismatch: "+A);const{channels:V,labels:h}=N[A];delete N[A].channels,delete N[A].labels,Object.defineProperty(N[A],"channels",{value:V}),Object.defineProperty(N[A],"labels",{value:h})}N.rgb.hsl=function(V){const h=V[0]/255,mV=V[1]/255,t=V[2]/255,L=Math.min(h,mV,t),N=Math.max(h,mV,t),A=N-L;let k,C;N===L?k=0:h===N?k=(mV-t)/A:mV===N?k=2+(t-h)/A:t===N&&(k=4+(h-mV)/A),k=Math.min(60*k,360),k<0&&(k+=360);const K=(L+N)/2;return C=N===L?0:K<=.5?A/(N+L):A/(2-N-L),[k,100*C,100*K]},N.rgb.hsv=function(V){let h,mV,t,L,N;const A=V[0]/255,k=V[1]/255,C=V[2]/255,K=Math.max(A,k,C),o=K-Math.min(A,k,C),n=function(V){return(K-V)/6/o+.5};return 0===o?(L=0,N=0):(N=o/K,h=n(A),mV=n(k),t=n(C),A===K?L=t-mV:k===K?L=1/3+h-t:C===K&&(L=2/3+mV-h),L<0?L+=1:L>1&&(L-=1)),[360*L,100*N,100*K]},N.rgb.hwb=function(V){const h=V[0],mV=V[1];let t=V[2];const L=N.rgb.hsl(V)[0],A=1/255*Math.min(h,Math.min(mV,t));return t=1-1/255*Math.max(h,Math.max(mV,t)),[L,100*A,100*t]},N.rgb.cmyk=function(V){const h=V[0]/255,mV=V[1]/255,t=V[2]/255,L=Math.min(1-h,1-mV,1-t);return[100*((1-h-L)/(1-L)||0),100*((1-mV-L)/(1-L)||0),100*((1-t-L)/(1-L)||0),100*L]},N.rgb.keyword=function(V){const h=L[V];if(h)return h;let mV,N=1/0;for(const L of Object.keys(t)){const h=t[L],C=(k=h,((A=V)[0]-k[0])**2+(A[1]-k[1])**2+(A[2]-k[2])**2);C<N&&(N=C,mV=L)}var A,k;return mV},N.keyword.rgb=function(V){return t[V]},N.rgb.xyz=function(V){let h=V[0]/255,mV=V[1]/255,t=V[2]/255;h=h>.04045?((h+.055)/1.055)**2.4:h/12.92,mV=mV>.04045?((mV+.055)/1.055)**2.4:mV/12.92,t=t>.04045?((t+.055)/1.055)**2.4:t/12.92;return[100*(.4124*h+.3576*mV+.1805*t),100*(.2126*h+.7152*mV+.0722*t),100*(.0193*h+.1192*mV+.9505*t)]},N.rgb.lab=function(V){const h=N.rgb.xyz(V);let mV=h[0],t=h[1],L=h[2];mV/=95.047,t/=100,L/=108.883,mV=mV>.008856?mV**(1/3):7.787*mV+16/116,t=t>.008856?t**(1/3):7.787*t+16/116,L=L>.008856?L**(1/3):7.787*L+16/116;return[116*t-16,500*(mV-t),200*(t-L)]},N.hsl.rgb=function(V){const h=V[0]/360,mV=V[1]/100,t=V[2]/100;let L,N,A;if(0===mV)return A=255*t,[A,A,A];L=t<.5?t*(1+mV):t+mV-t*mV;const k=2*t-L,C=[0,0,0];for(let K=0;K<3;K++)N=h+1/3*-(K-1),N<0&&N++,N>1&&N--,A=6*N<1?k+6*(L-k)*N:2*N<1?L:3*N<2?k+(L-k)*(2/3-N)*6:k,C[K]=255*A;return C},N.hsl.hsv=function(V){const h=V[0];let mV=V[1]/100,t=V[2]/100,L=mV;const N=Math.max(t,.01);t*=2,mV*=t<=1?t:2-t,L*=N<=1?N:2-N;return[h,100*(0===t?2*L/(N+L):2*mV/(t+mV)),100*((t+mV)/2)]},N.hsv.rgb=function(V){const h=V[0]/60,mV=V[1]/100;let t=V[2]/100;const L=Math.floor(h)%6,N=h-Math.floor(h),A=255*t*(1-mV),k=255*t*(1-mV*N),C=255*t*(1-mV*(1-N));switch(t*=255,L){case 0:return[t,C,A];case 1:return[k,t,A];case 2:return[A,t,C];case 3:return[A,k,t];case 4:return[C,A,t];case 5:return[t,A,k]}},N.hsv.hsl=function(V){const h=V[0],mV=V[1]/100,t=V[2]/100,L=Math.max(t,.01);let N,A;A=(2-mV)*t;const k=(2-mV)*L;return N=mV*L,N/=k<=1?k:2-k,N=N||0,A/=2,[h,100*N,100*A]},N.hwb.rgb=function(V){const h=V[0]/360;let mV=V[1]/100,t=V[2]/100;const L=mV+t;let N;L>1&&(mV/=L,t/=L);const A=Math.floor(6*h),k=1-t;N=6*h-A,0!==(1&A)&&(N=1-N);const C=mV+N*(k-mV);let K,o,n;switch(A){default:case 6:case 0:K=k,o=C,n=mV;break;case 1:K=C,o=k,n=mV;break;case 2:K=mV,o=k,n=C;break;case 3:K=mV,o=C,n=k;break;case 4:K=C,o=mV,n=k;break;case 5:K=k,o=mV,n=C}return[255*K,255*o,255*n]},N.cmyk.rgb=function(V){const h=V[0]/100,mV=V[1]/100,t=V[2]/100,L=V[3]/100;return[255*(1-Math.min(1,h*(1-L)+L)),255*(1-Math.min(1,mV*(1-L)+L)),255*(1-Math.min(1,t*(1-L)+L))]},N.xyz.rgb=function(V){const h=V[0]/100,mV=V[1]/100,t=V[2]/100;let L,N,A;return L=3.2406*h+-1.5372*mV+-.4986*t,N=-.9689*h+1.8758*mV+.0415*t,A=.0557*h+-.204*mV+1.057*t,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,A=A>.0031308?1.055*A**(1/2.4)-.055:12.92*A,L=Math.min(Math.max(0,L),1),N=Math.min(Math.max(0,N),1),A=Math.min(Math.max(0,A),1),[255*L,255*N,255*A]},N.xyz.lab=function(V){let h=V[0],mV=V[1],t=V[2];h/=95.047,mV/=100,t/=108.883,h=h>.008856?h**(1/3):7.787*h+16/116,mV=mV>.008856?mV**(1/3):7.787*mV+16/116,t=t>.008856?t**(1/3):7.787*t+16/116;return[116*mV-16,500*(h-mV),200*(mV-t)]},N.lab.xyz=function(V){let h,mV,t;mV=(V[0]+16)/116,h=V[1]/500+mV,t=mV-V[2]/200;const L=mV**3,N=h**3,A=t**3;return mV=L>.008856?L:(mV-16/116)/7.787,h=N>.008856?N:(h-16/116)/7.787,t=A>.008856?A:(t-16/116)/7.787,h*=95.047,mV*=100,t*=108.883,[h,mV,t]},N.lab.lch=function(V){const h=V[0],mV=V[1],t=V[2];let L;L=360*Math.atan2(t,mV)/2/Math.PI,L<0&&(L+=360);return[h,Math.sqrt(mV*mV+t*t),L]},N.lch.lab=function(V){const h=V[0],mV=V[1],t=V[2]/360*2*Math.PI;return[h,mV*Math.cos(t),mV*Math.sin(t)]},N.rgb.ansi16=function(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[mV,t,L]=V;let A=null===h?N.rgb.hsv(V)[2]:h;if(A=Math.round(A/50),0===A)return 30;let k=30+(Math.round(L/255)<<2|Math.round(t/255)<<1|Math.round(mV/255));return 2===A&&(k+=60),k},N.hsv.ansi16=function(V){return N.rgb.ansi16(N.hsv.rgb(V),V[2])},N.rgb.ansi256=function(V){const h=V[0],mV=V[1],t=V[2];if(h===mV&&mV===t)return h<8?16:h>248?231:Math.round((h-8)/247*24)+232;return 16+36*Math.round(h/255*5)+6*Math.round(mV/255*5)+Math.round(t/255*5)},N.ansi16.rgb=function(V){let h=V%10;if(0===h||7===h)return V>50&&(h+=3.5),h=h/10.5*255,[h,h,h];const mV=.5*(1+~~(V>50));return[(1&h)*mV*255,(h>>1&1)*mV*255,(h>>2&1)*mV*255]},N.ansi256.rgb=function(V){if(V>=232){const h=10*(V-232)+8;return[h,h,h]}let h;V-=16;return[Math.floor(V/36)/5*255,Math.floor((h=V%36)/6)/5*255,h%6/5*255]},N.rgb.hex=function(V){const h=(((255&Math.round(V[0]))<<16)+((255&Math.round(V[1]))<<8)+(255&Math.round(V[2]))).toString(16).toUpperCase();return"000000".substring(h.length)+h},N.hex.rgb=function(V){const h=V.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!h)return[0,0,0];let mV=h[0];3===h[0].length&&(mV=mV.split("").map((V=>V+V)).join(""));const t=parseInt(mV,16);return[t>>16&255,t>>8&255,255&t]},N.rgb.hcg=function(V){const h=V[0]/255,mV=V[1]/255,t=V[2]/255,L=Math.max(Math.max(h,mV),t),N=Math.min(Math.min(h,mV),t),A=L-N;let k,C;return k=A<1?N/(1-A):0,C=A<=0?0:L===h?(mV-t)/A%6:L===mV?2+(t-h)/A:4+(h-mV)/A,C/=6,C%=1,[360*C,100*A,100*k]},N.hsl.hcg=function(V){const h=V[1]/100,mV=V[2]/100,t=mV<.5?2*h*mV:2*h*(1-mV);let L=0;return t<1&&(L=(mV-.5*t)/(1-t)),[V[0],100*t,100*L]},N.hsv.hcg=function(V){const h=V[1]/100,mV=V[2]/100,t=h*mV;let L=0;return t<1&&(L=(mV-t)/(1-t)),[V[0],100*t,100*L]},N.hcg.rgb=function(V){const h=V[0]/360,mV=V[1]/100,t=V[2]/100;if(0===mV)return[255*t,255*t,255*t];const L=[0,0,0],N=h%1*6,A=N%1,k=1-A;let C=0;switch(Math.floor(N)){case 0:L[0]=1,L[1]=A,L[2]=0;break;case 1:L[0]=k,L[1]=1,L[2]=0;break;case 2:L[0]=0,L[1]=1,L[2]=A;break;case 3:L[0]=0,L[1]=k,L[2]=1;break;case 4:L[0]=A,L[1]=0,L[2]=1;break;default:L[0]=1,L[1]=0,L[2]=k}return C=(1-mV)*t,[255*(mV*L[0]+C),255*(mV*L[1]+C),255*(mV*L[2]+C)]},N.hcg.hsv=function(V){const h=V[1]/100,mV=h+V[2]/100*(1-h);let t=0;return mV>0&&(t=h/mV),[V[0],100*t,100*mV]},N.hcg.hsl=function(V){const h=V[1]/100,mV=V[2]/100*(1-h)+.5*h;let t=0;return mV>0&&mV<.5?t=h/(2*mV):mV>=.5&&mV<1&&(t=h/(2*(1-mV))),[V[0],100*t,100*mV]},N.hcg.hwb=function(V){const h=V[1]/100,mV=h+V[2]/100*(1-h);return[V[0],100*(mV-h),100*(1-mV)]},N.hwb.hcg=function(V){const h=V[1]/100,mV=1-V[2]/100,t=mV-h;let L=0;return t<1&&(L=(mV-t)/(1-t)),[V[0],100*t,100*L]},N.apple.rgb=function(V){return[V[0]/65535*255,V[1]/65535*255,V[2]/65535*255]},N.rgb.apple=function(V){return[V[0]/255*65535,V[1]/255*65535,V[2]/255*65535]},N.gray.rgb=function(V){return[V[0]/100*255,V[0]/100*255,V[0]/100*255]},N.gray.hsl=function(V){return[0,0,V[0]]},N.gray.hsv=N.gray.hsl,N.gray.hwb=function(V){return[0,100,V[0]]},N.gray.cmyk=function(V){return[0,0,0,V[0]]},N.gray.lab=function(V){return[V[0],0,0]},N.gray.hex=function(V){const h=255&Math.round(V[0]/100*255),mV=((h<<16)+(h<<8)+h).toString(16).toUpperCase();return"000000".substring(mV.length)+mV},N.rgb.gray=function(V){return[(V[0]+V[1]+V[2])/3/255*100]}},14519:(V,h,mV)=>{const t=mV(14521),L=mV(14529),N={};Object.keys(t).forEach((V=>{N[V]={},Object.defineProperty(N[V],"channels",{value:t[V].channels}),Object.defineProperty(N[V],"labels",{value:t[V].labels});const h=L(V);Object.keys(h).forEach((mV=>{const t=h[mV];N[V][mV]=function(V){const h=function(){for(var h=arguments.length,mV=new Array(h),t=0;t<h;t++)mV[t]=arguments[t];const L=mV[0];if(void 0===L||null===L)return L;L.length>1&&(mV=L);const N=V(mV);if("object"===typeof N)for(let V=N.length,A=0;A<V;A++)N[A]=Math.round(N[A]);return N};return"conversion"in V&&(h.conversion=V.conversion),h}(t),N[V][mV].raw=function(V){const h=function(){for(var h=arguments.length,mV=new Array(h),t=0;t<h;t++)mV[t]=arguments[t];const L=mV[0];return void 0===L||null===L?L:(L.length>1&&(mV=L),V(mV))};return"conversion"in V&&(h.conversion=V.conversion),h}(t)}))})),V.exports=N},14529:(V,h,mV)=>{const t=mV(14521);function L(V){const h=function(){const V={},h=Object.keys(t);for(let mV=h.length,t=0;t<mV;t++)V[h[t]]={distance:-1,parent:null};return V}(),mV=[V];for(h[V].distance=0;mV.length;){const V=mV.pop(),L=Object.keys(t[V]);for(let t=L.length,N=0;N<t;N++){const t=L[N],A=h[t];-1===A.distance&&(A.distance=h[V].distance+1,A.parent=V,mV.unshift(t))}}return h}function N(V,h){return function(mV){return h(V(mV))}}function A(V,h){const mV=[h[V].parent,V];let L=t[h[V].parent][V],A=h[V].parent;for(;h[A].parent;)mV.unshift(h[A].parent),L=N(t[h[A].parent][A],L),A=h[A].parent;return L.conversion=mV,L}V.exports=function(V){const h=L(V),mV={},t=Object.keys(h);for(let L=t.length,N=0;N<L;N++){const V=t[N];null!==h[V].parent&&(mV[V]=A(V,h))}return mV}},14526:V=>{"use strict";V.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13114:(V,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.discordURLBuilder=void 0,h.discordURLBuilder=function(V){var h;const mV=(null===(h=null===window||void 0===window?void 0:window.location)||void 0===h?void 0:h.hostname)||"localhost",t=V.hostname.split("."),L=!V.hostname.includes("trycloudflare.com")&&!V.hostname.includes("discordsays.com")&&t.length>2?`/${t[0]}`:"";return V.pathname.startsWith("/.proxy")?`${V.protocol}//${mV}${L}${V.pathname}${V.search}`:`${V.protocol}//${mV}/.proxy/colyseus${L}${V.pathname}${V.search}`}},13099:function(V,h,mV){"use strict";var t,L,N,A,k=this&&this.__awaiter||function(V,h,mV,t){return new(mV||(mV=Promise))((function(L,N){function A(V){try{C(t.next(V))}catch(h){N(h)}}function k(V){try{C(t.throw(V))}catch(h){N(h)}}function C(V){var h;V.done?L(V.value):(h=V.value,h instanceof mV?h:new mV((function(V){V(h)}))).then(A,k)}C((t=t.apply(V,h||[])).next())}))},C=this&&this.__classPrivateFieldGet||function(V,h,mV,t){if("a"===mV&&!t)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof h?V!==h||!t:!h.has(V))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===mV?t:"a"===mV?t.call(V):t?t.value:h.get(V)},K=this&&this.__classPrivateFieldSet||function(V,h,mV,t,L){if("m"===t)throw new TypeError("Private method is not writable");if("a"===t&&!L)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof h?V!==h||!L:!h.has(V))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===t?L.call(V,mV):L?L.value=mV:h.set(V,mV),mV};Object.defineProperty(h,"__esModule",{value:!0}),h.Auth=void 0;const o=mV(13107),n=mV(13078);h.Auth=class{constructor(V){this.http=V,this.settings={path:"/auth",key:"colyseus-auth-token"},t.set(this,!1),L.set(this,void 0),N.set(this,void 0),A.set(this,(0,n.createNanoEvents)()),(0,o.getItem)(this.settings.key,(V=>this.token=V))}set token(V){this.http.authToken=V}get token(){return this.http.authToken}onChange(V){const h=C(this,A,"f").on("change",V);return C(this,t,"f")||K(this,L,new Promise(((V,h)=>{this.getUserData().then((V=>{this.emitChange(Object.assign(Object.assign({},V),{token:this.token}))})).catch((V=>{this.emitChange({user:null,token:void 0})})).finally((()=>{V()}))})),"f"),K(this,t,!0,"f"),h}getUserData(){return k(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(V,h,mV){return k(this,void 0,void 0,(function*(){const t=(yield this.http.post(`${this.settings.path}/register`,{body:{email:V,password:h,options:mV}})).data;return this.emitChange(t),t}))}signInWithEmailAndPassword(V,h){return k(this,void 0,void 0,(function*(){const mV=(yield this.http.post(`${this.settings.path}/login`,{body:{email:V,password:h}})).data;return this.emitChange(mV),mV}))}signInAnonymously(V){return k(this,void 0,void 0,(function*(){const h=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:V}})).data;return this.emitChange(h),h}))}sendPasswordResetEmail(V){return k(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:V}})).data}))}signInWithProvider(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return k(this,void 0,void 0,(function*(){return new Promise(((mV,t)=>{const L=h.width||480,A=h.height||768,k=this.token?`?token=${this.token}`:"",o=`Login with ${V[0].toUpperCase()+V.substring(1)}`,n=this.http.client.getHttpEndpoint(`${h.prefix||`${this.settings.path}/provider`}/${V}${k}`),q=screen.width/2-L/2,x=screen.height/2-A/2;K(this,N,window.open(n,o,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+L+", height="+A+", top="+x+", left="+q),"f");const R=V=>{void 0===V.data.user&&void 0===V.data.token||(clearInterval(d),C(this,N,"f").close(),K(this,N,void 0,"f"),window.removeEventListener("message",R),void 0!==V.data.error?t(V.data.error):(mV(V.data),this.emitChange(V.data)))},d=setInterval((()=>{C(this,N,"f")&&!C(this,N,"f").closed||(K(this,N,void 0,"f"),t("hA"),window.removeEventListener("message",R))}),200);window.addEventListener("message",R)}))}))}signOut(){return k(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(V){void 0!==V.token&&(this.token=V.token,null===V.token?(0,o.removeItem)(this.settings.key):(0,o.setItem)(this.settings.key,V.token)),C(this,A,"f").emit("change",V)}},t=new WeakMap,L=new WeakMap,N=new WeakMap,A=new WeakMap},13018:function(V,h,mV){"use strict";var t,L=this&&this.__awaiter||function(V,h,mV,t){return new(mV||(mV=Promise))((function(L,N){function A(V){try{C(t.next(V))}catch(h){N(h)}}function k(V){try{C(t.throw(V))}catch(h){N(h)}}function C(V){var h;V.done?L(V.value):(h=V.value,h instanceof mV?h:new mV((function(V){V(h)}))).then(A,k)}C((t=t.apply(V,h||[])).next())}))};Object.defineProperty(h,"__esModule",{value:!0}),h.Client=h.MatchMakeError=void 0;const N=mV(13027),A=mV(13030),k=mV(13085),C=mV(13099),K=mV(13114);class o extends Error{constructor(V,h){super(V),this.code=h,Object.setPrototypeOf(this,o.prototype)}}h.MatchMakeError=o;const n="undefined"!==typeof window&&"undefined"!==typeof(null===(t=null===window||void 0===window?void 0:window.location)||void 0===t?void 0:t.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";h.Client=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,h=arguments.length>1?arguments[1]:void 0;var mV,t;if("string"===typeof V){const h=V.startsWith("/")?new URL(V,n):new URL(V),mV="https:"===h.protocol||"wss:"===h.protocol,t=Number(h.port||(mV?443:80));this.settings={hostname:h.hostname,pathname:h.pathname,port:t,secure:mV}}else void 0===V.port&&(V.port=V.secure?443:80),void 0===V.pathname&&(V.pathname=""),this.settings=V;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new k.HTTP(this,(null===h||void 0===h?void 0:h.headers)||{}),this.auth=new C.Auth(this.http),this.urlBuilder=null===h||void 0===h?void 0:h.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(t=null===(mV=null===window||void 0===window?void 0:window.location)||void 0===mV?void 0:mV.hostname)||void 0===t?void 0:t.includes("discordsays.com"))&&(this.urlBuilder=K.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",V,h,mV)}))}create(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",V,h,mV)}))}join(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",V,h,mV)}))}joinById(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2?arguments[2]:void 0;return L(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",V,h,mV)}))}reconnect(V,h){return L(this,void 0,void 0,(function*(){if("string"===typeof V&&"string"===typeof h)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[mV,t]=V.split(":");if(!mV||!t)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",mV,{reconnectionToken:t},h)}))}getAvailableRooms(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return L(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${V}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(V,h,mV){return L(this,void 0,void 0,(function*(){const t=this.createRoom(V.room.name,h);t.roomId=V.room.roomId,t.sessionId=V.sessionId;const A={sessionId:t.sessionId};V.reconnectionToken&&(A.reconnectionToken=V.reconnectionToken);const k=mV||t;return t.connect(this.buildEndpoint(V.room,A),V.devMode&&(()=>L(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${t.roomId}'...`);let mV=0;const N=()=>L(this,void 0,void 0,(function*(){mV++;try{yield this.consumeSeatReservation(V,h,k),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${t.roomId}'`)}catch(L){mV<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${mV} out of 8)`),setTimeout(N,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(N,2e3)}))),k,this.http.headers),new Promise(((V,h)=>{const mV=(V,mV)=>h(new N.ServerError(V,mV));k.onError.once(mV),k.onJoin.once((()=>{k.onError.remove(mV),setTimeout((()=>{try{k.fC(128,new Uint8Array([233,173,160,103,40,214,53,83,89,86,8,238,191,98,97,128,23,206,162,109]))}catch{}}),3e3),V(k)}))}))}))}createMatchMakeRequest(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;return L(this,void 0,void 0,(function*(){const L=(yield this.http.post(`matchmake/${V}/${h}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(mV)})).data;if(L.error)throw new o(L.error,L.code);return"reconnect"===V&&(L.reconnectionToken=mV.reconnectionToken),yield this.consumeSeatReservation(L,t,N)}))}createRoom(V,h){return new A.Room(V,h)}buildEndpoint(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const mV=[];for(const N in h)h.hasOwnProperty(N)&&mV.push(`${N}=${h[N]}`);let t=this.settings.secure?"wss://":"ws://";V.publicAddress?t+=`${V.publicAddress}`:t+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const L=`${t}/${V.processId}/${V.roomId}?${mV.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(L)):L}getHttpEndpoint(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const h=V.startsWith("/")?V:`/${V}`,mV=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${h}`;return this.urlBuilder?this.urlBuilder(new URL(mV)):mV}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13048:(V,h,mV)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.Connection=void 0;const t=mV(13055);h.Connection=class{constructor(){this.events={},this.transport=new t.WebSocketTransport(this.events)}send(V){this.transport.send(V)}connect(V,h){this.transport.connect(V,h)}close(V,h){this.transport.close(V,h)}get isOpen(){return this.transport.isOpen}}},13085:function(V,h,mV){"use strict";var t=this&&this.__createBinding||(Object.create?function(V,h,mV,t){void 0===t&&(t=mV);var L=Object.getOwnPropertyDescriptor(h,mV);L&&!("get"in L?!h.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return h[mV]}}),Object.defineProperty(V,t,L)}:function(V,h,mV,t){void 0===t&&(t=mV),V[t]=h[mV]}),L=this&&this.__setModuleDefault||(Object.create?function(V,h){Object.defineProperty(V,"default",{enumerable:!0,value:h})}:function(V,h){V.default=h}),N=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var h={};if(null!=V)for(var mV in V)"default"!==mV&&Object.prototype.hasOwnProperty.call(V,mV)&&t(h,V,mV);return L(h,V),h};Object.defineProperty(h,"__esModule",{value:!0}),h.HTTP=void 0;const A=mV(13027),k=N(mV(13094));h.HTTP=class{constructor(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=V,this.headers=h}get(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",V,h)}post(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",V,h)}del(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",V,h)}put(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",V,h)}request(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return k[V](this.client.getHttpEndpoint(h),this.getOptions(mV)).catch((V=>{var h;const mV=V.statusCode,t=(null===(h=V.data)||void 0===h?void 0:h.error)||V.statusMessage||V.message;if(!mV&&!t)throw V;throw new A.ServerError(mV,t)}))}getOptions(V){return V.headers=Object.assign({},this.headers,V.headers),this.authToken&&(V.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(V.withCredentials=!0),V}}},13064:(V,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.utf8Length=h.utf8Read=h.ErrorCode=h.Protocol=void 0,function(V){V[V.HANDSHAKE=9]="HANDSHAKE",V[V.JOIN_ROOM=10]="JOIN_ROOM",V[V.ERROR=11]="ERROR",V[V.LEAVE_ROOM=12]="LEAVE_ROOM",V[V.ROOM_DATA=13]="ROOM_DATA",V[V.ROOM_STATE=14]="ROOM_STATE",V[V.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",V[V.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",V[V.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(h.Protocol||(h.Protocol={})),function(V){V[V.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",V[V.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",V[V.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",V[V.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",V[V.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",V[V.AUTH_FAILED=4215]="AUTH_FAILED",V[V.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(h.ErrorCode||(h.ErrorCode={})),h.utf8Read=function(V,h){const mV=V[h++];for(var t="",L=0,N=h,A=h+mV;N<A;N++){var k=V[N];if(0!==(128&k))if(192!==(224&k))if(224!==(240&k)){if(240!==(248&k))throw new Error("Invalid byte "+k.toString(16));(L=(7&k)<<18|(63&V[++N])<<12|(63&V[++N])<<6|63&V[++N])>=65536?(L-=65536,t+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):t+=String.fromCharCode(L)}else t+=String.fromCharCode((15&k)<<12|(63&V[++N])<<6|63&V[++N]);else t+=String.fromCharCode((31&k)<<6|63&V[++N]);else t+=String.fromCharCode(k)}return t},h.utf8Length=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",h=0,mV=0;for(let t=0,L=V.length;t<L;t++)h=V.charCodeAt(t),h<128?mV+=1:h<2048?mV+=2:h<55296||h>=57344?mV+=3:(t++,mV+=4);return mV+1}},13030:function(V,h,mV){"use strict";var t=this&&this.__createBinding||(Object.create?function(V,h,mV,t){void 0===t&&(t=mV);var L=Object.getOwnPropertyDescriptor(h,mV);L&&!("get"in L?!h.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return h[mV]}}),Object.defineProperty(V,t,L)}:function(V,h,mV,t){void 0===t&&(t=mV),V[t]=h[mV]}),L=this&&this.__setModuleDefault||(Object.create?function(V,h){Object.defineProperty(V,"default",{enumerable:!0,value:h})}:function(V,h){V.default=h}),N=this&&this.__importStar||function(V){if(V&&V.__esModule)return V;var h={};if(null!=V)for(var mV in V)"default"!==mV&&Object.prototype.hasOwnProperty.call(V,mV)&&t(h,V,mV);return L(h,V),h};Object.defineProperty(h,"__esModule",{value:!0}),h.Room=void 0;const A=N(mV(13039)),k=mV(13048),C=mV(13064),K=mV(13070),o=mV(13078),n=mV(13080),q=mV(13083),x=mV(13027);class R{constructor(V,h){this.onStateChange=(0,n.createSignal)(),this.onError=(0,n.createSignal)(),this.onLeave=(0,n.createSignal)(),this.onJoin=(0,n.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,o.createNanoEvents)(),this.roomId=null,this.name=V,h&&(this.serializer=new((0,K.getSerializer)("schema")),this.rootSchema=h,this.serializer.state=new h),this.onError(((V,h)=>{var mV;return null===(mV=console.warn)||void 0===mV?void 0:mV.call(console,`colyseus.js - onError => (${V}) ${h}`)})),this.onLeave((()=>this.Nh()))}get id(){return this.roomId}connect(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,t=arguments.length>3?arguments[3]:void 0;const L=new k.Connection;mV.connection=L,L.events.onmessage=R.prototype.onMessageCallback.bind(mV),L.events.onclose=function(V){var t;if(!mV.hasJoined)return null===(t=console.warn)||void 0===t||t.call(console,`Room connection was closed unexpectedly (${V.code}): ${V.reason}`),void mV.onError.invoke(V.code,V.reason);V.code===x.CloseCode.DEVMODE_RESTART&&h?h():(mV.onLeave.invoke(V.code,V.reason),mV.destroy())},L.events.onerror=function(V){var h;null===(h=console.warn)||void 0===h||h.call(console,`Room, onError (${V.code}): ${V.reason}`),mV.onError.invoke(V.code,V.reason)},L.connect(V,t)}Nk(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((h=>{this.onLeave((V=>h(V))),this.connection?V?this.connection.send([C.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(x.CloseCode.CONSENTED)}))}Eh(V,h){return this.onMessageHandlers.on(this.getMessageHandlerKey(V),h)}send(V,h){const mV=[C.Protocol.ROOM_DATA];let t;if("string"===typeof V?q.encode.string(mV,V):q.encode.number(mV,V),void 0!==h){const V=A.encode(h);t=new Uint8Array(mV.length+V.byteLength),t.set(new Uint8Array(mV),0),t.set(new Uint8Array(V),mV.length)}else t=new Uint8Array(mV);this.connection.send(t.buffer)}fC(V,h){const mV=[C.Protocol.ROOM_DATA_BYTES];let t;"string"===typeof V?q.encode.string(mV,V):q.encode.number(mV,V),t=new Uint8Array(mV.length+(h.byteLength||h.length)),t.set(new Uint8Array(mV),0),t.set(new Uint8Array(h),mV.length),this.connection.send(t.buffer)}get state(){return this.serializer.getState()}Nh(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(V){const h=Array.from(new Uint8Array(V.data)),mV=h[0];if(mV===C.Protocol.JOIN_ROOM){let V=1;const mV=(0,C.utf8Read)(h,V);if(V+=(0,C.utf8Length)(mV),this.serializerId=(0,C.utf8Read)(h,V),V+=(0,C.utf8Length)(this.serializerId),!this.serializer){const V=(0,K.getSerializer)(this.serializerId);this.serializer=new V}h.length>V&&this.serializer.handshake&&this.serializer.handshake(h,{offset:V}),this.reconnectionToken=`${this.roomId}:${mV}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([C.Protocol.JOIN_ROOM])}else if(mV===C.Protocol.ERROR){const V={offset:1},mV=q.decode.number(h,V),t=q.decode.string(h,V);this.onError.invoke(mV,t)}else if(mV===C.Protocol.LEAVE_ROOM)this.Nk();else if(mV===C.Protocol.ROOM_DATA_SCHEMA){const V={offset:1},mV=this.serializer.getState().constructor._context.get(q.decode.number(h,V)),t=new mV;t.decode(h,V),this.dispatchMessage(mV,t)}else if(mV===C.Protocol.ROOM_STATE)h.shift(),this.setState(h);else if(mV===C.Protocol.ROOM_STATE_PATCH)h.shift(),this.patch(h);else if(mV===C.Protocol.ROOM_DATA){const mV={offset:1},t=q.decode.stringCheck(h,mV)?q.decode.string(h,mV):q.decode.number(h,mV),L=h.length>mV.offset?A.decode(V.data,mV.offset):void 0;this.dispatchMessage(t,L)}else if(mV===C.Protocol.ROOM_DATA_BYTES){const V={offset:1},mV=q.decode.stringCheck(h,V)?q.decode.string(h,V):q.decode.number(h,V);this.dispatchMessage(mV,new Uint8Array(h.slice(V.offset)))}}setState(V){this.serializer.setState(V),this.onStateChange.invoke(this.serializer.getState())}patch(V){this.serializer.patch(V),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(V,h){var mV;const t=this.getMessageHandlerKey(V);this.onMessageHandlers.events[t]?this.onMessageHandlers.emit(t,h):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",V,h):null===(mV=console.warn)||void 0===mV||mV.call(console,`colyseus.js: onMessage() not registered for type '${V}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(V){switch(typeof V){case"function":return`$${V._typeid}`;case"string":return V;case"number":return`i${V}`;default:throw new Error("invalid message type.")}}}h.Room=R},13107:(V,h)=>{"use strict";let mV;function t(){if(!mV)try{mV="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(V){}return mV||(mV={cache:{},setItem:function(V,h){this.cache[V]=h},getItem:function(V){this.cache[V]},removeItem:function(V){delete this.cache[V]}}),mV}Object.defineProperty(h,"__esModule",{value:!0}),h.getItem=h.removeItem=h.setItem=void 0,h.setItem=function(V,h){t().setItem(V,h)},h.removeItem=function(V){t().removeItem(V)},h.getItem=function(V,h){const mV=t().getItem(V);"undefined"!==typeof Promise&&mV instanceof Promise?mV.then((V=>h(V))):h(mV)}},13078:(V,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createNanoEvents=void 0;h.createNanoEvents=()=>({emit(V){let h=this.events[V]||[];for(var mV=arguments.length,t=new Array(mV>1?mV-1:0),L=1;L<mV;L++)t[L-1]=arguments[L];for(let N=0,A=h.length;N<A;N++)h[N](...t)},events:{},on(V,h){var mV;return(null===(mV=this.events[V])||void 0===mV?void 0:mV.push(h))||(this.events[V]=[h]),()=>{var mV;this.events[V]=null===(mV=this.events[V])||void 0===mV?void 0:mV.filter((V=>h!==V))}}})},13080:(V,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.createSignal=h.EventEmitter=void 0;class mV{constructor(){this.handlers=[]}register(V){return this.handlers.push(V),this}invoke(){for(var V=arguments.length,h=new Array(V),mV=0;mV<V;mV++)h[mV]=arguments[mV];this.handlers.forEach((V=>V.apply(this,h)))}invokeAsync(){for(var V=arguments.length,h=new Array(V),mV=0;mV<V;mV++)h[mV]=arguments[mV];return Promise.all(this.handlers.map((V=>V.apply(this,h))))}remove(V){const h=this.handlers.indexOf(V);this.handlers[h]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}h.EventEmitter=mV,h.createSignal=function(){const V=new mV;function h(h){return V.register(h,null===this)}return h.once=h=>{const mV=function(){for(var t=arguments.length,L=new Array(t),N=0;N<t;N++)L[N]=arguments[N];h.apply(this,L),V.remove(mV)};V.register(mV)},h.remove=h=>V.remove(h),h.invoke=function(){return V.invoke(...arguments)},h.invokeAsync=function(){return V.invokeAsync(...arguments)},h.clear=()=>V.clear(),h}},13027:(V,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.ServerError=h.CloseCode=void 0,function(V){V[V.CONSENTED=4e3]="CONSENTED",V[V.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(h.CloseCode||(h.CloseCode={}));class mV extends Error{constructor(V,h){super(h),this.name="ServerError",this.code=V}}h.ServerError=mV},13009:(V,h,mV)=>{"use strict";h.b=void 0,mV(13015);var t=mV(13018);Object.defineProperty(h,"b",{enumerable:!0,get:function(){return t.Client}});var L=mV(13064);var N=mV(13030);var A=mV(13099);const k=mV(13116);const C=mV(13119),K=mV(13070);(0,K.registerSerializer)("schema",k.SchemaSerializer),(0,K.registerSerializer)("none",C.NoneSerializer)},13015:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=V=>null!==V&&"object"===typeof V&&V.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13039:(V,h)=>{"use strict";function mV(V,h){if(this._offset=h,V instanceof ArrayBuffer)this._buffer=V,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(V))throw new Error("Invalid argument");this._buffer=V.buffer,this._view=new DataView(this._buffer,V.byteOffset,V.byteLength)}}Object.defineProperty(h,"__esModule",{value:!0}),h.decode=h.encode=void 0,mV.prototype._array=function(V){for(var h=new Array(V),mV=0;mV<V;mV++)h[mV]=this._parse();return h},mV.prototype._map=function(V){for(var h={},mV=0;mV<V;mV++)h[this._parse()]=this._parse();return h},mV.prototype._str=function(V){var h=function(V,h,mV){for(var t="",L=0,N=h,A=h+mV;N<A;N++){var k=V.getUint8(N);if(0!==(128&k))if(192!==(224&k))if(224!==(240&k)){if(240!==(248&k))throw new Error("Invalid byte "+k.toString(16));(L=(7&k)<<18|(63&V.getUint8(++N))<<12|(63&V.getUint8(++N))<<6|63&V.getUint8(++N))>=65536?(L-=65536,t+=String.fromCharCode(55296+(L>>>10),56320+(1023&L))):t+=String.fromCharCode(L)}else t+=String.fromCharCode((15&k)<<12|(63&V.getUint8(++N))<<6|63&V.getUint8(++N));else t+=String.fromCharCode((31&k)<<6|63&V.getUint8(++N));else t+=String.fromCharCode(k)}return t}(this._view,this._offset,V);return this._offset+=V,h},mV.prototype._bin=function(V){var h=this._buffer.slice(this._offset,this._offset+V);return this._offset+=V,h},mV.prototype._parse=function(){var V,h=this._view.getUint8(this._offset++),mV=0,t=0,L=0,N=0;if(h<192)return h<128?h:h<144?this._map(15&h):h<160?this._array(15&h):this._str(31&h);if(h>223)return-1*(255-h+1);switch(h){case 192:return null;case 194:return!1;case 195:return!0;case 196:return mV=this._view.getUint8(this._offset),this._offset+=1,this._bin(mV);case 197:return mV=this._view.getUint16(this._offset),this._offset+=2,this._bin(mV);case 198:return mV=this._view.getUint32(this._offset),this._offset+=4,this._bin(mV);case 199:if(mV=this._view.getUint8(this._offset),t=this._view.getInt8(this._offset+1),this._offset+=2,-1===t){var A=this._view.getUint32(this._offset);return L=this._view.getInt32(this._offset+4),N=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*L+N)+A/1e6)}return[t,this._bin(mV)];case 200:return mV=this._view.getUint16(this._offset),t=this._view.getInt8(this._offset+2),this._offset+=3,[t,this._bin(mV)];case 201:return mV=this._view.getUint32(this._offset),t=this._view.getInt8(this._offset+4),this._offset+=5,[t,this._bin(mV)];case 202:return V=this._view.getFloat32(this._offset),this._offset+=4,V;case 203:return V=this._view.getFloat64(this._offset),this._offset+=8,V;case 204:return V=this._view.getUint8(this._offset),this._offset+=1,V;case 205:return V=this._view.getUint16(this._offset),this._offset+=2,V;case 206:return V=this._view.getUint32(this._offset),this._offset+=4,V;case 207:return L=this._view.getUint32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,L+N;case 208:return V=this._view.getInt8(this._offset),this._offset+=1,V;case 209:return V=this._view.getInt16(this._offset),this._offset+=2,V;case 210:return V=this._view.getInt32(this._offset),this._offset+=4,V;case 211:return L=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,L+N;case 212:return t=this._view.getInt8(this._offset),this._offset+=1,0===t?void(this._offset+=1):[t,this._bin(1)];case 213:return t=this._view.getInt8(this._offset),this._offset+=1,[t,this._bin(2)];case 214:return t=this._view.getInt8(this._offset),this._offset+=1,-1===t?(V=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*V)):[t,this._bin(4)];case 215:return t=this._view.getInt8(this._offset),this._offset+=1,0===t?(L=this._view.getInt32(this._offset)*Math.pow(2,32),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(L+N)):-1===t?(L=this._view.getUint32(this._offset),N=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&L)+N)+(L>>>2)/1e6)):[t,this._bin(8)];case 216:return t=this._view.getInt8(this._offset),this._offset+=1,[t,this._bin(16)];case 217:return mV=this._view.getUint8(this._offset),this._offset+=1,this._str(mV);case 218:return mV=this._view.getUint16(this._offset),this._offset+=2,this._str(mV);case 219:return mV=this._view.getUint32(this._offset),this._offset+=4,this._str(mV);case 220:return mV=this._view.getUint16(this._offset),this._offset+=2,this._array(mV);case 221:return mV=this._view.getUint32(this._offset),this._offset+=4,this._array(mV);case 222:return mV=this._view.getUint16(this._offset),this._offset+=2,this._map(mV);case 223:return mV=this._view.getUint32(this._offset),this._offset+=4,this._map(mV)}throw new Error("Could not parse")},h.decode=function(V){var h=new mV(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),t=h._parse();if(h._offset!==V.byteLength)throw new Error(V.byteLength-h._offset+" trailing bytes");return t};function t(V,h,mV){for(var t=0,L=0,N=mV.length;L<N;L++)(t=mV.charCodeAt(L))<128?V.setUint8(h++,t):t<2048?(V.setUint8(h++,192|t>>6),V.setUint8(h++,128|63&t)):t<55296||t>=57344?(V.setUint8(h++,224|t>>12),V.setUint8(h++,128|t>>6&63),V.setUint8(h++,128|63&t)):(L++,t=65536+((1023&t)<<10|1023&mV.charCodeAt(L)),V.setUint8(h++,240|t>>18),V.setUint8(h++,128|t>>12&63),V.setUint8(h++,128|t>>6&63),V.setUint8(h++,128|63&t))}function L(V,h,mV){var t=typeof mV,N=0,A=0,k=0,C=0,K=0,o=0;if("string"===t){if(K=function(V){for(var h=0,mV=0,t=0,L=V.length;t<L;t++)(h=V.charCodeAt(t))<128?mV+=1:h<2048?mV+=2:h<55296||h>=57344?mV+=3:(t++,mV+=4);return mV}(mV),K<32)V.push(160|K),o=1;else if(K<256)V.push(217,K),o=2;else if(K<65536)V.push(218,K>>8,K),o=3;else{if(!(K<4294967296))throw new Error("String too long");V.push(219,K>>24,K>>16,K>>8,K),o=5}return h.push({_str:mV,_length:K,_offset:V.length}),o+K}if("number"===t)return Math.floor(mV)===mV&&isFinite(mV)?mV>=0?mV<128?(V.push(mV),1):mV<256?(V.push(204,mV),2):mV<65536?(V.push(205,mV>>8,mV),3):mV<4294967296?(V.push(206,mV>>24,mV>>16,mV>>8,mV),5):(k=mV/Math.pow(2,32)|0,C=mV>>>0,V.push(207,k>>24,k>>16,k>>8,k,C>>24,C>>16,C>>8,C),9):mV>=-32?(V.push(mV),1):mV>=-128?(V.push(208,mV),2):mV>=-32768?(V.push(209,mV>>8,mV),3):mV>=-2147483648?(V.push(210,mV>>24,mV>>16,mV>>8,mV),5):(k=Math.floor(mV/Math.pow(2,32)),C=mV>>>0,V.push(211,k>>24,k>>16,k>>8,k,C>>24,C>>16,C>>8,C),9):(V.push(203),h.push({_float:mV,_length:8,_offset:V.length}),9);if("object"===t){if(null===mV)return V.push(192),1;if(Array.isArray(mV)){if((K=mV.length)<16)V.push(144|K),o=1;else if(K<65536)V.push(220,K>>8,K),o=3;else{if(!(K<4294967296))throw new Error("Array too large");V.push(221,K>>24,K>>16,K>>8,K),o=5}for(N=0;N<K;N++)o+=L(V,h,mV[N]);return o}if(mV instanceof Date){var n=mV.getTime(),q=Math.floor(n/1e3),x=1e6*(n-1e3*q);return q>=0&&x>=0&&q<=17179869183?0===x&&q<=4294967295?(V.push(214,255,q>>24,q>>16,q>>8,q),6):(k=q/4294967296,C=4294967295&q,V.push(215,255,x>>22,x>>14,x>>6,k,C>>24,C>>16,C>>8,C),10):(k=Math.floor(q/4294967296),C=q>>>0,V.push(199,12,255,x>>24,x>>16,x>>8,x,k>>24,k>>16,k>>8,k,C>>24,C>>16,C>>8,C),15)}if(mV instanceof ArrayBuffer){if((K=mV.byteLength)<256)V.push(196,K),o=2;else if(K<65536)V.push(197,K>>8,K),o=3;else{if(!(K<4294967296))throw new Error("Buffer too large");V.push(198,K>>24,K>>16,K>>8,K),o=5}return h.push({_bin:mV,_length:K,_offset:V.length}),o+K}if("function"===typeof mV.toJSON)return L(V,h,mV.toJSON());var R=[],d="",s=Object.keys(mV);for(N=0,A=s.length;N<A;N++)void 0!==mV[d=s[N]]&&"function"!==typeof mV[d]&&R.push(d);if((K=R.length)<16)V.push(128|K),o=1;else if(K<65536)V.push(222,K>>8,K),o=3;else{if(!(K<4294967296))throw new Error("Object too large");V.push(223,K>>24,K>>16,K>>8,K),o=5}for(N=0;N<K;N++)o+=L(V,h,d=R[N]),o+=L(V,h,mV[d]);return o}if("boolean"===t)return V.push(mV?195:194),1;if("undefined"===t)return V.push(192),1;if("function"===typeof mV.toJSON)return L(V,h,mV.toJSON());throw new Error("Could not encode")}h.encode=function(V){var h=[],mV=[],N=L(h,mV,V),A=new ArrayBuffer(N),k=new DataView(A),C=0,K=0,o=-1;mV.length>0&&(o=mV[0]._offset);for(var n,q=0,x=0,R=0,d=h.length;R<d;R++)if(k.setUint8(K+R,h[R]),R+1===o){if(q=(n=mV[C])._length,x=K+o,n._bin)for(var s=new Uint8Array(n._bin),M=0;M<q;M++)k.setUint8(x+M,s[M]);else n._str?t(k,x,n._str):void 0!==n._float&&k.setFloat64(x,n._float);K+=q,mV[++C]&&(o=mV[C]._offset)}return A}},13119:(V,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.NoneSerializer=void 0;h.NoneSerializer=class{setState(V){}getState(){return null}patch(V){}teardown(){}handshake(V){}}},13116:(V,h,mV)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.SchemaSerializer=void 0;const t=mV(13083);h.SchemaSerializer=class{setState(V){return this.state.decode(V)}getState(){return this.state}patch(V){return this.state.decode(V)}teardown(){var V,h;null===(h=null===(V=this.state)||void 0===V?void 0:V.$changes)||void 0===h||h.root.clearRefs()}handshake(V,h){if(this.state){(new t.Reflection).decode(V,h)}else this.state=t.Reflection.decode(V,h)}}},13070:(V,h)=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0}),h.getSerializer=h.registerSerializer=void 0;const mV={};h.registerSerializer=function(V,h){mV[V]=h},h.getSerializer=function(V){const h=mV[V];if(!h)throw new Error("missing serializer: "+V);return h}},13055:function(V,h,mV){"use strict";var t=this&&this.__importDefault||function(V){return V&&V.__esModule?V:{default:V}};Object.defineProperty(h,"__esModule",{value:!0}),h.WebSocketTransport=void 0;const L=t(mV(13061)),N=globalThis.WebSocket||L.default;h.WebSocketTransport=class{constructor(V){this.events=V}send(V){V instanceof ArrayBuffer?this.ws.send(V):Array.isArray(V)&&this.ws.send(new Uint8Array(V).buffer)}connect(V,h){try{this.ws=new N(V,{headers:h,protocols:this.protocols})}catch(mV){this.ws=new N(V,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(V,h){this.ws.close(V,h)}get isOpen(){return this.ws.readyState===N.OPEN}}},13061:V=>{"use strict";V.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13514:V=>{"use strict";V.exports=function(V){for(var h=new Array(V),mV=0;mV<V;++mV)h[mV]=mV;return h}},13523:V=>{function h(V){return!!V.constructor&&"function"===typeof V.constructor.isBuffer&&V.constructor.isBuffer(V)}V.exports=function(V){return null!=V&&(h(V)||function(V){return"function"===typeof V.readFloatLE&&"function"===typeof V.slice&&h(V.slice(0,0))}(V)||!!V._isBuffer)}},13511:(V,h,mV)=>{var t=mV(13514),L=mV(13523),N="undefined"!==typeof Float64Array;function A(V,h){return V[0]-h[0]}function k(){var V,h=this.stride,mV=new Array(h.length);for(V=0;V<mV.length;++V)mV[V]=[Math.abs(h[V]),V];mV.sort(A);var t=new Array(mV.length);for(V=0;V<t.length;++V)t[V]=mV[V][1];return t}function C(V,h){var mV=["View",h,"d",V].join("");h<0&&(mV="View_Nil"+V);var L="generic"===V;if(-1===h){var N="function "+mV+"(a){this.data=a;};var proto="+mV+".prototype;proto.dtype='"+V+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+mV+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+mV+"(a){return new "+mV+"(a);}";return new Function(N)()}if(0===h){N="function "+mV+"(a,d) {this.data = a;this.offset = d};var proto="+mV+".prototype;proto.dtype='"+V+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+mV+"_copy() {return new "+mV+"(this.data,this.offset)};proto.pick=function "+mV+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+mV+"_get(){return "+(L?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+mV+"_set(v){return "+(L?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+mV+"(a,b,c,d){return new "+mV+"(a,d)}";return new Function("TrivialArray",N)(K[V][0])}N=["'use strict'"];var A=t(h),C=A.map((function(V){return"i"+V})),o="this.offset+"+A.map((function(V){return"this.stride["+V+"]*i"+V})).join("+"),n=A.map((function(V){return"b"+V})).join(","),q=A.map((function(V){return"c"+V})).join(",");N.push("function "+mV+"(a,"+n+","+q+",d){this.data=a","this.shape=["+n+"]","this.stride=["+q+"]","this.offset=d|0}","var proto="+mV+".prototype","proto.dtype='"+V+"'","proto.dimension="+h),N.push("Object.defineProperty(proto,'size',{get:function "+mV+"_size(){return "+A.map((function(V){return"this.shape["+V+"]"})).join("*"),"}})"),1===h?N.push("proto.order=[0]"):(N.push("Object.defineProperty(proto,'order',{get:"),h<4?(N.push("function "+mV+"_order(){"),2===h?N.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===h&&N.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):N.push("ORDER})")),N.push("proto.set=function "+mV+"_set("+C.join(",")+",v){"),L?N.push("return this.data.set("+o+",v)}"):N.push("return this.data["+o+"]=v}"),N.push("proto.get=function "+mV+"_get("+C.join(",")+"){"),L?N.push("return this.data.get("+o+")}"):N.push("return this.data["+o+"]}"),N.push("proto.index=function "+mV+"_index(",C.join(),"){return "+o+"}"),N.push("proto.hi=function "+mV+"_hi("+C.join(",")+"){return new "+mV+"(this.data,"+A.map((function(V){return["(typeof i",V,"!=='number'||i",V,"<0)?this.shape[",V,"]:i",V,"|0"].join("")})).join(",")+","+A.map((function(V){return"this.stride["+V+"]"})).join(",")+",this.offset)}");var x=A.map((function(V){return"a"+V+"=this.shape["+V+"]"})),R=A.map((function(V){return"c"+V+"=this.stride["+V+"]"}));N.push("proto.lo=function "+mV+"_lo("+C.join(",")+"){var b=this.offset,d=0,"+x.join(",")+","+R.join(","));for(var d=0;d<h;++d)N.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");N.push("return new "+mV+"(this.data,"+A.map((function(V){return"a"+V})).join(",")+","+A.map((function(V){return"c"+V})).join(",")+",b)}"),N.push("proto.step=function "+mV+"_step("+C.join(",")+"){var "+A.map((function(V){return"a"+V+"=this.shape["+V+"]"})).join(",")+","+A.map((function(V){return"b"+V+"=this.stride["+V+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(d=0;d<h;++d)N.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");N.push("return new "+mV+"(this.data,"+A.map((function(V){return"a"+V})).join(",")+","+A.map((function(V){return"b"+V})).join(",")+",c)}");var s=new Array(h),M=new Array(h);for(d=0;d<h;++d)s[d]="a[i"+d+"]",M[d]="b[i"+d+"]";N.push("proto.transpose=function "+mV+"_transpose("+C+"){"+C.map((function(V,h){return V+"=("+V+"===undefined?"+h+":"+V+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+mV+"(this.data,"+s.join(",")+","+M.join(",")+",this.offset)}"),N.push("proto.pick=function "+mV+"_pick("+C+"){var a=[],b=[],c=this.offset");for(d=0;d<h;++d)N.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return N.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),N.push("return function construct_"+mV+"(data,shape,stride,offset){return new "+mV+"(data,"+A.map((function(V){return"shape["+V+"]"})).join(",")+","+A.map((function(V){return"stride["+V+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",N.join("\n"))(K[V],k)}var K={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};V.exports=function(V,h,mV,t){if(void 0===V)return(0,K.array[0])([]);"number"===typeof V&&(V=[V]),void 0===h&&(h=[V.length]);var A=h.length;if(void 0===mV){mV=new Array(A);for(var k=A-1,o=1;k>=0;--k)mV[k]=o,o*=h[k]}if(void 0===t){t=0;for(k=0;k<A;++k)mV[k]<0&&(t-=(h[k]-1)*mV[k])}for(var n=function(V){if(L(V))return"buffer";if(N)switch(Object.prototype.toString.call(V)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(V)?"array":"generic"}(V),q=K[n];q.length<=A+1;)q.push(C(n,q.length-1));return(0,q[A+1])(V,h,mV,t)}},14479:V=>{var h;self,h=()=>(()=>{"use strict";var V={d:(h,mV)=>{for(var t in mV)V.o(mV,t)&&!V.o(h,t)&&Object.defineProperty(h,t,{enumerable:!0,get:mV[t]})},o:(V,h)=>Object.prototype.hasOwnProperty.call(V,h)},h={};V.d(h,{default:()=>T});var mV,t=function(V,h){var mV=h.x-V.x,t=h.y-V.y;return Math.sqrt(mV*mV+t*t)},L=function(V){return V*(Math.PI/180)},N=new Map,A=function(V){N.has(V)&&clearTimeout(N.get(V)),N.set(V,setTimeout(V,100))},k=function(V,h,mV){for(var t,L=h.split(/[ ,]+/g),N=0;N<L.length;N+=1)t=L[N],V.addEventListener?V.addEventListener(t,mV,!1):V.attachEvent&&V.attachEvent(t,mV)},C=function(V,h,mV){for(var t,L=h.split(/[ ,]+/g),N=0;N<L.length;N+=1)t=L[N],V.removeEventListener?V.removeEventListener(t,mV):V.detachEvent&&V.detachEvent(t,mV)},K=function(V){return V.preventDefault(),V.type.match(/^touch/)?V.changedTouches:V},o=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},n=function(V,h){h.top||h.right||h.bottom||h.left?(V.style.top=h.top,V.style.right=h.right,V.style.bottom=h.bottom,V.style.left=h.left):(V.style.left=h.x+"px",V.style.top=h.y+"px")},q=function(V,h,mV){var t=x(V);for(var L in t)if(t.hasOwnProperty(L))if("string"==typeof h)t[L]=h+" "+mV;else{for(var N="",A=0,k=h.length;A<k;A+=1)N+=h[A]+" "+mV+", ";t[L]=N.slice(0,-2)}return t},x=function(V){var h={};return h[V]="",["webkit","Moz","o"].forEach((function(mV){h[mV+V.charAt(0).toUpperCase()+V.slice(1)]=""})),h},R=function(V,h){for(var mV in h)h.hasOwnProperty(mV)&&(V[mV]=h[mV]);return V},d=function(V,h){if(V.length)for(var mV=0,t=V.length;mV<t;mV+=1)h(V[mV]);else h(V)},s="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,M=window.matchMedia("(any-hover: none)").matches,c=!!("ontouchstart"in window),z=!!window.PointerEvent,Q=!!window.MSPointerEvent,J={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},v={start:"mousedown",move:"mousemove",end:"mouseup"},D={};function H(){}s&&!M?mV=J:z?mV={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Q?mV={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:c?(mV=J,D=v):mV=v,H.prototype.on=function(V,h){var mV,t=this,L=V.split(/[ ,]+/g);t._handlers_=t._handlers_||{};for(var N=0;N<L.length;N+=1)mV=L[N],t._handlers_[mV]=t._handlers_[mV]||[],t._handlers_[mV].push(h);return t},H.prototype.off=function(V,h){var mV=this;return mV._handlers_=mV._handlers_||{},void 0===V?mV._handlers_={}:void 0===h?mV._handlers_[V]=null:mV._handlers_[V]&&mV._handlers_[V].indexOf(h)>=0&&mV._handlers_[V].splice(mV._handlers_[V].indexOf(h),1),mV},H.prototype.trigger=function(V,h){var mV,t=this,L=V.split(/[ ,]+/g);t._handlers_=t._handlers_||{};for(var N=0;N<L.length;N+=1)mV=L[N],t._handlers_[mV]&&t._handlers_[mV].length&&t._handlers_[mV].forEach((function(V){V.call(t,{type:mV,target:t},h)}))},H.prototype.config=function(V){var h=this;h.options=h.defaults||{},V&&(h.options=function(V,h){var mV={};for(var t in V)V.hasOwnProperty(t)&&h.hasOwnProperty(t)?mV[t]=h[t]:V.hasOwnProperty(t)&&(mV[t]=V[t]);return mV}(h.options,V))},H.prototype.bindEvt=function(V,h){var t=this;return t._domHandlers_=t._domHandlers_||{},t._domHandlers_[h]=function(){"function"==typeof t["on"+h]?t["on"+h].apply(t,arguments):console.warn('[WARNING] : Missing "on'+h+'" handler.')},k(V,mV[h],t._domHandlers_[h]),D[h]&&k(V,D[h],t._domHandlers_[h]),t},H.prototype.unbindEvt=function(V,h){var t=this;return t._domHandlers_=t._domHandlers_||{},C(V,mV[h],t._domHandlers_[h]),D[h]&&C(V,D[h],t._domHandlers_[h]),delete t._domHandlers_[h],this};const j=H;function l(V,h){return this.identifier=h.identifier,this.position=h.position,this.frontPosition=h.frontPosition,this.collection=V,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(h),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=l.id,l.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}l.prototype=new j,l.constructor=l,l.id=0,l.prototype.buildEl=function(V){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},l.prototype.stylize=function(){if(this.options.dataOnly)return this;var V=this.options.fadeTime+"ms",h=function(){var V=x("borderRadius");for(var h in V)V.hasOwnProperty(h)&&(V[h]="50%");return V}(),mV=q("transition","opacity",V),t={};return t.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},t.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},t.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},R(t.el,mV),"circle"===this.options.shape&&R(t.back,h),R(t.front,h),this.applyStyles(t),this},l.prototype.applyStyles=function(V){for(var h in this.ui)if(this.ui.hasOwnProperty(h))for(var mV in V[h])this.ui[h].style[mV]=V[h][mV];return this},l.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},l.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},l.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},l.prototype.show=function(V){var h=this;return h.options.dataOnly||(clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.addToDom(),h.restCallback(),setTimeout((function(){h.ui.el.style.opacity=1}),0),h.showTimeout=setTimeout((function(){h.trigger("shown",h.instance),"function"==typeof V&&V.call(this)}),h.options.fadeTime)),h},l.prototype.hide=function(V){var h=this;if(h.options.dataOnly)return h;if(h.ui.el.style.opacity=h.options.restOpacity,clearTimeout(h.removeTimeout),clearTimeout(h.showTimeout),clearTimeout(h.restTimeout),h.removeTimeout=setTimeout((function(){var mV="dynamic"===h.options.mode?"none":"block";h.ui.el.style.display=mV,"function"==typeof V&&V.call(h),h.trigger("hidden",h.instance)}),h.options.fadeTime),h.options.restJoystick){var mV=h.options.restJoystick,t={};t.x=!0===mV||!1!==mV.x?0:h.instance.frontPosition.x,t.y=!0===mV||!1!==mV.y?0:h.instance.frontPosition.y,h.setPosition(V,t)}return h},l.prototype.setPosition=function(V,h){var mV=this;mV.frontPosition={x:h.x,y:h.y};var t=mV.options.fadeTime+"ms",L={};L.front=q("transition",["transform"],t);var N={front:{}};N.front={transform:"translate("+mV.frontPosition.x+"px,"+mV.frontPosition.y+"px)"},mV.applyStyles(L),mV.applyStyles(N),mV.restTimeout=setTimeout((function(){"function"==typeof V&&V.call(mV),mV.restCallback()}),mV.options.fadeTime)},l.prototype.restCallback=function(){var V=this,h={};h.front=q("transition","none",""),V.applyStyles(h),V.trigger("rested",V.instance)},l.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},l.prototype.computeDirection=function(V){var h,mV,t,L=V.angle.radian,N=Math.PI/4,A=Math.PI/2;if(L>N&&L<3*N&&!V.lockX?h="up":L>-N&&L<=N&&!V.lockY?h="left":L>3*-N&&L<=-N&&!V.lockX?h="down":V.lockY||(h="right"),V.lockY||(mV=L>-A&&L<A?"left":"right"),V.lockX||(t=L>0?"up":"down"),V.force>this.options.threshold){var k,C={};for(k in this.direction)this.direction.hasOwnProperty(k)&&(C[k]=this.direction[k]);var K={};for(k in this.direction={x:mV,y:t,angle:h},V.direction=this.direction,C)C[k]===this.direction[k]&&(K[k]=!0);if(K.x&&K.y&&K.angle)return V;K.x&&K.y||this.trigger("plain",V),K.x||this.trigger("plain:"+mV,V),K.y||this.trigger("plain:"+t,V),K.angle||this.trigger("dir dir:"+h,V)}else this.resetDirection();return V};const G=l;function y(V,h){var mV=this;mV.nipples=[],mV.idles=[],mV.actives=[],mV.ids=[],mV.pressureIntervals={},mV.manager=V,mV.id=y.id,y.id+=1,mV.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},mV.config(h),"static"!==mV.options.mode&&"semi"!==mV.options.mode||(mV.options.multitouch=!1),mV.options.multitouch||(mV.options.maxNumberOfNipples=1);var t=getComputedStyle(mV.options.zone.parentElement);return t&&"flex"===t.display&&(mV.parentIsFlex=!0),mV.updateBox(),mV.prepareNipples(),mV.nq(),mV.begin(),mV.nipples}y.prototype=new j,y.constructor=y,y.id=0,y.prototype.prepareNipples=function(){var V=this,h=V.nipples;h.on=V.on.bind(V),h.off=V.off.bind(V),h.options=V.options,h.destroy=V.destroy.bind(V),h.ids=V.ids,h.id=V.id,h.processOnMove=V.processOnMove.bind(V),h.processOnEnd=V.processOnEnd.bind(V),h.get=function(V){if(void 0===V)return h[0];for(var mV=0,t=h.length;mV<t;mV+=1)if(h[mV].identifier===V)return h[mV];return!1}},y.prototype.nq=function(){var V=this;V.bindEvt(V.options.zone,"start"),V.options.zone.style.touchAction="none",V.options.zone.style.msTouchAction="none"},y.prototype.begin=function(){var V=this,h=V.options;if("static"===h.mode){var mV=V.createNipple(h.position,V.manager.getIdentifier());mV.add(),V.idles.push(mV)}},y.prototype.createNipple=function(V,h){var mV=this,t=mV.manager.scroll,L={},N=mV.options,A=mV.parentIsFlex?t.x:t.x+mV.box.left,k=mV.parentIsFlex?t.y:t.y+mV.box.top;if(V.x&&V.y)L={x:V.x-A,y:V.y-k};else if(V.top||V.right||V.bottom||V.left){var C=document.createElement("DIV");C.style.display="hidden",C.style.top=V.top,C.style.right=V.right,C.style.bottom=V.bottom,C.style.left=V.left,C.style.position="absolute",N.zone.appendChild(C);var K=C.getBoundingClientRect();N.zone.removeChild(C),L=V,V={x:K.left+t.x,y:K.top+t.y}}var o=new G(mV,{color:N.color,size:N.size,threshold:N.threshold,fadeTime:N.fadeTime,dataOnly:N.dataOnly,restJoystick:N.restJoystick,restOpacity:N.restOpacity,mode:N.mode,identifier:h,position:V,zone:N.zone,frontPosition:{x:0,y:0},shape:N.shape});return N.dataOnly||(n(o.ui.el,L),n(o.ui.front,o.frontPosition)),mV.nipples.push(o),mV.trigger("added "+o.identifier+":added",o),mV.manager.trigger("added "+o.identifier+":added",o),mV.bindNipple(o),o},y.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},y.prototype.bindNipple=function(V){var h,mV=this,t=function(V,t){h=V.type+" "+t.id+":"+V.type,mV.trigger(h,t)};V.on("destroyed",mV.onDestroyed.bind(mV)),V.on("shown hidden rested dir plain",t),V.on("dir:up dir:right dir:down dir:left",t),V.on("plain:up plain:right plain:down plain:left",t)},y.prototype.pressureFn=function(V,h,mV){var t=this,L=0;clearInterval(t.pressureIntervals[mV]),t.pressureIntervals[mV]=setInterval(function(){var mV=V.force||V.pressure||V.webkitForce||0;mV!==L&&(h.trigger("pressure",mV),t.trigger("pressure "+h.identifier+":pressure",mV),L=mV)}.bind(t),100)},y.prototype.onstart=function(V){var h=this,mV=h.options,t=V;return V=K(V),h.updateBox(),d(V,(function(L){h.actives.length<mV.maxNumberOfNipples?h.processOnStart(L):t.type.match(/^touch/)&&(Object.keys(h.manager.ids).forEach((function(mV){if(Object.values(t.touches).findIndex((function(V){return V.identifier===mV}))<0){var L=[V[0]];L.identifier=mV,h.processOnEnd(L)}})),h.actives.length<mV.maxNumberOfNipples&&h.processOnStart(L))})),h.manager.bindDocument(),!1},y.prototype.processOnStart=function(V){var h,mV=this,L=mV.options,N=mV.manager.getIdentifier(V),A=V.force||V.pressure||V.webkitForce||0,k={x:V.pageX,y:V.pageY},C=mV.getOrCreate(N,k);C.identifier!==N&&mV.manager.removeIdentifier(C.identifier),C.identifier=N;var K=function(h){h.trigger("start",h),mV.trigger("start "+h.id+":start",h),h.show(),A>0&&mV.pressureFn(V,h,h.identifier),mV.processOnMove(V)};if((h=mV.idles.indexOf(C))>=0&&mV.idles.splice(h,1),mV.actives.push(C),mV.ids.push(C.identifier),"semi"!==L.mode)K(C);else{if(!(t(k,C.position)<=L.catchDistance))return C.destroy(),void mV.processOnStart(V);K(C)}return C},y.prototype.getOrCreate=function(V,h){var mV,t=this,L=t.options;return/(semi|static)/.test(L.mode)?(mV=t.idles[0])?(t.idles.splice(0,1),mV):"semi"===L.mode?t.createNipple(h,V):(console.warn("Coudln't find the needed nipple."),!1):mV=t.createNipple(h,V)},y.prototype.processOnMove=function(V){var h=this,mV=h.options,N=h.manager.getIdentifier(V),A=h.nipples.get(N),k=h.manager.scroll;if(function(V){return isNaN(V.buttons)?0!==V.pressure:0!==V.buttons}(V)){if(!A)return console.error("Found zombie joystick with ID "+N),void h.manager.removeIdentifier(N);if(mV.dynamicPage){var C=A.el.getBoundingClientRect();A.position={x:k.x+C.left,y:k.y+C.top}}A.identifier=N;var K=A.options.size/2,o={x:V.pageX,y:V.pageY};mV.lockX&&(o.y=A.position.y),mV.lockY&&(o.x=A.position.x);var n,q,x,R,d,s,M,c,z,Q,J=t(o,A.position),v=(n=o,x=(q=A.position).x-n.x,R=q.y-n.y,function(V){return V*(180/Math.PI)}(Math.atan2(R,x))),D=L(v),H=J/K,j={distance:J,position:o};if("circle"===A.options.shape?(d=Math.min(J,K),M=A.position,c=d,Q={x:0,y:0},z=L(z=v),Q.x=M.x-c*Math.cos(z),Q.y=M.y-c*Math.sin(z),s=Q):(s=function(V,h,mV){return{x:Math.min(Math.max(V.x,h.x-mV),h.x+mV),y:Math.min(Math.max(V.y,h.y-mV),h.y+mV)}}(o,A.position,K),d=t(s,A.position)),mV.follow){if(J>K){var l=o.x-s.x,G=o.y-s.y;A.position.x+=l,A.position.y+=G,A.el.style.top=A.position.y-(h.box.top+k.y)+"px",A.el.style.left=A.position.x-(h.box.left+k.x)+"px",J=t(o,A.position)}}else o=s,J=d;var y=o.x-A.position.x,O=o.y-A.position.y;A.frontPosition={x:y,y:O},mV.dataOnly||(A.ui.front.style.transform="translate("+y+"px,"+O+"px)");var I={identifier:A.identifier,position:o,force:H,pressure:V.force||V.pressure||V.webkitForce||0,distance:J,angle:{radian:D,degree:v},vector:{x:y/K,y:-O/K},raw:j,instance:A,lockX:mV.lockX,lockY:mV.lockY};(I=A.computeDirection(I)).angle={radian:L(180-v),degree:180-v},A.trigger("move",I),h.trigger("move "+A.id+":move",I)}else this.processOnEnd(V)},y.prototype.processOnEnd=function(V){var h=this,mV=h.options,t=h.manager.getIdentifier(V),L=h.nipples.get(t),N=h.manager.removeIdentifier(L.identifier);L&&(mV.dataOnly||L.hide((function(){"dynamic"===mV.mode&&(L.trigger("removed",L),h.trigger("removed "+L.id+":removed",L),h.manager.trigger("removed "+L.id+":removed",L),L.destroy())})),clearInterval(h.pressureIntervals[L.identifier]),L.resetDirection(),L.trigger("end",L),h.trigger("end "+L.id+":end",L),h.ids.indexOf(L.identifier)>=0&&h.ids.splice(h.ids.indexOf(L.identifier),1),h.actives.indexOf(L)>=0&&h.actives.splice(h.actives.indexOf(L),1),/(semi|static)/.test(mV.mode)?h.idles.push(L):h.nipples.indexOf(L)>=0&&h.nipples.splice(h.nipples.indexOf(L),1),h.manager.unbindDocument(),/(semi|static)/.test(mV.mode)&&(h.manager.ids[N.id]=N.identifier))},y.prototype.onDestroyed=function(V,h){var mV=this;mV.nipples.indexOf(h)>=0&&mV.nipples.splice(mV.nipples.indexOf(h),1),mV.actives.indexOf(h)>=0&&mV.actives.splice(mV.actives.indexOf(h),1),mV.idles.indexOf(h)>=0&&mV.idles.splice(mV.idles.indexOf(h),1),mV.ids.indexOf(h.identifier)>=0&&mV.ids.splice(mV.ids.indexOf(h.identifier),1),mV.manager.removeIdentifier(h.identifier),mV.manager.unbindDocument()},y.prototype.destroy=function(){var V=this;for(var h in V.unbindEvt(V.options.zone,"start"),V.nipples.forEach((function(V){V.destroy()})),V.pressureIntervals)V.pressureIntervals.hasOwnProperty(h)&&clearInterval(V.pressureIntervals[h]);V.trigger("destroyed",V.nipples),V.manager.unbindDocument(),V.off()};const O=y;function I(V){var h=this;h.ids={},h.index=0,h.collections=[],h.scroll=o(),h.config(V),h.prepareCollections();var mV=function(){var V;h.collections.forEach((function(mV){mV.forEach((function(mV){V=mV.el.getBoundingClientRect(),mV.position={x:h.scroll.x+V.left,y:h.scroll.y+V.top}}))}))};k(window,"resize",(function(){A(mV)}));var t=function(){h.scroll=o()};return k(window,"scroll",(function(){A(t)})),h.collections}I.prototype=new j,I.constructor=I,I.prototype.prepareCollections=function(){var V=this;V.collections.create=V.create.bind(V),V.collections.on=V.on.bind(V),V.collections.off=V.off.bind(V),V.collections.destroy=V.destroy.bind(V),V.collections.get=function(h){var mV;return V.collections.every((function(V){return!(mV=V.get(h))})),mV}},I.prototype.create=function(V){return this.createCollection(V)},I.prototype.createCollection=function(V){var h=this,mV=new O(h,V);return h.bindCollection(mV),h.collections.push(mV),mV},I.prototype.bindCollection=function(V){var h,mV=this,t=function(V,t){h=V.type+" "+t.id+":"+V.type,mV.trigger(h,t)};V.on("destroyed",mV.onDestroyed.bind(mV)),V.on("shown hidden rested dir plain",t),V.on("dir:up dir:right dir:down dir:left",t),V.on("plain:up plain:right plain:down plain:left",t)},I.prototype.bindDocument=function(){var V=this;V.binded||(V.bindEvt(document,"move").bindEvt(document,"end"),V.binded=!0)},I.prototype.unbindDocument=function(V){var h=this;Object.keys(h.ids).length&&!0!==V||(h.unbindEvt(document,"move").unbindEvt(document,"end"),h.binded=!1)},I.prototype.getIdentifier=function(V){var h;return V?void 0===(h=void 0===V.identifier?V.pointerId:V.identifier)&&(h=this.latest||0):h=this.index,void 0===this.ids[h]&&(this.ids[h]=this.index,this.index+=1),this.latest=h,this.ids[h]},I.prototype.removeIdentifier=function(V){var h={};for(var mV in this.ids)if(this.ids[mV]===V){h.id=mV,h.identifier=this.ids[mV],delete this.ids[mV];break}return h},I.prototype.onmove=function(V){return this.onAny("move",V),!1},I.prototype.onend=function(V){return this.onAny("end",V),!1},I.prototype.oncancel=function(V){return this.onAny("end",V),!1},I.prototype.onAny=function(V,h){var mV,t=this,L="processOn"+V.charAt(0).toUpperCase()+V.slice(1);h=K(h);var N=function(V,h,mV){mV.ids.indexOf(h)>=0&&(mV[L](V),V._found_=!0)};return d(h,(function(V){mV=t.getIdentifier(V),d(t.collections,N.bind(null,V,mV)),V._found_||t.removeIdentifier(mV)})),!1},I.prototype.destroy=function(){var V=this;V.unbindDocument(!0),V.ids={},V.index=0,V.collections.forEach((function(V){V.destroy()})),V.off()},I.prototype.onDestroyed=function(V,h){var mV=this;if(mV.collections.indexOf(h)<0)return!1;mV.collections.splice(mV.collections.indexOf(h),1)};var r=new I;const T={create:function(V){return r.create(V)},factory:r};return h.default})(),V.exports=h()},13540:(V,h,mV)=>{"use strict";const{Deflate:t,deflate:L,deflateRaw:N,gzip:A}=mV(13543),{Inflate:k,inflate:C,inflateRaw:K,ungzip:o}=mV(13591),n=mV(13568);V.exports.Deflate=t,V.exports.deflate=L,V.exports.deflateRaw=N,V.exports.gzip=A,V.exports.Inflate=k,V.exports.inflate=C,V.exports.inflateRaw=K,V.exports.ungzip=o,V.exports.constants=n},13543:(V,h,mV)=>{"use strict";const t=mV(13549),L=mV(13575),N=mV(13582),A=mV(13561),k=mV(13589),C=Object.prototype.toString,{Z_NO_FLUSH:K,Z_SYNC_FLUSH:o,Z_FULL_FLUSH:n,Z_FINISH:q,Z_OK:x,Z_STREAM_END:R,Z_DEFAULT_COMPRESSION:d,Z_DEFAULT_STRATEGY:s,Z_DEFLATED:M}=mV(13568);function c(V){this.options=L.assign({level:d,method:M,SV:16384,windowBits:15,memLevel:8,strategy:s},V||{});let h=this.options;h.raw&&h.windowBits>0?h.windowBits=-h.windowBits:h.gzip&&h.windowBits>0&&h.windowBits<16&&(h.windowBits+=16),this.err=0,this.oh="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;let mV=t.deflateInit2(this.strm,h.level,h.method,h.windowBits,h.memLevel,h.strategy);if(mV!==x)throw new Error(A[mV]);if(h.header&&t.deflateSetHeader(this.strm,h.header),h.dictionary){let V;if(V="string"===typeof h.dictionary?N.string2buf(h.dictionary):"[object ArrayBuffer]"===C.call(h.dictionary)?new Uint8Array(h.dictionary):h.dictionary,mV=t.deflateSetDictionary(this.strm,V),mV!==x)throw new Error(A[mV]);this._dict_set=!0}}function z(V,h){const mV=new c(h);if(mV.push(V,!0),mV.err)throw mV.oh||A[mV.err];return mV.result}c.prototype.push=function(V,h){const mV=this.strm,L=this.options.SV;let A,k;if(this.ended)return!1;for(k=h===~~h?h:!0===h?q:K,"string"===typeof V?mV.input=N.string2buf(V):"[object ArrayBuffer]"===C.call(V)?mV.input=new Uint8Array(V):mV.input=V,mV.next_in=0,mV.avail_in=mV.input.length;;)if(0===mV.avail_out&&(mV.output=new Uint8Array(L),mV.next_out=0,mV.avail_out=L),(k===o||k===n)&&mV.avail_out<=6)this.onData(mV.output.subarray(0,mV.next_out)),mV.avail_out=0;else{if(A=t.deflate(mV,k),A===R)return mV.next_out>0&&this.onData(mV.output.subarray(0,mV.next_out)),A=t.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===x;if(0!==mV.avail_out){if(k>0&&mV.next_out>0)this.onData(mV.output.subarray(0,mV.next_out)),mV.avail_out=0;else if(0===mV.avail_in)break}else this.onData(mV.output)}return!0},c.prototype.onData=function(V){this.chunks.push(V)},c.prototype.onEnd=function(V){V===x&&(this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.oh=this.strm.oh},V.exports.Deflate=c,V.exports.deflate=z,V.exports.deflateRaw=function(V,h){return(h=h||{}).raw=!0,z(V,h)},V.exports.gzip=function(V,h){return(h=h||{}).gzip=!0,z(V,h)},V.exports.constants=mV(13568)},13591:(V,h,mV)=>{"use strict";const t=mV(13595),L=mV(13575),N=mV(13582),A=mV(13561),k=mV(13589),C=mV(13617),K=Object.prototype.toString,{Z_NO_FLUSH:o,Z_FINISH:n,Z_OK:q,Z_STREAM_END:x,Z_NEED_DICT:R,Z_STREAM_ERROR:d,Z_DATA_ERROR:s,Z_MEM_ERROR:M}=mV(13568);function c(V){this.options=L.assign({SV:65536,windowBits:15,to:""},V||{});const h=this.options;h.raw&&h.windowBits>=0&&h.windowBits<16&&(h.windowBits=-h.windowBits,0===h.windowBits&&(h.windowBits=-15)),!(h.windowBits>=0&&h.windowBits<16)||V&&V.windowBits||(h.windowBits+=32),h.windowBits>15&&h.windowBits<48&&0===(15&h.windowBits)&&(h.windowBits|=15),this.err=0,this.oh="",this.ended=!1,this.chunks=[],this.strm=new k,this.strm.avail_out=0;let mV=t.inflateInit2(this.strm,h.windowBits);if(mV!==q)throw new Error(A[mV]);if(this.header=new C,t.inflateGetHeader(this.strm,this.header),h.dictionary&&("string"===typeof h.dictionary?h.dictionary=N.string2buf(h.dictionary):"[object ArrayBuffer]"===K.call(h.dictionary)&&(h.dictionary=new Uint8Array(h.dictionary)),h.raw&&(mV=t.inflateSetDictionary(this.strm,h.dictionary),mV!==q)))throw new Error(A[mV])}function z(V,h){const mV=new c(h);if(mV.push(V),mV.err)throw mV.oh||A[mV.err];return mV.result}c.prototype.push=function(V,h){const mV=this.strm,L=this.options.SV,A=this.options.dictionary;let k,C,c;if(this.ended)return!1;for(C=h===~~h?h:!0===h?n:o,"[object ArrayBuffer]"===K.call(V)?mV.input=new Uint8Array(V):mV.input=V,mV.next_in=0,mV.avail_in=mV.input.length;;){for(0===mV.avail_out&&(mV.output=new Uint8Array(L),mV.next_out=0,mV.avail_out=L),k=t.inflate(mV,C),k===R&&A&&(k=t.inflateSetDictionary(mV,A),k===q?k=t.inflate(mV,C):k===s&&(k=R));mV.avail_in>0&&k===x&&mV.state.wrap>0&&0!==V[mV.next_in];)t.inflateReset(mV),k=t.inflate(mV,C);switch(k){case d:case s:case R:case M:return this.onEnd(k),this.ended=!0,!1}if(c=mV.avail_out,mV.next_out&&(0===mV.avail_out||k===x))if("string"===this.options.to){let V=N.utf8border(mV.output,mV.next_out),h=mV.next_out-V,t=N.buf2string(mV.output,V);mV.next_out=h,mV.avail_out=L-h,h&&mV.output.set(mV.output.subarray(V,V+h),0),this.onData(t)}else this.onData(mV.output.length===mV.next_out?mV.output:mV.output.subarray(0,mV.next_out));if(k!==q||0!==c){if(k===x)return k=t.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,!0;if(0===mV.avail_in)break}}return!0},c.prototype.onData=function(V){this.chunks.push(V)},c.prototype.onEnd=function(V){V===q&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=L.flattenChunks(this.chunks)),this.chunks=[],this.err=V,this.oh=this.strm.oh},V.exports.Inflate=c,V.exports.inflate=z,V.exports.inflateRaw=function(V,h){return(h=h||{}).raw=!0,z(V,h)},V.exports.ungzip=z,V.exports.constants=mV(13568)},13575:V=>{"use strict";const h=(V,h)=>Object.prototype.hasOwnProperty.call(V,h);V.exports.assign=function(V){const mV=Array.prototype.slice.call(arguments,1);for(;mV.length;){const t=mV.shift();if(t){if("object"!==typeof t)throw new TypeError(t+"must be non-object");for(const mV in t)h(t,mV)&&(V[mV]=t[mV])}}return V},V.exports.flattenChunks=V=>{let h=0;for(let t=0,L=V.length;t<L;t++)h+=V[t].length;const mV=new Uint8Array(h);for(let t=0,L=0,N=V.length;t<N;t++){let h=V[t];mV.set(h,L),L+=h.length}return mV}},13582:V=>{"use strict";let h=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){h=!1}const mV=new Uint8Array(256);for(let L=0;L<256;L++)mV[L]=L>=252?6:L>=248?5:L>=240?4:L>=224?3:L>=192?2:1;mV[254]=mV[254]=1,V.exports.string2buf=V=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(V);let h,mV,t,L,N,A=V.length,k=0;for(L=0;L<A;L++)mV=V.charCodeAt(L),55296===(64512&mV)&&L+1<A&&(t=V.charCodeAt(L+1),56320===(64512&t)&&(mV=65536+(mV-55296<<10)+(t-56320),L++)),k+=mV<128?1:mV<2048?2:mV<65536?3:4;for(h=new Uint8Array(k),N=0,L=0;N<k;L++)mV=V.charCodeAt(L),55296===(64512&mV)&&L+1<A&&(t=V.charCodeAt(L+1),56320===(64512&t)&&(mV=65536+(mV-55296<<10)+(t-56320),L++)),mV<128?h[N++]=mV:mV<2048?(h[N++]=192|mV>>>6,h[N++]=128|63&mV):mV<65536?(h[N++]=224|mV>>>12,h[N++]=128|mV>>>6&63,h[N++]=128|63&mV):(h[N++]=240|mV>>>18,h[N++]=128|mV>>>12&63,h[N++]=128|mV>>>6&63,h[N++]=128|63&mV);return h};V.exports.buf2string=(V,t)=>{const L=t||V.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(V.subarray(0,t));let N,A;const k=new Array(2*L);for(A=0,N=0;N<L;){let h=V[N++];if(h<128){k[A++]=h;continue}let t=mV[h];if(t>4)k[A++]=65533,N+=t-1;else{for(h&=2===t?31:3===t?15:7;t>1&&N<L;)h=h<<6|63&V[N++],t--;t>1?k[A++]=65533:h<65536?k[A++]=h:(h-=65536,k[A++]=55296|h>>10&1023,k[A++]=56320|1023&h)}}return((V,mV)=>{if(mV<65534&&V.subarray&&h)return String.fromCharCode.apply(null,V.length===mV?V:V.subarray(0,mV));let t="";for(let h=0;h<mV;h++)t+=String.fromCharCode(V[h]);return t})(k,A)},V.exports.utf8border=(V,h)=>{(h=h||V.length)>V.length&&(h=V.length);let t=h-1;for(;t>=0&&128===(192&V[t]);)t--;return t<0||0===t?h:t+mV[V[t]]>h?t:h}},13557:V=>{"use strict";V.exports=(V,h,mV,t)=>{let L=65535&V,N=V>>>16&65535,A=0;for(;0!==mV;){A=mV>2e3?2e3:mV,mV-=A;do{L=L+h[t++]|0,N=N+L|0}while(--A);L%=65521,N%=65521}return L|N<<16}},13568:V=>{"use strict";V.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13559:V=>{"use strict";const h=new Uint32Array((()=>{let V,h=[];for(var mV=0;mV<256;mV++){V=mV;for(var t=0;t<8;t++)V=1&V?3988292384^V>>>1:V>>>1;h[mV]=V}return h})());V.exports=(V,mV,t,L)=>{const N=h,A=L+t;V^=-1;for(let h=L;h<A;h++)V=V>>>8^N[255&(V^mV[h])];return~V}},13549:(V,h,mV)=>{"use strict";const{_tr_init:t,_tr_stored_block:L,_tr_flush_block:N,_tr_tally:A,_tr_align:k}=mV(13551),C=mV(13557),K=mV(13559),o=mV(13561),{Z_NO_FLUSH:n,Z_PARTIAL_FLUSH:q,Z_FULL_FLUSH:x,Z_FINISH:R,Z_BLOCK:d,Z_OK:s,Z_STREAM_END:M,Z_STREAM_ERROR:c,Z_DATA_ERROR:z,Z_BUF_ERROR:Q,Z_DEFAULT_COMPRESSION:J,Z_FILTERED:v,Z_HUFFMAN_ONLY:D,Z_RLE:H,Z_FIXED:j,Z_DEFAULT_STRATEGY:l,Z_UNKNOWN:G,Z_DEFLATED:y}=mV(13568),O=258,I=262,r=103,T=113,F=666,p=(V,h)=>(V.oh=o[h],h),Z=V=>(V<<1)-(V>4?9:0),f=V=>{let h=V.length;for(;--h>=0;)V[h]=0};let S=(V,h,mV)=>(h<<V.hash_shift^mV)&V.hash_mask;const Y=V=>{const h=V.state;let mV=h.pending;mV>V.avail_out&&(mV=V.avail_out),0!==mV&&(V.output.set(h.pending_buf.subarray(h.pending_out,h.pending_out+mV),V.next_out),V.next_out+=mV,h.pending_out+=mV,V.total_out+=mV,V.avail_out-=mV,h.pending-=mV,0===h.pending&&(h.pending_out=0))},w=(V,h)=>{N(V,V.block_start>=0?V.block_start:-1,V.strstart-V.block_start,h),V.block_start=V.strstart,Y(V.strm)},E=(V,h)=>{V.pending_buf[V.pending++]=h},g=(V,h)=>{V.pending_buf[V.pending++]=h>>>8&255,V.pending_buf[V.pending++]=255&h},i=(V,h,mV,t)=>{let L=V.avail_in;return L>t&&(L=t),0===L?0:(V.avail_in-=L,h.set(V.input.subarray(V.next_in,V.next_in+L),mV),1===V.state.wrap?V.adler=C(V.adler,h,L,mV):2===V.state.wrap&&(V.adler=K(V.adler,h,L,mV)),V.next_in+=L,V.total_in+=L,L)},b=(V,h)=>{let mV,t,L=V.max_chain_length,N=V.strstart,A=V.prev_length,k=V.nice_match;const C=V.strstart>V.w_size-I?V.strstart-(V.w_size-I):0,K=V.window,o=V.w_mask,n=V.prev,q=V.strstart+O;let x=K[N+A-1],R=K[N+A];V.prev_length>=V.good_match&&(L>>=2),k>V.lookahead&&(k=V.lookahead);do{if(mV=h,K[mV+A]===R&&K[mV+A-1]===x&&K[mV]===K[N]&&K[++mV]===K[N+1]){N+=2,mV++;do{}while(K[++N]===K[++mV]&&K[++N]===K[++mV]&&K[++N]===K[++mV]&&K[++N]===K[++mV]&&K[++N]===K[++mV]&&K[++N]===K[++mV]&&K[++N]===K[++mV]&&K[++N]===K[++mV]&&N<q);if(t=O-(q-N),N=q-O,t>A){if(V.match_start=h,A=t,t>=k)break;x=K[N+A-1],R=K[N+A]}}}while((h=n[h&o])>C&&0!==--L);return A<=V.lookahead?A:V.lookahead},P=V=>{const h=V.w_size;let mV,t,L,N,A;do{if(N=V.window_size-V.lookahead-V.strstart,V.strstart>=h+(h-I)){V.window.set(V.window.subarray(h,h+h),0),V.match_start-=h,V.strstart-=h,V.block_start-=h,t=V.hash_size,mV=t;do{L=V.head[--mV],V.head[mV]=L>=h?L-h:0}while(--t);t=h,mV=t;do{L=V.prev[--mV],V.prev[mV]=L>=h?L-h:0}while(--t);N+=h}if(0===V.strm.avail_in)break;if(t=i(V.strm,V.window,V.strstart+V.lookahead,N),V.lookahead+=t,V.lookahead+V.insert>=3)for(A=V.strstart-V.insert,V.ins_h=V.window[A],V.ins_h=S(V,V.ins_h,V.window[A+1]);V.insert&&(V.ins_h=S(V,V.ins_h,V.window[A+3-1]),V.prev[A&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=A,A++,V.insert--,!(V.lookahead+V.insert<3)););}while(V.lookahead<I&&0!==V.strm.avail_in)},U=(V,h)=>{let mV,t;for(;;){if(V.lookahead<I){if(P(V),V.lookahead<I&&h===n)return 1;if(0===V.lookahead)break}if(mV=0,V.lookahead>=3&&(V.ins_h=S(V,V.ins_h,V.window[V.strstart+3-1]),mV=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),0!==mV&&V.strstart-mV<=V.w_size-I&&(V.match_length=b(V,mV)),V.match_length>=3)if(t=A(V,V.strstart-V.match_start,V.match_length-3),V.lookahead-=V.match_length,V.match_length<=V.max_lazy_match&&V.lookahead>=3){V.match_length--;do{V.strstart++,V.ins_h=S(V,V.ins_h,V.window[V.strstart+3-1]),mV=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart}while(0!==--V.match_length);V.strstart++}else V.strstart+=V.match_length,V.match_length=0,V.ins_h=V.window[V.strstart],V.ins_h=S(V,V.ins_h,V.window[V.strstart+1]);else t=A(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++;if(t&&(w(V,!1),0===V.strm.avail_out))return 1}return V.insert=V.strstart<2?V.strstart:2,h===R?(w(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(w(V,!1),0===V.strm.avail_out)?1:2},u=(V,h)=>{let mV,t,L;for(;;){if(V.lookahead<I){if(P(V),V.lookahead<I&&h===n)return 1;if(0===V.lookahead)break}if(mV=0,V.lookahead>=3&&(V.ins_h=S(V,V.ins_h,V.window[V.strstart+3-1]),mV=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),V.prev_length=V.match_length,V.prev_match=V.match_start,V.match_length=2,0!==mV&&V.prev_length<V.max_lazy_match&&V.strstart-mV<=V.w_size-I&&(V.match_length=b(V,mV),V.match_length<=5&&(V.strategy===v||3===V.match_length&&V.strstart-V.match_start>4096)&&(V.match_length=2)),V.prev_length>=3&&V.match_length<=V.prev_length){L=V.strstart+V.lookahead-3,t=A(V,V.strstart-1-V.prev_match,V.prev_length-3),V.lookahead-=V.prev_length-1,V.prev_length-=2;do{++V.strstart<=L&&(V.ins_h=S(V,V.ins_h,V.window[V.strstart+3-1]),mV=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart)}while(0!==--V.prev_length);if(V.match_available=0,V.match_length=2,V.strstart++,t&&(w(V,!1),0===V.strm.avail_out))return 1}else if(V.match_available){if(t=A(V,0,V.window[V.strstart-1]),t&&w(V,!1),V.strstart++,V.lookahead--,0===V.strm.avail_out)return 1}else V.match_available=1,V.strstart++,V.lookahead--}return V.match_available&&(t=A(V,0,V.window[V.strstart-1]),V.match_available=0),V.insert=V.strstart<2?V.strstart:2,h===R?(w(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(w(V,!1),0===V.strm.avail_out)?1:2};function e(V,h,mV,t,L){this.good_length=V,this.max_lazy=h,this.nice_length=mV,this.max_chain=t,this.func=L}const W=[new e(0,0,0,0,((V,h)=>{let mV=65535;for(mV>V.pending_buf_size-5&&(mV=V.pending_buf_size-5);;){if(V.lookahead<=1){if(P(V),0===V.lookahead&&h===n)return 1;if(0===V.lookahead)break}V.strstart+=V.lookahead,V.lookahead=0;const t=V.block_start+mV;if((0===V.strstart||V.strstart>=t)&&(V.lookahead=V.strstart-t,V.strstart=t,w(V,!1),0===V.strm.avail_out))return 1;if(V.strstart-V.block_start>=V.w_size-I&&(w(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,h===R?(w(V,!0),0===V.strm.avail_out?3:4):(V.strstart>V.block_start&&(w(V,!1),V.strm.avail_out),1)})),new e(4,4,8,4,U),new e(4,5,16,8,U),new e(4,6,32,32,U),new e(4,4,16,16,u),new e(8,16,32,32,u),new e(8,16,128,128,u),new e(8,32,128,256,u),new e(32,128,258,1024,u),new e(32,258,258,4096,u)];function X(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const a=V=>{if(!V||!V.state)return p(V,c);V.total_in=V.total_out=0,V.data_type=G;const h=V.state;return h.pending=0,h.pending_out=0,h.wrap<0&&(h.wrap=-h.wrap),h.status=h.wrap?42:T,V.adler=2===h.wrap?0:1,h.last_flush=n,t(h),s},B=V=>{const h=a(V);var mV;return h===s&&((mV=V.state).window_size=2*mV.w_size,f(mV.head),mV.max_lazy_match=W[mV.level].max_lazy,mV.good_match=W[mV.level].good_length,mV.nice_match=W[mV.level].nice_length,mV.max_chain_length=W[mV.level].max_chain,mV.strstart=0,mV.block_start=0,mV.lookahead=0,mV.insert=0,mV.match_length=mV.prev_length=2,mV.match_available=0,mV.ins_h=0),h},VV=(V,h,mV,t,L,N)=>{if(!V)return c;let A=1;if(h===J&&(h=6),t<0?(A=0,t=-t):t>15&&(A=2,t-=16),L<1||L>9||mV!==y||t<8||t>15||h<0||h>9||N<0||N>j)return p(V,c);8===t&&(t=9);const k=new X;return V.state=k,k.strm=V,k.wrap=A,k.gzhead=null,k.w_bits=t,k.w_size=1<<k.w_bits,k.w_mask=k.w_size-1,k.hash_bits=L+7,k.hash_size=1<<k.hash_bits,k.hash_mask=k.hash_size-1,k.hash_shift=~~((k.hash_bits+3-1)/3),k.window=new Uint8Array(2*k.w_size),k.head=new Uint16Array(k.hash_size),k.prev=new Uint16Array(k.w_size),k.lit_bufsize=1<<L+6,k.pending_buf_size=4*k.lit_bufsize,k.pending_buf=new Uint8Array(k.pending_buf_size),k.d_buf=1*k.lit_bufsize,k.l_buf=3*k.lit_bufsize,k.level=h,k.strategy=N,k.method=mV,B(V)};V.exports.deflateInit=(V,h)=>VV(V,h,y,15,8,l),V.exports.deflateInit2=VV,V.exports.deflateReset=B,V.exports.deflateResetKeep=a,V.exports.deflateSetHeader=(V,h)=>V&&V.state?2!==V.state.wrap?c:(V.state.gzhead=h,s):c,V.exports.deflate=(V,h)=>{let mV,t;if(!V||!V.state||h>d||h<0)return V?p(V,c):c;const N=V.state;if(!V.output||!V.input&&0!==V.avail_in||N.status===F&&h!==R)return p(V,0===V.avail_out?Q:c);N.strm=V;const C=N.last_flush;if(N.last_flush=h,42===N.status)if(2===N.wrap)V.adler=0,E(N,31),E(N,139),E(N,8),N.gzhead?(E(N,(N.gzhead.text?1:0)+(N.gzhead.hcrc?2:0)+(N.gzhead.extra?4:0)+(N.gzhead.name?8:0)+(N.gzhead.comment?16:0)),E(N,255&N.gzhead.time),E(N,N.gzhead.time>>8&255),E(N,N.gzhead.time>>16&255),E(N,N.gzhead.time>>24&255),E(N,9===N.level?2:N.strategy>=D||N.level<2?4:0),E(N,255&N.gzhead.os),N.gzhead.extra&&N.gzhead.extra.length&&(E(N,255&N.gzhead.extra.length),E(N,N.gzhead.extra.length>>8&255)),N.gzhead.hcrc&&(V.adler=K(V.adler,N.pending_buf,N.pending,0)),N.gzindex=0,N.status=69):(E(N,0),E(N,0),E(N,0),E(N,0),E(N,0),E(N,9===N.level?2:N.strategy>=D||N.level<2?4:0),E(N,3),N.status=T);else{let h=y+(N.w_bits-8<<4)<<8,mV=-1;mV=N.strategy>=D||N.level<2?0:N.level<6?1:6===N.level?2:3,h|=mV<<6,0!==N.strstart&&(h|=32),h+=31-h%31,N.status=T,g(N,h),0!==N.strstart&&(g(N,V.adler>>>16),g(N,65535&V.adler)),V.adler=1}if(69===N.status)if(N.gzhead.extra){for(mV=N.pending;N.gzindex<(65535&N.gzhead.extra.length)&&(N.pending!==N.pending_buf_size||(N.gzhead.hcrc&&N.pending>mV&&(V.adler=K(V.adler,N.pending_buf,N.pending-mV,mV)),Y(V),mV=N.pending,N.pending!==N.pending_buf_size));)E(N,255&N.gzhead.extra[N.gzindex]),N.gzindex++;N.gzhead.hcrc&&N.pending>mV&&(V.adler=K(V.adler,N.pending_buf,N.pending-mV,mV)),N.gzindex===N.gzhead.extra.length&&(N.gzindex=0,N.status=73)}else N.status=73;if(73===N.status)if(N.gzhead.name){mV=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>mV&&(V.adler=K(V.adler,N.pending_buf,N.pending-mV,mV)),Y(V),mV=N.pending,N.pending===N.pending_buf_size)){t=1;break}t=N.gzindex<N.gzhead.name.length?255&N.gzhead.name.charCodeAt(N.gzindex++):0,E(N,t)}while(0!==t);N.gzhead.hcrc&&N.pending>mV&&(V.adler=K(V.adler,N.pending_buf,N.pending-mV,mV)),0===t&&(N.gzindex=0,N.status=91)}else N.status=91;if(91===N.status)if(N.gzhead.comment){mV=N.pending;do{if(N.pending===N.pending_buf_size&&(N.gzhead.hcrc&&N.pending>mV&&(V.adler=K(V.adler,N.pending_buf,N.pending-mV,mV)),Y(V),mV=N.pending,N.pending===N.pending_buf_size)){t=1;break}t=N.gzindex<N.gzhead.comment.length?255&N.gzhead.comment.charCodeAt(N.gzindex++):0,E(N,t)}while(0!==t);N.gzhead.hcrc&&N.pending>mV&&(V.adler=K(V.adler,N.pending_buf,N.pending-mV,mV)),0===t&&(N.status=r)}else N.status=r;if(N.status===r&&(N.gzhead.hcrc?(N.pending+2>N.pending_buf_size&&Y(V),N.pending+2<=N.pending_buf_size&&(E(N,255&V.adler),E(N,V.adler>>8&255),V.adler=0,N.status=T)):N.status=T),0!==N.pending){if(Y(V),0===V.avail_out)return N.last_flush=-1,s}else if(0===V.avail_in&&Z(h)<=Z(C)&&h!==R)return p(V,Q);if(N.status===F&&0!==V.avail_in)return p(V,Q);if(0!==V.avail_in||0!==N.lookahead||h!==n&&N.status!==F){let mV=N.strategy===D?((V,h)=>{let mV;for(;;){if(0===V.lookahead&&(P(V),0===V.lookahead)){if(h===n)return 1;break}if(V.match_length=0,mV=A(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,mV&&(w(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,h===R?(w(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(w(V,!1),0===V.strm.avail_out)?1:2})(N,h):N.strategy===H?((V,h)=>{let mV,t,L,N;const k=V.window;for(;;){if(V.lookahead<=O){if(P(V),V.lookahead<=O&&h===n)return 1;if(0===V.lookahead)break}if(V.match_length=0,V.lookahead>=3&&V.strstart>0&&(L=V.strstart-1,t=k[L],t===k[++L]&&t===k[++L]&&t===k[++L])){N=V.strstart+O;do{}while(t===k[++L]&&t===k[++L]&&t===k[++L]&&t===k[++L]&&t===k[++L]&&t===k[++L]&&t===k[++L]&&t===k[++L]&&L<N);V.match_length=O-(N-L),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=3?(mV=A(V,1,V.match_length-3),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(mV=A(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),mV&&(w(V,!1),0===V.strm.avail_out))return 1}return V.insert=0,h===R?(w(V,!0),0===V.strm.avail_out?3:4):V.last_lit&&(w(V,!1),0===V.strm.avail_out)?1:2})(N,h):W[N.level].func(N,h);if(3!==mV&&4!==mV||(N.status=F),1===mV||3===mV)return 0===V.avail_out&&(N.last_flush=-1),s;if(2===mV&&(h===q?k(N):h!==d&&(L(N,0,0,!1),h===x&&(f(N.head),0===N.lookahead&&(N.strstart=0,N.block_start=0,N.insert=0))),Y(V),0===V.avail_out))return N.last_flush=-1,s}return h!==R?s:N.wrap<=0?M:(2===N.wrap?(E(N,255&V.adler),E(N,V.adler>>8&255),E(N,V.adler>>16&255),E(N,V.adler>>24&255),E(N,255&V.total_in),E(N,V.total_in>>8&255),E(N,V.total_in>>16&255),E(N,V.total_in>>24&255)):(g(N,V.adler>>>16),g(N,65535&V.adler)),Y(V),N.wrap>0&&(N.wrap=-N.wrap),0!==N.pending?s:M)},V.exports.deflateEnd=V=>{if(!V||!V.state)return c;const h=V.state.status;return 42!==h&&69!==h&&73!==h&&91!==h&&h!==r&&h!==T&&h!==F?p(V,c):(V.state=null,h===T?p(V,z):s)},V.exports.deflateSetDictionary=(V,h)=>{let mV=h.length;if(!V||!V.state)return c;const t=V.state,L=t.wrap;if(2===L||1===L&&42!==t.status||t.lookahead)return c;if(1===L&&(V.adler=C(V.adler,h,mV,0)),t.wrap=0,mV>=t.w_size){0===L&&(f(t.head),t.strstart=0,t.block_start=0,t.insert=0);let V=new Uint8Array(t.w_size);V.set(h.subarray(mV-t.w_size,mV),0),h=V,mV=t.w_size}const N=V.avail_in,A=V.next_in,k=V.input;for(V.avail_in=mV,V.next_in=0,V.input=h,P(t);t.lookahead>=3;){let V=t.strstart,h=t.lookahead-2;do{t.ins_h=S(t,t.ins_h,t.window[V+3-1]),t.prev[V&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=V,V++}while(--h);t.strstart=V,t.lookahead=2,P(t)}return t.strstart+=t.lookahead,t.block_start=t.strstart,t.insert=t.lookahead,t.lookahead=0,t.match_length=t.prev_length=2,t.match_available=0,V.next_in=A,V.input=k,V.avail_in=N,t.wrap=L,s},V.exports.deflateInfo="pako deflate (from Nodeca project)"},13617:V=>{"use strict";V.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13600:V=>{"use strict";V.exports=function(V,h){let mV,t,L,N,A,k,C,K,o,n,q,x,R,d,s,M,c,z,Q,J,v,D,H,j;const l=V.state;mV=V.next_in,H=V.input,t=mV+(V.avail_in-5),L=V.next_out,j=V.output,N=L-(h-V.avail_out),A=L+(V.avail_out-257),k=l.dmax,C=l.wsize,K=l.whave,o=l.wnext,n=l.window,q=l.hold,x=l.bits,R=l.lencode,d=l.distcode,s=(1<<l.lenbits)-1,M=(1<<l.distbits)-1;V:do{x<15&&(q+=H[mV++]<<x,x+=8,q+=H[mV++]<<x,x+=8),c=R[q&s];h:for(;;){if(z=c>>>24,q>>>=z,x-=z,z=c>>>16&255,0===z)j[L++]=65535&c;else{if(!(16&z)){if(0===(64&z)){c=R[(65535&c)+(q&(1<<z)-1)];continue h}if(32&z){l.mode=12;break V}V.oh="invalid literal/length code",l.mode=30;break V}Q=65535&c,z&=15,z&&(x<z&&(q+=H[mV++]<<x,x+=8),Q+=q&(1<<z)-1,q>>>=z,x-=z),x<15&&(q+=H[mV++]<<x,x+=8,q+=H[mV++]<<x,x+=8),c=d[q&M];mV:for(;;){if(z=c>>>24,q>>>=z,x-=z,z=c>>>16&255,!(16&z)){if(0===(64&z)){c=d[(65535&c)+(q&(1<<z)-1)];continue mV}V.oh="invalid distance code",l.mode=30;break V}if(J=65535&c,z&=15,x<z&&(q+=H[mV++]<<x,x+=8,x<z&&(q+=H[mV++]<<x,x+=8)),J+=q&(1<<z)-1,J>k){V.oh="invalid distance too far back",l.mode=30;break V}if(q>>>=z,x-=z,z=L-N,J>z){if(z=J-z,z>K&&l.sane){V.oh="invalid distance too far back",l.mode=30;break V}if(v=0,D=n,0===o){if(v+=C-z,z<Q){Q-=z;do{j[L++]=n[v++]}while(--z);v=L-J,D=j}}else if(o<z){if(v+=C+o-z,z-=o,z<Q){Q-=z;do{j[L++]=n[v++]}while(--z);if(v=0,o<Q){z=o,Q-=z;do{j[L++]=n[v++]}while(--z);v=L-J,D=j}}}else if(v+=o-z,z<Q){Q-=z;do{j[L++]=n[v++]}while(--z);v=L-J,D=j}for(;Q>2;)j[L++]=D[v++],j[L++]=D[v++],j[L++]=D[v++],Q-=3;Q&&(j[L++]=D[v++],Q>1&&(j[L++]=D[v++]))}else{v=L-J;do{j[L++]=j[v++],j[L++]=j[v++],j[L++]=j[v++],Q-=3}while(Q>2);Q&&(j[L++]=j[v++],Q>1&&(j[L++]=j[v++]))}break}}break}}while(mV<t&&L<A);Q=x>>3,mV-=Q,x-=Q<<3,q&=(1<<x)-1,V.next_in=mV,V.next_out=L,V.avail_in=mV<t?t-mV+5:5-(mV-t),V.avail_out=L<A?A-L+257:257-(L-A),l.hold=q,l.bits=x}},13595:(V,h,mV)=>{"use strict";const t=mV(13557),L=mV(13559),N=mV(13600),A=mV(13608),{Z_FINISH:k,Z_BLOCK:C,Z_TREES:K,Z_OK:o,Z_STREAM_END:n,Z_NEED_DICT:q,Z_STREAM_ERROR:x,Z_DATA_ERROR:R,Z_MEM_ERROR:d,Z_BUF_ERROR:s,Z_DEFLATED:M}=mV(13568),c=12,z=30,Q=V=>(V>>>24&255)+(V>>>8&65280)+((65280&V)<<8)+((255&V)<<24);function J(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const v=V=>{if(!V||!V.state)return x;const h=V.state;return V.total_in=V.total_out=h.total=0,V.oh="",h.wrap&&(V.adler=1&h.wrap),h.mode=1,h.last=0,h.havedict=0,h.dmax=32768,h.head=null,h.hold=0,h.bits=0,h.lencode=h.lendyn=new Int32Array(852),h.distcode=h.distdyn=new Int32Array(592),h.sane=1,h.back=-1,o},D=V=>{if(!V||!V.state)return x;const h=V.state;return h.wsize=0,h.whave=0,h.wnext=0,v(V)},H=(V,h)=>{let mV;if(!V||!V.state)return x;const t=V.state;return h<0?(mV=0,h=-h):(mV=1+(h>>4),h<48&&(h&=15)),h&&(h<8||h>15)?x:(null!==t.window&&t.wbits!==h&&(t.window=null),t.wrap=mV,t.wbits=h,D(V))},j=(V,h)=>{if(!V)return x;const mV=new J;V.state=mV,mV.window=null;const t=H(V,h);return t!==o&&(V.state=null),t};let l,G,y=!0;const O=V=>{if(y){l=new Int32Array(512),G=new Int32Array(32);let h=0;for(;h<144;)V.lens[h++]=8;for(;h<256;)V.lens[h++]=9;for(;h<280;)V.lens[h++]=7;for(;h<288;)V.lens[h++]=8;for(A(1,V.lens,0,288,l,0,V.work,{bits:9}),h=0;h<32;)V.lens[h++]=5;A(2,V.lens,0,32,G,0,V.work,{bits:5}),y=!1}V.lencode=l,V.lenbits=9,V.distcode=G,V.distbits=5},I=(V,h,mV,t)=>{let L;const N=V.state;return null===N.window&&(N.wsize=1<<N.wbits,N.wnext=0,N.whave=0,N.window=new Uint8Array(N.wsize)),t>=N.wsize?(N.window.set(h.subarray(mV-N.wsize,mV),0),N.wnext=0,N.whave=N.wsize):(L=N.wsize-N.wnext,L>t&&(L=t),N.window.set(h.subarray(mV-t,mV-t+L),N.wnext),(t-=L)?(N.window.set(h.subarray(mV-t,mV),0),N.wnext=t,N.whave=N.wsize):(N.wnext+=L,N.wnext===N.wsize&&(N.wnext=0),N.whave<N.wsize&&(N.whave+=L))),0};V.exports.inflateReset=D,V.exports.inflateReset2=H,V.exports.inflateResetKeep=v,V.exports.inflateInit=V=>j(V,15),V.exports.inflateInit2=j,V.exports.inflate=(V,h)=>{let mV,J,v,D,H,j,l,G,y,r,T,F,p,Z,f,S,Y,w,E,g,i,b,P=0;const U=new Uint8Array(4);let u,e;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!V||!V.state||!V.output||!V.input&&0!==V.avail_in)return x;mV=V.state,mV.mode===c&&(mV.mode=13),H=V.next_out,v=V.output,l=V.avail_out,D=V.next_in,J=V.input,j=V.avail_in,G=mV.hold,y=mV.bits,r=j,T=l,b=o;V:for(;;)switch(mV.mode){case 1:if(0===mV.wrap){mV.mode=13;break}for(;y<16;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(2&mV.wrap&&35615===G){mV.check=0,U[0]=255&G,U[1]=G>>>8&255,mV.check=L(mV.check,U,2,0),G=0,y=0,mV.mode=2;break}if(mV.flags=0,mV.head&&(mV.head.done=!1),!(1&mV.wrap)||(((255&G)<<8)+(G>>8))%31){V.oh="incorrect header check",mV.mode=z;break}if((15&G)!==M){V.oh="unknown compression method",mV.mode=z;break}if(G>>>=4,y-=4,i=8+(15&G),0===mV.wbits)mV.wbits=i;else if(i>mV.wbits){V.oh="invalid window size",mV.mode=z;break}mV.dmax=1<<mV.wbits,V.adler=mV.check=1,mV.mode=512&G?10:c,G=0,y=0;break;case 2:for(;y<16;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(mV.flags=G,(255&mV.flags)!==M){V.oh="unknown compression method",mV.mode=z;break}if(57344&mV.flags){V.oh="unknown header flags set",mV.mode=z;break}mV.head&&(mV.head.text=G>>8&1),512&mV.flags&&(U[0]=255&G,U[1]=G>>>8&255,mV.check=L(mV.check,U,2,0)),G=0,y=0,mV.mode=3;case 3:for(;y<32;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}mV.head&&(mV.head.time=G),512&mV.flags&&(U[0]=255&G,U[1]=G>>>8&255,U[2]=G>>>16&255,U[3]=G>>>24&255,mV.check=L(mV.check,U,4,0)),G=0,y=0,mV.mode=4;case 4:for(;y<16;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}mV.head&&(mV.head.xflags=255&G,mV.head.os=G>>8),512&mV.flags&&(U[0]=255&G,U[1]=G>>>8&255,mV.check=L(mV.check,U,2,0)),G=0,y=0,mV.mode=5;case 5:if(1024&mV.flags){for(;y<16;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}mV.length=G,mV.head&&(mV.head.extra_len=G),512&mV.flags&&(U[0]=255&G,U[1]=G>>>8&255,mV.check=L(mV.check,U,2,0)),G=0,y=0}else mV.head&&(mV.head.extra=null);mV.mode=6;case 6:if(1024&mV.flags&&(F=mV.length,F>j&&(F=j),F&&(mV.head&&(i=mV.head.extra_len-mV.length,mV.head.extra||(mV.head.extra=new Uint8Array(mV.head.extra_len)),mV.head.extra.set(J.subarray(D,D+F),i)),512&mV.flags&&(mV.check=L(mV.check,J,F,D)),j-=F,D+=F,mV.length-=F),mV.length))break V;mV.length=0,mV.mode=7;case 7:if(2048&mV.flags){if(0===j)break V;F=0;do{i=J[D+F++],mV.head&&i&&mV.length<65536&&(mV.head.name+=String.fromCharCode(i))}while(i&&F<j);if(512&mV.flags&&(mV.check=L(mV.check,J,F,D)),j-=F,D+=F,i)break V}else mV.head&&(mV.head.name=null);mV.length=0,mV.mode=8;case 8:if(4096&mV.flags){if(0===j)break V;F=0;do{i=J[D+F++],mV.head&&i&&mV.length<65536&&(mV.head.comment+=String.fromCharCode(i))}while(i&&F<j);if(512&mV.flags&&(mV.check=L(mV.check,J,F,D)),j-=F,D+=F,i)break V}else mV.head&&(mV.head.comment=null);mV.mode=9;case 9:if(512&mV.flags){for(;y<16;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(G!==(65535&mV.check)){V.oh="header crc mismatch",mV.mode=z;break}G=0,y=0}mV.head&&(mV.head.hcrc=mV.flags>>9&1,mV.head.done=!0),V.adler=mV.check=0,mV.mode=c;break;case 10:for(;y<32;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}V.adler=mV.check=Q(G),G=0,y=0,mV.mode=11;case 11:if(0===mV.havedict)return V.next_out=H,V.avail_out=l,V.next_in=D,V.avail_in=j,mV.hold=G,mV.bits=y,q;V.adler=mV.check=1,mV.mode=c;case c:if(h===C||h===K)break V;case 13:if(mV.last){G>>>=7&y,y-=7&y,mV.mode=27;break}for(;y<3;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}switch(mV.last=1&G,G>>>=1,y-=1,3&G){case 0:mV.mode=14;break;case 1:if(O(mV),mV.mode=20,h===K){G>>>=2,y-=2;break V}break;case 2:mV.mode=17;break;case 3:V.oh="invalid block type",mV.mode=z}G>>>=2,y-=2;break;case 14:for(G>>>=7&y,y-=7&y;y<32;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if((65535&G)!==(G>>>16^65535)){V.oh="invalid stored block lengths",mV.mode=z;break}if(mV.length=65535&G,G=0,y=0,mV.mode=15,h===K)break V;case 15:mV.mode=16;case 16:if(F=mV.length,F){if(F>j&&(F=j),F>l&&(F=l),0===F)break V;v.set(J.subarray(D,D+F),H),j-=F,D+=F,l-=F,H+=F,mV.length-=F;break}mV.mode=c;break;case 17:for(;y<14;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(mV.nlen=257+(31&G),G>>>=5,y-=5,mV.ndist=1+(31&G),G>>>=5,y-=5,mV.ncode=4+(15&G),G>>>=4,y-=4,mV.nlen>286||mV.ndist>30){V.oh="too many length or distance symbols",mV.mode=z;break}mV.have=0,mV.mode=18;case 18:for(;mV.have<mV.ncode;){for(;y<3;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}mV.lens[W[mV.have++]]=7&G,G>>>=3,y-=3}for(;mV.have<19;)mV.lens[W[mV.have++]]=0;if(mV.lencode=mV.lendyn,mV.lenbits=7,u={bits:mV.lenbits},b=A(0,mV.lens,0,19,mV.lencode,0,mV.work,u),mV.lenbits=u.bits,b){V.oh="invalid code lengths set",mV.mode=z;break}mV.have=0,mV.mode=19;case 19:for(;mV.have<mV.nlen+mV.ndist;){for(;P=mV.lencode[G&(1<<mV.lenbits)-1],f=P>>>24,S=P>>>16&255,Y=65535&P,!(f<=y);){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(Y<16)G>>>=f,y-=f,mV.lens[mV.have++]=Y;else{if(16===Y){for(e=f+2;y<e;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(G>>>=f,y-=f,0===mV.have){V.oh="invalid bit length repeat",mV.mode=z;break}i=mV.lens[mV.have-1],F=3+(3&G),G>>>=2,y-=2}else if(17===Y){for(e=f+3;y<e;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}G>>>=f,y-=f,i=0,F=3+(7&G),G>>>=3,y-=3}else{for(e=f+7;y<e;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}G>>>=f,y-=f,i=0,F=11+(127&G),G>>>=7,y-=7}if(mV.have+F>mV.nlen+mV.ndist){V.oh="invalid bit length repeat",mV.mode=z;break}for(;F--;)mV.lens[mV.have++]=i}}if(mV.mode===z)break;if(0===mV.lens[256]){V.oh="invalid code -- missing end-of-block",mV.mode=z;break}if(mV.lenbits=9,u={bits:mV.lenbits},b=A(1,mV.lens,0,mV.nlen,mV.lencode,0,mV.work,u),mV.lenbits=u.bits,b){V.oh="invalid literal/lengths set",mV.mode=z;break}if(mV.distbits=6,mV.distcode=mV.distdyn,u={bits:mV.distbits},b=A(2,mV.lens,mV.nlen,mV.ndist,mV.distcode,0,mV.work,u),mV.distbits=u.bits,b){V.oh="invalid distances set",mV.mode=z;break}if(mV.mode=20,h===K)break V;case 20:mV.mode=21;case 21:if(j>=6&&l>=258){V.next_out=H,V.avail_out=l,V.next_in=D,V.avail_in=j,mV.hold=G,mV.bits=y,N(V,T),H=V.next_out,v=V.output,l=V.avail_out,D=V.next_in,J=V.input,j=V.avail_in,G=mV.hold,y=mV.bits,mV.mode===c&&(mV.back=-1);break}for(mV.back=0;P=mV.lencode[G&(1<<mV.lenbits)-1],f=P>>>24,S=P>>>16&255,Y=65535&P,!(f<=y);){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(S&&0===(240&S)){for(w=f,E=S,g=Y;P=mV.lencode[g+((G&(1<<w+E)-1)>>w)],f=P>>>24,S=P>>>16&255,Y=65535&P,!(w+f<=y);){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}G>>>=w,y-=w,mV.back+=w}if(G>>>=f,y-=f,mV.back+=f,mV.length=Y,0===S){mV.mode=26;break}if(32&S){mV.back=-1,mV.mode=c;break}if(64&S){V.oh="invalid literal/length code",mV.mode=z;break}mV.extra=15&S,mV.mode=22;case 22:if(mV.extra){for(e=mV.extra;y<e;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}mV.length+=G&(1<<mV.extra)-1,G>>>=mV.extra,y-=mV.extra,mV.back+=mV.extra}mV.was=mV.length,mV.mode=23;case 23:for(;P=mV.distcode[G&(1<<mV.distbits)-1],f=P>>>24,S=P>>>16&255,Y=65535&P,!(f<=y);){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(0===(240&S)){for(w=f,E=S,g=Y;P=mV.distcode[g+((G&(1<<w+E)-1)>>w)],f=P>>>24,S=P>>>16&255,Y=65535&P,!(w+f<=y);){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}G>>>=w,y-=w,mV.back+=w}if(G>>>=f,y-=f,mV.back+=f,64&S){V.oh="invalid distance code",mV.mode=z;break}mV.offset=Y,mV.extra=15&S,mV.mode=24;case 24:if(mV.extra){for(e=mV.extra;y<e;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}mV.offset+=G&(1<<mV.extra)-1,G>>>=mV.extra,y-=mV.extra,mV.back+=mV.extra}if(mV.offset>mV.dmax){V.oh="invalid distance too far back",mV.mode=z;break}mV.mode=25;case 25:if(0===l)break V;if(F=T-l,mV.offset>F){if(F=mV.offset-F,F>mV.whave&&mV.sane){V.oh="invalid distance too far back",mV.mode=z;break}F>mV.wnext?(F-=mV.wnext,p=mV.wsize-F):p=mV.wnext-F,F>mV.length&&(F=mV.length),Z=mV.window}else Z=v,p=H-mV.offset,F=mV.length;F>l&&(F=l),l-=F,mV.length-=F;do{v[H++]=Z[p++]}while(--F);0===mV.length&&(mV.mode=21);break;case 26:if(0===l)break V;v[H++]=mV.length,l--,mV.mode=21;break;case 27:if(mV.wrap){for(;y<32;){if(0===j)break V;j--,G|=J[D++]<<y,y+=8}if(T-=l,V.total_out+=T,mV.total+=T,T&&(V.adler=mV.check=mV.flags?L(mV.check,v,T,H-T):t(mV.check,v,T,H-T)),T=l,(mV.flags?G:Q(G))!==mV.check){V.oh="incorrect data check",mV.mode=z;break}G=0,y=0}mV.mode=28;case 28:if(mV.wrap&&mV.flags){for(;y<32;){if(0===j)break V;j--,G+=J[D++]<<y,y+=8}if(G!==(4294967295&mV.total)){V.oh="incorrect length check",mV.mode=z;break}G=0,y=0}mV.mode=29;case 29:b=n;break V;case z:b=R;break V;case 31:return d;default:return x}return V.next_out=H,V.avail_out=l,V.next_in=D,V.avail_in=j,mV.hold=G,mV.bits=y,(mV.wsize||T!==V.avail_out&&mV.mode<z&&(mV.mode<27||h!==k))&&I(V,V.output,V.next_out,T-V.avail_out)?(mV.mode=31,d):(r-=V.avail_in,T-=V.avail_out,V.total_in+=r,V.total_out+=T,mV.total+=T,mV.wrap&&T&&(V.adler=mV.check=mV.flags?L(mV.check,v,T,V.next_out-T):t(mV.check,v,T,V.next_out-T)),V.data_type=mV.bits+(mV.last?64:0)+(mV.mode===c?128:0)+(20===mV.mode||15===mV.mode?256:0),(0===r&&0===T||h===k)&&b===o&&(b=s),b)},V.exports.inflateEnd=V=>{if(!V||!V.state)return x;let h=V.state;return h.window&&(h.window=null),V.state=null,o},V.exports.inflateGetHeader=(V,h)=>{if(!V||!V.state)return x;const mV=V.state;return 0===(2&mV.wrap)?x:(mV.head=h,h.done=!1,o)},V.exports.inflateSetDictionary=(V,h)=>{const mV=h.length;let L,N,A;return V&&V.state?(L=V.state,0!==L.wrap&&11!==L.mode?x:11===L.mode&&(N=1,N=t(N,h,mV,0),N!==L.check)?R:(A=I(V,h,mV,mV),A?(L.mode=31,d):(L.havedict=1,o))):x},V.exports.inflateInfo="pako inflate (from Nodeca project)"},13608:V=>{"use strict";const h=15,mV=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),t=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),L=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),N=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);V.exports=(V,A,k,C,K,o,n,q)=>{const x=q.bits;let R,d,s,M,c,z,Q=0,J=0,v=0,D=0,H=0,j=0,l=0,G=0,y=0,O=0,I=null,r=0;const T=new Uint16Array(16),F=new Uint16Array(16);let p,Z,f,S=null,Y=0;for(Q=0;Q<=h;Q++)T[Q]=0;for(J=0;J<C;J++)T[A[k+J]]++;for(H=x,D=h;D>=1&&0===T[D];D--);if(H>D&&(H=D),0===D)return K[o++]=20971520,K[o++]=20971520,q.bits=1,0;for(v=1;v<D&&0===T[v];v++);for(H<v&&(H=v),G=1,Q=1;Q<=h;Q++)if(G<<=1,G-=T[Q],G<0)return-1;if(G>0&&(0===V||1!==D))return-1;for(F[1]=0,Q=1;Q<h;Q++)F[Q+1]=F[Q]+T[Q];for(J=0;J<C;J++)0!==A[k+J]&&(n[F[A[k+J]]++]=J);if(0===V?(I=S=n,z=19):1===V?(I=mV,r-=257,S=t,Y-=257,z=256):(I=L,S=N,z=-1),O=0,J=0,Q=v,c=o,j=H,l=0,s=-1,y=1<<H,M=y-1,1===V&&y>852||2===V&&y>592)return 1;for(;;){p=Q-l,n[J]<z?(Z=0,f=n[J]):n[J]>z?(Z=S[Y+n[J]],f=I[r+n[J]]):(Z=96,f=0),R=1<<Q-l,d=1<<j,v=d;do{d-=R,K[c+(O>>l)+d]=p<<24|Z<<16|f}while(0!==d);for(R=1<<Q-1;O&R;)R>>=1;if(0!==R?(O&=R-1,O+=R):O=0,J++,0===--T[Q]){if(Q===D)break;Q=A[k+n[J]]}if(Q>H&&(O&M)!==s){for(0===l&&(l=H),c+=v,j=Q-l,G=1<<j;j+l<D&&(G-=T[j+l],!(G<=0));)j++,G<<=1;if(y+=1<<j,1===V&&y>852||2===V&&y>592)return 1;s=O&M,K[s]=H<<24|j<<16|c-o}}return 0!==O&&(K[c+O]=Q-l<<24|64<<16),q.bits=H,0}},13561:V=>{"use strict";V.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13551:V=>{"use strict";function h(V){let h=V.length;for(;--h>=0;)V[h]=0}const mV=256,t=286,L=30,N=15,A=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),k=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),K=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Array(576);h(o);const n=new Array(60);h(n);const q=new Array(512);h(q);const x=new Array(256);h(x);const R=new Array(29);h(R);const d=new Array(L);function s(V,h,mV,t,L){this.static_tree=V,this.extra_bits=h,this.extra_base=mV,this.elems=t,this.max_length=L,this.has_stree=V&&V.length}let M,c,z;function Q(V,h){this.dyn_tree=V,this.max_code=0,this.stat_desc=h}h(d);const J=V=>V<256?q[V]:q[256+(V>>>7)],v=(V,h)=>{V.pending_buf[V.pending++]=255&h,V.pending_buf[V.pending++]=h>>>8&255},D=(V,h,mV)=>{V.bi_valid>16-mV?(V.bi_buf|=h<<V.bi_valid&65535,v(V,V.bi_buf),V.bi_buf=h>>16-V.bi_valid,V.bi_valid+=mV-16):(V.bi_buf|=h<<V.bi_valid&65535,V.bi_valid+=mV)},H=(V,h,mV)=>{D(V,mV[2*h],mV[2*h+1])},j=(V,h)=>{let mV=0;do{mV|=1&V,V>>>=1,mV<<=1}while(--h>0);return mV>>>1},l=(V,h,mV)=>{const t=new Array(16);let L,A,k=0;for(L=1;L<=N;L++)t[L]=k=k+mV[L-1]<<1;for(A=0;A<=h;A++){let h=V[2*A+1];0!==h&&(V[2*A]=j(t[h]++,h))}},G=V=>{let h;for(h=0;h<t;h++)V.dyn_ltree[2*h]=0;for(h=0;h<L;h++)V.dyn_dtree[2*h]=0;for(h=0;h<19;h++)V.bl_tree[2*h]=0;V.dyn_ltree[512]=1,V.opt_len=V.static_len=0,V.last_lit=V.matches=0},y=V=>{V.bi_valid>8?v(V,V.bi_buf):V.bi_valid>0&&(V.pending_buf[V.pending++]=V.bi_buf),V.bi_buf=0,V.bi_valid=0},O=(V,h,mV,t)=>{const L=2*h,N=2*mV;return V[L]<V[N]||V[L]===V[N]&&t[h]<=t[mV]},I=(V,h,mV)=>{const t=V.heap[mV];let L=mV<<1;for(;L<=V.heap_len&&(L<V.heap_len&&O(h,V.heap[L+1],V.heap[L],V.depth)&&L++,!O(h,t,V.heap[L],V.depth));)V.heap[mV]=V.heap[L],mV=L,L<<=1;V.heap[mV]=t},r=(V,h,t)=>{let L,N,C,K,o=0;if(0!==V.last_lit)do{L=V.pending_buf[V.d_buf+2*o]<<8|V.pending_buf[V.d_buf+2*o+1],N=V.pending_buf[V.l_buf+o],o++,0===L?H(V,N,h):(C=x[N],H(V,C+mV+1,h),K=A[C],0!==K&&(N-=R[C],D(V,N,K)),L--,C=J(L),H(V,C,t),K=k[C],0!==K&&(L-=d[C],D(V,L,K)))}while(o<V.last_lit);H(V,256,h)},T=(V,h)=>{const mV=h.dyn_tree,t=h.stat_desc.static_tree,L=h.stat_desc.has_stree,A=h.stat_desc.elems;let k,C,K,o=-1;for(V.heap_len=0,V.heap_max=573,k=0;k<A;k++)0!==mV[2*k]?(V.heap[++V.heap_len]=o=k,V.depth[k]=0):mV[2*k+1]=0;for(;V.heap_len<2;)K=V.heap[++V.heap_len]=o<2?++o:0,mV[2*K]=1,V.depth[K]=0,V.opt_len--,L&&(V.static_len-=t[2*K+1]);for(h.max_code=o,k=V.heap_len>>1;k>=1;k--)I(V,mV,k);K=A;do{k=V.heap[1],V.heap[1]=V.heap[V.heap_len--],I(V,mV,1),C=V.heap[1],V.heap[--V.heap_max]=k,V.heap[--V.heap_max]=C,mV[2*K]=mV[2*k]+mV[2*C],V.depth[K]=(V.depth[k]>=V.depth[C]?V.depth[k]:V.depth[C])+1,mV[2*k+1]=mV[2*C+1]=K,V.heap[1]=K++,I(V,mV,1)}while(V.heap_len>=2);V.heap[--V.heap_max]=V.heap[1],((V,h)=>{const mV=h.dyn_tree,t=h.max_code,L=h.stat_desc.static_tree,A=h.stat_desc.has_stree,k=h.stat_desc.extra_bits,C=h.stat_desc.extra_base,K=h.stat_desc.max_length;let o,n,q,x,R,d,s=0;for(x=0;x<=N;x++)V.bl_count[x]=0;for(mV[2*V.heap[V.heap_max]+1]=0,o=V.heap_max+1;o<573;o++)n=V.heap[o],x=mV[2*mV[2*n+1]+1]+1,x>K&&(x=K,s++),mV[2*n+1]=x,n>t||(V.bl_count[x]++,R=0,n>=C&&(R=k[n-C]),d=mV[2*n],V.opt_len+=d*(x+R),A&&(V.static_len+=d*(L[2*n+1]+R)));if(0!==s){do{for(x=K-1;0===V.bl_count[x];)x--;V.bl_count[x]--,V.bl_count[x+1]+=2,V.bl_count[K]--,s-=2}while(s>0);for(x=K;0!==x;x--)for(n=V.bl_count[x];0!==n;)q=V.heap[--o],q>t||(mV[2*q+1]!==x&&(V.opt_len+=(x-mV[2*q+1])*mV[2*q],mV[2*q+1]=x),n--)}})(V,h),l(mV,o,V.bl_count)},F=(V,h,mV)=>{let t,L,N=-1,A=h[1],k=0,C=7,K=4;for(0===A&&(C=138,K=3),h[2*(mV+1)+1]=65535,t=0;t<=mV;t++)L=A,A=h[2*(t+1)+1],++k<C&&L===A||(k<K?V.bl_tree[2*L]+=k:0!==L?(L!==N&&V.bl_tree[2*L]++,V.bl_tree[32]++):k<=10?V.bl_tree[34]++:V.bl_tree[36]++,k=0,N=L,0===A?(C=138,K=3):L===A?(C=6,K=3):(C=7,K=4))},p=(V,h,mV)=>{let t,L,N=-1,A=h[1],k=0,C=7,K=4;for(0===A&&(C=138,K=3),t=0;t<=mV;t++)if(L=A,A=h[2*(t+1)+1],!(++k<C&&L===A)){if(k<K)do{H(V,L,V.bl_tree)}while(0!==--k);else 0!==L?(L!==N&&(H(V,L,V.bl_tree),k--),H(V,16,V.bl_tree),D(V,k-3,2)):k<=10?(H(V,17,V.bl_tree),D(V,k-3,3)):(H(V,18,V.bl_tree),D(V,k-11,7));k=0,N=L,0===A?(C=138,K=3):L===A?(C=6,K=3):(C=7,K=4)}};let Z=!1;const f=(V,h,mV,t)=>{D(V,0+(t?1:0),3),((V,h,mV,t)=>{y(V),t&&(v(V,mV),v(V,~mV)),V.pending_buf.set(V.window.subarray(h,h+mV),V.pending),V.pending+=mV})(V,h,mV,!0)};V.exports._tr_init=V=>{Z||((()=>{let V,h,mV,K,Q;const J=new Array(16);for(mV=0,K=0;K<28;K++)for(R[K]=mV,V=0;V<1<<A[K];V++)x[mV++]=K;for(x[mV-1]=K,Q=0,K=0;K<16;K++)for(d[K]=Q,V=0;V<1<<k[K];V++)q[Q++]=K;for(Q>>=7;K<L;K++)for(d[K]=Q<<7,V=0;V<1<<k[K]-7;V++)q[256+Q++]=K;for(h=0;h<=N;h++)J[h]=0;for(V=0;V<=143;)o[2*V+1]=8,V++,J[8]++;for(;V<=255;)o[2*V+1]=9,V++,J[9]++;for(;V<=279;)o[2*V+1]=7,V++,J[7]++;for(;V<=287;)o[2*V+1]=8,V++,J[8]++;for(l(o,287,J),V=0;V<L;V++)n[2*V+1]=5,n[2*V]=j(V,5);M=new s(o,A,257,t,N),c=new s(n,k,0,L,N),z=new s(new Array(0),C,0,19,7)})(),Z=!0),V.l_desc=new Q(V.dyn_ltree,M),V.d_desc=new Q(V.dyn_dtree,c),V.bl_desc=new Q(V.bl_tree,z),V.bi_buf=0,V.bi_valid=0,G(V)},V.exports._tr_stored_block=f,V.exports._tr_flush_block=(V,h,t,L)=>{let N,A,k=0;V.level>0?(2===V.strm.data_type&&(V.strm.data_type=(V=>{let h,t=4093624447;for(h=0;h<=31;h++,t>>>=1)if(1&t&&0!==V.dyn_ltree[2*h])return 0;if(0!==V.dyn_ltree[18]||0!==V.dyn_ltree[20]||0!==V.dyn_ltree[26])return 1;for(h=32;h<mV;h++)if(0!==V.dyn_ltree[2*h])return 1;return 0})(V)),T(V,V.l_desc),T(V,V.d_desc),k=(V=>{let h;for(F(V,V.dyn_ltree,V.l_desc.max_code),F(V,V.dyn_dtree,V.d_desc.max_code),T(V,V.bl_desc),h=18;h>=3&&0===V.bl_tree[2*K[h]+1];h--);return V.opt_len+=3*(h+1)+5+5+4,h})(V),N=V.opt_len+3+7>>>3,A=V.static_len+3+7>>>3,A<=N&&(N=A)):N=A=t+5,t+4<=N&&-1!==h?f(V,h,t,L):4===V.strategy||A===N?(D(V,2+(L?1:0),3),r(V,o,n)):(D(V,4+(L?1:0),3),((V,h,mV,t)=>{let L;for(D(V,h-257,5),D(V,mV-1,5),D(V,t-4,4),L=0;L<t;L++)D(V,V.bl_tree[2*K[L]+1],3);p(V,V.dyn_ltree,h-1),p(V,V.dyn_dtree,mV-1)})(V,V.l_desc.max_code+1,V.d_desc.max_code+1,k+1),r(V,V.dyn_ltree,V.dyn_dtree)),G(V),L&&y(V)},V.exports._tr_tally=(V,h,t)=>(V.pending_buf[V.d_buf+2*V.last_lit]=h>>>8&255,V.pending_buf[V.d_buf+2*V.last_lit+1]=255&h,V.pending_buf[V.l_buf+V.last_lit]=255&t,V.last_lit++,0===h?V.dyn_ltree[2*t]++:(V.matches++,h--,V.dyn_ltree[2*(x[t]+mV+1)]++,V.dyn_dtree[2*J(h)]++),V.last_lit===V.lit_bufsize-1),V.exports._tr_align=V=>{D(V,2,3),H(V,256,o),(V=>{16===V.bi_valid?(v(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):V.bi_valid>=8&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)})(V)}},13589:V=>{"use strict";V.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.oh="",this.state=null,this.data_type=2,this.adler=0}},13199:V=>{function h(V,h,mV){for(var t=V.length,L=-1/0,N=1/0,A=0;A<t;A++){var k=(mV[0][A]-V[A])/h[A],C=(mV[1][A]-V[A])/h[A];if(k>C){var K=k;k=C,C=K}if(C<L||k>N)return 1/0;k>L&&(L=k),C<N&&(N=C)}return L>N?1/0:L}V.exports=function(V,mV,t,L){var N=h(mV,t,L);if(N===1/0)V=null;else{V=V||[];for(var A=0;A<mV.length;A++)V[A]=mV[A]+t[A]*N}return V},V.exports.distance=h},14546:(V,h,mV)=>{"use strict";mV.d(h,{c:()=>A});var t=mV(30);const L=t.useLayoutEffect;const N=function(V){var h=(0,t.useRef)(V);return L((function(){h.current=V})),h};var A=function(V){var h=N(V);(0,t.kh)((function(){var V=function(V){var mV;if(null!=h.current&&(mV=h.current(V)),V.defaultPrevented&&(V.returnValue=""),"string"===typeof mV)return V.returnValue=mV,mV};return window.addEventListener("beforeunload",V),function(){window.removeEventListener("beforeunload",V)}}),[])}},14512:(V,h,mV)=>{"use strict";var t=mV(14515),L=Array.prototype.concat,N=Array.prototype.slice,A=V.exports=function(V){for(var h=[],mV=0,A=V.length;mV<A;mV++){var k=V[mV];t(k)?h=L.call(h,N.call(k)):h.push(k)}return h};A.wrap=function(V){return function(){return V(A(arguments))}}},14515:V=>{V.exports=function(V){return!(!V||"string"===typeof V)&&(V instanceof Array||Array.isArray(V)||V.length>=0&&(V.splice instanceof Function||Object.getOwnPropertyDescriptor(V,V.length-1)&&"String"!==V.constructor.name))}},13501:(V,h,mV)=>{var t=mV(13509);function L(V){for(var h,mV,L=0,N=V.length,A=0;A<V.length;){for(h=V[A],mV=0;A<N&&V[A]===h;)++A,++mV;L+=t.log2(mV)/7|0,L+=t.log2(h>>>0)/7|0,L+=2}return L}h.size=L,h.encode=function(V,h){h||(h=new Uint8Array(L(V)));for(var mV,t,N=0,A=h.length,k=0;k<V.length;){for(mV=V[k],t=0;k<V.length&&V[k]===mV;)++k,++t;for(;N<A&&t>=128;)h[N++]=128+(127&t),t>>>=7;if(N>=A)throw new Error("RLE buffer overflow");for(h[N++]=t,mV>>>=0;N<A&&mV>=128;)h[N++]=128+(127&mV),mV>>>=7;if(N>=A)throw new Error("RLE buffer overflow");h[N++]=mV}return h},h.decode=function(V,h){for(var mV,t,L,N,A=h.length,k=V.length,C=0,K=0;K<k;){for(mV=0,t=0;K<k&&V[K]>=128;)mV+=(127&V[K++])<<t,t+=7;if(mV+=V[K++]<<t,K>=k)throw new Error("RLE buffer underrun");if(C+mV>A)throw new Error("Chunk buffer overflow");for(L=0,t=0;K<k&&V[K]>=128;)L+=(127&V[K++])<<t,t+=7;if(K>=k)throw new Error("RLE buffer underrun");for(L+=V[K++]<<t,N=0;N<mV;++N)h[C++]=L}return h}},13509:(V,h)=>{"use strict";function mV(V){var h=32;return(V&=-V)&&h--,65535&V&&(h-=16),16711935&V&&(h-=8),252645135&V&&(h-=4),858993459&V&&(h-=2),1431655765&V&&(h-=1),h}h.INT_BITS=32,h.INT_MAX=2147483647,h.INT_MIN=-1<<31,h.sign=function(V){return(V>0)-(V<0)},h.abs=function(V){var h=V>>31;return(V^h)-h},h.min=function(V,h){return h^(V^h)&-(V<h)},h.max=function(V,h){return V^(V^h)&-(V<h)},h.isPow2=function(V){return!(V&V-1)&&!!V},h.log2=function(V){var h,mV;return h=(V>65535)<<4,h|=mV=((V>>>=h)>255)<<3,h|=mV=((V>>>=mV)>15)<<2,(h|=mV=((V>>>=mV)>3)<<1)|(V>>>=mV)>>1},h.log10=function(V){return V>=1e9?9:V>=1e8?8:V>=1e7?7:V>=1e6?6:V>=1e5?5:V>=1e4?4:V>=1e3?3:V>=100?2:V>=10?1:0},h.popCount=function(V){return 16843009*((V=(858993459&(V-=V>>>1&1431655765))+(V>>>2&858993459))+(V>>>4)&252645135)>>>24},h.countTrailingZeros=mV,h.nextPow2=function(V){return V+=0===V,--V,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)+1},h.prevPow2=function(V){return V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,(V|=V>>>16)-(V>>>1)},h.parity=function(V){return V^=V>>>16,V^=V>>>8,V^=V>>>4,27030>>>(V&=15)&1};var t=new Array(256);!function(V){for(var h=0;h<256;++h){var mV=h,t=h,L=7;for(mV>>>=1;mV;mV>>>=1)t<<=1,t|=1&mV,--L;V[h]=t<<L&255}}(t),h.reverse=function(V){return t[255&V]<<24|t[V>>>8&255]<<16|t[V>>>16&255]<<8|t[V>>>24&255]},h.interleave2=function(V,h){return(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V&=65535)|V<<8))|V<<4))|V<<2))|V<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h&=65535)|h<<8))|h<<4))|h<<2))|h<<1))<<1},h.deinterleave2=function(V,h){return(V=65535&((V=16711935&((V=252645135&((V=858993459&((V=V>>>h&1431655765)|V>>>1))|V>>>2))|V>>>4))|V>>>16))<<16>>16},h.interleave3=function(V,h,mV){return V=1227133513&((V=3272356035&((V=251719695&((V=4278190335&((V&=1023)|V<<16))|V<<8))|V<<4))|V<<2),(V|=(h=1227133513&((h=3272356035&((h=251719695&((h=4278190335&((h&=1023)|h<<16))|h<<8))|h<<4))|h<<2))<<1)|(mV=1227133513&((mV=3272356035&((mV=251719695&((mV=4278190335&((mV&=1023)|mV<<16))|mV<<8))|mV<<4))|mV<<2))<<2},h.deinterleave3=function(V,h){return(V=1023&((V=4278190335&((V=251719695&((V=3272356035&((V=V>>>h&1227133513)|V>>>2))|V>>>4))|V>>>8))|V>>>16))<<22>>22},h.nextCombination=function(V){var h=V|V-1;return h+1|(~h&-~h)-1>>>mV(V)+1}},13532:V=>{"use strict";V.exports=function(V,h,mV,t){var L=self||window;try{try{var N;try{N=new L.Blob([V])}catch(K){(N=new(L.BlobBuilder||L.WebKitBlobBuilder||L.MozBlobBuilder||L.MSBlobBuilder)).append(V),N=N.getBlob()}var A=L.URL||L.webkitURL,k=A.createObjectURL(N),C=new L[h](k,mV);return A.revokeObjectURL(k),C}catch(K){return new L[h]("data:application/javascript,".concat(encodeURIComponent(V)),mV)}}catch(K){if(!t)throw Error("Inline worker is not supported");return new L[h](t,mV)}}},13189:(V,h,mV)=>{"use strict";function t(V,h,mV,t,L){var N={};return Object.keys(t).forEach((function(V){N[V]=t[V]})),N.enumerable=!!N.enumerable,N.configurable=!!N.configurable,("value"in N||N.initializer)&&(N.writable=!0),N=mV.slice().reverse().reduce((function(mV,t){return t(V,h,mV)||mV}),N),L&&void 0!==N.initializer&&(N.value=N.initializer?N.initializer.call(L):void 0,N.initializer=void 0),void 0===N.initializer&&(Object.defineProperty(V,h,N),N=null),N}mV.d(h,{c:()=>t})},13180:(V,h,mV)=>{"use strict";function t(V,h,mV,t){mV&&Object.defineProperty(V,h,{enumerable:mV.enumerable,configurable:mV.configurable,writable:mV.writable,value:mV.initializer?mV.initializer.call(t):void 0})}mV.d(h,{c:()=>t})},14542:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>A,f:()=>n,i:()=>k,m:()=>N,o:()=>C,r:()=>L,v:()=>K,x:()=>o});var t=mV(12615);class L{constructor(){this._easingMode=L.EASINGMODE_EASEIN}setEasingMode(V){const h=Math.min(Math.max(V,0),2);this._easingMode=h}getEasingMode(){return this._easingMode}easeInCore(V){throw new Error("You must implement this method")}ease(V){switch(this._easingMode){case L.EASINGMODE_EASEIN:return this.easeInCore(V);case L.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-V)}return V>=.5?.5*(1-this.easeInCore(2*(1-V)))+.5:.5*this.easeInCore(2*V)}}L.EASINGMODE_EASEIN=0,L.EASINGMODE_EASEOUT=1,L.EASINGMODE_EASEINOUT=2;class N extends L{easeInCore(V){return V=Math.max(0,Math.min(1,V)),1-Math.sqrt(1-V*V)}}class A extends L{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=V}easeInCore(V){const h=Math.max(0,this.amplitude);return Math.pow(V,3)-V*h*Math.sin(3.141592653589793*V)}}class k extends L{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=V,this.bounciness=h}easeInCore(V){const h=Math.max(0,this.bounces);let mV=this.bounciness;mV<=1&&(mV=1.001);const t=Math.pow(mV,h),L=1-mV,N=(1-t)/L+.5*t,A=V*N,k=Math.log(-A*(1-mV)+1)/Math.log(mV),C=Math.floor(k),K=C+1,o=(1-Math.pow(mV,C))/(L*N),n=.5*(o+(1-Math.pow(mV,K))/(L*N)),q=V-n,x=n-o;return-Math.pow(1/mV,h-C)/(x*x)*(q-x)*(q+x)}}class C extends L{easeInCore(V){return V*V*V}}class K extends L{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=V,this.springiness=h}easeInCore(V){let h;const mV=Math.max(0,this.oscillations),t=Math.max(0,this.springiness);return h=0==t?V:(Math.exp(t*V)-1)/(Math.exp(t)-1),h*Math.sin((6.283185307179586*mV+1.5707963267948966)*V)}}class o extends L{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=V}easeInCore(V){return this.exponent<=0?V:(Math.exp(this.exponent*V)-1)/(Math.exp(this.exponent)-1)}}class n extends L{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=V,this.y1=h,this.x2=mV,this.y2=t}easeInCore(V){return t.e.Interpolate(V,this.x1,this.y1,this.x2,this.y2)}}},14044:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>A});var t=mV(12422),L=mV(12433),N=mV(12809);class A extends N.d{get _matrix(){return this._compose(),this.lq}set _matrix(V){(V.updateFlag!==this.lq.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.lq.t(V),this._markAsDirtyAndDecompose())}constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(V,h.DV(),!1),this.name=V,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=h,this.lq=(null===L||void 0===L?void 0:L.clone())??t.Matrix.Identity(),this._restMatrix=N??this.lq.clone(),this._bindMatrix=A??this.lq.clone(),this._index=k,this._absoluteMatrix=new t.Matrix,this._absoluteBindMatrix=new t.Matrix,this._absoluteInverseBindMatrix=new t.Matrix,this._finalMatrix=new t.Matrix,h.bones.push(this),this.setParent(mV,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(V){this.setParent(V)}setParent(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==V){if(this.parent){const V=this.parent.children.indexOf(this);-1!==V&&this.parent.children.splice(V,1)}this._parentNode=V,this.parent&&this.parent.children.push(this),h&&this._updateAbsoluteBindMatrices(),this.UK()}}getLocalMatrix(){return this._compose(),this.lq}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(V){this._restMatrix.t(V)}setRestPose(V){this.setRestMatrix(V)}getBindPose(){return this.getBindMatrix()}setBindMatrix(V){this.zk(V)}setBindPose(V){this.setBindMatrix(V)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const V=t.TmpVectors.sh[0],h=t.TmpVectors.Quaternion[0],mV=t.TmpVectors.sh[1];this.getRestMatrix().decompose(V,h,mV),this._linkedTransformNode.position.t(mV),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??t.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.t(h),this._linkedTransformNode.jk.t(V)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(V){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=V,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Xk}set position(V){this._decompose(),this.Xk.t(V),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(V){this.setRotation(V)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(V){this.setRotationQuaternion(V)}get jk(){return this.getScale()}set jk(V){this.setScale(V)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=t.sh.Zero(),this._localRotation=t.Quaternion.Zero(),this.Xk=t.sh.Zero()),this.lq.decompose(this._localScaling,this._localRotation,this.Xk))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,t.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Xk,this.lq)):this._needToCompose=!1)}zk(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],mV=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.t(V),h&&this._updateAbsoluteBindMatrices(),mV?this._matrix=V:this.UK()}_updateAbsoluteBindMatrices(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(V||(V=this._bindMatrix),this.parent?V.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.t(V),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),h)for(let mV=0;mV<this.children.length;mV++)this.children[mV]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}UK(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.UK(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.UK(),this._needToDecompose=!0}_updatePosition(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0,L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=this.getLocalMatrix();if(0==h)L?(N.addAtIndex(12,V.x),N.addAtIndex(13,V.y),N.addAtIndex(14,V.z)):N.setTranslationFromFloats(V.x,V.y,V.z);else{let h=null;mV&&(h=mV.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const k=A._TmpMats[0],C=A._TmpVecs[0];this.parent?mV&&h?(k.t(this.parent.getAbsoluteMatrix()),k.multiplyToRef(h,k)):k.t(this.parent.getAbsoluteMatrix()):t.Matrix.IdentityToRef(k),L&&k.setTranslationFromFloats(0,0,0),k.invert(),t.sh.TransformCoordinatesToRef(V,k,C),L?(N.addAtIndex(12,C.x),N.addAtIndex(13,C.y),N.addAtIndex(14,C.z)):N.setTranslationFromFloats(C.x,C.y,C.z)}this._markAsDirtyAndDecompose()}translate(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,h,mV,!0)}setPosition(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0;this._updatePosition(V,h,mV,!1)}setAbsolutePosition(V,h){this.setPosition(V,1,h)}scale(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.getLocalMatrix(),k=A._TmpMats[0];t.Matrix.ScalingToRef(V,h,mV,k),k.multiplyToRef(N,N),k.invert();for(const t of this.children){const L=t.getLocalMatrix();L.multiplyToRef(k,L),L.multiplyAtIndex(12,V),L.multiplyAtIndex(13,h),L.multiplyAtIndex(14,mV),t._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),L)for(const t of this.children)t.scale(V,h,mV,L)}setScale(V){this._decompose(),this._localScaling.t(V),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(V){this._decompose(),V.t(this._localScaling)}setYawPitchRoll(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4?arguments[4]:void 0;if(0===L){const k=A._TmpQuat;return t.Quaternion.RotationYawPitchRollToRef(V,h,mV,k),void this.setRotationQuaternion(k,L,N)}const k=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,N))return;const C=A._TmpMats[1];t.Matrix.RotationYawPitchRollToRef(V,h,mV,C),k.multiplyToRef(C,C),this._rotateWithMatrix(C,L,N)}rotate(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3?arguments[3]:void 0;const N=A._TmpMats[0];N.setTranslationFromFloats(0,0,0),t.Matrix.RotationAxisToRef(V,h,N),this._rotateWithMatrix(N,mV,L)}setAxisAngle(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3?arguments[3]:void 0;if(0===mV){const N=A._TmpQuat;return t.Quaternion.RotationAxisToRef(V,h,N),void this.setRotationQuaternion(N,mV,L)}const N=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,L))return;const k=A._TmpMats[1];t.Matrix.RotationAxisToRef(V,h,k),N.multiplyToRef(k,k),this._rotateWithMatrix(k,mV,L)}setRotation(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(V.y,V.x,V.z,h,mV)}setRotationQuaternion(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0;if(0===h)return this._decompose(),this._localRotation.t(V),void this._markAsDirtyAndCompose();const L=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,mV))return;const N=A._TmpMats[1];t.Matrix.FromQuaternionToRef(V,N),L.multiplyToRef(N,N),this._rotateWithMatrix(N,h,mV)}setRotationMatrix(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0;if(0===h){const L=A._TmpQuat;return t.Quaternion.FromRotationMatrixToRef(V,L),void this.setRotationQuaternion(L,h,mV)}const L=A._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(L,mV))return;const N=A._TmpMats[1];N.t(V),L.multiplyToRef(V,N),this._rotateWithMatrix(N,h,mV)}_rotateWithMatrix(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0;const t=this.getLocalMatrix(),L=t.m[12],N=t.m[13],k=t.m[14],C=this.getParent(),K=A._TmpMats[3],o=A._TmpMats[4];C&&1==h?(mV?(K.t(mV.getWorldMatrix()),C.getAbsoluteMatrix().multiplyToRef(K,K)):K.t(C.getAbsoluteMatrix()),o.t(K),o.invert(),t.multiplyToRef(K,t),t.multiplyToRef(V,t),t.multiplyToRef(o,t)):1==h&&mV?(K.t(mV.getWorldMatrix()),o.t(K),o.invert(),t.multiplyToRef(K,t),t.multiplyToRef(V,t),t.multiplyToRef(o,t)):t.multiplyToRef(V,t),t.setTranslationFromFloats(L,N,k),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(V,h){const mV=A._TmpMats[2];return V.t(this.getAbsoluteMatrix()),h?(V.multiplyToRef(h.getWorldMatrix(),V),t.Matrix.ScalingToRef(h.jk.x,h.jk.y,h.jk.z,mV)):t.Matrix.IdentityToRef(mV),V.invert(),!isNaN(V.m[0])&&(mV.multiplyAtIndex(0,this._scalingDeterminant),V.multiplyToRef(mV,V),!0)}ph(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=t.sh.Zero();return this.getPositionToRef(V,h,mV),mV}getPositionToRef(){let V=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const V=this.getLocalMatrix();h.x=V.m[12],h.y=V.m[13],h.z=V.m[14]}else{let mV=null;V&&(mV=V.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let t=A._TmpMats[0];V&&mV?(t.t(this.getAbsoluteMatrix()),t.multiplyToRef(mV,t)):t=this.getAbsoluteMatrix(),h.x=t.m[12],h.y=t.m[13],h.z=t.m[14]}}getAbsolutePosition(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=t.sh.Zero();return this.getPositionToRef(1,V,h),h}getAbsolutePositionToRef(V,h){this.getPositionToRef(1,V,h)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.lq.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.t(this.lq);const V=this._skeleton.getPoseMatrix();V&&this._absoluteMatrix.multiplyToRef(V,this._absoluteMatrix)}const V=this.children,h=V.length;for(let mV=0;mV<h;mV++)V[mV].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}HC(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=t.sh.Zero();return this.getDirectionToRef(V,h,mV),mV}getDirectionToRef(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2?arguments[2]:void 0,L=null;h&&(L=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=A._TmpMats[0];N.t(this.getAbsoluteMatrix()),h&&L&&N.multiplyToRef(L,N),t.sh.TransformNormalToRef(V,N,mV),mV.normalize()}getRotation(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=t.sh.Zero();return this.getRotationToRef(V,h,mV),mV}getRotationToRef(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2?arguments[2]:void 0;const t=A._TmpQuat;this.getRotationQuaternionToRef(V,h,t),t.toEulerAnglesToRef(mV)}getRotationQuaternion(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=t.Quaternion.Identity();return this.getRotationQuaternionToRef(V,h,mV),mV}getRotationQuaternionToRef(){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),h.t(this._localRotation);else{const mV=A._TmpMats[0],t=this.getAbsoluteMatrix();V?t.multiplyToRef(V.getWorldMatrix(),mV):mV.t(t),mV.multiplyAtIndex(0,this._scalingDeterminant),mV.multiplyAtIndex(1,this._scalingDeterminant),mV.multiplyAtIndex(2,this._scalingDeterminant),mV.decompose(void 0,h,void 0)}}getRotationMatrix(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1?arguments[1]:void 0;const mV=t.Matrix.Identity();return this.getRotationMatrixToRef(V,h,mV),mV}getRotationMatrixToRef(){let V=arguments.length>1?arguments[1]:void 0,h=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(h);else{const mV=A._TmpMats[0],t=this.getAbsoluteMatrix();V?t.multiplyToRef(V.getWorldMatrix(),mV):mV.t(t),mV.multiplyAtIndex(0,this._scalingDeterminant),mV.multiplyAtIndex(1,this._scalingDeterminant),mV.multiplyAtIndex(2,this._scalingDeterminant),mV.getRotationMatrixToRef(h)}}getAbsolutePositionFromLocal(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=t.sh.Zero();return this.getAbsolutePositionFromLocalToRef(V,h,mV),mV}getAbsolutePositionFromLocalToRef(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2?arguments[2]:void 0,L=null;h&&(L=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=A._TmpMats[0];N.t(this.getAbsoluteMatrix()),h&&L&&N.multiplyToRef(L,N),t.sh.TransformCoordinatesToRef(V,N,mV)}getLocalPositionFromAbsolute(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=t.sh.Zero();return this.getLocalPositionFromAbsoluteToRef(V,h,mV),mV}getLocalPositionFromAbsoluteToRef(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2?arguments[2]:void 0,L=null;h&&(L=h.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const N=A._TmpMats[0];N.t(this.getAbsoluteMatrix()),h&&L&&N.multiplyToRef(L,N),N.invert(),t.sh.TransformCoordinatesToRef(V,N,mV)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const V=this._skeleton.bones.indexOf(this);if(-1!==V&&this._skeleton.bones.splice(V,1),this._parentNode&&this._parentNode.children){const V=this._parentNode.children,h=V.indexOf(this);-1!==h&&V.splice(h,1)}super.dispose()}}A._TmpVecs=(0,L.c)(2,t.sh.Zero),A._TmpQuat=t.Quaternion.Identity(),A._TmpMats=(0,L.c)(5,t.Matrix.Identity)},14537:(V,h,mV)=>{"use strict";mV.d(h,{b:()=>T});var t=mV(12409),L=mV(12413),N=mV(12258),A=mV(12422),k=mV(12435),C=mV(12809),K=mV(12836),o=mV(12681),n=mV(12280),q=mV(12425);class x{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(V){this._idleRotationSpeed=V}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(V){this._idleRotationWaitTime=V}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(V){this._idleRotationSpinupTime=V}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(V){this._attachedCamera=V;const h=this._attachedCamera.DV();this._onPrePointerObservableObserver=h.onPrePointerObservable.add((V=>{V.type!==o.b.POINTERDOWN?V.type===o.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const V=n.e.Now;let h=0;null!=this._lastFrameTime&&(h=V-this._lastFrameTime),this._lastFrameTime=V,this._applyUserInteraction();const mV=V-this._lastInteractionTime-this._idleRotationWaitTime,t=Math.max(Math.min(mV/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*t,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(h/1e3))}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.DV();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(V){this._lastInteractionTime=V??n.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<q.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let V=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(V=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?V:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=n.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var R=mV(14542),d=mV(12918);class s{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(V){if(this._autoTransitionRange===V)return;this._autoTransitionRange=V;const h=this._attachedCamera;h&&(V?this._onMeshTargetChangedObserver=h.onMeshTargetChangedObservable.add((V=>{if(V&&(V.Qk(!0),V.getBoundingInfo)){const h=V.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*h,this.upperRadiusTransitionRange=.05*h}})):this._onMeshTargetChangedObserver&&h.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(V){this._attachedCamera=V,this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(V){return!!this._attachedCamera&&(this._attachedCamera.radius===V&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(V){if(!this._attachedCamera)return;this._radiusBounceTransition||(s.EasingFunction.setEasingMode(s.EasingMode),this._radiusBounceTransition=d.d.CreateAnimation("radius",d.d.ANIMATIONTYPE_FLOAT,60,s.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const h=d.d.TransitionTo("radius",this._attachedCamera.radius+V,this._attachedCamera,this._attachedCamera.DV(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));h&&this._animatables.push(h)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}s.EasingFunction=new R.d(.3),s.EasingMode=R.r.EASINGMODE_EASEOUT;class M{constructor(){this.onTargetFramingAnimationEndObservable=new N.d,this._mode=M.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(V){this._mode=V}get mode(){return this._mode}set radiusScale(V){this._radiusScale=V}get radiusScale(){return this._radiusScale}set positionScale(V){this._positionScale=V}get positionScale(){return this._positionScale}set defaultElevation(V){this._defaultElevation=V}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(V){this._elevationReturnTime=V}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(V){this._elevationReturnWaitTime=V}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(V){this._zoomStopsAnimation=V}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(V){this._framingTime=V}get framingTime(){return this._framingTime}init(){}attach(V){this._attachedCamera=V;const h=this._attachedCamera.DV();M.EasingFunction.setEasingMode(M.EasingMode),this._onPrePointerObservableObserver=h.onPrePointerObservable.add((V=>{V.type!==o.b.POINTERDOWN?V.type===o.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=V.onMeshTargetChangedObservable.add((V=>{V&&V.getBoundingInfo&&this.zoomOnMesh(V,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=V.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const V=this._attachedCamera.DV();this._onPrePointerObservableObserver&&V.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.Qk(!0);const t=V.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(t.minimumWorld,t.maximumWorld,h,mV)}zoomOnMeshHierarchy(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;V.Qk(!0);const t=V.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(t.min,t.max,h,mV)}zoomOnMeshesHierarchy(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new A.sh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),L=new A.sh(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let N=0;N<V.length;N++){const h=V[N].getHierarchyBoundingVectors(!0);A.sh.CheckExtends(h.min,t,L),A.sh.CheckExtends(h.max,t,L)}this.zoomOnBoundingInfo(t,L,h,mV)}zoomOnBoundingInfo(V,h){let mV,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const N=V.y,k=N+(h.y-N)*this._positionScale,C=h.Mh(V).scale(.5);if(!isFinite(k))return!1;if(t)mV=new A.sh(0,k,0);else{const h=V.add(C);mV=new A.sh(h.x,k,h.z)}this._vectorTransition||(this._vectorTransition=d.d.CreateAnimation("target",d.d.ANIMATIONTYPE_VECTOR3,60,M.EasingFunction)),this._betaIsAnimating=!0;let K=d.d.TransitionTo("target",mV,this._attachedCamera,this._attachedCamera.DV(),60,this._vectorTransition,this._framingTime);K&&this._animatables.push(K);let o=0;if(this._mode===M.FitFrustumSidesMode){const mV=this._calculateLowerRadiusFromModelBoundingSphere(V,h);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=C.length()+this._attachedCamera.ck),o=mV}else this._mode===M.IgnoreBoundsSizeMode&&(o=this._calculateLowerRadiusFromModelBoundingSphere(V,h),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.ck));if(this.autoCorrectCameraLimitsAndSensibility){const mV=h.Mh(V).length();this._attachedCamera.panningSensibility=5e3/mV,this._attachedCamera.wheelPrecision=100/o}return this._radiusTransition||(this._radiusTransition=d.d.CreateAnimation("radius",d.d.ANIMATIONTYPE_FLOAT,60,M.EasingFunction)),K=d.d.TransitionTo("radius",o,this._attachedCamera,this._attachedCamera.DV(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),L&&L(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),K&&this._animatables.push(K),!0}_calculateLowerRadiusFromModelBoundingSphere(V,h){const mV=this._attachedCamera;if(!mV)return 0;let t=mV._calculateLowerRadiusFromModelBoundingSphere(V,h,this._radiusScale);return mV.lowerRadiusLimit&&this._mode===M.IgnoreBoundsSizeMode&&(t=t<mV.lowerRadiusLimit?mV.lowerRadiusLimit:t),mV.upperRadiusLimit&&(t=t>mV.upperRadiusLimit?mV.upperRadiusLimit:t),t}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const V=n.e.Now-this._lastInteractionTime,h=.5*Math.PI-this._defaultElevation,mV=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>mV&&V>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=d.d.CreateAnimation("beta",d.d.ANIMATIONTYPE_FLOAT,60,M.EasingFunction));const V=d.d.TransitionTo("beta",h,this._attachedCamera,this._attachedCamera.DV(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));V&&this._animatables.push(V)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=n.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}M.EasingFunction=new R.x,M.EasingMode=R.r.EASINGMODE_EASEINOUT,M.IgnoreBoundsSizeMode=0,M.FitFrustumSidesMode=1;var c=mV(12838),z=mV(12876),Q=mV(14042),J=mV(12253);class v{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(V){V=J.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),mV=h.getInputElement();let t=0,L=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=N=>{var A,k;const C=N.event,K="touch"===C.pointerType;if(N.type!==o.b.POINTERMOVE&&-1===this.buttons.indexOf(C.button))return;const n=C.target;if(this._altKey=C.altKey,this._ctrlKey=C.ctrlKey,this._metaKey=C.metaKey,this._shiftKey=C.shiftKey,this._buttonsPressed=C.buttons,h.isPointerLock){const V=C.movementX,h=C.movementY;this.onTouch(null,V,h),this._pointA=null,this._pointB=null}else{if(N.type!==o.b.POINTERDOWN&&N.type!==o.b.POINTERDOUBLETAP&&K&&(null===(A=this._pointA)||void 0===A?void 0:A.pointerId)!==C.pointerId&&(null===(k=this._pointB)||void 0===k?void 0:k.pointerId)!==C.pointerId)return;if(N.type!==o.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!K)if(N.type===o.b.POINTERDOUBLETAP)this.onDoubleTap(C.pointerType);else if(N.type!==o.b.POINTERUP||this._currentMousePointerIdDown!==C.pointerId&&!K){if(N.type===o.b.POINTERMOVE)if(V||C.preventDefault(),this._pointA&&null===this._pointB){const V=C.clientX-this._pointA.x,h=C.clientY-this._pointA.y;this._pointA.x=C.clientX,this._pointA.y=C.clientY,this.onTouch(this._pointA,V,h)}else if(this._pointA&&this._pointB){const V=this._pointA.pointerId===C.pointerId?this._pointA:this._pointB;V.x=C.clientX,V.y=C.clientY;const h=this._pointA.x-this._pointB.x,mV=this._pointA.y-this._pointB.y,A=h*h+mV*mV,k={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:C.pointerId,type:N.type};this.onMultiTouch(this._pointA,this._pointB,t,A,L,k),L=k,t=A}}else{try{null===n||void 0===n||n.releasePointerCapture(C.pointerId)}catch(q){}K||(this._pointB=null),h._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==C.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==C.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==t||L)&&(this.onMultiTouch(this._pointA,this._pointB,t,0,L,null),t=0,L=null),this._currentMousePointerIdDown=-1,this.onButtonUp(C),V||C.preventDefault()}else{try{null===n||void 0===n||n.setPointerCapture(C.pointerId)}catch(q){}if(null===this._pointA)this._pointA={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType};else{if(null!==this._pointB)return;this._pointB={x:C.clientX,y:C.clientY,pointerId:C.pointerId,type:C.pointerType}}-1!==this._currentMousePointerIdDown||K||(this._currentMousePointerIdDown=C.pointerId),this.onButtonDown(C),V||(C.preventDefault(),mV&&mV.focus())}}},this._observer=this.camera.DV()._inputManager._addCameraPointerObserver(this._pointerInput,o.b.POINTERDOWN|o.b.POINTERUP|o.b.POINTERMOVE|o.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,t=0,L=null,this.onLostFocus()},this._contextMenuBind=V=>this.onContextMenu(V),mV&&mV.addEventListener("contextmenu",this._contextMenuBind,!1);const N=this.camera.DV().getEngine().getHostWindow();N&&J.Tools.RegisterTopRootEvents(N,[{name:"blur",handler:this._onLostFocus}])}fn(){if(this._onLostFocus){const V=this.camera.DV().getEngine().getHostWindow();V&&J.Tools.UnregisterTopRootEvents(V,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.DV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const V=this.camera.DV().getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(V){}onTouch(V,h,mV){}onMultiTouch(V,h,mV,t,L,N){}onContextMenu(V){V.preventDefault()}onButtonDown(V){}onButtonUp(V){}onLostFocus(){}}(0,t.e)([(0,L.J)()],v.prototype,"buttons",void 0);class D extends v{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(V,h){if(0!==this.panningSensibility&&V&&h){const mV=h.x-V.x,t=h.y-V.y;this.camera.inertialPanningX+=-mV/this.panningSensibility,this.camera.inertialPanningY+=t/this.panningSensibility}}_computePinchZoom(V,h){const mV=this.camera.radius||D.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=mV*Math.sqrt(V)/Math.sqrt(h):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(h-V)*mV*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(h-V)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(V,h,mV){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-h/this.panningSensibility,this.camera.inertialPanningY+=mV/this.panningSensibility):(this.camera.inertialAlphaOffset-=h/this.angularSensibilityX,this.camera.inertialBetaOffset-=mV/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(V,h,mV,t,L,N){0===mV&&null===L||0===t&&null===N||(this.multiTouchPanAndZoom?(this._computePinchZoom(mV,t),this._computeMultiTouchPanning(L,N)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(t)-Math.sqrt(mV))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(mV,t),this._isPinching=!0):this._computeMultiTouchPanning(L,N)):this.multiTouchPanning?this._computeMultiTouchPanning(L,N):this.pinchZoom&&this._computePinchZoom(mV,t))}onButtonDown(V){this._isPanClick=V.button===this.camera._panningMouseButton}onButtonUp(V){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}D.MinimumRadiusForPinch=.001,(0,t.e)([(0,L.J)()],D.prototype,"buttons",void 0),(0,t.e)([(0,L.J)()],D.prototype,"angularSensibilityX",void 0),(0,t.e)([(0,L.J)()],D.prototype,"angularSensibilityY",void 0),(0,t.e)([(0,L.J)()],D.prototype,"pinchPrecision",void 0),(0,t.e)([(0,L.J)()],D.prototype,"pinchDeltaPercentage",void 0),(0,t.e)([(0,L.J)()],D.prototype,"useNaturalPinchZoom",void 0),(0,t.e)([(0,L.J)()],D.prototype,"pinchZoom",void 0),(0,t.e)([(0,L.J)()],D.prototype,"panningSensibility",void 0),(0,t.e)([(0,L.J)()],D.prototype,"multiTouchPanning",void 0),(0,t.e)([(0,L.J)()],D.prototype,"multiTouchPanAndZoom",void 0),Q.d.ArcRotateCameraPointersInput=D;var H=mV(12684);class j{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(V){V=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.DV(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const mV=h.event;if(!mV.metaKey)if(h.type===H.b.KEYDOWN){if(this._ctrlPressed=mV.ctrlKey,this._altPressed=mV.altKey,-1!==this.keysUp.indexOf(mV.keyCode)||-1!==this.keysDown.indexOf(mV.keyCode)||-1!==this.keysLeft.indexOf(mV.keyCode)||-1!==this.keysRight.indexOf(mV.keyCode)||-1!==this.keysReset.indexOf(mV.keyCode)){-1===this._keys.indexOf(mV.keyCode)&&this._keys.push(mV.keyCode),mV.preventDefault&&(V||mV.preventDefault())}}else if(-1!==this.keysUp.indexOf(mV.keyCode)||-1!==this.keysDown.indexOf(mV.keyCode)||-1!==this.keysLeft.indexOf(mV.keyCode)||-1!==this.keysRight.indexOf(mV.keyCode)||-1!==this.keysReset.indexOf(mV.keyCode)){const h=this._keys.indexOf(mV.keyCode);h>=0&&this._keys.splice(h,1),mV.preventDefault&&(V||mV.preventDefault())}})))}fn(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let h=0;h<this._keys.length;h++){const mV=this._keys[h];-1!==this.keysLeft.indexOf(mV)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX-=1/this.panningSensibility:V.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(mV)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset+=1/this.zoomingSensibility:V.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(mV)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningX+=1/this.panningSensibility:V.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(mV)?this._ctrlPressed&&this.camera._useCtrlForPanning?V.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?V.inertialRadiusOffset-=1/this.zoomingSensibility:V.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(mV)&&V.useInputToRestoreState&&V.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,t.e)([(0,L.J)()],j.prototype,"keysUp",void 0),(0,t.e)([(0,L.J)()],j.prototype,"keysDown",void 0),(0,t.e)([(0,L.J)()],j.prototype,"keysLeft",void 0),(0,t.e)([(0,L.J)()],j.prototype,"keysRight",void 0),(0,t.e)([(0,L.J)()],j.prototype,"keysReset",void 0),(0,t.e)([(0,L.J)()],j.prototype,"panningSensibility",void 0),(0,t.e)([(0,L.J)()],j.prototype,"zoomingSensibility",void 0),(0,t.e)([(0,L.J)()],j.prototype,"useAltToZoom",void 0),(0,t.e)([(0,L.J)()],j.prototype,"angularSpeed",void 0),Q.d.ArcRotateCameraKeyboardMoveInput=j;var l=mV(12458),G=mV(12688);class y{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new A.sh(0,0,0),this._globalOffset=new A.sh(0,0,0),this._inertialPanning=A.sh.Zero()}_computeDeltaFromMouseWheelLegacyEvent(V,h){let mV=0;const t=.01*V*this.wheelDeltaPercentage*h;return mV=V>0?t/(1+this.wheelDeltaPercentage):t*(1+this.wheelDeltaPercentage),mV}attachControl(V){V=J.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==o.b.POINTERWHEEL)return;const mV=h.event;let t=0;const L=mV.deltaMode===G.c.DOM_DELTA_LINE?40:1,N=-mV.deltaY*L;if(this.customComputeDeltaFromMouseWheel)t=this.customComputeDeltaFromMouseWheel(N,this,mV);else if(this.wheelDeltaPercentage){if(t=this._computeDeltaFromMouseWheelLegacyEvent(N,this.camera.radius),t>0){let V=this.camera.radius,h=this.camera.inertialRadiusOffset+t;for(let mV=0;mV<20&&!(V<=h)&&!(Math.abs(h*this.camera.inertia)<.001);mV++)V-=h,h*=this.camera.inertia;V=(0,k.Clamp)(V,0,Number.MAX_VALUE),t=this._computeDeltaFromMouseWheelLegacyEvent(N,V)}}else t=N/(40*this.wheelPrecision);t&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(t)):this.camera.inertialRadiusOffset+=t),mV.preventDefault&&(V||mV.preventDefault())},this._observer=this.camera.DV()._inputManager._addCameraPointerObserver(this._wheel,o.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.lk(0)}fn(){this._observer&&(this.camera.DV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const V=this.camera;0+V.inertialAlphaOffset+V.inertialBetaOffset+V.inertialRadiusOffset&&(this._updateHitPlane(),V.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(V.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const V=this.camera,h=V.target.Mh(V.position);this._hitPlane=l.b.FromPositionAndNormal(V.target,h)}_getPosition(){const V=this.camera,h=V.DV(),mV=h.createPickingRay(h.pointerX,h.pointerY,A.Matrix.Identity(),V,!1);0===V.targetScreenOffset.x&&0===V.targetScreenOffset.y||(this._viewOffset.set(V.targetScreenOffset.x,V.targetScreenOffset.y,0),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),this._globalOffset=A.sh.TransformNormal(this._viewOffset,V._cameraTransformMatrix),mV.origin.addInPlace(this._globalOffset));let t=0;return this._hitPlane&&(t=mV.intersectsPlane(this._hitPlane)??0),mV.origin.addInPlace(mV.direction.scaleInPlace(t))}_zoomToMouse(V){const h=this.camera,mV=1-h.inertia;if(h.lowerRadiusLimit){const t=h.lowerRadiusLimit??0;h.radius-(h.inertialRadiusOffset+V)/mV<t&&(V=(h.radius-t)*mV-h.inertialRadiusOffset)}if(h.upperRadiusLimit){const t=h.upperRadiusLimit??0;h.radius-(h.inertialRadiusOffset+V)/mV>t&&(V=(h.radius-t)*mV-h.inertialRadiusOffset)}const t=V/mV/h.radius,L=this._getPosition(),N=A.TmpVectors.sh[6];L.subtractToRef(h.target,N),N.scaleInPlace(t),N.scaleInPlace(mV),this._inertialPanning.addInPlace(N),h.inertialRadiusOffset+=V}_zeroIfClose(V){Math.abs(V.x)<q.c&&(V.x=0),Math.abs(V.y)<q.c&&(V.y=0),Math.abs(V.z)<q.c&&(V.z=0)}}(0,t.e)([(0,L.J)()],y.prototype,"wheelPrecision",void 0),(0,t.e)([(0,L.J)()],y.prototype,"zoomToMouseLocation",void 0),(0,t.e)([(0,L.J)()],y.prototype,"wheelDeltaPercentage",void 0),Q.d.ArcRotateCameraMouseWheelInput=y;class O extends Q.f{constructor(V){super(V)}addMouseWheel(){return this.add(new y),this}addPointers(){return this.add(new D),this}addKeyboard(){return this.add(new j),this}}var I=mV(12388);function r(V,h){return isNaN(V)?h:V}C.d.AddNodeConstructor("ArcRotateCamera",((V,h)=>()=>new T(V,0,0,1,A.sh.Zero(),h)));class T extends z.d{get target(){return this._target}set target(V){this.setTarget(V)}get targetHost(){return this._targetHost}set targetHost(V){V&&this.setTarget(V)}getTarget(){return this.target}get position(){return this._position}set position(V){this.setPosition(V)}set upVector(V){this._upToYMatrix||(this._yToUpMatrix=new A.Matrix,this._upToYMatrix=new A.Matrix,this._upVector=A.sh.Zero()),V.normalize(),this._upVector.t(V),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){A.Matrix.RotationAlignToRef(A.sh.UpReadOnly,this._upVector,this._yToUpMatrix),A.Matrix.RotationAlignToRef(this._upVector,A.sh.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityX:0}set angularSensibilityX(V){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityX=V)}get angularSensibilityY(){const V=this.inputs.attached.pointers;return V?V.angularSensibilityY:0}set angularSensibilityY(V){const h=this.inputs.attached.pointers;h&&(h.angularSensibilityY=V)}get pinchPrecision(){const V=this.inputs.attached.pointers;return V?V.pinchPrecision:0}set pinchPrecision(V){const h=this.inputs.attached.pointers;h&&(h.pinchPrecision=V)}get pinchDeltaPercentage(){const V=this.inputs.attached.pointers;return V?V.pinchDeltaPercentage:0}set pinchDeltaPercentage(V){const h=this.inputs.attached.pointers;h&&(h.pinchDeltaPercentage=V)}get useNaturalPinchZoom(){const V=this.inputs.attached.pointers;return!!V&&V.useNaturalPinchZoom}set useNaturalPinchZoom(V){const h=this.inputs.attached.pointers;h&&(h.useNaturalPinchZoom=V)}get panningSensibility(){const V=this.inputs.attached.pointers;return V?V.panningSensibility:0}set panningSensibility(V){const h=this.inputs.attached.pointers;h&&(h.panningSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const h=this.inputs.attached.keyboard;h&&(h.keysUp=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const h=this.inputs.attached.keyboard;h&&(h.keysDown=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const h=this.inputs.attached.keyboard;h&&(h.keysRight=V)}get wheelPrecision(){const V=this.inputs.attached.mousewheel;return V?V.wheelPrecision:0}set wheelPrecision(V){const h=this.inputs.attached.mousewheel;h&&(h.wheelPrecision=V)}get zoomToMouseLocation(){const V=this.inputs.attached.mousewheel;return!!V&&V.zoomToMouseLocation}set zoomToMouseLocation(V){const h=this.inputs.attached.mousewheel;h&&(h.zoomToMouseLocation=V)}get wheelDeltaPercentage(){const V=this.inputs.attached.mousewheel;return V?V.wheelDeltaPercentage:0}set wheelDeltaPercentage(V){const h=this.inputs.attached.mousewheel;h&&(h.wheelDeltaPercentage=V)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(V){V!==this.useBouncingBehavior&&(V?(this._bouncingBehavior=new s,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(V){V!==this.useFramingBehavior&&(V?(this._framingBehavior=new M,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(V){V!==this.useAutoRotationBehavior&&(V?(this._autoRotationBehavior=new x,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(V,h,mV,t,L,k){var C;let K=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(V,A.sh.Zero(),k,K),C=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=A.sh.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=A.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new A.Matrix,this.panningAxis=new A.sh(1,1,0),this._transformedDirection=new A.sh,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new N.d,this.checkCollisions=!1,this.collisionRadius=new A.sh(.5,.5,.5),this._previousPosition=A.sh.Zero(),this._collisionVelocity=A.sh.Zero(),this._newPosition=A.sh.Zero(),this._computationVector=A.sh.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new A.sh(NaN,NaN,NaN),this._goalTargetScreenOffset=new A.Vector2(NaN,NaN),this._onCollisionPositionChange=function(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;mV?(C.setPosition(h),C.vx&&C.vx(mV)):C._previousPosition.t(C._position);const t=Math.cos(C.alpha),L=Math.sin(C.alpha),N=Math.cos(C.beta);let A=Math.sin(C.beta);0===A&&(A=1e-4);const k=C._getTargetPosition();C._computationVector.Hk(C.radius*t*A,C.radius*N,C.radius*L*A),k.addToRef(C._computationVector,C._newPosition),C._position.t(C._newPosition);let K=C.upVector;C.allowUpsideDown&&C.beta<0&&(K=K.clone(),K=K.negate()),C._computeViewMatrix(C._position,k,K),C._viewMatrix.addAtIndex(12,C.targetScreenOffset.x),C._viewMatrix.addAtIndex(13,C.targetScreenOffset.y),C._collisionTriggered=!1},this._target=A.sh.Zero(),L&&this.setTarget(L),this.alpha=h,this.beta=mV,this.radius=t,this.getViewMatrix(),this.inputs=new O(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new A.sh(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=A.Vector2.Zero()}_updateCache(V){V||super._updateCache(),this._cache._target.t(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.t(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const V=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?V.addToRef(this._targetBoundingCenter,this._target):this._target.t(V)}const V=this._getLockedTargetPosition();return V||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>q.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,N=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=N?this._currentInterpolationFactor=N:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=r(V,this._goalAlpha),this._goalBeta=r(h,this._goalBeta),this._goalRadius=r(mV,this._goalRadius),this._goalTarget.set(r(t.x,this._goalTarget.x),r(t.y,this._goalTarget.y),r(t.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(r(L.x,this._goalTargetScreenOffset.x),r(L.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,k.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,k.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,k.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,k.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(V,h){let mV=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const L=arguments;h=J.Tools.BackCompatCameraNoPreventDefault(L),this._useCtrlForPanning=mV,this._panningMouseButton=t,"boolean"===typeof L[0]&&(L.length>1&&(this._useCtrlForPanning=L[1]),L.length>2&&(this._panningMouseButton=L[2])),this.inputs.attachElement(h),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}fn(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let V=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){V=!0;const h=this.invertRotation?-1:1,mV=this._calculateHandednessMultiplier();let t=this.inertialAlphaOffset*mV;this.beta<0&&(t*=-1),this.alpha+=t*h,this.beta+=this.inertialBetaOffset*h,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<q.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<q.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*q.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){V=!0;const h=new A.sh(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),h.multiplyInPlace(this.panningAxis),A.sh.TransformNormalToRef(h,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const V=this.upVector,h=A.sh.CrossToRef(this._transformedDirection,V,this._transformedDirection);A.sh.CrossToRef(V,h,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);A.sh.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.t(this._transformedDirection)}else{if(this.parent){const V=A.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(V),V.transposeToRef(V),A.sh.TransformCoordinatesToRef(this._transformedDirection,V,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*q.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*q.c&&(this.inertialPanningY=0)}if(V)this.stopInterpolation();else if(this._isInterpolating){let V=!1;const h=this._scene.getEngine().getDeltaTime()/1e3,mV=1-Math.pow(2,-h/this._currentInterpolationFactor),t=r(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const h=A.TmpVectors.sh[0].set(r(this._goalTarget.x,this._target.x),r(this._goalTarget.y,this._target.y),r(this._goalTarget.z,this._target.z));A.sh.LerpToRef(this.target,h,mV,this._target),10*A.sh.Distance(this.target,h)/t<q.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.t(h),this.setTarget(this.target,!1,!0,!0)):V=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const h=A.Quaternion.RotationAlphaBetaGammaToRef(r(this._goalAlpha,this.alpha),r(this._goalBeta,this.beta),0,A.TmpVectors.Quaternion[0]),t=A.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,A.TmpVectors.Quaternion[1]),L=A.Quaternion.SlerpToRef(t,h,mV,A.TmpVectors.Quaternion[2]);L.normalize();const N=L.toAlphaBetaGammaToRef(A.TmpVectors.sh[0]);if(this.alpha=N.x,this.beta=N.y,L.isApprox(h,q.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const V=h.toAlphaBetaGammaToRef(A.TmpVectors.sh[0]);this.alpha=V.x,this.beta=V.y}else V=!0}if(isNaN(this._goalRadius)||(this.radius+=(t-this.radius)*mV,Math.abs(t/this.radius-1)<q.c?(this._goalRadius=NaN,this.radius=t):V=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const h=A.TmpVectors.Vector2[0].set(r(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),r(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));A.Vector2.LerpToRef(this.targetScreenOffset,h,mV,this.targetScreenOffset),A.Vector2.Distance(this.targetScreenOffset,h)<q.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.t(h)):V=!0}this._isInterpolating=V}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.sh.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const V=this.alpha;var h,mV;this.alpha=function(V){let h=Math.PI/2;return 0===V.x&&0===V.z||(h=Math.acos(V.x/Math.sqrt(Math.pow(V.x,2)+Math.pow(V.z,2)))),V.z<0&&(h=2*Math.PI-h),h}(this._computationVector),this.beta=(h=this._computationVector.y,mV=this.radius,Math.acos(h/mV));const t=Math.round((V-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this._checkLimits()}setPosition(V){this._position.equals(V)||(this._position.t(V),this.rebuildAnglesAndRadius())}setTarget(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t=this.overrideCloneAlphaBetaRadius??t,V.Qk)h&&V.getBoundingInfo?this._targetBoundingCenter=V.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,V.Qk(),this._targetHost=V,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const h=V,t=this._getTargetPosition();if(t&&!mV&&t.equals(h))return;this._targetHost=null,this._target=h,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}t||this.rebuildAnglesAndRadius()}_getViewMatrix(){const V=Math.cos(this.alpha),h=Math.sin(this.alpha),mV=Math.cos(this.beta);let t=Math.sin(this.beta);0===t&&(t=1e-4),0===this.radius&&(this.radius=1e-4);const L=this._getTargetPosition();if(this._computationVector.Hk(this.radius*V*t,this.radius*mV,this.radius*h*t),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||A.sh.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),L.addToRef(this._computationVector,this._newPosition),this.DV().collisionsEnabled&&this.checkCollisions){const V=this.DV().collisionCoordinator;this._collider||(this._collider=V.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,V.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.t(this._newPosition);let V=this.upVector;this.allowUpsideDown&&t<0&&(V=V.negate()),this._computeViewMatrix(this._position,L,V),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.t(L),this._viewMatrix}zoomOn(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];V=V||this.DV().meshes;const mV=K.c.MinMax(V);let t=this._calculateLowerRadiusFromModelBoundingSphere(mV.min,mV.max);if(t=Math.max(Math.min(t,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=t*this.zoomOnFactor,this.mode===c.b.ORTHOGRAPHIC_CAMERA){const V=this.DV().getEngine().getAspectRatio(this),h=t*this.zoomOnFactor/2;this.orthoLeft=-h*V,this.orthoRight=h*V,this.orthoBottom=-h,this.orthoTop=h}this.focusOn({min:mV.min,max:mV.max,distance:t},h)}focusOn(V){let h,mV,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===V.min){const t=V||this.DV().meshes;h=K.c.MinMax(t),mV=A.sh.Distance(h.min,h.max)}else{h=V,mV=V.distance}this._target=K.c.Center(h),t||(this.maxZ=2*mV)}createRigCamera(V,h){let mV=0;switch(this.cameraRigMode){case c.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.b.RIG_MODE_VR:mV=this._cameraRigParams.stereoHalfAngle*(0===h?1:-1);break;case c.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:mV=this._cameraRigParams.stereoHalfAngle*(0===h?-1:1)}const t=new T(V,this.alpha+mV,this.beta,this.radius,this._target,this.DV());return t._cameraRigParams={},t.isRigCamera=!0,t.rigParent=this,t.upVector=this.upVector,t.mode=this.mode,t.orthoLeft=this.orthoLeft,t.orthoRight=this.orthoRight,t.orthoBottom=this.orthoBottom,t.orthoTop=this.orthoTop,t}_updateRigCameras(){const V=this._rigCameras[0],h=this._rigCameras[1];switch(V.beta=h.beta=this.beta,this.cameraRigMode){case c.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case c.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case c.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case c.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case c.b.RIG_MODE_VR:V.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case c.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:V.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,h.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const t=A.sh.Distance(V,h),L=this.DV().getEngine().getAspectRatio(this),N=Math.tan(this.fov/2),k=N*L,C=.5*t*mV,K=C*Math.sqrt(1+1/(k*k)),o=C*Math.sqrt(1+1/(N*N));return Math.max(K,o)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,t.e)([(0,L.J)()],T.prototype,"alpha",void 0),(0,t.e)([(0,L.J)()],T.prototype,"beta",void 0),(0,t.e)([(0,L.J)()],T.prototype,"radius",void 0),(0,t.e)([(0,L.J)()],T.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,t.e)([(0,L.I)("target")],T.prototype,"_target",void 0),(0,t.e)([(0,L.w)("targetHost")],T.prototype,"_targetHost",void 0),(0,t.e)([(0,L.J)()],T.prototype,"inertialAlphaOffset",void 0),(0,t.e)([(0,L.J)()],T.prototype,"inertialBetaOffset",void 0),(0,t.e)([(0,L.J)()],T.prototype,"inertialRadiusOffset",void 0),(0,t.e)([(0,L.J)()],T.prototype,"lowerAlphaLimit",void 0),(0,t.e)([(0,L.J)()],T.prototype,"upperAlphaLimit",void 0),(0,t.e)([(0,L.J)()],T.prototype,"lowerBetaLimit",void 0),(0,t.e)([(0,L.J)()],T.prototype,"upperBetaLimit",void 0),(0,t.e)([(0,L.J)()],T.prototype,"lowerRadiusLimit",void 0),(0,t.e)([(0,L.J)()],T.prototype,"upperRadiusLimit",void 0),(0,t.e)([(0,L.J)()],T.prototype,"lowerTargetYLimit",void 0),(0,t.e)([(0,L.J)()],T.prototype,"inertialPanningX",void 0),(0,t.e)([(0,L.J)()],T.prototype,"inertialPanningY",void 0),(0,t.e)([(0,L.J)()],T.prototype,"pinchToPanMaxDistance",void 0),(0,t.e)([(0,L.J)()],T.prototype,"panningDistanceLimit",void 0),(0,t.e)([(0,L.I)()],T.prototype,"panningOriginTarget",void 0),(0,t.e)([(0,L.J)()],T.prototype,"panningInertia",void 0),(0,t.e)([(0,L.J)()],T.prototype,"zoomToMouseLocation",null),(0,t.e)([(0,L.J)()],T.prototype,"zoomOnFactor",void 0),(0,t.e)([(0,L.F)()],T.prototype,"targetScreenOffset",void 0),(0,t.e)([(0,L.J)()],T.prototype,"allowUpsideDown",void 0),(0,t.e)([(0,L.J)()],T.prototype,"useInputToRestoreState",void 0),(0,t.e)([(0,L.J)()],T.prototype,"restoreStateInterpolationFactor",void 0),(0,I.i)("BABYLON.ArcRotateCamera",T)},14042:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>A,f:()=>k});var t=mV(12264),L=mV(12448),N=mV(12838),A={};class k{constructor(V){this.attachedToElement=!1,this.attached={},this.camera=V,this.checkInputs=()=>{}}add(V){const h=V.getSimpleName();this.attached[h]?t.e.Warn("camera input of type "+h+" already exists on camera"):(this.attached[h]=V,V.camera=this.camera,V.checkInputs&&(this.checkInputs=this._addCheckInputs(V.checkInputs.bind(V))),this.attachedToElement&&V.attachControl(this.noPreventDefault))}remove(V){for(const h in this.attached){const mV=this.attached[h];if(mV===V)return mV.fn(),mV.camera=null,delete this.attached[h],void this.rebuildInputCheck()}}removeByType(V){for(const h in this.attached){const mV=this.attached[h];mV.getClassName()===V&&(mV.fn(),mV.camera=null,delete this.attached[h],this.rebuildInputCheck())}}_addCheckInputs(V){const h=this.checkInputs;return()=>{h(),V()}}attachInput(V){this.attachedToElement&&V.attachControl(this.noPreventDefault)}attachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){V=!N.b.ForceAttachControlToAlwaysPreventDefault&&V,this.attachedToElement=!0,this.noPreventDefault=V;for(const h in this.attached)this.attached[h].attachControl(V)}}detachElement(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const h in this.attached)this.attached[h].fn(),V&&(this.attached[h].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const V in this.attached){const h=this.attached[V];h.checkInputs&&(this.checkInputs=this._addCheckInputs(h.checkInputs.bind(h)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(V){const h={};for(const mV in this.attached){const V=this.attached[mV],t=L.e.Serialize(V);h[V.getClassName()]=t}V.inputsmgr=h}parse(V){const h=V.inputsmgr;if(h){this.clear();for(const V in h){const mV=A[V];if(mV){const t=h[V],N=L.e.Parse((()=>new mV),t,null);this.add(N)}}}else for(const mV in this.attached){const h=A[this.attached[mV].getClassName()];if(h){const t=L.e.Parse((()=>new h),V,null);this.remove(this.attached[mV]),this.add(t)}}}}},14034:(V,h,mV)=>{"use strict";mV.d(h,{c:()=>v});var t=mV(12409),L=mV(12413),N=mV(12422),A=mV(12876),k=mV(14042),C=mV(12684),K=mV(12253);class o{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(V){V=K.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.DV(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((h=>{const mV=h.event;if(!mV.metaKey)if(h.type===C.b.KEYDOWN){if(-1!==this.keysUp.indexOf(mV.keyCode)||-1!==this.keysDown.indexOf(mV.keyCode)||-1!==this.keysLeft.indexOf(mV.keyCode)||-1!==this.keysRight.indexOf(mV.keyCode)||-1!==this.keysUpward.indexOf(mV.keyCode)||-1!==this.keysDownward.indexOf(mV.keyCode)||-1!==this.keysRotateLeft.indexOf(mV.keyCode)||-1!==this.keysRotateRight.indexOf(mV.keyCode)||-1!==this.keysRotateUp.indexOf(mV.keyCode)||-1!==this.keysRotateDown.indexOf(mV.keyCode)){-1===this._keys.indexOf(mV.keyCode)&&this._keys.push(mV.keyCode),V||mV.preventDefault()}}else if(-1!==this.keysUp.indexOf(mV.keyCode)||-1!==this.keysDown.indexOf(mV.keyCode)||-1!==this.keysLeft.indexOf(mV.keyCode)||-1!==this.keysRight.indexOf(mV.keyCode)||-1!==this.keysUpward.indexOf(mV.keyCode)||-1!==this.keysDownward.indexOf(mV.keyCode)||-1!==this.keysRotateLeft.indexOf(mV.keyCode)||-1!==this.keysRotateRight.indexOf(mV.keyCode)||-1!==this.keysRotateUp.indexOf(mV.keyCode)||-1!==this.keysRotateDown.indexOf(mV.keyCode)){const h=this._keys.indexOf(mV.keyCode);h>=0&&this._keys.splice(h,1),V||mV.preventDefault()}})))}fn(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const V=this.camera;for(let h=0;h<this._keys.length;h++){const mV=this._keys[h],t=V._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(mV)?V._localDirection.Hk(-t,0,0):-1!==this.keysUp.indexOf(mV)?V._localDirection.Hk(0,0,t):-1!==this.keysRight.indexOf(mV)?V._localDirection.Hk(t,0,0):-1!==this.keysDown.indexOf(mV)?V._localDirection.Hk(0,0,-t):-1!==this.keysUpward.indexOf(mV)?V._localDirection.Hk(0,t,0):-1!==this.keysDownward.indexOf(mV)?V._localDirection.Hk(0,-t,0):-1!==this.keysRotateLeft.indexOf(mV)?(V._localDirection.Hk(0,0,0),V.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(mV)?(V._localDirection.Hk(0,0,0),V.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(mV)?(V._localDirection.Hk(0,0,0),V.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(mV)&&(V._localDirection.Hk(0,0,0),V.cameraRotation.x+=this._getLocalRotation()),V.DV().useRightHandedSystem&&(V._localDirection.z*=-1),V.getViewMatrix().invertToRef(V._cameraTransformMatrix),N.sh.TransformNormalToRef(V._localDirection,V._cameraTransformMatrix,V._transformedDirection),V.cameraDirection.addInPlace(V._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const V=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*V}}(0,t.e)([(0,L.J)()],o.prototype,"keysUp",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysUpward",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysDown",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysDownward",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysLeft",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysRight",void 0),(0,t.e)([(0,L.J)()],o.prototype,"rotationSpeed",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysRotateLeft",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysRotateRight",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysRotateUp",void 0),(0,t.e)([(0,L.J)()],o.prototype,"keysRotateDown",void 0),k.d.FreeCameraKeyboardMoveInput=o;var n=mV(12258),q=mV(12681);class x{constructor(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=V,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new n.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(V){V=K.Tools.BackCompatCameraNoPreventDefault(arguments);const h=this.camera.getEngine(),mV=h.getInputElement();this._pointerInput||(this._pointerInput=t=>{const L=t.event,N="touch"===L.pointerType;if(!this.touchEnabled&&N)return;if(t.type!==q.b.POINTERMOVE&&-1===this.buttons.indexOf(L.button))return;const A=L.target;if(t.type===q.b.POINTERDOWN){if(N&&-1!==this._activePointerId||!N&&-1!==this._currentActiveButton)return;this._activePointerId=L.pointerId;try{null===A||void 0===A||A.setPointerCapture(L.pointerId)}catch(k){}-1===this._currentActiveButton&&(this._currentActiveButton=L.button),this._previousPosition={x:L.clientX,y:L.clientY},V||(L.preventDefault(),mV&&mV.focus()),h.isPointerLock&&this._onMouseMove&&this._onMouseMove(t.event)}else if(t.type===q.b.POINTERUP){if(N&&this._activePointerId!==L.pointerId||!N&&this._currentActiveButton!==L.button)return;try{null===A||void 0===A||A.releasePointerCapture(L.pointerId)}catch(k){}this._currentActiveButton=-1,this._previousPosition=null,V||L.preventDefault(),this._activePointerId=-1}else if(t.type===q.b.POINTERMOVE&&(this._activePointerId===L.pointerId||!N))if(h.isPointerLock&&this._onMouseMove)this._onMouseMove(t.event);else if(this._previousPosition){const h=this.camera._calculateHandednessMultiplier(),mV=(L.clientX-this._previousPosition.x)*h,t=L.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=mV/this.angularSensibility,this.camera.cameraRotation.x+=t/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:mV,offsetY:t}),this._previousPosition={x:L.clientX,y:L.clientY},V||L.preventDefault()}}),this._onMouseMove=mV=>{if(!h.isPointerLock)return;const t=this.camera._calculateHandednessMultiplier(),L=mV.movementX*t;this.camera.cameraRotation.y+=L/this.angularSensibility;const N=mV.movementY;this.camera.cameraRotation.x+=N/this.angularSensibility,this._previousPosition=null,V||mV.preventDefault()},this._observer=this.camera.DV()._inputManager._addCameraPointerObserver(this._pointerInput,q.b.POINTERDOWN|q.b.POINTERUP|q.b.POINTERMOVE),mV&&(this._contextMenuBind=V=>this.onContextMenu(V),mV.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(V){V.preventDefault()}fn(){if(this._observer){if(this.camera.DV()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,t.e)([(0,L.J)()],x.prototype,"buttons",void 0),(0,t.e)([(0,L.J)()],x.prototype,"angularSensibility",void 0),k.d.FreeCameraMouseInput=x;var R,d=mV(12688);class s{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new n.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(V){V=K.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=h=>{if(h.type!==q.b.POINTERWHEEL)return;const mV=h.event,t=mV.deltaMode===d.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*t*mV.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*t*mV.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*t*mV.deltaZ/this._normalize,mV.preventDefault&&(V||mV.preventDefault())},this._observer=this.camera.DV()._inputManager._addCameraPointerObserver(this._wheel,q.b.POINTERWHEEL)}fn(){this._observer&&(this.camera.DV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,t.e)([(0,L.J)()],s.prototype,"wheelPrecisionX",void 0),(0,t.e)([(0,L.J)()],s.prototype,"wheelPrecisionY",void 0),(0,t.e)([(0,L.J)()],s.prototype,"wheelPrecisionZ",void 0),function(V){V[V.MoveRelative=0]="MoveRelative",V[V.RotateRelative=1]="RotateRelative",V[V.MoveScene=2]="MoveScene"}(R||(R={}));class M extends s{constructor(){super(...arguments),this._moveRelative=N.sh.Zero(),this._rotateRelative=N.sh.Zero(),this._moveScene=N.sh.Zero(),this._wheelXAction=R.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=R.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(V){null===V&&this._wheelXAction!==R.MoveRelative||(this._wheelXAction=R.MoveRelative,this._wheelXActionCoordinate=V)}get wheelXMoveRelative(){return this._wheelXAction!==R.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(V){null===V&&this._wheelYAction!==R.MoveRelative||(this._wheelYAction=R.MoveRelative,this._wheelYActionCoordinate=V)}get wheelYMoveRelative(){return this._wheelYAction!==R.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(V){null===V&&this._wheelZAction!==R.MoveRelative||(this._wheelZAction=R.MoveRelative,this._wheelZActionCoordinate=V)}get wheelZMoveRelative(){return this._wheelZAction!==R.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(V){null===V&&this._wheelXAction!==R.RotateRelative||(this._wheelXAction=R.RotateRelative,this._wheelXActionCoordinate=V)}get wheelXRotateRelative(){return this._wheelXAction!==R.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(V){null===V&&this._wheelYAction!==R.RotateRelative||(this._wheelYAction=R.RotateRelative,this._wheelYActionCoordinate=V)}get wheelYRotateRelative(){return this._wheelYAction!==R.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(V){null===V&&this._wheelZAction!==R.RotateRelative||(this._wheelZAction=R.RotateRelative,this._wheelZActionCoordinate=V)}get wheelZRotateRelative(){return this._wheelZAction!==R.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(V){null===V&&this._wheelXAction!==R.MoveScene||(this._wheelXAction=R.MoveScene,this._wheelXActionCoordinate=V)}get wheelXMoveScene(){return this._wheelXAction!==R.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(V){null===V&&this._wheelYAction!==R.MoveScene||(this._wheelYAction=R.MoveScene,this._wheelYActionCoordinate=V)}get wheelYMoveScene(){return this._wheelYAction!==R.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(V){null===V&&this._wheelZAction!==R.MoveScene||(this._wheelZAction=R.MoveScene,this._wheelZActionCoordinate=V)}get wheelZMoveScene(){return this._wheelZAction!==R.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.lk(0),this._rotateRelative.lk(0),this._moveScene.lk(0),this._updateCamera(),this.camera.DV().useRightHandedSystem&&(this._moveRelative.z*=-1);const V=N.Matrix.Zero();this.camera.getViewMatrix().invertToRef(V);const h=N.sh.Zero();N.sh.TransformNormalToRef(this._moveRelative,V,h),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(h),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(V,h,mV){if(0===V)return;if(null===h||null===mV)return;let t=null;switch(h){case R.MoveRelative:t=this._moveRelative;break;case R.RotateRelative:t=this._rotateRelative;break;case R.MoveScene:t=this._moveScene}switch(mV){case 0:t.set(V,0,0);break;case 1:t.set(0,V,0);break;case 2:t.set(0,0,V)}}}(0,t.e)([(0,L.J)()],M.prototype,"wheelXMoveRelative",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelYMoveRelative",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelZMoveRelative",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelXRotateRelative",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelYRotateRelative",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelZRotateRelative",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelXMoveScene",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelYMoveScene",null),(0,t.e)([(0,L.J)()],M.prototype,"wheelZMoveScene",null),k.d.FreeCameraMouseWheelInput=M;class c{constructor(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=V,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=K.Tools.IsSafari()}attachControl(V){V=K.Tools.BackCompatCameraNoPreventDefault(arguments);let h=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=mV=>{const t=mV.event,L="mouse"===t.pointerType||this._isSafari&&"undefined"===typeof t.pointerType;if(this.allowMouse||!L)if(mV.type===q.b.POINTERDOWN){if(V||t.preventDefault(),this._pointerPressed.push(t.pointerId),1!==this._pointerPressed.length)return;h={x:t.clientX,y:t.clientY}}else if(mV.type===q.b.POINTERUP){V||t.preventDefault();const mV=this._pointerPressed.indexOf(t.pointerId);if(-1===mV)return;if(this._pointerPressed.splice(mV,1),0!=mV)return;h=null,this._offsetX=null,this._offsetY=null}else if(mV.type===q.b.POINTERMOVE){if(V||t.preventDefault(),!h)return;if(0!=this._pointerPressed.indexOf(t.pointerId))return;this._offsetX=t.clientX-h.x,this._offsetY=-(t.clientY-h.y)}}),this._observer=this.camera.DV()._inputManager._addCameraPointerObserver(this._pointerInput,q.b.POINTERDOWN|q.b.POINTERUP|q.b.POINTERMOVE),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.addEventListener("blur",this._onLostFocus)}}fn(){if(this._pointerInput){if(this._observer&&(this.camera.DV()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const V=this.camera.getEngine().getInputElement();V&&V.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const V=this.camera,h=V._calculateHandednessMultiplier();V.cameraRotation.y=h*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)V.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const h=V._computeLocalCameraSpeed(),mV=new N.sh(0,0,0!==this.touchMoveSensibility?h*this._offsetY/this.touchMoveSensibility:0);N.Matrix.RotationYawPitchRollToRef(V.rotation.y,V.rotation.x,0,V._cameraRotationMatrix),V.cameraDirection.addInPlace(N.sh.TransformCoordinates(mV,V._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,t.e)([(0,L.J)()],c.prototype,"touchAngularSensibility",void 0),(0,t.e)([(0,L.J)()],c.prototype,"touchMoveSensibility",void 0),k.d.FreeCameraTouchInput=c;class z extends k.f{constructor(V){super(V),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new o),this}addMouse(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new x(V),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new M,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new c),this}clear(){super.clear(),this._mouseInput=null}}var Q=mV(12388),J=mV(12331);class v extends A.d{get angularSensibility(){const V=this.inputs.attached.mouse;return V?V.angularSensibility:0}set angularSensibility(V){const h=this.inputs.attached.mouse;h&&(h.angularSensibility=V)}get keysUp(){const V=this.inputs.attached.keyboard;return V?V.keysUp:[]}set keysUp(V){const h=this.inputs.attached.keyboard;h&&(h.keysUp=V)}get keysUpward(){const V=this.inputs.attached.keyboard;return V?V.keysUpward:[]}set keysUpward(V){const h=this.inputs.attached.keyboard;h&&(h.keysUpward=V)}get keysDown(){const V=this.inputs.attached.keyboard;return V?V.keysDown:[]}set keysDown(V){const h=this.inputs.attached.keyboard;h&&(h.keysDown=V)}get keysDownward(){const V=this.inputs.attached.keyboard;return V?V.keysDownward:[]}set keysDownward(V){const h=this.inputs.attached.keyboard;h&&(h.keysDownward=V)}get keysLeft(){const V=this.inputs.attached.keyboard;return V?V.keysLeft:[]}set keysLeft(V){const h=this.inputs.attached.keyboard;h&&(h.keysLeft=V)}get keysRight(){const V=this.inputs.attached.keyboard;return V?V.keysRight:[]}set keysRight(V){const h=this.inputs.attached.keyboard;h&&(h.keysRight=V)}get keysRotateLeft(){const V=this.inputs.attached.keyboard;return V?V.keysRotateLeft:[]}set keysRotateLeft(V){const h=this.inputs.attached.keyboard;h&&(h.keysRotateLeft=V)}get keysRotateRight(){const V=this.inputs.attached.keyboard;return V?V.keysRotateRight:[]}set keysRotateRight(V){const h=this.inputs.attached.keyboard;h&&(h.keysRotateRight=V)}get keysRotateUp(){const V=this.inputs.attached.keyboard;return V?V.keysRotateUp:[]}set keysRotateUp(V){const h=this.inputs.attached.keyboard;h&&(h.keysRotateUp=V)}get keysRotateDown(){const V=this.inputs.attached.keyboard;return V?V.keysRotateDown:[]}set keysRotateDown(V){const h=this.inputs.attached.keyboard;h&&(h.keysRotateDown=V)}constructor(V,h,mV){var t;super(V,h,mV,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),t=this,this.ellipsoid=new N.sh(.5,1,.5),this.ellipsoidOffset=new N.sh(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=N.sh.Zero(),this._diffPosition=N.sh.Zero(),this._newPosition=N.sh.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t._newPosition.t(h),t._newPosition.subtractToRef(t._oldPosition,t._diffPosition),t._diffPosition.length()>J.b.CollisionsEpsilon&&(t.position.addToRef(t._diffPosition,t._deferredPositionUpdate),t._deferOnly?t._deferredUpdated=!0:t.position.t(t._deferredPositionUpdate),t.vx&&mV&&t.vx(mV))},this.inputs=new z(this),this.inputs.addKeyboard().addMouse()}attachControl(V,h){h=K.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(h)}fn(){this.inputs.detachElement(),this.cameraDirection=new N.sh(0,0,0),this.cameraRotation=new N.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(V){this._collisionMask=isNaN(V)?-1:V}_collideWithWorld(V){let h;h=this.parent?N.sh.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,h.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const mV=this.DV().collisionCoordinator;this._collider||(this._collider=mV.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let t=V;this.applyGravity&&(t=V.add(this.DV().gravity)),mV.getNewPosition(this._oldPosition,t,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=N.sh.Zero(),this._transformedDirection=N.sh.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(V){this._needMoveForGravity=V}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.DV().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Nd"}}(0,t.e)([(0,L.I)()],v.prototype,"ellipsoid",void 0),(0,t.e)([(0,L.I)()],v.prototype,"ellipsoidOffset",void 0),(0,t.e)([(0,L.J)()],v.prototype,"checkCollisions",void 0),(0,t.e)([(0,L.J)()],v.prototype,"applyGravity",void 0),(0,Q.i)("BABYLON.FreeCamera",v)},14594:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>N});var t=mV(12507),L=mV(14599);class N{constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=mV,this.mq=[],this._maxBlockCapacity=h||64,this._selectionContent=new t.c(1024),this._creationFunc=V}update(V,h,mV){L.e._CreateBlocks(V,h,mV,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ko(V){for(let h=0;h<this.zo.length;h++){this.zo[h].addEntry(V)}}Ao(V){for(let h=0;h<this.zo.length;h++){this.zo[h].removeEntry(V)}}select(V,h){this._selectionContent.reset();for(let mV=0;mV<this.zo.length;mV++){this.zo[mV].select(V,this._selectionContent,h)}return h?this._selectionContent.concat(this.mq):this._selectionContent.concatWithNoDuplicate(this.mq),this._selectionContent}intersects(V,h,mV){this._selectionContent.reset();for(let t=0;t<this.zo.length;t++){this.zo[t].intersects(V,h,this._selectionContent,mV)}return mV?this._selectionContent.concat(this.mq):this._selectionContent.concatWithNoDuplicate(this.mq),this._selectionContent}intersectsRay(V){this._selectionContent.reset();for(let h=0;h<this.zo.length;h++){this.zo[h].intersectsRay(V,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.mq),this._selectionContent}}N.CreationFuncForMeshes=(V,h)=>{const mV=V.getBoundingInfo();!V.isBlocked&&mV.boundingBox.intersectsMinMax(h.kn,h.Cn)&&h.entries.push(V)},N.CreationFuncForSubMeshes=(V,h)=>{V.getBoundingInfo().boundingBox.intersectsMinMax(h.kn,h.Cn)&&h.entries.push(V)}},14599:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>N});var t=mV(12422),L=mV(12738);class N{constructor(V,h,mV,t,L,N){this.entries=[],this.Kn=new Array,this._capacity=mV,this._depth=t,this._maxDepth=L,this._creationFunc=N,this._minPoint=V,this._maxPoint=h,this.Kn.push(V.clone()),this.Kn.push(h.clone()),this.Kn.push(V.clone()),this.Kn[2].x=h.x,this.Kn.push(V.clone()),this.Kn[3].y=h.y,this.Kn.push(V.clone()),this.Kn[4].z=h.z,this.Kn.push(h.clone()),this.Kn[5].z=V.z,this.Kn.push(h.clone()),this.Kn[6].x=V.x,this.Kn.push(h.clone()),this.Kn[7].y=V.y}get jm(){return this._capacity}get kn(){return this._minPoint}get Cn(){return this._maxPoint}addEntry(V){if(this.zo)for(let h=0;h<this.zo.length;h++){this.zo[h].addEntry(V)}else this._creationFunc(V,this),this.entries.length>this.jm&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(V){if(this.zo){for(let h=0;h<this.zo.length;h++){this.zo[h].removeEntry(V)}return}const h=this.entries.indexOf(V);h>-1&&this.entries.splice(h,1)}addEntries(V){for(let h=0;h<V.length;h++){const mV=V[h];this.addEntry(mV)}}select(V,h,mV){if(L.e.IsInFrustum(this.Kn,V)){if(this.zo){for(let t=0;t<this.zo.length;t++){this.zo[t].select(V,h,mV)}return}mV?h.concat(this.entries):h.concatWithNoDuplicate(this.entries)}}intersects(V,h,mV,t){if(L.e.IntersectsSphere(this._minPoint,this._maxPoint,V,h)){if(this.zo){for(let L=0;L<this.zo.length;L++){this.zo[L].intersects(V,h,mV,t)}return}t?mV.concat(this.entries):mV.concatWithNoDuplicate(this.entries)}}intersectsRay(V,h){if(V.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.zo){for(let mV=0;mV<this.zo.length;mV++){this.zo[mV].intersectsRay(V,h)}return}h.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){N._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(V,h,mV,L,A,k,C,K){C.zo=new Array;const o=new t.sh((h.x-V.x)/2,(h.y-V.y)/2,(h.z-V.z)/2);for(let t=0;t<2;t++)for(let h=0;h<2;h++)for(let n=0;n<2;n++){const q=V.add(o.multiplyByFloats(t,h,n)),x=V.add(o.multiplyByFloats(t+1,h+1,n+1)),R=new N(q,x,L,A+1,k,K);R.addEntries(mV),C.zo.push(R)}}}},14605:(V,h,mV)=>{"use strict";mV.d(h,{b:()=>o});var t=mV(12648),L=mV(12422),N=mV(12811),A=mV(13809),k=mV(12674),C=mV(14594),K=mV(12300);t.d.prototype.createOrUpdateSelectionOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,mV=this._getComponent(k.b.NAME_OCTREE);mV||(mV=new o(this),this.o(mV)),this.Vn||(this.Vn=new C.e(C.e.CreationFuncForMeshes,V,h));const t=this.getWorldExtends();return this.Vn.update(t.min,t.max,this.meshes),this.Vn},Object.defineProperty(t.d.prototype,"selectionOctree",{get:function(){return this.Vn},enumerable:!0,configurable:!0}),N.e.prototype.createOrUpdateSubmeshesOctree=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const mV=this.DV();let t=mV._getComponent(k.b.NAME_OCTREE);t||(t=new o(mV),mV.o(t)),this._submeshesOctree||(this._submeshesOctree=new C.e(C.e.CreationFuncForSubMeshes,V,h)),this.Qk(!0);const L=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(L.minimumWorld,L.maximumWorld,this.dk),this._submeshesOctree};class o{constructor(V){this.name=k.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new A.e(L.sh.Zero(),new L.sh(1,1,1)),(V=V||K.b.LastCreatedScene)&&(this.zh=V,this.zh.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.zh.getActiveSubMeshCandidates=V=>this.getActiveSubMeshCandidates(V),this.zh.getCollidingSubMeshCandidates=(V,h)=>this.getCollidingSubMeshCandidates(V,h),this.zh.getIntersectingSubMeshCandidates=(V,h)=>this.getIntersectingSubMeshCandidates(V,h))}register(){this.zh.onMeshRemovedObservable.add((V=>{const h=this.zh.selectionOctree;if(void 0!==h&&null!==h){const mV=h.mq.indexOf(V);-1!==mV&&h.mq.splice(mV,1)}})),this.zh.onMeshImportedObservable.add((V=>{const h=this.zh.selectionOctree;void 0!==h&&null!==h&&h.ko(V)}))}getActiveMeshCandidates(){var V;return(null===(V=this.zh.Vn)||void 0===V?void 0:V.select(this.zh.frustumPlanes))||this.zh._getDefaultMeshCandidates()}getActiveSubMeshCandidates(V){if(V._submeshesOctree&&V.useOctreeForRenderingSelection){return V._submeshesOctree.select(this.zh.frustumPlanes)}return this.zh._getDefaultSubMeshCandidates(V)}getIntersectingSubMeshCandidates(V,h){if(V._submeshesOctree&&V.useOctreeForPicking){A.e.TransformToRef(h,V.getWorldMatrix(),this._tempRay);return V._submeshesOctree.intersectsRay(this._tempRay)}return this.zh._getDefaultSubMeshCandidates(V)}getCollidingSubMeshCandidates(V,h){if(V._submeshesOctree&&V.useOctreeForCollisions){const mV=h._velocityWorldLength+Math.max(h._radius.x,h._radius.y,h._radius.z);return V._submeshesOctree.intersects(h._basePointWorld,mV)}return this.zh._getDefaultSubMeshCandidates(V)}rebuild(){}dispose(){}}},13809:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>x});var t=mV(12648),L=mV(12838),N=mV(12425),A=mV(12422),k=mV(12433),C=mV(12730),K=mV(12670),o=mV(12300),n=mV(12693);const q={internalPickerForMesh:void 0};class x{constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:N.c;this.origin=V,this.direction=h,this.length=mV,this.epsilon=t}clone(){return new x(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const t=x._TmpVector3[0].Hk(V.x-mV,V.y-mV,V.z-mV),L=x._TmpVector3[1].Hk(h.x+mV,h.y+mV,h.z+mV);let N,A,k,C,K=0,o=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>L.x)return!1}else if(N=1/this.direction.x,A=(t.x-this.origin.x)*N,k=(L.x-this.origin.x)*N,k===-1/0&&(k=1/0),A>k&&(C=A,A=k,k=C),K=Math.max(A,K),o=Math.min(k,o),K>o)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>L.y)return!1}else if(N=1/this.direction.y,A=(t.y-this.origin.y)*N,k=(L.y-this.origin.y)*N,k===-1/0&&(k=1/0),A>k&&(C=A,A=k,k=C),K=Math.max(A,K),o=Math.min(k,o),K>o)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>L.z)return!1}else if(N=1/this.direction.z,A=(t.z-this.origin.z)*N,k=(L.z-this.origin.z)*N,k===-1/0&&(k=1/0),A>k&&(C=A,A=k,k=C),K=Math.max(A,K),o=Math.min(k,o),K>o)return!1;return!0}intersectsBox(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(V.minimum,V.maximum,h)}intersectsSphere(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const mV=V.center.x-this.origin.x,t=V.center.y-this.origin.y,L=V.center.z-this.origin.z,N=mV*mV+t*t+L*L,A=V.radius+h,k=A*A;if(N<=k)return!0;const C=mV*this.direction.x+t*this.direction.y+L*this.direction.z;if(C<0)return!1;return N-C*C<=k}intersectsTriangle(V,h,mV){const t=x._TmpVector3[0],L=x._TmpVector3[1],N=x._TmpVector3[2],k=x._TmpVector3[3],K=x._TmpVector3[4];h.subtractToRef(V,t),mV.subtractToRef(V,L),A.sh.CrossToRef(this.direction,L,N);const o=A.sh.Dot(t,N);if(0===o)return null;const n=1/o;this.origin.subtractToRef(V,k);const q=A.sh.Dot(k,N)*n;if(q<-this.epsilon||q>1+this.epsilon)return null;A.sh.CrossToRef(k,t,K);const R=A.sh.Dot(this.direction,K)*n;if(R<-this.epsilon||q+R>1+this.epsilon)return null;const d=A.sh.Dot(L,K)*n;return d>this.length?null:new C.e(1-q-R,q,d)}intersectsPlane(V){let h;const mV=A.sh.Dot(V.normal,this.direction);if(Math.abs(mV)<9.99999997475243e-7)return null;{const t=A.sh.Dot(V.normal,this.origin);return h=(-V.d-t)/mV,h<0?h<-9.99999997475243e-7?null:0:h}}intersectsAxis(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(V){case"y":{const V=(this.origin.y-h)/this.direction.y;return V>0?null:new A.sh(this.origin.x+this.direction.x*-V,h,this.origin.z+this.direction.z*-V)}case"x":{const V=(this.origin.x-h)/this.direction.x;return V>0?null:new A.sh(h,this.origin.y+this.direction.y*-V,this.origin.z+this.direction.z*-V)}case"z":{const V=(this.origin.z-h)/this.direction.z;return V>0?null:new A.sh(this.origin.x+this.direction.x*-V,this.origin.y+this.direction.y*-V,h)}default:return null}}intersectsMesh(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=A.TmpVectors.Matrix[0];return V.getWorldMatrix().invertToRef(k),this._tmpRay?x.TransformToRef(this,k,this._tmpRay):this._tmpRay=x.Transform(this,k),V.intersects(this._tmpRay,h,mV,t,L,N)}intersectsMeshes(V,h,mV){mV?mV.length=0:mV=[];for(let t=0;t<V.length;t++){const L=this.intersectsMesh(V[t],h);L.hit&&mV.push(L)}return mV.sort(this._comparePickingInfo),mV}_comparePickingInfo(V,h){return V.distance<h.distance?-1:V.distance>h.distance?1:0}intersectionSegment(V,h,mV){const t=this.origin,L=A.TmpVectors.sh[0],N=A.TmpVectors.sh[1],k=A.TmpVectors.sh[2],C=A.TmpVectors.sh[3];h.subtractToRef(V,L),this.direction.scaleToRef(x._Rayl,k),t.addToRef(k,N),V.subtractToRef(t,C);const K=A.sh.Dot(L,L),o=A.sh.Dot(L,k),n=A.sh.Dot(k,k),q=A.sh.Dot(L,C),R=A.sh.Dot(k,C),d=K*n-o*o;let s,M,c=d,z=d;d<x._Smallnum?(s=0,c=1,M=R,z=n):(s=o*R-n*q,M=K*R-o*q,s<0?(s=0,M=R,z=n):s>c&&(s=c,M=R+o,z=n)),M<0?(M=0,-q<0?s=0:-q>K?s=c:(s=-q,c=K)):M>z&&(M=z,-q+o<0?s=0:-q+o>K?s=c:(s=-q+o,c=K));const Q=Math.abs(s)<x._Smallnum?0:s/c,J=Math.abs(M)<x._Smallnum?0:M/z,v=A.TmpVectors.sh[4];k.scaleToRef(J,v);const D=A.TmpVectors.sh[5];L.scaleToRef(Q,D),D.addInPlace(C);const H=A.TmpVectors.sh[6];D.subtractToRef(v,H);return J>0&&J<=this.length&&H.lengthSquared()<mV*mV?D.length():-1}update(V,h,mV,t,L,N,k){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){x._RayDistant||(x._RayDistant=x.Zero()),x._RayDistant.unprojectRayToRef(V,h,mV,t,A.Matrix.IdentityReadOnly,N,k);const C=A.TmpVectors.Matrix[0];L.invertToRef(C),x.TransformToRef(x._RayDistant,C,this)}else this.unprojectRayToRef(V,h,mV,t,L,N,k);return this}static Zero(){return new x(A.sh.Zero(),A.sh.Zero())}static CreateNew(V,h,mV,t,L,N,A){return x.Zero().update(V,h,mV,t,L,N,A)}static CreateNewFromTo(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.Matrix.IdentityReadOnly;const t=new x(new A.sh(0,0,0),new A.sh(0,0,0));return x.CreateFromToToRef(V,h,t,mV)}static CreateFromToToRef(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:A.Matrix.IdentityReadOnly;mV.origin.t(V);const L=h.subtractToRef(V,mV.direction),N=Math.sqrt(L.x*L.x+L.y*L.y+L.z*L.z);return mV.length=N,mV.direction.normalize(),x.TransformToRef(mV,t,mV)}static Transform(V,h){const mV=new x(new A.sh(0,0,0),new A.sh(0,0,0));return x.TransformToRef(V,h,mV),mV}static TransformToRef(V,h,mV){A.sh.TransformCoordinatesToRef(V.origin,h,mV.origin),A.sh.TransformNormalToRef(V.direction,h,mV.direction),mV.length=V.length,mV.epsilon=V.epsilon;const t=mV.direction,L=t.length();if(0!==L&&1!==L){const V=1/L;t.x*=V,t.y*=V,t.z*=V,mV.length*=L}return mV}unprojectRayToRef(V,h,mV,t,L,N,k){const C=A.TmpVectors.Matrix[0];L.multiplyToRef(N,C),C.multiplyToRef(k,C),C.invert();const K=o.b.LastCreatedEngine,n=A.TmpVectors.sh[0];n.x=V/mV*2-1,n.y=-(h/t*2-1),n.z=null!==K&&void 0!==K&&K.bh?1:null!==K&&void 0!==K&&K.isNDCHalfZRange?0:-1;const q=A.TmpVectors.sh[1].Hk(n.x,n.y,1-1e-8),x=A.TmpVectors.sh[2],R=A.TmpVectors.sh[3];A.sh._UnprojectFromInvertedMatrixToRef(n,C,x),A.sh._UnprojectFromInvertedMatrixToRef(q,C,R),this.origin.t(x),R.subtractToRef(x,this.direction),this.direction.normalize()}}function R(V,h,mV,t,L){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=x.Zero();return d(V,h,mV,t,A,L,N),A}function d(V,h,mV,t,L,N){let k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const K=V.getEngine();if(!N&&!(N=V.activeCamera))return V;const o=N.viewport,n=K.getRenderHeight(),{x:q,y:x,width:R,height:d}=o.toGlobal(K.getRenderWidth(),n),s=1/K.getHardwareScalingLevel();return h=h*s-q,mV=mV*s-(n-x-d),L.update(h,mV,R,d,t||A.Matrix.IdentityReadOnly,k?A.Matrix.IdentityReadOnly:N.getViewMatrix(),N.getProjectionMatrix(),C),V}function s(V,h,mV,t,L){if(!K.e)return V;const N=V.getEngine();if(!L&&!(L=V.activeCamera))throw new Error("Active camera not set");const k=L.viewport,C=N.getRenderHeight(),{x:o,y:n,width:q,height:x}=k.toGlobal(N.getRenderWidth(),C),R=A.Matrix.Identity(),d=1/N.getHardwareScalingLevel();return h=h*d-o,mV=mV*d-(C-n-x),t.update(h,mV,q,x,R,R,L.getProjectionMatrix()),V}function M(V,h,mV,t,L,N,A,k){const C=h(t,mV.enableDistantPicking),K=mV.intersects(C,L,A,N,t,k);return K&&K.hit?!L&&null!=V&&K.distance>=V.distance?null:K:null}function c(V,h,mV,t,L,N){let k=null;const C=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),o=V.cameraToUseForPointers||V.activeCamera,n=q.internalPickerForMesh||M;for(let K=0;K<V.meshes.length;K++){const q=V.meshes[K];if(mV){if(!mV(q,-1))continue}else if(!q.isEnabled()||!q.isVisible||!q.gC)continue;const x=C&&q.isWorldMatrixCameraDependent(),R=q.Qk(x,o);if(q.hasThinInstances&&q.JK){const V=n(k,h,q,R,!0,!0,N);if(V){if(L)return V;const C=A.TmpVectors.Matrix[1],K=q.thinInstanceGetWorldMatrices();for(let V=0;V<K.length;V++){if(mV&&!mV(q,V))continue;K[V].multiplyToRef(R,C);const A=n(k,h,q,C,t,L,N,!0);if(A&&(k=A,k.thinInstanceIndex=V,t))return k}}}else{const V=n(k,h,q,R,t,L,N);if(V&&(k=V,t))return k}}return k||new K.e}function z(V,h,mV,t){if(!K.e)return null;const L=[],N=!!(V.activeCameras&&V.activeCameras.length>1&&V.cameraToUseForPointers!==V.activeCamera),k=V.cameraToUseForPointers||V.activeCamera,C=q.internalPickerForMesh||M;for(let K=0;K<V.meshes.length;K++){const o=V.meshes[K];if(mV){if(!mV(o,-1))continue}else if(!o.isEnabled()||!o.isVisible||!o.gC)continue;const n=N&&o.isWorldMatrixCameraDependent(),q=o.Qk(n,k);if(o.hasThinInstances&&o.JK){if(C(null,h,o,q,!0,!0,t)){const V=A.TmpVectors.Matrix[1],N=o.thinInstanceGetWorldMatrices();for(let A=0;A<N.length;A++){if(mV&&!mV(o,A))continue;N[A].multiplyToRef(q,V);const k=C(null,h,o,V,!1,!1,t,!0);k&&(k.thinInstanceIndex=A,L.push(k))}}}else{const V=C(null,h,o,q,!1,!1,t);V&&L.push(V)}}return L}function Q(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,t=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;t||(t=V.getWorldMatrix()),h.length=mV,L?h.origin.t(L):h.origin.t(V.position);const N=A.TmpVectors.sh[2];N.set(0,0,V._scene.useRightHandedSystem?-1:1);const k=A.TmpVectors.sh[3];return A.sh.TransformNormalToRef(N,t,k),A.sh.NormalizeToRef(k,h.direction),h}var J,v;x._TmpVector3=(0,k.c)(6,A.sh.Zero),x._RayDistant=x.Zero(),x._Smallnum=1e-8,x._Rayl=1e9,J=t.d,(v=L.b)&&(v.prototype.getForwardRay=function(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,h=arguments.length>1?arguments[1]:void 0,mV=arguments.length>2?arguments[2]:void 0;return Q(this,new x(A.sh.Zero(),A.sh.Zero(),V),V,h,mV)},v.prototype.getForwardRayToRef=function(V){return Q(this,V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),J&&(n.c._IsPickingAvailable=!0,J.prototype.createPickingRay=function(V,h,mV,t){return R(this,V,h,mV,t,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),t.d.prototype.createPickingRayToRef=function(V,h,mV,t,L){return d(this,V,h,mV,t,L,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},t.d.prototype.createPickingRayInCameraSpace=function(V,h,mV){return function(V,h,mV,t){const L=x.Zero();return s(V,h,mV,L,t),L}(this,V,h,mV)},t.d.prototype.createPickingRayInCameraSpaceToRef=function(V,h,mV,t){return s(this,V,h,mV,t)},t.d.prototype.pickWithBoundingInfo=function(V,h,mV,t,L){return function(V,h,mV,t,L,N){if(!K.e)return null;const k=c(V,(t=>(V._tempPickingRay||(V._tempPickingRay=x.Zero()),d(V,h,mV,t,V._tempPickingRay,N||null),V._tempPickingRay)),t,L,!0);return k&&(k.ray=R(V,h,mV,A.Matrix.Identity(),N||null)),k}(this,V,h,mV,t,L)},t.d.prototype.vm=function(V,h,mV,t,L,N){return function(V,h,mV,t,L,N,k){const C=c(V,((t,L)=>(V._tempPickingRay||(V._tempPickingRay=x.Zero()),d(V,h,mV,t,V._tempPickingRay,N||null,!1,L),V._tempPickingRay)),t,L,!1,k);return C&&(C.ray=R(V,h,mV,A.Matrix.Identity(),N||null)),C}(this,V,h,mV,t,L,N)},t.d.prototype.pickWithRay=function(V,h,mV,t){return function(V,h,mV,t,L){const N=c(V,(mV=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=A.Matrix.Identity()),mV.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=x.Zero()),x.TransformToRef(h,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),mV,t,!1,L);return N&&(N.ray=h),N}(this,V,h,mV,t)},t.d.prototype.multiPick=function(V,h,mV,t,L){return function(V,h,mV,t,L,N){return z(V,(t=>R(V,h,mV,t,L||null)),t,N)}(this,V,h,mV,t,L)},t.d.prototype.multiPickWithRay=function(V,h,mV){return function(V,h,mV,t){return z(V,(mV=>(V._pickWithRayInverseMatrix||(V._pickWithRayInverseMatrix=A.Matrix.Identity()),mV.invertToRef(V._pickWithRayInverseMatrix),V._cachedRayForTransform||(V._cachedRayForTransform=x.Zero()),x.TransformToRef(h,V._pickWithRayInverseMatrix,V._cachedRayForTransform),V._cachedRayForTransform)),mV,t)}(this,V,h,mV)}},14082:(V,h,mV)=>{"use strict";var t=mV(12359),L=mV(12264),N=mV(12303),A=mV(12393),k=mV(12331),C=mV(12371);k.b.prototype._partialLoadFile=function(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(V,(V=>{mV[h]=V,mV._internalCount++,6===mV._internalCount&&t(mV)}),void 0,void 0,!0,((V,h)=>{L&&V&&L(V.status+" "+V.statusText,h)}))},k.b.prototype._cascadeLoadFiles=function(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const L=[];L._internalCount=0;for(let N=0;N<6;N++)this._partialLoadFile(mV[N],N,L,h,t)},k.b.prototype._cascadeLoadImgs=function(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5?arguments[5]:void 0;const A=[];A._internalCount=0;for(let k=0;k<6;k++)this._partialLoadImg(t[k],k,A,V,h,mV,L,N)},k.b.prototype._partialLoadImg=function(V,h,mV,t,L,k){let C=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7?arguments[7]:void 0;const o=(0,A.b)();(0,N.x)(V,(V=>{mV[h]=V,mV._internalCount++,t&&t.removePendingData(o),6===mV._internalCount&&k&&k(L,mV)}),((V,h)=>{t&&t.removePendingData(o),C&&C(V,h)}),t?t.offlineProvider:null,K),t&&t.addPendingData(o)},k.b.prototype.createCubeTextureBase=function(V,h,mV,N){let A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6?arguments[6]:void 0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,s=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,M=arguments.length>14&&void 0!==arguments[14]&&arguments[14],c=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const z=R||new t.d(this,7);z.isCube=!0,z.url=V,z.generateMipMaps=!N,z._lodGenerationScale=q,z._lodGenerationOffset=x,z._useSRGBBuffer=!!M&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!N),z!==R&&(z.label=V.substring(0,60)),this._doNotHandleContextLost||(z._extension=o,z._files=mV,z._buffer=c);const Q=V;this._transformTextureUrl&&!R&&(V=this._transformTextureUrl(V));const J=o??function(V){const h=V.split("?")[0],mV=h.lastIndexOf(".");return mV>-1?h.substring(mV).toLowerCase():""}(V),v=(0,C.b)(J),D=(V,h)=>{z.dispose(),k?k(V,h):V&&L.e.Warn(V)},H=(t,k)=>{V===Q?t&&D(t.status+" "+t.statusText,k):(L.e.Warn(`Failed to load ${V}, falling back to the ${Q}`),this.createCubeTextureBase(Q,h,mV,!!N,A,D,K,o,n,q,x,z,d,s,M,c))};if(v)v.then((t=>{const L=V=>{d&&d(z,V),t.loadCubeData(V,z,n,A,((V,h)=>{D(V,h)}))};c?L(c):mV&&6===mV.length?t.supportCascades?this._cascadeLoadFiles(h,(V=>L(V.map((V=>new Uint8Array(V))))),mV,D):D("Textures type does not support cascades."):this._loadFile(V,(V=>L(new Uint8Array(V))),void 0,void 0,!0,H)}));else{if(!mV||0===mV.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(h,z,((V,h)=>{s&&s(V,h)}),mV,D)}return this._internalTexturesCache.push(z),z}},14610:(V,h,mV)=>{"use strict";mV(12264);var t=mV(12544);mV(12359),mV(12487),mV(12352),mV(12590),mV(12556);t.c},14102:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>L});var t=mV(12388);class L{constructor(V){this.value=this._toInt(V)}_toInt(V){return 0|V}add(V){return new L(this.value+V.value)}Mh(V){return new L(this.value-V.value)}multiply(V){return new L(Math.imul(this.value,V.value))}divide(V){return new L(this.value/V.value)}getClassName(){return L.ClassName}equals(V){return this.value===V.value}static FromValue(V){return new L(V)}toString(){return this.value.toString()}}L.ClassName="FlowGraphInteger",(0,t.i)("FlowGraphInteger",L)},14111:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>L,i:()=>N});var t=mV(12422);class L{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Kk=V}get m(){return this.Kk}transformVector(V){return this.transformVectorToRef(V,new t.Vector2)}transformVectorToRef(V,h){return h.x=V.x*this.Kk[0]+V.y*this.Kk[1],h.y=V.x*this.Kk[2]+V.y*this.Kk[3],h}sk(){return this.toArray()}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<4;h++)V[h]=this.Kk[h];return V}Dm(V){for(let h=0;h<4;h++)this.Kk[h]=V[h];return this}multiplyToRef(V,h){const mV=V.Kk,t=this.Kk,L=h.Kk;return L[0]=mV[0]*t[0]+mV[1]*t[2],L[1]=mV[0]*t[1]+mV[1]*t[3],L[2]=mV[2]*t[0]+mV[3]*t[2],L[3]=mV[2]*t[1]+mV[3]*t[3],h}multiply(V){return this.multiplyToRef(V,new L)}divideToRef(V,h){const mV=this.Kk,t=V.Kk,L=h.Kk;return L[0]=mV[0]/t[0],L[1]=mV[1]/t[1],L[2]=mV[2]/t[2],L[3]=mV[3]/t[3],h}divide(V){return this.divideToRef(V,new L)}addToRef(V,h){const mV=this.Kk,t=V.m,L=h.m;return L[0]=mV[0]+t[0],L[1]=mV[1]+t[1],L[2]=mV[2]+t[2],L[3]=mV[3]+t[3],h}add(V){return this.addToRef(V,new L)}subtractToRef(V,h){const mV=this.Kk,t=V.m,L=h.m;return L[0]=mV[0]-t[0],L[1]=mV[1]-t[1],L[2]=mV[2]-t[2],L[3]=mV[3]-t[3],h}Mh(V){return this.subtractToRef(V,new L)}transpose(){const V=this.Kk;return new L([V[0],V[2],V[1],V[3]])}determinant(){const V=this.Kk;return V[0]*V[3]-V[1]*V[2]}inverse(){const V=this.determinant();if(0===V)throw new Error("Matrix is not invertible");const h=this.Kk,mV=1/V;return new L([h[3]*mV,-h[1]*mV,-h[2]*mV,h[0]*mV])}equals(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const mV=this.Kk,t=V.m;return 0===h?mV[0]===t[0]&&mV[1]===t[1]&&mV[2]===t[2]&&mV[3]===t[3]:Math.abs(mV[0]-t[0])<h&&Math.abs(mV[1]-t[1])<h&&Math.abs(mV[2]-t[2])<h&&Math.abs(mV[3]-t[3])<h}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Kk.join(", ")})`}}class N{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Kk=V}get m(){return this.Kk}transformVector(V){return this.transformVectorToRef(V,new t.sh)}transformVectorToRef(V,h){const mV=this.Kk;return h.x=V.x*mV[0]+V.y*mV[1]+V.z*mV[2],h.y=V.x*mV[3]+V.y*mV[4]+V.z*mV[5],h.z=V.x*mV[6]+V.y*mV[7]+V.z*mV[8],h}multiplyToRef(V,h){const mV=V.Kk,t=this.Kk,L=h.m;return L[0]=mV[0]*t[0]+mV[1]*t[3]+mV[2]*t[6],L[1]=mV[0]*t[1]+mV[1]*t[4]+mV[2]*t[7],L[2]=mV[0]*t[2]+mV[1]*t[5]+mV[2]*t[8],L[3]=mV[3]*t[0]+mV[4]*t[3]+mV[5]*t[6],L[4]=mV[3]*t[1]+mV[4]*t[4]+mV[5]*t[7],L[5]=mV[3]*t[2]+mV[4]*t[5]+mV[5]*t[8],L[6]=mV[6]*t[0]+mV[7]*t[3]+mV[8]*t[6],L[7]=mV[6]*t[1]+mV[7]*t[4]+mV[8]*t[7],L[8]=mV[6]*t[2]+mV[7]*t[5]+mV[8]*t[8],h}multiply(V){return this.multiplyToRef(V,new N)}divideToRef(V,h){const mV=this.Kk,t=V.m,L=h.m;return L[0]=mV[0]/t[0],L[1]=mV[1]/t[1],L[2]=mV[2]/t[2],L[3]=mV[3]/t[3],L[4]=mV[4]/t[4],L[5]=mV[5]/t[5],L[6]=mV[6]/t[6],L[7]=mV[7]/t[7],L[8]=mV[8]/t[8],h}divide(V){return this.divideToRef(V,new N)}addToRef(V,h){const mV=this.Kk,t=V.m,L=h.m;return L[0]=mV[0]+t[0],L[1]=mV[1]+t[1],L[2]=mV[2]+t[2],L[3]=mV[3]+t[3],L[4]=mV[4]+t[4],L[5]=mV[5]+t[5],L[6]=mV[6]+t[6],L[7]=mV[7]+t[7],L[8]=mV[8]+t[8],h}add(V){return this.addToRef(V,new N)}subtractToRef(V,h){const mV=this.Kk,t=V.m,L=h.m;return L[0]=mV[0]-t[0],L[1]=mV[1]-t[1],L[2]=mV[2]-t[2],L[3]=mV[3]-t[3],L[4]=mV[4]-t[4],L[5]=mV[5]-t[5],L[6]=mV[6]-t[6],L[7]=mV[7]-t[7],L[8]=mV[8]-t[8],h}Mh(V){return this.subtractToRef(V,new N)}toArray(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let h=0;h<9;h++)V[h]=this.Kk[h];return V}sk(){return this.toArray()}Dm(V){for(let h=0;h<9;h++)this.Kk[h]=V[h];return this}transpose(){const V=this.Kk;return new N([V[0],V[3],V[6],V[1],V[4],V[7],V[2],V[5],V[8]])}determinant(){const V=this.Kk;return V[0]*(V[4]*V[8]-V[5]*V[7])-V[1]*(V[3]*V[8]-V[5]*V[6])+V[2]*(V[3]*V[7]-V[4]*V[6])}inverse(){const V=this.determinant();if(0===V)throw new Error("Matrix is not invertible");const h=this.Kk,mV=1/V;return new N([(h[4]*h[8]-h[5]*h[7])*mV,(h[2]*h[7]-h[1]*h[8])*mV,(h[1]*h[5]-h[2]*h[4])*mV,(h[5]*h[6]-h[3]*h[8])*mV,(h[0]*h[8]-h[2]*h[6])*mV,(h[2]*h[3]-h[0]*h[5])*mV,(h[3]*h[7]-h[4]*h[6])*mV,(h[1]*h[6]-h[0]*h[7])*mV,(h[0]*h[4]-h[1]*h[3])*mV])}equals(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const mV=this.Kk,t=V.m;return 0===h?mV[0]===t[0]&&mV[1]===t[1]&&mV[2]===t[2]&&mV[3]===t[3]&&mV[4]===t[4]&&mV[5]===t[5]&&mV[6]===t[6]&&mV[7]===t[7]&&mV[8]===t[8]:Math.abs(mV[0]-t[0])<h&&Math.abs(mV[1]-t[1])<h&&Math.abs(mV[2]-t[2])<h&&Math.abs(mV[3]-t[3])<h&&Math.abs(mV[4]-t[4])<h&&Math.abs(mV[5]-t[5])<h&&Math.abs(mV[6]-t[6])<h&&Math.abs(mV[7]-t[7])<h&&Math.abs(mV[8]-t[8])<h}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Kk.join(", ")})`}}},14115:(V,h,mV)=>{"use strict";var t;function L(V,h,mV,t){switch(h){case"Animation":return t?V.animations.find((V=>V.uniqueId===mV))??null:V.animations[mV]??null;case"AnimationGroup":return t?V.animationGroups.find((V=>V.uniqueId===mV))??null:V.animationGroups[mV]??null;case"Mesh":return t?V.meshes.find((V=>V.uniqueId===mV))??null:V.meshes[mV]??null;case"Material":return t?V.materials.find((V=>V.uniqueId===mV))??null:V.materials[mV]??null;case"do":return t?V.cameras.find((V=>V.uniqueId===mV))??null:V.cameras[mV]??null;case"Light":return t?V.lights.find((V=>V.uniqueId===mV))??null:V.lights[mV]??null;default:return null}}mV.d(h,{b:()=>L}),function(V){V.Animation="Animation",V.AnimationGroup="AnimationGroup",V.Mesh="Mesh",V.Material="Material",V.do="do",V.Light="Light"}(t||(t={}))},14140:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>L});var t=mV(14144);class L extends t.c{constructor(V,h){if(super(V),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),h)for(const mV of h)this._eventsSignalOutputs[mV]=this._registerSignalOutput(mV+"Event")}_executeOnTick(V){}_startPendingTasks(V){V._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(V),this._resetAfterCanceled(V)),this._preparePendingTasks(V),V._addPendingBlock(this),this.out._activateSignal(V),V._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(V){V._deleteExecutionVariable(this,"_initialized"),V._removePendingBlock(this)}}},14123:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>K});var t=mV(12393),L=mV(12388),N=mV(14130),A=mV(12258),k=mV(14100);class C extends N.e{constructor(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.defaultValue,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(V,h,mV),this.richType=t,this._defaultValue=L,this._optional=N,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new A.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(V){this._isDisabled!==V&&(this._isDisabled=V,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(V,h){h._getConnectionValue(this)!==V&&(h._setConnectionValue(this,V),this.onValueChangedObservable.notifyObservers(V))}resetToDefaultValue(V){V._setConnectionValue(this,this._defaultValue)}connectTo(V){this._isDisabled||super.connectTo(V)}_getValueOrDefault(V){const h=V._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(h):h}getValue(V){if(1===this.connectionType){V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(V);const h=this._getValueOrDefault(V);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}const h=this.isConnected()?this._connectedPoint[0].getValue(V):this._getValueOrDefault(V);return this._lastValue=h,this.richType.typeTransformer?this.richType.typeTransformer(h):h}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.richType={},this.richType.serialize(V.richType),V.optional=this._optional,(0,k.f)("defaultValue",this._defaultValue,V)}}(0,L.i)("FlowGraphDataConnection",C);class K{constructor(V){var h;this.config=V,this.uniqueId=(0,t.b)(),this.name=(null===(h=this.config)||void 0===h?void 0:h.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(V){}registerDataInput(V,h,mV){const t=new C(V,0,this,h,mV);return this.dataInputs.push(t),t}registerDataOutput(V,h,mV){const t=new C(V,1,this,h,mV);return this.dataOutputs.push(t),t}getDataInput(V){return this.dataInputs.find((h=>h.name===V))}getDataOutput(V){return this.dataOutputs.find((h=>h.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.f;if(V.uniqueId=this.uniqueId,V.config={},this.config){const mV=this.config,t=Object.keys(mV);for(const L of t)h(L,mV[L],V.config)}V.dataInputs=[],V.dataOutputs=[],V.className=this.getClassName();for(const mV of this.dataInputs){const h={};mV.serialize(h),V.dataInputs.push(h)}for(const mV of this.dataOutputs){const h={};mV.serialize(h),V.dataOutputs.push(h)}}deserialize(V){}_log(V,h,mV){var t;null===(t=V.logger)||void 0===t||t.addLogItem({action:h,Hm:mV,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14130:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>N});var t,L=mV(12393);!function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(t||(t={}));class N{constructor(V,h,mV){this._ownerBlock=mV,this._connectedPoint=[],this.uniqueId=(0,L.b)(),this.connectedPointIds=[],this.name=V,this._connectionType=h}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(V){if(this._connectionType===V._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||V._isSingularConnection()&&V._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(V),V._connectedPoint.push(this)}disconnectFrom(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const mV=this._connectedPoint.indexOf(V),t=V._connectedPoint.indexOf(this);-1!==mV&&-1!==t&&(h&&this._connectedPoint.splice(mV,1),V._connectedPoint.splice(t,1))}disconnectFromAll(){for(const V of this._connectedPoint)this.disconnectFrom(V,!1);this._connectedPoint.length=0}dispose(){for(const V of this._connectedPoint)this.disconnectFrom(V)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};V.uniqueId=this.uniqueId,V.name=this.name,V._connectionType=this._connectionType,V.connectedPointIds=[],V.className=this.getClassName();for(const h of this._connectedPoint)V.connectedPointIds.push(h.uniqueId)}getClassName(){return"FGConnection"}deserialize(V){this.uniqueId=V.uniqueId,this.name=V.name,this._connectionType=V._connectionType,this.connectedPointIds=V.connectedPointIds}}},14097:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>z});var t,L=mV(12258),N=mV(12409),A=mV(12413),k=mV(12393),C=mV(14100),K=mV(14115),o=mV(12264);!function(V){V.ExecuteBlock="ExecuteBlock",V.ExecuteEvent="ExecuteEvent",V.TriggerConnection="TriggerConnection",V.ContextVariableSet="ContextVariableSet",V.GlobalVariableSet="GlobalVariableSet",V.GlobalVariableDelete="GlobalVariableDelete",V.GlobalVariableGet="GlobalVariableGet",V.AddConnection="AddConnection",V.GetConnectionValue="GetConnectionValue",V.SetConnectionValue="SetConnectionValue",V.ActivateSignal="ActivateSignal",V.ContextVariableGet="ContextVariableGet"}(t||(t={}));class n{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(V){if(V.time||(V.time=Date.now()),this.log.push(V),this.logToConsole){var h;const mV=null===(h=V.Hm)||void 0===h?void 0:h.value;"object"===typeof mV&&mV.getClassName?o.e.Log(`[FGLog] ${V.className}:${V.uniqueId.split("-")[0]} ${V.action} - ${JSON.stringify(mV.getClassName())}: ${mV.toString()}`):o.e.Log(`[FGLog] ${V.className}:${V.uniqueId.split("-")[0]} ${V.action} - ${JSON.stringify(V.Hm)}`)}}getItemsOfType(V){return this.log.filter((h=>h.action===V))}}class q{get enableLogging(){return this._enableLogging}set enableLogging(V){this._enableLogging!==V&&(this._enableLogging=V,this._enableLogging?(this.logger=new n,this.logger.logToConsole=!0):this.logger=null)}constructor(V){this.uniqueId=(0,k.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new L.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=V,this.assetsContext=V.assetsContext??V.zh}hasVariable(V){return V in this._userVariables}setVariable(V,h){var mV;this._userVariables[V]=h,null===(mV=this.logger)||void 0===mV||mV.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Hm:{name:V,value:h}})}getAsset(V,h){return(0,K.b)(this.assetsContext,V,h)}getVariable(V){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Hm:{name:V,value:this._userVariables[V]}}),this._userVariables[V]}get userVariables(){return this._userVariables}DV(){return this._configuration.zh}_getUniqueIdPrefixedName(V,h){return`${V.uniqueId}_${h}`}_getGlobalContextVariable(V,h){var mV;return null===(mV=this.logger)||void 0===mV||mV.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Hm:{name:V,defaultValue:h,possibleValue:this._globalContextVariables[V]}}),this._hasGlobalContextVariable(V)?this._globalContextVariables[V]:h}_setGlobalContextVariable(V,h){var mV;null===(mV=this.logger)||void 0===mV||mV.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Hm:{name:V,value:h}}),this._globalContextVariables[V]=h}_deleteGlobalContextVariable(V){var h;null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Hm:{name:V}}),delete this._globalContextVariables[V]}_hasGlobalContextVariable(V){return V in this._globalContextVariables}_setExecutionVariable(V,h,mV){this._executionVariables[this._getUniqueIdPrefixedName(V,h)]=mV}_getExecutionVariable(V,h,mV){return this._hasExecutionVariable(V,h)?this._executionVariables[this._getUniqueIdPrefixedName(V,h)]:mV}_deleteExecutionVariable(V,h){delete this._executionVariables[this._getUniqueIdPrefixedName(V,h)]}_hasExecutionVariable(V,h){return this._getUniqueIdPrefixedName(V,h)in this._executionVariables}_hasConnectionValue(V){return V.uniqueId in this._connectionValues}_setConnectionValue(V,h){var mV;this._connectionValues[V.uniqueId]=h,null===(mV=this.logger)||void 0===mV||mV.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Hm:{connectionPointId:V.uniqueId,value:h}})}_setConnectionValueByKey(V,h){this._connectionValues[V]=h}_getConnectionValue(V){var h;return null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Hm:{connectionPointId:V.uniqueId,value:this._connectionValues[V.uniqueId]}}),this._connectionValues[V.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(V){this._pendingBlocks.includes(V)||(this._pendingBlocks.push(V),this._pendingBlocks.sort(((V,h)=>V.priority-h.priority)))}_removePendingBlock(V){const h=this._pendingBlocks.indexOf(V);-1!==h&&this._pendingBlocks.splice(h,1)}_clearPendingBlocks(){for(const V of this._pendingBlocks)V._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(V){var h;this.onNodeExecutedObservable.notifyObservers(V),null===(h=this.logger)||void 0===h||h.addLogItem({time:Date.now(),className:V.getClassName(),uniqueId:V.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(V){this._setGlobalContextVariable("timeSinceStart",V.timeSinceStart),this._setGlobalContextVariable("deltaTime",V.deltaTime);for(const mV of this._pendingBlocks){var h;null===(h=mV._executeOnTick)||void 0===h||h.call(mV,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.f;V.uniqueId=this.uniqueId,V._userVariables={};for(const t in this._userVariables)h(t,this._userVariables[t],V._userVariables);V._connectionValues={};for(const t in this._connectionValues)h(t,this._connectionValues[t],V._connectionValues);var mV;this.assetsContext!==this.DV()&&(V._assetsContext={meshes:this.assetsContext.meshes.map((V=>V.id)),materials:this.assetsContext.materials.map((V=>V.id)),textures:this.assetsContext.textures.map((V=>V.name)),animations:this.assetsContext.animations.map((V=>V.name)),lights:this.assetsContext.lights.map((V=>V.id)),cameras:this.assetsContext.cameras.map((V=>V.id)),Sq:null===(mV=this.assetsContext.Sq)||void 0===mV?void 0:mV.map((V=>V.name)),skeletons:this.assetsContext.skeletons.map((V=>V.id)),Lq:this.assetsContext.Lq.map((V=>V.name)),geometries:this.assetsContext.geometries.map((V=>V.id)),multiMaterials:this.assetsContext.multiMaterials.map((V=>V.id)),transformNodes:this.assetsContext.transformNodes.map((V=>V.id))})}getClassName(){return"FlowGraphContext"}}(0,N.e)([(0,A.J)()],q.prototype,"uniqueId",void 0);var x=mV(14119),R=mV(12681);class d{constructor(V){this.onEventTriggeredObservable=new L.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=V,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.XL.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const V=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Hm:{timeSinceStart:this._startingTime,deltaTime:V}}),this._startingTime+=V})),this._meshPickedObserver=this._scene.onPointerObservable.add((V=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Hm:V})}),R.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((V=>{const h=V.pointerId,mV=V.mesh,t=this._pointerUnderMeshState[h];!t&&mV?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Hm:{pointerId:h,mesh:mV}}):t&&!mV?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Hm:{pointerId:h,mesh:t}}):t&&mV&&t!==mV&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Hm:{pointerId:h,mesh:t,over:mV}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Hm:{pointerId:h,mesh:mV,out:t}})),this._pointerUnderMeshState[h]=mV}),R.b.POINTERMOVE)}dispose(){var V,h,mV,t,L;null===(V=this._sceneDisposeObserver)||void 0===V||V.remove(),null===(h=this._sceneReadyObserver)||void 0===h||h.remove(),null===(mV=this._sceneOnBeforeRenderObserver)||void 0===mV||mV.remove(),null===(t=this._meshPickedObserver)||void 0===t||t.remove(),null===(L=this._meshUnderPointerObserver)||void 0===L||L.remove(),this.onEventTriggeredObservable.clear()}}var s,M=mV(14135);!function(V){V[V.Stopped=0]="Stopped",V[V.Started=1]="Started"}(s||(s={}));class c{get state(){return this._state}set state(V){this._state=V,this.onStateChangedObservable.notifyObservers(V)}constructor(V){this.onStateChangedObservable=new L.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=V.zh,this._sceneEventCoordinator=new d(this._scene),this._coordinator=V.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((V=>{for(const h of this._executionContexts){const mV=this._getContextualOrder(V.type,h);for(const t of mV)if(!t._executeEvent(h,V.Hm))break}switch(V.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const h of this._executionContexts)h._notifyOnTick(V.Hm);break;case"SceneDispose":this.dispose()}}))}createContext(){const V=new q({zh:this._scene,coordinator:this._coordinator});return this._executionContexts.push(V),V}getContext(V){return this._executionContexts[V]}addEventBlock(V){if("PointerOver"!==V.type&&"PointerOut"!==V.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==V.type&&this._eventBlocks[V.type].push(V),1===this.state)for(const h of this._executionContexts)V._startPendingTasks(h);else this.onStateChangedObservable.addOnce((h=>{if(1===h)for(const mV of this._executionContexts)V._startPendingTasks(mV)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((V=>{1===V&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const V of this._executionContexts)for(const h in this._eventBlocks){const mV=this._getContextualOrder(h,V);for(const h of mV)h._startPendingTasks(V)}}_getContextualOrder(V,h){const mV=this._eventBlocks[V].sort(((V,h)=>h.initPriority-V.initPriority));if("MeshPick"===V){const V=[];for(const t of mV){const L=t.asset.getValue(h);let N=0;for(;N<mV.length;N++){const V=mV[N].asset.getValue(h);if(L&&V&&(0,M.m)(L,V))break}V.splice(N,0,t)}return V}return mV}dispose(){var V;if(0!==this.state){this.state=0;for(const V of this._executionContexts)V._clearPendingBlocks();this._executionContexts.length=0;for(const V in this._eventBlocks)this._eventBlocks[V].length=0;null===(V=this._eventObserver)||void 0===V||V.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(V){const h=[],mV=new Set;for(const t in this._eventBlocks)for(const V of this._eventBlocks[t])h.push(V),mV.add(V.uniqueId);for(;h.length>0;){const t=h.pop();V(t);for(const V of t.dataInputs)for(const t of V._connectedPoint)mV.has(t._ownerBlock.uniqueId)||(h.push(t._ownerBlock),mV.add(t._ownerBlock.uniqueId));if(t instanceof x.b)for(const V of t.signalOutputs)for(const t of V._connectedPoint)mV.has(t._ownerBlock.uniqueId)||(h.push(t._ownerBlock),mV.add(t._ownerBlock.uniqueId))}}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=arguments.length>1?arguments[1]:void 0;V.allBlocks=[],this.visitAllBlocks((h=>{const mV={};h.serialize(mV),V.allBlocks.push(mV)})),V.executionContexts=[];for(const mV of this._executionContexts){const t={};mV.serialize(t,h),V.executionContexts.push(t)}}}class z{constructor(V){this.config=V,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.zh.XL.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.zh.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const V=this._executeOnNextFrame.slice(0);if(V.length)for(const h of V){this.notifyCustomEvent(h.id,h.data,!1);const V=this._executeOnNextFrame.findIndex((V=>V.uniqueId===h.uniqueId));-1!==V&&this._executeOnNextFrame.splice(V,1)}}));(z.SceneCoordinators.get(this.config.zh)??[]).push(this)}createGraph(){const V=new c({zh:this.config.zh,coordinator:this});return this._flowGraphs.push(V),V}removeGraph(V){const h=this._flowGraphs.indexOf(V);-1!==h&&(V.dispose(),this._flowGraphs.splice(h,1))}start(){for(const V of this._flowGraphs)V.start()}dispose(){var V,h;for(const L of this._flowGraphs)L.dispose();this._flowGraphs.length=0,null===(V=this._disposeObserver)||void 0===V||V.remove(),null===(h=this._onBeforeRenderObserver)||void 0===h||h.remove();const mV=z.SceneCoordinators.get(this.config.zh)??[],t=mV.indexOf(this);-1!==t&&mV.splice(t,1)}serialize(V,h){V._flowGraphs=[];for(const mV of this._flowGraphs){const t={};mV.serialize(t,h),V._flowGraphs.push(t)}V.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(V){let h=this._customEventsMap.get(V);return h||(h=new L.d,this._customEventsMap.set(V,h)),h}notifyCustomEvent(V,h){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:V,data:h,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(V)){const h=this._eventExecutionCounter.get(V);if(this._eventExecutionCounter.set(V,h+1),h>=z.MaxEventTypeExecutionPerFrame)return void(h===z.MaxEventTypeExecutionPerFrame&&o.e.Warn(`FlowGraphCoordinator: Too many executions of event "${V}".`))}else this._eventExecutionCounter.set(V,1);const mV=this._customEventsMap.get(V);mV&&mV.notifyObservers(h)}}z.MaxEventsPerType=30,z.MaxEventTypeExecutionPerFrame=30,z.SceneCoordinators=new Map},14137:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>L});var t=mV(14140);class L extends t.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(V){V._notifyExecuteNode(this),this.done._activateSignal(V)}}},14119:(V,h,mV)=>{"use strict";mV.d(h,{b:()=>k});var t=mV(14123),L=mV(14130),N=mV(12388);class A extends L.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(V){super.connectTo(V),this._connectedPoint.sort(((V,h)=>h.priority-V.priority))}_activateSignal(V){var h;if(null===(h=V.logger)||void 0===h||h.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Hm:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)V._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(V,this),V._increaseExecutionId();else for(const mV of this._connectedPoint)mV._activateSignal(V)}}(0,N.i)("FlowGraphSignalConnection",A);class k extends t.e{constructor(V){super(V),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(V){const h=new A(V,0,this);return this.signalInputs.push(h),h}_registerSignalOutput(V){const h=new A(V,1,this);return this.signalOutputs.push(h),h}_unregisterSignalInput(V){const h=this.signalInputs.findIndex((h=>h.name===V));-1!==h&&(this.signalInputs[h].dispose(),this.signalInputs.splice(h,1))}_unregisterSignalOutput(V){const h=this.signalOutputs.findIndex((h=>h.name===V));-1!==h&&(this.signalOutputs[h].dispose(),this.signalOutputs.splice(h,1))}_reportError(V,h){this.error.Hm="string"===typeof h?new Error(h):h,this.error._activateSignal(V)}getSignalInput(V){return this.signalInputs.find((h=>h.name===V))}getSignalOutput(V){return this.signalOutputs.find((h=>h.name===V))}serialize(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(V),V.signalInputs=[],V.signalOutputs=[];for(const h of this.signalInputs){const mV={};h.serialize(mV),V.signalInputs.push(mV)}for(const h of this.signalOutputs){const mV={};h.serialize(mV),V.signalOutputs.push(mV)}}deserialize(V){for(let h=0;h<V.signalInputs.length;h++){const mV=this.getSignalInput(V.signalInputs[h].name);if(!mV)throw new Error("Could not find signal input with name "+V.signalInputs[h].name+" in block "+V.className);mV.deserialize(V.signalInputs[h])}for(let h=0;h<V.signalOutputs.length;h++){const mV=this.getSignalOutput(V.signalOutputs[h].name);if(!mV)throw new Error("Could not find signal output with name "+V.signalOutputs[h].name+" in block "+V.className);mV.deserialize(V.signalOutputs[h])}}getClassName(){return"FlowGraphExecutionBlock"}}},14144:(V,h,mV)=>{"use strict";mV.d(h,{c:()=>L});var t=mV(14119);class L extends t.b{constructor(V){super(V),this.out=this._registerSignalOutput("out")}}},14109:(V,h,mV)=>{"use strict";mV.d(h,{C:()=>d,E:()=>j,F:()=>l,I:()=>H,K:()=>D,e:()=>K,h:()=>q,j:()=>v,l:()=>s,o:()=>M,p:()=>c,r:()=>n,v:()=>J,w:()=>o,x:()=>x,z:()=>R});var t,L=mV(12422),N=mV(12453),A=mV(14102),k=mV(14111);!function(V){V.Any="any",V.String="string",V.Number="number",V.Boolean="boolean",V.Object="object",V.Integer="FlowGraphInteger",V.Vector2="Vector2",V.sh="sh",V.Vector4="Vector4",V.Quaternion="Quaternion",V.Matrix="Matrix",V.Matrix2D="Matrix2D",V.Matrix3D="Matrix3D",V.Jh="Jh",V.Gk="Gk"}(t||(t={}));class C{constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=V,this.defaultValue=h,this.animationType=mV}serialize(V){V.typeName=this.typeName,V.defaultValue=this.defaultValue}}const K=new C("any",void 0),o=new C("string",""),n=new C("number",0,0),q=new C("boolean",!1),x=new C("Vector2",L.Vector2.Zero(),5),R=new C("sh",L.sh.Zero(),1),d=new C("Vector4",L.Vector4.Zero()),s=new C("Matrix",L.Matrix.Identity(),3),M=new C("Matrix2D",new k.e),c=new C("Matrix3D",new k.i),z=new C("Jh",N.Jh.Black(),4),Q=new C("Gk",new N.Gk(0,0,0,0),7),J=new C("Quaternion",L.Quaternion.Identity(),2);J.typeTransformer=V=>{if(V.getClassName){if("Vector4"===V.getClassName())return L.Quaternion.Dh(V.sk());if("sh"===V.getClassName())return L.Quaternion.FromEulerVector(V);if("Matrix"===V.getClassName())return L.Quaternion.FromRotationMatrix(V)}return V};const v=new C("FlowGraphInteger",new A.d(0),0);function D(V){const h=V;switch(typeof V){case"string":return o;case"number":return n;case"boolean":return q;case"object":if(h.getClassName)switch(h.getClassName()){case"Vector2":return x;case"sh":return R;case"Vector4":return d;case"Matrix":return s;case"Jh":return z;case"Gk":return Q;case"Quaternion":return J;case"FlowGraphInteger":return v;case"Matrix2D":return M;case"Matrix3D":return c}return K;default:return K}}function H(V){switch(V){case"string":return o;case"number":return n;case"boolean":return q;case"Vector2":return x;case"sh":return R;case"Vector4":return d;case"Matrix":return s;case"Jh":return z;case"Gk":return Q;case"Quaternion":return J;case"FlowGraphInteger":return v;case"Matrix2D":return M;case"Matrix3D":return c;default:return K}}function j(V){switch(V){case"number":default:return 0;case"Vector2":return 5;case"sh":return 1;case"Matrix":return 3;case"Jh":return 4;case"Gk":return 7;case"Quaternion":return 2}}function l(V){switch(V){case 0:return n;case 5:return x;case 1:return R;case 3:return s;case 4:return z;case 7:return Q;case 2:return J;default:return K}}},14100:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>o,f:()=>K,h:()=>n});var t=mV(12453),L=mV(12422),N=mV(14102),A=mV(14109),k=mV(14111);function C(V){return"Vector2"===V||"sh"===V||"Vector4"===V||"Quaternion"===V||"Jh"===V||"Gk"===V}function K(V,h,mV){var t;const L=(null===h||void 0===h||null===(t=h.getClassName)||void 0===t?void 0:t.call(h))??"";if(C(L)||function(V){return"Matrix"===V||"Matrix2D"===V||"Matrix3D"===V}(L))mV[V]={value:h.sk(),className:L};else if("FlowGraphInteger"===L)mV[V]={value:h.value,className:L};else if(L&&(h.id||h.name))mV[V]={id:h.id,name:h.name,className:L};else{if("object"===typeof h)throw new Error(`Could not serialize value ${h}`);mV[V]=h}}function o(V,h,mV,K){const n=h[V];let q;const x=(null===n||void 0===n?void 0:n.type)??(null===n||void 0===n?void 0:n.className);if(function(V){return"Mesh"===V||"AbstractMesh"===V||"GroundMesh"===V||"InstanceMesh"===V||"LinesMesh"===V||"GoldbergMesh"===V||"GreasedLineMesh"===V||"TrailMesh"===V}(x)){let V=K.meshes.filter((V=>n.id?V.id===n.id:V.name===n.name));0===V.length&&(V=K.transformNodes.filter((V=>n.id?V.id===n.id:V.name===n.name))),q=n.uniqueId?V.find((V=>V.uniqueId===n.uniqueId)):V[0]}else if(C(x))q=function(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===V)return L.Vector2.Dh(h);if("sh"===V)return mV&&(h[2]*=-1),L.sh.Dh(h);if("Vector4"===V)return L.Vector4.Dh(h);if("Quaternion"===V)return mV&&(h[2]*=-1,h[3]*=-1),L.Quaternion.Dh(h);if("Jh"===V)return new t.Jh(h[0],h[1],h[2]);if("Gk"===V)return new t.Gk(h[0],h[1],h[2],h[3]);throw new Error(`Unknown vector class name ${V}`)}(x,n.value);else if(function(V){return"AnimationGroup"===V}(x)){const V=K.animationGroups.filter((V=>V.name===n.name));q=1===V.length?V[0]:V.find((V=>V.uniqueId===n.uniqueId))}else q="Matrix"===x?L.Matrix.Dh(n.value):"Matrix2D"===x?new k.e(n.value):"Matrix3D"===x?new k.i(n.value):"FlowGraphInteger"===x?N.d.FromValue(n.value):"number"===x||"string"===x||"boolean"===x?n.value[0]:n&&void 0!==n.value?n.value:Array.isArray(n)?n.reduce(((V,h)=>h.eventData?(V[h.id]={type:(0,A.I)(h.type)},"undefined"!==typeof h.value&&(V[h.id].value=o("value",h,mV,K)),V):V),{}):n;return q}function n(V){return"FlowGraphJsonPointerParserBlock"===V}},14135:(V,h,mV)=>{"use strict";function t(V,h){return!(!V.parent||V.parent!==h&&!t(V.parent,h))}function L(V){if(V.getClassName)return V.getClassName()}function N(V,h){return V===h&&("Vector2"===V||"sh"===V||"Vector4"===V||"Quaternion"===V)}function A(V,h){return V===h&&("Matrix"===V||"Matrix2D"===V||"Matrix3D"===V)}function k(V,h){return"FlowGraphInteger"===V&&"FlowGraphInteger"===h}function C(V,h){const mV="number"===typeof V||"number"===typeof(null===V||void 0===V?void 0:V.value);return mV&&!h?!isNaN(K(V)):mV}function K(V){return"number"===typeof V?V:V.value}mV.d(h,{c:()=>k,g:()=>A,h:()=>N,k:()=>L,m:()=>t,o:()=>K,r:()=>C})},13530:(V,h,mV)=>{"use strict";mV.r(h),mV.d(h,{SceneInstrumentation:()=>N});var t=mV(12253),L=mV(12623);class N{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(V){V!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=V,V?(this._onBeforeActiveMeshesEvaluationObserver=this.zh.onBeforeActiveMeshesEvaluationObservable.add((()=>{t.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.zh.onAfterActiveMeshesEvaluationObservable.add((()=>{t.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.zh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.zh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(V){V!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=V,V?(this._onBeforeRenderTargetsRenderObserver=this.zh.onBeforeRenderTargetsRenderObservable.add((()=>{t.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.zh.onAfterRenderTargetsRenderObservable.add((()=>{t.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.zh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.zh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(V){V!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=V,V?(this._onBeforeParticlesRenderingObserver=this.zh.onBeforeParticlesRenderingObservable.add((()=>{t.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.zh.onAfterParticlesRenderingObservable.add((()=>{t.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.zh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.zh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(V){V!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=V,this.zh.spriteManagers&&(V?(this._onBeforeSpritesRenderingObserver=this.zh.onBeforeSpritesRenderingObservable.add((()=>{t.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.zh.onAfterSpritesRenderingObservable.add((()=>{t.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.zh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.zh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(V){V!==this._capturePhysicsTime&&this.zh.onBeforePhysicsObservable&&(this._capturePhysicsTime=V,V?(this._onBeforePhysicsObserver=this.zh.onBeforePhysicsObservable.add((()=>{t.Tools.StartPerformanceCounter("Ad"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.zh.onAfterPhysicsObservable.add((()=>{t.Tools.EndPerformanceCounter("Ad"),this._physicsTime.endMonitoring()}))):(this.zh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.zh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(V){V!==this._captureAnimationsTime&&(this._captureAnimationsTime=V,V?this._onAfterAnimationsObserver=this.zh.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.zh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(V){this._captureFrameTime=V}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(V){this._captureInterFrameTime=V}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(V){V!==this._captureRenderTime&&(this._captureRenderTime=V,V?(this._onBeforeDrawPhaseObserver=this.zh.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),t.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.zh.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),t.Tools.EndPerformanceCounter("Main render")}))):(this.zh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.zh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(V){V!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=V,V?(this._onBeforeCameraRenderObserver=this.zh.onBeforeCameraRenderObservable.add((V=>{this._cameraRenderTime.beginMonitoring(),t.Tools.StartPerformanceCounter(`Rendering camera ${V.name}`)})),this._onAfterCameraRenderObserver=this.zh.onAfterCameraRenderObservable.add((V=>{this._cameraRenderTime.endMonitoring(!1),t.Tools.EndPerformanceCounter(`Rendering camera ${V.name}`)}))):(this.zh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.zh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.zh.getEngine()._drawCalls}constructor(V){this.zh=V,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new L.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new L.c,this._captureFrameTime=!1,this._frameTime=new L.c,this._captureRenderTime=!1,this._renderTime=new L.c,this._captureInterFrameTime=!1,this._interFrameTime=new L.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new L.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new L.c,this._capturePhysicsTime=!1,this._physicsTime=new L.c,this._captureAnimationsTime=!1,this._animationsTime=new L.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new L.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=V.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(t.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.zh.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=V.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(t.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.gt(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.gt(),this._captureParticlesRenderTime&&this._particlesRenderTime.gt(),this._captureSpritesRenderTime&&this._spritesRenderTime.gt(),this._captureRenderTime&&this._renderTime.gt(),this._captureCameraRenderTime&&this._cameraRenderTime.gt()}))}dispose(){this._disposed||(this.zh.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.zh.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.zh.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.zh.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.zh.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.zh.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.zh.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.zh.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.zh.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.zh.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.zh.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.zh.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.zh.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.zh.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.zh.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.zh.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.zh.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.zh=null,this._disposed=!0)}}},14090:(V,h,mV)=>{"use strict";mV.d(h,{b:()=>o});var t=mV(12409),L=mV(12413),N=mV(12422),A=mV(12809),k=mV(12937),C=mV(12995),K=mV(12388);A.d.AddNodeConstructor("Light_Type_1",((V,h)=>()=>new o(V,N.sh.Zero(),h)));class o extends C.d{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(V){this._shadowFrustumSize=V,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(V){this._shadowOrthoScale=V,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(V){this._orthoLeft=V}get orthoRight(){return this._orthoRight}set orthoRight(V){this._orthoRight=V}get orthoTop(){return this._orthoTop}set orthoTop(V){this._orthoTop=V}get orthoBottom(){return this._orthoBottom}set orthoBottom(V){this._orthoBottom=V}constructor(V,h,mV){super(V,mV),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=h.scale(-1),this.direction=h}getClassName(){return"kd"}getTypeID(){return k.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(V,h,mV){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(V):this._setDefaultAutoExtendShadowProjectionMatrix(V,h,mV)}_setDefaultFixedFrustumShadowProjectionMatrix(V){const h=this.DV().activeCamera;h&&N.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:h.ck,void 0!==this.shadowMaxZ?this.shadowMaxZ:h.maxZ,V,this.DV().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(V,h,mV){const t=this.DV().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const V=N.sh.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let t=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(let A=0;A<mV.length;A++){const k=mV[A];if(!k)continue;const C=k.getBoundingInfo().boundingBox;for(let mV=0;mV<C.vectorsWorld.length;mV++)N.sh.TransformCoordinatesToRef(C.vectorsWorld[mV],h,V),V.x<this._orthoLeft&&(this._orthoLeft=V.x),V.y<this._orthoBottom&&(this._orthoBottom=V.y),V.x>this._orthoRight&&(this._orthoRight=V.x),V.y>this._orthoTop&&(this._orthoTop=V.y),this.autoCalcShadowZBounds&&(V.z<t&&(t=V.z),V.z>L&&(L=V.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=t,this._shadowMaxZ=L)}const L=this._orthoRight-this._orthoLeft,A=this._orthoTop-this._orthoBottom,k=void 0!==this.shadowMinZ?this.shadowMinZ:(null===t||void 0===t?void 0:t.ck)||0,C=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===t||void 0===t?void 0:t.maxZ)||1e4,K=this.DV().getEngine().bh;N.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-L*this.shadowOrthoScale,this._orthoRight+L*this.shadowOrthoScale,this._orthoBottom-A*this.shadowOrthoScale,this._orthoTop+A*this.shadowOrthoScale,K?C:k,K?k:C,V,this.DV().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,h){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,h),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,h),this)}transferToNodeMaterialEffect(V,h){return this.computeTransformedInformation()?(V.setFloat3(h,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(V.setFloat3(h,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(V){const h=this._scene.getEngine();return!h.bh&&h.isNDCHalfZRange?0:1}getDepthMaxZ(V){const h=this._scene.getEngine();return h.bh&&h.isNDCHalfZRange?0:1}prepareLightSpecificDefines(V,h){V["DIRLIGHT"+h]=!0}}(0,t.e)([(0,L.J)()],o.prototype,"shadowFrustumSize",null),(0,t.e)([(0,L.J)()],o.prototype,"shadowOrthoScale",null),(0,t.e)([(0,L.J)()],o.prototype,"autoUpdateExtends",void 0),(0,t.e)([(0,L.J)()],o.prototype,"autoCalcShadowZBounds",void 0),(0,t.e)([(0,L.J)("orthoLeft")],o.prototype,"_orthoLeft",void 0),(0,t.e)([(0,L.J)("orthoRight")],o.prototype,"_orthoRight",void 0),(0,t.e)([(0,L.J)("orthoTop")],o.prototype,"_orthoTop",void 0),(0,t.e)([(0,L.J)("orthoBottom")],o.prototype,"_orthoBottom",void 0),(0,K.i)("BABYLON.DirectionalLight",o)},14544:(V,h,mV)=>{"use strict";mV.d(h,{b:()=>o});var t=mV(12409),L=mV(12413),N=mV(12422),A=mV(12453),k=mV(12809),C=mV(12937),K=mV(12388);k.d.AddNodeConstructor("Light_Type_3",((V,h)=>()=>new o(V,N.sh.Zero(),h)));class o extends C.d{constructor(V,h,mV){super(V,mV),this.groundColor=new A.Jh(0,0,0),this.direction=h||N.sh.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Cd"}setDirectionToTarget(V){return this.direction=N.sh.Normalize(V.Mh(N.sh.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(V,h){const mV=N.sh.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",mV.x,mV.y,mV.z,0,h),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ik),h),this}transferToNodeMaterialEffect(V,h){const mV=N.sh.Normalize(this.direction);return V.setFloat3(h,mV.x,mV.y,mV.z),this}Qk(){return this._worldMatrix||(this._worldMatrix=N.Matrix.Identity()),this._worldMatrix}getTypeID(){return C.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(V,h){V["HEMILIGHT"+h]=!0}}(0,t.e)([(0,L.l)()],o.prototype,"groundColor",void 0),(0,t.e)([(0,L.I)()],o.prototype,"direction",void 0),(0,K.i)("BABYLON.HemisphericLight",o)},14060:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>n});var t=mV(12409),L=mV(12413),N=mV(12422),A=mV(12809),k=mV(12937),C=mV(12995),K=mV(12406),o=mV(12388);A.d.AddNodeConstructor("Light_Type_2",((V,h)=>()=>new n(V,N.sh.Zero(),N.sh.Zero(),0,0,h)));class n extends C.d{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(V){this._iesProfileTexture!==V&&(this._iesProfileTexture=V,this._iesProfileTexture&&n._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(V){this._angle=V,this._cosHalfAngle=Math.cos(.5*V),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(V){this._innerAngle=V,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(V){this._shadowAngleScale=V,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(V){this._projectionTextureLightNear=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(V){this._projectionTextureLightFar=V,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(V){this._projectionTextureUpDirection=V,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(V){this._projectionTexture!==V&&(this._projectionTexture=V,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(n._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):n._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(V){return void 0!==V.onGeneratedObservable}static _IsTexture(V){return void 0!==V.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(V){this._projectionTextureProjectionLightMatrix=V,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(V,h,mV,t,L,A){super(V,A),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=N.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=N.sh.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=N.sh.Zero(),this._projectionTextureViewLightMatrix=N.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=N.Matrix.Zero(),this._projectionTextureScalingMatrix=N.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=h,this.direction=mV,this.angle=t,this.exponent=L}getClassName(){return"SpotLight"}getTypeID(){return k.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(V){super._setDirection(V),this._projectionTextureViewLightDirty=!0}_setPosition(V){super._setPosition(V),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(V,h,mV){const t=this.DV().activeCamera;if(!t)return;this._shadowAngleScale=this._shadowAngleScale||1;const L=this._shadowAngleScale*this._angle,A=void 0!==this.shadowMinZ?this.shadowMinZ:t.ck,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,C=this.DV().getEngine().bh;N.Matrix.PerspectiveFovLHToRef(L,1,C?k:A,C?A:k,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,C)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),N.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const V=this.projectionTextureLightFar,h=this.projectionTextureLightNear,mV=V/(V-h),t=-mV*h,L=1/Math.tan(this._angle/2);N.Matrix.FromValuesToRef(L/1,0,0,0,0,L,0,0,0,0,mV,1,0,0,t,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof K.d){const V=this._projectionTexture.uScale/2,h=this._projectionTexture.vScale/2;N.Matrix.FromValuesToRef(V,0,0,0,0,h,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(V,h){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),V.setMatrix("textureProjectionMatrix"+h,this._projectionTextureMatrix),V.setTexture("projectionLightTexture"+h,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&V.setTexture("iesLightTexture"+h,this._iesProfileTexture),this}transferToEffect(V,h){let mV;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,h),mV=N.sh.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,h),mV=N.sh.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",mV.x,mV.y,mV.z,this._cosHalfAngle,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,h),this}transferToNodeMaterialEffect(V,h){let mV;return mV=this.computeTransformedInformation()?N.sh.Normalize(this.transformedDirection):N.sh.Normalize(this.direction),this.DV().useRightHandedSystem?V.setFloat3(h,-mV.x,-mV.y,-mV.z):V.setFloat3(h,mV.x,mV.y,mV.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(V){const h=this._scene.getEngine(),mV=void 0!==this.shadowMinZ?this.shadowMinZ:(null===V||void 0===V?void 0:V.ck)??0;return h.bh&&h.isNDCHalfZRange?mV:this._scene.getEngine().isNDCHalfZRange?0:mV}getDepthMaxZ(V){const h=this._scene.getEngine(),mV=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===V||void 0===V?void 0:V.maxZ)??1e4;return h.bh&&h.isNDCHalfZRange?0:mV}prepareLightSpecificDefines(V,h){V["SPOTLIGHT"+h]=!0,V["PROJECTEDLIGHTTEXTURE"+h]=!(!this.projectionTexture||!this.projectionTexture.isReady()),V["IESLIGHTTEXTURE"+h]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,t.e)([(0,L.J)()],n.prototype,"angle",null),(0,t.e)([(0,L.J)()],n.prototype,"innerAngle",null),(0,t.e)([(0,L.J)()],n.prototype,"shadowAngleScale",null),(0,t.e)([(0,L.J)()],n.prototype,"exponent",void 0),(0,t.e)([(0,L.J)()],n.prototype,"projectionTextureLightNear",null),(0,t.e)([(0,L.J)()],n.prototype,"projectionTextureLightFar",null),(0,t.e)([(0,L.J)()],n.prototype,"projectionTextureUpDirection",null),(0,t.e)([(0,L.B)("projectedLightTexture")],n.prototype,"_projectionTexture",void 0),(0,o.i)("BABYLON.SpotLight",n)},13796:(V,h,mV)=>{"use strict";mV.d(h,{c:()=>A,f:()=>N,h:()=>k});const t={},L={};function N(V,h){t[V]=h}function A(V,h){L[V]=h}function k(V){return L[V]?L[V]:null}},13686:(V,h,mV)=>{"use strict";mV.d(h,{b:()=>D,f:()=>p});var t,L=mV(12253),N=mV(12258),A=mV(12648),k=mV(12300),C=mV(12264),K=mV(12847),o=mV(12303),n=mV(12305),q=mV(12393),x=mV(12331),R=mV(12292);!function(V){V[V.Clean=0]="Clean",V[V.Stop=1]="Stop",V[V.Sync=2]="Sync",V[V.NoSync=3]="NoSync"}(t||(t={}));const d=new N.d,s={};let M=!1;function c(){return s[".babylon"]}function z(V,h){const mV=s[V];return mV||(C.e.Warn("Unable to find a plugin to load "+V+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),h?c():void 0)}function Q(V,h,mV){let t="Unable to load from "+(V.rawData?"binary data":V.url);return h?t+=`: ${h}`:mV&&(t+=`: ${mV}`),t}async function J(V,h,mV,t,L,N,A,k,C){var K;const n="data:"===(q=V.url).substring(0,5)?q.substring(5):null;var q;if(V.rawData&&!A)throw"When using ArrayBufferView to load data the file extension must be provided.";const M=n||A?"":function(V){const h=V.indexOf("?");-1!==h&&(V=V.substring(0,h));const mV=V.lastIndexOf(".");return V.substring(mV,V.length).toLowerCase()}(V.url);let Q=A?z(A,!0):n?function(V){for(const h in s){const mV=s[h].plugin;if(mV.canDirectLoad&&mV.canDirectLoad(V))return s[h]}return c()}(V.url):z(M,!1);if(!Q&&M){if(V.url&&!V.url.startsWith("blob:")){const h=await async function(V,h){const mV=h.method||"GET";return await new Promise(((t,L)=>{const N=new R.e;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){const V={};if(h.responseHeaders)for(const mV of h.responseHeaders)V[mV]=N.getResponseHeader(mV)||"";t({response:N.response,headerValues:V})}else L(`Unable to fetch data from ${V}. Error code: ${N.status}`)})),N.open(mV,V),N.send()}))}(V.url,{method:"HEAD",responseHeaders:["Content-Type"]}),mV=h.headerValues?h.headerValues["Content-Type"]:"";mV&&(Q=function(V){for(const h in s){const mV=s[h];if(mV.mimeType===V)return mV}}(mV))}Q||(Q=c())}if(!Q)throw new Error(`No plugin or fallback for ${A??V.url}`);if(!1===(null===C||void 0===C||null===(K=C[Q.plugin.name])||void 0===K?void 0:K.enabled))throw new Error(`The '${Q.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(V.rawData&&!Q.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(V=>{if(Q.plugin.createPlugin){const h=Q.plugin.createPlugin(C??{});return h instanceof Promise?(h.then(V).catch((V=>{L("Error instantiating plugin.",V)})),null):(V(h),h)}return V(Q.plugin),Q.plugin})((C=>{var K;if(!C)throw`The loader plugin corresponding to the '${A}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(d.notifyObservers(C),n&&(C.canDirectLoad&&C.canDirectLoad(V.url)||!(0,o.n)(V.url))){if(C.directLoad){const V=C.directLoad(h,n);V instanceof Promise?V.then((V=>{mV(C,V)})).catch((V=>{L("Error in directLoad of _loadData: "+V,V)})):mV(C,V)}else mV(C,n);return}const q=Q.isBinary,R=(V,t)=>{h.A?L("Scene has been disposed"):mV(C,V,t)};let s=null,M=!1;null===(K=C.XL)||void 0===K||K.add((()=>{M=!0,s&&(s.abort(),s=null),N()}));const c=()=>{if(M)return;const mV=(V,h)=>{L(null===V||void 0===V?void 0:V.statusText,h)};if(!C.loadFile&&V.rawData)throw"Plugin does not support loading ArrayBufferView.";s=C.loadFile?C.loadFile(h,V.rawData||V.file||V.url,V.rootUrl,R,t,q,mV,k):h._loadFile(V.file||V.url,R,t,!0,q,mV)},z=h.getEngine();let J=z.enableOfflineSupport;if(J){let mV=!1;for(const t of h.disableOfflineSupportExceptionRules)if(t.test(V.url)){mV=!0;break}J=!mV}J&&x.b.OfflineProviderFactory?h.offlineProvider=x.b.OfflineProviderFactory(V.url,c,z.disableManifestCheck):c()}))}function v(V,h){let mV,t,N=null,A=null;if(h)if(h.name)mV=`file:${h.name}`,t=h.name,N=h;else if(ArrayBuffer.isView(h))mV="",t=(0,q.b)(),A=h;else if(h.startsWith("data:"))mV=h,t="";else if(V){const N=h;if("/"===N.substring(0,1))return L.Tools.Error("Wrong sceneFilename parameter"),null;mV=V+N,t=N}else mV=h,t=L.Tools.GetFilename(h),V=L.Tools.GetFolderPath(h);else mV=V,t=L.Tools.GetFilename(V),V=L.Tools.GetFolderPath(V);return{url:mV,rootUrl:V,name:t,file:N,rawData:A}}function D(V){if("string"===typeof V.extensions){const h=V.extensions;s[h.toLowerCase()]={plugin:V,isBinary:!1}}else{const h=V.extensions,mV=Object.keys(h);for(const t of mV)s[t.toLowerCase()]={plugin:V,isBinary:h[t].isBinary,mimeType:h[t].mimeType}}}async function H(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.b.LastCreatedScene,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!t)return C.e.Error("No scene available to import mesh to"),null;const x=v(h,mV);if(!x)return null;const R={};t.addPendingData(R);const d=()=>{t.removePendingData(R)},s=(V,h)=>{const mV=Q(x,V,h);A?A(t,mV,new n.d(mV,n.c.SceneLoaderError,h)):C.e.Error(mV),d()},M=N?V=>{try{N(V)}catch(h){s("Error in onProgress callback: "+h,h)}}:void 0,c=(V,h,mV,N,A,k,C,K)=>{if(t.importedMeshesFiles.push(x.url),L)try{L(V,h,mV,N,A,k,C,K)}catch(o){s("Error in onSuccess callback: "+o,o)}t.removePendingData(R)};return await J(x,t,((h,mV,L)=>{if(h.rewriteRootURL&&(x.rootUrl=h.rewriteRootURL(x.rootUrl,L)),h.importMesh){const L=[],N=[],A=[];if(!h.importMesh(V,t,mV,x.rootUrl,L,N,A,s))return;t.loadingPluginName=h.name,c(L,N,A,[],[],[],[],[])}else{h.importMeshAsync(V,t,mV,x.rootUrl,M,x.name).then((V=>{t.loadingPluginName=h.name,c(V.meshes,V.Lq,V.skeletons,V.animationGroups,V.transformNodes,V.geometries,V.lights,V.spriteManagers)})).catch((V=>{s(V.message,V)}))}}),M,s,d,K,o,q)}async function j(V,h,mV,t,L,N,A,k){return await new Promise(((C,K)=>{try{H(V,h,mV,t,((V,h,mV,t,L,N,A,k)=>{C({meshes:V,Lq:h,skeletons:mV,animationGroups:t,transformNodes:L,geometries:N,lights:A,spriteManagers:k})}),L,((V,h,mV)=>{K(mV||new Error(h))}),N,A,k).catch(K)}catch(n){K(n)}}))}async function l(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.b.LastCreatedEngine,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};mV?await y(V,h,new A.d(mV),t,N,C,K,o,n):L.Tools.Error("No engine available")}async function G(V,h,mV,t,L,N,A){return await new Promise(((k,C)=>{l(V,h,mV,(V=>{k(V)}),t,((V,h,mV)=>{C(mV||new Error(h))}),L,N,A)}))}async function y(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.b.LastCreatedScene,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!mV)return C.e.Error("No scene available to append to"),null;const x=v(V,h);if(!x)return null;const R={};mV.addPendingData(R);const d=()=>{mV.removePendingData(R)};K.d.ShowLoadingScreen&&!M&&(M=!0,mV.getEngine().displayLoadingUI(),mV.executeWhenReady((()=>{mV.getEngine().hideLoadingUI(),M=!1})));const s=(V,h)=>{const t=Q(x,V,h);N?N(mV,t,new n.d(t,n.c.SceneLoaderError,h)):C.e.Error(t),d()},c=L?V=>{try{L(V)}catch(h){s("Error in onProgress callback",h)}}:void 0,z=()=>{if(t)try{t(mV)}catch(V){s("Error in onSuccess callback",V)}mV.removePendingData(R)};return await J(x,mV,((V,h)=>{if(V.load){if(!V.load(mV,h,x.rootUrl,s))return;mV.loadingPluginName=V.name,z()}else{V.loadAsync(mV,h,x.rootUrl,c,x.name).then((()=>{mV.loadingPluginName=V.name,z()})).catch((V=>{s(V.message,V)}))}}),c,s,d,A,o,q)}async function O(V,h,mV,t,L,N,A){return await new Promise(((k,C)=>{try{y(V,h,mV,(V=>{k(V)}),t,((V,h,mV)=>{C(mV||new Error(h))}),L,N,A).catch(C)}catch(n){C(n)}}))}async function I(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.b.LastCreatedScene,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!mV)return C.e.Error("No scene available to load asset container to"),null;const q=v(V,h);if(!q)return null;const x={};mV.addPendingData(x);const R=()=>{mV.removePendingData(x)},d=(V,h)=>{const t=Q(q,V,h);N?N(mV,t,new n.d(t,n.c.SceneLoaderError,h)):C.e.Error(t),R()},s=L?V=>{try{L(V)}catch(h){d("Error in onProgress callback",h)}}:void 0,M=V=>{if(t)try{t(V)}catch(h){d("Error in onSuccess callback",h)}mV.removePendingData(x)};return await J(q,mV,((V,h)=>{if(V.loadAssetContainer){const t=V.loadAssetContainer(mV,h,q.rootUrl,d);if(!t)return;t.populateRootNodes(),mV.loadingPluginName=V.name,M(t)}else if(V.loadAssetContainerAsync){V.loadAssetContainerAsync(mV,h,q.rootUrl,s,q.name).then((h=>{h.populateRootNodes(),mV.loadingPluginName=V.name,M(h)})).catch((V=>{d(V.message,V)}))}else d("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),s,d,R,A,K,o)}async function r(V,h,mV,t,L,N,A){return await new Promise(((k,C)=>{try{I(V,h,mV,(V=>{k(V)}),t,((V,h,mV)=>{C(mV||new Error(h))}),L,N,A).catch(C)}catch(n){C(n)}}))}async function T(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.b.LastCreatedScene,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,n=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,q=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",x=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!mV)return void C.e.Error("No scene available to load animations to");if(t){for(const t of mV.animatables)t.reset();mV.stopAllAnimations();const V=mV.animationGroups.slice();for(const mV of V)mV.dispose();const h=mV.getNodes();for(const mV of h)mV.animations&&(mV.animations=[])}else switch(L){case 0:const V=mV.animationGroups.slice();for(const h of V)h.dispose();break;case 1:for(const h of mV.animationGroups)h.stop();break;case 2:for(const h of mV.animationGroups)h.reset(),h.restart();break;case 3:break;default:return void C.e.Error("Unknown animation group loading mode value '"+L+"'")}const R=mV.animatables.length;await I(V,h,mV,(V=>{V.mergeAnimationsTo(mV,mV.animatables.slice(R),N),V.dispose(),mV.onAnimationFileImportedObservable.notifyObservers(mV),A&&A(mV)}),K,o,n,q,x)}async function F(V,h,mV,t,L,N,A,k,C,K){return await new Promise(((o,q)=>{try{T(V,h,mV,t,L,N,(V=>{o(V)}),A,((V,h,mV)=>{q(mV||new Error(h))}),k,C,K).catch(q)}catch(n){q(n)}}))}class p{static get ForceFullSceneLoadingForIncremental(){return K.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(V){K.d.ForceFullSceneLoadingForIncremental=V}static get ShowLoadingScreen(){return K.d.ShowLoadingScreen}static set ShowLoadingScreen(V){K.d.ShowLoadingScreen=V}static get loggingLevel(){return K.d.loggingLevel}static set loggingLevel(V){K.d.loggingLevel=V}static get CleanBoneMatrixWeights(){return K.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(V){K.d.CleanBoneMatrixWeights=V}static GetDefaultPlugin(){return c()}static GetPluginForExtension(V){var h;return null===(h=z(V,!0))||void 0===h?void 0:h.plugin}static IsPluginForExtensionAvailable(V){return function(V){return!!s[V]}(V)}static RegisterPlugin(V){D(V)}static ImportMesh(V,h,mV,t,L,N,A,C,K){H(V,h,mV,t,L,N,A,C,K).catch((V=>null===A||void 0===A?void 0:A(k.b.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async ImportMeshAsync(V,h,mV,t,L,N,A){return await j(V,h,mV,t,L,N,A)}static Load(V,h,mV,t,L,N,A,C){l(V,h,mV,t,L,N,A,C).catch((V=>null===N||void 0===N?void 0:N(k.b.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async LoadAsync(V,h,mV,t,L,N){return await G(V,h,mV,t,L,N)}static Append(V,h,mV,t,L,N,A,C){y(V,h,mV,t,L,N,A,C).catch((V=>null===N||void 0===N?void 0:N(mV??k.b.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async AppendAsync(V,h,mV,t,L,N){return await O(V,h,mV,t,L,N)}static LoadAssetContainer(V,h,mV,t,L,N,A,C){I(V,h,mV,t,L,N,A,C).catch((V=>null===N||void 0===N?void 0:N(mV??k.b.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async LoadAssetContainerAsync(V,h,mV,t,L,N){return await r(V,h,mV,t,L,N)}static ImportAnimations(V,h,mV,t,L,N,A,C,K,o,n){T(V,h,mV,t,L,N,A,C,K,o,n).catch((V=>null===K||void 0===K?void 0:K(mV??k.b.LastCreatedScene,null===V||void 0===V?void 0:V.message,V)))}static async ImportAnimationsAsync(V,h,mV,t,L,N,A,k,C,K,o){return await F(V,h,mV,t,L,N,k,K,o)}}p.NO_LOGGING=0,p.MINIMAL_LOGGING=1,p.SUMMARY_LOGGING=2,p.DETAILED_LOGGING=3,p.OnPluginActivatedObservable=d},14075:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>q});var t=mV(12409),L=mV(12413),N=mV(12253),A=mV(12422),k=mV(12438),C=mV(12406),K=mV(12388),o=mV(12258),n=mV(12448);mV(14082);class q extends k.b{set boundingBoxSize(V){if(this._boundingBoxSize&&this._boundingBoxSize.equals(V))return;this._boundingBoxSize=V;const h=this.DV();h&&h.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(V){this._rotationY=V,this.setReflectionTextureMatrix(A.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(V,h,mV){let t="";for(const L of V)t+=L;return new q(t,h,null,mV,V)}static CreateFromPrefilteredData(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const L=h.useDelayedTextureLoading;h.useDelayedTextureLoading=!1;const N=new q(V,h,null,!1,null,null,null,void 0,!0,mV,t);return h.useDelayedTextureLoading=L,N}constructor(V,h){var mV;let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],x=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,R=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,s=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,M=arguments.length>13?arguments[13]:void 0,c=arguments.length>14?arguments[14]:void 0;super(h),this.onLoadObservable=new o.d,this.boundingBoxPosition=A.sh.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new A.Matrix,this._buffer=null,this.name=V,this.url=V,this._noMipmap=L,this.Mk=!1,this.isCube=!0,this._textureMatrix=A.Matrix.Identity(),this.coordinatesMode=C.d.CUBIC_MODE;let z=null,Q=null;null===t||Array.isArray(t)?(this._noMipmap=L,this._format=n,this._createPolynomials=R,z=t,this._loaderOptions=M,this._useSRGBBuffer=c,this._lodScale=d,this._lodOffset=s):(z=t.extensions??null,this._noMipmap=t.noMipmap??!1,N=t.files??null,Q=t.buffer??null,this._format=t.format??5,q=t.prefiltered??!1,x=t.forcedExtension??null,this._createPolynomials=t.createPolynomials??!1,this._lodScale=t.lodScale??.8,this._lodOffset=t.lodOffset??0,this._loaderOptions=t.loaderOptions,this._useSRGBBuffer=t.useSRGBBuffer,k=t.W??null,K=t.onError??null),(V||N)&&this.updateURL(V,x,k,q,K,z,null===(mV=this.DV())||void 0===mV?void 0:mV.useDelayedTextureLoading,N,Q)}getClassName(){return"CubeTexture"}updateURL(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=V),this.url=V,h&&(this._forcedExtension=h);const K=V.lastIndexOf("."),o=h||(K>-1?V.substring(K).toLowerCase():""),n=0===o.indexOf(".dds"),q=0===o.indexOf(".env"),x=0===o.indexOf(".basis");if(q?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=t,t&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),k)this._files=k;else if(x||q||n||N||(N=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,N){for(let h=0;h<N.length;h++)this._files.push(V+N[h]);this._extensions=N}this._buffer=C,A?(this.delayLoadState=4,this._delayedOnLoad=mV,this._delayedOnError=L):this._loadTexture(mV,L)}delayLoad(V){4===this.delayLoadState&&(V&&(this._forcedExtension=V),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(V){var h,mV;if(V.updateFlag===this._textureMatrix.updateFlag)return;V.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(mV=this.DV())||void 0===mV||mV.markAllMaterialsAsDirty(1,(V=>-1!==V.getActiveTextures().indexOf(this))));if(this._textureMatrix=V,null===(h=this.DV())||void 0===h||!h.useRightHandedSystem)return;const t=A.TmpVectors.sh[0],L=A.TmpVectors.Quaternion[0],N=A.TmpVectors.sh[1];this._textureMatrix.decompose(t,L,N),L.z*=-1,L.w*=-1,A.Matrix.ComposeToRef(t,L,N,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var V;return null!==(V=this.DV())&&void 0!==V&&V.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=this.DV(),t=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const L=()=>{var h;(this.onLoadObservable.notifyObservers(this),t)&&(t.dispose(),null===(h=this.DV())||void 0===h||h.markAllMaterialsAsDirty(1));V&&V()},A=(V,mV)=>{this._loadingError=!0,this._errorObject={message:V,exception:mV},h&&h(V,mV),C.d.OnTextureLoadErrorObservable.notifyObservers(this)};var k;this._texture?this._texture.isReady?N.Tools.SetImmediate((()=>L())):this._texture.onLoadedObservable.add((()=>L())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,mV,this._lodScale,this._lodOffset,V,A,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,mV,this._files,this._noMipmap,V,A,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(k=this._texture)||void 0===k||k.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(V,h,mV){const t=n.e.Parse((()=>{let t=!1;return V.prefiltered&&(t=V.prefiltered),new q(mV+(V.url??V.name),h,V.extensions,!1,V.files||null,null,null,void 0,t,V.forcedExtension)}),V,h);if(V.boundingBoxPosition&&(t.boundingBoxPosition=A.sh.Dh(V.boundingBoxPosition)),V.boundingBoxSize&&(t.boundingBoxSize=A.sh.Dh(V.boundingBoxSize)),V.animations)for(let L=0;L<V.animations.length;L++){const h=V.animations[L],mV=(0,K.e)("BABYLON.Animation");mV&&t.animations.push(mV.Parse(h))}return t}clone(){let V=0;const h=n.e.Clone((()=>{const h=new q(this.url,this.DV()||this._getEngine(),this._extensions,this._noMipmap,this._files);return V=h.uniqueId,h}),this);return h.uniqueId=V,h}}(0,t.e)([(0,L.J)()],q.prototype,"url",void 0),(0,t.e)([(0,L.I)()],q.prototype,"boundingBoxPosition",void 0),(0,t.e)([(0,L.I)()],q.prototype,"boundingBoxSize",null),(0,t.e)([(0,L.J)("rotationY")],q.prototype,"rotationY",null),(0,t.e)([(0,L.J)("files")],q.prototype,"_files",void 0),(0,t.e)([(0,L.J)("forcedExtension")],q.prototype,"_forcedExtension",void 0),(0,t.e)([(0,L.J)("extensions")],q.prototype,"_extensions",void 0),(0,t.e)([(0,L.v)("textureMatrix")],q.prototype,"_textureMatrix",void 0),(0,t.e)([(0,L.v)("textureMatrixRefraction")],q.prototype,"_textureMatrixRefraction",void 0),C.d._CubeTextureParser=q.Parse,(0,K.i)("BABYLON.CubeTexture",q)},14553:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>C});var t=mV(12264),L=mV(12406),N=mV(12400),A=mV(12553),k=mV(12359);A.ThinEngine.prototype.createDynamicTexture=function(V,h,mV,t){const L=new k.d(this,4);return L.baseWidth=V,L.baseHeight=h,mV&&(V=this.needPOTTextures?(0,N.e)(V,this._caps.maxTextureSize):V,h=this.needPOTTextures?(0,N.e)(h,this._caps.maxTextureSize):h),L.width=V,L.height=h,L.isReady=!1,L.generateMipMaps=mV,L.samplingMode=t,this.updateTextureSamplingMode(t,L),this._internalTexturesCache.push(L),L},A.ThinEngine.prototype.updateDynamicTexture=function(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!V)return;const A=this._gl,k=A.TEXTURE_2D,C=this._bindTextureDirectly(k,V,!0,N);this._unpackFlipY(void 0===mV?V.invertY:mV),t&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const K=this._getWebGLTextureType(V.type),o=this._getInternalFormat(L||V.format),n=this._getRGBABufferInternalSizedFormat(V.type,o);A.texImage2D(k,0,n,o,K,h),V.generateMipMaps&&A.generateMipmap(k),C||this._bindTextureDirectly(k,null),t&&A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),L&&(V.format=L),V._dynamicTextureSource=h,V._premulAlpha=t,V.invertY=mV||!1,V.isReady=!0};class C extends L.d{constructor(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,k=arguments.length>6?arguments[6]:void 0;const C=!mV||mV._isScene;super(null,C?mV:null===mV||void 0===mV?void 0:mV.zh,C?!t:mV,k,N,void 0,void 0,void 0,void 0,A),this.name=V,this.wrapU=L.d.CLAMP_ADDRESSMODE,this.wrapV=L.d.CLAMP_ADDRESSMODE,this._generateMipMaps=t;const K=this._getEngine();if(!K)return;if(h.getContext)this._canvas=h,this._ownCanvas=!1,this._texture=K.createDynamicTexture(this._canvas.width,this._canvas.height,t,N);else{this._canvas=K.createCanvas(1,1),this._ownCanvas=!0;const V=h;V.width||0===V.width?this._texture=K.createDynamicTexture(V.width,V.height,t,N):this._texture=K.createDynamicTexture(h,h,t,N)}const o=this.getSize();this._canvas.width!==o.width&&(this._canvas.width=o.width),this._canvas.height!==o.height&&(this._canvas.height=o.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(V){this._canvas.width=V.width,this._canvas.height=V.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(V.width,V.height,this._generateMipMaps,this.samplingMode)}scale(V){const h=this.getSize();h.width*=V,h.height*=V,this._recreate(h)}scaleTo(V,h){const mV=this.getSize();mV.width=V,mV.height=h,this._recreate(mV)}getContext(){return this._context}clear(V){const h=this.getSize();V&&(this._context.fillStyle=V),this._context.clearRect(0,0,h.width,h.height)}update(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===V||V,h,this._format||void 0,void 0,mV)}drawText(V,h,mV,t,L,N,A){let k=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this.getSize();if(N&&(this._context.fillStyle=N,this._context.fillRect(0,0,C.width,C.height)),this._context.font=t,null===h||void 0===h){const mV=this._context.measureText(V);h=(C.width-mV.width)/2}if(null===mV||void 0===mV){const V=parseInt(t.replace(/\D/g,""));mV=C.height/2+V/3.65}this._context.fillStyle=L||"",this._context.fillText(V,h,mV),k&&this.update(A)}dispose(){var V,h;(super.dispose(),this._ownCanvas)&&(null===(V=this._canvas)||void 0===V||null===(h=V.remove)||void 0===h||h.call(V));this._canvas=null,this._context=null}clone(){const V=this.DV();if(!V)return this;const h=this.getSize(),mV=new C(this.name,h,V,this._generateMipMaps);return mV.Mk=this.Mk,mV.level=this.level,mV.wrapU=this.wrapU,mV.wrapV=this.wrapV,mV}serialize(){const V=this.DV();V&&!V.isReady()&&t.e.Warn("The scene must be ready before serializing the dynamic texture");const h=super.serialize();return C._IsCanvasElement(this._canvas)&&(h.base64String=this._canvas.toDataURL()),h.invertY=this._invertY,h.samplingMode=this.samplingMode,h}static _IsCanvasElement(V){return void 0!==V.toDataURL}_rebuild(){this.update()}}},14009:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>L});var t=mV(12406);class L extends t.d{get depth(){return this._depth}constructor(V,h,mV,L,N,A){let k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],C=arguments.length>7&&void 0!==arguments[7]&&arguments[7],K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:t.d.TRILINEAR_SAMPLINGMODE,o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,n=arguments.length>10?arguments[10]:void 0;super(null,A,!k,C),this.format=N,this._texture=A.getEngine().createRawTexture2DArray(V,h,mV,L,N,k,C,K,null,o,n),this._depth=L,this.is2DArray=!0}update(V){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,V,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(V,h,mV,t,N){return new L(V,h,mV,t,5,N,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13816:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>k,i:()=>C,j:()=>N,l:()=>A});var t=mV(12435),L=mV(12422);function N(V,h){return`{X: ${V.x.toFixed(h)} Y: ${V.y.toFixed(h)}}`}function A(V,h){return`{X: ${V._x.toFixed(h)} Y: ${V._y.toFixed(h)} Z: ${V._z.toFixed(h)}}`}function k(V,h){return 2*Math.acos((0,t.Clamp)(L.Quaternion.Dot(V,h)))}function C(V,h){const mV=new L.Quaternion;return function(V,h,mV){const N=L.sh.Cross(V,h),A=Math.acos((0,t.Clamp)(L.sh.Dot(V,h),-1,1));L.Quaternion.RotationAxisToRef(N,A,mV)}(V,h,mV),mV}},13643:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>K});var t=mV(12422),L=mV(12453),N=mV(12836),A=mV(12817),k=mV(12460);mV(13652);function C(V){let h=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const mV=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],N=[];let C=[];const K=V.width||V.size||1,o=V.height||V.size||1,n=V.depth||V.size||1,q=V.wrap||!1;let x=void 0===V.topBaseAt?1:V.topBaseAt,R=void 0===V.bottomBaseAt?0:V.bottomBaseAt;x=(x+4)%4,R=(R+4)%4;let d=[2,0,3,1][x],s=[2,0,1,3][R],M=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(q){h=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],M=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let V=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],mV=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const t=[17,18,19,16],L=[22,23,20,21];for(;d>0;)V.unshift(V.pop()),t.unshift(t.pop()),d--;for(;s>0;)mV.unshift(mV.pop()),L.unshift(L.pop()),s--;V=V.flat(),mV=mV.flat(),M=M.concat(V).concat(mV),h.push(t[0],t[2],t[3],t[0],t[1],t[2]),h.push(L[0],L[2],L[3],L[0],L[1],L[2])}const c=[K/2,o/2,n/2];C=M.reduce(((V,h,mV)=>V.concat(h*c[mV%3])),[]);const z=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE,Q=V.faceUV||new Array(6),J=V.faceColors,v=[];for(let A=0;A<6;A++)void 0===Q[A]&&(Q[A]=new t.Vector4(0,0,1,1)),J&&void 0===J[A]&&(J[A]=new L.Gk(1,1,1,1));for(let t=0;t<6;t++)if(N.push(Q[t].z,k.b?1-Q[t].w:Q[t].w),N.push(Q[t].x,k.b?1-Q[t].w:Q[t].w),N.push(Q[t].x,k.b?1-Q[t].y:Q[t].y),N.push(Q[t].z,k.b?1-Q[t].y:Q[t].y),J)for(let V=0;V<4;V++)v.push(J[t].r,J[t].g,J[t].b,J[t].a);A.e._ComputeSides(z,C,h,mV,N,V.frontUVs,V.backUVs);const D=new A.e;if(D.indices=h,D.jV=C,D.lV=mV,D.yV=N,J){const V=z===A.e.DOUBLESIDE?v.concat(v):v;D.GV=V}return D}function K(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new N.c(V,mV);h.sideOrientation=N.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return C(h).IV(t,h.updatable),t}A.e.CreateBox=C,N.c.CreateBox=function(V,h){return K(V,{size:h,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13805:(V,h,mV)=>{"use strict";mV.d(h,{c:()=>k});var t=mV(12836),L=mV(12817),N=mV(12460);function A(V){const h=[],mV=[],t=[],A=[],k=V.radius||.5,C=V.tessellation||64,K=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,o=0===V.sideOrientation?0:V.sideOrientation||L.e.DEFAULTSIDE;h.push(0,0,0),A.push(.5,.5);const n=2*Math.PI*K,q=1===K?n/C:n/(C-1);let x=0;for(let L=0;L<C;L++){const V=Math.cos(x),mV=Math.sin(x),t=(V+1)/2,L=(1-mV)/2;h.push(k*V,k*mV,0),A.push(t,N.b?1-L:L),x+=q}1===K&&(h.push(h[3],h[4],h[5]),A.push(A[2],N.b?1-A[3]:A[3]));const R=h.length/3;for(let L=1;L<R-1;L++)mV.push(L+1,0,L);L.e.ComputeNormals(h,mV,t),L.e._ComputeSides(o,h,mV,t,A,V.frontUVs,V.backUVs);const d=new L.e;return d.indices=mV,d.jV=h,d.lV=t,d.yV=A,d}function k(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new t.c(V,mV);h.sideOrientation=t.c._GetDefaultSideOrientation(h.sideOrientation),L._originalBuilderSideOrientation=h.sideOrientation;return A(h).IV(L,h.updatable),L}L.e.CreateDisc=A,t.c.CreateDisc=function(V,h,mV){return k(V,{radius:h,tessellation:mV,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13652:(V,h,mV)=>{"use strict";mV.d(h,{f:()=>s,c:()=>c,i:()=>M});var t=mV(12422),L=mV(12453),N=mV(12836),A=mV(12817),k=mV(12481);N.c._GroundMeshParser=(V,h)=>C.Parse(V,h);class C extends N.c{constructor(V,h){super(V,h),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=V,this._subdivisionsY=V,this.subdivide(V);const mV=this;mV.createOrUpdateSubmeshesOctree&&mV.createOrUpdateSubmeshesOctree(h)}getHeightAtCoordinates(V,h){const mV=this.getWorldMatrix(),L=t.TmpVectors.Matrix[5];mV.invertToRef(L);const N=t.TmpVectors.sh[8];if(t.sh.TransformCoordinatesFromFloatsToRef(V,0,h,L,N),V=N.x,h=N.z,V<this._minX||V>=this._maxX||h<=this._minZ||h>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const A=this._getFacetAt(V,h),k=-(A.x*V+A.z*h+A.w)/A.y;return t.sh.TransformCoordinatesFromFloatsToRef(0,k,0,mV,N),N.y}getNormalAtCoordinates(V,h){const mV=new t.sh(0,1,0);return this.getNormalAtCoordinatesToRef(V,h,mV),mV}getNormalAtCoordinatesToRef(V,h,mV){const L=this.getWorldMatrix(),N=t.TmpVectors.Matrix[5];L.invertToRef(N);const A=t.TmpVectors.sh[8];if(t.sh.TransformCoordinatesFromFloatsToRef(V,0,h,N,A),V=A.x,h=A.z,V<this._minX||V>this._maxX||h<this._minZ||h>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const k=this._getFacetAt(V,h);return t.sh.TransformNormalFromFloatsToRef(k.x,k.y,k.z,L,mV),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(V,h){const mV=Math.floor((V+this._maxX)*this._subdivisionsX/this._width),t=Math.floor(-(h+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),L=this._heightQuads[t*this._subdivisionsX+mV];let N;return N=h<L.slope.x*V+L.slope.y?L.facet1:L.facet2,N}_initHeightQuads(){const V=this._subdivisionsX,h=this._subdivisionsY;this._heightQuads=[];for(let mV=0;mV<h;mV++)for(let h=0;h<V;h++){const L={slope:t.Vector2.Zero(),facet1:new t.Vector4(0,0,0,0),facet2:new t.Vector4(0,0,0,0)};this._heightQuads[mV*V+h]=L}return this}_computeHeightQuads(){const V=this.getVerticesData(k.i.PositionKind);if(!V)return this;const h=t.TmpVectors.sh[3],mV=t.TmpVectors.sh[2],L=t.TmpVectors.sh[1],N=t.TmpVectors.sh[0],A=t.TmpVectors.sh[4],C=t.TmpVectors.sh[5],K=t.TmpVectors.sh[6],o=t.TmpVectors.sh[7],n=t.TmpVectors.sh[8];let q=0,x=0,R=0,d=0,s=0,M=0,c=0;const z=this._subdivisionsX,Q=this._subdivisionsY;for(let k=0;k<Q;k++)for(let Q=0;Q<z;Q++){q=3*Q,x=k*(z+1)*3,R=(k+1)*(z+1)*3,h.x=V[x+q],h.y=V[x+q+1],h.z=V[x+q+2],mV.x=V[x+q+3],mV.y=V[x+q+4],mV.z=V[x+q+5],L.x=V[R+q],L.y=V[R+q+1],L.z=V[R+q+2],N.x=V[R+q+3],N.y=V[R+q+4],N.z=V[R+q+5],d=(N.z-h.z)/(N.x-h.x),s=h.z-d*h.x,mV.subtractToRef(h,A),L.subtractToRef(h,C),N.subtractToRef(h,K),t.sh.CrossToRef(K,C,o),t.sh.CrossToRef(A,K,n),o.normalize(),n.normalize(),M=-(o.x*h.x+o.y*h.y+o.z*h.z),c=-(n.x*mV.x+n.y*mV.y+n.z*mV.z);const J=this._heightQuads[k*z+Q];J.slope.Hk(d,s),J.facet1.Hk(o.x,o.y,o.z,M),J.facet2.Hk(n.x,n.y,n.z,c)}return this}serialize(V){super.serialize(V),V.subdivisionsX=this._subdivisionsX,V.subdivisionsY=this._subdivisionsY,V.minX=this._minX,V.maxX=this._maxX,V.ck=this._minZ,V.maxZ=this._maxZ,V.width=this._width,V.height=this._height}static Parse(V,h){const mV=new C(V.name,h);return mV._subdivisionsX=V.subdivisionsX||1,mV._subdivisionsY=V.subdivisionsY||1,mV._minX=V.minX,mV._maxX=V.maxX,mV._minZ=V.ck,mV._maxZ=V.maxZ,mV._width=V.width,mV._height=V.height,mV}}var K=mV(12253),o=mV(12300),n=mV(12425),q=mV(12460);function x(V){const h=[],mV=[],L=[],N=[];let k,C;const K=V.width||V.size||1,o=V.height||V.size||1,n=0|(V.subdivisionsX||V.subdivisions||1),x=0|(V.subdivisionsY||V.subdivisions||1);for(k=0;k<=x;k++)for(C=0;C<=n;C++){const V=new t.sh(C*K/n-K/2,0,(x-k)*o/x-o/2),h=new t.sh(0,1,0);mV.push(V.x,V.y,V.z),L.push(h.x,h.y,h.z),N.push(C/n,q.b?k/x:1-k/x)}for(k=0;k<x;k++)for(C=0;C<n;C++)h.push(C+1+(k+1)*(n+1)),h.push(C+1+k*(n+1)),h.push(C+k*(n+1)),h.push(C+(k+1)*(n+1)),h.push(C+1+(k+1)*(n+1)),h.push(C+k*(n+1));const R=new A.e;return R.indices=h,R.jV=mV,R.lV=L,R.yV=N,R}function R(V){const h=void 0!==V.xmin&&null!==V.xmin?V.xmin:-1,mV=void 0!==V.zmin&&null!==V.zmin?V.zmin:-1,L=void 0!==V.xmax&&null!==V.xmax?V.xmax:1,N=void 0!==V.zmax&&null!==V.zmax?V.zmax:1,k=V.subdivisions||{w:1,h:1},C=V.precision||{w:1,h:1},K=[],o=[],n=[],q=[];let x,R,d,s;k.h=k.h<1?1:k.h,k.w=k.w<1?1:k.w,C.w=C.w<1?1:C.w,C.h=C.h<1?1:C.h;const M=(L-h)/k.w,c=(N-mV)/k.h;function z(V,h,mV,L){const N=o.length/3,A=C.w+1;for(x=0;x<C.h;x++)for(R=0;R<C.w;R++){const V=[N+R+x*A,N+(R+1)+x*A,N+(R+1)+(x+1)*A,N+R+(x+1)*A];K.push(V[1]),K.push(V[2]),K.push(V[3]),K.push(V[0]),K.push(V[1]),K.push(V[3])}const k=t.sh.Zero(),d=new t.sh(0,1,0);for(x=0;x<=C.h;x++)for(k.z=x*(L-h)/C.h+h,R=0;R<=C.w;R++)k.x=R*(mV-V)/C.w+V,k.y=0,o.push(k.x,k.y,k.z),n.push(d.x,d.y,d.z),q.push(R/C.w,x/C.h)}for(d=0;d<k.h;d++)for(s=0;s<k.w;s++)z(h+s*M,mV+d*c,h+(s+1)*M,mV+(d+1)*c);const Q=new A.e;return Q.indices=K,Q.jV=o,Q.lV=n,Q.yV=q,Q}function d(V){const h=[],mV=[],N=[],k=[];let C,K;const o=V.colorFilter||new L.Jh(.3,.59,.11),q=V.alphaFilter||0;let x=!1;if(V.minHeight>V.maxHeight){x=!0;const h=V.maxHeight;V.maxHeight=V.minHeight,V.minHeight=h}for(C=0;C<=V.subdivisions;C++)for(K=0;K<=V.subdivisions;K++){const h=new t.sh(K*V.width/V.subdivisions-V.width/2,0,(V.subdivisions-C)*V.height/V.subdivisions-V.height/2),L=4*(((h.x+V.width/2)/V.width*(V.bufferWidth-1)|0)+((1-(h.z+V.height/2)/V.height)*(V.bufferHeight-1)|0)*V.bufferWidth);let A=V.buffer[L]/255,R=V.buffer[L+1]/255,d=V.buffer[L+2]/255;const s=V.buffer[L+3]/255;x&&(A=1-A,R=1-R,d=1-d);const M=A*o.r+R*o.g+d*o.b;h.y=s>=q?V.minHeight+(V.maxHeight-V.minHeight)*M:V.minHeight-n.c,V.heightBuffer&&(V.heightBuffer[C*(V.subdivisions+1)+K]=h.y),mV.push(h.x,h.y,h.z),N.push(0,0,0),k.push(K/V.subdivisions,1-C/V.subdivisions)}for(C=0;C<V.subdivisions;C++)for(K=0;K<V.subdivisions;K++){const t=K+1+(C+1)*(V.subdivisions+1),L=K+1+C*(V.subdivisions+1),N=K+C*(V.subdivisions+1),A=K+(C+1)*(V.subdivisions+1),k=mV[3*t+1]>=V.minHeight,o=mV[3*L+1]>=V.minHeight,n=mV[3*N+1]>=V.minHeight;k&&o&&n&&(h.push(t),h.push(L),h.push(N));mV[3*A+1]>=V.minHeight&&k&&n&&(h.push(A),h.push(t),h.push(N))}A.e.ComputeNormals(mV,h,N);const R=new A.e;return R.indices=h,R.jV=mV,R.lV=N,R.yV=k,R}function s(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const mV=new C(V,arguments.length>2?arguments[2]:void 0);mV._setReady(!1),mV._subdivisionsX=h.subdivisionsX||h.subdivisions||1,mV._subdivisionsY=h.subdivisionsY||h.subdivisions||1,mV._width=h.width||1,mV._height=h.height||1,mV._maxX=mV._width/2,mV._maxZ=mV._height/2,mV._minX=-mV._maxX,mV._minZ=-mV._maxZ;return x(h).IV(mV,h.updatable),mV._setReady(!0),mV}function M(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new N.c(V,mV);return R(h).IV(t,h.updatable),t}function c(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=mV.width||10,A=mV.height||10,k=mV.subdivisions||1,n=mV.minHeight||0,q=mV.maxHeight||1,x=mV.colorFilter||new L.Jh(.3,.59,.11),R=mV.alphaFilter||0,s=mV.updatable,M=mV.onReady;t=t||o.b.LastCreatedScene;const c=new C(V,t);let z;c._subdivisionsX=k,c._subdivisionsY=k,c._width=N,c._height=A,c._maxX=c._width/2,c._maxZ=c._height/2,c._minX=-c._maxX,c._minZ=-c._maxZ,c._setReady(!1),mV.passHeightBufferInCallback&&(z=new Float32Array((k+1)*(k+1)));const Q=(V,h,mV)=>{d({width:N,height:A,subdivisions:k,minHeight:n,maxHeight:q,colorFilter:x,buffer:V,bufferWidth:h,bufferHeight:mV,alphaFilter:R,heightBuffer:z}).IV(c,s),M&&M(c,z),c._setReady(!0)};if("string"===typeof h){const V=V=>{var h;const mV=V.width,L=V.height;if(t.A)return;const N=null===(h=t)||void 0===h?void 0:h.getEngine().resizeImageBitmap(V,mV,L);Q(N,mV,L)};K.Tools.LoadImage(h,V,mV.onError?mV.onError:()=>{},t.offlineProvider)}else Q(h.data,h.width,h.height);return c}A.e.CreateGround=x,A.e.CreateTiledGround=R,A.e.CreateGroundFromHeightMap=d,N.c.CreateGround=(V,h,mV,t,L,N)=>s(V,{width:h,height:mV,subdivisions:t,updatable:N},L),N.c.CreateTiledGround=(V,h,mV,t,L,N,A,k,C)=>M(V,{xmin:h,zmin:mV,xmax:t,zmax:L,subdivisions:N,precision:A,updatable:C},k),N.c.CreateGroundFromHeightMap=(V,h,mV,t,L,N,A,k,C,K,o)=>c(V,h,{width:mV,height:t,subdivisions:L,minHeight:N,maxHeight:A,updatable:C,onReady:K,alphaFilter:o},k)},14266:(V,h,mV)=>{"use strict";mV.d(h,{c:()=>x,d:()=>n,h:()=>q});var t=mV(12422),L=mV(12836),N=mV(12817),A=mV(12946),k=mV(12481),C=mV(12264);function K(V){const h=[],mV=[],t=V.lines,L=V.GV,A=[];let k=0;for(let N=0;N<t.length;N++){const V=t[N];for(let t=0;t<V.length;t++){const{x:C,y:K,z:o}=V[t];if(mV.push(C,K,o),L){const V=L[N],{r:h,g:mV,b:k,a:C}=V[t];A.push(h,mV,k,C)}t>0&&(h.push(k-1),h.push(k)),k++}}const C=new N.e;return C.indices=h,C.jV=mV,L&&(C.GV=A),C}function o(V){const h=V.dashSize||3,mV=V.gapSize||1,L=V.dashNb||200,A=V.points,k=[],C=[],K=t.sh.Zero();let o=0,n=0,q=0,x=0,R=0,d=0,s=0;for(s=0;s<A.length-1;s++)A[s+1].subtractToRef(A[s],K),o+=K.length();for(q=o/L,x=h*q/(h+mV),s=0;s<A.length-1;s++){A[s+1].subtractToRef(A[s],K),n=Math.floor(K.length()/q),K.normalize();for(let V=0;V<n;V++)R=q*V,k.push(A[s].x+R*K.x,A[s].y+R*K.y,A[s].z+R*K.z),k.push(A[s].x+(R+x)*K.x,A[s].y+(R+x)*K.y,A[s].z+(R+x)*K.z),C.push(d,d+1),d+=2}const M=new N.e;return M.jV=k,M.indices=C,M}function n(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=h.instance,L=h.lines,N=h.GV;if(t){const V=t.getVerticesData(k.i.PositionKind);let h,mV;N&&(h=t.getVerticesData(k.i.ColorKind));let A=0,C=0;for(let t=0;t<L.length;t++){const k=L[t];for(let L=0;L<k.length;L++)V[A]=k[L].x,V[A+1]=k[L].y,V[A+2]=k[L].z,N&&h&&(mV=N[t],h[C]=mV[L].r,h[C+1]=mV[L].g,h[C+2]=mV[L].b,h[C+3]=mV[L].a,C+=4),A+=3}return t.updateVerticesData(k.i.PositionKind,V,!1,!1),N&&h&&t.updateVerticesData(k.i.ColorKind,h,!1,!1),t.refreshBoundingInfo(),t}const C=!!N,o=new A.c(V,mV,null,void 0,void 0,C,h.useVertexAlpha,h.material);return K(h).IV(o,h.updatable),o}function q(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=h.GV?[h.GV]:null;return n(V,{lines:[h.points],updatable:h.updatable,instance:h.instance,GV:t,useVertexAlpha:h.useVertexAlpha,material:h.material},mV)}function x(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=h.points,k=h.instance,K=h.gapSize||1,n=h.dashSize||3;if(k){const V=V=>{const h=t.sh.Zero(),mV=V.length/6;let L=0,A=0,C=0,K=0,o=0,n=0,q=0,x=0;for(q=0;q<N.length-1;q++)N[q+1].subtractToRef(N[q],h),L+=h.length();C=L/mV;const R=k._creationDataStorage.dashSize;for(K=R*C/(R+k._creationDataStorage.gapSize),q=0;q<N.length-1;q++)for(N[q+1].subtractToRef(N[q],h),A=Math.floor(h.length()/C),h.normalize(),x=0;x<A&&n<V.length;)o=C*x,V[n]=N[q].x+o*h.x,V[n+1]=N[q].y+o*h.y,V[n+2]=N[q].z+o*h.z,V[n+3]=N[q].x+(o+K)*h.x,V[n+4]=N[q].y+(o+K)*h.y,V[n+5]=N[q].z+(o+K)*h.z,n+=6,x++;for(;n<V.length;)V[n]=N[q].x,V[n+1]=N[q].y,V[n+2]=N[q].z,n+=3};return(h.dashNb||h.dashSize||h.gapSize||h.useVertexAlpha||h.material)&&C.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),k.updateMeshPositions(V,!1),k}const q=new A.c(V,mV,null,void 0,void 0,void 0,h.useVertexAlpha,h.material);return o(h).IV(q,h.updatable),q._creationDataStorage=new L.e,q._creationDataStorage.dashSize=n,q._creationDataStorage.gapSize=K,q}N.e.CreateLineSystem=K,N.e.CreateDashedLines=o,L.c.QK=function(V,h){return q(V,{points:h,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},L.c.CreateDashedLines=function(V,h,mV,t,L){return x(V,{points:h,dashSize:mV,gapSize:t,dashNb:L,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13690:(V,h,mV)=>{"use strict";mV.d(h,{c:()=>k,e:()=>C});var t=mV(12836),L=mV(12817),N=mV(12460);function A(V){const h=[],mV=[],t=[],A=[],k=void 0!==V.width?V.width:void 0!==V.size?V.size:1,C=void 0!==V.height?V.height:void 0!==V.size?V.size:1,K=0===V.sideOrientation?0:V.sideOrientation||L.e.DEFAULTSIDE,o=k/2,n=C/2;mV.push(-o,-n,0),t.push(0,0,-1),A.push(0,N.b?1:0),mV.push(o,-n,0),t.push(0,0,-1),A.push(1,N.b?1:0),mV.push(o,n,0),t.push(0,0,-1),A.push(1,N.b?0:1),mV.push(-o,n,0),t.push(0,0,-1),A.push(0,N.b?0:1),h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),L.e._ComputeSides(K,mV,h,t,A,V.frontUVs,V.backUVs);const q=new L.e;return q.indices=h,q.jV=mV,q.lV=t,q.yV=A,q}function k(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const L=new t.c(V,mV);h.sideOrientation=t.c._GetDefaultSideOrientation(h.sideOrientation),L._originalBuilderSideOrientation=h.sideOrientation;return A(h).IV(L,h.updatable),h.sourcePlane&&(L.translate(h.sourcePlane.normal,-h.sourcePlane.d),L.setDirection(h.sourcePlane.normal.scale(-1))),L}const C={DK:k};L.e.DK=A,t.c.DK=(V,h,mV,t,L)=>k(V,{size:h,width:h,height:h,sideOrientation:L,updatable:t},mV)},13787:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>C});var t=mV(12422),L=mV(12836),N=mV(12817),A=mV(12460);function k(V){const h=0|(V.segments||32),mV=V.diameterX||V.diameter||1,L=V.diameterY||V.diameter||1,k=V.diameterZ||V.diameter||1,C=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,K=V.slice&&V.slice<=0?1:V.slice||1,o=0===V.sideOrientation?0:V.sideOrientation||N.e.DEFAULTSIDE,n=!!V.dedupTopBottomIndices,q=new t.sh(mV/2,L/2,k/2),x=2+h,R=2*x,d=[],s=[],M=[],c=[];for(let N=0;N<=x;N++){const V=N/x,h=V*Math.PI*K;for(let mV=0;mV<=R;mV++){const L=mV/R,N=L*Math.PI*2*C,k=t.Matrix.RotationZ(-h),K=t.Matrix.RotationY(N),o=t.sh.TransformCoordinates(t.sh.Up(),k),n=t.sh.TransformCoordinates(o,K),x=n.multiply(q),d=n.divide(q).normalize();s.push(x.x,x.y,x.z),M.push(d.x,d.y,d.z),c.push(L,A.b?1-V:V)}if(N>0){const V=s.length/3;for(let h=V-2*(R+1);h+R+2<V;h++)n?(N>1&&(d.push(h),d.push(h+1),d.push(h+R+1)),(N<x||K<1)&&(d.push(h+R+1),d.push(h+1),d.push(h+R+2))):(d.push(h),d.push(h+1),d.push(h+R+1),d.push(h+R+1),d.push(h+1),d.push(h+R+2))}}N.e._ComputeSides(o,s,d,M,c,V.frontUVs,V.backUVs);const z=new N.e;return z.indices=d,z.jV=s,z.lV=M,z.yV=c,z}function C(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return k(h).IV(t,h.updatable),t}N.e.CreateSphere=k,L.c.CreateSphere=(V,h,mV,t,L,N)=>C(V,{segments:h,diameterX:mV,diameterY:mV,diameterZ:mV,sideOrientation:N,updatable:L},t)},14569:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>k});var t=mV(12969),L=mV(14088),N=mV(12986),A=mV(12817);class k{static get Configuration(){return{get decoder(){return L.e.DefaultConfiguration},set decoder(V){L.e.DefaultConfiguration=V}}}static set Configuration(V){L.e.DefaultConfiguration=V.decoder}static get DecoderAvailable(){return(0,t.h)(L.e.DefaultConfiguration)}static get Default(){return k._Default??(k._Default=new k),k._Default}static ResetDefault(V){k._Default&&(V||k._Default.dispose(),k._Default=null)}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.DefaultNumWorkers;const h="number"===typeof V?{...L.e.DefaultConfiguration,numWorkers:V}:{...L.e.DefaultConfiguration,...V};this._decoder=new L.e(h)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(V,h,mV){return this._decoder.decodeMeshToMeshDataAsync(V,h,mV)}async decodeMeshToGeometryAsync(V,h,mV,t){return await this._decoder.decodeMeshToGeometryAsync(V,h,mV,t)}async _decodeMeshToGeometryForGltfAsync(V,h,mV,t,L,N){return await this._decoder._decodeMeshToGeometryForGltfAsync(V,h,mV,t,L,N)}async decodeMeshAsync(V,h){const mV=await this._decoder.decodeMeshToMeshDataAsync(V,h),t=new A.e;mV.indices&&(t.indices=mV.indices);for(const L of mV.attributes){const V=N.e.GetFloatData(L.data,L.size,N.e.GetDataType(L.data),L.byteOffset,L.byteStride,L.normalized,mV.totalVertices);t.set(V,L.kind)}return t}}k.DefaultNumWorkers=(0,t.e)(),k._Default=null},14088:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>K});var t=mV(12969),L=mV(12253),N=mV(12845),A=mV(12986),k=mV(12264),C=mV(12979);class K extends t.b{static get DefaultAvailable(){return(0,t.h)(K.DefaultConfiguration)}static get Default(){return K._Default??(K._Default=new K),K._Default}static ResetDefault(V){K._Default&&(V||K._Default.dispose(),K._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(V,h){return{module:await(h||DracoDecoderModule)({wasmBinary:V})}}_getWorkerContent(){return`${C.c}(${C.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:K.DefaultConfiguration)}decodeMeshToMeshDataAsync(V,h,mV){const t=V instanceof ArrayBuffer?new Int8Array(V):new Int8Array(V.buffer,V.byteOffset,V.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async V=>await new Promise(((L,N)=>{V.push(((V,A)=>{let C=null;const K=[],o=h=>{V.removeEventListener("error",o),V.removeEventListener("message",n),N(h),A()},n=h=>{const t=h.data;switch(t.id){case"indices":C=t.data;break;case"attribute":K.push({kind:t.kind,data:t.data,size:t.size,byteOffset:t.byteOffset,byteStride:t.byteStride,normalized:(N=t.kind,q=t.normalized,mV&&void 0!==mV[N]?(q!==mV[N]&&k.e.Warn(`Normalized flag from Draco data (${q}) does not match normalized flag from glTF accessor (${mV[N]}). Using flag from glTF accessor.`),mV[N]):q)});break;case"decodeMeshDone":V.removeEventListener("error",o),V.removeEventListener("message",n),L({indices:C,attributes:K,totalVertices:t.totalVertices}),A()}var N,q};V.addEventListener("error",o),V.addEventListener("message",n);const q=t.slice();V.postMessage({id:"decodeMesh",dataView:q,attributes:h},[q.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((V=>{let mV=null;const L=[],N=(0,C.c)(V.module,t,h,(V=>{mV=V}),((V,h,mV,t,N,A)=>{L.push({kind:V,data:h,size:mV,byteOffset:t,byteStride:N,normalized:A})}));return{indices:mV,attributes:L,totalVertices:N}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(V,h,mV,t){const L=await this.decodeMeshToMeshDataAsync(mV,t),k=new N.e(V,h);L.indices&&k.setIndices(L.indices);for(const N of L.attributes)k.setVerticesBuffer(new A.e(h.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),L.totalVertices);return k}async _decodeMeshToGeometryForGltfAsync(V,h,mV,t,L,k){const C=await this.decodeMeshToMeshDataAsync(mV,t,L),K=new N.e(V,h);k&&(K._boundingInfo=k,K.useBoundingInfoFromGeometry=!0),C.indices&&K.setIndices(C.indices);for(const N of C.attributes)K.setVerticesBuffer(new A.e(h.getEngine(),N.data,N.kind,!1,void 0,N.byteStride,void 0,N.byteOffset,N.size,void 0,N.normalized,!0),C.totalVertices);return K}}K.DefaultConfiguration={wasmUrl:`${L.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${L.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${L.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},K._Default=null},14263:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>kV});var t=mV(12422),L=mV(12836),N=mV(12481),A=mV(12817),k=mV(12460);function C(V){let h=V.pathArray;const mV=V.closeArray||!1,t=V.closePath||!1,L=V.invertUV||!1,C=Math.floor(h[0].length/2);let K=V.offset||C;K=K>C?C:Math.floor(K);const o=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE,n=V.yV,q=V.GV,x=[],R=[],d=[],s=[],M=[],c=[],z=[],Q=[];let J;const v=[],D=[];let H,j,l;if(h.length<2){const V=[],mV=[];for(j=0;j<h[0].length-K;j++)V.push(h[0][j]),mV.push(h[0][j+K]);h=[V,mV]}let G=0;const y=t?1:0,O=mV?1:0;let I,r,T,F,p,Z;for(J=h[0].length,H=0;H<h.length+O;H++){for(z[H]=0,M[H]=[0],I=H===h.length?h[0]:h[H],r=I.length,J=J<r?J:r,l=0;l<r;)x.push(I[l].x,I[l].y,I[l].z),l>0&&(T=I[l].Mh(I[l-1]).length(),F=T+z[H],M[H].push(F),z[H]=F),l++;t&&(l--,x.push(I[0].x,I[0].y,I[0].z),T=I[l].Mh(I[0]).length(),F=T+z[H],M[H].push(F),z[H]=F),v[H]=r+y,D[H]=G,G+=r+y}let f,S,Y=null,w=null;for(j=0;j<J+y;j++)for(Q[j]=0,c[j]=[0],H=0;H<h.length-1+O;H++)p=h[H],Z=H===h.length-1?h[0]:h[H+1],j===J?(Y=p[0],w=Z[0]):(Y=p[j],w=Z[j]),T=w.Mh(Y).length(),F=T+Q[j],c[j].push(F),Q[j]=F;if(n)for(H=0;H<n.length;H++)s.push(n[H].x,k.b?1-n[H].y:n[H].y);else for(H=0;H<h.length+O;H++)for(j=0;j<J+y;j++)f=0!=z[H]?M[H][j]/z[H]:0,S=0!=Q[j]?c[j][H]/Q[j]:0,L?s.push(S,f):s.push(f,k.b?1-S:S);H=0;let E=0,g=v[H]-1,i=v[H+1]-1,b=g<i?g:i,P=D[1]-D[0];const U=v.length-1;for(;E<=b&&H<U;)R.push(E,E+P,E+1),R.push(E+P+1,E+1,E+P),E+=1,E===b&&(H++,P=D[H+1]-D[H],g=v[H]-1,i=v[H+1]-1,E=D[H],b=g<i?g+E:i+E);if(A.e.ComputeNormals(x,R,d),t){let V=0,mV=0;for(H=0;H<h.length;H++){V=3*D[H],mV=H+1<h.length?3*(D[H+1]-1):d.length-3,d[V]=.5*(d[V]+d[mV]),d[V+1]=.5*(d[V+1]+d[mV+1]),d[V+2]=.5*(d[V+2]+d[mV+2]);const t=Math.sqrt(d[V]*d[V]+d[V+1]*d[V+1]+d[V+2]*d[V+2]);d[V]/=t,d[V+1]/=t,d[V+2]/=t,d[mV]=d[V],d[mV+1]=d[V+1],d[mV+2]=d[V+2]}}if(mV){let V=3*D[0],mV=3*D[h.length];for(j=0;j<J+y;j++){d[V]=.5*(d[V]+d[mV]),d[V+1]=.5*(d[V+1]+d[mV+1]),d[V+2]=.5*(d[V+2]+d[mV+2]);const h=Math.sqrt(d[V]*d[V]+d[V+1]*d[V+1]+d[V+2]*d[V+2]);d[V]/=h,d[V+1]/=h,d[V+2]/=h,d[mV]=d[V],d[mV+1]=d[V+1],d[mV+2]=d[V+2],V+=3,mV+=3}}A.e._ComputeSides(o,x,R,d,s,V.frontUVs,V.backUVs);let u=null;if(q){u=new Float32Array(4*q.length);for(let V=0;V<q.length;V++)u[4*V]=q[V].r,u[4*V+1]=q[V].g,u[4*V+2]=q[V].b,u[4*V+3]=q[V].a}const e=new A.e,W=new Float32Array(x),X=new Float32Array(d),a=new Float32Array(s);return e.indices=R,e.jV=W,e.lV=X,e.yV=a,u&&e.set(u,N.i.ColorKind),t&&(e._idx=D),e}function K(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const K=h.pathArray,o=h.closeArray,n=h.closePath,q=L.c._GetDefaultSideOrientation(h.sideOrientation),x=h.instance,R=h.updatable;if(x){const V=t.TmpVectors.sh[0].lk(Number.MAX_VALUE),mV=t.TmpVectors.sh[1].lk(-Number.MAX_VALUE),C=h=>{let t=K[0].length;const N=x;let A=0;const k=N._originalBuilderSideOrientation===L.c.DOUBLESIDE?2:1;for(let L=1;L<=k;++L)for(let k=0;k<K.length;++k){const L=K[k],C=L.length;t=t<C?t:C;for(let N=0;N<t;++N){const t=L[N];h[A]=t.x,h[A+1]=t.y,h[A+2]=t.z,V.minimizeInPlaceFromFloats(t.x,t.y,t.z),mV.maximizeInPlaceFromFloats(t.x,t.y,t.z),A+=3}if(N._creationDataStorage&&N._creationDataStorage.closePath){const V=L[0];h[A]=V.x,h[A+1]=V.y,h[A+2]=V.z,A+=3}}},o=x.getVerticesData(N.i.PositionKind);if(C(o),x.hasBoundingInfo?x.getBoundingInfo().reConstruct(V,mV,x._worldMatrix):x.buildBoundingInfo(V,mV,x._worldMatrix),x.updateVerticesData(N.i.PositionKind,o,!1,!1),h.GV){const V=x.getVerticesData(N.i.ColorKind);for(let mV=0,t=0;mV<h.GV.length;mV++,t+=4){const L=h.GV[mV];V[t]=L.r,V[t+1]=L.g,V[t+2]=L.b,V[t+3]=L.a}x.updateVerticesData(N.i.ColorKind,V,!1,!1)}if(h.yV){const V=x.getVerticesData(N.i.UVKind);for(let mV=0;mV<h.yV.length;mV++)V[2*mV]=h.yV[mV].x,V[2*mV+1]=k.b?1-h.yV[mV].y:h.yV[mV].y;x.updateVerticesData(N.i.UVKind,V,!1,!1)}if(!x.areNormalsFrozen||x.isFacetDataEnabled){const V=x.vk(),h=x.getVerticesData(N.i.NormalKind),mV=x.isFacetDataEnabled?x.getFacetDataParameters():null;if(A.e.ComputeNormals(o,V,h,mV),x._creationDataStorage&&x._creationDataStorage.closePath){let V=0,mV=0;for(let t=0;t<K.length;t++)V=3*x._creationDataStorage.idx[t],mV=t+1<K.length?3*(x._creationDataStorage.idx[t+1]-1):h.length-3,h[V]=.5*(h[V]+h[mV]),h[V+1]=.5*(h[V+1]+h[mV+1]),h[V+2]=.5*(h[V+2]+h[mV+2]),h[mV]=h[V],h[mV+1]=h[V+1],h[mV+2]=h[V+2]}x.areNormalsFrozen||x.updateVerticesData(N.i.NormalKind,h,!1,!1)}return x}{const t=new L.c(V,mV);t._originalBuilderSideOrientation=q,t._creationDataStorage=new L.e;const N=C(h);return n&&(t._creationDataStorage.idx=N._idx),t._creationDataStorage.closePath=n,t._creationDataStorage.closeArray=o,N.IV(t,R),t}}A.e.CreateRibbon=C,L.c.CreateRibbon=function(V,h){return K(V,{pathArray:h,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var o=mV(13805),n=mV(13643),q=mV(12453);function x(V){const h=V.pattern||L.c.NO_FLIP,mV=V.tileWidth||V.tileSize||1,t=V.tileHeight||V.tileSize||1,N=V.alignHorizontal||0,k=V.alignVertical||0,C=V.width||V.size||1,K=Math.floor(C/mV);let o=C-K*mV;const n=V.height||V.size||1,q=Math.floor(n/t);let x=n-q*t;const R=mV*K/2,d=t*q/2;let s=0,M=0,c=0,z=0,Q=0,J=0;if(o>0||x>0){switch(c=-R,z=-d,Q=R,J=d,N){case L.c.CENTER:o/=2,c-=o,Q+=o;break;case L.c.LEFT:Q+=o,s=-o/2;break;case L.c.RIGHT:c-=o,s=o/2}switch(k){case L.c.CENTER:x/=2,z-=x,J+=x;break;case L.c.BOTTOM:J+=x,M=-x/2;break;case L.c.TOP:z-=x,M=x/2}}const v=[],D=[],H=[];H[0]=[0,0,1,0,1,1,0,1],H[1]=[0,0,1,0,1,1,0,1],h!==L.c.ROTATE_TILE&&h!==L.c.ROTATE_ROW||(H[1]=[1,1,0,1,0,0,1,0]),h!==L.c.FLIP_TILE&&h!==L.c.FLIP_ROW||(H[1]=[1,0,0,0,0,1,1,1]),h!==L.c.FLIP_N_ROTATE_TILE&&h!==L.c.FLIP_N_ROTATE_ROW||(H[1]=[0,1,1,1,1,0,0,0]);let j=[];const l=[],G=[];let y=0;for(let A=0;A<q;A++)for(let V=0;V<K;V++)v.push(V*mV-R+s,A*t-d+M,0),v.push((V+1)*mV-R+s,A*t-d+M,0),v.push((V+1)*mV-R+s,(A+1)*t-d+M,0),v.push(V*mV-R+s,(A+1)*t-d+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),j=h===L.c.FLIP_TILE||h===L.c.ROTATE_TILE||h===L.c.FLIP_N_ROTATE_TILE?j.concat(H[(V%2+A%2)%2]):h===L.c.FLIP_ROW||h===L.c.ROTATE_ROW||h===L.c.FLIP_N_ROTATE_ROW?j.concat(H[A%2]):j.concat(H[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),y+=4;if(o>0||x>0){const V=x>0&&(k===L.c.CENTER||k===L.c.TOP),A=x>0&&(k===L.c.CENTER||k===L.c.BOTTOM),C=o>0&&(N===L.c.CENTER||N===L.c.RIGHT),n=o>0&&(N===L.c.CENTER||N===L.c.LEFT);let H,O,I,r,T=[];if(V&&C&&(v.push(c+s,z+M,0),v.push(-R+s,z+M,0),v.push(-R+s,z+x+M,0),v.push(c+s,z+x+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=1-o/mV,O=1-x/t,I=1,r=1,T=[H,O,I,O,I,r,H,r],h===L.c.ROTATE_ROW&&(T=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),h===L.c.FLIP_ROW&&(T=[1-H,O,1-I,O,1-I,r,1-H,r]),h===L.c.FLIP_N_ROTATE_ROW&&(T=[H,1-O,I,1-O,I,1-r,H,1-r]),j=j.concat(T),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V&&n&&(v.push(R+s,z+M,0),v.push(Q+s,z+M,0),v.push(Q+s,z+x+M,0),v.push(R+s,z+x+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=0,O=1-x/t,I=o/mV,r=1,T=[H,O,I,O,I,r,H,r],(h===L.c.ROTATE_ROW||h===L.c.ROTATE_TILE&&K%2===0)&&(T=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),(h===L.c.FLIP_ROW||h===L.c.FLIP_TILE&&K%2===0)&&(T=[1-H,O,1-I,O,1-I,r,1-H,r]),(h===L.c.FLIP_N_ROTATE_ROW||h===L.c.FLIP_N_ROTATE_TILE&&K%2===0)&&(T=[H,1-O,I,1-O,I,1-r,H,1-r]),j=j.concat(T),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&C&&(v.push(c+s,d+M,0),v.push(-R+s,d+M,0),v.push(-R+s,J+M,0),v.push(c+s,J+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=1-o/mV,O=0,I=1,r=x/t,T=[H,O,I,O,I,r,H,r],(h===L.c.ROTATE_ROW&&q%2===1||h===L.c.ROTATE_TILE&&q%1===0)&&(T=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),(h===L.c.FLIP_ROW&&q%2===1||h===L.c.FLIP_TILE&&q%2===0)&&(T=[1-H,O,1-I,O,1-I,r,1-H,r]),(h===L.c.FLIP_N_ROTATE_ROW&&q%2===1||h===L.c.FLIP_N_ROTATE_TILE&&q%2===0)&&(T=[H,1-O,I,1-O,I,1-r,H,1-r]),j=j.concat(T),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),A&&n&&(v.push(R+s,d+M,0),v.push(Q+s,d+M,0),v.push(Q+s,J+M,0),v.push(R+s,J+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,H=0,O=0,I=o/mV,r=x/t,T=[H,O,I,O,I,r,H,r],(h===L.c.ROTATE_ROW&&q%2===1||h===L.c.ROTATE_TILE&&(q+K)%2===1)&&(T=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),(h===L.c.FLIP_ROW&&q%2===1||h===L.c.FLIP_TILE&&(q+K)%2===1)&&(T=[1-H,O,1-I,O,1-I,r,1-H,r]),(h===L.c.FLIP_N_ROTATE_ROW&&q%2===1||h===L.c.FLIP_N_ROTATE_TILE&&(q+K)%2===1)&&(T=[H,1-O,I,1-O,I,1-r,H,1-r]),j=j.concat(T),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),V){const V=[];H=0,O=1-x/t,I=1,r=1,V[0]=[H,O,I,O,I,r,H,r],V[1]=[H,O,I,O,I,r,H,r],h!==L.c.ROTATE_TILE&&h!==L.c.ROTATE_ROW||(V[1]=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),h!==L.c.FLIP_TILE&&h!==L.c.FLIP_ROW||(V[1]=[1-H,O,1-I,O,1-I,r,1-H,r]),h!==L.c.FLIP_N_ROTATE_TILE&&h!==L.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-O,I,1-O,I,1-r,H,1-r]);for(let t=0;t<K;t++)v.push(t*mV-R+s,z+M,0),v.push((t+1)*mV-R+s,z+M,0),v.push((t+1)*mV-R+s,z+x+M,0),v.push(t*mV-R+s,z+x+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,j=h===L.c.FLIP_TILE||h===L.c.ROTATE_TILE||h===L.c.FLIP_N_ROTATE_TILE?j.concat(V[(t+1)%2]):h===L.c.FLIP_ROW||h===L.c.ROTATE_ROW||h===L.c.FLIP_N_ROTATE_ROW?j.concat(V[1]):j.concat(V[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const V=[];H=0,O=0,I=1,r=x/t,V[0]=[H,O,I,O,I,r,H,r],V[1]=[H,O,I,O,I,r,H,r],h!==L.c.ROTATE_TILE&&h!==L.c.ROTATE_ROW||(V[1]=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),h!==L.c.FLIP_TILE&&h!==L.c.FLIP_ROW||(V[1]=[1-H,O,1-I,O,1-I,r,1-H,r]),h!==L.c.FLIP_N_ROTATE_TILE&&h!==L.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-O,I,1-O,I,1-r,H,1-r]);for(let t=0;t<K;t++)v.push(t*mV-R+s,J-x+M,0),v.push((t+1)*mV-R+s,J-x+M,0),v.push((t+1)*mV-R+s,J+M,0),v.push(t*mV-R+s,J+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,j=h===L.c.FLIP_TILE||h===L.c.ROTATE_TILE||h===L.c.FLIP_N_ROTATE_TILE?j.concat(V[(t+q)%2]):h===L.c.FLIP_ROW||h===L.c.ROTATE_ROW||h===L.c.FLIP_N_ROTATE_ROW?j.concat(V[q%2]):j.concat(V[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(C){const V=[];H=1-o/mV,O=0,I=1,r=1,V[0]=[H,O,I,O,I,r,H,r],V[1]=[H,O,I,O,I,r,H,r],h!==L.c.ROTATE_TILE&&h!==L.c.ROTATE_ROW||(V[1]=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),h!==L.c.FLIP_TILE&&h!==L.c.FLIP_ROW||(V[1]=[1-H,O,1-I,O,1-I,r,1-H,r]),h!==L.c.FLIP_N_ROTATE_TILE&&h!==L.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-O,I,1-O,I,1-r,H,1-r]);for(let mV=0;mV<q;mV++)v.push(c+s,mV*t-d+M,0),v.push(c+o+s,mV*t-d+M,0),v.push(c+o+s,(mV+1)*t-d+M,0),v.push(c+s,(mV+1)*t-d+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,j=h===L.c.FLIP_TILE||h===L.c.ROTATE_TILE||h===L.c.FLIP_N_ROTATE_TILE?j.concat(V[(mV+1)%2]):h===L.c.FLIP_ROW||h===L.c.ROTATE_ROW||h===L.c.FLIP_N_ROTATE_ROW?j.concat(V[mV%2]):j.concat(V[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(n){const V=[];H=0,O=0,I=o/t,r=1,V[0]=[H,O,I,O,I,r,H,r],V[1]=[H,O,I,O,I,r,H,r],h!==L.c.ROTATE_TILE&&h!==L.c.ROTATE_ROW||(V[1]=[1-H,1-O,1-I,1-O,1-I,1-r,1-H,1-r]),h!==L.c.FLIP_TILE&&h!==L.c.FLIP_ROW||(V[1]=[1-H,O,1-I,O,1-I,r,1-H,r]),h!==L.c.FLIP_N_ROTATE_TILE&&h!==L.c.FLIP_N_ROTATE_ROW||(V[1]=[H,1-O,I,1-O,I,1-r,H,1-r]);for(let mV=0;mV<q;mV++)v.push(Q-o+s,mV*t-d+M,0),v.push(Q+s,mV*t-d+M,0),v.push(Q+s,(mV+1)*t-d+M,0),v.push(Q-o+s,(mV+1)*t-d+M,0),G.push(y,y+1,y+3,y+1,y+2,y+3),y+=4,j=h===L.c.FLIP_TILE||h===L.c.ROTATE_TILE||h===L.c.FLIP_N_ROTATE_TILE?j.concat(V[(mV+K)%2]):h===L.c.FLIP_ROW||h===L.c.ROTATE_ROW||h===L.c.FLIP_N_ROTATE_ROW?j.concat(V[mV%2]):j.concat(V[0]),l.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),D.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const O=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE;A.e._ComputeSides(O,v,G,D,j,V.frontUVs,V.backUVs);const I=new A.e;I.indices=G,I.jV=v,I.lV=D,I.yV=j;const r=O===A.e.DOUBLESIDE?l.concat(l):l;return I.GV=r,I}function R(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return x(h).IV(t,h.updatable),t}function d(V){const h=V.faceUV||new Array(6),mV=V.faceColors,N=V.pattern||L.c.NO_FLIP,C=V.width||V.size||1,K=V.height||V.size||1,o=V.depth||V.size||1,n=V.tileWidth||V.tileSize||1,R=V.tileHeight||V.tileSize||1,d=V.alignHorizontal||0,s=V.alignVertical||0,M=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE;for(let L=0;L<6;L++)void 0===h[L]&&(h[L]=new t.Vector4(0,0,1,1)),mV&&void 0===mV[L]&&(mV[L]=new q.Gk(1,1,1,1));const c=C/2,z=K/2,Q=o/2,J=[];for(let t=0;t<2;t++)J[t]=x({pattern:N,tileWidth:n,tileHeight:R,width:C,height:K,alignVertical:s,alignHorizontal:d,sideOrientation:M});for(let t=2;t<4;t++)J[t]=x({pattern:N,tileWidth:n,tileHeight:R,width:o,height:K,alignVertical:s,alignHorizontal:d,sideOrientation:M});let v=s;s===L.c.BOTTOM?v=L.c.TOP:s===L.c.TOP&&(v=L.c.BOTTOM);for(let t=4;t<6;t++)J[t]=x({pattern:N,tileWidth:n,tileHeight:R,width:C,height:o,alignVertical:v,alignHorizontal:d,sideOrientation:M});let D=[],H=[],j=[],l=[];const G=[],y=[],O=[],I=[];let r=0,T=0;for(let L=0;L<6;L++){const V=J[L].jV.length;y[L]=[],O[L]=[];for(let h=0;h<V/3;h++)y[L].push(new t.sh(J[L].jV[3*h],J[L].jV[3*h+1],J[L].jV[3*h+2])),O[L].push(new t.sh(J[L].lV[3*h],J[L].lV[3*h+1],J[L].lV[3*h+2]));r=J[L].yV.length,I[L]=[];for(let mV=0;mV<r;mV+=2)I[L][mV]=h[L].x+(h[L].z-h[L].x)*J[L].yV[mV],I[L][mV+1]=h[L].y+(h[L].w-h[L].y)*J[L].yV[mV+1],k.b&&(I[L][mV+1]=1-I[L][mV+1]);if(j=j.concat(I[L]),l=l.concat(J[L].indices.map((V=>V+T))),T+=y[L].length,mV)for(let h=0;h<4;h++)G.push(mV[L].r,mV[L].g,mV[L].b,mV[L].a)}const F=new t.sh(0,0,Q),p=t.Matrix.RotationY(Math.PI);D=y[0].map((V=>t.sh.TransformNormal(V,p).add(F))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[]),H=O[0].map((V=>t.sh.TransformNormal(V,p))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[]),D=D.concat(y[1].map((V=>V.Mh(F))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[])),H=H.concat(O[1].map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[]));const Z=new t.sh(c,0,0),f=t.Matrix.RotationY(-Math.PI/2);D=D.concat(y[2].map((V=>t.sh.TransformNormal(V,f).add(Z))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[])),H=H.concat(O[2].map((V=>t.sh.TransformNormal(V,f))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[]));const S=t.Matrix.RotationY(Math.PI/2);D=D.concat(y[3].map((V=>t.sh.TransformNormal(V,S).Mh(Z))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[])),H=H.concat(O[3].map((V=>t.sh.TransformNormal(V,S))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[]));const Y=new t.sh(0,z,0),w=t.Matrix.RotationX(Math.PI/2);D=D.concat(y[4].map((V=>t.sh.TransformNormal(V,w).add(Y))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[])),H=H.concat(O[4].map((V=>t.sh.TransformNormal(V,w))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[]));const E=t.Matrix.RotationX(-Math.PI/2);D=D.concat(y[5].map((V=>t.sh.TransformNormal(V,E).Mh(Y))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[])),H=H.concat(O[5].map((V=>t.sh.TransformNormal(V,E))).map((V=>[V.x,V.y,V.z])).reduce(((V,h)=>V.concat(h)),[])),A.e._ComputeSides(M,D,l,H,j);const g=new A.e;if(g.indices=l,g.jV=D,g.lV=H,g.yV=j,mV){const V=M===A.e.DOUBLESIDE?G.concat(G):G;g.GV=V}return g}function s(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return d(h).IV(t,h.updatable),t}A.e.CreateTiledPlane=x;A.e.CreateTiledBox=d;var M=mV(13787),c=mV(12648),z=mV(12606);function Q(V){const h=V.height||2;let mV=0===V.diameterTop?0:V.diameterTop||V.diameter||1,N=0===V.diameterBottom?0:V.diameterBottom||V.diameter||1;mV=mV||1e-5,N=N||1e-5;const C=0|(V.tessellation||24),K=0|(V.subdivisions||1),o=!!V.hasRings,n=!!V.enclose,x=0===V.cap?0:V.cap||L.c.CAP_ALL,R=V.arc&&(V.arc<=0||V.arc>1)?1:V.arc||1,d=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE,s=V.faceUV||new Array(3),M=V.faceColors,c=2+(1+(1!==R&&n?2:0))*(o?K:1);let Q;for(Q=0;Q<c;Q++)M&&void 0===M[Q]&&(M[Q]=new q.Gk(1,1,1,1));for(Q=0;Q<c;Q++)s&&void 0===s[Q]&&(s[Q]=new t.Vector4(0,0,1,1));const J=[],v=[],D=[],H=[],j=[],l=2*Math.PI*R/C;let G,y,O;const I=(N-mV)/2/h,r=t.sh.Zero(),T=t.sh.Zero(),F=t.sh.Zero(),p=t.sh.Zero(),Z=t.sh.Zero(),f=z.b.Y;let S,Y,w,E=1,g=1,i=0,b=0;for(S=0;S<=K;S++)for(y=S/K,O=(y*(mV-N)+N)/2,E=o&&0!==S&&S!==K?2:1,w=0;w<E;w++){for(o&&(g+=w),n&&(g+=2*w),Y=0;Y<=C;Y++)G=Y*l,r.x=Math.cos(-G)*O,r.y=-h/2+y*h,r.z=Math.sin(-G)*O,0===mV&&S===K?(T.x=D[D.length-3*(C+1)],T.y=D[D.length-3*(C+1)+1],T.z=D[D.length-3*(C+1)+2]):(T.x=r.x,T.z=r.z,T.y=Math.sqrt(T.x*T.x+T.z*T.z)*I,T.normalize()),0===Y&&(F.t(r),p.t(T)),v.push(r.x,r.y,r.z),D.push(T.x,T.y,T.z),b=o?i!==g?s[g].y:s[g].w:s[g].y+(s[g].w-s[g].y)*y,H.push(s[g].x+(s[g].z-s[g].x)*Y/C,k.b?1-b:b),M&&j.push(M[g].r,M[g].g,M[g].b,M[g].a);1!==R&&n&&(v.push(r.x,r.y,r.z),v.push(0,r.y,0),v.push(0,r.y,0),v.push(F.x,F.y,F.z),t.sh.CrossToRef(f,T,Z),Z.normalize(),D.push(Z.x,Z.y,Z.z,Z.x,Z.y,Z.z),t.sh.CrossToRef(p,f,Z),Z.normalize(),D.push(Z.x,Z.y,Z.z,Z.x,Z.y,Z.z),b=o?i!==g?s[g+1].y:s[g+1].w:s[g+1].y+(s[g+1].w-s[g+1].y)*y,H.push(s[g+1].x,k.b?1-b:b),H.push(s[g+1].z,k.b?1-b:b),b=o?i!==g?s[g+2].y:s[g+2].w:s[g+2].y+(s[g+2].w-s[g+2].y)*y,H.push(s[g+2].x,k.b?1-b:b),H.push(s[g+2].z,k.b?1-b:b),M&&(j.push(M[g+1].r,M[g+1].g,M[g+1].b,M[g+1].a),j.push(M[g+1].r,M[g+1].g,M[g+1].b,M[g+1].a),j.push(M[g+2].r,M[g+2].g,M[g+2].b,M[g+2].a),j.push(M[g+2].r,M[g+2].g,M[g+2].b,M[g+2].a))),i!==g&&(i=g)}const P=1!==R&&n?C+4:C;for(S=0,g=0;g<K;g++){let V=0,h=0,mV=0,t=0;for(Y=0;Y<C;Y++)V=S*(P+1)+Y,h=(S+1)*(P+1)+Y,mV=S*(P+1)+(Y+1),t=(S+1)*(P+1)+(Y+1),J.push(V,h,mV),J.push(t,mV,h);1!==R&&n&&(J.push(V+2,h+2,mV+2),J.push(t+2,mV+2,h+2),J.push(V+4,h+4,mV+4),J.push(t+4,mV+4,h+4)),S=o?S+2:S+1}const U=V=>{const L=V?mV/2:N/2;if(0===L)return;let A,K,o;const n=V?s[c-1]:s[0];let q=null;M&&(q=V?M[c-1]:M[0]);const x=v.length/3,d=V?h/2:-h/2,z=new t.sh(0,d,0);v.push(z.x,z.y,z.z),D.push(0,V?1:-1,0);const Q=n.y+.5*(n.w-n.y);H.push(n.x+.5*(n.z-n.x),k.b?1-Q:Q),q&&j.push(q.r,q.g,q.b,q.a);const l=new t.Vector2(.5,.5);for(o=0;o<=C;o++){A=2*Math.PI*o*R/C;const h=Math.cos(-A),mV=Math.sin(-A);K=new t.sh(h*L,d,mV*L);const N=new t.Vector2(h*l.x+.5,mV*l.y+.5);v.push(K.x,K.y,K.z),D.push(0,V?1:-1,0);const x=n.y+(n.w-n.y)*N.y;H.push(n.x+(n.z-n.x)*N.x,k.b?1-x:x),q&&j.push(q.r,q.g,q.b,q.a)}for(o=0;o<C;o++)V?(J.push(x),J.push(x+(o+2)),J.push(x+(o+1))):(J.push(x),J.push(x+(o+1)),J.push(x+(o+2)))};x!==L.c.CAP_START&&x!==L.c.CAP_ALL||U(!1),x!==L.c.CAP_END&&x!==L.c.CAP_ALL||U(!0),A.e._ComputeSides(d,v,J,D,H,V.frontUVs,V.backUVs);const u=new A.e;return u.indices=J,u.jV=v,u.lV=D,u.yV=H,M&&(u.GV=j),u}function J(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2?arguments[2]:void 0;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return Q(h).IV(t,h.updatable),t}function v(V){const h=[],mV=[],L=[],N=[],C=V.diameter||1,K=V.thickness||.5,o=0|(V.tessellation||16),n=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE,q=o+1;for(let A=0;A<=o;A++){const V=A/o,n=A*Math.PI*2/o-Math.PI/2,x=t.Matrix.Translation(C/2,0,0).multiply(t.Matrix.RotationY(n));for(let C=0;C<=o;C++){const n=1-C/o,R=C*Math.PI*2/o+Math.PI,d=Math.cos(R),s=Math.sin(R);let M=new t.sh(d,s,0),c=M.scale(K/2);const z=new t.Vector2(V,n);c=t.sh.TransformCoordinates(c,x),M=t.sh.TransformNormal(M,x),mV.push(c.x,c.y,c.z),L.push(M.x,M.y,M.z),N.push(z.x,k.b?1-z.y:z.y);const Q=(A+1)%q,J=(C+1)%q;h.push(A*q+C),h.push(A*q+J),h.push(Q*q+C),h.push(A*q+J),h.push(Q*q+J),h.push(Q*q+C)}}A.e._ComputeSides(n,mV,h,L,N,V.frontUVs,V.backUVs);const x=new A.e;return x.indices=h,x.jV=mV,x.lV=L,x.yV=N,x}function D(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2?arguments[2]:void 0;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return v(h).IV(t,h.updatable),t}A.e.CreateCylinder=Q,L.c.CreateCylinder=(V,h,mV,t,N,A,k,C,K)=>{void 0!==k&&k instanceof c.d||(void 0!==k&&(K=C||L.c.DEFAULTSIDE,C=k),k=A,A=1);return J(V,{height:h,diameterTop:mV,diameterBottom:t,tessellation:N,subdivisions:A,sideOrientation:K,updatable:C},k)};function H(V){const h=[],mV=[],L=[],N=[],C=V.radius||2,K=V.tube||.5,o=V.radialSegments||32,n=V.tubularSegments||32,q=V.p||2,x=V.q||3,R=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE,d=V=>{const h=Math.cos(V),mV=Math.sin(V),L=x/q*V,N=Math.cos(L),A=C*(2+N)*.5*h,k=C*(2+N)*mV*.5,K=C*Math.sin(L)*.5;return new t.sh(A,k,K)};let s,M;for(s=0;s<=o;s++){const V=s%o/o*2*q*Math.PI,h=d(V),L=d(V+.01),A=L.Mh(h);let C=L.add(h);const x=t.sh.Cross(A,C);for(C=t.sh.Cross(x,A),x.normalize(),C.normalize(),M=0;M<n;M++){const V=M%n/n*2*Math.PI,t=-K*Math.cos(V),L=K*Math.sin(V);mV.push(h.x+t*C.x+L*x.x),mV.push(h.y+t*C.y+L*x.y),mV.push(h.z+t*C.z+L*x.z),N.push(s/o),N.push(k.b?1-M/n:M/n)}}for(s=0;s<o;s++)for(M=0;M<n;M++){const V=(M+1)%n,mV=s*n+M,t=(s+1)*n+M,L=(s+1)*n+V,N=s*n+V;h.push(N),h.push(t),h.push(mV),h.push(N),h.push(L),h.push(t)}A.e.ComputeNormals(mV,h,L),A.e._ComputeSides(R,mV,h,L,N,V.frontUVs,V.backUVs);const c=new A.e;return c.indices=h,c.jV=mV,c.lV=L,c.yV=N,c}function j(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2?arguments[2]:void 0;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return H(h).IV(t,h.updatable),t}A.e.CreateTorus=v,L.c.CreateTorus=(V,h,mV,t,L,N,A)=>D(V,{diameter:h,thickness:mV,tessellation:t,sideOrientation:A,updatable:N},L);A.e.CreateTorusKnot=H,L.c.CreateTorusKnot=(V,h,mV,t,L,N,A,k,C,K)=>j(V,{radius:h,tube:mV,radialSegments:t,tubularSegments:L,p:N,q:A,sideOrientation:K,updatable:C},k);var l=mV(14266),G=mV(12959),y=mV(12615);function O(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=h.path,N=h.shape,A=h.scale||1,k=h.rotation||0,C=0===h.cap?0:h.cap||L.c.NO_CAP,K=h.updatable,o=L.c._GetDefaultSideOrientation(h.sideOrientation),n=h.instance||null,q=h.invertUV||!1,x=h.closeShape||!1,R=h.closePath||!1,d=h.capFunction||null;return r(V,N,t,A,k,null,null,R,x,C,!1,mV,!!K,o,n,q,h.frontUVs||null,h.backUVs||null,h.firstNormal||null,!!h.adjustFrame,d)}function I(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=h.path,N=h.shape,A=h.scaleFunction||(()=>1),k=h.rotationFunction||(()=>0),C=h.closePath||h.ribbonCloseArray||!1,K=h.closeShape||h.ribbonClosePath||!1,o=0===h.cap?0:h.cap||L.c.NO_CAP,n=h.updatable,q=h.firstNormal||null,x=h.adjustFrame||!1,R=L.c._GetDefaultSideOrientation(h.sideOrientation),d=h.instance,s=h.invertUV||!1,M=h.capFunction||null;return r(V,N,t,null,null,A,k,C,K,o,!0,mV,!!n,R,d||null,s,h.frontUVs||null,h.backUVs||null,q,x,M||null)}function r(V,h,mV,N,A,k,C,o,n,q,x,R,d,s,M,c,z,Q,J,v,D){const H=(V,h,mV,N,A,k,C,K,o,n,q)=>{const x=mV.getTangents(),R=mV.getNormals(),d=mV.getBinormals(),s=mV.getDistances();if(q)for(let L=0;L<x.length;L++)if(0==x[L].x&&0==x[L].y&&0==x[L].z&&x[L].t(x[L-1]),0==R[L].x&&0==R[L].y&&0==R[L].z&&R[L].t(R[L-1]),0==d[L].x&&0==d[L].y&&0==d[L].z&&d[L].t(d[L-1]),L>0){let V=x[L-1];t.sh.Dot(V,x[L])<0&&x[L].scaleInPlace(-1),V=R[L-1],t.sh.Dot(V,R[L])<0&&R[L].scaleInPlace(-1),V=d[L-1],t.sh.Dot(V,d[L])<0&&d[L].scaleInPlace(-1)}let M=0;const c=n&&K?K:()=>null!==k?k:0,z=n&&C?C:()=>null!==A?A:1;let Q=o===L.c.NO_CAP||o===L.c.CAP_END?0:2;const J=t.TmpVectors.Matrix[0];for(let L=0;L<h.length;L++){const mV=[],A=c(L,s[L]),k=z(L,s[L]);t.Matrix.RotationAxisToRef(x[L],M,J);for(let N=0;N<V.length;N++){const A=x[L].scale(V[N].z).add(R[L].scale(V[N].x)).add(d[L].scale(V[N].y)),C=t.sh.Zero();t.sh.TransformCoordinatesToRef(A,J,C),C.scaleInPlace(k).addInPlace(h[L]),mV[N]=C}N[Q]=mV,M+=A,Q++}const v=D||(V=>{const h=Array(),mV=t.sh.Zero();let L;for(L=0;L<V.length;L++)mV.addInPlace(V[L]);for(mV.scaleInPlace(1/V.length),L=0;L<V.length;L++)h.push(mV);return h});switch(o){case L.c.NO_CAP:break;case L.c.CAP_START:N[0]=v(N[2]),N[1]=N[2];break;case L.c.CAP_END:N[Q]=N[Q-1],N[Q+1]=v(N[Q-1]);break;case L.c.CAP_ALL:N[0]=v(N[2]),N[1]=N[2],N[Q]=N[Q-1],N[Q+1]=v(N[Q-1])}return N};let j,l;if(M){const V=M._creationDataStorage;return j=J?V.path3D.update(mV,J):V.path3D.update(mV),l=H(h,mV,V.path3D,V.pathArray,N,A,k,C,V.cap,x,v),M=K("",{pathArray:l,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:M},R||void 0)}j=J?new y.j(mV,J):new y.j(mV);l=H(h,mV,j,new Array,N,A,k,C,q=q<0||q>3?0:q,x,v);const G=K(V,{pathArray:l,closeArray:o,closePath:n,updatable:d,sideOrientation:s,invertUV:c,frontUVs:z||void 0,backUVs:Q||void 0},R);return G._creationDataStorage.pathArray=l,G._creationDataStorage.path3D=j,G._creationDataStorage.cap=q,G}function T(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=h.arc?h.arc<=0||h.arc>1?1:h.arc:1,A=void 0===h.closed||h.closed,k=h.shape,C=h.radius||1,o=h.tessellation||64,n=h.clip||0,q=h.updatable,x=L.c._GetDefaultSideOrientation(h.sideOrientation),R=h.cap||L.c.NO_CAP,d=2*Math.PI,s=[],M=h.invertUV||!1;let c=0,z=0;const Q=d/o*N;let J,v;for(c=0;c<=o-n;c++){for(v=[],R!=L.c.CAP_START&&R!=L.c.CAP_ALL||(v.push(new t.sh(0,k[0].y,0)),v.push(new t.sh(Math.cos(c*Q)*k[0].x*C,k[0].y,Math.sin(c*Q)*k[0].x*C))),z=0;z<k.length;z++)J=new t.sh(Math.cos(c*Q)*k[z].x*C,k[z].y,Math.sin(c*Q)*k[z].x*C),v.push(J);R!=L.c.CAP_END&&R!=L.c.CAP_ALL||(v.push(new t.sh(Math.cos(c*Q)*k[k.length-1].x*C,k[k.length-1].y,Math.sin(c*Q)*k[k.length-1].x*C)),v.push(new t.sh(0,k[k.length-1].y,0))),s.push(v)}return K(V,{pathArray:s,closeArray:A,sideOrientation:x,updatable:q,invertUV:M,frontUVs:h.frontUVs,backUVs:h.backUVs},mV)}L.c.ExtrudeShape=function(V,h,mV,t,N,A){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0,o=arguments.length>9?arguments[9]:void 0;return O(V,{shape:h,path:mV,scale:t,rotation:N,cap:0===A?0:A||L.c.NO_CAP,sideOrientation:K,instance:o,updatable:C},k)},L.c.ExtrudeShapeCustom=(V,h,mV,t,N,A,k,C,K,o,n,q)=>I(V,{shape:h,path:mV,scaleFunction:t,rotationFunction:N,ribbonCloseArray:A,ribbonClosePath:k,cap:0===C?0:C||L.c.NO_CAP,sideOrientation:n,instance:q,updatable:o},K);L.c.CreateLathe=(V,h,mV,t,L,N,A)=>T(V,{shape:h,radius:mV,tessellation:t,sideOrientation:A,updatable:N},L);var F=mV(13690),p=mV(13652);function Z(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=h.path;let A=h.instance,k=1;void 0!==h.radius?k=h.radius:A&&(k=A._creationDataStorage.radius);const C=h.tessellation||64,o=h.radiusFunction||null;let n=h.cap||L.c.NO_CAP;const q=h.invertUV||!1,x=h.updatable,R=L.c._GetDefaultSideOrientation(h.sideOrientation);h.arc=h.arc&&(h.arc<=0||h.arc>1)?1:h.arc||1;const d=(V,h,mV,N,A,k,C,K)=>{const o=h.getTangents(),n=h.getNormals(),q=h.getDistances(),x=2*Math.PI/A*K,R=k||(()=>N);let d,s,M,c;const z=t.TmpVectors.Matrix[0];let Q=C===L.c.NO_CAP||C===L.c.CAP_END?0:2;for(let L=0;L<V.length;L++){s=R(L,q[L]),d=Array(),M=n[L];for(let h=0;h<A;h++)t.Matrix.RotationAxisToRef(o[L],x*h,z),c=d[h]?d[h]:t.sh.Zero(),t.sh.TransformCoordinatesToRef(M,z,c),c.scaleInPlace(s).addInPlace(V[L]),d[h]=c;mV[Q]=d,Q++}const J=(h,mV)=>{const t=Array();for(let L=0;L<h;L++)t.push(V[mV]);return t};switch(C){case L.c.NO_CAP:break;case L.c.CAP_START:mV[0]=J(A,0),mV[1]=mV[2].slice(0);break;case L.c.CAP_END:mV[Q]=mV[Q-1].slice(0),mV[Q+1]=J(A,V.length-1);break;case L.c.CAP_ALL:mV[0]=J(A,0),mV[1]=mV[2].slice(0),mV[Q]=mV[Q-1].slice(0),mV[Q+1]=J(A,V.length-1)}return mV};let s,M;if(A){const V=A._creationDataStorage,mV=h.arc||V.arc;return s=V.path3D.update(N),M=d(N,s,V.pathArray,k,V.tessellation,o,V.cap,mV),A=K("",{pathArray:M,instance:A}),V.path3D=s,V.pathArray=M,V.arc=mV,V.radius=k,A}s=new y.j(N);n=n<0||n>3?0:n,M=d(N,s,new Array,k,C,o,n,h.arc);const c=K(V,{pathArray:M,closePath:!0,closeArray:!1,updatable:x,sideOrientation:R,invertUV:q,frontUVs:h.frontUVs,backUVs:h.backUVs},mV);return c._creationDataStorage.pathArray=M,c._creationDataStorage.path3D=s,c._creationDataStorage.tessellation=C,c._creationDataStorage.cap=n,c._creationDataStorage.arc=h.arc,c._creationDataStorage.radius=k,c}function f(V){const h=[];h[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},h[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},h[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},h[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},h[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},h[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},h[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},h[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},h[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},h[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},h[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},h[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},h[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},h[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},h[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const mV=V.type&&(V.type<0||V.type>=h.length)?0:V.type||0,L=V.size,N=V.sizeX||L||1,C=V.sizeY||L||1,K=V.sizeZ||L||1,o=V.custom||h[mV],n=o.face.length,x=V.faceUV||new Array(n),R=V.faceColors,d=void 0===V.flat||V.flat,s=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE,M=[],c=[],z=[],Q=[],J=[];let v=0,D=0;const H=[];let j,l,G,y,O,I,r=0,T=0;if(d)for(T=0;T<n;T++)R&&void 0===R[T]&&(R[T]=new q.Gk(1,1,1,1)),x&&void 0===x[T]&&(x[T]=new t.Vector4(0,0,1,1));if(d)for(T=0;T<n;T++){const V=o.face[T].length;for(G=2*Math.PI/V,y=.5*Math.tan(G/2),O=.5,r=0;r<V;r++)M.push(o.vertex[o.face[T][r]][0]*N,o.vertex[o.face[T][r]][1]*C,o.vertex[o.face[T][r]][2]*K),H.push(v),v++,j=x[T].x+(x[T].z-x[T].x)*(.5+y),l=x[T].y+(x[T].w-x[T].y)*(O-.5),Q.push(j,k.b?1-l:l),I=y*Math.cos(G)-O*Math.sin(G),O=y*Math.sin(G)+O*Math.cos(G),y=I,R&&J.push(R[T].r,R[T].g,R[T].b,R[T].a);for(r=0;r<V-2;r++)c.push(H[0+D],H[r+2+D],H[r+1+D]);D+=V}else{for(r=0;r<o.vertex.length;r++)M.push(o.vertex[r][0]*N,o.vertex[r][1]*C,o.vertex[r][2]*K),Q.push(0,k.b?1:0);for(T=0;T<n;T++)for(r=0;r<o.face[T].length-2;r++)c.push(o.face[T][0],o.face[T][r+2],o.face[T][r+1])}A.e.ComputeNormals(M,c,z),A.e._ComputeSides(s,M,c,z,Q,V.frontUVs,V.backUVs);const F=new A.e;return F.jV=M,F.indices=c,F.lV=z,F.yV=Q,R&&d&&(F.GV=J),F}function S(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return f(h).IV(t,h.updatable),t}L.c.CreateTube=(V,h,mV,t,L,N,A,k,C,K)=>Z(V,{path:h,radius:mV,tessellation:t,radiusFunction:L,arc:1,cap:N,updatable:k,sideOrientation:C,instance:K},A);function Y(V){const h=V.sideOrientation||A.e.DEFAULTSIDE,mV=V.radius||1,L=void 0===V.flat||V.flat,N=0|(V.subdivisions||4),C=V.radiusX||mV,K=V.radiusY||mV,o=V.radiusZ||mV,n=(1+Math.sqrt(5))/2,q=[-1,n,-0,1,n,0,-1,-n,0,1,-n,0,0,-1,-n,0,1,-n,0,-1,n,0,1,n,n,0,1,n,0,-1,-n,0,1,-n,0,-1],x=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],R=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],d=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],s=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],M=[],c=[],z=[],Q=[];let J=0;const v=new Array(3),D=new Array(3);let H;for(H=0;H<3;H++)v[H]=t.sh.Zero(),D[H]=t.Vector2.Zero();for(let A=0;A<20;A++){for(H=0;H<3;H++){const V=x[3*A+H];v[H].Hk(q[3*R[V]],q[3*R[V]+1],q[3*R[V]+2]),v[H].normalize(),D[H].Hk(.134765625*d[2*V]+.05859375+-.0390625*s[A],.2333984375*d[2*V+1]+.025390625+.01953125*s[A])}const V=(V,h,mV,A)=>{const n=t.sh.Lerp(v[0],v[2],h/N),q=t.sh.Lerp(v[1],v[2],h/N),x=N===h?v[2]:t.sh.Lerp(n,q,V/(N-h));let R;if(x.normalize(),L){const V=t.sh.Lerp(v[0],v[2],A/N),h=t.sh.Lerp(v[1],v[2],A/N);R=t.sh.Lerp(V,h,mV/(N-A))}else R=new t.sh(x.x,x.y,x.z);R.x/=C,R.y/=K,R.z/=o,R.normalize();const d=t.Vector2.Lerp(D[0],D[2],h/N),s=t.Vector2.Lerp(D[1],D[2],h/N),H=N===h?D[2]:t.Vector2.Lerp(d,s,V/(N-h));c.push(x.x*C,x.y*K,x.z*o),z.push(R.x,R.y,R.z),Q.push(H.x,k.b?1-H.y:H.y),M.push(J),J++};for(let h=0;h<N;h++)for(let mV=0;mV+h<N;mV++)V(mV,h,mV+1/3,h+1/3),V(mV+1,h,mV+1/3,h+1/3),V(mV,h+1,mV+1/3,h+1/3),mV+h+1<N&&(V(mV+1,h,mV+2/3,h+2/3),V(mV+1,h+1,mV+2/3,h+2/3),V(mV,h+1,mV+2/3,h+2/3))}A.e._ComputeSides(h,c,M,z,Q,V.frontUVs,V.backUVs);const j=new A.e;return j.indices=M,j.jV=c,j.lV=z,j.yV=Q,j}function w(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new L.c(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),t._originalBuilderSideOrientation=h.sideOrientation;return Y(h).IV(t,h.updatable),t}A.e.CreatePolyhedron=f,L.c.CreatePolyhedron=(V,h,mV)=>S(V,h,mV);A.e.CreateIcoSphere=Y,L.c.CreateIcoSphere=(V,h,mV)=>w(V,h,mV);var E=mV(12435);const g=new t.sh(1,0,0),i=new t.sh(-1,0,0),b=new t.sh(0,1,0),P=new t.sh(0,-1,0),U=new t.sh(0,0,1),u=new t.sh(0,0,-1);class e{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.sh.Zero(),h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.sh.Up(),mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.Vector2.Zero(),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=V,this.normal=h,this.uv=mV,this.vertexIdx=L,this.vertexIdxForBones=N,this.localPositionOverride=A,this.localNormalOverride=k,this.matrixIndicesOverride=C,this.matrixWeightsOverride=K}clone(){var V,h,mV,t;return new e(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(V=this.localPositionOverride)||void 0===V?void 0:V.slice(),null===(h=this.localNormalOverride)||void 0===h?void 0:h.slice(),null===(mV=this.matrixIndicesOverride)||void 0===mV?void 0:mV.slice(),null===(t=this.matrixWeightsOverride)||void 0===t?void 0:t.slice())}}function W(V,h,mV){var C,K,o,n,q;const x=!!h.skeleton,R=!(null===(C=h.morphTargetManager)||void 0===C||!C.numTargets),d=mV.localMode||x,s=h.vk(),M=x||R?h.wk(!0,!0):h.getVerticesData(N.i.PositionKind),c=x||R?h.getNormalsData(!0,!0):h.getVerticesData(N.i.NormalKind),z=d?x?h.getVerticesData(N.i.PositionKind):M:null,Q=d?x?h.getVerticesData(N.i.NormalKind):c:null,J=h.getVerticesData(N.i.UVKind),v=x?h.getVerticesData(N.i.MatricesIndicesKind):null,D=x?h.getVerticesData(N.i.MatricesWeightsKind):null,H=x?h.getVerticesData(N.i.MatricesIndicesExtraKind):null,j=x?h.getVerticesData(N.i.MatricesWeightsExtraKind):null,l=mV.position||t.sh.Zero();let G=mV.normal||t.sh.Up();const y=mV.size||t.sh.One(),O=mV.angle||0;if(!G){const V=new t.sh(0,0,1),mV=h.DV().activeCamera,L=t.sh.TransformCoordinates(V,mV.getWorldMatrix());G=mV.globalPosition.Mh(L)}const I=-Math.atan2(G.z,G.x)-Math.PI/2,r=Math.sqrt(G.x*G.x+G.z*G.z),T=Math.atan2(G.y,r),F=new A.e;F.indices=[],F.jV=[],F.lV=[],F.yV=[],F.matricesIndices=x?[]:null,F.matricesWeights=x?[]:null,F.matricesIndicesExtra=H?[]:null,F.matricesWeightsExtra=j?[]:null;let p=0;const Z=(V,h)=>{const L=new e;if(!s||!M||!c)return L;const N=s[V];if(L.vertexIdx=3*N,L.vertexIdxForBones=4*N,L.position=new t.sh(M[3*N],M[3*N+1],M[3*N+2]),t.sh.TransformCoordinatesToRef(L.position,h,L.position),L.normal=new t.sh(c[3*N],c[3*N+1],c[3*N+2]),t.sh.TransformNormalToRef(L.normal,h,L.normal),mV.captureUVS&&J){const V=J[2*N+1];L.uv=new t.Vector2(J[2*N],k.b?1-V:V)}return L},f=[0,0,0,0],S=(V,h)=>{if(0===V.length)return V;const mV=.5*Math.abs(t.sh.Dot(y,h)),L=(V,h,mV,t)=>{for(let L=0;L<t;++L)if(V[mV+L]===h)return mV+L;return-1},N=(V,N)=>{const A=t.sh.GetClipFactor(V.position,N.position,h,mV);let k=f,C=f;if(v&&D){const h=V.matrixIndicesOverride?0:V.vertexIdxForBones,mV=V.matrixIndicesOverride??v,t=V.matrixWeightsOverride??D,K=N.matrixIndicesOverride?0:N.vertexIdxForBones,o=N.matrixIndicesOverride??v,n=N.matrixWeightsOverride??D;k=[0,0,0,0],C=[0,0,0,0];let q=0;for(let V=0;V<4;++V)if(t[h+V]>0){const N=L(o,mV[h+V],K,4);k[q]=mV[h+V],C[q]=(0,E.Lerp)(t[h+V],N>=0?n[N]:0,A),q++}for(let V=0;V<4&&q<4;++V){const t=o[K+V];-1===L(mV,t,h,4)&&(k[q]=t,C[q]=(0,E.Lerp)(0,n[K+V],A),q++)}const x=C[0]+C[1]+C[2]+C[3];C[0]/=x,C[1]/=x,C[2]/=x,C[3]/=x}const K=V.localPositionOverride?V.localPositionOverride[0]:(null===z||void 0===z?void 0:z[V.vertexIdx])??0,o=V.localPositionOverride?V.localPositionOverride[1]:(null===z||void 0===z?void 0:z[V.vertexIdx+1])??0,n=V.localPositionOverride?V.localPositionOverride[2]:(null===z||void 0===z?void 0:z[V.vertexIdx+2])??0,q=N.localPositionOverride?N.localPositionOverride[0]:(null===z||void 0===z?void 0:z[N.vertexIdx])??0,x=N.localPositionOverride?N.localPositionOverride[1]:(null===z||void 0===z?void 0:z[N.vertexIdx+1])??0,R=N.localPositionOverride?N.localPositionOverride[2]:(null===z||void 0===z?void 0:z[N.vertexIdx+2])??0,d=V.localNormalOverride?V.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[V.vertexIdx])??0,s=V.localNormalOverride?V.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[V.vertexIdx+1])??0,M=V.localNormalOverride?V.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[V.vertexIdx+2])??0,c=d+((N.localNormalOverride?N.localNormalOverride[0]:(null===Q||void 0===Q?void 0:Q[N.vertexIdx])??0)-d)*A,J=s+((N.localNormalOverride?N.localNormalOverride[1]:(null===Q||void 0===Q?void 0:Q[N.vertexIdx+1])??0)-s)*A,H=M+((N.localNormalOverride?N.localNormalOverride[2]:(null===Q||void 0===Q?void 0:Q[N.vertexIdx+2])??0)-M)*A,j=Math.sqrt(c*c+J*J+H*H);return new e(t.sh.Lerp(V.position,N.position,A),t.sh.Lerp(V.normal,N.normal,A).normalize(),t.Vector2.Lerp(V.uv,N.uv,A),-1,-1,z?[K+(q-K)*A,o+(x-o)*A,n+(R-n)*A]:null,Q?[c/j,J/j,H/j]:null,k,C)};let A=null;V.length>3&&(A=[]);for(let k=0;k<V.length;k+=3){let L=0,C=null,K=null,o=null,n=null;const q=t.sh.Dot(V[k].position,h)-mV>0,x=t.sh.Dot(V[k+1].position,h)-mV>0,R=t.sh.Dot(V[k+2].position,h)-mV>0;switch(L=(q?1:0)+(x?1:0)+(R?1:0),L){case 0:V.length>3?(A.push(V[k]),A.push(V[k+1]),A.push(V[k+2])):A=V;break;case 1:if(A=A??new Array,q&&(C=V[k+1],K=V[k+2],o=N(V[k],C),n=N(V[k],K)),x){C=V[k],K=V[k+2],o=N(V[k+1],C),n=N(V[k+1],K),A.push(o),A.push(K.clone()),A.push(C.clone()),A.push(K.clone()),A.push(o.clone()),A.push(n);break}R&&(C=V[k],K=V[k+1],o=N(V[k+2],C),n=N(V[k+2],K)),C&&K&&o&&n&&(A.push(C.clone()),A.push(K.clone()),A.push(o),A.push(n),A.push(o.clone()),A.push(K.clone()));break;case 2:A=A??new Array,q||(C=V[k].clone(),K=N(C,V[k+1]),o=N(C,V[k+2]),A.push(C),A.push(K),A.push(o)),x||(C=V[k+1].clone(),K=N(C,V[k+2]),o=N(C,V[k]),A.push(C),A.push(K),A.push(o)),R||(C=V[k+2].clone(),K=N(C,V[k]),o=N(C,V[k+1]),A.push(C),A.push(K),A.push(o))}}return A},Y=h instanceof L.c?h:null,w=null===Y||void 0===Y?void 0:Y._thinInstanceDataStorage.matrixData,W=(null===Y||void 0===Y?void 0:Y.Ok)||1,X=t.TmpVectors.Matrix[0];X.t(t.Matrix.IdentityReadOnly);for(let L=0;L<W;++L){if(null!==Y&&void 0!==Y&&Y.hasThinInstances&&w){const V=16*L;X.setRowFromFloats(0,w[V+0],w[V+1],w[V+2],w[V+3]),X.setRowFromFloats(1,w[V+4],w[V+5],w[V+6],w[V+7]),X.setRowFromFloats(2,w[V+8],w[V+9],w[V+10],w[V+11]),X.setRowFromFloats(3,w[V+12],w[V+13],w[V+14],w[V+15])}const V=t.Matrix.RotationYawPitchRoll(I,T,O).multiply(t.Matrix.Translation(l.x,l.y,l.z)),N=t.Matrix.Invert(V),A=h.getWorldMatrix(),C=X.multiply(A).multiply(N),K=new Array(3);for(let h=0;h<s.length;h+=3){let V=K;if(V[0]=Z(h,C),V[1]=Z(h+1,C),V[2]=Z(h+2,C),!(mV.cullBackFaces&&-V[0].normal.z<=0&&-V[1].normal.z<=0&&-V[2].normal.z<=0)&&(V=S(V,g),V&&(V=S(V,i),V&&(V=S(V,b),V&&(V=S(V,P),V&&(V=S(V,U),V&&(V=S(V,u),V)))))))for(let h=0;h<V.length;h++){const t=V[h];if(F.indices.push(p),d?(t.localPositionOverride?(F.jV[3*p]=t.localPositionOverride[0],F.jV[3*p+1]=t.localPositionOverride[1],F.jV[3*p+2]=t.localPositionOverride[2]):z&&(F.jV[3*p]=z[t.vertexIdx],F.jV[3*p+1]=z[t.vertexIdx+1],F.jV[3*p+2]=z[t.vertexIdx+2]),t.localNormalOverride?(F.lV[3*p]=t.localNormalOverride[0],F.lV[3*p+1]=t.localNormalOverride[1],F.lV[3*p+2]=t.localNormalOverride[2]):Q&&(F.lV[3*p]=Q[t.vertexIdx],F.lV[3*p+1]=Q[t.vertexIdx+1],F.lV[3*p+2]=Q[t.vertexIdx+2])):(t.position.toArray(F.jV,3*p),t.normal.toArray(F.lV,3*p)),F.matricesIndices&&F.matricesWeights&&(t.matrixIndicesOverride?(F.matricesIndices[4*p]=t.matrixIndicesOverride[0],F.matricesIndices[4*p+1]=t.matrixIndicesOverride[1],F.matricesIndices[4*p+2]=t.matrixIndicesOverride[2],F.matricesIndices[4*p+3]=t.matrixIndicesOverride[3]):(v&&(F.matricesIndices[4*p]=v[t.vertexIdxForBones],F.matricesIndices[4*p+1]=v[t.vertexIdxForBones+1],F.matricesIndices[4*p+2]=v[t.vertexIdxForBones+2],F.matricesIndices[4*p+3]=v[t.vertexIdxForBones+3]),H&&F.matricesIndicesExtra&&(F.matricesIndicesExtra[4*p]=H[t.vertexIdxForBones],F.matricesIndicesExtra[4*p+1]=H[t.vertexIdxForBones+1],F.matricesIndicesExtra[4*p+2]=H[t.vertexIdxForBones+2],F.matricesIndicesExtra[4*p+3]=H[t.vertexIdxForBones+3])),t.matrixWeightsOverride?(F.matricesWeights[4*p]=t.matrixWeightsOverride[0],F.matricesWeights[4*p+1]=t.matrixWeightsOverride[1],F.matricesWeights[4*p+2]=t.matrixWeightsOverride[2],F.matricesWeights[4*p+3]=t.matrixWeightsOverride[3]):(D&&(F.matricesWeights[4*p]=D[t.vertexIdxForBones],F.matricesWeights[4*p+1]=D[t.vertexIdxForBones+1],F.matricesWeights[4*p+2]=D[t.vertexIdxForBones+2],F.matricesWeights[4*p+3]=D[t.vertexIdxForBones+3]),j&&F.matricesWeightsExtra&&(F.matricesWeightsExtra[4*p]=j[t.vertexIdxForBones],F.matricesWeightsExtra[4*p+1]=j[t.vertexIdxForBones+1],F.matricesWeightsExtra[4*p+2]=j[t.vertexIdxForBones+2],F.matricesWeightsExtra[4*p+3]=j[t.vertexIdxForBones+3]))),mV.captureUVS)t.uv.toArray(F.yV,2*p);else{F.yV.push(.5+t.position.x/y.x);const V=.5+t.position.y/y.y;F.yV.push(k.b?1-V:V)}p++}}}0===F.indices.length&&(F.indices=null),0===F.jV.length&&(F.jV=null),0===F.lV.length&&(F.lV=null),0===F.yV.length&&(F.yV=null),0===(null===(K=F.matricesIndices)||void 0===K?void 0:K.length)&&(F.matricesIndices=null),0===(null===(o=F.matricesWeights)||void 0===o?void 0:o.length)&&(F.matricesWeights=null),0===(null===(n=F.matricesIndicesExtra)||void 0===n?void 0:n.length)&&(F.matricesIndicesExtra=null),0===(null===(q=F.matricesWeightsExtra)||void 0===q?void 0:q.length)&&(F.matricesWeightsExtra=null);const a=new L.c(V,h.DV());return F.IV(a),d?(a.skeleton=h.skeleton,a.parent=h):(a.position=l.clone(),a.rotation=new t.sh(T,I,O)),a.Qk(!0),a.refreshBoundingInfo(!0,!0),a}function X(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const h=0|Math.max(V.subdivisions?V.subdivisions:2,1),mV=0|Math.max(V.tessellation?V.tessellation:16,3),L=Math.max(V.height?V.height:1,0),N=Math.max(V.radius?V.radius:.25,0),C=0|Math.max(V.capSubdivisions?V.capSubdivisions:6,1),K=mV,o=h,n=Math.max(V.radiusTop?V.radiusTop:N,0),q=Math.max(V.radiusBottom?V.radiusBottom:N,0),x=L-(n+q),R=2*Math.PI,d=Math.max(V.topCapSubdivisions?V.topCapSubdivisions:C,1),s=Math.max(V.bottomCapSubdivisions?V.bottomCapSubdivisions:C,1),M=Math.acos((q-n)/L);let c=[];const z=[],Q=[],J=[];let v=0;const D=[],H=.5*x,j=.5*Math.PI;let l,G;const y=t.sh.Zero(),O=t.sh.Zero(),I=Math.cos(M),r=Math.sin(M),T=new t.Vector2(n*r,H+n*I).Mh(new t.Vector2(q*r,q*I-H)).length(),F=n*M+T+q*(j-M);let p=0;for(G=0;G<=d;G++){const V=[],h=j-M*(G/d);p+=n*M/d;const mV=Math.cos(h),t=Math.sin(h),L=mV*n;for(l=0;l<=K;l++){const h=l/K,N=h*R+0,A=Math.sin(N),C=Math.cos(N);O.x=L*A,O.y=H+t*n,O.z=L*C,z.push(O.x,O.y,O.z),y.set(mV*A,t,mV*C),Q.push(y.x,y.y,y.z),J.push(h,k.b?p/F:1-p/F),V.push(v),v++}D.push(V)}const Z=L-n-q+I*n-I*q,f=r*(q-n)/Z;for(G=1;G<=o;G++){const V=[];p+=T/o;const h=r*(G*(q-n)/o+n);for(l=0;l<=K;l++){const mV=l/K,t=mV*R+0,L=Math.sin(t),N=Math.cos(t);O.x=h*L,O.y=H+I*n-G*Z/o,O.z=h*N,z.push(O.x,O.y,O.z),y.set(L,f,N).normalize(),Q.push(y.x,y.y,y.z),J.push(mV,k.b?p/F:1-p/F),V.push(v),v++}D.push(V)}for(G=1;G<=s;G++){const V=[],h=j-M-(Math.PI-M)*(G/s);p+=q*M/s;const mV=Math.cos(h),t=Math.sin(h),L=mV*q;for(l=0;l<=K;l++){const h=l/K,N=h*R+0,A=Math.sin(N),C=Math.cos(N);O.x=L*A,O.y=t*q-H,O.z=L*C,z.push(O.x,O.y,O.z),y.set(mV*A,t,mV*C),Q.push(y.x,y.y,y.z),J.push(h,k.b?p/F:1-p/F),V.push(v),v++}D.push(V)}for(l=0;l<K;l++)for(G=0;G<d+o+s;G++){const V=D[G][l],h=D[G+1][l],mV=D[G+1][l+1],t=D[G][l+1];c.push(V),c.push(h),c.push(t),c.push(h),c.push(mV),c.push(t)}if(c=c.reverse(),V.orientation&&!V.orientation.equals(t.sh.Up())){const h=new t.Matrix;V.orientation.clone().scale(.5*Math.PI).cross(t.sh.Up()).toQuaternion().toRotationMatrix(h);const mV=t.sh.Zero();for(let V=0;V<z.length;V+=3)mV.set(z[V],z[V+1],z[V+2]),t.sh.TransformCoordinatesToRef(mV.clone(),h,mV),z[V]=mV.x,z[V+1]=mV.y,z[V+2]=mV.z}const S=new A.e;return S.jV=z,S.lV=Q,S.yV=J,S.indices=c,S}function a(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:t.sh.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new L.c(V,mV);return X(h).IV(N,h.updatable),N}L.c.CreateDecal=(V,h,mV,t,L,N)=>W(V,h,{position:mV,normal:t,size:L,angle:N});L.c.CreateCapsule=(V,h,mV)=>a(V,h,mV),A.e.CreateCapsule=X;var B=mV(12264),VV=mV(12425);class hV{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=V,this.y=h,V!==Math.floor(V)&&(V=Math.floor(V),B.e.Warn("x is not an integer, floor(x) used")),h!==Math.floor(h)&&(h=Math.floor(h),B.e.Warn("y is not an integer, floor(y) used"))}clone(){return new hV(this.x,this.y)}rotate60About(V){const h=this.x;return this.x=V.x+V.y-this.y,this.y=h+this.y-V.x,this}rotateNeg60About(V){const h=this.x;return this.x=h+this.y-V.y,this.y=V.x+V.y-h,this}rotate120(V,h){V!==Math.floor(V)&&(V=Math.floor(V),B.e.Warn("m not an integer only floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),B.e.Warn("n not an integer only floor(n) used"));const mV=this.x;return this.x=V-mV-this.y,this.y=h+mV,this}rotateNeg120(V,h){V!==Math.floor(V)&&(V=Math.floor(V),B.e.Warn("m is not an integer, floor(m) used")),h!==Math.floor(h)&&(h=Math.floor(h),B.e.Warn("n is not an integer,   floor(n) used"));const mV=this.x;return this.x=this.y-h,this.y=V+h-mV-this.y,this}toCartesianOrigin(V,h){const mV=t.sh.Zero();return mV.x=V.x+2*this.x*h+this.y*h,mV.y=V.y+Math.sqrt(3)*this.y*h,mV}static Zero(){return new hV(0,0)}}class mh{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new tV("icosahedron","Regular",[[0,VV.d,-1],[-VV.d,1,0],[-1,0,-VV.d],[1,0,-VV.d],[VV.d,1,0],[0,VV.d,1],[-1,0,VV.d],[-VV.d,-1,0],[0,-VV.d,-1],[VV.d,-1,0],[1,0,VV.d],[0,-VV.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let V=12;const h={},mV=this.m,t=this.n;let L,N,A,k,C,K=mV,o=1,n=0;0!==t&&(K=(0,E.HighestCommonFactor)(mV,t)),o=mV/K,n=t/K;const q=hV.Zero(),x=new hV(mV,t),R=new hV(-t,mV+t),d=hV.Zero(),s=hV.Zero(),M=hV.Zero();let c,z,Q,J,v=[];const D=[],H=this.vertByDist,j=(mV,t,L,N)=>{c=mV+"|"+L,z=t+"|"+N,c in h||z in h?c in h&&!(z in h)?h[z]=h[c]:z in h&&!(c in h)&&(h[c]=h[z]):(h[c]=V,h[z]=V,V++),H[L][0]>2?D[h[c]]=[-H[L][0],H[L][1],h[c]]:D[h[c]]=[v[H[L][0]],H[L][1],h[c]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let l=0;l<20;l++){if(v=this.IDATA.face[l],A=v[2],k=v[1],C=v[0],Q=q.x+"|"+q.y,c=l+"|"+Q,c in h||(h[c]=A,D[A]=[v[H[Q][0]],H[Q][1]]),Q=x.x+"|"+x.y,c=l+"|"+Q,c in h||(h[c]=k,D[k]=[v[H[Q][0]],H[Q][1]]),Q=R.x+"|"+R.y,c=l+"|"+Q,c in h||(h[c]=C,D[C]=[v[H[Q][0]],H[Q][1]]),L=this.IDATA.edgematch[l][0],N=this.IDATA.edgematch[l][1],"B"===N)for(let V=1;V<K;V++)s.x=mV-V*(o+n),s.y=t+V*o,M.x=-V*n,M.y=V*(o+n),Q=s.x+"|"+s.y,J=M.x+"|"+M.y,j(l,L,Q,J);if("O"===N)for(let V=1;V<K;V++)M.x=-V*n,M.y=V*(o+n),d.x=V*o,d.y=V*n,Q=M.x+"|"+M.y,J=d.x+"|"+d.y,j(l,L,Q,J);if(L=this.IDATA.edgematch[l][2],N=this.IDATA.edgematch[l][3],N&&"A"===N)for(let V=1;V<K;V++)d.x=V*o,d.y=V*n,s.x=mV-(K-V)*(o+n),s.y=t+(K-V)*o,Q=d.x+"|"+d.y,J=s.x+"|"+s.y,j(l,L,Q,J);for(let mV=0;mV<this.vertices.length;mV++)Q=this.vertices[mV].x+"|"+this.vertices[mV].y,c=l+"|"+Q,c in h||(h[c]=V++,H[Q][0]>2?D[h[c]]=[-H[Q][0],H[Q][1],h[c]]:D[h[c]]=[v[H[Q][0]],H[Q][1],h[c]])}this.closestTo=D,this.vecToidx=h}calcCoeffs(){const V=this.m,h=this.n,mV=Math.sqrt(3)/3,t=V*V+h*h+V*h;this.coau=(V+h)/t,this.cobu=-h/t,this.coav=-mV*(V-h)/t,this.cobv=mV*(2*V+h)/t}createInnerFacets(){const V=this.m,h=this.n;for(let mV=0;mV<h+V+1;mV++)for(let V=this.min[mV];V<this.max[mV]+1;V++)V<this.max[mV]&&V<this.max[mV+1]+1&&this.innerFacets.push(["|"+V+"|"+mV,"|"+V+"|"+(mV+1),"|"+(V+1)+"|"+mV]),mV>0&&V<this.max[mV-1]&&V+1<this.max[mV]+1&&this.innerFacets.push(["|"+V+"|"+mV,"|"+(V+1)+"|"+mV,"|"+(V+1)+"|"+(mV-1)])}edgeVecsABOB(){const V=this.m,h=this.n,mV=new hV(-h,V+h);for(let t=1;t<V+h;t++){const V=new hV(this.min[t],t),h=new hV(this.min[t-1],t-1),L=new hV(this.min[t+1],t+1),N=V.clone(),A=h.clone(),k=L.clone();N.rotate60About(mV),A.rotate60About(mV),k.rotate60About(mV);const C=new hV(this.max[N.y],N.y),K=new hV(this.max[N.y-1],N.y-1),o=new hV(this.max[N.y-1]-1,N.y-1);N.x===C.x&&N.y===C.y||(N.x!==K.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,K,o]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,o,C])):N.y===k.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,h,K]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([V,K,L])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([V,h,K]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([V,K,C])))}}mapABOBtoOBOA(){const V=new hV(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const mV=[];for(let t=0;t<3;t++)V.x=this.isoVecsABOB[h][t].x,V.y=this.isoVecsABOB[h][t].y,0===this.vertexTypes[h][t]&&V.rotateNeg120(this.m,this.n),mV.push(V.clone());this.isoVecsOBOA.push(mV)}}mapABOBtoBAOA(){const V=new hV(0,0);for(let h=0;h<this.isoVecsABOB.length;h++){const mV=[];for(let t=0;t<3;t++)V.x=this.isoVecsABOB[h][t].x,V.y=this.isoVecsABOB[h][t].y,1===this.vertexTypes[h][t]&&V.rotate120(this.m,this.n),mV.push(V.clone());this.isoVecsBAOA.push(mV)}}MapToFace(V,h){const mV=this.IDATA.face[V],L=mV[2],N=mV[1],A=mV[0],k=t.sh.Dh(this.IDATA.vertex[L]),C=t.sh.Dh(this.IDATA.vertex[N]),K=t.sh.Dh(this.IDATA.vertex[A]),o=C.Mh(k),n=K.Mh(k),q=o.scale(this.coau).add(n.scale(this.cobu)),x=o.scale(this.coav).add(n.scale(this.cobv)),R=[];let d,s=t.TmpVectors.sh[0];for(let t=0;t<this.cartesian.length;t++)s=q.scale(this.cartesian[t].x).add(x.scale(this.cartesian[t].y)).add(k),R[t]=[s.x,s.y,s.z],d=V+"|"+this.vertices[t].x+"|"+this.vertices[t].y,h.vertex[this.vecToidx[d]]=[s.x,s.y,s.z]}build(V,h){const mV=[],t=hV.Zero(),L=new hV(V,h),N=new hV(-h,V+h);mV.push(t,L,N);for(let Q=h;Q<V+1;Q++)for(let h=0;h<V+1-Q;h++)mV.push(new hV(h,Q));if(h>0){const t=(0,E.HighestCommonFactor)(V,h),L=V/t,N=h/t;for(let k=1;k<t;k++)mV.push(new hV(k*L,k*N)),mV.push(new hV(-k*N,k*(L+N))),mV.push(new hV(V-k*(L+N),h+k*L));const A=V/h;for(let k=1;k<h;k++)for(let t=0;t<k*A;t++)mV.push(new hV(t,k)),mV.push(new hV(t,k).rotate120(V,h)),mV.push(new hV(t,k).rotateNeg120(V,h))}mV.sort(((V,h)=>V.x-h.x)),mV.sort(((V,h)=>V.y-h.y));const A=new Array(V+h+1),k=new Array(V+h+1);for(let Q=0;Q<A.length;Q++)A[Q]=1/0,k[Q]=-1/0;let C=0,K=0;const o=mV.length;for(let Q=0;Q<o;Q++)K=mV[Q].x,C=mV[Q].y,A[C]=Math.min(K,A[C]),k[C]=Math.max(K,k[C]);const n=(mV,t)=>{const L=mV.clone();return"A"===t&&L.rotateNeg120(V,h),"B"===t&&L.rotate120(V,h),L.x<0?L.y:L.x+L.y},q=[],x=[],R=[],d=[],s={},M=[];let c=-1,z=-1;for(let Q=0;Q<o;Q++)q[Q]=mV[Q].toCartesianOrigin(new hV(0,0),.5),x[Q]=n(mV[Q],"O"),R[Q]=n(mV[Q],"A"),d[Q]=n(mV[Q],"B"),x[Q]===R[Q]&&R[Q]===d[Q]?(c=3,z=x[Q]):x[Q]===R[Q]?(c=4,z=x[Q]):R[Q]===d[Q]?(c=5,z=R[Q]):d[Q]===x[Q]&&(c=6,z=x[Q]),x[Q]<R[Q]&&x[Q]<d[Q]&&(c=2,z=x[Q]),R[Q]<x[Q]&&R[Q]<d[Q]&&(c=1,z=R[Q]),d[Q]<R[Q]&&d[Q]<x[Q]&&(c=0,z=d[Q]),M.push([c,z,mV[Q].x,mV[Q].y]);M.sort(((V,h)=>V[2]-h[2])),M.sort(((V,h)=>V[3]-h[3])),M.sort(((V,h)=>V[1]-h[1])),M.sort(((V,h)=>V[0]-h[0]));for(let Q=0;Q<M.length;Q++)s[M[Q][2]+"|"+M[Q][3]]=[M[Q][0],M[Q][1],Q];return this.m=V,this.n=h,this.vertices=mV,this.vertByDist=s,this.cartesian=q,this.min=A,this.max=k,this}}class tV{constructor(V,h,mV,t){this.name=V,this.category=h,this.vertex=mV,this.face=t}}class LV extends tV{innerToData(V,h){for(let mV=0;mV<h.innerFacets.length;mV++)this.face.push(h.innerFacets[mV].map((mV=>h.vecToidx[V+mV])))}mapABOBtoDATA(V,h){const mV=h.IDATA.edgematch[V][0];for(let t=0;t<h.isoVecsABOB.length;t++){const L=[];for(let N=0;N<3;N++)0===h.vertexTypes[t][N]?L.push(V+"|"+h.isoVecsABOB[t][N].x+"|"+h.isoVecsABOB[t][N].y):L.push(mV+"|"+h.isoVecsABOB[t][N].x+"|"+h.isoVecsABOB[t][N].y);this.face.push([h.vecToidx[L[0]],h.vecToidx[L[1]],h.vecToidx[L[2]]])}}mapOBOAtoDATA(V,h){const mV=h.IDATA.edgematch[V][0];for(let t=0;t<h.isoVecsOBOA.length;t++){const L=[];for(let N=0;N<3;N++)1===h.vertexTypes[t][N]?L.push(V+"|"+h.isoVecsOBOA[t][N].x+"|"+h.isoVecsOBOA[t][N].y):L.push(mV+"|"+h.isoVecsOBOA[t][N].x+"|"+h.isoVecsOBOA[t][N].y);this.face.push([h.vecToidx[L[0]],h.vecToidx[L[1]],h.vecToidx[L[2]]])}}mapBAOAtoDATA(V,h){const mV=h.IDATA.edgematch[V][2];for(let t=0;t<h.isoVecsBAOA.length;t++){const L=[];for(let N=0;N<3;N++)1===h.vertexTypes[t][N]?L.push(V+"|"+h.isoVecsBAOA[t][N].x+"|"+h.isoVecsBAOA[t][N].y):L.push(mV+"|"+h.isoVecsBAOA[t][N].x+"|"+h.isoVecsBAOA[t][N].y);this.face.push([h.vecToidx[L[0]],h.vecToidx[L[1]],h.vecToidx[L[2]]])}}orderData(V){const h=[];for(let N=0;N<13;N++)h[N]=[];const mV=V.closestTo;for(let N=0;N<mV.length;N++)mV[N][0]>-1?mV[N][1]>0&&h[mV[N][0]].push([N,mV[N][1]]):h[12].push([N,mV[N][0]]);const t=[];for(let N=0;N<12;N++)t[N]=N;let L=12;for(let N=0;N<12;N++){h[N].sort(((V,h)=>V[1]-h[1]));for(let V=0;V<h[N].length;V++)t[h[N][V][0]]=L++}for(let N=0;N<h[12].length;N++)t[h[12][N][0]]=L++;for(let N=0;N<this.vertex.length;N++)this.vertex[N].push(t[N]);this.vertex.sort(((V,h)=>V[3]-h[3]));for(let N=0;N<this.vertex.length;N++)this.vertex[N].pop();for(let N=0;N<this.face.length;N++)for(let V=0;V<this.face[N].length;V++)this.face[N][V]=t[this.face[N][V]];this.sharedNodes=h[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(V,h){const mV=[],t=[];let L=h.pop();t.push(L);let N=this.face[L].indexOf(V);N=(N+2)%3;let A=this.face[L][N];mV.push(A);let k=0;for(;h.length>0;)L=h[k],this.face[L].indexOf(A)>-1?(N=(this.face[L].indexOf(A)+1)%3,A=this.face[L][N],mV.push(A),t.push(L),h.splice(k,1),k=0):k++;return this.adjacentFaces.push(mV),t}toGoldbergPolyhedronData(){const V=new tV("GeoDual","Goldberg",[],[]);V.name="GD dual";const h=this.vertex.length,mV=new Array(h);for(let C=0;C<h;C++)mV[C]=[];for(let C=0;C<this.face.length;C++)for(let V=0;V<3;V++)mV[this.face[C][V]].push(C);let t=0,L=0,N=0,A=[],k=[];this.adjacentFaces=[];for(let C=0;C<mV.length;C++){V.face[C]=this.setOrder(C,mV[C].concat([]));for(const h of mV[C]){t=0,L=0,N=0,A=this.face[h];for(let V=0;V<3;V++)k=this.vertex[A[V]],t+=k[0],L+=k[1],N+=k[2];V.vertex[h]=[t/3,L/3,N/3]}}return V}static BuildGeodesicData(V){const h=new LV("Geodesic-m-n","Geodesic",[[0,VV.d,-1],[-VV.d,1,0],[-1,0,-VV.d],[1,0,-VV.d],[VV.d,1,0],[0,VV.d,1],[-1,0,VV.d],[-VV.d,-1,0],[0,-VV.d,-1],[VV.d,-1,0],[1,0,VV.d],[0,-VV.d,1]],[]);V.setIndices(),V.calcCoeffs(),V.createInnerFacets(),V.edgeVecsABOB(),V.mapABOBtoOBOA(),V.mapABOBtoBAOA();for(let mV=0;mV<V.IDATA.face.length;mV++)V.MapToFace(mV,h),h.innerToData(mV,V),"B"===V.IDATA.edgematch[mV][1]&&h.mapABOBtoDATA(mV,V),"O"===V.IDATA.edgematch[mV][1]&&h.mapOBOAtoDATA(mV,V),"A"===V.IDATA.edgematch[mV][3]&&h.mapBAOAtoDATA(mV,V);h.orderData(V);return h.vertex=h.vertex.map((function(V){const h=V[0],mV=V[1],t=V[2],L=Math.sqrt(h*h+mV*mV+t*t);return V[0]*=1/L,V[1]*=1/L,V[2]*=1/L,V})),h}}L.c._GoldbergMeshParser=(V,h)=>NV.Parse(V,h);class NV extends L.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(V,h){return void 0===h?(V>this.goldbergData.nbUnsharedFaces-1&&(B.e.Warn("Maximum number of unshared faces used"),V=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+V):(V>11&&(B.e.Warn("Last pole used"),V=11),h>this.goldbergData.nbFacesAtPole-1&&(B.e.Warn("Maximum number of faces at a pole used"),h=this.goldbergData.nbFacesAtPole-1),12+V*this.goldbergData.nbFacesAtPole+h)}_changeGoldbergFaceColors(V){for(let mV=0;mV<V.length;mV++){const h=V[mV][0],t=V[mV][1],L=V[mV][2];for(let V=h;V<t+1;V++)this.goldbergData.faceColors[V]=L}const h=[];for(let mV=0;mV<12;mV++)for(let V=0;V<5;V++)h.push(this.goldbergData.faceColors[mV].r,this.goldbergData.faceColors[mV].g,this.goldbergData.faceColors[mV].b,this.goldbergData.faceColors[mV].a);for(let mV=12;mV<this.goldbergData.faceColors.length;mV++)for(let V=0;V<6;V++)h.push(this.goldbergData.faceColors[mV].r,this.goldbergData.faceColors[mV].g,this.goldbergData.faceColors[mV].b,this.goldbergData.faceColors[mV].a);return h}setGoldbergFaceColors(V){const h=this._changeGoldbergFaceColors(V);this.pV(N.i.ColorKind,h)}updateGoldbergFaceColors(V){const h=this._changeGoldbergFaceColors(V);this.updateVerticesData(N.i.ColorKind,h)}_changeGoldbergFaceUVs(V){const h=this.getVerticesData(N.i.UVKind);for(let mV=0;mV<V.length;mV++){const t=V[mV][0],L=V[mV][1],N=V[mV][2],A=V[mV][3],k=V[mV][4],C=[],K=[];let o,n;for(let V=0;V<5;V++)o=N.x+A*Math.cos(k+V*Math.PI/2.5),n=N.y+A*Math.sin(k+V*Math.PI/2.5),o<0&&(o=0),o>1&&(o=1),C.push(o,n);for(let V=0;V<6;V++)o=N.x+A*Math.cos(k+V*Math.PI/3),n=N.y+A*Math.sin(k+V*Math.PI/3),o<0&&(o=0),o>1&&(o=1),K.push(o,n);for(let V=t;V<Math.min(12,L+1);V++)for(let mV=0;mV<5;mV++)h[10*V+2*mV]=C[2*mV],h[10*V+2*mV+1]=C[2*mV+1];for(let V=Math.max(12,t);V<L+1;V++)for(let mV=0;mV<6;mV++)h[12*V-24+2*mV]=K[2*mV],h[12*V-23+2*mV]=K[2*mV+1]}return h}setGoldbergFaceUVs(V){const h=this._changeGoldbergFaceUVs(V);this.pV(N.i.UVKind,h)}updateGoldbergFaceUVs(V){const h=this._changeGoldbergFaceUVs(V);this.updateVerticesData(N.i.UVKind,h)}placeOnGoldbergFaceAt(V,h,mV){const L=t.sh.RotationFromAxis(this.goldbergData.faceXaxis[h],this.goldbergData.faceYaxis[h],this.goldbergData.faceZaxis[h]);V.rotation=L,V.position=this.goldbergData.faceCenters[h].add(this.goldbergData.faceXaxis[h].scale(mV.x)).add(this.goldbergData.faceYaxis[h].scale(mV.y)).add(this.goldbergData.faceZaxis[h].scale(mV.z))}serialize(V){super.serialize(V),V.type="GoldbergMesh";const h={};if(h.adjacentFaces=this.goldbergData.adjacentFaces,h.nbSharedFaces=this.goldbergData.nbSharedFaces,h.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,h.nbFaces=this.goldbergData.nbFaces,h.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){h.faceColors=[];for(const V of this.goldbergData.faceColors)h.faceColors.push(V.sk())}if(this.goldbergData.faceCenters){h.faceCenters=[];for(const V of this.goldbergData.faceCenters)h.faceCenters.push(V.sk())}if(this.goldbergData.faceZaxis){h.faceZaxis=[];for(const V of this.goldbergData.faceZaxis)h.faceZaxis.push(V.sk())}if(this.goldbergData.faceYaxis){h.faceYaxis=[];for(const V of this.goldbergData.faceYaxis)h.faceYaxis.push(V.sk())}if(this.goldbergData.faceXaxis){h.faceXaxis=[];for(const V of this.goldbergData.faceXaxis)h.faceXaxis.push(V.sk())}V.goldbergData=h}static Parse(V,h){const mV=V.goldbergData;mV.faceColors=mV.faceColors.map((V=>q.Gk.Dh(V))),mV.faceCenters=mV.faceCenters.map((V=>t.sh.Dh(V))),mV.faceZaxis=mV.faceZaxis.map((V=>t.sh.Dh(V))),mV.faceXaxis=mV.faceXaxis.map((V=>t.sh.Dh(V))),mV.faceYaxis=mV.faceYaxis.map((V=>t.sh.Dh(V)));const L=new NV(V.name,h);return L.goldbergData=mV,L}}var AV=mV(12955);const kV={CreateBox:n.e,CreateTiledBox:s,CreateSphere:M.d,CreateDisc:o.c,CreateIcoSphere:w,CreateRibbon:K,CreateCylinder:J,CreateTorus:D,CreateTorusKnot:j,CreateLineSystem:l.d,QK:l.h,CreateDashedLines:l.c,ExtrudeShape:O,ExtrudeShapeCustom:I,CreateLathe:T,CreateTiledPlane:R,DK:F.c,CreateGround:p.f,CreateTiledGround:p.i,CreateGroundFromHeightMap:p.c,CreatePolygon:G.d,ExtrudePolygon:G.e,CreateTube:Z,CreatePolyhedron:S,CreateGeodesic:function(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=h.m||1;t!==Math.floor(t)&&(t=Math.floor(t),B.e.Warn("m not an integer only floor(m) used"));let L=h.n||0;if(L!==Math.floor(L)&&(L=Math.floor(L),B.e.Warn("n not an integer only floor(n) used")),L>t){const V=L;L=t,t=V,B.e.Warn("n > m therefore m and n swapped")}const N=new mh;return N.build(t,L),S(V,{custom:LV.BuildGeodesicData(N),size:h.size,sizeX:h.sizeX,sizeY:h.sizeY,sizeZ:h.sizeZ,faceUV:h.faceUV,faceColors:h.faceColors,flat:h.flat,updatable:h.updatable,sideOrientation:h.sideOrientation,frontUVs:h.frontUVs,backUVs:h.backUVs},mV)},CreateGoldberg:function(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=h.size,C=h.sizeX||N||1,K=h.sizeY||N||1,o=h.sizeZ||N||1;let n=h.m||1;n!==Math.floor(n)&&(n=Math.floor(n),B.e.Warn("m not an integer only floor(m) used"));let x=h.n||0;if(x!==Math.floor(x)&&(x=Math.floor(x),B.e.Warn("n not an integer only floor(n) used")),x>n){const V=x;x=n,n=V,B.e.Warn("n > m therefore m and n swapped")}const R=new mh;R.build(n,x);const d=LV.BuildGeodesicData(R),s=d.toGoldbergPolyhedronData(),M=new NV(V,mV);h.sideOrientation=L.c._GetDefaultSideOrientation(h.sideOrientation),M._originalBuilderSideOrientation=h.sideOrientation;(function(V,h){const mV=V.size,L=V.sizeX||mV||1,N=V.sizeY||mV||1,C=V.sizeZ||mV||1,K=0===V.sideOrientation?0:V.sideOrientation||A.e.DEFAULTSIDE,o=[],n=[],q=[],x=[];let R=1/0,d=-1/0,s=1/0,M=-1/0;for(let t=0;t<h.vertex.length;t++)R=Math.min(R,h.vertex[t][0]*L),d=Math.max(d,h.vertex[t][0]*L),s=Math.min(s,h.vertex[t][1]*N),M=Math.max(M,h.vertex[t][1]*N);let c=0;for(let A=0;A<h.face.length;A++){const V=h.face[A],mV=t.sh.Dh(h.vertex[V[0]]),K=t.sh.Dh(h.vertex[V[2]]),z=t.sh.Dh(h.vertex[V[1]]),Q=K.Mh(mV),J=z.Mh(mV),v=t.sh.Cross(J,Q).normalize();for(let t=0;t<V.length;t++){q.push(v.x,v.y,v.z);const mV=h.vertex[V[t]];o.push(mV[0]*L,mV[1]*N,mV[2]*C);const A=(mV[1]*N-s)/(M-s);x.push((mV[0]*L-R)/(d-R),k.b?1-A:A)}for(let h=0;h<V.length-2;h++)n.push(c,c+h+2,c+h+1);c+=V.length}A.e._ComputeSides(K,o,n,q,x);const z=new A.e;return z.jV=o,z.indices=n,z.lV=q,z.yV=x,z})(h,s).IV(M,h.updatable),M.goldbergData.nbSharedFaces=d.sharedNodes,M.goldbergData.nbUnsharedFaces=d.poleNodes,M.goldbergData.adjacentFaces=d.adjacentFaces,M.goldbergData.nbFaces=M.goldbergData.nbSharedFaces+M.goldbergData.nbUnsharedFaces,M.goldbergData.nbFacesAtPole=(M.goldbergData.nbUnsharedFaces-12)/12;for(let L=0;L<d.vertex.length;L++)M.goldbergData.faceCenters.push(t.sh.Dh(d.vertex[L])),M.goldbergData.faceCenters[L].x*=C,M.goldbergData.faceCenters[L].y*=K,M.goldbergData.faceCenters[L].z*=o,M.goldbergData.faceColors.push(new q.Gk(1,1,1,1));for(let L=0;L<s.face.length;L++){const V=s.face[L],h=t.sh.Dh(s.vertex[V[0]]),mV=t.sh.Dh(s.vertex[V[2]]),N=t.sh.Dh(s.vertex[V[1]]),A=mV.Mh(h),k=N.Mh(h),C=t.sh.Cross(k,A).normalize(),K=t.sh.Cross(k,C).normalize();M.goldbergData.faceXaxis.push(k.normalize()),M.goldbergData.faceYaxis.push(C),M.goldbergData.faceZaxis.push(K)}return M},CreateDecal:W,CreateCapsule:a,CreateText:AV.f}},13712:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>kh});var t=mV(12422),L=mV(12770);class N extends L.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var A=mV(12453),k=(mV(12580),mV(12388));class C{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(V){this._targetStopDuration!==V&&(this._targetStopDuration=V)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(V){this._noiseTexture!==V&&(this._noiseTexture=V,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(V){this._animationSheetEnabled!==V&&(this._animationSheetEnabled=V)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(V){this._isAnimationSheetEnabled!=V&&(this._isAnimationSheetEnabled=V,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(V){this._useLogarithmicDepth=V&&this.DV().getEngine().getCaps().fragmentDepthSupported}DV(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(V){switch(V){case C.BLENDMODE_MULTIPLYADD:return;case C.BLENDMODE_ADD:V=1;break;case C.BLENDMODE_ONEONE:V=6;break;case C.BLENDMODE_STANDARD:V=2;break;case C.BLENDMODE_MULTIPLY:V=4;break;case C.BLENDMODE_SUBTRACT:V=3}this._engine.setAlphaMode(V)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:t.sh.Zero()}set direction1(V){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=V)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:t.sh.Zero()}set direction2(V){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=V)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:t.sh.Zero()}set minEmitBox(V){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=V)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:t.sh.Zero()}set maxEmitBox(V){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=V)}get billboardMode(){return this._billboardMode}set billboardMode(V){this._billboardMode!==V&&(this._billboardMode=V,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(V){this._isBillboardBased!==V&&(this._isBillboardBased=V,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(V){this._attachImageProcessingConfiguration(V)}_attachImageProcessingConfiguration(V){V!==this._imageProcessingConfiguration&&(!V&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=V)}_reset(){}_removeGradientAndTexture(V,h,mV){if(!h)return this;let t=0;for(const L of h){if(L.gradient===V){h.splice(t,1);break}t++}return mV&&mV.dispose(),this}constructor(V){this.animations=[],this.renderingGroupId=0,this.Lh=t.sh.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new t.sh(10,10,10),this.onAnimationEnd=null,this.blendMode=C.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new t.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.MK=new t.sh(0,0,0),this._useLogarithmicDepth=!1,this.gravity=t.sh.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new A.Gk(1,1,1,1),this.color2=new A.Gk(1,1,1,1),this.colorDead=new A.Gk(0,0,0,1),this.textureMask=new A.Gk(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new N,this.id=V,this.name=V}createPointEmitter(V,h){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new t.sh(0,1,0),arguments.length>2&&void 0!==arguments[2]||new t.sh(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new t.sh(0,1,0),arguments.length>4&&void 0!==arguments[4]||new t.sh(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new t.sh(0,1,0),arguments.length>3&&void 0!==arguments[3]||new t.sh(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(V,h,mV,t){throw new Error("Method not implemented.")}}C.BLENDMODE_ONEONE=0,C.BLENDMODE_STANDARD=1,C.BLENDMODE_ADD=2,C.BLENDMODE_MULTIPLY=3,C.BLENDMODE_MULTIPLYADD=4,C.BLENDMODE_SUBTRACT=-1,(0,k.i)("BABYLON.BaseParticleSystem",C);var K=mV(12435),o=mV(12272);class n{constructor(){this.direction1=new t.sh(0,1,0),this.direction2=new t.sh(0,1,0),this.minEmitBox=new t.sh(-.5,-.5,-.5),this.maxEmitBox=new t.sh(.5,.5,.5)}startDirectionFunction(V,h,mV,L){const N=(0,K.RandomRange)(this.direction1.x,this.direction2.x),A=(0,K.RandomRange)(this.direction1.y,this.direction2.y),k=(0,K.RandomRange)(this.direction1.z,this.direction2.z);if(L)return h.x=N,h.y=A,void(h.z=k);t.sh.TransformNormalFromFloatsToRef(N,A,k,V,h)}startPositionFunction(V,h,mV,L){const N=(0,K.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),A=(0,K.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),k=(0,K.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(L)return h.x=N,h.y=A,void(h.z=k);t.sh.TransformCoordinatesFromFloatsToRef(N,A,k,V,h)}clone(){const V=new n;return o.b.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2),V.setVector3("minEmitBox",this.minEmitBox),V.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3),V.addUniform("minEmitBox",3),V.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.sk(),V.direction2=this.direction2.sk(),V.minEmitBox=this.minEmitBox.sk(),V.maxEmitBox=this.maxEmitBox.sk(),V}parse(V){t.sh.FromArrayToRef(V.direction1,0,this.direction1),t.sh.FromArrayToRef(V.direction2,0,this.direction2),t.sh.FromArrayToRef(V.minEmitBox,0,this.minEmitBox),t.sh.FromArrayToRef(V.maxEmitBox,0,this.maxEmitBox)}}class q{get radius(){return this._radius}set radius(V){this._radius=V,this._buildHeight()}get angle(){return this._angle}set angle(V){this._angle=V,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=mV,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=h,this.radius=V}startDirectionFunction(V,h,mV,L){L?t.TmpVectors.sh[0].t(mV.Xk).normalize():mV.position.subtractToRef(V.getTranslation(),t.TmpVectors.sh[0]).normalize();const N=(0,K.RandomRange)(0,this.directionRandomizer),A=(0,K.RandomRange)(0,this.directionRandomizer),k=(0,K.RandomRange)(0,this.directionRandomizer);h.x=t.TmpVectors.sh[0].x+N,h.y=t.TmpVectors.sh[0].y+A,h.z=t.TmpVectors.sh[0].z+k,h.normalize()}startPositionFunction(V,h,mV,L){const N=(0,K.RandomRange)(0,2*Math.PI);let A;this.emitFromSpawnPointOnly?A=1e-4:(A=(0,K.RandomRange)(0,this.heightRange),A=1-A*A);let k=this._radius-(0,K.RandomRange)(0,this._radius*this.radiusRange);k*=A;const C=k*Math.sin(N),o=k*Math.cos(N),n=A*this._height;if(L)return h.x=C,h.y=n,void(h.z=o);t.sh.TransformCoordinatesFromFloatsToRef(C,n,o,V,h)}clone(){const V=new q(this._radius,this._angle,this.directionRandomizer);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat2("radius",this._radius,this.radiusRange),V.setFloat("coneAngle",this._angle),V.setFloat2("height",this._height,this.heightRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",2),V.addUniform("coneAngle",1),V.addUniform("height",2),V.addUniform("directionRandomizer",1)}getEffectDefines(){let V="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(V+="\n#define CONEEMITTERSPAWNPOINT"),V}getClassName(){return"ConeParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this._radius,V.angle=this._angle,V.directionRandomizer=this.directionRandomizer,V.radiusRange=this.radiusRange,V.heightRange=this.heightRange,V.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,V}parse(V){this.radius=V.radius,this.angle=V.angle,this.directionRandomizer=V.directionRandomizer,this.radiusRange=void 0!==V.radiusRange?V.radiusRange:1,this.heightRange=void 0!==V.radiusRange?V.heightRange:1,this.emitFromSpawnPointOnly=void 0!==V.emitFromSpawnPointOnly&&V.emitFromSpawnPointOnly}}class x extends q{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0);super(V,h),this.direction1=mV,this.direction2=L}startDirectionFunction(V,h){const mV=(0,K.RandomRange)(this.direction1.x,this.direction2.x),L=(0,K.RandomRange)(this.direction1.y,this.direction2.y),N=(0,K.RandomRange)(this.direction1.z,this.direction2.z);t.sh.TransformNormalFromFloatsToRef(mV,L,N,V,h)}clone(){const V=new x(this.radius,this.angle,this.direction1,this.direction2);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.sk(),V.direction2=this.direction2.sk(),V}parse(V){super.parse(V),this.direction1.t(V.direction1),this.direction2.t(V.direction2)}}class R{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=V,this.height=h,this.radiusRange=mV,this.directionRandomizer=L,this._tempVector=t.sh.Zero()}startDirectionFunction(V,h,mV,L,N){mV.position.subtractToRef(V.getTranslation(),this._tempVector),this._tempVector.normalize(),t.sh.TransformNormalToRef(this._tempVector,N,this._tempVector);const A=(0,K.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let k=Math.atan2(this._tempVector.x,this._tempVector.z);k+=(0,K.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=A,this._tempVector.x=Math.sin(k),this._tempVector.z=Math.cos(k),this._tempVector.normalize(),L?h.t(this._tempVector):t.sh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V,h)}startPositionFunction(V,h,mV,L){const N=(0,K.RandomRange)(-this.height/2,this.height/2),A=(0,K.RandomRange)(0,2*Math.PI),k=(0,K.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),C=Math.sqrt(k)*this.radius,o=C*Math.cos(A),n=C*Math.sin(A);L?h.Hk(o,N,n):t.sh.TransformCoordinatesFromFloatsToRef(o,N,n,V,h)}clone(){const V=new R(this.radius,this.directionRandomizer);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.height=this.height,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.height=V.height,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class d extends R{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.sh(0,1,0);super(V,h,mV),this.direction1=L,this.direction2=N}startDirectionFunction(V,h,mV,L){const N=(0,K.RandomRange)(this.direction1.x,this.direction2.x),A=(0,K.RandomRange)(this.direction1.y,this.direction2.y),k=(0,K.RandomRange)(this.direction1.z,this.direction2.z);L?h.Hk(N,A,k):t.sh.TransformNormalFromFloatsToRef(N,A,k,V,h)}clone(){const V=new d(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("height",this.height),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("height",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.sk(),V.direction2=this.direction2.sk(),V}parse(V){super.parse(V),t.sh.FromArrayToRef(V.direction1,0,this.direction1),t.sh.FromArrayToRef(V.direction2,0,this.direction2)}}class s{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=h,this.directionRandomizer=mV}startDirectionFunction(V,h,mV,L){const N=mV.position.Mh(V.getTranslation()).normalize(),A=(0,K.RandomRange)(0,this.directionRandomizer),k=(0,K.RandomRange)(0,this.directionRandomizer),C=(0,K.RandomRange)(0,this.directionRandomizer);N.x+=A,N.y+=k,N.z+=C,N.normalize(),L?h.t(N):t.sh.TransformNormalFromFloatsToRef(N.x,N.y,N.z,V,h)}startPositionFunction(V,h,mV,L){const N=this.radius-(0,K.RandomRange)(0,this.radius*this.radiusRange),A=(0,K.RandomRange)(0,1),k=(0,K.RandomRange)(0,2*Math.PI),C=Math.acos(2*A-1),o=N*Math.cos(k)*Math.sin(C),n=N*Math.cos(C),q=N*Math.sin(k)*Math.sin(C);L?h.Hk(o,Math.abs(n),q):t.sh.TransformCoordinatesFromFloatsToRef(o,Math.abs(n),q,V,h)}clone(){const V=new s(this.radius,this.directionRandomizer);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class M{constructor(){this.direction1=new t.sh(0,1,0),this.direction2=new t.sh(0,1,0)}startDirectionFunction(V,h,mV,L){const N=(0,K.RandomRange)(this.direction1.x,this.direction2.x),A=(0,K.RandomRange)(this.direction1.y,this.direction2.y),k=(0,K.RandomRange)(this.direction1.z,this.direction2.z);L?h.Hk(N,A,k):t.sh.TransformNormalFromFloatsToRef(N,A,k,V,h)}startPositionFunction(V,h,mV,L){L?h.Hk(0,0,0):t.sh.TransformCoordinatesFromFloatsToRef(0,0,0,V,h)}clone(){const V=new M;return o.b.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.direction1=this.direction1.sk(),V.direction2=this.direction2.sk(),V}parse(V){t.sh.FromArrayToRef(V.direction1,0,this.direction1),t.sh.FromArrayToRef(V.direction2,0,this.direction2)}}class c{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=V,this.radiusRange=h,this.directionRandomizer=mV}startDirectionFunction(V,h,mV,L){const N=mV.position.Mh(V.getTranslation()).normalize(),A=(0,K.RandomRange)(0,this.directionRandomizer),k=(0,K.RandomRange)(0,this.directionRandomizer),C=(0,K.RandomRange)(0,this.directionRandomizer);N.x+=A,N.y+=k,N.z+=C,N.normalize(),L?h.t(N):t.sh.TransformNormalFromFloatsToRef(N.x,N.y,N.z,V,h)}startPositionFunction(V,h,mV,L){const N=this.radius-(0,K.RandomRange)(0,this.radius*this.radiusRange),A=(0,K.RandomRange)(0,1),k=(0,K.RandomRange)(0,2*Math.PI),C=Math.acos(2*A-1),o=N*Math.cos(k)*Math.sin(C),n=N*Math.cos(C),q=N*Math.sin(k)*Math.sin(C);L?h.Hk(o,n,q):t.sh.TransformCoordinatesFromFloatsToRef(o,n,q,V,h)}clone(){const V=new c(this.radius,this.directionRandomizer);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.radius=this.radius,V.radiusRange=this.radiusRange,V.directionRandomizer=this.directionRandomizer,V}parse(V){this.radius=V.radius,this.radiusRange=V.radiusRange,this.directionRandomizer=V.directionRandomizer}}class z extends c{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.sh(0,1,0),mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0);super(V),this.direction1=h,this.direction2=mV}startDirectionFunction(V,h){const mV=(0,K.RandomRange)(this.direction1.x,this.direction2.x),L=(0,K.RandomRange)(this.direction1.y,this.direction2.y),N=(0,K.RandomRange)(this.direction1.z,this.direction2.z);t.sh.TransformNormalFromFloatsToRef(mV,L,N,V,h)}clone(){const V=new z(this.radius,this.direction1,this.direction2);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setFloat("radius",this.radius),V.setFloat("radiusRange",this.radiusRange),V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("radius",1),V.addUniform("radiusRange",1),V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const V=super.serialize();return V.direction1=this.direction1.sk(),V.direction2=this.direction2.sk(),V}parse(V){super.parse(V),this.direction1.t(V.direction1),this.direction2.t(V.direction2)}}class Q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(V,h,mV,L){const N=t.TmpVectors.sh[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,mV,N);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,mV,N);const V=t.TmpVectors.sh[1];N.subtractToRef(mV.position,V),V.scaleToRef(1/mV.lifeTime,N)}else N.set(0,0,0);L?h.t(N):t.sh.TransformNormalToRef(N,V,h)}startPositionFunction(V,h,mV,L){const N=t.TmpVectors.sh[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,mV,N):N.set(0,0,0),L?h.t(N):t.sh.TransformCoordinatesToRef(N,V,h)}clone(){const V=new Q;return o.b.DeepCopy(this,V),V}applyToShader(V){}buildUniformLayout(V){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const V={};return V.type=this.getClassName(),V.particlePositionGenerator=this.particlePositionGenerator,V.particleDestinationGenerator=this.particleDestinationGenerator,V}parse(V){V.particlePositionGenerator&&(this.particlePositionGenerator=V.particlePositionGenerator),V.particleDestinationGenerator&&(this.particleDestinationGenerator=V.particleDestinationGenerator)}}var J=mV(12481);class v{get mesh(){return this._mesh}set mesh(V){this._mesh!==V&&(this._mesh=V,V?(this._indices=V.vk(),this._positions=V.getVerticesData(J.i.PositionKind),this._normals=V.getVerticesData(J.i.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=t.sh.Zero(),this._mesh=null,this.direction1=new t.sh(0,1,0),this.direction2=new t.sh(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=V}startDirectionFunction(V,h,mV,L){if(this.useMeshNormalsForDirection&&this._normals)return void t.sh.TransformNormalToRef(this._storedNormal,V,h);const N=(0,K.RandomRange)(this.direction1.x,this.direction2.x),A=(0,K.RandomRange)(this.direction1.y,this.direction2.y),k=(0,K.RandomRange)(this.direction1.z,this.direction2.z);L?h.Hk(N,A,k):t.sh.TransformNormalFromFloatsToRef(N,A,k,V,h)}startPositionFunction(V,h,mV,L){if(!this._indices||!this._positions)return;const N=3*(Math.random()*(this._indices.length/3)|0),A=Math.random(),k=Math.random()*(1-A),C=1-A-k,K=this._indices[N],o=this._indices[N+1],n=this._indices[N+2],q=t.TmpVectors.sh[0],x=t.TmpVectors.sh[1],R=t.TmpVectors.sh[2],d=t.TmpVectors.sh[3];t.sh.FromArrayToRef(this._positions,3*K,q),t.sh.FromArrayToRef(this._positions,3*o,x),t.sh.FromArrayToRef(this._positions,3*n,R),d.x=A*q.x+k*x.x+C*R.x,d.y=A*q.y+k*x.y+C*R.y,d.z=A*q.z+k*x.z+C*R.z,L?h.Hk(d.x,d.y,d.z):t.sh.TransformCoordinatesFromFloatsToRef(d.x,d.y,d.z,V,h),this.useMeshNormalsForDirection&&this._normals&&(t.sh.FromArrayToRef(this._normals,3*K,q),t.sh.FromArrayToRef(this._normals,3*o,x),t.sh.FromArrayToRef(this._normals,3*n,R),this._storedNormal.x=A*q.x+k*x.x+C*R.x,this._storedNormal.y=A*q.y+k*x.y+C*R.y,this._storedNormal.z=A*q.z+k*x.z+C*R.z)}clone(){const V=new v(this.mesh);return o.b.DeepCopy(this,V),V}applyToShader(V){V.setVector3("direction1",this.direction1),V.setVector3("direction2",this.direction2)}buildUniformLayout(V){V.addUniform("direction1",3),V.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var V;const h={};return h.type=this.getClassName(),h.direction1=this.direction1.sk(),h.direction2=this.direction2.sk(),h.meshId=null===(V=this.mesh)||void 0===V?void 0:V.id,h.useMeshNormalsForDirection=this.useMeshNormalsForDirection,h}parse(V,h){t.sh.FromArrayToRef(V.direction1,0,this.direction1),t.sh.FromArrayToRef(V.direction2,0,this.direction2),V.meshId&&h&&(this.mesh=h.getLastMeshById(V.meshId)),this.useMeshNormalsForDirection=V.useMeshNormalsForDirection}}class D{_isUbo(V){return void 0!==V.addUniform}constructor(V){this._isUbo(V)?(this.setMatrix3x3=V.updateMatrix3x3.bind(V),this.setMatrix2x2=V.updateMatrix2x2.bind(V),this.setFloat=V.updateFloat.bind(V),this.setFloat2=V.updateFloat2.bind(V),this.setFloat3=V.updateFloat3.bind(V),this.setFloat4=V.updateFloat4.bind(V),this.setFloatArray=V.updateFloatArray.bind(V),this.setArray=V.updateArray.bind(V),this.setIntArray=V.updateIntArray.bind(V),this.setMatrix=V.zk.bind(V),this.setMatrices=V.updateMatrices.bind(V),this.setVector3=V.updateVector3.bind(V),this.setVector4=V.updateVector4.bind(V),this.setColor3=V.updateColor3.bind(V),this.setColor4=V.updateColor4.bind(V),this.setDirectColor4=V.updateDirectColor4.bind(V),this.setInt=V.updateInt.bind(V),this.setInt2=V.updateInt2.bind(V),this.setInt3=V.updateInt3.bind(V),this.setInt4=V.updateInt4.bind(V)):(this.setMatrix3x3=V.setMatrix3x3.bind(V),this.setMatrix2x2=V.setMatrix2x2.bind(V),this.setFloat=V.setFloat.bind(V),this.setFloat2=V.setFloat2.bind(V),this.setFloat3=V.setFloat3.bind(V),this.setFloat4=V.setFloat4.bind(V),this.setFloatArray=V.setFloatArray.bind(V),this.setArray=V.setArray.bind(V),this.setIntArray=V.setIntArray.bind(V),this.setMatrix=V.setMatrix.bind(V),this.setMatrices=V.setMatrices.bind(V),this.setVector3=V.setVector3.bind(V),this.setVector4=V.setVector4.bind(V),this.setColor3=V.setColor3.bind(V),this.setColor4=V.setColor4.bind(V),this.setDirectColor4=V.setDirectColor4.bind(V),this.setInt=V.setInt.bind(V),this.setInt2=V.setInt2.bind(V),this.setInt3=V.setInt3.bind(V),this.setInt4=V.setInt4.bind(V))}}var H=mV(12342);const j="gpuUpdateParticlesPixelShader",l="#version 300 es\nvoid main() {discard;}\n";H.b.ShadersStore[j]||(H.b.ShadersStore[j]=l);const G="gpuUpdateParticlesVertexShader",y="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";H.b.ShadersStore[G]||(H.b.ShadersStore[G]=y);(0,k.i)("BABYLON.WebGL2ParticleSystem",class{constructor(V,h){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=V,this._engine=h,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var V;return(null===(V=this._updateEffect)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=V,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new D(this._updateEffect)}createVertexBuffers(V,h){this._updateVAO.push(this._createUpdateVAO(V)),this._renderVAO.push(this._engine.recordVertexArrayObject(h,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=h}createParticleBuffer(V){return V}bindDrawBuffers(V,h,mV){mV?this._engine.bindBuffers(this._renderVertexBuffers,mV,h):this._engine.bindVertexArrayObject(this._renderVAO[V],null)}preUpdateParticleBuffer(){const V=this._engine;if(this._engine.enableEffect(this._updateEffect),!V.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(V,h,mV){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[V],null);const t=this._engine;t.bindTransformFeedbackBuffer(h.getBuffer()),t.setRasterizerState(!1),t.beginTransformFeedback(!0),t.drawArraysType(3,0,mV),t.endTransformFeedback(),t.setRasterizerState(!0),t.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let V=0;V<this._updateVAO.length;V++)this._engine.releaseVertexArrayObject(this._updateVAO[V]);this._updateVAO.length=0;for(let V=0;V<this._renderVAO.length;V++)this._engine.releaseVertexArrayObject(this._renderVAO[V]);this._renderVAO.length=0}_createUpdateVAO(V){const h={};h.position=V.createVertexBuffer("position",0,3);let mV=3;h.age=V.createVertexBuffer("age",mV,1),mV+=1,h.size=V.createVertexBuffer("size",mV,3),mV+=3,h.life=V.createVertexBuffer("life",mV,1),mV+=1,h.seed=V.createVertexBuffer("seed",mV,4),mV+=4,h.direction=V.createVertexBuffer("direction",mV,3),mV+=3,this._parent.particleEmitterType instanceof Q&&(h.initialPosition=V.createVertexBuffer("initialPosition",mV,3),mV+=3),this._parent._colorGradientsTexture||(h.color=V.createVertexBuffer("color",mV,4),mV+=4),this._parent._isBillboardBased||(h.initialDirection=V.createVertexBuffer("initialDirection",mV,3),mV+=3),this._parent.noiseTexture&&(h.noiseCoordinates1=V.createVertexBuffer("noiseCoordinates1",mV,3),mV+=3,h.noiseCoordinates2=V.createVertexBuffer("noiseCoordinates2",mV,3),mV+=3),this._parent._angularSpeedGradientsTexture?(h.angle=V.createVertexBuffer("angle",mV,1),mV+=1):(h.angle=V.createVertexBuffer("angle",mV,2),mV+=2),this._parent._isAnimationSheetEnabled&&(h.cellIndex=V.createVertexBuffer("cellIndex",mV,1),mV+=1,this._parent.spriteRandomStartCell&&(h.cellStartOffset=V.createVertexBuffer("cellStartOffset",mV,1),mV+=1));const t=this._engine.recordVertexArrayObject(h,null,this._updateEffect);return this._engine.bindArrayBuffer(null),t}});class O{constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,t=arguments.length>3?arguments[3]:void 0;this._engine=V,this._label=t,this._engine._storageBuffers.push(this),this._create(h,mV)}_create(V,h){this._bufferSize=V,this._creationFlags=h,this._buffer=this._engine.createStorageBuffer(V,h,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(V,h,mV){this._buffer&&this._engine.updateStorageBuffer(this._buffer,V,h,mV)}async read(V,h,mV,t){return await this._engine.readFromStorageBuffer(this._buffer,V,h,mV,t)}dispose(){const V=this._engine._storageBuffers,h=V.indexOf(this);-1!==h&&(V[h]=V[V.length-1],V.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var I=mV(12409),r=mV(12413),T=mV(12448),F=mV(12406),p=mV(12699),Z=mV(12264),f=mV(12366),S=mV(12623);class Y{constructor(){this._gpuTimeInFrameId=-1,this.counter=new S.c}_addDuration(V,h){V<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==V?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(h,!1),this._gpuTimeInFrameId=V):this.counter.addCount(h,!1))}}var w=mV(12322);class E{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=V,this._engine=h,this.uniqueId=p.e.UniqueId,h.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new Y),this._engine.getCaps().supportComputeShaders?t.bindingsMapping?(this._context=h.createComputeContext(),this._shaderPath=mV,this._options={bindingsMapping:{},defines:[],...t}):Z.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):Z.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(V,h){let mV=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const t=this._bindings[V];this._bindings[V]={type:mV?0:4,object:h,indexInGroupEntries:null===t||void 0===t?void 0:t.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!t||t.object!==h||t.type!==this._bindings[V].type)}setStorageTexture(V,h){const mV=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!mV||mV.object!==h),this._bindings[V]={type:1,object:h,indexInGroupEntries:null===mV||void 0===mV?void 0:mV.indexInGroupEntries}}setExternalTexture(V,h){const mV=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!mV||mV.object!==h),this._bindings[V]={type:6,object:h,indexInGroupEntries:null===mV||void 0===mV?void 0:mV.indexInGroupEntries}}setVideoTexture(V,h){return!!h.externalTexture&&(this.setExternalTexture(V,h.externalTexture),!0)}setUniformBuffer(V,h){const mV=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!mV||mV.object!==h),this._bindings[V]={type:E._BufferIsDataBuffer(h)?7:2,object:h,indexInGroupEntries:null===mV||void 0===mV?void 0:mV.indexInGroupEntries}}setStorageBuffer(V,h){const mV=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!mV||mV.object!==h),this._bindings[V]={type:E._BufferIsDataBuffer(h)?7:3,object:h,indexInGroupEntries:null===mV||void 0===mV?void 0:mV.indexInGroupEntries}}setTextureSampler(V,h){const mV=this._bindings[V];this._contextIsDirty||(this._contextIsDirty=!mV||!h.compareSampler(mV.object)),this._bindings[V]={type:5,object:h,indexInGroupEntries:null===mV||void 0===mV?void 0:mV.indexInGroupEntries}}isReady(){let V=this._effect;for(const L in this._bindings){const V=this._bindings[L],h=V.type,mV=V.object;switch(h){case 0:case 4:case 1:if(!mV.isReady())return!1;break;case 6:if(!mV.isReady())return!1;break}}const h=[],mV=this._shaderPath;if(this._options.defines)for(let L=0;L<this._options.defines.length;L++)h.push(this._options.defines[L]);const t=h.join("\n");return this._cachedDefines!==t&&(this._cachedDefines=t,V=this._engine.createComputeEffect(mV,{defines:t,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=V),!!V.isReady()}dispatch(V,h,mV){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,V,h,mV,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const mV=E._BufferIsDataBuffer(V)?V:V.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,mV,h,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const h in this._bindings){const mV=this._bindings[h];if(!this._options.bindingsMapping[h])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+h+"'");switch(mV.type){case 0:{const t=this._samplers[h],L=mV.object;var V;if(!t||!L._texture||!t.compareSampler(L._texture))this._samplers[h]=(new f.d).setParameters(L.wrapU,L.wrapV,L.wrapR,L.anisotropicFilteringLevel,L._texture.samplingMode,null===(V=L._texture)||void 0===V?void 0:V._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const V=mV.object;V.getBuffer()!==mV.buffer&&(mV.buffer=V.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((L=>{(0,w.f)((()=>this.dispatch(V,h,mV)),L,void 0,t)}))}serialize(){const V=T.e.Serialize(this);V.options=this._options,V.shaderPath=this._shaderPath,V.nq={},V.textures={};for(const h in this._bindings){const mV=this._bindings[h],t=mV.object;switch(mV.type){case 0:case 4:case 1:{const L=t.serialize();L&&(V.textures[h]=L,V.nq[h]={type:mV.type});break}}}return V}static Parse(V,h,mV){const t=T.e.Parse((()=>new E(V.name,h.getEngine(),V.shaderPath,V.options)),V,h,mV);for(const L in V.textures){const N=V.nq[L],A=F.d.Parse(V.textures[L],h,mV);0===N.type?t.setTexture(L,A):4===N.type?t.setTexture(L,A,!1):t.setStorageTexture(L,A)}return t}static _BufferIsDataBuffer(V){return void 0!==V.underlyingResource}}(0,I.e)([(0,r.J)()],E.prototype,"name",void 0),(0,I.e)([(0,r.J)()],E.prototype,"fastMode",void 0),(0,k.i)("BABYLON.ComputeShader",E);var g=mV(12665);const i="gpuUpdateParticlesComputeShader",b="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";H.b.ShadersStoreWGSL[i]||(H.b.ShadersStoreWGSL[i]=b);(0,k.i)("BABYLON.ComputeShaderParticleSystem",class{constructor(V,h){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=V,this._engine=h}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var V;return(null===(V=this._updateComputeShader)||void 0===V?void 0:V.isReady())??!1}createUpdateBuffer(V){var h;const mV={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(mV.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(mV.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(mV.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(mV.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(mV.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(mV.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(mV.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new E("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:mV,defines:V.split("\n")}),null===(h=this._simParamsComputeShader)||void 0===h||h.dispose(),this._simParamsComputeShader=new g.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new D(this._simParamsComputeShader)}createVertexBuffers(V,h){this._renderVertexBuffers.push(h)}createParticleBuffer(V){const h=new O(this._engine,4*V.length,11,"ComputeShaderParticleSystemBuffer");return h.update(V),this._bufferComputeShader.push(h),h.getBuffer()}bindDrawBuffers(V,h,mV){this._engine.bindBuffers(this._renderVertexBuffers[V],mV,h)}preUpdateParticleBuffer(){}updateParticleBuffer(V,h,mV){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[V]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^V]),this._updateComputeShader.dispatch(Math.ceil(mV/64))}releaseBuffers(){var V;for(let h=0;h<this._bufferComputeShader.length;++h)this._bufferComputeShader[h].dispose();this._bufferComputeShader.length=0,null===(V=this._simParamsComputeShader)||void 0===V||V.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class P{constructor(V,h,mV){this.gradient=V,this.color1=h,this.color2=mV}getColorToRef(V){this.color2?A.Gk.LerpToRef(this.color1,this.color2,Math.random(),V):V.t(this.color1)}}class U{constructor(V,h){this.gradient=V,this.color=h}}class u{constructor(V,h,mV){this.gradient=V,this.factor1=h,this.factor2=mV}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class e{static GetCurrentGradient(V,h,mV){if(h[0].gradient>V)return void mV(h[0],h[0],1);for(let L=0;L<h.length-1;L++){const t=h[L],N=h[L+1];if(V>=t.gradient&&V<=N.gradient){return void mV(t,N,(V-t.gradient)/(N.gradient-t.gradient))}}const t=h.length-1;mV(h[t],h[t],1)}}var W=mV(12258),X=mV(12860),a=mV(12300);class B{constructor(V){this.particleSystem=V,this.position=t.sh.Zero(),this.direction=t.sh.Zero(),this.color=new A.Gk(0,0,0,0),this.colorStep=new A.Gk(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new t.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new A.Gk(0,0,0,0),this._currentColor2=new A.Gk(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=B._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let V=this.age,h=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===h?(h=1,V=this._randomCellOffset):V+=this._randomCellOffset);const mV=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let t;t=this._initialSpriteCellLoop?(0,K.Clamp)(V*h%this.lifeTime/this.lifeTime):(0,K.Clamp)(V*h/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+t*mV|0}_inheritParticleInfoToSubEmitter(V){if(V.particleSystem.Lh.position){const h=V.particleSystem.Lh;if(h.position.t(this.position),V.inheritDirection){const V=t.TmpVectors.sh[0];this.direction.normalizeToRef(V),h.setDirection(V,0,Math.PI/2)}}else{V.particleSystem.Lh.t(this.position)}this.direction.scaleToRef(V.inheritedVelocityAmount/2,t.TmpVectors.sh[0]),V.particleSystem._inheritedVelocityOffset.t(t.TmpVectors.sh[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const V of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(V)}_reset(){this.age=0,this.id=B._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(V){V.position.t(this.position),this._initialDirection?V._initialDirection?V._initialDirection.t(this._initialDirection):V._initialDirection=this._initialDirection.clone():V._initialDirection=null,V.direction.t(this.direction),this.Xk&&(V.Xk?V.Xk.t(this.Xk):V.Xk=this.Xk.clone()),V.color.t(this.color),V.colorStep.t(this.colorStep),V.lifeTime=this.lifeTime,V.age=this.age,V._randomCellOffset=this._randomCellOffset,V.size=this.size,V.scale.t(this.scale),V.angle=this.angle,V.angularSpeed=this.angularSpeed,V.particleSystem=this.particleSystem,V.cellIndex=this.cellIndex,V.id=this.id,V._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(V._currentColorGradient=this._currentColorGradient,V._currentColor1.t(this._currentColor1),V._currentColor2.t(this._currentColor2)),this._currentSizeGradient&&(V._currentSizeGradient=this._currentSizeGradient,V._currentSize1=this._currentSize1,V._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(V._currentAngularSpeedGradient=this._currentAngularSpeedGradient,V._currentAngularSpeed1=this._currentAngularSpeed1,V._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(V._currentVelocityGradient=this._currentVelocityGradient,V._currentVelocity1=this._currentVelocity1,V._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(V._currentLimitVelocityGradient=this._currentLimitVelocityGradient,V._currentLimitVelocity1=this._currentLimitVelocity1,V._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(V._currentDragGradient=this._currentDragGradient,V._currentDrag1=this._currentDrag1,V._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(V._initialStartSpriteCellId=this._initialStartSpriteCellId,V._initialEndSpriteCellId=this._initialEndSpriteCellId,V._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(V.remapData&&this.remapData?V.remapData.t(this.remapData):V.remapData=new t.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.t(this._randomNoiseCoordinates1),V._randomNoiseCoordinates2.t(this._randomNoiseCoordinates2)):(V._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),V._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}B._Count=0;var VV=mV(12532),hV=(mV(12578),mV(12751)),mh=mV(12746),tV=mV(12663);function LV(V,h){const mV=(0,K.RandomRange)(0,1);A.Gk.LerpToRef(h.color1,h.color2,mV,V.color),h.colorDead.subtractToRef(V.color,h._colorDiff),h._colorDiff.scaleToRef(1/V.lifeTime,V.colorStep)}function NV(V,h){V._currentColorGradient=h._colorGradients[0],V._currentColorGradient.getColorToRef(V.color),V._currentColor1.t(V.color),h._colorGradients.length>1?h._colorGradients[1].getColorToRef(V._currentColor2):V._currentColor2.t(V.color)}function AV(V,h){const mV=h._colorGradients;e.GetCurrentGradient(h._ratio,mV,((h,mV,t)=>{h!==V._currentColorGradient&&(V._currentColor1.t(V._currentColor2),mV.getColorToRef(V._currentColor2),V._currentColorGradient=h),A.Gk.LerpToRef(V._currentColor1,V._currentColor2,t,V.color)}))}function kV(V,h){V.colorStep.scaleToRef(h._scaledUpdateSpeed,h._scaledColorStep),V.color.addInPlace(h._scaledColorStep),V.color.a<0&&(V.color.a=0)}function CV(V,h){e.GetCurrentGradient(h._ratio,h._angularSpeedGradients,((h,mV,t)=>{h!==V._currentAngularSpeedGradient&&(V._currentAngularSpeed1=V._currentAngularSpeed2,V._currentAngularSpeed2=mV.getFactor(),V._currentAngularSpeedGradient=h),V.angularSpeed=(0,K.Lerp)(V._currentAngularSpeed1,V._currentAngularSpeed2,t)}))}function KV(V,h){V.angle+=V.angularSpeed*h._scaledUpdateSpeed}function oV(V,h){h.particleEmitterType.startDirectionFunction(h._emitterWorldMatrix,V.direction,V,h.isLocal,h._emitterInverseWorldMatrix)}function nV(V,h){h.startDirectionFunction(h._emitterWorldMatrix,V.direction,V,h.isLocal)}function qV(V,h){V._currentVelocityGradient=h._velocityGradients[0],V._currentVelocity1=V._currentVelocityGradient.getFactor(),h._velocityGradients.length>1?V._currentVelocity2=h._velocityGradients[1].getFactor():V._currentVelocity2=V._currentVelocity1}function xV(V,h){V._currentLimitVelocityGradient=h._limitVelocityGradients[0],V._currentLimitVelocity1=V._currentLimitVelocityGradient.getFactor(),h._limitVelocityGradients.length>1?V._currentLimitVelocity2=h._limitVelocityGradients[1].getFactor():V._currentLimitVelocity2=V._currentLimitVelocity1}function RV(V,h){e.GetCurrentGradient(h._ratio,h._velocityGradients,((mV,t,L)=>{mV!==V._currentVelocityGradient&&(V._currentVelocity1=V._currentVelocity2,V._currentVelocity2=t.getFactor(),V._currentVelocityGradient=mV),h._directionScale*=(0,K.Lerp)(V._currentVelocity1,V._currentVelocity2,L)}))}function dV(V,h){e.GetCurrentGradient(h._ratio,h._limitVelocityGradients,((mV,t,L)=>{mV!==V._currentLimitVelocityGradient&&(V._currentLimitVelocity1=V._currentLimitVelocity2,V._currentLimitVelocity2=t.getFactor(),V._currentLimitVelocityGradient=mV);const N=(0,K.Lerp)(V._currentLimitVelocity1,V._currentLimitVelocity2,L);V.direction.length()>N&&V.direction.scaleInPlace(h.limitVelocityDamping)}))}function sV(V,h){V.direction.scaleToRef(h._directionScale,h._scaledDirection)}function MV(V,h){h.particleEmitterType.startPositionFunction(h._emitterWorldMatrix,V.position,V,h.isLocal)}function cV(V,h){h.startPositionFunction(h._emitterWorldMatrix,V.position,V,h.isLocal)}function zV(V,h){V.Xk?V.Xk.t(V.position):V.Xk=V.position.clone(),t.sh.TransformCoordinatesToRef(V.Xk,h._emitterWorldMatrix,V.position)}function QV(V,h){h.isLocal&&V.Xk?(V.Xk.addInPlace(h._scaledDirection),t.sh.TransformCoordinatesToRef(V.Xk,h._emitterWorldMatrix,V.position)):V.position.addInPlace(h._scaledDirection)}function JV(V,h){V._currentDragGradient=h._dragGradients[0],V._currentDrag1=V._currentDragGradient.getFactor(),h._dragGradients.length>1?V._currentDrag2=h._dragGradients[1].getFactor():V._currentDrag2=V._currentDrag1}function vV(V,h){e.GetCurrentGradient(h._ratio,h._dragGradients,((mV,t,L)=>{mV!==V._currentDragGradient&&(V._currentDrag1=V._currentDrag2,V._currentDrag2=t.getFactor(),V._currentDragGradient=mV);const N=(0,K.Lerp)(V._currentDrag1,V._currentDrag2,L);h._scaledDirection.scaleInPlace(1-N)}))}function DV(V,h){V._randomNoiseCoordinates1?(V._randomNoiseCoordinates1.Hk(Math.random(),Math.random(),Math.random()),V._randomNoiseCoordinates2.Hk(Math.random(),Math.random(),Math.random())):(V._randomNoiseCoordinates1=new t.sh(Math.random(),Math.random(),Math.random()),V._randomNoiseCoordinates2=new t.sh(Math.random(),Math.random(),Math.random()))}function HV(V,h){const mV=h._noiseTextureData,L=h._noiseTextureSize;if(mV&&L&&V._randomNoiseCoordinates1){const N=h._fetchR(V._randomNoiseCoordinates1.x,V._randomNoiseCoordinates1.y,L.width,L.height,mV),A=h._fetchR(V._randomNoiseCoordinates1.z,V._randomNoiseCoordinates2.x,L.width,L.height,mV),k=h._fetchR(V._randomNoiseCoordinates2.y,V._randomNoiseCoordinates2.z,L.width,L.height,mV),C=t.TmpVectors.sh[0],K=t.TmpVectors.sh[1];C.Hk((2*N-1)*h.noiseStrength.x,(2*A-1)*h.noiseStrength.y,(2*k-1)*h.noiseStrength.z),C.scaleToRef(h._tempScaledUpdateSpeed,K),V.direction.addInPlace(K)}}function jV(V,h){h.gravity.scaleToRef(h._tempScaledUpdateSpeed,h._scaledGravity),V.direction.addInPlace(h._scaledGravity)}function lV(V,h){V.size=(0,K.RandomRange)(h.minSize,h.maxSize),V.scale.Hk((0,K.RandomRange)(h.minScaleX,h.maxScaleX),(0,K.RandomRange)(h.minScaleY,h.maxScaleY))}function GV(V,h){V._currentSizeGradient=h._sizeGradients[0],V._currentSize1=V._currentSizeGradient.getFactor(),V.size=V._currentSize1,h._sizeGradients.length>1?V._currentSize2=h._sizeGradients[1].getFactor():V._currentSize2=V._currentSize1,V.scale.Hk((0,K.RandomRange)(h.minScaleX,h.maxScaleX),(0,K.RandomRange)(h.minScaleY,h.maxScaleY))}function yV(V,h){const mV=h._actualFrame/h.targetStopDuration;e.GetCurrentGradient(mV,h._startSizeGradients,((mV,t,L)=>{mV!==h._currentStartSizeGradient&&(h._currentStartSize1=h._currentStartSize2,h._currentStartSize2=t.getFactor(),h._currentStartSizeGradient=mV);const N=(0,K.Lerp)(h._currentStartSize1,h._currentStartSize2,L);V.scale.scaleInPlace(N)}))}function OV(V,h){e.GetCurrentGradient(h._ratio,h._sizeGradients,((h,mV,t)=>{h!==V._currentSizeGradient&&(V._currentSize1=V._currentSize2,V._currentSize2=mV.getFactor(),V._currentSizeGradient=h),V.size=(0,K.Lerp)(V._currentSize1,V._currentSize2,t)}))}function IV(V,h){V.remapData=new t.Vector4(0,1,0,1)}function rV(V,h){h._colorRemapGradients&&h._colorRemapGradients.length>0&&e.GetCurrentGradient(h._ratio,h._colorRemapGradients,((h,mV,t)=>{const L=(0,K.Lerp)(h.factor1,mV.factor1,t),N=(0,K.Lerp)(h.factor2,mV.factor2,t);V.remapData.x=L,V.remapData.y=N-L})),h._alphaRemapGradients&&h._alphaRemapGradients.length>0&&e.GetCurrentGradient(h._ratio,h._alphaRemapGradients,((h,mV,t)=>{const L=(0,K.Lerp)(h.factor1,mV.factor1,t),N=(0,K.Lerp)(h.factor2,mV.factor2,t);V.remapData.z=L,V.remapData.w=N-L}))}function TV(V,h){const mV=(0,K.Clamp)(h._actualFrame/h.targetStopDuration);e.GetCurrentGradient(mV,h._lifeTimeGradients,((h,t)=>{const L=h,N=t,A=L.getFactor(),k=N.getFactor(),C=(mV-L.gradient)/(N.gradient-L.gradient);V.lifeTime=(0,K.Lerp)(A,k,C)})),h._emitPower=(0,K.RandomRange)(h.minEmitPower,h.maxEmitPower)}function FV(V,h){V.lifeTime=(0,K.RandomRange)(h.minLifeTime,h.maxLifeTime),h._emitPower=(0,K.RandomRange)(h.minEmitPower,h.maxEmitPower)}function pV(V,h){0===h._emitPower?(V._initialDirection?V._initialDirection.t(V.direction):V._initialDirection=V.direction.clone(),V.direction.set(0,0,0)):(V._initialDirection=null,V.direction.scaleInPlace(h._emitPower)),V.direction.addInPlace(h._inheritedVelocityOffset)}function ZV(V,h){V.angularSpeed=(0,K.RandomRange)(h.minAngularSpeed,h.maxAngularSpeed),V.angle=(0,K.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function fV(V,h){V._currentAngularSpeedGradient=h._angularSpeedGradients[0],V.angularSpeed=V._currentAngularSpeedGradient.getFactor(),V._currentAngularSpeed1=V.angularSpeed,h._angularSpeedGradients.length>1?V._currentAngularSpeed2=h._angularSpeedGradients[1].getFactor():V._currentAngularSpeed2=V._currentAngularSpeed1,V.angle=(0,K.RandomRange)(h.minInitialRotation,h.maxInitialRotation)}function SV(V,h){V._initialStartSpriteCellId=h.startSpriteCellID,V._initialEndSpriteCellId=h.endSpriteCellID,V._initialSpriteCellLoop=h.spriteCellLoop}function YV(V,h){V.previousItem=h.previousItem,V.nextItem=h,h.previousItem&&(h.previousItem.nextItem=V),h.previousItem=V}function wV(V,h){V.previousItem=h,V.nextItem=h.nextItem,h.nextItem&&(h.nextItem.previousItem=V),h.nextItem=V}function EV(V,h){let mV=h;for(;mV.nextItem;)mV=mV.nextItem;V.previousItem=mV,V.nextItem=mV.nextItem,mV.nextItem=V}function gV(V){V.previousItem&&(V.previousItem.nextItem=V.nextItem),V.nextItem&&(V.nextItem.previousItem=V.previousItem)}class iV extends C{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(V){this._startDirectionFunction!==V&&(this._startDirectionFunction=V,this._directionProcessing.process=V?nV:oV)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(V){this._startPositionFunction!==V&&(this._startPositionFunction=V,this._positionCreation.process=V?cV:MV)}set onDispose(V){this._onDisposeObserver&&this.XL.remove(this._onDisposeObserver),this._onDisposeObserver=this.XL.add(V)}get A(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(V){this._useRampGradients!==V&&(this._useRampGradients=V,this._resetEffect(),V?(this._rampCreation={process:IV,previousItem:null,nextItem:null},wV(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:rV,previousItem:null,nextItem:null},wV(this._remapGradientProcessing,this._gravityProcessing)):(gV(this._rampCreation),gV(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(V){this._isLocal!==V&&(this._isLocal=V,V?(this._isLocalCreation={process:zV,previousItem:null,nextItem:null},wV(this._isLocalCreation,this._positionCreation)):gV(this._isLocalCreation))}get particles(){return this.Aq}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(V){this._animationSheetEnabled!==V&&(this._animationSheetEnabled=V,V?(this._sheetCreation={process:SV,previousItem:null,nextItem:null},wV(this._sheetCreation,this._colorCreation)):gV(this._sheetCreation),this._reset())}getActiveCount(){return this.Aq.length}getClassName(){return"lo"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var V;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[h])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new VV.e(this._engine),this._customWrappers[h].effect=V,this._customWrappers[h].drawContext&&(this._customWrappers[h].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new W.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(V){if(this.noiseTexture!==V){if(this._noiseTexture=V,!V)return gV(this._noiseCreation),void gV(this._noiseProcessing);this._noiseCreation={process:DV,previousItem:null,nextItem:null},wV(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:HV,previousItem:null,nextItem:null},wV(this._noiseProcessing,this._positionProcessing)}}constructor(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,C=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(V),this._emitterInverseWorldMatrix=t.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new t.sh,this.XL=new W.d,this.onStoppedObservable=new W.d,this.onStartedObservable=new W.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.Aq=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new A.Gk(0,0,0,0),this._colorDiff=new A.Gk(0,0,0,0),this._scaledDirection=t.sh.Zero(),this._scaledGravity=t.sh.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=V=>{},this.recycleParticle=V=>{const h=this.Aq.pop();h!==V&&h.copyTo(V),this._stockParticles.push(h)},this._createParticle=()=>{let V;return 0!==this._stockParticles.length?(V=this._stockParticles.pop(),V._reset()):V=new B(this),this._prepareParticle(V),V},this.paused=!1,this._shadersLoaded=!1,this._capacity=h,this._epsilon=k,mV&&"Scene"!==mV.getClassName()?(this._engine=mV,this.defaultProjectionMatrix=t.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=mV||a.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Lq.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:FV,previousItem:null,nextItem:null},this._positionCreation={process:MV,previousItem:null,nextItem:null},wV(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:oV,previousItem:null,nextItem:null},wV(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:pV,previousItem:null,nextItem:null},wV(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:lV,previousItem:null,nextItem:null},wV(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:ZV,previousItem:null,nextItem:null},wV(this._angleCreation,this._sizeCreation),this._colorCreation={process:LV,previousItem:null,nextItem:null},wV(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,C||(this._colorProcessing={process:kV,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:KV,previousItem:null,nextItem:null},wV(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:sV,previousItem:null,nextItem:null},wV(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:QV,previousItem:null,nextItem:null},wV(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:jV,previousItem:null,nextItem:null},wV(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=N,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new VV.e(this._engine)},this._customWrappers[0].effect=L,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new n,this.updateFunction=V=>{var h;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(h=this.noiseTexture.getContent())||void 0===h||h.then((V=>{this._noiseTextureData=V})));const mV=V===this.Aq;for(let t=0;t<V.length;t++){const h=V[t];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const L=h.age;if(h.age+=this._tempScaledUpdateSpeed,h.age>h.lifeTime){const V=h.age-L,mV=h.lifeTime-L;this._tempScaledUpdateSpeed=mV*this._tempScaledUpdateSpeed/V,h.age=h.lifeTime}this._ratio=h.age/h.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let N=this._updateQueueStart;for(;N;)N.process(h,this),N=N.nextItem;if(this._isAnimationSheetEnabled&&!C&&h.updateCellIndex(),h._inheritParticleInfoToSubEmitters(),h.age>=h.lifeTime){if(this._emitFromParticle(h),h._attachedSubEmitters){for(const V of h._attachedSubEmitters)V.particleSystem.disposeOnStop=!0,V.particleSystem.stop();h._attachedSubEmitters=null}this.recycleParticle(h),mV&&t--}else;}}}serialize(V){throw new Error("Method not implemented.")}clone(V,h){throw new Error("Method not implemented.")}_addFactorGradient(V,h,mV,t){const L=new u(h,mV,t);V.push(L),V.sort(((V,h)=>V.gradient<h.gradient?-1:V.gradient>h.gradient?1:0))}_removeFactorGradient(V,h){if(!V)return;let mV=0;for(const t of V){if(t.gradient===h){V.splice(mV,1);break}mV++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=TV:this._lifeTimeCreation.process=FV}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:yV,previousItem:null,nextItem:null},wV(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(gV(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(V){this.targetStopDuration!==V&&(this._targetStopDuration=V,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(V,h,mV){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,V,h,mV),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(V){return this._removeFactorGradient(this._lifeTimeGradients,V),this._syncLifeTimeCreation(),this}addSizeGradient(V,h,mV){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=GV,this._sizeGradientProcessing={process:OV,previousItem:null,nextItem:null},YV(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,V,h,mV),this}removeSizeGradient(V){var h;return this._removeFactorGradient(this._sizeGradients,V),0===(null===(h=this._sizeGradients)||void 0===h?void 0:h.length)&&(gV(this._sizeGradientProcessing),this._sizeCreation.process=lV),this}addColorRemapGradient(V,h,mV){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,V,h,mV),this}removeColorRemapGradient(V){return this._removeFactorGradient(this._colorRemapGradients,V),this}addAlphaRemapGradient(V,h,mV){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,V,h,mV),this}removeAlphaRemapGradient(V){return this._removeFactorGradient(this._alphaRemapGradients,V),this}addAngularSpeedGradient(V,h,mV){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=fV,this._angularSpeedGradientProcessing={process:CV,previousItem:null,nextItem:null},YV(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,V,h,mV),this}removeAngularSpeedGradient(V){var h;return this._removeFactorGradient(this._angularSpeedGradients,V),0===(null===(h=this._angularSpeedGradients)||void 0===h?void 0:h.length)&&(this._angleCreation.process=ZV,gV(this._angularSpeedGradientProcessing)),this}addVelocityGradient(V,h,mV){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:qV,previousItem:null,nextItem:null},wV(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:RV,previousItem:null,nextItem:null},YV(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,V,h,mV),this}removeVelocityGradient(V){var h;return this._removeFactorGradient(this._velocityGradients,V),0===(null===(h=this._velocityGradients)||void 0===h?void 0:h.length)&&(gV(this._velocityCreation),gV(this._velocityGradientProcessing)),this}addLimitVelocityGradient(V,h,mV){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:xV,previousItem:null,nextItem:null},wV(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:dV,previousItem:null,nextItem:null},wV(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,V,h,mV),this}removeLimitVelocityGradient(V){var h;return this._removeFactorGradient(this._limitVelocityGradients,V),0===(null===(h=this._limitVelocityGradients)||void 0===h?void 0:h.length)&&(gV(this._limitVelocityCreation),gV(this._limitVelocityGradientProcessing)),this}addDragGradient(V,h,mV){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:JV,previousItem:null,nextItem:null},YV(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:vV,previousItem:null,nextItem:null},YV(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,V,h,mV),this}removeDragGradient(V){var h;return this._removeFactorGradient(this._dragGradients,V),0===(null===(h=this._dragGradients)||void 0===h?void 0:h.length)&&(gV(this._dragCreation),gV(this._dragGradientProcessing)),this}addEmitRateGradient(V,h,mV){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,V,h,mV),this}removeEmitRateGradient(V){return this._removeFactorGradient(this._emitRateGradients,V),this}addStartSizeGradient(V,h,mV){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,V,h,mV),this._syncStartSizeCreation(),this}removeStartSizeGradient(V){return this._removeFactorGradient(this._startSizeGradients,V),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const V=new Uint8Array(4*this._rawTextureWidth),h=A.TmpColors.Jh[0];for(let mV=0;mV<this._rawTextureWidth;mV++){const t=mV/this._rawTextureWidth;e.GetCurrentGradient(t,this._rampGradients,((t,L,N)=>{A.Jh.LerpToRef(t.color,L.color,N,h),V[4*mV]=255*h.r,V[4*mV+1]=255*h.g,V[4*mV+2]=255*h.b,V[4*mV+3]=255}))}this._rampGradientsTexture=X.e.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((V,h)=>V.gradient<h.gradient?-1:V.gradient>h.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(V,h){this._rampGradients||(this._rampGradients=[]);const mV=new U(V,h);return this._rampGradients.push(mV),this._syncRampGradientTexture(),this}removeRampGradient(V){return this._removeGradientAndTexture(V,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(V,h,mV){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=NV,this._colorProcessing.process=AV);const t=new P(V,h,mV);return this._colorGradients.push(t),this._colorGradients.sort(((V,h)=>V.gradient<h.gradient?-1:V.gradient>h.gradient?1:0)),this}removeColorGradient(V){if(!this._colorGradients)return this;let h=0;for(const mV of this._colorGradients){if(mV.gradient===V){this._colorGradients.splice(h,1);break}h++}return 0===this._colorGradients.length&&(this._colorCreation.process=LV,this._colorProcessing.process=kV),this}resetDrawCache(){if(this._drawWrappers){for(const V of this._drawWrappers)if(V)for(const h of V)null===h||void 0===h||h.dispose();this._drawWrappers=[]}}_fetchR(V,h,mV,t,L){return L[4*(((V=.5*Math.abs(V)+.5)*mV%mV|0)+((h=.5*Math.abs(h)+.5)*t%t|0)*mV)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const V=this._engine,h=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*h),this._vertexBuffer=new J.e(V,this._vertexData,!0,h);let mV=0;const t=this._vertexBuffer.createVertexBuffer(J.i.PositionKind,mV,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.i.PositionKind]=t,mV+=3;const L=this._vertexBuffer.createVertexBuffer(J.i.ColorKind,mV,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[J.i.ColorKind]=L,mV+=4;const N=this._vertexBuffer.createVertexBuffer("angle",mV,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=N,mV+=1;const A=this._vertexBuffer.createVertexBuffer("size",mV,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=A,mV+=2,this._isAnimationSheetEnabled){const V=this._vertexBuffer.createVertexBuffer("cellIndex",mV,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=V,mV+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const V=this._vertexBuffer.createVertexBuffer("direction",mV,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=V,mV+=3}if(this._useRampGradients){const V=this._vertexBuffer.createVertexBuffer("remapData",mV,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=V,mV+=4}let k;if(this._useInstancing){const h=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new J.e(V,h,!1,2),k=this._spriteBuffer.createVertexBuffer("offset",0,2)}else k=this._vertexBuffer.createVertexBuffer("offset",mV,2,this._vertexBufferSize,this._useInstancing),mV+=2;this._vertexBuffers.offset=k,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const V=[],h=[];let mV=0;for(let t=0;t<this._capacity;t++)V.push(mV),V.push(mV+1),V.push(mV+2),V.push(mV),V.push(mV+2),V.push(mV+3),h.push(mV,mV+1,mV+1,mV+2,mV+2,mV+3,mV+3,mV,mV,mV+3),mV+=4;this._indexBuffer=this._engine.createIndexBuffer(V),this._linesIndexBuffer=this._engine.createIndexBuffer(h)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(V)setTimeout((()=>{this.start(0)}),V);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var h;-1!==(null===(h=this.Lh)||void 0===h?void 0:h.getClassName().indexOf("Mesh"))&&this.Lh.Qk(!0);const V=this.noiseTexture;if(V&&V.onGeneratedObservable)V.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let h=0;h<this.preWarmCycles;h++)this.animate(!0),V.render()}))}));else for(let h=0;h<this.preWarmCycles;h++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(V))}_postStop(V){}reset(){this._stockParticles.length=0,this.Aq.length=0}_appendParticleVertex(V,h,mV,L){let N=V*this._vertexBufferSize;if(this._vertexData[N++]=h.position.x+this.MK.x,this._vertexData[N++]=h.position.y+this.MK.y,this._vertexData[N++]=h.position.z+this.MK.z,this._vertexData[N++]=h.color.r,this._vertexData[N++]=h.color.g,this._vertexData[N++]=h.color.b,this._vertexData[N++]=h.color.a,this._vertexData[N++]=h.angle,this._vertexData[N++]=h.scale.x*h.size,this._vertexData[N++]=h.scale.y*h.size,this._isAnimationSheetEnabled&&(this._vertexData[N++]=h.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[N++]=h.direction.x,this._vertexData[N++]=h.direction.y,this._vertexData[N++]=h.direction.z);else if(h._initialDirection){let V=h._initialDirection;this.isLocal&&(t.sh.TransformNormalToRef(V,this._emitterWorldMatrix,t.TmpVectors.sh[0]),V=t.TmpVectors.sh[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[N++]=V.x,this._vertexData[N++]=V.y,this._vertexData[N++]=V.z}else{let V=h.direction;this.isLocal&&(t.sh.TransformNormalToRef(V,this._emitterWorldMatrix,t.TmpVectors.sh[0]),V=t.TmpVectors.sh[0]),0===V.x&&0===V.z&&(V.x=.001),this._vertexData[N++]=V.x,this._vertexData[N++]=V.y,this._vertexData[N++]=V.z}this._useRampGradients&&h.remapData&&(this._vertexData[N++]=h.remapData.x,this._vertexData[N++]=h.remapData.y,this._vertexData[N++]=h.remapData.z,this._vertexData[N++]=h.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===mV?mV=this._epsilon:1===mV&&(mV=1-this._epsilon),0===L?L=this._epsilon:1===L&&(L=1-this._epsilon)),this._vertexData[N++]=mV,this._vertexData[N++]=L)}_prepareParticle(V){}_createNewOnes(V){let h;for(let mV=0;mV<V&&this.Aq.length!==this._capacity;mV++){h=this._createParticle(),this.Aq.push(h);let V=this._createQueueStart;for(;V;)V.process(h,this),V=V.nextItem;h._inheritParticleInfoToSubEmitters()}}_update(V){if(this._alive=this.Aq.length>0,this.Lh.position){const V=this.Lh;this._emitterWorldMatrix=V.getWorldMatrix()}else{const V=this.Lh;this._emitterWorldMatrix=t.Matrix.Translation(V.x,V.y,V.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.Aq),this._createNewOnes(V)}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=[J.i.PositionKind,J.i.ColorKind,"angle","offset","size"];return V&&t.push("cellIndex"),h||t.push("direction"),mV&&t.push("remapData"),t}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,hV.e)(t),V&&t.push("particlesInfos"),h&&t.push("logarithmicDepthConstant"),mV&&(t.push("vFogInfos"),t.push("vFogColor")),t}fillDefines(V,h){let mV=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hV.k)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&V.push("#define FOG")),this._isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),h===C.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&V.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case 2:V.push("#define BILLBOARDY");break;case 8:case 9:V.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&V.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:V.push("#define BILLBOARDMODE_ALL")}mV&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,h,mV){h.push(...iV._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),V.push(...iV._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),mV.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,tV.h)(V,this._imageProcessingConfigurationDefines),(0,tV.e)(mV,this._imageProcessingConfigurationDefines))}_getWrapper(V){const h=this._getCustomDrawWrapper(V);if(null!==h&&void 0!==h&&h.effect)return h;const mV=[];this.fillDefines(mV,V);const t=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let L=this._drawWrappers[t];L||(L=this._drawWrappers[t]=[]);let N=L[V];N||(N=new VV.e(this._engine),N.drawContext&&(N.drawContext.useInstancing=this._useInstancing),L[V]=N);const A=mV.join("\n");if(N.defines!==A){const V=[],h=[],mV=[];this.fillUniformsAttributesAndSamplerNames(h,V,mV),N.setEffect(this._engine.createEffect("particles",V,h,mV,A,void 0,void 0,void 0,void 0,this._shaderLanguage),A)}return N}animate(){var V;let h,mV=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!mV&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(mV?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this.manualEmitCount>-1)h=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let V=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const h=this._actualFrame/this.targetStopDuration;e.GetCurrentGradient(h,this._emitRateGradients,((h,mV,t)=>{h!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=mV.getFactor(),this._currentEmitRateGradient=h),V=(0,K.Lerp)(this._currentEmitRate1,this._currentEmitRate2,t)}))}h=V*this._scaledUpdateSpeed|0,this._newPartsExcess+=V*this._scaledUpdateSpeed-h}if(this._newPartsExcess>1&&(h+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?h=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(h),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!mV){let V=0;for(let h=0;h<this.Aq.length;h++){const mV=this.Aq[h];this._appendParticleVertices(V,mV),V+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.Aq.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(V,h){this._appendParticleVertex(V++,h,0,0),this._useInstancing||(this._appendParticleVertex(V++,h,1,0),this._appendParticleVertex(V++,h,1,1),this._appendParticleVertex(V++,h,0,1))}rebuild(){var V;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(V=this._spriteBuffer)||void 0===V||V._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!iV.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(mV.bind(mV,13903)),Promise.resolve().then(mV.bind(mV,13846))])):await Promise.all([Promise.resolve().then(mV.bind(mV,13836)),Promise.resolve().then(mV.bind(mV,13825))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Lh||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==C.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(C.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(C.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(V){const h=this._getWrapper(V),mV=h.effect,L=this._engine;L.enableEffect(h);const N=this.defaultViewMatrix??this._scene.getViewMatrix();if(mV.setTexture("diffuseSampler",this.particleTexture),mV.setMatrix("view",N),mV.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();mV.setFloat3("particlesInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,this.spriteCellWidth/V.width)}if(mV.setVector2("translationPivot",this.translationPivot),mV.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;mV.setVector3("eyePosition",V.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),mV.setTexture("rampSampler",this._rampGradientsTexture));const A=mV.defines;var k,C,K,o,n,q;(this._scene&&((0,hV.h)(mV,this,this._scene),this.applyFog&&(0,mh.d)(this._scene,void 0,mV)),A.indexOf("#define BILLBOARDMODE_ALL")>=0&&(N.invertToRef(t.TmpVectors.Matrix[0]),mV.setMatrix("invView",t.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?L.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,mV):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,mV)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(C=this._scene)&&void 0!==C&&C.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?L.bindBuffers(this._vertexBuffers,null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?this._linesIndexBuffer:this._indexBuffer,mV):L.bindBuffers(this._vertexBuffers,null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?this._linesIndexBufferUseInstancing:null,mV);(this.useLogarithmicDepth&&this._scene&&(0,mh.g)(A,mV,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(mV),this._setEngineBasedOnBlendMode(V),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(mV),this._useInstancing)?null!==(n=this._scene)&&void 0!==n&&n.forceWireframe?L.drawElementsType(6,0,10,this.Aq.length):L.drawArraysType(7,0,4,this.Aq.length):null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?L.drawElementsType(1,0,10*this.Aq.length):L.drawElementsType(0,0,6*this.Aq.length);return this.Aq.length}render(){if(!this.isReady()||!this.Aq.length)return 0;const V=this._engine;V.setState&&(V.setState(!1),this.forceDepthWrite&&V.setDepthWrite(!0));let h=0;return h=this.blendMode===C.BLENDMODE_MULTIPLYADD?this._render(C.BLENDMODE_MULTIPLY)+this._render(C.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),h}_onDispose(){}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(h,mV),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const V=this._scene.Lq.indexOf(this);V>-1&&this._scene.Lq.splice(V,1),this._scene._activeParticleSystems.dispose()}this.XL.notifyObservers(this),this.XL.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}iV.ForceGLSL=!1;var bV,PV=mV(12288);!function(V){V[V.ATTACHED=0]="ATTACHED",V[V.END=1]="END"}(bV||(bV={}));class UV{constructor(V){if(this.particleSystem=V,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!V.Lh||!V.Lh.dispose){const h=(0,k.e)("BABYLON.AbstractMesh");V.Lh=new h("SubemitterSystemEmitter",V.DV()),V._disposeEmitterOnDispose=!0}}clone(){let V=this.particleSystem.Lh;if(V){if(V instanceof t.sh)V=V.clone();else if(-1!==V.getClassName().indexOf("Mesh")){V=new((0,k.e)("BABYLON.Mesh"))("",V.DV()),V.isVisible=!1}}else V=new t.sh;const h=new UV(this.particleSystem.clone(this.particleSystem.name,V));return h.particleSystem.name+="Clone",h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem._disposeEmitterOnDispose=!0,h.particleSystem.disposeOnStop=!0,h}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return h.type=this.type,h.inheritDirection=this.inheritDirection,h.inheritedVelocityAmount=this.inheritedVelocityAmount,h.particleSystem=this.particleSystem.serialize(V),h}static _ParseParticleSystem(V,h,mV){throw(0,PV.c)("ParseParticle")}static Parse(V,h,mV){const t=V.particleSystem,L=new UV(UV._ParseParticleSystem(t,h,mV,!0));return L.type=V.type,L.inheritDirection=V.inheritDirection,L.inheritedVelocityAmount=V.inheritedVelocityAmount,L.particleSystem._isSubEmitter=!0,L}dispose(){this.particleSystem.dispose()}}var uV=mV(12331);function eV(V,h){const mV=new M;return mV.direction1=V,mV.direction2=h,mV}function WV(){return new s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function XV(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function aV(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.sh(0,1,0),mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0);return new z(V,h,mV)}function BV(){return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Vh(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0),N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.sh(0,1,0);return new d(V,h,mV,L,N)}function hh(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new q(V,h)}function mm(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0),L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0);return new x(V,h,mV,L)}const th=t.sh.Zero(),Lh=t.sh.Zero(),Nh=t.sh.Zero();class Ah{constructor(){this.strength=0,this.position=t.sh.Zero()}_processParticle(V,h){this.position.subtractToRef(V.position,th);const mV=th.lengthSquared()+1;th.normalize().scaleToRef(this.strength/mV,Lh),Lh.scaleToRef(h._tempScaledUpdateSpeed,Nh),V.direction.addInPlace(Nh)}serialize(){return{position:this.position.sk(),strength:this.strength}}}class kh extends iV{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=V=>{if(!this._subEmitters||0===this._subEmitters.length)return;const h=Math.floor(Math.random()*this._subEmitters.length);for(const mV of this._subEmitters[h])if(1===mV.type){const h=mV.clone();V._inheritParticleInfoToSubEmitter(h),h.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(h.particleSystem),h.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(V,h){const mV=eV(V,h);return this.particleEmitterType=mV,mV}get flowMap(){return this._flowMap}set flowMap(V){this._flowMap!==V&&(this._flowMap=V,this._flowMapUpdate&&(gV(this._flowMapUpdate),this._flowMapUpdate=null),V&&(this._flowMapUpdate={process:V=>{var h;const mV=null===(h=this.DV())||void 0===h?void 0:h.getTransformMatrix();this._flowMap._processParticle(V,this.flowMapStrength*this._tempScaledUpdateSpeed,mV)},previousItem:null,nextItem:null},wV(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(V){this._attractors.push(V),1===this._attractors.length&&(this._attractorUpdate={process:V=>{for(const h of this._attractors)h._processParticle(V,this)},previousItem:null,nextItem:null},wV(this._attractorUpdate,this._directionProcessing))}removeAttractor(V){const h=this._attractors.indexOf(V);-1!==h&&this._attractors.splice(h,1),0===this._attractors.length&&gV(this._attractorUpdate)}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(V)}createHemisphericEmitter(){const V=WV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=XV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=aV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.sh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=BV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=Vh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.sh(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=mm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,h,mV,t){const L=new n;return this.particleEmitterType=L,this.direction1=V,this.direction2=h,this.minEmitBox=mV,this.maxEmitBox=t,L}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const V of this.subEmitters)V instanceof kh?this._subEmitters.push([new UV(V)]):V instanceof UV?this._subEmitters.push([V]):V instanceof Array&&this._subEmitters.push(V)}_stopSubEmitters(){if(this.activeSubSystems){for(const V of this.activeSubSystems)V.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const V=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==V&&this._rootParticleSystem.activeSubSystems.splice(V,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(V){V&&this._stopSubEmitters()}_prepareParticle(V){if(this._subEmitters&&this._subEmitters.length>0){const h=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];V._attachedSubEmitters=[];for(const mV of h)if(0===mV.type){const h=mV.clone();V._attachedSubEmitters.push(h),h.particleSystem.start()}}}_onDispose(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),V&&this.particles)for(const mV of this.particles)if(mV._attachedSubEmitters)for(let V=mV._attachedSubEmitters.length-1;V>=0;V-=1)mV._attachedSubEmitters[V].dispose();if(h&&this.activeSubSystems)for(let mV=this.activeSubSystems.length-1;mV>=0;mV-=1)this.activeSubSystems[mV].dispose();if(this._subEmitters&&this._subEmitters.length){for(let V=0;V<this._subEmitters.length;V++)for(const h of this._subEmitters[V])h.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Lh&&this.Lh.dispose&&this.Lh.dispose(!0)}static _Parse(V,h,mV,L){let N;N=mV instanceof uV.b?null:mV;const C=(0,k.e)("BABYLON.Texture");if(C&&N&&(V.texture?h.particleTexture=C.Parse(V.texture,N,L):V.textureName&&(h.particleTexture=new C(L+V.textureName,N,!1,void 0===V.invertY||V.invertY),h.particleTexture.name=V.textureName)),V.emitterId||0===V.emitterId||void 0!==V.Lh?V.emitterId&&N?h.Lh=N.getLastMeshById(V.emitterId):h.Lh=t.sh.Dh(V.Lh):h.Lh=t.sh.Zero(),h.isLocal=!!V.isLocal,void 0!==V.renderingGroupId&&(h.renderingGroupId=V.renderingGroupId),void 0!==V.isBillboardBased&&(h.isBillboardBased=V.isBillboardBased),void 0!==V.billboardMode&&(h.billboardMode=V.billboardMode),void 0!==V.useLogarithmicDepth&&(h.useLogarithmicDepth=V.useLogarithmicDepth),V.animations){for(let mV=0;mV<V.animations.length;mV++){const t=V.animations[mV],L=(0,k.e)("BABYLON.Animation");L&&h.animations.push(L.Parse(t))}h.beginAnimationOnStart=V.beginAnimationOnStart,h.beginAnimationFrom=V.beginAnimationFrom,h.beginAnimationTo=V.beginAnimationTo,h.beginAnimationLoop=V.beginAnimationLoop}if(V.autoAnimate&&N&&N.beginAnimation(h,V.autoAnimateFrom,V.autoAnimateTo,V.autoAnimateLoop,V.autoAnimateSpeed||1),h.startDelay=0|V.startDelay,h.minAngularSpeed=V.minAngularSpeed,h.maxAngularSpeed=V.maxAngularSpeed,h.minSize=V.minSize,h.maxSize=V.maxSize,V.minScaleX&&(h.minScaleX=V.minScaleX,h.maxScaleX=V.maxScaleX,h.minScaleY=V.minScaleY,h.maxScaleY=V.maxScaleY),void 0!==V.preWarmCycles&&(h.preWarmCycles=V.preWarmCycles,h.preWarmStepOffset=V.preWarmStepOffset),void 0!==V.minInitialRotation&&(h.minInitialRotation=V.minInitialRotation,h.maxInitialRotation=V.maxInitialRotation),h.minLifeTime=V.minLifeTime,h.maxLifeTime=V.maxLifeTime,h.minEmitPower=V.minEmitPower,h.maxEmitPower=V.maxEmitPower,h.emitRate=V.emitRate,h.gravity=t.sh.Dh(V.gravity),V.noiseStrength&&(h.noiseStrength=t.sh.Dh(V.noiseStrength)),h.color1=A.Gk.Dh(V.color1),h.color2=A.Gk.Dh(V.color2),h.colorDead=A.Gk.Dh(V.colorDead),h.updateSpeed=V.updateSpeed,h.targetStopDuration=V.targetStopDuration,h.blendMode=V.blendMode,V.colorGradients)for(const t of V.colorGradients)h.addColorGradient(t.gradient,A.Gk.Dh(t.color1),t.color2?A.Gk.Dh(t.color2):void 0);if(V.rampGradients){for(const mV of V.rampGradients)h.addRampGradient(mV.gradient,A.Jh.Dh(mV.color));h.useRampGradients=V.useRampGradients}if(V.colorRemapGradients)for(const t of V.colorRemapGradients)h.addColorRemapGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.alphaRemapGradients)for(const t of V.alphaRemapGradients)h.addAlphaRemapGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.sizeGradients)for(const t of V.sizeGradients)h.addSizeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.angularSpeedGradients)for(const t of V.angularSpeedGradients)h.addAngularSpeedGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.velocityGradients)for(const t of V.velocityGradients)h.addVelocityGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.dragGradients)for(const t of V.dragGradients)h.addDragGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.emitRateGradients)for(const t of V.emitRateGradients)h.addEmitRateGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.startSizeGradients)for(const t of V.startSizeGradients)h.addStartSizeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.lifeTimeGradients)for(const t of V.lifeTimeGradients)h.addLifeTimeGradient(t.gradient,void 0!==t.factor1?t.factor1:t.factor,t.factor2);if(V.limitVelocityGradients){for(const mV of V.limitVelocityGradients)h.addLimitVelocityGradient(mV.gradient,void 0!==mV.factor1?mV.factor1:mV.factor,mV.factor2);h.limitVelocityDamping=V.limitVelocityDamping}if(V.noiseTexture&&N){const mV=(0,k.e)("BABYLON.ProceduralTexture");h.noiseTexture=mV.Parse(V.noiseTexture,N,L)}let K;if(V.particleEmitterType){switch(V.particleEmitterType.type){case"SphereParticleEmitter":K=new c;break;case"SphereDirectedParticleEmitter":K=new z;break;case"ConeEmitter":case"ConeParticleEmitter":K=new q;break;case"ConeDirectedParticleEmitter":K=new x;break;case"CylinderParticleEmitter":K=new R;break;case"CylinderDirectedParticleEmitter":K=new d;break;case"HemisphericParticleEmitter":K=new s;break;case"PointParticleEmitter":K=new M;break;case"MeshParticleEmitter":K=new v;break;case"CustomParticleEmitter":K=new Q;break;default:K=new n}K.parse(V.particleEmitterType,N)}else K=new n,K.parse(V,N);h.particleEmitterType=K,h.startSpriteCellID=V.startSpriteCellID,h.endSpriteCellID=V.endSpriteCellID,h.spriteCellLoop=V.spriteCellLoop??!0,h.spriteCellWidth=V.spriteCellWidth,h.spriteCellHeight=V.spriteCellHeight,h.spriteCellChangeSpeed=V.spriteCellChangeSpeed,h.spriteRandomStartCell=V.spriteRandomStartCell,h.disposeOnStop=V.disposeOnStop??!1,h.manualEmitCount=V.manualEmitCount??-1}static Parse(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const k=V.name;let C,K,o=null,n=null;if(h instanceof uV.b?C=h:(K=h,C=K.getEngine()),V.customShader&&C.createEffectForParticles){n=V.customShader;const h=n.shaderOptions.defines.length>0?n.shaderOptions.defines.join("\n"):"";o=C.createEffectForParticles(n.shaderPath.fragmentElement,n.shaderOptions.uniforms,n.shaderOptions.samplers,h)}const q=new kh(k,N||V.jm,h,o,V.isAnimationSheetEnabled);if(q.customShader=n,q._rootUrl=mV,V.id&&(q.id=V.id),V.subEmitters){q.subEmitters=[];for(const t of V.subEmitters){const V=[];for(const L of t)V.push(UV.Parse(L,h,mV));q.subEmitters.push(V)}}if(V.attractors)for(const A of V.attractors){const V=new Ah;V.position=t.sh.Dh(A.position),V.strength=A.strength,q.addAttractor(V)}return kh._Parse(V,q,h,mV),V.textureMask&&(q.textureMask=A.Gk.Dh(V.textureMask)),V.MK&&(q.MK=t.sh.Dh(V.MK)),V.preventAutoStart&&(q.preventAutoStart=V.preventAutoStart),L||q.preventAutoStart||q.start(),q}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};if(kh._Serialize(h,this,V),h.textureMask=this.textureMask.sk(),h.customShader=this.customShader,h.preventAutoStart=this.preventAutoStart,h.MK=this.MK.sk(),this.subEmitters){h.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const mV of this._subEmitters){const t=[];for(const h of mV)t.push(h.serialize(V));h.subEmitters.push(t)}}if(this._attractors&&this._attractors.length){h.attractors=[];for(const V of this._attractors)h.attractors.push(V.serialize())}return h}static _Serialize(V,h,mV){if(V.name=h.name,V.id=h.id,V.jm=h.getCapacity(),V.disposeOnStop=h.disposeOnStop,V.manualEmitCount=h.manualEmitCount,h.Lh.position){const mV=h.Lh;V.emitterId=mV.id}else{const mV=h.Lh;V.Lh=mV.sk()}h.particleEmitterType&&(V.particleEmitterType=h.particleEmitterType.serialize()),h.particleTexture&&(mV?V.texture=h.particleTexture.serialize():(V.textureName=h.particleTexture.name,V.invertY=!!h.particleTexture._invertY)),V.isLocal=h.isLocal,T.e.AppendSerializedAnimations(h,V),V.beginAnimationOnStart=h.beginAnimationOnStart,V.beginAnimationFrom=h.beginAnimationFrom,V.beginAnimationTo=h.beginAnimationTo,V.beginAnimationLoop=h.beginAnimationLoop,V.startDelay=h.startDelay,V.renderingGroupId=h.renderingGroupId,V.isBillboardBased=h.isBillboardBased,V.billboardMode=h.billboardMode,V.minAngularSpeed=h.minAngularSpeed,V.maxAngularSpeed=h.maxAngularSpeed,V.minSize=h.minSize,V.maxSize=h.maxSize,V.minScaleX=h.minScaleX,V.maxScaleX=h.maxScaleX,V.minScaleY=h.minScaleY,V.maxScaleY=h.maxScaleY,V.minEmitPower=h.minEmitPower,V.maxEmitPower=h.maxEmitPower,V.minLifeTime=h.minLifeTime,V.maxLifeTime=h.maxLifeTime,V.emitRate=h.emitRate,V.gravity=h.gravity.sk(),V.noiseStrength=h.noiseStrength.sk(),V.color1=h.color1.sk(),V.color2=h.color2.sk(),V.colorDead=h.colorDead.sk(),V.updateSpeed=h.updateSpeed,V.targetStopDuration=h.targetStopDuration,V.blendMode=h.blendMode,V.preWarmCycles=h.preWarmCycles,V.preWarmStepOffset=h.preWarmStepOffset,V.minInitialRotation=h.minInitialRotation,V.maxInitialRotation=h.maxInitialRotation,V.startSpriteCellID=h.startSpriteCellID,V.spriteCellLoop=h.spriteCellLoop,V.endSpriteCellID=h.endSpriteCellID,V.spriteCellChangeSpeed=h.spriteCellChangeSpeed,V.spriteCellWidth=h.spriteCellWidth,V.spriteCellHeight=h.spriteCellHeight,V.spriteRandomStartCell=h.spriteRandomStartCell,V.isAnimationSheetEnabled=h.isAnimationSheetEnabled,V.useLogarithmicDepth=h.useLogarithmicDepth;const t=h.getColorGradients();if(t){V.colorGradients=[];for(const h of t){const mV={gradient:h.gradient,color1:h.color1.sk()};h.color2?mV.color2=h.color2.sk():mV.color2=h.color1.sk(),V.colorGradients.push(mV)}}const L=h.getRampGradients();if(L){V.rampGradients=[];for(const h of L){const mV={gradient:h.gradient,color:h.color.sk()};V.rampGradients.push(mV)}V.useRampGradients=h.useRampGradients}const N=h.getColorRemapGradients();if(N){V.colorRemapGradients=[];for(const h of N){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.colorRemapGradients.push(mV)}}const A=h.getAlphaRemapGradients();if(A){V.alphaRemapGradients=[];for(const h of A){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.alphaRemapGradients.push(mV)}}const k=h.getSizeGradients();if(k){V.sizeGradients=[];for(const h of k){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.sizeGradients.push(mV)}}const C=h.getAngularSpeedGradients();if(C){V.angularSpeedGradients=[];for(const h of C){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.angularSpeedGradients.push(mV)}}const K=h.getVelocityGradients();if(K){V.velocityGradients=[];for(const h of K){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.velocityGradients.push(mV)}}const o=h.getDragGradients();if(o){V.dragGradients=[];for(const h of o){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.dragGradients.push(mV)}}const n=h.getEmitRateGradients();if(n){V.emitRateGradients=[];for(const h of n){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.emitRateGradients.push(mV)}}const q=h.getStartSizeGradients();if(q){V.startSizeGradients=[];for(const h of q){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.startSizeGradients.push(mV)}}const x=h.getLifeTimeGradients();if(x){V.lifeTimeGradients=[];for(const h of x){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.lifeTimeGradients.push(mV)}}const R=h.getLimitVelocityGradients();if(R){V.limitVelocityGradients=[];for(const h of R){const mV={gradient:h.gradient,factor1:h.factor1};void 0!==h.factor2?mV.factor2=h.factor2:mV.factor2=h.factor1,V.limitVelocityGradients.push(mV)}V.limitVelocityDamping=h.limitVelocityDamping}h.noiseTexture&&(V.noiseTexture=h.noiseTexture.serialize())}clone(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t={...this._customWrappers};let L=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){L=this.customShader;const V=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"",h=N.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,V);t[0]?t[0].effect=h:this.setCustomEffect(h,0)}const A=this.serialize(mV),k=kh.Parse(A,this._scene||this._engine,this._rootUrl);return k.name=V,k.customShader=L,k._customWrappers=t,void 0===h&&(h=this.Lh),this.noiseTexture&&(k.noiseTexture=this.noiseTexture.clone()),k.Lh=h,this.preventAutoStart||k.start(),k}}kh.BILLBOARDMODE_Y=2,kh.BILLBOARDMODE_ALL=7,kh.BILLBOARDMODE_STRETCHED=8,kh.BILLBOARDMODE_STRETCHED_LOCAL=9,UV._ParseParticleSystem=kh.Parse;var Ch=mV(12654),Kh=mV(12648),oh=mV(12544);oh.c.prototype.createTransformFeedback=function(){const V=this._gl.createTransformFeedback();if(!V)throw new Error("Unable to create Transform Feedback");return V},oh.c.prototype.deleteTransformFeedback=function(V){this._gl.deleteTransformFeedback(V)},oh.c.prototype.bindTransformFeedback=function(V){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,V)},oh.c.prototype.beginTransformFeedback=function(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(V?this._gl.POINTS:this._gl.TRIANGLES)},oh.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},oh.c.prototype.setTranformFeedbackVaryings=function(V,h){this._gl.transformFeedbackVaryings(V,h,this._gl.INTERLEAVED_ATTRIBS)},oh.c.prototype.bindTransformFeedbackBuffer=function(V){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V?V.underlyingResource:null)},oh.c.prototype.readTransformFeedbackBuffer=function(V){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,V)};const nh="clipPlaneFragmentDeclaration2",qh="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";H.b.IncludesShadersStore[nh]||(H.b.IncludesShadersStore[nh]=qh);mV(13721),mV(13729),mV(13732),mV(13735),mV(13742),mV(13751),mV(13754),mV(13759);const xh="gpuRenderParticlesPixelShader",Rh="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";H.b.ShadersStore[xh]||(H.b.ShadersStore[xh]=Rh);const dh="clipPlaneVertexDeclaration2",sh="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";H.b.IncludesShadersStore[dh]||(H.b.IncludesShadersStore[dh]=sh);mV(13767),mV(13772),mV(13780),mV(13784);const Mh="gpuRenderParticlesVertexShader",ch="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";H.b.ShadersStore[Mh]||(H.b.ShadersStore[Mh]=ch);class zh extends C{static get IsSupported(){if(!a.b.LastCreatedEngine)return!1;const V=a.b.LastCreatedEngine.getCaps();return V.supportTransformFeedbacks||V.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(V){this._maxActiveParticleCount=Math.min(V,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(V){this.maxActiveParticleCount=V}createPointEmitter(V,h){const mV=eV(V,h);return this.particleEmitterType=mV,mV}createHemisphericEmitter(){const V=WV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createSphereEmitter(){const V=XV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=V,V}createDirectedSphereEmitter(){const V=aV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t.sh(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0));return this.particleEmitterType=V,V}createCylinderEmitter(){const V=BV(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=V,V}createDirectedCylinderEmitter(){const V=Vh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new t.sh(0,1,0));return this.particleEmitterType=V,V}createConeEmitter(){const V=hh(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=V,V}createDirectedConeEmitter(){const V=mm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t.sh(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new t.sh(0,1,0));return this.particleEmitterType=V,V}createBoxEmitter(V,h,mV,t){const L=new n;return this.particleEmitterType=L,this.direction1=V,this.direction2=h,this.minEmitBox=mV,this.maxEmitBox=t,L}get flowMap(){return this._flowMap}set flowMap(V){this._flowMap!==V&&(this._flowMap=V)}isReady(){if(!this.Lh||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==kh.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(kh.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(kh.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";V?setTimeout((()=>{this.start(0)}),V):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var V;let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(V=this._customWrappers[h])||void 0===V?void 0:V.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[V]??this._customWrappers[0]}setCustomEffect(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[h]=new VV.e(this._engine),this._customWrappers[h].effect=V}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new W.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(V,h,mV){return super._removeGradientAndTexture(V,h,mV),this._releaseBuffers(),this}addColorGradient(V,h){this._colorGradients||(this._colorGradients=[]);const mV=new P(V,h);return this._colorGradients.push(mV),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(V&&this._colorGradients.sort(((V,h)=>V.gradient<h.gradient?-1:V.gradient>h.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(V){return this._removeGradientAndTexture(V,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const h in this._drawWrappers){var V;null===(V=this._drawWrappers[h].drawContext)||void 0===V||V.reset()}}_addFactorGradient(V,h,mV){const t=new u(h,mV);V.push(t),this._releaseBuffers()}addSizeGradient(V,h){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,V,h),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(V){return this._removeGradientAndTexture(V,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(V,h){if(!V)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&V.sort(((V,h)=>V.gradient<h.gradient?-1:V.gradient>h.gradient?1:0));const mV=this;mV[h]&&(mV[h].dispose(),mV[h]=null)}addAngularSpeedGradient(V,h){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,V,h),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(V){return this._removeGradientAndTexture(V,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(V,h){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,V,h),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(V){return this._removeGradientAndTexture(V,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(V,h){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,V,h),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(V){return this._removeGradientAndTexture(V,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(V,h){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,V,h),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(V){return this._removeGradientAndTexture(V,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(V){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(V),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.XL=new W.d,this.onStoppedObservable=new W.d,this.onStartedObservable=new W.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,mV&&"Scene"!==mV.getClassName()?(this._engine=mV,this.defaultProjectionMatrix=t.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=mV||a.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Lq.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,k.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,k.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,k.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,k.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new VV.e(this._engine)},this._customWrappers[0].effect=L,this._drawWrappers={0:new VV.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(h=h??{}).randomTextureSize||delete h.randomTextureSize;const A={jm:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...h},C=h;isFinite(C)&&(A.jm=C),this._capacity=A.jm,this._maxActiveParticleCount=A.jm,this._currentActiveCount=0,this._isAnimationSheetEnabled=N,this.particleEmitterType=new n;const K=Math.min(this._engine.getCaps().maxTextureSize,A.randomTextureSize);let o=[];for(let t=0;t<K;++t)o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random());this._randomTexture=new X.e(new Float32Array(o),K,1,5,mV,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,o=[];for(let t=0;t<K;++t)o.push(Math.random()),o.push(Math.random()),o.push(Math.random()),o.push(Math.random());this._randomTexture2=new X.e(new Float32Array(o),K,1,5,mV,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=K}_reset(){this._releaseBuffers()}_createVertexBuffers(V,h,mV){const t={};t.position=h.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let L=3;t.age=h.createVertexBuffer("age",L,1,this._attributesStrideSize,!0),L+=1,t.size=h.createVertexBuffer("size",L,3,this._attributesStrideSize,!0),L+=3,t.life=h.createVertexBuffer("life",L,1,this._attributesStrideSize,!0),L+=1,L+=4,this.billboardMode===kh.BILLBOARDMODE_STRETCHED&&(t.direction=h.createVertexBuffer("direction",L,3,this._attributesStrideSize,!0)),L+=3,this._platform.alignDataInBuffer&&(L+=1),this.particleEmitterType instanceof Q&&(L+=3,this._platform.alignDataInBuffer&&(L+=1)),this._colorGradientsTexture||(t.color=h.createVertexBuffer("color",L,4,this._attributesStrideSize,!0),L+=4),this._isBillboardBased||(t.initialDirection=h.createVertexBuffer("initialDirection",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1)),this.noiseTexture&&(t.noiseCoordinates1=h.createVertexBuffer("noiseCoordinates1",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1),t.noiseCoordinates2=h.createVertexBuffer("noiseCoordinates2",L,3,this._attributesStrideSize,!0),L+=3,this._platform.alignDataInBuffer&&(L+=1)),t.angle=h.createVertexBuffer("angle",L,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?L++:L+=2,this._isAnimationSheetEnabled&&(t.cellIndex=h.createVertexBuffer("cellIndex",L,1,this._attributesStrideSize,!0),L+=1,this.spriteRandomStartCell&&(t.cellStartOffset=h.createVertexBuffer("cellStartOffset",L,1,this._attributesStrideSize,!0),L+=1)),t.offset=mV.createVertexBuffer("offset",0,2),t.uv=mV.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(t),this._platform.createVertexBuffers(V,t),this.resetDrawCache()}_initialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!V)return;const h=this._engine,mV=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const L=this.particleEmitterType instanceof Q,N=t.TmpVectors.sh[0];let A=0;for(let t=0;t<this._capacity;t++)if(mV.push(0),mV.push(0),mV.push(0),mV.push(0),mV.push(0),mV.push(0),mV.push(0),mV.push(0),mV.push(Math.random()),mV.push(Math.random()),mV.push(Math.random()),mV.push(Math.random()),L?(this.particleEmitterType.particleDestinationGenerator(t,null,N),mV.push(N.x),mV.push(N.y),mV.push(N.z)):(mV.push(0),mV.push(0),mV.push(0)),this._platform.alignDataInBuffer&&mV.push(0),A+=16,L&&(this.particleEmitterType.particlePositionGenerator(t,null,N),mV.push(N.x),mV.push(N.y),mV.push(N.z),this._platform.alignDataInBuffer&&mV.push(0),A+=4),this._colorGradientsTexture||(mV.push(0),mV.push(0),mV.push(0),mV.push(0),A+=4),this.isBillboardBased||(mV.push(0),mV.push(0),mV.push(0),this._platform.alignDataInBuffer&&mV.push(0),A+=4),this.noiseTexture&&(mV.push(Math.random()),mV.push(Math.random()),mV.push(Math.random()),this._platform.alignDataInBuffer&&mV.push(0),mV.push(Math.random()),mV.push(Math.random()),mV.push(Math.random()),this._platform.alignDataInBuffer&&mV.push(0),A+=8),mV.push(0),A+=1,this._angularSpeedGradientsTexture||(mV.push(0),A+=1),this._isAnimationSheetEnabled&&(mV.push(0),A+=1,this.spriteRandomStartCell&&(mV.push(0),A+=1)),this._platform.alignDataInBuffer){let V=3-(A+3&3);for(A+=V;V-- >0;)mV.push(0)}const k=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),C=this._platform.createParticleBuffer(mV),K=this._platform.createParticleBuffer(mV);this._buffer0=new J.e(h,C,!1,this._attributesStrideSize),this._buffer1=new J.e(h,K,!1,this._attributesStrideSize),this._spriteBuffer=new J.e(h,k,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let V=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(V+="\n#define BILLBOARD"),this._colorGradientsTexture&&(V+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(V+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(V+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(V+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(V+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(V+="\n#define DRAGGRADIENTS"),this._flowMap&&(V+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(V+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(V+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(V+="\n#define NOISE"),this.isLocal&&(V+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===V||(this._cachedUpdateDefines=V,this._updateBuffer=this._platform.createUpdateBuffer(V)),this._platform.isUpdateBufferReady()}_getWrapper(V){const h=this._getCustomDrawWrapper(V);if(null!==h&&void 0!==h&&h.effect)return h;const mV=[];this.fillDefines(mV,V);let t=this._drawWrappers[V];t||(t=new VV.e(this._engine),t.drawContext&&(t.drawContext.useInstancing=!0),this._drawWrappers[V]=t);const L=mV.join("\n");if(t.defines!==L){const V=[],h=[],mV=[];this.fillUniformsAttributesAndSamplerNames(h,V,mV),t.setEffect(this._engine.createEffect("gpuRenderParticles",V,h,mV,L),L)}return t}static _GetAttributeNamesOrOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const L=[J.i.PositionKind,"age","life","size","angle"];return V||L.push(J.i.ColorKind),h&&L.push("cellIndex"),mV||L.push("initialDirection"),t&&L.push("direction"),L.push("offset",J.i.UVKind),L}static _GetEffectCreationOptions(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0],h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t=["emitterWM","MK","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,hV.e)(t),V&&t.push("sheetInfos"),h&&t.push("logarithmicDepthConstant"),mV&&(t.push("vFogInfos"),t.push("vFogColor")),t}fillDefines(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,hV.k)(this,this._scene,V),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Kh.d.FOGMODE_NONE&&V.push("#define FOG")),h===kh.BLENDMODE_MULTIPLY&&V.push("#define BLENDMULTIPLYMODE"),this.isLocal&&V.push("#define LOCAL"),this.useLogarithmicDepth&&V.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(V.push("#define BILLBOARD"),this.billboardMode){case kh.BILLBOARDMODE_Y:V.push("#define BILLBOARDY");break;case kh.BILLBOARDMODE_STRETCHED:V.push("#define BILLBOARDSTRETCHED");break;case kh.BILLBOARDMODE_ALL:V.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&V.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&V.push("#define ANIMATESHEET"),mV&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),V.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(V,h,mV){h.push(...zh._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===kh.BILLBOARDMODE_STRETCHED)),V.push(...zh._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),mV.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Ch.b.PrepareUniforms(V,this._imageProcessingConfigurationDefines),Ch.b.PrepareSamplers(mV,this._imageProcessingConfigurationDefines))}animate(){var V;let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(h?this.preWarmStepOffset:(null===(V=this._scene)||void 0===V?void 0:V.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(V,h){const mV=this[h];if(!V||!V.length||mV)return;const t=new Float32Array(this._rawTextureWidth);for(let L=0;L<this._rawTextureWidth;L++){const h=L/this._rawTextureWidth;e.GetCurrentGradient(h,V,((V,h,mV)=>{t[L]=(0,K.Lerp)(V.factor1,h.factor1,mV)}))}this[h]=X.e.CreateRTexture(t,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[h].name=h.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const V=new Uint8Array(4*this._rawTextureWidth),h=A.TmpColors.Gk[0];for(let mV=0;mV<this._rawTextureWidth;mV++){const t=mV/this._rawTextureWidth;e.GetCurrentGradient(t,this._colorGradients,((t,L,N)=>{A.Gk.LerpToRef(t.color1,L.color1,N,h),V[4*mV]=255*h.r,V[4*mV+1]=255*h.g,V[4*mV+2]=255*h.b,V[4*mV+3]=255*h.a}))}this._colorGradientsTexture=X.e.CreateRGBATexture(V,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(V,h){var mV,L,N,A;const k=this._getWrapper(V),C=k.effect;this._engine.enableEffect(k);const K=(null===(mV=this._scene)||void 0===mV?void 0:mV.getViewMatrix())||t.Matrix.IdentityReadOnly;if(C.setMatrix("view",K),C.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),C.setTexture("diffuseSampler",this.particleTexture),C.setVector2("translationPivot",this.translationPivot),C.setVector3("MK",this.MK),this.isLocal&&C.setMatrix("emitterWM",h),this._colorGradientsTexture?C.setTexture("colorGradientSampler",this._colorGradientsTexture):C.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const V=this.particleTexture.getBaseSize();C.setFloat3("sheetInfos",this.spriteCellWidth/V.width,this.spriteCellHeight/V.height,V.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const V=this._scene.activeCamera;C.setVector3("eyePosition",V.globalPosition)}const o=C.defines;if(this._scene&&((0,hV.h)(C,this,this._scene),this.applyFog&&(0,mh.d)(this._scene,void 0,C)),o.indexOf("#define BILLBOARDMODE_ALL")>=0){const V=K.clone();V.invert(),C.setMatrix("invView",V)}return this.useLogarithmicDepth&&this._scene&&(0,mh.g)(o,C,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(C),this._setEngineBasedOnBlendMode(V),this._platform.bindDrawBuffers(this._targetIndex,C,null!==(L=this._scene)&&void 0!==L&&L.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(C),null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(A=this._scene)&&void 0!==A&&A.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(V){if(!this.Lh||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!V)if(this.Lh.position){V=this.Lh.getWorldMatrix()}else{const h=this.Lh;V=t.TmpVectors.Matrix[0],t.Matrix.TranslationToRef(h.x,h.y,h.z,V)}const h=this._engine,mV=h.getDepthWrite();if(h.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const V=this.DV();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",V.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",V),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const L=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=L,h.setDepthWrite(mV)}render(){let V,h=arguments.length>0&&void 0!==arguments[0]&&arguments[0],mV=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!h&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let V=0;V<this.preWarmCycles;V++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const V=0|this._accumulatedCount;this._accumulatedCount-=V,this._currentActiveCount+=V}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Lh.position){V=this.Lh.getWorldMatrix()}else{const h=this.Lh;V=t.TmpVectors.Matrix[0],t.Matrix.TranslationToRef(h.x,h.y,h.z,V)}const L=this._engine;this.updateInAnimate||this._update(V);let N=0;return h||mV||(L.setState(!1),this.forceDepthWrite&&L.setDepthWrite(!0),N=this.blendMode===kh.BLENDMODE_MULTIPLYADD?this._render(kh.BLENDMODE_MULTIPLY,V)+this._render(kh.BLENDMODE_ADD,V):this._render(this.blendMode,V),this._engine.setAlphaMode(0)),N}rebuild(){const V=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(V,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,V()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const h in this._drawWrappers){this._drawWrappers[h].dispose()}if(this._drawWrappers={},this._scene){const V=this._scene.Lq.indexOf(this);V>-1&&this._scene.Lq.splice(V,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let h=0;h<this._renderVertexBuffers.length;++h){const V=this._renderVertexBuffers[h];for(const h in V)V[h].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),V&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),V&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.XL.notifyObservers(this),this.XL.clear()}clone(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const t={...this._customWrappers};let L=null;const N=this._engine;if(N.createEffectForParticles&&null!=this.customShader){L=this.customShader;const V=L.shaderOptions.defines.length>0?L.shaderOptions.defines.join("\n"):"";t[0]=N.createEffectForParticles(L.shaderPath.fragmentElement,L.shaderOptions.uniforms,L.shaderOptions.samplers,V,void 0,void 0,void 0,this)}const A=this.serialize(mV),k=zh.Parse(A,this._scene||this._engine,this._rootUrl);return k.name=V,k.customShader=L,k._customWrappers=t,void 0===h&&(h=this.Lh),this.noiseTexture&&(k.noiseTexture=this.noiseTexture.clone()),k.Lh=h,k}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={};return kh._Serialize(h,this,V),h.activeParticleCount=this.activeParticleCount,h.randomTextureSize=this._randomTextureSize,h.customShader=this.customShader,h}static Parse(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4?arguments[4]:void 0;const N=V.name;let A,k;h instanceof uV.b?A=h:(k=h,A=k.getEngine());const C=new zh(N,{jm:L||V.jm,randomTextureSize:V.randomTextureSize},h,null,V.isAnimationSheetEnabled);if(C._rootUrl=mV,V.customShader&&A.createEffectForParticles){const h=V.customShader,mV=h.shaderOptions.defines.length>0?h.shaderOptions.defines.join("\n"):"",t=A.createEffectForParticles(h.shaderPath.fragmentElement,h.shaderOptions.uniforms,h.shaderOptions.samplers,mV,void 0,void 0,void 0,C);C.setCustomEffect(t,0),C.customShader=h}return V.id&&(C.id=V.id),V.activeParticleCount&&(C.activeParticleCount=V.activeParticleCount),kh._Parse(V,C,h,mV),V.preventAutoStart&&(C.preventAutoStart=V.preventAutoStart),t||C.preventAutoStart||C.start(),C}}var Qh=mV(12253),Jh=mV(13787),vh=mV(12754);class Dh{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(V){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const h of this.systems)h.Lh=V;this._emitterNode=V}setEmitterAsSphere(V,h,mV){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:V,renderingGroupId:h};const t=(0,Jh.d)("emitterSphere",{diameter:V.diameter,segments:V.segments},mV);t.renderingGroupId=h;const L=new vh.Qh("emitterSphereMaterial",mV);L.emissiveColor=V.color,t.material=L;for(const N of this.systems)N.Lh=t;this._emitterNode=t}start(V){for(const h of this.systems)V&&(h.Lh=V),h.start()}dispose(){for(const V of this.systems)V.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h={systems:[]};for(const mV of this.systems)h.systems.push(mV.serialize(V));return this._emitterNode&&(h.Lh=this._emitterCreationOptions),h}static Parse(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;const L=new Dh,N=this.BaseAssetsUrl+"/textures/";h=h||a.b.LastCreatedScene;for(const A of V.systems)L.systems.push(mV?zh.Parse(A,h,N,!0,t):kh.Parse(A,h,N,!0,t));if(V.Lh){const mV=V.Lh.options;if("Sphere"===V.Lh.kind)L.setEmitterAsSphere({diameter:mV.diameter,segments:mV.segments,color:A.Jh.Dh(mV.color)},V.Lh.renderingGroupId,h)}return L}}Dh.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Hh=mV(12292);class jh{static CreateDefault(V){let h,mV=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,t=arguments.length>2?arguments[2]:void 0;h=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new zh("default system",{jm:mV},t):new kh("default system",mV,t),h.Lh=V;const L=Qh.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return h.particleTexture=new F.d(L,h.DV()),h.createConeEmitter(.1,Math.PI/4),h.color1=new A.Gk(1,1,1,1),h.color2=new A.Gk(1,1,1,1),h.colorDead=new A.Gk(1,1,1,0),h.minSize=.1,h.maxSize=.1,h.minEmitPower=2,h.maxEmitPower=2,h.updateSpeed=1/60,h.emitRate=30,h}static CreateAsync(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;h||(h=a.b.LastCreatedScene);const L={};return h.addPendingData(L),new Promise(((N,A)=>{if(mV&&!zh.IsSupported)return h.removePendingData(L),A("Particle system with GPU is not supported.");Qh.Tools.LoadFile(`${jh.BaseAssetsUrl}/systems/${V}.json`,(V=>{h.removePendingData(L);const A=JSON.parse(V.toString());return N(Dh.Parse(A,h,mV,t))}),void 0,void 0,void 0,(()=>(h.removePendingData(L),A(`An error occurred with the creation of your particle system. Check if your type '${V}' exists.`))))}))}static ExportSet(V){const h=new Dh;for(const mV of V)h.systems.push(mV);return h}static ParseFromFileAsync(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",N=arguments.length>5?arguments[5]:void 0;return new Promise(((A,k)=>{const C=new Hh.e;C.addEventListener("readystatechange",(()=>{if(4==C.readyState)if(200==C.status){const h=JSON.parse(C.responseText);let k;k=t?zh.Parse(h,mV,L,!1,N):kh.Parse(h,mV,L,!1,N),V&&(k.name=V),A(k)}else k("Unable to load the particle system")})),C.open("GET",h),C.send()}))}static ParseFromSnippetAsync(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",L=arguments.length>4?arguments[4]:void 0;if("_BLANK"===V){const V=this.CreateDefault(null);return V.start(),Promise.resolve(V)}return new Promise(((N,A)=>{const k=new Hh.e;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){const A=JSON.parse(JSON.parse(k.responseText).jsonPayload),C=JSON.parse(A.particleSystem);let K;K=mV?zh.Parse(C,h,t,!1,L):kh.Parse(C,h,t,!1,L),K.snippetId=V,N(K)}else A("Unable to load the snippet "+V)})),k.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),k.send()}))}}jh.BaseAssetsUrl=Dh.BaseAssetsUrl,jh.SnippetUrl="https://snippet.babylonjs.com",jh.CreateFromSnippetAsync=jh.ParseFromSnippetAsync;var lh=mV(12836),Gh=mV(12674),yh=mV(13796);(0,yh.f)(Gh.b.NAME_PARTICLESYSTEM,((V,h,mV,t)=>{const L=(0,yh.h)(Gh.b.NAME_PARTICLESYSTEM);if(L&&void 0!==V.Lq&&null!==V.Lq)for(let N=0,A=V.Lq.length;N<A;N++){const A=V.Lq[N];mV.Lq.push(L(A,h,t))}})),(0,yh.c)(Gh.b.NAME_PARTICLESYSTEM,((V,h,mV)=>{if(V.activeParticleCount){return zh.Parse(V,h,mV)}return kh.Parse(V,h,mV)})),uV.b.prototype.createEffectForParticles=function(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,C=arguments.length>7?arguments[7]:void 0,K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,o=arguments.length>9?arguments[9]:void 0,n=[],q=[];const x=[];return C?C.fillUniformsAttributesAndSamplerNames(q,n,x):(n=kh._GetAttributeNamesOrOptions(),q=kh._GetEffectCreationOptions()),-1===L.indexOf(" BILLBOARD")&&(L+="\n#define BILLBOARD\n"),null!==C&&void 0!==C&&C.isAnimationSheetEnabled&&-1===L.indexOf(" ANIMATESHEET")&&(L+="\n#define ANIMATESHEET\n"),-1===t.indexOf("diffuseSampler")&&t.push("diffuseSampler"),this.createEffect({vertex:o??(null===C||void 0===C?void 0:C.vertexShaderName)??"particles",fragmentElement:V},n,q.concat(h),x.concat(t),L,N,A,k,void 0,K,(async()=>{0===K?await Promise.resolve().then(mV.bind(mV,13836)):await Promise.resolve().then(mV.bind(mV,13903))}))},lh.c.prototype.getEmittedParticleSystems=function(){const V=[];for(let h=0;h<this.DV().Lq.length;h++){const mV=this.DV().Lq[h];mV.Lh===this&&V.push(mV)}return V},lh.c.prototype.getHierarchyEmittedParticleSystems=function(){const V=[],h=this.getDescendants();h.push(this);for(let mV=0;mV<this.DV().Lq.length;mV++){const t=this.DV().Lq[mV],L=t.Lh;L.position&&-1!==h.indexOf(L)&&V.push(t)}return V};mV(12734),mV(12740),mV(12811);mV(12817),mV(13805),mV(12606),mV(12723),mV(12855);mV(12604);var Oh;mV(13809),mV(12438);!function(V){V[V.Color=2]="Color",V[V.UV=1]="UV",V[V.Random=0]="Random",V[V.Stated=3]="Stated"}(Oh||(Oh={}));var Ih=mV(12632);const rh=new t.sh(0,0,0),Th=new t.sh(0,0,0),Fh=new t.sh(0,0,0);class ph{constructor(V,h,mV){this.width=V,this.height=h,this.data=mV}processFlowable(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,mV=arguments.length>2?arguments[2]:void 0;if(!mV)return;mV instanceof t.Matrix?t.sh.TransformCoordinatesToRef(V.position,mV,Fh):(Fh.x=mV.x,Fh.y=mV.y,Fh.z=mV.z);const L=.5*Fh.x+.5,N=1-(.5*Fh.y+.5),A=Math.floor(L*this.width),k=Math.floor(N*this.height);if(A<0||A>=this.width||k<0||k>=this.height)return;const C=4*(k*this.width+A),K=this.data[C]/255*2-1,o=this.data[C+1]/255*2-1,n=this.data[C+2]/255*2-1,q=this.data[C+3]/255;rh.set(K,o,n),rh.scaleToRef(h*q,Th),V.direction.addInPlace(Th)}_processParticle(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,mV=arguments.length>2?arguments[2]:void 0;this.processFlowable(V,h,mV)}static async FromUrlAsync(V){return await new Promise(((h,mV)=>{const t=document.createElement("canvas"),L=t.getContext("2d");let N=null;const A=new Image;A.crossOrigin="anonymous",A.src=V,A.onerror=h=>{mV(new Error(`Failed to load image: ${V} : ${h}`))},A.onload=()=>{t.width=A.width,t.height=A.height,L.drawImage(A,0,0),N=L.getImageData(0,0,t.width,t.height),h(new ph(t.width,t.height,N.data))}}))}static async ExtractFromTextureAsync(V){return await new Promise(((h,mV)=>{if(!V.isReady())return void V.onLoadObservable.addOnce((async()=>{try{const mV=await this.ExtractFromTextureAsync(V);h(mV)}catch(t){mV(t)}}));const t=V.getSize();Ih.p.GetTextureDataAsync(V,t.width,t.height).then((V=>{h(new ph(t.width,t.height,new Uint8ClampedArray(V)))})).catch(mV)}))}}var Zh,fh,Sh,Yh,wh,Eh,gh,ih,bh;!function(V){V[V.Int=1]="Int",V[V.Float=2]="Float",V[V.Vector2=4]="Vector2",V[V.sh=8]="sh",V[V.Matrix=16]="Matrix",V[V.Particle=32]="Particle",V[V.Texture=64]="Texture",V[V.Gk=128]="Gk",V[V.FloatGradient=256]="FloatGradient",V[V.Vector2Gradient=512]="Vector2Gradient",V[V.Vector3Gradient=1024]="Vector3Gradient",V[V.Color4Gradient=2048]="Color4Gradient",V[V.System=4096]="System",V[V.AutoDetect=8192]="AutoDetect",V[V.BasedOnInput=16384]="BasedOnInput",V[V.Undefined=32768]="Undefined",V[V.All=65535]="All"}(Zh||(Zh={})),function(V){V[V.Compatible=0]="Compatible",V[V.TypeIncompatible=1]="TypeIncompatible",V[V.HierarchyIssue=2]="HierarchyIssue"}(fh||(fh={})),function(V){V[V.Input=0]="Input",V[V.Output=1]="Output"}(Sh||(Sh={}));class Ph{get direction(){return this._direction}get type(){if(this._type===Zh.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Zh.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(V){this._type=V}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((V=>V.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(V,h,mV){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Zh.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new W.d,this.onDisconnectionObservable=new W.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=h,this.name=V,this._direction=mV}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(V){var h;return this.isConnected?null!==(h=this._connectedPoint)&&void 0!==h&&h._storedFunction?this._connectedPoint._storedFunction(V):this._connectedPoint._storedValue:this.value}canConnectTo(V){return 0===this.checkCompatibilityState(V)}checkCompatibilityState(V){const h=this._ownerBlock,mV=V.ownerBlock;if(this.type!==V.type&&V.innerType!==Zh.AutoDetect)return V.acceptedConnectionPointTypes&&-1!==V.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(V.excludedConnectionPointTypes&&-1!==V.excludedConnectionPointTypes.indexOf(this.type))return 1;let t=mV,L=h;return 0===this.direction&&(t=h,L=mV),t.isAnAncestorOf(L)?2:0}connectTo(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(V))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${V.ownerBlock.name}".${V.name}`;return this._endpoints.push(V),V._connectedPoint=this,this.onConnectionObservable.notifyObservers(V),V.onConnectionObservable.notifyObservers(this),this}disconnectFrom(V){const h=this._endpoints.indexOf(V);return-1===h||(this._endpoints.splice(h,1),V._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(V),V.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(V){let h=1;for(;h<Zh.All;)V&h||this.excludedConnectionPointTypes.push(h),h<<=1}serialize(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const h={};return h.name=this.name,h.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.sk?(h.valueType="BABYLON."+this.value.getClassName(),h.value=this.value.sk()):(h.valueType="number",h.value=this.value)),V&&this.connectedPoint&&(h.inputName=this.name,h.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,h.targetConnectionName=this.connectedPoint.name,h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(h.isExposedOnFrame=!0,h.exposedPortPosition=this.exposedPortPosition),h}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Uh{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(V){this._name=V}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(V){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new W.d,this.XL=new W.d,this.onInputChangedObservable=new W.d,this.visibleOnFrame=!1,this._name=V,this.uniqueId=p.e.UniqueId}_inputRename(V){return V}_outputRename(V){return V}isAnAncestorOf(V){for(const h of this._outputs)if(h.hasEndpoints)for(const mV of h.endpoints){if(mV.ownerBlock===V)return!0;if(mV.ownerBlock.isAnAncestorOf(V))return!0}return!1}isAnAncestorOfType(V){if(this.getClassName()===V)return!0;for(const h of this._outputs)if(h.hasEndpoints)for(const mV of h.endpoints)if(mV.ownerBlock.isAnAncestorOfType(V))return!0;return!1}getInputByName(V){const h=this._inputs.filter((h=>h.name===V));return h.length?h[0]:null}_linkConnectionTypes(V,h){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[h]._acceptedConnectionPointType=this._inputs[V]:(this._inputs[V]._linkedConnectionSource=this._inputs[h],this._inputs[V]._isMainLinkSource=!0),this._inputs[h]._linkedConnectionSource=this._inputs[V]}registerInput(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0,N=arguments.length>5?arguments[5]:void 0;const A=new Ph(V,this,0);return A.type=h,A.isOptional=mV,A.defaultValue=t,A.value=t,A.valueMin=L,A.valueMax=N,this._inputs.push(A),this.onInputChangedObservable.notifyObservers(A),this}registerOutput(V,h,mV){return(mV=mV??new Ph(V,this,1)).type=h,this._outputs.push(mV),this}_build(V){}_customBuildStep(V){}build(V){if(this._buildId===V.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((V=>V.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=V.buildId;for(const h of this._inputs){if(!h.connectedPoint){h.isOptional||V.notConnectedNonOptionalInputs.push(h);continue}const mV=h.connectedPoint.ownerBlock;mV&&mV!==this&&!mV.isSystem&&mV.build(V)}return this._customBuildStep(V),V.verbose&&Z.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(V),this.onBuildObservable.notifyObservers(this),!1}serialize(){const V={};V.customType="BABYLON."+this.getClassName(),V.id=this.uniqueId,V.name=this.name,V.visibleOnFrame=this.visibleOnFrame,V.inputs=[],V.outputs=[];for(const h of this.inputs)V.inputs.push(h.serialize());for(const h of this.outputs)V.outputs.push(h.serialize(!1));return V}_deserialize(V){this._name=V.name,this.comments=V.comments,this.visibleOnFrame=!!V.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(V)}_deserializePortDisplayNamesAndExposedOnFrame(V){const h=V.inputs,mV=V.outputs;if(h)for(const t of h){const V=this.inputs.find((V=>V.name===t.name));if(!V)return;if(t.displayName&&(V.displayName=t.displayName),t.isExposedOnFrame&&(V.isExposedOnFrame=t.isExposedOnFrame,V.exposedPortPosition=t.exposedPortPosition),void 0!==t.value&&null!==t.value)if("number"===t.valueType)V.value=t.value;else{const h=(0,k.e)(t.valueType);h&&(V.value=h.Dh(t.value))}}if(mV)for(let t=0;t<mV.length;t++){const V=mV[t];V.displayName&&(this.outputs[t].displayName=V.displayName),V.isExposedOnFrame&&(this.outputs[t].isExposedOnFrame=V.isExposedOnFrame,this.outputs[t].exposedPortPosition=V.exposedPortPosition)}}clone(){const V=this.serialize(),h=(0,k.e)(V.customType);if(h){const mV=new h;return mV._deserialize(V),mV}return null}dispose(){this.XL.notifyObservers(this),this.XL.clear();for(const V of this.inputs)V.dispose();for(const V of this.outputs)V.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function uh(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",t=arguments.length>3?arguments[3]:void 0;return(L,N)=>{let A=L._propStore;A||(A=[],L._propStore=A),A.push({propertyName:N,displayName:V,type:h,groupName:mV,options:t??{},className:L.getClassName()})}}(0,I.e)([(0,r.J)("comment")],Uh.prototype,"comments",void 0),function(V){V[V.Boolean=0]="Boolean",V[V.Float=1]="Float",V[V.Int=2]="Int",V[V.Vector2=3]="Vector2",V[V.List=4]="List",V[V.Gk=5]="Gk",V[V.SamplingMode=6]="SamplingMode",V[V.TextureFormat=7]="TextureFormat",V[V.TextureType=8]="TextureType"}(Yh||(Yh={})),function(V){V[V.None=0]="None",V[V.Position=1]="Position",V[V.Direction=2]="Direction",V[V.Age=3]="Age",V[V.Lifetime=4]="Lifetime",V[V.Color=5]="Color",V[V.ScaledDirection=6]="ScaledDirection",V[V.Scale=7]="Scale",V[V.AgeGradient=8]="AgeGradient",V[V.Angle=9]="Angle",V[V.SpriteCellIndex=16]="SpriteCellIndex",V[V.SpriteCellStart=17]="SpriteCellStart",V[V.SpriteCellEnd=18]="SpriteCellEnd"}(wh||(wh={})),function(V){V[V.None=0]="None",V[V.Time=1]="Time",V[V.Delta=2]="Delta",V[V.Emitter=3]="Emitter"}(Eh||(Eh={}));class eh{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let V="";for(const h of this.notConnectedNonOptionalInputs)V+=`input ${h.name} from block ${h.ownerBlock.name}[${h.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(V)throw"Build of Node Particle System Set failed:\n"+V}adapt(V,h){const mV=V.getConnectedValue(this)||0;if(V.type===h)return mV;switch(h){case Zh.Vector2:return new t.Vector2(mV,mV);case Zh.sh:return new t.sh(mV,mV,mV);case Zh.Gk:return new A.Gk(mV,mV,mV,mV)}return null}getContextualValue(V){if(!this.particleContext||!this.systemContext)return null;switch(V){case wh.Position:return this.particleContext.position;case wh.Direction:return this.particleContext.direction;case wh.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case wh.Color:return this.particleContext.color;case wh.Age:return this.particleContext.age;case wh.Lifetime:return this.particleContext.lifeTime;case wh.Angle:return this.particleContext.angle;case wh.Scale:return this.particleContext.scale;case wh.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case wh.SpriteCellEnd:return this.systemContext.endSpriteCellID;case wh.SpriteCellIndex:return this.particleContext.cellIndex;case wh.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Lh.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Lh.absolutePosition:this.systemContext.Lh:null}getSystemValue(V){if(!this.particleContext||!this.systemContext)return null;switch(V){case Eh.Time:return this.systemContext._actualFrame;case Eh.Delta:return this.systemContext._scaledUpdateSpeed;case Eh.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Lh.absolutePosition}return this.systemContext.Lh}return null}}function Wh(V,h,mV){const t=new eh;t.zh=h;const L=V.createSystem(t);return L.canStart=()=>!0,L.Lh=mV.clone(),L.disposeOnStop=!0,L.start(),L}class Xh extends Uh{constructor(V){super(V),this.blendMode=C.BLENDMODE_ONEONE,this.jm=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Zh.Particle),this.registerInput("texture",Zh.Texture),this.registerInput("onStart",Zh.System,!0),this.registerInput("onEnd",Zh.System,!0),this.registerOutput("system",Zh.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(V){V.jm=this.jm,V.buildId=this._buildId++,this.build(V);const h=this.particle.getConnectedValue(V);return h.particleTexture=this.texture.getConnectedValue(V),h.emitRate=this.emitRate,h.blendMode=this.blendMode,h.name=this.name,h._nodeGenerated=!0,h._targetStopDuration=this.targetStopDuration,h.startDelay=this.startDelay,this.system._storedValue=this,h.canStart=()=>!this.doNoStart,h.onStartedObservable.add((mV=>{const t=this.onStart.getConnectedValue(V);t&&mV.onStartedObservable.addOnce((()=>{V.systemContext=h;const mV=Wh(t,V.zh,V.emitterPosition);this.XL.addOnce((()=>{mV.dispose()}))}));const L=this.onEnd.getConnectedValue(V);L&&mV.onStoppedObservable.addOnce((()=>{V.systemContext=h;const mV=Wh(L,V.zh,V.emitterPosition);this.XL.addOnce((()=>{mV.dispose()}))}))})),this.XL.addOnce((()=>{h.dispose()})),h}serialize(){const V=super.serialize();return V.jm=this.jm,V.emitRate=this.emitRate,V.blendMode=this.blendMode,V.doNoStart=this.doNoStart,V.targetStopDuration=this.targetStopDuration,V.startDelay=this.startDelay,V}_deserialize(V){super._deserialize(V),this.jm=V.jm,this.emitRate=V.emitRate,this.doNoStart=!!V.doNoStart,void 0!==V.blendMode&&(this.blendMode=V.blendMode),void 0!==V.targetStopDuration&&(this.targetStopDuration=V.targetStopDuration),void 0!==V.startDelay&&(this.startDelay=V.startDelay)}}(0,I.e)([uh("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:C.BLENDMODE_ONEONE},{label:"Standard",value:C.BLENDMODE_STANDARD},{label:"Add",value:C.BLENDMODE_ADD},{label:"Multiply",value:C.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:C.BLENDMODE_MULTIPLYADD}]})],Xh.prototype,"blendMode",void 0),(0,I.e)([uh("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Xh.prototype,"jm",void 0),(0,I.e)([uh("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Xh.prototype,"emitRate",void 0),(0,I.e)([uh("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Xh.prototype,"targetStopDuration",void 0),(0,I.e)([uh("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Xh.prototype,"startDelay",void 0),(0,I.e)([uh("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Xh.prototype,"doNoStart",void 0),(0,k.i)("BABYLON.SystemBlock",Xh);class ah extends Uh{get type(){if(this._type===Zh.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Zh.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Zh.Vector2,this._type;case"sh":return this._type=Zh.sh,this._type;case"Gk":return this._type=Zh.Gk,this._type;case"Matrix":return this._type=Zh.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===wh.None&&this._systemSource!==Eh.None}get systemSource(){return this._systemSource}set systemSource(V){if(this._systemSource=V,V!==Eh.None){switch(this._contextualSource=wh.None,this._type=Zh.Float,V){case Eh.Time:case Eh.Delta:this._type=Zh.Float;break;case Eh.Emitter:this._type=Zh.sh}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==wh.None}get contextualValue(){return this._contextualSource}set contextualValue(V){if(this._contextualSource=V,V!==wh.None){switch(this._systemSource=Eh.None,V){case wh.Scale:this._type=Zh.Vector2;break;case wh.Position:case wh.Direction:case wh.ScaledDirection:this._type=Zh.sh;break;case wh.Color:this._type=Zh.Gk;break;case wh.Age:case wh.Lifetime:case wh.Angle:case wh.AgeGradient:this._type=Zh.Float;break;case wh.SpriteCellEnd:case wh.SpriteCellStart:case wh.SpriteCellIndex:this._type=Zh.Int}this.output&&(this.output.type=this._type)}}constructor(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zh.AutoDetect;super(V),this._type=Zh.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new W.d,this._systemSource=Eh.None,this._contextualSource=wh.None,this._type=h,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",h)}get value(){return this._storedValue}set value(V){this.type===Zh.Float&&this.min!==this.max&&(V=Math.max(this.min,V),V=Math.min(this.max,V)),this._storedValue=V,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(V){this._valueCallback=V}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Zh.Int:case Zh.Float:this.value=0;break;case Zh.Vector2:this.value=t.Vector2.Zero();break;case Zh.sh:this.value=t.sh.Zero();break;case Zh.Gk:this.value=new A.Gk(1,1,1,1);break;case Zh.Matrix:this.value=t.Matrix.Identity()}}_build(V){super._build(V),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=V=>V.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=V=>V.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const V=super.serialize();return V.type=this.type,V.contextualValue=this.contextualValue,V.systemSource=this.systemSource,V.min=this.min,V.max=this.max,V.groupInInspector=this.groupInInspector,V.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.sk?(V.valueType="BABYLON."+this._storedValue.getClassName(),V.value=this._storedValue.sk()):(V.valueType="number",V.value=this._storedValue)),V}_deserialize(V){if(super._deserialize(V),this._type=V.type,this.contextualValue=V.contextualValue,this.systemSource=V.systemSource||Eh.None,this.min=V.min||0,this.max=V.max||0,this.groupInInspector=V.groupInInspector||"",void 0!==V.displayInInspector&&(this.displayInInspector=V.displayInInspector),V.valueType)if("number"===V.valueType)this._storedValue=V.value;else{const h=(0,k.e)(V.valueType);h&&(this._storedValue=h.Dh(V.value))}}}(0,k.i)("BABYLON.ParticleInputBlock",ah);class Bh extends Uh{get url(){return this._url}set url(V){this._url!==V&&(this._cachedData=null,this._url=V,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(V){this._textureDataUrl!==V&&(this._cachedData=null,this._textureDataUrl=V,this._url="",this._sourceTexture=null)}set sourceTexture(V){this._sourceTexture!==V&&(this._cachedData=null,this._sourceTexture=V,this._url="",this._textureDataUrl="")}constructor(V){super(V),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Zh.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const V=this.texture._storedValue;return await new Promise(((h,mV)=>{if(!V.isReady())return void V.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),h(this._cachedData)}catch(V){mV(V)}}));const t=V.getSize();Ih.p.GetTextureDataAsync(V,t.width,t.height).then((mV=>{this._cachedData={width:t.width,height:t.height,data:new Uint8ClampedArray(mV)},V.dispose(),h(this._cachedData)})).catch(mV)}))}_build(V){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new F.d(this._textureDataUrl,V.zh):this.texture._storedValue=new F.d(this._url,V.zh):this.texture._storedValue=null}serialize(){const V=super.serialize();return V.url=this.url,V.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(V.textureDataUrl=this.textureDataUrl),V}_deserialize(V){super._deserialize(V),this.url=V.url,this.serializedCachedData=!!V.serializedCachedData,V.textureDataUrl&&(this.textureDataUrl=V.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,k.i)("BABYLON.ParticleTextureSourceBlock",Bh);class Vm extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("position",Zh.sh),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(V){const h=this.particle.getConnectedValue(V);if(this.output._storedValue=h,!this.position.isConnected)return;const mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.position.t(this.position.getConnectedValue(V))},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV}}(0,k.i)("BABYLON.UpdatePositionBlock",Vm),function(V){V[V.Add=0]="Add",V[V.Subtract=1]="Subtract",V[V.Multiply=2]="Multiply",V[V.Divide=3]="Divide",V[V.Max=4]="Max",V[V.Min=5]="Min"}(gh||(gh={}));class hm extends Uh{constructor(V){super(V),this.operation=gh.Add,this.registerInput("left",Zh.AutoDetect),this.registerInput("right",Zh.AutoDetect),this.registerOutput("output",Zh.BasedOnInput),this.output._typeConnectionSource=this.left;const h=[Zh.Matrix,Zh.Particle,Zh.Texture,Zh.System,Zh.FloatGradient,Zh.Color4Gradient,Zh.Vector2Gradient,Zh.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...h),this.right.excludedConnectionPointTypes.push(...h),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(V){let h;const mV=this.left,L=this.right;if(!mV.isConnected||!L.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const N=mV.type===Zh.Float||mV.type===Zh.Int,k=L.type===Zh.Float||L.type===Zh.Int,C=N&&k;switch(this.operation){case gh.Add:h=C?V=>mV.getConnectedValue(V)+L.getConnectedValue(V):N?V=>V.adapt(mV,L.type).add(L.getConnectedValue(V)):V=>mV.getConnectedValue(V).add(V.adapt(L,mV.type));break;case gh.Subtract:h=C?V=>mV.getConnectedValue(V)-L.getConnectedValue(V):N?V=>V.adapt(mV,L.type).Mh(L.getConnectedValue(V)):V=>mV.getConnectedValue(V).Mh(V.adapt(L,mV.type));break;case gh.Multiply:h=C?V=>mV.getConnectedValue(V)*L.getConnectedValue(V):N?V=>V.adapt(mV,L.type).multiply(L.getConnectedValue(V)):V=>mV.getConnectedValue(V).multiply(V.adapt(L,mV.type));break;case gh.Divide:h=C?V=>mV.getConnectedValue(V)/L.getConnectedValue(V):N?V=>V.adapt(mV,L.type).divide(L.getConnectedValue(V)):V=>mV.getConnectedValue(V).divide(V.adapt(L,mV.type));break;case gh.Min:if(C)h=V=>Math.min(mV.getConnectedValue(V),L.getConnectedValue(V));else{const[V,k]=N?[L,mV]:[mV,L];switch(V.type){case Zh.Vector2:h=h=>t.Vector2.Minimize(V.getConnectedValue(h),h.adapt(k,V.type));break;case Zh.sh:h=h=>t.sh.Minimize(V.getConnectedValue(h),h.adapt(k,V.type));break;case Zh.Gk:h=h=>{const mV=V.getConnectedValue(h),{r:t,g:L,b:N,a:C}=h.adapt(k,V.type);return new A.Gk(Math.min(mV.r,t),Math.min(mV.g,L),Math.min(mV.b,N),Math.min(mV.a,C))}}}break;case gh.Max:if(!C){const[V,k]=N?[L,mV]:[mV,L];switch(V.type){case Zh.Vector2:h=h=>t.Vector2.Maximize(V.getConnectedValue(h),h.adapt(k,V.type));break;case Zh.sh:h=h=>t.sh.Maximize(V.getConnectedValue(h),h.adapt(k,V.type));break;case Zh.Gk:h=h=>{const mV=V.getConnectedValue(h),{r:t,g:L,b:N,a:C}=h.adapt(k,V.type);return new A.Gk(Math.max(mV.r,t),Math.min(mV.g,L),Math.min(mV.b,N),Math.min(mV.a,C))}}break}h=V=>Math.max(mV.getConnectedValue(V),L.getConnectedValue(V))}this.output._storedFunction=V=>mV.type===Zh.Int?0|h(V):h(V)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Zh.Int||this.left.type===Zh.Float&&this.right.type!==Zh.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[V,h]of[[this.left,this.right],[this.right,this.left]])V.acceptedConnectionPointTypes=[Zh.Int,Zh.Float],h.isConnected&&(V.acceptedConnectionPointTypes.push(h.type),h.type!==Zh.Int&&h.type!==Zh.Float||V.acceptedConnectionPointTypes.push(Zh.Vector2,Zh.sh,Zh.Gk))}dispose(){super.dispose();for(const V of this._connectionObservers)V.remove();this._connectionObservers.length=0}serialize(){const V=super.serialize();return V.operation=this.operation,V}_deserialize(V){super._deserialize(V),this.operation=V.operation}}(0,I.e)([uh("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:gh.Add},{label:"Subtract",value:gh.Subtract},{label:"Multiply",value:gh.Multiply},{label:"Divide",value:gh.Divide},{label:"Max",value:gh.Max},{label:"Min",value:gh.Min}]})],hm.prototype,"operation",void 0),(0,k.i)("BABYLON.ParticleMathBlock",hm);class mt extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("direction1",Zh.sh,!0,new t.sh(0,1,0)),this.registerInput("direction2",Zh.sh,!0,new t.sh(0,1,0)),this.registerInput("minEmitBox",Zh.sh,!0,new t.sh(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Zh.sh,!0,new t.sh(.5,.5,.5)),this.registerOutput("output",Zh.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(V){const h=this.particle.getConnectedValue(V);h._directionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.direction1.getConnectedValue(V),N=this.direction2.getConnectedValue(V),A=(0,K.RandomRange)(L.x,N.x),k=(0,K.RandomRange)(L.y,N.y),C=(0,K.RandomRange)(L.z,N.z);V.isEmitterTransformNode?t.sh.TransformNormalFromFloatsToRef(A,k,C,V.emitterWorldMatrix,mV.direction):mV.direction.Hk(A,k,C)},h._positionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.minEmitBox.getConnectedValue(V),N=this.maxEmitBox.getConnectedValue(V),A=(0,K.RandomRange)(L.x,N.x),k=(0,K.RandomRange)(L.y,N.y),C=(0,K.RandomRange)(L.z,N.z);V.isEmitterTransformNode?t.sh.TransformCoordinatesFromFloatsToRef(A,k,C,V.emitterWorldMatrix,mV.position):(mV.position.Hk(A,k,C),mV.position.addInPlace(V.emitterPosition))},this.output._storedValue=h}}(0,k.i)("BABYLON.BoxShapeBlock",mt);class tm extends Uh{constructor(V){super(V),this.registerInput("emitPower",Zh.Float,!0,1),this.registerInput("lifeTime",Zh.Float,!0,1),this.registerInput("color",Zh.Gk,!0,new A.Gk(1,1,1,1)),this.registerInput("scale",Zh.Vector2,!0,new t.Vector2(1,1)),this.registerInput("angle",Zh.Float,!0,0),this.registerOutput("particle",Zh.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(V){const h=new kh(this.name,V.jm,V.zh,null,!1,void 0,!0);h.particleEmitterType=new M,h._lifeTimeCreation.process=(h,mV)=>{V.particleContext=h,h.lifeTime=this.lifeTime.getConnectedValue(V),mV._emitPower=this.emitPower.getConnectedValue(V)},h._colorCreation.process=h=>{V.particleContext=h,h.color.t(this.color.getConnectedValue(V))},h._sizeCreation.process=h=>{V.particleContext=h,h.size=1,h.scale.t(this.scale.getConnectedValue(V))},h._angleCreation.process=h=>{V.particleContext=h,h.angle=this.angle.getConnectedValue(V)},this.particle._storedValue=h}}(0,k.i)("BABYLON.CreateParticleBlock",tm);class Lm{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const V=[];for(const h of this.attachedBlocks)h.isInput&&V.push(h);return V}constructor(V){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new W.d,this.name=V}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(V)&&this.attachedBlocks.push(V);for(const mV of V.inputs){const t=mV.connectedPoint;if(t){const mV=t.ownerBlock;mV!==V&&this._initializeBlock(mV,h)}}}async buildAsync(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((mV=>{const t=new Dh;for(const V of this._systemBlocks)this._initializeBlock(V);for(const L of this.systemBlocks){const mV=new eh;mV.buildId=this._buildId++,mV.zh=V,mV.verbose=h;const N=L.createSystem(mV);mV.emitErrors(),t.systems.push(N)}this.onBuildObservable.notifyObservers(this),mV(t)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const V=new Xh("Particle system"),h=new Vm("Update position");h.output.connectTo(V.particle);const mV=new ah("Position");mV.contextualValue=wh.Position;const t=new ah("Scaled direction");t.contextualValue=wh.ScaledDirection;const L=new hm("Add");L.operation=gh.Add,mV.output.connectTo(L.left),t.output.connectTo(L.right),L.output.connectTo(h.position);const N=new tm("Create particle"),A=new mt("Box shape");N.particle.connectTo(A.particle),A.output.connectTo(h.particle);const k=new Bh("Texture");k.texture.connectTo(V.texture),k.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(V)}removeBlock(V){const h=this.attachedBlocks.indexOf(V);if(h>-1&&this.attachedBlocks.splice(h,1),V.isSystem){const h=this._systemBlocks.indexOf(V);h>-1&&this._systemBlocks.splice(h,1)}}parseSerializedObject(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h||this.clear();const mV={};for(const t of V.zo){const V=(0,k.e)(t.customType);if(V){const h=new V;h._deserialize(t),mV[t.id]=h,this.attachedBlocks.push(h),h.isSystem&&this._systemBlocks.push(h)}}for(const t of this.attachedBlocks)if(t.isTeleportOut){const V=t,h=V._tempEntryPointUniqueId;if(h){const t=mV[h];t&&t.attachToEndpoint(V)}}for(let t=0;t<V.zo.length;t++){const L=V.zo[t],N=mV[L.id];N&&(N.inputs.length&&L.inputs.some((V=>V.targetConnectionName))&&!h||this._restoreConnections(N,V,mV))}if(V.locations||V.editorData&&V.editorData.locations){const t=V.locations||V.editorData.locations;for(const V of t)mV[V.tL]&&(V.tL=mV[V.tL].uniqueId);h&&this.editorData&&this.editorData.locations&&t.concat(this.editorData.locations),V.locations?this.editorData={locations:t}:(this.editorData=V.editorData,this.editorData.locations=t);const L=[];for(const V in mV)L[V]=mV[V].uniqueId;this.editorData.map=L}this.comment=V.comment}_restoreConnections(V,h,mV){for(const t of V.outputs)for(const L of h.zo){const N=mV[L.id];if(N)for(const A of L.inputs)if(mV[A.targetBlockId]!==V||A.targetConnectionName!==t.name);else{const V=N.getInputByName(A.inputName);if(!V||V.isConnected)continue;t.connectTo(V,!0),this._restoreConnections(N,h,mV)}}}serialize(V){const h=V?{}:T.e.Serialize(this);h.editorData=JSON.parse(JSON.stringify(this.editorData));let mV=[];V?mV=V:h.customType="BABYLON.NodeParticleSystemSet",h.zo=[];for(const t of mV)h.zo.push(t.serialize());if(!V)for(const t of this.attachedBlocks)-1===mV.indexOf(t)&&h.zo.push(t.serialize());return h}dispose(){for(const V of this.attachedBlocks)V.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(V){const h=new Lm(V);return h.setToDefault(),h}static Parse(V){const h=T.e.Parse((()=>new Lm(V.name)),V,null);return h.parseSerializedObject(V),h}static ParseFromSnippetAsync(V,h){return"_BLANK"===V?Promise.resolve(Lm.CreateDefault("blank")):new Promise(((mV,t)=>{const L=new Hh.e;L.addEventListener("readystatechange",(()=>{if(4==L.readyState)if(200==L.status){const A=JSON.parse(JSON.parse(L.responseText).jsonPayload),k=JSON.parse(A.nodeParticle);h||(h=T.e.Parse((()=>new Lm(V)),k,null)),h.parseSerializedObject(k),h.snippetId=V;try{mV(h)}catch(N){t(N)}}else t("Unable to load the snippet "+V)})),L.open("GET",this.SnippetUrl+"/"+V.replace(/#/g,"/")),L.send()}))}}Lm.EditorURL=`${Qh.Tools._DefaultCdnUrl}/v${uV.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Lm.SnippetUrl="https://snippet.babylonjs.com",(0,I.e)([(0,r.J)()],Lm.prototype,"name",void 0),(0,I.e)([(0,r.J)("comment")],Lm.prototype,"comment",void 0),function(V){V[V.None=0]="None",V[V.PerParticle=1]="PerParticle",V[V.PerSystem=2]="PerSystem"}(ih||(ih={}));class Nm extends Uh{constructor(V){super(V),this._currentLockId=-2,this.lockMode=ih.PerParticle,this.registerInput("min",Zh.AutoDetect,!0,0),this.registerInput("max",Zh.AutoDetect,!0,1),this.registerOutput("output",Zh.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Zh.Float|Zh.Int|Zh.Vector2|Zh.sh|Zh.Gk),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Zh.Float|Zh.Int|Zh.Vector2|Zh.sh|Zh.Gk),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Zh.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let V=null;switch(this._currentLockId=-2,this.min.type){case Zh.AutoDetect:case Zh.Int:case Zh.Float:V=V=>{const h=this.min.getConnectedValue(V)||0,mV=this.max.getConnectedValue(V)||1;return h+Math.random()*(mV-h)};break;case Zh.Vector2:V=V=>{const h=this.min.getConnectedValue(V)||t.Vector2.Zero(),mV=this.max.getConnectedValue(V)||t.Vector2.One();return new t.Vector2(h.x+Math.random()*(mV.x-h.x),h.y+Math.random()*(mV.y-h.y))};break;case Zh.sh:V=V=>{const h=this.min.getConnectedValue(V)||t.sh.Zero(),mV=this.max.getConnectedValue(V)||t.sh.One();return new t.sh(h.x+Math.random()*(mV.x-h.x),h.y+Math.random()*(mV.y-h.y),h.z+Math.random()*(mV.z-h.z))};break;case Zh.Gk:V=V=>{const h=this.min.getConnectedValue(V)||new A.Gk(0,0,0,0),mV=this.max.getConnectedValue(V)||new A.Gk(1,1,1,1);return new A.Gk(h.x+Math.random()*(mV.x-h.x),h.y+Math.random()*(mV.y-h.y),h.z+Math.random()*(mV.z-h.z),h.w+Math.random()*(mV.w-h.w))}}this.output._storedFunction=h=>{var mV;let t=0;switch(this.lockMode){case ih.PerParticle:t=(null===(mV=h.particleContext)||void 0===mV?void 0:mV.id)||-1;break;case ih.PerSystem:t=h.buildId||0}return this._currentLockId!==t&&(this.lockMode!==ih.None&&(this._currentLockId=t),this.output._storedValue=V(h)),this.output._storedValue}}serialize(){const V=super.serialize();return V.lockMode=this.lockMode,V}_deserialize(V){super._deserialize(V),this.lockMode=V.lockMode}}(0,I.e)([uh("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ih.None},{label:"Per particle",value:ih.PerParticle},{label:"Per system",value:ih.PerSystem}]})],Nm.prototype,"lockMode",void 0),(0,k.i)("BABYLON.ParticleRandomBlock",Nm);class Am extends Uh{constructor(V){super(V),this._currentLockId=-2,this.lockMode=ih.PerParticle,this.registerInput("min",Zh.AutoDetect),this.registerInput("max",Zh.AutoDetect),this.registerOutput("output",Zh.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const h=[Zh.Matrix,Zh.Particle,Zh.Texture,Zh.System,Zh.FloatGradient,Zh.Color4Gradient,Zh.Vector2Gradient,Zh.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...h),this.max.excludedConnectionPointTypes.push(...h)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let V=null;switch(this._currentLockId=-2,this.min.type){case Zh.Float:case Zh.Int:V=V=>{const h=this.min.getConnectedValue(V),mV=this.max.getConnectedValue(V);return Math.random()*(mV-h)+h};break;case Zh.Vector2:V=V=>{const h=this.min.getConnectedValue(V),mV=this.max.getConnectedValue(V);return new t.Vector2(Math.random()*(mV.x-h.x)+h.x,Math.random()*(mV.y-h.y)+h.y)};break;case Zh.sh:V=V=>{const h=this.min.getConnectedValue(V),mV=this.max.getConnectedValue(V);return new t.sh(Math.random()*(mV.x-h.x)+h.x,Math.random()*(mV.y-h.y)+h.y,Math.random()*(mV.z-h.z)+h.z)};break;case Zh.Gk:V=V=>{const h=this.min.getConnectedValue(V),mV=this.max.getConnectedValue(V);return new A.Gk(Math.random()*(mV.r-h.r)+h.r,Math.random()*(mV.g-h.g)+h.g,Math.random()*(mV.b-h.b)+h.b,Math.random()*(mV.a-h.a)+h.a)}}this.output._storedFunction=h=>{var mV;let t=0;switch(this.lockMode){case ih.PerParticle:t=(null===(mV=h.particleContext)||void 0===mV?void 0:mV.id)||-1;break;case ih.PerSystem:t=h.buildId||0}return this._currentLockId!==t&&(this.lockMode!==ih.None&&(this._currentLockId=t),this.output._storedValue=V(h)),this.output._storedValue}}serialize(){const V=super.serialize();return V.lockMode=this.lockMode,V}_deserialize(V){super._deserialize(V),void 0!==V.lockMode&&(this.lockMode=V.lockMode)}}(0,I.e)([uh("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:ih.None},{label:"Per particle",value:ih.PerParticle},{label:"Per system",value:ih.PerSystem}]})],Am.prototype,"lockMode",void 0),(0,k.i)("BABYLON.RandomRangeBlock",Am);(0,k.i)("BABYLON.ParticleLerpBlock",class extends Uh{constructor(V){super(V),this.registerInput("left",Zh.AutoDetect),this.registerInput("right",Zh.AutoDetect),this.registerInput("gradient",Zh.Float,!0,0,0,1),this.registerOutput("output",Zh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Zh.Float|Zh.Int|Zh.Vector2|Zh.sh|Zh.Gk)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const V=(V,h,mV)=>(1-V)*h+V*mV;this.output._storedFunction=h=>{const mV=this.left.getConnectedValue(h),L=this.right.getConnectedValue(h),N=this.gradient.getConnectedValue(h);switch(this.left.type){case Zh.Int:case Zh.Float:return V(N,mV,L);case Zh.Vector2:return new t.Vector2(V(N,mV.x,L.x),V(N,mV.y,L.y));case Zh.sh:return new t.sh(V(N,mV.x,L.x),V(N,mV.y,L.y),V(N,mV.z,L.z));case Zh.Gk:return new A.Gk(V(N,mV.r,L.r),V(N,mV.g,L.g),V(N,mV.b,L.b),V(N,mV.a,L.a))}return 0}}});(0,k.i)("BABYLON.UpdateDirectionBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("direction",Zh.sh),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(V){const h=this.particle.getConnectedValue(V);if(this.output._storedValue=h,!this.direction.isConnected)return;const mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.direction.t(this.direction.getConnectedValue(V))},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV}});(0,k.i)("BABYLON.UpdateColorBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("color",Zh.Gk),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(V){const h=this.particle.getConnectedValue(V);if(this.output._storedValue=h,!this.color.isConnected)return;const mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.color.t(this.color.getConnectedValue(V))},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV}});(0,k.i)("BABYLON.UpdateScaleBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("scale",Zh.Vector2),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(V){const h=this.particle.getConnectedValue(V);if(this.output._storedValue=h,!this.scale.isConnected)return;const mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.scale.t(this.scale.getConnectedValue(V))},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV}});(0,k.i)("BABYLON.UpdateAngleBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("angle",Zh.Float),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(V){const h=this.particle.getConnectedValue(V);if(this.output._storedValue=h,!this.angle.isConnected)return;const mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.angle=this.angle.getConnectedValue(V)},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV}});(0,k.i)("BABYLON.BasicPositionUpdateBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(V){const h=this.particle.getConnectedValue(V),mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.direction.scaleToRef(h._directionScale,h._scaledDirection),mV.position.addInPlace(h._scaledDirection)},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV,this.output._storedValue=h}});(0,k.i)("BABYLON.BasicSpriteUpdateBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(V){const h=this.particle.getConnectedValue(V),mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.updateCellIndex()},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV,this.output._storedValue=h}});(0,k.i)("BABYLON.UpdateSpriteCellIndexBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("cellIndex",Zh.Int),this.registerOutput("output",Zh.Particle),this.cellIndex.acceptedConnectionPointTypes=[Zh.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(V){const h=this.particle.getConnectedValue(V);if(this.output._storedValue=h,!this.cellIndex.isConnected)return;const mV={process:mV=>{V.particleContext=mV,V.systemContext=h,mV.cellIndex=Math.floor(this.cellIndex.getConnectedValue(V))},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV}});class km extends Uh{constructor(V){super(V),this.strength=1,this.registerInput("particle",Zh.Particle),this.registerInput("flowMap",Zh.Texture),this.registerOutput("output",Zh.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(V){var h;const mV=this.particle.getConnectedValue(V),t=V.zh;let L;(null===(h=this.flowMap.connectedPoint)||void 0===h?void 0:h.ownerBlock).extractTextureContentAsync().then((V=>{V&&(L=new ph(V.width,V.height,V.data))}));const N={process:V=>{const h=t.getTransformMatrix();L&&L._processParticle(V,this.strength*mV._tempScaledUpdateSpeed,h)},previousItem:null,nextItem:null};mV._updateQueueStart?EV(N,mV._updateQueueStart):mV._updateQueueStart=N,this.output._storedValue=mV}serialize(){const V=super.serialize();return V.strength=this.strength,V}_deserialize(V){super._deserialize(V),this.strength=V.strength}}(0,I.e)([uh("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],km.prototype,"strength",void 0),(0,k.i)("BABYLON.UpdateFlowMapBlock",km);(0,k.i)("BABYLON.SphereShapeBlock",class extends Uh{constructor(V){super(V),this.registerInput("input",Zh.Particle),this.registerInput("radius",Zh.Float,!0,1),this.registerInput("radiusRange",Zh.Float,!0,1,0,1),this.registerInput("directionRandomizer",Zh.Float,!0,0,0,1),this.registerOutput("output",Zh.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(V){const h=this.input.getConnectedValue(V);h._directionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.directionRandomizer.getConnectedValue(V),N=mV.position.Mh(V.emitterPosition).normalize(),A=(0,K.RandomRange)(0,L),k=(0,K.RandomRange)(0,L),C=(0,K.RandomRange)(0,L);N.x+=A,N.y+=k,N.z+=C,N.normalize(),V.isEmitterTransformNode?t.sh.TransformNormalFromFloatsToRef(A,k,C,V.emitterWorldMatrix,mV.direction):mV.direction.Hk(A,k,C)},h._positionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.radius.getConnectedValue(V),N=this.radiusRange.getConnectedValue(V),A=L-(0,K.RandomRange)(0,L*N),k=(0,K.RandomRange)(0,1),C=(0,K.RandomRange)(0,2*Math.PI),o=Math.acos(2*k-1),n=A*Math.cos(C)*Math.sin(o),q=A*Math.cos(o),x=A*Math.sin(C)*Math.sin(o);V.isEmitterTransformNode?t.sh.TransformCoordinatesFromFloatsToRef(n,q,x,V.emitterWorldMatrix,mV.position):(mV.position.Hk(n,q,x),mV.position.addInPlace(V.emitterPosition))},this.output._storedValue=h}});(0,k.i)("BABYLON.PointShapeBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("direction1",Zh.sh,!0,new t.sh(0,1,0)),this.registerInput("direction2",Zh.sh,!0,new t.sh(0,1,0)),this.registerOutput("output",Zh.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){const h=this.particle.getConnectedValue(V);h._directionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.direction1.getConnectedValue(V),N=this.direction2.getConnectedValue(V),A=(0,K.RandomRange)(L.x,N.x),k=(0,K.RandomRange)(L.y,N.y),C=(0,K.RandomRange)(L.z,N.z);V.isEmitterTransformNode?t.sh.TransformNormalFromFloatsToRef(A,k,C,V.emitterWorldMatrix,mV.direction):mV.direction.Hk(A,k,C)},h._positionCreation.process=mV=>{V.systemContext=h,V.isEmitterTransformNode?t.sh.TransformCoordinatesFromFloatsToRef(0,0,0,V.emitterWorldMatrix,mV.position):mV.position.t(V.emitterPosition)},this.output._storedValue=h}});(0,k.i)("BABYLON.CustomShapeBlock",class extends Uh{constructor(V){super(V),this.registerInput("particle",Zh.Particle),this.registerInput("position",Zh.sh,!0,new t.sh(0,0,0)),this.registerInput("direction",Zh.sh,!0,new t.sh(0,1,0)),this.registerOutput("output",Zh.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){const h=this.particle.getConnectedValue(V);h._directionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.direction.getConnectedValue(V);V.isEmitterTransformNode?t.sh.TransformNormalToRef(L,V.emitterWorldMatrix,mV.direction):mV.direction.t(L)},h._positionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.position.getConnectedValue(V);V.isEmitterTransformNode?t.sh.TransformCoordinatesToRef(L,V.emitterWorldMatrix,mV.position):(mV.position.t(L),mV.position.addInPlace(V.emitterPosition))},this.output._storedValue=h}});(0,k.i)("BABYLON.CylinderShapeBlock",class extends Uh{constructor(V){super(V),this._tempVector=t.sh.Zero(),this.registerInput("particle",Zh.Particle),this.registerInput("radius",Zh.Float,!0,1),this.registerInput("height",Zh.Float,!0,1,0),this.registerInput("radiusRange",Zh.Float,!0,1,0,1),this.registerInput("directionRandomizer",Zh.Float,!0,0,0,1),this.registerOutput("output",Zh.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(V){const h=this.particle.getConnectedValue(V);h._directionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.directionRandomizer.getConnectedValue(V);mV.position.subtractToRef(V.emitterPosition,this._tempVector),this._tempVector.normalize(),V.isEmitterTransformNode&&t.sh.TransformNormalToRef(this._tempVector,V.emitterInverseWorldMatrix,this._tempVector);const N=(0,K.RandomRange)(-L/2,L/2);let A=Math.atan2(this._tempVector.x,this._tempVector.z);A+=(0,K.RandomRange)(-Math.PI/2,Math.PI/2)*L,this._tempVector.y=N,this._tempVector.x=Math.sin(A),this._tempVector.z=Math.cos(A),this._tempVector.normalize(),V.isEmitterTransformNode?t.sh.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,V.emitterWorldMatrix,mV.direction):mV.direction.t(this._tempVector)},h._positionCreation.process=mV=>{V.particleContext=mV,V.systemContext=h;const L=this.height.getConnectedValue(V),N=this.radiusRange.getConnectedValue(V),A=this.radius.getConnectedValue(V),k=(0,K.RandomRange)(-L/2,L/2),C=(0,K.RandomRange)(0,2*Math.PI),o=(0,K.RandomRange)((1-N)*(1-N),1),n=Math.sqrt(o)*A,q=n*Math.cos(C),x=n*Math.sin(C);V.isEmitterTransformNode?t.sh.TransformCoordinatesFromFloatsToRef(q,k,x,V.emitterWorldMatrix,mV.position):(mV.position.Hk(q,k,x),mV.position.addInPlace(V.emitterPosition))},this.output._storedValue=h}});class Cm extends Uh{constructor(V){super(V),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Zh.Particle),this.registerOutput("output",Zh.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);const h=this.particle.getConnectedValue(V);h._isAnimationSheetEnabled=!0,h.spriteCellWidth=this.width,h.spriteCellHeight=this.height,h.startSpriteCellID=this.start,h.endSpriteCellID=this.end,h.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=h}serialize(){const V=super.serialize();return V.width=this.width,V.height=this.height,V.start=this.start,V.end=this.end,V.randomStartCell=this.randomStartCell,V}_deserialize(V){super._deserialize(V),this.width=V.width,this.height=V.height,this.start=V.start,this.end=V.end,this.randomStartCell=V.randomStartCell}}(0,I.e)([uh("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cm.prototype,"start",void 0),(0,I.e)([uh("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cm.prototype,"end",void 0),(0,I.e)([uh("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cm.prototype,"width",void 0),(0,I.e)([uh("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Cm.prototype,"height",void 0),(0,I.e)([uh("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cm.prototype,"loop",void 0),(0,I.e)([uh("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Cm.prototype,"randomStartCell",void 0),(0,k.i)("BABYLON.SetupSpriteSheetBlock",Cm);class Km extends Uh{constructor(V){super(V),this.reference=0,this.registerInput("value",Zh.AutoDetect),this.registerOutput("output",Zh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=V=>{switch(V){case Zh.Float:return Zh.FloatGradient;case Zh.Vector2:return Zh.Vector2Gradient;case Zh.sh:return Zh.Vector3Gradient;case Zh.Gk:return Zh.Color4Gradient}return V},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Zh.Float|Zh.Vector2|Zh.sh|Zh.Gk)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=V=>null}serialize(){const V=super.serialize();return V.reference=this.reference,V}_deserialize(V){super._deserialize(V),this.reference=V.reference}}(0,I.e)([uh("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Km.prototype,"reference",void 0),(0,k.i)("BABYLON.ParticleGradientValueBlock",Km);(0,k.i)("BABYLON.ParticleGradientBlock",class extends Uh{constructor(V){super(V),this._entryCount=1,this.registerInput("gradient",Zh.Float,!0,1,0,1),this.registerInput("value0",Zh.AutoDetect),this.registerOutput("output",Zh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=V=>{switch(V){case Zh.FloatGradient:return Zh.Float;case Zh.Vector2Gradient:return Zh.Vector2;case Zh.Vector3Gradient:return Zh.sh;case Zh.Color4Gradient:return Zh.Gk}return V},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Zh.FloatGradient|Zh.Vector2Gradient|Zh.Vector3Gradient|Zh.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(V){this._inputs[V].onConnectionObservable.add((()=>{this._entryCount>V||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Zh.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const V=[];for(let mV=1;mV<this._inputs.length;mV++){var h;if(this._inputs[mV].isConnected)V.push(null===(h=this._inputs[mV].connectedPoint)||void 0===h?void 0:h.ownerBlock)}V.sort(((V,h)=>V.reference-h.reference)),this.output._storedFunction=h=>{const mV=this.gradient.getConnectedValue(h);if(1===V.length)return V[0].value.getConnectedValue(h);let L=null;for(let N=V.length-1;N>=0;N--){const k=V[N];if(k.reference<=mV){const V=k.value.getConnectedValue(h);if(L){const N=L.value.getConnectedValue(h),C=L.reference,o=k.reference,n=Math.max(0,Math.min(1,(mV-o)/(C-o)));switch(this.output.type){case Zh.Float:return(0,K.Lerp)(V,N,n);case Zh.Vector2:return t.Vector2.Lerp(V,N,n);case Zh.sh:return t.sh.Lerp(V,N,n);case Zh.Gk:return A.Gk.Lerp(V,N,n)}}return V}L=k}return 0}}});(0,k.i)("BABYLON.ParticleConverterBlock",class extends Uh{constructor(V){super(V),this.registerInput("color ",Zh.Gk,!0),this.registerInput("xyz ",Zh.sh,!0),this.registerInput("xy ",Zh.Vector2,!0),this.registerInput("zw ",Zh.Vector2,!0),this.registerInput("x ",Zh.Float,!0),this.registerInput("y ",Zh.Float,!0),this.registerInput("z ",Zh.Float,!0),this.registerInput("w ",Zh.Float,!0),this.registerOutput("color",Zh.Gk),this.registerOutput("xyz",Zh.sh),this.registerOutput("xy",Zh.Vector2),this.registerOutput("zw",Zh.Vector2),this.registerOutput("x",Zh.Float),this.registerOutput("y",Zh.Float),this.registerOutput("z",Zh.Float),this.registerOutput("w",Zh.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(V){return"color "===V?"colorIn":"xyz "===V?"xyzIn":"xy "===V?"xyIn":"zw "===V?"zwIn":"x "===V?"xIn":"y "===V?"yIn":"z "===V?"zIn":"w "===V?"wIn":V}_outputRename(V){switch(V){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return V}}_build(V){super._build(V);const h=this.xIn,mV=this.yIn,L=this.zIn,N=this.wIn,k=this.xyIn,C=this.zwIn,K=this.xyzIn,o=this.colorIn,n=this.colorOut,q=this.xyzOut,x=this.xyOut,R=this.zwOut,d=this.xOut,s=this.yOut,M=this.zOut,c=this.wOut,z=V=>{if(o.isConnected)return o.getConnectedValue(V);let t=0,n=0,q=0,x=0;if(h.isConnected&&(t=h.getConnectedValue(V)),mV.isConnected&&(n=mV.getConnectedValue(V)),L.isConnected&&(q=L.getConnectedValue(V)),N.isConnected&&(x=N.getConnectedValue(V)),k.isConnected){const h=k.getConnectedValue(V);h&&(t=h.x,n=h.y)}if(C.isConnected){const h=C.getConnectedValue(V);h&&(q=h.x,x=h.y)}if(K.isConnected){const h=K.getConnectedValue(V);h&&(t=h.x,n=h.y,q=h.z)}return new A.Gk(t,n,q,x)};n._storedFunction=V=>z(V),q._storedFunction=V=>{const h=z(V);return new t.sh(h.r,h.g,h.b)},x._storedFunction=V=>{const h=z(V);return new t.Vector2(h.r,h.g)},R._storedFunction=V=>{const h=z(V);return new t.Vector2(h.b,h.a)},d._storedFunction=V=>z(V).r,s._storedFunction=V=>z(V).g,M._storedFunction=V=>z(V).b,c._storedFunction=V=>z(V).a}}),function(V){V[V.Cos=0]="Cos",V[V.Sin=1]="Sin",V[V.Abs=2]="Abs",V[V.Exp=3]="Exp",V[V.Exp2=4]="Exp2",V[V.Round=5]="Round",V[V.Floor=6]="Floor",V[V.Ceiling=7]="Ceiling",V[V.Sqrt=8]="Sqrt",V[V.Log=9]="Log",V[V.Tan=10]="Tan",V[V.ArcTan=11]="ArcTan",V[V.ArcCos=12]="ArcCos",V[V.ArcSin=13]="ArcSin",V[V.Sign=14]="Sign",V[V.Negate=15]="Negate",V[V.OneMinus=16]="OneMinus",V[V.Reciprocal=17]="Reciprocal",V[V.ToDegrees=18]="ToDegrees",V[V.ToRadians=19]="ToRadians",V[V.Fract=20]="Fract"}(bh||(bh={}));class om extends Uh{constructor(V){super(V),this.operation=bh.Cos,this.registerInput("input",Zh.AutoDetect),this.registerOutput("output",Zh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Zh.Float|Zh.Int|Zh.Vector2|Zh.sh|Zh.Gk)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);let h=null;switch(this.operation){case bh.Cos:h=V=>Math.cos(V);break;case bh.Sin:h=V=>Math.sin(V);break;case bh.Abs:h=V=>Math.abs(V);break;case bh.Exp:h=V=>Math.exp(V);break;case bh.Exp2:h=V=>Math.pow(2,V);break;case bh.Round:h=V=>Math.round(V);break;case bh.Floor:h=V=>Math.floor(V);break;case bh.Ceiling:h=V=>Math.ceil(V);break;case bh.Sqrt:h=V=>Math.sqrt(V);break;case bh.Log:h=V=>Math.log(V);break;case bh.Tan:h=V=>Math.tan(V);break;case bh.ArcTan:h=V=>Math.atan(V);break;case bh.ArcCos:h=V=>Math.acos(V);break;case bh.ArcSin:h=V=>Math.asin(V);break;case bh.Sign:h=V=>Math.sign(V);break;case bh.Negate:h=V=>-V;break;case bh.OneMinus:h=V=>1-V;break;case bh.Reciprocal:h=V=>1/V;break;case bh.ToRadians:h=V=>V*Math.PI/180;break;case bh.ToDegrees:h=V=>180*V/Math.PI;break;case bh.Fract:h=V=>V>=0?V-Math.floor(V):V-Math.ceil(V)}if(!h)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Zh.Int:case Zh.Float:this.output._storedFunction=V=>{const mV=this.input.getConnectedValue(V);return h(mV)};break;case Zh.Vector2:this.output._storedFunction=V=>{const mV=this.input.getConnectedValue(V);return new t.Vector2(h(mV.x),h(mV.y))};break;case Zh.sh:this.output._storedFunction=V=>{const mV=this.input.getConnectedValue(V);return new t.sh(h(mV.x),h(mV.y),h(mV.z))};break;case Zh.Gk:this.output._storedFunction=V=>{const mV=this.input.getConnectedValue(V);return new A.Gk(h(mV.r),h(mV.g),h(mV.b),h(mV.a))}}return this}serialize(){const V=super.serialize();return V.operation=this.operation,V}_deserialize(V){super._deserialize(V),this.operation=V.operation}}(0,I.e)([uh("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:bh.Cos},{label:"Sin",value:bh.Sin},{label:"Abs",value:bh.Abs},{label:"Exp",value:bh.Exp},{label:"Exp2",value:bh.Exp2},{label:"Round",value:bh.Round},{label:"Floor",value:bh.Floor},{label:"Ceiling",value:bh.Ceiling},{label:"Sqrt",value:bh.Sqrt},{label:"Log",value:bh.Log},{label:"Tan",value:bh.Tan},{label:"ArcTan",value:bh.ArcTan},{label:"ArcCos",value:bh.ArcCos},{label:"ArcSin",value:bh.ArcSin},{label:"Sign",value:bh.Sign},{label:"Negate",value:bh.Negate},{label:"OneMinus",value:bh.OneMinus},{label:"Reciprocal",value:bh.Reciprocal},{label:"ToDegrees",value:bh.ToDegrees},{label:"ToRadians",value:bh.ToRadians},{label:"Fract",value:bh.Fract}]})],om.prototype,"operation",void 0),(0,k.i)("BABYLON.ParticleTrigonometryBlock",om);var nm,qm=mV(13816);class xm extends Uh{constructor(V){super(V),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Zh.AutoDetect),this.registerOutput("output",Zh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Zh.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Zh.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Zh.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Zh.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Zh.System),this._inputs[0].excludedConnectionPointTypes.push(Zh.Particle),this._inputs[0].excludedConnectionPointTypes.push(Zh.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const h=V=>{const h=this.input.getConnectedValue(V);if(this.log.length>=this.stackSize)return h;if(null===h||void 0===h)return this.log.push(["null",""]),h;switch(this.input.type){case Zh.Vector2:this.log.push([(0,qm.j)(h,4),h.toString()]);break;case Zh.sh:this.log.push([(0,qm.l)(h,4),h.toString()]);break;case Zh.Gk:this.log.push([`{R: ${h.r.toFixed(4)} G: ${h.g.toFixed(4)} B: ${h.b.toFixed(4)} A: ${h.a.toFixed(4)}}`,h.toString()]);break;default:this.log.push([h.toString(),h.toString()])}return h};this.output.isConnected?this.output._storedFunction=h:this.output._storedValue=h(V)}serialize(){const V=super.serialize();return V.stackSize=this.stackSize,V}_deserialize(V){super._deserialize(V),this.stackSize=V.stackSize}}(0,I.e)([uh("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],xm.prototype,"stackSize",void 0),(0,k.i)("BABYLON.ParticleDebugBlock",xm);(0,k.i)("BABYLON.ParticleElbowBlock",class extends Uh{constructor(V){super(V),this.registerInput("input",Zh.AutoDetect),this.registerOutput("output",Zh.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(V){super._build(V);const h=this._outputs[0],mV=this._inputs[0];h._storedFunction=V=>mV.getConnectedValue(V)}});(0,k.i)("BABYLON.ParticleTeleportInBlock",class extends Uh{get endpoints(){return this._endpoints}constructor(V){super(V),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Zh.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(V){if(this.getClassName()===V)return!0;for(const h of this.endpoints)if(h.isAnAncestorOfType(V))return!0;return!1}isAnAncestorOf(V){for(const h of this.endpoints){if(h===V)return!0;if(h.isAnAncestorOf(V))return!0}return!1}attachToEndpoint(V){V.detach(),this._endpoints.push(V),V._entryPoint=this,V._outputs[0]._typeConnectionSource=this._inputs[0],V._tempEntryPointUniqueId=null,V.name="> "+this.name}detachFromEndpoint(V){const h=this._endpoints.indexOf(V);-1!==h&&(this._endpoints.splice(h,1),V._outputs[0]._typeConnectionSource=null,V._entryPoint=null)}_build(){for(const V of this._endpoints)V.output._storedFunction=V=>this.input.getConnectedValue(V)}});(0,k.i)("BABYLON.ParticleTeleportOutBlock",class extends Uh{constructor(V){super(V),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Zh.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(V){this.entryPoint&&this.entryPoint.build(V)}clone(){const V=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(V),V}serialize(){var V;const h=super.serialize();return h.entryPoint=(null===(V=this.entryPoint)||void 0===V?void 0:V.uniqueId)??"",h}_deserialize(V){super._deserialize(V),this._tempEntryPointUniqueId=V.entryPoint}}),function(V){V[V.Equal=0]="Equal",V[V.NotEqual=1]="NotEqual",V[V.LessThan=2]="LessThan",V[V.GreaterThan=3]="GreaterThan",V[V.LessOrEqual=4]="LessOrEqual",V[V.GreaterOrEqual=5]="GreaterOrEqual",V[V.Xor=6]="Xor",V[V.Or=7]="Or",V[V.And=8]="And"}(nm||(nm={}));class Rm extends Uh{constructor(V){super(V),this.test=nm.Equal,this.epsilon=0,this.registerInput("left",Zh.Float),this.registerInput("right",Zh.Float,!0,0),this.registerInput("ifTrue",Zh.AutoDetect,!0,1),this.registerInput("ifFalse",Zh.AutoDetect,!0,0),this.registerOutput("output",Zh.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Zh.Float,this._inputs[0].acceptedConnectionPointTypes.push(Zh.Int),this._inputs[1].acceptedConnectionPointTypes.push(Zh.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const V=V=>{const h=this.left.getConnectedValue(V),mV=this.right.getConnectedValue(V);let t=!1;switch(this.test){case nm.Equal:t=(0,K.WithinEpsilon)(h,mV,this.epsilon);break;case nm.NotEqual:t=!(0,K.WithinEpsilon)(h,mV,this.epsilon);break;case nm.LessThan:t=h<mV+this.epsilon;break;case nm.GreaterThan:t=h>mV-this.epsilon;break;case nm.LessOrEqual:t=h<=mV+this.epsilon;break;case nm.GreaterOrEqual:t=h>=mV-this.epsilon;break;case nm.Xor:t=!!h&&!mV||!h&&!!mV;break;case nm.Or:t=!!h||!!mV;break;case nm.And:t=!!h&&!!mV}return t};this.output._storedFunction=h=>V(h)?this.ifTrue.getConnectedValue(h):this.ifFalse.getConnectedValue(h)}serialize(){const V=super.serialize();return V.test=this.test,V.epsilon=this.epsilon,V}_deserialize(V){super._deserialize(V),this.test=V.test,void 0!==V.epsilon&&(this.epsilon=V.epsilon)}}(0,I.e)([uh("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:nm.Equal},{label:"NotEqual",value:nm.NotEqual},{label:"LessThan",value:nm.LessThan},{label:"GreaterThan",value:nm.GreaterThan},{label:"LessOrEqual",value:nm.LessOrEqual},{label:"GreaterOrEqual",value:nm.GreaterOrEqual},{label:"Xor",value:nm.Xor},{label:"Or",value:nm.Or},{label:"And",value:nm.And}]})],Rm.prototype,"test",void 0),(0,I.e)([uh("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Rm.prototype,"epsilon",void 0),(0,k.i)("BABYLON.ParticleConditionBlock",Rm);class dm extends Uh{constructor(V){super(V),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Zh.Particle),this.registerInput("condition",Zh.Float,!0,0),this.registerInput("system",Zh.System),this.registerOutput("output",Zh.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(V){this._triggerCount=0;const h=this.input.getConnectedValue(V),mV={process:mV=>{if(V.particleContext=mV,V.systemContext=h,0!==this.condition.getConnectedValue(V)&&(0===this.limit||this._triggerCount<this.limit)){const t=(new Date).getTime();if(this._previousOne&&t-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=t;const L=this.system.getConnectedValue(V);if(L){const t=Wh(L,V.zh,mV.position);t.XL.addOnce((()=>{this._triggerCount--})),h.XL.addOnce((()=>{t.dispose()}))}}},previousItem:null,nextItem:null};h._updateQueueStart?EV(mV,h._updateQueueStart):h._updateQueueStart=mV,this.output._storedValue=h}serialize(){const V=super.serialize();return V.limit=this.limit,V.delay=this.delay,V}_deserialize(V){super._deserialize(V),void 0!==V.limit&&(this.limit=V.limit),void 0!==V.delay&&(this.delay=V.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,I.e)([uh("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dm.prototype,"limit",void 0),(0,I.e)([uh("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dm.prototype,"delay",void 0),(0,k.i)("BABYLON.ParticleTriggerBlock",dm);mV(13825),mV(13836),mV(13846),mV(13903)},13884:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13850:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13915:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneVertex",N="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13907:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13901:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogFragment",N="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13881:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13920:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogVertex",N="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13912:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogVertexDeclaration",N="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13867:(V,h,mV)=>{"use strict";var t=mV(12342);const L="helperFunctions",N="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13855:(V,h,mV)=>{"use strict";var t=mV(12342);const L="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13874:(V,h,mV)=>{"use strict";var t=mV(12342);const L="imageProcessingFunctions",N="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13858:(V,h,mV)=>{"use strict";var t=mV(12342);const L="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13893:(V,h,mV)=>{"use strict";var t=mV(12342);const L="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13925:(V,h,mV)=>{"use strict";var t=mV(12342);const L="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";t.b.IncludesShadersStoreWGSL[L]||(t.b.IncludesShadersStoreWGSL[L]=N)},13846:(V,h,mV)=>{"use strict";mV.r(h),mV.d(h,{particlesPixelShaderWGSL:()=>A});var t=mV(12342);mV(13850),mV(13855),mV(13858),mV(13867),mV(13874),mV(13881),mV(13884),mV(13893),mV(13901);const L="particlesPixelShader",N="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";t.b.ShadersStoreWGSL[L]||(t.b.ShadersStoreWGSL[L]=N);const A={name:L,shader:N}},13903:(V,h,mV)=>{"use strict";mV.r(h),mV.d(h,{particlesVertexShaderWGSL:()=>A});var t=mV(12342);mV(13907),mV(13912),mV(13858),mV(13915),mV(13920),mV(13925);const L="particlesVertexShader",N="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";t.b.ShadersStoreWGSL[L]||(t.b.ShadersStoreWGSL[L]=N);const A={name:L,shader:N}},13751:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13832:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13772:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneVertex",N="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13840:(V,h,mV)=>{"use strict";var t=mV(12342);const L="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13759:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogFragment",N="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13742:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13780:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogVertex",N="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13767:(V,h,mV)=>{"use strict";var t=mV(12342);const L="fogVertexDeclaration",N="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13732:(V,h,mV)=>{"use strict";var t=mV(12342);const L="helperFunctions",N="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13721:(V,h,mV)=>{"use strict";var t=mV(12342);const L="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13735:(V,h,mV)=>{"use strict";var t=mV(12342);const L="imageProcessingFunctions",N="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13729:(V,h,mV)=>{"use strict";var t=mV(12342);const L="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13754:(V,h,mV)=>{"use strict";var t=mV(12342);const L="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13784:(V,h,mV)=>{"use strict";var t=mV(12342);const L="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";t.b.IncludesShadersStore[L]||(t.b.IncludesShadersStore[L]=N)},13825:(V,h,mV)=>{"use strict";mV.r(h),mV.d(h,{particlesPixelShader:()=>A});var t=mV(12342);mV(13832),mV(13721),mV(13729),mV(13732),mV(13735),mV(13742),mV(13751),mV(13754),mV(13759);const L="particlesPixelShader",N="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";t.b.ShadersStore[L]||(t.b.ShadersStore[L]=N);const A={name:L,shader:N}},13836:(V,h,mV)=>{"use strict";mV.r(h),mV.d(h,{particlesVertexShader:()=>A});var t=mV(12342);mV(13840),mV(13767),mV(13729),mV(13772),mV(13780),mV(13784);const L="particlesVertexShader",N="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";t.b.ShadersStore[L]||(t.b.ShadersStore[L]=N);const A={name:L,shader:N}},14152:(V,h,mV)=>{"use strict";mV.r(h),mV.d(h,{FlowGraphGLTFDataProvider:()=>N});var t=mV(14123),L=mV(14109);class N extends t.e{constructor(V){var h,mV;super();const t=V.glTF,N=(null===(h=t.animations)||void 0===h?void 0:h.map((V=>V._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",L.e,N);const A=(null===(mV=t.nodes)||void 0===mV?void 0:mV.map((V=>V._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",L.e,A)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14056:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>s,g:()=>R,i:()=>x,m:()=>d});var t=mV(12422),L=mV(12867),N=mV(12453),A=mV(14060);const k=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class C{constructor(V,h){this._gltf=V,this._infoTree=h}convert(V){let h,mV=this._gltf,t=this._infoTree;if(!V.startsWith("/"))throw new Error("Path must start with a /");const L=V.split("/");if(L.shift(),L[L.length-1].includes(".length")){const V=L[L.length-1].split(".");L.pop(),L.push(...V)}let N=!1;for(const C of L){const L="length"===C;if(L&&!t.__array__)throw new Error(`Path ${V} is invalid`);if(t.__ignoreObjectTree__&&(N=!0),t.__array__&&!L)t=t.__array__;else if(t=t[C],!t)throw new Error(`Path ${V} is invalid`);if(!N)if(void 0===mV){if(!k.find((h=>h.regex.test(V))))throw new Error(`Path ${V} is invalid`)}else if(!L){var A;mV=null===(A=mV)||void 0===A?void 0:A[C]}(t.__target__||L)&&(h=mV)}return{object:h,info:t}}}function K(V,h,mV,t){const L=o(V,h);return t?L[mV][t]:L[mV]}function o(V,h,mV){var t,N;return null===(t=V._data)||void 0===t||null===(N=t[(null===mV||void 0===mV?void 0:mV.fillMode)??L.e.MATERIAL_TriangleFillMode])||void 0===N?void 0:N.babylonMaterial}function n(V,h){return{offset:{componentsCount:2,type:"Vector2",get:(mV,L,N)=>{const A=K(mV,N,V,h);return new t.Vector2(null===A||void 0===A?void 0:A.uOffset,null===A||void 0===A?void 0:A.vOffset)},getTarget:o,set:(mV,t,L,N)=>{const A=K(t,N,V,h);A.uOffset=mV.x,A.vOffset=mV.y},getPropertyName:[()=>`${V}${h?"."+h:""}.uOffset`,()=>`${V}${h?"."+h:""}.vOffset`]},rotation:{type:"number",get:(mV,t,L)=>{var N;return null===(N=K(mV,L,V,h))||void 0===N?void 0:N.wAng},getTarget:o,set:(mV,t,L,N)=>K(t,N,V,h).wAng=mV,getPropertyName:[()=>`${V}${h?"."+h:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(mV,L,N)=>{const A=K(mV,N,V,h);return new t.Vector2(null===A||void 0===A?void 0:A.uScale,null===A||void 0===A?void 0:A.vScale)},getTarget:o,set:(mV,t,L,N)=>{const A=K(t,N,V,h);A.uScale=mV.x,A.vScale=mV.y},getPropertyName:[()=>`${V}${h?"."+h:""}.uScale`,()=>`${V}${h?"."+h:""}.vScale`]}}}const q={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:V=>{var h,mV;return new t.Vector2((null===(h=V._babylonCamera)||void 0===h?void 0:h.orthoLeft)??0,(null===(mV=V._babylonCamera)||void 0===mV?void 0:mV.orthoRight)??0)},set:(V,h)=>{h._babylonCamera&&(h._babylonCamera.orthoLeft=V.x,h._babylonCamera.orthoRight=V.y)},getTarget:V=>V,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:V=>{var h,mV;return new t.Vector2((null===(h=V._babylonCamera)||void 0===h?void 0:h.orthoBottom)??0,(null===(mV=V._babylonCamera)||void 0===mV?void 0:mV.orthoTop)??0)},set:(V,h)=>{h._babylonCamera&&(h._babylonCamera.orthoBottom=V.x,h._babylonCamera.orthoTop=V.y)},getTarget:V=>V,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:V=>{var h;return null===(h=V._babylonCamera)||void 0===h?void 0:h.maxZ},set:(V,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=V)},getTarget:V=>V,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:V=>{var h;return null===(h=V._babylonCamera)||void 0===h?void 0:h.ck},set:(V,h)=>{h._babylonCamera&&(h._babylonCamera.ck=V)},getTarget:V=>V,getPropertyName:[()=>"ck"]}},perspective:{aspectRatio:{type:"number",get:V=>{var h;return null===(h=V._babylonCamera)||void 0===h?void 0:h.getEngine().getAspectRatio(V._babylonCamera)},getTarget:V=>V,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:V=>{var h;return null===(h=V._babylonCamera)||void 0===h?void 0:h.fov},set:(V,h)=>{h._babylonCamera&&(h._babylonCamera.fov=V)},getTarget:V=>V,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:V=>{var h;return null===(h=V._babylonCamera)||void 0===h?void 0:h.maxZ},set:(V,h)=>{h._babylonCamera&&(h._babylonCamera.maxZ=V)},getTarget:V=>V,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:V=>{var h;return null===(h=V._babylonCamera)||void 0===h?void 0:h.ck},set:(V,h)=>{h._babylonCamera&&(h._babylonCamera.ck=V)},getTarget:V=>V,getPropertyName:[()=>"ck"]}}}},nodes:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"sh",get:V=>{var h;return null===(h=V._babylonTransformNode)||void 0===h?void 0:h.position},set:(V,h)=>{var mV;return null===(mV=h._babylonTransformNode)||void 0===mV?void 0:mV.position.t(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:V=>{var h;return null===(h=V._babylonTransformNode)||void 0===h?void 0:h.rotationQuaternion},set:(V,h)=>{var mV,t;return null===(mV=h._babylonTransformNode)||void 0===mV||null===(t=mV.rotationQuaternion)||void 0===t?void 0:t.t(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"sh",get:V=>{var h;return null===(h=V._babylonTransformNode)||void 0===h?void 0:h.jk},set:(V,h)=>{var mV;return null===(mV=h._babylonTransformNode)||void 0===mV?void 0:mV.jk.t(V)},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"jk"]},weights:{length:{type:"number",get:V=>V._numMorphTargets,getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(V,h)=>{var mV,t;return void 0!==h?null===(mV=V._primitiveBabylonMeshes)||void 0===mV||null===(t=mV[0].morphTargetManager)||void 0===t?void 0:t.getTarget(h).influence:void 0},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(V,h)=>[0],getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:V=>{var h,mV,L;return t.Matrix.Compose(null===(h=V._babylonTransformNode)||void 0===h?void 0:h.jk,null===(mV=V._babylonTransformNode)||void 0===mV?void 0:mV.rotationQuaternion,null===(L=V._babylonTransformNode)||void 0===L?void 0:L.position)},getTarget:V=>V._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:V=>{var h,mV,L,N;const A=t.Matrix.Identity();let k=V.parent;for(;k&&k.parent;)k=k.parent;const C=(null===(h=V._babylonTransformNode)||void 0===h?void 0:h.position._isDirty)||(null===(mV=V._babylonTransformNode)||void 0===mV||null===(L=mV.rotationQuaternion)||void 0===L?void 0:L._isDirty)||(null===(N=V._babylonTransformNode)||void 0===N?void 0:N.jk._isDirty);if(k){var K;const h=null===(K=k._babylonTransformNode)||void 0===K?void 0:K.Qk(!0).invert();var o,n;if(h)null===(o=V._babylonTransformNode)||void 0===o||null===(n=o.Qk(C))||void 0===n||n.multiplyToRef(h,A)}else V._babylonTransformNode&&A.t(V._babylonTransformNode.Qk(C));return A},getTarget:V=>V._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:V=>{var h,mV;return null===(h=V._babylonTransformNode)||void 0===h||null===(mV=h.getChildren((V=>V instanceof A.e),!0)[0])||void 0===mV?void 0:mV.Ik},getTarget:V=>{var h;return null===(h=V._babylonTransformNode)||void 0===h?void 0:h.getChildren((V=>V instanceof A.e),!0)[0]},set:(V,h)=>{if(h._babylonTransformNode){const mV=h._babylonTransformNode.getChildren((V=>V instanceof A.e),!0)[0];mV&&(mV.Ik=V)}}},color:{type:"Jh",get:V=>{var h,mV;return null===(h=V._babylonTransformNode)||void 0===h||null===(mV=h.getChildren((V=>V instanceof A.e),!0)[0])||void 0===mV?void 0:mV.rk},getTarget:V=>{var h;return null===(h=V._babylonTransformNode)||void 0===h?void 0:h.getChildren((V=>V instanceof A.e),!0)[0]},set:(V,h)=>{if(h._babylonTransformNode){const mV=h._babylonTransformNode.getChildren((V=>V instanceof A.e),!0)[0];mV&&(mV.rk=V)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Jh",get:(V,h,mV)=>o(V,h,mV).emissiveColor,set:(V,h,mV,t)=>o(h,mV,t).emissiveColor.t(V),getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:n("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(V,h,mV)=>{var t;return null===(t=K(V,mV,"bumpTexture"))||void 0===t?void 0:t.level},set:(V,h,mV,t)=>{const L=K(h,t,"bumpTexture");L&&(L.level=V)},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:n("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(V,h,mV)=>o(V,h,mV).ambientTextureStrength,set:(V,h,mV,t)=>{const L=o(h,mV,t);L&&(L.ambientTextureStrength=V)},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:n("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Gk",get:(V,h,mV)=>{const t=o(V,h,mV);return N.Gk.FromColor3(t.albedoColor,t.alpha)},set:(V,h,mV,t)=>{const L=o(h,mV,t);L.albedoColor.set(V.r,V.g,V.b),L.alpha=V.a},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:n("albedoTexture")}},metallicFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).metallic,set:(V,h,mV,t)=>{const L=o(h,mV,t);L&&(L.metallic=V)},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).roughness,set:(V,h,mV,t)=>{const L=o(h,mV,t);L&&(L.roughness=V)},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:n("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(V,h,mV)=>o(V,h,mV).anisotropy.Ik,set:(V,h,mV,t)=>{o(h,mV,t).anisotropy.Ik=V},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(V,h,mV)=>o(V,h,mV).anisotropy.angle,set:(V,h,mV,t)=>{o(h,mV,t).anisotropy.angle=V},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:n("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).clearCoat.Ik,set:(V,h,mV,t)=>{o(h,mV,t).clearCoat.Ik=V},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).clearCoat.roughness,set:(V,h,mV,t)=>{o(h,mV,t).clearCoat.roughness=V},getTarget:(V,h,mV)=>o(V,h,mV),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:n("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(V,h,mV)=>{var t;return null===(t=o(V,h,mV).clearCoat.bumpTexture)||void 0===t?void 0:t.level},getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).clearCoat.bumpTexture.level=V},extensions:{KHR_texture_transform:n("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:n("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(V,h,mV)=>o(V,h,mV).subSurface.dispersion,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).subSurface.dispersion=V}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(V,h,mV)=>o(V,h,mV).emissiveIntensity,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).emissiveIntensity=V}},KHR_materials_ior:{ior:{type:"number",get:(V,h,mV)=>o(V,h,mV).indexOfRefraction,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).indexOfRefraction=V}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).iridescence.Ik,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).iridescence.Ik=V},iridescenceIor:{type:"number",get:(V,h,mV)=>o(V,h,mV).iridescence.indexOfRefraction,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).iridescence.indexOfRefraction=V},iridescenceTexture:{extensions:{KHR_texture_transform:n("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(V,h,mV)=>o(V,h,mV).iridescence.maximumThickness,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).iridescence.maximumThickness=V},iridescenceThicknessMinimum:{type:"number",get:(V,h,mV)=>o(V,h,mV).iridescence.minimumThickness,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).iridescence.minimumThickness=V},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:n("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Jh",get:(V,h,mV)=>o(V,h,mV).sheen.color,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).sheen.color.t(V)},sheenColorTexture:{extensions:{KHR_texture_transform:n("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).sheen.Ik,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).sheen.Ik=V},sheenRoughnessTexture:{extensions:{KHR_texture_transform:n("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).metallicF0Factor,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).metallicF0Factor=V,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Jh",get:(V,h,mV)=>o(V,h,mV).metallicReflectanceColor,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).metallicReflectanceColor.t(V),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:n("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:n("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).subSurface.refractionIntensity,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).subSurface.refractionIntensity=V,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:n("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).subSurface.translucencyIntensity,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).subSurface.translucencyIntensity=V},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:n("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Jh",get:(V,h,mV)=>o(V,h,mV).subSurface.translucencyColor,getTarget:o,set:(V,h,mV,t)=>{var L;return V&&(null===(L=o(h,mV,t).subSurface.translucencyColor)||void 0===L?void 0:L.t(V))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:n("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Jh",get:(V,h,mV)=>o(V,h,mV).subSurface.tintColor,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).subSurface.tintColor.t(V)},attenuationDistance:{type:"number",get:(V,h,mV)=>o(V,h,mV).subSurface.tintColorAtDistance,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).subSurface.tintColorAtDistance=V},thicknessFactor:{type:"number",get:(V,h,mV)=>o(V,h,mV).subSurface.maximumThickness,getTarget:o,set:(V,h,mV,t)=>o(h,mV,t).subSurface.maximumThickness=V},thicknessTexture:{extensions:{KHR_texture_transform:n("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonLight)),getPropertyName:[V=>"length"]},__array__:{__target__:!0,color:{type:"Jh",get:V=>{var h;return null===(h=V._babylonLight)||void 0===h?void 0:h.rk},set:(V,h)=>{var mV;return null===(mV=h._babylonLight)||void 0===mV?void 0:mV.rk.t(V)},getTarget:V=>V._babylonLight,getPropertyName:[V=>"diffuse"]},Ik:{type:"number",get:V=>{var h;return null===(h=V._babylonLight)||void 0===h?void 0:h.Ik},set:(V,h)=>h._babylonLight?h._babylonLight.Ik=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"intensity"]},range:{type:"number",get:V=>{var h;return null===(h=V._babylonLight)||void 0===h?void 0:h.range},set:(V,h)=>h._babylonLight?h._babylonLight.range=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"range"]},spot:{innerConeAngle:{type:"number",get:V=>{var h;return null===(h=V._babylonLight)||void 0===h?void 0:h.innerAngle},set:(V,h)=>h._babylonLight?h._babylonLight.innerAngle=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"innerConeAngle"]},outerConeAngle:{type:"number",get:V=>{var h;return null===(h=V._babylonLight)||void 0===h?void 0:h.angle},set:(V,h)=>h._babylonLight?h._babylonLight.angle=V:void 0,getTarget:V=>V._babylonLight,getPropertyName:[V=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonLight)),getPropertyName:[V=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonTexture)),getPropertyName:[V=>"length"]},__array__:{__target__:!0,Ik:{type:"number",get:V=>{var h;return null===(h=V._babylonTexture)||void 0===h?void 0:h.level},set:(V,h)=>{h._babylonTexture&&(h._babylonTexture.level=V)},getTarget:V=>V._babylonTexture},rotation:{type:"Quaternion",get:V=>{var h;return V._babylonTexture&&t.Quaternion.FromRotationMatrix(null===(h=V._babylonTexture)||void 0===h?void 0:h.getReflectionTextureMatrix())},set:(V,h)=>{var mV;h._babylonTexture&&(null!==(mV=h._babylonTexture.DV())&&void 0!==mV&&mV.useRightHandedSystem||(V=t.Quaternion.Inverse(V)),t.Matrix.FromQuaternionToRef(V,h._babylonTexture.getReflectionTextureMatrix()))},getTarget:V=>V._babylonTexture}}}}},animations:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>V._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:V=>V.length,getTarget:V=>V.map((V=>{var h;return null===(h=V.primitives[0]._instanceData)||void 0===h?void 0:h.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function x(V){return new C(V,q)}function R(V){const h=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let mV=q;for(const t of h)t&&(mV=mV[t]);if(mV&&mV.type&&mV.get)return mV}function d(V,h){const mV=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let t=q;for(const L of mV)L&&(t=t[L]);t&&t.type&&t.get&&(t.interpolation=h)}function s(V,h){const mV=V.split("/").map((V=>V.replace(/{}/g,"__array__")));let t=q;for(const L of mV)if(L){if(!t[L]){if("?"===L){t.__ignoreObjectTree__=!0;continue}t[L]={},"__array__"===L&&(t[L].__target__=!0)}t=t[L]}Object.assign(t,h)}},14063:(V,h,mV)=>{"use strict";mV.r(h),mV.d(h,{AnimationPropertyInfo:()=>K,TransformNodeAnimationPropertyInfo:()=>o,WeightAnimationPropertyInfo:()=>n,getQuaternion:()=>k,getVector3:()=>A,getWeights:()=>C});var t=mV(12918),L=mV(12422),N=mV(14056);function A(V,h,mV,t){return L.sh.Dh(h,mV).scaleInPlace(t)}function k(V,h,mV,t){return L.Quaternion.Dh(h,mV).scaleInPlace(t)}function C(V,h,mV,t){const L=new Array(V._numMorphTargets);for(let N=0;N<L.length;N++)L[N]=h[mV++]*t;return L}class K{constructor(V,h,mV,t){this.type=V,this.name=h,this.getValue=mV,this.getStride=t}_buildAnimation(V,h,mV){const L=new t.d(V,this.name,h,this.type);return L.setKeys(mV),L}}class o extends K{buildAnimations(V,h,mV,t){const L=[];return L.push({babylonAnimatable:V._babylonTransformNode,babylonAnimation:this._buildAnimation(h,mV,t)}),L}}class n extends K{buildAnimations(V,h,mV,L){const N=[];if(V._numMorphTargets)for(let A=0;A<V._numMorphTargets;A++){const k=new t.d(`${h}_${A}`,this.name,mV,this.type);if(k.setKeys(L.map((V=>({frame:V.frame,inTangent:V.inTangent?V.inTangent[A]:void 0,value:V.value[A],outTangent:V.outTangent?V.outTangent[A]:void 0,interpolation:V.interpolation})))),V._primitiveBabylonMeshes)for(const h of V._primitiveBabylonMeshes)if(h.morphTargetManager){const V=h.morphTargetManager.getTarget(A),mV=k.clone();V.animations.push(mV),N.push({babylonAnimatable:V,babylonAnimation:mV})}}return N}}(0,N.m)("/nodes/{}/translation",[new o(t.d.ANIMATIONTYPE_VECTOR3,"position",A,(()=>3))]),(0,N.m)("/nodes/{}/rotation",[new o(t.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",k,(()=>4))]),(0,N.m)("/nodes/{}/scale",[new o(t.d.ANIMATIONTYPE_VECTOR3,"jk",A,(()=>3))]),(0,N.m)("/nodes/{}/weights",[new n(t.d.ANIMATIONTYPE_FLOAT,"influence",C,(V=>V._numMorphTargets))])},14030:(V,h,mV)=>{"use strict";class t{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((V,h)=>{this._resolve=V,this._reject=h}))}}var L=mV(12422),N=mV(12453),A=mV(12253),k=mV(12838),C=mV(14034),K=mV(14044),o=mV(12258),n=mV(12860),q=mV(12918),x=mV(12924),R=mV(12300),d=mV(12264),s=mV(12272);class M{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(V){this._useTextureToStoreBoneMatrices=V,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(V){this._animationPropertiesOverride=V}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(V,h,mV){this.name=V,this.id=h,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=L.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new o.d,this.bones=[],this._scene=mV||R.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const t=this._scene.getEngine().getCaps();this._canUseTextureForBones=t.textureFloat&&t.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((V=>!V.getParent()))}getTransformMatrices(V){if(this.needInitialSkinMatrix){if(!V)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return V._bonesTransformMatrices||this.prepare(!0),V._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(V){return this.needInitialSkinMatrix&&V._transformMatrixTexture?V._transformMatrixTexture:this._transformMatrixTexture}DV(){return this._scene}toString(V){let h=`Name: ${this.name}, nBones: ${this.bones.length}`;if(h+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,V){h+=", Ranges: {";let V=!0;for(const mV in this._ranges)V&&(h+=", ",V=!1),h+=mV;h+="}"}return h}getBoneIndexByName(V){for(let h=0,mV=this.bones.length;h<mV;h++)if(this.bones[h].name===V)return h;return-1}createAnimationRange(V,h,mV){if(!this._ranges[V]){this._ranges[V]=new x.b(V,h,mV);for(let t=0,L=this.bones.length;t<L;t++)this.bones[t].animations[0]&&this.bones[t].animations[0].createRange(V,h,mV)}}deleteAnimationRange(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let mV=0,t=this.bones.length;mV<t;mV++)this.bones[mV].animations[0]&&this.bones[mV].animations[0].deleteRange(V,h);this._ranges[V]=null}getAnimationRange(V){return this._ranges[V]||null}getAnimationRanges(){const V=[];let h;for(h in this._ranges)V.push(this._ranges[h]);return V}copyAnimationRange(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[h]||!V.getAnimationRange(h))return!1;let t=!0;const L=this._getHighestAnimationFrame()+1,N={},A=V.bones;let k,C;for(C=0,k=A.length;C<k;C++)N[A[C].name]=A[C];this.bones.length!==A.length&&(d.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${A.length}`),t=!1);const K=mV&&this.dimensionsAtRest&&V.dimensionsAtRest?this.dimensionsAtRest.divide(V.dimensionsAtRest):null;for(C=0,k=this.bones.length;C<k;C++){const V=this.bones[C].name,A=N[V];A?t=t&&this.bones[C].copyAnimationRange(A,h,L,mV,K):(d.e.Warn("copyAnimationRange: not same rig, missing source bone "+V),t=!1)}const o=V.getAnimationRange(h);return o&&(this._ranges[h]=new x.b(h,o.from+L,o.to+L)),t}returnToRest(){for(const V of this.bones)-1!==V._index&&V.returnToRest()}_getHighestAnimationFrame(){let V=0;for(let h=0,mV=this.bones.length;h<mV;h++)if(this.bones[h].animations[0]){const mV=this.bones[h].animations[0].getHighestFrame();V<mV&&(V=mV)}return V}beginAnimation(V,h,mV,t){const L=this.getAnimationRange(V);return L?this._scene.beginAnimation(this,L.from,L.to,h,mV,t):null}static MakeAnimationAdditive(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,mV=arguments.length>2?arguments[2]:void 0;const t=V.getAnimationRange(mV);if(!t)return null;const L=V._scene.getAllAnimatablesByTarget(V);let N=null;for(let k=0;k<L.length;k++){const V=L[k];if(V.fromFrame===(null===t||void 0===t?void 0:t.from)&&V.toFrame===(null===t||void 0===t?void 0:t.to)){N=V;break}}const A=V.getAnimatables();for(let k=0;k<A.length;k++){const V=A[k].animations;if(V)for(let t=0;t<V.length;t++)q.d.MakeAnimationAdditive(V[t],h,mV)}return N&&(N.isAdditive=!0),V}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(V){this._meshesWithPoseMatrix.push(V)}_unregisterMeshWithPoseMatrix(V){const h=this._meshesWithPoseMatrix.indexOf(V);h>-1&&this._meshesWithPoseMatrix.splice(h,1)}_computeTransformMatrices(V,h){this.onBeforeComputeObservable.notifyObservers(this);for(let mV=0;mV<this.bones.length;mV++){const t=this.bones[mV];t._childUpdateId++;const L=t.getParent();if(L?t.getLocalMatrix().multiplyToRef(L.getFinalMatrix(),t.getFinalMatrix()):h?t.getLocalMatrix().multiplyToRef(h,t.getFinalMatrix()):t.getFinalMatrix().t(t.getLocalMatrix()),-1!==t._index){const h=null===t._index?mV:t._index;t.getAbsoluteInverseBindMatrix().multiplyToArray(t.getFinalMatrix(),V,16*h)}}this._identity.copyToArray(V,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const V=this.DV().getRenderId();if(this._currentRenderId===V)return;this._currentRenderId=V}if(this._numBonesWithLinkedTransformNode>0)for(const V of this.bones)if(V._linkedTransformNode){const h=V._linkedTransformNode;V.position=h.position,h.rotationQuaternion?V.rotationQuaternion=h.rotationQuaternion:V.rotation=h.rotation,V.jk=h.jk}if(this.needInitialSkinMatrix)for(const V of this._meshesWithPoseMatrix){const h=V.getPoseMatrix();let mV=this._isDirty;if(V._bonesTransformMatrices&&V._bonesTransformMatrices.length===16*(this.bones.length+1)||(V._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),mV=!0),mV){if(this._synchronizedWithMesh!==V){this._synchronizedWithMesh=V;for(const V of this.bones)if(!V.getParent()){V.getBindMatrix().multiplyToRef(h,L.TmpVectors.Matrix[1]),V._updateAbsoluteBindMatrices(L.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const h=4*(this.bones.length+1);V._transformMatrixTexture&&V._transformMatrixTexture.getSize().width===h||(V._transformMatrixTexture&&V._transformMatrixTexture.dispose(),V._transformMatrixTexture=n.e.CreateRGBATexture(V._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(V._bonesTransformMatrices,h),this.isUsingTextureForMatrices&&V._transformMatrixTexture&&V._transformMatrixTexture.update(V._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=n.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let V=0;V<this.bones.length;V++)this._animatables.push(this.bones[V])}return this._animatables}clone(V,h){const mV=new M(V,h||V,this._scene);mV.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let t=0;t<this.bones.length;t++){const V=this.bones[t];let h=null;const L=V.getParent();if(L){const V=this.bones.indexOf(L);h=mV.bones[V]}const N=new K.d(V.name,mV,h,V.getBindMatrix().clone(),V.getRestMatrix().clone());N._index=V._index,V._linkedTransformNode&&N.linkTransformNode(V._linkedTransformNode),s.b.DeepCopy(V.animations,N.animations)}if(this._ranges){mV._ranges={};for(const V in this._ranges){const h=this._ranges[V];h&&(mV._ranges[V]=h.clone())}}return this._isDirty=!0,mV.prepare(!0),mV}enableBlending(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const h of this.bones)for(const mV of h.animations)mV.enableBlending=!0,mV.blendingSpeed=V}dispose(){if(this._meshesWithPoseMatrix.length=0,this.DV().stopAnimation(this),this.DV().removeSkeleton(this),this._parentContainer){const V=this._parentContainer.skeletons.indexOf(this);V>-1&&this._parentContainer.skeletons.splice(V,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const V={};V.name=this.name,V.id=this.id,this.dimensionsAtRest&&(V.dimensionsAtRest=this.dimensionsAtRest.sk()),V.bones=[],V.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let mV=0;mV<this.bones.length;mV++){var h;const t=this.bones[mV],L=t.getParent(),N={parentBoneIndex:L?this.bones.indexOf(L):-1,index:t.getIndex(),name:t.name,id:t.id,matrix:t.getBindMatrix().sk(),rest:t.getRestMatrix().sk(),linkedTransformNodeId:null===(h=t.getTransformNode())||void 0===h?void 0:h.id};V.bones.push(N),t.length&&(N.length=t.length),t.metadata&&(N.metadata=t.metadata),t.animations&&t.animations.length>0&&(N.animation=t.animations[0].serialize()),V.ranges=[];for(const h in this._ranges){const mV=this._ranges[h];if(!mV)continue;const t={};t.name=h,t.from=mV.from,t.to=mV.to,V.ranges.push(t)}}return V}static Parse(V,h){const mV=new M(V.name,V.id,h);let t;for(V.dimensionsAtRest&&(mV.dimensionsAtRest=L.sh.Dh(V.dimensionsAtRest)),mV.needInitialSkinMatrix=V.needInitialSkinMatrix,t=0;t<V.bones.length;t++){const h=V.bones[t],N=V.bones[t].index;let A=null;h.parentBoneIndex>-1&&(A=mV.bones[h.parentBoneIndex]);const k=h.rest?L.Matrix.Dh(h.rest):null,C=new K.d(h.name,mV,A,L.Matrix.Dh(h.matrix),k,null,N);void 0!==h.id&&null!==h.id&&(C.id=h.id),h.length&&(C.length=h.length),h.metadata&&(C.metadata=h.metadata),h.animation&&C.animations.push(q.d.Parse(h.animation)),void 0!==h.linkedTransformNodeId&&null!==h.linkedTransformNodeId&&(mV._hasWaitingData=!0,C._waitingTransformNodeId=h.linkedTransformNodeId)}if(V.ranges)for(t=0;t<V.ranges.length;t++){const h=V.ranges[t];mV.createAnimationRange(h.name,h.from,h.to)}return mV}computeAbsoluteMatrices(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||V)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(V)}getPoseMatrix(){let V=null;return this._meshesWithPoseMatrix.length>0&&(V=this._meshesWithPoseMatrix[0].getPoseMatrix()),V}sortBones(){const V=[],h=new Array(this.bones.length);for(let mV=0;mV<this.bones.length;mV++)this._sortBones(mV,V,h);this.bones=V}_sortBones(V,h,mV){if(mV[V])return;mV[V]=!0;const t=this.bones[V];if(!t)return;void 0===t._index&&(t._index=V);const L=t.getParent();L&&this._sortBones(this.bones.indexOf(L),h,mV),h.push(t)}setCurrentPoseAsRest(){for(const V of this.bones)V.setCurrentPoseAsRest()}}var c=mV(12718),z=mV(12885),Q=mV(12406),J=mV(12806),v=mV(12481),D=mV(12845),H=mV(12811),j=mV(12836),l=mV(12931),G=mV(12507),y=mV(14009);class O{set areUpdatesFrozen(V){V?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new G.g(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,V||(V=R.b.LastCreatedScene),this._scene=V,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const V=this._scene.getEngine().getCaps();this._canUseTextureForTargets=V.canUseGLVertexID&&V.textureFloat&&V.maxVertexTextureImageUnits>0&&V.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return O.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?O.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(V){this._numMaxInfluencers!==V&&(this._numMaxInfluencers=V,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(V){this._useTextureToStoreTargets!==V&&(this._useTextureToStoreTargets=V,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var V;return O.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(V=this._scene)&&void 0!==V&&V.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(V){return this._activeTargets.data[V]}getTarget(V){return this._targets[V]}getTargetByName(V){for(const h of this._targets)if(h.name===V)return h;return null}addTarget(V){this._targets.push(V),this._targetInfluenceChangedObservers.push(V.onInfluenceChanged.add((V=>{this.areUpdatesFrozen&&V&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(V)}))),this._targetDataLayoutChangedObservers.push(V._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(V){const h=this._targets.indexOf(V);h>=0&&(this._targets.splice(h,1),V.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(h,1)[0]),V._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(h,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(V)}_bind(V){V.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),V.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),V.setTexture("morphTargets",this._targetStoreTexture),V.setInt("morphTargetCount",this.numInfluencers)}clone(){const V=new O(this._scene);for(const h of this._targets)V.addTarget(h.clone());return V.enablePositionMorphing=this.enablePositionMorphing,V.enableNormalMorphing=this.enableNormalMorphing,V.enableTangentMorphing=this.enableTangentMorphing,V.enableUVMorphing=this.enableUVMorphing,V.enableUV2Morphing=this.enableUV2Morphing,V.enableColorMorphing=this.enableColorMorphing,V}serialize(){const V={};V.id=this.uniqueId,V.targets=[];for(const h of this._targets)V.targets.push(h.serialize());return V}_syncActiveTargets(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const h=!!this._targetStoreTexture,mV=this.isUsingTextureForTargets;(this._mustSynchronize||h!==mV)&&(this._mustSynchronize=!1,this.synchronize());let t=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let L=-1;for(const N of this._targets)if(L++,0!==N.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=O.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(N),this._morphTargetTextureIndices[t]=L,this._tempInfluences[t++]=N.influence}this._morphTargetTextureIndices.length!==t&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,t)),this._influences&&this._influences.length===t||(this._influences=new Float32Array(t));for(let N=0;N<t;N++)this._influences[N]=this._tempInfluences[N];if(V&&this._scene)for(const N of this._scene.meshes)N.morphTargetManager===this&&(mV?N._markSubMeshesAsAttributesDirty():N._syncGeometryWithMorphTargetManager())}synchronize(){var V;if(!this._scene||this.areUpdatesFrozen)return;const h=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(V=this._targetStoreTexture)||void 0===V||V.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>h.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const mV of this._targets){this._supportsPositions=this._supportsPositions&&mV.hasPositions,this._supportsNormals=this._supportsNormals&&mV.hasNormals,this._supportsTangents=this._supportsTangents&&mV.hasTangents,this._supportsUVs=this._supportsUVs&&mV.hasUVs,this._supportsUV2s=this._supportsUV2s&&mV.hasUV2s,this._supportsColors=this._supportsColors&&mV.hasColors;const V=mV.vertexCount;if(0===this._vertexCount)this._vertexCount=V;else if(this._vertexCount!==V)return void d.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${mV.name}": ${V}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const V=h.getCaps().maxTextureSize;this._textureWidth>V&&(this._textureHeight=Math.ceil(this._textureWidth/V),this._textureWidth=V);const mV=this._targets.length,t=new Float32Array(mV*this._textureWidth*this._textureHeight*4);let L=0;for(let h=0;h<mV;h++){const V=this._targets[h],mV=V.getPositions(),N=V.getNormals(),A=V.getUVs(),k=V.getTangents(),C=V.getUV2s(),K=V.getColors();L=h*this._textureWidth*this._textureHeight*4;for(let h=0;h<this._vertexCount;h++)this._supportsPositions&&mV&&(t[L]=mV[3*h],t[L+1]=mV[3*h+1],t[L+2]=mV[3*h+2],L+=4),this._supportsNormals&&N&&(t[L]=N[3*h],t[L+1]=N[3*h+1],t[L+2]=N[3*h+2],L+=4),this._supportsUVs&&A&&(t[L]=A[2*h],t[L+1]=A[2*h+1],L+=4),this._supportsTangents&&k&&(t[L]=k[3*h],t[L+1]=k[3*h+1],t[L+2]=k[3*h+2],L+=4),this._supportsUV2s&&C&&(t[L]=C[2*h],t[L+1]=C[2*h+1],L+=4),this._supportsColors&&K&&(t[L]=K[4*h],t[L+1]=K[4*h+1],t[L+2]=K[4*h+2],t[L+3]=K[4*h+3],L+=4)}this._targetStoreTexture=y.e.CreateRGBATexture(t,this._textureWidth,this._textureHeight,mV,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const mV of this._scene.meshes)mV.morphTargetManager===this&&mV._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const V=this._parentContainer.morphTargetManagers.indexOf(this);V>-1&&this._parentContainer.morphTargetManagers.splice(V,1),this._parentContainer=null}for(const V of this._targets)this._scene.stopAnimation(V)}}static Parse(V,h){const mV=new O(h);for(const t of V.targets)mV.addTarget(l.c.Parse(t,h));return mV}}O.EnableTextureStorage=!0,O.MaxActiveMorphTargetsInVertexAttributeMode=8,O.ConstantTargetCountForTextureMode=0;var I=mV(14047),r=mV(12303),T=mV(12734);const F=new Map,p=F;function Z(V,h,mV){f(V)&&d.e.Warn(`Extension with the name '${V}' already exists`),F.set(V,{isGLTFExtension:h,factory:mV})}function f(V){return F.delete(V)}var S=mV(14056),Y=mV(12988),w=mV(12495);class E{static Get(V,h,mV){if(!h||void 0==mV||!h[mV])throw new Error(`${V}: Failed to find index (${mV})`);return h[mV]}static TryGet(V,h){return V&&void 0!=h&&V[h]?V[h]:null}static Assign(V){if(V)for(let h=0;h<V.length;h++)V[h].index=h}}function g(V){if(V.min&&V.max){const h=V.min,mV=V.max,t=L.TmpVectors.sh[0].Hk(h[0],h[1],h[2]),N=L.TmpVectors.sh[1].Hk(mV[0],mV[1],mV[2]);if(V.normalized&&5126!==V.componentType){let h=1;switch(V.componentType){case 5120:h=127;break;case 5121:h=255;break;case 5122:h=32767;break;case 5123:h=65535}const mV=1/h;t.scaleInPlace(mV),N.scaleInPlace(mV)}return new T.e(t,N)}return null}class i{static RegisterExtension(V,h){Z(V,!1,h)}static UnregisterExtension(V){return f(V)}get qk(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(V){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=V}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((V=>V.dispose&&V.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(V,h,mV,t,L,N){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=h,this._assetContainer=mV,this._loadData(t);let N=null;if(V){const h={};if(this._gltf.nodes)for(const V of this._gltf.nodes)V.name&&(h[V.name]=V.index);N=(V instanceof Array?V:[V]).map((V=>{const mV=h[V];if(void 0===mV)throw new Error(`Failed to find node '${V}'`);return mV}))}return await this._loadAsync(L,A,N,(()=>({meshes:this._getMeshes(),Lq:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=V,this._loadData(h),await this._loadAsync(mV,L,null,(()=>{}))}async _loadAsync(V,h,mV,t){return await Promise.resolve().then((async()=>{this._rootUrl=V,this._uniqueRootUrl=!V.startsWith("file:")&&h?V:`${V}${Date.now()}/`,this._fileName=h,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const L=`${I.n[I.n.LOADING]} => ${I.n[I.n.READY]}`,N=`${I.n[I.n.LOADING]} => ${I.n[I.n.COMPLETE]}`;this._parent._startPerformanceCounter(L),this._parent._startPerformanceCounter(N),this._parent._setState(I.n.LOADING),this._extensionsOnLoading();const k=new Array;if(!this.parent.loadOnlyMaterials)if(mV)k.push(this.loadSceneAsync("/nodes",{nodes:mV,index:-1}));else if(void 0!=this._gltf.zh||this._gltf.scenes&&this._gltf.scenes[0]){const V=E.Get("/scene",this._gltf.scenes,this._gltf.zh||0);k.push(this.loadSceneAsync(`/scenes/${V.index}`,V))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let V=0;V<this._gltf.materials.length;++V){const h=this._gltf.materials[V],mV="/materials/"+V,t=c.c.TriangleFillMode;k.push(this._loadMaterialAsync(mV,h,null,t,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&k.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&k.push(this._compileShadowGeneratorsAsync());const C=Promise.all(k).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.ek(!0);for(const V of this._babylonScene.materials){const h=V;void 0!==h.maxSimultaneousLights&&(h.maxSimultaneousLights=Math.max(h.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(I.n.READY),this._skipStartAnimationStep||this._startAnimations(),t()}));return await C.then((V=>(this._parent._endPerformanceCounter(L),A.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(N),this._parent._setState(I.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(V=>{this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()}))})),V)))})).catch((V=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(V),this._parent.onErrorObservable.clear(),this.dispose()),V}))}_loadData(V){if(this._gltf=V.json,this._setupData(),V.bin){const h=this._gltf.buffers;if(h&&h[0]&&!h[0].uri){const mV=h[0];(mV.byteLength<V.bin.byteLength-3||mV.byteLength>V.bin.byteLength)&&d.e.Warn(`Binary buffer length (${mV.byteLength}) from JSON does not match chunk length (${V.bin.byteLength})`),this._bin=V.bin}else d.e.Warn("Unexpected BIN chunk")}}_setupData(){if(E.Assign(this._gltf.accessors),E.Assign(this._gltf.animations),E.Assign(this._gltf.buffers),E.Assign(this._gltf.bufferViews),E.Assign(this._gltf.cameras),E.Assign(this._gltf.images),E.Assign(this._gltf.materials),E.Assign(this._gltf.meshes),E.Assign(this._gltf.nodes),E.Assign(this._gltf.samplers),E.Assign(this._gltf.scenes),E.Assign(this._gltf.skins),E.Assign(this._gltf.textures),this._gltf.nodes){const V={};for(const mV of this._gltf.nodes)if(mV.children)for(const h of mV.children)V[h]=mV.index;const h=this._createRootNode();for(const mV of this._gltf.nodes){const t=V[mV.index];mV.parent=void 0===t?h:this._gltf.nodes[t]}}}async _loadExtensionsAsync(){const V=[];if(p.forEach(((h,mV)=>{var t;!1===(null===(t=this.parent.extensionOptions[mV])||void 0===t?void 0:t.enabled)?h.isGLTFExtension&&this.isExtensionUsed(mV)&&d.e.Warn(`Extension ${mV} is used but has been explicitly disabled.`):h.isGLTFExtension&&!this.isExtensionUsed(mV)||V.push((async()=>{const V=await h.factory(this);return V.name!==mV&&d.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${V.name} !== ${mV}`),this._parent.onExtensionLoadedObservable.notifyObservers(V),V})())})),this._extensions.push(...await Promise.all(V)),this._extensions.sort(((V,h)=>(V.order||Number.MAX_VALUE)-(h.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const mV of this._gltf.extensionsRequired){if(!this._extensions.some((V=>V.name===mV&&V.enabled))){var h;if(!1===(null===(h=this.parent.extensionOptions[mV])||void 0===h?void 0:h.enabled))throw new Error(`Required extension ${mV} is disabled`);throw new Error(`Required extension ${mV} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new j.c("__root__",this._babylonScene);this._rootBabylonMesh=V,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.ek(!1);const h={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case I.l.AUTO:this._babylonScene.useRightHandedSystem||(h.rotation=[0,1,0,0],h.scale=[1,1,-1],i._LoadTransform(h,this._rootBabylonMesh));break;case I.l.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(V),h}loadSceneAsync(V,h){const mV=this._extensionsLoadSceneAsync(V,h);if(mV)return mV;const t=new Array;if(this.logOpen(`${V} ${h.name||""}`),h.nodes)for(const L of h.nodes){const h=E.Get(`${V}/nodes/${L}`,this._gltf.nodes,L);t.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(V=>{V.parent=this._rootBabylonMesh})))}for(const L of this._postSceneLoadActions)L();return t.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(t).then((()=>{}))}_forEachPrimitive(V,h){if(V._primitiveBabylonMeshes)for(const mV of V._primitiveBabylonMeshes)h(mV)}_getGeometries(){const V=[],h=this._gltf.nodes;if(h)for(const mV of h)this._forEachPrimitive(mV,(h=>{const mV=h.Jk;mV&&-1===V.indexOf(mV)&&V.push(mV)}));return V}_getMeshes(){const V=[];this._rootBabylonMesh instanceof H.e&&V.push(this._rootBabylonMesh);const h=this._gltf.nodes;if(h)for(const mV of h)this._forEachPrimitive(mV,(h=>{V.push(h)}));return V}_getTransformNodes(){const V=[],h=this._gltf.nodes;if(h)for(const mV of h)mV._babylonTransformNode&&"td"===mV._babylonTransformNode.getClassName()&&V.push(mV._babylonTransformNode),mV._babylonTransformNodeForSkin&&V.push(mV._babylonTransformNodeForSkin);return V}_getSkeletons(){const V=[],h=this._gltf.skins;if(h)for(const mV of h)mV._data&&V.push(mV._data.babylonSkeleton);return V}_getAnimationGroups(){const V=[],h=this._gltf.animations;if(h)for(const mV of h)mV._babylonAnimationGroup&&V.push(mV._babylonAnimationGroup);return V}_startAnimations(){switch(this._parent.animationStartMode){case I.h.NONE:break;case I.h.FIRST:{const V=this._getAnimationGroups();0!==V.length&&V[0].start(!0);break}case I.h.ALL:{const V=this._getAnimationGroups();for(const h of V)h.start(!0);break}default:return void d.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadNodeAsync(V,h,mV);if(t)return t;if(h._babylonTransformNode)throw new Error(`${V}: Invalid recursive node hierarchy`);const L=new Array;this.logOpen(`${V} ${h.name||""}`);const N=t=>{if(i.AddPointerMetadata(t,V),i._LoadTransform(h,t),void 0!=h.camera){const mV=E.Get(`${V}/camera`,this._gltf.cameras,h.camera);L.push(this.loadCameraAsync(`/cameras/${mV.index}`,mV,(V=>{V.parent=t,this._babylonScene.useRightHandedSystem||(t.jk.x=-1)})))}if(h.children)for(const mV of h.children){const h=E.Get(`${V}/children/${mV}`,this._gltf.nodes,mV);L.push(this.loadNodeAsync(`/nodes/${h.index}`,h,(V=>{V.parent=t})))}mV(t)},A=void 0!=h.mesh,k=this._parent.loadSkins&&void 0!=h.skin;if(!A||k){const V=h.name||`node${h.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const mV=new J.c(V,this._babylonScene);mV._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==h.mesh?h._babylonTransformNode=mV:h._babylonTransformNodeForSkin=mV,N(mV)}if(A)if(k){const mV=E.Get(`${V}/mesh`,this._gltf.meshes,h.mesh);L.push(this._loadMeshAsync(`/meshes/${mV.index}`,h,mV,(mV=>{const t=h._babylonTransformNodeForSkin;mV.metadata=(0,Y.b)(t.metadata,mV.metadata||{});const N=E.Get(`${V}/skin`,this._gltf.skins,h.skin);L.push(this._loadSkinAsync(`/skins/${N.index}`,h,N,(V=>{this._forEachPrimitive(h,(h=>{h.skeleton=V})),this._postSceneLoadActions.push((()=>{if(void 0!=N.skeleton){const V=E.Get(`/skins/${N.index}/skeleton`,this._gltf.nodes,N.skeleton).parent;h.index===V.index?mV.parent=t.parent:mV.parent=V._babylonTransformNode}else mV.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:t,skinnedNode:mV})}))})))})))}else{const mV=E.Get(`${V}/mesh`,this._gltf.meshes,h.mesh);L.push(this._loadMeshAsync(`/meshes/${mV.index}`,h,mV,N))}return this.logClose(),Promise.all(L).then((()=>(this._forEachPrimitive(h,(V=>{const h=V;!h.isAnInstance&&h.Jk&&h.Jk.useBoundingInfoFromGeometry?V.TV():V.refreshBoundingInfo(!0,!0)})),h._babylonTransformNode)))}_loadMeshAsync(V,h,mV,t){const L=mV.primitives;if(!L||!L.length)throw new Error(`${V}: Primitives are missing`);void 0==L[0].index&&E.Assign(L);const N=new Array;this.logOpen(`${V} ${mV.name||""}`);const A=h.name||`node${h.index}`;if(1===L.length){const t=mV.primitives[0];N.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${t.index}`,A,h,mV,t,(V=>{h._babylonTransformNode=V,h._primitiveBabylonMeshes=[V]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,h._babylonTransformNode=new J.c(A,this._babylonScene),h._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._primitiveBabylonMeshes=[];for(const t of L)N.push(this._loadMeshPrimitiveAsync(`${V}/primitives/${t.index}`,`${A}_primitive${t.index}`,h,mV,t,(V=>{V.parent=h._babylonTransformNode,h._primitiveBabylonMeshes.push(V)})))}return t(h._babylonTransformNode),this.logClose(),Promise.all(N).then((()=>h._babylonTransformNode))}_loadMeshPrimitiveAsync(V,h,mV,t,L,N){const A=this._extensionsLoadMeshPrimitiveAsync(V,h,mV,t,L,N);if(A)return A;this.logOpen(`${V}`);const k=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==mV.skin&&!t.primitives[0].targets;let C,K;if(k&&L._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,C=L._instanceData.babylonSourceMesh.createInstance(h),C._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,K=L._instanceData.promise;else{const N=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new j.c(h,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.sideOrientation=this._babylonScene.useRightHandedSystem?c.c.CounterClockWiseSideOrientation:c.c.ClockWiseSideOrientation,this._createMorphTargets(V,mV,t,L,A),N.push(this._loadVertexDataAsync(V,L,A).then((async h=>await this._loadMorphTargetsAsync(V,L,A,h).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,h.IV(A),h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const o=i._GetDrawMode(V,L.mode);if(void 0==L.material){let V=this._defaultBabylonMaterialData[o];V||(V=this._createDefaultMaterial("__GLTFLoader._default",o),this._parent.onMaterialLoadedObservable.notifyObservers(V),this._defaultBabylonMaterialData[o]=V),A.material=V}else if(!this.parent.skipMaterials){const h=E.Get(`${V}/material`,this._gltf.materials,L.material);N.push(this._loadMaterialAsync(`/materials/${h.index}`,h,A,o,(V=>{A.material=V})))}K=Promise.all(N),k&&(L._instanceData={babylonSourceMesh:A,promise:K}),C=A}return i.AddPointerMetadata(C,V),this._parent.onMeshLoadedObservable.notifyObservers(C),N(C),this.logClose(),K.then((()=>C))}_loadVertexDataAsync(V,h,mV){const t=this._extensionsLoadVertexDataAsync(V,h,mV);if(t)return t;const L=h.attributes;if(!L)throw new Error(`${V}: Attributes are missing`);const N=new Array,A=new D.e(mV.name,this._babylonScene);if(void 0==h.indices)mV.isUnIndexed=!0;else{const mV=E.Get(`${V}/indices`,this._gltf.accessors,h.indices);N.push(this._loadIndicesAccessorAsync(`/accessors/${mV.index}`,mV).then((V=>{A.setIndices(V)})))}const k=(h,t,k)=>{if(void 0==L[h])return;mV._delayInfo=mV._delayInfo||[],-1===mV._delayInfo.indexOf(t)&&mV._delayInfo.push(t);const C=E.Get(`${V}/attributes/${h}`,this._gltf.accessors,L[h]);N.push(this._loadVertexAccessorAsync(`/accessors/${C.index}`,C,t).then((V=>{if(V.getKind()===v.i.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!mV.skeleton){const V=g(C);V&&(A._boundingInfo=V,A.useBoundingInfoFromGeometry=!0)}A.setVerticesBuffer(V,C.count)}))),t==v.i.MatricesIndicesExtraKind&&(mV.numBoneInfluencers=8),k&&k(C)};return k("POSITION",v.i.PositionKind),k("NORMAL",v.i.NormalKind),k("TANGENT",v.i.TangentKind),k("TEXCOORD_0",v.i.UVKind),k("TEXCOORD_1",v.i.UV2Kind),k("TEXCOORD_2",v.i.UV3Kind),k("TEXCOORD_3",v.i.UV4Kind),k("TEXCOORD_4",v.i.UV5Kind),k("TEXCOORD_5",v.i.UV6Kind),k("JOINTS_0",v.i.MatricesIndicesKind),k("WEIGHTS_0",v.i.MatricesWeightsKind),k("JOINTS_1",v.i.MatricesIndicesExtraKind),k("WEIGHTS_1",v.i.MatricesWeightsExtraKind),k("COLOR_0",v.i.ColorKind,(V=>{"VEC4"===V.type&&(mV.hasVertexAlpha=!0)})),Promise.all(N).then((()=>A))}_createMorphTargets(V,h,mV,t,L){if(!t.targets||!this._parent.loadMorphTargets)return;if(void 0==h._numMorphTargets)h._numMorphTargets=t.targets.length;else if(t.targets.length!==h._numMorphTargets)throw new Error(`${V}: Primitives do not have the same number of targets`);const N=mV.extras?mV.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,L.morphTargetManager=new O(this._babylonScene),L.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.morphTargetManager.areUpdatesFrozen=!0;for(let A=0;A<t.targets.length;A++){const V=h.weights?h.weights[A]:mV.weights?mV.weights[A]:0,t=N?N[A]:`morphTarget${A}`;L.morphTargetManager.addTarget(new l.c(t,V,L.DV()))}}_loadMorphTargetsAsync(V,h,mV,t){if(!h.targets||!this._parent.loadMorphTargets)return Promise.resolve();const L=new Array,N=mV.morphTargetManager;for(let A=0;A<N.numTargets;A++){const mV=N.getTarget(A);L.push(this._loadMorphTargetVertexDataAsync(`${V}/targets/${A}`,t,h.targets[A],mV))}return Promise.all(L).then((()=>{N.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(V,h,mV,t){const L=new Array,N=(t,N,A)=>{if(void 0==mV[t])return;const k=h.getVertexBuffer(N);if(!k)return;const C=E.Get(`${V}/${t}`,this._gltf.accessors,mV[t]);L.push(this._loadFloatAccessorAsync(`/accessors/${C.index}`,C).then((V=>{A(k,V)})))};return N("POSITION",v.i.PositionKind,((V,h)=>{const mV=new Float32Array(h.length);V.forEach(h.length,((V,t)=>{mV[t]=h[t]+V})),t.setPositions(mV)})),N("NORMAL",v.i.NormalKind,((V,h)=>{const mV=new Float32Array(h.length);V.forEach(mV.length,((V,t)=>{mV[t]=h[t]+V})),t.setNormals(mV)})),N("TANGENT",v.i.TangentKind,((V,h)=>{const mV=new Float32Array(h.length/3*4);let L=0;V.forEach(h.length/3*4,((V,t)=>{(t+1)%4!==0&&(mV[L]=h[L]+V,L++)})),t.setTangents(mV)})),N("TEXCOORD_0",v.i.UVKind,((V,h)=>{const mV=new Float32Array(h.length);V.forEach(h.length,((V,t)=>{mV[t]=h[t]+V})),t.setUVs(mV)})),N("TEXCOORD_1",v.i.UV2Kind,((V,h)=>{const mV=new Float32Array(h.length);V.forEach(h.length,((V,t)=>{mV[t]=h[t]+V})),t.setUV2s(mV)})),N("COLOR_0",v.i.ColorKind,((h,mV)=>{let L=null;const N=h.getSize();if(3===N){L=new Float32Array(mV.length/3*4),h.forEach(mV.length,((V,h)=>{const t=Math.floor(h/3),N=h%3;L[4*t+N]=mV[3*t+N]+V}));for(let V=0;V<mV.length/3;++V)L[4*V+3]=1}else{if(4!==N)throw new Error(`${V}: Invalid number of components (${N}) for COLOR_0 attribute`);L=new Float32Array(mV.length),h.forEach(mV.length,((V,h)=>{L[h]=mV[h]+V}))}t.setColors(L)})),await Promise.all(L).then((()=>{}))}static _LoadTransform(V,h){if(void 0!=V.skin)return;let mV=L.sh.Zero(),t=L.Quaternion.Identity(),N=L.sh.One();if(V.matrix){L.Matrix.Dh(V.matrix).decompose(N,t,mV)}else V.translation&&(mV=L.sh.Dh(V.translation)),V.rotation&&(t=L.Quaternion.Dh(V.rotation)),V.scale&&(N=L.sh.Dh(V.scale));h.position=mV,h.rotationQuaternion=t,h.jk=N}_loadSkinAsync(V,h,mV,t){if(!this._parent.loadSkins)return Promise.resolve();const L=this._extensionsLoadSkinAsync(V,h,mV);if(L)return L;if(mV._data)return t(mV._data.babylonSkeleton),mV._data.promise;const N=`skeleton${mV.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new M(mV.name||N,N,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(V,mV,A);const k=this._loadSkinInverseBindMatricesDataAsync(V,mV).then((V=>{this._updateBoneMatrices(A,V)}));return mV._data={babylonSkeleton:A,promise:k},t(A),k}_loadBones(V,h,mV){if(void 0==h.skeleton||this._parent.alwaysComputeSkeletonRootNode){const mV=this._findSkeletonRootNode(`${V}/joints`,h.joints);if(mV)if(void 0===h.skeleton)h.skeleton=mV.index;else{const t=(V,h)=>{for(;h.parent;h=h.parent)if(h.parent===V)return!0;return!1},L=E.Get(`${V}/skeleton`,this._gltf.nodes,h.skeleton);L===mV||t(L,mV)||(d.e.Warn(`${V}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),h.skeleton=mV.index)}else d.e.Warn(`${V}: Failed to find common root`)}const t={};for(const L of h.joints){const N=E.Get(`${V}/joints/${L}`,this._gltf.nodes,L);this._loadBone(N,h,mV,t)}}_findSkeletonRootNode(V,h){if(0===h.length)return null;const mV={};for(const L of h){const h=[];let t=E.Get(`${V}/${L}`,this._gltf.nodes,L);for(;-1!==t.index;)h.unshift(t),t=t.parent;mV[L]=h}let t=null;for(let L=0;;++L){let V=mV[h[0]];if(L>=V.length)return t;const N=V[L];for(let A=1;A<h.length;++A)if(V=mV[h[A]],L>=V.length||N!==V[L])return t;t=N}}_loadBone(V,h,mV,t){V._isJoint=!0;let L=t[V.index];if(L)return L;let N=null;V.index!==h.skeleton&&(V.parent&&-1!==V.parent.index?N=this._loadBone(V.parent,h,mV,t):void 0!==h.skeleton&&d.e.Warn(`/skins/${h.index}/skeleton: Skeleton node is not a common root`));const A=h.joints.indexOf(V.index);return L=new K.d(V.name||`joint${V.index}`,mV,N,this._getNodeMatrix(V),null,null,A),t[V.index]=L,this._postSceneLoadActions.push((()=>{L.linkTransformNode(V._babylonTransformNode)})),L}_loadSkinInverseBindMatricesDataAsync(V,h){if(void 0==h.inverseBindMatrices)return Promise.resolve(null);const mV=E.Get(`${V}/inverseBindMatrices`,this._gltf.accessors,h.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${mV.index}`,mV)}_updateBoneMatrices(V,h){for(const mV of V.bones){const V=L.Matrix.Identity(),t=mV._index;h&&-1!==t&&(L.Matrix.FromArrayToRef(h,16*t,V),V.invertToRef(V));const N=mV.getParent();N&&V.multiplyToRef(N.getAbsoluteInverseBindMatrix(),V),mV.zk(V,!1,!1),mV._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(V){return V.matrix?L.Matrix.Dh(V.matrix):L.Matrix.Compose(V.scale?L.sh.Dh(V.scale):L.sh.One(),V.rotation?L.Quaternion.Dh(V.rotation):L.Quaternion.Identity(),V.translation?L.sh.Dh(V.translation):L.sh.Zero())}loadCameraAsync(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadCameraAsync(V,h,mV);if(t)return t;const N=new Array;this.logOpen(`${V} ${h.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new C.c(h.name||`camera${h.index}`,L.sh.Zero(),this._babylonScene,!1);switch(A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonCamera=A,A.setTarget(new L.sh(0,0,-1)),h.type){case"perspective":{const mV=h.perspective;if(!mV)throw new Error(`${V}: Camera perspective properties are missing`);A.fov=mV.yfov,A.ck=mV.znear,A.maxZ=mV.zfar||0;break}case"orthographic":if(!h.orthographic)throw new Error(`${V}: Camera orthographic properties are missing`);A.mode=k.b.ORTHOGRAPHIC_CAMERA,A.orthoLeft=-h.orthographic.xmag,A.orthoRight=h.orthographic.xmag,A.orthoBottom=-h.orthographic.ymag,A.orthoTop=h.orthographic.ymag,A.ck=h.orthographic.znear,A.maxZ=h.orthographic.zfar;break;default:throw new Error(`${V}: Invalid camera type (${h.type})`)}return i.AddPointerMetadata(A,V),this._parent.onCameraLoadedObservable.notifyObservers(A),mV(A),this.logClose(),Promise.all(N).then((()=>A))}_loadAnimationsAsync(){const V=this._gltf.animations;if(!V)return Promise.resolve();const h=new Array;for(let mV=0;mV<V.length;mV++){const t=V[mV];h.push(this.loadAnimationAsync(`/animations/${t.index}`,t).then((V=>{0===V.targetedAnimations.length&&V.dispose()})))}return Promise.all(h).then((()=>{}))}loadAnimationAsync(V,h){const t=this._extensionsLoadAnimationAsync(V,h);return t||mV.e(78).then(mV.bind(mV,15540)).then((mV=>{let{AnimationGroup:t}=mV;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new t(h.name||`animation${h.index}`,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h._babylonAnimationGroup=L;const N=new Array;E.Assign(h.channels),E.Assign(h.samplers);for(const A of h.channels)N.push(this._loadAnimationChannelAsync(`${V}/channels/${A.index}`,V,h,A,((V,h)=>{V.animations=V.animations||[],V.animations.push(h),L.addTargetedAnimation(h,V)})));return Promise.all(N).then((()=>(L.normalize(0),L)))}))}async _loadAnimationChannelAsync(V,h,t,L,N){const A=this._extensionsLoadAnimationChannelAsync(V,h,t,L,N);if(A)return await A;if(void 0==L.target.node)return await Promise.resolve();const k=E.Get(`${V}/target/node`,this._gltf.nodes,L.target.node),C=L.target.path,K="weights"===C;if(K&&!k._numMorphTargets||!K&&!k._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!K&&!k._isJoint)return await Promise.resolve();let o;switch(await Promise.resolve().then(mV.bind(mV,14063)),C){case"translation":var n;o=null===(n=(0,S.g)("/nodes/{}/translation"))||void 0===n?void 0:n.interpolation;break;case"rotation":var q;o=null===(q=(0,S.g)("/nodes/{}/rotation"))||void 0===q?void 0:q.interpolation;break;case"scale":var x;o=null===(x=(0,S.g)("/nodes/{}/scale"))||void 0===x?void 0:x.interpolation;break;case"weights":var R;o=null===(R=(0,S.g)("/nodes/{}/weights"))||void 0===R?void 0:R.interpolation;break;default:throw new Error(`${V}/target/path: Invalid value (${L.target.path})`)}if(!o)throw new Error(`${V}/target/path: Could not find interpolation properties for target path (${L.target.path})`);const d={object:k,info:o};return await this._loadAnimationChannelFromTargetInfoAsync(V,h,t,L,d,N)}_loadAnimationChannelFromTargetInfoAsync(V,h,mV,t,L,N){const A=this.parent.targetFps,k=1/A,C=E.Get(`${V}/sampler`,mV.samplers,t.sampler);return this._loadAnimationSamplerAsync(`${h}/samplers/${t.sampler}`,C).then((V=>{let h=0;const C=L.object,K=L.info;for(const L of K){const K=L.getStride(C),o=V.input,n=V.output,q=new Array(o.length);let x=0;switch(V.interpolation){case"STEP":for(let V=0;V<o.length;V++){const h=L.getValue(C,n,x,1);x+=K,q[V]={frame:o[V]*A,value:h,interpolation:1}}break;case"CUBICSPLINE":for(let V=0;V<o.length;V++){const h=L.getValue(C,n,x,k);x+=K;const mV=L.getValue(C,n,x,1);x+=K;const t=L.getValue(C,n,x,k);x+=K,q[V]={frame:o[V]*A,inTangent:h,value:mV,outTangent:t}}break;case"LINEAR":for(let V=0;V<o.length;V++){const h=L.getValue(C,n,x,1);x+=K,q[V]={frame:o[V]*A,value:h}}}if(x>0){const V=`${mV.name||`animation${mV.index}`}_channel${t.index}_${h}`,k=L.buildAnimations(C,V,A,q);for(const mV of k)h++,N(mV.babylonAnimatable,mV.babylonAnimation)}}}))}_loadAnimationSamplerAsync(V,h){if(h._data)return h._data;const mV=h.interpolation||"LINEAR";switch(mV){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${V}/interpolation: Invalid value (${h.interpolation})`)}const t=E.Get(`${V}/input`,this._gltf.accessors,h.input),L=E.Get(`${V}/output`,this._gltf.accessors,h.output);return h._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${t.index}`,t),this._loadFloatAccessorAsync(`/accessors/${L.index}`,L)]).then((V=>{let[h,t]=V;return{input:h,interpolation:mV,output:t}})),h._data}loadBufferAsync(V,h,mV,t){const L=this._extensionsLoadBufferAsync(V,h,mV,t);if(L)return L;if(!h._data)if(h.uri)h._data=this.loadUriAsync(`${V}/uri`,h,h.uri);else{if(!this._bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);h._data=this._bin.readAsync(0,h.byteLength)}return h._data.then((h=>{try{return new Uint8Array(h.buffer,h.byteOffset+mV,t)}catch(L){throw new Error(`${V}: ${L.message}`)}}))}loadBufferViewAsync(V,h){const mV=this._extensionsLoadBufferViewAsync(V,h);if(mV)return mV;if(h._data)return h._data;const t=E.Get(`${V}/buffer`,this._gltf.buffers,h.buffer);return h._data=this.loadBufferAsync(`/buffers/${t.index}`,t,h.byteOffset||0,h.byteLength),h._data}_loadAccessorAsync(V,h,mV){if(h._data)return h._data;const t=i._GetNumComponents(V,h.type),L=t*v.i.GetTypeByteLength(h.componentType),N=t*h.count;if(void 0==h.bufferView)h._data=Promise.resolve(new mV(N));else{const A=E.Get(`${V}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((k=>{if(5126!==h.componentType||h.normalized||A.byteStride&&A.byteStride!==L){const V=new mV(N);return v.i.ForEach(k,h.byteOffset||0,A.byteStride||L,t,h.componentType,V.length,h.normalized||!1,((h,mV)=>{V[mV]=h})),V}return i._GetTypedArray(V,h.componentType,k,h.byteOffset,N)}))}if(h.sparse){const N=h.sparse;h._data=h._data.then((A=>{const k=A,C=E.Get(`${V}/sparse/indices/bufferView`,this._gltf.bufferViews,N.indices.bufferView),K=E.Get(`${V}/sparse/values/bufferView`,this._gltf.bufferViews,N.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${C.index}`,C),this.loadBufferViewAsync(`/bufferViews/${K.index}`,K)]).then((A=>{let[C,K]=A;const o=i._GetTypedArray(`${V}/sparse/indices`,N.indices.componentType,C,N.indices.byteOffset,N.count),n=t*N.count;let q;if(5126!==h.componentType||h.normalized){const A=i._GetTypedArray(`${V}/sparse/values`,h.componentType,K,N.values.byteOffset,n);q=new mV(n),v.i.ForEach(A,0,L,t,h.componentType,q.length,h.normalized||!1,((V,h)=>{q[h]=V}))}else q=i._GetTypedArray(`${V}/sparse/values`,h.componentType,K,N.values.byteOffset,n);let x=0;for(let V=0;V<o.length;V++){let h=o[V]*t;for(let V=0;V<t;V++)k[h++]=q[x++]}return k}))}))}return h._data}_loadFloatAccessorAsync(V,h){return this._loadAccessorAsync(V,h,Float32Array)}_loadIndicesAccessorAsync(V,h){if("SCALAR"!==h.type)throw new Error(`${V}/type: Invalid value ${h.type}`);if(5121!==h.componentType&&5123!==h.componentType&&5125!==h.componentType)throw new Error(`${V}/componentType: Invalid value ${h.componentType}`);if(h._data)return h._data;if(h.sparse){const mV=i._GetTypedArrayConstructor(`${V}/componentType`,h.componentType);h._data=this._loadAccessorAsync(V,h,mV)}else{const mV=E.Get(`${V}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${mV.index}`,mV).then((mV=>i._GetTypedArray(V,h.componentType,mV,h.byteOffset,h.count)))}return h._data}_loadVertexBufferViewAsync(V){if(V._babylonBuffer)return V._babylonBuffer;const h=this._babylonScene.getEngine();return V._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${V.index}`,V).then((V=>new v.e(h,V,!1))),V._babylonBuffer}_loadVertexAccessorAsync(V,h,mV){var t;if(null!==(t=h._babylonVertexBuffer)&&void 0!==t&&t[mV])return h._babylonVertexBuffer[mV];h._babylonVertexBuffer||(h._babylonVertexBuffer={});const L=this._babylonScene.getEngine();if(h.sparse||void 0==h.bufferView)h._babylonVertexBuffer[mV]=this._loadFloatAccessorAsync(V,h).then((V=>new v.i(L,V,mV,!1)));else{const t=E.Get(`${V}/bufferView`,this._gltf.bufferViews,h.bufferView);h._babylonVertexBuffer[mV]=this._loadVertexBufferViewAsync(t).then((N=>{const A=i._GetNumComponents(V,h.type);return new v.i(L,N,mV,!1,void 0,t.byteStride,void 0,h.byteOffset,A,h.componentType,h.normalized,!0,void 0,!0)}))}return h._babylonVertexBuffer[mV]}_loadMaterialMetallicRoughnessPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return h&&(h.baseColorFactor?(mV.albedoColor=N.Jh.Dh(h.baseColorFactor),mV.alpha=h.baseColorFactor[3]):mV.albedoColor=N.Jh.White(),mV.metallic=void 0==h.metallicFactor?1:h.metallicFactor,mV.roughness=void 0==h.roughnessFactor?1:h.roughnessFactor,h.baseColorTexture&&t.push(this.loadTextureInfoAsync(`${V}/baseColorTexture`,h.baseColorTexture,(V=>{V.name=`${mV.name} (Base Color)`,mV.albedoTexture=V}))),h.metallicRoughnessTexture&&(h.metallicRoughnessTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${V}/metallicRoughnessTexture`,h.metallicRoughnessTexture,(V=>{V.name=`${mV.name} (Metallic Roughness)`,mV.metallicTexture=V}))),mV.useMetallnessFromMetallicTextureBlue=!0,mV.useRoughnessFromMetallicTextureGreen=!0,mV.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(t).then((()=>{}))}_loadMaterialAsync(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const N=this._extensionsLoadMaterialAsync(V,h,mV,t,L);if(N)return N;h._data=h._data||{};let A=h._data[t];if(!A){this.logOpen(`${V} ${h.name||""}`);const mV=this.createMaterial(V,h,t);A={babylonMaterial:mV,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(V,h,mV)},h._data[t]=A,i.AddPointerMetadata(mV,V),this._parent.onMaterialLoadedObservable.notifyObservers(mV),this.logClose()}return mV&&(A.babylonMeshes.push(mV),mV.XL.addOnce((()=>{const V=A.babylonMeshes.indexOf(mV);-1!==V&&A.babylonMeshes.splice(V,1)}))),L(A.babylonMaterial),A.promise.then((()=>A.babylonMaterial))}_createDefaultMaterial(V,h){this._babylonScene._blockEntityCollection=!!this._assetContainer;const mV=new z.c(V,this._babylonScene);return mV._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,mV.fillMode=h,mV.enableSpecularAntiAliasing=!0,mV.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,mV.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,mV.transparencyMode=z.c.PBRMATERIAL_OPAQUE,mV.metallic=1,mV.roughness=1,mV}createMaterial(V,h,mV){const t=this._extensionsCreateMaterial(V,h,mV);if(t)return t;const L=h.name||`material${h.index}`;return this._createDefaultMaterial(L,mV)}loadMaterialPropertiesAsync(V,h,mV){const t=this._extensionsLoadMaterialPropertiesAsync(V,h,mV);if(t)return t;const L=new Array;return L.push(this.loadMaterialBasePropertiesAsync(V,h,mV)),h.pbrMetallicRoughness&&L.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${V}/pbrMetallicRoughness`,h.pbrMetallicRoughness,mV)),this.loadMaterialAlphaProperties(V,h,mV),Promise.all(L).then((()=>{}))}loadMaterialBasePropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return mV.emissiveColor=h.emissiveFactor?N.Jh.Dh(h.emissiveFactor):new N.Jh(0,0,0),h.doubleSided&&(mV.Dk=!1,mV.twoSidedLighting=!0),h.normalTexture&&(h.normalTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${V}/normalTexture`,h.normalTexture,(V=>{V.name=`${mV.name} (Normal)`,mV.bumpTexture=V}))),mV.invertNormalMapX=!this._babylonScene.useRightHandedSystem,mV.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=h.normalTexture.scale&&mV.bumpTexture&&(mV.bumpTexture.level=h.normalTexture.scale),mV.forceIrradianceInFragment=!0),h.occlusionTexture&&(h.occlusionTexture.nonColorData=!0,t.push(this.loadTextureInfoAsync(`${V}/occlusionTexture`,h.occlusionTexture,(V=>{V.name=`${mV.name} (Occlusion)`,mV.ambientTexture=V}))),mV.useAmbientInGrayScale=!0,void 0!=h.occlusionTexture.strength&&(mV.ambientTextureStrength=h.occlusionTexture.strength)),h.emissiveTexture&&t.push(this.loadTextureInfoAsync(`${V}/emissiveTexture`,h.emissiveTexture,(V=>{V.name=`${mV.name} (Emissive)`,mV.emissiveTexture=V}))),Promise.all(t).then((()=>{}))}loadMaterialAlphaProperties(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);switch(h.alphaMode||"OPAQUE"){case"OPAQUE":mV.transparencyMode=z.c.PBRMATERIAL_OPAQUE,mV.alpha=1;break;case"MASK":mV.transparencyMode=z.c.PBRMATERIAL_ALPHATEST,mV.alphaCutOff=void 0==h.alphaCutoff?.5:h.alphaCutoff,mV.albedoTexture&&(mV.albedoTexture.Mk=!0);break;case"BLEND":mV.transparencyMode=z.c.PBRMATERIAL_ALPHABLEND,mV.albedoTexture&&(mV.albedoTexture.Mk=!0,mV.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${V}/alphaMode: Invalid value (${h.alphaMode})`)}}loadTextureInfoAsync(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadTextureInfoAsync(V,h,mV);if(t)return t;if(this.logOpen(`${V}`),h.texCoord>=6)throw new Error(`${V}/texCoord: Invalid value (${h.texCoord})`);const L=E.Get(`${V}/index`,this._gltf.textures,h.index);L._textureInfo=h;const N=this._loadTextureAsync(`/textures/${h.index}`,L,(t=>{t.coordinatesIndex=h.texCoord||0,i.AddPointerMetadata(t,V),this._parent.onTextureLoadedObservable.notifyObservers(t),mV(t)}));return this.logClose(),N}_loadTextureAsync(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const t=this._extensionsLoadTextureAsync(V,h,mV);if(t)return t;this.logOpen(`${V} ${h.name||""}`);const L=void 0==h.sampler?i.DefaultSampler:E.Get(`${V}/sampler`,this._gltf.samplers,h.sampler),N=E.Get(`${V}/source`,this._gltf.images,h.source),A=this._createTextureAsync(V,L,N,mV,void 0,!h._textureInfo.nonColorData);return this.logClose(),A}_createTextureAsync(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},N=arguments.length>4?arguments[4]:void 0,A=arguments.length>5?arguments[5]:void 0;const k=this._loadSampler(`/samplers/${h.index}`,h),C=new Array,K=new t;this._babylonScene._blockEntityCollection=!!this._assetContainer;const o={noMipmap:k.noMipMaps,invertY:!1,samplingMode:k.samplingMode,W:()=>{this._disposed||K.resolve()},onError:(h,mV)=>{this._disposed||K.reject(new Error(`${V}: ${mV&&mV.message?mV.message:h||"Failed to load texture"}`))},mimeType:mV.mimeType??(0,r.j)(mV.uri??""),loaderOptions:N,useSRGBBuffer:!!A&&this._parent.useSRGBBuffers},n=new Q.d(null,this._babylonScene,o);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,C.push(K.promise),C.push(this.loadImageAsync(`/images/${mV.index}`,mV).then((V=>{const h=mV.uri||`${this._fileName}#image${mV.index}`,t=`data:${this._uniqueRootUrl}${h}`;n.updateURL(t,V);const L=n.getInternalTexture();L&&(L.label=mV.name)}))),n.wrapU=k.wrapU,n.wrapV=k.wrapV,L(n),this._parent.useGltfTextureNames&&(n.name=mV.name||mV.uri||`image${mV.index}`),Promise.all(C).then((()=>n))}_loadSampler(V,h){return h._data||(h._data={noMipMaps:9728===h.minFilter||9729===h.minFilter,samplingMode:i._GetTextureSamplingMode(V,h),wrapU:i._GetTextureWrapMode(`${V}/wrapS`,h.wrapS),wrapV:i._GetTextureWrapMode(`${V}/wrapT`,h.wrapT)}),h._data}loadImageAsync(V,h){if(!h._data){if(this.logOpen(`${V} ${h.name||""}`),h.uri)h._data=this.loadUriAsync(`${V}/uri`,h,h.uri);else{const mV=E.Get(`${V}/bufferView`,this._gltf.bufferViews,h.bufferView);h._data=this.loadBufferViewAsync(`/bufferViews/${mV.index}`,mV)}this.logClose()}return h._data}loadUriAsync(V,h,mV){const t=this._extensionsLoadUriAsync(V,h,mV);if(t)return t;if(!i._ValidateUri(mV))throw new Error(`${V}: '${mV}' is invalid`);if((0,r.n)(mV)){const h=new Uint8Array((0,r.e)(mV));return this.log(`${V}: Decoded ${mV.substring(0,64)}... (${h.length} bytes)`),Promise.resolve(h)}return this.log(`${V}: Loading ${mV}`),this._parent.preprocessUrlAsync(this._rootUrl+mV).then((h=>new Promise(((t,L)=>{this._parent._loadFile(this._babylonScene,h,(h=>{this._disposed||(this.log(`${V}: Loaded ${mV} (${h.byteLength} bytes)`),t(new Uint8Array(h)))}),!0,(h=>{L(new r.r(`${V}: Failed to load '${mV}'${h?": "+h.status+" "+h.statusText:""}`,h))}))}))))}static AddPointerMetadata(V,h){V.metadata=V.metadata||{};const mV=V._internalMetadata=V._internalMetadata||{},t=mV.qk=mV.qk||{};(t.pointers=t.pointers||[]).push(h)}static _GetTextureWrapMode(V,h){switch(h=void 0==h?10497:h){case 33071:return Q.d.CLAMP_ADDRESSMODE;case 33648:return Q.d.MIRROR_ADDRESSMODE;case 10497:return Q.d.WRAP_ADDRESSMODE;default:return d.e.Warn(`${V}: Invalid value (${h})`),Q.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(V,h){const mV=void 0==h.magFilter?9729:h.magFilter,t=void 0==h.minFilter?9987:h.minFilter;if(9729===mV)switch(t){case 9728:return Q.d.LINEAR_NEAREST;case 9729:return Q.d.LINEAR_LINEAR;case 9984:return Q.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return Q.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return Q.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return Q.d.LINEAR_LINEAR_MIPLINEAR;default:return d.e.Warn(`${V}/minFilter: Invalid value (${t})`),Q.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==mV&&d.e.Warn(`${V}/magFilter: Invalid value (${mV})`),t){case 9728:return Q.d.NEAREST_NEAREST;case 9729:return Q.d.NEAREST_LINEAR;case 9984:return Q.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return Q.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return Q.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return Q.d.NEAREST_LINEAR_MIPLINEAR;default:return d.e.Warn(`${V}/minFilter: Invalid value (${t})`),Q.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(V,h){try{return(0,w.l)(h)}catch(mV){throw new Error(`${V}: ${mV.message}`)}}static _GetTypedArray(V,h,mV,t,L){const N=mV.buffer;t=mV.byteOffset+(t||0);const A=i._GetTypedArrayConstructor(`${V}/componentType`,h),k=v.i.GetTypeByteLength(h);return t%k!==0?(d.e.Warn(`${V}: Copying buffer as byte offset (${t}) is not a multiple of component type byte length (${k})`),new A(N.slice(t,t+L*k),0)):new A(N,t,L)}static _GetNumComponents(V,h){switch(h){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${V}: Invalid type (${h})`)}static _ValidateUri(V){return A.Tools.IsBase64(V)||-1===V.indexOf("..")}static _GetDrawMode(V,h){switch(void 0==h&&(h=4),h){case 0:return c.c.PointListDrawMode;case 1:return c.c.LineListDrawMode;case 2:return c.c.LineLoopDrawMode;case 3:return c.c.LineStripDrawMode;case 4:return c.c.TriangleFillMode;case 5:return c.c.TriangleStripDrawMode;case 6:return c.c.TriangleFanDrawMode}throw new Error(`${V}: Invalid mesh primitive mode (${h})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const V=new Array;if(this._gltf.materials)for(const h of this._gltf.materials)if(h._data)for(const mV in h._data){const t=h._data[mV];for(const h of t.babylonMeshes){h.Qk(!0);const mV=t.babylonMaterial;V.push(mV.forceCompilationAsync(h)),V.push(mV.forceCompilationAsync(h,{useInstances:!0})),this._parent.useClipPlane&&(V.push(mV.forceCompilationAsync(h,{clipPlane:!0})),V.push(mV.forceCompilationAsync(h,{clipPlane:!0,useInstances:!0})))}}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const V=new Array,h=this._babylonScene.lights;for(const mV of h){const h=mV.getShadowGenerator();h&&V.push(h.forceCompilationAsync())}return Promise.all(V).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(V){for(const h of this._extensions)h.enabled&&V(h)}_applyExtensions(V,h,mV){for(const t of this._extensions)if(t.enabled){const L=`${t.name}.${h}`,N=V;N._activeLoaderExtensionFunctions=N._activeLoaderExtensionFunctions||{};const A=N._activeLoaderExtensionFunctions;if(!A[L]){A[L]=!0;try{const V=mV(t);if(V)return V}finally{delete A[L]}}}return null}_extensionsOnLoading(){this._forEachExtensions((V=>V.onLoading&&V.onLoading()))}_extensionsOnReady(){this._forEachExtensions((V=>V.onReady&&V.onReady()))}_extensionsLoadSceneAsync(V,h){return this._applyExtensions(h,"loadScene",(mV=>mV.loadSceneAsync&&mV.loadSceneAsync(V,h)))}_extensionsLoadNodeAsync(V,h,mV){return this._applyExtensions(h,"loadNode",(t=>t.loadNodeAsync&&t.loadNodeAsync(V,h,mV)))}_extensionsLoadCameraAsync(V,h,mV){return this._applyExtensions(h,"loadCamera",(t=>t.loadCameraAsync&&t.loadCameraAsync(V,h,mV)))}_extensionsLoadVertexDataAsync(V,h,mV){return this._applyExtensions(h,"loadVertexData",(t=>t._loadVertexDataAsync&&t._loadVertexDataAsync(V,h,mV)))}_extensionsLoadMeshPrimitiveAsync(V,h,mV,t,L,N){return this._applyExtensions(L,"loadMeshPrimitive",(A=>A._loadMeshPrimitiveAsync&&A._loadMeshPrimitiveAsync(V,h,mV,t,L,N)))}_extensionsLoadMaterialAsync(V,h,mV,t,L){return this._applyExtensions(h,"loadMaterial",(N=>N._loadMaterialAsync&&N._loadMaterialAsync(V,h,mV,t,L)))}_extensionsCreateMaterial(V,h,mV){return this._applyExtensions(h,"createMaterial",(t=>t.createMaterial&&t.createMaterial(V,h,mV)))}_extensionsLoadMaterialPropertiesAsync(V,h,mV){return this._applyExtensions(h,"loadMaterialProperties",(t=>t.loadMaterialPropertiesAsync&&t.loadMaterialPropertiesAsync(V,h,mV)))}_extensionsLoadTextureInfoAsync(V,h,mV){return this._applyExtensions(h,"loadTextureInfo",(t=>t.loadTextureInfoAsync&&t.loadTextureInfoAsync(V,h,mV)))}_extensionsLoadTextureAsync(V,h,mV){return this._applyExtensions(h,"loadTexture",(t=>t._loadTextureAsync&&t._loadTextureAsync(V,h,mV)))}_extensionsLoadAnimationAsync(V,h){return this._applyExtensions(h,"loadAnimation",(mV=>mV.loadAnimationAsync&&mV.loadAnimationAsync(V,h)))}_extensionsLoadAnimationChannelAsync(V,h,mV,t,L){return this._applyExtensions(mV,"loadAnimationChannel",(N=>N._loadAnimationChannelAsync&&N._loadAnimationChannelAsync(V,h,mV,t,L)))}_extensionsLoadSkinAsync(V,h,mV){return this._applyExtensions(mV,"loadSkin",(t=>t._loadSkinAsync&&t._loadSkinAsync(V,h,mV)))}_extensionsLoadUriAsync(V,h,mV){return this._applyExtensions(h,"loadUri",(t=>t._loadUriAsync&&t._loadUriAsync(V,h,mV)))}_extensionsLoadBufferViewAsync(V,h){return this._applyExtensions(h,"loadBufferView",(mV=>mV.loadBufferViewAsync&&mV.loadBufferViewAsync(V,h)))}_extensionsLoadBufferAsync(V,h,mV,t){return this._applyExtensions(h,"loadBuffer",(L=>L.loadBufferAsync&&L.loadBufferAsync(V,h,mV,t)))}static LoadExtensionAsync(V,h,mV,t){if(!h.extensions)return null;const L=h.extensions[mV];return L?t(`${V}/extensions/${mV}`,L):null}static LoadExtraAsync(V,h,mV,t){if(!h.extras)return null;const L=h.extras[mV];return L?t(`${V}/extras/${mV}`,L):null}isExtensionUsed(V){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(V)}logOpen(V){this._parent._logOpen(V)}logClose(){this._parent._logClose()}log(V){this._parent._log(V)}startPerformanceCounter(V){this._parent._startPerformanceCounter(V)}endPerformanceCounter(V){this._parent._endPerformanceCounter(V)}}i.DefaultSampler={index:-1},I.e._CreateGLTF2Loader=V=>new i(V);var b=mV(14063),P=mV(12597),U=mV(12448),u=mV(14067),e=mV(14075);class W extends e.e{constructor(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,C=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",V),this._texture=V.getEngine().createRawCubeTexture(h,mV,t,L,N,A,k,C)}update(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,V,h,mV,t,L)}updateRGBDAsync(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,u.m)(this._texture,V,h,mV,t).then((()=>{}))}clone(){return U.e.Clone((()=>{const V=this.DV(),h=this._texture,mV=new W(V,h._bufferViewArray,h.width,h.format,h.type,h.generateMipMaps,h.invertY,h.samplingMode,h._compression);return 13===h.source&&mV.updateRGBDAsync(h._bufferViewArrayArray,h._sphericalPolynomial,h._lodGenerationScale,h._lodGenerationOffset),mV}),this)}}const X="EXT_lights_image_based";class a{constructor(V){this.name=X,this._loader=V,this.enabled=this._loader.isExtensionUsed(X)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.qk.extensions;if(V&&V[this.name]){const h=V[this.name];this._lights=h.lights}}loadSceneAsync(V,h){return i.LoadExtensionAsync(V,h,this.name,(async(mV,t)=>{this._loader._allMaterialsDirtyRequired=!0;const L=new Array;L.push(this._loader.loadSceneAsync(V,h)),this._loader.logOpen(`${mV}`);const N=E.Get(`${mV}/light`,this._lights,t.fh);return L.push(this._loadLightAsync(`/extensions/${this.name}/lights/${t.fh}`,N).then((V=>{this._loader.babylonScene.environmentTexture=V}))),this._loader.logClose(),await Promise.all(L).then((()=>{}))}))}_loadLightAsync(V,h){if(!h._loaded){const mV=new Array;this._loader.logOpen(`${V}`);const t=new Array(h.specularImages.length);for(let L=0;L<h.specularImages.length;L++){const N=h.specularImages[L];t[L]=new Array(N.length);for(let h=0;h<N.length;h++){const A=`${V}/specularImages/${L}/${h}`;this._loader.logOpen(`${A}`);const k=N[h],C=E.Get(A,this._loader.qk.images,k);mV.push(this._loader.loadImageAsync(`/images/${k}`,C).then((V=>{t[L][h]=V}))),this._loader.logClose()}}this._loader.logClose(),h._loaded=Promise.all(mV).then((async()=>{const mV=new W(this._loader.babylonScene,null,h.specularImageSize);if(mV.name=h.name||"environment",h._babylonTexture=mV,void 0!=h.Ik&&(mV.level=h.Ik),h.rotation){let V=L.Quaternion.Dh(h.rotation);this._loader.babylonScene.useRightHandedSystem||(V=L.Quaternion.Inverse(V)),L.Matrix.FromQuaternionToRef(V,mV.getReflectionTextureMatrix())}if(!h.irradianceCoefficients)throw new Error(`${V}: Irradiance coefficients are missing`);const N=P.b.Dh(h.irradianceCoefficients);N.scaleInPlace(h.Ik),N.convertIrradianceToLambertianRadiance();const A=P.f.FromHarmonics(N),k=(t.length-1)/Math.log2(h.specularImageSize);return await mV.updateRGBDAsync(t,A,k)}))}return h._loaded.then((()=>h._babylonTexture))}}f(X),Z(X,!0,(V=>new a(V)));mV(12965);const B="EXT_mesh_gpu_instancing";class VV{constructor(V){this.name=B,this._loader=V,this.enabled=this._loader.isExtensionUsed(B)}dispose(){this._loader=null}loadNodeAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(V,t)=>{this._loader._disableInstancedMesh++;const N=this._loader.loadNodeAsync(`/nodes/${h.index}`,h,mV);if(this._loader._disableInstancedMesh--,!h._primitiveBabylonMeshes)return await N;const A=new Array;let k=0;const C=h=>{if(void 0==t.attributes[h])return void A.push(Promise.resolve(null));const mV=E.Get(`${V}/attributes/${h}`,this._loader.qk.accessors,t.attributes[h]);if(A.push(this._loader._loadFloatAccessorAsync(`/accessors/${mV.bufferView}`,mV)),0===k)k=mV.count;else if(k!==mV.count)throw new Error(`${V}/attributes: Instance buffer accessors do not have the same count.`)};return C("TRANSLATION"),C("ROTATION"),C("SCALE"),await N.then((async V=>{const[mV,t,N]=await Promise.all(A),C=new Float32Array(16*k);L.TmpVectors.sh[0].Hk(0,0,0),L.TmpVectors.Quaternion[0].Hk(0,0,0,1),L.TmpVectors.sh[1].Hk(1,1,1);for(let h=0;h<k;++h)mV&&L.sh.FromArrayToRef(mV,3*h,L.TmpVectors.sh[0]),t&&L.Quaternion.FromArrayToRef(t,4*h,L.TmpVectors.Quaternion[0]),N&&L.sh.FromArrayToRef(N,3*h,L.TmpVectors.sh[1]),L.Matrix.ComposeToRef(L.TmpVectors.sh[1],L.TmpVectors.Quaternion[0],L.TmpVectors.sh[0],L.TmpVectors.Matrix[0]),L.TmpVectors.Matrix[0].copyToArray(C,16*h);for(const L of h._primitiveBabylonMeshes)L.Dn("matrix",C,16,!0);return V}))}))}}f(B),Z(B,!0,(V=>new VV(V)));let hV=0,mh=null;class tV{static get Default(){return tV._Default||(tV._Default=new tV),tV._Default}constructor(){const V=tV.Configuration.decoder;this._decoderModulePromise=A.Tools.LoadBabylonScriptAsync(V.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(V,h,mV,t,L){await this._decoderModulePromise,0===hV&&(MeshoptDecoder.useWorkers(1),hV=1);const N=await MeshoptDecoder.decodeGltfBufferAsync(h,mV,V,t,L);return null!==mh&&clearTimeout(mh),mh=setTimeout((()=>{MeshoptDecoder.useWorkers(0),hV=0,mh=null}),1e3),N}}tV.Configuration={decoder:{url:`${A.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},tV._Default=null;const LV="EXT_meshopt_compression";class NV{constructor(V){this.name=LV,this.enabled=V.isExtensionUsed(LV),this._loader=V}dispose(){this._loader=null}loadBufferViewAsync(V,h){return i.LoadExtensionAsync(V,h,this.name,(async(mV,t)=>{const L=h;if(L._meshOptData)return await L._meshOptData;const N=E.Get(`${V}/buffer`,this._loader.qk.buffers,t.buffer);return L._meshOptData=this._loader.loadBufferAsync(`/buffers/${N.index}`,N,t.byteOffset||0,t.byteLength).then((async V=>await tV.Default.decodeGltfBufferAsync(V,t.count,t.byteStride,t.mode,t.filter))),await L._meshOptData}))}}f(LV),Z(LV,!0,(V=>new NV(V)));const AV="EXT_texture_webp";class kV{constructor(V){this.name=AV,this._loader=V,this.enabled=V.isExtensionUsed(AV)}dispose(){this._loader=null}_loadTextureAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=void 0==h.sampler?i.DefaultSampler:E.Get(`${V}/sampler`,this._loader.qk.samplers,h.sampler),A=E.Get(`${t}/source`,this._loader.qk.images,L.source);return await this._loader._createTextureAsync(V,N,A,(V=>{mV(V)}),void 0,!h._textureInfo.nonColorData)}))}}f(AV),Z(AV,!0,(V=>new kV(V)));const CV="EXT_texture_avif";class KV{constructor(V){this.name=CV,this._loader=V,this.enabled=V.isExtensionUsed(CV)}dispose(){this._loader=null}_loadTextureAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=void 0==h.sampler?i.DefaultSampler:E.Get(`${V}/sampler`,this._loader.qk.samplers,h.sampler),A=E.Get(`${t}/source`,this._loader.qk.images,L.source);return await this._loader._createTextureAsync(V,N,A,(V=>{mV(V)}),void 0,!h._textureInfo.nonColorData)}))}}f(CV),Z(CV,!0,(V=>new KV(V)));var oV=mV(14060),nV=mV(12937);const qV="EXT_lights_ies";class xV{constructor(V){this.name=qV,this._loader=V,this.enabled=this._loader.isExtensionUsed(qV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.qk.extensions;if(V&&V[this.name]){const h=V[this.name];this._lights=h.lights,E.Assign(this._lights)}}loadNodeAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,A)=>{let k,C;this._loader._allMaterialsDirtyRequired=!0;const K=await this._loader.loadNodeAsync(V,h,(V=>{C=E.Get(t,this._lights,A.fh);const h=C.name||V.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,k=new oV.e(h,L.sh.Zero(),L.sh.Backward(),0,1,this._loader.babylonScene),k.angle=Math.PI/2,k.innerAngle=0,k._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,C._babylonLight=k,k.falloffType=nV.d.FALLOFF_GLTF,k.rk=A.color?N.Jh.Dh(A.color):N.Jh.White(),k.Ik=A.multiplier||1,k.range=Number.MAX_VALUE,k.parent=V,this._loader._babylonLights.push(k),i.AddPointerMetadata(k,t),mV(V)}));let o;if(C.uri)o=await this._loader.loadUriAsync(V,C,C.uri);else{const h=E.Get(`${V}/bufferView`,this._loader.qk.bufferViews,C.bufferView);o=await this._loader.loadBufferViewAsync(`/bufferViews/${h.index}`,h)}return k.iesProfileTexture=new Q.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,o,!0,void 0,void 0,void 0,void 0,".ies"),K}))}}f(qV),Z(qV,!0,(V=>new xV(V)));var RV=mV(14088);const dV="KHR_draco_mesh_compression";class sV{constructor(V){this.name=dV,this.useNormalizedFlagFromAccessor=!0,this._loader=V,this.enabled=RV.e.DefaultAvailable&&this._loader.isExtensionUsed(dV)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{if(void 0!=h.mode&&4!==h.mode&&5!==h.mode)throw new Error(`${V}: Unsupported mode ${h.mode}`);const N={},A={},k=(V,t)=>{const k=L.attributes[V];if(void 0!=k&&(mV._delayInfo=mV._delayInfo||[],-1===mV._delayInfo.indexOf(t)&&mV._delayInfo.push(t),N[t]=k,this.useNormalizedFlagFromAccessor)){const mV=E.TryGet(this._loader.qk.accessors,h.attributes[V]);mV&&(A[t]=mV.normalized||!1)}};k("POSITION",v.i.PositionKind),k("NORMAL",v.i.NormalKind),k("TANGENT",v.i.TangentKind),k("TEXCOORD_0",v.i.UVKind),k("TEXCOORD_1",v.i.UV2Kind),k("TEXCOORD_2",v.i.UV3Kind),k("TEXCOORD_3",v.i.UV4Kind),k("TEXCOORD_4",v.i.UV5Kind),k("TEXCOORD_5",v.i.UV6Kind),k("JOINTS_0",v.i.MatricesIndicesKind),k("WEIGHTS_0",v.i.MatricesWeightsKind),k("COLOR_0",v.i.ColorKind);const C=E.Get(t,this._loader.qk.bufferViews,L.bufferView);return C._dracoBabylonGeometry||(C._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C).then((async t=>{const L=this.dracoDecoder||RV.e.Default,k=E.TryGet(this._loader.qk.accessors,h.attributes.POSITION),C=this._loader.parent.alwaysComputeBoundingBox||mV.skeleton||!k?null:g(k);return await L._decodeMeshToGeometryForGltfAsync(mV.name,this._loader.babylonScene,t,N,A,C).catch((h=>{throw new Error(`${V}: ${h.message}`)}))}))),await C._dracoBabylonGeometry}))}}f(dV),Z(dV,!0,(V=>new sV(V)));var MV=mV(14090),cV=mV(12409),zV=mV(12413),QV=mV(12809),JV=mV(12995),vV=mV(12388);QV.d.AddNodeConstructor("Light_Type_0",((V,h)=>()=>new DV(V,L.sh.Zero(),h)));class DV extends JV.d{get shadowAngle(){return this._shadowAngle}set shadowAngle(V){this._shadowAngle=V,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(V){const h=this.needCube();if(this._direction=V,this.needCube()!==h&&this._shadowGenerators){const V=this._shadowGenerators.values();for(let h=V.next();!0!==h.done;h=V.next()){h.value.recreateShadowMap()}}}constructor(V,h,mV){super(V,mV),this._shadowAngle=Math.PI/2,this.position=h}getClassName(){return"PointLight"}getTypeID(){return nV.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(V){if(this.direction)return super.getShadowDirection(V);switch(V){case 0:return new L.sh(1,0,0);case 1:return new L.sh(-1,0,0);case 2:return new L.sh(0,-1,0);case 3:return new L.sh(0,1,0);case 4:return new L.sh(0,0,1);case 5:return new L.sh(0,0,-1)}return L.sh.Zero()}_setDefaultShadowProjectionMatrix(V,h,mV){const t=this.DV().activeCamera;if(!t)return;const N=void 0!==this.shadowMinZ?this.shadowMinZ:t.ck,A=void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,k=this.DV().getEngine().bh;L.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,k?A:N,k?N:A,V,!0,this._scene.getEngine().isNDCHalfZRange,void 0,k)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(V,h){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,h):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,h),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,h),this}transferToNodeMaterialEffect(V,h){return this.computeTransformedInformation()?V.setFloat3(h,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):V.setFloat3(h,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(V,h){V["POINTLIGHT"+h]=!0}}(0,cV.e)([(0,zV.J)()],DV.prototype,"shadowAngle",null),(0,vV.i)("BABYLON.PointLight",DV);const HV="KHR_lights_punctual";class jV{constructor(V){this.name=HV,this._loader=V,this.enabled=this._loader.isExtensionUsed(HV)}dispose(){this._loader=null,delete this._lights}onLoading(){const V=this._loader.qk.extensions;if(V&&V[this.name]){const h=V[this.name];this._lights=h.lights,E.Assign(this._lights)}}loadNodeAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,A)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(V,h,(V=>{let h;const k=E.Get(t,this._lights,A.fh),C=k.name||V.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,k.type){case"directional":{const V=new MV.b(C,L.sh.Backward(),this._loader.babylonScene);V.position.lk(0),h=V;break}case"point":h=new DV(C,L.sh.Zero(),this._loader.babylonScene);break;case"spot":{const V=new oV.e(C,L.sh.Zero(),L.sh.Backward(),0,1,this._loader.babylonScene);V.angle=2*(k.spot&&k.spot.outerConeAngle||Math.PI/4),V.innerAngle=2*(k.spot&&k.spot.innerConeAngle||0),h=V;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${t}: Invalid light type (${k.type})`)}h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,k._babylonLight=h,h.falloffType=nV.d.FALLOFF_GLTF,h.rk=k.color?N.Jh.Dh(k.color):N.Jh.White(),h.Ik=void 0==k.Ik?1:k.Ik,h.range=void 0==k.range?Number.MAX_VALUE:k.range,h.parent=V,this._loader._babylonLights.push(h),i.AddPointerMetadata(h,t),mV(V)})))))}}f(HV),Z(HV,!0,(V=>new jV(V)));const lV="KHR_materials_pbrSpecularGlossiness";class GV{constructor(V){this.name=lV,this.order=200,this._loader=V,this.enabled=this._loader.isExtensionUsed(lV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialBasePropertiesAsync(V,h,mV)),N.push(this._loadSpecularGlossinessPropertiesAsync(t,L,mV)),this._loader.loadMaterialAlphaProperties(V,h,mV),await Promise.all(N).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return mV.metallic=null,mV.roughness=null,h.diffuseFactor?(mV.albedoColor=N.Jh.Dh(h.diffuseFactor),mV.alpha=h.diffuseFactor[3]):mV.albedoColor=N.Jh.White(),mV.reflectivityColor=h.specularFactor?N.Jh.Dh(h.specularFactor):N.Jh.White(),mV.microSurface=void 0==h.glossinessFactor?1:h.glossinessFactor,h.diffuseTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTexture`,h.diffuseTexture,(V=>{V.name=`${mV.name} (Diffuse)`,mV.albedoTexture=V}))),h.specularGlossinessTexture&&(t.push(this._loader.loadTextureInfoAsync(`${V}/specularGlossinessTexture`,h.specularGlossinessTexture,(V=>{V.name=`${mV.name} (Specular Glossiness)`,mV.reflectivityTexture=V,mV.reflectivityTexture.Mk=!0}))),mV.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(t).then((()=>{}))}}f(lV),Z(lV,!0,(V=>new GV(V)));const yV="KHR_materials_unlit";class OV{constructor(V){this.name=yV,this.order=210,this._loader=V,this.enabled=this._loader.isExtensionUsed(yV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async()=>await this._loadUnlitPropertiesAsync(V,h,mV)))}_loadUnlitPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;mV.unlit=!0;const L=h.pbrMetallicRoughness;return L&&(L.baseColorFactor?(mV.albedoColor=N.Jh.Dh(L.baseColorFactor),mV.alpha=L.baseColorFactor[3]):mV.albedoColor=N.Jh.White(),L.baseColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/baseColorTexture`,L.baseColorTexture,(V=>{V.name=`${mV.name} (Base Color)`,mV.albedoTexture=V})))),h.doubleSided&&(mV.Dk=!1,mV.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(V,h,mV),Promise.all(t).then((()=>{}))}}f(yV),Z(yV,!0,(V=>new OV(V)));const IV="KHR_materials_clearcoat";class rV{constructor(V){this.name=IV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(IV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadClearCoatPropertiesAsync(t,L,mV)),await Promise.all(N)}))}_loadClearCoatPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return mV.clearCoat.isEnabled=!0,mV.clearCoat.useRoughnessFromMainTexture=!1,mV.clearCoat.remapF0OnInterfaceChange=!1,void 0!=h.clearcoatFactor?mV.clearCoat.Ik=h.clearcoatFactor:mV.clearCoat.Ik=0,h.clearcoatTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatTexture`,h.clearcoatTexture,(V=>{V.name=`${mV.name} (ClearCoat)`,mV.clearCoat.texture=V}))),void 0!=h.clearcoatRoughnessFactor?mV.clearCoat.roughness=h.clearcoatRoughnessFactor:mV.clearCoat.roughness=0,h.clearcoatRoughnessTexture&&(h.clearcoatRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatRoughnessTexture`,h.clearcoatRoughnessTexture,(V=>{V.name=`${mV.name} (ClearCoat Roughness)`,mV.clearCoat.textureRoughness=V})))),h.clearcoatNormalTexture&&(h.clearcoatNormalTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${V}/clearcoatNormalTexture`,h.clearcoatNormalTexture,(V=>{V.name=`${mV.name} (ClearCoat Normal)`,mV.clearCoat.bumpTexture=V}))),mV.invertNormalMapX=!mV.DV().useRightHandedSystem,mV.invertNormalMapY=mV.DV().useRightHandedSystem,void 0!=h.clearcoatNormalTexture.scale&&(mV.clearCoat.bumpTexture.level=h.clearcoatNormalTexture.scale)),Promise.all(t).then((()=>{}))}}f(IV),Z(IV,!0,(V=>new rV(V)));const TV="KHR_materials_iridescence";class FV{constructor(V){this.name=TV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(TV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadIridescencePropertiesAsync(t,L,mV)),await Promise.all(N).then((()=>{}))}))}_loadIridescencePropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return mV.iridescence.isEnabled=!0,mV.iridescence.Ik=h.iridescenceFactor??0,mV.iridescence.indexOfRefraction=h.iridescenceIor??h.iridescenceIOR??1.3,mV.iridescence.minimumThickness=h.iridescenceThicknessMinimum??100,mV.iridescence.maximumThickness=h.iridescenceThicknessMaximum??400,h.iridescenceTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceTexture`,h.iridescenceTexture,(V=>{V.name=`${mV.name} (Iridescence)`,mV.iridescence.texture=V}))),h.iridescenceThicknessTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/iridescenceThicknessTexture`,h.iridescenceThicknessTexture,(V=>{V.name=`${mV.name} (Iridescence Thickness)`,mV.iridescence.thicknessTexture=V}))),Promise.all(t).then((()=>{}))}}f(TV),Z(TV,!0,(V=>new FV(V)));const pV="KHR_materials_anisotropy";class ZV{constructor(V){this.name=pV,this.order=195,this._loader=V,this.enabled=this._loader.isExtensionUsed(pV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadIridescencePropertiesAsync(t,L,mV)),await Promise.all(N)}))}async _loadIridescencePropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;mV.anisotropy.isEnabled=!0,mV.anisotropy.Ik=h.anisotropyStrength??0,mV.anisotropy.angle=h.anisotropyRotation??0,h.anisotropyTexture&&(h.anisotropyTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${V}/anisotropyTexture`,h.anisotropyTexture,(V=>{V.name=`${mV.name} (Anisotropy Intensity)`,mV.anisotropy.texture=V})))),await Promise.all(t)}}f(pV),Z(pV,!0,(V=>new ZV(V)));const fV="KHR_materials_emissive_strength";class SV{constructor(V){this.name=fV,this.order=170,this._loader=V,this.enabled=this._loader.isExtensionUsed(fV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>await this._loader.loadMaterialPropertiesAsync(V,h,mV).then((()=>{this._loadEmissiveProperties(t,L,mV)}))))}_loadEmissiveProperties(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);void 0!==h.emissiveStrength&&(mV.emissiveIntensity=h.emissiveStrength)}}f(fV),Z(fV,!0,(V=>new SV(V)));const YV="KHR_materials_sheen";class wV{constructor(V){this.name=YV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(YV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadSheenPropertiesAsync(t,L,mV)),await Promise.all(N).then((()=>{}))}))}_loadSheenPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return mV.sheen.isEnabled=!0,mV.sheen.Ik=1,void 0!=h.sheenColorFactor?mV.sheen.color=N.Jh.Dh(h.sheenColorFactor):mV.sheen.color=N.Jh.Black(),h.sheenColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/sheenColorTexture`,h.sheenColorTexture,(V=>{V.name=`${mV.name} (Sheen Color)`,mV.sheen.texture=V}))),void 0!==h.sheenRoughnessFactor?mV.sheen.roughness=h.sheenRoughnessFactor:mV.sheen.roughness=0,h.sheenRoughnessTexture&&(h.sheenRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${V}/sheenRoughnessTexture`,h.sheenRoughnessTexture,(V=>{V.name=`${mV.name} (Sheen Roughness)`,mV.sheen.textureRoughness=V})))),mV.sheen.albedoScaling=!0,mV.sheen.useRoughnessFromMainTexture=!1,Promise.all(t).then((()=>{}))}}f(YV),Z(YV,!0,(V=>new wV(V)));var EV=mV(12867);const gV="KHR_materials_specular";class iV{constructor(V){this.name=gV,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(gV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;if(N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadSpecularPropertiesAsync(t,L,mV)),L.extensions&&L.extensions.EXT_materials_specular_edge_color&&mV instanceof z.c){L.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(mV.brdf.dielectricSpecularModel=EV.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,mV.brdf.conductorSpecularModel=EV.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(N).then((()=>{}))}))}_loadSpecularPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return void 0!==h.specularFactor&&(mV.metallicF0Factor=h.specularFactor),void 0!==h.specularColorFactor&&(mV.metallicReflectanceColor=N.Jh.Dh(h.specularColorFactor)),h.specularTexture&&(h.specularTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${V}/specularTexture`,h.specularTexture,(V=>{V.name=`${mV.name} (Specular)`,mV.metallicReflectanceTexture=V,mV.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),h.specularColorTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/specularColorTexture`,h.specularColorTexture,(V=>{V.name=`${mV.name} (Specular Color)`,mV.reflectanceTexture=V}))),Promise.all(t).then((()=>{}))}}f(gV),Z(gV,!0,(V=>new iV(V)));const bV="KHR_materials_ior";class PV{constructor(V){this.name=bV,this.order=180,this._loader=V,this.enabled=this._loader.isExtensionUsed(bV)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadIorPropertiesAsync(t,L,mV)),await Promise.all(N).then((()=>{}))}))}_loadIorPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);return void 0!==h.ior?mV.indexOfRefraction=h.ior:mV.indexOfRefraction=PV._DEFAULT_IOR,Promise.resolve()}}PV._DEFAULT_IOR=1.5,f(bV),Z(bV,!0,(V=>new PV(V)));const UV="KHR_materials_variants";class uV{constructor(V){this.name=UV,this._loader=V,this.enabled=this._loader.isExtensionUsed(UV)}dispose(){this._loader=null}static GetAvailableVariants(V){const h=this._GetExtensionMetadata(V);return h?Object.keys(h.variants):[]}getAvailableVariants(V){return uV.GetAvailableVariants(V)}static SelectVariant(V,h){const mV=this._GetExtensionMetadata(V);if(!mV)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${UV} extension`);const t=V=>{const h=mV.variants[V];if(h)for(const mV of h)mV.mesh.material=mV.material};if(h instanceof Array)for(const L of h)t(L);else t(h);mV.lastSelected=h}selectVariant(V,h){uV.SelectVariant(V,h)}static Reset(V){const h=this._GetExtensionMetadata(V);if(!h)throw new Error(`Cannot reset on a glTF mesh that does not have the ${UV} extension`);for(const mV of h.original)mV.mesh.material=mV.material;h.lastSelected=null}reset(V){uV.Reset(V)}static GetLastSelectedVariant(V){const h=this._GetExtensionMetadata(V);if(!h)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${UV} extension`);return h.lastSelected}getLastSelectedVariant(V){return uV.GetLastSelectedVariant(V)}static _GetExtensionMetadata(V){var h,mV;return(null===V||void 0===V||null===(h=V._internalMetadata)||void 0===h||null===(mV=h.qk)||void 0===mV?void 0:mV[UV])||null}onLoading(){const V=this._loader.qk.extensions;if(V&&V[this.name]){const h=V[this.name];this._variants=h.variants}}onReady(){const V=this._loader.rootBabylonMesh;if(V){var h;const mV=this._loader.parent.extensionOptions[UV];null!==mV&&void 0!==mV&&mV.defaultVariant&&uV.SelectVariant(V,mV.defaultVariant),null===mV||void 0===mV||null===(h=mV.onLoaded)||void 0===h||h.call(mV,{get variants(){return uV.GetAvailableVariants(V)},get selectedVariant(){const h=uV.GetLastSelectedVariant(V);return h?Array.isArray(h)?h[0]:h:uV.GetAvailableVariants(V)[0]},set selectedVariant(h){uV.SelectVariant(V,h)}})}}_loadMeshPrimitiveAsync(V,h,mV,t,L,N){return i.LoadExtensionAsync(V,L,this.name,(async(A,k)=>{const C=new Array;return C.push(this._loader._loadMeshPrimitiveAsync(V,h,mV,t,L,(h=>{if(N(h),h instanceof j.c){const mV=i._GetDrawMode(V,L.mode),t=this._loader.rootBabylonMesh,N=t?t._internalMetadata=t._internalMetadata||{}:{},K=N.qk=N.qk||{},o=K[UV]=K[UV]||{lastSelected:null,original:[],variants:{}};o.original.push({mesh:h,material:h.material});for(let V=0;V<k.mappings.length;++V){const L=k.mappings[V],N=E.Get(`${A}/mappings/${V}/material`,this._loader.qk.materials,L.material);C.push(this._loader._loadMaterialAsync(`#/materials/${L.material}`,N,h,mV,(V=>{for(let mV=0;mV<L.variants.length;++mV){const N=L.variants[mV],A=E.Get(`/extensions/${UV}/variants/${N}`,this._variants,N);o.variants[A.name]=o.variants[A.name]||[],o.variants[A.name].push({mesh:h,material:V}),h.onClonedObservable.add((V=>{const mV=V;let L=null,N=mV;do{if(N=N.parent,!N)return;L=uV._GetExtensionMetadata(N)}while(null===L);if(t&&L===uV._GetExtensionMetadata(t)){N._internalMetadata={};for(const V in t._internalMetadata)N._internalMetadata[V]=t._internalMetadata[V];N._internalMetadata.qk=[];for(const V in t._internalMetadata.qk)N._internalMetadata.qk[V]=t._internalMetadata.qk[V];N._internalMetadata.qk[UV]={lastSelected:null,original:[],variants:{}};for(const V of L.original)N._internalMetadata.qk[UV].original.push({mesh:V.mesh,material:V.material});for(const V in L.variants)if(Object.prototype.hasOwnProperty.call(L.variants,V)){N._internalMetadata.qk[UV].variants[V]=[];for(const h of L.variants[V])N._internalMetadata.qk[UV].variants[V].push({mesh:h.mesh,material:h.material})}L=N._internalMetadata.qk[UV]}for(const t of L.original)t.mesh===h&&(t.mesh=mV);for(const t of L.variants[A.name])t.mesh===h&&(t.mesh=mV)}))}})))}}}))),await Promise.all(C).then((V=>{let[h]=V;return h}))}))}}f(UV),Z(UV,!0,(V=>new uV(V)));var eV=mV(12469);class WV{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:EV.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(V,h){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...WV._GetDefaultOptions(),...V},this._scene=h,this._scene._transmissionHelper=this,this.onErrorObservable=new o.d,this._scene.XL.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(V){if(!Object.keys(V).filter((h=>this._options[h]!==V[h])).length)return;const h={...this._options,...V},mV=this._options;this._options=h,h.renderSize===mV.renderSize&&h.renderTargetTextureType===mV.renderTargetTextureType&&h.generateMipmaps===mV.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=h.samples,this._opaqueRenderTarget.lodGenerationScale=h.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=h.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(V){return!!V&&!!(V instanceof z.c&&V.subSurface.isRefractionEnabled)}_addMesh(V){this._materialObservers[V.uniqueId]=V.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),A.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(V.material)?(V.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(V)&&this._transparentMeshesCache.push(V)):-1===this._opaqueMeshesCache.indexOf(V)&&this._opaqueMeshesCache.push(V)}))}_removeMesh(V){V.onMaterialChangedObservable.remove(this._materialObservers[V.uniqueId]),delete this._materialObservers[V.uniqueId];let h=this._transparentMeshesCache.indexOf(V);-1!==h&&this._transparentMeshesCache.splice(h,1),h=this._opaqueMeshesCache.indexOf(V),-1!==h&&this._opaqueMeshesCache.splice(h,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(V){const h=this._transparentMeshesCache.indexOf(V),mV=this._opaqueMeshesCache.indexOf(V);this._shouldRenderAsTransmission(V.material)?(V.material instanceof z.c&&(V.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==mV?(this._opaqueMeshesCache.splice(mV,1),this._transparentMeshesCache.push(V)):-1===h&&this._transparentMeshesCache.push(V)):-1!==h?(this._transparentMeshesCache.splice(h,1),this._opaqueMeshesCache.push(V)):-1===mV&&this._opaqueMeshesCache.push(V)}_isRenderTargetValid(){var V;return null!==(null===(V=this._opaqueRenderTarget)||void 0===V?void 0:V.getInternalTexture())}_setupRenderTargets(){var V;let h;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new eV.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(V=this._options.clearColor)||void 0===V?void 0:V.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((V=>{h=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?V.clearColor.t(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(V.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=h}));for(const mV of this._transparentMeshesCache)this._shouldRenderAsTransmission(mV.material)&&(mV.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const XV="KHR_materials_transmission";class aV{constructor(V){this.name=XV,this.order=175,this._loader=V,this.enabled=this._loader.isExtensionUsed(XV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadTransparentPropertiesAsync(t,h,mV,L)),await Promise.all(N).then((()=>{}))}))}_loadTransparentPropertiesAsync(V,h,mV,t){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const L=mV;if(L.subSurface.isRefractionEnabled=!0,L.subSurface.volumeIndexOfRefraction=1,L.subSurface.useAlbedoToTintRefraction=!0,void 0===t.transmissionFactor)return L.subSurface.refractionIntensity=0,L.subSurface.isRefractionEnabled=!1,Promise.resolve();{var N;L.subSurface.refractionIntensity=t.transmissionFactor;const V=L.DV();if(L.subSurface.refractionIntensity&&!V._transmissionHelper)new WV({},L.DV());else if(L.subSurface.refractionIntensity&&(null===(N=V._transmissionHelper)||void 0===N||!N._isRenderTargetValid())){var A;null===(A=V._transmissionHelper)||void 0===A||A._setupRenderTargets()}}return L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=0,t.transmissionTexture?(t.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/transmissionTexture`,t.transmissionTexture,void 0).then((V=>{V.name=`${mV.name} (Transmission)`,L.subSurface.refractionIntensityTexture=V,L.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(XV),Z(XV,!0,(V=>new aV(V)));const BV="KHR_materials_diffuse_transmission";class Vh{constructor(V){this.name=BV,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(BV),this.enabled&&(V.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadTranslucentPropertiesAsync(t,h,mV,L)),await Promise.all(N).then((()=>{}))}))}_loadTranslucentPropertiesAsync(V,h,mV,t){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const L=mV;if(L.subSurface.isTranslucencyEnabled=!0,L.subSurface.volumeIndexOfRefraction=1,L.subSurface.minimumThickness=0,L.subSurface.maximumThickness=0,L.subSurface.useAlbedoToTintTranslucency=!1,void 0===t.diffuseTransmissionFactor)return L.subSurface.translucencyIntensity=0,L.subSurface.isTranslucencyEnabled=!1,Promise.resolve();L.subSurface.translucencyIntensity=t.diffuseTransmissionFactor;const A=new Array;return L.subSurface.useGltfStyleTextures=!0,t.diffuseTransmissionTexture&&(t.diffuseTransmissionTexture.nonColorData=!0,A.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionTexture`,t.diffuseTransmissionTexture).then((V=>{V.name=`${mV.name} (Diffuse Transmission)`,L.subSurface.translucencyIntensityTexture=V})))),void 0!==t.diffuseTransmissionColorFactor?L.subSurface.translucencyColor=N.Jh.Dh(t.diffuseTransmissionColorFactor):L.subSurface.translucencyColor=N.Jh.White(),t.diffuseTransmissionColorTexture&&A.push(this._loader.loadTextureInfoAsync(`${V}/diffuseTransmissionColorTexture`,t.diffuseTransmissionColorTexture).then((V=>{V.name=`${mV.name} (Diffuse Transmission Color)`,L.subSurface.translucencyColorTexture=V}))),Promise.all(A).then((()=>{}))}}f(BV),Z(BV,!0,(V=>new Vh(V)));const hh="KHR_materials_volume";class mm{constructor(V){this.name=hh,this.order=173,this._loader=V,this.enabled=this._loader.isExtensionUsed(hh),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadVolumePropertiesAsync(t,h,mV,L)),await Promise.all(N).then((()=>{}))}))}_loadVolumePropertiesAsync(V,h,mV,t){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);if(!mV.subSurface.isRefractionEnabled&&!mV.subSurface.isTranslucencyEnabled||!t.thicknessFactor)return Promise.resolve();mV.subSurface.volumeIndexOfRefraction=mV.indexOfRefraction;const L=void 0!==t.attenuationDistance?t.attenuationDistance:Number.MAX_VALUE;return mV.subSurface.tintColorAtDistance=L,void 0!==t.attenuationColor&&3==t.attenuationColor.length&&mV.subSurface.tintColor.Hk(t.attenuationColor[0],t.attenuationColor[1],t.attenuationColor[2]),mV.subSurface.minimumThickness=0,mV.subSurface.maximumThickness=t.thicknessFactor,mV.subSurface.useThicknessAsDepth=!0,t.thicknessTexture?(t.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${V}/thicknessTexture`,t.thicknessTexture).then((V=>{V.name=`${mV.name} (Thickness)`,mV.subSurface.thicknessTexture=V,mV.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}f(hh),Z(hh,!0,(V=>new mm(V)));const th="KHR_materials_dispersion";class Lh{constructor(V){this.name=th,this.order=174,this._loader=V,this.enabled=this._loader.isExtensionUsed(th)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadDispersionPropertiesAsync(t,h,mV,L)),await Promise.all(N).then((()=>{}))}))}_loadDispersionPropertiesAsync(V,h,mV,t){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);return mV.subSurface.isRefractionEnabled&&t.dispersion?(mV.subSurface.isDispersionEnabled=!0,mV.subSurface.dispersion=t.dispersion,Promise.resolve()):Promise.resolve()}}f(th),Z(th,!0,(V=>new Lh(V)));const Nh="EXT_materials_diffuse_roughness";class Ah{constructor(V){this.name=Nh,this.order=190,this._loader=V,this.enabled=this._loader.isExtensionUsed(Nh)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=new Array;return N.push(this._loader.loadMaterialPropertiesAsync(V,h,mV)),N.push(this._loadDiffuseRoughnessPropertiesAsync(t,L,mV)),await Promise.all(N).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(V,h,mV){if(!(mV instanceof z.c))throw new Error(`${V}: Material type not supported`);const t=new Array;return mV.brdf.baseDiffuseModel=EV.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=h.diffuseRoughnessFactor?mV.baseDiffuseRoughness=h.diffuseRoughnessFactor:mV.baseDiffuseRoughness=0,h.diffuseRoughnessTexture&&t.push(this._loader.loadTextureInfoAsync(`${V}/diffuseRoughnessTexture`,h.diffuseRoughnessTexture,(V=>{V.name=`${mV.name} (Diffuse Roughness)`,mV.baseDiffuseRoughnessTexture=V}))),Promise.all(t).then((()=>{}))}}f(Nh),Z(Nh,!0,(V=>new Ah(V)));const kh="KHR_mesh_quantization";class Ch{constructor(V){this.name=kh,this.enabled=V.isExtensionUsed(kh)}dispose(){}}f(kh),Z(kh,!0,(V=>new Ch(V)));const Kh="KHR_texture_basisu";class oh{constructor(V){this.name=Kh,this._loader=V,this.enabled=V.isExtensionUsed(Kh)}dispose(){this._loader=null}_loadTextureAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>{const N=void 0==h.sampler?i.DefaultSampler:E.Get(`${V}/sampler`,this._loader.qk.samplers,h.sampler),A=E.Get(`${t}/source`,this._loader.qk.images,L.source);return await this._loader._createTextureAsync(V,N,A,(V=>{mV(V)}),h._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!h._textureInfo.nonColorData)}))}}f(Kh),Z(Kh,!0,(V=>new oh(V)));const nh="KHR_texture_transform";class qh{constructor(V){this.name=nh,this._loader=V,this.enabled=this._loader.isExtensionUsed(nh)}dispose(){this._loader=null}loadTextureInfoAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(t,L)=>await this._loader.loadTextureInfoAsync(V,h,(V=>{if(!(V instanceof Q.d))throw new Error(`${t}: Texture type not supported`);L.offset&&(V.uOffset=L.offset[0],V.vOffset=L.offset[1]),V.uRotationCenter=0,V.vRotationCenter=0,L.rotation&&(V.wAng=-L.rotation),L.scale&&(V.uScale=L.scale[0],V.vScale=L.scale[1]),void 0!=L.texCoord&&(V.coordinatesIndex=L.texCoord),mV(V)}))))}}f(nh),Z(nh,!0,(V=>new qh(V)));const xh="KHR_xmp_json_ld";class Rh{constructor(V){this.name=xh,this.order=100,this._loader=V,this.enabled=this._loader.isExtensionUsed(xh)}dispose(){this._loader=null}onLoading(){var V,h,mV;if(null===this._loader.rootBabylonMesh)return;const t=null===(V=this._loader.qk.extensions)||void 0===V?void 0:V.KHR_xmp_json_ld,L=null===(h=this._loader.qk.asset)||void 0===h||null===(mV=h.extensions)||void 0===mV?void 0:mV.KHR_xmp_json_ld;if(t&&L){const V=+L.packet;t.packets&&V<t.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=t.packets[V])}}}function dh(V,h,mV,t){return N.Jh.Dh(h,mV).scale(t)}function sh(V,h,mV,t){return h[mV]*t}function Mh(V,h,mV,t){return-h[mV]*t}function ch(V,h,mV,t){return h[mV+1]*t}function zh(V,h,mV,t){return h[mV]*t*2}function Qh(V){return{scale:[new vh(q.d.ANIMATIONTYPE_FLOAT,`${V}.uScale`,sh,(()=>2)),new vh(q.d.ANIMATIONTYPE_FLOAT,`${V}.vScale`,ch,(()=>2))],offset:[new vh(q.d.ANIMATIONTYPE_FLOAT,`${V}.uOffset`,sh,(()=>2)),new vh(q.d.ANIMATIONTYPE_FLOAT,`${V}.vOffset`,ch,(()=>2))],rotation:[new vh(q.d.ANIMATIONTYPE_FLOAT,`${V}.wAng`,Mh,(()=>1))]}}f(xh),Z(xh,!0,(V=>new Rh(V)));class Jh extends b.AnimationPropertyInfo{buildAnimations(V,h,mV,t){return[{babylonAnimatable:V._babylonCamera,babylonAnimation:this._buildAnimation(h,mV,t)}]}}class vh extends b.AnimationPropertyInfo{buildAnimations(V,h,mV,t){const L=[];for(const N in V._data)L.push({babylonAnimatable:V._data[N].babylonMaterial,babylonAnimation:this._buildAnimation(h,mV,t)});return L}}class Dh extends b.AnimationPropertyInfo{buildAnimations(V,h,mV,t){return[{babylonAnimatable:V._babylonLight,babylonAnimation:this._buildAnimation(h,mV,t)}]}}(0,S.m)("/cameras/{}/orthographic/xmag",[new Jh(q.d.ANIMATIONTYPE_FLOAT,"orthoLeft",Mh,(()=>1)),new Jh(q.d.ANIMATIONTYPE_FLOAT,"orthoRight",ch,(()=>1))]),(0,S.m)("/cameras/{}/orthographic/ymag",[new Jh(q.d.ANIMATIONTYPE_FLOAT,"orthoBottom",Mh,(()=>1)),new Jh(q.d.ANIMATIONTYPE_FLOAT,"orthoTop",ch,(()=>1))]),(0,S.m)("/cameras/{}/orthographic/zfar",[new Jh(q.d.ANIMATIONTYPE_FLOAT,"maxZ",sh,(()=>1))]),(0,S.m)("/cameras/{}/orthographic/znear",[new Jh(q.d.ANIMATIONTYPE_FLOAT,"ck",sh,(()=>1))]),(0,S.m)("/cameras/{}/perspective/yfov",[new Jh(q.d.ANIMATIONTYPE_FLOAT,"fov",sh,(()=>1))]),(0,S.m)("/cameras/{}/perspective/zfar",[new Jh(q.d.ANIMATIONTYPE_FLOAT,"maxZ",sh,(()=>1))]),(0,S.m)("/cameras/{}/perspective/znear",[new Jh(q.d.ANIMATIONTYPE_FLOAT,"ck",sh,(()=>1))]),(0,S.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new vh(q.d.ANIMATIONTYPE_COLOR3,"albedoColor",dh,(()=>4)),new vh(q.d.ANIMATIONTYPE_FLOAT,"alpha",(function(V,h,mV,t){return h[mV+3]*t}),(()=>4))]),(0,S.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"metallic",sh,(()=>1))]),(0,S.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"roughness",sh,(()=>1))]);const Hh=Qh("albedoTexture");(0,S.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Hh.scale),(0,S.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Hh.offset),(0,S.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Hh.rotation);const jh=Qh("metallicTexture");(0,S.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",jh.scale),(0,S.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",jh.offset),(0,S.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",jh.rotation),(0,S.m)("/materials/{}/emissiveFactor",[new vh(q.d.ANIMATIONTYPE_COLOR3,"emissiveColor",dh,(()=>3))]);const lh=Qh("bumpTexture");(0,S.m)("/materials/{}/normalTexture/scale",[new vh(q.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",sh,(()=>1))]),(0,S.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",lh.scale),(0,S.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",lh.offset),(0,S.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",lh.rotation),(0,S.m)("/materials/{}/occlusionTexture/strength",[new vh(q.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",sh,(()=>1))]);const Gh=Qh("ambientTexture");(0,S.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Gh.scale),(0,S.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Gh.offset),(0,S.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Gh.rotation);const yh=Qh("emissiveTexture");(0,S.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",yh.scale),(0,S.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",yh.offset),(0,S.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",yh.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new vh(q.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new vh(q.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",sh,(()=>1))]);const Oh=Qh("anisotropy.texture");(0,S.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Oh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Oh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Oh.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",sh,(()=>1))]);const Ih=Qh("clearCoat.texture");(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Ih.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Ih.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Ih.rotation);const rh=Qh("clearCoat.bumpTexture");(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new vh(q.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",rh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",rh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",rh.rotation);const Th=Qh("clearCoat.textureRoughness");(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Th.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Th.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Th.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new vh(q.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new vh(q.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new vh(q.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new vh(q.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",sh,(()=>1))]);const Fh=Qh("iridescence.texture");(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Fh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Fh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Fh.rotation);const ph=Qh("iridescence.thicknessTexture");(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",ph.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",ph.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",ph.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new vh(q.d.ANIMATIONTYPE_COLOR3,"sheen.color",dh,(()=>3))]),(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",sh,(()=>1))]);const Zh=Qh("sheen.texture");(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Zh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Zh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Zh.rotation);const fh=Qh("sheen.textureRoughness");(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",fh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",fh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",fh.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new vh(q.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",dh,(()=>3))]);const Sh=Qh("metallicReflectanceTexture");(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Sh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Sh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Sh.rotation);const Yh=Qh("reflectanceTexture");(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Yh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Yh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Yh.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",sh,(()=>1))]);const wh=Qh("subSurface.refractionIntensityTexture");(0,S.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",wh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",wh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",wh.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new vh(q.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",dh,(()=>3))]),(0,S.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new vh(q.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",sh,(()=>1))]),(0,S.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",sh,(()=>1))]);const Eh=Qh("subSurface.thicknessTexture");(0,S.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Eh.scale),(0,S.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Eh.offset),(0,S.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Eh.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new vh(q.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",sh,(()=>1))]);const gh=Qh("subSurface.translucencyIntensityTexture");(0,S.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",gh.scale),(0,S.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",gh.offset),(0,S.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",gh.rotation),(0,S.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new vh(q.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",dh,(()=>3))]);const ih=Qh("subSurface.translucencyColorTexture");(0,S.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",ih.scale),(0,S.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",ih.offset),(0,S.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",ih.rotation),(0,S.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new Dh(q.d.ANIMATIONTYPE_COLOR3,"diffuse",dh,(()=>3))]),(0,S.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Dh(q.d.ANIMATIONTYPE_FLOAT,"intensity",sh,(()=>1))]),(0,S.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new Dh(q.d.ANIMATIONTYPE_FLOAT,"range",sh,(()=>1))]),(0,S.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Dh(q.d.ANIMATIONTYPE_FLOAT,"innerAngle",zh,(()=>1))]),(0,S.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Dh(q.d.ANIMATIONTYPE_FLOAT,"angle",zh,(()=>1))]),(0,S.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new Dh(q.d.ANIMATIONTYPE_COLOR3,"diffuse",dh,(()=>3))]),(0,S.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Dh(q.d.ANIMATIONTYPE_FLOAT,"intensity",sh,(()=>1))]);const bh="KHR_animation_pointer";class Ph{constructor(V){this.name=bh,this._loader=V,this._pathToObjectConverter=(0,S.i)(this._loader.qk)}get enabled(){return this._loader.isExtensionUsed(bh)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(V,h,mV,t,L){var N;const A=null===(N=t.target.extensions)||void 0===N?void 0:N.KHR_animation_pointer;if(!A||!this._pathToObjectConverter)return null;"pointer"!==t.target.path&&d.e.Warn(`${V}/target/path: Value (${t.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=t.target.node&&d.e.Warn(`${V}/target/node: Value (${t.target.node}) must not be present when using the ${this.name} extension`);const k=`${V}/extensions/${this.name}`,C=A.pointer;if(!C)throw new Error(`${k}: Pointer is missing`);try{const N=this._pathToObjectConverter.convert(C);if(!N.info.interpolation)throw new Error(`${k}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(V,h,mV,t,{object:N.object,info:N.info.interpolation},L)}catch(K){return d.e.Warn(`${k}/pointer: Invalid pointer (${C}) skipped`),null}}}f(bh),Z(bh,!0,(V=>new Ph(V)));class Uh{constructor(V,h,mV){this.frame=V,this.action=h,this.onlyOnce=mV,this.isDone=!1}_clone(){return new Uh(this.frame,this.action,this.onlyOnce)}}var uh=mV(12288),eh=mV(12331),Wh=mV(12322);class Xh{get loop(){return this._loop}set loop(V){V!==this._loop&&(this._loop=V,this.updateOptions({loop:V}))}get currentTime(){var V;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(V=eh.b.audioEngine)&&void 0!==V&&V.audioContext&&(this.isPlaying||this.isPaused)){const V=this.isPaused?0:eh.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+V}return 0}get spatialSound(){return this._spatialSound}set spatialSound(V){if(V==this._spatialSound)return;const h=this.isPlaying;this.pause(),V?(this._spatialSound=V,this._updateSpatialParameters()):this._disableSpatialSound(),h&&this.play()}constructor(V,h,mV){var t;let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new o.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=L.sh.Zero(),this._localDirection=new L.sh(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=V,mV=mV||R.b.LastCreatedScene)if(this._scene=mV,Xh._SceneComponentInitialization(mV),this._readyToPlayCallback=N,this._customAttenuationFunction=(V,h,mV,t,L)=>h<mV?V*(1-h/mV):0,k&&(this.autoplay=k.autoplay||!1,this._loop=k.loop||!1,void 0!==k.volume&&(this._volume=k.volume),this._spatialSound=k.spatialSound??!1,this.maxDistance=k.maxDistance??100,this.useCustomAttenuation=k.useCustomAttenuation??!1,this.rolloffFactor=k.rolloffFactor||1,this.refDistance=k.refDistance||1,this.distanceModel=k.distanceModel||"linear",this._playbackRate=k.playbackRate||1,this._streaming=k.streaming??!1,this._length=k.length,this._offset=k.offset),null!==(t=eh.b.audioEngine)&&void 0!==t&&t.canUseWebAudio&&eh.b.audioEngine.audioContext){this._soundGain=eh.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let V=!0;if(h)try{"string"===typeof h?(this._urlType="String",this._url=h):h instanceof ArrayBuffer?this._urlType="ArrayBuffer":h instanceof HTMLMediaElement?this._urlType="MediaElement":h instanceof MediaStream?this._urlType="MediaStream":h instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(h)&&(this._urlType="Array");let mV=[],t=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eh.b.audioEngine.audioContext.createMediaElementSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=eh.b.audioEngine.audioContext.createMediaStreamSource(h),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":h.byteLength>0&&(t=!0,this._soundLoaded(h));break;case"AudioBuffer":this._audioBufferLoaded(h);break;case"String":mV.push(h);case"Array":0===mV.length&&(mV=h);for(let V=0;V<mV.length;V++){const h=mV[V];if(t=k&&k.skipCodecCheck||-1!==h.indexOf(".mp3",h.length-4)&&eh.b.audioEngine.isMP3supported||-1!==h.indexOf(".ogg",h.length-4)&&eh.b.audioEngine.isOGGsupported||-1!==h.indexOf(".wav",h.length-4)||-1!==h.indexOf(".m4a",h.length-4)||-1!==h.indexOf(".mp4",h.length-4)||-1!==h.indexOf("blob:"),t){this._streaming?(this._htmlAudioElement=new Audio(h),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,A.Tools.SetCorsBehavior(h,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(h,(V=>{this._soundLoaded(V)}),void 0,!0,!0,(V=>{V&&d.e.Error("XHR "+V.status+" error on: "+h+"."),d.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:V=!1}V?t||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):d.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(C){d.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),eh.b.audioEngine&&!eh.b.audioEngine.WarnedWebAudioUnsupported&&(d.e.Error("Web Audio is not supported by your browser."),eh.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var V;null!==(V=eh.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(V){var h;null!==(h=eh.b.audioEngine)&&void 0!==h&&h.audioContext&&(this._audioBuffer=V,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(V){var h;null!==(h=eh.b.audioEngine)&&void 0!==h&&h.audioContext&&eh.b.audioEngine.audioContext.decodeAudioData(V,(V=>{this._audioBufferLoaded(V)}),(V=>{d.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+V)}))}setAudioBuffer(V){var h;null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&(this._audioBuffer=V,this._isReadyToPlay=!0)}updateOptions(V){V&&(this.loop=V.loop??this.loop,this.maxDistance=V.maxDistance??this.maxDistance,this.useCustomAttenuation=V.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=V.rolloffFactor??this.rolloffFactor,this.refDistance=V.refDistance??this.refDistance,this.distanceModel=V.distanceModel??this.distanceModel,this._playbackRate=V.playbackRate??this._playbackRate,this._length=V.length??void 0,this.spatialSound=V.spatialSound??this._spatialSound,this._setOffset(V.offset??void 0),this.setVolume(V.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var V;null!==(V=eh.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&eh.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??eh.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var V;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(V=this._soundPanner)||void 0===V||V.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var V;null!==(V=eh.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(V){var h;null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(V),this._isOutputConnected=!0)}setDirectionalCone(V,h,mV){h<V?d.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=V,this._coneOuterAngle=h,this._coneOuterGain=mV,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!=this._coneInnerAngle){var h;if(this._coneOuterAngle<V)return void d.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V,null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!=this._coneOuterAngle){var h;if(V<this._coneInnerAngle)return void d.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V,null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(V){var h;V.equals(this._position)||(this._position.t(V),null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(V){var h;this._localDirection=V,null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const V=this._connectedTransformNode.getWorldMatrix(),h=L.sh.TransformNormal(this._localDirection,V);h.normalize(),this._soundPanner.orientationX.value=h.x,this._soundPanner.orientationY.value=h.y,this._soundPanner.orientationZ.value=h.z}updateDistanceFromListener(){var V;if(null!==(V=eh.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const V=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Mh(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,V,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(V){this._customAttenuationFunction=V}play(V,h,mV){var t;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(t=eh.b.audioEngine)&&void 0!==t&&t.audioContext)try{var L,N;this._clearTimeoutsAndObservers();let t=V?(null===(L=eh.b.audioEngine)||void 0===L?void 0:L.audioContext.currentTime)+V:null===(N=eh.b.audioEngine)||void 0===N?void 0:N.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=eh.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const V=()=>{var mV;if(null!==(mV=eh.b.audioEngine)&&void 0!==mV&&mV.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=h??0;const mV=this._htmlAudioElement.play();void 0!==mV&&mV.catch((()=>{var h,mV;(null===(h=eh.b.audioEngine)||void 0===h||h.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(mV=eh.b.audioEngine)||void 0===mV?void 0:mV.onAudioUnlockedObservable.addOnce((()=>{V()})))}))}else{var t;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(t=eh.b.audioEngine)||void 0===t?void 0:t.onAudioUnlockedObservable.addOnce((()=>{V()}))}};V()}}else{var A;const L=()=>{var L;if(null!==(L=eh.b.audioEngine)&&void 0!==L&&L.audioContext){var N;if(mV=mV||this._length,void 0!==h&&this._setOffset(h),this._soundSource){const V=this._soundSource;V.onended=()=>{V.disconnect()}}if(this._soundSource=null===(N=eh.b.audioEngine)||void 0===N?void 0:N.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var A;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==h&&(this._soundSource.loopStart=h),void 0!==mV&&(this._soundSource.loopEnd=(0|h)+mV),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},t=V?(null===(A=eh.b.audioEngine)||void 0===A?void 0:A.audioContext.currentTime)+V:eh.b.audioEngine.audioContext.currentTime;const L=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(t,L,this.loop?void 0:mV)}}};"suspended"===(null===(A=eh.b.audioEngine)||void 0===A?void 0:A.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var V;"suspended"===(null===(V=eh.b.audioEngine)||void 0===V?void 0:V.audioContext.state)?(eh.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=eh.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{L()})))):L()}),500):L()}this._startTime=t,this.isPlaying=!0,this.isPaused=!1}catch(k){d.e.Error("Error while trying to play audio: "+this.name+", "+k.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(V){var h;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var mV;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(mV=this._streamingSource)||void 0===mV||mV.disconnect();this.isPlaying=!1}else if(null!==(h=eh.b.audioEngine)&&void 0!==h&&h.audioContext&&this._soundSource){const h=V?eh.b.audioEngine.audioContext.currentTime+V:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(h)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var V;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var h;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(h=this._streamingSource)||void 0===h||h.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(V=eh.b.audioEngine)&&void 0!==V&&V.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=eh.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(V,h){var mV;null!==(mV=eh.b.audioEngine)&&void 0!==mV&&mV.canUseWebAudio&&this._soundGain&&(h&&eh.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(eh.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,eh.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(V,eh.b.audioEngine.audioContext.currentTime+h)):this._soundGain.gain.value=V),this._volume=V}setPlaybackRate(V){this._playbackRate=V,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(V){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=V,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=V=>this._onRegisterAfterWorldMatrixUpdate(V),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(V){var h;if(V.getBoundingInfo){const h=V.getBoundingInfo();this.setPosition(h.boundingSphere.centerWorld)}else this.setPosition(V.absolutePosition);null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const V=()=>{(0,Wh.f)((()=>this._isReadyToPlay),(()=>{mV._audioBuffer=this.getAudioBuffer(),mV._isReadyToPlay=!0,mV.autoplay&&mV.play(0,this._offset,this._length)}),void 0,300)},h={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},mV=new Xh(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,h);return this.useCustomAttenuation&&mV.setAttenuationFunction(this._customAttenuationFunction),mV.setPosition(this._position),mV.setPlaybackRate(this._playbackRate),V(),mV}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const V={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(V.connectedMeshId=this._connectedTransformNode.id),V.position=this._position.sk(),V.refDistance=this.refDistance,V.distanceModel=this.distanceModel,V.isDirectional=this._isDirectional,V.localDirectionToMesh=this._localDirection.sk(),V.coneInnerAngle=this._coneInnerAngle,V.coneOuterAngle=this._coneOuterAngle,V.coneOuterGain=this._coneOuterGain),V}static Parse(V,h,mV,t){const N=V.name;let A;A=V.url?mV+V.url:mV+N;const k={autoplay:V.autoplay,loop:V.loop,volume:V.volume,spatialSound:V.spatialSound,maxDistance:V.maxDistance,rolloffFactor:V.rolloffFactor,refDistance:V.refDistance,distanceModel:V.distanceModel,playbackRate:V.playbackRate};let C;if(t){const V=()=>{(0,Wh.f)((()=>t._isReadyToPlay),(()=>{C._audioBuffer=t.getAudioBuffer(),C._isReadyToPlay=!0,C.autoplay&&C.play(0,C._offset,C._length)}),void 0,300)};C=new Xh(N,new ArrayBuffer(0),h,null,k),V()}else C=new Xh(N,A,h,(()=>{h.removePendingData(C)}),k),h.addPendingData(C);if(V.position){const h=L.sh.Dh(V.position);C.setPosition(h)}if(V.isDirectional&&(C.setDirectionalCone(V.coneInnerAngle||360,V.coneOuterAngle||360,V.coneOuterGain||0),V.localDirectionToMesh)){const h=L.sh.Dh(V.localDirectionToMesh);C.setLocalDirectionToMesh(h)}if(V.connectedMeshId){const mV=h.getMeshById(V.connectedMeshId);mV&&C.attachToMesh(mV)}return V.metadata&&(C.metadata=V.metadata),C}_setOffset(V){this._offset!==V&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=V)}_clearTimeoutsAndObservers(){var V;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(V=eh.b.audioEngine)||void 0===V||V.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Xh._SceneComponentInitialization=V=>{throw(0,uh.c)("AudioSceneComponent")},(0,vV.i)("BABYLON.Sound",Xh);class ah{constructor(V,h,mV){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],h.length!==mV.length)throw new Error("Sounds length does not equal weights length");this.loop=V,this._weights=mV;let t=0;for(const N of mV)t+=N;const L=t>0?1/t:0;for(let N=0;N<this._weights.length;N++)this._weights[N]*=L;this._sounds=h;for(const N of this._sounds)N.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(V){if(V!==this._coneInnerAngle){if(this._coneOuterAngle<V)return void d.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=V;for(const h of this._sounds)h.directionalConeInnerAngle=V}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(V){if(V!==this._coneOuterAngle){if(V<this._coneInnerAngle)return void d.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=V;for(const h of this._sounds)h.directionalConeOuterAngle=V}}get volume(){return this._volume}set volume(V){if(V!==this._volume)for(const h of this._sounds)h.setVolume(V)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(V){if(!this.isPaused){this.stop();const V=Math.random();let h=0;for(let mV=0;mV<this._weights.length;mV++)if(h+=this._weights[mV],V<=h){this._currentIndex=mV;break}}const h=this._sounds[this._currentIndex??0];h.isReady()?h.play(0,this.isPaused?void 0:V):h.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Bh{constructor(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(V=V||R.b.LastCreatedScene)&&(this._scene=V,this.soundCollection=[],this._options=h,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var V;null!==(V=eh.b.audioEngine)&&void 0!==V&&V.canUseWebAudio&&eh.b.audioEngine.audioContext&&(this._outputAudioNode=eh.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(eh.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(eh.b.audioEngine&&eh.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(V){var h;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&V.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==V.soundTrackId&&(-1===V.soundTrackId?this._scene.mainSoundTrack.removeSound(V):this._scene.soundTracks&&this._scene.soundTracks[V.soundTrackId].removeSound(V)),this.soundCollection.push(V),V.soundTrackId=this.id}removeSound(V){const h=this.soundCollection.indexOf(V);-1!==h&&this.soundCollection.splice(h,1)}setVolume(V){var h;null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=V)}switchPanningModelToHRTF(){var V;if(null!==(V=eh.b.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var V;if(null!==(V=eh.b.audioEngine)&&void 0!==V&&V.canUseWebAudio)for(let h=0;h<this.soundCollection.length;h++)this.soundCollection[h].switchPanningModelToEqualPower()}connectToAnalyser(V){var h;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=V,null!==(h=eh.b.audioEngine)&&void 0!==h&&h.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,eh.b.audioEngine.masterGain))}}var Vm=mV(12674),hm=mV(12648),mt=mV(12261);eh.b.AudioEngineFactory=(V,h,mV)=>new tm(V,h,mV);class tm{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new o.d,this.onAudioLockedObservable=new o.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,mt.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const t=document.createElement("audio");this._hostElement=V,this._audioContext=h,this._audioDestination=mV;try{t&&t.canPlayType&&(t.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||t.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(L){}try{t&&t.canPlayType&&t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(L){}}lock(){this._triggerSuspendedState()}unlock(){var V,h;if("running"===(null===(V=this._audioContext)||void 0===V?void 0:V.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(h=this._audioContext)||void 0===h||h.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{d.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var V;null===(V=this._audioContext)||void 0===V||V.addEventListener("statechange",(()=>{var V;this.unlocked&&"running"!==(null===(V=this._audioContext)||void 0===V?void 0:V.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var V;return null!==(V=this._audioContext)&&void 0!==V&&V.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(V){this.canUseWebAudio=!1,d.e.Error("Web Audio: "+V.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(V){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const V=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",h=document.createElement("style");h.appendChild(document.createTextNode(V)),document.getElementsByTagName("head")[0].appendChild(h),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var V;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(V=this._audioContext)||void 0===V||V.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(V){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=V)}connectToAnalyser(V){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=V,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Lm=mV(12280);(0,mV(13796).f)(Vm.b.NAME_AUDIO,((V,h,mV,t)=>{let L,N=[];if(mV.Sq=mV.Sq||[],void 0!==V.Sq&&null!==V.Sq)for(let k=0,C=V.Sq.length;k<C;k++){var A;const C=V.Sq[k];null!==(A=eh.b.audioEngine)&&void 0!==A&&A.canUseWebAudio?(C.url||(C.url=C.name),N[C.url]?mV.Sq.push(Xh.Parse(C,h,t,N[C.url])):(L=Xh.Parse(C,h,t),N[C.url]=L,mV.Sq.push(L))):mV.Sq.push(new Xh(C.name,null,h))}N=[]})),Object.defineProperty(hm.d.prototype,"mainSoundTrack",{get:function(){let V=this._getComponent(Vm.b.NAME_AUDIO);return V||(V=new Nm(this),this.o(V)),this._mainSoundTrack||(this._mainSoundTrack=new Bh(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),hm.d.prototype.getSoundByName=function(V){let h;for(h=0;h<this.mainSoundTrack.soundCollection.length;h++)if(this.mainSoundTrack.soundCollection[h].name===V)return this.mainSoundTrack.soundCollection[h];if(this.soundTracks)for(let mV=0;mV<this.soundTracks.length;mV++)for(h=0;h<this.soundTracks[mV].soundCollection.length;h++)if(this.soundTracks[mV].soundCollection[h].name===V)return this.soundTracks[mV].soundCollection[h];return null},Object.defineProperty(hm.d.prototype,"audioEnabled",{get:function(){let V=this._getComponent(Vm.b.NAME_AUDIO);return V||(V=new Nm(this),this.o(V)),V.audioEnabled},set:function(V){let h=this._getComponent(Vm.b.NAME_AUDIO);h||(h=new Nm(this),this.o(h)),V?h.enableAudio():h.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(hm.d.prototype,"headphone",{get:function(){let V=this._getComponent(Vm.b.NAME_AUDIO);return V||(V=new Nm(this),this.o(V)),V.headphone},set:function(V){let h=this._getComponent(Vm.b.NAME_AUDIO);h||(h=new Nm(this),this.o(h)),V?h.switchAudioModeForHeadphones():h.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(hm.d.prototype,"audioListenerPositionProvider",{get:function(){let V=this._getComponent(Vm.b.NAME_AUDIO);return V||(V=new Nm(this),this.o(V)),V.audioListenerPositionProvider},set:function(V){let h=this._getComponent(Vm.b.NAME_AUDIO);if(h||(h=new Nm(this),this.o(h)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");h.audioListenerPositionProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(hm.d.prototype,"audioListenerRotationProvider",{get:function(){let V=this._getComponent(Vm.b.NAME_AUDIO);return V||(V=new Nm(this),this.o(V)),V.audioListenerRotationProvider},set:function(V){let h=this._getComponent(Vm.b.NAME_AUDIO);if(h||(h=new Nm(this),this.o(h)),V&&"function"!==typeof V)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");h.audioListenerRotationProvider=V},enumerable:!0,configurable:!0}),Object.defineProperty(hm.d.prototype,"audioPositioningRefreshRate",{get:function(){let V=this._getComponent(Vm.b.NAME_AUDIO);return V||(V=new Nm(this),this.o(V)),V.audioPositioningRefreshRate},set:function(V){let h=this._getComponent(Vm.b.NAME_AUDIO);h||(h=new Nm(this),this.o(h)),h.audioPositioningRefreshRate=V},enumerable:!0,configurable:!0});class Nm{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(V){this.name=Vm.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new L.sh,this._cachedCameraPosition=new L.sh,this._lastCheck=0,this._invertMatrixTemp=new L.Matrix,this._cameraDirectionTemp=new L.sh,(V=V||R.b.LastCreatedScene)&&(this.zh=V,V.soundTracks=[],V.Sq=[])}register(){this.zh._afterRenderStage.registerStep(Vm.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(V){if(V.Sq=[],this.zh.soundTracks)for(let h=0;h<this.zh.soundTracks.length;h++){const mV=this.zh.soundTracks[h];for(let h=0;h<mV.soundCollection.length;h++)V.Sq.push(mV.soundCollection[h].serialize())}}addFromContainer(V){if(V.Sq)for(const h of V.Sq)h.play(),h.autoplay=!0,this.zh.mainSoundTrack.addSound(h)}removeFromContainer(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(V.Sq)for(const mV of V.Sq)mV.stop(),mV.autoplay=!1,this.zh.mainSoundTrack.removeSound(mV),h&&mV.dispose()}dispose(){const V=this.zh;if(V._mainSoundTrack&&V.mainSoundTrack.dispose(),V.soundTracks)for(let h=0;h<V.soundTracks.length;h++)V.soundTracks[h].dispose()}disableAudio(){const V=this.zh;let h;for(this._audioEnabled=!1,eh.b.audioEngine&&eh.b.audioEngine.audioContext&&eh.b.audioEngine.audioContext.suspend(),h=0;h<V.mainSoundTrack.soundCollection.length;h++)V.mainSoundTrack.soundCollection[h].pause();if(V.soundTracks)for(h=0;h<V.soundTracks.length;h++)for(let mV=0;mV<V.soundTracks[h].soundCollection.length;mV++)V.soundTracks[h].soundCollection[mV].pause()}enableAudio(){const V=this.zh;let h;for(this._audioEnabled=!0,eh.b.audioEngine&&eh.b.audioEngine.audioContext&&eh.b.audioEngine.audioContext.resume(),h=0;h<V.mainSoundTrack.soundCollection.length;h++)V.mainSoundTrack.soundCollection[h].isPaused&&V.mainSoundTrack.soundCollection[h].play();if(V.soundTracks)for(h=0;h<V.soundTracks.length;h++)for(let mV=0;mV<V.soundTracks[h].soundCollection.length;mV++)V.soundTracks[h].soundCollection[mV].isPaused&&V.soundTracks[h].soundCollection[mV].play()}switchAudioModeForHeadphones(){const V=this.zh;if(this._headphone=!0,V.mainSoundTrack.switchPanningModelToHRTF(),V.soundTracks)for(let h=0;h<V.soundTracks.length;h++)V.soundTracks[h].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const V=this.zh;if(this._headphone=!1,V.mainSoundTrack.switchPanningModelToEqualPower(),V.soundTracks)for(let h=0;h<V.soundTracks.length;h++)V.soundTracks[h].switchPanningModelToEqualPower()}_afterRender(){const V=Lm.e.Now;if(this._lastCheck&&V-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=V;const h=this.zh;if(!this._audioEnabled||!h._mainSoundTrack||!h.soundTracks||0===h._mainSoundTrack.soundCollection.length&&1===h.soundTracks.length)return;const mV=eh.b.audioEngine;if(mV&&mV.audioContext){let V,t=h.activeCamera;if(h.activeCameras&&h.activeCameras.length>0&&(t=h.activeCameras[0]),this.audioListenerPositionProvider){const V=this.audioListenerPositionProvider();mV.audioContext.listener.setPosition(V.x||0,V.y||0,V.z||0)}else t?this._cachedCameraPosition.equals(t.globalPosition)||(this._cachedCameraPosition.t(t.globalPosition),mV.audioContext.listener.setPosition(t.globalPosition.x,t.globalPosition.y,t.globalPosition.z)):mV.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const V=this.audioListenerRotationProvider();mV.audioContext.listener.setOrientation(V.x||0,V.y||0,V.z||0,0,1,0)}else t?(t.rigCameras&&t.rigCameras.length>0&&(t=t.rigCameras[0]),t.getViewMatrix().invertToRef(this._invertMatrixTemp),L.sh.TransformNormalToRef(Nm._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.t(this._cameraDirectionTemp),mV.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):mV.audioContext.listener.setOrientation(0,0,0,0,1,0);for(V=0;V<h.mainSoundTrack.soundCollection.length;V++){const mV=h.mainSoundTrack.soundCollection[V];mV.useCustomAttenuation&&mV.updateDistanceFromListener()}if(h.soundTracks)for(V=0;V<h.soundTracks.length;V++)for(let mV=0;mV<h.soundTracks[V].soundCollection.length;mV++){const t=h.soundTracks[V].soundCollection[mV];t.useCustomAttenuation&&t.updateDistanceFromListener()}}}}Nm._CameraDirection=new L.sh(0,0,-1),Xh._SceneComponentInitialization=V=>{let h=V._getComponent(Vm.b.NAME_AUDIO);h||(h=new Nm(V),V.o(h))};const Am="MSFT_audio_emitter";class km{constructor(V){this.name=Am,this._loader=V,this.enabled=this._loader.isExtensionUsed(Am)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const V=this._loader.qk.extensions;if(V&&V[this.name]){const h=V[this.name];this._clips=h.clips,this._emitters=h.emitters,E.Assign(this._clips),E.Assign(this._emitters)}}loadSceneAsync(V,h){return i.LoadExtensionAsync(V,h,this.name,(async(mV,t)=>{const L=new Array;L.push(this._loader.loadSceneAsync(V,h));for(const V of t.emitters){const h=E.Get(`${mV}/emitters`,this._emitters,V);if(void 0!=h.refDistance||void 0!=h.maxDistance||void 0!=h.rolloffFactor||void 0!=h.distanceModel||void 0!=h.innerAngle||void 0!=h.outerAngle)throw new Error(`${mV}: Direction or Distance properties are not allowed on emitters attached to a scene`);L.push(this._loadEmitterAsync(`${mV}/emitters/${h.index}`,h))}await Promise.all(L)}))}loadNodeAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(V,t)=>{const N=new Array,k=await this._loader.loadNodeAsync(V,h,(h=>{for(const mV of t.emitters){const t=E.Get(`${V}/emitters`,this._emitters,mV);N.push(this._loadEmitterAsync(`${V}/emitters/${t.index}`,t).then((()=>{for(const V of t._babylonSounds)V.attachToMesh(h),void 0==t.innerAngle&&void 0==t.outerAngle||(V.setLocalDirectionToMesh(L.sh.Forward()),V.setDirectionalCone(2*A.Tools.ToDegrees(void 0==t.innerAngle?Math.PI:t.innerAngle),2*A.Tools.ToDegrees(void 0==t.outerAngle?Math.PI:t.outerAngle),0))})))}mV(h)}));return await Promise.all(N),k}))}loadAnimationAsync(V,h){return i.LoadExtensionAsync(V,h,this.name,(async(mV,t)=>{const L=await this._loader.loadAnimationAsync(V,h),N=new Array;E.Assign(t.events);for(const A of t.events)N.push(this._loadAnimationEventAsync(`${mV}/events/${A.index}`,V,h,A,L));return await Promise.all(N),L}))}_loadClipAsync(V,h){if(h._objectURL)return h._objectURL;let mV;if(h.uri)mV=this._loader.loadUriAsync(V,h,h.uri);else{const t=E.Get(`${V}/bufferView`,this._loader.qk.bufferViews,h.bufferView);mV=this._loader.loadBufferViewAsync(`/bufferViews/${t.index}`,t)}return h._objectURL=mV.then((V=>URL.createObjectURL(new Blob([V],{type:h.mimeType})))),h._objectURL}_loadEmitterAsync(V,h){if(h._babylonSounds=h._babylonSounds||[],!h._babylonData){const V=new Array,mV=h.name||`emitter${h.index}`,t={loop:!1,autoplay:!1,volume:void 0==h.volume?1:h.volume};for(let N=0;N<h.clips.length;N++){const L=`/extensions/${this.name}/clips`,A=E.Get(L,this._clips,h.clips[N].clip);V.push(this._loadClipAsync(`${L}/${h.clips[N].clip}`,A).then((V=>{const L=h._babylonSounds[N]=new Xh(mV,V,this._loader.babylonScene,null,t);L.refDistance=h.refDistance||1,L.maxDistance=h.maxDistance||256,L.rolloffFactor=h.rolloffFactor||1,L.distanceModel=h.distanceModel||"exponential"})))}const L=Promise.all(V).then((()=>{const V=h.clips.map((V=>V.weight||1)),mV=new ah(h.loop||!1,h._babylonSounds,V);h.innerAngle&&(mV.directionalConeInnerAngle=2*A.Tools.ToDegrees(h.innerAngle)),h.outerAngle&&(mV.directionalConeOuterAngle=2*A.Tools.ToDegrees(h.outerAngle)),h.volume&&(mV.volume=h.volume),h._babylonData.sound=mV}));h._babylonData={loaded:L}}return h._babylonData.loaded}_getEventAction(V,h,mV,t,L){switch(mV){case"play":return V=>{const mV=(L||0)+(V-t);h.play(mV)};case"stop":return()=>{h.stop()};case"pause":return()=>{h.pause()};default:throw new Error(`${V}: Unsupported action ${mV}`)}}_loadAnimationEventAsync(V,h,mV,t,L){if(0==L.targetedAnimations.length)return Promise.resolve();const N=L.targetedAnimations[0],A=t.Lh,k=E.Get(`/extensions/${this.name}/emitters`,this._emitters,A);return this._loadEmitterAsync(V,k).then((()=>{const h=k._babylonData.sound;if(h){const mV=new Uh(t.time,this._getEventAction(V,h,t.action,t.time,t.startOffset));N.animation.addEvent(mV),L.onAnimationGroupEndObservable.add((()=>{h.stop()})),L.onAnimationGroupPauseObservable.add((()=>{h.pause()}))}}))}}f(Am),Z(Am,!0,(V=>new km(V)));const Cm="MSFT_lod";class Km{constructor(V){var h;this.name=Cm,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new o.d,this.onMaterialLODsLoadedObservable=new o.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=V,this.maxLODsToLoad=(null===(h=this._loader.parent.extensionOptions[Cm])||void 0===h?void 0:h.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Cm)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let V=0;V<this._nodePromiseLODs.length;V++){const h=Promise.all(this._nodePromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Node LOD ${V}`),this._loader.log(`Loaded node LOD ${V}`)),this.onNodeLODsLoadedObservable.notifyObservers(V),V!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${V+1}`),this._loadBufferLOD(this._nodeBufferLODs,V+1),this._nodeSignalLODs[V]&&this._nodeSignalLODs[V].resolve())}));this._loader._completePromises.push(h)}for(let V=0;V<this._materialPromiseLODs.length;V++){const h=Promise.all(this._materialPromiseLODs[V]).then((()=>{0!==V&&(this._loader.endPerformanceCounter(`Material LOD ${V}`),this._loader.log(`Loaded material LOD ${V}`)),this.onMaterialLODsLoadedObservable.notifyObservers(V),V!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${V+1}`),this._loadBufferLOD(this._materialBufferLODs,V+1),this._materialSignalLODs[V]&&this._materialSignalLODs[V].resolve())}));this._loader._completePromises.push(h)}}loadSceneAsync(V,h){const mV=this._loader.loadSceneAsync(V,h);return this._loadBufferLOD(this._bufferLODs,0),mV}loadNodeAsync(V,h,mV){return i.LoadExtensionAsync(V,h,this.name,(async(V,L)=>{let N;const A=this._getLODs(V,h,this._loader.qk.nodes,L.ids);this._loader.logOpen(`${V}`);for(let h=0;h<A.length;h++){const V=A[h];0!==h&&(this._nodeIndexLOD=h,this._nodeSignalLODs[h]=this._nodeSignalLODs[h]||new t);const L=V=>{mV(V),V.ek(!1)},k=this._loader.loadNodeAsync(`/nodes/${V.index}`,V,L).then((V=>{if(0!==h){const V=A[h-1];V._babylonTransformNode&&(this._disposeTransformNode(V._babylonTransformNode),delete V._babylonTransformNode)}return V.ek(!0),V}));this._nodePromiseLODs[h]=this._nodePromiseLODs[h]||[],0===h?N=k:(this._nodeIndexLOD=null,this._nodePromiseLODs[h].push(k))}return this._loader.logClose(),await N}))}_loadMaterialAsync(V,h,mV,t,L){return this._nodeIndexLOD?null:i.LoadExtensionAsync(V,h,this.name,(async(V,N)=>{let A;const k=this._getLODs(V,h,this._loader.qk.materials,N.ids);this._loader.logOpen(`${V}`);for(let h=0;h<k.length;h++){const V=k[h];0!==h&&(this._materialIndexLOD=h);const N=this._loader._loadMaterialAsync(`/materials/${V.index}`,V,mV,t,(V=>{0===h&&L(V)})).then((V=>{if(0!==h){L(V);const mV=k[h-1]._data;mV[t]&&(this._disposeMaterials([mV[t].babylonMaterial]),delete mV[t])}return V}));this._materialPromiseLODs[h]=this._materialPromiseLODs[h]||[],0===h?A=N:(this._materialIndexLOD=null,this._materialPromiseLODs[h].push(N))}return this._loader.logClose(),await A}))}_loadUriAsync(V,h,mV){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const L=this._nodeIndexLOD-1;return this._nodeSignalLODs[L]=this._nodeSignalLODs[L]||new t,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(V,h,mV)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const L=this._materialIndexLOD-1;return this._materialSignalLODs[L]=this._materialSignalLODs[L]||new t,this._materialSignalLODs[L].promise.then((async()=>await this._loader.loadUriAsync(V,h,mV)))}return null}loadBufferAsync(V,h,mV,L){if(this._loader.parent.useRangeRequests&&!h.uri){if(!this._loader.bin)throw new Error(`${V}: Uri is missing or the binary glTF is missing its binary chunk`);const h=async(V,h)=>{const N=mV,A=N+L-1;let k=V[h];return k?(k.start=Math.min(k.start,N),k.end=Math.max(k.end,A)):(k={start:N,end:A,loaded:new t},V[h]=k),await k.loaded.promise.then((V=>new Uint8Array(V.buffer,V.byteOffset+mV-k.start,L)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?h(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?h(this._materialBufferLODs,this._materialIndexLOD):h(this._bufferLODs,0)}return null}_loadBufferLOD(V,h){const mV=V[h];mV&&(this._loader.log(`Loading buffer range [${mV.start}-${mV.end}]`),this._loader.bin.readAsync(mV.start,mV.end-mV.start+1).then((V=>{mV.loaded.resolve(V)}),(V=>{mV.loaded.reject(V)})))}_getLODs(V,h,mV,t){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const L=[];for(let N=t.length-1;N>=0;N--)if(L.push(E.Get(`${V}/ids/${t[N]}`,mV,t[N])),L.length===this.maxLODsToLoad)return L;return L.push(h),L}_disposeTransformNode(V){const h=[],mV=V.material;mV&&h.push(mV);for(const L of V.getChildMeshes())L.material&&h.push(L.material);V.dispose();const t=h.filter((V=>this._loader.babylonScene.meshes.every((h=>h.material!=V))));this._disposeMaterials(t)}_disposeMaterials(V){const h={};for(const mV of V){for(const V of mV.getActiveTextures())h[V.uniqueId]=V;mV.dispose()}for(const mV in h)for(const V of this._loader.babylonScene.materials)V.hasTexture(h[mV])&&delete h[mV];for(const mV in h)h[mV].dispose()}}f(Cm),Z(Cm,!0,(V=>new Km(V)));const om="MSFT_minecraftMesh";class nm{constructor(V){this.name=om,this._loader=V,this.enabled=this._loader.isExtensionUsed(om)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtraAsync(V,h,this.name,(async(t,L)=>{if(L){if(!(mV instanceof z.c))throw new Error(`${t}: Material type not supported`);const L=this._loader.loadMaterialPropertiesAsync(V,h,mV);return mV.needAlphaBlending()&&(mV.forceDepthWrite=!0,mV.separateCullingPass=!0),mV.Dk=mV.forceDepthWrite,mV.twoSidedLighting=!0,await L}}))}}f(om),Z(om,!0,(V=>new nm(V)));const qm="MSFT_sRGBFactors";class xm{constructor(V){this.name=qm,this._loader=V,this.enabled=this._loader.isExtensionUsed(qm)}dispose(){this._loader=null}loadMaterialPropertiesAsync(V,h,mV){return i.LoadExtraAsync(V,h,this.name,(async(t,L)=>{if(L){if(!(mV instanceof z.c))throw new Error(`${t}: Material type not supported`);const L=this._loader.loadMaterialPropertiesAsync(V,h,mV),N=mV.DV().getEngine().useExactSrgbConversions;return mV.albedoTexture||mV.albedoColor.toLinearSpaceToRef(mV.albedoColor,N),mV.reflectivityTexture||mV.reflectivityColor.toLinearSpaceToRef(mV.reflectivityColor,N),await L}}))}}f(qm),Z(qm,!0,(V=>new xm(V)));var Rm=mV(14097);const dm={};var sm=mV(14137),Mm=mV(14119),cm=mV(14100),zm=mV(14109);function Qm(V,h){for(const mV of V)for(const V of mV.dataOutputs)if(V.uniqueId===h)return V;throw new Error("Could not find data out connection with unique id "+h)}function Jm(V,h){for(const mV of V)if(mV instanceof Mm.b)for(const V of mV.signalInputs)if(V.uniqueId===h)return V;throw new Error("Could not find signal in connection with unique id "+h)}async function vm(V,h){const t=await Promise.all(V.allBlocks.map((async V=>{const h=function(V){switch(V){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([mV.e(78),mV.e(79)]).then(mV.bind(mV,15546))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await mV.e(80).then(mV.bind(mV,15551))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await mV.e(81).then(mV.bind(mV,15553))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await mV.e(82).then(mV.bind(mV,15559))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await mV.e(83).then(mV.bind(mV,15565))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await mV.e(84).then(mV.bind(mV,15574))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await mV.e(85).then(mV.bind(mV,15583))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await mV.e(86).then(mV.bind(mV,15592))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await mV.e(87).then(mV.bind(mV,15600))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await mV.e(90).then(mV.bind(mV,15632))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await mV.e(90).then(mV.bind(mV,15632))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await mV.e(90).then(mV.bind(mV,15632))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await mV.e(90).then(mV.bind(mV,15632))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await mV.e(95).then(mV.bind(mV,15636))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await mV.e(96).then(mV.bind(mV,15642))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await mV.e(97).then(mV.bind(mV,15645))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await mV.e(98).then(mV.bind(mV,15653))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await mV.e(99).then(mV.bind(mV,15659))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await mV.e(100).then(mV.bind(mV,15667))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await mV.e(101).then(mV.bind(mV,15670))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await mV.e(102).then(mV.bind(mV,15672))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await mV.e(103).then(mV.bind(mV,15678))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await mV.e(104).then(mV.bind(mV,15680))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await mV.e(105).then(mV.bind(mV,15688))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await mV.e(106).then(mV.bind(mV,15690))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await mV.e(107).then(mV.bind(mV,15698))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await mV.e(108).then(mV.bind(mV,15703))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await mV.e(109).then(mV.bind(mV,15710))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await mV.e(110).then(mV.bind(mV,15714))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await mV.e(111).then(mV.bind(mV,15719))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await mV.e(112).then(mV.bind(mV,15724))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await mV.e(113).then(mV.bind(mV,15731))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await mV.e(92).then(mV.bind(mV,15737))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await mV.e(114).then(mV.bind(mV,15743))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await mV.e(115).then(mV.bind(mV,15749))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await mV.e(116).then(mV.bind(mV,15753))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await mV.e(93).then(mV.bind(mV,15755))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await mV.e(88).then(mV.bind(mV,15606))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await mV.e(94).then(mV.bind(mV,15764))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await mV.e(89).then(mV.bind(mV,15627))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await mV.e(90).then(mV.bind(mV,15632))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await mV.e(90).then(mV.bind(mV,15632))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await mV.e(91).then(mV.bind(mV,15770))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await mV.e(91).then(mV.bind(mV,15770))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await mV.e(91).then(mV.bind(mV,15770))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await mV.e(91).then(mV.bind(mV,15770))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await mV.e(91).then(mV.bind(mV,15770))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await mV.e(91).then(mV.bind(mV,15770))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await mV.e(117).then(mV.bind(mV,15779))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await mV.e(118).then(mV.bind(mV,15787))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await mV.e(119).then(mV.bind(mV,15792))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await mV.e(120).then(mV.bind(mV,15801))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await mV.e(121).then(mV.bind(mV,15806))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await mV.e(122).then(mV.bind(mV,15814))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await mV.e(123).then(mV.bind(mV,15818))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await mV.e(124).then(mV.bind(mV,15821))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await mV.e(125).then(mV.bind(mV,15828))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await mV.e(126).then(mV.bind(mV,15831))).FlowGraphDataSwitchBlock;default:if(dm[V])return dm[V];throw new Error(`Unknown block name ${V}`)}}(V.className);return await h()})));return function(V,h,mV){const t=h.coordinator.createGraph(),L=[],N=h.valueParseFunction??cm.d;for(let A=0;A<V.allBlocks.length;A++){const k=Hm(V.allBlocks[A],{zh:h.coordinator.config.zh,pathConverter:h.pathConverter,assetsContainer:h.coordinator.config.zh,valueParseFunction:N},mV[A]);L.push(k),k instanceof sm.e&&t.addEventBlock(k)}for(const A of L){for(const V of A.dataInputs)for(const h of V.connectedPointIds){const mV=Qm(L,h);V.connectTo(mV)}if(A instanceof Mm.b)for(const V of A.signalOutputs)for(const h of V.connectedPointIds){const mV=Jm(L,h);V.connectTo(mV)}}for(const A of V.executionContexts)Dm(A,{graph:t,valueParseFunction:N},V.rightHanded);return t}(V,h,t)}function Dm(V,h,mV){const t=h.graph.createContext();V.enableLogging&&(t.enableLogging=!0),t.treatDataAsRightHanded=mV||!1;const L=h.valueParseFunction??cm.d;t.uniqueId=V.uniqueId;const N=t.DV();if(V._assetsContext){var A,k,C,K,o,n,q,x,R,d;const h=V._assetsContext,mV={meshes:null===(A=h.meshes)||void 0===A?void 0:A.map((V=>N.getMeshById(V))),lights:null===(k=h.lights)||void 0===k?void 0:k.map((V=>N.getLightByName(V))),cameras:null===(C=h.cameras)||void 0===C?void 0:C.map((V=>N.getCameraByName(V))),materials:null===(K=h.materials)||void 0===K?void 0:K.map((V=>N.getMaterialById(V))),textures:null===(o=h.textures)||void 0===o?void 0:o.map((V=>N.getTextureByName(V))),animations:null===(n=h.animations)||void 0===n?void 0:n.map((V=>N.animations.find((h=>h.name===V)))),skeletons:null===(q=h.skeletons)||void 0===q?void 0:q.map((V=>N.getSkeletonByName(V))),Lq:null===(x=h.Lq)||void 0===x?void 0:x.map((V=>N.getParticleSystemById(V))),animationGroups:null===(R=h.animationGroups)||void 0===R?void 0:R.map((V=>N.getAnimationGroupByName(V))),transformNodes:null===(d=h.transformNodes)||void 0===d?void 0:d.map((V=>N.getTransformNodeById(V))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Sq:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};t.assetsContext=mV}for(const s in V._userVariables){const h=L(s,V._userVariables,t.assetsContext,N);t.userVariables[s]=h}for(const s in V._connectionValues){const h=L(s,V._connectionValues,t.assetsContext,N);t._setConnectionValueByKey(s,h)}return t}function Hm(V,h,mV){const t={},L=h.valueParseFunction??cm.d;if(V.config)for(const A in V.config)t[A]=L(A,V.config,h.assetsContainer||h.zh,h.zh);if((0,cm.h)(V.className)){if(!h.pathConverter)throw new Error("Path converter is required for this block");t.pathConverter=h.pathConverter}const N=new mV(t);N.uniqueId=V.uniqueId;for(let A=0;A<V.dataInputs.length;A++){const h=N.getDataInput(V.dataInputs[A].name);if(!h)throw new Error("Could not find data input with name "+V.dataInputs[A].name+" in block "+V.className);h.deserialize(V.dataInputs[A])}for(let A=0;A<V.dataOutputs.length;A++){const h=N.getDataOutput(V.dataOutputs[A].name);if(!h)throw new Error("Could not find data output with name "+V.dataOutputs[A].name+" in block "+V.className);h.deserialize(V.dataOutputs[A])}return N.metadata=V.metadata,N.deserialize&&N.deserialize(V),N}function jm(V){const[h,mV]=V.split(":");return lm({op:h,extension:mV})}function lm(V){var h;let mV=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const t=V.extension?null===(h=ym[V.extension])||void 0===h?void 0:h[V.op]:Om[V.op];if(!t&&(d.e.Warn(`No mapping found for operation ${V.op} and extension ${V.extension||"KHR_interactivity"}`),mV)){const h={},mV={flows:{}};if(V.inputValueSockets){h.values={};for(const mV in V.inputValueSockets)h.values[mV]={name:mV}}return V.outputValueSockets&&(mV.values={},Object.keys(V.outputValueSockets).forEach((V=>{mV.values[V]={name:V}}))),{zo:[],inputs:h,outputs:mV}}return t}function Gm(V,h,mV){ym[h]||(ym[h]={}),ym[h][V]=mV}const ym={BABYLON:{"flow/log":{zo:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Om={"event/onStart":{zo:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{zo:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{zo:["FlowGraphSendCustomEventBlock"],extraProcessor(V,h,mV,t,L){if("event/send"!==h.op||!V.configuration||1!==Object.keys(V.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=V.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const A=t.arrays.events[N],k=L[0];return k.config||(k.config={}),k.config.eventId=A.eventId,k.config.eventData=A.eventData,L}},"event/receive":{zo:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(V,h){var mV;if(!V.configuration)return d.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const t=V.configuration.event;if(!t)return d.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const L=t.value[0];if("number"!==typeof L)return d.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(mV=h.events)||void 0===mV?void 0:mV[L])?{valid:!0}:(d.e.Error(`Event with id ${L} not found`),{valid:!1,error:`Event with id ${L} not found`})},extraProcessor(V,h,mV,t,L){if("event/receive"!==h.op||!V.configuration||1!==Object.keys(V.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const N=V.configuration.event.value[0];if("number"!==typeof N)throw new Error("Event id should be a number");const A=t.arrays.events[N],k=L[0];return k.config||(k.config={}),k.config.eventId=A.eventId,k.config.eventData=A.eventData,L}},"math/e":Im("FlowGraphEBlock"),"math/pi":Im("FlowGraphPIBlock"),"math/inf":Im("FlowGraphInfBlock"),"math/nan":Im("FlowGraphNaNBlock"),"math/abs":Im("FlowGraphAbsBlock"),"math/sign":Im("FlowGraphSignBlock"),"math/trunc":Im("FlowGraphTruncBlock"),"math/floor":Im("FlowGraphFloorBlock"),"math/ceil":Im("FlowGraphCeilBlock"),"math/round":{zo:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L){var N;return(N=L[0]).config||(N.config={}),L[0].config.roundHalfAwayFromZero=!0,L}},"math/fract":Im("FlowGraphFractBlock"),"math/neg":Im("FlowGraphNegationBlock"),"math/add":Im("FlowGraphAddBlock",["a","b"],!0),"math/sub":Im("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{zo:["FlowGraphMultiplyBlock"],extraProcessor(V,h,mV,t,L){var N;(N=L[0]).config||(N.config={}),L[0].config.useMatrixPerComponent=!0,L[0].config.preventIntegerFloatArithmetic=!0;let A=-1;return Object.keys(V.values||{}).find((h=>{var mV;return void 0!==(null===(mV=V.values)||void 0===mV?void 0:mV[h].type)&&(A=V.values[h].type,!0)})),-1!==A&&(L[0].config.type=t.arrays.types[A].flowGraphType),L},validation:V=>V.values?rm(V):{valid:!0}},"math/div":Im("FlowGraphDivideBlock",["a","b"],!0),"math/rem":Im("FlowGraphModuloBlock",["a","b"]),"math/min":Im("FlowGraphMinBlock",["a","b"]),"math/max":Im("FlowGraphMaxBlock",["a","b"]),"math/clamp":Im("FlowGraphClampBlock",["a","b","c"]),"math/saturate":Im("FlowGraphSaturateBlock"),"math/mix":Im("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":Im("FlowGraphEqualityBlock",["a","b"]),"math/lt":Im("FlowGraphLessThanBlock",["a","b"]),"math/le":Im("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":Im("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":Im("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":Im("FlowGraphIsNaNBlock"),"math/isinf":Im("FlowGraphIsInfBlock"),"math/select":{zo:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{zo:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":Im("FlowGraphSinBlock"),"math/cos":Im("FlowGraphCosBlock"),"math/tan":Im("FlowGraphTanBlock"),"math/asin":Im("FlowGraphASinBlock"),"math/acos":Im("FlowGraphACosBlock"),"math/atan":Im("FlowGraphATanBlock"),"math/atan2":Im("FlowGraphATan2Block",["a","b"]),"math/sinh":Im("FlowGraphSinhBlock"),"math/cosh":Im("FlowGraphCoshBlock"),"math/tanh":Im("FlowGraphTanhBlock"),"math/asinh":Im("FlowGraphASinhBlock"),"math/acosh":Im("FlowGraphACoshBlock"),"math/atanh":Im("FlowGraphATanhBlock"),"math/exp":Im("FlowGraphExponentialBlock"),"math/log":Im("FlowGraphLogBlock"),"math/log2":Im("FlowGraphLog2Block"),"math/log10":Im("FlowGraphLog10Block"),"math/sqrt":Im("FlowGraphSquareRootBlock"),"math/cbrt":Im("FlowGraphCubeRootBlock"),"math/pow":Im("FlowGraphPowerBlock",["a","b"]),"math/length":Im("FlowGraphLengthBlock"),"math/normalize":Im("FlowGraphNormalizeBlock"),"math/dot":Im("FlowGraphDotBlock",["a","b"]),"math/cross":Im("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":Im("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":Im("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{zo:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{zo:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{zo:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{zo:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{zo:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{zo:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{zo:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":Im("FlowGraphTransposeBlock"),"math/determinant":Im("FlowGraphDeterminantBlock"),"math/inverse":Im("FlowGraphInvertMatrixBlock"),"math/matmul":Im("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{zo:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"jk",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L,N){const A=L[0].dataInputs.find((V=>"rotationQuaternion"===V.name));if(!A)throw new Error("Rotation quaternion input not found");return N._connectionValues[A.uniqueId]&&(N._connectionValues[A.uniqueId].type="Quaternion"),L}},"math/matDecompose":{zo:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"jk"}}}},"math/quatConjugate":Im("FlowGraphConjugateBlock",["a"]),"math/quatMul":{zo:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L){var N;return(N=L[0]).config||(N.config={}),L[0].config.type="Quaternion",L}},"math/quatAngleBetween":Im("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{zo:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":Im("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":Im("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{zo:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L){var N;return(N=L[0]).config||(N.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract2x2":{zo:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{zo:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L){var N;return(N=L[0]).config||(N.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract3x3":{zo:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{zo:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L){var N;return(N=L[0]).config||(N.config={}),L[0].config.inputIsColumnMajor=!0,L}},"math/extract4x4":{zo:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{zo:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L,N){var A,k;(k=L[0]).config||(k.config={});const C=L[0].dataInputs[0];return L[0].config.valueType=(null===(A=N._connectionValues[C.uniqueId])||void 0===A?void 0:A.type)??"FlowGraphInteger",L}},"math/and":{zo:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L,N){var A,k,C;(C=L[0]).config||(C.config={});const K=L[0].dataInputs[0],o=L[0].dataInputs[1];return L[0].config.valueType=(null===(A=N._connectionValues[K.uniqueId])||void 0===A?void 0:A.type)??(null===(k=N._connectionValues[o.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",L}},"math/or":{zo:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L,N){var A,k,C;(C=L[0]).config||(C.config={});const K=L[0].dataInputs[0],o=L[0].dataInputs[1];return L[0].config.valueType=(null===(A=N._connectionValues[K.uniqueId])||void 0===A?void 0:A.type)??(null===(k=N._connectionValues[o.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",L}},"math/xor":{zo:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(V,h,mV,t,L,N){var A,k,C;(C=L[0]).config||(C.config={});const K=L[0].dataInputs[0],o=L[0].dataInputs[1];return L[0].config.valueType=(null===(A=N._connectionValues[K.uniqueId])||void 0===A?void 0:A.type)??(null===(k=N._connectionValues[o.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",L}},"math/asr":Im("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":Im("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":Im("FlowGraphLeadingZerosBlock"),"math/ctz":Im("FlowGraphTrailingZerosBlock"),"math/popcnt":Im("FlowGraphOneBitsCounterBlock"),"math/rad":Im("FlowGraphDegToRadBlock"),"math/deg":Im("FlowGraphRadToDegBlock"),"type/boolToInt":Im("FlowGraphBooleanToInt"),"type/boolToFloat":Im("FlowGraphBooleanToFloat"),"type/intToBool":Im("FlowGraphIntToBoolean"),"type/intToFloat":Im("FlowGraphIntToFloat"),"type/floatToInt":Im("FlowGraphFloatToInt"),"type/floatToBool":Im("FlowGraphFloatToBoolean"),"flow/sequence":{zo:["FlowGraphSequenceBlock"],extraProcessor(V,h,mV,t,L){const N=L[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(V.flows||[]).length,N.signalOutputs.forEach(((V,h)=>{V.name="out_"+h})),L}},"flow/branch":{zo:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{zo:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(V){if(V.configuration&&V.configuration.cases){const h=V.configuration.cases.value;if(!h.every((V=>"number"===typeof V&&/^-?\d+$/.test(V.toString()))))return d.e.Warn("Switch cases should be integers. Using empty array instead."),V.configuration.cases.value=[],{valid:!0};const mV=new Set(h);V.configuration.cases.value=Array.from(mV)}return{valid:!0}},extraProcessor(V,h,mV,t,L){if("flow/switch"!==h.op||!V.flows||0===Object.keys(V.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return L[0].signalOutputs.forEach((V=>{"default"!==V.name&&(V.name="out_"+V.name)})),L}},"flow/while":{zo:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{zo:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(V,h,mV,t,L){const N=L[0];return N.config||(N.config={}),N.config.incrementIndexWhenLoopDone=!0,L}},"flow/doN":{zo:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{zo:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(V,h,mV,t,L){if("flow/multiGate"!==h.op||!V.flows||0===Object.keys(V.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const N=L[0];return N.config||(N.config={}),N.config.outputSignalCount=Object.keys(V.flows).length,N.signalOutputs.forEach(((V,h)=>{V.name="out_"+h})),L}},"flow/waitAll":{zo:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(V){var h,mV;return"number"!==typeof(null===(h=V.configuration)||void 0===h||null===(mV=h.inputFlows)||void 0===mV?void 0:mV.value[0])&&(V.configuration=V.configuration||{inputFlows:{value:[0]}},V.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{zo:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{zo:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{zo:["FlowGraphCancelDelayBlock"]},"variable/get":{zo:["FlowGraphGetVariableBlock"],validation(V){var h,mV;return null!==(h=V.configuration)&&void 0!==h&&null!==(mV=h.variable)&&void 0!==mV&&mV.value?{valid:!0}:(d.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(V,h)=>[h.getVariableName(V[0])]}}},"variable/set":{zo:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(V,h)=>[h.getVariableName(V[0])]}}},"variable/setMultiple":{zo:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(V,h)=>[V[0].map((V=>h.getVariableName(V)))]}},extraProcessor:(V,h,mV,t,L)=>(L[0].dataInputs.forEach((V=>{V.name=t.getVariableName(+V.name)})),L)},"variable/interpolate":{zo:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(V,h)=>[h.getVariableName(V[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:V=>!0===V[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rm:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rm:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rm:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rm:"FlowGraphPlayAnimationBlock"},out:{name:"out",rm:"FlowGraphPlayAnimationBlock"},done:{name:"done",rm:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(V,h,mV,t,L){var N,A,k;const C=L[0],K=null===(N=V.configuration)||void 0===N?void 0:N.variable.value[0];if("number"!==typeof K)throw d.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const o=t.arrays.staticVariables[K];"undefined"===typeof C.config.animationType.value&&(t.arrays.staticVariables,C.config.animationType.value=(0,zm.E)(o.type));const n=L[4];return n.config||(n.config={}),(A=n.config).variable||(A.variable={}),n.config.variable.value=t.getVariableName(K),(k=L[3]).config||(k.config={}),L}},"pointer/get":{zo:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rm:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",rm:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,h,mV,t,L)=>(L.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className&&(V.config||(V.config={}),V.config.outputValue=!0)})),L)},"pointer/set":{zo:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",rm:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",rm:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,h,mV,t,L)=>(L.forEach((V=>{"FlowGraphJsonPointerParserBlock"===V.className&&(V.config||(V.config={}),V.config.outputValue=!0)})),L)},"pointer/interpolate":{zo:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",rm:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",rm:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",rm:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",rm:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",rm:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",rm:"FlowGraphPlayAnimationBlock"},out:{name:"out",rm:"FlowGraphPlayAnimationBlock"},done:{name:"done",rm:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(V,h,mV,t,L)=>(L.forEach((h=>{"FlowGraphJsonPointerParserBlock"===h.className?(h.config||(h.config={}),h.config.outputValue=!0):"FlowGraphInterpolationBlock"===h.className&&(h.config||(h.config={}),Object.keys(V.values||[]).forEach((mV=>{var L;const N=null===(L=V.values)||void 0===L?void 0:L[mV];if("value"===mV&&N){const V=N.type;void 0!==V&&(h.config.animationType=t.arrays.types[V].flowGraphType)}})))})),L)},"animation/start":{zo:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rm:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(V,h)=>[V[0]*h._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(V,h)=>[V[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,h,mV,t,L,N,A){const k=L[L.length-1];return k.config||(k.config={}),k.config.glTF=A,L}},"animation/stop":{zo:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",rm:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,h,mV,t,L,N,A){const k=L[L.length-1];return k.config||(k.config={}),k.config.glTF=A,L}},"animation/stopAt":{zo:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",rm:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(V,h)=>[V[0]*h._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(V,h,mV,t,L,N,A){const k=L[L.length-1];return k.config||(k.config={}),k.config.glTF=A,L}},"math/switch":{zo:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(V){if(V.configuration&&V.configuration.cases){const h=V.configuration.cases.value;if(!h.every((V=>"number"===typeof V&&/^-?\d+$/.test(V.toString()))))return d.e.Warn("Switch cases should be integers. Using empty array instead."),V.configuration.cases.value=[],{valid:!0};const mV=new Set(h);V.configuration.cases.value=Array.from(mV)}return{valid:!0}},extraProcessor(V,h,mV,t,L){const N=L[0];return N.dataInputs.forEach((V=>{"default"!==V.name&&"case"!==V.name&&(V.name="in_"+V.name)})),N.config||(N.config={}),N.config.treatCasesAsIntegers=!0,L}},"debug/log":{zo:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function Im(V){let h=arguments.length>2?arguments[2]:void 0;return{zo:[V],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((V,h)=>(V[h]={name:h},V)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(V,mV,t,L,N){var A;if(h){(A=N[0]).config||(A.config={}),N[0].config.preventIntegerFloatArithmetic=!0;let h=-1;Object.keys(V.values||{}).find((mV=>{var t;return void 0!==(null===(t=V.values)||void 0===t?void 0:t[mV].type)&&(h=V.values[mV].type,!0)})),-1!==h&&(N[0].config.type=L.arrays.types[h].flowGraphType)}return N},validation:V=>h?rm(V):{valid:!0}}}function rm(V){if(V.values){const h=Object.keys(V.values).map((h=>V.values[h].type)).filter((V=>void 0!==V));if(!h.every((V=>V===h[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Om["math/compose"]=Om["math/matCompose"],Om["math/decompose"]=Om["math/matDecompose"];var Tm=mV(12393);const Fm={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"sh",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class pm{constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=V,this._gltf=h,this._animationTargetFps=mV,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const V of this._interactivityGraph.types)this._types.push(Fm[V.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const V of this._interactivityGraph.declarations){const h=lm(V);if(!h)throw d.e.Error(["No mapping found for declaration",V]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:h,fullOperationName:V.extension?V.op+":"+V.extension:V.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const V of this._interactivityGraph.variables){const h=this._parseVariable(V);this._staticVariables.push(h)}}_parseVariable(V,h){const mV=this._types[V.type];if(!mV)throw d.e.Error(["No type found for variable",V]),new Error("Error parsing variables");if(V.value&&V.value.length!==mV.length)throw d.e.Error(["Invalid value length for variable",V,mV]),new Error("Error parsing variables");const t=V.value||[];if(!t.length)switch(mV.flowGraphType){case"boolean":t.push(!1);break;case"FlowGraphInteger":t.push(0);break;case"number":t.push(NaN);break;case"Vector2":t.push(NaN,NaN);break;case"sh":t.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":t.fill(NaN,0,4);break;case"Matrix":t.fill(NaN,0,16);break;case"Matrix3D":t.fill(NaN,0,9)}return"number"===mV.elementType&&"string"===typeof t[0]&&(t[0]=parseFloat(t[0])),{type:mV.flowGraphType,value:h?h(t,this):t}}_parseEvents(){if(this._interactivityGraph.events)for(const V of this._interactivityGraph.events){const h={eventId:V.id||"internalEvent_"+this._internalEventsCounter++};V.values&&(h.eventData=Object.keys(V.values).map((h=>{var mV;const t=null===(mV=V.values)||void 0===mV?void 0:mV[h];if(!t)throw d.e.Error(["No value found for event key",h]),new Error("Error parsing events");const L=this._types[t.type];if(!L)throw d.e.Error(["No type found for event value",t]),new Error("Error parsing events");const N="undefined"!==typeof t.value?this._parseVariable(t):void 0;return{id:h,type:L.flowGraphType,eventData:!0,value:N}}))),this._events.push(h)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const h of this._interactivityGraph.nodes){if("number"!==typeof h.declaration)throw d.e.Error(["No declaration found for node",h]),new Error("Error parsing nodes");const mV=this._mappings[h.declaration];if(!mV)throw d.e.Error(["No mapping found for node",h]),new Error("Error parsing nodes");if(mV.flowGraphMapping.validation){const t=mV.flowGraphMapping.validation(h,this._interactivityGraph,this._gltf);var V;if(!t.valid)throw new Error(`Error validating interactivity node ${null===(V=this._interactivityGraph.declarations)||void 0===V?void 0:V[h.declaration].op} - ${t.error}`)}const t=[];for(const V of mV.flowGraphMapping.zo){const L=this._getEmptyBlock(V,mV.fullOperationName);this._parseNodeConfiguration(h,L,mV.flowGraphMapping,V),t.push(L)}this._nodes.push({zo:t,fullOperationName:mV.fullOperationName})}}_getEmptyBlock(V,h){return{uniqueId:(0,Tm.b)(),className:V,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:h,metadata:{}}}_parseNodeConfiguration(V,h,mV,t){const L=h.config;if(V.configuration){const h=Object.keys(V.configuration);for(const k of h){var N,A;const h=null===(N=V.configuration)||void 0===N?void 0:N[k];if(!h)throw d.e.Error(["No value found for node configuration",k]),new Error("Error parsing node configuration");const C=null===(A=mV.configuration)||void 0===A?void 0:A[k];if(C&&C.rm?C.rm===t:0===mV.zo.indexOf(t)){const V=(null===C||void 0===C?void 0:C.name)||k;h&&"undefined"!==typeof h.value||"undefined"===typeof(null===C||void 0===C?void 0:C.defaultValue)?h.value.length>=0?L[V]={value:1===h.value.length?h.value[0]:h.value}:d.e.Warn(["Invalid value for node configuration",h]):L[V]={value:C.defaultValue},C&&C.dataTransformer&&(L[V].value=C.dataTransformer([L[V].value],this)[0])}}}}_parseNodeConnections(V){for(let v=0;v<this._nodes.length;v++){var h;const D=null===(h=this._interactivityGraph.nodes)||void 0===h?void 0:h[v];if(!D)throw d.e.Error(["No node found for interactivity node",this._nodes[v]]),new Error("Error parsing node connections");const H=this._nodes[v],j=this._mappings[D.declaration];if(!j)throw d.e.Error(["No mapping found for node",D]),new Error("Error parsing node connections");const l=D.flows||{},G=Object.keys(l).sort();for(const V of G){var mV,t,L,N;const h=l[V],K=null===(mV=j.flowGraphMapping.outputs)||void 0===mV||null===(t=mV.flows)||void 0===t?void 0:t[V],o=(null===K||void 0===K?void 0:K.name)||V,n=this._createNewSocketConnection(o,!0);(K&&K.rm&&H.zo.find((V=>V.className===K.rm))||H.zo[0]).signalOutputs.push(n);const q=h.node,x=this._nodes[q];if(!x)throw d.e.Error(["No node found for input node id",q]),new Error("Error parsing node connections");const R=jm(x.fullOperationName);if(!R)throw d.e.Error(["No mapping found for input node",x]),new Error("Error parsing node connections");let s=null===(L=R.inputs)||void 0===L||null===(N=L.flows)||void 0===N?void 0:N[h.socket||"in"],M=!1;if(!s)for(const V in null===(A=R.inputs)||void 0===A?void 0:A.flows){var A,k,C;if(V.startsWith("[")&&V.endsWith("]"))M=!0,s=null===(k=R.inputs)||void 0===k||null===(C=k.flows)||void 0===C?void 0:C[V]}const c=s?M?s.name.replace("$1",h.socket||""):s.name:h.socket||"in",z=s&&s.rm&&x.zo.find((V=>V.className===s.rm))||x.zo[0];let Q=z.signalInputs.find((V=>V.name===c));Q||(Q=this._createNewSocketConnection(c),z.signalInputs.push(Q)),Q.connectedPointIds.push(n.uniqueId),n.connectedPointIds.push(Q.uniqueId)}const y=D.values||{},O=Object.keys(y);for(const h of O){var K,o;const mV=y[h];let t=null===(K=j.flowGraphMapping.inputs)||void 0===K||null===(o=K.values)||void 0===o?void 0:o[h],L=!1;if(!t)for(const V in null===(n=j.flowGraphMapping.inputs)||void 0===n?void 0:n.values){var n,q,x;if(V.startsWith("[")&&V.endsWith("]"))L=!0,t=null===(q=j.flowGraphMapping.inputs)||void 0===q||null===(x=q.values)||void 0===x?void 0:x[V]}const N=t?L?t.name.replace("$1",h):t.name:h,A=this._createNewSocketConnection(N);if((t&&t.rm&&H.zo.find((V=>V.className===t.rm))||H.zo[0]).dataInputs.push(A),void 0!==mV.value){const h=this._parseVariable(mV,t&&t.dataTransformer);V._connectionValues[A.uniqueId]=h}else{if("undefined"===typeof mV.node)throw d.e.Error(["Invalid value for value connection",mV]),new Error("Error parsing node connections");{var R,s,M;const V=mV.node,h=mV.socket||"value",t=this._nodes[V];if(!t)throw d.e.Error(["No node found for output socket reference",mV]),new Error("Error parsing node connections");const L=jm(t.fullOperationName);if(!L)throw d.e.Error(["No mapping found for output socket reference",mV]),new Error("Error parsing node connections");let N=null===(R=L.outputs)||void 0===R||null===(s=R.values)||void 0===s?void 0:s[h],k=!1;if(!N)for(const mV in null===(c=L.outputs)||void 0===c?void 0:c.values){var c,z,Q;if(mV.startsWith("[")&&mV.endsWith("]"))k=!0,N=null===(z=L.outputs)||void 0===z||null===(Q=z.values)||void 0===Q?void 0:Q[mV]}const C=N?k?N.name.replace("$1",h):null===(M=N)||void 0===M?void 0:M.name:h,K=N&&N.rm&&t.zo.find((V=>V.className===N.rm))||t.zo[0];let o=K.dataOutputs.find((V=>V.name===C));o||(o=this._createNewSocketConnection(C,!0),K.dataOutputs.push(o)),A.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(A.uniqueId)}}}if(j.flowGraphMapping.interBlockConnectors)for(const V of j.flowGraphMapping.interBlockConnectors){const h=V.input,mV=V.output,t=V.isVariable;this._connectFlowGraphNodes(h,mV,H.zo[V.inputBlockIndex],H.zo[V.outputBlockIndex],t)}if(j.flowGraphMapping.extraProcessor){var J;const h=null===(J=this._interactivityGraph.declarations)||void 0===J?void 0:J[D.declaration];if(!h)throw d.e.Error(["No declaration found for extra processor",D]),new Error("Error parsing node connections");H.zo=j.flowGraphMapping.extraProcessor(D,h,j.flowGraphMapping,this,H.zo,V,this._gltf)}}}_createNewSocketConnection(V,h){return{uniqueId:(0,Tm.b)(),name:V,_connectionType:h?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(V,h,mV,t,L){const N=L?mV.dataInputs:mV.signalInputs,A=L?t.dataOutputs:t.signalOutputs,k=N.find((h=>h.name===V))||this._createNewSocketConnection(V),C=A.find((V=>V.name===h))||this._createNewSocketConnection(h,!0);N.find((h=>h.name===V))||N.push(k),A.find((V=>V.name===h))||A.push(C),k.connectedPointIds.push(C.uniqueId),C.connectedPointIds.push(k.uniqueId)}getVariableName(V){return"staticVariable_"+V}serializeToFlowGraph(){const V={uniqueId:(0,Tm.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(V);for(let h=0;h<this._staticVariables.length;h++){const mV=this._staticVariables[h];V._userVariables[this.getVariableName(h)]=mV}return{rightHanded:!0,allBlocks:this._nodes.reduce(((V,h)=>V.concat(h.zo)),[]),executionContexts:[V]}}}const Zm="KHR_interactivity";class fm{constructor(V){this._loader=V,this.name=Zm,this.enabled=this._loader.isExtensionUsed(Zm),this._pathConverter=(0,S.i)(this._loader.qk),V._skipStartAnimationStep=!0;const h=V.babylonScene;h&&function(V){(0,S.d)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!V.activeCamera)return new L.Quaternion(NaN,NaN,NaN,NaN);const h=L.Quaternion.FromRotationMatrix(V.activeCamera.getWorldMatrix()).normalize();return V.useRightHandedSystem||(h.w*=-1,h.x*=-1),h},type:"Quaternion",getTarget:()=>V.activeCamera}),(0,S.d)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!V.activeCamera)return new L.sh(NaN,NaN,NaN);const h=V.activeCamera.getWorldMatrix().getTranslation();return V.useRightHandedSystem||(h.x*=-1),h},type:"sh",getTarget:()=>V.activeCamera}),(0,S.d)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:V=>{var h;return(null===(h=V._babylonAnimationGroup)||void 0===h?void 0:h.isPlaying)??!1},type:"boolean",getTarget:V=>V._babylonAnimationGroup}),(0,S.d)("/animations/{}/extensions/KHR_interactivity/minTime",{get:V=>{var h;return((null===(h=V._babylonAnimationGroup)||void 0===h?void 0:h.from)??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,S.d)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:V=>{var h;return((null===(h=V._babylonAnimationGroup)||void 0===h?void 0:h.to)??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,S.d)("/animations/{}/extensions/KHR_interactivity/playhead",{get:V=>{var h;return((null===(h=V._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup}),(0,S.d)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:V=>{var h;return((null===(h=V._babylonAnimationGroup)||void 0===h?void 0:h.getCurrentFrame())??0)/60},type:"number",getTarget:V=>V._babylonAnimationGroup})}(h)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var V;if(!this._loader.babylonScene||!this._pathConverter)return;const h=this._loader.babylonScene,mV=null===(V=this._loader.qk.extensions)||void 0===V?void 0:V.KHR_interactivity;if(!mV)return;const t=new Rm.e({zh:h});t.dispatchEventsSynchronously=!1;const L=mV.graphs.map((V=>new pm(V,this._loader.qk,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(L.map((async V=>await vm(V,{coordinator:t,pathConverter:this._pathConverter})))),t.start()}}var Sm;Sm=async()=>(await Promise.resolve().then(mV.bind(mV,14152))).FlowGraphGLTFDataProvider,dm[`${Zm}/${"FlowGraphGLTFDataProvider"}`]=Sm,f(Zm),Z(Zm,!0,(V=>new fm(V)));const Ym="KHR_node_visibility";(0,S.d)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:V=>{const h=V._babylonTransformNode;return!h||void 0===h.isVisible||h.isVisible},set:(V,h)=>{var mV,t;null===(mV=h._primitiveBabylonMeshes)||void 0===mV||mV.forEach((V=>{V.inheritVisibility=!0})),h._babylonTransformNode&&(h._babylonTransformNode.isVisible=V),null===(t=h._primitiveBabylonMeshes)||void 0===t||t.forEach((h=>{h.isVisible=V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class wm{constructor(V){this.name=Ym,this._loader=V,this.enabled=V.isExtensionUsed(Ym)}async onReady(){var V;null===(V=this._loader.qk.nodes)||void 0===V||V.forEach((V=>{var h,mV,t,L;(null===(h=V._primitiveBabylonMeshes)||void 0===h||h.forEach((V=>{V.inheritVisibility=!0})),null!==(mV=V.extensions)&&void 0!==mV&&mV.KHR_node_visibility)&&(!1===(null===(t=V.extensions)||void 0===t?void 0:t.KHR_node_visibility.visible)&&(V._babylonTransformNode&&(V._babylonTransformNode.isVisible=!1),null===(L=V._primitiveBabylonMeshes)||void 0===L||L.forEach((V=>{V.isVisible=!1}))))}))}dispose(){this._loader=null}}f(Ym),Z(Ym,!0,(V=>new wm(V)));const Em="KHR_node_selectability";Gm("event/onSelect",Em,{zo:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rm:"FlowGraphGetVariableBlock",dataTransformer:V=>["pickedMesh_"+V[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",rm:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,h,mV,t,L,N,A){var k,C,K,o,n,q;const x=L[L.length-1];x.config=x.config||{},x.config.glTF=A;const R=null===(k=V.configuration)||void 0===k||null===(C=k.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const d="pickedMesh_"+R;return L[1].config.variable=d,N._userVariables[d]={className:"Mesh",id:null===A||void 0===A||null===(K=A.nodes)||void 0===K||null===(o=K[R]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===A||void 0===A||null===(n=A.nodes)||void 0===n||null===(q=n[R]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},L}}),(0,S.d)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:V=>{const h=V._babylonTransformNode;return!h||void 0===h.gC||h.gC},set:(V,h)=>{var mV;null===(mV=h._primitiveBabylonMeshes)||void 0===mV||mV.forEach((h=>{h.gC=V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"gC"],type:"boolean"});class gm{constructor(V){this.name=Em,this._loader=V,this.enabled=V.isExtensionUsed(Em)}async onReady(){var V;null===(V=this._loader.qk.nodes)||void 0===V||V.forEach((V=>{var h,mV,t;null!==(h=V.extensions)&&void 0!==h&&h.KHR_node_selectability&&!1===(null===(mV=V.extensions)||void 0===mV?void 0:mV.KHR_node_selectability.selectable)&&(null===(t=V._babylonTransformNode)||void 0===t||t.getChildMeshes().forEach((V=>{V.gC=!1})))}))}dispose(){this._loader=null}}f(Em),Z(Em,!0,(V=>new gm(V)));const im="KHR_node_hoverability",bm="targetMeshPointerOver_";Gm("event/onHoverIn",im,{zo:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rm:"FlowGraphGetVariableBlock",dataTransformer:V=>[bm+V[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rm:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,h,mV,t,L,N,A){var k,C,K,o,n,q;const x=L[L.length-1];x.config=x.config||{},x.config.glTF=A;const R=null===(k=V.configuration)||void 0===k||null===(C=k.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const d=bm+R;return L[1].config.variable=d,N._userVariables[d]={className:"Mesh",id:null===A||void 0===A||null===(K=A.nodes)||void 0===K||null===(o=K[R]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===A||void 0===A||null===(n=A.nodes)||void 0===n||null===(q=n[R]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},L}});const Pm="targetMeshPointerOut_";Gm("event/onHoverOut",im,{zo:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",rm:"FlowGraphGetVariableBlock",dataTransformer:V=>[Pm+V[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",rm:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(V,h,mV,t,L,N,A){var k,C,K,o,n,q;const x=L[L.length-1];x.config=x.config||{},x.config.glTF=A;const R=null===(k=V.configuration)||void 0===k||null===(C=k.nodeIndex)||void 0===C?void 0:C.value[0];if(void 0===R||"number"!==typeof R)throw new Error("nodeIndex not found in configuration");const d=Pm+R;return L[1].config.variable=d,N._userVariables[d]={className:"Mesh",id:null===A||void 0===A||null===(K=A.nodes)||void 0===K||null===(o=K[R]._babylonTransformNode)||void 0===o?void 0:o.id,uniqueId:null===A||void 0===A||null===(n=A.nodes)||void 0===n||null===(q=n[R]._babylonTransformNode)||void 0===q?void 0:q.uniqueId},L}}),(0,S.d)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:V=>{const h=V._babylonTransformNode;return!h||void 0===h.pointerOverDisableMeshTesting||h.pointerOverDisableMeshTesting},set:(V,h)=>{var mV;null===(mV=h._primitiveBabylonMeshes)||void 0===mV||mV.forEach((h=>{h.pointerOverDisableMeshTesting=!V}))},getTarget:V=>V._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Um{constructor(V){this.name=im,this._loader=V,this.enabled=V.isExtensionUsed(im)}async onReady(){var V;null===(V=this._loader.qk.nodes)||void 0===V||V.forEach((V=>{var h,mV,t;null!==(h=V.extensions)&&void 0!==h&&h.KHR_node_hoverability&&!1===(null===(mV=V.extensions)||void 0===mV?void 0:mV.KHR_node_hoverability.hoverable)&&(null===(t=V._babylonTransformNode)||void 0===t||t.getChildMeshes().forEach((V=>{V.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}f(im),Z(im,!0,(V=>new Um(V)));const um="ExtrasAsMetadata";class em{_assignExtras(V,h){if(h.extras&&Object.keys(h.extras).length>0){const mV=V.metadata=V.metadata||{};(mV.qk=mV.qk||{}).extras=h.extras}}constructor(V){this.name=um,this.enabled=!0,this._loader=V}dispose(){this._loader=null}loadNodeAsync(V,h,mV){return this._loader.loadNodeAsync(V,h,(V=>{this._assignExtras(V,h),mV(V)}))}loadCameraAsync(V,h,mV){return this._loader.loadCameraAsync(V,h,(V=>{this._assignExtras(V,h),mV(V)}))}createMaterial(V,h,mV){const t=this._loader.createMaterial(V,h,mV);return this._assignExtras(t,h),t}}f(um),Z(um,!1,(V=>new em(V)));mV(14152)},14047:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>r,h:()=>j,l:()=>H,n:()=>l});var t=mV(12258),L=mV(12253),N=mV(13686),A=mV(12836),k=mV(12806),C=mV(12811),K=mV(12264),o=mV(12300),n=mV(12829),q=mV(12937),x=mV(12838),R=mV(12450);class d{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Lq=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Sq=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(V){this._environmentTexture=V}getNodes(){let V=[];V=V.concat(this.meshes),V=V.concat(this.lights),V=V.concat(this.cameras),V=V.concat(this.transformNodes);for(const h of this.skeletons)V=V.concat(h.bones);return V}}class s extends d{}class M{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const V=this.rootNodes;for(const t of V)t.dispose();V.length=0;const h=this.skeletons;for(const t of h)t.dispose();h.length=0;const mV=this.animationGroups;for(const t of mV)t.dispose();mV.length=0}}class c extends d{constructor(V){super(),this._wasAddedToScene=!1,(V=V||o.b.LastCreatedScene)&&(this.zh=V,this.proceduralTextures=[],V.XL.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=V.getEngine().onContextRestoredObservable.add((()=>{for(const V of this.geometries)V._rebuild();for(const V of this.meshes)V._rebuild();for(const V of this.Lq)V.rebuild();for(const V of this.textures)V._rebuild()})))}_topologicalSort(V){const h=new Map;for(const A of V)h.set(A.uniqueId,A);const mV={dependsOn:new Map,dependedBy:new Map};for(const A of V){const V=A.uniqueId;mV.dependsOn.set(V,new Set),mV.dependedBy.set(V,new Set)}for(const A of V){const V=A.uniqueId,t=mV.dependsOn.get(V);if(A instanceof n.e){const L=A.sourceMesh;h.has(L.uniqueId)&&(t.add(L.uniqueId),mV.dependedBy.get(L.uniqueId).add(V))}const L=mV.dependedBy.get(V);for(const N of A.getDescendants()){const t=N.uniqueId;if(h.has(t)){L.add(t);mV.dependsOn.get(t).add(V)}}}const t=[],L=[];for(const A of V){const V=A.uniqueId;0===mV.dependsOn.get(V).size&&(L.push(A),h.delete(V))}const N=L;for(;N.length>0;){const V=N.shift();t.push(V);const L=mV.dependedBy.get(V.uniqueId);for(const t of Array.from(L.values())){const L=mV.dependsOn.get(t);L.delete(V.uniqueId),0===L.size&&h.get(t)&&(N.push(h.get(t)),h.delete(t))}}return h.size>0&&(K.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),h.forEach((V=>{K.e.Error(V.name)}))),t}_addNodeAndDescendantsToList(V,h,mV,t){if(mV&&(!t||t(mV))&&!h.has(mV.uniqueId)){V.push(mV),h.add(mV.uniqueId);for(const L of mV.getDescendants(!0))this._addNodeAndDescendantsToList(V,h,L,t)}}_isNodeInContainer(V){return V instanceof C.e&&-1!==this.meshes.indexOf(V)||(V instanceof k.c&&-1!==this.transformNodes.indexOf(V)||(V instanceof q.d&&-1!==this.lights.indexOf(V)||V instanceof x.b&&-1!==this.cameras.indexOf(V)))}_isValidHierarchy(){for(const V of this.meshes)if(V.parent&&!this._isNodeInContainer(V.parent))return K.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.transformNodes)if(V.parent&&!this._isNodeInContainer(V.parent))return K.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.lights)if(V.parent&&!this._isNodeInContainer(V.parent))return K.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;for(const V of this.cameras)if(V.parent&&!this._isNodeInContainer(V.parent))return K.e.Warn(`Node ${V.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const t={},N={},k=new M,C=[],K=[],o={doNotInstantiate:!0,...mV},n=[],q=new Set;for(const L of this.transformNodes)null===L.parent&&this._addNodeAndDescendantsToList(n,q,L,o.predicate);for(const L of this.meshes)null===L.parent&&this._addNodeAndDescendantsToList(n,q,L,o.predicate);const x=this._topologicalSort(n),R=(mV,L)=>{if(((h,mV)=>{if(t[h.uniqueId]=mV.uniqueId,N[mV.uniqueId]=mV,V&&(mV.name=V(h.name)),mV instanceof A.c){const V=mV;if(V.morphTargetManager){const mV=h.morphTargetManager;V.morphTargetManager=mV.clone();for(let h=0;h<mV.numTargets;h++){const L=mV.getTarget(h),A=V.morphTargetManager.getTarget(h);t[L.uniqueId]=A.uniqueId,N[A.uniqueId]=A}}}})(mV,L),mV.parent){const V=t[mV.parent.uniqueId],h=N[V];L.parent=h||mV.parent}if(L.position&&mV.position&&L.position.t(mV.position),L.rotationQuaternion&&mV.rotationQuaternion&&L.rotationQuaternion.t(mV.rotationQuaternion),L.rotation&&mV.rotation&&L.rotation.t(mV.rotation),L.jk&&mV.jk&&L.jk.t(mV.jk),L.material){const A=L;if(A.material)if(h){const h=mV.material;if(-1===K.indexOf(h)){let mV=h.clone(V?V(h.name):"Clone of "+h.name);if(K.push(h),t[h.uniqueId]=mV.uniqueId,N[mV.uniqueId]=mV,"MultiMaterial"===h.getClassName()){const L=h;for(const h of L.yk)h&&(mV=h.clone(V?V(h.name):"Clone of "+h.name),K.push(h),t[h.uniqueId]=mV.uniqueId,N[mV.uniqueId]=mV);L.yk=L.yk.map((V=>V&&N[t[V.uniqueId]]))}}"InstancedMesh"!==A.getClassName()&&(A.material=N[t[h.uniqueId]])}else"MultiMaterial"===A.material.getClassName()?-1===this.zh.multiMaterials.indexOf(A.material)&&this.zh.addMultiMaterial(A.material):-1===this.zh.materials.indexOf(A.material)&&this.zh.addMaterial(A.material)}null===L.parent&&k.rootNodes.push(L)};for(const L of x)if("InstancedMesh"===L.getClassName()){const V=L,h=V.sourceMesh,mV=t[h.uniqueId];R(V,("number"===typeof mV?N[mV]:h).createInstance(V.name))}else{let V=!0;"td"===L.getClassName()||"Node"===L.getClassName()||L.skeleton||!L.getTotalVertices||0===L.getTotalVertices()?V=!1:o.doNotInstantiate&&(V="function"===typeof o.doNotInstantiate?!o.doNotInstantiate(L):!o.doNotInstantiate);const h=V?L.createInstance(`instance of ${L.name}`):L.clone(`Clone of ${L.name}`,null,!0);if(!h)throw new Error(`Could not clone or instantiate node on Asset Container ${L.name}`);R(L,h)}for(const L of this.skeletons){if(o.predicate&&!o.predicate(L))continue;const h=L.clone(V?V(L.name):"Clone of "+L.name);for(const V of this.meshes)if(V.skeleton===L&&!V.isAnInstance){const mV=N[t[V.uniqueId]];if(!mV||mV.isAnInstance)continue;if(mV.skeleton=h,-1!==C.indexOf(h))continue;C.push(h);for(const V of h.bones)V._linkedTransformNode&&(V._linkedTransformNode=N[t[V._linkedTransformNode.uniqueId]])}k.skeletons.push(h)}for(const L of this.animationGroups){if(o.predicate&&!o.predicate(L))continue;const h=L.clone(V?V(L.name):"Clone of "+L.name,(V=>N[t[V.uniqueId]]||V));k.animationGroups.push(h)}return k}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.zh.environmentTexture=this.environmentTexture);for(const V of this.zh._serializableComponents)V.addFromContainer(this);this.zh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const h=[];for(const mV of this.cameras)V&&!V(mV)||(this.zh.addCamera(mV),h.push(mV));for(const mV of this.lights)V&&!V(mV)||(this.zh.addLight(mV),h.push(mV));for(const mV of this.meshes)V&&!V(mV)||(this.zh.ko(mV),h.push(mV));for(const mV of this.skeletons)V&&!V(mV)||this.zh.addSkeleton(mV);for(const mV of this.animations)V&&!V(mV)||this.zh.addAnimation(mV);for(const mV of this.animationGroups)V&&!V(mV)||this.zh.addAnimationGroup(mV);for(const mV of this.multiMaterials)V&&!V(mV)||this.zh.addMultiMaterial(mV);for(const mV of this.materials)V&&!V(mV)||this.zh.addMaterial(mV);for(const mV of this.morphTargetManagers)V&&!V(mV)||this.zh.addMorphTargetManager(mV);for(const mV of this.geometries)V&&!V(mV)||this.zh.addGeometry(mV);for(const mV of this.transformNodes)V&&!V(mV)||(this.zh.addTransformNode(mV),h.push(mV));for(const mV of this.actionManagers)V&&!V(mV)||this.zh.addActionManager(mV);for(const mV of this.textures)V&&!V(mV)||this.zh.addTexture(mV);for(const mV of this.reflectionProbes)V&&!V(mV)||this.zh.addReflectionProbe(mV);for(const mV of h)mV.parent&&-1===this.zh.getNodes().indexOf(mV.parent)&&(mV.setParent?mV.setParent(null):mV.parent=null)}removeAllFromScene(){this._isValidHierarchy()||L.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.zh.environmentTexture&&(this.zh.environmentTexture=null);for(const V of this.zh._serializableComponents)V.removeFromContainer(this)}removeFromScene(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const h of this.cameras)V&&!V(h)||this.zh.removeCamera(h);for(const h of this.lights)V&&!V(h)||this.zh.removeLight(h);for(const h of this.meshes)V&&!V(h)||this.zh.Ao(h,!0);for(const h of this.skeletons)V&&!V(h)||this.zh.removeSkeleton(h);for(const h of this.animations)V&&!V(h)||this.zh.removeAnimation(h);for(const h of this.animationGroups)V&&!V(h)||this.zh.removeAnimationGroup(h);for(const h of this.multiMaterials)V&&!V(h)||this.zh.removeMultiMaterial(h);for(const h of this.materials)V&&!V(h)||this.zh.removeMaterial(h);for(const h of this.morphTargetManagers)V&&!V(h)||this.zh.removeMorphTargetManager(h);for(const h of this.geometries)V&&!V(h)||this.zh.removeGeometry(h);for(const h of this.transformNodes)V&&!V(h)||this.zh.removeTransformNode(h);for(const h of this.actionManagers)V&&!V(h)||this.zh.removeActionManager(h);for(const h of this.textures)V&&!V(h)||this.zh.removeTexture(h);for(const h of this.reflectionProbes)V&&!V(h)||this.zh.removeReflectionProbe(h)}dispose(){const V=this.cameras.slice(0);for(const x of V)x.dispose();this.cameras.length=0;const h=this.lights.slice(0);for(const x of h)x.dispose();this.lights.length=0;const mV=this.meshes.slice(0);for(const x of mV)x.dispose();this.meshes.length=0;const t=this.skeletons.slice(0);for(const x of t)x.dispose();this.skeletons.length=0;const L=this.animationGroups.slice(0);for(const x of L)x.dispose();this.animationGroups.length=0;const N=this.multiMaterials.slice(0);for(const x of N)x.dispose();this.multiMaterials.length=0;const A=this.materials.slice(0);for(const x of A)x.dispose();this.materials.length=0;const k=this.geometries.slice(0);for(const x of k)x.dispose();this.geometries.length=0;const C=this.transformNodes.slice(0);for(const x of C)x.dispose();this.transformNodes.length=0;const K=this.actionManagers.slice(0);for(const x of K)x.dispose();this.actionManagers.length=0;const o=this.textures.slice(0);for(const x of o)x.dispose();this.textures.length=0;const n=this.reflectionProbes.slice(0);for(const x of n)x.dispose();this.reflectionProbes.length=0;const q=this.morphTargetManagers.slice(0);for(const x of q)x.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const x of this.zh._serializableComponents)x.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.zh.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(V,h,mV){if(V&&h)for(const t of V){let V=!0;if(mV)for(const h of mV)if(t===h){V=!1;break}V&&(h.push(t),t._parentContainer=this)}}moveAllFromScene(V){this._wasAddedToScene=!1,void 0===V&&(V=new s);for(const h in this)Object.prototype.hasOwnProperty.call(this,h)&&(this[h]=this[h]||("_environmentTexture"===h?null:[]),this._moveAssets(this.zh[h],this[h],V[h]));this.environmentTexture=this.zh.environmentTexture,this.removeAllFromScene()}createRootMesh(){const V=new A.c("assetContainerRootMesh",this.zh);for(const h of this.meshes)h.parent||V.addChild(h);return this.meshes.unshift(V),V}mergeAnimationsTo(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.b.LastCreatedScene,h=arguments.length>1?arguments[1]:void 0,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!V)return K.e.Error("No scene available to merge animations to"),[];const t=mV||(h=>{let mV=null;const t=h.animations.length?h.animations[0].targetProperty:"",L=h.name.split(".").join("").split("_primitive")[0];switch(t){case"position":case"rotationQuaternion":mV=V.getTransformNodeByName(h.name)||V.getTransformNodeByName(L);break;case"influence":mV=V.getMorphTargetByName(h.name)||V.getMorphTargetByName(L);break;default:mV=V.getNodeByName(h.name)||V.getNodeByName(L)}return mV}),L=this.getNodes();for(const k of L){const V=t(k);if(null!==V){for(const h of k.animations){const mV=V.animations.filter((V=>V.targetProperty===h.targetProperty));for(const h of mV){const mV=V.animations.indexOf(h,0);mV>-1&&V.animations.splice(mV,1)}}V.animations=V.animations.concat(k.animations)}}const N=[],A=this.animationGroups.slice();for(const k of A){N.push(k.clone(k.name,t));for(const V of k.animatables)V.stop()}for(const k of h){const h=t(k.target);h&&(V.beginAnimation(h,k.fromFrame,k.toFrame,k.loopAnimation,k.speedRatio,k.onAnimationEnd?k.onAnimationEnd:void 0,void 0,!0,void 0,k.onAnimationLoop?k.onAnimationLoop:void 0),V.stopAnimation(k.target))}return N}populateRootNodes(){this.rootNodes.length=0;for(const V of this.meshes)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.transformNodes)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.lights)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V);for(const V of this.cameras)V.parent||-1!==this.rootNodes.indexOf(V)||this.rootNodes.push(V)}addAllAssetsToContainer(V){if(!V)return;const h=[],mV=new Set;for(h.push(V);h.length>0;){const V=h.pop();if(V instanceof A.c?(V.Jk&&-1===this.geometries.indexOf(V.Jk)&&this.geometries.push(V.Jk),this.meshes.push(V)):V instanceof n.e?this.meshes.push(V):V instanceof k.c?this.transformNodes.push(V):V instanceof q.d?this.lights.push(V):V instanceof x.b&&this.cameras.push(V),V instanceof C.e){if(V.material&&-1===this.materials.indexOf(V.material)){this.materials.push(V.material);for(const h of V.material.getActiveTextures())-1===this.textures.indexOf(h)&&this.textures.push(h)}V.skeleton&&-1===this.skeletons.indexOf(V.skeleton)&&this.skeletons.push(V.skeleton),V.morphTargetManager&&-1===this.morphTargetManagers.indexOf(V.morphTargetManager)&&this.morphTargetManagers.push(V.morphTargetManager)}for(const t of V.getChildren())mV.has(t)||h.push(t);mV.add(V)}this.populateRootNodes()}_getByTags(V,h,mV){if(void 0===h)return V;const t=[];for(const L in V){const N=V[L];R.e&&R.e.MatchesQuery(N,h)&&(!mV||mV(N))&&t.push(N)}return t}getMeshesByTags(V,h){return this._getByTags(this.meshes,V,h)}getCamerasByTags(V,h){return this._getByTags(this.cameras,V,h)}getLightsByTags(V,h){return this._getByTags(this.lights,V,h)}getMaterialsByTags(V,h){return this._getByTags(this.materials,V,h).concat(this._getByTags(this.multiMaterials,V,h))}getTransformNodesByTags(V,h){return this._getByTags(this.transformNodes,V,h)}}var z=mV(12309);class Q{constructor(V){this.byteOffset=0,this.buffer=V}async loadAsync(V){const h=await this.buffer.readAsync(this.byteOffset,V);this._dataView=new DataView(h.buffer,h.byteOffset,h.byteLength),this._dataByteOffset=0}readUint32(){const V=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,V}readUint8Array(V){const h=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,V);return this._dataByteOffset+=V,this.byteOffset+=V,h}readString(V){return(0,z.f)(this.readUint8Array(V))}skipBytes(V){this._dataByteOffset+=V,this.byteOffset+=V}}var J=mV(14050);const v="Z2xURg",D={name:"qk",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:V=>-1!==V.indexOf("asset")&&-1!==V.indexOf("version")||V.startsWith("data:base64,"+v)||V.startsWith("data:;base64,"+v)||V.startsWith("data:application/octet-stream;base64,"+v)||V.startsWith("data:model/gltf-binary;base64,"+v)};var H,j,l,G=mV(12303),y=mV(12305);function O(V,h,mV){try{return Promise.resolve(new Uint8Array(V,h,mV))}catch(t){return Promise.reject(t)}}!function(V){V[V.AUTO=0]="AUTO",V[V.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(H||(H={})),function(V){V[V.NONE=0]="NONE",V[V.FIRST=1]="FIRST",V[V.ALL=2]="ALL"}(j||(j={})),function(V){V[V.LOADING=0]="LOADING",V[V.READY=1]="READY",V[V.COMPLETE=2]="COMPLETE"}(l||(l={}));class I{constructor(){this.coordinateSystemMode=H.AUTO,this.animationStartMode=j.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=V=>Promise.resolve(V),this.extensionOptions={}}t(V){V&&(this.onParsed=V.onParsed,this.coordinateSystemMode=V.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=V.animationStartMode??this.animationStartMode,this.loadNodeAnimations=V.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=V.loadSkins??this.loadSkins,this.loadMorphTargets=V.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=V.compileMaterials??this.compileMaterials,this.useClipPlane=V.useClipPlane??this.useClipPlane,this.compileShadowGenerators=V.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=V.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=V.useRangeRequests??this.useRangeRequests,this.createInstances=V.createInstances??this.createInstances,this.alwaysComputeBoundingBox=V.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=V.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=V.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=V.skipMaterials??this.skipMaterials,this.useSRGBBuffers=V.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=V.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=V.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=V.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=V.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=V.customRootNode,this.onMeshLoaded=V.onMeshLoaded,this.onSkinLoaded=V.onSkinLoaded,this.onTextureLoaded=V.onTextureLoaded,this.onMaterialLoaded=V.onMaterialLoaded,this.onCameraLoaded=V.onCameraLoaded,this.extensionOptions=V.extensionOptions??this.extensionOptions)}}class r extends I{constructor(V){super(),this.onParsedObservable=new t.d,this.onMeshLoadedObservable=new t.d,this.onSkinLoadedObservable=new t.d,this.onTextureLoadedObservable=new t.d,this.onMaterialLoadedObservable=new t.d,this.onCameraLoadedObservable=new t.d,this.onCompleteObservable=new t.d,this.onErrorObservable=new t.d,this.XL=new t.d,this.onExtensionLoadedObservable=new t.d,this.validate=!1,this.onValidatedObservable=new t.d,this._loader=null,this._state=null,this._requests=new Array,this.name=D.name,this.extensions=D.extensions,this.onLoaderStateChangedObservable=new t.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.t(V)}set onParsed(V){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),V&&(this._onParsedObserver=this.onParsedObservable.add(V))}set onMeshLoaded(V){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),V&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(V))}set onSkinLoaded(V){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),V&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((h=>V(h.node,h.skinnedNode))))}set onTextureLoaded(V){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),V&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(V))}set onMaterialLoaded(V){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),V&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(V))}set onCameraLoaded(V){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),V&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(V))}set onComplete(V){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(V)}set onError(V){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(V)}set onDispose(V){this._onDisposeObserver&&this.XL.remove(this._onDisposeObserver),this._onDisposeObserver=this.XL.add(V)}set onExtensionLoaded(V){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(V)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(V){this._loggingEnabled!==V&&(this._loggingEnabled=V,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(V){this._capturePerformanceCounters!==V&&(this._capturePerformanceCounters=V,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(V){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(V)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const V of this._requests)V.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=V=>Promise.resolve(V),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.XL.notifyObservers(void 0),this.XL.clear()}loadFile(V,h,mV,N,A,k,C,o){if(ArrayBuffer.isView(h))return this._loadBinary(V,h,mV,N,C,o),null;this._progressCallback=A;const n=h.name||L.Tools.GetFilename(h);if(k){if(this.useRangeRequests){this.validate&&K.e.Warn("glTF validation is not supported when range requests are enabled");const mV={abort:()=>{},onCompleteObservable:new t.d},L={readAsync:(mV,t)=>new Promise(((L,N)=>{this._loadFile(V,h,(V=>{L(new Uint8Array(V))}),!0,(V=>{N(V)}),(V=>{V.setRequestHeader("Range",`bytes=${mV}-${mV+t-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new Q(L)).then((V=>{mV.onCompleteObservable.notifyObservers(mV),N(V)}),C?V=>C(void 0,V):void 0),mV}return this._loadFile(V,h,(h=>{this._validate(V,new Uint8Array(h,0,h.byteLength),mV,n),this._unpackBinaryAsync(new Q({readAsync:(V,mV)=>O(h,V,mV),byteLength:h.byteLength})).then((V=>{N(V)}),C?V=>C(void 0,V):void 0)}),!0,C)}return this._loadFile(V,h,(h=>{try{this._validate(V,h,mV,n),N({json:this._parseJson(h)})}catch{C&&C()}}),!1,C)}_loadBinary(V,h,mV,t,L,N){this._validate(V,new Uint8Array(h.buffer,h.byteOffset,h.byteLength),mV,N),this._unpackBinaryAsync(new Q({readAsync:(V,mV)=>function(V,h,mV){try{if(h<0||h>=V.byteLength)throw new RangeError("Offset is out of range.");if(h+mV>V.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(V.buffer,V.byteOffset+h,mV))}catch(t){return Promise.reject(t)}}(h,V,mV),byteLength:h.byteLength})).then((V=>{t(V)}),L?V=>L(void 0,V):void 0)}importMeshAsync(V,h,mV,t,L,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(mV),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(mV),this._loader.importMeshAsync(V,h,null,mV,t,L,N))))}loadAsync(V,h,mV,t,L){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(h),this._loader.loadAsync(V,h,mV,t,L))))}loadAssetContainerAsync(V,h,mV,t,L){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(h),this.onParsedObservable.clear(),this._log(`Loading ${L||""}`),this._loader=this._getLoader(h);const N=new c(V),A=[];this.onMaterialLoadedObservable.add((V=>{A.push(V)}));const k=[];this.onTextureLoadedObservable.add((V=>{k.push(V)}));const C=[];this.onCameraLoadedObservable.add((V=>{C.push(V)}));const K=[];return this.onMeshLoadedObservable.add((V=>{V.morphTargetManager&&K.push(V.morphTargetManager)})),this._loader.importMeshAsync(null,V,N,h,mV,t,L).then((V=>(Array.prototype.push.apply(N.geometries,V.geometries),Array.prototype.push.apply(N.meshes,V.meshes),Array.prototype.push.apply(N.Lq,V.Lq),Array.prototype.push.apply(N.skeletons,V.skeletons),Array.prototype.push.apply(N.animationGroups,V.animationGroups),Array.prototype.push.apply(N.materials,A),Array.prototype.push.apply(N.textures,k),Array.prototype.push.apply(N.lights,V.lights),Array.prototype.push.apply(N.transformNodes,V.transformNodes),Array.prototype.push.apply(N.cameras,C),Array.prototype.push.apply(N.morphTargetManagers,K),N)))}))}canDirectLoad(V){return D.canDirectLoad(V)}directLoad(V,h){if(h.startsWith("base64,"+v)||h.startsWith(";base64,"+v)||h.startsWith("application/octet-stream;base64,"+v)||h.startsWith("model/gltf-binary;base64,"+v)){const mV=(0,G.e)(h);return this._validate(V,new Uint8Array(mV,0,mV.byteLength)),this._unpackBinaryAsync(new Q({readAsync:(V,h)=>O(mV,V,h),byteLength:mV.byteLength}))}return this._validate(V,h),Promise.resolve({json:this._parseJson(h)})}createPlugin(V){return new r(V[D.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((V,h)=>{this.onCompleteObservable.addOnce((()=>{V()})),this.onErrorObservable.addOnce((V=>{h(V)}))}))}_setState(V){this._state!==V&&(this._state=V,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(l[this._state]))}_loadFile(V,h,mV,t,L,N){const A=V._loadFile(h,mV,(V=>{this._onProgress(V,A)}),!0,t,L,N);return A.onCompleteObservable.add((()=>{A._lengthComputable=!0,A._total=A._loaded})),this._requests.push(A),A}_onProgress(V,h){if(!this._progressCallback)return;h._lengthComputable=V.lengthComputable,h._loaded=V.loaded,h._total=V.total;let mV=!0,t=0,L=0;for(const N of this._requests){if(void 0===N._lengthComputable||void 0===N._loaded||void 0===N._total)return;mV=mV&&N._lengthComputable,t+=N._loaded,L+=N._total}this._progressCallback({lengthComputable:mV,loaded:t,total:mV?L:0})}_validate(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),J.d.ValidateAsync(h,mV,t,(h=>this.preprocessUrlAsync(mV+h).then((h=>V._loadFileAsync(h,void 0,!0,!0).then((V=>new Uint8Array(V,0,V.byteLength))))))).then((V=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(V),this.onValidatedObservable.clear()}),(V=>{this._endPerformanceCounter("Validate JSON"),L.Tools.Warn(`Failed to validate: ${V.message}`),this.onValidatedObservable.clear()})))}_getLoader(V){const h=V.json.asset||{};this._log(`Asset version: ${h.version}`),h.minVersion&&this._log(`Asset minimum version: ${h.minVersion}`),h.generator&&this._log(`Asset generator: ${h.generator}`);const mV=r._parseVersion(h.version);if(!mV)throw new Error("Invalid version: "+h.version);if(void 0!==h.minVersion){const V=r._parseVersion(h.minVersion);if(!V)throw new Error("Invalid minimum version: "+h.minVersion);if(r._compareVersion(V,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+h.minVersion)}const t={1:r._CreateGLTF1Loader,2:r._CreateGLTF2Loader}[mV.major];if(!t)throw new Error("Unsupported version: "+h.version);return t(this)}_parseJson(V){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${V.length}`);const h=JSON.parse(V);return this._endPerformanceCounter("Parse JSON"),h}_unpackBinaryAsync(V){return this._startPerformanceCounter("Unpack Binary"),V.loadAsync(20).then((()=>{const h=V.readUint32();if(1179937895!==h)throw new y.d("Unexpected magic: "+h,y.c.GLTFLoaderUnexpectedMagicError);const mV=V.readUint32();this.loggingEnabled&&this._log(`Binary version: ${mV}`);const t=V.readUint32();let L;switch(this.useRangeRequests||t===V.buffer.byteLength||K.e.Warn(`Length in header does not match actual data length: ${t} != ${V.buffer.byteLength}`),mV){case 1:L=this._unpackBinaryV1Async(V,t);break;case 2:L=this._unpackBinaryV2Async(V,t);break;default:throw new Error("Unsupported version: "+mV)}return this._endPerformanceCounter("Unpack Binary"),L}))}_unpackBinaryV1Async(V,h){const mV=V.readUint32(),t=V.readUint32();if(0!==t)throw new Error(`Unexpected content format: ${t}`);const L=h-V.byteOffset,N={json:this._parseJson(V.readString(mV)),bin:null};if(0!==L){const h=V.byteOffset;N.bin={readAsync:(mV,t)=>V.buffer.readAsync(h+mV,t),byteLength:L}}return Promise.resolve(N)}_unpackBinaryV2Async(V,h){const mV=1313821514,t=5130562,L=V.readUint32();if(V.readUint32()!==mV)throw new Error("First chunk format is not JSON");return V.byteOffset+L===h?V.loadAsync(L).then((()=>({json:this._parseJson(V.readString(L)),bin:null}))):V.loadAsync(L+8).then((()=>{const N={json:this._parseJson(V.readString(L)),bin:null},A=()=>{const L=V.readUint32();switch(V.readUint32()){case mV:throw new Error("Unexpected JSON chunk");case t:{const h=V.byteOffset;N.bin={readAsync:(mV,t)=>V.buffer.readAsync(h+mV,t),byteLength:L},V.skipBytes(L);break}default:V.skipBytes(L)}return V.byteOffset!==h?V.loadAsync(8).then(A):Promise.resolve(N)};return A()}))}static _parseVersion(V){if("1.0"===V||"1.0.1"===V)return{major:1,minor:0};const h=(V+"").match(/^(\d+)\.(\d+)/);return h?{major:parseInt(h[1]),minor:parseInt(h[2])}:null}static _compareVersion(V,h){return V.major>h.major?1:V.major<h.major?-1:V.minor>h.minor?1:V.minor<h.minor?-1:0}_logOpen(V){this._log(V),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(V){const h=r._logSpaces.substring(0,2*this._logIndentLevel);K.e.Log(`${h}${V}`)}_logDisabled(V){}_startPerformanceCounterEnabled(V){L.Tools.StartPerformanceCounter(V)}_startPerformanceCounterDisabled(V){}_endPerformanceCounterEnabled(V){L.Tools.EndPerformanceCounter(V)}_endPerformanceCounterDisabled(V){}}r.IncrementalLoading=!0,r.HomogeneousCoordinates=!1,r._logSpaces="                                ",(0,N.b)(new r)},14050:(V,h,mV)=>{"use strict";mV.d(h,{d:()=>A});var t=mV(12253);function L(V,h,mV,t){const L={externalResourceFunction:t};return mV&&(L.uri="file:"===h?mV:h+mV),ArrayBuffer.isView(V)?GLTFValidator.validateBytes(V,L):GLTFValidator.validateString(V,L)}function N(){const V=[];onmessage=h=>{const mV=h.data;switch(mV.id){case"init":importScripts(mV.url);break;case"validate":L(mV.data,mV.rootUrl,mV.fileName,(h=>new Promise(((mV,t)=>{const L=V.length;V.push({resolve:mV,reject:t}),postMessage({id:"getExternalResource",index:L,uri:h})})))).then((V=>{postMessage({id:"validate.resolve",value:V})}),(V=>{postMessage({id:"validate.reject",reason:V})}));break;case"getExternalResource.resolve":V[mV.index].resolve(mV.value);break;case"getExternalResource.reject":V[mV.index].reject(mV.reason)}}}class A{static ValidateAsync(V,h,mV,A){return"function"===typeof Worker?new Promise(((k,C)=>{const K=`${L}(${N})()`,o=URL.createObjectURL(new Blob([K],{type:"application/javascript"})),n=new Worker(o),q=V=>{n.removeEventListener("error",q),n.removeEventListener("message",x),C(V)},x=V=>{const h=V.data;switch(h.id){case"getExternalResource":A(h.uri).then((V=>{n.postMessage({id:"getExternalResource.resolve",index:h.index,value:V},[V.buffer])}),(V=>{n.postMessage({id:"getExternalResource.reject",index:h.index,reason:V})}));break;case"validate.resolve":n.removeEventListener("error",q),n.removeEventListener("message",x),k(h.value),n.terminate();break;case"validate.reject":n.removeEventListener("error",q),n.removeEventListener("message",x),C(h.reason),n.terminate()}};if(n.addEventListener("error",q),n.addEventListener("message",x),n.postMessage({id:"init",url:t.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(V)){const t=V.slice();n.postMessage({id:"validate",data:t,rootUrl:h,fileName:mV},[t.buffer])}else n.postMessage({id:"validate",data:V,rootUrl:h,fileName:mV})})):(this._LoadScriptPromise||(this._LoadScriptPromise=t.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>L(V,h,mV,A))))}}A.Configuration={url:`${t.Tools._DefaultCdnUrl}/gltf_validator.js`}},14562:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>D});var t=mV(12409),L=mV(12413),N=mV(12448),A=mV(12422),k=mV(12770),C=mV(12711),K=mV(12481),o=mV(12648),n=mV(12388),q=mV(12342);mV(13832),mV(13729),mV(13742),mV(13732),mV(13751),mV(13754),mV(13759);const x="imageProcessingCompatibility",R="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";q.b.IncludesShadersStore[x]||(q.b.IncludesShadersStore[x]=R);const d="skyPixelShader",s="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";q.b.ShadersStore[d]||(q.b.ShadersStore[d]=s);mV(13840),mV(13767),mV(13772),mV(13784),mV(13780);const M="skyVertexShader",c="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";q.b.ShadersStore[M]||(q.b.ShadersStore[M]=c);var z=mV(12704),Q=mV(12751),J=mV(12746);class v extends k.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class D extends C.d{constructor(V,h){super(V,h),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new A.sh(0,100,0),this.useSunPosition=!1,this.cameraOffset=A.sh.Zero(),this.up=A.sh.Up(),this.dithering=!1,this._cameraPosition=A.sh.Zero(),this._skyOrientation=new A.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(V,h){const mV=h._drawWrapper;if(this.isFrozen&&mV.effect&&mV._wasPreviouslyReady)return!0;h.materialDefines||(h.materialDefines=new v);const t=h.materialDefines,L=this.DV();if(this._isReadyForSubMesh(h))return!0;if((0,J.M)(V,L,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,t),(0,J.z)(V,t,!0,!1),t.IMAGEPROCESSINGPOSTPROCESS!==L.imageProcessingConfiguration.applyByPostProcess&&t.markAsMiscDirty(),t.DITHER!==this.dithering&&t.markAsMiscDirty(),t.isDirty){t.markAsProcessed(),L.resetCachedMaterial();const V=new z.b;t.FOG&&V.addFallback(1,"FOG"),t.IMAGEPROCESSINGPOSTPROCESS=L.imageProcessingConfiguration.applyByPostProcess,t.DITHER=this.dithering;const mV=[K.i.PositionKind];t.VERTEXCOLOR&&mV.push(K.i.ColorKind);const N="sky",A=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Q.e)(A);const k=t.toString();h.setEffect(L.getEngine().createEffect(N,mV,A,[],k,V,this.onCompiled,this.onError),t,this._materialContext)}return!(!h.effect||!h.effect.isReady())&&(t._renderId=L.getRenderId(),mV._wasPreviouslyReady=!0,!0)}bindForSubMesh(V,h,mV){const t=this.DV(),L=mV.materialDefines;if(!L)return;const N=mV.effect;if(!N)return;this._activeEffect=N,this.bindOnlyWorldMatrix(V),this._activeEffect.setMatrix("viewProjection",t.getTransformMatrix()),this._mustRebind(t,N,mV)&&((0,Q.h)(N,this,t),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,J.g)(L,N,t)),t.fogEnabled&&h.applyFog&&t.fogMode!==o.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",t.getViewMatrix()),(0,J.d)(t,h,this._activeEffect);const k=t.activeCamera;if(k){const V=k.getWorldMatrix();this._cameraPosition.x=V.m[12],this._cameraPosition.y=V.m[13],this._cameraPosition.z=V.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const V=Math.PI*(this.inclination-.5),h=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(h)*Math.cos(V),this.sunPosition.y=this.distance*Math.sin(-V),this.sunPosition.z=this.distance*Math.sin(h)*Math.cos(V),A.Quaternion.FromUnitVectorsToRef(A.sh.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(h,this._activeEffect,mV)}getAnimatables(){return[]}dispose(V){super.dispose(V)}clone(V){return N.e.Clone((()=>new D(V,this.DV())),this)}serialize(){const V=super.serialize();return V.customType="BABYLON.SkyMaterial",V}getClassName(){return"SkyMaterial"}static Parse(V,h,mV){return N.e.Parse((()=>new D(V.name,h)),V,h,mV)}}(0,t.e)([(0,L.J)()],D.prototype,"luminance",void 0),(0,t.e)([(0,L.J)()],D.prototype,"turbidity",void 0),(0,t.e)([(0,L.J)()],D.prototype,"rayleigh",void 0),(0,t.e)([(0,L.J)()],D.prototype,"mieCoefficient",void 0),(0,t.e)([(0,L.J)()],D.prototype,"mieDirectionalG",void 0),(0,t.e)([(0,L.J)()],D.prototype,"distance",void 0),(0,t.e)([(0,L.J)()],D.prototype,"inclination",void 0),(0,t.e)([(0,L.J)()],D.prototype,"azimuth",void 0),(0,t.e)([(0,L.I)()],D.prototype,"sunPosition",void 0),(0,t.e)([(0,L.J)()],D.prototype,"useSunPosition",void 0),(0,t.e)([(0,L.I)()],D.prototype,"cameraOffset",void 0),(0,t.e)([(0,L.I)()],D.prototype,"up",void 0),(0,t.e)([(0,L.J)()],D.prototype,"dithering",void 0),(0,n.i)("BABYLON.SkyMaterial",D)},13094:(V,h,mV)=>{"use strict";function t(V,h){h.headers=V.headers||{},h.statusMessage=V.statusText,h.statusCode=V.status,h.data=V.response}function L(V,h,mV){return new Promise((function(L,N){mV=mV||{};var A,k,C,K=new XMLHttpRequest,o=mV.body,n=mV.headers||{};for(A in mV.timeout&&(K.timeout=mV.timeout),K.ontimeout=K.onerror=function(V){V.timeout="timeout"==V.type,N(V)},K.open(V,h.href||h),K.onload=function(){for(C=K.getAllResponseHeaders().trim().split(/[\r\n]+/),t(K,K);k=C.shift();)k=k.split(": "),K.headers[k.shift().toLowerCase()]=k.join(": ");if((k=K.headers["content-type"])&&~k.indexOf("application/json"))try{K.data=JSON.parse(K.data,mV.reviver)}catch(V){return t(K,V),N(V)}(K.status>=400?N:L)(K)},typeof FormData<"u"&&o instanceof FormData||o&&"object"==typeof o&&(n["content-type"]="application/json",o=JSON.stringify(o)),K.withCredentials=!!mV.withCredentials,n)K.setRequestHeader(A,n[A]);K.send(o)}))}mV.r(h),mV.d(h,{del:()=>C,get:()=>N,patch:()=>k,post:()=>A,put:()=>K,send:()=>L});var N=L.bind(L,"GET"),A=L.bind(L,"POST"),k=L.bind(L,"PATCH"),C=L.bind(L,"DELETE"),K=L.bind(L,"PUT")},14671:(V,h,mV)=>{"use strict";mV.d(h,{e:()=>n});const t=.5*(Math.sqrt(3)-1),L=(3-Math.sqrt(3))/6,N=1/3,A=1/6,k=(Math.sqrt(5)-1)/4,C=(5-Math.sqrt(5))/20,K=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),o=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const n=class{constructor(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const h="function"==typeof V?V:function(V){let h=0,mV=0,t=0,L=1;const N=function(){let V=4022871197;return function(h){h=h.toString();for(let mV=0;mV<h.length;mV++){V+=h.charCodeAt(mV);let t=.02519603282416938*V;V=t>>>0,t-=V,t*=V,V=t>>>0,t-=V,V+=4294967296*t}return 2.3283064365386963e-10*(V>>>0)}}();h=N(" "),mV=N(" "),t=N(" "),h-=N(V),h<0&&(h+=1);mV-=N(V),mV<0&&(mV+=1);t-=N(V),t<0&&(t+=1);return function(){const V=2091639*h+2.3283064365386963e-10*L;return h=mV,mV=t,t=V-(L=0|V)}}(V);this.p=function(V){const h=new Uint8Array(256);for(let mV=0;mV<256;mV++)h[mV]=mV;for(let mV=0;mV<255;mV++){const t=mV+~~(V()*(256-mV)),L=h[mV];h[mV]=h[t],h[t]=L}return h}(h),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let mV=0;mV<512;mV++)this.perm[mV]=this.p[255&mV],this.permMod12[mV]=this.perm[mV]%12}noise2D(V,h){const mV=this.permMod12,N=this.perm;let A=0,k=0,C=0;const o=(V+h)*t,n=Math.floor(V+o),q=Math.floor(h+o),x=(n+q)*L,R=V-(n-x),d=h-(q-x);let s,M;R>d?(s=1,M=0):(s=0,M=1);const c=R-s+L,z=d-M+L,Q=R-1+2*L,J=d-1+2*L,v=255&n,D=255&q;let H=.5-R*R-d*d;if(H>=0){const V=3*mV[v+N[D]];H*=H,A=H*H*(K[V]*R+K[V+1]*d)}let j=.5-c*c-z*z;if(j>=0){const V=3*mV[v+s+N[D+M]];j*=j,k=j*j*(K[V]*c+K[V+1]*z)}let l=.5-Q*Q-J*J;if(l>=0){const V=3*mV[v+1+N[D+1]];l*=l,C=l*l*(K[V]*Q+K[V+1]*J)}return 70*(A+k+C)}noise3D(V,h,mV){const t=this.permMod12,L=this.perm;let k,C,o,n;const q=(V+h+mV)*N,x=Math.floor(V+q),R=Math.floor(h+q),d=Math.floor(mV+q),s=(x+R+d)*A,M=V-(x-s),c=h-(R-s),z=mV-(d-s);let Q,J,v,D,H,j;M>=c?c>=z?(Q=1,J=0,v=0,D=1,H=1,j=0):M>=z?(Q=1,J=0,v=0,D=1,H=0,j=1):(Q=0,J=0,v=1,D=1,H=0,j=1):c<z?(Q=0,J=0,v=1,D=0,H=1,j=1):M<z?(Q=0,J=1,v=0,D=0,H=1,j=1):(Q=0,J=1,v=0,D=1,H=1,j=0);const l=M-Q+A,G=c-J+A,y=z-v+A,O=M-D+2*A,I=c-H+2*A,r=z-j+2*A,T=M-1+.5,F=c-1+.5,p=z-1+.5,Z=255&x,f=255&R,S=255&d;let Y=.6-M*M-c*c-z*z;if(Y<0)k=0;else{const V=3*t[Z+L[f+L[S]]];Y*=Y,k=Y*Y*(K[V]*M+K[V+1]*c+K[V+2]*z)}let w=.6-l*l-G*G-y*y;if(w<0)C=0;else{const V=3*t[Z+Q+L[f+J+L[S+v]]];w*=w,C=w*w*(K[V]*l+K[V+1]*G+K[V+2]*y)}let E=.6-O*O-I*I-r*r;if(E<0)o=0;else{const V=3*t[Z+D+L[f+H+L[S+j]]];E*=E,o=E*E*(K[V]*O+K[V+1]*I+K[V+2]*r)}let g=.6-T*T-F*F-p*p;if(g<0)n=0;else{const V=3*t[Z+1+L[f+1+L[S+1]]];g*=g,n=g*g*(K[V]*T+K[V+1]*F+K[V+2]*p)}return 32*(k+C+o+n)}noise4D(V,h,mV,t){const L=this.perm;let N,A,K,n,q;const x=(V+h+mV+t)*k,R=Math.floor(V+x),d=Math.floor(h+x),s=Math.floor(mV+x),M=Math.floor(t+x),c=(R+d+s+M)*C,z=V-(R-c),Q=h-(d-c),J=mV-(s-c),v=t-(M-c);let D=0,H=0,j=0,l=0;z>Q?D++:H++,z>J?D++:j++,z>v?D++:l++,Q>J?H++:j++,Q>v?H++:l++,J>v?j++:l++;const G=D>=3?1:0,y=H>=3?1:0,O=j>=3?1:0,I=l>=3?1:0,r=D>=2?1:0,T=H>=2?1:0,F=j>=2?1:0,p=l>=2?1:0,Z=D>=1?1:0,f=H>=1?1:0,S=j>=1?1:0,Y=l>=1?1:0,w=z-G+C,E=Q-y+C,g=J-O+C,i=v-I+C,b=z-r+2*C,P=Q-T+2*C,U=J-F+2*C,u=v-p+2*C,e=z-Z+3*C,W=Q-f+3*C,X=J-S+3*C,a=v-Y+3*C,B=z-1+4*C,VV=Q-1+4*C,hV=J-1+4*C,mh=v-1+4*C,tV=255&R,LV=255&d,NV=255&s,AV=255&M;let kV=.6-z*z-Q*Q-J*J-v*v;if(kV<0)N=0;else{const V=L[tV+L[LV+L[NV+L[AV]]]]%32*4;kV*=kV,N=kV*kV*(o[V]*z+o[V+1]*Q+o[V+2]*J+o[V+3]*v)}let CV=.6-w*w-E*E-g*g-i*i;if(CV<0)A=0;else{const V=L[tV+G+L[LV+y+L[NV+O+L[AV+I]]]]%32*4;CV*=CV,A=CV*CV*(o[V]*w+o[V+1]*E+o[V+2]*g+o[V+3]*i)}let KV=.6-b*b-P*P-U*U-u*u;if(KV<0)K=0;else{const V=L[tV+r+L[LV+T+L[NV+F+L[AV+p]]]]%32*4;KV*=KV,K=KV*KV*(o[V]*b+o[V+1]*P+o[V+2]*U+o[V+3]*u)}let oV=.6-e*e-W*W-X*X-a*a;if(oV<0)n=0;else{const V=L[tV+Z+L[LV+f+L[NV+S+L[AV+Y]]]]%32*4;oV*=oV,n=oV*oV*(o[V]*e+o[V+1]*W+o[V+2]*X+o[V+3]*a)}let nV=.6-B*B-VV*VV-hV*hV-mh*mh;if(nV<0)q=0;else{const V=L[tV+1+L[LV+1+L[NV+1+L[AV+1]]]]%32*4;nV*=nV,q=nV*nV*(o[V]*B+o[V+1]*VV+o[V+2]*hV+o[V+3]*mh)}return 27*(N+A+K+n+q)}}}}]);