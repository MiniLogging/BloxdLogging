/*! For license information please see f7r5om.32.4fa0dd18.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[32],{13172:(P,f,Y)=>{"use strict";var C=Y(13179),q=Y(13183),m=Y(13187);Y.g.__TYPEDARRAY_POOL||(Y.g.__TYPEDARRAY_POOL={UINT8:q([32,0]),UINT16:q([32,0]),UINT32:q([32,0]),INT8:q([32,0]),INT16:q([32,0]),INT32:q([32,0]),FLOAT:q([32,0]),DOUBLE:q([32,0]),DATA:q([32,0]),UINT8C:q([32,0]),BUFFER:q([32,0])});var L="undefined"!==typeof Uint8ClampedArray,o=Y.g.__TYPEDARRAY_POOL;o.UINT8C||(o.UINT8C=q([32,0])),o.BUFFER||(o.BUFFER=q([32,0]));var w=o.DATA,d=o.BUFFER;function R(P){if(P){var f=P.length||P.byteLength,Y=C.log2(f);w[Y].push(P)}}function y(P){P=C.nextPow2(P);var f=C.log2(P),Y=w[f];return Y.length>0?Y.pop():new ArrayBuffer(P)}function r(P){return new Uint8Array(y(P),0,P)}function i(P){return new Uint16Array(y(2*P),0,P)}function u(P){return new Uint32Array(y(4*P),0,P)}function g(P){return new Int8Array(y(P),0,P)}function S(P){return new Int16Array(y(2*P),0,P)}function K(P){return new Int32Array(y(4*P),0,P)}function M(P){return new Float32Array(y(4*P),0,P)}function V(P){return new Float64Array(y(8*P),0,P)}function O(P){return L?new Uint8ClampedArray(y(P),0,P):r(P)}function n(P){return new DataView(y(P),0,P)}f.free=function(P){if(m(P))d[C.log2(P.length)].push(P);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(P)&&(P=P.buffer),!P)return;var f=P.length||P.byteLength,Y=0|C.log2(f);w[Y].push(P)}},f.freeUint8=f.freeUint16=f.freeUint32=f.freeInt8=f.freeInt16=f.freeInt32=f.freeFloat32=f.freeFloat=f.freeFloat64=f.freeDouble=f.freeUint8Clamped=f.freeDataView=function(P){R(P.buffer)},f.freeArrayBuffer=R,f.freeBuffer=function(P){d[C.log2(P.length)].push(P)},f.malloc=function(P,f){if(void 0===f||"arraybuffer"===f)return y(P);switch(f){case"uint8":return r(P);case"uint16":return i(P);case"uint32":return u(P);case"int8":return g(P);case"int16":return S(P);case"int32":return K(P);case"float":case"float32":return M(P);case"double":case"float64":return V(P);case"uint8_clamped":return O(P);case"buffer":throw"Buffer not supported";case"data":case"dataview":return n(P);default:return null}return null},f.mallocArrayBuffer=y,f.mallocUint8=r,f.mallocUint16=i,f.mallocUint32=u,f.mallocInt8=g,f.mallocInt16=S,f.mallocInt32=K,f.mallocFloat32=f.mallocFloat=M,f.mallocFloat64=f.mallocDouble=V,f.mallocUint8Clamped=O,f.mallocDataView=n,f.clearCache=function(){for(var P=0;P<32;++P)o.UINT8[P].length=0,o.UINT16[P].length=0,o.UINT32[P].length=0,o.INT8[P].length=0,o.INT16[P].length=0,o.INT32[P].length=0,o.FLOAT[P].length=0,o.DOUBLE[P].length=0,o.UINT8C[P].length=0,w[P].length=0,d[P].length=0}},13273:(P,f,Y)=>{P.exports=q;var C=Y(12037);function q(P,f){if(!(this instanceof q))return new q(P,f);var Y=C.create();C.add(Y,P,f),this.base=C.min(C.create(),P,Y),this.CR=C.clone(f),this.max=C.max(C.create(),P,Y),this.mag=C.length(this.CR)}var m=q.prototype;m.width=function(){return this.CR[0]},m.height=function(){return this.CR[1]},m.depth=function(){return this.CR[2]},m.x0=function(){return this.base[0]},m.y0=function(){return this.base[1]},m.z0=function(){return this.base[2]},m.x1=function(){return this.max[0]},m.y1=function(){return this.max[1]},m.z1=function(){return this.max[2]},m.translate=function(P){return C.add(this.max,this.max,P),C.add(this.base,this.base,P),this},m.setPosition=function(P){return C.add(this.max,P,this.CR),C.j(this.base,P),this},m.expand=function(P){var f=C.create(),Y=C.create();return C.max(f,P.max,this.max),C.min(Y,P.base,this.base),C.nf(f,f,Y),new q(Y,f)},m.intersects=function(P){return!(P.base[0]>this.max[0])&&(!(P.base[1]>this.max[1])&&(!(P.base[2]>this.max[2])&&(!(P.max[0]<this.base[0])&&(!(P.max[1]<this.base[1])&&!(P.max[2]<this.base[2])))))},m.touches=function(P){var f=this.union(P);return null!==f&&(0==f.width()||0==f.height()||0==f.depth())},m.union=function(P){if(!this.intersects(P))return null;var f=Math.max(P.base[0],this.base[0]),Y=Math.max(P.base[1],this.base[1]),C=Math.max(P.base[2],this.base[2]);return new q([f,Y,C],[Math.min(P.max[0],this.max[0])-f,Math.min(P.max[1],this.max[1])-Y,Math.min(P.max[2],this.max[2])-C])}},13179:(P,f)=>{"use strict";function Y(P){var f=32;return(P&=-P)&&f--,65535&P&&(f-=16),16711935&P&&(f-=8),252645135&P&&(f-=4),858993459&P&&(f-=2),1431655765&P&&(f-=1),f}f.INT_BITS=32,f.INT_MAX=2147483647,f.INT_MIN=-1<<31,f.sign=function(P){return(P>0)-(P<0)},f.abs=function(P){var f=P>>31;return(P^f)-f},f.min=function(P,f){return f^(P^f)&-(P<f)},f.max=function(P,f){return P^(P^f)&-(P<f)},f.isPow2=function(P){return!(P&P-1)&&!!P},f.log2=function(P){var f,Y;return f=(P>65535)<<4,f|=Y=((P>>>=f)>255)<<3,f|=Y=((P>>>=Y)>15)<<2,(f|=Y=((P>>>=Y)>3)<<1)|(P>>>=Y)>>1},f.log10=function(P){return P>=1e9?9:P>=1e8?8:P>=1e7?7:P>=1e6?6:P>=1e5?5:P>=1e4?4:P>=1e3?3:P>=100?2:P>=10?1:0},f.popCount=function(P){return 16843009*((P=(858993459&(P-=P>>>1&1431655765))+(P>>>2&858993459))+(P>>>4)&252645135)>>>24},f.countTrailingZeros=Y,f.nextPow2=function(P){return P+=0===P,--P,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)+1},f.prevPow2=function(P){return P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)-(P>>>1)},f.parity=function(P){return P^=P>>>16,P^=P>>>8,P^=P>>>4,27030>>>(P&=15)&1};var C=new Array(256);!function(P){for(var f=0;f<256;++f){var Y=f,C=f,q=7;for(Y>>>=1;Y;Y>>>=1)C<<=1,C|=1&Y,--q;P[f]=C<<q&255}}(C),f.reverse=function(P){return C[255&P]<<24|C[P>>>8&255]<<16|C[P>>>16&255]<<8|C[P>>>24&255]},f.interleave2=function(P,f){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P&=65535)|P<<8))|P<<4))|P<<2))|P<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))<<1},f.deinterleave2=function(P,f){return(P=65535&((P=16711935&((P=252645135&((P=858993459&((P=P>>>f&1431655765)|P>>>1))|P>>>2))|P>>>4))|P>>>16))<<16>>16},f.interleave3=function(P,f,Y){return P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2),(P|=(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<1)|(Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2))<<2},f.deinterleave3=function(P,f){return(P=1023&((P=4278190335&((P=251719695&((P=3272356035&((P=P>>>f&1227133513)|P>>>2))|P>>>4))|P>>>8))|P>>>16))<<22>>22},f.nextCombination=function(P){var f=P|P-1;return f+1|(~f&-~f)-1>>>Y(P)+1}},13169:(P,f,Y)=>{"use strict";P.exports=function(P,f,Y){switch(arguments.length){case 1:return C=[],d(q=P,q,R,!0),C;case 2:return"function"===typeof f?d(P,P,f,!0):function(P,f){return C=[],d(P,f,R,!1),C}(P,f);case 3:return d(P,f,Y,!1);default:throw new Error("box-intersect: Invalid arguments")}var q};var C,q=Y(13172),m=Y(13196),L=Y(13209);function o(P,f){for(var Y=0;Y<P;++Y)if(!(f[Y]<=f[Y+P]))return!0;return!1}function w(P,f,Y,C){for(var q=0,m=0,L=0,w=P.length;L<w;++L){var d=P[L];if(!o(f,d)){for(var R=0;R<2*f;++R)Y[q++]=d[R];C[m++]=L}}return m}function d(P,f,Y,C){var o=P.length,d=f.length;if(!(o<=0||d<=0)){var R=P[0].length>>>1;if(!(R<=0)){var y,r=q.mallocDouble(2*R*o),i=q.mallocInt32(o);if((o=w(P,R,r,i))>0){if(1===R&&C)m.init(o),y=m.sweepComplete(R,Y,0,o,r,i,0,o,r,i);else{var u=q.mallocDouble(2*R*d),g=q.mallocInt32(d);(d=w(f,R,u,g))>0&&(m.init(o+d),y=1===R?m.sweepBipartite(R,Y,0,o,r,i,0,d,u,g):L(R,Y,C,o,r,i,d,u,g),q.free(u),q.free(g))}q.free(r),q.free(i)}return y}}}function R(P,f){C.push([P,f])}},13216:(P,f)=>{"use strict";var Y="d",C="ax",q="fp",m="es",L="rs",o="re",w="rb",d="bs",R="be",y="bb",r=[Y,C,"vv",L,o,w,"ri",d,R,y,"bi"];function i(P){var f="bruteForce"+(P?"Full":"Partial"),C=[],L=r.slice();P||L.splice(3,0,q);var o=["function "+f+"("+L.join()+"){"];function w(f,q){var L=function(P,f,C){var q="bruteForce"+(P?"Red":"Blue")+(f?"Flip":"")+(C?"Full":""),L=["function ",q,"(",r.join(),"){","var ",m,"=2*",Y,";"],o="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",w="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(C?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return P?L.push(o,"Q",":",w):L.push(w,"Q",":",o),C?L.push("if(y1<x0||x1<y0)continue;"):f?L.push("if(y0<=x0||x1<y0)continue;"):L.push("if(y0<x0||x1<y0)continue;"),L.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),f?L.push("yi,xi"):L.push("xi,yi"),L.push(");if(rv!==void 0)return rv;}}}"),{name:q,code:L.join("")}}(f,q,P);C.push(L.code),o.push("return "+L.name+"("+r.join()+");")}o.push("if(re-rs>be-bs){"),P?(w(!0,!1),o.push("}else{"),w(!1,!1)):(o.push("if(fp){"),w(!0,!0),o.push("}else{"),w(!0,!1),o.push("}}else{if(fp){"),w(!1,!0),o.push("}else{"),w(!1,!1),o.push("}")),o.push("}}return "+f);var d=C.join("")+o.join("");return new Function(d)()}f.partial=i(!1),f.full=i(!0)},13209:(P,f,Y)=>{"use strict";P.exports=function(P,f,Y,m,R,D,j,e,s){!function(P,f){var Y=8*q.log2(f+1)*(P+1)|0,m=q.nextPow2(O*Y);l.length<m&&(C.free(l),l=C.mallocInt32(m));var L=q.nextPow2(n*Y);v.length<L&&(C.free(v),v=C.mallocDouble(L))}(P,m+j);var a,Q=0,J=2*P;c(Q++,0,0,m,0,j,Y?16:0,-1/0,1/0),Y||c(Q++,0,0,j,0,m,1,-1/0,1/0);for(;Q>0;){var N=(Q-=1)*O,I=l[N],X=l[N+1],x=l[N+2],k=l[N+3],Z=l[N+4],A=l[N+5],E=Q*n,t=v[E],G=v[E+1],z=1&A,B=!!(16&A),b=R,H=D,W=e,p=s;if(z&&(b=e,H=s,W=R,p=D),!(2&A&&X>=(x=S(P,I,X,x,b,H,G)))&&!(4&A&&(X=K(P,I,X,x,b,H,t))>=x)){var h=x-X,F=Z-k;if(B){if(P*h*(h+F)<i){if(void 0!==(a=w.scanComplete(P,I,f,X,x,b,H,k,Z,W,p)))return a;continue}}else{if(P*Math.min(h,F)<y){if(void 0!==(a=L(P,I,f,z,X,x,b,H,k,Z,W,p)))return a;continue}if(P*h*F<r){if(void 0!==(a=w.scanBipartite(P,I,f,z,X,x,b,H,k,Z,W,p)))return a;continue}}var PP=u(P,I,X,x,b,H,t,G);if(X<PP)if(P*(PP-X)<y){if(void 0!==(a=o(P,I+1,f,X,PP,b,H,k,Z,W,p)))return a}else if(I===P-2){if(void 0!==(a=z?w.sweepBipartite(P,f,k,Z,W,p,X,PP,b,H):w.sweepBipartite(P,f,X,PP,b,H,k,Z,W,p)))return a}else c(Q++,I+1,X,PP,k,Z,z,-1/0,1/0),c(Q++,I+1,k,Z,X,PP,1^z,-1/0,1/0);if(PP<x){var fP=d(P,I,k,Z,W,p),YP=W[J*fP+I],CP=g(P,I,fP,Z,W,p,YP);if(CP<Z&&c(Q++,I,PP,x,CP,Z,(4|z)+(B?16:0),YP,G),k<fP&&c(Q++,I,PP,x,k,fP,(2|z)+(B?16:0),t,YP),fP+1===CP){if(void 0!==(a=B?U(P,I,f,PP,x,b,H,fP,W,p[fP]):T(P,I,f,z,PP,x,b,H,fP,W,p[fP])))return a}else if(fP<CP){var qP;if(B){if(PP<(qP=M(P,I,PP,x,b,H,YP))){var mP=g(P,I,PP,qP,b,H,YP);if(I===P-2){if(PP<mP&&void 0!==(a=w.sweepComplete(P,f,PP,mP,b,H,fP,CP,W,p)))return a;if(mP<qP&&void 0!==(a=w.sweepBipartite(P,f,mP,qP,b,H,fP,CP,W,p)))return a}else PP<mP&&c(Q++,I+1,PP,mP,fP,CP,16,-1/0,1/0),mP<qP&&(c(Q++,I+1,mP,qP,fP,CP,0,-1/0,1/0),c(Q++,I+1,fP,CP,mP,qP,1,-1/0,1/0))}}else PP<(qP=z?V(P,I,PP,x,b,H,YP):M(P,I,PP,x,b,H,YP))&&(I===P-2?a=z?w.sweepBipartite(P,f,fP,CP,W,p,PP,qP,b,H):w.sweepBipartite(P,f,PP,qP,b,H,fP,CP,W,p):(c(Q++,I+1,PP,qP,fP,CP,z,-1/0,1/0),c(Q++,I+1,fP,CP,PP,qP,1^z,-1/0,1/0)))}}}}};var C=Y(13172),q=Y(13179),m=Y(13216),L=m.partial,o=m.full,w=Y(13196),d=Y(13223),R=Y(13230),y=128,r=1<<22,i=1<<22,u=R("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),g=R("lo===p0",["p0"]),S=R("lo<p0",["p0"]),K=R("hi<=p0",["p0"]),M=R("lo<=p0&&p0<=hi",["p0"]),V=R("lo<p0&&p0<=hi",["p0"]),O=6,n=2,l=C.mallocInt32(1024),v=C.mallocDouble(1024);function c(P,f,Y,C,q,m,L,o,w){var d=O*P;l[d]=f,l[d+1]=Y,l[d+2]=C,l[d+3]=q,l[d+4]=m,l[d+5]=L;var R=n*P;v[R]=o,v[R+1]=w}function T(P,f,Y,C,q,m,L,o,w,d,R){var y=2*P,r=w*y,i=d[r+f];P:for(var u=q,g=q*y;u<m;++u,g+=y){var S=L[g+f],K=L[g+f+P];if(!(i<S||K<i)&&(!C||i!==S)){for(var M,V=o[u],O=f+1;O<P;++O){S=L[g+O],K=L[g+O+P];var n=d[r+O],l=d[r+O+P];if(K<n||l<S)continue P}if(void 0!==(M=C?Y(R,V):Y(V,R)))return M}}}function U(P,f,Y,C,q,m,L,o,w,d){var R=2*P,y=o*R,r=w[y+f];P:for(var i=C,u=C*R;i<q;++i,u+=R){var g=L[i];if(g!==d){var S=m[u+f],K=m[u+f+P];if(!(r<S||K<r)){for(var M=f+1;M<P;++M){S=m[u+M],K=m[u+M+P];var V=w[y+M],O=w[y+M+P];if(K<V||O<S)continue P}var n=Y(g,d);if(void 0!==n)return n}}}}},13223:(P,f,Y)=>{"use strict";P.exports=function(P,f,Y,L,o,w){if(L<=Y+1)return Y;var d=Y,R=L,y=L+Y>>>1,r=2*P,i=y,u=o[r*y+f];for(;d<R;){if(R-d<q){m(P,f,d,R,o,w),u=o[r*y+f];break}var g=R-d,S=Math.random()*g+d|0,K=o[r*S+f],M=Math.random()*g+d|0,V=o[r*M+f],O=Math.random()*g+d|0,n=o[r*O+f];K<=V?n>=V?(i=M,u=V):K>=n?(i=S,u=K):(i=O,u=n):V>=n?(i=M,u=V):n>=K?(i=S,u=K):(i=O,u=n);for(var l=r*(R-1),v=r*i,c=0;c<r;++c,++l,++v){var T=o[l];o[l]=o[v],o[v]=T}var U=w[R-1];w[R-1]=w[i],w[i]=U;for(l=r*(R-1),v=r*(i=C(P,f,d,R-1,o,w,u)),c=0;c<r;++c,++l,++v){T=o[l];o[l]=o[v],o[v]=T}U=w[R-1];if(w[R-1]=w[i],w[i]=U,y<i){for(R=i-1;d<R&&o[r*(R-1)+f]===u;)R-=1;R+=1}else{if(!(i<y))break;for(d=i+1;d<R&&o[r*d+f]===u;)d+=1}}return C(P,f,Y,y,o,w,o[r*y+f])};var C=Y(13230)("lo<p0",["p0"]),q=8;function m(P,f,Y,C,q,m){for(var L=2*P,o=L*(Y+1)+f,w=Y+1;w<C;++w,o+=L)for(var d=q[o],R=w,y=L*(w-1);R>Y&&q[y+f]>d;--R,y-=L){for(var r=y,i=y+L,u=0;u<L;++u,++r,++i){var g=q[r];q[r]=q[i],q[i]=g}var S=m[R];m[R]=m[R-1],m[R-1]=S}}},13230:P=>{"use strict";P.exports=function(P,Y){var C="abcdef".split("").concat(Y),q=[];P.indexOf("lo")>=0&&q.push("lo=e[k+n]");P.indexOf("hi")>=0&&q.push("hi=e[k+o]");return C.push(f.replace("_",q.join()).replace("$",P)),Function.apply(void 0,C)};var f="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13203:P=>{"use strict";P.exports=function(P,C){C<=4*f?Y(0,C-1,P):d(0,C-1,P)};var f=32;function Y(P,f,Y){for(var C=2*(P+1),q=P+1;q<=f;++q){for(var m=Y[C++],L=Y[C++],o=q,w=C-2;o-- >P;){var d=Y[w-2],R=Y[w-1];if(d<m)break;if(d===m&&R<L)break;Y[w]=d,Y[w+1]=R,w-=2}Y[w]=m,Y[w+1]=L}}function C(P,f,Y){f*=2;var C=Y[P*=2],q=Y[P+1];Y[P]=Y[f],Y[P+1]=Y[f+1],Y[f]=C,Y[f+1]=q}function q(P,f,Y){f*=2,Y[P*=2]=Y[f],Y[P+1]=Y[f+1]}function m(P,f,Y,C){f*=2,Y*=2;var q=C[P*=2],m=C[P+1];C[P]=C[f],C[P+1]=C[f+1],C[f]=C[Y],C[f+1]=C[Y+1],C[Y]=q,C[Y+1]=m}function L(P,f,Y,C,q){f*=2,q[P*=2]=q[f],q[f]=Y,q[P+1]=q[f+1],q[f+1]=C}function o(P,f,Y){f*=2;var C=Y[P*=2],q=Y[f];return!(C<q)&&(C!==q||Y[P+1]>Y[f+1])}function w(P,f,Y,C){var q=C[P*=2];return q<f||q===f&&C[P+1]<Y}function d(P,R,y){var r=(R-P+1)/6|0,i=P+r,u=R-r,g=P+R>>1,S=g-r,K=g+r,M=i,V=S,O=g,n=K,l=u,v=P+1,c=R-1,T=0;o(M,V,y)&&(T=M,M=V,V=T),o(n,l,y)&&(T=n,n=l,l=T),o(M,O,y)&&(T=M,M=O,O=T),o(V,O,y)&&(T=V,V=O,O=T),o(M,n,y)&&(T=M,M=n,n=T),o(O,n,y)&&(T=O,O=n,n=T),o(V,l,y)&&(T=V,V=l,l=T),o(V,O,y)&&(T=V,V=O,O=T),o(n,l,y)&&(T=n,n=l,l=T);for(var U=y[2*V],D=y[2*V+1],j=y[2*n],e=y[2*n+1],s=2*M,a=2*O,Q=2*l,J=2*i,N=2*g,I=2*u,X=0;X<2;++X){var x=y[s+X],k=y[a+X],Z=y[Q+X];y[J+X]=x,y[N+X]=k,y[I+X]=Z}q(S,P,y),q(K,R,y);for(var A=v;A<=c;++A)if(w(A,U,D,y))A!==v&&C(A,v,y),++v;else if(!w(A,j,e,y))for(;;){if(w(c,j,e,y)){w(c,U,D,y)?(m(A,v,c,y),++v,--c):(C(A,c,y),--c);break}if(--c<A)break}L(P,v-1,U,D,y),L(R,c+1,j,e,y),v-2-P<=f?Y(P,v-2,y):d(P,v-2,y),R-(c+2)<=f?Y(c+2,R,y):d(c+2,R,y),c-v<=f?Y(v,c,y):d(v,c,y)}},13196:(P,f,Y)=>{"use strict";P.exports={init:function(P){var f=q.nextPow2(P);w.length<f&&(C.free(w),w=C.mallocInt32(f));d.length<f&&(C.free(d),d=C.mallocInt32(f));R.length<f&&(C.free(R),R=C.mallocInt32(f));y.length<f&&(C.free(y),y=C.mallocInt32(f));r.length<f&&(C.free(r),r=C.mallocInt32(f));i.length<f&&(C.free(i),i=C.mallocInt32(f));var Y=8*f;u.length<Y&&(C.free(u),u=C.mallocDouble(Y))},sweepBipartite:function(P,f,Y,C,q,o,r,i,K,M){for(var V=0,O=2*P,n=P-1,l=O-1,v=Y;v<C;++v){var c=o[v],T=O*v;u[V++]=q[T+n],u[V++]=-(c+1),u[V++]=q[T+l],u[V++]=c}for(v=r;v<i;++v){c=M[v]+L;var U=O*v;u[V++]=K[U+n],u[V++]=-c,u[V++]=K[U+l],u[V++]=c}var D=V>>>1;m(u,D);var j=0,e=0;for(v=0;v<D;++v){var s=0|u[2*v+1];if(s>=L)g(R,y,e--,s=s-L|0);else if(s>=0)g(w,d,j--,s);else if(s<=-L){s=-s-L|0;for(var a=0;a<j;++a){if(void 0!==(Q=f(w[a],s)))return Q}S(R,y,e++,s)}else{s=-s-1|0;for(a=0;a<e;++a){var Q;if(void 0!==(Q=f(s,R[a])))return Q}S(w,d,j++,s)}}},sweepComplete:function(P,f,Y,C,q,L,o,K,M,V){for(var O=0,n=2*P,l=P-1,v=n-1,c=Y;c<C;++c){var T=L[c]+1<<1,U=n*c;u[O++]=q[U+l],u[O++]=-T,u[O++]=q[U+v],u[O++]=T}for(c=o;c<K;++c){T=V[c]+1<<1;var D=n*c;u[O++]=M[D+l],u[O++]=1|-T,u[O++]=M[D+v],u[O++]=1|T}var j=O>>>1;m(u,j);var e=0,s=0,a=0;for(c=0;c<j;++c){var Q=0|u[2*c+1],J=1&Q;if(c<j-1&&Q>>1===u[2*c+3]>>1&&(J=2,c+=1),Q<0){for(var N=-(Q>>1)-1,I=0;I<a;++I){if(void 0!==(X=f(r[I],N)))return X}if(0!==J)for(I=0;I<e;++I){if(void 0!==(X=f(w[I],N)))return X}if(1!==J)for(I=0;I<s;++I){var X;if(void 0!==(X=f(R[I],N)))return X}0===J?S(w,d,e++,N):1===J?S(R,y,s++,N):2===J&&S(r,i,a++,N)}else{N=(Q>>1)-1;0===J?g(w,d,e--,N):1===J?g(R,y,s--,N):2===J&&g(r,i,a--,N)}}},scanBipartite:function(P,f,Y,C,q,o,R,y,r,i,K,M){var V=0,O=2*P,n=f,l=f+P,v=1,c=1;C?c=L:v=L;for(var T=q;T<o;++T){var U=T+v,D=O*T;u[V++]=R[D+n],u[V++]=-U,u[V++]=R[D+l],u[V++]=U}for(T=r;T<i;++T){U=T+c;var j=O*T;u[V++]=K[j+n],u[V++]=-U}var e=V>>>1;m(u,e);var s=0;for(T=0;T<e;++T){var a=0|u[2*T+1];if(a<0){var Q=!1;if((U=-a)>=L?(Q=!C,U-=L):(Q=!!C,U-=1),Q)S(w,d,s++,U);else{var J=M[U],N=O*U,I=K[N+f+1],X=K[N+f+1+P];P:for(var x=0;x<s;++x){var k=w[x],Z=O*k;if(!(X<R[Z+f+1]||R[Z+f+1+P]<I)){for(var A=f+2;A<P;++A)if(K[N+A+P]<R[Z+A]||R[Z+A+P]<K[N+A])continue P;var E,t=y[k];if(void 0!==(E=C?Y(J,t):Y(t,J)))return E}}}}else g(w,d,s--,a-v)}},scanComplete:function(P,f,Y,C,q,o,d,R,y,r,i){for(var g=0,S=2*P,K=f,M=f+P,V=C;V<q;++V){var O=V+L,n=S*V;u[g++]=o[n+K],u[g++]=-O,u[g++]=o[n+M],u[g++]=O}for(V=R;V<y;++V){O=V+1;var l=S*V;u[g++]=r[l+K],u[g++]=-O}var v=g>>>1;m(u,v);var c=0;for(V=0;V<v;++V){var T=0|u[2*V+1];if(T<0){if((O=-T)>=L)w[c++]=O-L;else{var U=i[O-=1],D=S*O,j=r[D+f+1],e=r[D+f+1+P];P:for(var s=0;s<c;++s){var a=w[s],Q=d[a];if(Q===U)break;var J=S*a;if(!(e<o[J+f+1]||o[J+f+1+P]<j)){for(var N=f+2;N<P;++N)if(r[D+N+P]<o[J+N]||o[J+N+P]<r[D+N])continue P;var I=Y(Q,U);if(void 0!==I)return I}}}}else{for(O=T-L,s=c-1;s>=0;--s)if(w[s]===O){for(N=s+1;N<c;++N)w[N-1]=w[N];break}--c}}}};var C=Y(13172),q=Y(13179),m=Y(13203),L=1<<28,o=1024,w=C.mallocInt32(o),d=C.mallocInt32(o),R=C.mallocInt32(o),y=C.mallocInt32(o),r=C.mallocInt32(o),i=C.mallocInt32(o),u=C.mallocDouble(8192);function g(P,f,Y,C){var q=f[C],m=P[Y-1];P[q]=m,f[m]=q}function S(P,f,Y,C){P[Y]=C,f[C]=Y}},13183:P=>{"use strict";function f(P,Y,C){var q=0|P[C];if(q<=0)return[];var m,L=new Array(q);if(C===P.length-1)for(m=0;m<q;++m)L[m]=Y;else for(m=0;m<q;++m)L[m]=f(P,Y,C+1);return L}P.exports=function(P,Y){switch("undefined"===typeof Y&&(Y=0),typeof P){case"number":if(P>0)return function(P,f){var Y,C;for(Y=new Array(P),C=0;C<P;++C)Y[C]=f;return Y}(0|P,Y);break;case"object":if("number"===typeof P.length)return f(P,Y,0)}return[]}},13142:(P,f,Y)=>{P.exports=function(){var P=this;this.components={},this.comps=this.components;var f=this.components,Y=1,q={},m=[],L=[],o={timeout:!1,removals:[],multiComps:[]};function w(P,Y){var C=f[Y],m=q[Y],L=m.hash[P];L&&(m.remove(P),C.Cf&&(C.multi?(L.forEach((f=>{f&&C.Cf(P,f)})),L.length=0):C.Cf(P,L)),o.removals.push(m),d())}function d(){o.timeout||(o.timeout=!0,setTimeout(R,1))}function R(){o.timeout=!1,y()}function y(){o.multiComps.length&&function(P){for(var f=0;f<P.length;f++){var{entID:Y,data:C}=P[f],q=C.hash[Y];if(q){for(var m=0;m<q.length;m++)q[m]||(q.splice(m,1),m--);0===q.length&&(C.remove(Y),o.removals.push(C))}}P.length=0}(o.multiComps),o.removals.length&&function(P){for(var f=0;f<P.length;f++){P[f].flush()}P.length=0}(o.removals)}this.Oy=q,this._systems=m,this._renderSystems=L,this.LR=function(f){var C=Y++;return Array.isArray(f)&&f.forEach((f=>P.Vw(C,f))),C},this.deleteEntity=function(f){return Object.keys(q).forEach((P=>{q[P].hash[f]&&w(f,P)})),P},this.nR=function(P){if(!P)throw new Error("Missing component definition");var Y=P.name;if(!Y)throw new Error("Component definition must have a name property.");if("string"!==typeof Y)throw new Error("Component name must be a string.");if(""===Y)throw new Error("Component name must be a non-empty string.");if(q[Y])throw new Error(`Component ${Y} already exists.`);var o={};return o.name=Y,o.multi=!!P.multi,o.order=isNaN(P.order)?99:P.order,o.stateConstructor=P.stateConstructor||null,o.state=P.state||{},o.co=P.co||null,o.Cf=P.Cf||null,o.system=P.system||null,o.so=P.so||null,f[Y]=o,q[Y]=new C,q[Y]._pendingMultiCleanup=!1,q[Y]._multiCleanupIDs=o.multi?[]:null,o.system&&(m.push(Y),m.sort(((P,Y)=>f[P].order-f[Y].order))),o.so&&(L.push(Y),L.sort(((P,Y)=>f[P].order-f[Y].order))),Y},this.overwriteComponent=function(P,Y){var C=f[P];if(!C)throw new Error(`Unknown component: ${P}`);if(!Y)throw new Error("Missing component definition");if(C.name!==Y.name)throw new Error("Overwriting component must use the same name property.");var o={};o.name=P,o.multi=!!Y.multi,o.order=isNaN(Y.order)?99:Y.order,o.state=Y.state||{},o.co=Y.co||null,o.Cf=Y.Cf||null,o.system=Y.system||null,o.so=Y.so||null,f[P]=o,q[P]._pendingMultiCleanup=!1,q[P]._multiCleanupIDs=o.multi?[]:null;var w=m.indexOf(P);o.system&&w<0&&m.push(P),!o.system&&w>=0&&m.splice(w,1),m.sort(((P,Y)=>f[P].order-f[Y].order));var d=L.indexOf(P);o.so&&d<0&&L.push(P),!o.so&&d>=0&&L.splice(d,1),L.sort(((P,Y)=>f[P].order-f[Y].order));var R=o.state;return this.Dd(P).forEach((P=>{for(var f in R)f in P||(P[f]=R[f]);o.co&&o.co(P.jo,P)})),P},this.deleteComponent=function(Y){var C=q[Y];if(!C)throw new Error(`Unknown component: ${Y}`);C.flush(),C.list.forEach((P=>{P&&w(P.jo||P[0].jo,Y)}));var o=m.indexOf(Y),d=L.indexOf(Y);return o>-1&&m.splice(o,1),d>-1&&L.splice(d,1),q[Y].dispose(),delete q[Y],delete f[Y],P},this.Vw=function(P,Y,C){var m,L=f[Y],o=q[Y];if(!o)throw new Error(`Unknown component: ${Y}.`);if(o.hash[P]&&!L.multi)throw new Error(`Entity ${P} already has component: ${Y}.`);if(L.stateConstructor){if(!(m=new L.stateConstructor).hasOwnProperty("jo"))throw new Error(`Component ${L.name} stateConstructor type does not have property __id`)}else m=Object.assign({},{jo:P},L.state,C);if(m.jo=P,L.multi){var w=o.hash[P];w||(w=[],o.add(P,w)),w.push(m)}else o.add(P,m);return L.co&&L.co(P,m),this},this.sw=function(P,f){var Y=q[f];if(!Y)throw new Error(`Unknown component: ${f}.`);return!!Y.hash[P]},this.cw=function(f,Y){if(!q[Y])throw new Error(`Unknown component: ${Y}.`);return w(f,Y),P},this.getState=function(P,f){var Y=q[f];if(!Y)throw new Error(`Unknown component: ${f}.`);return Y.hash[P]},this.Dd=function(P){var f=q[P];if(!f)throw new Error(`Unknown component: ${P}.`);return y(),f.list},this.Mi=function(P){if(!q[P])throw new Error(`Unknown component: ${P}.`);var f=q[P].hash;return P=>f[P]},this.ni=function(P){if(!q[P])throw new Error(`Unknown component: ${P}.`);var f=q[P].hash;return P=>!!f[P]},this.wo=function(Y){y();for(var C=0;C<m.length;C++){var L=m[C],o=f[L],w=q[L];o.system(Y,w.list),y()}return P},this.render=function(Y){y();for(var C=0;C<L.length;C++){var m=L[C],o=f[m],w=q[m];o.so(Y,w.list),y()}return P},this.removeMultiComponent=function(Y,C,m){var L=f[C],w=q[C];if(!w)throw new Error(`Unknown component: ${C}.`);if(!L.multi)throw new Error("removeMultiComponent called on non-multi component");return function(P,f,Y,C){var q=Y.hash[P];if(q){var m=q[C];m&&(q[C]=null,f.Cf&&f.Cf(P,m),o.multiComps.push({entID:P,data:Y}),d())}}(Y,L,w,m),P}};var C=Y(13145)},13145:P=>{function f(P,f){var Y=P._map[f];if(delete P.hash[f],delete P._map[f],Y===P.list.length-1)P.list.pop();else{var C=P.list.pop();if(P.list[Y]=C,null===C||null===C[0]){var q=P.list.length;for(var m in P._map)if(P._map[m]===q)return void(P._map[m]=Y)}else{var L=C.jo||C[0].jo;P._map[L]=Y}}}P.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(P,f){if("number"===typeof this._map[P]){var Y=this._map[P];this.hash[P]=f,this.list[Y]=f}else this._map[P]=this.list.length,this.hash[P]=f,this.list.push(f)}remove(P){var f=this._map[P];this.hash[P]=null,this.list[f]=null,this._pendingRemovals.push(P)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var P=0;P<this._pendingRemovals.length;P++){var Y=this._pendingRemovals[P];null===this.hash[Y]&&f(this,Y)}this._pendingRemovals.length=0}}},13112:P=>{"use strict";var f,Y="object"===typeof Reflect?Reflect:null,C=function(P,f,Y){return Function.prototype.apply.call(P,f,Y)};f=Y&&"function"===typeof Y.ownKeys?Y.ownKeys:Object.getOwnPropertySymbols?function(P){return Object.getOwnPropertyNames(P).concat(Object.getOwnPropertySymbols(P))}:function(P){return Object.getOwnPropertyNames(P)};var q=Number.isNaN||function(P){return P!==P};function m(){m.init.call(this)}P.exports=m,P.exports.once=function(P,f){return new Promise((function(Y,C){function q(Y){P.removeListener(f,m),C(Y)}function m(){"function"===typeof P.removeListener&&P.removeListener("error",q),Y([].slice.call(arguments))}g(P,f,m,{once:!0}),"error"!==f&&function(P,f,Y){"function"===typeof P.on&&g(P,"error",f,Y)}(P,q,{once:!0})}))},m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var L=10;function o(P){if("function"!==typeof P)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}function w(P){return void 0===P._maxListeners?m.defaultMaxListeners:P._maxListeners}function d(P,f,Y,C){var q,m,L,d;if(o(Y),void 0===(m=P._events)?(m=P._events=Object.create(null),P._eventsCount=0):(void 0!==m.newListener&&(P.emit("newListener",f,Y.listener?Y.listener:Y),m=P._events),L=m[f]),void 0===L)L=m[f]=Y,++P._eventsCount;else if("function"===typeof L?L=m[f]=C?[Y,L]:[L,Y]:C?L.unshift(Y):L.push(Y),(q=w(P))>0&&L.length>q&&!L.warned){L.warned=!0;var R=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(f)+" listeners added. Use emitter.setMaxListeners() to increase limit");R.name="MaxListenersExceededWarning",R.k=P,R.type=f,R.count=L.length,d=R,console&&console.warn&&console.warn(d)}return P}function R(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function y(P,f,Y){var C={fired:!1,wrapFn:void 0,target:P,type:f,listener:Y},q=R.bind(C);return q.listener=Y,C.wrapFn=q,q}function r(P,f,Y){var C=P._events;if(void 0===C)return[];var q=C[f];return void 0===q?[]:"function"===typeof q?Y?[q.listener||q]:[q]:Y?function(P){for(var f=new Array(P.length),Y=0;Y<f.length;++Y)f[Y]=P[Y].listener||P[Y];return f}(q):u(q,q.length)}function i(P){var f=this._events;if(void 0!==f){var Y=f[P];if("function"===typeof Y)return 1;if(void 0!==Y)return Y.length}return 0}function u(P,f){for(var Y=new Array(f),C=0;C<f;++C)Y[C]=P[C];return Y}function g(P,f,Y,C){if("function"===typeof P.on)C.once?P.once(f,Y):P.on(f,Y);else{if("function"!==typeof P.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P);P.addEventListener(f,(function q(m){C.once&&P.removeEventListener(f,q),Y(m)}))}}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return L},set:function(P){if("number"!==typeof P||P<0||q(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");L=P}}),m.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(P){if("number"!==typeof P||P<0||q(P))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+P+".");return this._maxListeners=P,this},m.prototype.getMaxListeners=function(){return w(this)},m.prototype.emit=function(P){for(var f=[],Y=1;Y<arguments.length;Y++)f.push(arguments[Y]);var q="error"===P,m=this._events;if(void 0!==m)q=q&&void 0===m.error;else if(!q)return!1;if(q){var L;if(f.length>0&&(L=f[0]),L instanceof Error)throw L;var o=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw o.context=L,o}var w=m[P];if(void 0===w)return!1;if("function"===typeof w)C(w,this,f);else{var d=w.length,R=u(w,d);for(Y=0;Y<d;++Y)C(R[Y],this,f)}return!0},m.prototype.addListener=function(P,f){return d(this,P,f,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(P,f){return d(this,P,f,!0)},m.prototype.once=function(P,f){return o(f),this.on(P,y(this,P,f)),this},m.prototype.prependOnceListener=function(P,f){return o(f),this.prependListener(P,y(this,P,f)),this},m.prototype.removeListener=function(P,f){var Y,C,q,m,L;if(o(f),void 0===(C=this._events))return this;if(void 0===(Y=C[P]))return this;if(Y===f||Y.listener===f)0===--this._eventsCount?this._events=Object.create(null):(delete C[P],C.removeListener&&this.emit("removeListener",P,Y.listener||f));else if("function"!==typeof Y){for(q=-1,m=Y.length-1;m>=0;m--)if(Y[m]===f||Y[m].listener===f){L=Y[m].listener,q=m;break}if(q<0)return this;0===q?Y.shift():function(P,f){for(;f+1<P.length;f++)P[f]=P[f+1];P.pop()}(Y,q),1===Y.length&&(C[P]=Y[0]),void 0!==C.removeListener&&this.emit("removeListener",P,L||f)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(P){var f,Y,C;if(void 0===(Y=this._events))return this;if(void 0===Y.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Y[P]&&(0===--this._eventsCount?this._events=Object.create(null):delete Y[P]),this;if(0===arguments.length){var q,m=Object.keys(Y);for(C=0;C<m.length;++C)"removeListener"!==(q=m[C])&&this.removeAllListeners(q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(f=Y[P]))this.removeListener(P,f);else if(void 0!==f)for(C=f.length-1;C>=0;C--)this.removeListener(P,f[C]);return this},m.prototype.listeners=function(P){return r(this,P,!0)},m.prototype.rawListeners=function(P){return r(this,P,!1)},m.listenerCount=function(P,f){return"function"===typeof P.listenerCount?P.listenerCount(f):i.call(P,f)},m.prototype.listenerCount=i,m.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]}},13400:P=>{"use strict";P.exports=function(P,f,Y,C,q,m){var L=+f[0],o=+f[1],w=+f[2],d=+Y[0],R=+Y[1],y=+Y[2],r=Math.sqrt(d*d+R*R+y*y);if(0===r)throw new Error("Can't raycast along a zero vector");return function(P,f,Y,C,q,m,L,o,w,d){for(var R=0,y=Math.floor,r=0|y(f),i=0|y(Y),u=0|y(C),g=q>0?1:-1,S=m>0?1:-1,K=L>0?1:-1,M=Math.abs(1/q),V=Math.abs(1/m),O=Math.abs(1/L),n=M<1/0?M*(g>0?r+1-f:f-r):1/0,l=V<1/0?V*(S>0?i+1-Y:Y-i):1/0,v=O<1/0?O*(K>0?u+1-C:C-u):1/0,c=-1;R<=o;){var T=P(r,i,u);if(T)return w&&(w[0]=f+R*q,w[1]=Y+R*m,w[2]=C+R*L),d&&(d[0]=d[1]=d[2]=0,0===c&&(d[0]=-g),1===c&&(d[1]=-S),2===c&&(d[2]=-K)),T;n<l?n<v?(r+=g,R=n,n+=M,c=0):(u+=K,R=v,v+=O,c=2):l<v?(i+=S,R=l,l+=V,c=1):(u+=K,R=v,v+=O,c=2)}return w&&(w[0]=f+R*q,w[1]=Y+R*m,w[2]=C+R*L),d&&(d[0]=d[1]=d[2]=0),0}(P,L,o,w,d/=r,R/=r,y/=r,C="undefined"===typeof C?64:+C,q,m)}},13438:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>m});var C=Y(13112);function q(){this.gr=!1,this.stopPropagation=!1,this.Sr=!1,this.disabled=!1}class m{constructor(P,f){this.version="0.7.0";var Y=Object.assign({},new q,f||{});this.element=P||document,this.gr=!!Y.gr,this.stopPropagation=!!Y.stopPropagation,this.Sr=!!Y.Sr,this.disabled=!!Y.disabled,this.filterEvents=(P,f)=>!0,this.down=new C.EventEmitter,this.up=new C.EventEmitter,this.state={},this.Sd={dx:0,dy:0,oi:0,gd:0,wi:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?o(this):document.addEventListener("DOMContentLoaded",(P=>{o(this)}),{once:!0})}bind(P){for(var f=arguments.length,Y=new Array(f>1?f-1:0),C=1;C<f;C++)Y[C-1]=arguments[C];Y.forEach((f=>{var Y=this._keyBindmap[f]||[];Y.includes(P)||(Y.push(P),this._keyBindmap[f]=Y)})),this.state[P]=!!this.state[P],this.pressCount[P]=this.pressCount[P]||0,this.releaseCount[P]=this.releaseCount[P]||0}unbind(P){for(var f in this._keyBindmap){var Y=this._keyBindmap[f],C=Y.indexOf(P);C>-1&&Y.splice(C,1)}}getBindings(){var P={};for(var f in this._keyBindmap){this._keyBindmap[f].forEach((Y=>{P[Y]=P[Y]||[],P[Y].push(f)}))}return P}wo(){L(this.Sd),L(this.pressCount),L(this.releaseCount)}}function L(P){for(var f in P)P[f]=0}function o(P){window.addEventListener("keydown",u.bind(null,P,!0),!1),window.addEventListener("keyup",u.bind(null,P,!1),!1);var f={passive:!0};P.element.addEventListener("touchstart",y.bind(void 0,P),{passive:!1}),P.element.addEventListener("touchend",i.bind(void 0,P),f),P.element.addEventListener("mousedown",g.bind(null,P,!0),f),window.document.addEventListener("mouseup",g.bind(null,P,!1),f),P.element.addEventListener("touchmove",S.bind(null,P),f),P.element.addEventListener("mousemove",S.bind(null,P),f),window.PointerEvent,P.element.addEventListener("wheel",K.bind(null,P),f),P.element.addEventListener("contextmenu",M.bind(null,P),!1),window.addEventListener("blur",V.bind(null,P),!1)}var w=0,d=0,R=null;function y(P,f){f.preventDefault(),r(f)}function r(P){let f=!1;for(let Y=0;Y<P.touches.length;++Y)if(P.touches[Y].identifier===R){f=!0;break}if(!f){const f=P.changedTouches[0];w=f.clientX,d=f.clientY,R=f.identifier}}function i(P,f){for(var Y=f.changedTouches,C=0;C<Y.length;++C)Y[C].identifier===R&&(R=null)}function u(P,f,Y){O(Y.code,f,P,Y)}function g(P,f,Y){if("pointerId"in Y)if(f){if(null!==P._touches.currID)return;P._touches.currID=Y.pointerId}else{if(P._touches.currID!==Y.pointerId)return;P._touches.currID=null}return O("Mouse"+("button"in Y?Y.button+1:1),f,P,Y),!1}function S(P,f){var Y=f.movementX||f.mozMovementX||0,C=f.movementY||f.mozMovementY||0;if(f.touches&&0===(Y|C)){var q=function(P){r(P);for(let f=0;f<P.changedTouches.length;++f)if(P.changedTouches[f].identifier==R){const Y=P.changedTouches[f],C=[Y.clientX-w,Y.clientY-d];return w=Y.clientX,d=Y.clientY,C}return console.error(`Did not find touch id ${R}`),[0,0]}(f);Y=q[0],C=q[1]}P.Sd.dx+=Y,P.Sd.dy+=C}function K(P,f){var Y=1;switch(f.deltaMode){case 0:Y=1;break;case 1:Y=12;break;case 2:Y=P.element.clientHeight||window.innerHeight}P.Sd.oi+=(f.deltaX||0)*Y,P.Sd.gd+=(f.deltaY||0)*Y,P.Sd.wi+=(f.deltaZ||0)*Y}function M(P,f){if(!P.Sr)return f.preventDefault(),!1}function V(P){for(var f in P._keyStates)P._keyStates[f]&&(/^Mouse\d/.test(f)||O(f,!1,P,{code:f,note:"hk8l2nfw4kv",preventDefault:()=>{},stopPropagation:()=>{}}))}function O(P,f,Y,C){var q=Y._keyBindmap[P];q&&(n(Y._keyStates[P],f)&&(Y._keyStates[P]=f,q.forEach((P=>{(!Y.filterEvents||Y.filterEvents(C,P))&&function(P,f,Y,C){var q=f?Y.pressCount:Y.releaseCount;q[P]=(q[P]||0)+1;var m=Y._bindPressCount[P]||0;(m+=f?1:-1)<0&&(m=0);Y._bindPressCount[P]=m;var L=Y.state[P];if(n(L,m)){Y.state[P]=m>0;var o=f?Y.down:Y.up;Y.disabled||o.emit(P,C)}}(P,f,Y,C)}))),"button"in C||(Y.gr&&!C.defaultPrevented&&C.preventDefault(),Y.stopPropagation&&C.stopPropagation()))}function n(P,f){return P?!f:f}},12107:P=>{P.exports=function(P,f,Y){return P[0]=f[0]+Y[0],P[1]=f[1]+Y[1],P[2]=f[2]+Y[2],P}},12064:(P,f,Y)=>{P.exports=function(P,f){var Y=C(P[0],P[1],P[2]),L=C(f[0],f[1],f[2]);q(Y,Y),q(L,L);var o=m(Y,L);return o>1?0:Math.acos(o)};var C=Y(12069),q=Y(12078),m=Y(12087)},12168:P=>{P.exports=function(P,f){return P[0]=Math.ceil(f[0]),P[1]=Math.ceil(f[1]),P[2]=Math.ceil(f[2]),P}},12061:P=>{P.exports=function(P){var f=new Float32Array(3);return f[0]=P[0],f[1]=P[1],f[2]=P[2],f}},12094:P=>{P.exports=function(P,f){return P[0]=f[0],P[1]=f[1],P[2]=f[2],P}},12052:P=>{P.exports=function(){var P=new Float32Array(3);return P[0]=0,P[1]=0,P[2]=0,P}},12245:P=>{P.exports=function(P,f,Y){var C=f[0],q=f[1],m=f[2],L=Y[0],o=Y[1],w=Y[2];return P[0]=q*w-m*o,P[1]=m*L-C*w,P[2]=C*o-q*L,P}},12190:(P,f,Y)=>{P.exports=Y(12184)},12184:P=>{P.exports=function(P,f){var Y=f[0]-P[0],C=f[1]-P[1],q=f[2]-P[2];return Math.sqrt(Y*Y+C*C+q*q)}},12145:(P,f,Y)=>{P.exports=Y(12137)},12137:P=>{P.exports=function(P,f,Y){return P[0]=f[0]/Y[0],P[1]=f[1]/Y[1],P[2]=f[2]/Y[2],P}},12087:P=>{P.exports=function(P,f){return P[0]*f[0]+P[1]*f[1]+P[2]*f[2]}},12046:P=>{P.exports=1e-6},12101:(P,f,Y)=>{P.exports=function(P,f){var Y=P[0],q=P[1],m=P[2],L=f[0],o=f[1],w=f[2];return Math.abs(Y-L)<=C*Math.max(1,Math.abs(Y),Math.abs(L))&&Math.abs(q-o)<=C*Math.max(1,Math.abs(q),Math.abs(o))&&Math.abs(m-w)<=C*Math.max(1,Math.abs(m),Math.abs(w))};var C=Y(12046)},12104:P=>{P.exports=function(P,f){return P[0]===f[0]&&P[1]===f[1]&&P[2]===f[2]}},12160:P=>{P.exports=function(P,f){return P[0]=Math.floor(f[0]),P[1]=Math.floor(f[1]),P[2]=Math.floor(f[2]),P}},12294:(P,f,Y)=>{P.exports=function(P,f,Y,q,m,L){var o,w;f||(f=3);Y||(Y=0);w=q?Math.min(q*f+Y,P.length):P.length;for(o=Y;o<w;o+=f)C[0]=P[o],C[1]=P[o+1],C[2]=P[o+2],m(C,C,L),P[o]=C[0],P[o+1]=C[1],P[o+2]=C[2];return P};var C=Y(12052)()},12069:P=>{P.exports=function(P,f,Y){var C=new Float32Array(3);return C[0]=P,C[1]=f,C[2]=Y,C}},12037:(P,f,Y)=>{P.exports={EPSILON:Y(12046),create:Y(12052),clone:Y(12061),angle:Y(12064),Po:Y(12069),j:Y(12094),set:Y(12098),equals:Y(12101),exactEquals:Y(12104),add:Y(12107),nf:Y(12111),sub:Y(12119),multiply:Y(12122),mul:Y(12131),divide:Y(12137),div:Y(12145),min:Y(12154),max:Y(12156),floor:Y(12160),ceil:Y(12168),round:Y(12170),scale:Y(12178),fo:Y(12180),distance:Y(12184),i:Y(12190),squaredDistance:Y(12194),sqrDist:Y(12200),length:Y(12207),len:Y(12215),squaredLength:Y(12223),Yo:Y(12232),negate:Y(12236),inverse:Y(12243),normalize:Y(12078),dot:Y(12087),cross:Y(12245),pL:Y(12249),random:Y(12251),transformMat4:Y(12260),transformMat3:Y(12263),transformQuat:Y(12268),Co:Y(12272),qo:Y(12280),mo:Y(12285),forEach:Y(12294)}},12243:P=>{P.exports=function(P,f){return P[0]=1/f[0],P[1]=1/f[1],P[2]=1/f[2],P}},12215:(P,f,Y)=>{P.exports=Y(12207)},12207:P=>{P.exports=function(P){var f=P[0],Y=P[1],C=P[2];return Math.sqrt(f*f+Y*Y+C*C)}},12249:P=>{P.exports=function(P,f,Y,C){var q=f[0],m=f[1],L=f[2];return P[0]=q+C*(Y[0]-q),P[1]=m+C*(Y[1]-m),P[2]=L+C*(Y[2]-L),P}},12156:P=>{P.exports=function(P,f,Y){return P[0]=Math.max(f[0],Y[0]),P[1]=Math.max(f[1],Y[1]),P[2]=Math.max(f[2],Y[2]),P}},12154:P=>{P.exports=function(P,f,Y){return P[0]=Math.min(f[0],Y[0]),P[1]=Math.min(f[1],Y[1]),P[2]=Math.min(f[2],Y[2]),P}},12131:(P,f,Y)=>{P.exports=Y(12122)},12122:P=>{P.exports=function(P,f,Y){return P[0]=f[0]*Y[0],P[1]=f[1]*Y[1],P[2]=f[2]*Y[2],P}},12236:P=>{P.exports=function(P,f){return P[0]=-f[0],P[1]=-f[1],P[2]=-f[2],P}},12078:P=>{P.exports=function(P,f){var Y=f[0],C=f[1],q=f[2],m=Y*Y+C*C+q*q;m>0&&(m=1/Math.sqrt(m),P[0]=f[0]*m,P[1]=f[1]*m,P[2]=f[2]*m);return P}},12251:P=>{P.exports=function(P,f){f=f||1;var Y=2*Math.random()*Math.PI,C=2*Math.random()-1,q=Math.sqrt(1-C*C)*f;return P[0]=Math.cos(Y)*q,P[1]=Math.sin(Y)*q,P[2]=C*f,P}},12272:P=>{P.exports=function(P,f,Y,C){var q=Y[1],m=Y[2],L=f[1]-q,o=f[2]-m,w=Math.sin(C),d=Math.cos(C);return P[0]=f[0],P[1]=q+L*d-o*w,P[2]=m+L*w+o*d,P}},12280:P=>{P.exports=function(P,f,Y,C){var q=Y[0],m=Y[2],L=f[0]-q,o=f[2]-m,w=Math.sin(C),d=Math.cos(C);return P[0]=q+o*w+L*d,P[1]=f[1],P[2]=m+o*d-L*w,P}},12285:P=>{P.exports=function(P,f,Y,C){var q=Y[0],m=Y[1],L=f[0]-q,o=f[1]-m,w=Math.sin(C),d=Math.cos(C);return P[0]=q+L*d-o*w,P[1]=m+L*w+o*d,P[2]=f[2],P}},12170:P=>{P.exports=function(P,f){return P[0]=Math.round(f[0]),P[1]=Math.round(f[1]),P[2]=Math.round(f[2]),P}},12178:P=>{P.exports=function(P,f,Y){return P[0]=f[0]*Y,P[1]=f[1]*Y,P[2]=f[2]*Y,P}},12180:P=>{P.exports=function(P,f,Y,C){return P[0]=f[0]+Y[0]*C,P[1]=f[1]+Y[1]*C,P[2]=f[2]+Y[2]*C,P}},12098:P=>{P.exports=function(P,f,Y,C){return P[0]=f,P[1]=Y,P[2]=C,P}},12200:(P,f,Y)=>{P.exports=Y(12194)},12232:(P,f,Y)=>{P.exports=Y(12223)},12194:P=>{P.exports=function(P,f){var Y=f[0]-P[0],C=f[1]-P[1],q=f[2]-P[2];return Y*Y+C*C+q*q}},12223:P=>{P.exports=function(P){var f=P[0],Y=P[1],C=P[2];return f*f+Y*Y+C*C}},12119:(P,f,Y)=>{P.exports=Y(12111)},12111:P=>{P.exports=function(P,f,Y){return P[0]=f[0]-Y[0],P[1]=f[1]-Y[1],P[2]=f[2]-Y[2],P}},12263:P=>{P.exports=function(P,f,Y){var C=f[0],q=f[1],m=f[2];return P[0]=C*Y[0]+q*Y[3]+m*Y[6],P[1]=C*Y[1]+q*Y[4]+m*Y[7],P[2]=C*Y[2]+q*Y[5]+m*Y[8],P}},12260:P=>{P.exports=function(P,f,Y){var C=f[0],q=f[1],m=f[2],L=Y[3]*C+Y[7]*q+Y[11]*m+Y[15];return L=L||1,P[0]=(Y[0]*C+Y[4]*q+Y[8]*m+Y[12])/L,P[1]=(Y[1]*C+Y[5]*q+Y[9]*m+Y[13])/L,P[2]=(Y[2]*C+Y[6]*q+Y[10]*m+Y[14])/L,P}},12268:P=>{P.exports=function(P,f,Y){var C=f[0],q=f[1],m=f[2],L=Y[0],o=Y[1],w=Y[2],d=Y[3],R=d*C+o*m-w*q,y=d*q+w*C-L*m,r=d*m+L*q-o*C,i=-L*C-o*q-w*m;return P[0]=R*d+i*-L+y*-w-r*-o,P[1]=y*d+i*-o+r*-L-R*-w,P[2]=r*d+i*-w+R*-o-y*-L,P}},13130:P=>{"use strict";P.exports=function(P){for(var f=new Array(P),Y=0;Y<P;++Y)f[Y]=Y;return f}},13187:P=>{P.exports=function(P){return null!=P&&null!=P.constructor&&"function"===typeof P.constructor.isBuffer&&P.constructor.isBuffer(P)}},13402:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>C});class C{constructor(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.ER=!1,this.tR=!1,this.ZR=30,this.AR=0,this.hR=!1,this.fullscreen=!1,this.zR=function(P){},this.BR=function(){},this.WR=function(){},this.rf=function(){},this.bR=function(P){},this.onFullscreenChanged=function(P){},d((()=>{!function(P,f){P._nowObject=performance||Date,P._lastTick=0,P._renderAccum=0,P._rt=0,P._frameCB=o.bind(null,P),requestAnimationFrame(P._frameCB),f>0&&(P._intervalCB=L.bind(null,P),P._interval=setInterval(P._intervalCB,Math.max(f,1e3/P.ZR/2)))}(this,f),function(P,f){if(!f)return;var Y=!1,C=!1;document.addEventListener("pointerlockchange",(C=>{Y=document.pointerLockElement===f,P.bR(Y)})),document.addEventListener("fullscreenchange",(Y=>{C=document.fullscreenElement===f,P.onFullscreenChanged(C)})),Object.defineProperty(P,"hR",{get:()=>Y,set:P=>{P&&!Y?w(f):Y&&!P&&function(P){P.exitPointerLock&&P.exitPointerLock()}(document)}}),Object.defineProperty(P,"fullscreen",{get:()=>C,set:P=>{P&&!C?f.requestFullscreen():C&&!P&&document.exitFullscreen()}}),f.addEventListener("click",(q=>{P.ER&&!Y&&w(f),P.tR&&!C&&f.requestFullscreen()}));var q=()=>P.rf();if(window.ResizeObserver){new ResizeObserver(q).observe(f)}else window.addEventListener("resize",q)}(this,P),this.WR()}))}}var q=3,m=20;function L(P){for(var f=1e3/P.ZR,Y=P._nowObject.now()+m,C=0;P._nowObject.now()>=P._lastTick+f&&P._nowObject.now()<Y&&++C<=q;)P.zR(f),P._lastTick+=f;var L=5*(f+5),o=P._nowObject.now();if(o-P._lastTick>L)for(;o>=P._lastTick+f;)P._lastTick+=f}function o(P){requestAnimationFrame(P._frameCB),L(P);var f=P._nowObject.now(),Y=f-P._rt;if(P._rt=f,P.AR>0){P._renderAccum+=Y;var C=1e3/P.AR;if(P._renderAccum<C)return;P._renderAccum=Math.min(P._renderAccum-C,C)}var q=1e3/P.ZR,m=(f-P._lastTick)/q;P.BR(Y,m,q)}function w(P){P.requestPointerLock&&P.requestPointerLock()}var d=P=>{if("loading"===document.readyState){var f=()=>{document.removeEventListener("readystatechange",f),P()};document.addEventListener("readystatechange",f)}else setTimeout(P,1)}},13123:(P,f,Y)=>{var C=Y(13130),q=Y(13132),m="undefined"!==typeof Float64Array;function L(P,f){return P[0]-f[0]}function o(){var P,f=this.stride,Y=new Array(f.length);for(P=0;P<Y.length;++P)Y[P]=[Math.abs(f[P]),P];Y.sort(L);var C=new Array(Y.length);for(P=0;P<C.length;++P)C[P]=Y[P][1];return C}function w(P,f){var Y=["View",f,"d",P].join("");f<0&&(Y="View_Nil"+P);var q="generic"===P;if(-1===f){var m="function "+Y+"(a){this.data=a;};var proto="+Y+".prototype;proto.dtype='"+P+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Y+"(a){return new "+Y+"(a);}";return new Function(m)()}if(0===f){m="function "+Y+"(a,d) {this.data = a;this.offset = d};var proto="+Y+".prototype;proto.dtype='"+P+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Y+"_copy() {return new "+Y+"(this.data,this.offset)};proto.pick=function "+Y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Y+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Y+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Y+"(a,b,c,d){return new "+Y+"(a,d)}";return new Function("TrivialArray",m)(d[P][0])}m=["'use strict'"];var L=C(f),w=L.map((function(P){return"i"+P})),R="this.offset+"+L.map((function(P){return"this.stride["+P+"]*i"+P})).join("+"),y=L.map((function(P){return"b"+P})).join(","),r=L.map((function(P){return"c"+P})).join(",");m.push("function "+Y+"(a,"+y+","+r+",d){this.data=a","this.shape=["+y+"]","this.stride=["+r+"]","this.offset=d|0}","var proto="+Y+".prototype","proto.dtype='"+P+"'","proto.dimension="+f),m.push("Object.defineProperty(proto,'size',{get:function "+Y+"_size(){return "+L.map((function(P){return"this.shape["+P+"]"})).join("*"),"}})"),1===f?m.push("proto.order=[0]"):(m.push("Object.defineProperty(proto,'order',{get:"),f<4?(m.push("function "+Y+"_order(){"),2===f?m.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===f&&m.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):m.push("ORDER})")),m.push("proto.set=function "+Y+"_set("+w.join(",")+",v){"),q?m.push("return this.data.set("+R+",v)}"):m.push("return this.data["+R+"]=v}"),m.push("proto.get=function "+Y+"_get("+w.join(",")+"){"),q?m.push("return this.data.get("+R+")}"):m.push("return this.data["+R+"]}"),m.push("proto.index=function "+Y+"_index(",w.join(),"){return "+R+"}"),m.push("proto.hi=function "+Y+"_hi("+w.join(",")+"){return new "+Y+"(this.data,"+L.map((function(P){return["(typeof i",P,"!=='number'||i",P,"<0)?this.shape[",P,"]:i",P,"|0"].join("")})).join(",")+","+L.map((function(P){return"this.stride["+P+"]"})).join(",")+",this.offset)}");var i=L.map((function(P){return"a"+P+"=this.shape["+P+"]"})),u=L.map((function(P){return"c"+P+"=this.stride["+P+"]"}));m.push("proto.lo=function "+Y+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+i.join(",")+","+u.join(","));for(var g=0;g<f;++g)m.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");m.push("return new "+Y+"(this.data,"+L.map((function(P){return"a"+P})).join(",")+","+L.map((function(P){return"c"+P})).join(",")+",b)}"),m.push("proto.step=function "+Y+"_step("+w.join(",")+"){var "+L.map((function(P){return"a"+P+"=this.shape["+P+"]"})).join(",")+","+L.map((function(P){return"b"+P+"=this.stride["+P+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<f;++g)m.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");m.push("return new "+Y+"(this.data,"+L.map((function(P){return"a"+P})).join(",")+","+L.map((function(P){return"b"+P})).join(",")+",c)}");var S=new Array(f),K=new Array(f);for(g=0;g<f;++g)S[g]="a[i"+g+"]",K[g]="b[i"+g+"]";m.push("proto.transpose=function "+Y+"_transpose("+w+"){"+w.map((function(P,f){return P+"=("+P+"===undefined?"+f+":"+P+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Y+"(this.data,"+S.join(",")+","+K.join(",")+",this.offset)}"),m.push("proto.pick=function "+Y+"_pick("+w+"){var a=[],b=[],c=this.offset");for(g=0;g<f;++g)m.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return m.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),m.push("return function construct_"+Y+"(data,shape,stride,offset){return new "+Y+"(data,"+L.map((function(P){return"shape["+P+"]"})).join(",")+","+L.map((function(P){return"stride["+P+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",m.join("\n"))(d[P],o)}var d={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};P.exports=function(P,f,Y,C){if(void 0===P)return(0,d.array[0])([]);"number"===typeof P&&(P=[P]),void 0===f&&(f=[P.length]);var L=f.length;if(void 0===Y){Y=new Array(L);for(var o=L-1,R=1;o>=0;--o)Y[o]=R,R*=f[o]}if(void 0===C){C=0;for(o=0;o<L;++o)Y[o]<0&&(C-=(f[o]-1)*Y[o])}for(var y=function(P){if(q(P))return"buffer";if(m)switch(Object.prototype.toString.call(P)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(P)?"array":"generic"}(P),r=d[y];r.length<=L+1;)r.push(w(y,r.length-1));return(0,r[L+1])(P,f,Y,C)}},13132:P=>{function f(P){return!!P.constructor&&"function"===typeof P.constructor.isBuffer&&P.constructor.isBuffer(P)}P.exports=function(P){return null!=P&&(f(P)||function(P){return"function"===typeof P.readFloatLE&&"function"===typeof P.slice&&f(P.slice(0,0))}(P)||!!P._isBuffer)}},13275:P=>{"use strict";var f=[],Y=[],C=[],q=[],m=[],L=[],o=[],w=[],d=[],R=[],y=[],r=[];P.exports=function(P,i,u,g,S,K){for(var M=o,V=d,O=R,n=r,l=0;l<3;l++)M[l]=+u[l],O[l]=+i.max[l],V[l]=+i.base[l];K||(K=1e-10);var v=function(P,o,d,R,r,i){var u=f,g=Y,S=C,K=q,M=m,V=L,O=w,n=Math.floor,l=0,v=0,c=0,T=0,U=0;if(D(),0===c)return 0;for(T=s();v<=c;){if(j(T)&&e())return l;T=s()}for(l+=c,U=0;U<3;U++)R[U]+=d[U],r[U]+=d[U];return l;function D(){if(v=0,0!==(c=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])))for(var P=0;P<3;P++){var f=d[P]>=0;K[P]=f?1:-1;var Y=f?r[P]:R[P];u[P]=f?R[P]:r[P],g[P]=a(Y,K[P]),S[P]=Q(u[P],K[P]),O[P]=d[P]/c,M[P]=Math.abs(1/O[P]);var C=f?g[P]+1-Y:Y-g[P];V[P]=M[P]<1/0?M[P]*C:1/0}}function j(f){for(var Y=K[0],C=0===f?g[0]:S[0],q=g[0]+Y,m=K[1],L=1===f?g[1]:S[1],o=g[1]+m,w=K[2],d=2===f?g[2]:S[2],R=g[2]+w,y=C;y!=q;y+=Y)for(var r=L;r!=o;r+=m)for(var i=d;i!=R;i+=w)if(P(y,r,i))return!0;return!1}function e(){l+=v;var P=K[T],f=v/c,Y=y;for(U=0;U<3;U++){var C=d[U]*f;R[U]+=C,r[U]+=C,Y[U]=d[U]-C}if(P>0?r[T]=Math.round(r[T]):R[T]=Math.round(R[T]),o(l,T,P,Y))return!0;for(U=0;U<3;U++)d[U]=Y[U];return D(),0===c}function s(){var P=V[0]<V[1]?V[0]<V[2]?0:2:V[1]<V[2]?1:2,f=V[P]-v;for(v=V[P],g[P]+=K[P],V[P]+=M[P],U=0;U<3;U++)u[U]+=f*O[U],S[U]=Q(u[U],K[U]);return P}function a(P,f){return n(P-f*i)}function Q(P,f){return n(P+f*i)}}(P,g,M,V,O,K);if(!S){for(l=0;l<3;l++)n[l]=u[l]>0?O[l]-i.max[l]:V[l]-i.base[l];i.translate(n)}return v}},13442:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>y});var C=Y(13273),q=Y(12037);class m{constructor(P,f,Y,m,L,o,w){this.Ud=new C(P.base,P.CR),this.TC=f,this.friction=Y,this.restitution=m,this.tL=L,this.ai=o,this.GL=!!w,this.YR=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Vu=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Bw=q.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=q.create(),this._impulses=q.create(),this._sleepFrameCount=10}loadFromCopy(P){q.j(this.Ud.base,P.Ud.base),q.j(this.Ud.CR,P.Ud.CR),q.j(this.Ud.max,P.Ud.max),this.Ud.mag=P.Ud.mag,this.TC=P.TC,this.friction=P.friction,this.restitution=P.restitution,this.tL=P.tL,this.ai=P.ai,this.GL=P.GL,this.YR=P.YR,this.fluidDrag=P.fluidDrag,this.Vu=P.Vu,this.preventFallOffEdge=P.preventFallOffEdge,this.rolledBackLastTick=P.rolledBackLastTick,q.j(this.Bw,P.Bw),q.j(this.resting,P.resting),this.inFluid=P.inFluid,this._ratioInFluid=P._ratioInFluid,q.j(this._forces,P._forces),q.j(this._impulses,P._impulses),this._sleepFrameCount=P._sleepFrameCount}setPosition(P){L(P),q.nf(P,P,this.Ud.base),this.Ud.translate(P),this.Ww()}gf(){return q.clone(this.Ud.base)}applyForce(P){L(P),q.add(this._forces,this._forces,P),this.Ww()}applyImpulse(P){L(P),q.add(this._impulses,this._impulses,P),this.Ww()}Ww(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var L=P=>{};var o=Y(13273),w=Y(12037),d=Y(13275);function R(){this.YR=.1,this.fluidDrag=.4,this.WL=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function y(P,f,Y){P=Object.assign(new R,P),this.gravity=P.gravity||[0,-10,0],this.YR=P.YR||.1,this.WL=P.WL||2,this.fluidDrag=P.fluidDrag||.4,this.minBounceImpulse=P.minBounceImpulse,this.bodies=[],this.Wr=P.Wr,this.testSolid=f,this.testFluid=Y}y.prototype.Zi=function(P,f,Y,C,q,L){P=P||new o([0,0,0],[1,1,1]),"undefined"==typeof f&&(f=1),"undefined"==typeof Y&&(Y=1),"undefined"==typeof C&&(C=0),"undefined"==typeof q&&(q=1);var w=new m(P,f,Y,C,q,L);return this.bodies.push(w),w},y.prototype.Ai=function(P){var f=this.bodies.indexOf(P);f<0||(this.bodies.splice(f,1),P.Ud=P.ai=null)};var r=w.create(),i=w.create(),u=w.create(),g=w.create(),S=w.create(),K=w.create(),M=w.create(),V=new o([0,0,0],[1,1,1]),O=new m(V,1,1,0,1,(()=>{}),!1);function n(P,f,Y){return f=Y,f*=1-(1-P.ratioInFluid)**2}y.prototype.wo=function(P){P/=1e3;var f=x(0,w.squaredLength(this.gravity));this.bodies.forEach((Y=>function(P,f,Y,C){w.j(S,f.resting),P.Wr&&O.loadFromCopy(f);if(f.TC<=0)return w.set(f.Bw,0,0,0),w.set(f._forces,0,0,0),void w.set(f._impulses,0,0,0);var q=C||0===f.tL;if(function(P,f,Y,C){if(f._sleepFrameCount>0)return!1;if(C)return!0;var q=!1,m=.5*Y*Y*f.tL;return w.scale(X,P.gravity,m),d(P.testSolid,f.Ud,X,(function(){return q=!0,!0}),!0),q}(P,f,Y,q))return;f._sleepFrameCount--,function(P,f){var Y=f.Ud,C=Math.floor(Y.base[0]),q=Math.floor(Y.base[2]),m=Math.floor(Y.base[1]),L=Math.floor(Y.max[1]);if(!P.testFluid(C,m,q))return f.inFluid=!1,void(f.ratioInFluid=0);var o=1,d=m+1;for(;d<=L&&P.testFluid(C,d,q);)o++,d++;var R=(m+o-Y.base[1])/Y.CR[1];R>1&&(R=1);var y=Y.CR[0]*Y.CR[1]*Y.CR[2]*R,r=v;w.scale(r,P.gravity,-P.WL*y*f.tL),f.applyForce(r),f.inFluid=!0,f.ratioInFluid=R}(P,f),Z(f._forces),Z(f._impulses),Z(f.Bw),Z(f.resting),w.scale(r,f._forces,1/f.TC),w.fo(r,r,P.gravity,f.tL),w.scale(i,f._impulses,1/f.TC),w.fo(i,i,r,Y),w.add(f.Bw,f.Bw,i),f.friction&&(c(P,0,f,i,Y),c(P,1,f,i,Y),c(P,2,f,i,Y));var m=f.fluidDrag>=0?f.fluidDrag:P.fluidDrag,L=f.YR>=0?f.YR:P.YR,o=L,R=L;f.inFluid&&(o=n(f,o,f.fluidDragHoriz>=0?f.fluidDragHoriz:m),R=n(f,R,f.fluidDragVert>=0?f.fluidDragVert:m));o=Math.max(1-o*Y/f.TC,0),R=Math.max(1-R*Y/f.TC,0),w.set(l,o,R,o),w.multiply(f.Bw,f.Bw,l),w.scale(u,f.Bw,Y),w.set(f._forces,0,0,0),w.set(f._impulses,0,0,0),f.GL&&k(D,f.Ud);w.j(K,u),w.set(M,0,0,0),f.preventFallOffEdge&&function(P,f,Y,C){if(!f.resting[1]||Y[1]>0)return;var q=J;k(q,f.Ud);for(var m=0;m<3;m+=2){w.set(Q,0,0,0),Q[m]=Y[m];var L=!0;(L=(L=(L=(L=L&&!I(P,q.base[0]+Q[0]+1e-5,q.base[1],q.base[2]+Q[2]+1e-5))&&!I(P,q.max[0]+Q[0]-1e-5,q.base[1],q.base[2]+Q[2]+1e-5))&&!I(P,q.base[0]+Q[0]+1e-5,q.base[1],q.max[2]+Q[2]-1e-5))&&!I(P,q.max[0]+Q[0]-1e-5,q.base[1],q.max[2]+Q[2]-1e-5))?(C[m]=Y[m]>0?1:-1,Y[m]=0):0===m&&(w.set(N,Y[0],0,0),U(P,q,N,C,f.slideOnCollision))}}(P,f,u,M);U(P,f.Ud,u,f.resting,f.slideOnCollision),f.GL&&function(P,f,Y,C){if(f.resting[1]>=0&&!f.inFluid)return;var q=0!==f.resting[0],m=0!==f.resting[2];if(!q&&!m)return;var L=Math.abs(C[0]/C[2]),o=4;if(!q&&L>o)return;if(!m&&L<1/o)return;w.add(e,Y.base,C);var R=P.testSolid;d(R,Y,C,(function(P,f,Y,C){if(1!==f)return!0;C[f]=0}));var y=Y.base[1],r=f.inFluid?1.951:1.001,i=Math.floor(y+r)-y;w.set(s,0,i,0);var u=!1;if(d(R,Y,s,(function(P,f,Y,C){return u=!0,!0})),u)return;w.nf(a,e,Y.base),a[1]=0,U(P,Y,a,j,!0);var g=x(Y.base[0],e[0]),S=x(Y.base[2],e[2]);if(q&&!g&&(!S||!m))return;if(m&&(!g||!q)&&!S)return;var K=!0;if(K=K&&!I(P,Y.base[0]+1e-5,Y.base[1],Y.base[2]+1e-5),K=K&&!I(P,Y.max[0]-1e-5,Y.base[1],Y.base[2]+1e-5),K=K&&!I(P,Y.base[0]+1e-5,Y.base[1],Y.max[2]-1e-5),K=K&&!I(P,Y.max[0]-1e-5,Y.base[1],Y.max[2]-1e-5),K)return;k(f.Ud,Y),f.resting[0]=j[0],f.resting[2]=j[2],f.Vu&&f.Vu()}(P,f,D,K);for(var y=0;y<3;++y)f.resting[y]=f.resting[y]||M[y],g[y]=0,f.resting[y]&&(S[y]||(g[y]=-f.Bw[y]),f.Bw[y]=0);var V=w.length(g);V>.001&&(w.scale(g,g,f.TC),f.ai&&f.ai(g),f.restitution>0&&V>P.minBounceImpulse&&(w.scale(g,g,f.restitution),f.applyImpulse(g)));var T=w.squaredLength(f.Bw);T>1e-5&&f.Ww();P.Wr&&P.Wr(f)?(f.loadFromCopy(O),f.rolledBackLastTick=!0):f.rolledBackLastTick=!1}(this,Y,P,f)))};var l=w.create([0,0,0]);var v=w.create();function c(P,f,Y,C,q){var m=Y.resting[f],L=C[f];if(!Y.alwaysApplyHorizFriction||1!==f){if(0===m)return;if(m*L<=0)return}w.j(T,Y.Bw),T[f]=0;var o=w.length(T);if(!x(o,0)){var d=Math.abs(Y.friction*P.gravity[f]*q),R=o>d?(o-d)/o:0;Y.Bw[(f+1)%3]*=R,Y.Bw[(f+2)%3]*=R}}var T=w.create();function U(P,f,Y,C,q){return w.set(C,0,0,0),d(P.testSolid,f,Y,(function(P,f,Y,m){C[f]=Y,m[f]=0,q||(m[0]=0,m[1]=0,m[2]=0)}))}var D=new o([],[]),j=w.create(),e=w.create(),s=w.create(),a=w.create();var Q=w.create(),J=new o([],[]),N=w.create();function I(P,f,Y,C){return P.testSolid(Math.floor(f),Math.floor(Y-1),Math.floor(C))}var X=w.create();function x(P,f){return Math.abs(P-f)<1e-5}function k(P,f){for(var Y=0;Y<3;Y++)P.base[Y]=f.base[Y],P.max[Y]=f.max[Y],P.CR[Y]=f.CR[Y]}var Z=function(P){}},11901:function(P,f){!function(P){"use strict";var f=function(P,Y){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,f){P.__proto__=f}||function(P,f){for(var Y in f)Object.prototype.hasOwnProperty.call(f,Y)&&(P[Y]=f[Y])},f(P,Y)};function Y(P,Y){if("function"!==typeof Y&&null!==Y)throw new TypeError("Class extends value "+String(Y)+" is not a constructor or null");function C(){this.constructor=P}f(P,Y),P.prototype=null===Y?Object.create(Y):(C.prototype=Y.prototype,new C)}function C(P,f,Y,C){var q,m=arguments.length,L=m<3?f:null===C?C=Object.getOwnPropertyDescriptor(f,Y):C;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)L=Reflect.decorate(P,f,Y,C);else for(var o=P.length-1;o>=0;o--)(q=P[o])&&(L=(m<3?q(L):m>3?q(f,Y,L):q(f,Y))||L);return m>3&&L&&Object.defineProperty(f,Y,L),L}function q(P,f,Y){if(Y||2===arguments.length)for(var C,q=0,m=f.length;q<m;q++)!C&&q in f||(C||(C=Array.prototype.slice.call(f,0,q)),C[q]=f[q]);return P.concat(C||Array.prototype.slice.call(f))}var m,L=255,o=213;P.OPERATION=void 0,(m=P.OPERATION||(P.OPERATION={}))[m.ADD=128]="ADD",m[m.REPLACE=0]="REPLACE",m[m.DELETE=64]="DELETE",m[m.DELETE_AND_ADD=192]="DELETE_AND_ADD",m[m.TOUCH=1]="TOUCH",m[m.CLEAR=10]="CLEAR";var w=function(){function f(P,f,Y){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=P,this.setParent(f,Y)}return f.prototype.setParent=function(P,f,Y){var C=this;if(this.indexes||(this.indexes=this.ref instanceof aP?this.ref._definition.indexes:{}),this.parent=P,this.parentIndex=Y,f)if(this.root=f,this.ref instanceof aP){var q=this.ref._definition;for(var m in q.schema){var L=this.ref[m];if(L&&L.$changes){var o=q.indexes[m];L.$changes.setParent(this.ref,f,o)}}}else"object"===typeof this.ref&&this.ref.forEach((function(P,f){if(P instanceof aP){var Y=P.$changes,q=C.ref.$changes.indexes[f];Y.setParent(C.ref,C.root,q)}}))},f.prototype.operation=function(P){this.changes.set(--this.currentCustomOperation,P)},f.prototype.change=function(f,Y){void 0===Y&&(Y=P.OPERATION.ADD);var C="number"===typeof f?f:this.indexes[f];this.assertValidIndex(C,f);var q=this.changes.get(C);q&&q.op!==P.OPERATION.DELETE&&q.op!==P.OPERATION.TOUCH||this.changes.set(C,{op:q&&q.op===P.OPERATION.DELETE?P.OPERATION.DELETE_AND_ADD:Y,index:C}),this.allChanges.add(C),this.changed=!0,this.touchParents()},f.prototype.touch=function(f){var Y="number"===typeof f?f:this.indexes[f];this.assertValidIndex(Y,f),this.changes.has(Y)||this.changes.set(Y,{op:P.OPERATION.TOUCH,index:Y}),this.allChanges.add(Y),this.touchParents()},f.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},f.prototype.getType=function(P){if(this.ref._definition)return(f=this.ref._definition).schema[f.fieldsByIndex[P]];var f,Y=(f=this.parent._definition).schema[f.fieldsByIndex[this.parentIndex]];return Object.values(Y)[0]},f.prototype.getChildrenFilter=function(){var P=this.parent._definition.childFilters;return P&&P[this.parentIndex]},f.prototype.getValue=function(P){return this.ref.getByIndex(P)},f.prototype.delete=function(f){var Y="number"===typeof f?f:this.indexes[f];if(void 0!==Y){var C=this.getValue(Y);this.changes.set(Y,{op:P.OPERATION.DELETE,index:Y}),this.allChanges.delete(Y),delete this.caches[Y],C&&C.$changes&&(C.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(f," (").concat(Y,")"))},f.prototype.discard=function(f,Y){var C=this;void 0===f&&(f=!1),void 0===Y&&(Y=!1),this.ref instanceof aP||this.changes.forEach((function(f){if(f.op===P.OPERATION.DELETE){var Y=C.ref.getIndex(f.index);delete C.indexes[Y]}})),this.changes.clear(),this.changed=f,Y&&this.allChanges.clear(),this.currentCustomOperation=0},f.prototype.discardAll=function(){var P=this;this.changes.forEach((function(f){var Y=P.getValue(f.index);Y&&Y.$changes&&Y.$changes.discardAll()})),this.discard()},f.prototype.cache=function(P,f){this.caches[P]=f},f.prototype.clone=function(){return new f(this.ref,this.parent,this.root)},f.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},f.prototype.assertValidIndex=function(P,f){if(void 0===P)throw new Error('ChangeTree: missing index for field "'.concat(f,'"'))},f}();function d(P,f,Y,C){return P[f]||(P[f]=[]),P[f].push(Y),null===C||void 0===C||C.forEach((function(P,f){return Y(P,f)})),function(){return y(P[f],P[f].indexOf(Y))}}function R(f){var Y=this,C="string"!==typeof this.$changes.getType();this.$items.forEach((function(q,m){f.push({refId:Y.$changes.refId,op:P.OPERATION.DELETE,field:m,value:void 0,previousValue:q}),C&&Y.$changes.root.removeRef(q.$changes.refId)}))}function y(P,f){if(-1===f||f>=P.length)return!1;for(var Y=P.length-1,C=f;C<Y;C++)P[C]=P[C+1];return P.length=Y,!0}var r=function(P,f){var Y=P.toString(),C=f.toString();return Y<C?-1:Y>C?1:0};function i(P){return P.$proxy=!0,P=new Proxy(P,{get:function(P,f){return"symbol"===typeof f||isNaN(f)?P[f]:P.at(f)},set:function(P,f,Y){if("symbol"===typeof f||isNaN(f))P[f]=Y;else{var C=Array.from(P.$items.keys()),q=parseInt(C[f]||f);void 0===Y||null===Y?P.deleteAt(q):P.setAt(q,Y)}return!0},deleteProperty:function(P,f){return"number"===typeof f?P.deleteAt(f):delete P[f],!0}})}var u=function(){function f(){for(var P=[],f=0;f<arguments.length;f++)P[f]=arguments[f];this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,P)}return f.prototype.co=function(f,Y){return void 0===Y&&(Y=!0),d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,f,Y?this.$items:void 0)},f.prototype.Cf=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,f)},f.is=function(P){return Array.isArray(P)||void 0!==P.array},Object.defineProperty(f.prototype,"length",{get:function(){return this.$items.size},set:function(P){0===P?this.clear():this.splice(P,this.length-P)},enumerable:!1,configurable:!0}),f.prototype.push=function(){for(var P,f=this,Y=[],C=0;C<arguments.length;C++)Y[C]=arguments[C];return Y.forEach((function(Y){P=f.$refId++,f.setAt(P,Y)})),P},f.prototype.pop=function(){var P=Array.from(this.$indexes.values()).pop();if(void 0!==P){this.$changes.delete(P),this.$indexes.delete(P);var f=this.$items.get(P);return this.$items.delete(P),f}},f.prototype.at=function(P){var f=Array.from(this.$items.keys())[P];return this.$items.get(f)},f.prototype.setAt=function(f,Y){var C,q;if(void 0!==Y&&null!==Y){if(this.$items.get(f)!==Y){void 0!==Y.$changes&&Y.$changes.setParent(this,this.$changes.root,f);var m=null!==(q=null===(C=this.$changes.indexes[f])||void 0===C?void 0:C.op)&&void 0!==q?q:P.OPERATION.ADD;this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,Y),this.$changes.change(f,m)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},f.prototype.deleteAt=function(P){var f=Array.from(this.$items.keys())[P];return void 0!==f&&this.$deleteAt(f)},f.prototype.$deleteAt=function(P){return this.$changes.delete(P),this.$indexes.delete(P),this.$items.delete(P)},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&R.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.concat=function(){for(var P,Y=[],C=0;C<arguments.length;C++)Y[C]=arguments[C];return new(f.bind.apply(f,q([void 0],(P=Array.from(this.$items.values())).concat.apply(P,Y),!1)))},f.prototype.join=function(P){return Array.from(this.$items.values()).join(P)},f.prototype.reverse=function(){var P=this,f=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Y,C){P.setAt(f[C],Y)})),this},f.prototype.shift=function(){var P=Array.from(this.$items.keys()).shift();if(void 0!==P){var f=this.$items.get(P);return this.$deleteAt(P),f}},f.prototype.slice=function(P,Y){var C=new f;return C.push.apply(C,Array.from(this.$items.values()).slice(P,Y)),C},f.prototype.sort=function(P){var f=this;void 0===P&&(P=r);var Y=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(P).forEach((function(P,C){f.setAt(Y[C],P)})),this},f.prototype.splice=function(P,f){void 0===f&&(f=this.length-P);for(var Y=Array.from(this.$items.keys()),C=[],q=P;q<P+f;q++)C.push(this.$items.get(Y[q])),this.$deleteAt(Y[q]);return C},f.prototype.unshift=function(){for(var P=this,f=[],Y=0;Y<arguments.length;Y++)f[Y]=arguments[Y];var C=this.length,q=f.length,m=Array.from(this.$items.values());return f.forEach((function(f,Y){P.setAt(Y,f)})),m.forEach((function(f,Y){P.setAt(q+Y,f)})),C+q},f.prototype.indexOf=function(P,f){return Array.from(this.$items.values()).indexOf(P,f)},f.prototype.lastIndexOf=function(P,f){return void 0===f&&(f=this.length-1),Array.from(this.$items.values()).lastIndexOf(P,f)},f.prototype.every=function(P,f){return Array.from(this.$items.values()).every(P,f)},f.prototype.some=function(P,f){return Array.from(this.$items.values()).some(P,f)},f.prototype.forEach=function(P,f){Array.from(this.$items.values()).forEach(P,f)},f.prototype.map=function(P,f){return Array.from(this.$items.values()).map(P,f)},f.prototype.filter=function(P,f){return Array.from(this.$items.values()).filter(P,f)},f.prototype.reduce=function(P,f){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},f.prototype.reduceRight=function(P,f){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},f.prototype.find=function(P,f){return Array.from(this.$items.values()).find(P,f)},f.prototype.findIndex=function(P,f){return Array.from(this.$items.values()).findIndex(P,f)},f.prototype.fill=function(P,f,Y){throw new Error("ArraySchema#fill() not implemented")},f.prototype.copyWithin=function(P,f,Y){throw new Error("ArraySchema#copyWithin() not implemented")},f.prototype.toString=function(){return this.$items.toString()},f.prototype.toLocaleString=function(){return this.$items.toLocaleString()},f.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(f,Symbol.species,{get:function(){return f},enumerable:!1,configurable:!0}),f.prototype.entries=function(){return this.$items.entries()},f.prototype.keys=function(){return this.$items.keys()},f.prototype.values=function(){return this.$items.values()},f.prototype.includes=function(P,f){return Array.from(this.$items.values()).includes(P,f)},f.prototype.flatMap=function(P,f){throw new Error("ArraySchema#flatMap() is not supported.")},f.prototype.flat=function(P){throw new Error("ArraySchema#flat() is not supported.")},f.prototype.findLast=function(){var P=Array.from(this.$items.values());return P.findLast.apply(P,arguments)},f.prototype.findLastIndex=function(){var P=Array.from(this.$items.values());return P.findLastIndex.apply(P,arguments)},f.prototype.setIndex=function(P,f){this.$indexes.set(P,f)},f.prototype.getIndex=function(P){return this.$indexes.get(P)},f.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},f.prototype.deleteByIndex=function(P){var f=this.$indexes.get(P);this.$items.delete(f),this.$indexes.delete(P)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){return this.toArray().map((function(P){return"function"===typeof P.toJSON?P.toJSON():P}))},f.prototype.clone=function(P){return P?new(f.bind.apply(f,q([void 0],Array.from(this.$items.values()),!1))):new(f.bind.apply(f,q([void 0],this.map((function(P){return P.$changes?P.clone():P})),!1)))},f}();function g(P){return P.$proxy=!0,P=new Proxy(P,{get:function(P,f){return"symbol"!==typeof f&&"undefined"===typeof P[f]?P.get(f):P[f]},set:function(P,f,Y){return"symbol"!==typeof f&&-1===f.indexOf("$")&&"co"!==f&&"Cf"!==f&&"onChange"!==f?P.set(f,Y):P[f]=Y,!0},deleteProperty:function(P,f){return P.delete(f),!0}})}var S=function(){function f(P){var Y=this;if(this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,P)if(P instanceof Map||P instanceof f)P.forEach((function(P,f){return Y.set(f,P)}));else for(var C in P)this.set(C,P[C])}return f.prototype.co=function(f,Y){return void 0===Y&&(Y=!0),d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,f,Y?this.$items:void 0)},f.prototype.Cf=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,f)},f.is=function(P){return void 0!==P.map},f.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(f.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(f,Symbol.species,{get:function(){return f},enumerable:!1,configurable:!0}),f.prototype.set=function(f,Y){if(void 0===Y||null===Y)throw new Error("MapSchema#set('".concat(f,"', ").concat(Y,"): trying to set ").concat(Y," value on '").concat(f,"'."));f=f.toString();var C="undefined"!==typeof this.$changes.indexes[f],q=C?this.$changes.indexes[f]:this.$refId++,m=C?P.OPERATION.REPLACE:P.OPERATION.ADD,L=void 0!==Y.$changes;if(L&&Y.$changes.setParent(this,this.$changes.root,q),C){if(!L&&this.$items.get(f)===Y)return;L&&this.$items.get(f)!==Y&&(m=P.OPERATION.ADD)}else this.$changes.indexes[f]=q,this.$indexes.set(q,f);return this.$items.set(f,Y),this.$changes.change(f,m),this},f.prototype.get=function(P){return this.$items.get(P)},f.prototype.delete=function(P){return this.$changes.delete(P),this.$items.delete(P)},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&R.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(P){return this.$items.has(P)},f.prototype.forEach=function(P){this.$items.forEach(P)},f.prototype.entries=function(){return this.$items.entries()},f.prototype.keys=function(){return this.$items.keys()},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(P,f){this.$indexes.set(P,f)},f.prototype.getIndex=function(P){return this.$indexes.get(P)},f.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},f.prototype.deleteByIndex=function(P){var f=this.$indexes.get(P);this.$items.delete(f),this.$indexes.delete(P)},f.prototype.toJSON=function(){var P={};return this.forEach((function(f,Y){P[Y]="function"===typeof f.toJSON?f.toJSON():f})),P},f.prototype.clone=function(P){var Y;return P?Y=Object.assign(new f,this):(Y=new f,this.forEach((function(P,f){P.$changes?Y.set(f,P.clone()):Y.set(f,P)}))),Y},f}(),K={};function M(P,f){K[P]=f}function V(P){return K[P]}var O=function(){function P(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return P.create=function(f){var Y=new P;return Y.schema=Object.assign({},f&&f.schema||{}),Y.indexes=Object.assign({},f&&f.indexes||{}),Y.fieldsByIndex=Object.assign({},f&&f.fieldsByIndex||{}),Y.descriptors=Object.assign({},f&&f.descriptors||{}),Y.deprecated=Object.assign({},f&&f.deprecated||{}),Y},P.prototype.addField=function(P,f){var Y=this.getNextFieldIndex();this.fieldsByIndex[Y]=P,this.indexes[P]=Y,this.schema[P]=Array.isArray(f)?{array:f[0]}:f},P.prototype.hasField=function(P){return void 0!==this.indexes[P]},P.prototype.addFilter=function(P,f){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[P]]=f,this.indexesWithFilters.push(this.indexes[P]),!0},P.prototype.addChildrenFilter=function(P,f){var Y=this.indexes[P],C=this.schema[P];if(V(Object.keys(C)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Y]=f,!0;console.warn("@filterChildren: field '".concat(P,"' can't have children. Ignoring filter."))},P.prototype.getChildrenFilter=function(P){return this.childFilters&&this.childFilters[this.indexes[P]]},P.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},P}();function n(P){return P._context&&P._context.useFilters}var l=function(){function P(){this.types={},this.schemas=new Map,this.useFilters=!1}return P.prototype.has=function(P){return this.schemas.has(P)},P.prototype.get=function(P){return this.types[P]},P.prototype.add=function(P,f){void 0===f&&(f=this.schemas.size),P._definition=O.create(P._definition),P._typeid=f,this.types[f]=P,this.schemas.set(P,f)},P.create=function(f){return void 0===f&&(f={}),function(Y){return f.context||(f.context=new P),c(Y,f)}},P}(),v=new l;function c(P,f){return void 0===f&&(f={}),function(Y,C){var m=f.context||v,L=Y.constructor;if(L._context=m,!P)throw new Error("".concat(L.name,': @type() reference provided for "').concat(C,"\" is undefined. Make sure you don't have any circular dependencies."));m.has(L)||m.add(L);var o=L._definition;if(o.addField(C,P),o.descriptors[C]){if(o.deprecated[C])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(C,"' definition on '").concat(L.name,"'.\nCheck @type() annotation"))}catch(K){var w=K.stack.split("\n")[4].trim();throw new Error("".concat(K.message," ").concat(w))}}var d=u.is(P),R=!d&&S.is(P);if("string"!==typeof P&&!aP.is(P)){var y=Object.values(P)[0];"string"===typeof y||m.has(y)||m.add(y)}if(f.manual)o.descriptors[C]={enumerable:!0,configurable:!0,writable:!0};else{var r="_".concat(C);o.descriptors[r]={enumerable:!1,configurable:!1,writable:!0},o.descriptors[C]={get:function(){return this[r]},set:function(P){P!==this[r]&&(void 0!==P&&null!==P?(!d||P instanceof u||(P=new(u.bind.apply(u,q([void 0],P,!1)))),!R||P instanceof S||(P=new S(P)),void 0===P.$proxy&&(R?P=g(P):d&&(P=i(P))),this.$changes.change(C),P.$changes&&P.$changes.setParent(this,this.$changes.root,this._definition.indexes[C])):this[r]&&this.$changes.delete(C),this[r]=P)},enumerable:!0,configurable:!0}}}}function T(P){return function(f,Y){var C=f.constructor;C._definition.addFilter(Y,P)&&(C._context.useFilters=!0)}}function U(P){return function(f,Y){var C=f.constructor;C._definition.addChildrenFilter(Y,P)&&(C._context.useFilters=!0)}}function D(P){return void 0===P&&(P=!0),function(f,Y){var C=f.constructor._definition;C.deprecated[Y]=!0,P&&(C.descriptors[Y]={get:function(){throw new Error("".concat(Y," is deprecated."))},set:function(P){},enumerable:!1,configurable:!0})}}function j(P,f,Y){for(var C in void 0===Y&&(Y={}),Y.context||(Y.context=P._context||Y.context||v),f)c(f[C],Y)(P.prototype,C);return P}function e(P){for(var f=0,Y=0,C=0,q=P.length;C<q;C++)(f=P.charCodeAt(C))<128?Y+=1:f<2048?Y+=2:f<55296||f>=57344?Y+=3:(C++,Y+=4);return Y}function s(P,f,Y){for(var C=0,q=0,m=Y.length;q<m;q++)(C=Y.charCodeAt(q))<128?P[f++]=C:C<2048?(P[f++]=192|C>>6,P[f++]=128|63&C):C<55296||C>=57344?(P[f++]=224|C>>12,P[f++]=128|C>>6&63,P[f++]=128|63&C):(q++,C=65536+((1023&C)<<10|1023&Y.charCodeAt(q)),P[f++]=240|C>>18,P[f++]=128|C>>12&63,P[f++]=128|C>>6&63,P[f++]=128|63&C)}function a(P,f){P.push(255&f)}function Q(P,f){P.push(255&f)}function J(P,f){P.push(255&f),P.push(f>>8&255)}function N(P,f){P.push(255&f),P.push(f>>8&255)}function I(P,f){P.push(255&f),P.push(f>>8&255),P.push(f>>16&255),P.push(f>>24&255)}function X(P,f){var Y=f>>24,C=f>>16,q=f>>8,m=f;P.push(255&m),P.push(255&q),P.push(255&C),P.push(255&Y)}function x(P,f){var Y=Math.floor(f/Math.pow(2,32));X(P,f>>>0),X(P,Y)}function k(P,f){var Y=f/Math.pow(2,32)|0;X(P,f>>>0),X(P,Y)}function Z(P,f){z(P,f)}function A(P,f){B(P,f)}var E=new Int32Array(2),t=new Float32Array(E.buffer),G=new Float64Array(E.buffer);function z(P,f){t[0]=f,I(P,E[0])}function B(P,f){G[0]=f,I(P,E[0]),I(P,E[1])}function b(P,f){return Q(P,f?1:0)}function H(P,f){f||(f="");var Y=e(f),C=0;if(Y<32)P.push(160|Y),C=1;else if(Y<256)P.push(217),Q(P,Y),C=2;else if(Y<65536)P.push(218),N(P,Y),C=3;else{if(!(Y<4294967296))throw new Error("String too long");P.push(219),X(P,Y),C=5}return s(P,P.length,f),C+Y}function W(P,f){return isNaN(f)?W(P,0):isFinite(f)?f!==(0|f)?(P.push(203),B(P,f),9):f>=0?f<128?(Q(P,f),1):f<256?(P.push(204),Q(P,f),2):f<65536?(P.push(205),N(P,f),3):f<4294967296?(P.push(206),X(P,f),5):(P.push(207),k(P,f),9):f>=-32?(P.push(224|f+32),1):f>=-128?(P.push(208),a(P,f),2):f>=-32768?(P.push(209),J(P,f),3):f>=-2147483648?(P.push(210),I(P,f),5):(P.push(211),x(P,f),9):W(P,f>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var p=Object.freeze({__proto__:null,utf8Write:s,int8:a,uint8:Q,int16:J,uint16:N,int32:I,uint32:X,int64:x,uint64:k,float32:Z,float64:A,writeFloat32:z,writeFloat64:B,boolean:b,string:H,number:W});function h(P,f,Y){for(var C="",q=0,m=f,L=f+Y;m<L;m++){var o=P[m];0!==(128&o)?192!==(224&o)?224!==(240&o)?240!==(248&o)?console.error("Invalid byte "+o.toString(16)):(q=(7&o)<<18|(63&P[++m])<<12|(63&P[++m])<<6|63&P[++m])>=65536?(q-=65536,C+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):C+=String.fromCharCode(q):C+=String.fromCharCode((15&o)<<12|(63&P[++m])<<6|63&P[++m]):C+=String.fromCharCode((31&o)<<6|63&P[++m]):C+=String.fromCharCode(o)}return C}function F(P,f){return PP(P,f)<<24>>24}function PP(P,f){return P[f.offset++]}function fP(P,f){return YP(P,f)<<16>>16}function YP(P,f){return P[f.offset++]|P[f.offset++]<<8}function CP(P,f){return P[f.offset++]|P[f.offset++]<<8|P[f.offset++]<<16|P[f.offset++]<<24}function qP(P,f){return CP(P,f)>>>0}function mP(P,f){return rP(P,f)}function LP(P,f){return iP(P,f)}function oP(P,f){var Y=qP(P,f);return CP(P,f)*Math.pow(2,32)+Y}function wP(P,f){var Y=qP(P,f);return qP(P,f)*Math.pow(2,32)+Y}var dP=new Int32Array(2),RP=new Float32Array(dP.buffer),yP=new Float64Array(dP.buffer);function rP(P,f){return dP[0]=CP(P,f),RP[0]}function iP(P,f){return dP[0]=CP(P,f),dP[1]=CP(P,f),yP[0]}function uP(P,f){return PP(P,f)>0}function gP(P,f){var Y,C=P[f.offset++];C<192?Y=31&C:217===C?Y=PP(P,f):218===C?Y=YP(P,f):219===C&&(Y=qP(P,f));var q=h(P,f.offset,Y);return f.offset+=Y,q}function SP(P,f){var Y=P[f.offset];return Y<192&&Y>160||217===Y||218===Y||219===Y}function KP(P,f){var Y=P[f.offset++];return Y<128?Y:202===Y?rP(P,f):203===Y?iP(P,f):204===Y?PP(P,f):205===Y?YP(P,f):206===Y?qP(P,f):207===Y?wP(P,f):208===Y?F(P,f):209===Y?fP(P,f):210===Y?CP(P,f):211===Y?oP(P,f):Y>223?-1*(255-Y+1):void 0}function MP(P,f){var Y=P[f.offset];return Y<128||Y>=202&&Y<=211}function VP(P,f){return P[f.offset]<160}function OP(P,f){return P[f.offset-1]===L&&(P[f.offset]<128||P[f.offset]>=202&&P[f.offset]<=211)}var nP=Object.freeze({__proto__:null,int8:F,uint8:PP,int16:fP,uint16:YP,int32:CP,uint32:qP,float32:mP,float64:LP,int64:oP,uint64:wP,readFloat32:rP,readFloat64:iP,boolean:uP,string:gP,stringCheck:SP,number:KP,numberCheck:MP,arrayCheck:VP,switchStructureCheck:OP}),lP=function(){function f(P){var f=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,P&&P.forEach((function(P){return f.add(P)}))}return f.prototype.co=function(f,Y){return void 0===Y&&(Y=!0),d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,f,Y?this.$items:void 0)},f.prototype.Cf=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,f)},f.is=function(P){return void 0!==P.collection},f.prototype.add=function(P){var f=this.$refId++;return void 0!==P.$changes&&P.$changes.setParent(this,this.$changes.root,f),this.$changes.indexes[f]=f,this.$indexes.set(f,f),this.$items.set(f,P),this.$changes.change(f),f},f.prototype.at=function(P){var f=Array.from(this.$items.keys())[P];return this.$items.get(f)},f.prototype.entries=function(){return this.$items.entries()},f.prototype.delete=function(P){for(var f,Y,C=this.$items.entries();(Y=C.next())&&!Y.done;)if(P===Y.value[1]){f=Y.value[0];break}return void 0!==f&&(this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f))},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&R.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(P){return Array.from(this.$items.values()).some((function(f){return f===P}))},f.prototype.forEach=function(P){var f=this;this.$items.forEach((function(Y,C,q){return P(Y,C,f)}))},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(P,f){this.$indexes.set(P,f)},f.prototype.getIndex=function(P){return this.$indexes.get(P)},f.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},f.prototype.deleteByIndex=function(P){var f=this.$indexes.get(P);this.$items.delete(f),this.$indexes.delete(P)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){var P=[];return this.forEach((function(f,Y){P.push("function"===typeof f.toJSON?f.toJSON():f)})),P},f.prototype.clone=function(P){var Y;return P?Y=Object.assign(new f,this):(Y=new f,this.forEach((function(P){P.$changes?Y.add(P.clone()):Y.add(P)}))),Y},f}(),vP=function(){function f(P){var f=this;this.$changes=new w(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,P&&P.forEach((function(P){return f.add(P)}))}return f.prototype.co=function(f,Y){return void 0===Y&&(Y=!0),d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.ADD,f,Y?this.$items:void 0)},f.prototype.Cf=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,f)},f.prototype.onChange=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,f)},f.is=function(P){return void 0!==P.set},f.prototype.add=function(f){var Y,C;if(this.has(f))return!1;var q=this.$refId++;void 0!==f.$changes&&f.$changes.setParent(this,this.$changes.root,q);var m=null!==(C=null===(Y=this.$changes.indexes[q])||void 0===Y?void 0:Y.op)&&void 0!==C?C:P.OPERATION.ADD;return this.$changes.indexes[q]=q,this.$indexes.set(q,q),this.$items.set(q,f),this.$changes.change(q,m),q},f.prototype.entries=function(){return this.$items.entries()},f.prototype.delete=function(P){for(var f,Y,C=this.$items.entries();(Y=C.next())&&!Y.done;)if(P===Y.value[1]){f=Y.value[0];break}return void 0!==f&&(this.$changes.delete(f),this.$indexes.delete(f),this.$items.delete(f))},f.prototype.clear=function(f){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),f&&R.call(this,f),this.$items.clear(),this.$changes.operation({index:0,op:P.OPERATION.CLEAR}),this.$changes.touchParents()},f.prototype.has=function(P){for(var f,Y=this.$items.values(),C=!1;(f=Y.next())&&!f.done;)if(P===f.value){C=!0;break}return C},f.prototype.forEach=function(P){var f=this;this.$items.forEach((function(Y,C,q){return P(Y,C,f)}))},f.prototype.values=function(){return this.$items.values()},Object.defineProperty(f.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),f.prototype.setIndex=function(P,f){this.$indexes.set(P,f)},f.prototype.getIndex=function(P){return this.$indexes.get(P)},f.prototype.getByIndex=function(P){return this.$items.get(this.$indexes.get(P))},f.prototype.deleteByIndex=function(P){var f=this.$indexes.get(P);this.$items.delete(f),this.$indexes.delete(P)},f.prototype.toArray=function(){return Array.from(this.$items.values())},f.prototype.toJSON=function(){var P=[];return this.forEach((function(f,Y){P.push("function"===typeof f.toJSON?f.toJSON():f)})),P},f.prototype.clone=function(P){var Y;return P?Y=Object.assign(new f,this):(Y=new f,this.forEach((function(P){P.$changes?Y.add(P.clone()):Y.add(P)}))),Y},f}(),cP=function(){function P(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return P.prototype.addRefId=function(P){this.refIds.has(P)||(this.refIds.add(P),this.containerIndexes.set(P,new Set))},P.get=function(f){return void 0===f.$filterState&&(f.$filterState=new P),f.$filterState},P}(),TP=function(){function P(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return P.prototype.getNextUniqueId=function(){return this.nextUniqueId++},P.prototype.addRef=function(P,f,Y){void 0===Y&&(Y=!0),this.refs.set(P,f),Y&&(this.refCounts[P]=(this.refCounts[P]||0)+1)},P.prototype.removeRef=function(P){this.refCounts[P]=this.refCounts[P]-1,this.deletedRefs.add(P)},P.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},P.prototype.garbageCollectDeletedRefs=function(){var P=this;this.deletedRefs.forEach((function(f){if(!(P.refCounts[f]>0)){var Y=P.refs.get(f);if(Y instanceof aP)for(var C in Y._definition.schema)"string"!==typeof Y._definition.schema[C]&&Y[C]&&Y[C].$changes&&P.removeRef(Y[C].$changes.refId);else{var q=Y.$changes.parent._definition,m=q.schema[q.fieldsByIndex[Y.$changes.parentIndex]];"function"===typeof Object.values(m)[0]&&Array.from(Y.values()).forEach((function(f){return P.removeRef(f.$changes.refId)}))}P.refs.delete(f),delete P.refCounts[f]}})),this.deletedRefs.clear()},P}(),UP=function(P){function f(){return null!==P&&P.apply(this,arguments)||this}return Y(f,P),f}(Error);function DP(P,f,Y,C){var q,m=!1;switch(f){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":q="number",isNaN(P)&&console.log('trying to encode "NaN" in '.concat(Y.constructor.name,"#").concat(C));break;case"string":q="string",m=!0;break;case"boolean":return}if(typeof P!==q&&(!m||m&&null!==P)){var L="'".concat(JSON.stringify(P),"'").concat(P&&P.constructor&&" (".concat(P.constructor.name,")")||"");throw new UP("a '".concat(q,"' was expected, but ").concat(L," was provided in ").concat(Y.constructor.name,"#").concat(C))}}function jP(P,f,Y,C){if(!(P instanceof f))throw new UP("a '".concat(f.name,"' was expected, but '").concat(P.constructor.name,"' was provided in ").concat(Y.constructor.name,"#").concat(C))}function eP(P,f,Y,C,q){DP(Y,P,C,q);var m=p[P];if(!m)throw new UP("a '".concat(P,"' was expected, but ").concat(Y," was provided in ").concat(C.constructor.name,"#").concat(q));m(f,Y)}function sP(P,f,Y){return nP[P](f,Y)}var aP=function(){function f(){for(var P=[],f=0;f<arguments.length;f++)P[f]=arguments[f];Object.defineProperties(this,{$changes:{value:new w(this,void 0,new TP),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Y=this._definition.descriptors;Y&&Object.defineProperties(this,Y),P[0]&&this.assign(P[0])}return f.onError=function(P){console.error(P)},f.is=function(P){return P._definition&&void 0!==P._definition.schema},f.prototype.onChange=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.REPLACE,f)},f.prototype.Cf=function(f){return d(this.$callbacks||(this.$callbacks=[]),P.OPERATION.DELETE,f)},f.prototype.assign=function(P){return Object.assign(this,P),this},Object.defineProperty(f.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),f.prototype.setDirty=function(P,f){this.$changes.change(P,f)},f.prototype.listen=function(P,f,Y){var C=this;return void 0===Y&&(Y=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[P]||(this.$callbacks[P]=[]),this.$callbacks[P].push(f),Y&&void 0!==this[P]&&f(this[P],void 0),function(){return y(C.$callbacks[P],C.$callbacks[P].indexOf(f))}},f.prototype.decode=function(Y,C,q){var m;void 0===C&&(C={offset:0}),void 0===q&&(q=this);var o=[],w=this.$changes.root,d=Y.length,R=0;for(w.refs.set(R,this);C.offset<d;){var y=Y[C.offset++];if(y!=L){var r=q.$changes,i=void 0!==q._definition,g=i?y>>6<<6:y;if(g!==P.OPERATION.CLEAR){var K=i?y%(g||255):KP(Y,C),M=i?q._definition.fieldsByIndex[K]:"",O=r.getType(K),n=void 0,l=void 0,v=void 0;if(i?l=q["_".concat(M)]:(l=q.getByIndex(K),(g&P.OPERATION.ADD)===P.OPERATION.ADD?(v=q instanceof S?gP(Y,C):K,q.setIndex(K,v)):v=q.getIndex(K)),(g&P.OPERATION.DELETE)===P.OPERATION.DELETE&&(g!==P.OPERATION.DELETE_AND_ADD&&q.deleteByIndex(K),l&&l.$changes&&w.removeRef(l.$changes.refId),n=null),void 0!==M){if(g===P.OPERATION.DELETE);else if(f.is(O)){var c=KP(Y,C);if(n=w.refs.get(c),g!==P.OPERATION.REPLACE){var T=this.getSchemaType(Y,C,O);n||((n=this.createTypeInstance(T)).$changes.refId=c,l&&(n.$callbacks=l.$callbacks,l.$changes.refId&&c!==l.$changes.refId&&w.removeRef(l.$changes.refId))),w.addRef(c,n,n!==l)}}else if("string"===typeof O)n=sP(O,Y,C);else{var U=V(Object.keys(O)[0]),D=KP(Y,C),j=w.refs.has(D)?l||w.refs.get(D):new U.constructor;if((n=j.clone(!0)).$changes.refId=D,l&&(n.$callbacks=l.$callbacks,l.$changes.refId&&D!==l.$changes.refId)){w.removeRef(l.$changes.refId);for(var e=l.entries(),s=void 0;(s=e.next())&&!s.done;){var a=(m=s.value)[0],Q=m[1];o.push({refId:D,op:P.OPERATION.DELETE,field:a,value:void 0,previousValue:Q})}}w.addRef(D,n,j!==l)}if(null!==n&&void 0!==n)if(n.$changes&&n.$changes.setParent(r.ref,r.root,K),q instanceof f)q[M]=n;else if(q instanceof S)a=v,q.$items.set(a,n),q.$changes.allChanges.add(K);else if(q instanceof u)q.setAt(K,n);else if(q instanceof lP){var J=q.add(n);q.setIndex(K,J)}else q instanceof vP&&!1!==(J=q.add(n))&&q.setIndex(K,J);l!==n&&o.push({refId:R,op:g,field:M,dynamicIndex:v,value:n,previousValue:l})}else{console.warn("@colyseus/schema: definition mismatch");for(var N={offset:C.offset};C.offset<d&&(!OP(Y,C)||(N.offset=C.offset+1,!w.refs.has(KP(Y,N))));)C.offset++}}else q.clear(o)}else{R=KP(Y,C);var I=w.refs.get(R);if(!I)throw new Error('"refId" not found: '.concat(R));q=I}}return this._triggerChanges(o),w.garbageCollectDeletedRefs(),o},f.prototype.encode=function(Y,C,q){void 0===Y&&(Y=!1),void 0===C&&(C=[]),void 0===q&&(q=!1);for(var m=this.$changes,o=new WeakSet,w=[m],d=1,R=0;R<d;R++){var y=w[R],r=y.ref,i=r instanceof f;y.ensureRefId(),o.add(y),y!==m&&(y.changed||Y)&&(Q(C,L),W(C,y.refId));for(var u=Y?Array.from(y.allChanges):Array.from(y.changes.values()),g=0,K=u.length;g<K;g++){var M=Y?{op:P.OPERATION.ADD,index:u[g]}:u[g],O=M.index,n=i?r._definition.fieldsByIndex&&r._definition.fieldsByIndex[O]:O,l=C.length;if(M.op!==P.OPERATION.TOUCH)if(i)Q(C,O|M.op);else{if(Q(C,M.op),M.op===P.OPERATION.CLEAR)continue;W(C,O)}if(i||(M.op&P.OPERATION.ADD)!=P.OPERATION.ADD||r instanceof S&&H(C,y.ref.$indexes.get(O)),M.op!==P.OPERATION.DELETE){var v=y.getType(O),c=y.getValue(O);if(c&&c.$changes&&!o.has(c.$changes)&&(w.push(c.$changes),c.$changes.ensureRefId(),d++),M.op!==P.OPERATION.TOUCH){if(f.is(v))jP(c,v,r,n),W(C,c.$changes.refId),(M.op&P.OPERATION.ADD)===P.OPERATION.ADD&&this.tryEncodeTypeId(C,v,c.constructor);else if("string"===typeof v)eP(v,C,c,r,n);else{var T=V(Object.keys(v)[0]);jP(r["_".concat(n)],T.constructor,r,n),W(C,c.$changes.refId)}q&&y.cache(O,C.slice(l))}}}Y||q||y.discard()}return C},f.prototype.encodeAll=function(P){return this.encode(!0,[],P)},f.prototype.applyFilters=function(Y,C){var q,m;void 0===C&&(C=!1);for(var o=this,w=new Set,d=cP.get(Y),R=[this.$changes],y=1,r=[],i=function(i){var u=R[i];if(w.has(u.refId))return"continue";var g=u.ref,K=g instanceof f;Q(r,L),W(r,u.refId);var M=d.refIds.has(u),V=C||!M;d.addRefId(u);var O=d.containerIndexes.get(u),n=V?Array.from(u.allChanges):Array.from(u.changes.values());!C&&K&&g._definition.indexesWithFilters&&g._definition.indexesWithFilters.forEach((function(f){!O.has(f)&&u.allChanges.has(f)&&(V?n.push(f):n.push({op:P.OPERATION.ADD,index:f}))}));for(var l=0,v=n.length;l<v;l++){var c=V?{op:P.OPERATION.ADD,index:n[l]}:n[l];if(c.op!==P.OPERATION.CLEAR){var T=c.index;if(c.op!==P.OPERATION.DELETE){var U=u.getValue(T),D=u.getType(T);if(K){if((j=g._definition.filters&&g._definition.filters[T])&&!j.call(g,Y,U,o)){U&&U.$changes&&w.add(U.$changes.refId);continue}}else{var j,e=u.parent;if((j=u.getChildrenFilter())&&!j.call(e,Y,g.$indexes.get(T),U,o)){U&&U.$changes&&w.add(U.$changes.refId);continue}}if(U.$changes&&(R.push(U.$changes),y++),c.op!==P.OPERATION.TOUCH)if(c.op===P.OPERATION.ADD||K)r.push.apply(r,null!==(q=u.caches[T])&&void 0!==q?q:[]),O.add(T);else if(O.has(T))r.push.apply(r,null!==(m=u.caches[T])&&void 0!==m?m:[]);else{if(O.add(T),Q(r,P.OPERATION.ADD),W(r,T),g instanceof S){var s=u.ref.$indexes.get(T);H(r,s)}U.$changes?W(r,U.$changes.refId):p[D](r,U)}else U.$changes&&!K&&(Q(r,P.OPERATION.ADD),W(r,T),g instanceof S&&(s=u.ref.$indexes.get(T),H(r,s)),W(r,U.$changes.refId))}else K?Q(r,c.op|T):(Q(r,c.op),W(r,T))}else Q(r,c.op)}},u=0;u<y;u++)i(u);return r},f.prototype.clone=function(){var P,f=new this.constructor,Y=this._definition.schema;for(var C in Y)"object"===typeof this[C]&&"function"===typeof(null===(P=this[C])||void 0===P?void 0:P.clone)?f[C]=this[C].clone():f[C]=this[C];return f},f.prototype.toJSON=function(){var P=this._definition.schema,f=this._definition.deprecated,Y={};for(var C in P)f[C]||null===this[C]||"undefined"===typeof this[C]||(Y[C]="function"===typeof this[C].toJSON?this[C].toJSON():this["_".concat(C)]);return Y},f.prototype.discardAllChanges=function(){this.$changes.discardAll()},f.prototype.getByIndex=function(P){return this[this._definition.fieldsByIndex[P]]},f.prototype.deleteByIndex=function(P){this[this._definition.fieldsByIndex[P]]=void 0},f.prototype.tryEncodeTypeId=function(P,f,Y){f._typeid!==Y._typeid&&(Q(P,o),W(P,Y._typeid))},f.prototype.getSchemaType=function(P,f,Y){var C;return P[f.offset]===o&&(f.offset++,C=this.constructor._context.get(KP(P,f))),C||Y},f.prototype.createTypeInstance=function(P){var f=new P;return f.$changes.root=this.$changes.root,f},f.prototype._triggerChanges=function(Y){for(var C,q,m,L,o,w,d,R,y,r=new Set,i=this.$changes.root.refs,u=function(u){var g=Y[u],S=g.refId,K=i.get(S),M=K.$callbacks;if((g.op&P.OPERATION.DELETE)===P.OPERATION.DELETE&&g.previousValue instanceof f&&(null===(q=null===(C=g.previousValue.$callbacks)||void 0===C?void 0:C[P.OPERATION.DELETE])||void 0===q||q.forEach((function(P){return P()}))),!M)return"continue";if(K instanceof f){if(!r.has(S))try{null===(m=null===M||void 0===M?void 0:M[P.OPERATION.REPLACE])||void 0===m||m.forEach((function(P){return P()}))}catch(V){f.onError(V)}try{M.hasOwnProperty(g.field)&&(null===(L=M[g.field])||void 0===L||L.forEach((function(P){return P(g.value,g.previousValue)})))}catch(V){f.onError(V)}}else g.op===P.OPERATION.ADD&&void 0===g.previousValue?null===(o=M[P.OPERATION.ADD])||void 0===o||o.forEach((function(P){var f;return P(g.value,null!==(f=g.dynamicIndex)&&void 0!==f?f:g.field)})):g.op===P.OPERATION.DELETE?void 0!==g.previousValue&&(null===(w=M[P.OPERATION.DELETE])||void 0===w||w.forEach((function(P){var f;return P(g.previousValue,null!==(f=g.dynamicIndex)&&void 0!==f?f:g.field)}))):g.op===P.OPERATION.DELETE_AND_ADD&&(void 0!==g.previousValue&&(null===(d=M[P.OPERATION.DELETE])||void 0===d||d.forEach((function(P){var f;return P(g.previousValue,null!==(f=g.dynamicIndex)&&void 0!==f?f:g.field)}))),null===(R=M[P.OPERATION.ADD])||void 0===R||R.forEach((function(P){var f;return P(g.value,null!==(f=g.dynamicIndex)&&void 0!==f?f:g.field)}))),g.value!==g.previousValue&&(null===(y=M[P.OPERATION.REPLACE])||void 0===y||y.forEach((function(P){var f;return P(g.value,null!==(f=g.dynamicIndex)&&void 0!==f?f:g.field)})));r.add(S)},g=0;g<Y.length;g++)u(g)},f._definition=O.create(),f}();function QP(P){for(var f=[P.$changes],Y=1,C={},q=C,m=function(P){var Y=f[P];Y.changes.forEach((function(P){var f=Y.ref,C=P.index,m=f._definition?f._definition.fieldsByIndex[C]:f.$indexes.get(C);q[m]=Y.getValue(C)}))},L=0;L<Y;L++)m(L);return C}var JP={context:new l},NP=function(P){function f(){return null!==P&&P.apply(this,arguments)||this}return Y(f,P),C([c("string",JP)],f.prototype,"name",void 0),C([c("string",JP)],f.prototype,"type",void 0),C([c("number",JP)],f.prototype,"referencedType",void 0),f}(aP),IP=function(P){function f(){var f=null!==P&&P.apply(this,arguments)||this;return f.fields=new u,f}return Y(f,P),C([c("number",JP)],f.prototype,"id",void 0),C([c([NP],JP)],f.prototype,"fields",void 0),f}(aP),XP=function(P){function f(){var f=null!==P&&P.apply(this,arguments)||this;return f.types=new u,f}return Y(f,P),f.encode=function(P){var Y=P.constructor,C=new f;C.rootType=Y._typeid;var q=function(P,f){for(var Y in f){var q=new NP;q.name=Y;var m=void 0;if("string"===typeof f[Y])m=f[Y];else{var L=f[Y],o=void 0;aP.is(L)?(m="ref",o=f[Y]):"string"===typeof L[m=Object.keys(L)[0]]?m+=":"+L[m]:o=L[m],q.referencedType=o?o._typeid:-1}q.type=m,P.fields.push(q)}C.types.push(P)},m=Y._context.types;for(var L in m){var o=new IP;o.id=Number(L),q(o,m[L]._definition.schema)}return C.encodeAll()},f.decode=function(P,C){var q=new l,m=new f;m.decode(P,C);var L=m.types.reduce((function(P,f){var C=function(P){function f(){return null!==P&&P.apply(this,arguments)||this}return Y(f,P),f}(aP),m=f.id;return P[m]=C,q.add(C,m),P}),{});m.types.forEach((function(P){var f=L[P.id];P.fields.forEach((function(P){var Y;if(void 0!==P.referencedType){var C=P.type,m=L[P.referencedType];if(!m){var o=P.type.split(":");C=o[0],m=o[1]}"ref"===C?c(m,{context:q})(f.prototype,P.name):c(((Y={})[C]=m,Y),{context:q})(f.prototype,P.name)}else c(P.type,{context:q})(f.prototype,P.name)}))}));var o=L[m.rootType],w=new o;for(var d in o._definition.schema){var R=o._definition.schema[d];"string"!==typeof R&&(w[d]="function"===typeof R?new R:new(V(Object.keys(R)[0]).constructor))}return w},C([c([IP],JP)],f.prototype,"types",void 0),C([c("number",JP)],f.prototype,"rootType",void 0),f}(aP);M("map",{constructor:S}),M("array",{constructor:u}),M("set",{constructor:vP}),M("collection",{constructor:lP}),P.ArraySchema=u,P.CollectionSchema=lP,P.Context=l,P.MapSchema=S,P.Reflection=XP,P.ReflectionField=NP,P.ReflectionType=IP,P.Schema=aP,P.SchemaDefinition=O,P.SetSchema=vP,P.decode=nP,P.defineTypes=j,P.deprecated=D,P.dumpChanges=QP,P.encode=p,P.filter=T,P.filterChildren=U,P.hasFilter=n,P.registerType=M,P.type=c,Object.defineProperty(P,"__esModule",{value:!0})}(f)},13310:P=>{"use strict";P.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13301:(P,f,Y)=>{var C=Y(13310),q=Y(13317),m=Object.hasOwnProperty,L=Object.create(null);for(var o in C)m.call(C,o)&&(L[C[o]]=o);var w=P.exports={to:{},get:{}};function d(P,f,Y){return Math.min(Math.max(f,P),Y)}function R(P){var f=Math.round(P).toString(16).toUpperCase();return f.length<2?"0"+f:f}w.get=function(P){var f,Y;switch(P.substring(0,3).toLowerCase()){case"hsl":f=w.get.hsl(P),Y="hsl";break;case"hwb":f=w.get.hwb(P),Y="hwb";break;default:f=w.get.rgb(P),Y="rgb"}return f?{model:Y,value:f}:null},w.get.rgb=function(P){if(!P)return null;var f,Y,q,L=[0,0,0,1];if(f=P.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(q=f[2],f=f[1],Y=0;Y<3;Y++){var o=2*Y;L[Y]=parseInt(f.slice(o,o+2),16)}q&&(L[3]=parseInt(q,16)/255)}else if(f=P.match(/^#([a-f0-9]{3,4})$/i)){for(q=(f=f[1])[3],Y=0;Y<3;Y++)L[Y]=parseInt(f[Y]+f[Y],16);q&&(L[3]=parseInt(q+q,16)/255)}else if(f=P.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Y=0;Y<3;Y++)L[Y]=parseInt(f[Y+1],0);f[4]&&(f[5]?L[3]=.01*parseFloat(f[4]):L[3]=parseFloat(f[4]))}else{if(!(f=P.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(f=P.match(/^(\w+)$/))?"transparent"===f[1]?[0,0,0,0]:m.call(C,f[1])?((L=C[f[1]])[3]=1,L):null:null;for(Y=0;Y<3;Y++)L[Y]=Math.round(2.55*parseFloat(f[Y+1]));f[4]&&(f[5]?L[3]=.01*parseFloat(f[4]):L[3]=parseFloat(f[4]))}for(Y=0;Y<3;Y++)L[Y]=d(L[Y],0,255);return L[3]=d(L[3],0,1),L},w.get.hsl=function(P){if(!P)return null;var f=P.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(f){var Y=parseFloat(f[4]);return[(parseFloat(f[1])%360+360)%360,d(parseFloat(f[2]),0,100),d(parseFloat(f[3]),0,100),d(isNaN(Y)?1:Y,0,1)]}return null},w.get.hwb=function(P){if(!P)return null;var f=P.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(f){var Y=parseFloat(f[4]);return[(parseFloat(f[1])%360+360)%360,d(parseFloat(f[2]),0,100),d(parseFloat(f[3]),0,100),d(isNaN(Y)?1:Y,0,1)]}return null},w.to.hex=function(){var P=q(arguments);return"#"+R(P[0])+R(P[1])+R(P[2])+(P[3]<1?R(Math.round(255*P[3])):"")},w.to.rgb=function(){var P=q(arguments);return P.length<4||1===P[3]?"rgb("+Math.round(P[0])+", "+Math.round(P[1])+", "+Math.round(P[2])+")":"rgba("+Math.round(P[0])+", "+Math.round(P[1])+", "+Math.round(P[2])+", "+P[3]+")"},w.to.rgb.percent=function(){var P=q(arguments),f=Math.round(P[0]/255*100),Y=Math.round(P[1]/255*100),C=Math.round(P[2]/255*100);return P.length<4||1===P[3]?"rgb("+f+"%, "+Y+"%, "+C+"%)":"rgba("+f+"%, "+Y+"%, "+C+"%, "+P[3]+")"},w.to.hsl=function(){var P=q(arguments);return P.length<4||1===P[3]?"hsl("+P[0]+", "+P[1]+"%, "+P[2]+"%)":"hsla("+P[0]+", "+P[1]+"%, "+P[2]+"%, "+P[3]+")"},w.to.hwb=function(){var P=q(arguments),f="";return P.length>=4&&1!==P[3]&&(f=", "+P[3]),"hwb("+P[0]+", "+P[1]+"%, "+P[2]+"%"+f+")"},w.to.keyword=function(P){return L[P.slice(0,3)]}},13299:(P,f,Y)=>{const C=Y(13301),q=Y(13329),m=["keyword","gray","hex"],L={};for(const i of Object.keys(q))L[[...q[i].labels].sort().join("")]=i;const o={};function w(P,f){if(!(this instanceof w))return new w(P,f);if(f&&f in m&&(f=null),f&&!(f in q))throw new Error("Unknown model: "+f);let Y,d;if(null==P)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(P instanceof w)this.model=P.model,this.color=[...P.color],this.valpha=P.valpha;else if("string"===typeof P){const f=C.get(P);if(null===f)throw new Error("Unable to parse color from string: "+P);this.model=f.model,d=q[this.model].channels,this.color=f.value.slice(0,d),this.valpha="number"===typeof f.value[d]?f.value[d]:1}else if(P.length>0){this.model=f||"rgb",d=q[this.model].channels;const Y=Array.prototype.slice.call(P,0,d);this.color=r(Y,d),this.valpha="number"===typeof P[d]?P[d]:1}else if("number"===typeof P)this.model="rgb",this.color=[P>>16&255,P>>8&255,255&P],this.valpha=1;else{this.valpha=1;const f=Object.keys(P);"alpha"in P&&(f.splice(f.indexOf("alpha"),1),this.valpha="number"===typeof P.alpha?P.alpha:0);const C=f.sort().join("");if(!(C in L))throw new Error("Unable to parse color from object: "+JSON.stringify(P));this.model=L[C];const{labels:m}=q[this.model],o=[];for(Y=0;Y<m.length;Y++)o.push(P[m[Y]]);this.color=r(o)}if(o[this.model])for(d=q[this.model].channels,Y=0;Y<d;Y++){const P=o[this.model][Y];P&&(this.color[Y]=P(this.color[Y]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}w.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(P){let f=this.model in C.to?this:this.rgb();f=f.round("number"===typeof P?P:1);const Y=1===f.valpha?f.color:[...f.color,this.valpha];return C.to[f.model](Y)},percentString(P){const f=this.rgb().round("number"===typeof P?P:1),Y=1===f.valpha?f.color:[...f.color,this.valpha];return C.to.rgb.percent(Y)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const P={},{channels:f}=q[this.model],{labels:Y}=q[this.model];for(let C=0;C<f;C++)P[Y[C]]=this.color[C];return 1!==this.valpha&&(P.alpha=this.valpha),P},unitArray(){const P=this.rgb().color;return P[0]/=255,P[1]/=255,P[2]/=255,1!==this.valpha&&P.push(this.valpha),P},unitObject(){const P=this.rgb().object();return P.r/=255,P.g/=255,P.b/=255,1!==this.valpha&&(P.alpha=this.valpha),P},round(P){return P=Math.max(P||0,0),new w([...this.color.map(d(P)),this.valpha],this.model)},alpha(P){return void 0!==P?new w([...this.color,Math.max(0,Math.min(1,P))],this.model):this.valpha},red:R("rgb",0,y(255)),green:R("rgb",1,y(255)),blue:R("rgb",2,y(255)),hue:R(["hsl","hsv","hsl","hwb","hcg"],0,(P=>(P%360+360)%360)),saturationl:R("hsl",1,y(100)),lightness:R("hsl",2,y(100)),saturationv:R("hsv",1,y(100)),value:R("hsv",2,y(100)),chroma:R("hcg",1,y(100)),gray:R("hcg",2,y(100)),white:R("hwb",1,y(100)),wblack:R("hwb",2,y(100)),cyan:R("cmyk",0,y(100)),magenta:R("cmyk",1,y(100)),yellow:R("cmyk",2,y(100)),black:R("cmyk",3,y(100)),x:R("xyz",0,y(95.047)),y:R("xyz",1,y(100)),z:R("xyz",2,y(108.833)),l:R("lab",0,y(100)),a:R("lab",1),b:R("lab",2),keyword(P){return void 0!==P?new w(P):q[this.model].keyword(this.color)},hex(P){return void 0!==P?new w(P):C.to.hex(this.rgb().round().color)},hexa(P){if(void 0!==P)return new w(P);const f=this.rgb().round().color;let Y=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Y.length&&(Y="0"+Y),C.to.hex(f)+Y},rgbNumber(){const P=this.rgb().color;return(255&P[0])<<16|(255&P[1])<<8|255&P[2]},luminosity(){const P=this.rgb().color,f=[];for(const[Y,C]of P.entries()){const P=C/255;f[Y]=P<=.04045?P/12.92:((P+.055)/1.055)**2.4}return.2126*f[0]+.7152*f[1]+.0722*f[2]},contrast(P){const f=this.luminosity(),Y=P.luminosity();return f>Y?(f+.05)/(Y+.05):(Y+.05)/(f+.05)},level(P){const f=this.contrast(P);return f>=7?"AAA":f>=4.5?"AA":""},isDark(){const P=this.rgb().color;return(2126*P[0]+7152*P[1]+722*P[2])/1e4<128},isLight(){return!this.isDark()},negate(){const P=this.rgb();for(let f=0;f<3;f++)P.color[f]=255-P.color[f];return P},lighten(P){const f=this.hsl();return f.color[2]+=f.color[2]*P,f},darken(P){const f=this.hsl();return f.color[2]-=f.color[2]*P,f},saturate(P){const f=this.hsl();return f.color[1]+=f.color[1]*P,f},desaturate(P){const f=this.hsl();return f.color[1]-=f.color[1]*P,f},whiten(P){const f=this.hwb();return f.color[1]+=f.color[1]*P,f},blacken(P){const f=this.hwb();return f.color[2]+=f.color[2]*P,f},grayscale(){const P=this.rgb().color,f=.3*P[0]+.59*P[1]+.11*P[2];return w.rgb(f,f,f)},fade(P){return this.alpha(this.valpha-this.valpha*P)},opaquer(P){return this.alpha(this.valpha+this.valpha*P)},rotate(P){const f=this.hsl();let Y=f.color[0];return Y=(Y+P)%360,Y=Y<0?360+Y:Y,f.color[0]=Y,f},mix(P,f){if(!P||!P.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof P);const Y=P.rgb(),C=this.rgb(),q=void 0===f?.5:f,m=2*q-1,L=Y.alpha()-C.alpha(),o=((m*L===-1?m:(m+L)/(1+m*L))+1)/2,d=1-o;return w.rgb(o*Y.red()+d*C.red(),o*Y.green()+d*C.green(),o*Y.blue()+d*C.blue(),Y.alpha()*q+C.alpha()*(1-q))}};for(const i of Object.keys(q)){if(m.includes(i))continue;const{channels:P}=q[i];w.prototype[i]=function(){if(this.model===i)return new w(this);for(var P=arguments.length,f=new Array(P),Y=0;Y<P;Y++)f[Y]=arguments[Y];return f.length>0?new w(f,i):new w([...(C=q[this.model][i].raw(this.color),Array.isArray(C)?C:[C]),this.valpha],i);var C},w[i]=function(){for(var f=arguments.length,Y=new Array(f),C=0;C<f;C++)Y[C]=arguments[C];let q=Y[0];return"number"===typeof q&&(q=r(Y,P)),new w(q,i)}}function d(P){return function(f){return function(P,f){return Number(P.toFixed(f))}(f,P)}}function R(P,f,Y){P=Array.isArray(P)?P:[P];for(const C of P)(o[C]||(o[C]=[]))[f]=Y;return P=P[0],function(C){let q;return void 0!==C?(Y&&(C=Y(C)),q=this[P](),q.color[f]=C,q):(q=this[P]().color[f],Y&&(q=Y(q)),q)}}function y(P){return function(f){return Math.max(0,Math.min(P,f))}}function r(P,f){for(let Y=0;Y<f;Y++)"number"!==typeof P[Y]&&(P[Y]=0);return P}P.exports=w},13332:(P,f,Y)=>{const C=Y(13341),q={};for(const L of Object.keys(C))q[C[L]]=L;const m={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};P.exports=m;for(const L of Object.keys(m)){if(!("channels"in m[L]))throw new Error("missing channels property: "+L);if(!("labels"in m[L]))throw new Error("missing channel labels property: "+L);if(m[L].labels.length!==m[L].channels)throw new Error("channel and label counts mismatch: "+L);const{channels:P,labels:f}=m[L];delete m[L].channels,delete m[L].labels,Object.defineProperty(m[L],"channels",{value:P}),Object.defineProperty(m[L],"labels",{value:f})}m.rgb.hsl=function(P){const f=P[0]/255,Y=P[1]/255,C=P[2]/255,q=Math.min(f,Y,C),m=Math.max(f,Y,C),L=m-q;let o,w;m===q?o=0:f===m?o=(Y-C)/L:Y===m?o=2+(C-f)/L:C===m&&(o=4+(f-Y)/L),o=Math.min(60*o,360),o<0&&(o+=360);const d=(q+m)/2;return w=m===q?0:d<=.5?L/(m+q):L/(2-m-q),[o,100*w,100*d]},m.rgb.hsv=function(P){let f,Y,C,q,m;const L=P[0]/255,o=P[1]/255,w=P[2]/255,d=Math.max(L,o,w),R=d-Math.min(L,o,w),y=function(P){return(d-P)/6/R+.5};return 0===R?(q=0,m=0):(m=R/d,f=y(L),Y=y(o),C=y(w),L===d?q=C-Y:o===d?q=1/3+f-C:w===d&&(q=2/3+Y-f),q<0?q+=1:q>1&&(q-=1)),[360*q,100*m,100*d]},m.rgb.hwb=function(P){const f=P[0],Y=P[1];let C=P[2];const q=m.rgb.hsl(P)[0],L=1/255*Math.min(f,Math.min(Y,C));return C=1-1/255*Math.max(f,Math.max(Y,C)),[q,100*L,100*C]},m.rgb.cmyk=function(P){const f=P[0]/255,Y=P[1]/255,C=P[2]/255,q=Math.min(1-f,1-Y,1-C);return[100*((1-f-q)/(1-q)||0),100*((1-Y-q)/(1-q)||0),100*((1-C-q)/(1-q)||0),100*q]},m.rgb.keyword=function(P){const f=q[P];if(f)return f;let Y,m=1/0;for(const q of Object.keys(C)){const f=C[q],w=(o=f,((L=P)[0]-o[0])**2+(L[1]-o[1])**2+(L[2]-o[2])**2);w<m&&(m=w,Y=q)}var L,o;return Y},m.keyword.rgb=function(P){return C[P]},m.rgb.xyz=function(P){let f=P[0]/255,Y=P[1]/255,C=P[2]/255;f=f>.04045?((f+.055)/1.055)**2.4:f/12.92,Y=Y>.04045?((Y+.055)/1.055)**2.4:Y/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92;return[100*(.4124*f+.3576*Y+.1805*C),100*(.2126*f+.7152*Y+.0722*C),100*(.0193*f+.1192*Y+.9505*C)]},m.rgb.lab=function(P){const f=m.rgb.xyz(P);let Y=f[0],C=f[1],q=f[2];Y/=95.047,C/=100,q/=108.883,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*C-16,500*(Y-C),200*(C-q)]},m.hsl.rgb=function(P){const f=P[0]/360,Y=P[1]/100,C=P[2]/100;let q,m,L;if(0===Y)return L=255*C,[L,L,L];q=C<.5?C*(1+Y):C+Y-C*Y;const o=2*C-q,w=[0,0,0];for(let d=0;d<3;d++)m=f+1/3*-(d-1),m<0&&m++,m>1&&m--,L=6*m<1?o+6*(q-o)*m:2*m<1?q:3*m<2?o+(q-o)*(2/3-m)*6:o,w[d]=255*L;return w},m.hsl.hsv=function(P){const f=P[0];let Y=P[1]/100,C=P[2]/100,q=Y;const m=Math.max(C,.01);C*=2,Y*=C<=1?C:2-C,q*=m<=1?m:2-m;return[f,100*(0===C?2*q/(m+q):2*Y/(C+Y)),100*((C+Y)/2)]},m.hsv.rgb=function(P){const f=P[0]/60,Y=P[1]/100;let C=P[2]/100;const q=Math.floor(f)%6,m=f-Math.floor(f),L=255*C*(1-Y),o=255*C*(1-Y*m),w=255*C*(1-Y*(1-m));switch(C*=255,q){case 0:return[C,w,L];case 1:return[o,C,L];case 2:return[L,C,w];case 3:return[L,o,C];case 4:return[w,L,C];case 5:return[C,L,o]}},m.hsv.hsl=function(P){const f=P[0],Y=P[1]/100,C=P[2]/100,q=Math.max(C,.01);let m,L;L=(2-Y)*C;const o=(2-Y)*q;return m=Y*q,m/=o<=1?o:2-o,m=m||0,L/=2,[f,100*m,100*L]},m.hwb.rgb=function(P){const f=P[0]/360;let Y=P[1]/100,C=P[2]/100;const q=Y+C;let m;q>1&&(Y/=q,C/=q);const L=Math.floor(6*f),o=1-C;m=6*f-L,0!==(1&L)&&(m=1-m);const w=Y+m*(o-Y);let d,R,y;switch(L){default:case 6:case 0:d=o,R=w,y=Y;break;case 1:d=w,R=o,y=Y;break;case 2:d=Y,R=o,y=w;break;case 3:d=Y,R=w,y=o;break;case 4:d=w,R=Y,y=o;break;case 5:d=o,R=Y,y=w}return[255*d,255*R,255*y]},m.cmyk.rgb=function(P){const f=P[0]/100,Y=P[1]/100,C=P[2]/100,q=P[3]/100;return[255*(1-Math.min(1,f*(1-q)+q)),255*(1-Math.min(1,Y*(1-q)+q)),255*(1-Math.min(1,C*(1-q)+q))]},m.xyz.rgb=function(P){const f=P[0]/100,Y=P[1]/100,C=P[2]/100;let q,m,L;return q=3.2406*f+-1.5372*Y+-.4986*C,m=-.9689*f+1.8758*Y+.0415*C,L=.0557*f+-.204*Y+1.057*C,q=q>.0031308?1.055*q**(1/2.4)-.055:12.92*q,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,L=L>.0031308?1.055*L**(1/2.4)-.055:12.92*L,q=Math.min(Math.max(0,q),1),m=Math.min(Math.max(0,m),1),L=Math.min(Math.max(0,L),1),[255*q,255*m,255*L]},m.xyz.lab=function(P){let f=P[0],Y=P[1],C=P[2];f/=95.047,Y/=100,C/=108.883,f=f>.008856?f**(1/3):7.787*f+16/116,Y=Y>.008856?Y**(1/3):7.787*Y+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;return[116*Y-16,500*(f-Y),200*(Y-C)]},m.lab.xyz=function(P){let f,Y,C;Y=(P[0]+16)/116,f=P[1]/500+Y,C=Y-P[2]/200;const q=Y**3,m=f**3,L=C**3;return Y=q>.008856?q:(Y-16/116)/7.787,f=m>.008856?m:(f-16/116)/7.787,C=L>.008856?L:(C-16/116)/7.787,f*=95.047,Y*=100,C*=108.883,[f,Y,C]},m.lab.lch=function(P){const f=P[0],Y=P[1],C=P[2];let q;q=360*Math.atan2(C,Y)/2/Math.PI,q<0&&(q+=360);return[f,Math.sqrt(Y*Y+C*C),q]},m.lch.lab=function(P){const f=P[0],Y=P[1],C=P[2]/360*2*Math.PI;return[f,Y*Math.cos(C),Y*Math.sin(C)]},m.rgb.ansi16=function(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Y,C,q]=P;let L=null===f?m.rgb.hsv(P)[2]:f;if(L=Math.round(L/50),0===L)return 30;let o=30+(Math.round(q/255)<<2|Math.round(C/255)<<1|Math.round(Y/255));return 2===L&&(o+=60),o},m.hsv.ansi16=function(P){return m.rgb.ansi16(m.hsv.rgb(P),P[2])},m.rgb.ansi256=function(P){const f=P[0],Y=P[1],C=P[2];if(f===Y&&Y===C)return f<8?16:f>248?231:Math.round((f-8)/247*24)+232;return 16+36*Math.round(f/255*5)+6*Math.round(Y/255*5)+Math.round(C/255*5)},m.ansi16.rgb=function(P){let f=P%10;if(0===f||7===f)return P>50&&(f+=3.5),f=f/10.5*255,[f,f,f];const Y=.5*(1+~~(P>50));return[(1&f)*Y*255,(f>>1&1)*Y*255,(f>>2&1)*Y*255]},m.ansi256.rgb=function(P){if(P>=232){const f=10*(P-232)+8;return[f,f,f]}let f;P-=16;return[Math.floor(P/36)/5*255,Math.floor((f=P%36)/6)/5*255,f%6/5*255]},m.rgb.hex=function(P){const f=(((255&Math.round(P[0]))<<16)+((255&Math.round(P[1]))<<8)+(255&Math.round(P[2]))).toString(16).toUpperCase();return"000000".substring(f.length)+f},m.hex.rgb=function(P){const f=P.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!f)return[0,0,0];let Y=f[0];3===f[0].length&&(Y=Y.split("").map((P=>P+P)).join(""));const C=parseInt(Y,16);return[C>>16&255,C>>8&255,255&C]},m.rgb.hcg=function(P){const f=P[0]/255,Y=P[1]/255,C=P[2]/255,q=Math.max(Math.max(f,Y),C),m=Math.min(Math.min(f,Y),C),L=q-m;let o,w;return o=L<1?m/(1-L):0,w=L<=0?0:q===f?(Y-C)/L%6:q===Y?2+(C-f)/L:4+(f-Y)/L,w/=6,w%=1,[360*w,100*L,100*o]},m.hsl.hcg=function(P){const f=P[1]/100,Y=P[2]/100,C=Y<.5?2*f*Y:2*f*(1-Y);let q=0;return C<1&&(q=(Y-.5*C)/(1-C)),[P[0],100*C,100*q]},m.hsv.hcg=function(P){const f=P[1]/100,Y=P[2]/100,C=f*Y;let q=0;return C<1&&(q=(Y-C)/(1-C)),[P[0],100*C,100*q]},m.hcg.rgb=function(P){const f=P[0]/360,Y=P[1]/100,C=P[2]/100;if(0===Y)return[255*C,255*C,255*C];const q=[0,0,0],m=f%1*6,L=m%1,o=1-L;let w=0;switch(Math.floor(m)){case 0:q[0]=1,q[1]=L,q[2]=0;break;case 1:q[0]=o,q[1]=1,q[2]=0;break;case 2:q[0]=0,q[1]=1,q[2]=L;break;case 3:q[0]=0,q[1]=o,q[2]=1;break;case 4:q[0]=L,q[1]=0,q[2]=1;break;default:q[0]=1,q[1]=0,q[2]=o}return w=(1-Y)*C,[255*(Y*q[0]+w),255*(Y*q[1]+w),255*(Y*q[2]+w)]},m.hcg.hsv=function(P){const f=P[1]/100,Y=f+P[2]/100*(1-f);let C=0;return Y>0&&(C=f/Y),[P[0],100*C,100*Y]},m.hcg.hsl=function(P){const f=P[1]/100,Y=P[2]/100*(1-f)+.5*f;let C=0;return Y>0&&Y<.5?C=f/(2*Y):Y>=.5&&Y<1&&(C=f/(2*(1-Y))),[P[0],100*C,100*Y]},m.hcg.hwb=function(P){const f=P[1]/100,Y=f+P[2]/100*(1-f);return[P[0],100*(Y-f),100*(1-Y)]},m.hwb.hcg=function(P){const f=P[1]/100,Y=1-P[2]/100,C=Y-f;let q=0;return C<1&&(q=(Y-C)/(1-C)),[P[0],100*C,100*q]},m.apple.rgb=function(P){return[P[0]/65535*255,P[1]/65535*255,P[2]/65535*255]},m.rgb.apple=function(P){return[P[0]/255*65535,P[1]/255*65535,P[2]/255*65535]},m.gray.rgb=function(P){return[P[0]/100*255,P[0]/100*255,P[0]/100*255]},m.gray.hsl=function(P){return[0,0,P[0]]},m.gray.hsv=m.gray.hsl,m.gray.hwb=function(P){return[0,100,P[0]]},m.gray.cmyk=function(P){return[0,0,0,P[0]]},m.gray.lab=function(P){return[P[0],0,0]},m.gray.hex=function(P){const f=255&Math.round(P[0]/100*255),Y=((f<<16)+(f<<8)+f).toString(16).toUpperCase();return"000000".substring(Y.length)+Y},m.rgb.gray=function(P){return[(P[0]+P[1]+P[2])/3/255*100]}},13329:(P,f,Y)=>{const C=Y(13332),q=Y(13347),m={};Object.keys(C).forEach((P=>{m[P]={},Object.defineProperty(m[P],"channels",{value:C[P].channels}),Object.defineProperty(m[P],"labels",{value:C[P].labels});const f=q(P);Object.keys(f).forEach((Y=>{const C=f[Y];m[P][Y]=function(P){const f=function(){for(var f=arguments.length,Y=new Array(f),C=0;C<f;C++)Y[C]=arguments[C];const q=Y[0];if(void 0===q||null===q)return q;q.length>1&&(Y=q);const m=P(Y);if("object"===typeof m)for(let P=m.length,L=0;L<P;L++)m[L]=Math.round(m[L]);return m};return"conversion"in P&&(f.conversion=P.conversion),f}(C),m[P][Y].raw=function(P){const f=function(){for(var f=arguments.length,Y=new Array(f),C=0;C<f;C++)Y[C]=arguments[C];const q=Y[0];return void 0===q||null===q?q:(q.length>1&&(Y=q),P(Y))};return"conversion"in P&&(f.conversion=P.conversion),f}(C)}))})),P.exports=m},13347:(P,f,Y)=>{const C=Y(13332);function q(P){const f=function(){const P={},f=Object.keys(C);for(let Y=f.length,C=0;C<Y;C++)P[f[C]]={distance:-1,parent:null};return P}(),Y=[P];for(f[P].distance=0;Y.length;){const P=Y.pop(),q=Object.keys(C[P]);for(let C=q.length,m=0;m<C;m++){const C=q[m],L=f[C];-1===L.distance&&(L.distance=f[P].distance+1,L.parent=P,Y.unshift(C))}}return f}function m(P,f){return function(Y){return f(P(Y))}}function L(P,f){const Y=[f[P].parent,P];let q=C[f[P].parent][P],L=f[P].parent;for(;f[L].parent;)Y.unshift(f[L].parent),q=m(C[f[L].parent][L],q),L=f[L].parent;return q.conversion=Y,q}P.exports=function(P){const f=q(P),Y={},C=Object.keys(f);for(let q=C.length,m=0;m<q;m++){const P=C[m];null!==f[P].parent&&(Y[P]=L(P,f))}return Y}},13341:P=>{"use strict";P.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11907:function(P,f,Y){"use strict";var C=this&&this.__createBinding||(Object.create?function(P,f,Y,C){void 0===C&&(C=Y);var q=Object.getOwnPropertyDescriptor(f,Y);q&&!("get"in q?!f.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return f[Y]}}),Object.defineProperty(P,C,q)}:function(P,f,Y,C){void 0===C&&(C=Y),P[C]=f[Y]}),q=this&&this.__setModuleDefault||(Object.create?function(P,f){Object.defineProperty(P,"default",{enumerable:!0,value:f})}:function(P,f){P.default=f}),m=this&&this.__importStar||function(P){if(P&&P.__esModule)return P;var f={};if(null!=P)for(var Y in P)"default"!==Y&&Object.prototype.hasOwnProperty.call(P,Y)&&C(f,P,Y);return q(f,P),f},L=this&&this.__awaiter||function(P,f,Y,C){return new(Y||(Y=Promise))((function(q,m){function L(P){try{w(C.next(P))}catch(f){m(f)}}function o(P){try{w(C.throw(P))}catch(f){m(f)}}function w(P){var f;P.done?q(P.value):(f=P.value,f instanceof Y?f:new Y((function(P){P(f)}))).then(L,o)}w((C=C.apply(P,f||[])).next())}))};Object.defineProperty(f,"__esModule",{value:!0}),f.Auth=f.Platform=void 0;const o=m(Y(11837)),w=Y(11911),d="colyseus-auth-token";!function(P){P.ios="ios",P.android="android"}(f.Platform||(f.Platform={}));f.Auth=class{constructor(P){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=P.replace("ws","http"),(0,w.getItem)(d,(P=>this.token=P))}get hasToken(){return!!this.token}login(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return L(this,void 0,void 0,(function*(){const f=Object.assign({},P);this.hasToken&&(f.token=this.token);const Y=yield this.request("post","/auth",f);this.token=Y.token,(0,w.setItem)(d,this.token);for(let P in Y)this.hasOwnProperty(P)&&(this[P]=Y[P]);return this.registerPingService(),this}))}save(){return L(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return L(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(P){return L(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:P})}))}acceptFriendRequest(P){return L(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:P})}))}declineFriendRequest(P){return L(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:P})}))}blockUser(P){return L(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:P})}))}unblockUser(P){return L(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:P})}))}request(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3?arguments[3]:void 0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return L(this,void 0,void 0,(function*(){q.Accept="application/json",this.hasToken&&(q.Authorization="Bearer "+this.token);const m=[];for(const P in Y)m.push(`${P}=${Y[P]}`);const L=m.length>0?`?${m.join("&")}`:"",w={headers:q};return C&&(w.body=C),(yield o[P](`${this.endpoint}${f}${L}`,w)).data}))}logout(){this.token=void 0,(0,w.removeItem)(d),this.unregisterPingService()}registerPingService(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),P)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},11835:function(P,f,Y){"use strict";var C,q=this&&this.__awaiter||function(P,f,Y,C){return new(Y||(Y=Promise))((function(q,m){function L(P){try{w(C.next(P))}catch(f){m(f)}}function o(P){try{w(C.throw(P))}catch(f){m(f)}}function w(P){var f;P.done?q(P.value):(f=P.value,f instanceof Y?f:new Y((function(P){P(f)}))).then(L,o)}w((C=C.apply(P,f||[])).next())}))};Object.defineProperty(f,"__esModule",{value:!0}),f.Client=f.MatchMakeError=void 0;const m=Y(11837),L=Y(11844),o=Y(11849);class w extends Error{constructor(P,f){super(P),this.code=f,Object.setPrototypeOf(this,w.prototype)}}f.MatchMakeError=w;const d="undefined"!==typeof window&&"undefined"!==typeof(null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";f.Client=class{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;if("string"===typeof P){const f=new URL(P),Y="https:"===f.protocol||"wss:"===f.protocol,C=Number(f.port||(Y?443:80));this.settings={hostname:f.hostname,pathname:"/"!==f.pathname?f.pathname:"",port:C,secure:Y}}else void 0===P.port&&(P.port=P.secure?443:80),void 0===P.pathname&&(P.pathname=""),this.settings=P}joinOrCreate(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",P,f,Y)}))}create(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",P,f,Y)}))}join(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",P,f,Y)}))}joinById(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;return q(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",P,f,Y)}))}reconnect(P,f){return q(this,void 0,void 0,(function*(){if("string"===typeof P&&"string"===typeof f)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Y,C]=P.split(":");return yield this.createMatchMakeRequest("reconnect",Y,{reconnectionToken:C},f)}))}getAvailableRooms(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return q(this,void 0,void 0,(function*(){return(yield(0,m.get)(this.getHttpEndpoint(`${P}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(P,f,Y){return q(this,void 0,void 0,(function*(){const C=this.createRoom(P.room.name,f);C.roomId=P.room.roomId,C.sessionId=P.sessionId;const m={sessionId:C.sessionId};P.reconnectionToken&&(m.reconnectionToken=P.reconnectionToken);const o=Y||C;return C.connect(this.buildEndpoint(P.room,m),P.devMode&&(()=>q(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${C.roomId}'...`);let Y=0;const m=()=>q(this,void 0,void 0,(function*(){Y++;try{yield this.consumeSeatReservation(P,f,o),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${C.roomId}'`)}catch(q){Y<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Y} out of 8)`),setTimeout(m,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(m,2e3)}))),o),new Promise(((P,f)=>{const Y=(P,Y)=>f(new L.ServerError(P,Y));o.onError.once(Y),o.onJoin.once((()=>{o.onError.remove(Y),P(o)}))}))}))}createMatchMakeRequest(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;return q(this,void 0,void 0,(function*(){const q=(yield(0,m.post)(this.getHttpEndpoint(`${P}/${f}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Y)})).data;if(q.error)throw new w(q.error,q.code);return"reconnect"===P&&(q.reconnectionToken=Y.reconnectionToken),yield this.consumeSeatReservation(q,C,L)}))}createRoom(P,f){return new o.Room(P,f)}buildEndpoint(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Y=[];for(const q in f)f.hasOwnProperty(q)&&Y.push(`${q}=${f[q]}`);let C=this.settings.secure?"wss://":"ws://";return P.publicAddress?C+=`${P.publicAddress}`:C+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${C}/${P.processId}/${P.roomId}?${Y.join("&")}`}getHttpEndpoint(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${P}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11864:(P,f,Y)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.Connection=void 0;const C=Y(11870);f.Connection=class{constructor(){this.events={},this.transport=new C.WebSocketTransport(this.events)}send(P){this.transport.send(P)}connect(P){this.transport.connect(P)}close(P,f){this.transport.close(P,f)}get isOpen(){return this.transport.isOpen}}},11880:(P,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.utf8Length=f.utf8Read=f.ErrorCode=f.Protocol=void 0,function(P){P[P.HANDSHAKE=9]="HANDSHAKE",P[P.JOIN_ROOM=10]="JOIN_ROOM",P[P.ERROR=11]="ERROR",P[P.LEAVE_ROOM=12]="LEAVE_ROOM",P[P.ROOM_DATA=13]="ROOM_DATA",P[P.ROOM_STATE=14]="ROOM_STATE",P[P.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",P[P.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",P[P.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(f.Protocol||(f.Protocol={})),function(P){P[P.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",P[P.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",P[P.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",P[P.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",P[P.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",P[P.AUTH_FAILED=4215]="AUTH_FAILED",P[P.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(f.ErrorCode||(f.ErrorCode={})),f.utf8Read=function(P,f){const Y=P[f++];for(var C="",q=0,m=f,L=f+Y;m<L;m++){var o=P[m];if(0!==(128&o))if(192!==(224&o))if(224!==(240&o)){if(240!==(248&o))throw new Error("Invalid byte "+o.toString(16));(q=(7&o)<<18|(63&P[++m])<<12|(63&P[++m])<<6|63&P[++m])>=65536?(q-=65536,C+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):C+=String.fromCharCode(q)}else C+=String.fromCharCode((15&o)<<12|(63&P[++m])<<6|63&P[++m]);else C+=String.fromCharCode((31&o)<<6|63&P[++m]);else C+=String.fromCharCode(o)}return C},f.utf8Length=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",f=0,Y=0;for(let C=0,q=P.length;C<q;C++)f=P.charCodeAt(C),f<128?Y+=1:f<2048?Y+=2:f<55296||f>=57344?Y+=3:(C++,Y+=4);return Y+1}},11849:function(P,f,Y){"use strict";var C=this&&this.__createBinding||(Object.create?function(P,f,Y,C){void 0===C&&(C=Y);var q=Object.getOwnPropertyDescriptor(f,Y);q&&!("get"in q?!f.__esModule:q.writable||q.configurable)||(q={enumerable:!0,get:function(){return f[Y]}}),Object.defineProperty(P,C,q)}:function(P,f,Y,C){void 0===C&&(C=Y),P[C]=f[Y]}),q=this&&this.__setModuleDefault||(Object.create?function(P,f){Object.defineProperty(P,"default",{enumerable:!0,value:f})}:function(P,f){P.default=f}),m=this&&this.__importStar||function(P){if(P&&P.__esModule)return P;var f={};if(null!=P)for(var Y in P)"default"!==Y&&Object.prototype.hasOwnProperty.call(P,Y)&&C(f,P,Y);return q(f,P),f};Object.defineProperty(f,"__esModule",{value:!0}),f.Room=void 0;const L=m(Y(11855)),o=Y(11864),w=Y(11880),d=Y(11887),R=Y(11892),y=Y(11899),r=Y(11901),i=Y(11844);class u{constructor(P,f){this.onStateChange=(0,y.createSignal)(),this.onError=(0,y.createSignal)(),this.onLeave=(0,y.createSignal)(),this.onJoin=(0,y.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,R.createNanoEvents)(),this.roomId=null,this.name=P,f&&(this.serializer=new((0,d.getSerializer)("schema")),this.rootSchema=f,this.serializer.state=new f),this.onError(((P,f)=>{var Y;return null===(Y=console.warn)||void 0===Y?void 0:Y.call(console,`colyseus.js - onError => (${P}) ${f}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const C=new o.Connection;Y.connection=C,C.events.onmessage=u.prototype.onMessageCallback.bind(Y),C.events.onclose=function(P){var C;if(!Y.hasJoined)return null===(C=console.warn)||void 0===C||C.call(console,`Room connection was closed unexpectedly (${P.code}): ${P.reason}`),void Y.onError.invoke(P.code,P.reason);P.code===i.CloseCode.DEVMODE_RESTART&&f?f():(Y.onLeave.invoke(P.code),Y.destroy())},C.events.onerror=function(P){var f;null===(f=console.warn)||void 0===f||f.call(console,`Room, onError (${P.code}): ${P.reason}`),Y.onError.invoke(P.code,P.reason)},C.connect(P)}leave(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((f=>{this.onLeave((P=>f(P))),this.connection?P?this.connection.send([w.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(i.CloseCode.CONSENTED)}))}onMessage(P,f){return this.onMessageHandlers.on(this.getMessageHandlerKey(P),f)}send(P,f){const Y=[w.Protocol.ROOM_DATA];let C;if("string"===typeof P?r.encode.string(Y,P):r.encode.number(Y,P),void 0!==f){const P=L.encode(f);C=new Uint8Array(Y.length+P.byteLength),C.set(new Uint8Array(Y),0),C.set(new Uint8Array(P),Y.length)}else C=new Uint8Array(Y);this.connection.send(C.buffer)}sendBytes(P,f){const Y=[w.Protocol.ROOM_DATA_BYTES];let C;"string"===typeof P?r.encode.string(Y,P):r.encode.number(Y,P),C=new Uint8Array(Y.length+(f.byteLength||f.length)),C.set(new Uint8Array(Y),0),C.set(new Uint8Array(f),Y.length),this.connection.send(C.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(P){const f=Array.from(new Uint8Array(P.data)),Y=f[0];if(Y===w.Protocol.JOIN_ROOM){let P=1;const Y=(0,w.utf8Read)(f,P);if(P+=(0,w.utf8Length)(Y),this.serializerId=(0,w.utf8Read)(f,P),P+=(0,w.utf8Length)(this.serializerId),!this.serializer){const P=(0,d.getSerializer)(this.serializerId);this.serializer=new P}f.length>P&&this.serializer.handshake&&this.serializer.handshake(f,{offset:P}),this.reconnectionToken=`${this.roomId}:${Y}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([w.Protocol.JOIN_ROOM])}else if(Y===w.Protocol.ERROR){const P={offset:1},Y=r.decode.number(f,P),C=r.decode.string(f,P);this.onError.invoke(Y,C)}else if(Y===w.Protocol.LEAVE_ROOM)this.leave();else if(Y===w.Protocol.ROOM_DATA_SCHEMA){const P={offset:1},Y=this.serializer.getState().constructor._context.get(r.decode.number(f,P)),C=new Y;C.decode(f,P),this.dispatchMessage(Y,C)}else if(Y===w.Protocol.ROOM_STATE)f.shift(),this.setState(f);else if(Y===w.Protocol.ROOM_STATE_PATCH)f.shift(),this.patch(f);else if(Y===w.Protocol.ROOM_DATA){const Y={offset:1},C=r.decode.stringCheck(f,Y)?r.decode.string(f,Y):r.decode.number(f,Y),q=f.length>Y.offset?L.decode(P.data,Y.offset):void 0;this.dispatchMessage(C,q)}else if(Y===w.Protocol.ROOM_DATA_BYTES){const P={offset:1},Y=r.decode.stringCheck(f,P)?r.decode.string(f,P):r.decode.number(f,P);this.dispatchMessage(Y,new Uint8Array(f.slice(P.offset)))}}setState(P){this.serializer.setState(P),this.onStateChange.invoke(this.serializer.getState())}patch(P){this.serializer.patch(P),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(P,f){var Y;const C=this.getMessageHandlerKey(P);this.onMessageHandlers.events[C]?this.onMessageHandlers.emit(C,f):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",P,f):null===(Y=console.warn)||void 0===Y||Y.call(console,`colyseus.js: onMessage() not registered for type '${P}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(P){switch(typeof P){case"function":return`$${P._typeid}`;case"string":return P;case"number":return`i${P}`;default:throw new Error("invalid message type.")}}}f.Room=u},11911:(P,f)=>{"use strict";let Y;function C(){return Y||(Y="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(P,f){this.cache[P]=f},getItem:function(P){this.cache[P]},removeItem:function(P){delete this.cache[P]}}),Y}Object.defineProperty(f,"__esModule",{value:!0}),f.getItem=f.removeItem=f.setItem=void 0,f.setItem=function(P,f){C().setItem(P,f)},f.removeItem=function(P){C().removeItem(P)},f.getItem=function(P,f){const Y=C().getItem(P);"undefined"!==typeof Promise&&Y instanceof Promise?Y.then((P=>f(P))):f(Y)}},11892:(P,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.createNanoEvents=void 0;f.createNanoEvents=()=>({emit(P){let f=this.events[P]||[];for(var Y=arguments.length,C=new Array(Y>1?Y-1:0),q=1;q<Y;q++)C[q-1]=arguments[q];for(let m=0,L=f.length;m<L;m++)f[m](...C)},events:{},on(P,f){var Y;return(null===(Y=this.events[P])||void 0===Y?void 0:Y.push(f))||(this.events[P]=[f]),()=>{var Y;this.events[P]=null===(Y=this.events[P])||void 0===Y?void 0:Y.filter((P=>f!==P))}}})},11899:(P,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.createSignal=f.EventEmitter=void 0;class Y{constructor(){this.handlers=[]}register(P){return this.handlers.push(P),this}invoke(){for(var P=arguments.length,f=new Array(P),Y=0;Y<P;Y++)f[Y]=arguments[Y];this.handlers.forEach((P=>P.apply(this,f)))}invokeAsync(){for(var P=arguments.length,f=new Array(P),Y=0;Y<P;Y++)f[Y]=arguments[Y];return Promise.all(this.handlers.map((P=>P.apply(this,f))))}remove(P){const f=this.handlers.indexOf(P);this.handlers[f]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}f.EventEmitter=Y,f.createSignal=function(){const P=new Y;function f(f){return P.register(f,null===this)}return f.once=f=>{const Y=function(){for(var C=arguments.length,q=new Array(C),m=0;m<C;m++)q[m]=arguments[m];f.apply(this,q),P.remove(Y)};P.register(Y)},f.remove=f=>P.remove(f),f.invoke=function(){return P.invoke(...arguments)},f.invokeAsync=function(){return P.invokeAsync(...arguments)},f.clear=()=>P.clear(),f}},11844:(P,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.ServerError=f.CloseCode=void 0,function(P){P[P.CONSENTED=4e3]="CONSENTED",P[P.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(f.CloseCode||(f.CloseCode={}));class Y extends Error{constructor(P,f){super(f),this.name="ServerError",this.code=P}}f.ServerError=Y},11824:(P,f,Y)=>{"use strict";f.e=void 0,Y(11830);var C=Y(11835);Object.defineProperty(f,"e",{enumerable:!0,get:function(){return C.Client}});var q=Y(11880);var m=Y(11849);var L=Y(11907);const o=Y(11917);const w=Y(11926),d=Y(11887);(0,d.registerSerializer)("schema",o.SchemaSerializer),(0,d.registerSerializer)("none",w.NoneSerializer)},11830:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=P=>null!==P&&"object"===typeof P&&P.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11855:(P,f)=>{"use strict";function Y(P,f){if(this._offset=f,P instanceof ArrayBuffer)this._buffer=P,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(P))throw new Error("Invalid argument");this._buffer=P.buffer,this._view=new DataView(this._buffer,P.byteOffset,P.byteLength)}}Object.defineProperty(f,"__esModule",{value:!0}),f.decode=f.encode=void 0,Y.prototype._array=function(P){for(var f=new Array(P),Y=0;Y<P;Y++)f[Y]=this._parse();return f},Y.prototype._map=function(P){for(var f={},Y=0;Y<P;Y++)f[this._parse()]=this._parse();return f},Y.prototype._str=function(P){var f=function(P,f,Y){for(var C="",q=0,m=f,L=f+Y;m<L;m++){var o=P.getUint8(m);if(0!==(128&o))if(192!==(224&o))if(224!==(240&o)){if(240!==(248&o))throw new Error("Invalid byte "+o.toString(16));(q=(7&o)<<18|(63&P.getUint8(++m))<<12|(63&P.getUint8(++m))<<6|63&P.getUint8(++m))>=65536?(q-=65536,C+=String.fromCharCode(55296+(q>>>10),56320+(1023&q))):C+=String.fromCharCode(q)}else C+=String.fromCharCode((15&o)<<12|(63&P.getUint8(++m))<<6|63&P.getUint8(++m));else C+=String.fromCharCode((31&o)<<6|63&P.getUint8(++m));else C+=String.fromCharCode(o)}return C}(this._view,this._offset,P);return this._offset+=P,f},Y.prototype._bin=function(P){var f=this._buffer.slice(this._offset,this._offset+P);return this._offset+=P,f},Y.prototype._parse=function(){var P,f=this._view.getUint8(this._offset++),Y=0,C=0,q=0,m=0;if(f<192)return f<128?f:f<144?this._map(15&f):f<160?this._array(15&f):this._str(31&f);if(f>223)return-1*(255-f+1);switch(f){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Y=this._view.getUint8(this._offset),this._offset+=1,this._bin(Y);case 197:return Y=this._view.getUint16(this._offset),this._offset+=2,this._bin(Y);case 198:return Y=this._view.getUint32(this._offset),this._offset+=4,this._bin(Y);case 199:if(Y=this._view.getUint8(this._offset),C=this._view.getInt8(this._offset+1),this._offset+=2,-1===C){var L=this._view.getUint32(this._offset);return q=this._view.getInt32(this._offset+4),m=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*q+m)+L/1e6)}return[C,this._bin(Y)];case 200:return Y=this._view.getUint16(this._offset),C=this._view.getInt8(this._offset+2),this._offset+=3,[C,this._bin(Y)];case 201:return Y=this._view.getUint32(this._offset),C=this._view.getInt8(this._offset+4),this._offset+=5,[C,this._bin(Y)];case 202:return P=this._view.getFloat32(this._offset),this._offset+=4,P;case 203:return P=this._view.getFloat64(this._offset),this._offset+=8,P;case 204:return P=this._view.getUint8(this._offset),this._offset+=1,P;case 205:return P=this._view.getUint16(this._offset),this._offset+=2,P;case 206:return P=this._view.getUint32(this._offset),this._offset+=4,P;case 207:return q=this._view.getUint32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,q+m;case 208:return P=this._view.getInt8(this._offset),this._offset+=1,P;case 209:return P=this._view.getInt16(this._offset),this._offset+=2,P;case 210:return P=this._view.getInt32(this._offset),this._offset+=4,P;case 211:return q=this._view.getInt32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,q+m;case 212:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?void(this._offset+=1):[C,this._bin(1)];case 213:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(2)];case 214:return C=this._view.getInt8(this._offset),this._offset+=1,-1===C?(P=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*P)):[C,this._bin(4)];case 215:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?(q=this._view.getInt32(this._offset)*Math.pow(2,32),m=this._view.getUint32(this._offset+4),this._offset+=8,new Date(q+m)):-1===C?(q=this._view.getUint32(this._offset),m=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&q)+m)+(q>>>2)/1e6)):[C,this._bin(8)];case 216:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(16)];case 217:return Y=this._view.getUint8(this._offset),this._offset+=1,this._str(Y);case 218:return Y=this._view.getUint16(this._offset),this._offset+=2,this._str(Y);case 219:return Y=this._view.getUint32(this._offset),this._offset+=4,this._str(Y);case 220:return Y=this._view.getUint16(this._offset),this._offset+=2,this._array(Y);case 221:return Y=this._view.getUint32(this._offset),this._offset+=4,this._array(Y);case 222:return Y=this._view.getUint16(this._offset),this._offset+=2,this._map(Y);case 223:return Y=this._view.getUint32(this._offset),this._offset+=4,this._map(Y)}throw new Error("Could not parse")},f.decode=function(P){var f=new Y(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),C=f._parse();if(f._offset!==P.byteLength)throw new Error(P.byteLength-f._offset+" trailing bytes");return C};function C(P,f,Y){for(var C=0,q=0,m=Y.length;q<m;q++)(C=Y.charCodeAt(q))<128?P.setUint8(f++,C):C<2048?(P.setUint8(f++,192|C>>6),P.setUint8(f++,128|63&C)):C<55296||C>=57344?(P.setUint8(f++,224|C>>12),P.setUint8(f++,128|C>>6&63),P.setUint8(f++,128|63&C)):(q++,C=65536+((1023&C)<<10|1023&Y.charCodeAt(q)),P.setUint8(f++,240|C>>18),P.setUint8(f++,128|C>>12&63),P.setUint8(f++,128|C>>6&63),P.setUint8(f++,128|63&C))}function q(P,f,Y){var C=typeof Y,m=0,L=0,o=0,w=0,d=0,R=0;if("string"===C){if(d=function(P){for(var f=0,Y=0,C=0,q=P.length;C<q;C++)(f=P.charCodeAt(C))<128?Y+=1:f<2048?Y+=2:f<55296||f>=57344?Y+=3:(C++,Y+=4);return Y}(Y),d<32)P.push(160|d),R=1;else if(d<256)P.push(217,d),R=2;else if(d<65536)P.push(218,d>>8,d),R=3;else{if(!(d<4294967296))throw new Error("String too long");P.push(219,d>>24,d>>16,d>>8,d),R=5}return f.push({_str:Y,_length:d,_offset:P.length}),R+d}if("number"===C)return Math.floor(Y)===Y&&isFinite(Y)?Y>=0?Y<128?(P.push(Y),1):Y<256?(P.push(204,Y),2):Y<65536?(P.push(205,Y>>8,Y),3):Y<4294967296?(P.push(206,Y>>24,Y>>16,Y>>8,Y),5):(o=Y/Math.pow(2,32)|0,w=Y>>>0,P.push(207,o>>24,o>>16,o>>8,o,w>>24,w>>16,w>>8,w),9):Y>=-32?(P.push(Y),1):Y>=-128?(P.push(208,Y),2):Y>=-32768?(P.push(209,Y>>8,Y),3):Y>=-2147483648?(P.push(210,Y>>24,Y>>16,Y>>8,Y),5):(o=Math.floor(Y/Math.pow(2,32)),w=Y>>>0,P.push(211,o>>24,o>>16,o>>8,o,w>>24,w>>16,w>>8,w),9):(P.push(203),f.push({_float:Y,_length:8,_offset:P.length}),9);if("object"===C){if(null===Y)return P.push(192),1;if(Array.isArray(Y)){if((d=Y.length)<16)P.push(144|d),R=1;else if(d<65536)P.push(220,d>>8,d),R=3;else{if(!(d<4294967296))throw new Error("Array too large");P.push(221,d>>24,d>>16,d>>8,d),R=5}for(m=0;m<d;m++)R+=q(P,f,Y[m]);return R}if(Y instanceof Date){var y=Y.getTime(),r=Math.floor(y/1e3),i=1e6*(y-1e3*r);return r>=0&&i>=0&&r<=17179869183?0===i&&r<=4294967295?(P.push(214,255,r>>24,r>>16,r>>8,r),6):(o=r/4294967296,w=4294967295&r,P.push(215,255,i>>22,i>>14,i>>6,o,w>>24,w>>16,w>>8,w),10):(o=Math.floor(r/4294967296),w=r>>>0,P.push(199,12,255,i>>24,i>>16,i>>8,i,o>>24,o>>16,o>>8,o,w>>24,w>>16,w>>8,w),15)}if(Y instanceof ArrayBuffer){if((d=Y.byteLength)<256)P.push(196,d),R=2;else if(d<65536)P.push(197,d>>8,d),R=3;else{if(!(d<4294967296))throw new Error("Buffer too large");P.push(198,d>>24,d>>16,d>>8,d),R=5}return f.push({_bin:Y,_length:d,_offset:P.length}),R+d}if("function"===typeof Y.toJSON)return q(P,f,Y.toJSON());var u=[],g="",S=Object.keys(Y);for(m=0,L=S.length;m<L;m++)void 0!==Y[g=S[m]]&&"function"!==typeof Y[g]&&u.push(g);if((d=u.length)<16)P.push(128|d),R=1;else if(d<65536)P.push(222,d>>8,d),R=3;else{if(!(d<4294967296))throw new Error("Object too large");P.push(223,d>>24,d>>16,d>>8,d),R=5}for(m=0;m<d;m++)R+=q(P,f,g=u[m]),R+=q(P,f,Y[g]);return R}if("boolean"===C)return P.push(Y?195:194),1;if("undefined"===C)return P.push(192),1;if("function"===typeof Y.toJSON)return q(P,f,Y.toJSON());throw new Error("Could not encode")}f.encode=function(P){var f=[],Y=[],m=q(f,Y,P),L=new ArrayBuffer(m),o=new DataView(L),w=0,d=0,R=-1;Y.length>0&&(R=Y[0]._offset);for(var y,r=0,i=0,u=0,g=f.length;u<g;u++)if(o.setUint8(d+u,f[u]),u+1===R){if(r=(y=Y[w])._length,i=d+R,y._bin)for(var S=new Uint8Array(y._bin),K=0;K<r;K++)o.setUint8(i+K,S[K]);else y._str?C(o,i,y._str):void 0!==y._float&&o.setFloat64(i,y._float);d+=r,Y[++w]&&(R=Y[w]._offset)}return L}},11926:(P,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.NoneSerializer=void 0;f.NoneSerializer=class{setState(P){}getState(){return null}patch(P){}teardown(){}handshake(P){}}},11917:(P,f,Y)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.SchemaSerializer=void 0;const C=Y(11901);f.SchemaSerializer=class{setState(P){return this.state.decode(P)}getState(){return this.state}patch(P){return this.state.decode(P)}teardown(){var P,f;null===(f=null===(P=this.state)||void 0===P?void 0:P.$changes)||void 0===f||f.root.clearRefs()}handshake(P,f){if(this.state){(new C.Reflection).decode(P,f)}else this.state=C.Reflection.decode(P,f)}}},11887:(P,f)=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.getSerializer=f.registerSerializer=void 0;const Y={};f.registerSerializer=function(P,f){Y[P]=f},f.getSerializer=function(P){const f=Y[P];if(!f)throw new Error("missing serializer: "+P);return f}},11870:function(P,f,Y){"use strict";var C=this&&this.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(f,"__esModule",{value:!0}),f.WebSocketTransport=void 0;const q=C(Y(11873)),m=globalThis.WebSocket||q.default;f.WebSocketTransport=class{constructor(P){this.events=P}send(P){P instanceof ArrayBuffer?this.ws.send(P):Array.isArray(P)&&this.ws.send(new Uint8Array(P).buffer)}connect(P){this.ws=new m(P,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(P,f){this.ws.close(P,f)}get isOpen(){return this.ws.readyState===m.OPEN}}},11873:P=>{"use strict";P.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12323:P=>{"use strict";P.exports=function(P){for(var f=new Array(P),Y=0;Y<P;++Y)f[Y]=Y;return f}},12329:P=>{function f(P){return!!P.constructor&&"function"===typeof P.constructor.isBuffer&&P.constructor.isBuffer(P)}P.exports=function(P){return null!=P&&(f(P)||function(P){return"function"===typeof P.readFloatLE&&"function"===typeof P.slice&&f(P.slice(0,0))}(P)||!!P._isBuffer)}},12319:(P,f,Y)=>{var C=Y(12323),q=Y(12329),m="undefined"!==typeof Float64Array;function L(P,f){return P[0]-f[0]}function o(){var P,f=this.stride,Y=new Array(f.length);for(P=0;P<Y.length;++P)Y[P]=[Math.abs(f[P]),P];Y.sort(L);var C=new Array(Y.length);for(P=0;P<C.length;++P)C[P]=Y[P][1];return C}function w(P,f){var Y=["View",f,"d",P].join("");f<0&&(Y="View_Nil"+P);var q="generic"===P;if(-1===f){var m="function "+Y+"(a){this.data=a;};var proto="+Y+".prototype;proto.dtype='"+P+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Y+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Y+"(a){return new "+Y+"(a);}";return new Function(m)()}if(0===f){m="function "+Y+"(a,d) {this.data = a;this.offset = d};var proto="+Y+".prototype;proto.dtype='"+P+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Y+"_copy() {return new "+Y+"(this.data,this.offset)};proto.pick=function "+Y+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Y+"_get(){return "+(q?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Y+"_set(v){return "+(q?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Y+"(a,b,c,d){return new "+Y+"(a,d)}";return new Function("TrivialArray",m)(d[P][0])}m=["'use strict'"];var L=C(f),w=L.map((function(P){return"i"+P})),R="this.offset+"+L.map((function(P){return"this.stride["+P+"]*i"+P})).join("+"),y=L.map((function(P){return"b"+P})).join(","),r=L.map((function(P){return"c"+P})).join(",");m.push("function "+Y+"(a,"+y+","+r+",d){this.data=a","this.shape=["+y+"]","this.stride=["+r+"]","this.offset=d|0}","var proto="+Y+".prototype","proto.dtype='"+P+"'","proto.dimension="+f),m.push("Object.defineProperty(proto,'size',{get:function "+Y+"_size(){return "+L.map((function(P){return"this.shape["+P+"]"})).join("*"),"}})"),1===f?m.push("proto.order=[0]"):(m.push("Object.defineProperty(proto,'order',{get:"),f<4?(m.push("function "+Y+"_order(){"),2===f?m.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===f&&m.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):m.push("ORDER})")),m.push("proto.set=function "+Y+"_set("+w.join(",")+",v){"),q?m.push("return this.data.set("+R+",v)}"):m.push("return this.data["+R+"]=v}"),m.push("proto.get=function "+Y+"_get("+w.join(",")+"){"),q?m.push("return this.data.get("+R+")}"):m.push("return this.data["+R+"]}"),m.push("proto.index=function "+Y+"_index(",w.join(),"){return "+R+"}"),m.push("proto.hi=function "+Y+"_hi("+w.join(",")+"){return new "+Y+"(this.data,"+L.map((function(P){return["(typeof i",P,"!=='number'||i",P,"<0)?this.shape[",P,"]:i",P,"|0"].join("")})).join(",")+","+L.map((function(P){return"this.stride["+P+"]"})).join(",")+",this.offset)}");var i=L.map((function(P){return"a"+P+"=this.shape["+P+"]"})),u=L.map((function(P){return"c"+P+"=this.stride["+P+"]"}));m.push("proto.lo=function "+Y+"_lo("+w.join(",")+"){var b=this.offset,d=0,"+i.join(",")+","+u.join(","));for(var g=0;g<f;++g)m.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");m.push("return new "+Y+"(this.data,"+L.map((function(P){return"a"+P})).join(",")+","+L.map((function(P){return"c"+P})).join(",")+",b)}"),m.push("proto.step=function "+Y+"_step("+w.join(",")+"){var "+L.map((function(P){return"a"+P+"=this.shape["+P+"]"})).join(",")+","+L.map((function(P){return"b"+P+"=this.stride["+P+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<f;++g)m.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");m.push("return new "+Y+"(this.data,"+L.map((function(P){return"a"+P})).join(",")+","+L.map((function(P){return"b"+P})).join(",")+",c)}");var S=new Array(f),K=new Array(f);for(g=0;g<f;++g)S[g]="a[i"+g+"]",K[g]="b[i"+g+"]";m.push("proto.transpose=function "+Y+"_transpose("+w+"){"+w.map((function(P,f){return P+"=("+P+"===undefined?"+f+":"+P+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Y+"(this.data,"+S.join(",")+","+K.join(",")+",this.offset)}"),m.push("proto.pick=function "+Y+"_pick("+w+"){var a=[],b=[],c=this.offset");for(g=0;g<f;++g)m.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return m.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),m.push("return function construct_"+Y+"(data,shape,stride,offset){return new "+Y+"(data,"+L.map((function(P){return"shape["+P+"]"})).join(",")+","+L.map((function(P){return"stride["+P+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",m.join("\n"))(d[P],o)}var d={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};P.exports=function(P,f,Y,C){if(void 0===P)return(0,d.array[0])([]);"number"===typeof P&&(P=[P]),void 0===f&&(f=[P.length]);var L=f.length;if(void 0===Y){Y=new Array(L);for(var o=L-1,R=1;o>=0;--o)Y[o]=R,R*=f[o]}if(void 0===C){C=0;for(o=0;o<L;++o)Y[o]<0&&(C-=(f[o]-1)*Y[o])}for(var y=function(P){if(q(P))return"buffer";if(m)switch(Object.prototype.toString.call(P)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(P)?"array":"generic"}(P),r=d[y];r.length<=L+1;)r.push(w(y,r.length-1));return(0,r[L+1])(P,f,Y,C)}},13285:P=>{var f;self,f=()=>(()=>{"use strict";var P={d:(f,Y)=>{for(var C in Y)P.o(Y,C)&&!P.o(f,C)&&Object.defineProperty(f,C,{enumerable:!0,get:Y[C]})},o:(P,f)=>Object.prototype.hasOwnProperty.call(P,f)},f={};P.d(f,{default:()=>Q});var Y,C=function(P,f){var Y=f.x-P.x,C=f.y-P.y;return Math.sqrt(Y*Y+C*C)},q=function(P){return P*(Math.PI/180)},m=new Map,L=function(P){m.has(P)&&clearTimeout(m.get(P)),m.set(P,setTimeout(P,100))},o=function(P,f,Y){for(var C,q=f.split(/[ ,]+/g),m=0;m<q.length;m+=1)C=q[m],P.addEventListener?P.addEventListener(C,Y,!1):P.attachEvent&&P.attachEvent(C,Y)},w=function(P,f,Y){for(var C,q=f.split(/[ ,]+/g),m=0;m<q.length;m+=1)C=q[m],P.removeEventListener?P.removeEventListener(C,Y):P.detachEvent&&P.detachEvent(C,Y)},d=function(P){return P.preventDefault(),P.type.match(/^touch/)?P.changedTouches:P},R=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},y=function(P,f){f.top||f.right||f.bottom||f.left?(P.style.top=f.top,P.style.right=f.right,P.style.bottom=f.bottom,P.style.left=f.left):(P.style.left=f.x+"px",P.style.top=f.y+"px")},r=function(P,f,Y){var C=i(P);for(var q in C)if(C.hasOwnProperty(q))if("string"==typeof f)C[q]=f+" "+Y;else{for(var m="",L=0,o=f.length;L<o;L+=1)m+=f[L]+" "+Y+", ";C[q]=m.slice(0,-2)}return C},i=function(P){var f={};return f[P]="",["webkit","Moz","o"].forEach((function(Y){f[Y+P.charAt(0).toUpperCase()+P.slice(1)]=""})),f},u=function(P,f){for(var Y in f)f.hasOwnProperty(Y)&&(P[Y]=f[Y]);return P},g=function(P,f){if(P.length)for(var Y=0,C=P.length;Y<C;Y+=1)f(P[Y]);else f(P)},S="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,K=window.matchMedia("(any-hover: none)").matches,M=!!("ontouchstart"in window),V=!!window.PointerEvent,O=!!window.MSPointerEvent,n={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},l={start:"mousedown",move:"mousemove",end:"mouseup"},v={};function c(){}S&&!K?Y=n:V?Y={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:O?Y={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:M?(Y=n,v=l):Y=l,c.prototype.on=function(P,f){var Y,C=this,q=P.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var m=0;m<q.length;m+=1)Y=q[m],C._handlers_[Y]=C._handlers_[Y]||[],C._handlers_[Y].push(f);return C},c.prototype.off=function(P,f){var Y=this;return Y._handlers_=Y._handlers_||{},void 0===P?Y._handlers_={}:void 0===f?Y._handlers_[P]=null:Y._handlers_[P]&&Y._handlers_[P].indexOf(f)>=0&&Y._handlers_[P].splice(Y._handlers_[P].indexOf(f),1),Y},c.prototype.trigger=function(P,f){var Y,C=this,q=P.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var m=0;m<q.length;m+=1)Y=q[m],C._handlers_[Y]&&C._handlers_[Y].length&&C._handlers_[Y].forEach((function(P){P.call(C,{type:Y,target:C},f)}))},c.prototype.config=function(P){var f=this;f.options=f.defaults||{},P&&(f.options=function(P,f){var Y={};for(var C in P)P.hasOwnProperty(C)&&f.hasOwnProperty(C)?Y[C]=f[C]:P.hasOwnProperty(C)&&(Y[C]=P[C]);return Y}(f.options,P))},c.prototype.bindEvt=function(P,f){var C=this;return C._domHandlers_=C._domHandlers_||{},C._domHandlers_[f]=function(){"function"==typeof C["on"+f]?C["on"+f].apply(C,arguments):console.warn('[WARNING] : Missing "on'+f+'" handler.')},o(P,Y[f],C._domHandlers_[f]),v[f]&&o(P,v[f],C._domHandlers_[f]),C},c.prototype.unbindEvt=function(P,f){var C=this;return C._domHandlers_=C._domHandlers_||{},w(P,Y[f],C._domHandlers_[f]),v[f]&&w(P,v[f],C._domHandlers_[f]),delete C._domHandlers_[f],this};const T=c;function U(P,f){return this.identifier=f.identifier,this.position=f.position,this.frontPosition=f.frontPosition,this.collection=P,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(f),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=U.id,U.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}U.prototype=new T,U.constructor=U,U.id=0,U.prototype.buildEl=function(P){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},U.prototype.stylize=function(){if(this.options.dataOnly)return this;var P=this.options.fadeTime+"ms",f=function(){var P=i("borderRadius");for(var f in P)P.hasOwnProperty(f)&&(P[f]="50%");return P}(),Y=r("transition","opacity",P),C={};return C.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},C.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},C.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},u(C.el,Y),"circle"===this.options.shape&&u(C.back,f),u(C.front,f),this.applyStyles(C),this},U.prototype.applyStyles=function(P){for(var f in this.ui)if(this.ui.hasOwnProperty(f))for(var Y in P[f])this.ui[f].style[Y]=P[f][Y];return this},U.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},U.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},U.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},U.prototype.show=function(P){var f=this;return f.options.dataOnly||(clearTimeout(f.removeTimeout),clearTimeout(f.showTimeout),clearTimeout(f.restTimeout),f.addToDom(),f.restCallback(),setTimeout((function(){f.ui.el.style.opacity=1}),0),f.showTimeout=setTimeout((function(){f.trigger("shown",f.instance),"function"==typeof P&&P.call(this)}),f.options.fadeTime)),f},U.prototype.hide=function(P){var f=this;if(f.options.dataOnly)return f;if(f.ui.el.style.opacity=f.options.restOpacity,clearTimeout(f.removeTimeout),clearTimeout(f.showTimeout),clearTimeout(f.restTimeout),f.removeTimeout=setTimeout((function(){var Y="dynamic"===f.options.mode?"none":"block";f.ui.el.style.display=Y,"function"==typeof P&&P.call(f),f.trigger("hidden",f.instance)}),f.options.fadeTime),f.options.restJoystick){var Y=f.options.restJoystick,C={};C.x=!0===Y||!1!==Y.x?0:f.instance.frontPosition.x,C.y=!0===Y||!1!==Y.y?0:f.instance.frontPosition.y,f.setPosition(P,C)}return f},U.prototype.setPosition=function(P,f){var Y=this;Y.frontPosition={x:f.x,y:f.y};var C=Y.options.fadeTime+"ms",q={};q.front=r("transition",["transform"],C);var m={front:{}};m.front={transform:"translate("+Y.frontPosition.x+"px,"+Y.frontPosition.y+"px)"},Y.applyStyles(q),Y.applyStyles(m),Y.restTimeout=setTimeout((function(){"function"==typeof P&&P.call(Y),Y.restCallback()}),Y.options.fadeTime)},U.prototype.restCallback=function(){var P=this,f={};f.front=r("transition","none",""),P.applyStyles(f),P.trigger("rested",P.instance)},U.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},U.prototype.computeDirection=function(P){var f,Y,C,q=P.angle.radian,m=Math.PI/4,L=Math.PI/2;if(q>m&&q<3*m&&!P.lockX?f="up":q>-m&&q<=m&&!P.lockY?f="left":q>3*-m&&q<=-m&&!P.lockX?f="down":P.lockY||(f="right"),P.lockY||(Y=q>-L&&q<L?"left":"right"),P.lockX||(C=q>0?"up":"down"),P.force>this.options.threshold){var o,w={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(w[o]=this.direction[o]);var d={};for(o in this.direction={x:Y,y:C,angle:f},P.direction=this.direction,w)w[o]===this.direction[o]&&(d[o]=!0);if(d.x&&d.y&&d.angle)return P;d.x&&d.y||this.trigger("plain",P),d.x||this.trigger("plain:"+Y,P),d.y||this.trigger("plain:"+C,P),d.angle||this.trigger("dir dir:"+f,P)}else this.resetDirection();return P};const D=U;function j(P,f){var Y=this;Y.nipples=[],Y.idles=[],Y.actives=[],Y.ids=[],Y.pressureIntervals={},Y.manager=P,Y.id=j.id,j.id+=1,Y.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Y.config(f),"static"!==Y.options.mode&&"semi"!==Y.options.mode||(Y.options.multitouch=!1),Y.options.multitouch||(Y.options.maxNumberOfNipples=1);var C=getComputedStyle(Y.options.zone.parentElement);return C&&"flex"===C.display&&(Y.parentIsFlex=!0),Y.updateBox(),Y.prepareNipples(),Y.Kr(),Y.begin(),Y.nipples}j.prototype=new T,j.constructor=j,j.id=0,j.prototype.prepareNipples=function(){var P=this,f=P.nipples;f.on=P.on.bind(P),f.off=P.off.bind(P),f.options=P.options,f.destroy=P.destroy.bind(P),f.ids=P.ids,f.id=P.id,f.processOnMove=P.processOnMove.bind(P),f.processOnEnd=P.processOnEnd.bind(P),f.get=function(P){if(void 0===P)return f[0];for(var Y=0,C=f.length;Y<C;Y+=1)if(f[Y].identifier===P)return f[Y];return!1}},j.prototype.Kr=function(){var P=this;P.bindEvt(P.options.zone,"start"),P.options.zone.style.touchAction="none",P.options.zone.style.msTouchAction="none"},j.prototype.begin=function(){var P=this,f=P.options;if("static"===f.mode){var Y=P.createNipple(f.position,P.manager.getIdentifier());Y.add(),P.idles.push(Y)}},j.prototype.createNipple=function(P,f){var Y=this,C=Y.manager.scroll,q={},m=Y.options,L=Y.parentIsFlex?C.x:C.x+Y.box.left,o=Y.parentIsFlex?C.y:C.y+Y.box.top;if(P.x&&P.y)q={x:P.x-L,y:P.y-o};else if(P.top||P.right||P.bottom||P.left){var w=document.createElement("DIV");w.style.display="hidden",w.style.top=P.top,w.style.right=P.right,w.style.bottom=P.bottom,w.style.left=P.left,w.style.position="absolute",m.zone.appendChild(w);var d=w.getBoundingClientRect();m.zone.removeChild(w),q=P,P={x:d.left+C.x,y:d.top+C.y}}var R=new D(Y,{color:m.color,size:m.size,threshold:m.threshold,fadeTime:m.fadeTime,dataOnly:m.dataOnly,restJoystick:m.restJoystick,restOpacity:m.restOpacity,mode:m.mode,identifier:f,position:P,zone:m.zone,frontPosition:{x:0,y:0},shape:m.shape});return m.dataOnly||(y(R.ui.el,q),y(R.ui.front,R.frontPosition)),Y.nipples.push(R),Y.trigger("added "+R.identifier+":added",R),Y.manager.trigger("added "+R.identifier+":added",R),Y.bindNipple(R),R},j.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},j.prototype.bindNipple=function(P){var f,Y=this,C=function(P,C){f=P.type+" "+C.id+":"+P.type,Y.trigger(f,C)};P.on("destroyed",Y.onDestroyed.bind(Y)),P.on("shown hidden rested dir plain",C),P.on("dir:up dir:right dir:down dir:left",C),P.on("plain:up plain:right plain:down plain:left",C)},j.prototype.pressureFn=function(P,f,Y){var C=this,q=0;clearInterval(C.pressureIntervals[Y]),C.pressureIntervals[Y]=setInterval(function(){var Y=P.force||P.pressure||P.webkitForce||0;Y!==q&&(f.trigger("pressure",Y),C.trigger("pressure "+f.identifier+":pressure",Y),q=Y)}.bind(C),100)},j.prototype.onstart=function(P){var f=this,Y=f.options,C=P;return P=d(P),f.updateBox(),g(P,(function(q){f.actives.length<Y.maxNumberOfNipples?f.processOnStart(q):C.type.match(/^touch/)&&(Object.keys(f.manager.ids).forEach((function(Y){if(Object.values(C.touches).findIndex((function(P){return P.identifier===Y}))<0){var q=[P[0]];q.identifier=Y,f.processOnEnd(q)}})),f.actives.length<Y.maxNumberOfNipples&&f.processOnStart(q))})),f.manager.bindDocument(),!1},j.prototype.processOnStart=function(P){var f,Y=this,q=Y.options,m=Y.manager.getIdentifier(P),L=P.force||P.pressure||P.webkitForce||0,o={x:P.pageX,y:P.pageY},w=Y.getOrCreate(m,o);w.identifier!==m&&Y.manager.removeIdentifier(w.identifier),w.identifier=m;var d=function(f){f.trigger("start",f),Y.trigger("start "+f.id+":start",f),f.show(),L>0&&Y.pressureFn(P,f,f.identifier),Y.processOnMove(P)};if((f=Y.idles.indexOf(w))>=0&&Y.idles.splice(f,1),Y.actives.push(w),Y.ids.push(w.identifier),"semi"!==q.mode)d(w);else{if(!(C(o,w.position)<=q.catchDistance))return w.destroy(),void Y.processOnStart(P);d(w)}return w},j.prototype.getOrCreate=function(P,f){var Y,C=this,q=C.options;return/(semi|static)/.test(q.mode)?(Y=C.idles[0])?(C.idles.splice(0,1),Y):"semi"===q.mode?C.createNipple(f,P):(console.warn("Coudln't find the needed nipple."),!1):Y=C.createNipple(f,P)},j.prototype.processOnMove=function(P){var f=this,Y=f.options,m=f.manager.getIdentifier(P),L=f.nipples.get(m),o=f.manager.scroll;if(function(P){return isNaN(P.buttons)?0!==P.pressure:0!==P.buttons}(P)){if(!L)return console.error("Found zombie joystick with ID "+m),void f.manager.removeIdentifier(m);if(Y.dynamicPage){var w=L.el.getBoundingClientRect();L.position={x:o.x+w.left,y:o.y+w.top}}L.identifier=m;var d=L.options.size/2,R={x:P.pageX,y:P.pageY};Y.lockX&&(R.y=L.position.y),Y.lockY&&(R.x=L.position.x);var y,r,i,u,g,S,K,M,V,O,n=C(R,L.position),l=(y=R,i=(r=L.position).x-y.x,u=r.y-y.y,function(P){return P*(180/Math.PI)}(Math.atan2(u,i))),v=q(l),c=n/d,T={distance:n,position:R};if("circle"===L.options.shape?(g=Math.min(n,d),K=L.position,M=g,O={x:0,y:0},V=q(V=l),O.x=K.x-M*Math.cos(V),O.y=K.y-M*Math.sin(V),S=O):(S=function(P,f,Y){return{x:Math.min(Math.max(P.x,f.x-Y),f.x+Y),y:Math.min(Math.max(P.y,f.y-Y),f.y+Y)}}(R,L.position,d),g=C(S,L.position)),Y.follow){if(n>d){var U=R.x-S.x,D=R.y-S.y;L.position.x+=U,L.position.y+=D,L.el.style.top=L.position.y-(f.box.top+o.y)+"px",L.el.style.left=L.position.x-(f.box.left+o.x)+"px",n=C(R,L.position)}}else R=S,n=g;var j=R.x-L.position.x,e=R.y-L.position.y;L.frontPosition={x:j,y:e},Y.dataOnly||(L.ui.front.style.transform="translate("+j+"px,"+e+"px)");var s={identifier:L.identifier,position:R,force:c,pressure:P.force||P.pressure||P.webkitForce||0,distance:n,angle:{radian:v,degree:l},vector:{x:j/d,y:-e/d},raw:T,instance:L,lockX:Y.lockX,lockY:Y.lockY};(s=L.computeDirection(s)).angle={radian:q(180-l),degree:180-l},L.trigger("move",s),f.trigger("move "+L.id+":move",s)}else this.processOnEnd(P)},j.prototype.processOnEnd=function(P){var f=this,Y=f.options,C=f.manager.getIdentifier(P),q=f.nipples.get(C),m=f.manager.removeIdentifier(q.identifier);q&&(Y.dataOnly||q.hide((function(){"dynamic"===Y.mode&&(q.trigger("removed",q),f.trigger("removed "+q.id+":removed",q),f.manager.trigger("removed "+q.id+":removed",q),q.destroy())})),clearInterval(f.pressureIntervals[q.identifier]),q.resetDirection(),q.trigger("end",q),f.trigger("end "+q.id+":end",q),f.ids.indexOf(q.identifier)>=0&&f.ids.splice(f.ids.indexOf(q.identifier),1),f.actives.indexOf(q)>=0&&f.actives.splice(f.actives.indexOf(q),1),/(semi|static)/.test(Y.mode)?f.idles.push(q):f.nipples.indexOf(q)>=0&&f.nipples.splice(f.nipples.indexOf(q),1),f.manager.unbindDocument(),/(semi|static)/.test(Y.mode)&&(f.manager.ids[m.id]=m.identifier))},j.prototype.onDestroyed=function(P,f){var Y=this;Y.nipples.indexOf(f)>=0&&Y.nipples.splice(Y.nipples.indexOf(f),1),Y.actives.indexOf(f)>=0&&Y.actives.splice(Y.actives.indexOf(f),1),Y.idles.indexOf(f)>=0&&Y.idles.splice(Y.idles.indexOf(f),1),Y.ids.indexOf(f.identifier)>=0&&Y.ids.splice(Y.ids.indexOf(f.identifier),1),Y.manager.removeIdentifier(f.identifier),Y.manager.unbindDocument()},j.prototype.destroy=function(){var P=this;for(var f in P.unbindEvt(P.options.zone,"start"),P.nipples.forEach((function(P){P.destroy()})),P.pressureIntervals)P.pressureIntervals.hasOwnProperty(f)&&clearInterval(P.pressureIntervals[f]);P.trigger("destroyed",P.nipples),P.manager.unbindDocument(),P.off()};const e=j;function s(P){var f=this;f.ids={},f.index=0,f.collections=[],f.scroll=R(),f.config(P),f.prepareCollections();var Y=function(){var P;f.collections.forEach((function(Y){Y.forEach((function(Y){P=Y.el.getBoundingClientRect(),Y.position={x:f.scroll.x+P.left,y:f.scroll.y+P.top}}))}))};o(window,"resize",(function(){L(Y)}));var C=function(){f.scroll=R()};return o(window,"scroll",(function(){L(C)})),f.collections}s.prototype=new T,s.constructor=s,s.prototype.prepareCollections=function(){var P=this;P.collections.create=P.create.bind(P),P.collections.on=P.on.bind(P),P.collections.off=P.off.bind(P),P.collections.destroy=P.destroy.bind(P),P.collections.get=function(f){var Y;return P.collections.every((function(P){return!(Y=P.get(f))})),Y}},s.prototype.create=function(P){return this.createCollection(P)},s.prototype.createCollection=function(P){var f=this,Y=new e(f,P);return f.bindCollection(Y),f.collections.push(Y),Y},s.prototype.bindCollection=function(P){var f,Y=this,C=function(P,C){f=P.type+" "+C.id+":"+P.type,Y.trigger(f,C)};P.on("destroyed",Y.onDestroyed.bind(Y)),P.on("shown hidden rested dir plain",C),P.on("dir:up dir:right dir:down dir:left",C),P.on("plain:up plain:right plain:down plain:left",C)},s.prototype.bindDocument=function(){var P=this;P.binded||(P.bindEvt(document,"move").bindEvt(document,"end"),P.binded=!0)},s.prototype.unbindDocument=function(P){var f=this;Object.keys(f.ids).length&&!0!==P||(f.unbindEvt(document,"move").unbindEvt(document,"end"),f.binded=!1)},s.prototype.getIdentifier=function(P){var f;return P?void 0===(f=void 0===P.identifier?P.pointerId:P.identifier)&&(f=this.latest||0):f=this.index,void 0===this.ids[f]&&(this.ids[f]=this.index,this.index+=1),this.latest=f,this.ids[f]},s.prototype.removeIdentifier=function(P){var f={};for(var Y in this.ids)if(this.ids[Y]===P){f.id=Y,f.identifier=this.ids[Y],delete this.ids[Y];break}return f},s.prototype.onmove=function(P){return this.onAny("move",P),!1},s.prototype.onend=function(P){return this.onAny("end",P),!1},s.prototype.oncancel=function(P){return this.onAny("end",P),!1},s.prototype.onAny=function(P,f){var Y,C=this,q="processOn"+P.charAt(0).toUpperCase()+P.slice(1);f=d(f);var m=function(P,f,Y){Y.ids.indexOf(f)>=0&&(Y[q](P),P._found_=!0)};return g(f,(function(P){Y=C.getIdentifier(P),g(C.collections,m.bind(null,P,Y)),P._found_||C.removeIdentifier(Y)})),!1},s.prototype.destroy=function(){var P=this;P.unbindDocument(!0),P.ids={},P.index=0,P.collections.forEach((function(P){P.destroy()})),P.off()},s.prototype.onDestroyed=function(P,f){var Y=this;if(Y.collections.indexOf(f)<0)return!1;Y.collections.splice(Y.collections.indexOf(f),1)};var a=new s;const Q={create:function(P){return a.create(P)},factory:a};return f.default})(),P.exports=f()},12338:(P,f,Y)=>{"use strict";const{Deflate:C,deflate:q,deflateRaw:m,gzip:L}=Y(12347),{Inflate:o,inflate:w,inflateRaw:d,ungzip:R}=Y(12401),y=Y(12375);P.exports.Deflate=C,P.exports.deflate=q,P.exports.deflateRaw=m,P.exports.gzip=L,P.exports.Inflate=o,P.exports.inflate=w,P.exports.inflateRaw=d,P.exports.ungzip=R,P.exports.constants=y},12347:(P,f,Y)=>{"use strict";const C=Y(12352),q=Y(12380),m=Y(12386),L=Y(12367),o=Y(12394),w=Object.prototype.toString,{Z_NO_FLUSH:d,Z_SYNC_FLUSH:R,Z_FULL_FLUSH:y,Z_FINISH:r,Z_OK:i,Z_STREAM_END:u,Z_DEFAULT_COMPRESSION:g,Z_DEFAULT_STRATEGY:S,Z_DEFLATED:K}=Y(12375);function M(P){this.options=q.assign({level:g,method:K,xP:16384,windowBits:15,memLevel:8,strategy:S},P||{});let f=this.options;f.raw&&f.windowBits>0?f.windowBits=-f.windowBits:f.gzip&&f.windowBits>0&&f.windowBits<16&&(f.windowBits+=16),this.err=0,this.Rf="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;let Y=C.deflateInit2(this.strm,f.level,f.method,f.windowBits,f.memLevel,f.strategy);if(Y!==i)throw new Error(L[Y]);if(f.header&&C.deflateSetHeader(this.strm,f.header),f.dictionary){let P;if(P="string"===typeof f.dictionary?m.string2buf(f.dictionary):"[object ArrayBuffer]"===w.call(f.dictionary)?new Uint8Array(f.dictionary):f.dictionary,Y=C.deflateSetDictionary(this.strm,P),Y!==i)throw new Error(L[Y]);this._dict_set=!0}}function V(P,f){const Y=new M(f);if(Y.push(P,!0),Y.err)throw Y.Rf||L[Y.err];return Y.result}M.prototype.push=function(P,f){const Y=this.strm,q=this.options.xP;let L,o;if(this.ended)return!1;for(o=f===~~f?f:!0===f?r:d,"string"===typeof P?Y.input=m.string2buf(P):"[object ArrayBuffer]"===w.call(P)?Y.input=new Uint8Array(P):Y.input=P,Y.next_in=0,Y.avail_in=Y.input.length;;)if(0===Y.avail_out&&(Y.output=new Uint8Array(q),Y.next_out=0,Y.avail_out=q),(o===R||o===y)&&Y.avail_out<=6)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else{if(L=C.deflate(Y,o),L===u)return Y.next_out>0&&this.onData(Y.output.subarray(0,Y.next_out)),L=C.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===i;if(0!==Y.avail_out){if(o>0&&Y.next_out>0)this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;else if(0===Y.avail_in)break}else this.onData(Y.output)}return!0},M.prototype.onData=function(P){this.chunks.push(P)},M.prototype.onEnd=function(P){P===i&&(this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=P,this.Rf=this.strm.Rf},P.exports.Deflate=M,P.exports.deflate=V,P.exports.deflateRaw=function(P,f){return(f=f||{}).raw=!0,V(P,f)},P.exports.gzip=function(P,f){return(f=f||{}).gzip=!0,V(P,f)},P.exports.constants=Y(12375)},12401:(P,f,Y)=>{"use strict";const C=Y(12408),q=Y(12380),m=Y(12386),L=Y(12367),o=Y(12394),w=Y(12420),d=Object.prototype.toString,{Z_NO_FLUSH:R,Z_FINISH:y,Z_OK:r,Z_STREAM_END:i,Z_NEED_DICT:u,Z_STREAM_ERROR:g,Z_DATA_ERROR:S,Z_MEM_ERROR:K}=Y(12375);function M(P){this.options=q.assign({xP:65536,windowBits:15,to:""},P||{});const f=this.options;f.raw&&f.windowBits>=0&&f.windowBits<16&&(f.windowBits=-f.windowBits,0===f.windowBits&&(f.windowBits=-15)),!(f.windowBits>=0&&f.windowBits<16)||P&&P.windowBits||(f.windowBits+=32),f.windowBits>15&&f.windowBits<48&&0===(15&f.windowBits)&&(f.windowBits|=15),this.err=0,this.Rf="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;let Y=C.inflateInit2(this.strm,f.windowBits);if(Y!==r)throw new Error(L[Y]);if(this.header=new w,C.inflateGetHeader(this.strm,this.header),f.dictionary&&("string"===typeof f.dictionary?f.dictionary=m.string2buf(f.dictionary):"[object ArrayBuffer]"===d.call(f.dictionary)&&(f.dictionary=new Uint8Array(f.dictionary)),f.raw&&(Y=C.inflateSetDictionary(this.strm,f.dictionary),Y!==r)))throw new Error(L[Y])}function V(P,f){const Y=new M(f);if(Y.push(P),Y.err)throw Y.Rf||L[Y.err];return Y.result}M.prototype.push=function(P,f){const Y=this.strm,q=this.options.xP,L=this.options.dictionary;let o,w,M;if(this.ended)return!1;for(w=f===~~f?f:!0===f?y:R,"[object ArrayBuffer]"===d.call(P)?Y.input=new Uint8Array(P):Y.input=P,Y.next_in=0,Y.avail_in=Y.input.length;;){for(0===Y.avail_out&&(Y.output=new Uint8Array(q),Y.next_out=0,Y.avail_out=q),o=C.inflate(Y,w),o===u&&L&&(o=C.inflateSetDictionary(Y,L),o===r?o=C.inflate(Y,w):o===S&&(o=u));Y.avail_in>0&&o===i&&Y.state.wrap>0&&0!==P[Y.next_in];)C.inflateReset(Y),o=C.inflate(Y,w);switch(o){case g:case S:case u:case K:return this.onEnd(o),this.ended=!0,!1}if(M=Y.avail_out,Y.next_out&&(0===Y.avail_out||o===i))if("string"===this.options.to){let P=m.utf8border(Y.output,Y.next_out),f=Y.next_out-P,C=m.buf2string(Y.output,P);Y.next_out=f,Y.avail_out=q-f,f&&Y.output.set(Y.output.subarray(P,P+f),0),this.onData(C)}else this.onData(Y.output.length===Y.next_out?Y.output:Y.output.subarray(0,Y.next_out));if(o!==r||0!==M){if(o===i)return o=C.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===Y.avail_in)break}}return!0},M.prototype.onData=function(P){this.chunks.push(P)},M.prototype.onEnd=function(P){P===r&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=q.flattenChunks(this.chunks)),this.chunks=[],this.err=P,this.Rf=this.strm.Rf},P.exports.Inflate=M,P.exports.inflate=V,P.exports.inflateRaw=function(P,f){return(f=f||{}).raw=!0,V(P,f)},P.exports.ungzip=V,P.exports.constants=Y(12375)},12380:P=>{"use strict";const f=(P,f)=>Object.prototype.hasOwnProperty.call(P,f);P.exports.assign=function(P){const Y=Array.prototype.slice.call(arguments,1);for(;Y.length;){const C=Y.shift();if(C){if("object"!==typeof C)throw new TypeError(C+"must be non-object");for(const Y in C)f(C,Y)&&(P[Y]=C[Y])}}return P},P.exports.flattenChunks=P=>{let f=0;for(let C=0,q=P.length;C<q;C++)f+=P[C].length;const Y=new Uint8Array(f);for(let C=0,q=0,m=P.length;C<m;C++){let f=P[C];Y.set(f,q),q+=f.length}return Y}},12386:P=>{"use strict";let f=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(C){f=!1}const Y=new Uint8Array(256);for(let q=0;q<256;q++)Y[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;Y[254]=Y[254]=1,P.exports.string2buf=P=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(P);let f,Y,C,q,m,L=P.length,o=0;for(q=0;q<L;q++)Y=P.charCodeAt(q),55296===(64512&Y)&&q+1<L&&(C=P.charCodeAt(q+1),56320===(64512&C)&&(Y=65536+(Y-55296<<10)+(C-56320),q++)),o+=Y<128?1:Y<2048?2:Y<65536?3:4;for(f=new Uint8Array(o),m=0,q=0;m<o;q++)Y=P.charCodeAt(q),55296===(64512&Y)&&q+1<L&&(C=P.charCodeAt(q+1),56320===(64512&C)&&(Y=65536+(Y-55296<<10)+(C-56320),q++)),Y<128?f[m++]=Y:Y<2048?(f[m++]=192|Y>>>6,f[m++]=128|63&Y):Y<65536?(f[m++]=224|Y>>>12,f[m++]=128|Y>>>6&63,f[m++]=128|63&Y):(f[m++]=240|Y>>>18,f[m++]=128|Y>>>12&63,f[m++]=128|Y>>>6&63,f[m++]=128|63&Y);return f};P.exports.buf2string=(P,C)=>{const q=C||P.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(P.subarray(0,C));let m,L;const o=new Array(2*q);for(L=0,m=0;m<q;){let f=P[m++];if(f<128){o[L++]=f;continue}let C=Y[f];if(C>4)o[L++]=65533,m+=C-1;else{for(f&=2===C?31:3===C?15:7;C>1&&m<q;)f=f<<6|63&P[m++],C--;C>1?o[L++]=65533:f<65536?o[L++]=f:(f-=65536,o[L++]=55296|f>>10&1023,o[L++]=56320|1023&f)}}return((P,Y)=>{if(Y<65534&&P.subarray&&f)return String.fromCharCode.apply(null,P.length===Y?P:P.subarray(0,Y));let C="";for(let f=0;f<Y;f++)C+=String.fromCharCode(P[f]);return C})(o,L)},P.exports.utf8border=(P,f)=>{(f=f||P.length)>P.length&&(f=P.length);let C=f-1;for(;C>=0&&128===(192&P[C]);)C--;return C<0||0===C?f:C+Y[P[C]]>f?C:f}},12361:P=>{"use strict";P.exports=(P,f,Y,C)=>{let q=65535&P,m=P>>>16&65535,L=0;for(;0!==Y;){L=Y>2e3?2e3:Y,Y-=L;do{q=q+f[C++]|0,m=m+q|0}while(--L);q%=65521,m%=65521}return q|m<<16}},12375:P=>{"use strict";P.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12365:P=>{"use strict";const f=new Uint32Array((()=>{let P,f=[];for(var Y=0;Y<256;Y++){P=Y;for(var C=0;C<8;C++)P=1&P?3988292384^P>>>1:P>>>1;f[Y]=P}return f})());P.exports=(P,Y,C,q)=>{const m=f,L=q+C;P^=-1;for(let f=q;f<L;f++)P=P>>>8^m[255&(P^Y[f])];return~P}},12352:(P,f,Y)=>{"use strict";const{_tr_init:C,_tr_stored_block:q,_tr_flush_block:m,_tr_tally:L,_tr_align:o}=Y(12358),w=Y(12361),d=Y(12365),R=Y(12367),{Z_NO_FLUSH:y,Z_PARTIAL_FLUSH:r,Z_FULL_FLUSH:i,Z_FINISH:u,Z_BLOCK:g,Z_OK:S,Z_STREAM_END:K,Z_STREAM_ERROR:M,Z_DATA_ERROR:V,Z_BUF_ERROR:O,Z_DEFAULT_COMPRESSION:n,Z_FILTERED:l,Z_HUFFMAN_ONLY:v,Z_RLE:c,Z_FIXED:T,Z_DEFAULT_STRATEGY:U,Z_UNKNOWN:D,Z_DEFLATED:j}=Y(12375),e=258,s=262,a=103,Q=113,J=666,N=(P,f)=>(P.Rf=R[f],f),I=P=>(P<<1)-(P>4?9:0),X=P=>{let f=P.length;for(;--f>=0;)P[f]=0};let x=(P,f,Y)=>(f<<P.hash_shift^Y)&P.hash_mask;const k=P=>{const f=P.state;let Y=f.pending;Y>P.avail_out&&(Y=P.avail_out),0!==Y&&(P.output.set(f.pending_buf.subarray(f.pending_out,f.pending_out+Y),P.next_out),P.next_out+=Y,f.pending_out+=Y,P.total_out+=Y,P.avail_out-=Y,f.pending-=Y,0===f.pending&&(f.pending_out=0))},Z=(P,f)=>{m(P,P.block_start>=0?P.block_start:-1,P.strstart-P.block_start,f),P.block_start=P.strstart,k(P.strm)},A=(P,f)=>{P.pending_buf[P.pending++]=f},E=(P,f)=>{P.pending_buf[P.pending++]=f>>>8&255,P.pending_buf[P.pending++]=255&f},t=(P,f,Y,C)=>{let q=P.avail_in;return q>C&&(q=C),0===q?0:(P.avail_in-=q,f.set(P.input.subarray(P.next_in,P.next_in+q),Y),1===P.state.wrap?P.adler=w(P.adler,f,q,Y):2===P.state.wrap&&(P.adler=d(P.adler,f,q,Y)),P.next_in+=q,P.total_in+=q,q)},G=(P,f)=>{let Y,C,q=P.max_chain_length,m=P.strstart,L=P.prev_length,o=P.nice_match;const w=P.strstart>P.w_size-s?P.strstart-(P.w_size-s):0,d=P.window,R=P.w_mask,y=P.prev,r=P.strstart+e;let i=d[m+L-1],u=d[m+L];P.prev_length>=P.good_match&&(q>>=2),o>P.lookahead&&(o=P.lookahead);do{if(Y=f,d[Y+L]===u&&d[Y+L-1]===i&&d[Y]===d[m]&&d[++Y]===d[m+1]){m+=2,Y++;do{}while(d[++m]===d[++Y]&&d[++m]===d[++Y]&&d[++m]===d[++Y]&&d[++m]===d[++Y]&&d[++m]===d[++Y]&&d[++m]===d[++Y]&&d[++m]===d[++Y]&&d[++m]===d[++Y]&&m<r);if(C=e-(r-m),m=r-e,C>L){if(P.match_start=f,L=C,C>=o)break;i=d[m+L-1],u=d[m+L]}}}while((f=y[f&R])>w&&0!==--q);return L<=P.lookahead?L:P.lookahead},z=P=>{const f=P.w_size;let Y,C,q,m,L;do{if(m=P.window_size-P.lookahead-P.strstart,P.strstart>=f+(f-s)){P.window.set(P.window.subarray(f,f+f),0),P.match_start-=f,P.strstart-=f,P.block_start-=f,C=P.hash_size,Y=C;do{q=P.head[--Y],P.head[Y]=q>=f?q-f:0}while(--C);C=f,Y=C;do{q=P.prev[--Y],P.prev[Y]=q>=f?q-f:0}while(--C);m+=f}if(0===P.strm.avail_in)break;if(C=t(P.strm,P.window,P.strstart+P.lookahead,m),P.lookahead+=C,P.lookahead+P.insert>=3)for(L=P.strstart-P.insert,P.ins_h=P.window[L],P.ins_h=x(P,P.ins_h,P.window[L+1]);P.insert&&(P.ins_h=x(P,P.ins_h,P.window[L+3-1]),P.prev[L&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=L,L++,P.insert--,!(P.lookahead+P.insert<3)););}while(P.lookahead<s&&0!==P.strm.avail_in)},B=(P,f)=>{let Y,C;for(;;){if(P.lookahead<s){if(z(P),P.lookahead<s&&f===y)return 1;if(0===P.lookahead)break}if(Y=0,P.lookahead>=3&&(P.ins_h=x(P,P.ins_h,P.window[P.strstart+3-1]),Y=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),0!==Y&&P.strstart-Y<=P.w_size-s&&(P.match_length=G(P,Y)),P.match_length>=3)if(C=L(P,P.strstart-P.match_start,P.match_length-3),P.lookahead-=P.match_length,P.match_length<=P.max_lazy_match&&P.lookahead>=3){P.match_length--;do{P.strstart++,P.ins_h=x(P,P.ins_h,P.window[P.strstart+3-1]),Y=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart}while(0!==--P.match_length);P.strstart++}else P.strstart+=P.match_length,P.match_length=0,P.ins_h=P.window[P.strstart],P.ins_h=x(P,P.ins_h,P.window[P.strstart+1]);else C=L(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++;if(C&&(Z(P,!1),0===P.strm.avail_out))return 1}return P.insert=P.strstart<2?P.strstart:2,f===u?(Z(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(Z(P,!1),0===P.strm.avail_out)?1:2},b=(P,f)=>{let Y,C,q;for(;;){if(P.lookahead<s){if(z(P),P.lookahead<s&&f===y)return 1;if(0===P.lookahead)break}if(Y=0,P.lookahead>=3&&(P.ins_h=x(P,P.ins_h,P.window[P.strstart+3-1]),Y=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),P.prev_length=P.match_length,P.prev_match=P.match_start,P.match_length=2,0!==Y&&P.prev_length<P.max_lazy_match&&P.strstart-Y<=P.w_size-s&&(P.match_length=G(P,Y),P.match_length<=5&&(P.strategy===l||3===P.match_length&&P.strstart-P.match_start>4096)&&(P.match_length=2)),P.prev_length>=3&&P.match_length<=P.prev_length){q=P.strstart+P.lookahead-3,C=L(P,P.strstart-1-P.prev_match,P.prev_length-3),P.lookahead-=P.prev_length-1,P.prev_length-=2;do{++P.strstart<=q&&(P.ins_h=x(P,P.ins_h,P.window[P.strstart+3-1]),Y=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart)}while(0!==--P.prev_length);if(P.match_available=0,P.match_length=2,P.strstart++,C&&(Z(P,!1),0===P.strm.avail_out))return 1}else if(P.match_available){if(C=L(P,0,P.window[P.strstart-1]),C&&Z(P,!1),P.strstart++,P.lookahead--,0===P.strm.avail_out)return 1}else P.match_available=1,P.strstart++,P.lookahead--}return P.match_available&&(C=L(P,0,P.window[P.strstart-1]),P.match_available=0),P.insert=P.strstart<2?P.strstart:2,f===u?(Z(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(Z(P,!1),0===P.strm.avail_out)?1:2};function H(P,f,Y,C,q){this.good_length=P,this.max_lazy=f,this.nice_length=Y,this.max_chain=C,this.func=q}const W=[new H(0,0,0,0,((P,f)=>{let Y=65535;for(Y>P.pending_buf_size-5&&(Y=P.pending_buf_size-5);;){if(P.lookahead<=1){if(z(P),0===P.lookahead&&f===y)return 1;if(0===P.lookahead)break}P.strstart+=P.lookahead,P.lookahead=0;const C=P.block_start+Y;if((0===P.strstart||P.strstart>=C)&&(P.lookahead=P.strstart-C,P.strstart=C,Z(P,!1),0===P.strm.avail_out))return 1;if(P.strstart-P.block_start>=P.w_size-s&&(Z(P,!1),0===P.strm.avail_out))return 1}return P.insert=0,f===u?(Z(P,!0),0===P.strm.avail_out?3:4):(P.strstart>P.block_start&&(Z(P,!1),P.strm.avail_out),1)})),new H(4,4,8,4,B),new H(4,5,16,8,B),new H(4,6,32,32,B),new H(4,4,16,16,b),new H(8,16,32,32,b),new H(8,16,128,128,b),new H(8,32,128,256,b),new H(32,128,258,1024,b),new H(32,258,258,4096,b)];function p(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=j,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),X(this.dyn_ltree),X(this.dyn_dtree),X(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),X(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),X(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const h=P=>{if(!P||!P.state)return N(P,M);P.total_in=P.total_out=0,P.data_type=D;const f=P.state;return f.pending=0,f.pending_out=0,f.wrap<0&&(f.wrap=-f.wrap),f.status=f.wrap?42:Q,P.adler=2===f.wrap?0:1,f.last_flush=y,C(f),S},F=P=>{const f=h(P);var Y;return f===S&&((Y=P.state).window_size=2*Y.w_size,X(Y.head),Y.max_lazy_match=W[Y.level].max_lazy,Y.good_match=W[Y.level].good_length,Y.nice_match=W[Y.level].nice_length,Y.max_chain_length=W[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=2,Y.match_available=0,Y.ins_h=0),f},PP=(P,f,Y,C,q,m)=>{if(!P)return M;let L=1;if(f===n&&(f=6),C<0?(L=0,C=-C):C>15&&(L=2,C-=16),q<1||q>9||Y!==j||C<8||C>15||f<0||f>9||m<0||m>T)return N(P,M);8===C&&(C=9);const o=new p;return P.state=o,o.strm=P,o.wrap=L,o.gzhead=null,o.w_bits=C,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=q+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<q+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=f,o.strategy=m,o.method=Y,F(P)};P.exports.deflateInit=(P,f)=>PP(P,f,j,15,8,U),P.exports.deflateInit2=PP,P.exports.deflateReset=F,P.exports.deflateResetKeep=h,P.exports.deflateSetHeader=(P,f)=>P&&P.state?2!==P.state.wrap?M:(P.state.gzhead=f,S):M,P.exports.deflate=(P,f)=>{let Y,C;if(!P||!P.state||f>g||f<0)return P?N(P,M):M;const m=P.state;if(!P.output||!P.input&&0!==P.avail_in||m.status===J&&f!==u)return N(P,0===P.avail_out?O:M);m.strm=P;const w=m.last_flush;if(m.last_flush=f,42===m.status)if(2===m.wrap)P.adler=0,A(m,31),A(m,139),A(m,8),m.gzhead?(A(m,(m.gzhead.text?1:0)+(m.gzhead.hcrc?2:0)+(m.gzhead.extra?4:0)+(m.gzhead.name?8:0)+(m.gzhead.comment?16:0)),A(m,255&m.gzhead.time),A(m,m.gzhead.time>>8&255),A(m,m.gzhead.time>>16&255),A(m,m.gzhead.time>>24&255),A(m,9===m.level?2:m.strategy>=v||m.level<2?4:0),A(m,255&m.gzhead.os),m.gzhead.extra&&m.gzhead.extra.length&&(A(m,255&m.gzhead.extra.length),A(m,m.gzhead.extra.length>>8&255)),m.gzhead.hcrc&&(P.adler=d(P.adler,m.pending_buf,m.pending,0)),m.gzindex=0,m.status=69):(A(m,0),A(m,0),A(m,0),A(m,0),A(m,0),A(m,9===m.level?2:m.strategy>=v||m.level<2?4:0),A(m,3),m.status=Q);else{let f=j+(m.w_bits-8<<4)<<8,Y=-1;Y=m.strategy>=v||m.level<2?0:m.level<6?1:6===m.level?2:3,f|=Y<<6,0!==m.strstart&&(f|=32),f+=31-f%31,m.status=Q,E(m,f),0!==m.strstart&&(E(m,P.adler>>>16),E(m,65535&P.adler)),P.adler=1}if(69===m.status)if(m.gzhead.extra){for(Y=m.pending;m.gzindex<(65535&m.gzhead.extra.length)&&(m.pending!==m.pending_buf_size||(m.gzhead.hcrc&&m.pending>Y&&(P.adler=d(P.adler,m.pending_buf,m.pending-Y,Y)),k(P),Y=m.pending,m.pending!==m.pending_buf_size));)A(m,255&m.gzhead.extra[m.gzindex]),m.gzindex++;m.gzhead.hcrc&&m.pending>Y&&(P.adler=d(P.adler,m.pending_buf,m.pending-Y,Y)),m.gzindex===m.gzhead.extra.length&&(m.gzindex=0,m.status=73)}else m.status=73;if(73===m.status)if(m.gzhead.name){Y=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>Y&&(P.adler=d(P.adler,m.pending_buf,m.pending-Y,Y)),k(P),Y=m.pending,m.pending===m.pending_buf_size)){C=1;break}C=m.gzindex<m.gzhead.name.length?255&m.gzhead.name.charCodeAt(m.gzindex++):0,A(m,C)}while(0!==C);m.gzhead.hcrc&&m.pending>Y&&(P.adler=d(P.adler,m.pending_buf,m.pending-Y,Y)),0===C&&(m.gzindex=0,m.status=91)}else m.status=91;if(91===m.status)if(m.gzhead.comment){Y=m.pending;do{if(m.pending===m.pending_buf_size&&(m.gzhead.hcrc&&m.pending>Y&&(P.adler=d(P.adler,m.pending_buf,m.pending-Y,Y)),k(P),Y=m.pending,m.pending===m.pending_buf_size)){C=1;break}C=m.gzindex<m.gzhead.comment.length?255&m.gzhead.comment.charCodeAt(m.gzindex++):0,A(m,C)}while(0!==C);m.gzhead.hcrc&&m.pending>Y&&(P.adler=d(P.adler,m.pending_buf,m.pending-Y,Y)),0===C&&(m.status=a)}else m.status=a;if(m.status===a&&(m.gzhead.hcrc?(m.pending+2>m.pending_buf_size&&k(P),m.pending+2<=m.pending_buf_size&&(A(m,255&P.adler),A(m,P.adler>>8&255),P.adler=0,m.status=Q)):m.status=Q),0!==m.pending){if(k(P),0===P.avail_out)return m.last_flush=-1,S}else if(0===P.avail_in&&I(f)<=I(w)&&f!==u)return N(P,O);if(m.status===J&&0!==P.avail_in)return N(P,O);if(0!==P.avail_in||0!==m.lookahead||f!==y&&m.status!==J){let Y=m.strategy===v?((P,f)=>{let Y;for(;;){if(0===P.lookahead&&(z(P),0===P.lookahead)){if(f===y)return 1;break}if(P.match_length=0,Y=L(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,Y&&(Z(P,!1),0===P.strm.avail_out))return 1}return P.insert=0,f===u?(Z(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(Z(P,!1),0===P.strm.avail_out)?1:2})(m,f):m.strategy===c?((P,f)=>{let Y,C,q,m;const o=P.window;for(;;){if(P.lookahead<=e){if(z(P),P.lookahead<=e&&f===y)return 1;if(0===P.lookahead)break}if(P.match_length=0,P.lookahead>=3&&P.strstart>0&&(q=P.strstart-1,C=o[q],C===o[++q]&&C===o[++q]&&C===o[++q])){m=P.strstart+e;do{}while(C===o[++q]&&C===o[++q]&&C===o[++q]&&C===o[++q]&&C===o[++q]&&C===o[++q]&&C===o[++q]&&C===o[++q]&&q<m);P.match_length=e-(m-q),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=3?(Y=L(P,1,P.match_length-3),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(Y=L(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),Y&&(Z(P,!1),0===P.strm.avail_out))return 1}return P.insert=0,f===u?(Z(P,!0),0===P.strm.avail_out?3:4):P.last_lit&&(Z(P,!1),0===P.strm.avail_out)?1:2})(m,f):W[m.level].func(m,f);if(3!==Y&&4!==Y||(m.status=J),1===Y||3===Y)return 0===P.avail_out&&(m.last_flush=-1),S;if(2===Y&&(f===r?o(m):f!==g&&(q(m,0,0,!1),f===i&&(X(m.head),0===m.lookahead&&(m.strstart=0,m.block_start=0,m.insert=0))),k(P),0===P.avail_out))return m.last_flush=-1,S}return f!==u?S:m.wrap<=0?K:(2===m.wrap?(A(m,255&P.adler),A(m,P.adler>>8&255),A(m,P.adler>>16&255),A(m,P.adler>>24&255),A(m,255&P.total_in),A(m,P.total_in>>8&255),A(m,P.total_in>>16&255),A(m,P.total_in>>24&255)):(E(m,P.adler>>>16),E(m,65535&P.adler)),k(P),m.wrap>0&&(m.wrap=-m.wrap),0!==m.pending?S:K)},P.exports.deflateEnd=P=>{if(!P||!P.state)return M;const f=P.state.status;return 42!==f&&69!==f&&73!==f&&91!==f&&f!==a&&f!==Q&&f!==J?N(P,M):(P.state=null,f===Q?N(P,V):S)},P.exports.deflateSetDictionary=(P,f)=>{let Y=f.length;if(!P||!P.state)return M;const C=P.state,q=C.wrap;if(2===q||1===q&&42!==C.status||C.lookahead)return M;if(1===q&&(P.adler=w(P.adler,f,Y,0)),C.wrap=0,Y>=C.w_size){0===q&&(X(C.head),C.strstart=0,C.block_start=0,C.insert=0);let P=new Uint8Array(C.w_size);P.set(f.subarray(Y-C.w_size,Y),0),f=P,Y=C.w_size}const m=P.avail_in,L=P.next_in,o=P.input;for(P.avail_in=Y,P.next_in=0,P.input=f,z(C);C.lookahead>=3;){let P=C.strstart,f=C.lookahead-2;do{C.ins_h=x(C,C.ins_h,C.window[P+3-1]),C.prev[P&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=P,P++}while(--f);C.strstart=P,C.lookahead=2,z(C)}return C.strstart+=C.lookahead,C.block_start=C.strstart,C.insert=C.lookahead,C.lookahead=0,C.match_length=C.prev_length=2,C.match_available=0,P.next_in=L,P.input=o,P.avail_in=m,C.wrap=q,S},P.exports.deflateInfo="pako deflate (from Nodeca project)"},12420:P=>{"use strict";P.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12413:P=>{"use strict";P.exports=function(P,f){let Y,C,q,m,L,o,w,d,R,y,r,i,u,g,S,K,M,V,O,n,l,v,c,T;const U=P.state;Y=P.next_in,c=P.input,C=Y+(P.avail_in-5),q=P.next_out,T=P.output,m=q-(f-P.avail_out),L=q+(P.avail_out-257),o=U.dmax,w=U.wsize,d=U.whave,R=U.wnext,y=U.window,r=U.hold,i=U.bits,u=U.lencode,g=U.distcode,S=(1<<U.lenbits)-1,K=(1<<U.distbits)-1;P:do{i<15&&(r+=c[Y++]<<i,i+=8,r+=c[Y++]<<i,i+=8),M=u[r&S];f:for(;;){if(V=M>>>24,r>>>=V,i-=V,V=M>>>16&255,0===V)T[q++]=65535&M;else{if(!(16&V)){if(0===(64&V)){M=u[(65535&M)+(r&(1<<V)-1)];continue f}if(32&V){U.mode=12;break P}P.Rf="invalid literal/length code",U.mode=30;break P}O=65535&M,V&=15,V&&(i<V&&(r+=c[Y++]<<i,i+=8),O+=r&(1<<V)-1,r>>>=V,i-=V),i<15&&(r+=c[Y++]<<i,i+=8,r+=c[Y++]<<i,i+=8),M=g[r&K];Y:for(;;){if(V=M>>>24,r>>>=V,i-=V,V=M>>>16&255,!(16&V)){if(0===(64&V)){M=g[(65535&M)+(r&(1<<V)-1)];continue Y}P.Rf="invalid distance code",U.mode=30;break P}if(n=65535&M,V&=15,i<V&&(r+=c[Y++]<<i,i+=8,i<V&&(r+=c[Y++]<<i,i+=8)),n+=r&(1<<V)-1,n>o){P.Rf="invalid distance too far back",U.mode=30;break P}if(r>>>=V,i-=V,V=q-m,n>V){if(V=n-V,V>d&&U.sane){P.Rf="invalid distance too far back",U.mode=30;break P}if(l=0,v=y,0===R){if(l+=w-V,V<O){O-=V;do{T[q++]=y[l++]}while(--V);l=q-n,v=T}}else if(R<V){if(l+=w+R-V,V-=R,V<O){O-=V;do{T[q++]=y[l++]}while(--V);if(l=0,R<O){V=R,O-=V;do{T[q++]=y[l++]}while(--V);l=q-n,v=T}}}else if(l+=R-V,V<O){O-=V;do{T[q++]=y[l++]}while(--V);l=q-n,v=T}for(;O>2;)T[q++]=v[l++],T[q++]=v[l++],T[q++]=v[l++],O-=3;O&&(T[q++]=v[l++],O>1&&(T[q++]=v[l++]))}else{l=q-n;do{T[q++]=T[l++],T[q++]=T[l++],T[q++]=T[l++],O-=3}while(O>2);O&&(T[q++]=T[l++],O>1&&(T[q++]=T[l++]))}break}}break}}while(Y<C&&q<L);O=i>>3,Y-=O,i-=O<<3,r&=(1<<i)-1,P.next_in=Y,P.next_out=q,P.avail_in=Y<C?C-Y+5:5-(Y-C),P.avail_out=q<L?L-q+257:257-(q-L),U.hold=r,U.bits=i}},12408:(P,f,Y)=>{"use strict";const C=Y(12361),q=Y(12365),m=Y(12413),L=Y(12418),{Z_FINISH:o,Z_BLOCK:w,Z_TREES:d,Z_OK:R,Z_STREAM_END:y,Z_NEED_DICT:r,Z_STREAM_ERROR:i,Z_DATA_ERROR:u,Z_MEM_ERROR:g,Z_BUF_ERROR:S,Z_DEFLATED:K}=Y(12375),M=12,V=30,O=P=>(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24);function n(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const l=P=>{if(!P||!P.state)return i;const f=P.state;return P.total_in=P.total_out=f.total=0,P.Rf="",f.wrap&&(P.adler=1&f.wrap),f.mode=1,f.last=0,f.havedict=0,f.dmax=32768,f.head=null,f.hold=0,f.bits=0,f.lencode=f.lendyn=new Int32Array(852),f.distcode=f.distdyn=new Int32Array(592),f.sane=1,f.back=-1,R},v=P=>{if(!P||!P.state)return i;const f=P.state;return f.wsize=0,f.whave=0,f.wnext=0,l(P)},c=(P,f)=>{let Y;if(!P||!P.state)return i;const C=P.state;return f<0?(Y=0,f=-f):(Y=1+(f>>4),f<48&&(f&=15)),f&&(f<8||f>15)?i:(null!==C.window&&C.wbits!==f&&(C.window=null),C.wrap=Y,C.wbits=f,v(P))},T=(P,f)=>{if(!P)return i;const Y=new n;P.state=Y,Y.window=null;const C=c(P,f);return C!==R&&(P.state=null),C};let U,D,j=!0;const e=P=>{if(j){U=new Int32Array(512),D=new Int32Array(32);let f=0;for(;f<144;)P.lens[f++]=8;for(;f<256;)P.lens[f++]=9;for(;f<280;)P.lens[f++]=7;for(;f<288;)P.lens[f++]=8;for(L(1,P.lens,0,288,U,0,P.work,{bits:9}),f=0;f<32;)P.lens[f++]=5;L(2,P.lens,0,32,D,0,P.work,{bits:5}),j=!1}P.lencode=U,P.lenbits=9,P.distcode=D,P.distbits=5},s=(P,f,Y,C)=>{let q;const m=P.state;return null===m.window&&(m.wsize=1<<m.wbits,m.wnext=0,m.whave=0,m.window=new Uint8Array(m.wsize)),C>=m.wsize?(m.window.set(f.subarray(Y-m.wsize,Y),0),m.wnext=0,m.whave=m.wsize):(q=m.wsize-m.wnext,q>C&&(q=C),m.window.set(f.subarray(Y-C,Y-C+q),m.wnext),(C-=q)?(m.window.set(f.subarray(Y-C,Y),0),m.wnext=C,m.whave=m.wsize):(m.wnext+=q,m.wnext===m.wsize&&(m.wnext=0),m.whave<m.wsize&&(m.whave+=q))),0};P.exports.inflateReset=v,P.exports.inflateReset2=c,P.exports.inflateResetKeep=l,P.exports.inflateInit=P=>T(P,15),P.exports.inflateInit2=T,P.exports.inflate=(P,f)=>{let Y,n,l,v,c,T,U,D,j,a,Q,J,N,I,X,x,k,Z,A,E,t,G,z=0;const B=new Uint8Array(4);let b,H;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!P||!P.state||!P.output||!P.input&&0!==P.avail_in)return i;Y=P.state,Y.mode===M&&(Y.mode=13),c=P.next_out,l=P.output,U=P.avail_out,v=P.next_in,n=P.input,T=P.avail_in,D=Y.hold,j=Y.bits,a=T,Q=U,G=R;P:for(;;)switch(Y.mode){case 1:if(0===Y.wrap){Y.mode=13;break}for(;j<16;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(2&Y.wrap&&35615===D){Y.check=0,B[0]=255&D,B[1]=D>>>8&255,Y.check=q(Y.check,B,2,0),D=0,j=0,Y.mode=2;break}if(Y.flags=0,Y.head&&(Y.head.done=!1),!(1&Y.wrap)||(((255&D)<<8)+(D>>8))%31){P.Rf="incorrect header check",Y.mode=V;break}if((15&D)!==K){P.Rf="unknown compression method",Y.mode=V;break}if(D>>>=4,j-=4,t=8+(15&D),0===Y.wbits)Y.wbits=t;else if(t>Y.wbits){P.Rf="invalid window size",Y.mode=V;break}Y.dmax=1<<Y.wbits,P.adler=Y.check=1,Y.mode=512&D?10:M,D=0,j=0;break;case 2:for(;j<16;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(Y.flags=D,(255&Y.flags)!==K){P.Rf="unknown compression method",Y.mode=V;break}if(57344&Y.flags){P.Rf="unknown header flags set",Y.mode=V;break}Y.head&&(Y.head.text=D>>8&1),512&Y.flags&&(B[0]=255&D,B[1]=D>>>8&255,Y.check=q(Y.check,B,2,0)),D=0,j=0,Y.mode=3;case 3:for(;j<32;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}Y.head&&(Y.head.time=D),512&Y.flags&&(B[0]=255&D,B[1]=D>>>8&255,B[2]=D>>>16&255,B[3]=D>>>24&255,Y.check=q(Y.check,B,4,0)),D=0,j=0,Y.mode=4;case 4:for(;j<16;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}Y.head&&(Y.head.xflags=255&D,Y.head.os=D>>8),512&Y.flags&&(B[0]=255&D,B[1]=D>>>8&255,Y.check=q(Y.check,B,2,0)),D=0,j=0,Y.mode=5;case 5:if(1024&Y.flags){for(;j<16;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}Y.length=D,Y.head&&(Y.head.extra_len=D),512&Y.flags&&(B[0]=255&D,B[1]=D>>>8&255,Y.check=q(Y.check,B,2,0)),D=0,j=0}else Y.head&&(Y.head.extra=null);Y.mode=6;case 6:if(1024&Y.flags&&(J=Y.length,J>T&&(J=T),J&&(Y.head&&(t=Y.head.extra_len-Y.length,Y.head.extra||(Y.head.extra=new Uint8Array(Y.head.extra_len)),Y.head.extra.set(n.subarray(v,v+J),t)),512&Y.flags&&(Y.check=q(Y.check,n,J,v)),T-=J,v+=J,Y.length-=J),Y.length))break P;Y.length=0,Y.mode=7;case 7:if(2048&Y.flags){if(0===T)break P;J=0;do{t=n[v+J++],Y.head&&t&&Y.length<65536&&(Y.head.name+=String.fromCharCode(t))}while(t&&J<T);if(512&Y.flags&&(Y.check=q(Y.check,n,J,v)),T-=J,v+=J,t)break P}else Y.head&&(Y.head.name=null);Y.length=0,Y.mode=8;case 8:if(4096&Y.flags){if(0===T)break P;J=0;do{t=n[v+J++],Y.head&&t&&Y.length<65536&&(Y.head.comment+=String.fromCharCode(t))}while(t&&J<T);if(512&Y.flags&&(Y.check=q(Y.check,n,J,v)),T-=J,v+=J,t)break P}else Y.head&&(Y.head.comment=null);Y.mode=9;case 9:if(512&Y.flags){for(;j<16;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(D!==(65535&Y.check)){P.Rf="header crc mismatch",Y.mode=V;break}D=0,j=0}Y.head&&(Y.head.hcrc=Y.flags>>9&1,Y.head.done=!0),P.adler=Y.check=0,Y.mode=M;break;case 10:for(;j<32;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}P.adler=Y.check=O(D),D=0,j=0,Y.mode=11;case 11:if(0===Y.havedict)return P.next_out=c,P.avail_out=U,P.next_in=v,P.avail_in=T,Y.hold=D,Y.bits=j,r;P.adler=Y.check=1,Y.mode=M;case M:if(f===w||f===d)break P;case 13:if(Y.last){D>>>=7&j,j-=7&j,Y.mode=27;break}for(;j<3;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}switch(Y.last=1&D,D>>>=1,j-=1,3&D){case 0:Y.mode=14;break;case 1:if(e(Y),Y.mode=20,f===d){D>>>=2,j-=2;break P}break;case 2:Y.mode=17;break;case 3:P.Rf="invalid block type",Y.mode=V}D>>>=2,j-=2;break;case 14:for(D>>>=7&j,j-=7&j;j<32;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if((65535&D)!==(D>>>16^65535)){P.Rf="invalid stored block lengths",Y.mode=V;break}if(Y.length=65535&D,D=0,j=0,Y.mode=15,f===d)break P;case 15:Y.mode=16;case 16:if(J=Y.length,J){if(J>T&&(J=T),J>U&&(J=U),0===J)break P;l.set(n.subarray(v,v+J),c),T-=J,v+=J,U-=J,c+=J,Y.length-=J;break}Y.mode=M;break;case 17:for(;j<14;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(Y.nlen=257+(31&D),D>>>=5,j-=5,Y.ndist=1+(31&D),D>>>=5,j-=5,Y.ncode=4+(15&D),D>>>=4,j-=4,Y.nlen>286||Y.ndist>30){P.Rf="too many length or distance symbols",Y.mode=V;break}Y.have=0,Y.mode=18;case 18:for(;Y.have<Y.ncode;){for(;j<3;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}Y.lens[W[Y.have++]]=7&D,D>>>=3,j-=3}for(;Y.have<19;)Y.lens[W[Y.have++]]=0;if(Y.lencode=Y.lendyn,Y.lenbits=7,b={bits:Y.lenbits},G=L(0,Y.lens,0,19,Y.lencode,0,Y.work,b),Y.lenbits=b.bits,G){P.Rf="invalid code lengths set",Y.mode=V;break}Y.have=0,Y.mode=19;case 19:for(;Y.have<Y.nlen+Y.ndist;){for(;z=Y.lencode[D&(1<<Y.lenbits)-1],X=z>>>24,x=z>>>16&255,k=65535&z,!(X<=j);){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(k<16)D>>>=X,j-=X,Y.lens[Y.have++]=k;else{if(16===k){for(H=X+2;j<H;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(D>>>=X,j-=X,0===Y.have){P.Rf="invalid bit length repeat",Y.mode=V;break}t=Y.lens[Y.have-1],J=3+(3&D),D>>>=2,j-=2}else if(17===k){for(H=X+3;j<H;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}D>>>=X,j-=X,t=0,J=3+(7&D),D>>>=3,j-=3}else{for(H=X+7;j<H;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}D>>>=X,j-=X,t=0,J=11+(127&D),D>>>=7,j-=7}if(Y.have+J>Y.nlen+Y.ndist){P.Rf="invalid bit length repeat",Y.mode=V;break}for(;J--;)Y.lens[Y.have++]=t}}if(Y.mode===V)break;if(0===Y.lens[256]){P.Rf="invalid code -- missing end-of-block",Y.mode=V;break}if(Y.lenbits=9,b={bits:Y.lenbits},G=L(1,Y.lens,0,Y.nlen,Y.lencode,0,Y.work,b),Y.lenbits=b.bits,G){P.Rf="invalid literal/lengths set",Y.mode=V;break}if(Y.distbits=6,Y.distcode=Y.distdyn,b={bits:Y.distbits},G=L(2,Y.lens,Y.nlen,Y.ndist,Y.distcode,0,Y.work,b),Y.distbits=b.bits,G){P.Rf="invalid distances set",Y.mode=V;break}if(Y.mode=20,f===d)break P;case 20:Y.mode=21;case 21:if(T>=6&&U>=258){P.next_out=c,P.avail_out=U,P.next_in=v,P.avail_in=T,Y.hold=D,Y.bits=j,m(P,Q),c=P.next_out,l=P.output,U=P.avail_out,v=P.next_in,n=P.input,T=P.avail_in,D=Y.hold,j=Y.bits,Y.mode===M&&(Y.back=-1);break}for(Y.back=0;z=Y.lencode[D&(1<<Y.lenbits)-1],X=z>>>24,x=z>>>16&255,k=65535&z,!(X<=j);){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(x&&0===(240&x)){for(Z=X,A=x,E=k;z=Y.lencode[E+((D&(1<<Z+A)-1)>>Z)],X=z>>>24,x=z>>>16&255,k=65535&z,!(Z+X<=j);){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}D>>>=Z,j-=Z,Y.back+=Z}if(D>>>=X,j-=X,Y.back+=X,Y.length=k,0===x){Y.mode=26;break}if(32&x){Y.back=-1,Y.mode=M;break}if(64&x){P.Rf="invalid literal/length code",Y.mode=V;break}Y.extra=15&x,Y.mode=22;case 22:if(Y.extra){for(H=Y.extra;j<H;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}Y.length+=D&(1<<Y.extra)-1,D>>>=Y.extra,j-=Y.extra,Y.back+=Y.extra}Y.was=Y.length,Y.mode=23;case 23:for(;z=Y.distcode[D&(1<<Y.distbits)-1],X=z>>>24,x=z>>>16&255,k=65535&z,!(X<=j);){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(0===(240&x)){for(Z=X,A=x,E=k;z=Y.distcode[E+((D&(1<<Z+A)-1)>>Z)],X=z>>>24,x=z>>>16&255,k=65535&z,!(Z+X<=j);){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}D>>>=Z,j-=Z,Y.back+=Z}if(D>>>=X,j-=X,Y.back+=X,64&x){P.Rf="invalid distance code",Y.mode=V;break}Y.offset=k,Y.extra=15&x,Y.mode=24;case 24:if(Y.extra){for(H=Y.extra;j<H;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}Y.offset+=D&(1<<Y.extra)-1,D>>>=Y.extra,j-=Y.extra,Y.back+=Y.extra}if(Y.offset>Y.dmax){P.Rf="invalid distance too far back",Y.mode=V;break}Y.mode=25;case 25:if(0===U)break P;if(J=Q-U,Y.offset>J){if(J=Y.offset-J,J>Y.whave&&Y.sane){P.Rf="invalid distance too far back",Y.mode=V;break}J>Y.wnext?(J-=Y.wnext,N=Y.wsize-J):N=Y.wnext-J,J>Y.length&&(J=Y.length),I=Y.window}else I=l,N=c-Y.offset,J=Y.length;J>U&&(J=U),U-=J,Y.length-=J;do{l[c++]=I[N++]}while(--J);0===Y.length&&(Y.mode=21);break;case 26:if(0===U)break P;l[c++]=Y.length,U--,Y.mode=21;break;case 27:if(Y.wrap){for(;j<32;){if(0===T)break P;T--,D|=n[v++]<<j,j+=8}if(Q-=U,P.total_out+=Q,Y.total+=Q,Q&&(P.adler=Y.check=Y.flags?q(Y.check,l,Q,c-Q):C(Y.check,l,Q,c-Q)),Q=U,(Y.flags?D:O(D))!==Y.check){P.Rf="incorrect data check",Y.mode=V;break}D=0,j=0}Y.mode=28;case 28:if(Y.wrap&&Y.flags){for(;j<32;){if(0===T)break P;T--,D+=n[v++]<<j,j+=8}if(D!==(4294967295&Y.total)){P.Rf="incorrect length check",Y.mode=V;break}D=0,j=0}Y.mode=29;case 29:G=y;break P;case V:G=u;break P;case 31:return g;default:return i}return P.next_out=c,P.avail_out=U,P.next_in=v,P.avail_in=T,Y.hold=D,Y.bits=j,(Y.wsize||Q!==P.avail_out&&Y.mode<V&&(Y.mode<27||f!==o))&&s(P,P.output,P.next_out,Q-P.avail_out)?(Y.mode=31,g):(a-=P.avail_in,Q-=P.avail_out,P.total_in+=a,P.total_out+=Q,Y.total+=Q,Y.wrap&&Q&&(P.adler=Y.check=Y.flags?q(Y.check,l,Q,P.next_out-Q):C(Y.check,l,Q,P.next_out-Q)),P.data_type=Y.bits+(Y.last?64:0)+(Y.mode===M?128:0)+(20===Y.mode||15===Y.mode?256:0),(0===a&&0===Q||f===o)&&G===R&&(G=S),G)},P.exports.inflateEnd=P=>{if(!P||!P.state)return i;let f=P.state;return f.window&&(f.window=null),P.state=null,R},P.exports.inflateGetHeader=(P,f)=>{if(!P||!P.state)return i;const Y=P.state;return 0===(2&Y.wrap)?i:(Y.head=f,f.done=!1,R)},P.exports.inflateSetDictionary=(P,f)=>{const Y=f.length;let q,m,L;return P&&P.state?(q=P.state,0!==q.wrap&&11!==q.mode?i:11===q.mode&&(m=1,m=C(m,f,Y,0),m!==q.check)?u:(L=s(P,f,Y,Y),L?(q.mode=31,g):(q.havedict=1,R))):i},P.exports.inflateInfo="pako inflate (from Nodeca project)"},12418:P=>{"use strict";const f=15,Y=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),C=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),q=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),m=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);P.exports=(P,L,o,w,d,R,y,r)=>{const i=r.bits;let u,g,S,K,M,V,O=0,n=0,l=0,v=0,c=0,T=0,U=0,D=0,j=0,e=0,s=null,a=0;const Q=new Uint16Array(16),J=new Uint16Array(16);let N,I,X,x=null,k=0;for(O=0;O<=f;O++)Q[O]=0;for(n=0;n<w;n++)Q[L[o+n]]++;for(c=i,v=f;v>=1&&0===Q[v];v--);if(c>v&&(c=v),0===v)return d[R++]=20971520,d[R++]=20971520,r.bits=1,0;for(l=1;l<v&&0===Q[l];l++);for(c<l&&(c=l),D=1,O=1;O<=f;O++)if(D<<=1,D-=Q[O],D<0)return-1;if(D>0&&(0===P||1!==v))return-1;for(J[1]=0,O=1;O<f;O++)J[O+1]=J[O]+Q[O];for(n=0;n<w;n++)0!==L[o+n]&&(y[J[L[o+n]]++]=n);if(0===P?(s=x=y,V=19):1===P?(s=Y,a-=257,x=C,k-=257,V=256):(s=q,x=m,V=-1),e=0,n=0,O=l,M=R,T=c,U=0,S=-1,j=1<<c,K=j-1,1===P&&j>852||2===P&&j>592)return 1;for(;;){N=O-U,y[n]<V?(I=0,X=y[n]):y[n]>V?(I=x[k+y[n]],X=s[a+y[n]]):(I=96,X=0),u=1<<O-U,g=1<<T,l=g;do{g-=u,d[M+(e>>U)+g]=N<<24|I<<16|X}while(0!==g);for(u=1<<O-1;e&u;)u>>=1;if(0!==u?(e&=u-1,e+=u):e=0,n++,0===--Q[O]){if(O===v)break;O=L[o+y[n]]}if(O>c&&(e&K)!==S){for(0===U&&(U=c),M+=l,T=O-U,D=1<<T;T+U<v&&(D-=Q[T+U],!(D<=0));)T++,D<<=1;if(j+=1<<T,1===P&&j>852||2===P&&j>592)return 1;S=e&K,d[S]=c<<24|T<<16|M-R}}return 0!==e&&(d[M+e]=O-U<<24|64<<16),r.bits=c,0}},12367:P=>{"use strict";P.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12358:P=>{"use strict";function f(P){let f=P.length;for(;--f>=0;)P[f]=0}const Y=256,C=286,q=30,m=15,L=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),w=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),R=new Array(576);f(R);const y=new Array(60);f(y);const r=new Array(512);f(r);const i=new Array(256);f(i);const u=new Array(29);f(u);const g=new Array(q);function S(P,f,Y,C,q){this.static_tree=P,this.extra_bits=f,this.extra_base=Y,this.elems=C,this.max_length=q,this.has_stree=P&&P.length}let K,M,V;function O(P,f){this.dyn_tree=P,this.max_code=0,this.stat_desc=f}f(g);const n=P=>P<256?r[P]:r[256+(P>>>7)],l=(P,f)=>{P.pending_buf[P.pending++]=255&f,P.pending_buf[P.pending++]=f>>>8&255},v=(P,f,Y)=>{P.bi_valid>16-Y?(P.bi_buf|=f<<P.bi_valid&65535,l(P,P.bi_buf),P.bi_buf=f>>16-P.bi_valid,P.bi_valid+=Y-16):(P.bi_buf|=f<<P.bi_valid&65535,P.bi_valid+=Y)},c=(P,f,Y)=>{v(P,Y[2*f],Y[2*f+1])},T=(P,f)=>{let Y=0;do{Y|=1&P,P>>>=1,Y<<=1}while(--f>0);return Y>>>1},U=(P,f,Y)=>{const C=new Array(16);let q,L,o=0;for(q=1;q<=m;q++)C[q]=o=o+Y[q-1]<<1;for(L=0;L<=f;L++){let f=P[2*L+1];0!==f&&(P[2*L]=T(C[f]++,f))}},D=P=>{let f;for(f=0;f<C;f++)P.dyn_ltree[2*f]=0;for(f=0;f<q;f++)P.dyn_dtree[2*f]=0;for(f=0;f<19;f++)P.bl_tree[2*f]=0;P.dyn_ltree[512]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0},j=P=>{P.bi_valid>8?l(P,P.bi_buf):P.bi_valid>0&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0},e=(P,f,Y,C)=>{const q=2*f,m=2*Y;return P[q]<P[m]||P[q]===P[m]&&C[f]<=C[Y]},s=(P,f,Y)=>{const C=P.heap[Y];let q=Y<<1;for(;q<=P.heap_len&&(q<P.heap_len&&e(f,P.heap[q+1],P.heap[q],P.depth)&&q++,!e(f,C,P.heap[q],P.depth));)P.heap[Y]=P.heap[q],Y=q,q<<=1;P.heap[Y]=C},a=(P,f,C)=>{let q,m,w,d,R=0;if(0!==P.last_lit)do{q=P.pending_buf[P.d_buf+2*R]<<8|P.pending_buf[P.d_buf+2*R+1],m=P.pending_buf[P.l_buf+R],R++,0===q?c(P,m,f):(w=i[m],c(P,w+Y+1,f),d=L[w],0!==d&&(m-=u[w],v(P,m,d)),q--,w=n(q),c(P,w,C),d=o[w],0!==d&&(q-=g[w],v(P,q,d)))}while(R<P.last_lit);c(P,256,f)},Q=(P,f)=>{const Y=f.dyn_tree,C=f.stat_desc.static_tree,q=f.stat_desc.has_stree,L=f.stat_desc.elems;let o,w,d,R=-1;for(P.heap_len=0,P.heap_max=573,o=0;o<L;o++)0!==Y[2*o]?(P.heap[++P.heap_len]=R=o,P.depth[o]=0):Y[2*o+1]=0;for(;P.heap_len<2;)d=P.heap[++P.heap_len]=R<2?++R:0,Y[2*d]=1,P.depth[d]=0,P.opt_len--,q&&(P.static_len-=C[2*d+1]);for(f.max_code=R,o=P.heap_len>>1;o>=1;o--)s(P,Y,o);d=L;do{o=P.heap[1],P.heap[1]=P.heap[P.heap_len--],s(P,Y,1),w=P.heap[1],P.heap[--P.heap_max]=o,P.heap[--P.heap_max]=w,Y[2*d]=Y[2*o]+Y[2*w],P.depth[d]=(P.depth[o]>=P.depth[w]?P.depth[o]:P.depth[w])+1,Y[2*o+1]=Y[2*w+1]=d,P.heap[1]=d++,s(P,Y,1)}while(P.heap_len>=2);P.heap[--P.heap_max]=P.heap[1],((P,f)=>{const Y=f.dyn_tree,C=f.max_code,q=f.stat_desc.static_tree,L=f.stat_desc.has_stree,o=f.stat_desc.extra_bits,w=f.stat_desc.extra_base,d=f.stat_desc.max_length;let R,y,r,i,u,g,S=0;for(i=0;i<=m;i++)P.bl_count[i]=0;for(Y[2*P.heap[P.heap_max]+1]=0,R=P.heap_max+1;R<573;R++)y=P.heap[R],i=Y[2*Y[2*y+1]+1]+1,i>d&&(i=d,S++),Y[2*y+1]=i,y>C||(P.bl_count[i]++,u=0,y>=w&&(u=o[y-w]),g=Y[2*y],P.opt_len+=g*(i+u),L&&(P.static_len+=g*(q[2*y+1]+u)));if(0!==S){do{for(i=d-1;0===P.bl_count[i];)i--;P.bl_count[i]--,P.bl_count[i+1]+=2,P.bl_count[d]--,S-=2}while(S>0);for(i=d;0!==i;i--)for(y=P.bl_count[i];0!==y;)r=P.heap[--R],r>C||(Y[2*r+1]!==i&&(P.opt_len+=(i-Y[2*r+1])*Y[2*r],Y[2*r+1]=i),y--)}})(P,f),U(Y,R,P.bl_count)},J=(P,f,Y)=>{let C,q,m=-1,L=f[1],o=0,w=7,d=4;for(0===L&&(w=138,d=3),f[2*(Y+1)+1]=65535,C=0;C<=Y;C++)q=L,L=f[2*(C+1)+1],++o<w&&q===L||(o<d?P.bl_tree[2*q]+=o:0!==q?(q!==m&&P.bl_tree[2*q]++,P.bl_tree[32]++):o<=10?P.bl_tree[34]++:P.bl_tree[36]++,o=0,m=q,0===L?(w=138,d=3):q===L?(w=6,d=3):(w=7,d=4))},N=(P,f,Y)=>{let C,q,m=-1,L=f[1],o=0,w=7,d=4;for(0===L&&(w=138,d=3),C=0;C<=Y;C++)if(q=L,L=f[2*(C+1)+1],!(++o<w&&q===L)){if(o<d)do{c(P,q,P.bl_tree)}while(0!==--o);else 0!==q?(q!==m&&(c(P,q,P.bl_tree),o--),c(P,16,P.bl_tree),v(P,o-3,2)):o<=10?(c(P,17,P.bl_tree),v(P,o-3,3)):(c(P,18,P.bl_tree),v(P,o-11,7));o=0,m=q,0===L?(w=138,d=3):q===L?(w=6,d=3):(w=7,d=4)}};let I=!1;const X=(P,f,Y,C)=>{v(P,0+(C?1:0),3),((P,f,Y,C)=>{j(P),C&&(l(P,Y),l(P,~Y)),P.pending_buf.set(P.window.subarray(f,f+Y),P.pending),P.pending+=Y})(P,f,Y,!0)};P.exports._tr_init=P=>{I||((()=>{let P,f,Y,d,O;const n=new Array(16);for(Y=0,d=0;d<28;d++)for(u[d]=Y,P=0;P<1<<L[d];P++)i[Y++]=d;for(i[Y-1]=d,O=0,d=0;d<16;d++)for(g[d]=O,P=0;P<1<<o[d];P++)r[O++]=d;for(O>>=7;d<q;d++)for(g[d]=O<<7,P=0;P<1<<o[d]-7;P++)r[256+O++]=d;for(f=0;f<=m;f++)n[f]=0;for(P=0;P<=143;)R[2*P+1]=8,P++,n[8]++;for(;P<=255;)R[2*P+1]=9,P++,n[9]++;for(;P<=279;)R[2*P+1]=7,P++,n[7]++;for(;P<=287;)R[2*P+1]=8,P++,n[8]++;for(U(R,287,n),P=0;P<q;P++)y[2*P+1]=5,y[2*P]=T(P,5);K=new S(R,L,257,C,m),M=new S(y,o,0,q,m),V=new S(new Array(0),w,0,19,7)})(),I=!0),P.l_desc=new O(P.dyn_ltree,K),P.d_desc=new O(P.dyn_dtree,M),P.bl_desc=new O(P.bl_tree,V),P.bi_buf=0,P.bi_valid=0,D(P)},P.exports._tr_stored_block=X,P.exports._tr_flush_block=(P,f,C,q)=>{let m,L,o=0;P.level>0?(2===P.strm.data_type&&(P.strm.data_type=(P=>{let f,C=4093624447;for(f=0;f<=31;f++,C>>>=1)if(1&C&&0!==P.dyn_ltree[2*f])return 0;if(0!==P.dyn_ltree[18]||0!==P.dyn_ltree[20]||0!==P.dyn_ltree[26])return 1;for(f=32;f<Y;f++)if(0!==P.dyn_ltree[2*f])return 1;return 0})(P)),Q(P,P.l_desc),Q(P,P.d_desc),o=(P=>{let f;for(J(P,P.dyn_ltree,P.l_desc.max_code),J(P,P.dyn_dtree,P.d_desc.max_code),Q(P,P.bl_desc),f=18;f>=3&&0===P.bl_tree[2*d[f]+1];f--);return P.opt_len+=3*(f+1)+5+5+4,f})(P),m=P.opt_len+3+7>>>3,L=P.static_len+3+7>>>3,L<=m&&(m=L)):m=L=C+5,C+4<=m&&-1!==f?X(P,f,C,q):4===P.strategy||L===m?(v(P,2+(q?1:0),3),a(P,R,y)):(v(P,4+(q?1:0),3),((P,f,Y,C)=>{let q;for(v(P,f-257,5),v(P,Y-1,5),v(P,C-4,4),q=0;q<C;q++)v(P,P.bl_tree[2*d[q]+1],3);N(P,P.dyn_ltree,f-1),N(P,P.dyn_dtree,Y-1)})(P,P.l_desc.max_code+1,P.d_desc.max_code+1,o+1),a(P,P.dyn_ltree,P.dyn_dtree)),D(P),q&&j(P)},P.exports._tr_tally=(P,f,C)=>(P.pending_buf[P.d_buf+2*P.last_lit]=f>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&f,P.pending_buf[P.l_buf+P.last_lit]=255&C,P.last_lit++,0===f?P.dyn_ltree[2*C]++:(P.matches++,f--,P.dyn_ltree[2*(i[C]+Y+1)]++,P.dyn_dtree[2*n(f)]++),P.last_lit===P.lit_bufsize-1),P.exports._tr_align=P=>{v(P,2,3),c(P,256,R),(P=>{16===P.bi_valid?(l(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):P.bi_valid>=8&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)})(P)}},12394:P=>{"use strict";P.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.Rf="",this.state=null,this.data_type=2,this.adler=0}},12025:P=>{function f(P,f,Y){for(var C=P.length,q=-1/0,m=1/0,L=0;L<C;L++){var o=(Y[0][L]-P[L])/f[L],w=(Y[1][L]-P[L])/f[L];if(o>w){var d=o;o=w,w=d}if(w<q||o>m)return 1/0;o>q&&(q=o),w<m&&(m=w)}return q>m?1/0:q}P.exports=function(P,Y,C,q){var m=f(Y,C,q);if(m===1/0)P=null;else{P=P||[];for(var L=0;L<Y.length;L++)P[L]=Y[L]+C[L]*m}return P},P.exports.distance=f},13365:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>L});var C=Y(31);const q=C.useLayoutEffect;const m=function(P){var f=(0,C.useRef)(P);return q((function(){f.current=P})),f};var L=function(P){var f=m(P);(0,C.Lf)((function(){var P=function(P){var Y;if(null!=f.current&&(Y=f.current(P)),P.defaultPrevented&&(P.returnValue=""),"string"===typeof Y)return P.returnValue=Y,Y};return window.addEventListener("beforeunload",P),function(){window.removeEventListener("beforeunload",P)}}),[])}},13317:(P,f,Y)=>{"use strict";var C=Y(13320),q=Array.prototype.concat,m=Array.prototype.slice,L=P.exports=function(P){for(var f=[],Y=0,L=P.length;Y<L;Y++){var o=P[Y];C(o)?f=q.call(f,m.call(o)):f.push(o)}return f};L.wrap=function(P){return function(){return P(L(arguments))}}},13320:P=>{P.exports=function(P){return!(!P||"string"===typeof P)&&(P instanceof Array||Array.isArray(P)||P.length>=0&&(P.splice instanceof Function||Object.getOwnPropertyDescriptor(P,P.length-1)&&"String"!==P.constructor.name))}},12309:(P,f,Y)=>{var C=Y(12312);function q(P){for(var f,Y,q=0,m=P.length,L=0;L<P.length;){for(f=P[L],Y=0;L<m&&P[L]===f;)++L,++Y;q+=C.log2(Y)/7|0,q+=C.log2(f>>>0)/7|0,q+=2}return q}f.size=q,f.encode=function(P,f){f||(f=new Uint8Array(q(P)));for(var Y,C,m=0,L=f.length,o=0;o<P.length;){for(Y=P[o],C=0;o<P.length&&P[o]===Y;)++o,++C;for(;m<L&&C>=128;)f[m++]=128+(127&C),C>>>=7;if(m>=L)throw new Error("RLE buffer overflow");for(f[m++]=C,Y>>>=0;m<L&&Y>=128;)f[m++]=128+(127&Y),Y>>>=7;if(m>=L)throw new Error("RLE buffer overflow");f[m++]=Y}return f},f.decode=function(P,f){for(var Y,C,q,m,L=f.length,o=P.length,w=0,d=0;d<o;){for(Y=0,C=0;d<o&&P[d]>=128;)Y+=(127&P[d++])<<C,C+=7;if(Y+=P[d++]<<C,d>=o)throw new Error("RLE buffer underrun");if(w+Y>L)throw new Error("Chunk buffer overflow");for(q=0,C=0;d<o&&P[d]>=128;)q+=(127&P[d++])<<C,C+=7;if(d>=o)throw new Error("RLE buffer underrun");for(q+=P[d++]<<C,m=0;m<Y;++m)f[w++]=q}return f}},12312:(P,f)=>{"use strict";function Y(P){var f=32;return(P&=-P)&&f--,65535&P&&(f-=16),16711935&P&&(f-=8),252645135&P&&(f-=4),858993459&P&&(f-=2),1431655765&P&&(f-=1),f}f.INT_BITS=32,f.INT_MAX=2147483647,f.INT_MIN=-1<<31,f.sign=function(P){return(P>0)-(P<0)},f.abs=function(P){var f=P>>31;return(P^f)-f},f.min=function(P,f){return f^(P^f)&-(P<f)},f.max=function(P,f){return P^(P^f)&-(P<f)},f.isPow2=function(P){return!(P&P-1)&&!!P},f.log2=function(P){var f,Y;return f=(P>65535)<<4,f|=Y=((P>>>=f)>255)<<3,f|=Y=((P>>>=Y)>15)<<2,(f|=Y=((P>>>=Y)>3)<<1)|(P>>>=Y)>>1},f.log10=function(P){return P>=1e9?9:P>=1e8?8:P>=1e7?7:P>=1e6?6:P>=1e5?5:P>=1e4?4:P>=1e3?3:P>=100?2:P>=10?1:0},f.popCount=function(P){return 16843009*((P=(858993459&(P-=P>>>1&1431655765))+(P>>>2&858993459))+(P>>>4)&252645135)>>>24},f.countTrailingZeros=Y,f.nextPow2=function(P){return P+=0===P,--P,P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)+1},f.prevPow2=function(P){return P|=P>>>1,P|=P>>>2,P|=P>>>4,P|=P>>>8,(P|=P>>>16)-(P>>>1)},f.parity=function(P){return P^=P>>>16,P^=P>>>8,P^=P>>>4,27030>>>(P&=15)&1};var C=new Array(256);!function(P){for(var f=0;f<256;++f){var Y=f,C=f,q=7;for(Y>>>=1;Y;Y>>>=1)C<<=1,C|=1&Y,--q;P[f]=C<<q&255}}(C),f.reverse=function(P){return C[255&P]<<24|C[P>>>8&255]<<16|C[P>>>16&255]<<8|C[P>>>24&255]},f.interleave2=function(P,f){return(P=1431655765&((P=858993459&((P=252645135&((P=16711935&((P&=65535)|P<<8))|P<<4))|P<<2))|P<<1))|(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f&=65535)|f<<8))|f<<4))|f<<2))|f<<1))<<1},f.deinterleave2=function(P,f){return(P=65535&((P=16711935&((P=252645135&((P=858993459&((P=P>>>f&1431655765)|P>>>1))|P>>>2))|P>>>4))|P>>>16))<<16>>16},f.interleave3=function(P,f,Y){return P=1227133513&((P=3272356035&((P=251719695&((P=4278190335&((P&=1023)|P<<16))|P<<8))|P<<4))|P<<2),(P|=(f=1227133513&((f=3272356035&((f=251719695&((f=4278190335&((f&=1023)|f<<16))|f<<8))|f<<4))|f<<2))<<1)|(Y=1227133513&((Y=3272356035&((Y=251719695&((Y=4278190335&((Y&=1023)|Y<<16))|Y<<8))|Y<<4))|Y<<2))<<2},f.deinterleave3=function(P,f){return(P=1023&((P=4278190335&((P=251719695&((P=3272356035&((P=P>>>f&1227133513)|P>>>2))|P>>>4))|P>>>8))|P>>>16))<<22>>22},f.nextCombination=function(P){var f=P|P-1;return f+1|(~f&-~f)-1>>>Y(P)+1}},12334:P=>{"use strict";P.exports=function(P,f,Y,C){var q=self||window;try{try{var m;try{m=new q.Blob([P])}catch(d){(m=new(q.BlobBuilder||q.WebKitBlobBuilder||q.MozBlobBuilder||q.MSBlobBuilder)).append(P),m=m.getBlob()}var L=q.URL||q.webkitURL,o=L.createObjectURL(m),w=new q[f](o,Y);return L.revokeObjectURL(o),w}catch(d){return new q[f]("data:application/javascript,".concat(encodeURIComponent(P)),Y)}}catch(d){if(!C)throw Error("Inline worker is not supported");return new q[f](C,Y)}}},12005:(P,f,Y)=>{"use strict";function C(P,f,Y,C,q){var m={};return Object.keys(C).forEach((function(P){m[P]=C[P]})),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Y.slice().reverse().reduce((function(Y,C){return C(P,f,Y)||Y}),m),q&&void 0!==m.initializer&&(m.value=m.initializer?m.initializer.call(q):void 0,m.initializer=void 0),void 0===m.initializer&&(Object.defineProperty(P,f,m),m=null),m}Y.d(f,{d:()=>C})},11996:(P,f,Y)=>{"use strict";function C(P,f,Y,C){Y&&Object.defineProperty(P,f,{enumerable:Y.enumerable,configurable:Y.configurable,writable:Y.writable,value:Y.initializer?Y.initializer.call(C):void 0})}Y.d(f,{c:()=>C})},13360:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>L,g:()=>y,i:()=>o,k:()=>m,m:()=>w,p:()=>q,r:()=>d,t:()=>R});var C=Y(11405);class q{constructor(){this._easingMode=q.EASINGMODE_EASEIN}setEasingMode(P){const f=Math.min(Math.max(P,0),2);this._easingMode=f}getEasingMode(){return this._easingMode}easeInCore(P){throw new Error("You must implement this method")}ease(P){switch(this._easingMode){case q.EASINGMODE_EASEIN:return this.easeInCore(P);case q.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-P)}return P>=.5?.5*(1-this.easeInCore(2*(1-P)))+.5:.5*this.easeInCore(2*P)}}q.EASINGMODE_EASEIN=0,q.EASINGMODE_EASEOUT=1,q.EASINGMODE_EASEINOUT=2;class m extends q{easeInCore(P){return P=Math.max(0,Math.min(1,P)),1-Math.sqrt(1-P*P)}}class L extends q{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=P}easeInCore(P){const f=Math.max(0,this.amplitude);return Math.pow(P,3)-P*f*Math.sin(3.141592653589793*P)}}class o extends q{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=P,this.bounciness=f}easeInCore(P){const f=Math.max(0,this.bounces);let Y=this.bounciness;Y<=1&&(Y=1.001);const C=Math.pow(Y,f),q=1-Y,m=(1-C)/q+.5*C,L=P*m,o=Math.log(-L*(1-Y)+1)/Math.log(Y),w=Math.floor(o),d=w+1,R=(1-Math.pow(Y,w))/(q*m),y=.5*(R+(1-Math.pow(Y,d))/(q*m)),r=P-y,i=y-R;return-Math.pow(1/Y,f-w)/(i*i)*(r-i)*(r+i)}}class w extends q{easeInCore(P){return P*P*P}}class d extends q{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=P,this.springiness=f}easeInCore(P){let f;const Y=Math.max(0,this.oscillations),C=Math.max(0,this.springiness);return f=0==C?P:(Math.exp(C*P)-1)/(Math.exp(C)-1),f*Math.sin((6.283185307179586*Y+1.5707963267948966)*P)}}class R extends q{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=P}easeInCore(P){return this.exponent<=0?P:(Math.exp(this.exponent*P)-1)/(Math.exp(this.exponent)-1)}}class y extends q{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=P,this.y1=f,this.x2=Y,this.y2=C}easeInCore(P){return C.b.Interpolate(P,this.x1,this.y1,this.x2,this.y2)}}},12840:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>L});var C=Y(11179),q=Y(11196),m=Y(11620);class L extends m.b{get _matrix(){return this._compose(),this.Qr}set _matrix(P){(P.updateFlag!==this.Qr.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Qr.q(P),this._markAsDirtyAndDecompose())}constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(P,f.vP(),!1),this.name=P,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=f,this.Qr=(null===q||void 0===q?void 0:q.clone())??C.Matrix.Identity(),this._restMatrix=m??this.Qr.clone(),this._bindMatrix=L??this.Qr.clone(),this._index=o,this._absoluteMatrix=new C.Matrix,this._absoluteBindMatrix=new C.Matrix,this._absoluteInverseBindMatrix=new C.Matrix,this._finalMatrix=new C.Matrix,f.bones.push(this),this.setParent(Y,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(P){this.setParent(P)}setParent(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==P){if(this.parent){const P=this.parent.children.indexOf(this);-1!==P&&this.parent.children.splice(P,1)}this._parentNode=P,this.parent&&this.parent.children.push(this),f&&this._updateAbsoluteBindMatrices(),this.Ed()}}getLocalMatrix(){return this._compose(),this.Qr}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(P){this._restMatrix.q(P)}setRestPose(P){this.setRestMatrix(P)}getBindPose(){return this.getBindMatrix()}setBindMatrix(P){this.bf(P)}setBindPose(P){this.setBindMatrix(P)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const P=C.TmpVectors.Of[0],f=C.TmpVectors.Quaternion[0],Y=C.TmpVectors.Of[1];this.getRestMatrix().decompose(P,f,Y),this._linkedTransformNode.position.q(Y),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??C.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.q(f),this._linkedTransformNode.Ro.q(P)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(P){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=P,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Xo}set position(P){this._decompose(),this.Xo.q(P),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(P){this.setRotation(P)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(P){this.setRotationQuaternion(P)}get Ro(){return this.getScale()}set Ro(P){this.setScale(P)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=C.Of.Zero(),this._localRotation=C.Quaternion.Zero(),this.Xo=C.Of.Zero()),this.Qr.decompose(this._localScaling,this._localRotation,this.Xo))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,C.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Xo,this.Qr)):this._needToCompose=!1)}bf(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.q(P),f&&this._updateAbsoluteBindMatrices(),Y?this._matrix=P:this.Ed()}_updateAbsoluteBindMatrices(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(P||(P=this._bindMatrix),this.parent?P.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.q(P),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),f)for(let Y=0;Y<this.children.length;Y++)this.children[Y]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Ed(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Ed(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Ed(),this._needToDecompose=!0}_updatePosition(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const m=this.getLocalMatrix();if(0==f)q?(m.addAtIndex(12,P.x),m.addAtIndex(13,P.y),m.addAtIndex(14,P.z)):m.setTranslationFromFloats(P.x,P.y,P.z);else{let f=null;Y&&(f=Y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const o=L._TmpMats[0],w=L._TmpVecs[0];this.parent?Y&&f?(o.q(this.parent.getAbsoluteMatrix()),o.multiplyToRef(f,o)):o.q(this.parent.getAbsoluteMatrix()):C.Matrix.IdentityToRef(o),q&&o.setTranslationFromFloats(0,0,0),o.invert(),C.Of.TransformCoordinatesToRef(P,o,w),q?(m.addAtIndex(12,w.x),m.addAtIndex(13,w.y),m.addAtIndex(14,w.z)):m.setTranslationFromFloats(w.x,w.y,w.z)}this._markAsDirtyAndDecompose()}translate(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this._updatePosition(P,f,Y,!0)}setPosition(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this._updatePosition(P,f,Y,!1)}setAbsolutePosition(P,f){this.setPosition(P,1,f)}scale(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const m=this.getLocalMatrix(),o=L._TmpMats[0];C.Matrix.ScalingToRef(P,f,Y,o),o.multiplyToRef(m,m),o.invert();for(const C of this.children){const q=C.getLocalMatrix();q.multiplyToRef(o,q),q.multiplyAtIndex(12,P),q.multiplyAtIndex(13,f),q.multiplyAtIndex(14,Y),C._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),q)for(const C of this.children)C.scale(P,f,Y,q)}setScale(P){this._decompose(),this._localScaling.q(P),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(P){this._decompose(),P.q(this._localScaling)}setYawPitchRoll(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4?arguments[4]:void 0;if(0===q){const o=L._TmpQuat;return C.Quaternion.RotationYawPitchRollToRef(P,f,Y,o),void this.setRotationQuaternion(o,q,m)}const o=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(o,m))return;const w=L._TmpMats[1];C.Matrix.RotationYawPitchRollToRef(P,f,Y,w),o.multiplyToRef(w,w),this._rotateWithMatrix(w,q,m)}rotate(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;const m=L._TmpMats[0];m.setTranslationFromFloats(0,0,0),C.Matrix.RotationAxisToRef(P,f,m),this._rotateWithMatrix(m,Y,q)}setAxisAngle(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3?arguments[3]:void 0;if(0===Y){const m=L._TmpQuat;return C.Quaternion.RotationAxisToRef(P,f,m),void this.setRotationQuaternion(m,Y,q)}const m=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(m,q))return;const o=L._TmpMats[1];C.Matrix.RotationAxisToRef(P,f,o),m.multiplyToRef(o,o),this._rotateWithMatrix(o,Y,q)}setRotation(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(P.y,P.x,P.z,f,Y)}setRotationQuaternion(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;if(0===f)return this._decompose(),this._localRotation.q(P),void this._markAsDirtyAndCompose();const q=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,Y))return;const m=L._TmpMats[1];C.Matrix.FromQuaternionToRef(P,m),q.multiplyToRef(m,m),this._rotateWithMatrix(m,f,Y)}setRotationMatrix(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;if(0===f){const q=L._TmpQuat;return C.Quaternion.FromRotationMatrixToRef(P,q),void this.setRotationQuaternion(q,f,Y)}const q=L._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(q,Y))return;const m=L._TmpMats[1];m.q(P),q.multiplyToRef(P,m),this._rotateWithMatrix(m,f,Y)}_rotateWithMatrix(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;const C=this.getLocalMatrix(),q=C.m[12],m=C.m[13],o=C.m[14],w=this.getParent(),d=L._TmpMats[3],R=L._TmpMats[4];w&&1==f?(Y?(d.q(Y.getWorldMatrix()),w.getAbsoluteMatrix().multiplyToRef(d,d)):d.q(w.getAbsoluteMatrix()),R.q(d),R.invert(),C.multiplyToRef(d,C),C.multiplyToRef(P,C),C.multiplyToRef(R,C)):1==f&&Y?(d.q(Y.getWorldMatrix()),R.q(d),R.invert(),C.multiplyToRef(d,C),C.multiplyToRef(P,C),C.multiplyToRef(R,C)):C.multiplyToRef(P,C),C.setTranslationFromFloats(q,m,o),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(P,f){const Y=L._TmpMats[2];return P.q(this.getAbsoluteMatrix()),f?(P.multiplyToRef(f.getWorldMatrix(),P),C.Matrix.ScalingToRef(f.Ro.x,f.Ro.y,f.Ro.z,Y)):C.Matrix.IdentityToRef(Y),P.invert(),!isNaN(P.m[0])&&(Y.multiplyAtIndex(0,this._scalingDeterminant),P.multiplyToRef(Y,P),!0)}gf(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=C.Of.Zero();return this.getPositionToRef(P,f,Y),Y}getPositionToRef(){let P=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const P=this.getLocalMatrix();f.x=P.m[12],f.y=P.m[13],f.z=P.m[14]}else{let Y=null;P&&(Y=P.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let C=L._TmpMats[0];P&&Y?(C.q(this.getAbsoluteMatrix()),C.multiplyToRef(Y,C)):C=this.getAbsoluteMatrix(),f.x=C.m[12],f.y=C.m[13],f.z=C.m[14]}}getAbsolutePosition(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const f=C.Of.Zero();return this.getPositionToRef(1,P,f),f}getAbsolutePositionToRef(P,f){this.getPositionToRef(1,P,f)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Qr.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.q(this.Qr);const P=this._skeleton.getPoseMatrix();P&&this._absoluteMatrix.multiplyToRef(P,this._absoluteMatrix)}const P=this.children,f=P.length;for(let Y=0;Y<f;Y++)P[Y].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}rw(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=C.Of.Zero();return this.getDirectionToRef(P,f,Y),Y}getDirectionToRef(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,q=null;f&&(q=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=L._TmpMats[0];m.q(this.getAbsoluteMatrix()),f&&q&&m.multiplyToRef(q,m),C.Of.TransformNormalToRef(P,m,Y),Y.normalize()}getRotation(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=C.Of.Zero();return this.getRotationToRef(P,f,Y),Y}getRotationToRef(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0;const C=L._TmpQuat;this.getRotationQuaternionToRef(P,f,C),C.toEulerAnglesToRef(Y)}getRotationQuaternion(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=C.Quaternion.Identity();return this.getRotationQuaternionToRef(P,f,Y),Y}getRotationQuaternionToRef(){let P=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),f.q(this._localRotation);else{const Y=L._TmpMats[0],C=this.getAbsoluteMatrix();P?C.multiplyToRef(P.getWorldMatrix(),Y):Y.q(C),Y.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyAtIndex(1,this._scalingDeterminant),Y.multiplyAtIndex(2,this._scalingDeterminant),Y.decompose(void 0,f,void 0)}}getRotationMatrix(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1?arguments[1]:void 0;const Y=C.Matrix.Identity();return this.getRotationMatrixToRef(P,f,Y),Y}getRotationMatrixToRef(){let P=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(f);else{const Y=L._TmpMats[0],C=this.getAbsoluteMatrix();P?C.multiplyToRef(P.getWorldMatrix(),Y):Y.q(C),Y.multiplyAtIndex(0,this._scalingDeterminant),Y.multiplyAtIndex(1,this._scalingDeterminant),Y.multiplyAtIndex(2,this._scalingDeterminant),Y.getRotationMatrixToRef(f)}}getAbsolutePositionFromLocal(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=C.Of.Zero();return this.getAbsolutePositionFromLocalToRef(P,f,Y),Y}getAbsolutePositionFromLocalToRef(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,q=null;f&&(q=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=L._TmpMats[0];m.q(this.getAbsoluteMatrix()),f&&q&&m.multiplyToRef(q,m),C.Of.TransformCoordinatesToRef(P,m,Y)}getLocalPositionFromAbsolute(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=C.Of.Zero();return this.getLocalPositionFromAbsoluteToRef(P,f,Y),Y}getLocalPositionFromAbsoluteToRef(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2?arguments[2]:void 0,q=null;f&&(q=f.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const m=L._TmpMats[0];m.q(this.getAbsoluteMatrix()),f&&q&&m.multiplyToRef(q,m),m.invert(),C.Of.TransformCoordinatesToRef(P,m,Y)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const P=this._skeleton.bones.indexOf(this);if(-1!==P&&this._skeleton.bones.splice(P,1),this._parentNode&&this._parentNode.children){const P=this._parentNode.children,f=P.indexOf(this);-1!==f&&P.splice(f,1)}super.dispose()}}L._TmpVecs=(0,q.d)(2,C.Of.Zero),L._TmpQuat=C.Quaternion.Identity(),L._TmpMats=(0,q.d)(5,C.Matrix.Identity)},13355:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>Q});var C=Y(11165),q=Y(11170),m=Y(11018),L=Y(11179),o=Y(11198),w=Y(11620),d=Y(11648),R=Y(11476),y=Y(11035),r=Y(11187);class i{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(P){this._zoomStopsAnimation=P}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(P){this._idleRotationSpeed=P}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(P){this._idleRotationWaitTime=P}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(P){this._idleRotationSpinupTime=P}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(P){this._attachedCamera=P;const f=this._attachedCamera.vP();this._onPrePointerObservableObserver=f.onPrePointerObservable.add((P=>{P.type!==R.d.POINTERDOWN?P.type===R.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=P.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const P=y.e.Now;let f=0;null!=this._lastFrameTime&&(f=P-this._lastFrameTime),this._lastFrameTime=P,this._applyUserInteraction();const Y=P-this._lastInteractionTime-this._idleRotationWaitTime,C=Math.max(Math.min(Y/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*C,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(f/1e3))}))}detach(){if(!this._attachedCamera)return;const P=this._attachedCamera.vP();this._onPrePointerObservableObserver&&P.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(P){this._lastInteractionTime=P??y.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<r.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let P=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(P=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?P:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=y.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var u=Y(13360),g=Y(11727);class S{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(P){if(this._autoTransitionRange===P)return;this._autoTransitionRange=P;const f=this._attachedCamera;f&&(P?this._onMeshTargetChangedObserver=f.onMeshTargetChangedObservable.add((P=>{if(P&&(P.XC(!0),P.getBoundingInfo)){const f=P.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*f,this.upperRadiusTransitionRange=.05*f}})):this._onMeshTargetChangedObserver&&f.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(P){this._attachedCamera=P,this._onAfterCheckInputsObserver=P.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(P){return!!this._attachedCamera&&(this._attachedCamera.radius===P&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(P){if(!this._attachedCamera)return;this._radiusBounceTransition||(S.EasingFunction.setEasingMode(S.EasingMode),this._radiusBounceTransition=g.b.CreateAnimation("radius",g.b.ANIMATIONTYPE_FLOAT,60,S.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const f=g.b.TransitionTo("radius",this._attachedCamera.radius+P,this._attachedCamera,this._attachedCamera.vP(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));f&&this._animatables.push(f)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}S.EasingFunction=new u.d(.3),S.EasingMode=u.p.EASINGMODE_EASEOUT;class K{constructor(){this.onTargetFramingAnimationEndObservable=new m.e,this._mode=K.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(P){this._mode=P}get mode(){return this._mode}set radiusScale(P){this._radiusScale=P}get radiusScale(){return this._radiusScale}set positionScale(P){this._positionScale=P}get positionScale(){return this._positionScale}set defaultElevation(P){this._defaultElevation=P}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(P){this._elevationReturnTime=P}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(P){this._elevationReturnWaitTime=P}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(P){this._zoomStopsAnimation=P}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(P){this._framingTime=P}get framingTime(){return this._framingTime}init(){}attach(P){this._attachedCamera=P;const f=this._attachedCamera.vP();K.EasingFunction.setEasingMode(K.EasingMode),this._onPrePointerObservableObserver=f.onPrePointerObservable.add((P=>{P.type!==R.d.POINTERDOWN?P.type===R.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=P.onMeshTargetChangedObservable.add((P=>{P&&P.getBoundingInfo&&this.zoomOnMesh(P,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=P.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const P=this._attachedCamera.vP();this._onPrePointerObservableObserver&&P.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P.XC(!0);const C=P.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(C.minimumWorld,C.maximumWorld,f,Y)}zoomOnMeshHierarchy(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;P.XC(!0);const C=P.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(C.min,C.max,f,Y)}zoomOnMeshesHierarchy(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new L.Of(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new L.Of(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let m=0;m<P.length;m++){const f=P[m].getHierarchyBoundingVectors(!0);L.Of.CheckExtends(f.min,C,q),L.Of.CheckExtends(f.max,C,q)}this.zoomOnBoundingInfo(C,q,f,Y)}zoomOnBoundingInfo(P,f){let Y,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const m=P.y,o=m+(f.y-m)*this._positionScale,w=f.nf(P).scale(.5);if(!isFinite(o))return!1;if(C)Y=new L.Of(0,o,0);else{const f=P.add(w);Y=new L.Of(f.x,o,f.z)}this._vectorTransition||(this._vectorTransition=g.b.CreateAnimation("target",g.b.ANIMATIONTYPE_VECTOR3,60,K.EasingFunction)),this._betaIsAnimating=!0;let d=g.b.TransitionTo("target",Y,this._attachedCamera,this._attachedCamera.vP(),60,this._vectorTransition,this._framingTime);d&&this._animatables.push(d);let R=0;if(this._mode===K.FitFrustumSidesMode){const Y=this._calculateLowerRadiusFromModelBoundingSphere(P,f);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=w.length()+this._attachedCamera.zf),R=Y}else this._mode===K.IgnoreBoundsSizeMode&&(R=this._calculateLowerRadiusFromModelBoundingSphere(P,f),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.zf));if(this.autoCorrectCameraLimitsAndSensibility){const Y=f.nf(P).length();this._attachedCamera.panningSensibility=5e3/Y,this._attachedCamera.wheelPrecision=100/R}return this._radiusTransition||(this._radiusTransition=g.b.CreateAnimation("radius",g.b.ANIMATIONTYPE_FLOAT,60,K.EasingFunction)),d=g.b.TransitionTo("radius",R,this._attachedCamera,this._attachedCamera.vP(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),q&&q(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),d&&this._animatables.push(d),!0}_calculateLowerRadiusFromModelBoundingSphere(P,f){const Y=this._attachedCamera;if(!Y)return 0;let C=Y._calculateLowerRadiusFromModelBoundingSphere(P,f,this._radiusScale);return Y.lowerRadiusLimit&&this._mode===K.IgnoreBoundsSizeMode&&(C=C<Y.lowerRadiusLimit?Y.lowerRadiusLimit:C),Y.upperRadiusLimit&&(C=C>Y.upperRadiusLimit?Y.upperRadiusLimit:C),C}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const P=y.e.Now-this._lastInteractionTime,f=.5*Math.PI-this._defaultElevation,Y=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Y&&P>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=g.b.CreateAnimation("beta",g.b.ANIMATIONTYPE_FLOAT,60,K.EasingFunction));const P=g.b.TransitionTo("beta",f,this._attachedCamera,this._attachedCamera.vP(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));P&&this._animatables.push(P)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=y.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}K.EasingFunction=new u.t,K.EasingMode=u.p.EASINGMODE_EASEINOUT,K.IgnoreBoundsSizeMode=0,K.FitFrustumSidesMode=1;var M=Y(11657),V=Y(11684),O=Y(12836),n=Y(11014);class l{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(P){P=n.Tools.BackCompatCameraNoPreventDefault(arguments);const f=this.camera.getEngine(),Y=f.getInputElement();let C=0,q=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=m=>{var L,o;const w=m.event,d="touch"===w.pointerType;if(m.type!==R.d.POINTERMOVE&&-1===this.buttons.indexOf(w.button))return;const y=w.target;if(this._altKey=w.altKey,this._ctrlKey=w.ctrlKey,this._metaKey=w.metaKey,this._shiftKey=w.shiftKey,this._buttonsPressed=w.buttons,f.isPointerLock){const P=w.movementX,f=w.movementY;this.onTouch(null,P,f),this._pointA=null,this._pointB=null}else{if(m.type!==R.d.POINTERDOWN&&m.type!==R.d.POINTERDOUBLETAP&&d&&(null===(L=this._pointA)||void 0===L?void 0:L.pointerId)!==w.pointerId&&(null===(o=this._pointB)||void 0===o?void 0:o.pointerId)!==w.pointerId)return;if(m.type!==R.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!d)if(m.type===R.d.POINTERDOUBLETAP)this.onDoubleTap(w.pointerType);else if(m.type!==R.d.POINTERUP||this._currentMousePointerIdDown!==w.pointerId&&!d){if(m.type===R.d.POINTERMOVE)if(P||w.preventDefault(),this._pointA&&null===this._pointB){const P=w.clientX-this._pointA.x,f=w.clientY-this._pointA.y;this._pointA.x=w.clientX,this._pointA.y=w.clientY,this.onTouch(this._pointA,P,f)}else if(this._pointA&&this._pointB){const P=this._pointA.pointerId===w.pointerId?this._pointA:this._pointB;P.x=w.clientX,P.y=w.clientY;const f=this._pointA.x-this._pointB.x,Y=this._pointA.y-this._pointB.y,L=f*f+Y*Y,o={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:w.pointerId,type:m.type};this.onMultiTouch(this._pointA,this._pointB,C,L,q,o),q=o,C=L}}else{try{null===y||void 0===y||y.releasePointerCapture(w.pointerId)}catch(r){}d||(this._pointB=null),f._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==w.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==w.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==C||q)&&(this.onMultiTouch(this._pointA,this._pointB,C,0,q,null),C=0,q=null),this._currentMousePointerIdDown=-1,this.onButtonUp(w),P||w.preventDefault()}else{try{null===y||void 0===y||y.setPointerCapture(w.pointerId)}catch(r){}if(null===this._pointA)this._pointA={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType};else{if(null!==this._pointB)return;this._pointB={x:w.clientX,y:w.clientY,pointerId:w.pointerId,type:w.pointerType}}-1!==this._currentMousePointerIdDown||d||(this._currentMousePointerIdDown=w.pointerId),this.onButtonDown(w),P||(w.preventDefault(),Y&&Y.focus())}}},this._observer=this.camera.vP()._inputManager._addCameraPointerObserver(this._pointerInput,R.d.POINTERDOWN|R.d.POINTERUP|R.d.POINTERMOVE|R.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,C=0,q=null,this.onLostFocus()},this._contextMenuBind=P=>this.onContextMenu(P),Y&&Y.addEventListener("contextmenu",this._contextMenuBind,!1);const m=this.camera.vP().getEngine().getHostWindow();m&&n.Tools.RegisterTopRootEvents(m,[{name:"blur",handler:this._onLostFocus}])}Ay(){if(this._onLostFocus){const P=this.camera.vP().getEngine().getHostWindow();P&&n.Tools.UnregisterTopRootEvents(P,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.vP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const P=this.camera.vP().getEngine().getInputElement();P&&P.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(P){}onTouch(P,f,Y){}onMultiTouch(P,f,Y,C,q,m){}onContextMenu(P){P.preventDefault()}onButtonDown(P){}onButtonUp(P){}onLostFocus(){}}(0,C.b)([(0,q.F)()],l.prototype,"buttons",void 0);class v extends l{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(P,f){if(0!==this.panningSensibility&&P&&f){const Y=f.x-P.x,C=f.y-P.y;this.camera.inertialPanningX+=-Y/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility}}_computePinchZoom(P,f){const Y=this.camera.radius||v.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=Y*Math.sqrt(P)/Math.sqrt(f):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(f-P)*Y*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(f-P)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(P,f,Y){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-f/this.panningSensibility,this.camera.inertialPanningY+=Y/this.panningSensibility):(this.camera.inertialAlphaOffset-=f/this.angularSensibilityX,this.camera.inertialBetaOffset-=Y/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(P,f,Y,C,q,m){0===Y&&null===q||0===C&&null===m||(this.multiTouchPanAndZoom?(this._computePinchZoom(Y,C),this._computeMultiTouchPanning(q,m)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(C)-Math.sqrt(Y))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Y,C),this._isPinching=!0):this._computeMultiTouchPanning(q,m)):this.multiTouchPanning?this._computeMultiTouchPanning(q,m):this.pinchZoom&&this._computePinchZoom(Y,C))}onButtonDown(P){this._isPanClick=P.button===this.camera._panningMouseButton}onButtonUp(P){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}v.MinimumRadiusForPinch=.001,(0,C.b)([(0,q.F)()],v.prototype,"buttons",void 0),(0,C.b)([(0,q.F)()],v.prototype,"angularSensibilityX",void 0),(0,C.b)([(0,q.F)()],v.prototype,"angularSensibilityY",void 0),(0,C.b)([(0,q.F)()],v.prototype,"pinchPrecision",void 0),(0,C.b)([(0,q.F)()],v.prototype,"pinchDeltaPercentage",void 0),(0,C.b)([(0,q.F)()],v.prototype,"useNaturalPinchZoom",void 0),(0,C.b)([(0,q.F)()],v.prototype,"pinchZoom",void 0),(0,C.b)([(0,q.F)()],v.prototype,"panningSensibility",void 0),(0,C.b)([(0,q.F)()],v.prototype,"multiTouchPanning",void 0),(0,C.b)([(0,q.F)()],v.prototype,"multiTouchPanAndZoom",void 0),O.d.ArcRotateCameraPointersInput=v;var c=Y(11483);class T{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(P){P=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.vP(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((f=>{const Y=f.event;if(!Y.metaKey)if(f.type===c.b.KEYDOWN){if(this._ctrlPressed=Y.ctrlKey,this._altPressed=Y.altKey,-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysReset.indexOf(Y.keyCode)){-1===this._keys.indexOf(Y.keyCode)&&this._keys.push(Y.keyCode),Y.preventDefault&&(P||Y.preventDefault())}}else if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysReset.indexOf(Y.keyCode)){const f=this._keys.indexOf(Y.keyCode);f>=0&&this._keys.splice(f,1),Y.preventDefault&&(P||Y.preventDefault())}})))}Ay(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const P=this.camera;for(let f=0;f<this._keys.length;f++){const Y=this._keys[f];-1!==this.keysLeft.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningX-=1/this.panningSensibility:P.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?P.inertialRadiusOffset+=1/this.zoomingSensibility:P.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningX+=1/this.panningSensibility:P.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Y)?this._ctrlPressed&&this.camera._useCtrlForPanning?P.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?P.inertialRadiusOffset-=1/this.zoomingSensibility:P.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Y)&&P.useInputToRestoreState&&P.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,C.b)([(0,q.F)()],T.prototype,"keysUp",void 0),(0,C.b)([(0,q.F)()],T.prototype,"keysDown",void 0),(0,C.b)([(0,q.F)()],T.prototype,"keysLeft",void 0),(0,C.b)([(0,q.F)()],T.prototype,"keysRight",void 0),(0,C.b)([(0,q.F)()],T.prototype,"keysReset",void 0),(0,C.b)([(0,q.F)()],T.prototype,"panningSensibility",void 0),(0,C.b)([(0,q.F)()],T.prototype,"zoomingSensibility",void 0),(0,C.b)([(0,q.F)()],T.prototype,"useAltToZoom",void 0),(0,C.b)([(0,q.F)()],T.prototype,"angularSpeed",void 0),O.d.ArcRotateCameraKeyboardMoveInput=T;var U=Y(11230),D=Y(11486);class j{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new L.Of(0,0,0),this._globalOffset=new L.Of(0,0,0),this._inertialPanning=L.Of.Zero()}_computeDeltaFromMouseWheelLegacyEvent(P,f){let Y=0;const C=.01*P*this.wheelDeltaPercentage*f;return Y=P>0?C/(1+this.wheelDeltaPercentage):C*(1+this.wheelDeltaPercentage),Y}attachControl(P){P=n.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=f=>{if(f.type!==R.d.POINTERWHEEL)return;const Y=f.event;let C=0;const q=Y.deltaMode===D.c.DOM_DELTA_LINE?40:1,m=-Y.deltaY*q;if(this.customComputeDeltaFromMouseWheel)C=this.customComputeDeltaFromMouseWheel(m,this,Y);else if(this.wheelDeltaPercentage){if(C=this._computeDeltaFromMouseWheelLegacyEvent(m,this.camera.radius),C>0){let P=this.camera.radius,f=this.camera.inertialRadiusOffset+C;for(let Y=0;Y<20&&!(P<=f)&&!(Math.abs(f*this.camera.inertia)<.001);Y++)P-=f,f*=this.camera.inertia;P=(0,o.Clamp)(P,0,Number.MAX_VALUE),C=this._computeDeltaFromMouseWheelLegacyEvent(m,P)}}else C=m/(40*this.wheelPrecision);C&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(C)):this.camera.inertialRadiusOffset+=C),Y.preventDefault&&(P||Y.preventDefault())},this._observer=this.camera.vP()._inputManager._addCameraPointerObserver(this._wheel,R.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.yo(0)}Ay(){this._observer&&(this.camera.vP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const P=this.camera;0+P.inertialAlphaOffset+P.inertialBetaOffset+P.inertialRadiusOffset&&(this._updateHitPlane(),P.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(P.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const P=this.camera,f=P.target.nf(P.position);this._hitPlane=U.d.FromPositionAndNormal(P.target,f)}_getPosition(){const P=this.camera,f=P.vP(),Y=f.createPickingRay(f.pointerX,f.pointerY,L.Matrix.Identity(),P,!1);0===P.targetScreenOffset.x&&0===P.targetScreenOffset.y||(this._viewOffset.set(P.targetScreenOffset.x,P.targetScreenOffset.y,0),P.getViewMatrix().invertToRef(P._cameraTransformMatrix),this._globalOffset=L.Of.TransformNormal(this._viewOffset,P._cameraTransformMatrix),Y.origin.addInPlace(this._globalOffset));let C=0;return this._hitPlane&&(C=Y.intersectsPlane(this._hitPlane)??0),Y.origin.addInPlace(Y.direction.scaleInPlace(C))}_zoomToMouse(P){const f=this.camera,Y=1-f.inertia;if(f.lowerRadiusLimit){const C=f.lowerRadiusLimit??0;f.radius-(f.inertialRadiusOffset+P)/Y<C&&(P=(f.radius-C)*Y-f.inertialRadiusOffset)}if(f.upperRadiusLimit){const C=f.upperRadiusLimit??0;f.radius-(f.inertialRadiusOffset+P)/Y>C&&(P=(f.radius-C)*Y-f.inertialRadiusOffset)}const C=P/Y/f.radius,q=this._getPosition(),m=L.TmpVectors.Of[6];q.subtractToRef(f.target,m),m.scaleInPlace(C),m.scaleInPlace(Y),this._inertialPanning.addInPlace(m),f.inertialRadiusOffset+=P}_zeroIfClose(P){Math.abs(P.x)<r.c&&(P.x=0),Math.abs(P.y)<r.c&&(P.y=0),Math.abs(P.z)<r.c&&(P.z=0)}}(0,C.b)([(0,q.F)()],j.prototype,"wheelPrecision",void 0),(0,C.b)([(0,q.F)()],j.prototype,"zoomToMouseLocation",void 0),(0,C.b)([(0,q.F)()],j.prototype,"wheelDeltaPercentage",void 0),O.d.ArcRotateCameraMouseWheelInput=j;class e extends O.e{constructor(P){super(P)}addMouseWheel(){return this.add(new j),this}addPointers(){return this.add(new v),this}addKeyboard(){return this.add(new T),this}}var s=Y(11134);function a(P,f){return isNaN(P)?f:P}w.b.AddNodeConstructor("ArcRotateCamera",((P,f)=>()=>new Q(P,0,0,1,L.Of.Zero(),f)));class Q extends V.e{get target(){return this._target}set target(P){this.setTarget(P)}get targetHost(){return this._targetHost}set targetHost(P){P&&this.setTarget(P)}getTarget(){return this.target}get position(){return this._position}set position(P){this.setPosition(P)}set upVector(P){this._upToYMatrix||(this._yToUpMatrix=new L.Matrix,this._upToYMatrix=new L.Matrix,this._upVector=L.Of.Zero()),P.normalize(),this._upVector.q(P),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){L.Matrix.RotationAlignToRef(L.Of.UpReadOnly,this._upVector,this._yToUpMatrix),L.Matrix.RotationAlignToRef(this._upVector,L.Of.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const P=this.inputs.attached.pointers;return P?P.angularSensibilityX:0}set angularSensibilityX(P){const f=this.inputs.attached.pointers;f&&(f.angularSensibilityX=P)}get angularSensibilityY(){const P=this.inputs.attached.pointers;return P?P.angularSensibilityY:0}set angularSensibilityY(P){const f=this.inputs.attached.pointers;f&&(f.angularSensibilityY=P)}get pinchPrecision(){const P=this.inputs.attached.pointers;return P?P.pinchPrecision:0}set pinchPrecision(P){const f=this.inputs.attached.pointers;f&&(f.pinchPrecision=P)}get pinchDeltaPercentage(){const P=this.inputs.attached.pointers;return P?P.pinchDeltaPercentage:0}set pinchDeltaPercentage(P){const f=this.inputs.attached.pointers;f&&(f.pinchDeltaPercentage=P)}get useNaturalPinchZoom(){const P=this.inputs.attached.pointers;return!!P&&P.useNaturalPinchZoom}set useNaturalPinchZoom(P){const f=this.inputs.attached.pointers;f&&(f.useNaturalPinchZoom=P)}get panningSensibility(){const P=this.inputs.attached.pointers;return P?P.panningSensibility:0}set panningSensibility(P){const f=this.inputs.attached.pointers;f&&(f.panningSensibility=P)}get keysUp(){const P=this.inputs.attached.keyboard;return P?P.keysUp:[]}set keysUp(P){const f=this.inputs.attached.keyboard;f&&(f.keysUp=P)}get keysDown(){const P=this.inputs.attached.keyboard;return P?P.keysDown:[]}set keysDown(P){const f=this.inputs.attached.keyboard;f&&(f.keysDown=P)}get keysLeft(){const P=this.inputs.attached.keyboard;return P?P.keysLeft:[]}set keysLeft(P){const f=this.inputs.attached.keyboard;f&&(f.keysLeft=P)}get keysRight(){const P=this.inputs.attached.keyboard;return P?P.keysRight:[]}set keysRight(P){const f=this.inputs.attached.keyboard;f&&(f.keysRight=P)}get wheelPrecision(){const P=this.inputs.attached.mousewheel;return P?P.wheelPrecision:0}set wheelPrecision(P){const f=this.inputs.attached.mousewheel;f&&(f.wheelPrecision=P)}get zoomToMouseLocation(){const P=this.inputs.attached.mousewheel;return!!P&&P.zoomToMouseLocation}set zoomToMouseLocation(P){const f=this.inputs.attached.mousewheel;f&&(f.zoomToMouseLocation=P)}get wheelDeltaPercentage(){const P=this.inputs.attached.mousewheel;return P?P.wheelDeltaPercentage:0}set wheelDeltaPercentage(P){const f=this.inputs.attached.mousewheel;f&&(f.wheelDeltaPercentage=P)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(P){P!==this.useBouncingBehavior&&(P?(this._bouncingBehavior=new S,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(P){P!==this.useFramingBehavior&&(P?(this._framingBehavior=new K,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(P){P!==this.useAutoRotationBehavior&&(P?(this._autoRotationBehavior=new i,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(P,f,Y,C,q,o){var w;let d=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(P,L.Of.Zero(),o,d),w=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=L.Of.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=L.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new L.Matrix,this.panningAxis=new L.Of(1,1,0),this._transformedDirection=new L.Of,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new m.e,this.checkCollisions=!1,this.collisionRadius=new L.Of(.5,.5,.5),this._previousPosition=L.Of.Zero(),this._collisionVelocity=L.Of.Zero(),this._newPosition=L.Of.Zero(),this._computationVector=L.Of.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new L.Of(NaN,NaN,NaN),this._goalTargetScreenOffset=new L.Vector2(NaN,NaN),this._onCollisionPositionChange=function(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Y?(w.setPosition(f),w.ai&&w.ai(Y)):w._previousPosition.q(w._position);const C=Math.cos(w.alpha),q=Math.sin(w.alpha),m=Math.cos(w.beta);let L=Math.sin(w.beta);0===L&&(L=1e-4);const o=w._getTargetPosition();w._computationVector.do(w.radius*C*L,w.radius*m,w.radius*q*L),o.addToRef(w._computationVector,w._newPosition),w._position.q(w._newPosition);let d=w.upVector;w.allowUpsideDown&&w.beta<0&&(d=d.clone(),d=d.negate()),w._computeViewMatrix(w._position,o,d),w._viewMatrix.addAtIndex(12,w.targetScreenOffset.x),w._viewMatrix.addAtIndex(13,w.targetScreenOffset.y),w._collisionTriggered=!1},this._target=L.Of.Zero(),q&&this.setTarget(q),this.alpha=f,this.beta=Y,this.radius=C,this.getViewMatrix(),this.inputs=new e(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new L.Of(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=L.Vector2.Zero()}_updateCache(P){P||super._updateCache(),this._cache._target.q(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.q(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const P=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?P.addToRef(this._targetBoundingCenter,this._target):this._target.q(P)}const P=this._getLockedTargetPosition();return P||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>r.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,m=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=m?this._currentInterpolationFactor=m:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=a(P,this._goalAlpha),this._goalBeta=a(f,this._goalBeta),this._goalRadius=a(Y,this._goalRadius),this._goalTarget.set(a(C.x,this._goalTarget.x),a(C.y,this._goalTarget.y),a(C.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(a(q.x,this._goalTargetScreenOffset.x),a(q.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,o.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,o.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,o.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,o.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(P,f){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const q=arguments;f=n.Tools.BackCompatCameraNoPreventDefault(q),this._useCtrlForPanning=Y,this._panningMouseButton=C,"boolean"===typeof q[0]&&(q.length>1&&(this._useCtrlForPanning=q[1]),q.length>2&&(this._panningMouseButton=q[2])),this.inputs.attachElement(f),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Ay(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let P=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){P=!0;const f=this.invertRotation?-1:1,Y=this._calculateHandednessMultiplier();let C=this.inertialAlphaOffset*Y;this.beta<0&&(C*=-1),this.alpha+=C*f,this.beta+=this.inertialBetaOffset*f,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<r.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<r.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*r.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){P=!0;const f=new L.Of(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),f.multiplyInPlace(this.panningAxis),L.Of.TransformNormalToRef(f,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const P=this.upVector,f=L.Of.CrossToRef(this._transformedDirection,P,this._transformedDirection);L.Of.CrossToRef(P,f,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);L.Of.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.q(this._transformedDirection)}else{if(this.parent){const P=L.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(P),P.transposeToRef(P),L.Of.TransformCoordinatesToRef(this._transformedDirection,P,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*r.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*r.c&&(this.inertialPanningY=0)}if(P)this.stopInterpolation();else if(this._isInterpolating){let P=!1;const f=this._scene.getEngine().getDeltaTime()/1e3,Y=1-Math.pow(2,-f/this._currentInterpolationFactor),C=a(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const f=L.TmpVectors.Of[0].set(a(this._goalTarget.x,this._target.x),a(this._goalTarget.y,this._target.y),a(this._goalTarget.z,this._target.z));L.Of.LerpToRef(this.target,f,Y,this._target),10*L.Of.Distance(this.target,f)/C<r.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.q(f),this.setTarget(this.target,!1,!0,!0)):P=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const f=L.Quaternion.RotationAlphaBetaGammaToRef(a(this._goalAlpha,this.alpha),a(this._goalBeta,this.beta),0,L.TmpVectors.Quaternion[0]),C=L.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,L.TmpVectors.Quaternion[1]),q=L.Quaternion.SlerpToRef(C,f,Y,L.TmpVectors.Quaternion[2]);q.normalize();const m=q.toAlphaBetaGammaToRef(L.TmpVectors.Of[0]);if(this.alpha=m.x,this.beta=m.y,q.isApprox(f,r.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const P=f.toAlphaBetaGammaToRef(L.TmpVectors.Of[0]);this.alpha=P.x,this.beta=P.y}else P=!0}if(isNaN(this._goalRadius)||(this.radius+=(C-this.radius)*Y,Math.abs(C/this.radius-1)<r.c?(this._goalRadius=NaN,this.radius=C):P=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const f=L.TmpVectors.Vector2[0].set(a(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),a(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));L.Vector2.LerpToRef(this.targetScreenOffset,f,Y,this.targetScreenOffset),L.Vector2.Distance(this.targetScreenOffset,f)<r.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.q(f)):P=!0}this._isInterpolating=P}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||L.Of.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const P=this.alpha;var f,Y;this.alpha=function(P){let f=Math.PI/2;return 0===P.x&&0===P.z||(f=Math.acos(P.x/Math.sqrt(Math.pow(P.x,2)+Math.pow(P.z,2)))),P.z<0&&(f=2*Math.PI-f),f}(this._computationVector),this.beta=(f=this._computationVector.y,Y=this.radius,Math.acos(f/Y));const C=Math.round((P-this.alpha)/(2*Math.PI));this.alpha+=2*C*Math.PI,this._checkLimits()}setPosition(P){this._position.equals(P)||(this._position.q(P),this.rebuildAnglesAndRadius())}setTarget(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(C=this.overrideCloneAlphaBetaRadius??C,P.XC)f&&P.getBoundingInfo?this._targetBoundingCenter=P.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,P.XC(),this._targetHost=P,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const f=P,C=this._getTargetPosition();if(C&&!Y&&C.equals(f))return;this._targetHost=null,this._target=f,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}C||this.rebuildAnglesAndRadius()}_getViewMatrix(){const P=Math.cos(this.alpha),f=Math.sin(this.alpha),Y=Math.cos(this.beta);let C=Math.sin(this.beta);0===C&&(C=1e-4),0===this.radius&&(this.radius=1e-4);const q=this._getTargetPosition();if(this._computationVector.do(this.radius*P*C,this.radius*Y,this.radius*f*C),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||L.Of.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),q.addToRef(this._computationVector,this._newPosition),this.vP().collisionsEnabled&&this.checkCollisions){const P=this.vP().collisionCoordinator;this._collider||(this._collider=P.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,P.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.q(this._newPosition);let P=this.upVector;this.allowUpsideDown&&C<0&&(P=P.negate()),this._computeViewMatrix(this._position,q,P),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.q(q),this._viewMatrix}zoomOn(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];P=P||this.vP().meshes;const Y=d.c.MinMax(P);let C=this._calculateLowerRadiusFromModelBoundingSphere(Y.min,Y.max);if(C=Math.max(Math.min(C,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=C*this.zoomOnFactor,this.mode===M.e.ORTHOGRAPHIC_CAMERA){const P=this.vP().getEngine().getAspectRatio(this),f=C*this.zoomOnFactor/2;this.orthoLeft=-f*P,this.orthoRight=f*P,this.orthoBottom=-f,this.orthoTop=f}this.focusOn({min:Y.min,max:Y.max,distance:C},f)}focusOn(P){let f,Y,C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===P.min){const C=P||this.vP().meshes;f=d.c.MinMax(C),Y=L.Of.Distance(f.min,f.max)}else{f=P,Y=P.distance}this._target=d.c.Center(f),C||(this.maxZ=2*Y)}createRigCamera(P,f){let Y=0;switch(this.cameraRigMode){case M.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.e.RIG_MODE_VR:Y=this._cameraRigParams.stereoHalfAngle*(0===f?1:-1);break;case M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Y=this._cameraRigParams.stereoHalfAngle*(0===f?-1:1)}const C=new Q(P,this.alpha+Y,this.beta,this.radius,this._target,this.vP());return C._cameraRigParams={},C.isRigCamera=!0,C.rigParent=this,C.upVector=this.upVector,C.mode=this.mode,C.orthoLeft=this.orthoLeft,C.orthoRight=this.orthoRight,C.orthoBottom=this.orthoBottom,C.orthoTop=this.orthoTop,C}_updateRigCameras(){const P=this._rigCameras[0],f=this._rigCameras[1];switch(P.beta=f.beta=this.beta,this.cameraRigMode){case M.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case M.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case M.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case M.e.RIG_MODE_VR:P.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,f.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case M.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:P.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,f.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const C=L.Of.Distance(P,f),q=this.vP().getEngine().getAspectRatio(this),m=Math.tan(this.fov/2),o=m*q,w=.5*C*Y,d=w*Math.sqrt(1+1/(o*o)),R=w*Math.sqrt(1+1/(m*m));return Math.max(d,R)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,C.b)([(0,q.F)()],Q.prototype,"alpha",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"beta",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"radius",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,C.b)([(0,q.D)("target")],Q.prototype,"_target",void 0),(0,C.b)([(0,q.u)("targetHost")],Q.prototype,"_targetHost",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"inertialAlphaOffset",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"inertialBetaOffset",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"inertialRadiusOffset",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"lowerAlphaLimit",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"upperAlphaLimit",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"lowerBetaLimit",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"upperBetaLimit",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"lowerRadiusLimit",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"upperRadiusLimit",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"lowerTargetYLimit",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"inertialPanningX",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"inertialPanningY",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"pinchToPanMaxDistance",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"panningDistanceLimit",void 0),(0,C.b)([(0,q.D)()],Q.prototype,"panningOriginTarget",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"panningInertia",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"zoomToMouseLocation",null),(0,C.b)([(0,q.F)()],Q.prototype,"zoomOnFactor",void 0),(0,C.b)([(0,q.B)()],Q.prototype,"targetScreenOffset",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"allowUpsideDown",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"useInputToRestoreState",void 0),(0,C.b)([(0,q.F)()],Q.prototype,"restoreStateInterpolationFactor",void 0),(0,s.d)("BABYLON.ArcRotateCamera",Q)},12836:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>L,e:()=>o});var C=Y(11025),q=Y(11216),m=Y(11657),L={};class o{constructor(P){this.attachedToElement=!1,this.attached={},this.camera=P,this.checkInputs=()=>{}}add(P){const f=P.getSimpleName();this.attached[f]?C.e.Warn("camera input of type "+f+" already exists on camera"):(this.attached[f]=P,P.camera=this.camera,P.checkInputs&&(this.checkInputs=this._addCheckInputs(P.checkInputs.bind(P))),this.attachedToElement&&P.attachControl(this.noPreventDefault))}remove(P){for(const f in this.attached){const Y=this.attached[f];if(Y===P)return Y.Ay(),Y.camera=null,delete this.attached[f],void this.rebuildInputCheck()}}removeByType(P){for(const f in this.attached){const Y=this.attached[f];Y.getClassName()===P&&(Y.Ay(),Y.camera=null,delete this.attached[f],this.rebuildInputCheck())}}_addCheckInputs(P){const f=this.checkInputs;return()=>{f(),P()}}attachInput(P){this.attachedToElement&&P.attachControl(this.noPreventDefault)}attachElement(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){P=!m.e.ForceAttachControlToAlwaysPreventDefault&&P,this.attachedToElement=!0,this.noPreventDefault=P;for(const f in this.attached)this.attached[f].attachControl(P)}}detachElement(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const f in this.attached)this.attached[f].Ay(),P&&(this.attached[f].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const P in this.attached){const f=this.attached[P];f.checkInputs&&(this.checkInputs=this._addCheckInputs(f.checkInputs.bind(f)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(P){const f={};for(const Y in this.attached){const P=this.attached[Y],C=q.e.Serialize(P);f[P.getClassName()]=C}P.inputsmgr=f}parse(P){const f=P.inputsmgr;if(f){this.clear();for(const P in f){const Y=L[P];if(Y){const C=f[P],m=q.e.Parse((()=>new Y),C,null);this.add(m)}}}else for(const Y in this.attached){const f=L[this.attached[Y].getClassName()];if(f){const C=q.e.Parse((()=>new f),P,null);this.remove(this.attached[Y]),this.add(C)}}}}},12833:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>l});var C=Y(11165),q=Y(11170),m=Y(11179),L=Y(11684),o=Y(12836),w=Y(11483),d=Y(11014);class R{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(P){P=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.vP(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((f=>{const Y=f.event;if(!Y.metaKey)if(f.type===w.b.KEYDOWN){if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysUpward.indexOf(Y.keyCode)||-1!==this.keysDownward.indexOf(Y.keyCode)||-1!==this.keysRotateLeft.indexOf(Y.keyCode)||-1!==this.keysRotateRight.indexOf(Y.keyCode)||-1!==this.keysRotateUp.indexOf(Y.keyCode)||-1!==this.keysRotateDown.indexOf(Y.keyCode)){-1===this._keys.indexOf(Y.keyCode)&&this._keys.push(Y.keyCode),P||Y.preventDefault()}}else if(-1!==this.keysUp.indexOf(Y.keyCode)||-1!==this.keysDown.indexOf(Y.keyCode)||-1!==this.keysLeft.indexOf(Y.keyCode)||-1!==this.keysRight.indexOf(Y.keyCode)||-1!==this.keysUpward.indexOf(Y.keyCode)||-1!==this.keysDownward.indexOf(Y.keyCode)||-1!==this.keysRotateLeft.indexOf(Y.keyCode)||-1!==this.keysRotateRight.indexOf(Y.keyCode)||-1!==this.keysRotateUp.indexOf(Y.keyCode)||-1!==this.keysRotateDown.indexOf(Y.keyCode)){const f=this._keys.indexOf(Y.keyCode);f>=0&&this._keys.splice(f,1),P||Y.preventDefault()}})))}Ay(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const P=this.camera;for(let f=0;f<this._keys.length;f++){const Y=this._keys[f],C=P._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Y)?P._localDirection.do(-C,0,0):-1!==this.keysUp.indexOf(Y)?P._localDirection.do(0,0,C):-1!==this.keysRight.indexOf(Y)?P._localDirection.do(C,0,0):-1!==this.keysDown.indexOf(Y)?P._localDirection.do(0,0,-C):-1!==this.keysUpward.indexOf(Y)?P._localDirection.do(0,C,0):-1!==this.keysDownward.indexOf(Y)?P._localDirection.do(0,-C,0):-1!==this.keysRotateLeft.indexOf(Y)?(P._localDirection.do(0,0,0),P.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Y)?(P._localDirection.do(0,0,0),P.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Y)?(P._localDirection.do(0,0,0),P.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Y)&&(P._localDirection.do(0,0,0),P.cameraRotation.x+=this._getLocalRotation()),P.vP().useRightHandedSystem&&(P._localDirection.z*=-1),P.getViewMatrix().invertToRef(P._cameraTransformMatrix),m.Of.TransformNormalToRef(P._localDirection,P._cameraTransformMatrix,P._transformedDirection),P.cameraDirection.addInPlace(P._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const P=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*P}}(0,C.b)([(0,q.F)()],R.prototype,"keysUp",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysUpward",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysDown",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysDownward",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysLeft",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysRight",void 0),(0,C.b)([(0,q.F)()],R.prototype,"rotationSpeed",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysRotateLeft",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysRotateRight",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysRotateUp",void 0),(0,C.b)([(0,q.F)()],R.prototype,"keysRotateDown",void 0),o.d.FreeCameraKeyboardMoveInput=R;var y=Y(11018),r=Y(11476);class i{constructor(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=P,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new y.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(P){P=d.Tools.BackCompatCameraNoPreventDefault(arguments);const f=this.camera.getEngine(),Y=f.getInputElement();this._pointerInput||(this._pointerInput=C=>{const q=C.event,m="touch"===q.pointerType;if(!this.touchEnabled&&m)return;if(C.type!==r.d.POINTERMOVE&&-1===this.buttons.indexOf(q.button))return;const L=q.target;if(C.type===r.d.POINTERDOWN){if(m&&-1!==this._activePointerId||!m&&-1!==this._currentActiveButton)return;this._activePointerId=q.pointerId;try{null===L||void 0===L||L.setPointerCapture(q.pointerId)}catch(o){}-1===this._currentActiveButton&&(this._currentActiveButton=q.button),this._previousPosition={x:q.clientX,y:q.clientY},P||(q.preventDefault(),Y&&Y.focus()),f.isPointerLock&&this._onMouseMove&&this._onMouseMove(C.event)}else if(C.type===r.d.POINTERUP){if(m&&this._activePointerId!==q.pointerId||!m&&this._currentActiveButton!==q.button)return;try{null===L||void 0===L||L.releasePointerCapture(q.pointerId)}catch(o){}this._currentActiveButton=-1,this._previousPosition=null,P||q.preventDefault(),this._activePointerId=-1}else if(C.type===r.d.POINTERMOVE&&(this._activePointerId===q.pointerId||!m))if(f.isPointerLock&&this._onMouseMove)this._onMouseMove(C.event);else if(this._previousPosition){const f=this.camera._calculateHandednessMultiplier(),Y=(q.clientX-this._previousPosition.x)*f,C=q.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Y/this.angularSensibility,this.camera.cameraRotation.x+=C/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Y,offsetY:C}),this._previousPosition={x:q.clientX,y:q.clientY},P||q.preventDefault()}}),this._onMouseMove=Y=>{if(!f.isPointerLock)return;const C=this.camera._calculateHandednessMultiplier(),q=Y.movementX*C;this.camera.cameraRotation.y+=q/this.angularSensibility;const m=Y.movementY;this.camera.cameraRotation.x+=m/this.angularSensibility,this._previousPosition=null,P||Y.preventDefault()},this._observer=this.camera.vP()._inputManager._addCameraPointerObserver(this._pointerInput,r.d.POINTERDOWN|r.d.POINTERUP|r.d.POINTERMOVE),Y&&(this._contextMenuBind=P=>this.onContextMenu(P),Y.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(P){P.preventDefault()}Ay(){if(this._observer){if(this.camera.vP()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const P=this.camera.getEngine().getInputElement();P&&P.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,C.b)([(0,q.F)()],i.prototype,"buttons",void 0),(0,C.b)([(0,q.F)()],i.prototype,"angularSensibility",void 0),o.d.FreeCameraMouseInput=i;var u,g=Y(11486);class S{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new y.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(P){P=d.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=f=>{if(f.type!==r.d.POINTERWHEEL)return;const Y=f.event,C=Y.deltaMode===g.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*C*Y.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*C*Y.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*C*Y.deltaZ/this._normalize,Y.preventDefault&&(P||Y.preventDefault())},this._observer=this.camera.vP()._inputManager._addCameraPointerObserver(this._wheel,r.d.POINTERWHEEL)}Ay(){this._observer&&(this.camera.vP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,C.b)([(0,q.F)()],S.prototype,"wheelPrecisionX",void 0),(0,C.b)([(0,q.F)()],S.prototype,"wheelPrecisionY",void 0),(0,C.b)([(0,q.F)()],S.prototype,"wheelPrecisionZ",void 0),function(P){P[P.MoveRelative=0]="MoveRelative",P[P.RotateRelative=1]="RotateRelative",P[P.MoveScene=2]="MoveScene"}(u||(u={}));class K extends S{constructor(){super(...arguments),this._moveRelative=m.Of.Zero(),this._rotateRelative=m.Of.Zero(),this._moveScene=m.Of.Zero(),this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(P){null===P&&this._wheelXAction!==u.MoveRelative||(this._wheelXAction=u.MoveRelative,this._wheelXActionCoordinate=P)}get wheelXMoveRelative(){return this._wheelXAction!==u.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(P){null===P&&this._wheelYAction!==u.MoveRelative||(this._wheelYAction=u.MoveRelative,this._wheelYActionCoordinate=P)}get wheelYMoveRelative(){return this._wheelYAction!==u.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(P){null===P&&this._wheelZAction!==u.MoveRelative||(this._wheelZAction=u.MoveRelative,this._wheelZActionCoordinate=P)}get wheelZMoveRelative(){return this._wheelZAction!==u.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(P){null===P&&this._wheelXAction!==u.RotateRelative||(this._wheelXAction=u.RotateRelative,this._wheelXActionCoordinate=P)}get wheelXRotateRelative(){return this._wheelXAction!==u.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(P){null===P&&this._wheelYAction!==u.RotateRelative||(this._wheelYAction=u.RotateRelative,this._wheelYActionCoordinate=P)}get wheelYRotateRelative(){return this._wheelYAction!==u.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(P){null===P&&this._wheelZAction!==u.RotateRelative||(this._wheelZAction=u.RotateRelative,this._wheelZActionCoordinate=P)}get wheelZRotateRelative(){return this._wheelZAction!==u.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(P){null===P&&this._wheelXAction!==u.MoveScene||(this._wheelXAction=u.MoveScene,this._wheelXActionCoordinate=P)}get wheelXMoveScene(){return this._wheelXAction!==u.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(P){null===P&&this._wheelYAction!==u.MoveScene||(this._wheelYAction=u.MoveScene,this._wheelYActionCoordinate=P)}get wheelYMoveScene(){return this._wheelYAction!==u.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(P){null===P&&this._wheelZAction!==u.MoveScene||(this._wheelZAction=u.MoveScene,this._wheelZActionCoordinate=P)}get wheelZMoveScene(){return this._wheelZAction!==u.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.yo(0),this._rotateRelative.yo(0),this._moveScene.yo(0),this._updateCamera(),this.camera.vP().useRightHandedSystem&&(this._moveRelative.z*=-1);const P=m.Matrix.Zero();this.camera.getViewMatrix().invertToRef(P);const f=m.Of.Zero();m.Of.TransformNormalToRef(this._moveRelative,P,f),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(f),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(P,f,Y){if(0===P)return;if(null===f||null===Y)return;let C=null;switch(f){case u.MoveRelative:C=this._moveRelative;break;case u.RotateRelative:C=this._rotateRelative;break;case u.MoveScene:C=this._moveScene}switch(Y){case 0:C.set(P,0,0);break;case 1:C.set(0,P,0);break;case 2:C.set(0,0,P)}}}(0,C.b)([(0,q.F)()],K.prototype,"wheelXMoveRelative",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelYMoveRelative",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelZMoveRelative",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelXRotateRelative",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelYRotateRelative",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelZRotateRelative",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelXMoveScene",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelYMoveScene",null),(0,C.b)([(0,q.F)()],K.prototype,"wheelZMoveScene",null),o.d.FreeCameraMouseWheelInput=K;class M{constructor(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=P,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=d.Tools.IsSafari()}attachControl(P){P=d.Tools.BackCompatCameraNoPreventDefault(arguments);let f=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Y=>{const C=Y.event,q="mouse"===C.pointerType||this._isSafari&&"undefined"===typeof C.pointerType;if(this.allowMouse||!q)if(Y.type===r.d.POINTERDOWN){if(P||C.preventDefault(),this._pointerPressed.push(C.pointerId),1!==this._pointerPressed.length)return;f={x:C.clientX,y:C.clientY}}else if(Y.type===r.d.POINTERUP){P||C.preventDefault();const Y=this._pointerPressed.indexOf(C.pointerId);if(-1===Y)return;if(this._pointerPressed.splice(Y,1),0!=Y)return;f=null,this._offsetX=null,this._offsetY=null}else if(Y.type===r.d.POINTERMOVE){if(P||C.preventDefault(),!f)return;if(0!=this._pointerPressed.indexOf(C.pointerId))return;this._offsetX=C.clientX-f.x,this._offsetY=-(C.clientY-f.y)}}),this._observer=this.camera.vP()._inputManager._addCameraPointerObserver(this._pointerInput,r.d.POINTERDOWN|r.d.POINTERUP|r.d.POINTERMOVE),this._onLostFocus){const P=this.camera.getEngine().getInputElement();P&&P.addEventListener("blur",this._onLostFocus)}}Ay(){if(this._pointerInput){if(this._observer&&(this.camera.vP()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const P=this.camera.getEngine().getInputElement();P&&P.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const P=this.camera,f=P._calculateHandednessMultiplier();P.cameraRotation.y=f*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)P.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const f=P._computeLocalCameraSpeed(),Y=new m.Of(0,0,0!==this.touchMoveSensibility?f*this._offsetY/this.touchMoveSensibility:0);m.Matrix.RotationYawPitchRollToRef(P.rotation.y,P.rotation.x,0,P._cameraRotationMatrix),P.cameraDirection.addInPlace(m.Of.TransformCoordinates(Y,P._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,C.b)([(0,q.F)()],M.prototype,"touchAngularSensibility",void 0),(0,C.b)([(0,q.F)()],M.prototype,"touchMoveSensibility",void 0),o.d.FreeCameraTouchInput=M;class V extends o.e{constructor(P){super(P),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new R),this}addMouse(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new i(P),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new K,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new M),this}clear(){super.clear(),this._mouseInput=null}}var O=Y(11134),n=Y(11089);class l extends L.e{get angularSensibility(){const P=this.inputs.attached.mouse;return P?P.angularSensibility:0}set angularSensibility(P){const f=this.inputs.attached.mouse;f&&(f.angularSensibility=P)}get keysUp(){const P=this.inputs.attached.keyboard;return P?P.keysUp:[]}set keysUp(P){const f=this.inputs.attached.keyboard;f&&(f.keysUp=P)}get keysUpward(){const P=this.inputs.attached.keyboard;return P?P.keysUpward:[]}set keysUpward(P){const f=this.inputs.attached.keyboard;f&&(f.keysUpward=P)}get keysDown(){const P=this.inputs.attached.keyboard;return P?P.keysDown:[]}set keysDown(P){const f=this.inputs.attached.keyboard;f&&(f.keysDown=P)}get keysDownward(){const P=this.inputs.attached.keyboard;return P?P.keysDownward:[]}set keysDownward(P){const f=this.inputs.attached.keyboard;f&&(f.keysDownward=P)}get keysLeft(){const P=this.inputs.attached.keyboard;return P?P.keysLeft:[]}set keysLeft(P){const f=this.inputs.attached.keyboard;f&&(f.keysLeft=P)}get keysRight(){const P=this.inputs.attached.keyboard;return P?P.keysRight:[]}set keysRight(P){const f=this.inputs.attached.keyboard;f&&(f.keysRight=P)}get keysRotateLeft(){const P=this.inputs.attached.keyboard;return P?P.keysRotateLeft:[]}set keysRotateLeft(P){const f=this.inputs.attached.keyboard;f&&(f.keysRotateLeft=P)}get keysRotateRight(){const P=this.inputs.attached.keyboard;return P?P.keysRotateRight:[]}set keysRotateRight(P){const f=this.inputs.attached.keyboard;f&&(f.keysRotateRight=P)}get keysRotateUp(){const P=this.inputs.attached.keyboard;return P?P.keysRotateUp:[]}set keysRotateUp(P){const f=this.inputs.attached.keyboard;f&&(f.keysRotateUp=P)}get keysRotateDown(){const P=this.inputs.attached.keyboard;return P?P.keysRotateDown:[]}set keysRotateDown(P){const f=this.inputs.attached.keyboard;f&&(f.keysRotateDown=P)}constructor(P,f,Y){var C;super(P,f,Y,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),C=this,this.ellipsoid=new m.Of(.5,1,.5),this.ellipsoidOffset=new m.Of(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=m.Of.Zero(),this._diffPosition=m.Of.Zero(),this._newPosition=m.Of.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C._newPosition.q(f),C._newPosition.subtractToRef(C._oldPosition,C._diffPosition),C._diffPosition.length()>n.c.CollisionsEpsilon&&(C.position.addToRef(C._diffPosition,C._deferredPositionUpdate),C._deferOnly?C._deferredUpdated=!0:C.position.q(C._deferredPositionUpdate),C.ai&&Y&&C.ai(Y))},this.inputs=new V(this),this.inputs.addKeyboard().addMouse()}attachControl(P,f){f=d.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(f)}Ay(){this.inputs.detachElement(),this.cameraDirection=new m.Of(0,0,0),this.cameraRotation=new m.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(P){this._collisionMask=isNaN(P)?-1:P}_collideWithWorld(P){let f;f=this.parent?m.Of.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,f.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Y=this.vP().collisionCoordinator;this._collider||(this._collider=Y.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let C=P;this.applyGravity&&(C=P.add(this.vP().gravity)),Y.getNewPosition(this._oldPosition,C,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=m.Of.Zero(),this._transformedDirection=m.Of.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(P){this._needMoveForGravity=P}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.vP().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"yd"}}(0,C.b)([(0,q.D)()],l.prototype,"ellipsoid",void 0),(0,C.b)([(0,q.D)()],l.prototype,"ellipsoidOffset",void 0),(0,C.b)([(0,q.F)()],l.prototype,"checkCollisions",void 0),(0,C.b)([(0,q.F)()],l.prototype,"applyGravity",void 0),(0,O.d)("BABYLON.FreeCamera",l)},13410:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>m});var C=Y(11280),q=Y(13418);class m{constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Y,this.Yy=[],this._maxBlockCapacity=f||64,this._selectionContent=new C.b(1024),this._creationFunc=P}update(P,f,Y){q.b._CreateBlocks(P,f,Y,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}wR(P){for(let f=0;f<this.OR.length;f++){this.OR[f].addEntry(P)}}oR(P){for(let f=0;f<this.OR.length;f++){this.OR[f].removeEntry(P)}}select(P,f){this._selectionContent.reset();for(let Y=0;Y<this.OR.length;Y++){this.OR[Y].select(P,this._selectionContent,f)}return f?this._selectionContent.concat(this.Yy):this._selectionContent.concatWithNoDuplicate(this.Yy),this._selectionContent}intersects(P,f,Y){this._selectionContent.reset();for(let C=0;C<this.OR.length;C++){this.OR[C].intersects(P,f,this._selectionContent,Y)}return Y?this._selectionContent.concat(this.Yy):this._selectionContent.concatWithNoDuplicate(this.Yy),this._selectionContent}intersectsRay(P){this._selectionContent.reset();for(let f=0;f<this.OR.length;f++){this.OR[f].intersectsRay(P,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Yy),this._selectionContent}}m.CreationFuncForMeshes=(P,f)=>{const Y=P.getBoundingInfo();!P.isBlocked&&Y.boundingBox.intersectsMinMax(f.oy,f.wy)&&f.entries.push(P)},m.CreationFuncForSubMeshes=(P,f)=>{P.getBoundingInfo().boundingBox.intersectsMinMax(f.oy,f.wy)&&f.entries.push(P)}},13418:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>m});var C=Y(11179),q=Y(11542);class m{constructor(P,f,Y,C,q,m){this.entries=[],this.Ry=new Array,this._capacity=Y,this._depth=C,this._maxDepth=q,this._creationFunc=m,this._minPoint=P,this._maxPoint=f,this.Ry.push(P.clone()),this.Ry.push(f.clone()),this.Ry.push(P.clone()),this.Ry[2].x=f.x,this.Ry.push(P.clone()),this.Ry[3].y=f.y,this.Ry.push(P.clone()),this.Ry[4].z=f.z,this.Ry.push(f.clone()),this.Ry[5].z=P.z,this.Ry.push(f.clone()),this.Ry[6].x=P.x,this.Ry.push(f.clone()),this.Ry[7].y=P.y}get eY(){return this._capacity}get oy(){return this._minPoint}get wy(){return this._maxPoint}addEntry(P){if(this.OR)for(let f=0;f<this.OR.length;f++){this.OR[f].addEntry(P)}else this._creationFunc(P,this),this.entries.length>this.eY&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(P){if(this.OR){for(let f=0;f<this.OR.length;f++){this.OR[f].removeEntry(P)}return}const f=this.entries.indexOf(P);f>-1&&this.entries.splice(f,1)}addEntries(P){for(let f=0;f<P.length;f++){const Y=P[f];this.addEntry(Y)}}select(P,f,Y){if(q.d.IsInFrustum(this.Ry,P)){if(this.OR){for(let C=0;C<this.OR.length;C++){this.OR[C].select(P,f,Y)}return}Y?f.concat(this.entries):f.concatWithNoDuplicate(this.entries)}}intersects(P,f,Y,C){if(q.d.IntersectsSphere(this._minPoint,this._maxPoint,P,f)){if(this.OR){for(let q=0;q<this.OR.length;q++){this.OR[q].intersects(P,f,Y,C)}return}C?Y.concat(this.entries):Y.concatWithNoDuplicate(this.entries)}}intersectsRay(P,f){if(P.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.OR){for(let Y=0;Y<this.OR.length;Y++){this.OR[Y].intersectsRay(P,f)}return}f.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){m._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(P,f,Y,q,L,o,w,d){w.OR=new Array;const R=new C.Of((f.x-P.x)/2,(f.y-P.y)/2,(f.z-P.z)/2);for(let C=0;C<2;C++)for(let f=0;f<2;f++)for(let y=0;y<2;y++){const r=P.add(R.multiplyByFloats(C,f,y)),i=P.add(R.multiplyByFloats(C+1,f+1,y+1)),u=new m(r,i,q,L+1,o,d);u.addEntries(Y),w.OR.push(u)}}}},13420:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>R});var C=Y(11429),q=Y(11179),m=Y(11622),L=Y(12600),o=Y(11467),w=Y(13410),d=Y(11052);C.e.prototype.createOrUpdateSelectionOctree=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Y=this._getComponent(o.d.NAME_OCTREE);Y||(Y=new R(this),this.mf(Y)),this.FR||(this.FR=new w.e(w.e.CreationFuncForMeshes,P,f));const C=this.getWorldExtends();return this.FR.update(C.min,C.max,this.meshes),this.FR},Object.defineProperty(C.e.prototype,"selectionOctree",{get:function(){return this.FR},enumerable:!0,configurable:!0}),m.b.prototype.createOrUpdateSubmeshesOctree=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Y=this.vP();let C=Y._getComponent(o.d.NAME_OCTREE);C||(C=new R(Y),Y.mf(C)),this._submeshesOctree||(this._submeshesOctree=new w.e(w.e.CreationFuncForSubMeshes,P,f)),this.XC(!0);const q=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(q.minimumWorld,q.maximumWorld,this.Jf),this._submeshesOctree};class R{constructor(P){this.name=o.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new L.c(q.Of.Zero(),new q.Of(1,1,1)),(P=P||d.e.LastCreatedScene)&&(this.lf=P,this.lf.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.lf.getActiveSubMeshCandidates=P=>this.getActiveSubMeshCandidates(P),this.lf.getCollidingSubMeshCandidates=(P,f)=>this.getCollidingSubMeshCandidates(P,f),this.lf.getIntersectingSubMeshCandidates=(P,f)=>this.getIntersectingSubMeshCandidates(P,f))}register(){this.lf.onMeshRemovedObservable.add((P=>{const f=this.lf.selectionOctree;if(void 0!==f&&null!==f){const Y=f.Yy.indexOf(P);-1!==Y&&f.Yy.splice(Y,1)}})),this.lf.onMeshImportedObservable.add((P=>{const f=this.lf.selectionOctree;void 0!==f&&null!==f&&f.wR(P)}))}getActiveMeshCandidates(){var P;return(null===(P=this.lf.FR)||void 0===P?void 0:P.select(this.lf.frustumPlanes))||this.lf._getDefaultMeshCandidates()}getActiveSubMeshCandidates(P){if(P._submeshesOctree&&P.useOctreeForRenderingSelection){return P._submeshesOctree.select(this.lf.frustumPlanes)}return this.lf._getDefaultSubMeshCandidates(P)}getIntersectingSubMeshCandidates(P,f){if(P._submeshesOctree&&P.useOctreeForPicking){L.c.TransformToRef(f,P.getWorldMatrix(),this._tempRay);return P._submeshesOctree.intersectsRay(this._tempRay)}return this.lf._getDefaultSubMeshCandidates(P)}getCollidingSubMeshCandidates(P,f){if(P._submeshesOctree&&P.useOctreeForCollisions){const Y=f._velocityWorldLength+Math.max(f._radius.x,f._radius.y,f._radius.z);return P._submeshesOctree.intersects(f._basePointWorld,Y)}return this.lf._getDefaultSubMeshCandidates(P)}rebuild(){}dispose(){}}},12600:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>i});var C=Y(11429),q=Y(11657),m=Y(11187),L=Y(11179),o=Y(11196),w=Y(11530),d=Y(11461),R=Y(11052),y=Y(11494);const r={internalPickerForMesh:void 0};class i{constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m.c;this.origin=P,this.direction=f,this.length=Y,this.epsilon=C}clone(){return new i(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=i._TmpVector3[0].do(P.x-Y,P.y-Y,P.z-Y),q=i._TmpVector3[1].do(f.x+Y,f.y+Y,f.z+Y);let m,L,o,w,d=0,R=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<C.x||this.origin.x>q.x)return!1}else if(m=1/this.direction.x,L=(C.x-this.origin.x)*m,o=(q.x-this.origin.x)*m,o===-1/0&&(o=1/0),L>o&&(w=L,L=o,o=w),d=Math.max(L,d),R=Math.min(o,R),d>R)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<C.y||this.origin.y>q.y)return!1}else if(m=1/this.direction.y,L=(C.y-this.origin.y)*m,o=(q.y-this.origin.y)*m,o===-1/0&&(o=1/0),L>o&&(w=L,L=o,o=w),d=Math.max(L,d),R=Math.min(o,R),d>R)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<C.z||this.origin.z>q.z)return!1}else if(m=1/this.direction.z,L=(C.z-this.origin.z)*m,o=(q.z-this.origin.z)*m,o===-1/0&&(o=1/0),L>o&&(w=L,L=o,o=w),d=Math.max(L,d),R=Math.min(o,R),d>R)return!1;return!0}intersectsBox(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(P.minimum,P.maximum,f)}intersectsSphere(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=P.center.x-this.origin.x,C=P.center.y-this.origin.y,q=P.center.z-this.origin.z,m=Y*Y+C*C+q*q,L=P.radius+f,o=L*L;if(m<=o)return!0;const w=Y*this.direction.x+C*this.direction.y+q*this.direction.z;if(w<0)return!1;return m-w*w<=o}intersectsTriangle(P,f,Y){const C=i._TmpVector3[0],q=i._TmpVector3[1],m=i._TmpVector3[2],o=i._TmpVector3[3],d=i._TmpVector3[4];f.subtractToRef(P,C),Y.subtractToRef(P,q),L.Of.CrossToRef(this.direction,q,m);const R=L.Of.Dot(C,m);if(0===R)return null;const y=1/R;this.origin.subtractToRef(P,o);const r=L.Of.Dot(o,m)*y;if(r<-this.epsilon||r>1+this.epsilon)return null;L.Of.CrossToRef(o,C,d);const u=L.Of.Dot(this.direction,d)*y;if(u<-this.epsilon||r+u>1+this.epsilon)return null;const g=L.Of.Dot(q,d)*y;return g>this.length?null:new w.e(1-r-u,r,g)}intersectsPlane(P){let f;const Y=L.Of.Dot(P.normal,this.direction);if(Math.abs(Y)<9.99999997475243e-7)return null;{const C=L.Of.Dot(P.normal,this.origin);return f=(-P.d-C)/Y,f<0?f<-9.99999997475243e-7?null:0:f}}intersectsAxis(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(P){case"y":{const P=(this.origin.y-f)/this.direction.y;return P>0?null:new L.Of(this.origin.x+this.direction.x*-P,f,this.origin.z+this.direction.z*-P)}case"x":{const P=(this.origin.x-f)/this.direction.x;return P>0?null:new L.Of(f,this.origin.y+this.direction.y*-P,this.origin.z+this.direction.z*-P)}case"z":{const P=(this.origin.z-f)/this.direction.z;return P>0?null:new L.Of(this.origin.x+this.direction.x*-P,this.origin.y+this.direction.y*-P,f)}default:return null}}intersectsMesh(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=L.TmpVectors.Matrix[0];return P.getWorldMatrix().invertToRef(o),this._tmpRay?i.TransformToRef(this,o,this._tmpRay):this._tmpRay=i.Transform(this,o),P.intersects(this._tmpRay,f,Y,C,q,m)}intersectsMeshes(P,f,Y){Y?Y.length=0:Y=[];for(let C=0;C<P.length;C++){const q=this.intersectsMesh(P[C],f);q.hit&&Y.push(q)}return Y.sort(this._comparePickingInfo),Y}_comparePickingInfo(P,f){return P.distance<f.distance?-1:P.distance>f.distance?1:0}intersectionSegment(P,f,Y){const C=this.origin,q=L.TmpVectors.Of[0],m=L.TmpVectors.Of[1],o=L.TmpVectors.Of[2],w=L.TmpVectors.Of[3];f.subtractToRef(P,q),this.direction.scaleToRef(i._Rayl,o),C.addToRef(o,m),P.subtractToRef(C,w);const d=L.Of.Dot(q,q),R=L.Of.Dot(q,o),y=L.Of.Dot(o,o),r=L.Of.Dot(q,w),u=L.Of.Dot(o,w),g=d*y-R*R;let S,K,M=g,V=g;g<i._Smallnum?(S=0,M=1,K=u,V=y):(S=R*u-y*r,K=d*u-R*r,S<0?(S=0,K=u,V=y):S>M&&(S=M,K=u+R,V=y)),K<0?(K=0,-r<0?S=0:-r>d?S=M:(S=-r,M=d)):K>V&&(K=V,-r+R<0?S=0:-r+R>d?S=M:(S=-r+R,M=d));const O=Math.abs(S)<i._Smallnum?0:S/M,n=Math.abs(K)<i._Smallnum?0:K/V,l=L.TmpVectors.Of[4];o.scaleToRef(n,l);const v=L.TmpVectors.Of[5];q.scaleToRef(O,v),v.addInPlace(w);const c=L.TmpVectors.Of[6];v.subtractToRef(l,c);return n>0&&n<=this.length&&c.lengthSquared()<Y*Y?v.length():-1}update(P,f,Y,C,q,m,o){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){i._RayDistant||(i._RayDistant=i.Zero()),i._RayDistant.unprojectRayToRef(P,f,Y,C,L.Matrix.IdentityReadOnly,m,o);const w=L.TmpVectors.Matrix[0];q.invertToRef(w),i.TransformToRef(i._RayDistant,w,this)}else this.unprojectRayToRef(P,f,Y,C,q,m,o);return this}static Zero(){return new i(L.Of.Zero(),L.Of.Zero())}static CreateNew(P,f,Y,C,q,m,L){return i.Zero().update(P,f,Y,C,q,m,L)}static CreateNewFromTo(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:L.Matrix.IdentityReadOnly;const C=new i(new L.Of(0,0,0),new L.Of(0,0,0));return i.CreateFromToToRef(P,f,C,Y)}static CreateFromToToRef(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:L.Matrix.IdentityReadOnly;Y.origin.q(P);const q=f.subtractToRef(P,Y.direction),m=Math.sqrt(q.x*q.x+q.y*q.y+q.z*q.z);return Y.length=m,Y.direction.normalize(),i.TransformToRef(Y,C,Y)}static Transform(P,f){const Y=new i(new L.Of(0,0,0),new L.Of(0,0,0));return i.TransformToRef(P,f,Y),Y}static TransformToRef(P,f,Y){L.Of.TransformCoordinatesToRef(P.origin,f,Y.origin),L.Of.TransformNormalToRef(P.direction,f,Y.direction),Y.length=P.length,Y.epsilon=P.epsilon;const C=Y.direction,q=C.length();if(0!==q&&1!==q){const P=1/q;C.x*=P,C.y*=P,C.z*=P,Y.length*=q}return Y}unprojectRayToRef(P,f,Y,C,q,m,o){const w=L.TmpVectors.Matrix[0];q.multiplyToRef(m,w),w.multiplyToRef(o,w),w.invert();const d=R.e.LastCreatedEngine,y=L.TmpVectors.Of[0];y.x=P/Y*2-1,y.y=-(f/C*2-1),y.z=null!==d&&void 0!==d&&d.useReverseDepthBuffer?1:null!==d&&void 0!==d&&d.isNDCHalfZRange?0:-1;const r=L.TmpVectors.Of[1].do(y.x,y.y,1-1e-8),i=L.TmpVectors.Of[2],u=L.TmpVectors.Of[3];L.Of._UnprojectFromInvertedMatrixToRef(y,w,i),L.Of._UnprojectFromInvertedMatrixToRef(r,w,u),this.origin.q(i),u.subtractToRef(i,this.direction),this.direction.normalize()}}function u(P,f,Y,C,q){let m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const L=i.Zero();return g(P,f,Y,C,L,q,m),L}function g(P,f,Y,C,q,m){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const d=P.getEngine();if(!m&&!(m=P.activeCamera))return P;const R=m.viewport,y=d.getRenderHeight(),{x:r,y:i,width:u,height:g}=R.toGlobal(d.getRenderWidth(),y),S=1/d.getHardwareScalingLevel();return f=f*S-r,Y=Y*S-(y-i-g),q.update(f,Y,u,g,C||L.Matrix.IdentityReadOnly,o?L.Matrix.IdentityReadOnly:m.getViewMatrix(),m.getProjectionMatrix(),w),P}function S(P,f,Y,C,q){if(!d.b)return P;const m=P.getEngine();if(!q&&!(q=P.activeCamera))throw new Error("Active camera not set");const o=q.viewport,w=m.getRenderHeight(),{x:R,y:y,width:r,height:i}=o.toGlobal(m.getRenderWidth(),w),u=L.Matrix.Identity(),g=1/m.getHardwareScalingLevel();return f=f*g-R,Y=Y*g-(w-y-i),C.update(f,Y,r,i,u,u,q.getProjectionMatrix()),P}function K(P,f,Y,C,q,m,L,o){const w=f(C,Y.enableDistantPicking),d=Y.intersects(w,q,L,m,C,o);return d&&d.hit?!q&&null!=P&&d.distance>=P.distance?null:d:null}function M(P,f,Y,C,q,m){let o=null;const w=!!(P.activeCameras&&P.activeCameras.length>1&&P.cameraToUseForPointers!==P.activeCamera),R=P.cameraToUseForPointers||P.activeCamera,y=r.internalPickerForMesh||K;for(let d=0;d<P.meshes.length;d++){const r=P.meshes[d];if(Y){if(!Y(r,-1))continue}else if(!r.isEnabled()||!r.isVisible||!r.nw)continue;const i=w&&r.isWorldMatrixCameraDependent(),u=r.XC(i,R);if(r.hasThinInstances&&r.thinInstanceEnablePicking){const P=y(o,f,r,u,!0,!0,m);if(P){if(q)return P;const w=L.TmpVectors.Matrix[1],d=r.thinInstanceGetWorldMatrices();for(let P=0;P<d.length;P++){if(Y&&!Y(r,P))continue;d[P].multiplyToRef(u,w);const L=y(o,f,r,w,C,q,m,!0);if(L&&(o=L,o.thinInstanceIndex=P,C))return o}}}else{const P=y(o,f,r,u,C,q,m);if(P&&(o=P,C))return o}}return o||new d.b}function V(P,f,Y,C){if(!d.b)return null;const q=[],m=!!(P.activeCameras&&P.activeCameras.length>1&&P.cameraToUseForPointers!==P.activeCamera),o=P.cameraToUseForPointers||P.activeCamera,w=r.internalPickerForMesh||K;for(let d=0;d<P.meshes.length;d++){const R=P.meshes[d];if(Y){if(!Y(R,-1))continue}else if(!R.isEnabled()||!R.isVisible||!R.nw)continue;const y=m&&R.isWorldMatrixCameraDependent(),r=R.XC(y,o);if(R.hasThinInstances&&R.thinInstanceEnablePicking){if(w(null,f,R,r,!0,!0,C)){const P=L.TmpVectors.Matrix[1],m=R.thinInstanceGetWorldMatrices();for(let L=0;L<m.length;L++){if(Y&&!Y(R,L))continue;m[L].multiplyToRef(r,P);const o=w(null,f,R,P,!1,!1,C,!0);o&&(o.thinInstanceIndex=L,q.push(o))}}}else{const P=w(null,f,R,r,!1,!1,C);P&&q.push(P)}}return q}function O(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,C=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0;C||(C=P.getWorldMatrix()),f.length=Y,q?f.origin.q(q):f.origin.q(P.position);const m=L.TmpVectors.Of[2];m.set(0,0,P._scene.useRightHandedSystem?-1:1);const o=L.TmpVectors.Of[3];return L.Of.TransformNormalToRef(m,C,o),L.Of.NormalizeToRef(o,f.direction),f}var n,l;i._TmpVector3=(0,o.d)(6,L.Of.Zero),i._RayDistant=i.Zero(),i._Smallnum=1e-8,i._Rayl=1e9,n=C.e,(l=q.e)&&(l.prototype.getForwardRay=function(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,f=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2?arguments[2]:void 0;return O(this,new i(L.Of.Zero(),L.Of.Zero(),P),P,f,Y)},l.prototype.getForwardRayToRef=function(P){return O(this,P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),n&&(y.e._IsPickingAvailable=!0,n.prototype.createPickingRay=function(P,f,Y,C){return u(this,P,f,Y,C,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),C.e.prototype.createPickingRayToRef=function(P,f,Y,C,q){return g(this,P,f,Y,C,q,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},C.e.prototype.createPickingRayInCameraSpace=function(P,f,Y){return function(P,f,Y,C){const q=i.Zero();return S(P,f,Y,q,C),q}(this,P,f,Y)},C.e.prototype.createPickingRayInCameraSpaceToRef=function(P,f,Y,C){return S(this,P,f,Y,C)},C.e.prototype.pickWithBoundingInfo=function(P,f,Y,C,q){return function(P,f,Y,C,q,m){if(!d.b)return null;const o=M(P,(C=>(P._tempPickingRay||(P._tempPickingRay=i.Zero()),g(P,f,Y,C,P._tempPickingRay,m||null),P._tempPickingRay)),C,q,!0);return o&&(o.ray=u(P,f,Y,L.Matrix.Identity(),m||null)),o}(this,P,f,Y,C,q)},C.e.prototype.DY=function(P,f,Y,C,q,m){return function(P,f,Y,C,q,m,o){const w=M(P,((C,q)=>(P._tempPickingRay||(P._tempPickingRay=i.Zero()),g(P,f,Y,C,P._tempPickingRay,m||null,!1,q),P._tempPickingRay)),C,q,!1,o);return w&&(w.ray=u(P,f,Y,L.Matrix.Identity(),m||null)),w}(this,P,f,Y,C,q,m)},C.e.prototype.pickWithRay=function(P,f,Y,C){return function(P,f,Y,C,q){const m=M(P,(Y=>(P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=L.Matrix.Identity()),Y.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=i.Zero()),i.TransformToRef(f,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform)),Y,C,!1,q);return m&&(m.ray=f),m}(this,P,f,Y,C)},C.e.prototype.multiPick=function(P,f,Y,C,q){return function(P,f,Y,C,q,m){return V(P,(C=>u(P,f,Y,C,q||null)),C,m)}(this,P,f,Y,C,q)},C.e.prototype.multiPickWithRay=function(P,f,Y){return function(P,f,Y,C){return V(P,(Y=>(P._pickWithRayInverseMatrix||(P._pickWithRayInverseMatrix=L.Matrix.Identity()),Y.invertToRef(P._pickWithRayInverseMatrix),P._cachedRayForTransform||(P._cachedRayForTransform=i.Zero()),i.TransformToRef(f,P._pickWithRayInverseMatrix,P._cachedRayForTransform),P._cachedRayForTransform)),Y,C)}(this,P,f,Y)}},12888:(P,f,Y)=>{"use strict";var C=Y(11119),q=Y(11025),m=Y(11059),L=Y(11139),o=Y(11089),w=Y(11129);o.c.prototype._partialLoadFile=function(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(P,(P=>{Y[f]=P,Y._internalCount++,6===Y._internalCount&&C(Y)}),void 0,void 0,!0,((P,f)=>{q&&P&&q(P.status+" "+P.statusText,f)}))},o.c.prototype._cascadeLoadFiles=function(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const q=[];q._internalCount=0;for(let m=0;m<6;m++)this._partialLoadFile(Y[m],m,q,f,C)},o.c.prototype._cascadeLoadImgs=function(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5?arguments[5]:void 0;const L=[];L._internalCount=0;for(let o=0;o<6;o++)this._partialLoadImg(C[o],o,L,P,f,Y,q,m)},o.c.prototype._partialLoadImg=function(P,f,Y,C,q,o){let w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7?arguments[7]:void 0;const R=(0,L.b)();(0,m.q)(P,(P=>{Y[f]=P,Y._internalCount++,C&&C.removePendingData(R),6===Y._internalCount&&o&&o(q,Y)}),((P,f)=>{C&&C.removePendingData(R),w&&w(P,f)}),C?C.offlineProvider:null,d),C&&C.addPendingData(R)},o.c.prototype.createCubeTextureBase=function(P,f,Y,m){let L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6?arguments[6]:void 0,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,y=arguments.length>8&&void 0!==arguments[8]&&arguments[8],r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,S=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,K=arguments.length>14&&void 0!==arguments[14]&&arguments[14],M=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const V=u||new C.b(this,7);V.isCube=!0,V.url=P,V.generateMipMaps=!m,V._lodGenerationScale=r,V._lodGenerationOffset=i,V._useSRGBBuffer=!!K&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!m),V!==u&&(V.label=P.substring(0,60)),this._doNotHandleContextLost||(V._extension=R,V._files=Y,V._buffer=M);const O=P;this._transformTextureUrl&&!u&&(P=this._transformTextureUrl(P));const n=R??function(P){const f=P.split("?")[0],Y=f.lastIndexOf(".");return Y>-1?f.substring(Y).toLowerCase():""}(P),l=(0,w.d)(n),v=(P,f)=>{V.dispose(),o?o(P,f):P&&q.e.Warn(P)},c=(C,o)=>{P===O?C&&v(C.status+" "+C.statusText,o):(q.e.Warn(`Failed to load ${P}, falling back to the ${O}`),this.createCubeTextureBase(O,f,Y,!!m,L,v,d,R,y,r,i,V,g,S,K,M))};if(l)l.then((C=>{const q=P=>{g&&g(V,P),C.loadCubeData(P,V,y,L,((P,f)=>{v(P,f)}))};M?q(M):Y&&6===Y.length?C.supportCascades?this._cascadeLoadFiles(f,(P=>q(P.map((P=>new Uint8Array(P))))),Y,v):v("Textures type does not support cascades."):this._loadFile(P,(P=>q(new Uint8Array(P))),void 0,void 0,!0,c)}));else{if(!Y||0===Y.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(f,V,((P,f)=>{S&&S(P,f)}),Y,v)}return this._internalTexturesCache.push(V),V}},13429:(P,f,Y)=>{"use strict";Y(11025);var C=Y(11319);Y(11119),Y(11264),Y(11112),Y(11365),Y(11324);C.c},12908:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>q});var C=Y(11134);class q{constructor(P){this.value=this._toInt(P)}_toInt(P){return 0|P}add(P){return new q(this.value+P.value)}nf(P){return new q(this.value-P.value)}multiply(P){return new q(Math.imul(this.value,P.value))}divide(P){return new q(this.value/P.value)}getClassName(){return q.ClassName}equals(P){return this.value===P.value}static FromValue(P){return new q(P)}toString(){return this.value.toString()}}q.ClassName="FlowGraphInteger",(0,C.d)("FlowGraphInteger",q)},12923:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>q,e:()=>m});var C=Y(11179);class q{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.cf=P}get m(){return this.cf}transformVector(P){return this.transformVectorToRef(P,new C.Vector2)}transformVectorToRef(P,f){return f.x=P.x*this.cf[0]+P.y*this.cf[1],f.y=P.x*this.cf[2]+P.y*this.cf[3],f}If(){return this.toArray()}toArray(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let f=0;f<4;f++)P[f]=this.cf[f];return P}jY(P){for(let f=0;f<4;f++)this.cf[f]=P[f];return this}multiplyToRef(P,f){const Y=P.cf,C=this.cf,q=f.cf;return q[0]=Y[0]*C[0]+Y[1]*C[2],q[1]=Y[0]*C[1]+Y[1]*C[3],q[2]=Y[2]*C[0]+Y[3]*C[2],q[3]=Y[2]*C[1]+Y[3]*C[3],f}multiply(P){return this.multiplyToRef(P,new q)}divideToRef(P,f){const Y=this.cf,C=P.cf,q=f.cf;return q[0]=Y[0]/C[0],q[1]=Y[1]/C[1],q[2]=Y[2]/C[2],q[3]=Y[3]/C[3],f}divide(P){return this.divideToRef(P,new q)}addToRef(P,f){const Y=this.cf,C=P.m,q=f.m;return q[0]=Y[0]+C[0],q[1]=Y[1]+C[1],q[2]=Y[2]+C[2],q[3]=Y[3]+C[3],f}add(P){return this.addToRef(P,new q)}subtractToRef(P,f){const Y=this.cf,C=P.m,q=f.m;return q[0]=Y[0]-C[0],q[1]=Y[1]-C[1],q[2]=Y[2]-C[2],q[3]=Y[3]-C[3],f}nf(P){return this.subtractToRef(P,new q)}transpose(){const P=this.cf;return new q([P[0],P[2],P[1],P[3]])}determinant(){const P=this.cf;return P[0]*P[3]-P[1]*P[2]}inverse(){const P=this.determinant();if(0===P)throw new Error("Matrix is not invertible");const f=this.cf,Y=1/P;return new q([f[3]*Y,-f[1]*Y,-f[2]*Y,f[0]*Y])}equals(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=this.cf,C=P.m;return 0===f?Y[0]===C[0]&&Y[1]===C[1]&&Y[2]===C[2]&&Y[3]===C[3]:Math.abs(Y[0]-C[0])<f&&Math.abs(Y[1]-C[1])<f&&Math.abs(Y[2]-C[2])<f&&Math.abs(Y[3]-C[3])<f}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.cf.join(", ")})`}}class m{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.cf=P}get m(){return this.cf}transformVector(P){return this.transformVectorToRef(P,new C.Of)}transformVectorToRef(P,f){const Y=this.cf;return f.x=P.x*Y[0]+P.y*Y[1]+P.z*Y[2],f.y=P.x*Y[3]+P.y*Y[4]+P.z*Y[5],f.z=P.x*Y[6]+P.y*Y[7]+P.z*Y[8],f}multiplyToRef(P,f){const Y=P.cf,C=this.cf,q=f.m;return q[0]=Y[0]*C[0]+Y[1]*C[3]+Y[2]*C[6],q[1]=Y[0]*C[1]+Y[1]*C[4]+Y[2]*C[7],q[2]=Y[0]*C[2]+Y[1]*C[5]+Y[2]*C[8],q[3]=Y[3]*C[0]+Y[4]*C[3]+Y[5]*C[6],q[4]=Y[3]*C[1]+Y[4]*C[4]+Y[5]*C[7],q[5]=Y[3]*C[2]+Y[4]*C[5]+Y[5]*C[8],q[6]=Y[6]*C[0]+Y[7]*C[3]+Y[8]*C[6],q[7]=Y[6]*C[1]+Y[7]*C[4]+Y[8]*C[7],q[8]=Y[6]*C[2]+Y[7]*C[5]+Y[8]*C[8],f}multiply(P){return this.multiplyToRef(P,new m)}divideToRef(P,f){const Y=this.cf,C=P.m,q=f.m;return q[0]=Y[0]/C[0],q[1]=Y[1]/C[1],q[2]=Y[2]/C[2],q[3]=Y[3]/C[3],q[4]=Y[4]/C[4],q[5]=Y[5]/C[5],q[6]=Y[6]/C[6],q[7]=Y[7]/C[7],q[8]=Y[8]/C[8],f}divide(P){return this.divideToRef(P,new m)}addToRef(P,f){const Y=this.cf,C=P.m,q=f.m;return q[0]=Y[0]+C[0],q[1]=Y[1]+C[1],q[2]=Y[2]+C[2],q[3]=Y[3]+C[3],q[4]=Y[4]+C[4],q[5]=Y[5]+C[5],q[6]=Y[6]+C[6],q[7]=Y[7]+C[7],q[8]=Y[8]+C[8],f}add(P){return this.addToRef(P,new m)}subtractToRef(P,f){const Y=this.cf,C=P.m,q=f.m;return q[0]=Y[0]-C[0],q[1]=Y[1]-C[1],q[2]=Y[2]-C[2],q[3]=Y[3]-C[3],q[4]=Y[4]-C[4],q[5]=Y[5]-C[5],q[6]=Y[6]-C[6],q[7]=Y[7]-C[7],q[8]=Y[8]-C[8],f}nf(P){return this.subtractToRef(P,new m)}toArray(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let f=0;f<9;f++)P[f]=this.cf[f];return P}If(){return this.toArray()}jY(P){for(let f=0;f<9;f++)this.cf[f]=P[f];return this}transpose(){const P=this.cf;return new m([P[0],P[3],P[6],P[1],P[4],P[7],P[2],P[5],P[8]])}determinant(){const P=this.cf;return P[0]*(P[4]*P[8]-P[5]*P[7])-P[1]*(P[3]*P[8]-P[5]*P[6])+P[2]*(P[3]*P[7]-P[4]*P[6])}inverse(){const P=this.determinant();if(0===P)throw new Error("Matrix is not invertible");const f=this.cf,Y=1/P;return new m([(f[4]*f[8]-f[5]*f[7])*Y,(f[2]*f[7]-f[1]*f[8])*Y,(f[1]*f[5]-f[2]*f[4])*Y,(f[5]*f[6]-f[3]*f[8])*Y,(f[0]*f[8]-f[2]*f[6])*Y,(f[2]*f[3]-f[0]*f[5])*Y,(f[3]*f[7]-f[4]*f[6])*Y,(f[1]*f[6]-f[0]*f[7])*Y,(f[0]*f[4]-f[1]*f[3])*Y])}equals(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Y=this.cf,C=P.m;return 0===f?Y[0]===C[0]&&Y[1]===C[1]&&Y[2]===C[2]&&Y[3]===C[3]&&Y[4]===C[4]&&Y[5]===C[5]&&Y[6]===C[6]&&Y[7]===C[7]&&Y[8]===C[8]:Math.abs(Y[0]-C[0])<f&&Math.abs(Y[1]-C[1])<f&&Math.abs(Y[2]-C[2])<f&&Math.abs(Y[3]-C[3])<f&&Math.abs(Y[4]-C[4])<f&&Math.abs(Y[5]-C[5])<f&&Math.abs(Y[6]-C[6])<f&&Math.abs(Y[7]-C[7])<f&&Math.abs(Y[8]-C[8])<f}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.cf.join(", ")})`}}},12931:(P,f,Y)=>{"use strict";var C;function q(P,f,Y,C){switch(f){case"Animation":return C?P.animations.find((P=>P.uniqueId===Y))??null:P.animations[Y]??null;case"AnimationGroup":return C?P.animationGroups.find((P=>P.uniqueId===Y))??null:P.animationGroups[Y]??null;case"Mesh":return C?P.meshes.find((P=>P.uniqueId===Y))??null:P.meshes[Y]??null;case"Material":return C?P.materials.find((P=>P.uniqueId===Y))??null:P.materials[Y]??null;case"SR":return C?P.cameras.find((P=>P.uniqueId===Y))??null:P.cameras[Y]??null;case"Light":return C?P.lights.find((P=>P.uniqueId===Y))??null:P.lights[Y]??null;default:return null}}Y.d(f,{e:()=>q}),function(P){P.Animation="Animation",P.AnimationGroup="AnimationGroup",P.Mesh="Mesh",P.Material="Material",P.SR="SR",P.Light="Light"}(C||(C={}))},12970:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>q});var C=Y(12974);class q extends C.d{constructor(P,f){if(super(P),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),f)for(const Y of f)this._eventsSignalOutputs[Y]=this._registerSignalOutput(Y+"Event")}_executeOnTick(P){}_startPendingTasks(P){P._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(P),this._resetAfterCanceled(P)),this._preparePendingTasks(P),P._addPendingBlock(this),this.out._activateSignal(P),P._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(P){P._deleteExecutionVariable(this,"_initialized"),P._removePendingBlock(this)}}},12947:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>d});var C=Y(11139),q=Y(11134),m=Y(12954),L=Y(11018),o=Y(12899);class w extends m.b{constructor(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:C.defaultValue,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(P,f,Y),this.richType=C,this._defaultValue=q,this._optional=m,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new L.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(P){this._isDisabled!==P&&(this._isDisabled=P,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(P,f){f._getConnectionValue(this)!==P&&(f._setConnectionValue(this,P),this.onValueChangedObservable.notifyObservers(P))}resetToDefaultValue(P){P._setConnectionValue(this,this._defaultValue)}connectTo(P){this._isDisabled||super.connectTo(P)}_getValueOrDefault(P){const f=P._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(f):f}getValue(P){if(1===this.connectionType){P._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(P);const f=this._getValueOrDefault(P);return this._lastValue=f,this.richType.typeTransformer?this.richType.typeTransformer(f):f}const f=this.isConnected()?this._connectedPoint[0].getValue(P):this._getValueOrDefault(P);return this._lastValue=f,this.richType.typeTransformer?this.richType.typeTransformer(f):f}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(P),P.richType={},this.richType.serialize(P.richType),P.optional=this._optional,(0,o.e)("defaultValue",this._defaultValue,P)}}(0,q.d)("FlowGraphDataConnection",w);class d{constructor(P){var f;this.config=P,this.uniqueId=(0,C.b)(),this.name=(null===(f=this.config)||void 0===f?void 0:f.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(P){}registerDataInput(P,f,Y){const C=new w(P,0,this,f,Y);return this.dataInputs.push(C),C}registerDataOutput(P,f,Y){const C=new w(P,1,this,f,Y);return this.dataOutputs.push(C),C}getDataInput(P){return this.dataInputs.find((f=>f.name===P))}getDataOutput(P){return this.dataOutputs.find((f=>f.name===P))}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.e;if(P.uniqueId=this.uniqueId,P.config={},this.config){const Y=this.config,C=Object.keys(Y);for(const q of C)f(q,Y[q],P.config)}P.dataInputs=[],P.dataOutputs=[],P.className=this.getClassName();for(const Y of this.dataInputs){const f={};Y.serialize(f),P.dataInputs.push(f)}for(const Y of this.dataOutputs){const f={};Y.serialize(f),P.dataOutputs.push(f)}}deserialize(P){}_log(P,f,Y){var C;null===(C=P.logger)||void 0===C||C.addLogItem({action:f,payload:Y,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12954:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>m});var C,q=Y(11139);!function(P){P[P.Input=0]="Input",P[P.Output=1]="Output"}(C||(C={}));class m{constructor(P,f,Y){this._ownerBlock=Y,this._connectedPoint=[],this.uniqueId=(0,q.b)(),this.connectedPointIds=[],this.name=P,this._connectionType=f}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(P){if(this._connectionType===P._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||P._isSingularConnection()&&P._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(P),P._connectedPoint.push(this)}disconnectFrom(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Y=this._connectedPoint.indexOf(P),C=P._connectedPoint.indexOf(this);-1!==Y&&-1!==C&&(f&&this._connectedPoint.splice(Y,1),P._connectedPoint.splice(C,1))}disconnectFromAll(){for(const P of this._connectedPoint)this.disconnectFrom(P,!1);this._connectedPoint.length=0}dispose(){for(const P of this._connectedPoint)this.disconnectFrom(P)}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};P.uniqueId=this.uniqueId,P.name=this.name,P._connectionType=this._connectionType,P.connectedPointIds=[],P.className=this.getClassName();for(const f of this._connectedPoint)P.connectedPointIds.push(f.uniqueId)}getClassName(){return"FGConnection"}deserialize(P){this.uniqueId=P.uniqueId,this.name=P.name,this._connectionType=P._connectionType,this.connectedPointIds=P.connectedPointIds}}},12895:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>V});var C,q=Y(11018),m=Y(11165),L=Y(11170),o=Y(11139),w=Y(12899),d=Y(12931),R=Y(11025);!function(P){P.ExecuteBlock="ExecuteBlock",P.ExecuteEvent="ExecuteEvent",P.TriggerConnection="TriggerConnection",P.ContextVariableSet="ContextVariableSet",P.GlobalVariableSet="GlobalVariableSet",P.GlobalVariableDelete="GlobalVariableDelete",P.GlobalVariableGet="GlobalVariableGet",P.AddConnection="AddConnection",P.GetConnectionValue="GetConnectionValue",P.SetConnectionValue="SetConnectionValue",P.ActivateSignal="ActivateSignal",P.ContextVariableGet="ContextVariableGet"}(C||(C={}));class y{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(P){if(P.time||(P.time=Date.now()),this.log.push(P),this.logToConsole){var f;const Y=null===(f=P.payload)||void 0===f?void 0:f.value;"object"===typeof Y&&Y.getClassName?R.e.Log(`[FGLog] ${P.className}:${P.uniqueId.split("-")[0]} ${P.action} - ${JSON.stringify(Y.getClassName())}: ${Y.toString()}`):R.e.Log(`[FGLog] ${P.className}:${P.uniqueId.split("-")[0]} ${P.action} - ${JSON.stringify(P.payload)}`)}}getItemsOfType(P){return this.log.filter((f=>f.action===P))}}class r{get enableLogging(){return this._enableLogging}set enableLogging(P){this._enableLogging!==P&&(this._enableLogging=P,this._enableLogging?(this.logger=new y,this.logger.logToConsole=!0):this.logger=null)}constructor(P){this.uniqueId=(0,o.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new q.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=P,this.assetsContext=P.assetsContext??P.lf}hasVariable(P){return P in this._userVariables}setVariable(P,f){var Y;this._userVariables[P]=f,null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",payload:{name:P,value:f}})}getAsset(P,f){return(0,d.e)(this.assetsContext,P,f)}getVariable(P){var f;return null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",payload:{name:P,value:this._userVariables[P]}}),this._userVariables[P]}get userVariables(){return this._userVariables}vP(){return this._configuration.lf}_getUniqueIdPrefixedName(P,f){return`${P.uniqueId}_${f}`}_getGlobalContextVariable(P,f){var Y;return null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",payload:{name:P,defaultValue:f,possibleValue:this._globalContextVariables[P]}}),this._hasGlobalContextVariable(P)?this._globalContextVariables[P]:f}_setGlobalContextVariable(P,f){var Y;null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",payload:{name:P,value:f}}),this._globalContextVariables[P]=f}_deleteGlobalContextVariable(P){var f;null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",payload:{name:P}}),delete this._globalContextVariables[P]}_hasGlobalContextVariable(P){return P in this._globalContextVariables}_setExecutionVariable(P,f,Y){this._executionVariables[this._getUniqueIdPrefixedName(P,f)]=Y}_getExecutionVariable(P,f,Y){return this._hasExecutionVariable(P,f)?this._executionVariables[this._getUniqueIdPrefixedName(P,f)]:Y}_deleteExecutionVariable(P,f){delete this._executionVariables[this._getUniqueIdPrefixedName(P,f)]}_hasExecutionVariable(P,f){return this._getUniqueIdPrefixedName(P,f)in this._executionVariables}_hasConnectionValue(P){return P.uniqueId in this._connectionValues}_setConnectionValue(P,f){var Y;this._connectionValues[P.uniqueId]=f,null===(Y=this.logger)||void 0===Y||Y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",payload:{connectionPointId:P.uniqueId,value:f}})}_setConnectionValueByKey(P,f){this._connectionValues[P]=f}_getConnectionValue(P){var f;return null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",payload:{connectionPointId:P.uniqueId,value:this._connectionValues[P.uniqueId]}}),this._connectionValues[P.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(P){this._pendingBlocks.includes(P)||(this._pendingBlocks.push(P),this._pendingBlocks.sort(((P,f)=>P.priority-f.priority)))}_removePendingBlock(P){const f=this._pendingBlocks.indexOf(P);-1!==f&&this._pendingBlocks.splice(f,1)}_clearPendingBlocks(){for(const P of this._pendingBlocks)P._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(P){var f;this.onNodeExecutedObservable.notifyObservers(P),null===(f=this.logger)||void 0===f||f.addLogItem({time:Date.now(),className:P.getClassName(),uniqueId:P.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(P){this._setGlobalContextVariable("timeSinceStart",P.timeSinceStart),this._setGlobalContextVariable("deltaTime",P.deltaTime);for(const Y of this._pendingBlocks){var f;null===(f=Y._executeOnTick)||void 0===f||f.call(Y,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.e;P.uniqueId=this.uniqueId,P._userVariables={};for(const C in this._userVariables)f(C,this._userVariables[C],P._userVariables);P._connectionValues={};for(const C in this._connectionValues)f(C,this._connectionValues[C],P._connectionValues);var Y;this.assetsContext!==this.vP()&&(P._assetsContext={meshes:this.assetsContext.meshes.map((P=>P.id)),materials:this.assetsContext.materials.map((P=>P.id)),textures:this.assetsContext.textures.map((P=>P.name)),animations:this.assetsContext.animations.map((P=>P.name)),lights:this.assetsContext.lights.map((P=>P.id)),cameras:this.assetsContext.cameras.map((P=>P.id)),zr:null===(Y=this.assetsContext.zr)||void 0===Y?void 0:Y.map((P=>P.name)),skeletons:this.assetsContext.skeletons.map((P=>P.id)),Rr:this.assetsContext.Rr.map((P=>P.name)),geometries:this.assetsContext.geometries.map((P=>P.id)),multiMaterials:this.assetsContext.multiMaterials.map((P=>P.id)),transformNodes:this.assetsContext.transformNodes.map((P=>P.id))})}getClassName(){return"FlowGraphContext"}}(0,m.b)([(0,L.F)()],r.prototype,"uniqueId",void 0);var i=Y(12939),u=Y(11476);class g{constructor(P){this.onEventTriggeredObservable=new q.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=P,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.vf.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const P=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",payload:{timeSinceStart:this._startingTime,deltaTime:P}}),this._startingTime+=P})),this._meshPickedObserver=this._scene.onPointerObservable.add((P=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",payload:P})}),u.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((P=>{const f=P.pointerId,Y=P.mesh,C=this._pointerUnderMeshState[f];!C&&Y?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:f,mesh:Y}}):C&&!Y?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:f,mesh:C}}):C&&Y&&C!==Y&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",payload:{pointerId:f,mesh:C,over:Y}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",payload:{pointerId:f,mesh:Y,out:C}})),this._pointerUnderMeshState[f]=Y}),u.d.POINTERMOVE)}dispose(){var P,f,Y,C,q;null===(P=this._sceneDisposeObserver)||void 0===P||P.remove(),null===(f=this._sceneReadyObserver)||void 0===f||f.remove(),null===(Y=this._sceneOnBeforeRenderObserver)||void 0===Y||Y.remove(),null===(C=this._meshPickedObserver)||void 0===C||C.remove(),null===(q=this._meshUnderPointerObserver)||void 0===q||q.remove(),this.onEventTriggeredObservable.clear()}}var S,K=Y(12960);!function(P){P[P.Stopped=0]="Stopped",P[P.Started=1]="Started"}(S||(S={}));class M{get state(){return this._state}set state(P){this._state=P,this.onStateChangedObservable.notifyObservers(P)}constructor(P){this.onStateChangedObservable=new q.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=P.lf,this._sceneEventCoordinator=new g(this._scene),this._coordinator=P.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((P=>{for(const f of this._executionContexts){const Y=this._getContextualOrder(P.type,f);for(const C of Y)if(!C._executeEvent(f,P.payload))break}switch(P.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const f of this._executionContexts)f._notifyOnTick(P.payload);break;case"SceneDispose":this.dispose()}}))}createContext(){const P=new r({lf:this._scene,coordinator:this._coordinator});return this._executionContexts.push(P),P}getContext(P){return this._executionContexts[P]}addEventBlock(P){if("PointerOver"!==P.type&&"PointerOut"!==P.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==P.type&&this._eventBlocks[P.type].push(P),1===this.state)for(const f of this._executionContexts)P._startPendingTasks(f);else this.onStateChangedObservable.addOnce((f=>{if(1===f)for(const Y of this._executionContexts)P._startPendingTasks(Y)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((P=>{1===P&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const P of this._executionContexts)for(const f in this._eventBlocks){const Y=this._getContextualOrder(f,P);for(const f of Y)f._startPendingTasks(P)}}_getContextualOrder(P,f){const Y=this._eventBlocks[P].sort(((P,f)=>f.initPriority-P.initPriority));if("MeshPick"===P){const P=[];for(const C of Y){const q=C.asset.getValue(f);let m=0;for(;m<Y.length;m++){const P=Y[m].asset.getValue(f);if(q&&P&&(0,K.l)(q,P))break}P.splice(m,0,C)}return P}return Y}dispose(){var P;if(0!==this.state){this.state=0;for(const P of this._executionContexts)P._clearPendingBlocks();this._executionContexts.length=0;for(const P in this._eventBlocks)this._eventBlocks[P].length=0;null===(P=this._eventObserver)||void 0===P||P.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(P){const f=[],Y=new Set;for(const C in this._eventBlocks)for(const P of this._eventBlocks[C])f.push(P),Y.add(P.uniqueId);for(;f.length>0;){const C=f.pop();P(C);for(const P of C.dataInputs)for(const C of P._connectedPoint)Y.has(C._ownerBlock.uniqueId)||(f.push(C._ownerBlock),Y.add(C._ownerBlock.uniqueId));if(C instanceof i.d)for(const P of C.signalOutputs)for(const C of P._connectedPoint)Y.has(C._ownerBlock.uniqueId)||(f.push(C._ownerBlock),Y.add(C._ownerBlock.uniqueId))}}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=arguments.length>1?arguments[1]:void 0;P.allBlocks=[],this.visitAllBlocks((f=>{const Y={};f.serialize(Y),P.allBlocks.push(Y)})),P.executionContexts=[];for(const Y of this._executionContexts){const C={};Y.serialize(C,f),P.executionContexts.push(C)}}}class V{constructor(P){this.config=P,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.lf.vf.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.lf.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const P=this._executeOnNextFrame.slice(0);if(P.length)for(const f of P){this.notifyCustomEvent(f.id,f.data,!1);const P=this._executeOnNextFrame.findIndex((P=>P.uniqueId===f.uniqueId));-1!==P&&this._executeOnNextFrame.splice(P,1)}}));(V.SceneCoordinators.get(this.config.lf)??[]).push(this)}createGraph(){const P=new M({lf:this.config.lf,coordinator:this});return this._flowGraphs.push(P),P}removeGraph(P){const f=this._flowGraphs.indexOf(P);-1!==f&&(P.dispose(),this._flowGraphs.splice(f,1))}start(){for(const P of this._flowGraphs)P.start()}dispose(){var P,f;for(const q of this._flowGraphs)q.dispose();this._flowGraphs.length=0,null===(P=this._disposeObserver)||void 0===P||P.remove(),null===(f=this._onBeforeRenderObserver)||void 0===f||f.remove();const Y=V.SceneCoordinators.get(this.config.lf)??[],C=Y.indexOf(this);-1!==C&&Y.splice(C,1)}serialize(P,f){P._flowGraphs=[];for(const Y of this._flowGraphs){const C={};Y.serialize(C,f),P._flowGraphs.push(C)}P.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(P){let f=this._customEventsMap.get(P);return f||(f=new q.e,this._customEventsMap.set(P,f)),f}notifyCustomEvent(P,f){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:P,data:f,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(P)){const f=this._eventExecutionCounter.get(P);if(this._eventExecutionCounter.set(P,f+1),f>=V.MaxEventTypeExecutionPerFrame)return void(f===V.MaxEventTypeExecutionPerFrame&&R.e.Warn(`FlowGraphCoordinator: Too many executions of event "${P}".`))}else this._eventExecutionCounter.set(P,1);const Y=this._customEventsMap.get(P);Y&&Y.notifyObservers(f)}}V.MaxEventsPerType=30,V.MaxEventTypeExecutionPerFrame=30,V.SceneCoordinators=new Map},12962:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>q});var C=Y(12970);class q extends C.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(P){P._notifyExecuteNode(this),this.done._activateSignal(P)}}},12939:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>o});var C=Y(12947),q=Y(12954),m=Y(11134);class L extends q.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(P){super.connectTo(P),this._connectedPoint.sort(((P,f)=>f.priority-P.priority))}_activateSignal(P){var f;if(null===(f=P.logger)||void 0===f||f.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,payload:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)P._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(P,this),P._increaseExecutionId();else for(const Y of this._connectedPoint)Y._activateSignal(P)}}(0,m.d)("FlowGraphSignalConnection",L);class o extends C.b{constructor(P){super(P),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(P){const f=new L(P,0,this);return this.signalInputs.push(f),f}_registerSignalOutput(P){const f=new L(P,1,this);return this.signalOutputs.push(f),f}_unregisterSignalInput(P){const f=this.signalInputs.findIndex((f=>f.name===P));-1!==f&&(this.signalInputs[f].dispose(),this.signalInputs.splice(f,1))}_unregisterSignalOutput(P){const f=this.signalOutputs.findIndex((f=>f.name===P));-1!==f&&(this.signalOutputs[f].dispose(),this.signalOutputs.splice(f,1))}_reportError(P,f){this.error.payload="string"===typeof f?new Error(f):f,this.error._activateSignal(P)}getSignalInput(P){return this.signalInputs.find((f=>f.name===P))}getSignalOutput(P){return this.signalOutputs.find((f=>f.name===P))}serialize(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(P),P.signalInputs=[],P.signalOutputs=[];for(const f of this.signalInputs){const Y={};f.serialize(Y),P.signalInputs.push(Y)}for(const f of this.signalOutputs){const Y={};f.serialize(Y),P.signalOutputs.push(Y)}}deserialize(P){for(let f=0;f<P.signalInputs.length;f++){const Y=this.getSignalInput(P.signalInputs[f].name);if(!Y)throw new Error("Could not find signal input with name "+P.signalInputs[f].name+" in block "+P.className);Y.deserialize(P.signalInputs[f])}for(let f=0;f<P.signalOutputs.length;f++){const Y=this.getSignalOutput(P.signalOutputs[f].name);if(!Y)throw new Error("Could not find signal output with name "+P.signalOutputs[f].name+" in block "+P.className);Y.deserialize(P.signalOutputs[f])}}getClassName(){return"FlowGraphExecutionBlock"}}},12974:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>q});var C=Y(12939);class q extends C.d{constructor(P){super(P),this.out=this._registerSignalOutput("out")}}},12917:(P,f,Y)=>{"use strict";Y.d(f,{A:()=>U,D:()=>c,G:()=>v,d:()=>d,e:()=>r,f:()=>l,h:()=>S,j:()=>K,k:()=>M,o:()=>y,q:()=>n,r:()=>R,u:()=>i,v:()=>u,w:()=>g,y:()=>T});var C,q=Y(11179),m=Y(11228),L=Y(12908),o=Y(12923);!function(P){P.Any="any",P.String="string",P.Number="number",P.Boolean="boolean",P.Object="object",P.Integer="FlowGraphInteger",P.Vector2="Vector2",P.Of="Of",P.Vector4="Vector4",P.Quaternion="Quaternion",P.Matrix="Matrix",P.Matrix2D="Matrix2D",P.Matrix3D="Matrix3D",P.Df="Df",P.ro="ro"}(C||(C={}));class w{constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=P,this.defaultValue=f,this.animationType=Y}serialize(P){P.typeName=this.typeName,P.defaultValue=this.defaultValue}}const d=new w("any",void 0),R=new w("string",""),y=new w("number",0,0),r=new w("boolean",!1),i=new w("Vector2",q.Vector2.Zero(),5),u=new w("Of",q.Of.Zero(),1),g=new w("Vector4",q.Vector4.Zero()),S=new w("Matrix",q.Matrix.Identity(),3),K=new w("Matrix2D",new o.c),M=new w("Matrix3D",new o.e),V=new w("Df",m.Df.Black(),4),O=new w("ro",new m.ro(0,0,0,0),7),n=new w("Quaternion",q.Quaternion.Identity(),2);n.typeTransformer=P=>{if(P.getClassName){if("Vector4"===P.getClassName())return q.Quaternion.ef(P.If());if("Of"===P.getClassName())return q.Quaternion.FromEulerVector(P);if("Matrix"===P.getClassName())return q.Quaternion.FromRotationMatrix(P)}return P};const l=new w("FlowGraphInteger",new L.c(0),0);function v(P){const f=P;switch(typeof P){case"string":return R;case"number":return y;case"boolean":return r;case"object":if(f.getClassName)switch(f.getClassName()){case"Vector2":return i;case"Of":return u;case"Vector4":return g;case"Matrix":return S;case"Df":return V;case"ro":return O;case"Quaternion":return n;case"FlowGraphInteger":return l;case"Matrix2D":return K;case"Matrix3D":return M}return d;default:return d}}function c(P){switch(P){case"string":return R;case"number":return y;case"boolean":return r;case"Vector2":return i;case"Of":return u;case"Vector4":return g;case"Matrix":return S;case"Df":return V;case"ro":return O;case"Quaternion":return n;case"FlowGraphInteger":return l;case"Matrix2D":return K;case"Matrix3D":return M;default:return d}}function T(P){switch(P){case"number":default:return 0;case"Vector2":return 5;case"Of":return 1;case"Matrix":return 3;case"Df":return 4;case"ro":return 7;case"Quaternion":return 2}}function U(P){switch(P){case 0:return y;case 5:return i;case 1:return u;case 3:return S;case 4:return V;case 7:return O;case 2:return n;default:return d}}},12899:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>R,e:()=>d,f:()=>y});var C=Y(11228),q=Y(11179),m=Y(12908),L=Y(12917),o=Y(12923);function w(P){return"Vector2"===P||"Of"===P||"Vector4"===P||"Quaternion"===P||"Df"===P||"ro"===P}function d(P,f,Y){var C;const q=(null===f||void 0===f||null===(C=f.getClassName)||void 0===C?void 0:C.call(f))??"";if(w(q)||function(P){return"Matrix"===P||"Matrix2D"===P||"Matrix3D"===P}(q))Y[P]={value:f.If(),className:q};else if("FlowGraphInteger"===q)Y[P]={value:f.value,className:q};else if(q&&(f.id||f.name))Y[P]={id:f.id,name:f.name,className:q};else{if("object"===typeof f)throw new Error(`Could not serialize value ${f}`);Y[P]=f}}function R(P,f,Y,d){const y=f[P];let r;const i=(null===y||void 0===y?void 0:y.type)??(null===y||void 0===y?void 0:y.className);if(function(P){return"Mesh"===P||"AbstractMesh"===P||"GroundMesh"===P||"InstanceMesh"===P||"LinesMesh"===P||"GoldbergMesh"===P||"GreasedLineMesh"===P||"TrailMesh"===P}(i)){let P=d.meshes.filter((P=>y.id?P.id===y.id:P.name===y.name));0===P.length&&(P=d.transformNodes.filter((P=>y.id?P.id===y.id:P.name===y.name))),r=y.uniqueId?P.find((P=>P.uniqueId===y.uniqueId)):P[0]}else if(w(i))r=function(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===P)return q.Vector2.ef(f);if("Of"===P)return Y&&(f[2]*=-1),q.Of.ef(f);if("Vector4"===P)return q.Vector4.ef(f);if("Quaternion"===P)return Y&&(f[2]*=-1,f[3]*=-1),q.Quaternion.ef(f);if("Df"===P)return new C.Df(f[0],f[1],f[2]);if("ro"===P)return new C.ro(f[0],f[1],f[2],f[3]);throw new Error(`Unknown vector class name ${P}`)}(i,y.value);else if(function(P){return"AnimationGroup"===P}(i)){const P=d.animationGroups.filter((P=>P.name===y.name));r=1===P.length?P[0]:P.find((P=>P.uniqueId===y.uniqueId))}else r="Matrix"===i?q.Matrix.ef(y.value):"Matrix2D"===i?new o.c(y.value):"Matrix3D"===i?new o.e(y.value):"FlowGraphInteger"===i?m.c.FromValue(y.value):"number"===i||"string"===i||"boolean"===i?y.value[0]:y&&void 0!==y.value?y.value:Array.isArray(y)?y.reduce(((P,f)=>f.eventData?(P[f.id]={type:(0,L.D)(f.type)},"undefined"!==typeof f.value&&(P[f.id].value=R("value",f,Y,d)),P):P),{}):y;return r}function y(P){return"FlowGraphJsonPointerParserBlock"===P}},12960:(P,f,Y)=>{"use strict";function C(P,f){return!(!P.parent||P.parent!==f&&!C(P.parent,f))}function q(P){if(P.getClassName)return P.getClassName()}function m(P,f){return P===f&&("Vector2"===P||"Of"===P||"Vector4"===P||"Quaternion"===P)}function L(P,f){return P===f&&("Matrix"===P||"Matrix2D"===P||"Matrix3D"===P)}function o(P,f){return"FlowGraphInteger"===P&&"FlowGraphInteger"===f}function w(P,f){const Y="number"===typeof P||"number"===typeof(null===P||void 0===P?void 0:P.value);return Y&&!f?!isNaN(d(P)):Y}function d(P){return"number"===typeof P?P:P.value}Y.d(f,{d:()=>o,g:()=>L,i:()=>m,j:()=>q,l:()=>C,o:()=>d,p:()=>w})},12332:(P,f,Y)=>{"use strict";Y.r(f),Y.d(f,{SceneInstrumentation:()=>m});var C=Y(11014),q=Y(11410);class m{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(P){P!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=P,P?(this._onBeforeActiveMeshesEvaluationObserver=this.lf.onBeforeActiveMeshesEvaluationObservable.add((()=>{C.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.lf.onAfterActiveMeshesEvaluationObservable.add((()=>{C.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.lf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.lf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(P){P!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=P,P?(this._onBeforeRenderTargetsRenderObserver=this.lf.onBeforeRenderTargetsRenderObservable.add((()=>{C.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.lf.onAfterRenderTargetsRenderObservable.add((()=>{C.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.lf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.lf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(P){P!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=P,P?(this._onBeforeParticlesRenderingObserver=this.lf.onBeforeParticlesRenderingObservable.add((()=>{C.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.lf.onAfterParticlesRenderingObservable.add((()=>{C.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.lf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.lf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(P){P!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=P,this.lf.spriteManagers&&(P?(this._onBeforeSpritesRenderingObserver=this.lf.onBeforeSpritesRenderingObservable.add((()=>{C.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.lf.onAfterSpritesRenderingObservable.add((()=>{C.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.lf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.lf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(P){P!==this._capturePhysicsTime&&this.lf.onBeforePhysicsObservable&&(this._capturePhysicsTime=P,P?(this._onBeforePhysicsObserver=this.lf.onBeforePhysicsObservable.add((()=>{C.Tools.StartPerformanceCounter("rd"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.lf.onAfterPhysicsObservable.add((()=>{C.Tools.EndPerformanceCounter("rd"),this._physicsTime.endMonitoring()}))):(this.lf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.lf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(P){P!==this._captureAnimationsTime&&(this._captureAnimationsTime=P,P?this._onAfterAnimationsObserver=this.lf.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.lf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(P){this._captureFrameTime=P}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(P){this._captureInterFrameTime=P}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(P){P!==this._captureRenderTime&&(this._captureRenderTime=P,P?(this._onBeforeDrawPhaseObserver=this.lf.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),C.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.lf.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),C.Tools.EndPerformanceCounter("Main render")}))):(this.lf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.lf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(P){P!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=P,P?(this._onBeforeCameraRenderObserver=this.lf.onBeforeCameraRenderObservable.add((P=>{this._cameraRenderTime.beginMonitoring(),C.Tools.StartPerformanceCounter(`Rendering camera ${P.name}`)})),this._onAfterCameraRenderObserver=this.lf.onAfterCameraRenderObservable.add((P=>{this._cameraRenderTime.endMonitoring(!1),C.Tools.EndPerformanceCounter(`Rendering camera ${P.name}`)}))):(this.lf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.lf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.lf.getEngine()._drawCalls}constructor(P){this.lf=P,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new q.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new q.b,this._captureFrameTime=!1,this._frameTime=new q.b,this._captureRenderTime=!1,this._renderTime=new q.b,this._captureInterFrameTime=!1,this._interFrameTime=new q.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new q.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new q.b,this._capturePhysicsTime=!1,this._physicsTime=new q.b,this._captureAnimationsTime=!1,this._animationsTime=new q.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new q.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=P.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(C.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.lf.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=P.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(C.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Vf(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Vf(),this._captureParticlesRenderTime&&this._particlesRenderTime.Vf(),this._captureSpritesRenderTime&&this._spritesRenderTime.Vf(),this._captureRenderTime&&this._renderTime.Vf(),this._captureCameraRenderTime&&this._cameraRenderTime.Vf()}))}dispose(){this._disposed||(this.lf.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.lf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.lf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.lf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.lf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.lf.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.lf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.lf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.lf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.lf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.lf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.lf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.lf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.lf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.lf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.lf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.lf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.lf=null,this._disposed=!0)}}},12892:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>R});var C=Y(11165),q=Y(11170),m=Y(11179),L=Y(11620),o=Y(11742),w=Y(11812),d=Y(11134);L.b.AddNodeConstructor("Light_Type_1",((P,f)=>()=>new R(P,m.Of.Zero(),f)));class R extends w.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(P){this._shadowFrustumSize=P,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(P){this._shadowOrthoScale=P,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(P){this._orthoLeft=P}get orthoRight(){return this._orthoRight}set orthoRight(P){this._orthoRight=P}get orthoTop(){return this._orthoTop}set orthoTop(P){this._orthoTop=P}get orthoBottom(){return this._orthoBottom}set orthoBottom(P){this._orthoBottom=P}constructor(P,f,Y){super(P,Y),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=f.scale(-1),this.direction=f}getClassName(){return"Kd"}getTypeID(){return o.d.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(P,f,Y){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(P):this._setDefaultAutoExtendShadowProjectionMatrix(P,f,Y)}_setDefaultFixedFrustumShadowProjectionMatrix(P){const f=this.vP().activeCamera;f&&m.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:f.zf,void 0!==this.shadowMaxZ?this.shadowMaxZ:f.maxZ,P,this.vP().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(P,f,Y){const C=this.vP().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const P=m.Of.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let C=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let L=0;L<Y.length;L++){const o=Y[L];if(!o)continue;const w=o.getBoundingInfo().boundingBox;for(let Y=0;Y<w.vectorsWorld.length;Y++)m.Of.TransformCoordinatesToRef(w.vectorsWorld[Y],f,P),P.x<this._orthoLeft&&(this._orthoLeft=P.x),P.y<this._orthoBottom&&(this._orthoBottom=P.y),P.x>this._orthoRight&&(this._orthoRight=P.x),P.y>this._orthoTop&&(this._orthoTop=P.y),this.autoCalcShadowZBounds&&(P.z<C&&(C=P.z),P.z>q&&(q=P.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=C,this._shadowMaxZ=q)}const q=this._orthoRight-this._orthoLeft,L=this._orthoTop-this._orthoBottom,o=void 0!==this.shadowMinZ?this.shadowMinZ:(null===C||void 0===C?void 0:C.zf)||0,w=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===C||void 0===C?void 0:C.maxZ)||1e4,d=this.vP().getEngine().useReverseDepthBuffer;m.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-q*this.shadowOrthoScale,this._orthoRight+q*this.shadowOrthoScale,this._orthoBottom-L*this.shadowOrthoScale,this._orthoTop+L*this.shadowOrthoScale,d?w:o,d?o:w,P,this.vP().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(P,f){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,f),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,f),this)}transferToNodeMaterialEffect(P,f){return this.computeTransformedInformation()?(P.setFloat3(f,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(P.setFloat3(f,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(P){const f=this._scene.getEngine();return!f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:1}getDepthMaxZ(P){const f=this._scene.getEngine();return f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:1}prepareLightSpecificDefines(P,f){P["DIRLIGHT"+f]=!0}}(0,C.b)([(0,q.F)()],R.prototype,"shadowFrustumSize",null),(0,C.b)([(0,q.F)()],R.prototype,"shadowOrthoScale",null),(0,C.b)([(0,q.F)()],R.prototype,"autoUpdateExtends",void 0),(0,C.b)([(0,q.F)()],R.prototype,"autoCalcShadowZBounds",void 0),(0,C.b)([(0,q.F)("orthoLeft")],R.prototype,"_orthoLeft",void 0),(0,C.b)([(0,q.F)("orthoRight")],R.prototype,"_orthoRight",void 0),(0,C.b)([(0,q.F)("orthoTop")],R.prototype,"_orthoTop",void 0),(0,C.b)([(0,q.F)("orthoBottom")],R.prototype,"_orthoBottom",void 0),(0,d.d)("BABYLON.DirectionalLight",R)},13363:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>R});var C=Y(11165),q=Y(11170),m=Y(11179),L=Y(11228),o=Y(11620),w=Y(11742),d=Y(11134);o.b.AddNodeConstructor("Light_Type_3",((P,f)=>()=>new R(P,m.Of.Zero(),f)));class R extends w.d{constructor(P,f,Y){super(P,Y),this.groundColor=new L.Df(0,0,0),this.direction=f||m.Of.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Vd"}setDirectionToTarget(P){return this.direction=m.Of.Normalize(P.nf(m.Of.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(P,f){const Y=m.Of.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Y.x,Y.y,Y.z,0,f),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.So),f),this}transferToNodeMaterialEffect(P,f){const Y=m.Of.Normalize(this.direction);return P.setFloat3(f,Y.x,Y.y,Y.z),this}XC(){return this._worldMatrix||(this._worldMatrix=m.Matrix.Identity()),this._worldMatrix}getTypeID(){return w.d.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(P,f){P["HEMILIGHT"+f]=!0}}(0,C.b)([(0,q.i)()],R.prototype,"groundColor",void 0),(0,C.b)([(0,q.D)()],R.prototype,"direction",void 0),(0,d.d)("BABYLON.HemisphericLight",R)},12863:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>y});var C=Y(11165),q=Y(11170),m=Y(11179),L=Y(11620),o=Y(11742),w=Y(11812),d=Y(11160),R=Y(11134);L.b.AddNodeConstructor("Light_Type_2",((P,f)=>()=>new y(P,m.Of.Zero(),m.Of.Zero(),0,0,f)));class y extends w.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(P){this._iesProfileTexture!==P&&(this._iesProfileTexture=P,this._iesProfileTexture&&y._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(P){this._angle=P,this._cosHalfAngle=Math.cos(.5*P),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(P){this._innerAngle=P,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(P){this._shadowAngleScale=P,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(P){this._projectionTextureLightNear=P,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(P){this._projectionTextureLightFar=P,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(P){this._projectionTextureUpDirection=P,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(P){this._projectionTexture!==P&&(this._projectionTexture=P,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(y._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):y._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(P){return void 0!==P.onGeneratedObservable}static _IsTexture(P){return void 0!==P.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(P){this._projectionTextureProjectionLightMatrix=P,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(P,f,Y,C,q,L){super(P,L),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=m.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=m.Of.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=m.Of.Zero(),this._projectionTextureViewLightMatrix=m.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=m.Matrix.Zero(),this._projectionTextureScalingMatrix=m.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=f,this.direction=Y,this.angle=C,this.exponent=q}getClassName(){return"SpotLight"}getTypeID(){return o.d.LIGHTTYPEID_SPOTLIGHT}_setDirection(P){super._setDirection(P),this._projectionTextureViewLightDirty=!0}_setPosition(P){super._setPosition(P),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(P,f,Y){const C=this.vP().activeCamera;if(!C)return;this._shadowAngleScale=this._shadowAngleScale||1;const q=this._shadowAngleScale*this._angle,L=void 0!==this.shadowMinZ?this.shadowMinZ:C.zf,o=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,w=this.vP().getEngine().useReverseDepthBuffer;m.Matrix.PerspectiveFovLHToRef(q,1,w?o:L,w?L:o,P,!0,this._scene.getEngine().isNDCHalfZRange,void 0,w)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),m.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const P=this.projectionTextureLightFar,f=this.projectionTextureLightNear,Y=P/(P-f),C=-Y*f,q=1/Math.tan(this._angle/2);m.Matrix.FromValuesToRef(q/1,0,0,0,0,q,0,0,0,0,Y,1,0,0,C,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof d.c){const P=this._projectionTexture.uScale/2,f=this._projectionTexture.vScale/2;m.Matrix.FromValuesToRef(P,0,0,0,0,f,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(P,f){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),P.setMatrix("textureProjectionMatrix"+f,this._projectionTextureMatrix),P.setTexture("projectionLightTexture"+f,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&P.setTexture("iesLightTexture"+f,this._iesProfileTexture),this}transferToEffect(P,f){let Y;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,f),Y=m.Of.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,f),Y=m.Of.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Y.x,Y.y,Y.z,this._cosHalfAngle,f),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,f),this}transferToNodeMaterialEffect(P,f){let Y;return Y=this.computeTransformedInformation()?m.Of.Normalize(this.transformedDirection):m.Of.Normalize(this.direction),this.vP().useRightHandedSystem?P.setFloat3(f,-Y.x,-Y.y,-Y.z):P.setFloat3(f,Y.x,Y.y,Y.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(P){const f=this._scene.getEngine(),Y=void 0!==this.shadowMinZ?this.shadowMinZ:(null===P||void 0===P?void 0:P.zf)??0;return f.useReverseDepthBuffer&&f.isNDCHalfZRange?Y:this._scene.getEngine().isNDCHalfZRange?0:Y}getDepthMaxZ(P){const f=this._scene.getEngine(),Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===P||void 0===P?void 0:P.maxZ)??1e4;return f.useReverseDepthBuffer&&f.isNDCHalfZRange?0:Y}prepareLightSpecificDefines(P,f){P["SPOTLIGHT"+f]=!0,P["PROJECTEDLIGHTTEXTURE"+f]=!(!this.projectionTexture||!this.projectionTexture.isReady()),P["IESLIGHTTEXTURE"+f]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,C.b)([(0,q.F)()],y.prototype,"angle",null),(0,C.b)([(0,q.F)()],y.prototype,"innerAngle",null),(0,C.b)([(0,q.F)()],y.prototype,"shadowAngleScale",null),(0,C.b)([(0,q.F)()],y.prototype,"exponent",void 0),(0,C.b)([(0,q.F)()],y.prototype,"projectionTextureLightNear",null),(0,C.b)([(0,q.F)()],y.prototype,"projectionTextureLightFar",null),(0,C.b)([(0,q.F)()],y.prototype,"projectionTextureUpDirection",null),(0,C.b)([(0,q.x)("projectedLightTexture")],y.prototype,"_projectionTexture",void 0),(0,R.d)("BABYLON.SpotLight",y)},12595:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>L,g:()=>m,j:()=>o});const C={},q={};function m(P,f){C[P]=f}function L(P,f){q[P]=f}function o(P){return q[P]?q[P]:null}},12494:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>v,f:()=>N});var C,q=Y(11014),m=Y(11018),L=Y(11429),o=Y(11052),w=Y(11025),d=Y(11662),R=Y(11059),y=Y(11063),r=Y(11139),i=Y(11089),u=Y(11046);!function(P){P[P.Clean=0]="Clean",P[P.Stop=1]="Stop",P[P.Sync=2]="Sync",P[P.NoSync=3]="NoSync"}(C||(C={}));const g=new m.e,S={};let K=!1;function M(){return S[".babylon"]}function V(P,f){const Y=S[P];return Y||(w.e.Warn("Unable to find a plugin to load "+P+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),f?M():void 0)}function O(P,f,Y){let C="Unable to load from "+(P.rawData?"binary data":P.url);return f?C+=`: ${f}`:Y&&(C+=`: ${Y}`),C}async function n(P,f,Y,C,q,m,L,o,w){var d;const y="data:"===(r=P.url).substring(0,5)?r.substring(5):null;var r;if(P.rawData&&!L)throw"When using ArrayBufferView to load data the file extension must be provided.";const K=y||L?"":function(P){const f=P.indexOf("?");-1!==f&&(P=P.substring(0,f));const Y=P.lastIndexOf(".");return P.substring(Y,P.length).toLowerCase()}(P.url);let O=L?V(L,!0):y?function(P){for(const f in S){const Y=S[f].plugin;if(Y.canDirectLoad&&Y.canDirectLoad(P))return S[f]}return M()}(P.url):V(K,!1);if(!O&&K){if(P.url&&!P.url.startsWith("blob:")){const f=await async function(P,f){const Y=f.method||"GET";return await new Promise(((C,q)=>{const m=new u.d;m.addEventListener("readystatechange",(()=>{if(4==m.readyState)if(200==m.status){const P={};if(f.responseHeaders)for(const Y of f.responseHeaders)P[Y]=m.getResponseHeader(Y)||"";C({response:m.response,headerValues:P})}else q(`Unable to fetch data from ${P}. Error code: ${m.status}`)})),m.open(Y,P),m.send()}))}(P.url,{method:"HEAD",responseHeaders:["Content-Type"]}),Y=f.headerValues?f.headerValues["Content-Type"]:"";Y&&(O=function(P){for(const f in S){const Y=S[f];if(Y.mimeType===P)return Y}}(Y))}O||(O=M())}if(!O)throw new Error(`No plugin or fallback for ${L??P.url}`);if(!1===(null===w||void 0===w||null===(d=w[O.plugin.name])||void 0===d?void 0:d.enabled))throw new Error(`The '${O.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(P.rawData&&!O.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(P=>{if(O.plugin.createPlugin){const f=O.plugin.createPlugin(w??{});return f instanceof Promise?(f.then(P).catch((P=>{q("Error instantiating plugin.",P)})),null):(P(f),f)}return P(O.plugin),O.plugin})((w=>{var d;if(!w)throw`The loader plugin corresponding to the '${L}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(g.notifyObservers(w),y&&(w.canDirectLoad&&w.canDirectLoad(P.url)||!(0,R.j)(P.url))){if(w.directLoad){const P=w.directLoad(f,y);P instanceof Promise?P.then((P=>{Y(w,P)})).catch((P=>{q("Error in directLoad of _loadData: "+P,P)})):Y(w,P)}else Y(w,y);return}const r=O.isBinary,u=(P,C)=>{f.R?q("Scene has been disposed"):Y(w,P,C)};let S=null,K=!1;null===(d=w.vf)||void 0===d||d.add((()=>{K=!0,S&&(S.abort(),S=null),m()}));const M=()=>{if(K)return;const Y=(P,f)=>{q(null===P||void 0===P?void 0:P.statusText,f)};if(!w.loadFile&&P.rawData)throw"Plugin does not support loading ArrayBufferView.";S=w.loadFile?w.loadFile(f,P.rawData||P.file||P.url,P.rootUrl,u,C,r,Y,o):f._loadFile(P.file||P.url,u,C,!0,r,Y)},V=f.getEngine();let n=V.enableOfflineSupport;if(n){let Y=!1;for(const C of f.disableOfflineSupportExceptionRules)if(C.test(P.url)){Y=!0;break}n=!Y}n&&i.c.OfflineProviderFactory?f.offlineProvider=i.c.OfflineProviderFactory(P.url,M,V.disableManifestCheck):M()}))}function l(P,f){let Y,C,m=null,L=null;if(f)if(f.name)Y=`file:${f.name}`,C=f.name,m=f;else if(ArrayBuffer.isView(f))Y="",C=(0,r.b)(),L=f;else if(f.startsWith("data:"))Y=f,C="";else if(P){const m=f;if("/"===m.substring(0,1))return q.Tools.Error("Wrong sceneFilename parameter"),null;Y=P+m,C=m}else Y=f,C=q.Tools.GetFilename(f),P=q.Tools.GetFolderPath(f);else Y=P,C=q.Tools.GetFilename(P),P=q.Tools.GetFolderPath(P);return{url:Y,rootUrl:P,name:C,file:m,rawData:L}}function v(P){if("string"===typeof P.extensions){const f=P.extensions;S[f.toLowerCase()]={plugin:P,isBinary:!1}}else{const f=P.extensions,Y=Object.keys(f);for(const C of Y)S[C.toLowerCase()]={plugin:P,isBinary:f[C].isBinary,mimeType:f[C].mimeType}}}async function c(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.e.LastCreatedScene,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",r=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!C)return w.e.Error("No scene available to import mesh to"),null;const i=l(f,Y);if(!i)return null;const u={};C.addPendingData(u);const g=()=>{C.removePendingData(u)},S=(P,f)=>{const Y=O(i,P,f);L?L(C,Y,new y.j(Y,y.g.SceneLoaderError,f)):w.e.Error(Y),g()},K=m?P=>{try{m(P)}catch(f){S("Error in onProgress callback: "+f,f)}}:void 0,M=(P,f,Y,m,L,o,w,d)=>{if(C.importedMeshesFiles.push(i.url),q)try{q(P,f,Y,m,L,o,w,d)}catch(R){S("Error in onSuccess callback: "+R,R)}C.removePendingData(u)};return await n(i,C,((f,Y,q)=>{if(f.rewriteRootURL&&(i.rootUrl=f.rewriteRootURL(i.rootUrl,q)),f.importMesh){const q=[],m=[],L=[];if(!f.importMesh(P,C,Y,i.rootUrl,q,m,L,S))return;C.loadingPluginName=f.name,M(q,m,L,[],[],[],[],[])}else{f.importMeshAsync(P,C,Y,i.rootUrl,K,i.name).then((P=>{C.loadingPluginName=f.name,M(P.meshes,P.Rr,P.skeletons,P.animationGroups,P.transformNodes,P.geometries,P.lights,P.spriteManagers)})).catch((P=>{S(P.message,P)}))}}),K,S,g,d,R,r)}async function T(P,f,Y,C,q,m,L,o){return await new Promise(((w,d)=>{try{c(P,f,Y,C,((P,f,Y,C,q,m,L,o)=>{w({meshes:P,Rr:f,skeletons:Y,animationGroups:C,transformNodes:q,geometries:m,lights:L,spriteManagers:o})}),q,((P,f,Y)=>{d(Y||new Error(f))}),m,L,o).catch(d)}catch(y){d(y)}}))}async function U(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.e.LastCreatedEngine,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};Y?await j(P,f,new L.e(Y),C,m,w,d,R,y):q.Tools.Error("No engine available")}async function D(P,f,Y,C,q,m,L){return await new Promise(((o,w)=>{U(P,f,Y,(P=>{o(P)}),C,((P,f,Y)=>{w(Y||new Error(f))}),q,m,L)}))}async function j(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.e.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",r=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Y)return w.e.Error("No scene available to append to"),null;const i=l(P,f);if(!i)return null;const u={};Y.addPendingData(u);const g=()=>{Y.removePendingData(u)};d.e.ShowLoadingScreen&&!K&&(K=!0,Y.getEngine().displayLoadingUI(),Y.executeWhenReady((()=>{Y.getEngine().hideLoadingUI(),K=!1})));const S=(P,f)=>{const C=O(i,P,f);m?m(Y,C,new y.j(C,y.g.SceneLoaderError,f)):w.e.Error(C),g()},M=q?P=>{try{q(P)}catch(f){S("Error in onProgress callback",f)}}:void 0,V=()=>{if(C)try{C(Y)}catch(P){S("Error in onSuccess callback",P)}Y.removePendingData(u)};return await n(i,Y,((P,f)=>{if(P.load){if(!P.load(Y,f,i.rootUrl,S))return;Y.loadingPluginName=P.name,V()}else{P.loadAsync(Y,f,i.rootUrl,M,i.name).then((()=>{Y.loadingPluginName=P.name,V()})).catch((P=>{S(P.message,P)}))}}),M,S,g,L,R,r)}async function e(P,f,Y,C,q,m,L){return await new Promise(((o,w)=>{try{j(P,f,Y,(P=>{o(P)}),C,((P,f,Y)=>{w(Y||new Error(f))}),q,m,L).catch(w)}catch(y){w(y)}}))}async function s(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.e.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Y)return w.e.Error("No scene available to load asset container to"),null;const r=l(P,f);if(!r)return null;const i={};Y.addPendingData(i);const u=()=>{Y.removePendingData(i)},g=(P,f)=>{const C=O(r,P,f);m?m(Y,C,new y.j(C,y.g.SceneLoaderError,f)):w.e.Error(C),u()},S=q?P=>{try{q(P)}catch(f){g("Error in onProgress callback",f)}}:void 0,K=P=>{if(C)try{C(P)}catch(f){g("Error in onSuccess callback",f)}Y.removePendingData(i)};return await n(r,Y,((P,f)=>{if(P.loadAssetContainer){const C=P.loadAssetContainer(Y,f,r.rootUrl,g);if(!C)return;C.populateRootNodes(),Y.loadingPluginName=P.name,K(C)}else if(P.loadAssetContainerAsync){P.loadAssetContainerAsync(Y,f,r.rootUrl,S,r.name).then((f=>{f.populateRootNodes(),Y.loadingPluginName=P.name,K(f)})).catch((P=>{g(P.message,P)}))}else g("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),S,g,u,L,d,R)}async function a(P,f,Y,C,q,m,L){return await new Promise(((o,w)=>{try{s(P,f,Y,(P=>{o(P)}),C,((P,f,Y)=>{w(Y||new Error(f))}),q,m,L).catch(w)}catch(y){w(y)}}))}async function Q(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.e.LastCreatedScene,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",i=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Y)return void w.e.Error("No scene available to load animations to");if(C){for(const C of Y.animatables)C.reset();Y.stopAllAnimations();const P=Y.animationGroups.slice();for(const Y of P)Y.dispose();const f=Y.getNodes();for(const Y of f)Y.animations&&(Y.animations=[])}else switch(q){case 0:const P=Y.animationGroups.slice();for(const f of P)f.dispose();break;case 1:for(const f of Y.animationGroups)f.stop();break;case 2:for(const f of Y.animationGroups)f.reset(),f.restart();break;case 3:break;default:return void w.e.Error("Unknown animation group loading mode value '"+q+"'")}const u=Y.animatables.length;await s(P,f,Y,(P=>{P.mergeAnimationsTo(Y,Y.animatables.slice(u),m),P.dispose(),Y.onAnimationFileImportedObservable.notifyObservers(Y),L&&L(Y)}),d,R,y,r,i)}async function J(P,f,Y,C,q,m,L,o,w,d){return await new Promise(((R,r)=>{try{Q(P,f,Y,C,q,m,(P=>{R(P)}),L,((P,f,Y)=>{r(Y||new Error(f))}),o,w,d).catch(r)}catch(y){r(y)}}))}class N{static get ForceFullSceneLoadingForIncremental(){return d.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(P){d.e.ForceFullSceneLoadingForIncremental=P}static get ShowLoadingScreen(){return d.e.ShowLoadingScreen}static set ShowLoadingScreen(P){d.e.ShowLoadingScreen=P}static get loggingLevel(){return d.e.loggingLevel}static set loggingLevel(P){d.e.loggingLevel=P}static get CleanBoneMatrixWeights(){return d.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(P){d.e.CleanBoneMatrixWeights=P}static GetDefaultPlugin(){return M()}static GetPluginForExtension(P){var f;return null===(f=V(P,!0))||void 0===f?void 0:f.plugin}static IsPluginForExtensionAvailable(P){return function(P){return!!S[P]}(P)}static RegisterPlugin(P){v(P)}static ImportMesh(P,f,Y,C,q,m,L,w,d){c(P,f,Y,C,q,m,L,w,d).catch((P=>null===L||void 0===L?void 0:L(o.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async ImportMeshAsync(P,f,Y,C,q,m,L){return await T(P,f,Y,C,q,m,L)}static Load(P,f,Y,C,q,m,L,w){U(P,f,Y,C,q,m,L,w).catch((P=>null===m||void 0===m?void 0:m(o.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async LoadAsync(P,f,Y,C,q,m){return await D(P,f,Y,C,q,m)}static Append(P,f,Y,C,q,m,L,w){j(P,f,Y,C,q,m,L,w).catch((P=>null===m||void 0===m?void 0:m(Y??o.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async AppendAsync(P,f,Y,C,q,m){return await e(P,f,Y,C,q,m)}static LoadAssetContainer(P,f,Y,C,q,m,L,w){s(P,f,Y,C,q,m,L,w).catch((P=>null===m||void 0===m?void 0:m(Y??o.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async LoadAssetContainerAsync(P,f,Y,C,q,m){return await a(P,f,Y,C,q,m)}static ImportAnimations(P,f,Y,C,q,m,L,w,d,R,y){Q(P,f,Y,C,q,m,L,w,d,R,y).catch((P=>null===d||void 0===d?void 0:d(Y??o.e.LastCreatedScene,null===P||void 0===P?void 0:P.message,P)))}static async ImportAnimationsAsync(P,f,Y,C,q,m,L,o,w,d,R){return await J(P,f,Y,C,q,m,o,d,R)}}N.NO_LOGGING=0,N.MINIMAL_LOGGING=1,N.SUMMARY_LOGGING=2,N.DETAILED_LOGGING=3,N.OnPluginActivatedObservable=g},12880:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>r});var C=Y(11165),q=Y(11170),m=Y(11014),L=Y(11179),o=Y(11203),w=Y(11160),d=Y(11134),R=Y(11018),y=Y(11216);Y(12888);class r extends o.d{set boundingBoxSize(P){if(this._boundingBoxSize&&this._boundingBoxSize.equals(P))return;this._boundingBoxSize=P;const f=this.vP();f&&f.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(P){this._rotationY=P,this.setReflectionTextureMatrix(L.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(P,f,Y){let C="";for(const q of P)C+=q;return new r(C,f,null,Y,P)}static CreateFromPrefilteredData(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const q=f.useDelayedTextureLoading;f.useDelayedTextureLoading=!1;const m=new r(P,f,null,!1,null,null,null,void 0,!0,Y,C);return f.useDelayedTextureLoading=q,m}constructor(P,f){var Y;let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,r=arguments.length>8&&void 0!==arguments[8]&&arguments[8],i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],g=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,K=arguments.length>13?arguments[13]:void 0,M=arguments.length>14?arguments[14]:void 0;super(f),this.onLoadObservable=new R.e,this.boundingBoxPosition=L.Of.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new L.Matrix,this._buffer=null,this.name=P,this.url=P,this._noMipmap=q,this.Gf=!1,this.isCube=!0,this._textureMatrix=L.Matrix.Identity(),this.coordinatesMode=w.c.CUBIC_MODE;let V=null,O=null;null===C||Array.isArray(C)?(this._noMipmap=q,this._format=y,this._createPolynomials=u,V=C,this._loaderOptions=K,this._useSRGBBuffer=M,this._lodScale=g,this._lodOffset=S):(V=C.extensions??null,this._noMipmap=C.noMipmap??!1,m=C.files??null,O=C.buffer??null,this._format=C.format??5,r=C.prefiltered??!1,i=C.forcedExtension??null,this._createPolynomials=C.createPolynomials??!1,this._lodScale=C.lodScale??.8,this._lodOffset=C.lodOffset??0,this._loaderOptions=C.loaderOptions,this._useSRGBBuffer=C.useSRGBBuffer,o=C.p??null,d=C.onError??null),(P||m)&&this.updateURL(P,i,o,r,d,V,null===(Y=this.vP())||void 0===Y?void 0:Y.useDelayedTextureLoading,m,O)}getClassName(){return"CubeTexture"}updateURL(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=P),this.url=P,f&&(this._forcedExtension=f);const d=P.lastIndexOf("."),R=f||(d>-1?P.substring(d).toLowerCase():""),y=0===R.indexOf(".dds"),r=0===R.indexOf(".env"),i=0===R.indexOf(".basis");if(r?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=C,C&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),o)this._files=o;else if(i||r||y||m||(m=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,m){for(let f=0;f<m.length;f++)this._files.push(P+m[f]);this._extensions=m}this._buffer=w,L?(this.delayLoadState=4,this._delayedOnLoad=Y,this._delayedOnError=q):this._loadTexture(Y,q)}delayLoad(P){4===this.delayLoadState&&(P&&(this._forcedExtension=P),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(P){var f,Y;if(P.updateFlag===this._textureMatrix.updateFlag)return;P.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Y=this.vP())||void 0===Y||Y.markAllMaterialsAsDirty(1,(P=>-1!==P.getActiveTextures().indexOf(this))));if(this._textureMatrix=P,null===(f=this.vP())||void 0===f||!f.useRightHandedSystem)return;const C=L.TmpVectors.Of[0],q=L.TmpVectors.Quaternion[0],m=L.TmpVectors.Of[1];this._textureMatrix.decompose(C,q,m),q.z*=-1,q.w*=-1,L.Matrix.ComposeToRef(C,q,m,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var P;return null!==(P=this.vP())&&void 0!==P&&P.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=this.vP(),C=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const q=()=>{var f;(this.onLoadObservable.notifyObservers(this),C)&&(C.dispose(),null===(f=this.vP())||void 0===f||f.markAllMaterialsAsDirty(1));P&&P()},L=(P,Y)=>{this._loadingError=!0,this._errorObject={message:P,exception:Y},f&&f(P,Y),w.c.OnTextureLoadErrorObservable.notifyObservers(this)};var o;this._texture?this._texture.isReady?m.Tools.SetImmediate((()=>q())):this._texture.onLoadedObservable.add((()=>q())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Y,this._lodScale,this._lodOffset,P,L,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Y,this._files,this._noMipmap,P,L,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(o=this._texture)||void 0===o||o.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(P,f,Y){const C=y.e.Parse((()=>{let C=!1;return P.prefiltered&&(C=P.prefiltered),new r(Y+(P.url??P.name),f,P.extensions,!1,P.files||null,null,null,void 0,C,P.forcedExtension)}),P,f);if(P.boundingBoxPosition&&(C.boundingBoxPosition=L.Of.ef(P.boundingBoxPosition)),P.boundingBoxSize&&(C.boundingBoxSize=L.Of.ef(P.boundingBoxSize)),P.animations)for(let q=0;q<P.animations.length;q++){const f=P.animations[q],Y=(0,d.c)("BABYLON.Animation");Y&&C.animations.push(Y.Parse(f))}return C}clone(){let P=0;const f=y.e.Clone((()=>{const f=new r(this.url,this.vP()||this._getEngine(),this._extensions,this._noMipmap,this._files);return P=f.uniqueId,f}),this);return f.uniqueId=P,f}}(0,C.b)([(0,q.F)()],r.prototype,"url",void 0),(0,C.b)([(0,q.D)()],r.prototype,"boundingBoxPosition",void 0),(0,C.b)([(0,q.D)()],r.prototype,"boundingBoxSize",null),(0,C.b)([(0,q.F)("rotationY")],r.prototype,"rotationY",null),(0,C.b)([(0,q.F)("files")],r.prototype,"_files",void 0),(0,C.b)([(0,q.F)("forcedExtension")],r.prototype,"_forcedExtension",void 0),(0,C.b)([(0,q.F)("extensions")],r.prototype,"_extensions",void 0),(0,C.b)([(0,q.s)("textureMatrix")],r.prototype,"_textureMatrix",void 0),(0,C.b)([(0,q.s)("textureMatrixRefraction")],r.prototype,"_textureMatrixRefraction",void 0),w.c._CubeTextureParser=r.Parse,(0,d.d)("BABYLON.CubeTexture",r)},13371:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>w});var C=Y(11025),q=Y(11160),m=Y(11147),L=Y(11322),o=Y(11119);L.ThinEngine.prototype.createDynamicTexture=function(P,f,Y,C){const q=new o.b(this,4);return q.baseWidth=P,q.baseHeight=f,Y&&(P=this.needPOTTextures?(0,m.e)(P,this._caps.maxTextureSize):P,f=this.needPOTTextures?(0,m.e)(f,this._caps.maxTextureSize):f),q.width=P,q.height=f,q.isReady=!1,q.generateMipMaps=Y,q.samplingMode=C,this.updateTextureSamplingMode(C,q),this._internalTexturesCache.push(q),q},L.ThinEngine.prototype.updateDynamicTexture=function(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!P)return;const L=this._gl,o=L.TEXTURE_2D,w=this._bindTextureDirectly(o,P,!0,m);this._unpackFlipY(void 0===Y?P.invertY:Y),C&&L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const d=this._getWebGLTextureType(P.type),R=this._getInternalFormat(q||P.format),y=this._getRGBABufferInternalSizedFormat(P.type,R);L.texImage2D(o,0,y,R,d,f),P.generateMipMaps&&L.generateMipmap(o),w||this._bindTextureDirectly(o,null),C&&L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),q&&(P.format=q),P._dynamicTextureSource=f,P._premulAlpha=C,P.invertY=Y||!1,P.isReady=!0};class w extends q.c{constructor(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,o=arguments.length>6?arguments[6]:void 0;const w=!Y||Y._isScene;super(null,w?Y:null===Y||void 0===Y?void 0:Y.lf,w?!C:Y,o,m,void 0,void 0,void 0,void 0,L),this.name=P,this.wrapU=q.c.CLAMP_ADDRESSMODE,this.wrapV=q.c.CLAMP_ADDRESSMODE,this._generateMipMaps=C;const d=this._getEngine();if(!d)return;if(f.getContext)this._canvas=f,this._ownCanvas=!1,this._texture=d.createDynamicTexture(this._canvas.width,this._canvas.height,C,m);else{this._canvas=d.createCanvas(1,1),this._ownCanvas=!0;const P=f;P.width||0===P.width?this._texture=d.createDynamicTexture(P.width,P.height,C,m):this._texture=d.createDynamicTexture(f,f,C,m)}const R=this.getSize();this._canvas.width!==R.width&&(this._canvas.width=R.width),this._canvas.height!==R.height&&(this._canvas.height=R.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(P){this._canvas.width=P.width,this._canvas.height=P.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(P.width,P.height,this._generateMipMaps,this.samplingMode)}scale(P){const f=this.getSize();f.width*=P,f.height*=P,this._recreate(f)}scaleTo(P,f){const Y=this.getSize();Y.width=P,Y.height=f,this._recreate(Y)}getContext(){return this._context}clear(P){const f=this.getSize();P&&(this._context.fillStyle=P),this._context.clearRect(0,0,f.width,f.height)}update(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===P||P,f,this._format||void 0,void 0,Y)}drawText(P,f,Y,C,q,m,L){let o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const w=this.getSize();if(m&&(this._context.fillStyle=m,this._context.fillRect(0,0,w.width,w.height)),this._context.font=C,null===f||void 0===f){const Y=this._context.measureText(P);f=(w.width-Y.width)/2}if(null===Y||void 0===Y){const P=parseInt(C.replace(/\D/g,""));Y=w.height/2+P/3.65}this._context.fillStyle=q||"",this._context.fillText(P,f,Y),o&&this.update(L)}dispose(){var P,f;(super.dispose(),this._ownCanvas)&&(null===(P=this._canvas)||void 0===P||null===(f=P.remove)||void 0===f||f.call(P));this._canvas=null,this._context=null}clone(){const P=this.vP();if(!P)return this;const f=this.getSize(),Y=new w(this.name,f,P,this._generateMipMaps);return Y.Gf=this.Gf,Y.level=this.level,Y.wrapU=this.wrapU,Y.wrapV=this.wrapV,Y}serialize(){const P=this.vP();P&&!P.isReady()&&C.e.Warn("The scene must be ready before serializing the dynamic texture");const f=super.serialize();return w._IsCanvasElement(this._canvas)&&(f.base64String=this._canvas.toDataURL()),f.invertY=this._invertY,f.samplingMode=this.samplingMode,f}static _IsCanvasElement(P){return void 0!==P.toDataURL}_rebuild(){this.update()}}},12792:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>q});var C=Y(11160);class q extends C.c{get depth(){return this._depth}constructor(P,f,Y,q,m,L){let o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],w=arguments.length>7&&void 0!==arguments[7]&&arguments[7],d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:C.c.TRILINEAR_SAMPLINGMODE,R=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,y=arguments.length>10?arguments[10]:void 0;super(null,L,!o,w),this.format=m,this._texture=L.getEngine().createRawTexture2DArray(P,f,Y,q,m,o,w,d,null,R,y),this._depth=q,this.is2DArray=!0}update(P){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,P,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(P,f,Y,C,m){return new q(P,f,Y,C,5,m,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12603:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>o,g:()=>w,h:()=>m,k:()=>L});var C=Y(11198),q=Y(11179);function m(P,f){return`{X: ${P.x.toFixed(f)} Y: ${P.y.toFixed(f)}}`}function L(P,f){return`{X: ${P._x.toFixed(f)} Y: ${P._y.toFixed(f)} Z: ${P._z.toFixed(f)}}`}function o(P,f){return 2*Math.acos((0,C.Clamp)(q.Quaternion.Dot(P,f)))}function w(P,f){const Y=new q.Quaternion;return function(P,f,Y){const m=q.Of.Cross(P,f),L=Math.acos((0,C.Clamp)(q.Of.Dot(P,f),-1,1));q.Quaternion.RotationAxisToRef(m,L,Y)}(P,f,Y),Y}},12454:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>d});var C=Y(11179),q=Y(11228),m=Y(11648),L=Y(11625),o=Y(11239);Y(12463);function w(P){let f=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Y=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],m=[];let w=[];const d=P.width||P.size||1,R=P.height||P.size||1,y=P.depth||P.size||1,r=P.wrap||!1;let i=void 0===P.topBaseAt?1:P.topBaseAt,u=void 0===P.bottomBaseAt?0:P.bottomBaseAt;i=(i+4)%4,u=(u+4)%4;let g=[2,0,3,1][i],S=[2,0,1,3][u],K=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(r){f=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],K=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let P=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Y=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const C=[17,18,19,16],q=[22,23,20,21];for(;g>0;)P.unshift(P.pop()),C.unshift(C.pop()),g--;for(;S>0;)Y.unshift(Y.pop()),q.unshift(q.pop()),S--;P=P.flat(),Y=Y.flat(),K=K.concat(P).concat(Y),f.push(C[0],C[2],C[3],C[0],C[1],C[2]),f.push(q[0],q[2],q[3],q[0],q[1],q[2])}const M=[d/2,R/2,y/2];w=K.reduce(((P,f,Y)=>P.concat(f*M[Y%3])),[]);const V=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE,O=P.faceUV||new Array(6),n=P.faceColors,l=[];for(let L=0;L<6;L++)void 0===O[L]&&(O[L]=new C.Vector4(0,0,1,1)),n&&void 0===n[L]&&(n[L]=new q.ro(1,1,1,1));for(let C=0;C<6;C++)if(m.push(O[C].z,o.d?1-O[C].w:O[C].w),m.push(O[C].x,o.d?1-O[C].w:O[C].w),m.push(O[C].x,o.d?1-O[C].y:O[C].y),m.push(O[C].z,o.d?1-O[C].y:O[C].y),n)for(let P=0;P<4;P++)l.push(n[C].r,n[C].g,n[C].b,n[C].a);L.c._ComputeSides(V,w,f,Y,m,P.frontUVs,P.backUVs);const v=new L.c;if(v.indices=f,v.TP=w,v.UP=Y,v.jP=m,n){const P=V===L.c.DOUBLESIDE?l.concat(l):l;v.DP=P}return v}function d(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new m.c(P,Y);f.sideOrientation=m.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return w(f).sP(C,f.updatable),C}L.c.CreateBox=w,m.c.CreateBox=function(P,f){return d(P,{size:f,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12598:(P,f,Y)=>{"use strict";Y.d(f,{c:()=>o});var C=Y(11648),q=Y(11625),m=Y(11239);function L(P){const f=[],Y=[],C=[],L=[],o=P.radius||.5,w=P.tessellation||64,d=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,R=0===P.sideOrientation?0:P.sideOrientation||q.c.DEFAULTSIDE;f.push(0,0,0),L.push(.5,.5);const y=2*Math.PI*d,r=1===d?y/w:y/(w-1);let i=0;for(let q=0;q<w;q++){const P=Math.cos(i),Y=Math.sin(i),C=(P+1)/2,q=(1-Y)/2;f.push(o*P,o*Y,0),L.push(C,m.d?1-q:q),i+=r}1===d&&(f.push(f[3],f[4],f[5]),L.push(L[2],m.d?1-L[3]:L[3]));const u=f.length/3;for(let q=1;q<u-1;q++)Y.push(q+1,0,q);q.c.ComputeNormals(f,Y,C),q.c._ComputeSides(R,f,Y,C,L,P.frontUVs,P.backUVs);const g=new q.c;return g.indices=Y,g.TP=f,g.UP=C,g.jP=L,g}function o(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new C.c(P,Y);f.sideOrientation=C.c._GetDefaultSideOrientation(f.sideOrientation),q._originalBuilderSideOrientation=f.sideOrientation;return L(f).sP(q,f.updatable),q}q.c.CreateDisc=L,C.c.CreateDisc=function(P,f,Y){return o(P,{radius:f,tessellation:Y,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12463:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>S,c:()=>M,g:()=>K});var C=Y(11179),q=Y(11228),m=Y(11648),L=Y(11625),o=Y(11255);m.c._GroundMeshParser=(P,f)=>w.Parse(P,f);class w extends m.c{constructor(P,f){super(P,f),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=P,this._subdivisionsY=P,this.subdivide(P);const Y=this;Y.createOrUpdateSubmeshesOctree&&Y.createOrUpdateSubmeshesOctree(f)}getHeightAtCoordinates(P,f){const Y=this.getWorldMatrix(),q=C.TmpVectors.Matrix[5];Y.invertToRef(q);const m=C.TmpVectors.Of[8];if(C.Of.TransformCoordinatesFromFloatsToRef(P,0,f,q,m),P=m.x,f=m.z,P<this._minX||P>=this._maxX||f<=this._minZ||f>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const L=this._getFacetAt(P,f),o=-(L.x*P+L.z*f+L.w)/L.y;return C.Of.TransformCoordinatesFromFloatsToRef(0,o,0,Y,m),m.y}getNormalAtCoordinates(P,f){const Y=new C.Of(0,1,0);return this.getNormalAtCoordinatesToRef(P,f,Y),Y}getNormalAtCoordinatesToRef(P,f,Y){const q=this.getWorldMatrix(),m=C.TmpVectors.Matrix[5];q.invertToRef(m);const L=C.TmpVectors.Of[8];if(C.Of.TransformCoordinatesFromFloatsToRef(P,0,f,m,L),P=L.x,f=L.z,P<this._minX||P>this._maxX||f<this._minZ||f>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const o=this._getFacetAt(P,f);return C.Of.TransformNormalFromFloatsToRef(o.x,o.y,o.z,q,Y),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(P,f){const Y=Math.floor((P+this._maxX)*this._subdivisionsX/this._width),C=Math.floor(-(f+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),q=this._heightQuads[C*this._subdivisionsX+Y];let m;return m=f<q.slope.x*P+q.slope.y?q.facet1:q.facet2,m}_initHeightQuads(){const P=this._subdivisionsX,f=this._subdivisionsY;this._heightQuads=[];for(let Y=0;Y<f;Y++)for(let f=0;f<P;f++){const q={slope:C.Vector2.Zero(),facet1:new C.Vector4(0,0,0,0),facet2:new C.Vector4(0,0,0,0)};this._heightQuads[Y*P+f]=q}return this}_computeHeightQuads(){const P=this.getVerticesData(o.d.PositionKind);if(!P)return this;const f=C.TmpVectors.Of[3],Y=C.TmpVectors.Of[2],q=C.TmpVectors.Of[1],m=C.TmpVectors.Of[0],L=C.TmpVectors.Of[4],w=C.TmpVectors.Of[5],d=C.TmpVectors.Of[6],R=C.TmpVectors.Of[7],y=C.TmpVectors.Of[8];let r=0,i=0,u=0,g=0,S=0,K=0,M=0;const V=this._subdivisionsX,O=this._subdivisionsY;for(let o=0;o<O;o++)for(let O=0;O<V;O++){r=3*O,i=o*(V+1)*3,u=(o+1)*(V+1)*3,f.x=P[i+r],f.y=P[i+r+1],f.z=P[i+r+2],Y.x=P[i+r+3],Y.y=P[i+r+4],Y.z=P[i+r+5],q.x=P[u+r],q.y=P[u+r+1],q.z=P[u+r+2],m.x=P[u+r+3],m.y=P[u+r+4],m.z=P[u+r+5],g=(m.z-f.z)/(m.x-f.x),S=f.z-g*f.x,Y.subtractToRef(f,L),q.subtractToRef(f,w),m.subtractToRef(f,d),C.Of.CrossToRef(d,w,R),C.Of.CrossToRef(L,d,y),R.normalize(),y.normalize(),K=-(R.x*f.x+R.y*f.y+R.z*f.z),M=-(y.x*Y.x+y.y*Y.y+y.z*Y.z);const n=this._heightQuads[o*V+O];n.slope.do(g,S),n.facet1.do(R.x,R.y,R.z,K),n.facet2.do(y.x,y.y,y.z,M)}return this}serialize(P){super.serialize(P),P.subdivisionsX=this._subdivisionsX,P.subdivisionsY=this._subdivisionsY,P.minX=this._minX,P.maxX=this._maxX,P.zf=this._minZ,P.maxZ=this._maxZ,P.width=this._width,P.height=this._height}static Parse(P,f){const Y=new w(P.name,f);return Y._subdivisionsX=P.subdivisionsX||1,Y._subdivisionsY=P.subdivisionsY||1,Y._minX=P.minX,Y._maxX=P.maxX,Y._minZ=P.zf,Y._maxZ=P.maxZ,Y._width=P.width,Y._height=P.height,Y}}var d=Y(11014),R=Y(11052),y=Y(11187),r=Y(11239);function i(P){const f=[],Y=[],q=[],m=[];let o,w;const d=P.width||P.size||1,R=P.height||P.size||1,y=0|(P.subdivisionsX||P.subdivisions||1),i=0|(P.subdivisionsY||P.subdivisions||1);for(o=0;o<=i;o++)for(w=0;w<=y;w++){const P=new C.Of(w*d/y-d/2,0,(i-o)*R/i-R/2),f=new C.Of(0,1,0);Y.push(P.x,P.y,P.z),q.push(f.x,f.y,f.z),m.push(w/y,r.d?o/i:1-o/i)}for(o=0;o<i;o++)for(w=0;w<y;w++)f.push(w+1+(o+1)*(y+1)),f.push(w+1+o*(y+1)),f.push(w+o*(y+1)),f.push(w+(o+1)*(y+1)),f.push(w+1+(o+1)*(y+1)),f.push(w+o*(y+1));const u=new L.c;return u.indices=f,u.TP=Y,u.UP=q,u.jP=m,u}function u(P){const f=void 0!==P.xmin&&null!==P.xmin?P.xmin:-1,Y=void 0!==P.zmin&&null!==P.zmin?P.zmin:-1,q=void 0!==P.xmax&&null!==P.xmax?P.xmax:1,m=void 0!==P.zmax&&null!==P.zmax?P.zmax:1,o=P.subdivisions||{w:1,h:1},w=P.precision||{w:1,h:1},d=[],R=[],y=[],r=[];let i,u,g,S;o.h=o.h<1?1:o.h,o.w=o.w<1?1:o.w,w.w=w.w<1?1:w.w,w.h=w.h<1?1:w.h;const K=(q-f)/o.w,M=(m-Y)/o.h;function V(P,f,Y,q){const m=R.length/3,L=w.w+1;for(i=0;i<w.h;i++)for(u=0;u<w.w;u++){const P=[m+u+i*L,m+(u+1)+i*L,m+(u+1)+(i+1)*L,m+u+(i+1)*L];d.push(P[1]),d.push(P[2]),d.push(P[3]),d.push(P[0]),d.push(P[1]),d.push(P[3])}const o=C.Of.Zero(),g=new C.Of(0,1,0);for(i=0;i<=w.h;i++)for(o.z=i*(q-f)/w.h+f,u=0;u<=w.w;u++)o.x=u*(Y-P)/w.w+P,o.y=0,R.push(o.x,o.y,o.z),y.push(g.x,g.y,g.z),r.push(u/w.w,i/w.h)}for(g=0;g<o.h;g++)for(S=0;S<o.w;S++)V(f+S*K,Y+g*M,f+(S+1)*K,Y+(g+1)*M);const O=new L.c;return O.indices=d,O.TP=R,O.UP=y,O.jP=r,O}function g(P){const f=[],Y=[],m=[],o=[];let w,d;const R=P.colorFilter||new q.Df(.3,.59,.11),r=P.alphaFilter||0;let i=!1;if(P.minHeight>P.maxHeight){i=!0;const f=P.maxHeight;P.maxHeight=P.minHeight,P.minHeight=f}for(w=0;w<=P.subdivisions;w++)for(d=0;d<=P.subdivisions;d++){const f=new C.Of(d*P.width/P.subdivisions-P.width/2,0,(P.subdivisions-w)*P.height/P.subdivisions-P.height/2),q=4*(((f.x+P.width/2)/P.width*(P.bufferWidth-1)|0)+((1-(f.z+P.height/2)/P.height)*(P.bufferHeight-1)|0)*P.bufferWidth);let L=P.buffer[q]/255,u=P.buffer[q+1]/255,g=P.buffer[q+2]/255;const S=P.buffer[q+3]/255;i&&(L=1-L,u=1-u,g=1-g);const K=L*R.r+u*R.g+g*R.b;f.y=S>=r?P.minHeight+(P.maxHeight-P.minHeight)*K:P.minHeight-y.c,P.heightBuffer&&(P.heightBuffer[w*(P.subdivisions+1)+d]=f.y),Y.push(f.x,f.y,f.z),m.push(0,0,0),o.push(d/P.subdivisions,1-w/P.subdivisions)}for(w=0;w<P.subdivisions;w++)for(d=0;d<P.subdivisions;d++){const C=d+1+(w+1)*(P.subdivisions+1),q=d+1+w*(P.subdivisions+1),m=d+w*(P.subdivisions+1),L=d+(w+1)*(P.subdivisions+1),o=Y[3*C+1]>=P.minHeight,R=Y[3*q+1]>=P.minHeight,y=Y[3*m+1]>=P.minHeight;o&&R&&y&&(f.push(C),f.push(q),f.push(m));Y[3*L+1]>=P.minHeight&&o&&y&&(f.push(L),f.push(C),f.push(m))}L.c.ComputeNormals(Y,f,m);const u=new L.c;return u.indices=f,u.TP=Y,u.UP=m,u.jP=o,u}function S(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Y=new w(P,arguments.length>2?arguments[2]:void 0);Y._setReady(!1),Y._subdivisionsX=f.subdivisionsX||f.subdivisions||1,Y._subdivisionsY=f.subdivisionsY||f.subdivisions||1,Y._width=f.width||1,Y._height=f.height||1,Y._maxX=Y._width/2,Y._maxZ=Y._height/2,Y._minX=-Y._maxX,Y._minZ=-Y._maxZ;return i(f).sP(Y,f.updatable),Y._setReady(!0),Y}function K(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new m.c(P,Y);return u(f).sP(C,f.updatable),C}function M(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const m=Y.width||10,L=Y.height||10,o=Y.subdivisions||1,y=Y.minHeight||0,r=Y.maxHeight||1,i=Y.colorFilter||new q.Df(.3,.59,.11),u=Y.alphaFilter||0,S=Y.updatable,K=Y.onReady;C=C||R.e.LastCreatedScene;const M=new w(P,C);let V;M._subdivisionsX=o,M._subdivisionsY=o,M._width=m,M._height=L,M._maxX=M._width/2,M._maxZ=M._height/2,M._minX=-M._maxX,M._minZ=-M._maxZ,M._setReady(!1),Y.passHeightBufferInCallback&&(V=new Float32Array((o+1)*(o+1)));const O=(P,f,Y)=>{g({width:m,height:L,subdivisions:o,minHeight:y,maxHeight:r,colorFilter:i,buffer:P,bufferWidth:f,bufferHeight:Y,alphaFilter:u,heightBuffer:V}).sP(M,S),K&&K(M,V),M._setReady(!0)};if("string"===typeof f){const P=P=>{var f;const Y=P.width,q=P.height;if(C.R)return;const m=null===(f=C)||void 0===f?void 0:f.getEngine().resizeImageBitmap(P,Y,q);O(m,Y,q)};d.Tools.LoadImage(f,P,Y.onError?Y.onError:()=>{},C.offlineProvider)}else O(f.data,f.width,f.height);return M}L.c.CreateGround=i,L.c.CreateTiledGround=u,L.c.CreateGroundFromHeightMap=g,m.c.CreateGround=(P,f,Y,C,q,m)=>S(P,{width:f,height:Y,subdivisions:C,updatable:m},q),m.c.CreateTiledGround=(P,f,Y,C,q,m,L,o,w)=>K(P,{xmin:f,zmin:Y,xmax:C,zmax:q,subdivisions:m,precision:L,updatable:w},o),m.c.CreateGroundFromHeightMap=(P,f,Y,C,q,m,L,o,w,d,R)=>M(P,f,{width:Y,height:C,subdivisions:q,minHeight:m,maxHeight:L,updatable:w,onReady:d,alphaFilter:R},o)},13086:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>i,e:()=>y,h:()=>r});var C=Y(11179),q=Y(11648),m=Y(11625),L=Y(11751),o=Y(11255),w=Y(11025);function d(P){const f=[],Y=[],C=P.lines,q=P.DP,L=[];let o=0;for(let m=0;m<C.length;m++){const P=C[m];for(let C=0;C<P.length;C++){const{x:w,y:d,z:R}=P[C];if(Y.push(w,d,R),q){const P=q[m],{r:f,g:Y,b:o,a:w}=P[C];L.push(f,Y,o,w)}C>0&&(f.push(o-1),f.push(o)),o++}}const w=new m.c;return w.indices=f,w.TP=Y,q&&(w.DP=L),w}function R(P){const f=P.dashSize||3,Y=P.gapSize||1,q=P.dashNb||200,L=P.points,o=[],w=[],d=C.Of.Zero();let R=0,y=0,r=0,i=0,u=0,g=0,S=0;for(S=0;S<L.length-1;S++)L[S+1].subtractToRef(L[S],d),R+=d.length();for(r=R/q,i=f*r/(f+Y),S=0;S<L.length-1;S++){L[S+1].subtractToRef(L[S],d),y=Math.floor(d.length()/r),d.normalize();for(let P=0;P<y;P++)u=r*P,o.push(L[S].x+u*d.x,L[S].y+u*d.y,L[S].z+u*d.z),o.push(L[S].x+(u+i)*d.x,L[S].y+(u+i)*d.y,L[S].z+(u+i)*d.z),w.push(g,g+1),g+=2}const K=new m.c;return K.TP=o,K.indices=w,K}function y(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=f.instance,q=f.lines,m=f.DP;if(C){const P=C.getVerticesData(o.d.PositionKind);let f,Y;m&&(f=C.getVerticesData(o.d.ColorKind));let L=0,w=0;for(let C=0;C<q.length;C++){const o=q[C];for(let q=0;q<o.length;q++)P[L]=o[q].x,P[L+1]=o[q].y,P[L+2]=o[q].z,m&&f&&(Y=m[C],f[w]=Y[q].r,f[w+1]=Y[q].g,f[w+2]=Y[q].b,f[w+3]=Y[q].a,w+=4),L+=3}return C.updateVerticesData(o.d.PositionKind,P,!1,!1),m&&f&&C.updateVerticesData(o.d.ColorKind,f,!1,!1),C.refreshBoundingInfo(),C}const w=!!m,R=new L.e(P,Y,null,void 0,void 0,w,f.useVertexAlpha,f.material);return d(f).sP(R,f.updatable),R}function r(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=f.DP?[f.DP]:null;return y(P,{lines:[f.points],updatable:f.updatable,instance:f.instance,DP:C,useVertexAlpha:f.useVertexAlpha,material:f.material},Y)}function i(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=f.points,o=f.instance,d=f.gapSize||1,y=f.dashSize||3;if(o){const P=P=>{const f=C.Of.Zero(),Y=P.length/6;let q=0,L=0,w=0,d=0,R=0,y=0,r=0,i=0;for(r=0;r<m.length-1;r++)m[r+1].subtractToRef(m[r],f),q+=f.length();w=q/Y;const u=o._creationDataStorage.dashSize;for(d=u*w/(u+o._creationDataStorage.gapSize),r=0;r<m.length-1;r++)for(m[r+1].subtractToRef(m[r],f),L=Math.floor(f.length()/w),f.normalize(),i=0;i<L&&y<P.length;)R=w*i,P[y]=m[r].x+R*f.x,P[y+1]=m[r].y+R*f.y,P[y+2]=m[r].z+R*f.z,P[y+3]=m[r].x+(R+d)*f.x,P[y+4]=m[r].y+(R+d)*f.y,P[y+5]=m[r].z+(R+d)*f.z,y+=6,i++;for(;y<P.length;)P[y]=m[r].x,P[y+1]=m[r].y,P[y+2]=m[r].z,y+=3};return(f.dashNb||f.dashSize||f.gapSize||f.useVertexAlpha||f.material)&&w.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),o.updateMeshPositions(P,!1),o}const r=new L.e(P,Y,null,void 0,void 0,void 0,f.useVertexAlpha,f.material);return R(f).sP(r,f.updatable),r._creationDataStorage=new q.e,r._creationDataStorage.dashSize=y,r._creationDataStorage.gapSize=d,r}m.c.CreateLineSystem=d,m.c.CreateDashedLines=R,q.c.Yd=function(P,f){return r(P,{points:f,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},q.c.CreateDashedLines=function(P,f,Y,C,q){return i(P,{points:f,dashSize:Y,gapSize:C,dashNb:q,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12503:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>o,f:()=>w});var C=Y(11648),q=Y(11625),m=Y(11239);function L(P){const f=[],Y=[],C=[],L=[],o=void 0!==P.width?P.width:void 0!==P.size?P.size:1,w=void 0!==P.height?P.height:void 0!==P.size?P.size:1,d=0===P.sideOrientation?0:P.sideOrientation||q.c.DEFAULTSIDE,R=o/2,y=w/2;Y.push(-R,-y,0),C.push(0,0,-1),L.push(0,m.d?1:0),Y.push(R,-y,0),C.push(0,0,-1),L.push(1,m.d?1:0),Y.push(R,y,0),C.push(0,0,-1),L.push(1,m.d?0:1),Y.push(-R,y,0),C.push(0,0,-1),L.push(0,m.d?0:1),f.push(0),f.push(1),f.push(2),f.push(0),f.push(2),f.push(3),q.c._ComputeSides(d,Y,f,C,L,P.frontUVs,P.backUVs);const r=new q.c;return r.indices=f,r.TP=Y,r.UP=C,r.jP=L,r}function o(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new C.c(P,Y);f.sideOrientation=C.c._GetDefaultSideOrientation(f.sideOrientation),q._originalBuilderSideOrientation=f.sideOrientation;return L(f).sP(q,f.updatable),f.sourcePlane&&(q.translate(f.sourcePlane.normal,-f.sourcePlane.d),q.setDirection(f.sourcePlane.normal.scale(-1))),q}const w={qd:o};q.c.qd=L,C.c.qd=(P,f,Y,C,q)=>o(P,{size:f,width:f,height:f,sideOrientation:q,updatable:C},Y)},12586:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>w});var C=Y(11179),q=Y(11648),m=Y(11625),L=Y(11239);function o(P){const f=0|(P.segments||32),Y=P.diameterX||P.diameter||1,q=P.diameterY||P.diameter||1,o=P.diameterZ||P.diameter||1,w=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,d=P.slice&&P.slice<=0?1:P.slice||1,R=0===P.sideOrientation?0:P.sideOrientation||m.c.DEFAULTSIDE,y=!!P.dedupTopBottomIndices,r=new C.Of(Y/2,q/2,o/2),i=2+f,u=2*i,g=[],S=[],K=[],M=[];for(let m=0;m<=i;m++){const P=m/i,f=P*Math.PI*d;for(let Y=0;Y<=u;Y++){const q=Y/u,m=q*Math.PI*2*w,o=C.Matrix.RotationZ(-f),d=C.Matrix.RotationY(m),R=C.Of.TransformCoordinates(C.Of.Up(),o),y=C.Of.TransformCoordinates(R,d),i=y.multiply(r),g=y.divide(r).normalize();S.push(i.x,i.y,i.z),K.push(g.x,g.y,g.z),M.push(q,L.d?1-P:P)}if(m>0){const P=S.length/3;for(let f=P-2*(u+1);f+u+2<P;f++)y?(m>1&&(g.push(f),g.push(f+1),g.push(f+u+1)),(m<i||d<1)&&(g.push(f+u+1),g.push(f+1),g.push(f+u+2))):(g.push(f),g.push(f+1),g.push(f+u+1),g.push(f+u+1),g.push(f+1),g.push(f+u+2))}}m.c._ComputeSides(R,S,g,K,M,P.frontUVs,P.backUVs);const V=new m.c;return V.indices=g,V.TP=S,V.UP=K,V.jP=M,V}function w(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return o(f).sP(C,f.updatable),C}m.c.CreateSphere=o,q.c.CreateSphere=(P,f,Y,C,q,m)=>w(P,{segments:f,diameterX:Y,diameterY:Y,diameterZ:Y,sideOrientation:m,updatable:q},C)},13376:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>o});var C=Y(11781),q=Y(12890),m=Y(11800),L=Y(11625);class o{static get Configuration(){return{get decoder(){return q.b.DefaultConfiguration},set decoder(P){q.b.DefaultConfiguration=P}}}static set Configuration(P){q.b.DefaultConfiguration=P.decoder}static get DecoderAvailable(){return(0,C.j)(q.b.DefaultConfiguration)}static get Default(){return o._Default??(o._Default=new o),o._Default}static ResetDefault(P){o._Default&&(P||o._Default.dispose(),o._Default=null)}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.DefaultNumWorkers;const f="number"===typeof P?{...q.b.DefaultConfiguration,numWorkers:P}:{...q.b.DefaultConfiguration,...P};this._decoder=new q.b(f)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(P,f,Y){return this._decoder.decodeMeshToMeshDataAsync(P,f,Y)}async decodeMeshToGeometryAsync(P,f,Y,C){return await this._decoder.decodeMeshToGeometryAsync(P,f,Y,C)}async _decodeMeshToGeometryForGltfAsync(P,f,Y,C,q,m){return await this._decoder._decodeMeshToGeometryForGltfAsync(P,f,Y,C,q,m)}async decodeMeshAsync(P,f){const Y=await this._decoder.decodeMeshToMeshDataAsync(P,f),C=new L.c;Y.indices&&(C.indices=Y.indices);for(const q of Y.attributes){const P=m.e.GetFloatData(q.data,q.size,m.e.GetDataType(q.data),q.byteOffset,q.byteStride,q.normalized,Y.totalVertices);C.set(P,q.kind)}return C}}o.DefaultNumWorkers=(0,C.g)(),o._Default=null},12890:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>d});var C=Y(11781),q=Y(11014),m=Y(11660),L=Y(11800),o=Y(11025),w=Y(11795);class d extends C.e{static get DefaultAvailable(){return(0,C.j)(d.DefaultConfiguration)}static get Default(){return d._Default??(d._Default=new d),d._Default}static ResetDefault(P){d._Default&&(P||d._Default.dispose(),d._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(P,f){return{module:await(f||DracoDecoderModule)({wasmBinary:P})}}_getWorkerContent(){return`${w.d}(${w.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.DefaultConfiguration)}decodeMeshToMeshDataAsync(P,f,Y){const C=P instanceof ArrayBuffer?new Int8Array(P):new Int8Array(P.buffer,P.byteOffset,P.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async P=>await new Promise(((q,m)=>{P.push(((P,L)=>{let w=null;const d=[],R=f=>{P.removeEventListener("error",R),P.removeEventListener("message",y),m(f),L()},y=f=>{const C=f.data;switch(C.id){case"indices":w=C.data;break;case"attribute":d.push({kind:C.kind,data:C.data,size:C.size,byteOffset:C.byteOffset,byteStride:C.byteStride,normalized:(m=C.kind,r=C.normalized,Y&&void 0!==Y[m]?(r!==Y[m]&&o.e.Warn(`Normalized flag from Draco data (${r}) does not match normalized flag from glTF accessor (${Y[m]}). Using flag from glTF accessor.`),Y[m]):r)});break;case"decodeMeshDone":P.removeEventListener("error",R),P.removeEventListener("message",y),q({indices:w,attributes:d,totalVertices:C.totalVertices}),L()}var m,r};P.addEventListener("error",R),P.addEventListener("message",y);const r=C.slice();P.postMessage({id:"decodeMesh",dataView:r,attributes:f},[r.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((P=>{let Y=null;const q=[],m=(0,w.d)(P.module,C,f,(P=>{Y=P}),((P,f,Y,C,m,L)=>{q.push({kind:P,data:f,size:Y,byteOffset:C,byteStride:m,normalized:L})}));return{indices:Y,attributes:q,totalVertices:m}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(P,f,Y,C){const q=await this.decodeMeshToMeshDataAsync(Y,C),o=new m.c(P,f);q.indices&&o.setIndices(q.indices);for(const m of q.attributes)o.setVerticesBuffer(new L.e(f.getEngine(),m.data,m.kind,!1,void 0,m.byteStride,void 0,m.byteOffset,m.size,void 0,m.normalized,!0),q.totalVertices);return o}async _decodeMeshToGeometryForGltfAsync(P,f,Y,C,q,o){const w=await this.decodeMeshToMeshDataAsync(Y,C,q),d=new m.c(P,f);o&&(d._boundingInfo=o,d.useBoundingInfoFromGeometry=!0),w.indices&&d.setIndices(w.indices);for(const m of w.attributes)d.setVerticesBuffer(new L.e(f.getEngine(),m.data,m.kind,!1,void 0,m.byteStride,void 0,m.byteOffset,m.size,void 0,m.normalized,!0),w.totalVertices);return d}}d.DefaultConfiguration={wasmUrl:`${q.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${q.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},d._Default=null},13080:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>oP});var C=Y(11179),q=Y(11648),m=Y(11255),L=Y(11625),o=Y(11239);function w(P){let f=P.pathArray;const Y=P.closeArray||!1,C=P.closePath||!1,q=P.invertUV||!1,w=Math.floor(f[0].length/2);let d=P.offset||w;d=d>w?w:Math.floor(d);const R=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE,y=P.jP,r=P.DP,i=[],u=[],g=[],S=[],K=[],M=[],V=[],O=[];let n;const l=[],v=[];let c,T,U;if(f.length<2){const P=[],Y=[];for(T=0;T<f[0].length-d;T++)P.push(f[0][T]),Y.push(f[0][T+d]);f=[P,Y]}let D=0;const j=C?1:0,e=Y?1:0;let s,a,Q,J,N,I;for(n=f[0].length,c=0;c<f.length+e;c++){for(V[c]=0,K[c]=[0],s=c===f.length?f[0]:f[c],a=s.length,n=n<a?n:a,U=0;U<a;)i.push(s[U].x,s[U].y,s[U].z),U>0&&(Q=s[U].nf(s[U-1]).length(),J=Q+V[c],K[c].push(J),V[c]=J),U++;C&&(U--,i.push(s[0].x,s[0].y,s[0].z),Q=s[U].nf(s[0]).length(),J=Q+V[c],K[c].push(J),V[c]=J),l[c]=a+j,v[c]=D,D+=a+j}let X,x,k=null,Z=null;for(T=0;T<n+j;T++)for(O[T]=0,M[T]=[0],c=0;c<f.length-1+e;c++)N=f[c],I=c===f.length-1?f[0]:f[c+1],T===n?(k=N[0],Z=I[0]):(k=N[T],Z=I[T]),Q=Z.nf(k).length(),J=Q+O[T],M[T].push(J),O[T]=J;if(y)for(c=0;c<y.length;c++)S.push(y[c].x,o.d?1-y[c].y:y[c].y);else for(c=0;c<f.length+e;c++)for(T=0;T<n+j;T++)X=0!=V[c]?K[c][T]/V[c]:0,x=0!=O[T]?M[T][c]/O[T]:0,q?S.push(x,X):S.push(X,o.d?1-x:x);c=0;let A=0,E=l[c]-1,t=l[c+1]-1,G=E<t?E:t,z=v[1]-v[0];const B=l.length-1;for(;A<=G&&c<B;)u.push(A,A+z,A+1),u.push(A+z+1,A+1,A+z),A+=1,A===G&&(c++,z=v[c+1]-v[c],E=l[c]-1,t=l[c+1]-1,A=v[c],G=E<t?E+A:t+A);if(L.c.ComputeNormals(i,u,g),C){let P=0,Y=0;for(c=0;c<f.length;c++){P=3*v[c],Y=c+1<f.length?3*(v[c+1]-1):g.length-3,g[P]=.5*(g[P]+g[Y]),g[P+1]=.5*(g[P+1]+g[Y+1]),g[P+2]=.5*(g[P+2]+g[Y+2]);const C=Math.sqrt(g[P]*g[P]+g[P+1]*g[P+1]+g[P+2]*g[P+2]);g[P]/=C,g[P+1]/=C,g[P+2]/=C,g[Y]=g[P],g[Y+1]=g[P+1],g[Y+2]=g[P+2]}}if(Y){let P=3*v[0],Y=3*v[f.length];for(T=0;T<n+j;T++){g[P]=.5*(g[P]+g[Y]),g[P+1]=.5*(g[P+1]+g[Y+1]),g[P+2]=.5*(g[P+2]+g[Y+2]);const f=Math.sqrt(g[P]*g[P]+g[P+1]*g[P+1]+g[P+2]*g[P+2]);g[P]/=f,g[P+1]/=f,g[P+2]/=f,g[Y]=g[P],g[Y+1]=g[P+1],g[Y+2]=g[P+2],P+=3,Y+=3}}L.c._ComputeSides(R,i,u,g,S,P.frontUVs,P.backUVs);let b=null;if(r){b=new Float32Array(4*r.length);for(let P=0;P<r.length;P++)b[4*P]=r[P].r,b[4*P+1]=r[P].g,b[4*P+2]=r[P].b,b[4*P+3]=r[P].a}const H=new L.c,W=new Float32Array(i),p=new Float32Array(g),h=new Float32Array(S);return H.indices=u,H.TP=W,H.UP=p,H.jP=h,b&&H.set(b,m.d.ColorKind),C&&(H._idx=v),H}function d(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const d=f.pathArray,R=f.closeArray,y=f.closePath,r=q.c._GetDefaultSideOrientation(f.sideOrientation),i=f.instance,u=f.updatable;if(i){const P=C.TmpVectors.Of[0].yo(Number.MAX_VALUE),Y=C.TmpVectors.Of[1].yo(-Number.MAX_VALUE),w=f=>{let C=d[0].length;const m=i;let L=0;const o=m._originalBuilderSideOrientation===q.c.DOUBLESIDE?2:1;for(let q=1;q<=o;++q)for(let o=0;o<d.length;++o){const q=d[o],w=q.length;C=C<w?C:w;for(let m=0;m<C;++m){const C=q[m];f[L]=C.x,f[L+1]=C.y,f[L+2]=C.z,P.minimizeInPlaceFromFloats(C.x,C.y,C.z),Y.maximizeInPlaceFromFloats(C.x,C.y,C.z),L+=3}if(m._creationDataStorage&&m._creationDataStorage.closePath){const P=q[0];f[L]=P.x,f[L+1]=P.y,f[L+2]=P.z,L+=3}}},R=i.getVerticesData(m.d.PositionKind);if(w(R),i.hasBoundingInfo?i.getBoundingInfo().reConstruct(P,Y,i._worldMatrix):i.buildBoundingInfo(P,Y,i._worldMatrix),i.updateVerticesData(m.d.PositionKind,R,!1,!1),f.DP){const P=i.getVerticesData(m.d.ColorKind);for(let Y=0,C=0;Y<f.DP.length;Y++,C+=4){const q=f.DP[Y];P[C]=q.r,P[C+1]=q.g,P[C+2]=q.b,P[C+3]=q.a}i.updateVerticesData(m.d.ColorKind,P,!1,!1)}if(f.jP){const P=i.getVerticesData(m.d.UVKind);for(let Y=0;Y<f.jP.length;Y++)P[2*Y]=f.jP[Y].x,P[2*Y+1]=o.d?1-f.jP[Y].y:f.jP[Y].y;i.updateVerticesData(m.d.UVKind,P,!1,!1)}if(!i.areNormalsFrozen||i.isFacetDataEnabled){const P=i.eq(),f=i.getVerticesData(m.d.NormalKind),Y=i.isFacetDataEnabled?i.getFacetDataParameters():null;if(L.c.ComputeNormals(R,P,f,Y),i._creationDataStorage&&i._creationDataStorage.closePath){let P=0,Y=0;for(let C=0;C<d.length;C++)P=3*i._creationDataStorage.idx[C],Y=C+1<d.length?3*(i._creationDataStorage.idx[C+1]-1):f.length-3,f[P]=.5*(f[P]+f[Y]),f[P+1]=.5*(f[P+1]+f[Y+1]),f[P+2]=.5*(f[P+2]+f[Y+2]),f[Y]=f[P],f[Y+1]=f[P+1],f[Y+2]=f[P+2]}i.areNormalsFrozen||i.updateVerticesData(m.d.NormalKind,f,!1,!1)}return i}{const C=new q.c(P,Y);C._originalBuilderSideOrientation=r,C._creationDataStorage=new q.e;const m=w(f);return y&&(C._creationDataStorage.idx=m._idx),C._creationDataStorage.closePath=y,C._creationDataStorage.closeArray=R,m.sP(C,u),C}}L.c.CreateRibbon=w,q.c.CreateRibbon=function(P,f){return d(P,{pathArray:f,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var R=Y(12598),y=Y(12454),r=Y(11228);function i(P){const f=P.pattern||q.c.NO_FLIP,Y=P.tileWidth||P.tileSize||1,C=P.tileHeight||P.tileSize||1,m=P.alignHorizontal||0,o=P.alignVertical||0,w=P.width||P.size||1,d=Math.floor(w/Y);let R=w-d*Y;const y=P.height||P.size||1,r=Math.floor(y/C);let i=y-r*C;const u=Y*d/2,g=C*r/2;let S=0,K=0,M=0,V=0,O=0,n=0;if(R>0||i>0){switch(M=-u,V=-g,O=u,n=g,m){case q.c.CENTER:R/=2,M-=R,O+=R;break;case q.c.LEFT:O+=R,S=-R/2;break;case q.c.RIGHT:M-=R,S=R/2}switch(o){case q.c.CENTER:i/=2,V-=i,n+=i;break;case q.c.BOTTOM:n+=i,K=-i/2;break;case q.c.TOP:V-=i,K=i/2}}const l=[],v=[],c=[];c[0]=[0,0,1,0,1,1,0,1],c[1]=[0,0,1,0,1,1,0,1],f!==q.c.ROTATE_TILE&&f!==q.c.ROTATE_ROW||(c[1]=[1,1,0,1,0,0,1,0]),f!==q.c.FLIP_TILE&&f!==q.c.FLIP_ROW||(c[1]=[1,0,0,0,0,1,1,1]),f!==q.c.FLIP_N_ROTATE_TILE&&f!==q.c.FLIP_N_ROTATE_ROW||(c[1]=[0,1,1,1,1,0,0,0]);let T=[];const U=[],D=[];let j=0;for(let L=0;L<r;L++)for(let P=0;P<d;P++)l.push(P*Y-u+S,L*C-g+K,0),l.push((P+1)*Y-u+S,L*C-g+K,0),l.push((P+1)*Y-u+S,(L+1)*C-g+K,0),l.push(P*Y-u+S,(L+1)*C-g+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),T=f===q.c.FLIP_TILE||f===q.c.ROTATE_TILE||f===q.c.FLIP_N_ROTATE_TILE?T.concat(c[(P%2+L%2)%2]):f===q.c.FLIP_ROW||f===q.c.ROTATE_ROW||f===q.c.FLIP_N_ROTATE_ROW?T.concat(c[L%2]):T.concat(c[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),j+=4;if(R>0||i>0){const P=i>0&&(o===q.c.CENTER||o===q.c.TOP),L=i>0&&(o===q.c.CENTER||o===q.c.BOTTOM),w=R>0&&(m===q.c.CENTER||m===q.c.RIGHT),y=R>0&&(m===q.c.CENTER||m===q.c.LEFT);let c,e,s,a,Q=[];if(P&&w&&(l.push(M+S,V+K,0),l.push(-u+S,V+K,0),l.push(-u+S,V+i+K,0),l.push(M+S,V+i+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,c=1-R/Y,e=1-i/C,s=1,a=1,Q=[c,e,s,e,s,a,c,a],f===q.c.ROTATE_ROW&&(Q=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),f===q.c.FLIP_ROW&&(Q=[1-c,e,1-s,e,1-s,a,1-c,a]),f===q.c.FLIP_N_ROTATE_ROW&&(Q=[c,1-e,s,1-e,s,1-a,c,1-a]),T=T.concat(Q),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),P&&y&&(l.push(u+S,V+K,0),l.push(O+S,V+K,0),l.push(O+S,V+i+K,0),l.push(u+S,V+i+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,c=0,e=1-i/C,s=R/Y,a=1,Q=[c,e,s,e,s,a,c,a],(f===q.c.ROTATE_ROW||f===q.c.ROTATE_TILE&&d%2===0)&&(Q=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),(f===q.c.FLIP_ROW||f===q.c.FLIP_TILE&&d%2===0)&&(Q=[1-c,e,1-s,e,1-s,a,1-c,a]),(f===q.c.FLIP_N_ROTATE_ROW||f===q.c.FLIP_N_ROTATE_TILE&&d%2===0)&&(Q=[c,1-e,s,1-e,s,1-a,c,1-a]),T=T.concat(Q),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&w&&(l.push(M+S,g+K,0),l.push(-u+S,g+K,0),l.push(-u+S,n+K,0),l.push(M+S,n+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,c=1-R/Y,e=0,s=1,a=i/C,Q=[c,e,s,e,s,a,c,a],(f===q.c.ROTATE_ROW&&r%2===1||f===q.c.ROTATE_TILE&&r%1===0)&&(Q=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),(f===q.c.FLIP_ROW&&r%2===1||f===q.c.FLIP_TILE&&r%2===0)&&(Q=[1-c,e,1-s,e,1-s,a,1-c,a]),(f===q.c.FLIP_N_ROTATE_ROW&&r%2===1||f===q.c.FLIP_N_ROTATE_TILE&&r%2===0)&&(Q=[c,1-e,s,1-e,s,1-a,c,1-a]),T=T.concat(Q),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&y&&(l.push(u+S,g+K,0),l.push(O+S,g+K,0),l.push(O+S,n+K,0),l.push(u+S,n+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,c=0,e=0,s=R/Y,a=i/C,Q=[c,e,s,e,s,a,c,a],(f===q.c.ROTATE_ROW&&r%2===1||f===q.c.ROTATE_TILE&&(r+d)%2===1)&&(Q=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),(f===q.c.FLIP_ROW&&r%2===1||f===q.c.FLIP_TILE&&(r+d)%2===1)&&(Q=[1-c,e,1-s,e,1-s,a,1-c,a]),(f===q.c.FLIP_N_ROTATE_ROW&&r%2===1||f===q.c.FLIP_N_ROTATE_TILE&&(r+d)%2===1)&&(Q=[c,1-e,s,1-e,s,1-a,c,1-a]),T=T.concat(Q),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),P){const P=[];c=0,e=1-i/C,s=1,a=1,P[0]=[c,e,s,e,s,a,c,a],P[1]=[c,e,s,e,s,a,c,a],f!==q.c.ROTATE_TILE&&f!==q.c.ROTATE_ROW||(P[1]=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),f!==q.c.FLIP_TILE&&f!==q.c.FLIP_ROW||(P[1]=[1-c,e,1-s,e,1-s,a,1-c,a]),f!==q.c.FLIP_N_ROTATE_TILE&&f!==q.c.FLIP_N_ROTATE_ROW||(P[1]=[c,1-e,s,1-e,s,1-a,c,1-a]);for(let C=0;C<d;C++)l.push(C*Y-u+S,V+K,0),l.push((C+1)*Y-u+S,V+K,0),l.push((C+1)*Y-u+S,V+i+K,0),l.push(C*Y-u+S,V+i+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,T=f===q.c.FLIP_TILE||f===q.c.ROTATE_TILE||f===q.c.FLIP_N_ROTATE_TILE?T.concat(P[(C+1)%2]):f===q.c.FLIP_ROW||f===q.c.ROTATE_ROW||f===q.c.FLIP_N_ROTATE_ROW?T.concat(P[1]):T.concat(P[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){const P=[];c=0,e=0,s=1,a=i/C,P[0]=[c,e,s,e,s,a,c,a],P[1]=[c,e,s,e,s,a,c,a],f!==q.c.ROTATE_TILE&&f!==q.c.ROTATE_ROW||(P[1]=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),f!==q.c.FLIP_TILE&&f!==q.c.FLIP_ROW||(P[1]=[1-c,e,1-s,e,1-s,a,1-c,a]),f!==q.c.FLIP_N_ROTATE_TILE&&f!==q.c.FLIP_N_ROTATE_ROW||(P[1]=[c,1-e,s,1-e,s,1-a,c,1-a]);for(let C=0;C<d;C++)l.push(C*Y-u+S,n-i+K,0),l.push((C+1)*Y-u+S,n-i+K,0),l.push((C+1)*Y-u+S,n+K,0),l.push(C*Y-u+S,n+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,T=f===q.c.FLIP_TILE||f===q.c.ROTATE_TILE||f===q.c.FLIP_N_ROTATE_TILE?T.concat(P[(C+r)%2]):f===q.c.FLIP_ROW||f===q.c.ROTATE_ROW||f===q.c.FLIP_N_ROTATE_ROW?T.concat(P[r%2]):T.concat(P[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(w){const P=[];c=1-R/Y,e=0,s=1,a=1,P[0]=[c,e,s,e,s,a,c,a],P[1]=[c,e,s,e,s,a,c,a],f!==q.c.ROTATE_TILE&&f!==q.c.ROTATE_ROW||(P[1]=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),f!==q.c.FLIP_TILE&&f!==q.c.FLIP_ROW||(P[1]=[1-c,e,1-s,e,1-s,a,1-c,a]),f!==q.c.FLIP_N_ROTATE_TILE&&f!==q.c.FLIP_N_ROTATE_ROW||(P[1]=[c,1-e,s,1-e,s,1-a,c,1-a]);for(let Y=0;Y<r;Y++)l.push(M+S,Y*C-g+K,0),l.push(M+R+S,Y*C-g+K,0),l.push(M+R+S,(Y+1)*C-g+K,0),l.push(M+S,(Y+1)*C-g+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,T=f===q.c.FLIP_TILE||f===q.c.ROTATE_TILE||f===q.c.FLIP_N_ROTATE_TILE?T.concat(P[(Y+1)%2]):f===q.c.FLIP_ROW||f===q.c.ROTATE_ROW||f===q.c.FLIP_N_ROTATE_ROW?T.concat(P[Y%2]):T.concat(P[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const P=[];c=0,e=0,s=R/C,a=1,P[0]=[c,e,s,e,s,a,c,a],P[1]=[c,e,s,e,s,a,c,a],f!==q.c.ROTATE_TILE&&f!==q.c.ROTATE_ROW||(P[1]=[1-c,1-e,1-s,1-e,1-s,1-a,1-c,1-a]),f!==q.c.FLIP_TILE&&f!==q.c.FLIP_ROW||(P[1]=[1-c,e,1-s,e,1-s,a,1-c,a]),f!==q.c.FLIP_N_ROTATE_TILE&&f!==q.c.FLIP_N_ROTATE_ROW||(P[1]=[c,1-e,s,1-e,s,1-a,c,1-a]);for(let Y=0;Y<r;Y++)l.push(O-R+S,Y*C-g+K,0),l.push(O+S,Y*C-g+K,0),l.push(O+S,(Y+1)*C-g+K,0),l.push(O-R+S,(Y+1)*C-g+K,0),D.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,T=f===q.c.FLIP_TILE||f===q.c.ROTATE_TILE||f===q.c.FLIP_N_ROTATE_TILE?T.concat(P[(Y+d)%2]):f===q.c.FLIP_ROW||f===q.c.ROTATE_ROW||f===q.c.FLIP_N_ROTATE_ROW?T.concat(P[Y%2]):T.concat(P[0]),U.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const e=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE;L.c._ComputeSides(e,l,D,v,T,P.frontUVs,P.backUVs);const s=new L.c;s.indices=D,s.TP=l,s.UP=v,s.jP=T;const a=e===L.c.DOUBLESIDE?U.concat(U):U;return s.DP=a,s}function u(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return i(f).sP(C,f.updatable),C}function g(P){const f=P.faceUV||new Array(6),Y=P.faceColors,m=P.pattern||q.c.NO_FLIP,w=P.width||P.size||1,d=P.height||P.size||1,R=P.depth||P.size||1,y=P.tileWidth||P.tileSize||1,u=P.tileHeight||P.tileSize||1,g=P.alignHorizontal||0,S=P.alignVertical||0,K=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE;for(let q=0;q<6;q++)void 0===f[q]&&(f[q]=new C.Vector4(0,0,1,1)),Y&&void 0===Y[q]&&(Y[q]=new r.ro(1,1,1,1));const M=w/2,V=d/2,O=R/2,n=[];for(let C=0;C<2;C++)n[C]=i({pattern:m,tileWidth:y,tileHeight:u,width:w,height:d,alignVertical:S,alignHorizontal:g,sideOrientation:K});for(let C=2;C<4;C++)n[C]=i({pattern:m,tileWidth:y,tileHeight:u,width:R,height:d,alignVertical:S,alignHorizontal:g,sideOrientation:K});let l=S;S===q.c.BOTTOM?l=q.c.TOP:S===q.c.TOP&&(l=q.c.BOTTOM);for(let C=4;C<6;C++)n[C]=i({pattern:m,tileWidth:y,tileHeight:u,width:w,height:R,alignVertical:l,alignHorizontal:g,sideOrientation:K});let v=[],c=[],T=[],U=[];const D=[],j=[],e=[],s=[];let a=0,Q=0;for(let q=0;q<6;q++){const P=n[q].TP.length;j[q]=[],e[q]=[];for(let f=0;f<P/3;f++)j[q].push(new C.Of(n[q].TP[3*f],n[q].TP[3*f+1],n[q].TP[3*f+2])),e[q].push(new C.Of(n[q].UP[3*f],n[q].UP[3*f+1],n[q].UP[3*f+2]));a=n[q].jP.length,s[q]=[];for(let Y=0;Y<a;Y+=2)s[q][Y]=f[q].x+(f[q].z-f[q].x)*n[q].jP[Y],s[q][Y+1]=f[q].y+(f[q].w-f[q].y)*n[q].jP[Y+1],o.d&&(s[q][Y+1]=1-s[q][Y+1]);if(T=T.concat(s[q]),U=U.concat(n[q].indices.map((P=>P+Q))),Q+=j[q].length,Y)for(let f=0;f<4;f++)D.push(Y[q].r,Y[q].g,Y[q].b,Y[q].a)}const J=new C.Of(0,0,O),N=C.Matrix.RotationY(Math.PI);v=j[0].map((P=>C.Of.TransformNormal(P,N).add(J))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[]),c=e[0].map((P=>C.Of.TransformNormal(P,N))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[]),v=v.concat(j[1].map((P=>P.nf(J))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[])),c=c.concat(e[1].map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[]));const I=new C.Of(M,0,0),X=C.Matrix.RotationY(-Math.PI/2);v=v.concat(j[2].map((P=>C.Of.TransformNormal(P,X).add(I))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[])),c=c.concat(e[2].map((P=>C.Of.TransformNormal(P,X))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[]));const x=C.Matrix.RotationY(Math.PI/2);v=v.concat(j[3].map((P=>C.Of.TransformNormal(P,x).nf(I))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[])),c=c.concat(e[3].map((P=>C.Of.TransformNormal(P,x))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[]));const k=new C.Of(0,V,0),Z=C.Matrix.RotationX(Math.PI/2);v=v.concat(j[4].map((P=>C.Of.TransformNormal(P,Z).add(k))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[])),c=c.concat(e[4].map((P=>C.Of.TransformNormal(P,Z))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[]));const A=C.Matrix.RotationX(-Math.PI/2);v=v.concat(j[5].map((P=>C.Of.TransformNormal(P,A).nf(k))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[])),c=c.concat(e[5].map((P=>C.Of.TransformNormal(P,A))).map((P=>[P.x,P.y,P.z])).reduce(((P,f)=>P.concat(f)),[])),L.c._ComputeSides(K,v,U,c,T);const E=new L.c;if(E.indices=U,E.TP=v,E.UP=c,E.jP=T,Y){const P=K===L.c.DOUBLESIDE?D.concat(D):D;E.DP=P}return E}function S(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return g(f).sP(C,f.updatable),C}L.c.CreateTiledPlane=i;L.c.CreateTiledBox=g;var K=Y(12586),M=Y(11429),V=Y(11391);function O(P){const f=P.height||2;let Y=0===P.diameterTop?0:P.diameterTop||P.diameter||1,m=0===P.diameterBottom?0:P.diameterBottom||P.diameter||1;Y=Y||1e-5,m=m||1e-5;const w=0|(P.tessellation||24),d=0|(P.subdivisions||1),R=!!P.hasRings,y=!!P.enclose,i=0===P.cap?0:P.cap||q.c.CAP_ALL,u=P.arc&&(P.arc<=0||P.arc>1)?1:P.arc||1,g=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE,S=P.faceUV||new Array(3),K=P.faceColors,M=2+(1+(1!==u&&y?2:0))*(R?d:1);let O;for(O=0;O<M;O++)K&&void 0===K[O]&&(K[O]=new r.ro(1,1,1,1));for(O=0;O<M;O++)S&&void 0===S[O]&&(S[O]=new C.Vector4(0,0,1,1));const n=[],l=[],v=[],c=[],T=[],U=2*Math.PI*u/w;let D,j,e;const s=(m-Y)/2/f,a=C.Of.Zero(),Q=C.Of.Zero(),J=C.Of.Zero(),N=C.Of.Zero(),I=C.Of.Zero(),X=V.e.Y;let x,k,Z,A=1,E=1,t=0,G=0;for(x=0;x<=d;x++)for(j=x/d,e=(j*(Y-m)+m)/2,A=R&&0!==x&&x!==d?2:1,Z=0;Z<A;Z++){for(R&&(E+=Z),y&&(E+=2*Z),k=0;k<=w;k++)D=k*U,a.x=Math.cos(-D)*e,a.y=-f/2+j*f,a.z=Math.sin(-D)*e,0===Y&&x===d?(Q.x=v[v.length-3*(w+1)],Q.y=v[v.length-3*(w+1)+1],Q.z=v[v.length-3*(w+1)+2]):(Q.x=a.x,Q.z=a.z,Q.y=Math.sqrt(Q.x*Q.x+Q.z*Q.z)*s,Q.normalize()),0===k&&(J.q(a),N.q(Q)),l.push(a.x,a.y,a.z),v.push(Q.x,Q.y,Q.z),G=R?t!==E?S[E].y:S[E].w:S[E].y+(S[E].w-S[E].y)*j,c.push(S[E].x+(S[E].z-S[E].x)*k/w,o.d?1-G:G),K&&T.push(K[E].r,K[E].g,K[E].b,K[E].a);1!==u&&y&&(l.push(a.x,a.y,a.z),l.push(0,a.y,0),l.push(0,a.y,0),l.push(J.x,J.y,J.z),C.Of.CrossToRef(X,Q,I),I.normalize(),v.push(I.x,I.y,I.z,I.x,I.y,I.z),C.Of.CrossToRef(N,X,I),I.normalize(),v.push(I.x,I.y,I.z,I.x,I.y,I.z),G=R?t!==E?S[E+1].y:S[E+1].w:S[E+1].y+(S[E+1].w-S[E+1].y)*j,c.push(S[E+1].x,o.d?1-G:G),c.push(S[E+1].z,o.d?1-G:G),G=R?t!==E?S[E+2].y:S[E+2].w:S[E+2].y+(S[E+2].w-S[E+2].y)*j,c.push(S[E+2].x,o.d?1-G:G),c.push(S[E+2].z,o.d?1-G:G),K&&(T.push(K[E+1].r,K[E+1].g,K[E+1].b,K[E+1].a),T.push(K[E+1].r,K[E+1].g,K[E+1].b,K[E+1].a),T.push(K[E+2].r,K[E+2].g,K[E+2].b,K[E+2].a),T.push(K[E+2].r,K[E+2].g,K[E+2].b,K[E+2].a))),t!==E&&(t=E)}const z=1!==u&&y?w+4:w;for(x=0,E=0;E<d;E++){let P=0,f=0,Y=0,C=0;for(k=0;k<w;k++)P=x*(z+1)+k,f=(x+1)*(z+1)+k,Y=x*(z+1)+(k+1),C=(x+1)*(z+1)+(k+1),n.push(P,f,Y),n.push(C,Y,f);1!==u&&y&&(n.push(P+2,f+2,Y+2),n.push(C+2,Y+2,f+2),n.push(P+4,f+4,Y+4),n.push(C+4,Y+4,f+4)),x=R?x+2:x+1}const B=P=>{const q=P?Y/2:m/2;if(0===q)return;let L,d,R;const y=P?S[M-1]:S[0];let r=null;K&&(r=P?K[M-1]:K[0]);const i=l.length/3,g=P?f/2:-f/2,V=new C.Of(0,g,0);l.push(V.x,V.y,V.z),v.push(0,P?1:-1,0);const O=y.y+.5*(y.w-y.y);c.push(y.x+.5*(y.z-y.x),o.d?1-O:O),r&&T.push(r.r,r.g,r.b,r.a);const U=new C.Vector2(.5,.5);for(R=0;R<=w;R++){L=2*Math.PI*R*u/w;const f=Math.cos(-L),Y=Math.sin(-L);d=new C.Of(f*q,g,Y*q);const m=new C.Vector2(f*U.x+.5,Y*U.y+.5);l.push(d.x,d.y,d.z),v.push(0,P?1:-1,0);const i=y.y+(y.w-y.y)*m.y;c.push(y.x+(y.z-y.x)*m.x,o.d?1-i:i),r&&T.push(r.r,r.g,r.b,r.a)}for(R=0;R<w;R++)P?(n.push(i),n.push(i+(R+2)),n.push(i+(R+1))):(n.push(i),n.push(i+(R+1)),n.push(i+(R+2)))};i!==q.c.CAP_START&&i!==q.c.CAP_ALL||B(!1),i!==q.c.CAP_END&&i!==q.c.CAP_ALL||B(!0),L.c._ComputeSides(g,l,n,v,c,P.frontUVs,P.backUVs);const b=new L.c;return b.indices=n,b.TP=l,b.UP=v,b.jP=c,K&&(b.DP=T),b}function n(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return O(f).sP(C,f.updatable),C}function l(P){const f=[],Y=[],q=[],m=[],w=P.diameter||1,d=P.thickness||.5,R=0|(P.tessellation||16),y=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE,r=R+1;for(let L=0;L<=R;L++){const P=L/R,y=L*Math.PI*2/R-Math.PI/2,i=C.Matrix.Translation(w/2,0,0).multiply(C.Matrix.RotationY(y));for(let w=0;w<=R;w++){const y=1-w/R,u=w*Math.PI*2/R+Math.PI,g=Math.cos(u),S=Math.sin(u);let K=new C.Of(g,S,0),M=K.scale(d/2);const V=new C.Vector2(P,y);M=C.Of.TransformCoordinates(M,i),K=C.Of.TransformNormal(K,i),Y.push(M.x,M.y,M.z),q.push(K.x,K.y,K.z),m.push(V.x,o.d?1-V.y:V.y);const O=(L+1)%r,n=(w+1)%r;f.push(L*r+w),f.push(L*r+n),f.push(O*r+w),f.push(L*r+n),f.push(O*r+n),f.push(O*r+w)}}L.c._ComputeSides(y,Y,f,q,m,P.frontUVs,P.backUVs);const i=new L.c;return i.indices=f,i.TP=Y,i.UP=q,i.jP=m,i}function v(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return l(f).sP(C,f.updatable),C}L.c.CreateCylinder=O,q.c.CreateCylinder=(P,f,Y,C,m,L,o,w,d)=>{void 0!==o&&o instanceof M.e||(void 0!==o&&(d=w||q.c.DEFAULTSIDE,w=o),o=L,L=1);return n(P,{height:f,diameterTop:Y,diameterBottom:C,tessellation:m,subdivisions:L,sideOrientation:d,updatable:w},o)};function c(P){const f=[],Y=[],q=[],m=[],w=P.radius||2,d=P.tube||.5,R=P.radialSegments||32,y=P.tubularSegments||32,r=P.p||2,i=P.q||3,u=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE,g=P=>{const f=Math.cos(P),Y=Math.sin(P),q=i/r*P,m=Math.cos(q),L=w*(2+m)*.5*f,o=w*(2+m)*Y*.5,d=w*Math.sin(q)*.5;return new C.Of(L,o,d)};let S,K;for(S=0;S<=R;S++){const P=S%R/R*2*r*Math.PI,f=g(P),q=g(P+.01),L=q.nf(f);let w=q.add(f);const i=C.Of.Cross(L,w);for(w=C.Of.Cross(i,L),i.normalize(),w.normalize(),K=0;K<y;K++){const P=K%y/y*2*Math.PI,C=-d*Math.cos(P),q=d*Math.sin(P);Y.push(f.x+C*w.x+q*i.x),Y.push(f.y+C*w.y+q*i.y),Y.push(f.z+C*w.z+q*i.z),m.push(S/R),m.push(o.d?1-K/y:K/y)}}for(S=0;S<R;S++)for(K=0;K<y;K++){const P=(K+1)%y,Y=S*y+K,C=(S+1)*y+K,q=(S+1)*y+P,m=S*y+P;f.push(m),f.push(C),f.push(Y),f.push(m),f.push(q),f.push(C)}L.c.ComputeNormals(Y,f,q),L.c._ComputeSides(u,Y,f,q,m,P.frontUVs,P.backUVs);const M=new L.c;return M.indices=f,M.TP=Y,M.UP=q,M.jP=m,M}function T(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2?arguments[2]:void 0;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return c(f).sP(C,f.updatable),C}L.c.CreateTorus=l,q.c.CreateTorus=(P,f,Y,C,q,m,L)=>v(P,{diameter:f,thickness:Y,tessellation:C,sideOrientation:L,updatable:m},q);L.c.CreateTorusKnot=c,q.c.CreateTorusKnot=(P,f,Y,C,q,m,L,o,w,d)=>T(P,{radius:f,tube:Y,radialSegments:C,tubularSegments:q,p:m,q:L,sideOrientation:d,updatable:w},o);var U=Y(13086),D=Y(11765),j=Y(11405);function e(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=f.path,m=f.shape,L=f.scale||1,o=f.rotation||0,w=0===f.cap?0:f.cap||q.c.NO_CAP,d=f.updatable,R=q.c._GetDefaultSideOrientation(f.sideOrientation),y=f.instance||null,r=f.invertUV||!1,i=f.closeShape||!1,u=f.closePath||!1,g=f.capFunction||null;return a(P,m,C,L,o,null,null,u,i,w,!1,Y,!!d,R,y,r,f.frontUVs||null,f.backUVs||null,f.firstNormal||null,!!f.adjustFrame,g)}function s(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=f.path,m=f.shape,L=f.scaleFunction||(()=>1),o=f.rotationFunction||(()=>0),w=f.closePath||f.ribbonCloseArray||!1,d=f.closeShape||f.ribbonClosePath||!1,R=0===f.cap?0:f.cap||q.c.NO_CAP,y=f.updatable,r=f.firstNormal||null,i=f.adjustFrame||!1,u=q.c._GetDefaultSideOrientation(f.sideOrientation),g=f.instance,S=f.invertUV||!1,K=f.capFunction||null;return a(P,m,C,null,null,L,o,w,d,R,!0,Y,!!y,u,g||null,S,f.frontUVs||null,f.backUVs||null,r,i,K||null)}function a(P,f,Y,m,L,o,w,R,y,r,i,u,g,S,K,M,V,O,n,l,v){const c=(P,f,Y,m,L,o,w,d,R,y,r)=>{const i=Y.getTangents(),u=Y.getNormals(),g=Y.getBinormals(),S=Y.getDistances();if(r)for(let q=0;q<i.length;q++)if(0==i[q].x&&0==i[q].y&&0==i[q].z&&i[q].q(i[q-1]),0==u[q].x&&0==u[q].y&&0==u[q].z&&u[q].q(u[q-1]),0==g[q].x&&0==g[q].y&&0==g[q].z&&g[q].q(g[q-1]),q>0){let P=i[q-1];C.Of.Dot(P,i[q])<0&&i[q].scaleInPlace(-1),P=u[q-1],C.Of.Dot(P,u[q])<0&&u[q].scaleInPlace(-1),P=g[q-1],C.Of.Dot(P,g[q])<0&&g[q].scaleInPlace(-1)}let K=0;const M=y&&d?d:()=>null!==o?o:0,V=y&&w?w:()=>null!==L?L:1;let O=R===q.c.NO_CAP||R===q.c.CAP_END?0:2;const n=C.TmpVectors.Matrix[0];for(let q=0;q<f.length;q++){const Y=[],L=M(q,S[q]),o=V(q,S[q]);C.Matrix.RotationAxisToRef(i[q],K,n);for(let m=0;m<P.length;m++){const L=i[q].scale(P[m].z).add(u[q].scale(P[m].x)).add(g[q].scale(P[m].y)),w=C.Of.Zero();C.Of.TransformCoordinatesToRef(L,n,w),w.scaleInPlace(o).addInPlace(f[q]),Y[m]=w}m[O]=Y,K+=L,O++}const l=v||(P=>{const f=Array(),Y=C.Of.Zero();let q;for(q=0;q<P.length;q++)Y.addInPlace(P[q]);for(Y.scaleInPlace(1/P.length),q=0;q<P.length;q++)f.push(Y);return f});switch(R){case q.c.NO_CAP:break;case q.c.CAP_START:m[0]=l(m[2]),m[1]=m[2];break;case q.c.CAP_END:m[O]=m[O-1],m[O+1]=l(m[O-1]);break;case q.c.CAP_ALL:m[0]=l(m[2]),m[1]=m[2],m[O]=m[O-1],m[O+1]=l(m[O-1])}return m};let T,U;if(K){const P=K._creationDataStorage;return T=n?P.path3D.update(Y,n):P.path3D.update(Y),U=c(f,Y,P.path3D,P.pathArray,m,L,o,w,P.cap,i,l),K=d("",{pathArray:U,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:K},u||void 0)}T=n?new j.m(Y,n):new j.m(Y);U=c(f,Y,T,new Array,m,L,o,w,r=r<0||r>3?0:r,i,l);const D=d(P,{pathArray:U,closeArray:R,closePath:y,updatable:g,sideOrientation:S,invertUV:M,frontUVs:V||void 0,backUVs:O||void 0},u);return D._creationDataStorage.pathArray=U,D._creationDataStorage.path3D=T,D._creationDataStorage.cap=r,D}function Q(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=f.arc?f.arc<=0||f.arc>1?1:f.arc:1,L=void 0===f.closed||f.closed,o=f.shape,w=f.radius||1,R=f.tessellation||64,y=f.clip||0,r=f.updatable,i=q.c._GetDefaultSideOrientation(f.sideOrientation),u=f.cap||q.c.NO_CAP,g=2*Math.PI,S=[],K=f.invertUV||!1;let M=0,V=0;const O=g/R*m;let n,l;for(M=0;M<=R-y;M++){for(l=[],u!=q.c.CAP_START&&u!=q.c.CAP_ALL||(l.push(new C.Of(0,o[0].y,0)),l.push(new C.Of(Math.cos(M*O)*o[0].x*w,o[0].y,Math.sin(M*O)*o[0].x*w))),V=0;V<o.length;V++)n=new C.Of(Math.cos(M*O)*o[V].x*w,o[V].y,Math.sin(M*O)*o[V].x*w),l.push(n);u!=q.c.CAP_END&&u!=q.c.CAP_ALL||(l.push(new C.Of(Math.cos(M*O)*o[o.length-1].x*w,o[o.length-1].y,Math.sin(M*O)*o[o.length-1].x*w)),l.push(new C.Of(0,o[o.length-1].y,0))),S.push(l)}return d(P,{pathArray:S,closeArray:L,sideOrientation:i,updatable:r,invertUV:K,frontUVs:f.frontUVs,backUVs:f.backUVs},Y)}q.c.ExtrudeShape=function(P,f,Y,C,m,L){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7?arguments[7]:void 0,d=arguments.length>8?arguments[8]:void 0,R=arguments.length>9?arguments[9]:void 0;return e(P,{shape:f,path:Y,scale:C,rotation:m,cap:0===L?0:L||q.c.NO_CAP,sideOrientation:d,instance:R,updatable:w},o)},q.c.ExtrudeShapeCustom=(P,f,Y,C,m,L,o,w,d,R,y,r)=>s(P,{shape:f,path:Y,scaleFunction:C,rotationFunction:m,ribbonCloseArray:L,ribbonClosePath:o,cap:0===w?0:w||q.c.NO_CAP,sideOrientation:y,instance:r,updatable:R},d);q.c.CreateLathe=(P,f,Y,C,q,m,L)=>Q(P,{shape:f,radius:Y,tessellation:C,sideOrientation:L,updatable:m},q);var J=Y(12503),N=Y(12463);function I(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=f.path;let L=f.instance,o=1;void 0!==f.radius?o=f.radius:L&&(o=L._creationDataStorage.radius);const w=f.tessellation||64,R=f.radiusFunction||null;let y=f.cap||q.c.NO_CAP;const r=f.invertUV||!1,i=f.updatable,u=q.c._GetDefaultSideOrientation(f.sideOrientation);f.arc=f.arc&&(f.arc<=0||f.arc>1)?1:f.arc||1;const g=(P,f,Y,m,L,o,w,d)=>{const R=f.getTangents(),y=f.getNormals(),r=f.getDistances(),i=2*Math.PI/L*d,u=o||(()=>m);let g,S,K,M;const V=C.TmpVectors.Matrix[0];let O=w===q.c.NO_CAP||w===q.c.CAP_END?0:2;for(let q=0;q<P.length;q++){S=u(q,r[q]),g=Array(),K=y[q];for(let f=0;f<L;f++)C.Matrix.RotationAxisToRef(R[q],i*f,V),M=g[f]?g[f]:C.Of.Zero(),C.Of.TransformCoordinatesToRef(K,V,M),M.scaleInPlace(S).addInPlace(P[q]),g[f]=M;Y[O]=g,O++}const n=(f,Y)=>{const C=Array();for(let q=0;q<f;q++)C.push(P[Y]);return C};switch(w){case q.c.NO_CAP:break;case q.c.CAP_START:Y[0]=n(L,0),Y[1]=Y[2].slice(0);break;case q.c.CAP_END:Y[O]=Y[O-1].slice(0),Y[O+1]=n(L,P.length-1);break;case q.c.CAP_ALL:Y[0]=n(L,0),Y[1]=Y[2].slice(0),Y[O]=Y[O-1].slice(0),Y[O+1]=n(L,P.length-1)}return Y};let S,K;if(L){const P=L._creationDataStorage,Y=f.arc||P.arc;return S=P.path3D.update(m),K=g(m,S,P.pathArray,o,P.tessellation,R,P.cap,Y),L=d("",{pathArray:K,instance:L}),P.path3D=S,P.pathArray=K,P.arc=Y,P.radius=o,L}S=new j.m(m);y=y<0||y>3?0:y,K=g(m,S,new Array,o,w,R,y,f.arc);const M=d(P,{pathArray:K,closePath:!0,closeArray:!1,updatable:i,sideOrientation:u,invertUV:r,frontUVs:f.frontUVs,backUVs:f.backUVs},Y);return M._creationDataStorage.pathArray=K,M._creationDataStorage.path3D=S,M._creationDataStorage.tessellation=w,M._creationDataStorage.cap=y,M._creationDataStorage.arc=f.arc,M._creationDataStorage.radius=o,M}function X(P){const f=[];f[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},f[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},f[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},f[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},f[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},f[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},f[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},f[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},f[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},f[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},f[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},f[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},f[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},f[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},f[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Y=P.type&&(P.type<0||P.type>=f.length)?0:P.type||0,q=P.size,m=P.sizeX||q||1,w=P.sizeY||q||1,d=P.sizeZ||q||1,R=P.custom||f[Y],y=R.face.length,i=P.faceUV||new Array(y),u=P.faceColors,g=void 0===P.flat||P.flat,S=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE,K=[],M=[],V=[],O=[],n=[];let l=0,v=0;const c=[];let T,U,D,j,e,s,a=0,Q=0;if(g)for(Q=0;Q<y;Q++)u&&void 0===u[Q]&&(u[Q]=new r.ro(1,1,1,1)),i&&void 0===i[Q]&&(i[Q]=new C.Vector4(0,0,1,1));if(g)for(Q=0;Q<y;Q++){const P=R.face[Q].length;for(D=2*Math.PI/P,j=.5*Math.tan(D/2),e=.5,a=0;a<P;a++)K.push(R.vertex[R.face[Q][a]][0]*m,R.vertex[R.face[Q][a]][1]*w,R.vertex[R.face[Q][a]][2]*d),c.push(l),l++,T=i[Q].x+(i[Q].z-i[Q].x)*(.5+j),U=i[Q].y+(i[Q].w-i[Q].y)*(e-.5),O.push(T,o.d?1-U:U),s=j*Math.cos(D)-e*Math.sin(D),e=j*Math.sin(D)+e*Math.cos(D),j=s,u&&n.push(u[Q].r,u[Q].g,u[Q].b,u[Q].a);for(a=0;a<P-2;a++)M.push(c[0+v],c[a+2+v],c[a+1+v]);v+=P}else{for(a=0;a<R.vertex.length;a++)K.push(R.vertex[a][0]*m,R.vertex[a][1]*w,R.vertex[a][2]*d),O.push(0,o.d?1:0);for(Q=0;Q<y;Q++)for(a=0;a<R.face[Q].length-2;a++)M.push(R.face[Q][0],R.face[Q][a+2],R.face[Q][a+1])}L.c.ComputeNormals(K,M,V),L.c._ComputeSides(S,K,M,V,O,P.frontUVs,P.backUVs);const J=new L.c;return J.TP=K,J.indices=M,J.UP=V,J.jP=O,u&&g&&(J.DP=n),J}function x(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return X(f).sP(C,f.updatable),C}q.c.CreateTube=(P,f,Y,C,q,m,L,o,w,d)=>I(P,{path:f,radius:Y,tessellation:C,radiusFunction:q,arc:1,cap:m,updatable:o,sideOrientation:w,instance:d},L);function k(P){const f=P.sideOrientation||L.c.DEFAULTSIDE,Y=P.radius||1,q=void 0===P.flat||P.flat,m=0|(P.subdivisions||4),w=P.radiusX||Y,d=P.radiusY||Y,R=P.radiusZ||Y,y=(1+Math.sqrt(5))/2,r=[-1,y,-0,1,y,0,-1,-y,0,1,-y,0,0,-1,-y,0,1,-y,0,-1,y,0,1,y,y,0,1,y,0,-1,-y,0,1,-y,0,-1],i=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],u=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],g=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],S=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],K=[],M=[],V=[],O=[];let n=0;const l=new Array(3),v=new Array(3);let c;for(c=0;c<3;c++)l[c]=C.Of.Zero(),v[c]=C.Vector2.Zero();for(let L=0;L<20;L++){for(c=0;c<3;c++){const P=i[3*L+c];l[c].do(r[3*u[P]],r[3*u[P]+1],r[3*u[P]+2]),l[c].normalize(),v[c].do(.134765625*g[2*P]+.05859375+-.0390625*S[L],.2333984375*g[2*P+1]+.025390625+.01953125*S[L])}const P=(P,f,Y,L)=>{const y=C.Of.Lerp(l[0],l[2],f/m),r=C.Of.Lerp(l[1],l[2],f/m),i=m===f?l[2]:C.Of.Lerp(y,r,P/(m-f));let u;if(i.normalize(),q){const P=C.Of.Lerp(l[0],l[2],L/m),f=C.Of.Lerp(l[1],l[2],L/m);u=C.Of.Lerp(P,f,Y/(m-L))}else u=new C.Of(i.x,i.y,i.z);u.x/=w,u.y/=d,u.z/=R,u.normalize();const g=C.Vector2.Lerp(v[0],v[2],f/m),S=C.Vector2.Lerp(v[1],v[2],f/m),c=m===f?v[2]:C.Vector2.Lerp(g,S,P/(m-f));M.push(i.x*w,i.y*d,i.z*R),V.push(u.x,u.y,u.z),O.push(c.x,o.d?1-c.y:c.y),K.push(n),n++};for(let f=0;f<m;f++)for(let Y=0;Y+f<m;Y++)P(Y,f,Y+1/3,f+1/3),P(Y+1,f,Y+1/3,f+1/3),P(Y,f+1,Y+1/3,f+1/3),Y+f+1<m&&(P(Y+1,f,Y+2/3,f+2/3),P(Y+1,f+1,Y+2/3,f+2/3),P(Y,f+1,Y+2/3,f+2/3))}L.c._ComputeSides(f,M,K,V,O,P.frontUVs,P.backUVs);const T=new L.c;return T.indices=K,T.TP=M,T.UP=V,T.jP=O,T}function Z(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new q.c(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),C._originalBuilderSideOrientation=f.sideOrientation;return k(f).sP(C,f.updatable),C}L.c.CreatePolyhedron=X,q.c.CreatePolyhedron=(P,f,Y)=>x(P,f,Y);L.c.CreateIcoSphere=k,q.c.CreateIcoSphere=(P,f,Y)=>Z(P,f,Y);var A=Y(11198);const E=new C.Of(1,0,0),t=new C.Of(-1,0,0),G=new C.Of(0,1,0),z=new C.Of(0,-1,0),B=new C.Of(0,0,1),b=new C.Of(0,0,-1);class H{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.Of.Zero(),f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.Of.Up(),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.Vector2.Zero(),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,w=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=P,this.normal=f,this.uv=Y,this.vertexIdx=q,this.vertexIdxForBones=m,this.localPositionOverride=L,this.localNormalOverride=o,this.matrixIndicesOverride=w,this.matrixWeightsOverride=d}clone(){var P,f,Y,C;return new H(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(P=this.localPositionOverride)||void 0===P?void 0:P.slice(),null===(f=this.localNormalOverride)||void 0===f?void 0:f.slice(),null===(Y=this.matrixIndicesOverride)||void 0===Y?void 0:Y.slice(),null===(C=this.matrixWeightsOverride)||void 0===C?void 0:C.slice())}}function W(P,f,Y){var w,d,R,y,r;const i=!!f.skeleton,u=!(null===(w=f.morphTargetManager)||void 0===w||!w.numTargets),g=Y.localMode||i,S=f.eq(),K=i||u?f.Uo(!0,!0):f.getVerticesData(m.d.PositionKind),M=i||u?f.getNormalsData(!0,!0):f.getVerticesData(m.d.NormalKind),V=g?i?f.getVerticesData(m.d.PositionKind):K:null,O=g?i?f.getVerticesData(m.d.NormalKind):M:null,n=f.getVerticesData(m.d.UVKind),l=i?f.getVerticesData(m.d.MatricesIndicesKind):null,v=i?f.getVerticesData(m.d.MatricesWeightsKind):null,c=i?f.getVerticesData(m.d.MatricesIndicesExtraKind):null,T=i?f.getVerticesData(m.d.MatricesWeightsExtraKind):null,U=Y.position||C.Of.Zero();let D=Y.normal||C.Of.Up();const j=Y.size||C.Of.One(),e=Y.angle||0;if(!D){const P=new C.Of(0,0,1),Y=f.vP().activeCamera,q=C.Of.TransformCoordinates(P,Y.getWorldMatrix());D=Y.globalPosition.nf(q)}const s=-Math.atan2(D.z,D.x)-Math.PI/2,a=Math.sqrt(D.x*D.x+D.z*D.z),Q=Math.atan2(D.y,a),J=new L.c;J.indices=[],J.TP=[],J.UP=[],J.jP=[],J.matricesIndices=i?[]:null,J.matricesWeights=i?[]:null,J.matricesIndicesExtra=c?[]:null,J.matricesWeightsExtra=T?[]:null;let N=0;const I=(P,f)=>{const q=new H;if(!S||!K||!M)return q;const m=S[P];if(q.vertexIdx=3*m,q.vertexIdxForBones=4*m,q.position=new C.Of(K[3*m],K[3*m+1],K[3*m+2]),C.Of.TransformCoordinatesToRef(q.position,f,q.position),q.normal=new C.Of(M[3*m],M[3*m+1],M[3*m+2]),C.Of.TransformNormalToRef(q.normal,f,q.normal),Y.captureUVS&&n){const P=n[2*m+1];q.uv=new C.Vector2(n[2*m],o.d?1-P:P)}return q},X=[0,0,0,0],x=(P,f)=>{if(0===P.length)return P;const Y=.5*Math.abs(C.Of.Dot(j,f)),q=(P,f,Y,C)=>{for(let q=0;q<C;++q)if(P[Y+q]===f)return Y+q;return-1},m=(P,m)=>{const L=C.Of.GetClipFactor(P.position,m.position,f,Y);let o=X,w=X;if(l&&v){const f=P.matrixIndicesOverride?0:P.vertexIdxForBones,Y=P.matrixIndicesOverride??l,C=P.matrixWeightsOverride??v,d=m.matrixIndicesOverride?0:m.vertexIdxForBones,R=m.matrixIndicesOverride??l,y=m.matrixWeightsOverride??v;o=[0,0,0,0],w=[0,0,0,0];let r=0;for(let P=0;P<4;++P)if(C[f+P]>0){const m=q(R,Y[f+P],d,4);o[r]=Y[f+P],w[r]=(0,A.Lerp)(C[f+P],m>=0?y[m]:0,L),r++}for(let P=0;P<4&&r<4;++P){const C=R[d+P];-1===q(Y,C,f,4)&&(o[r]=C,w[r]=(0,A.Lerp)(0,y[d+P],L),r++)}const i=w[0]+w[1]+w[2]+w[3];w[0]/=i,w[1]/=i,w[2]/=i,w[3]/=i}const d=P.localPositionOverride?P.localPositionOverride[0]:(null===V||void 0===V?void 0:V[P.vertexIdx])??0,R=P.localPositionOverride?P.localPositionOverride[1]:(null===V||void 0===V?void 0:V[P.vertexIdx+1])??0,y=P.localPositionOverride?P.localPositionOverride[2]:(null===V||void 0===V?void 0:V[P.vertexIdx+2])??0,r=m.localPositionOverride?m.localPositionOverride[0]:(null===V||void 0===V?void 0:V[m.vertexIdx])??0,i=m.localPositionOverride?m.localPositionOverride[1]:(null===V||void 0===V?void 0:V[m.vertexIdx+1])??0,u=m.localPositionOverride?m.localPositionOverride[2]:(null===V||void 0===V?void 0:V[m.vertexIdx+2])??0,g=P.localNormalOverride?P.localNormalOverride[0]:(null===O||void 0===O?void 0:O[P.vertexIdx])??0,S=P.localNormalOverride?P.localNormalOverride[1]:(null===O||void 0===O?void 0:O[P.vertexIdx+1])??0,K=P.localNormalOverride?P.localNormalOverride[2]:(null===O||void 0===O?void 0:O[P.vertexIdx+2])??0,M=g+((m.localNormalOverride?m.localNormalOverride[0]:(null===O||void 0===O?void 0:O[m.vertexIdx])??0)-g)*L,n=S+((m.localNormalOverride?m.localNormalOverride[1]:(null===O||void 0===O?void 0:O[m.vertexIdx+1])??0)-S)*L,c=K+((m.localNormalOverride?m.localNormalOverride[2]:(null===O||void 0===O?void 0:O[m.vertexIdx+2])??0)-K)*L,T=Math.sqrt(M*M+n*n+c*c);return new H(C.Of.Lerp(P.position,m.position,L),C.Of.Lerp(P.normal,m.normal,L).normalize(),C.Vector2.Lerp(P.uv,m.uv,L),-1,-1,V?[d+(r-d)*L,R+(i-R)*L,y+(u-y)*L]:null,O?[M/T,n/T,c/T]:null,o,w)};let L=null;P.length>3&&(L=[]);for(let o=0;o<P.length;o+=3){let q=0,w=null,d=null,R=null,y=null;const r=C.Of.Dot(P[o].position,f)-Y>0,i=C.Of.Dot(P[o+1].position,f)-Y>0,u=C.Of.Dot(P[o+2].position,f)-Y>0;switch(q=(r?1:0)+(i?1:0)+(u?1:0),q){case 0:P.length>3?(L.push(P[o]),L.push(P[o+1]),L.push(P[o+2])):L=P;break;case 1:if(L=L??new Array,r&&(w=P[o+1],d=P[o+2],R=m(P[o],w),y=m(P[o],d)),i){w=P[o],d=P[o+2],R=m(P[o+1],w),y=m(P[o+1],d),L.push(R),L.push(d.clone()),L.push(w.clone()),L.push(d.clone()),L.push(R.clone()),L.push(y);break}u&&(w=P[o],d=P[o+1],R=m(P[o+2],w),y=m(P[o+2],d)),w&&d&&R&&y&&(L.push(w.clone()),L.push(d.clone()),L.push(R),L.push(y),L.push(R.clone()),L.push(d.clone()));break;case 2:L=L??new Array,r||(w=P[o].clone(),d=m(w,P[o+1]),R=m(w,P[o+2]),L.push(w),L.push(d),L.push(R)),i||(w=P[o+1].clone(),d=m(w,P[o+2]),R=m(w,P[o]),L.push(w),L.push(d),L.push(R)),u||(w=P[o+2].clone(),d=m(w,P[o]),R=m(w,P[o+1]),L.push(w),L.push(d),L.push(R))}}return L},k=f instanceof q.c?f:null,Z=null===k||void 0===k?void 0:k._thinInstanceDataStorage.matrixData,W=(null===k||void 0===k?void 0:k.uo)||1,p=C.TmpVectors.Matrix[0];p.q(C.Matrix.IdentityReadOnly);for(let q=0;q<W;++q){if(null!==k&&void 0!==k&&k.hasThinInstances&&Z){const P=16*q;p.setRowFromFloats(0,Z[P+0],Z[P+1],Z[P+2],Z[P+3]),p.setRowFromFloats(1,Z[P+4],Z[P+5],Z[P+6],Z[P+7]),p.setRowFromFloats(2,Z[P+8],Z[P+9],Z[P+10],Z[P+11]),p.setRowFromFloats(3,Z[P+12],Z[P+13],Z[P+14],Z[P+15])}const P=C.Matrix.RotationYawPitchRoll(s,Q,e).multiply(C.Matrix.Translation(U.x,U.y,U.z)),m=C.Matrix.Invert(P),L=f.getWorldMatrix(),w=p.multiply(L).multiply(m),d=new Array(3);for(let f=0;f<S.length;f+=3){let P=d;if(P[0]=I(f,w),P[1]=I(f+1,w),P[2]=I(f+2,w),!(Y.cullBackFaces&&-P[0].normal.z<=0&&-P[1].normal.z<=0&&-P[2].normal.z<=0)&&(P=x(P,E),P&&(P=x(P,t),P&&(P=x(P,G),P&&(P=x(P,z),P&&(P=x(P,B),P&&(P=x(P,b),P)))))))for(let f=0;f<P.length;f++){const C=P[f];if(J.indices.push(N),g?(C.localPositionOverride?(J.TP[3*N]=C.localPositionOverride[0],J.TP[3*N+1]=C.localPositionOverride[1],J.TP[3*N+2]=C.localPositionOverride[2]):V&&(J.TP[3*N]=V[C.vertexIdx],J.TP[3*N+1]=V[C.vertexIdx+1],J.TP[3*N+2]=V[C.vertexIdx+2]),C.localNormalOverride?(J.UP[3*N]=C.localNormalOverride[0],J.UP[3*N+1]=C.localNormalOverride[1],J.UP[3*N+2]=C.localNormalOverride[2]):O&&(J.UP[3*N]=O[C.vertexIdx],J.UP[3*N+1]=O[C.vertexIdx+1],J.UP[3*N+2]=O[C.vertexIdx+2])):(C.position.toArray(J.TP,3*N),C.normal.toArray(J.UP,3*N)),J.matricesIndices&&J.matricesWeights&&(C.matrixIndicesOverride?(J.matricesIndices[4*N]=C.matrixIndicesOverride[0],J.matricesIndices[4*N+1]=C.matrixIndicesOverride[1],J.matricesIndices[4*N+2]=C.matrixIndicesOverride[2],J.matricesIndices[4*N+3]=C.matrixIndicesOverride[3]):(l&&(J.matricesIndices[4*N]=l[C.vertexIdxForBones],J.matricesIndices[4*N+1]=l[C.vertexIdxForBones+1],J.matricesIndices[4*N+2]=l[C.vertexIdxForBones+2],J.matricesIndices[4*N+3]=l[C.vertexIdxForBones+3]),c&&J.matricesIndicesExtra&&(J.matricesIndicesExtra[4*N]=c[C.vertexIdxForBones],J.matricesIndicesExtra[4*N+1]=c[C.vertexIdxForBones+1],J.matricesIndicesExtra[4*N+2]=c[C.vertexIdxForBones+2],J.matricesIndicesExtra[4*N+3]=c[C.vertexIdxForBones+3])),C.matrixWeightsOverride?(J.matricesWeights[4*N]=C.matrixWeightsOverride[0],J.matricesWeights[4*N+1]=C.matrixWeightsOverride[1],J.matricesWeights[4*N+2]=C.matrixWeightsOverride[2],J.matricesWeights[4*N+3]=C.matrixWeightsOverride[3]):(v&&(J.matricesWeights[4*N]=v[C.vertexIdxForBones],J.matricesWeights[4*N+1]=v[C.vertexIdxForBones+1],J.matricesWeights[4*N+2]=v[C.vertexIdxForBones+2],J.matricesWeights[4*N+3]=v[C.vertexIdxForBones+3]),T&&J.matricesWeightsExtra&&(J.matricesWeightsExtra[4*N]=T[C.vertexIdxForBones],J.matricesWeightsExtra[4*N+1]=T[C.vertexIdxForBones+1],J.matricesWeightsExtra[4*N+2]=T[C.vertexIdxForBones+2],J.matricesWeightsExtra[4*N+3]=T[C.vertexIdxForBones+3]))),Y.captureUVS)C.uv.toArray(J.jP,2*N);else{J.jP.push(.5+C.position.x/j.x);const P=.5+C.position.y/j.y;J.jP.push(o.d?1-P:P)}N++}}}0===J.indices.length&&(J.indices=null),0===J.TP.length&&(J.TP=null),0===J.UP.length&&(J.UP=null),0===J.jP.length&&(J.jP=null),0===(null===(d=J.matricesIndices)||void 0===d?void 0:d.length)&&(J.matricesIndices=null),0===(null===(R=J.matricesWeights)||void 0===R?void 0:R.length)&&(J.matricesWeights=null),0===(null===(y=J.matricesIndicesExtra)||void 0===y?void 0:y.length)&&(J.matricesIndicesExtra=null),0===(null===(r=J.matricesWeightsExtra)||void 0===r?void 0:r.length)&&(J.matricesWeightsExtra=null);const h=new q.c(P,f.vP());return J.sP(h),g?(h.skeleton=f.skeleton,h.parent=f):(h.position=U.clone(),h.rotation=new C.Of(Q,s,e)),h.XC(!0),h.refreshBoundingInfo(!0,!0),h}function p(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const f=0|Math.max(P.subdivisions?P.subdivisions:2,1),Y=0|Math.max(P.tessellation?P.tessellation:16,3),q=Math.max(P.height?P.height:1,0),m=Math.max(P.radius?P.radius:.25,0),w=0|Math.max(P.capSubdivisions?P.capSubdivisions:6,1),d=Y,R=f,y=Math.max(P.radiusTop?P.radiusTop:m,0),r=Math.max(P.radiusBottom?P.radiusBottom:m,0),i=q-(y+r),u=2*Math.PI,g=Math.max(P.topCapSubdivisions?P.topCapSubdivisions:w,1),S=Math.max(P.bottomCapSubdivisions?P.bottomCapSubdivisions:w,1),K=Math.acos((r-y)/q);let M=[];const V=[],O=[],n=[];let l=0;const v=[],c=.5*i,T=.5*Math.PI;let U,D;const j=C.Of.Zero(),e=C.Of.Zero(),s=Math.cos(K),a=Math.sin(K),Q=new C.Vector2(y*a,c+y*s).nf(new C.Vector2(r*a,r*s-c)).length(),J=y*K+Q+r*(T-K);let N=0;for(D=0;D<=g;D++){const P=[],f=T-K*(D/g);N+=y*K/g;const Y=Math.cos(f),C=Math.sin(f),q=Y*y;for(U=0;U<=d;U++){const f=U/d,m=f*u+0,L=Math.sin(m),w=Math.cos(m);e.x=q*L,e.y=c+C*y,e.z=q*w,V.push(e.x,e.y,e.z),j.set(Y*L,C,Y*w),O.push(j.x,j.y,j.z),n.push(f,o.d?N/J:1-N/J),P.push(l),l++}v.push(P)}const I=q-y-r+s*y-s*r,X=a*(r-y)/I;for(D=1;D<=R;D++){const P=[];N+=Q/R;const f=a*(D*(r-y)/R+y);for(U=0;U<=d;U++){const Y=U/d,C=Y*u+0,q=Math.sin(C),m=Math.cos(C);e.x=f*q,e.y=c+s*y-D*I/R,e.z=f*m,V.push(e.x,e.y,e.z),j.set(q,X,m).normalize(),O.push(j.x,j.y,j.z),n.push(Y,o.d?N/J:1-N/J),P.push(l),l++}v.push(P)}for(D=1;D<=S;D++){const P=[],f=T-K-(Math.PI-K)*(D/S);N+=r*K/S;const Y=Math.cos(f),C=Math.sin(f),q=Y*r;for(U=0;U<=d;U++){const f=U/d,m=f*u+0,L=Math.sin(m),w=Math.cos(m);e.x=q*L,e.y=C*r-c,e.z=q*w,V.push(e.x,e.y,e.z),j.set(Y*L,C,Y*w),O.push(j.x,j.y,j.z),n.push(f,o.d?N/J:1-N/J),P.push(l),l++}v.push(P)}for(U=0;U<d;U++)for(D=0;D<g+R+S;D++){const P=v[D][U],f=v[D+1][U],Y=v[D+1][U+1],C=v[D][U+1];M.push(P),M.push(f),M.push(C),M.push(f),M.push(Y),M.push(C)}if(M=M.reverse(),P.orientation&&!P.orientation.equals(C.Of.Up())){const f=new C.Matrix;P.orientation.clone().scale(.5*Math.PI).cross(C.Of.Up()).toQuaternion().toRotationMatrix(f);const Y=C.Of.Zero();for(let P=0;P<V.length;P+=3)Y.set(V[P],V[P+1],V[P+2]),C.Of.TransformCoordinatesToRef(Y.clone(),f,Y),V[P]=Y.x,V[P+1]=Y.y,V[P+2]=Y.z}const x=new L.c;return x.TP=V,x.UP=O,x.jP=n,x.indices=M,x}function h(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:C.Of.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=new q.c(P,Y);return p(f).sP(m,f.updatable),m}q.c.CreateDecal=(P,f,Y,C,q,m)=>W(P,f,{position:Y,normal:C,size:q,angle:m});q.c.CreateCapsule=(P,f,Y)=>h(P,f,Y),L.c.CreateCapsule=p;var F=Y(11025),PP=Y(11187);class fP{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=P,this.y=f,P!==Math.floor(P)&&(P=Math.floor(P),F.e.Warn("x is not an integer, floor(x) used")),f!==Math.floor(f)&&(f=Math.floor(f),F.e.Warn("y is not an integer, floor(y) used"))}clone(){return new fP(this.x,this.y)}rotate60About(P){const f=this.x;return this.x=P.x+P.y-this.y,this.y=f+this.y-P.x,this}rotateNeg60About(P){const f=this.x;return this.x=f+this.y-P.y,this.y=P.x+P.y-f,this}rotate120(P,f){P!==Math.floor(P)&&(P=Math.floor(P),F.e.Warn("m not an integer only floor(m) used")),f!==Math.floor(f)&&(f=Math.floor(f),F.e.Warn("n not an integer only floor(n) used"));const Y=this.x;return this.x=P-Y-this.y,this.y=f+Y,this}rotateNeg120(P,f){P!==Math.floor(P)&&(P=Math.floor(P),F.e.Warn("m is not an integer, floor(m) used")),f!==Math.floor(f)&&(f=Math.floor(f),F.e.Warn("n is not an integer,   floor(n) used"));const Y=this.x;return this.x=this.y-f,this.y=P+f-Y-this.y,this}toCartesianOrigin(P,f){const Y=C.Of.Zero();return Y.x=P.x+2*this.x*f+this.y*f,Y.y=P.y+Math.sqrt(3)*this.y*f,Y}static Zero(){return new fP(0,0)}}class YP{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new CP("icosahedron","Regular",[[0,PP.g,-1],[-PP.g,1,0],[-1,0,-PP.g],[1,0,-PP.g],[PP.g,1,0],[0,PP.g,1],[-1,0,PP.g],[-PP.g,-1,0],[0,-PP.g,-1],[PP.g,-1,0],[1,0,PP.g],[0,-PP.g,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let P=12;const f={},Y=this.m,C=this.n;let q,m,L,o,w,d=Y,R=1,y=0;0!==C&&(d=(0,A.HighestCommonFactor)(Y,C)),R=Y/d,y=C/d;const r=fP.Zero(),i=new fP(Y,C),u=new fP(-C,Y+C),g=fP.Zero(),S=fP.Zero(),K=fP.Zero();let M,V,O,n,l=[];const v=[],c=this.vertByDist,T=(Y,C,q,m)=>{M=Y+"|"+q,V=C+"|"+m,M in f||V in f?M in f&&!(V in f)?f[V]=f[M]:V in f&&!(M in f)&&(f[M]=f[V]):(f[M]=P,f[V]=P,P++),c[q][0]>2?v[f[M]]=[-c[q][0],c[q][1],f[M]]:v[f[M]]=[l[c[q][0]],c[q][1],f[M]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let U=0;U<20;U++){if(l=this.IDATA.face[U],L=l[2],o=l[1],w=l[0],O=r.x+"|"+r.y,M=U+"|"+O,M in f||(f[M]=L,v[L]=[l[c[O][0]],c[O][1]]),O=i.x+"|"+i.y,M=U+"|"+O,M in f||(f[M]=o,v[o]=[l[c[O][0]],c[O][1]]),O=u.x+"|"+u.y,M=U+"|"+O,M in f||(f[M]=w,v[w]=[l[c[O][0]],c[O][1]]),q=this.IDATA.edgematch[U][0],m=this.IDATA.edgematch[U][1],"B"===m)for(let P=1;P<d;P++)S.x=Y-P*(R+y),S.y=C+P*R,K.x=-P*y,K.y=P*(R+y),O=S.x+"|"+S.y,n=K.x+"|"+K.y,T(U,q,O,n);if("O"===m)for(let P=1;P<d;P++)K.x=-P*y,K.y=P*(R+y),g.x=P*R,g.y=P*y,O=K.x+"|"+K.y,n=g.x+"|"+g.y,T(U,q,O,n);if(q=this.IDATA.edgematch[U][2],m=this.IDATA.edgematch[U][3],m&&"A"===m)for(let P=1;P<d;P++)g.x=P*R,g.y=P*y,S.x=Y-(d-P)*(R+y),S.y=C+(d-P)*R,O=g.x+"|"+g.y,n=S.x+"|"+S.y,T(U,q,O,n);for(let Y=0;Y<this.vertices.length;Y++)O=this.vertices[Y].x+"|"+this.vertices[Y].y,M=U+"|"+O,M in f||(f[M]=P++,c[O][0]>2?v[f[M]]=[-c[O][0],c[O][1],f[M]]:v[f[M]]=[l[c[O][0]],c[O][1],f[M]])}this.closestTo=v,this.vecToidx=f}calcCoeffs(){const P=this.m,f=this.n,Y=Math.sqrt(3)/3,C=P*P+f*f+P*f;this.coau=(P+f)/C,this.cobu=-f/C,this.coav=-Y*(P-f)/C,this.cobv=Y*(2*P+f)/C}createInnerFacets(){const P=this.m,f=this.n;for(let Y=0;Y<f+P+1;Y++)for(let P=this.min[Y];P<this.max[Y]+1;P++)P<this.max[Y]&&P<this.max[Y+1]+1&&this.innerFacets.push(["|"+P+"|"+Y,"|"+P+"|"+(Y+1),"|"+(P+1)+"|"+Y]),Y>0&&P<this.max[Y-1]&&P+1<this.max[Y]+1&&this.innerFacets.push(["|"+P+"|"+Y,"|"+(P+1)+"|"+Y,"|"+(P+1)+"|"+(Y-1)])}edgeVecsABOB(){const P=this.m,f=this.n,Y=new fP(-f,P+f);for(let C=1;C<P+f;C++){const P=new fP(this.min[C],C),f=new fP(this.min[C-1],C-1),q=new fP(this.min[C+1],C+1),m=P.clone(),L=f.clone(),o=q.clone();m.rotate60About(Y),L.rotate60About(Y),o.rotate60About(Y);const w=new fP(this.max[m.y],m.y),d=new fP(this.max[m.y-1],m.y-1),R=new fP(this.max[m.y-1]-1,m.y-1);m.x===w.x&&m.y===w.y||(m.x!==d.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([P,d,R]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([P,R,w])):m.y===o.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([P,f,d]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([P,d,q])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([P,f,d]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([P,d,w])))}}mapABOBtoOBOA(){const P=new fP(0,0);for(let f=0;f<this.isoVecsABOB.length;f++){const Y=[];for(let C=0;C<3;C++)P.x=this.isoVecsABOB[f][C].x,P.y=this.isoVecsABOB[f][C].y,0===this.vertexTypes[f][C]&&P.rotateNeg120(this.m,this.n),Y.push(P.clone());this.isoVecsOBOA.push(Y)}}mapABOBtoBAOA(){const P=new fP(0,0);for(let f=0;f<this.isoVecsABOB.length;f++){const Y=[];for(let C=0;C<3;C++)P.x=this.isoVecsABOB[f][C].x,P.y=this.isoVecsABOB[f][C].y,1===this.vertexTypes[f][C]&&P.rotate120(this.m,this.n),Y.push(P.clone());this.isoVecsBAOA.push(Y)}}MapToFace(P,f){const Y=this.IDATA.face[P],q=Y[2],m=Y[1],L=Y[0],o=C.Of.ef(this.IDATA.vertex[q]),w=C.Of.ef(this.IDATA.vertex[m]),d=C.Of.ef(this.IDATA.vertex[L]),R=w.nf(o),y=d.nf(o),r=R.scale(this.coau).add(y.scale(this.cobu)),i=R.scale(this.coav).add(y.scale(this.cobv)),u=[];let g,S=C.TmpVectors.Of[0];for(let C=0;C<this.cartesian.length;C++)S=r.scale(this.cartesian[C].x).add(i.scale(this.cartesian[C].y)).add(o),u[C]=[S.x,S.y,S.z],g=P+"|"+this.vertices[C].x+"|"+this.vertices[C].y,f.vertex[this.vecToidx[g]]=[S.x,S.y,S.z]}build(P,f){const Y=[],C=fP.Zero(),q=new fP(P,f),m=new fP(-f,P+f);Y.push(C,q,m);for(let O=f;O<P+1;O++)for(let f=0;f<P+1-O;f++)Y.push(new fP(f,O));if(f>0){const C=(0,A.HighestCommonFactor)(P,f),q=P/C,m=f/C;for(let o=1;o<C;o++)Y.push(new fP(o*q,o*m)),Y.push(new fP(-o*m,o*(q+m))),Y.push(new fP(P-o*(q+m),f+o*q));const L=P/f;for(let o=1;o<f;o++)for(let C=0;C<o*L;C++)Y.push(new fP(C,o)),Y.push(new fP(C,o).rotate120(P,f)),Y.push(new fP(C,o).rotateNeg120(P,f))}Y.sort(((P,f)=>P.x-f.x)),Y.sort(((P,f)=>P.y-f.y));const L=new Array(P+f+1),o=new Array(P+f+1);for(let O=0;O<L.length;O++)L[O]=1/0,o[O]=-1/0;let w=0,d=0;const R=Y.length;for(let O=0;O<R;O++)d=Y[O].x,w=Y[O].y,L[w]=Math.min(d,L[w]),o[w]=Math.max(d,o[w]);const y=(Y,C)=>{const q=Y.clone();return"A"===C&&q.rotateNeg120(P,f),"B"===C&&q.rotate120(P,f),q.x<0?q.y:q.x+q.y},r=[],i=[],u=[],g=[],S={},K=[];let M=-1,V=-1;for(let O=0;O<R;O++)r[O]=Y[O].toCartesianOrigin(new fP(0,0),.5),i[O]=y(Y[O],"O"),u[O]=y(Y[O],"A"),g[O]=y(Y[O],"B"),i[O]===u[O]&&u[O]===g[O]?(M=3,V=i[O]):i[O]===u[O]?(M=4,V=i[O]):u[O]===g[O]?(M=5,V=u[O]):g[O]===i[O]&&(M=6,V=i[O]),i[O]<u[O]&&i[O]<g[O]&&(M=2,V=i[O]),u[O]<i[O]&&u[O]<g[O]&&(M=1,V=u[O]),g[O]<u[O]&&g[O]<i[O]&&(M=0,V=g[O]),K.push([M,V,Y[O].x,Y[O].y]);K.sort(((P,f)=>P[2]-f[2])),K.sort(((P,f)=>P[3]-f[3])),K.sort(((P,f)=>P[1]-f[1])),K.sort(((P,f)=>P[0]-f[0]));for(let O=0;O<K.length;O++)S[K[O][2]+"|"+K[O][3]]=[K[O][0],K[O][1],O];return this.m=P,this.n=f,this.vertices=Y,this.vertByDist=S,this.cartesian=r,this.min=L,this.max=o,this}}class CP{constructor(P,f,Y,C){this.name=P,this.category=f,this.vertex=Y,this.face=C}}class qP extends CP{innerToData(P,f){for(let Y=0;Y<f.innerFacets.length;Y++)this.face.push(f.innerFacets[Y].map((Y=>f.vecToidx[P+Y])))}mapABOBtoDATA(P,f){const Y=f.IDATA.edgematch[P][0];for(let C=0;C<f.isoVecsABOB.length;C++){const q=[];for(let m=0;m<3;m++)0===f.vertexTypes[C][m]?q.push(P+"|"+f.isoVecsABOB[C][m].x+"|"+f.isoVecsABOB[C][m].y):q.push(Y+"|"+f.isoVecsABOB[C][m].x+"|"+f.isoVecsABOB[C][m].y);this.face.push([f.vecToidx[q[0]],f.vecToidx[q[1]],f.vecToidx[q[2]]])}}mapOBOAtoDATA(P,f){const Y=f.IDATA.edgematch[P][0];for(let C=0;C<f.isoVecsOBOA.length;C++){const q=[];for(let m=0;m<3;m++)1===f.vertexTypes[C][m]?q.push(P+"|"+f.isoVecsOBOA[C][m].x+"|"+f.isoVecsOBOA[C][m].y):q.push(Y+"|"+f.isoVecsOBOA[C][m].x+"|"+f.isoVecsOBOA[C][m].y);this.face.push([f.vecToidx[q[0]],f.vecToidx[q[1]],f.vecToidx[q[2]]])}}mapBAOAtoDATA(P,f){const Y=f.IDATA.edgematch[P][2];for(let C=0;C<f.isoVecsBAOA.length;C++){const q=[];for(let m=0;m<3;m++)1===f.vertexTypes[C][m]?q.push(P+"|"+f.isoVecsBAOA[C][m].x+"|"+f.isoVecsBAOA[C][m].y):q.push(Y+"|"+f.isoVecsBAOA[C][m].x+"|"+f.isoVecsBAOA[C][m].y);this.face.push([f.vecToidx[q[0]],f.vecToidx[q[1]],f.vecToidx[q[2]]])}}orderData(P){const f=[];for(let m=0;m<13;m++)f[m]=[];const Y=P.closestTo;for(let m=0;m<Y.length;m++)Y[m][0]>-1?Y[m][1]>0&&f[Y[m][0]].push([m,Y[m][1]]):f[12].push([m,Y[m][0]]);const C=[];for(let m=0;m<12;m++)C[m]=m;let q=12;for(let m=0;m<12;m++){f[m].sort(((P,f)=>P[1]-f[1]));for(let P=0;P<f[m].length;P++)C[f[m][P][0]]=q++}for(let m=0;m<f[12].length;m++)C[f[12][m][0]]=q++;for(let m=0;m<this.vertex.length;m++)this.vertex[m].push(C[m]);this.vertex.sort(((P,f)=>P[3]-f[3]));for(let m=0;m<this.vertex.length;m++)this.vertex[m].pop();for(let m=0;m<this.face.length;m++)for(let P=0;P<this.face[m].length;P++)this.face[m][P]=C[this.face[m][P]];this.sharedNodes=f[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(P,f){const Y=[],C=[];let q=f.pop();C.push(q);let m=this.face[q].indexOf(P);m=(m+2)%3;let L=this.face[q][m];Y.push(L);let o=0;for(;f.length>0;)q=f[o],this.face[q].indexOf(L)>-1?(m=(this.face[q].indexOf(L)+1)%3,L=this.face[q][m],Y.push(L),C.push(q),f.splice(o,1),o=0):o++;return this.adjacentFaces.push(Y),C}toGoldbergPolyhedronData(){const P=new CP("GeoDual","Goldberg",[],[]);P.name="GD dual";const f=this.vertex.length,Y=new Array(f);for(let w=0;w<f;w++)Y[w]=[];for(let w=0;w<this.face.length;w++)for(let P=0;P<3;P++)Y[this.face[w][P]].push(w);let C=0,q=0,m=0,L=[],o=[];this.adjacentFaces=[];for(let w=0;w<Y.length;w++){P.face[w]=this.setOrder(w,Y[w].concat([]));for(const f of Y[w]){C=0,q=0,m=0,L=this.face[f];for(let P=0;P<3;P++)o=this.vertex[L[P]],C+=o[0],q+=o[1],m+=o[2];P.vertex[f]=[C/3,q/3,m/3]}}return P}static BuildGeodesicData(P){const f=new qP("Geodesic-m-n","Geodesic",[[0,PP.g,-1],[-PP.g,1,0],[-1,0,-PP.g],[1,0,-PP.g],[PP.g,1,0],[0,PP.g,1],[-1,0,PP.g],[-PP.g,-1,0],[0,-PP.g,-1],[PP.g,-1,0],[1,0,PP.g],[0,-PP.g,1]],[]);P.setIndices(),P.calcCoeffs(),P.createInnerFacets(),P.edgeVecsABOB(),P.mapABOBtoOBOA(),P.mapABOBtoBAOA();for(let Y=0;Y<P.IDATA.face.length;Y++)P.MapToFace(Y,f),f.innerToData(Y,P),"B"===P.IDATA.edgematch[Y][1]&&f.mapABOBtoDATA(Y,P),"O"===P.IDATA.edgematch[Y][1]&&f.mapOBOAtoDATA(Y,P),"A"===P.IDATA.edgematch[Y][3]&&f.mapBAOAtoDATA(Y,P);f.orderData(P);return f.vertex=f.vertex.map((function(P){const f=P[0],Y=P[1],C=P[2],q=Math.sqrt(f*f+Y*Y+C*C);return P[0]*=1/q,P[1]*=1/q,P[2]*=1/q,P})),f}}q.c._GoldbergMeshParser=(P,f)=>mP.Parse(P,f);class mP extends q.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(P,f){return void 0===f?(P>this.goldbergData.nbUnsharedFaces-1&&(F.e.Warn("Maximum number of unshared faces used"),P=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+P):(P>11&&(F.e.Warn("Last pole used"),P=11),f>this.goldbergData.nbFacesAtPole-1&&(F.e.Warn("Maximum number of faces at a pole used"),f=this.goldbergData.nbFacesAtPole-1),12+P*this.goldbergData.nbFacesAtPole+f)}_changeGoldbergFaceColors(P){for(let Y=0;Y<P.length;Y++){const f=P[Y][0],C=P[Y][1],q=P[Y][2];for(let P=f;P<C+1;P++)this.goldbergData.faceColors[P]=q}const f=[];for(let Y=0;Y<12;Y++)for(let P=0;P<5;P++)f.push(this.goldbergData.faceColors[Y].r,this.goldbergData.faceColors[Y].g,this.goldbergData.faceColors[Y].b,this.goldbergData.faceColors[Y].a);for(let Y=12;Y<this.goldbergData.faceColors.length;Y++)for(let P=0;P<6;P++)f.push(this.goldbergData.faceColors[Y].r,this.goldbergData.faceColors[Y].g,this.goldbergData.faceColors[Y].b,this.goldbergData.faceColors[Y].a);return f}setGoldbergFaceColors(P){const f=this._changeGoldbergFaceColors(P);this.NP(m.d.ColorKind,f)}updateGoldbergFaceColors(P){const f=this._changeGoldbergFaceColors(P);this.updateVerticesData(m.d.ColorKind,f)}_changeGoldbergFaceUVs(P){const f=this.getVerticesData(m.d.UVKind);for(let Y=0;Y<P.length;Y++){const C=P[Y][0],q=P[Y][1],m=P[Y][2],L=P[Y][3],o=P[Y][4],w=[],d=[];let R,y;for(let P=0;P<5;P++)R=m.x+L*Math.cos(o+P*Math.PI/2.5),y=m.y+L*Math.sin(o+P*Math.PI/2.5),R<0&&(R=0),R>1&&(R=1),w.push(R,y);for(let P=0;P<6;P++)R=m.x+L*Math.cos(o+P*Math.PI/3),y=m.y+L*Math.sin(o+P*Math.PI/3),R<0&&(R=0),R>1&&(R=1),d.push(R,y);for(let P=C;P<Math.min(12,q+1);P++)for(let Y=0;Y<5;Y++)f[10*P+2*Y]=w[2*Y],f[10*P+2*Y+1]=w[2*Y+1];for(let P=Math.max(12,C);P<q+1;P++)for(let Y=0;Y<6;Y++)f[12*P-24+2*Y]=d[2*Y],f[12*P-23+2*Y]=d[2*Y+1]}return f}setGoldbergFaceUVs(P){const f=this._changeGoldbergFaceUVs(P);this.NP(m.d.UVKind,f)}updateGoldbergFaceUVs(P){const f=this._changeGoldbergFaceUVs(P);this.updateVerticesData(m.d.UVKind,f)}placeOnGoldbergFaceAt(P,f,Y){const q=C.Of.RotationFromAxis(this.goldbergData.faceXaxis[f],this.goldbergData.faceYaxis[f],this.goldbergData.faceZaxis[f]);P.rotation=q,P.position=this.goldbergData.faceCenters[f].add(this.goldbergData.faceXaxis[f].scale(Y.x)).add(this.goldbergData.faceYaxis[f].scale(Y.y)).add(this.goldbergData.faceZaxis[f].scale(Y.z))}serialize(P){super.serialize(P),P.type="GoldbergMesh";const f={};if(f.adjacentFaces=this.goldbergData.adjacentFaces,f.nbSharedFaces=this.goldbergData.nbSharedFaces,f.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,f.nbFaces=this.goldbergData.nbFaces,f.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){f.faceColors=[];for(const P of this.goldbergData.faceColors)f.faceColors.push(P.If())}if(this.goldbergData.faceCenters){f.faceCenters=[];for(const P of this.goldbergData.faceCenters)f.faceCenters.push(P.If())}if(this.goldbergData.faceZaxis){f.faceZaxis=[];for(const P of this.goldbergData.faceZaxis)f.faceZaxis.push(P.If())}if(this.goldbergData.faceYaxis){f.faceYaxis=[];for(const P of this.goldbergData.faceYaxis)f.faceYaxis.push(P.If())}if(this.goldbergData.faceXaxis){f.faceXaxis=[];for(const P of this.goldbergData.faceXaxis)f.faceXaxis.push(P.If())}P.goldbergData=f}static Parse(P,f){const Y=P.goldbergData;Y.faceColors=Y.faceColors.map((P=>r.ro.ef(P))),Y.faceCenters=Y.faceCenters.map((P=>C.Of.ef(P))),Y.faceZaxis=Y.faceZaxis.map((P=>C.Of.ef(P))),Y.faceXaxis=Y.faceXaxis.map((P=>C.Of.ef(P))),Y.faceYaxis=Y.faceYaxis.map((P=>C.Of.ef(P)));const q=new mP(P.name,f);return q.goldbergData=Y,q}}var LP=Y(11756);const oP={CreateBox:y.e,CreateTiledBox:S,CreateSphere:K.e,CreateDisc:R.c,CreateIcoSphere:Z,CreateRibbon:d,CreateCylinder:n,CreateTorus:v,CreateTorusKnot:T,CreateLineSystem:U.e,Yd:U.h,CreateDashedLines:U.b,ExtrudeShape:e,ExtrudeShapeCustom:s,CreateLathe:Q,CreateTiledPlane:u,qd:J.d,CreateGround:N.d,CreateTiledGround:N.g,CreateGroundFromHeightMap:N.c,CreatePolygon:D.e,ExtrudePolygon:D.i,CreateTube:I,CreatePolyhedron:x,CreateGeodesic:function(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=f.m||1;C!==Math.floor(C)&&(C=Math.floor(C),F.e.Warn("m not an integer only floor(m) used"));let q=f.n||0;if(q!==Math.floor(q)&&(q=Math.floor(q),F.e.Warn("n not an integer only floor(n) used")),q>C){const P=q;q=C,C=P,F.e.Warn("n > m therefore m and n swapped")}const m=new YP;return m.build(C,q),x(P,{custom:qP.BuildGeodesicData(m),size:f.size,sizeX:f.sizeX,sizeY:f.sizeY,sizeZ:f.sizeZ,faceUV:f.faceUV,faceColors:f.faceColors,flat:f.flat,updatable:f.updatable,sideOrientation:f.sideOrientation,frontUVs:f.frontUVs,backUVs:f.backUVs},Y)},CreateGoldberg:function(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const m=f.size,w=f.sizeX||m||1,d=f.sizeY||m||1,R=f.sizeZ||m||1;let y=f.m||1;y!==Math.floor(y)&&(y=Math.floor(y),F.e.Warn("m not an integer only floor(m) used"));let i=f.n||0;if(i!==Math.floor(i)&&(i=Math.floor(i),F.e.Warn("n not an integer only floor(n) used")),i>y){const P=i;i=y,y=P,F.e.Warn("n > m therefore m and n swapped")}const u=new YP;u.build(y,i);const g=qP.BuildGeodesicData(u),S=g.toGoldbergPolyhedronData(),K=new mP(P,Y);f.sideOrientation=q.c._GetDefaultSideOrientation(f.sideOrientation),K._originalBuilderSideOrientation=f.sideOrientation;(function(P,f){const Y=P.size,q=P.sizeX||Y||1,m=P.sizeY||Y||1,w=P.sizeZ||Y||1,d=0===P.sideOrientation?0:P.sideOrientation||L.c.DEFAULTSIDE,R=[],y=[],r=[],i=[];let u=1/0,g=-1/0,S=1/0,K=-1/0;for(let C=0;C<f.vertex.length;C++)u=Math.min(u,f.vertex[C][0]*q),g=Math.max(g,f.vertex[C][0]*q),S=Math.min(S,f.vertex[C][1]*m),K=Math.max(K,f.vertex[C][1]*m);let M=0;for(let L=0;L<f.face.length;L++){const P=f.face[L],Y=C.Of.ef(f.vertex[P[0]]),d=C.Of.ef(f.vertex[P[2]]),V=C.Of.ef(f.vertex[P[1]]),O=d.nf(Y),n=V.nf(Y),l=C.Of.Cross(n,O).normalize();for(let C=0;C<P.length;C++){r.push(l.x,l.y,l.z);const Y=f.vertex[P[C]];R.push(Y[0]*q,Y[1]*m,Y[2]*w);const L=(Y[1]*m-S)/(K-S);i.push((Y[0]*q-u)/(g-u),o.d?1-L:L)}for(let f=0;f<P.length-2;f++)y.push(M,M+f+2,M+f+1);M+=P.length}L.c._ComputeSides(d,R,y,r,i);const V=new L.c;return V.TP=R,V.indices=y,V.UP=r,V.jP=i,V})(f,S).sP(K,f.updatable),K.goldbergData.nbSharedFaces=g.sharedNodes,K.goldbergData.nbUnsharedFaces=g.poleNodes,K.goldbergData.adjacentFaces=g.adjacentFaces,K.goldbergData.nbFaces=K.goldbergData.nbSharedFaces+K.goldbergData.nbUnsharedFaces,K.goldbergData.nbFacesAtPole=(K.goldbergData.nbUnsharedFaces-12)/12;for(let q=0;q<g.vertex.length;q++)K.goldbergData.faceCenters.push(C.Of.ef(g.vertex[q])),K.goldbergData.faceCenters[q].x*=w,K.goldbergData.faceCenters[q].y*=d,K.goldbergData.faceCenters[q].z*=R,K.goldbergData.faceColors.push(new r.ro(1,1,1,1));for(let q=0;q<S.face.length;q++){const P=S.face[q],f=C.Of.ef(S.vertex[P[0]]),Y=C.Of.ef(S.vertex[P[2]]),m=C.Of.ef(S.vertex[P[1]]),L=Y.nf(f),o=m.nf(f),w=C.Of.Cross(o,L).normalize(),d=C.Of.Cross(o,w).normalize();K.goldbergData.faceXaxis.push(o.normalize()),K.goldbergData.faceYaxis.push(w),K.goldbergData.faceZaxis.push(d)}return K},CreateDecal:W,CreateCapsule:h,CreateText:LP.e}},12528:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>of});var C=Y(11179),q=Y(11583);class m extends q.c{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var L=Y(11228),o=(Y(11351),Y(11134));class w{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(P){this._targetStopDuration!==P&&(this._targetStopDuration=P)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(P){this._noiseTexture!==P&&(this._noiseTexture=P,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(P){this._animationSheetEnabled!==P&&(this._animationSheetEnabled=P)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(P){this._isAnimationSheetEnabled!=P&&(this._isAnimationSheetEnabled=P,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(P){this._useLogarithmicDepth=P&&this.vP().getEngine().getCaps().fragmentDepthSupported}vP(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(P){switch(P){case w.BLENDMODE_MULTIPLYADD:return;case w.BLENDMODE_ADD:P=1;break;case w.BLENDMODE_ONEONE:P=6;break;case w.BLENDMODE_STANDARD:P=2;break;case w.BLENDMODE_MULTIPLY:P=4;break;case w.BLENDMODE_SUBTRACT:P=3}this._engine.setAlphaMode(P)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:C.Of.Zero()}set direction1(P){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=P)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:C.Of.Zero()}set direction2(P){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=P)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:C.Of.Zero()}set minEmitBox(P){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=P)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:C.Of.Zero()}set maxEmitBox(P){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=P)}get billboardMode(){return this._billboardMode}set billboardMode(P){this._billboardMode!==P&&(this._billboardMode=P,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(P){this._isBillboardBased!==P&&(this._isBillboardBased=P,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(P){this._attachImageProcessingConfiguration(P)}_attachImageProcessingConfiguration(P){P!==this._imageProcessingConfiguration&&(!P&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=P)}_reset(){}_removeGradientAndTexture(P,f,Y){if(!f)return this;let C=0;for(const q of f){if(q.gradient===P){f.splice(C,1);break}C++}return Y&&Y.dispose(),this}constructor(P){this.animations=[],this.renderingGroupId=0,this.k=C.Of.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new C.Of(10,10,10),this.onAnimationEnd=null,this.blendMode=w.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new C.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.hw=new C.Of(0,0,0),this._useLogarithmicDepth=!1,this.gravity=C.Of.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new L.ro(1,1,1,1),this.color2=new L.ro(1,1,1,1),this.colorDead=new L.ro(0,0,0,1),this.textureMask=new L.ro(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new m,this.id=P,this.name=P}createPointEmitter(P,f){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new C.Of(0,1,0),arguments.length>2&&void 0!==arguments[2]||new C.Of(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new C.Of(0,1,0),arguments.length>4&&void 0!==arguments[4]||new C.Of(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new C.Of(0,1,0),arguments.length>3&&void 0!==arguments[3]||new C.Of(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(P,f,Y,C){throw new Error("Method not implemented.")}}w.BLENDMODE_ONEONE=0,w.BLENDMODE_STANDARD=1,w.BLENDMODE_ADD=2,w.BLENDMODE_MULTIPLY=3,w.BLENDMODE_MULTIPLYADD=4,w.BLENDMODE_SUBTRACT=-1,(0,o.d)("BABYLON.BaseParticleSystem",w);var d=Y(11198),R=Y(11031);class y{constructor(){this.direction1=new C.Of(0,1,0),this.direction2=new C.Of(0,1,0),this.minEmitBox=new C.Of(-.5,-.5,-.5),this.maxEmitBox=new C.Of(.5,.5,.5)}startDirectionFunction(P,f,Y,q){const m=(0,d.RandomRange)(this.direction1.x,this.direction2.x),L=(0,d.RandomRange)(this.direction1.y,this.direction2.y),o=(0,d.RandomRange)(this.direction1.z,this.direction2.z);if(q)return f.x=m,f.y=L,void(f.z=o);C.Of.TransformNormalFromFloatsToRef(m,L,o,P,f)}startPositionFunction(P,f,Y,q){const m=(0,d.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),L=(0,d.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),o=(0,d.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(q)return f.x=m,f.y=L,void(f.z=o);C.Of.TransformCoordinatesFromFloatsToRef(m,L,o,P,f)}clone(){const P=new y;return R.e.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2),P.setVector3("minEmitBox",this.minEmitBox),P.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3),P.addUniform("minEmitBox",3),P.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.direction1=this.direction1.If(),P.direction2=this.direction2.If(),P.minEmitBox=this.minEmitBox.If(),P.maxEmitBox=this.maxEmitBox.If(),P}parse(P){C.Of.FromArrayToRef(P.direction1,0,this.direction1),C.Of.FromArrayToRef(P.direction2,0,this.direction2),C.Of.FromArrayToRef(P.minEmitBox,0,this.minEmitBox),C.Of.FromArrayToRef(P.maxEmitBox,0,this.maxEmitBox)}}class r{get radius(){return this._radius}set radius(P){this._radius=P,this._buildHeight()}get angle(){return this._angle}set angle(P){this._angle=P,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Y,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=f,this.radius=P}startDirectionFunction(P,f,Y,q){q?C.TmpVectors.Of[0].q(Y.Xo).normalize():Y.position.subtractToRef(P.getTranslation(),C.TmpVectors.Of[0]).normalize();const m=(0,d.RandomRange)(0,this.directionRandomizer),L=(0,d.RandomRange)(0,this.directionRandomizer),o=(0,d.RandomRange)(0,this.directionRandomizer);f.x=C.TmpVectors.Of[0].x+m,f.y=C.TmpVectors.Of[0].y+L,f.z=C.TmpVectors.Of[0].z+o,f.normalize()}startPositionFunction(P,f,Y,q){const m=(0,d.RandomRange)(0,2*Math.PI);let L;this.emitFromSpawnPointOnly?L=1e-4:(L=(0,d.RandomRange)(0,this.heightRange),L=1-L*L);let o=this._radius-(0,d.RandomRange)(0,this._radius*this.radiusRange);o*=L;const w=o*Math.sin(m),R=o*Math.cos(m),y=L*this._height;if(q)return f.x=w,f.y=y,void(f.z=R);C.Of.TransformCoordinatesFromFloatsToRef(w,y,R,P,f)}clone(){const P=new r(this._radius,this._angle,this.directionRandomizer);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat2("radius",this._radius,this.radiusRange),P.setFloat("coneAngle",this._angle),P.setFloat2("height",this._height,this.heightRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",2),P.addUniform("coneAngle",1),P.addUniform("height",2),P.addUniform("directionRandomizer",1)}getEffectDefines(){let P="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(P+="\n#define CONEEMITTERSPAWNPOINT"),P}getClassName(){return"ConeParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this._radius,P.angle=this._angle,P.directionRandomizer=this.directionRandomizer,P.radiusRange=this.radiusRange,P.heightRange=this.heightRange,P.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,P}parse(P){this.radius=P.radius,this.angle=P.angle,this.directionRandomizer=P.directionRandomizer,this.radiusRange=void 0!==P.radiusRange?P.radiusRange:1,this.heightRange=void 0!==P.radiusRange?P.heightRange:1,this.emitFromSpawnPointOnly=void 0!==P.emitFromSpawnPointOnly&&P.emitFromSpawnPointOnly}}class i extends r{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0);super(P,f),this.direction1=Y,this.direction2=q}startDirectionFunction(P,f){const Y=(0,d.RandomRange)(this.direction1.x,this.direction2.x),q=(0,d.RandomRange)(this.direction1.y,this.direction2.y),m=(0,d.RandomRange)(this.direction1.z,this.direction2.z);C.Of.TransformNormalFromFloatsToRef(Y,q,m,P,f)}clone(){const P=new i(this.radius,this.angle,this.direction1,this.direction2);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.If(),P.direction2=this.direction2.If(),P}parse(P){super.parse(P),this.direction1.q(P.direction1),this.direction2.q(P.direction2)}}class u{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=P,this.height=f,this.radiusRange=Y,this.directionRandomizer=q,this._tempVector=C.Of.Zero()}startDirectionFunction(P,f,Y,q,m){Y.position.subtractToRef(P.getTranslation(),this._tempVector),this._tempVector.normalize(),C.Of.TransformNormalToRef(this._tempVector,m,this._tempVector);const L=(0,d.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let o=Math.atan2(this._tempVector.x,this._tempVector.z);o+=(0,d.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=L,this._tempVector.x=Math.sin(o),this._tempVector.z=Math.cos(o),this._tempVector.normalize(),q?f.q(this._tempVector):C.Of.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,P,f)}startPositionFunction(P,f,Y,q){const m=(0,d.RandomRange)(-this.height/2,this.height/2),L=(0,d.RandomRange)(0,2*Math.PI),o=(0,d.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),w=Math.sqrt(o)*this.radius,R=w*Math.cos(L),y=w*Math.sin(L);q?f.do(R,m,y):C.Of.TransformCoordinatesFromFloatsToRef(R,m,y,P,f)}clone(){const P=new u(this.radius,this.directionRandomizer);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("height",this.height),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("height",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.height=this.height,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.height=P.height,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class g extends u{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0),m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.Of(0,1,0);super(P,f,Y),this.direction1=q,this.direction2=m}startDirectionFunction(P,f,Y,q){const m=(0,d.RandomRange)(this.direction1.x,this.direction2.x),L=(0,d.RandomRange)(this.direction1.y,this.direction2.y),o=(0,d.RandomRange)(this.direction1.z,this.direction2.z);q?f.do(m,L,o):C.Of.TransformNormalFromFloatsToRef(m,L,o,P,f)}clone(){const P=new g(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("height",this.height),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("height",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.If(),P.direction2=this.direction2.If(),P}parse(P){super.parse(P),C.Of.FromArrayToRef(P.direction1,0,this.direction1),C.Of.FromArrayToRef(P.direction2,0,this.direction2)}}class S{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=P,this.radiusRange=f,this.directionRandomizer=Y}startDirectionFunction(P,f,Y,q){const m=Y.position.nf(P.getTranslation()).normalize(),L=(0,d.RandomRange)(0,this.directionRandomizer),o=(0,d.RandomRange)(0,this.directionRandomizer),w=(0,d.RandomRange)(0,this.directionRandomizer);m.x+=L,m.y+=o,m.z+=w,m.normalize(),q?f.q(m):C.Of.TransformNormalFromFloatsToRef(m.x,m.y,m.z,P,f)}startPositionFunction(P,f,Y,q){const m=this.radius-(0,d.RandomRange)(0,this.radius*this.radiusRange),L=(0,d.RandomRange)(0,1),o=(0,d.RandomRange)(0,2*Math.PI),w=Math.acos(2*L-1),R=m*Math.cos(o)*Math.sin(w),y=m*Math.cos(w),r=m*Math.sin(o)*Math.sin(w);q?f.do(R,Math.abs(y),r):C.Of.TransformCoordinatesFromFloatsToRef(R,Math.abs(y),r,P,f)}clone(){const P=new S(this.radius,this.directionRandomizer);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class K{constructor(){this.direction1=new C.Of(0,1,0),this.direction2=new C.Of(0,1,0)}startDirectionFunction(P,f,Y,q){const m=(0,d.RandomRange)(this.direction1.x,this.direction2.x),L=(0,d.RandomRange)(this.direction1.y,this.direction2.y),o=(0,d.RandomRange)(this.direction1.z,this.direction2.z);q?f.do(m,L,o):C.Of.TransformNormalFromFloatsToRef(m,L,o,P,f)}startPositionFunction(P,f,Y,q){q?f.do(0,0,0):C.Of.TransformCoordinatesFromFloatsToRef(0,0,0,P,f)}clone(){const P=new K;return R.e.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.direction1=this.direction1.If(),P.direction2=this.direction2.If(),P}parse(P){C.Of.FromArrayToRef(P.direction1,0,this.direction1),C.Of.FromArrayToRef(P.direction2,0,this.direction2)}}class M{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=P,this.radiusRange=f,this.directionRandomizer=Y}startDirectionFunction(P,f,Y,q){const m=Y.position.nf(P.getTranslation()).normalize(),L=(0,d.RandomRange)(0,this.directionRandomizer),o=(0,d.RandomRange)(0,this.directionRandomizer),w=(0,d.RandomRange)(0,this.directionRandomizer);m.x+=L,m.y+=o,m.z+=w,m.normalize(),q?f.q(m):C.Of.TransformNormalFromFloatsToRef(m.x,m.y,m.z,P,f)}startPositionFunction(P,f,Y,q){const m=this.radius-(0,d.RandomRange)(0,this.radius*this.radiusRange),L=(0,d.RandomRange)(0,1),o=(0,d.RandomRange)(0,2*Math.PI),w=Math.acos(2*L-1),R=m*Math.cos(o)*Math.sin(w),y=m*Math.cos(w),r=m*Math.sin(o)*Math.sin(w);q?f.do(R,y,r):C.Of.TransformCoordinatesFromFloatsToRef(R,y,r,P,f)}clone(){const P=new M(this.radius,this.directionRandomizer);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.radius=this.radius,P.radiusRange=this.radiusRange,P.directionRandomizer=this.directionRandomizer,P}parse(P){this.radius=P.radius,this.radiusRange=P.radiusRange,this.directionRandomizer=P.directionRandomizer}}class V extends M{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.Of(0,1,0),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0);super(P),this.direction1=f,this.direction2=Y}startDirectionFunction(P,f){const Y=(0,d.RandomRange)(this.direction1.x,this.direction2.x),q=(0,d.RandomRange)(this.direction1.y,this.direction2.y),m=(0,d.RandomRange)(this.direction1.z,this.direction2.z);C.Of.TransformNormalFromFloatsToRef(Y,q,m,P,f)}clone(){const P=new V(this.radius,this.direction1,this.direction2);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setFloat("radius",this.radius),P.setFloat("radiusRange",this.radiusRange),P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("radius",1),P.addUniform("radiusRange",1),P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const P=super.serialize();return P.direction1=this.direction1.If(),P.direction2=this.direction2.If(),P}parse(P){super.parse(P),this.direction1.q(P.direction1),this.direction2.q(P.direction2)}}class O{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(P,f,Y,q){const m=C.TmpVectors.Of[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,Y,m);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Y,m);const P=C.TmpVectors.Of[1];m.subtractToRef(Y.position,P),P.scaleToRef(1/Y.lifeTime,m)}else m.set(0,0,0);q?f.q(m):C.Of.TransformNormalToRef(m,P,f)}startPositionFunction(P,f,Y,q){const m=C.TmpVectors.Of[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Y,m):m.set(0,0,0),q?f.q(m):C.Of.TransformCoordinatesToRef(m,P,f)}clone(){const P=new O;return R.e.DeepCopy(this,P),P}applyToShader(P){}buildUniformLayout(P){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const P={};return P.type=this.getClassName(),P.particlePositionGenerator=this.particlePositionGenerator,P.particleDestinationGenerator=this.particleDestinationGenerator,P}parse(P){P.particlePositionGenerator&&(this.particlePositionGenerator=P.particlePositionGenerator),P.particleDestinationGenerator&&(this.particleDestinationGenerator=P.particleDestinationGenerator)}}var n=Y(11255);class l{get mesh(){return this._mesh}set mesh(P){this._mesh!==P&&(this._mesh=P,P?(this._indices=P.eq(),this._positions=P.getVerticesData(n.d.PositionKind),this._normals=P.getVerticesData(n.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=C.Of.Zero(),this._mesh=null,this.direction1=new C.Of(0,1,0),this.direction2=new C.Of(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=P}startDirectionFunction(P,f,Y,q){if(this.useMeshNormalsForDirection&&this._normals)return void C.Of.TransformNormalToRef(this._storedNormal,P,f);const m=(0,d.RandomRange)(this.direction1.x,this.direction2.x),L=(0,d.RandomRange)(this.direction1.y,this.direction2.y),o=(0,d.RandomRange)(this.direction1.z,this.direction2.z);q?f.do(m,L,o):C.Of.TransformNormalFromFloatsToRef(m,L,o,P,f)}startPositionFunction(P,f,Y,q){if(!this._indices||!this._positions)return;const m=3*(Math.random()*(this._indices.length/3)|0),L=Math.random(),o=Math.random()*(1-L),w=1-L-o,d=this._indices[m],R=this._indices[m+1],y=this._indices[m+2],r=C.TmpVectors.Of[0],i=C.TmpVectors.Of[1],u=C.TmpVectors.Of[2],g=C.TmpVectors.Of[3];C.Of.FromArrayToRef(this._positions,3*d,r),C.Of.FromArrayToRef(this._positions,3*R,i),C.Of.FromArrayToRef(this._positions,3*y,u),g.x=L*r.x+o*i.x+w*u.x,g.y=L*r.y+o*i.y+w*u.y,g.z=L*r.z+o*i.z+w*u.z,q?f.do(g.x,g.y,g.z):C.Of.TransformCoordinatesFromFloatsToRef(g.x,g.y,g.z,P,f),this.useMeshNormalsForDirection&&this._normals&&(C.Of.FromArrayToRef(this._normals,3*d,r),C.Of.FromArrayToRef(this._normals,3*R,i),C.Of.FromArrayToRef(this._normals,3*y,u),this._storedNormal.x=L*r.x+o*i.x+w*u.x,this._storedNormal.y=L*r.y+o*i.y+w*u.y,this._storedNormal.z=L*r.z+o*i.z+w*u.z)}clone(){const P=new l(this.mesh);return R.e.DeepCopy(this,P),P}applyToShader(P){P.setVector3("direction1",this.direction1),P.setVector3("direction2",this.direction2)}buildUniformLayout(P){P.addUniform("direction1",3),P.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var P;const f={};return f.type=this.getClassName(),f.direction1=this.direction1.If(),f.direction2=this.direction2.If(),f.meshId=null===(P=this.mesh)||void 0===P?void 0:P.id,f.useMeshNormalsForDirection=this.useMeshNormalsForDirection,f}parse(P,f){C.Of.FromArrayToRef(P.direction1,0,this.direction1),C.Of.FromArrayToRef(P.direction2,0,this.direction2),P.meshId&&f&&(this.mesh=f.getLastMeshById(P.meshId)),this.useMeshNormalsForDirection=P.useMeshNormalsForDirection}}class v{_isUbo(P){return void 0!==P.addUniform}constructor(P){this._isUbo(P)?(this.setMatrix3x3=P.updateMatrix3x3.bind(P),this.setMatrix2x2=P.updateMatrix2x2.bind(P),this.setFloat=P.updateFloat.bind(P),this.setFloat2=P.updateFloat2.bind(P),this.setFloat3=P.updateFloat3.bind(P),this.setFloat4=P.updateFloat4.bind(P),this.setFloatArray=P.updateFloatArray.bind(P),this.setArray=P.updateArray.bind(P),this.setIntArray=P.updateIntArray.bind(P),this.setMatrix=P.bf.bind(P),this.setMatrices=P.updateMatrices.bind(P),this.setVector3=P.updateVector3.bind(P),this.setVector4=P.updateVector4.bind(P),this.setColor3=P.updateColor3.bind(P),this.setColor4=P.updateColor4.bind(P),this.setDirectColor4=P.updateDirectColor4.bind(P),this.setInt=P.updateInt.bind(P),this.setInt2=P.updateInt2.bind(P),this.setInt3=P.updateInt3.bind(P),this.setInt4=P.updateInt4.bind(P)):(this.setMatrix3x3=P.setMatrix3x3.bind(P),this.setMatrix2x2=P.setMatrix2x2.bind(P),this.setFloat=P.setFloat.bind(P),this.setFloat2=P.setFloat2.bind(P),this.setFloat3=P.setFloat3.bind(P),this.setFloat4=P.setFloat4.bind(P),this.setFloatArray=P.setFloatArray.bind(P),this.setArray=P.setArray.bind(P),this.setIntArray=P.setIntArray.bind(P),this.setMatrix=P.setMatrix.bind(P),this.setMatrices=P.setMatrices.bind(P),this.setVector3=P.setVector3.bind(P),this.setVector4=P.setVector4.bind(P),this.setColor3=P.setColor3.bind(P),this.setColor4=P.setColor4.bind(P),this.setDirectColor4=P.setDirectColor4.bind(P),this.setInt=P.setInt.bind(P),this.setInt2=P.setInt2.bind(P),this.setInt3=P.setInt3.bind(P),this.setInt4=P.setInt4.bind(P))}}var c=Y(11101);const T="gpuUpdateParticlesPixelShader",U="#version 300 es\nvoid main() {discard;}\n";c.e.ShadersStore[T]||(c.e.ShadersStore[T]=U);const D="gpuUpdateParticlesVertexShader",j="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";c.e.ShadersStore[D]||(c.e.ShadersStore[D]=j);(0,o.d)("BABYLON.WebGL2ParticleSystem",class{constructor(P,f){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=P,this._engine=f,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var P;return(null===(P=this._updateEffect)||void 0===P?void 0:P.isReady())??!1}createUpdateBuffer(P){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof O&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=P,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new v(this._updateEffect)}createVertexBuffers(P,f){this._updateVAO.push(this._createUpdateVAO(P)),this._renderVAO.push(this._engine.recordVertexArrayObject(f,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=f}createParticleBuffer(P){return P}bindDrawBuffers(P,f,Y){Y?this._engine.bindBuffers(this._renderVertexBuffers,Y,f):this._engine.bindVertexArrayObject(this._renderVAO[P],null)}preUpdateParticleBuffer(){const P=this._engine;if(this._engine.enableEffect(this._updateEffect),!P.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(P,f,Y){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[P],null);const C=this._engine;C.bindTransformFeedbackBuffer(f.getBuffer()),C.setRasterizerState(!1),C.beginTransformFeedback(!0),C.drawArraysType(3,0,Y),C.endTransformFeedback(),C.setRasterizerState(!0),C.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let P=0;P<this._updateVAO.length;P++)this._engine.releaseVertexArrayObject(this._updateVAO[P]);this._updateVAO.length=0;for(let P=0;P<this._renderVAO.length;P++)this._engine.releaseVertexArrayObject(this._renderVAO[P]);this._renderVAO.length=0}_createUpdateVAO(P){const f={};f.position=P.createVertexBuffer("position",0,3);let Y=3;f.age=P.createVertexBuffer("age",Y,1),Y+=1,f.size=P.createVertexBuffer("size",Y,3),Y+=3,f.life=P.createVertexBuffer("life",Y,1),Y+=1,f.seed=P.createVertexBuffer("seed",Y,4),Y+=4,f.direction=P.createVertexBuffer("direction",Y,3),Y+=3,this._parent.particleEmitterType instanceof O&&(f.initialPosition=P.createVertexBuffer("initialPosition",Y,3),Y+=3),this._parent._colorGradientsTexture||(f.color=P.createVertexBuffer("color",Y,4),Y+=4),this._parent._isBillboardBased||(f.initialDirection=P.createVertexBuffer("initialDirection",Y,3),Y+=3),this._parent.noiseTexture&&(f.noiseCoordinates1=P.createVertexBuffer("noiseCoordinates1",Y,3),Y+=3,f.noiseCoordinates2=P.createVertexBuffer("noiseCoordinates2",Y,3),Y+=3),this._parent._angularSpeedGradientsTexture?(f.angle=P.createVertexBuffer("angle",Y,1),Y+=1):(f.angle=P.createVertexBuffer("angle",Y,2),Y+=2),this._parent._isAnimationSheetEnabled&&(f.cellIndex=P.createVertexBuffer("cellIndex",Y,1),Y+=1,this._parent.spriteRandomStartCell&&(f.cellStartOffset=P.createVertexBuffer("cellStartOffset",Y,1),Y+=1));const C=this._engine.recordVertexArrayObject(f,null,this._updateEffect);return this._engine.bindArrayBuffer(null),C}});class e{constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,C=arguments.length>3?arguments[3]:void 0;this._engine=P,this._label=C,this._engine._storageBuffers.push(this),this._create(f,Y)}_create(P,f){this._bufferSize=P,this._creationFlags=f,this._buffer=this._engine.createStorageBuffer(P,f,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(P,f,Y){this._buffer&&this._engine.updateStorageBuffer(this._buffer,P,f,Y)}async read(P,f,Y,C){return await this._engine.readFromStorageBuffer(this._buffer,P,f,Y,C)}dispose(){const P=this._engine._storageBuffers,f=P.indexOf(this);-1!==f&&(P[f]=P[P.length-1],P.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var s=Y(11165),a=Y(11170),Q=Y(11216),J=Y(11160),N=Y(11501),I=Y(11025),X=Y(11125),x=Y(11410);class k{constructor(){this._gpuTimeInFrameId=-1,this.counter=new x.b}_addDuration(P,f){P<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==P?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(f,!1),this._gpuTimeInFrameId=P):this.counter.addCount(f,!1))}}var Z=Y(11087);class A{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=P,this._engine=f,this.uniqueId=N.b.UniqueId,f.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new k),this._engine.getCaps().supportComputeShaders?C.bindingsMapping?(this._context=f.createComputeContext(),this._shaderPath=Y,this._options={bindingsMapping:{},defines:[],...C}):I.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):I.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(P,f){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const C=this._bindings[P];this._bindings[P]={type:Y?0:4,object:f,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!C||C.object!==f||C.type!==this._bindings[P].type)}setStorageTexture(P,f){const Y=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==f),this._bindings[P]={type:1,object:f,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setExternalTexture(P,f){const Y=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==f),this._bindings[P]={type:6,object:f,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setVideoTexture(P,f){return!!f.externalTexture&&(this.setExternalTexture(P,f.externalTexture),!0)}setUniformBuffer(P,f){const Y=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==f),this._bindings[P]={type:A._BufferIsDataBuffer(f)?7:2,object:f,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setStorageBuffer(P,f){const Y=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!Y||Y.object!==f),this._bindings[P]={type:A._BufferIsDataBuffer(f)?7:3,object:f,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}setTextureSampler(P,f){const Y=this._bindings[P];this._contextIsDirty||(this._contextIsDirty=!Y||!f.compareSampler(Y.object)),this._bindings[P]={type:5,object:f,indexInGroupEntries:null===Y||void 0===Y?void 0:Y.indexInGroupEntries}}isReady(){let P=this._effect;for(const q in this._bindings){const P=this._bindings[q],f=P.type,Y=P.object;switch(f){case 0:case 4:case 1:if(!Y.isReady())return!1;break;case 6:if(!Y.isReady())return!1;break}}const f=[],Y=this._shaderPath;if(this._options.defines)for(let q=0;q<this._options.defines.length;q++)f.push(this._options.defines[q]);const C=f.join("\n");return this._cachedDefines!==C&&(this._cachedDefines=C,P=this._engine.createComputeEffect(Y,{defines:C,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=P),!!P.isReady()}dispatch(P,f,Y){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,P,f,Y,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Y=A._BufferIsDataBuffer(P)?P:P.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Y,f,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const f in this._bindings){const Y=this._bindings[f];if(!this._options.bindingsMapping[f])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+f+"'");switch(Y.type){case 0:{const C=this._samplers[f],q=Y.object;var P;if(!C||!q._texture||!C.compareSampler(q._texture))this._samplers[f]=(new X.c).setParameters(q.wrapU,q.wrapV,q.wrapR,q.anisotropicFilteringLevel,q._texture.samplingMode,null===(P=q._texture)||void 0===P?void 0:P._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const P=Y.object;P.getBuffer()!==Y.buffer&&(Y.buffer=P.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((q=>{(0,Z.e)((()=>this.dispatch(P,f,Y)),q,void 0,C)}))}serialize(){const P=Q.e.Serialize(this);P.options=this._options,P.shaderPath=this._shaderPath,P.Kr={},P.textures={};for(const f in this._bindings){const Y=this._bindings[f],C=Y.object;switch(Y.type){case 0:case 4:case 1:{const q=C.serialize();q&&(P.textures[f]=q,P.Kr[f]={type:Y.type});break}}}return P}static Parse(P,f,Y){const C=Q.e.Parse((()=>new A(P.name,f.getEngine(),P.shaderPath,P.options)),P,f,Y);for(const q in P.textures){const m=P.Kr[q],L=J.c.Parse(P.textures[q],f,Y);0===m.type?C.setTexture(q,L):4===m.type?C.setTexture(q,L,!1):C.setStorageTexture(q,L)}return C}static _BufferIsDataBuffer(P){return void 0!==P.underlyingResource}}(0,s.b)([(0,a.F)()],A.prototype,"name",void 0),(0,s.b)([(0,a.F)()],A.prototype,"fastMode",void 0),(0,o.d)("BABYLON.ComputeShader",A);var E=Y(11455);const t="gpuUpdateParticlesComputeShader",G="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";c.e.ShadersStoreWGSL[t]||(c.e.ShadersStoreWGSL[t]=G);(0,o.d)("BABYLON.ComputeShaderParticleSystem",class{constructor(P,f){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=P,this._engine=f}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var P;return(null===(P=this._updateComputeShader)||void 0===P?void 0:P.isReady())??!1}createUpdateBuffer(P){var f;const Y={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Y.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Y.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Y.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Y.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Y.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Y.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(Y.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new A("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Y,defines:P.split("\n")}),null===(f=this._simParamsComputeShader)||void 0===f||f.dispose(),this._simParamsComputeShader=new E.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new v(this._simParamsComputeShader)}createVertexBuffers(P,f){this._renderVertexBuffers.push(f)}createParticleBuffer(P){const f=new e(this._engine,4*P.length,11,"ComputeShaderParticleSystemBuffer");return f.update(P),this._bufferComputeShader.push(f),f.getBuffer()}bindDrawBuffers(P,f,Y){this._engine.bindBuffers(this._renderVertexBuffers[P],Y,f)}preUpdateParticleBuffer(){}updateParticleBuffer(P,f,Y){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[P]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^P]),this._updateComputeShader.dispatch(Math.ceil(Y/64))}releaseBuffers(){var P;for(let f=0;f<this._bufferComputeShader.length;++f)this._bufferComputeShader[f].dispose();this._bufferComputeShader.length=0,null===(P=this._simParamsComputeShader)||void 0===P||P.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class z{constructor(P,f,Y){this.gradient=P,this.color1=f,this.color2=Y}getColorToRef(P){this.color2?L.ro.LerpToRef(this.color1,this.color2,Math.random(),P):P.q(this.color1)}}class B{constructor(P,f){this.gradient=P,this.color=f}}class b{constructor(P,f,Y){this.gradient=P,this.factor1=f,this.factor2=Y}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class H{static GetCurrentGradient(P,f,Y){if(f[0].gradient>P)return void Y(f[0],f[0],1);for(let q=0;q<f.length-1;q++){const C=f[q],m=f[q+1];if(P>=C.gradient&&P<=m.gradient){return void Y(C,m,(P-C.gradient)/(m.gradient-C.gradient))}}const C=f.length-1;Y(f[C],f[C],1)}}var W=Y(11018),p=Y(11671),h=Y(11052);class F{constructor(P){this.particleSystem=P,this.position=C.Of.Zero(),this.direction=C.Of.Zero(),this.color=new L.ro(0,0,0,0),this.colorStep=new L.ro(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new C.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new L.ro(0,0,0,0),this._currentColor2=new L.ro(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=F._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let P=this.age,f=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===f?(f=1,P=this._randomCellOffset):P+=this._randomCellOffset);const Y=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let C;C=this._initialSpriteCellLoop?(0,d.Clamp)(P*f%this.lifeTime/this.lifeTime):(0,d.Clamp)(P*f/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+C*Y|0}_inheritParticleInfoToSubEmitter(P){if(P.particleSystem.k.position){const f=P.particleSystem.k;if(f.position.q(this.position),P.inheritDirection){const P=C.TmpVectors.Of[0];this.direction.normalizeToRef(P),f.setDirection(P,0,Math.PI/2)}}else{P.particleSystem.k.q(this.position)}this.direction.scaleToRef(P.inheritedVelocityAmount/2,C.TmpVectors.Of[0]),P.particleSystem._inheritedVelocityOffset.q(C.TmpVectors.Of[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const P of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(P)}_reset(){this.age=0,this.id=F._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(P){P.position.q(this.position),this._initialDirection?P._initialDirection?P._initialDirection.q(this._initialDirection):P._initialDirection=this._initialDirection.clone():P._initialDirection=null,P.direction.q(this.direction),this.Xo&&(P.Xo?P.Xo.q(this.Xo):P.Xo=this.Xo.clone()),P.color.q(this.color),P.colorStep.q(this.colorStep),P.lifeTime=this.lifeTime,P.age=this.age,P._randomCellOffset=this._randomCellOffset,P.size=this.size,P.scale.q(this.scale),P.angle=this.angle,P.angularSpeed=this.angularSpeed,P.particleSystem=this.particleSystem,P.cellIndex=this.cellIndex,P.id=this.id,P._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(P._currentColorGradient=this._currentColorGradient,P._currentColor1.q(this._currentColor1),P._currentColor2.q(this._currentColor2)),this._currentSizeGradient&&(P._currentSizeGradient=this._currentSizeGradient,P._currentSize1=this._currentSize1,P._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(P._currentAngularSpeedGradient=this._currentAngularSpeedGradient,P._currentAngularSpeed1=this._currentAngularSpeed1,P._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(P._currentVelocityGradient=this._currentVelocityGradient,P._currentVelocity1=this._currentVelocity1,P._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(P._currentLimitVelocityGradient=this._currentLimitVelocityGradient,P._currentLimitVelocity1=this._currentLimitVelocity1,P._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(P._currentDragGradient=this._currentDragGradient,P._currentDrag1=this._currentDrag1,P._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(P._initialStartSpriteCellId=this._initialStartSpriteCellId,P._initialEndSpriteCellId=this._initialEndSpriteCellId,P._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(P.remapData&&this.remapData?P.remapData.q(this.remapData):P.remapData=new C.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(P._randomNoiseCoordinates1?(P._randomNoiseCoordinates1.q(this._randomNoiseCoordinates1),P._randomNoiseCoordinates2.q(this._randomNoiseCoordinates2)):(P._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),P._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}F._Count=0;var PP=Y(11304),fP=(Y(11348),Y(11561)),YP=Y(11555),CP=Y(11451);function qP(P,f){const Y=(0,d.RandomRange)(0,1);L.ro.LerpToRef(f.color1,f.color2,Y,P.color),f.colorDead.subtractToRef(P.color,f._colorDiff),f._colorDiff.scaleToRef(1/P.lifeTime,P.colorStep)}function mP(P,f){P._currentColorGradient=f._colorGradients[0],P._currentColorGradient.getColorToRef(P.color),P._currentColor1.q(P.color),f._colorGradients.length>1?f._colorGradients[1].getColorToRef(P._currentColor2):P._currentColor2.q(P.color)}function LP(P,f){const Y=f._colorGradients;H.GetCurrentGradient(f._ratio,Y,((f,Y,C)=>{f!==P._currentColorGradient&&(P._currentColor1.q(P._currentColor2),Y.getColorToRef(P._currentColor2),P._currentColorGradient=f),L.ro.LerpToRef(P._currentColor1,P._currentColor2,C,P.color)}))}function oP(P,f){P.colorStep.scaleToRef(f._scaledUpdateSpeed,f._scaledColorStep),P.color.addInPlace(f._scaledColorStep),P.color.a<0&&(P.color.a=0)}function wP(P,f){H.GetCurrentGradient(f._ratio,f._angularSpeedGradients,((f,Y,C)=>{f!==P._currentAngularSpeedGradient&&(P._currentAngularSpeed1=P._currentAngularSpeed2,P._currentAngularSpeed2=Y.getFactor(),P._currentAngularSpeedGradient=f),P.angularSpeed=(0,d.Lerp)(P._currentAngularSpeed1,P._currentAngularSpeed2,C)}))}function dP(P,f){P.angle+=P.angularSpeed*f._scaledUpdateSpeed}function RP(P,f){f.particleEmitterType.startDirectionFunction(f._emitterWorldMatrix,P.direction,P,f.isLocal,f._emitterInverseWorldMatrix)}function yP(P,f){f.startDirectionFunction(f._emitterWorldMatrix,P.direction,P,f.isLocal)}function rP(P,f){P._currentVelocityGradient=f._velocityGradients[0],P._currentVelocity1=P._currentVelocityGradient.getFactor(),f._velocityGradients.length>1?P._currentVelocity2=f._velocityGradients[1].getFactor():P._currentVelocity2=P._currentVelocity1}function iP(P,f){P._currentLimitVelocityGradient=f._limitVelocityGradients[0],P._currentLimitVelocity1=P._currentLimitVelocityGradient.getFactor(),f._limitVelocityGradients.length>1?P._currentLimitVelocity2=f._limitVelocityGradients[1].getFactor():P._currentLimitVelocity2=P._currentLimitVelocity1}function uP(P,f){H.GetCurrentGradient(f._ratio,f._velocityGradients,((Y,C,q)=>{Y!==P._currentVelocityGradient&&(P._currentVelocity1=P._currentVelocity2,P._currentVelocity2=C.getFactor(),P._currentVelocityGradient=Y),f._directionScale*=(0,d.Lerp)(P._currentVelocity1,P._currentVelocity2,q)}))}function gP(P,f){H.GetCurrentGradient(f._ratio,f._limitVelocityGradients,((Y,C,q)=>{Y!==P._currentLimitVelocityGradient&&(P._currentLimitVelocity1=P._currentLimitVelocity2,P._currentLimitVelocity2=C.getFactor(),P._currentLimitVelocityGradient=Y);const m=(0,d.Lerp)(P._currentLimitVelocity1,P._currentLimitVelocity2,q);P.direction.length()>m&&P.direction.scaleInPlace(f.limitVelocityDamping)}))}function SP(P,f){P.direction.scaleToRef(f._directionScale,f._scaledDirection)}function KP(P,f){f.particleEmitterType.startPositionFunction(f._emitterWorldMatrix,P.position,P,f.isLocal)}function MP(P,f){f.startPositionFunction(f._emitterWorldMatrix,P.position,P,f.isLocal)}function VP(P,f){P.Xo?P.Xo.q(P.position):P.Xo=P.position.clone(),C.Of.TransformCoordinatesToRef(P.Xo,f._emitterWorldMatrix,P.position)}function OP(P,f){f.isLocal&&P.Xo?(P.Xo.addInPlace(f._scaledDirection),C.Of.TransformCoordinatesToRef(P.Xo,f._emitterWorldMatrix,P.position)):P.position.addInPlace(f._scaledDirection)}function nP(P,f){P._currentDragGradient=f._dragGradients[0],P._currentDrag1=P._currentDragGradient.getFactor(),f._dragGradients.length>1?P._currentDrag2=f._dragGradients[1].getFactor():P._currentDrag2=P._currentDrag1}function lP(P,f){H.GetCurrentGradient(f._ratio,f._dragGradients,((Y,C,q)=>{Y!==P._currentDragGradient&&(P._currentDrag1=P._currentDrag2,P._currentDrag2=C.getFactor(),P._currentDragGradient=Y);const m=(0,d.Lerp)(P._currentDrag1,P._currentDrag2,q);f._scaledDirection.scaleInPlace(1-m)}))}function vP(P,f){P._randomNoiseCoordinates1?(P._randomNoiseCoordinates1.do(Math.random(),Math.random(),Math.random()),P._randomNoiseCoordinates2.do(Math.random(),Math.random(),Math.random())):(P._randomNoiseCoordinates1=new C.Of(Math.random(),Math.random(),Math.random()),P._randomNoiseCoordinates2=new C.Of(Math.random(),Math.random(),Math.random()))}function cP(P,f){const Y=f._noiseTextureData,q=f._noiseTextureSize;if(Y&&q&&P._randomNoiseCoordinates1){const m=f._fetchR(P._randomNoiseCoordinates1.x,P._randomNoiseCoordinates1.y,q.width,q.height,Y),L=f._fetchR(P._randomNoiseCoordinates1.z,P._randomNoiseCoordinates2.x,q.width,q.height,Y),o=f._fetchR(P._randomNoiseCoordinates2.y,P._randomNoiseCoordinates2.z,q.width,q.height,Y),w=C.TmpVectors.Of[0],d=C.TmpVectors.Of[1];w.do((2*m-1)*f.noiseStrength.x,(2*L-1)*f.noiseStrength.y,(2*o-1)*f.noiseStrength.z),w.scaleToRef(f._tempScaledUpdateSpeed,d),P.direction.addInPlace(d)}}function TP(P,f){f.gravity.scaleToRef(f._tempScaledUpdateSpeed,f._scaledGravity),P.direction.addInPlace(f._scaledGravity)}function UP(P,f){P.size=(0,d.RandomRange)(f.minSize,f.maxSize),P.scale.do((0,d.RandomRange)(f.minScaleX,f.maxScaleX),(0,d.RandomRange)(f.minScaleY,f.maxScaleY))}function DP(P,f){P._currentSizeGradient=f._sizeGradients[0],P._currentSize1=P._currentSizeGradient.getFactor(),P.size=P._currentSize1,f._sizeGradients.length>1?P._currentSize2=f._sizeGradients[1].getFactor():P._currentSize2=P._currentSize1,P.scale.do((0,d.RandomRange)(f.minScaleX,f.maxScaleX),(0,d.RandomRange)(f.minScaleY,f.maxScaleY))}function jP(P,f){const Y=f._actualFrame/f.targetStopDuration;H.GetCurrentGradient(Y,f._startSizeGradients,((Y,C,q)=>{Y!==f._currentStartSizeGradient&&(f._currentStartSize1=f._currentStartSize2,f._currentStartSize2=C.getFactor(),f._currentStartSizeGradient=Y);const m=(0,d.Lerp)(f._currentStartSize1,f._currentStartSize2,q);P.scale.scaleInPlace(m)}))}function eP(P,f){H.GetCurrentGradient(f._ratio,f._sizeGradients,((f,Y,C)=>{f!==P._currentSizeGradient&&(P._currentSize1=P._currentSize2,P._currentSize2=Y.getFactor(),P._currentSizeGradient=f),P.size=(0,d.Lerp)(P._currentSize1,P._currentSize2,C)}))}function sP(P,f){P.remapData=new C.Vector4(0,1,0,1)}function aP(P,f){f._colorRemapGradients&&f._colorRemapGradients.length>0&&H.GetCurrentGradient(f._ratio,f._colorRemapGradients,((f,Y,C)=>{const q=(0,d.Lerp)(f.factor1,Y.factor1,C),m=(0,d.Lerp)(f.factor2,Y.factor2,C);P.remapData.x=q,P.remapData.y=m-q})),f._alphaRemapGradients&&f._alphaRemapGradients.length>0&&H.GetCurrentGradient(f._ratio,f._alphaRemapGradients,((f,Y,C)=>{const q=(0,d.Lerp)(f.factor1,Y.factor1,C),m=(0,d.Lerp)(f.factor2,Y.factor2,C);P.remapData.z=q,P.remapData.w=m-q}))}function QP(P,f){const Y=(0,d.Clamp)(f._actualFrame/f.targetStopDuration);H.GetCurrentGradient(Y,f._lifeTimeGradients,((f,C)=>{const q=f,m=C,L=q.getFactor(),o=m.getFactor(),w=(Y-q.gradient)/(m.gradient-q.gradient);P.lifeTime=(0,d.Lerp)(L,o,w)})),f._emitPower=(0,d.RandomRange)(f.minEmitPower,f.maxEmitPower)}function JP(P,f){P.lifeTime=(0,d.RandomRange)(f.minLifeTime,f.maxLifeTime),f._emitPower=(0,d.RandomRange)(f.minEmitPower,f.maxEmitPower)}function NP(P,f){0===f._emitPower?(P._initialDirection?P._initialDirection.q(P.direction):P._initialDirection=P.direction.clone(),P.direction.set(0,0,0)):(P._initialDirection=null,P.direction.scaleInPlace(f._emitPower)),P.direction.addInPlace(f._inheritedVelocityOffset)}function IP(P,f){P.angularSpeed=(0,d.RandomRange)(f.minAngularSpeed,f.maxAngularSpeed),P.angle=(0,d.RandomRange)(f.minInitialRotation,f.maxInitialRotation)}function XP(P,f){P._currentAngularSpeedGradient=f._angularSpeedGradients[0],P.angularSpeed=P._currentAngularSpeedGradient.getFactor(),P._currentAngularSpeed1=P.angularSpeed,f._angularSpeedGradients.length>1?P._currentAngularSpeed2=f._angularSpeedGradients[1].getFactor():P._currentAngularSpeed2=P._currentAngularSpeed1,P.angle=(0,d.RandomRange)(f.minInitialRotation,f.maxInitialRotation)}function xP(P,f){P._initialStartSpriteCellId=f.startSpriteCellID,P._initialEndSpriteCellId=f.endSpriteCellID,P._initialSpriteCellLoop=f.spriteCellLoop}function kP(P,f){P.previousItem=f.previousItem,P.nextItem=f,f.previousItem&&(f.previousItem.nextItem=P),f.previousItem=P}function ZP(P,f){P.previousItem=f,P.nextItem=f.nextItem,f.nextItem&&(f.nextItem.previousItem=P),f.nextItem=P}function AP(P,f){let Y=f;for(;Y.nextItem;)Y=Y.nextItem;P.previousItem=Y,P.nextItem=Y.nextItem,Y.nextItem=P}function EP(P){P.previousItem&&(P.previousItem.nextItem=P.nextItem),P.nextItem&&(P.nextItem.previousItem=P.previousItem)}class tP extends w{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(P){this._startDirectionFunction!==P&&(this._startDirectionFunction=P,this._directionProcessing.process=P?yP:RP)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(P){this._startPositionFunction!==P&&(this._startPositionFunction=P,this._positionCreation.process=P?MP:KP)}set onDispose(P){this._onDisposeObserver&&this.vf.remove(this._onDisposeObserver),this._onDisposeObserver=this.vf.add(P)}get R(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(P){this._useRampGradients!==P&&(this._useRampGradients=P,this._resetEffect(),P?(this._rampCreation={process:sP,previousItem:null,nextItem:null},ZP(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:aP,previousItem:null,nextItem:null},ZP(this._remapGradientProcessing,this._gravityProcessing)):(EP(this._rampCreation),EP(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(P){this._isLocal!==P&&(this._isLocal=P,P?(this._isLocalCreation={process:VP,previousItem:null,nextItem:null},ZP(this._isLocalCreation,this._positionCreation)):EP(this._isLocalCreation))}get particles(){return this.rr}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(P){this._animationSheetEnabled!==P&&(this._animationSheetEnabled=P,P?(this._sheetCreation={process:xP,previousItem:null,nextItem:null},ZP(this._sheetCreation,this._colorCreation)):EP(this._sheetCreation),this._reset())}getActiveCount(){return this.rr.length}getClassName(){return"lo"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var P;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(P=this._customWrappers[f])||void 0===P?void 0:P.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[P]??this._customWrappers[0]}setCustomEffect(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[f]=new PP.d(this._engine),this._customWrappers[f].effect=P,this._customWrappers[f].drawContext&&(this._customWrappers[f].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new W.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(P){if(this.noiseTexture!==P){if(this._noiseTexture=P,!P)return EP(this._noiseCreation),void EP(this._noiseProcessing);this._noiseCreation={process:vP,previousItem:null,nextItem:null},ZP(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:cP,previousItem:null,nextItem:null},ZP(this._noiseProcessing,this._positionProcessing)}}constructor(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,w=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(P),this._emitterInverseWorldMatrix=C.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new C.Of,this.vf=new W.e,this.onStoppedObservable=new W.e,this.onStartedObservable=new W.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.rr=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new L.ro(0,0,0,0),this._colorDiff=new L.ro(0,0,0,0),this._scaledDirection=C.Of.Zero(),this._scaledGravity=C.Of.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=P=>{},this.recycleParticle=P=>{const f=this.rr.pop();f!==P&&f.copyTo(P),this._stockParticles.push(f)},this._createParticle=()=>{let P;return 0!==this._stockParticles.length?(P=this._stockParticles.pop(),P._reset()):P=new F(this),this._prepareParticle(P),P},this.paused=!1,this._shadersLoaded=!1,this._capacity=f,this._epsilon=o,Y&&"Scene"!==Y.getClassName()?(this._engine=Y,this.defaultProjectionMatrix=C.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Y||h.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Rr.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:JP,previousItem:null,nextItem:null},this._positionCreation={process:KP,previousItem:null,nextItem:null},ZP(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:RP,previousItem:null,nextItem:null},ZP(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:NP,previousItem:null,nextItem:null},ZP(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:UP,previousItem:null,nextItem:null},ZP(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:IP,previousItem:null,nextItem:null},ZP(this._angleCreation,this._sizeCreation),this._colorCreation={process:qP,previousItem:null,nextItem:null},ZP(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,w||(this._colorProcessing={process:oP,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:dP,previousItem:null,nextItem:null},ZP(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:SP,previousItem:null,nextItem:null},ZP(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:OP,previousItem:null,nextItem:null},ZP(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:TP,previousItem:null,nextItem:null},ZP(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=m,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new PP.d(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new y,this.updateFunction=P=>{var f;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(f=this.noiseTexture.getContent())||void 0===f||f.then((P=>{this._noiseTextureData=P})));const Y=P===this.rr;for(let C=0;C<P.length;C++){const f=P[C];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const q=f.age;if(f.age+=this._tempScaledUpdateSpeed,f.age>f.lifeTime){const P=f.age-q,Y=f.lifeTime-q;this._tempScaledUpdateSpeed=Y*this._tempScaledUpdateSpeed/P,f.age=f.lifeTime}this._ratio=f.age/f.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let m=this._updateQueueStart;for(;m;)m.process(f,this),m=m.nextItem;if(this._isAnimationSheetEnabled&&!w&&f.updateCellIndex(),f._inheritParticleInfoToSubEmitters(),f.age>=f.lifeTime){if(this._emitFromParticle(f),f._attachedSubEmitters){for(const P of f._attachedSubEmitters)P.particleSystem.disposeOnStop=!0,P.particleSystem.stop();f._attachedSubEmitters=null}this.recycleParticle(f),Y&&C--}else;}}}serialize(P){throw new Error("Method not implemented.")}clone(P,f){throw new Error("Method not implemented.")}_addFactorGradient(P,f,Y,C){const q=new b(f,Y,C);P.push(q),P.sort(((P,f)=>P.gradient<f.gradient?-1:P.gradient>f.gradient?1:0))}_removeFactorGradient(P,f){if(!P)return;let Y=0;for(const C of P){if(C.gradient===f){P.splice(Y,1);break}Y++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=QP:this._lifeTimeCreation.process=JP}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:jP,previousItem:null,nextItem:null},ZP(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(EP(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(P){this.targetStopDuration!==P&&(this._targetStopDuration=P,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(P,f,Y){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,P,f,Y),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(P){return this._removeFactorGradient(this._lifeTimeGradients,P),this._syncLifeTimeCreation(),this}addSizeGradient(P,f,Y){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=DP,this._sizeGradientProcessing={process:eP,previousItem:null,nextItem:null},kP(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,P,f,Y),this}removeSizeGradient(P){var f;return this._removeFactorGradient(this._sizeGradients,P),0===(null===(f=this._sizeGradients)||void 0===f?void 0:f.length)&&(EP(this._sizeGradientProcessing),this._sizeCreation.process=UP),this}addColorRemapGradient(P,f,Y){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,P,f,Y),this}removeColorRemapGradient(P){return this._removeFactorGradient(this._colorRemapGradients,P),this}addAlphaRemapGradient(P,f,Y){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,P,f,Y),this}removeAlphaRemapGradient(P){return this._removeFactorGradient(this._alphaRemapGradients,P),this}addAngularSpeedGradient(P,f,Y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=XP,this._angularSpeedGradientProcessing={process:wP,previousItem:null,nextItem:null},kP(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,P,f,Y),this}removeAngularSpeedGradient(P){var f;return this._removeFactorGradient(this._angularSpeedGradients,P),0===(null===(f=this._angularSpeedGradients)||void 0===f?void 0:f.length)&&(this._angleCreation.process=IP,EP(this._angularSpeedGradientProcessing)),this}addVelocityGradient(P,f,Y){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:rP,previousItem:null,nextItem:null},ZP(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:uP,previousItem:null,nextItem:null},kP(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,P,f,Y),this}removeVelocityGradient(P){var f;return this._removeFactorGradient(this._velocityGradients,P),0===(null===(f=this._velocityGradients)||void 0===f?void 0:f.length)&&(EP(this._velocityCreation),EP(this._velocityGradientProcessing)),this}addLimitVelocityGradient(P,f,Y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:iP,previousItem:null,nextItem:null},ZP(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:gP,previousItem:null,nextItem:null},ZP(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,P,f,Y),this}removeLimitVelocityGradient(P){var f;return this._removeFactorGradient(this._limitVelocityGradients,P),0===(null===(f=this._limitVelocityGradients)||void 0===f?void 0:f.length)&&(EP(this._limitVelocityCreation),EP(this._limitVelocityGradientProcessing)),this}addDragGradient(P,f,Y){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:nP,previousItem:null,nextItem:null},kP(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:lP,previousItem:null,nextItem:null},kP(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,P,f,Y),this}removeDragGradient(P){var f;return this._removeFactorGradient(this._dragGradients,P),0===(null===(f=this._dragGradients)||void 0===f?void 0:f.length)&&(EP(this._dragCreation),EP(this._dragGradientProcessing)),this}addEmitRateGradient(P,f,Y){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,P,f,Y),this}removeEmitRateGradient(P){return this._removeFactorGradient(this._emitRateGradients,P),this}addStartSizeGradient(P,f,Y){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,P,f,Y),this._syncStartSizeCreation(),this}removeStartSizeGradient(P){return this._removeFactorGradient(this._startSizeGradients,P),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const P=new Uint8Array(4*this._rawTextureWidth),f=L.TmpColors.Df[0];for(let Y=0;Y<this._rawTextureWidth;Y++){const C=Y/this._rawTextureWidth;H.GetCurrentGradient(C,this._rampGradients,((C,q,m)=>{L.Df.LerpToRef(C.color,q.color,m,f),P[4*Y]=255*f.r,P[4*Y+1]=255*f.g,P[4*Y+2]=255*f.b,P[4*Y+3]=255}))}this._rampGradientsTexture=p.d.CreateRGBATexture(P,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((P,f)=>P.gradient<f.gradient?-1:P.gradient>f.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(P,f){this._rampGradients||(this._rampGradients=[]);const Y=new B(P,f);return this._rampGradients.push(Y),this._syncRampGradientTexture(),this}removeRampGradient(P){return this._removeGradientAndTexture(P,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(P,f,Y){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=mP,this._colorProcessing.process=LP);const C=new z(P,f,Y);return this._colorGradients.push(C),this._colorGradients.sort(((P,f)=>P.gradient<f.gradient?-1:P.gradient>f.gradient?1:0)),this}removeColorGradient(P){if(!this._colorGradients)return this;let f=0;for(const Y of this._colorGradients){if(Y.gradient===P){this._colorGradients.splice(f,1);break}f++}return 0===this._colorGradients.length&&(this._colorCreation.process=qP,this._colorProcessing.process=oP),this}resetDrawCache(){if(this._drawWrappers){for(const P of this._drawWrappers)if(P)for(const f of P)null===f||void 0===f||f.dispose();this._drawWrappers=[]}}_fetchR(P,f,Y,C,q){return q[4*(((P=.5*Math.abs(P)+.5)*Y%Y|0)+((f=.5*Math.abs(f)+.5)*C%C|0)*Y)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const P=this._engine,f=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*f),this._vertexBuffer=new n.c(P,this._vertexData,!0,f);let Y=0;const C=this._vertexBuffer.createVertexBuffer(n.d.PositionKind,Y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[n.d.PositionKind]=C,Y+=3;const q=this._vertexBuffer.createVertexBuffer(n.d.ColorKind,Y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[n.d.ColorKind]=q,Y+=4;const m=this._vertexBuffer.createVertexBuffer("angle",Y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=m,Y+=1;const L=this._vertexBuffer.createVertexBuffer("size",Y,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=L,Y+=2,this._isAnimationSheetEnabled){const P=this._vertexBuffer.createVertexBuffer("cellIndex",Y,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=P,Y+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const P=this._vertexBuffer.createVertexBuffer("direction",Y,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=P,Y+=3}if(this._useRampGradients){const P=this._vertexBuffer.createVertexBuffer("remapData",Y,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=P,Y+=4}let o;if(this._useInstancing){const f=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new n.c(P,f,!1,2),o=this._spriteBuffer.createVertexBuffer("offset",0,2)}else o=this._vertexBuffer.createVertexBuffer("offset",Y,2,this._vertexBufferSize,this._useInstancing),Y+=2;this._vertexBuffers.offset=o,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const P=[],f=[];let Y=0;for(let C=0;C<this._capacity;C++)P.push(Y),P.push(Y+1),P.push(Y+2),P.push(Y),P.push(Y+2),P.push(Y+3),f.push(Y,Y+1,Y+1,Y+2,Y+2,Y+3,Y+3,Y,Y,Y+3),Y+=4;this._indexBuffer=this._engine.createIndexBuffer(P),this._linesIndexBuffer=this._engine.createIndexBuffer(f)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(P)setTimeout((()=>{this.start(0)}),P);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var f;-1!==(null===(f=this.k)||void 0===f?void 0:f.getClassName().indexOf("Mesh"))&&this.k.XC(!0);const P=this.noiseTexture;if(P&&P.onGeneratedObservable)P.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let f=0;f<this.preWarmCycles;f++)this.animate(!0),P.render()}))}));else for(let f=0;f<this.preWarmCycles;f++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(P))}_postStop(P){}reset(){this._stockParticles.length=0,this.rr.length=0}_appendParticleVertex(P,f,Y,q){let m=P*this._vertexBufferSize;if(this._vertexData[m++]=f.position.x+this.hw.x,this._vertexData[m++]=f.position.y+this.hw.y,this._vertexData[m++]=f.position.z+this.hw.z,this._vertexData[m++]=f.color.r,this._vertexData[m++]=f.color.g,this._vertexData[m++]=f.color.b,this._vertexData[m++]=f.color.a,this._vertexData[m++]=f.angle,this._vertexData[m++]=f.scale.x*f.size,this._vertexData[m++]=f.scale.y*f.size,this._isAnimationSheetEnabled&&(this._vertexData[m++]=f.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[m++]=f.direction.x,this._vertexData[m++]=f.direction.y,this._vertexData[m++]=f.direction.z);else if(f._initialDirection){let P=f._initialDirection;this.isLocal&&(C.Of.TransformNormalToRef(P,this._emitterWorldMatrix,C.TmpVectors.Of[0]),P=C.TmpVectors.Of[0]),0===P.x&&0===P.z&&(P.x=.001),this._vertexData[m++]=P.x,this._vertexData[m++]=P.y,this._vertexData[m++]=P.z}else{let P=f.direction;this.isLocal&&(C.Of.TransformNormalToRef(P,this._emitterWorldMatrix,C.TmpVectors.Of[0]),P=C.TmpVectors.Of[0]),0===P.x&&0===P.z&&(P.x=.001),this._vertexData[m++]=P.x,this._vertexData[m++]=P.y,this._vertexData[m++]=P.z}this._useRampGradients&&f.remapData&&(this._vertexData[m++]=f.remapData.x,this._vertexData[m++]=f.remapData.y,this._vertexData[m++]=f.remapData.z,this._vertexData[m++]=f.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Y?Y=this._epsilon:1===Y&&(Y=1-this._epsilon),0===q?q=this._epsilon:1===q&&(q=1-this._epsilon)),this._vertexData[m++]=Y,this._vertexData[m++]=q)}_prepareParticle(P){}_createNewOnes(P){let f;for(let Y=0;Y<P&&this.rr.length!==this._capacity;Y++){f=this._createParticle(),this.rr.push(f);let P=this._createQueueStart;for(;P;)P.process(f,this),P=P.nextItem;f._inheritParticleInfoToSubEmitters()}}_update(P){if(this._alive=this.rr.length>0,this.k.position){const P=this.k;this._emitterWorldMatrix=P.getWorldMatrix()}else{const P=this.k;this._emitterWorldMatrix=C.Matrix.Translation(P.x,P.y,P.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.rr),this._createNewOnes(P)}static _GetAttributeNamesOrOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=[n.d.PositionKind,n.d.ColorKind,"angle","offset","size"];return P&&C.push("cellIndex"),f||C.push("direction"),Y&&C.push("remapData"),C}static _GetEffectCreationOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,fP.d)(C),P&&C.push("particlesInfos"),f&&C.push("logarithmicDepthConstant"),Y&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(P,f){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,fP.l)(this,this._scene,P),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&P.push("#define FOG")),this._isAnimationSheetEnabled&&P.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&P.push("#define LOGARITHMICDEPTH"),f===w.BLENDMODE_MULTIPLY&&P.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&P.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(P.push("#define BILLBOARD"),this.billboardMode){case 2:P.push("#define BILLBOARDY");break;case 8:case 9:P.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&P.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:P.push("#define BILLBOARDMODE_ALL")}Y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),P.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(P,f,Y){f.push(...tP._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),P.push(...tP._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Y.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,CP.e)(P,this._imageProcessingConfigurationDefines),(0,CP.b)(Y,this._imageProcessingConfigurationDefines))}_getWrapper(P){const f=this._getCustomDrawWrapper(P);if(null!==f&&void 0!==f&&f.effect)return f;const Y=[];this.fillDefines(Y,P);const C=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let q=this._drawWrappers[C];q||(q=this._drawWrappers[C]=[]);let m=q[P];m||(m=new PP.d(this._engine),m.drawContext&&(m.drawContext.useInstancing=this._useInstancing),q[P]=m);const L=Y.join("\n");if(m.defines!==L){const P=[],f=[],Y=[];this.fillUniformsAttributesAndSamplerNames(f,P,Y),m.setEffect(this._engine.createEffect("particles",P,f,Y,L,void 0,void 0,void 0,void 0,this._shaderLanguage),L)}return m}animate(){var P;let f,Y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!Y&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Y?this.preWarmStepOffset:(null===(P=this._scene)||void 0===P?void 0:P.getAnimationRatio())||1),this.manualEmitCount>-1)f=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let P=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const f=this._actualFrame/this.targetStopDuration;H.GetCurrentGradient(f,this._emitRateGradients,((f,Y,C)=>{f!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Y.getFactor(),this._currentEmitRateGradient=f),P=(0,d.Lerp)(this._currentEmitRate1,this._currentEmitRate2,C)}))}f=P*this._scaledUpdateSpeed|0,this._newPartsExcess+=P*this._scaledUpdateSpeed-f}if(this._newPartsExcess>1&&(f+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?f=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(f),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Y){let P=0;for(let f=0;f<this.rr.length;f++){const Y=this.rr[f];this._appendParticleVertices(P,Y),P+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.rr.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(P,f){this._appendParticleVertex(P++,f,0,0),this._useInstancing||(this._appendParticleVertex(P++,f,1,0),this._appendParticleVertex(P++,f,1,1),this._appendParticleVertex(P++,f,0,1))}rebuild(){var P;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(P=this._spriteBuffer)||void 0===P||P._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!tP.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Y.bind(Y,12677)),Promise.resolve().then(Y.bind(Y,12630))])):await Promise.all([Promise.resolve().then(Y.bind(Y,12620)),Promise.resolve().then(Y.bind(Y,12606))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==w.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(w.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(w.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(P){const f=this._getWrapper(P),Y=f.effect,q=this._engine;q.enableEffect(f);const m=this.defaultViewMatrix??this._scene.getViewMatrix();if(Y.setTexture("diffuseSampler",this.particleTexture),Y.setMatrix("view",m),Y.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const P=this.particleTexture.getBaseSize();Y.setFloat3("particlesInfos",this.spriteCellWidth/P.width,this.spriteCellHeight/P.height,this.spriteCellWidth/P.width)}if(Y.setVector2("translationPivot",this.translationPivot),Y.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const P=this._scene.activeCamera;Y.setVector3("eyePosition",P.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Y.setTexture("rampSampler",this._rampGradientsTexture));const L=Y.defines;var o,w,d,R,y,r;(this._scene&&((0,fP.f)(Y,this,this._scene),this.applyFog&&(0,YP.d)(this._scene,void 0,Y)),L.indexOf("#define BILLBOARDMODE_ALL")>=0&&(m.invertToRef(C.TmpVectors.Matrix[0]),Y.setMatrix("invView",C.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?q.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Y):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Y)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?q.bindBuffers(this._vertexBuffers,null!==(d=this._scene)&&void 0!==d&&d.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Y):q.bindBuffers(this._vertexBuffers,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBufferUseInstancing:null,Y);(this.useLogarithmicDepth&&this._scene&&(0,YP.i)(L,Y,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Y),this._setEngineBasedOnBlendMode(P),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Y),this._useInstancing)?null!==(y=this._scene)&&void 0!==y&&y.forceWireframe?q.drawElementsType(6,0,10,this.rr.length):q.drawArraysType(7,0,4,this.rr.length):null!==(r=this._scene)&&void 0!==r&&r.forceWireframe?q.drawElementsType(1,0,10*this.rr.length):q.drawElementsType(0,0,6*this.rr.length);return this.rr.length}render(){if(!this.isReady()||!this.rr.length)return 0;const P=this._engine;P.setState&&(P.setState(!1),this.forceDepthWrite&&P.setDepthWrite(!0));let f=0;return f=this.blendMode===w.BLENDMODE_MULTIPLYADD?this._render(w.BLENDMODE_MULTIPLY)+this._render(w.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),f}_onDispose(){}dispose(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),P&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),P&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(f,Y),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const P=this._scene.Rr.indexOf(this);P>-1&&this._scene.Rr.splice(P,1),this._scene._activeParticleSystems.dispose()}this.vf.notifyObservers(this),this.vf.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}tP.ForceGLSL=!1;var GP,zP=Y(11043);!function(P){P[P.ATTACHED=0]="ATTACHED",P[P.END=1]="END"}(GP||(GP={}));class BP{constructor(P){if(this.particleSystem=P,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!P.k||!P.k.dispose){const f=(0,o.c)("BABYLON.AbstractMesh");P.k=new f("SubemitterSystemEmitter",P.vP()),P._disposeEmitterOnDispose=!0}}clone(){let P=this.particleSystem.k;if(P){if(P instanceof C.Of)P=P.clone();else if(-1!==P.getClassName().indexOf("Mesh")){P=new((0,o.c)("BABYLON.Mesh"))("",P.vP()),P.isVisible=!1}}else P=new C.Of;const f=new BP(this.particleSystem.clone(this.particleSystem.name,P));return f.particleSystem.name+="Clone",f.type=this.type,f.inheritDirection=this.inheritDirection,f.inheritedVelocityAmount=this.inheritedVelocityAmount,f.particleSystem._disposeEmitterOnDispose=!0,f.particleSystem.disposeOnStop=!0,f}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};return f.type=this.type,f.inheritDirection=this.inheritDirection,f.inheritedVelocityAmount=this.inheritedVelocityAmount,f.particleSystem=this.particleSystem.serialize(P),f}static _ParseParticleSystem(P,f,Y){throw(0,zP.b)("ParseParticle")}static Parse(P,f,Y){const C=P.particleSystem,q=new BP(BP._ParseParticleSystem(C,f,Y,!0));return q.type=P.type,q.inheritDirection=P.inheritDirection,q.inheritedVelocityAmount=P.inheritedVelocityAmount,q.particleSystem._isSubEmitter=!0,q}dispose(){this.particleSystem.dispose()}}var bP=Y(11089);function HP(P,f){const Y=new K;return Y.direction1=P,Y.direction2=f,Y}function WP(){return new S(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function pP(){return new M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function hP(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.Of(0,1,0),Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0);return new V(P,f,Y)}function FP(){return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Pf(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0),m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.Of(0,1,0);return new g(P,f,Y,q,m)}function ff(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new r(P,f)}function Yf(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0),q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0);return new i(P,f,Y,q)}const Cf=C.Of.Zero(),qf=C.Of.Zero(),mf=C.Of.Zero();class Lf{constructor(){this.strength=0,this.position=C.Of.Zero()}_processParticle(P,f){this.position.subtractToRef(P.position,Cf);const Y=Cf.lengthSquared()+1;Cf.normalize().scaleToRef(this.strength/Y,qf),qf.scaleToRef(f._tempScaledUpdateSpeed,mf),P.direction.addInPlace(mf)}serialize(){return{position:this.position.If(),strength:this.strength}}}class of extends tP{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=P=>{if(!this._subEmitters||0===this._subEmitters.length)return;const f=Math.floor(Math.random()*this._subEmitters.length);for(const Y of this._subEmitters[f])if(1===Y.type){const f=Y.clone();P._inheritParticleInfoToSubEmitter(f),f.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(f.particleSystem),f.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(P,f){const Y=HP(P,f);return this.particleEmitterType=Y,Y}get flowMap(){return this._flowMap}set flowMap(P){this._flowMap!==P&&(this._flowMap=P,this._flowMapUpdate&&(EP(this._flowMapUpdate),this._flowMapUpdate=null),P&&(this._flowMapUpdate={process:P=>{var f;const Y=null===(f=this.vP())||void 0===f?void 0:f.getTransformMatrix();this._flowMap._processParticle(P,this.flowMapStrength*this._tempScaledUpdateSpeed,Y)},previousItem:null,nextItem:null},ZP(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(P){this._attractors.push(P),1===this._attractors.length&&(this._attractorUpdate={process:P=>{for(const f of this._attractors)f._processParticle(P,this)},previousItem:null,nextItem:null},ZP(this._attractorUpdate,this._directionProcessing))}removeAttractor(P){const f=this._attractors.indexOf(P);-1!==f&&this._attractors.splice(f,1),0===this._attractors.length&&EP(this._attractorUpdate)}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(P)}createHemisphericEmitter(){const P=WP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createSphereEmitter(){const P=pP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createDirectedSphereEmitter(){const P=hP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.Of(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0));return this.particleEmitterType=P,P}createCylinderEmitter(){const P=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=P,P}createDirectedCylinderEmitter(){const P=Pf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.Of(0,1,0));return this.particleEmitterType=P,P}createConeEmitter(){const P=ff(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=P,P}createDirectedConeEmitter(){const P=Yf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0));return this.particleEmitterType=P,P}createBoxEmitter(P,f,Y,C){const q=new y;return this.particleEmitterType=q,this.direction1=P,this.direction2=f,this.minEmitBox=Y,this.maxEmitBox=C,q}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const P of this.subEmitters)P instanceof of?this._subEmitters.push([new BP(P)]):P instanceof BP?this._subEmitters.push([P]):P instanceof Array&&this._subEmitters.push(P)}_stopSubEmitters(){if(this.activeSubSystems){for(const P of this.activeSubSystems)P.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const P=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==P&&this._rootParticleSystem.activeSubSystems.splice(P,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(P){P&&this._stopSubEmitters()}_prepareParticle(P){if(this._subEmitters&&this._subEmitters.length>0){const f=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];P._attachedSubEmitters=[];for(const Y of f)if(0===Y.type){const f=Y.clone();P._attachedSubEmitters.push(f),f.particleSystem.start()}}}_onDispose(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),P&&this.particles)for(const Y of this.particles)if(Y._attachedSubEmitters)for(let P=Y._attachedSubEmitters.length-1;P>=0;P-=1)Y._attachedSubEmitters[P].dispose();if(f&&this.activeSubSystems)for(let Y=this.activeSubSystems.length-1;Y>=0;Y-=1)this.activeSubSystems[Y].dispose();if(this._subEmitters&&this._subEmitters.length){for(let P=0;P<this._subEmitters.length;P++)for(const f of this._subEmitters[P])f.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(P,f,Y,q){let m;m=Y instanceof bP.c?null:Y;const w=(0,o.c)("BABYLON.Texture");if(w&&m&&(P.texture?f.particleTexture=w.Parse(P.texture,m,q):P.textureName&&(f.particleTexture=new w(q+P.textureName,m,!1,void 0===P.invertY||P.invertY),f.particleTexture.name=P.textureName)),P.emitterId||0===P.emitterId||void 0!==P.k?P.emitterId&&m?f.k=m.getLastMeshById(P.emitterId):f.k=C.Of.ef(P.k):f.k=C.Of.Zero(),f.isLocal=!!P.isLocal,void 0!==P.renderingGroupId&&(f.renderingGroupId=P.renderingGroupId),void 0!==P.isBillboardBased&&(f.isBillboardBased=P.isBillboardBased),void 0!==P.billboardMode&&(f.billboardMode=P.billboardMode),void 0!==P.useLogarithmicDepth&&(f.useLogarithmicDepth=P.useLogarithmicDepth),P.animations){for(let Y=0;Y<P.animations.length;Y++){const C=P.animations[Y],q=(0,o.c)("BABYLON.Animation");q&&f.animations.push(q.Parse(C))}f.beginAnimationOnStart=P.beginAnimationOnStart,f.beginAnimationFrom=P.beginAnimationFrom,f.beginAnimationTo=P.beginAnimationTo,f.beginAnimationLoop=P.beginAnimationLoop}if(P.autoAnimate&&m&&m.beginAnimation(f,P.autoAnimateFrom,P.autoAnimateTo,P.autoAnimateLoop,P.autoAnimateSpeed||1),f.startDelay=0|P.startDelay,f.minAngularSpeed=P.minAngularSpeed,f.maxAngularSpeed=P.maxAngularSpeed,f.minSize=P.minSize,f.maxSize=P.maxSize,P.minScaleX&&(f.minScaleX=P.minScaleX,f.maxScaleX=P.maxScaleX,f.minScaleY=P.minScaleY,f.maxScaleY=P.maxScaleY),void 0!==P.preWarmCycles&&(f.preWarmCycles=P.preWarmCycles,f.preWarmStepOffset=P.preWarmStepOffset),void 0!==P.minInitialRotation&&(f.minInitialRotation=P.minInitialRotation,f.maxInitialRotation=P.maxInitialRotation),f.minLifeTime=P.minLifeTime,f.maxLifeTime=P.maxLifeTime,f.minEmitPower=P.minEmitPower,f.maxEmitPower=P.maxEmitPower,f.emitRate=P.emitRate,f.gravity=C.Of.ef(P.gravity),P.noiseStrength&&(f.noiseStrength=C.Of.ef(P.noiseStrength)),f.color1=L.ro.ef(P.color1),f.color2=L.ro.ef(P.color2),f.colorDead=L.ro.ef(P.colorDead),f.updateSpeed=P.updateSpeed,f.targetStopDuration=P.targetStopDuration,f.blendMode=P.blendMode,P.colorGradients)for(const C of P.colorGradients)f.addColorGradient(C.gradient,L.ro.ef(C.color1),C.color2?L.ro.ef(C.color2):void 0);if(P.rampGradients){for(const Y of P.rampGradients)f.addRampGradient(Y.gradient,L.Df.ef(Y.color));f.useRampGradients=P.useRampGradients}if(P.colorRemapGradients)for(const C of P.colorRemapGradients)f.addColorRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.alphaRemapGradients)for(const C of P.alphaRemapGradients)f.addAlphaRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.sizeGradients)for(const C of P.sizeGradients)f.addSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.angularSpeedGradients)for(const C of P.angularSpeedGradients)f.addAngularSpeedGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.velocityGradients)for(const C of P.velocityGradients)f.addVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.dragGradients)for(const C of P.dragGradients)f.addDragGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.emitRateGradients)for(const C of P.emitRateGradients)f.addEmitRateGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.startSizeGradients)for(const C of P.startSizeGradients)f.addStartSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.lifeTimeGradients)for(const C of P.lifeTimeGradients)f.addLifeTimeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(P.limitVelocityGradients){for(const Y of P.limitVelocityGradients)f.addLimitVelocityGradient(Y.gradient,void 0!==Y.factor1?Y.factor1:Y.factor,Y.factor2);f.limitVelocityDamping=P.limitVelocityDamping}if(P.noiseTexture&&m){const Y=(0,o.c)("BABYLON.ProceduralTexture");f.noiseTexture=Y.Parse(P.noiseTexture,m,q)}let d;if(P.particleEmitterType){switch(P.particleEmitterType.type){case"SphereParticleEmitter":d=new M;break;case"SphereDirectedParticleEmitter":d=new V;break;case"ConeEmitter":case"ConeParticleEmitter":d=new r;break;case"ConeDirectedParticleEmitter":d=new i;break;case"CylinderParticleEmitter":d=new u;break;case"CylinderDirectedParticleEmitter":d=new g;break;case"HemisphericParticleEmitter":d=new S;break;case"PointParticleEmitter":d=new K;break;case"MeshParticleEmitter":d=new l;break;case"CustomParticleEmitter":d=new O;break;default:d=new y}d.parse(P.particleEmitterType,m)}else d=new y,d.parse(P,m);f.particleEmitterType=d,f.startSpriteCellID=P.startSpriteCellID,f.endSpriteCellID=P.endSpriteCellID,f.spriteCellLoop=P.spriteCellLoop??!0,f.spriteCellWidth=P.spriteCellWidth,f.spriteCellHeight=P.spriteCellHeight,f.spriteCellChangeSpeed=P.spriteCellChangeSpeed,f.spriteRandomStartCell=P.spriteRandomStartCell,f.disposeOnStop=P.disposeOnStop??!1,f.manualEmitCount=P.manualEmitCount??-1}static Parse(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],m=arguments.length>4?arguments[4]:void 0;const o=P.name;let w,d,R=null,y=null;if(f instanceof bP.c?w=f:(d=f,w=d.getEngine()),P.customShader&&w.createEffectForParticles){y=P.customShader;const f=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"";R=w.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,f)}const r=new of(o,m||P.eY,f,R,P.isAnimationSheetEnabled);if(r.customShader=y,r._rootUrl=Y,P.id&&(r.id=P.id),P.subEmitters){r.subEmitters=[];for(const C of P.subEmitters){const P=[];for(const q of C)P.push(BP.Parse(q,f,Y));r.subEmitters.push(P)}}if(P.attractors)for(const L of P.attractors){const P=new Lf;P.position=C.Of.ef(L.position),P.strength=L.strength,r.addAttractor(P)}return of._Parse(P,r,f,Y),P.textureMask&&(r.textureMask=L.ro.ef(P.textureMask)),P.hw&&(r.hw=C.Of.ef(P.hw)),P.preventAutoStart&&(r.preventAutoStart=P.preventAutoStart),q||r.preventAutoStart||r.start(),r}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};if(of._Serialize(f,this,P),f.textureMask=this.textureMask.If(),f.customShader=this.customShader,f.preventAutoStart=this.preventAutoStart,f.hw=this.hw.If(),this.subEmitters){f.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Y of this._subEmitters){const C=[];for(const f of Y)C.push(f.serialize(P));f.subEmitters.push(C)}}if(this._attractors&&this._attractors.length){f.attractors=[];for(const P of this._attractors)f.attractors.push(P.serialize())}return f}static _Serialize(P,f,Y){if(P.name=f.name,P.id=f.id,P.eY=f.getCapacity(),P.disposeOnStop=f.disposeOnStop,P.manualEmitCount=f.manualEmitCount,f.k.position){const Y=f.k;P.emitterId=Y.id}else{const Y=f.k;P.k=Y.If()}f.particleEmitterType&&(P.particleEmitterType=f.particleEmitterType.serialize()),f.particleTexture&&(Y?P.texture=f.particleTexture.serialize():(P.textureName=f.particleTexture.name,P.invertY=!!f.particleTexture._invertY)),P.isLocal=f.isLocal,Q.e.AppendSerializedAnimations(f,P),P.beginAnimationOnStart=f.beginAnimationOnStart,P.beginAnimationFrom=f.beginAnimationFrom,P.beginAnimationTo=f.beginAnimationTo,P.beginAnimationLoop=f.beginAnimationLoop,P.startDelay=f.startDelay,P.renderingGroupId=f.renderingGroupId,P.isBillboardBased=f.isBillboardBased,P.billboardMode=f.billboardMode,P.minAngularSpeed=f.minAngularSpeed,P.maxAngularSpeed=f.maxAngularSpeed,P.minSize=f.minSize,P.maxSize=f.maxSize,P.minScaleX=f.minScaleX,P.maxScaleX=f.maxScaleX,P.minScaleY=f.minScaleY,P.maxScaleY=f.maxScaleY,P.minEmitPower=f.minEmitPower,P.maxEmitPower=f.maxEmitPower,P.minLifeTime=f.minLifeTime,P.maxLifeTime=f.maxLifeTime,P.emitRate=f.emitRate,P.gravity=f.gravity.If(),P.noiseStrength=f.noiseStrength.If(),P.color1=f.color1.If(),P.color2=f.color2.If(),P.colorDead=f.colorDead.If(),P.updateSpeed=f.updateSpeed,P.targetStopDuration=f.targetStopDuration,P.blendMode=f.blendMode,P.preWarmCycles=f.preWarmCycles,P.preWarmStepOffset=f.preWarmStepOffset,P.minInitialRotation=f.minInitialRotation,P.maxInitialRotation=f.maxInitialRotation,P.startSpriteCellID=f.startSpriteCellID,P.spriteCellLoop=f.spriteCellLoop,P.endSpriteCellID=f.endSpriteCellID,P.spriteCellChangeSpeed=f.spriteCellChangeSpeed,P.spriteCellWidth=f.spriteCellWidth,P.spriteCellHeight=f.spriteCellHeight,P.spriteRandomStartCell=f.spriteRandomStartCell,P.isAnimationSheetEnabled=f.isAnimationSheetEnabled,P.useLogarithmicDepth=f.useLogarithmicDepth;const C=f.getColorGradients();if(C){P.colorGradients=[];for(const f of C){const Y={gradient:f.gradient,color1:f.color1.If()};f.color2?Y.color2=f.color2.If():Y.color2=f.color1.If(),P.colorGradients.push(Y)}}const q=f.getRampGradients();if(q){P.rampGradients=[];for(const f of q){const Y={gradient:f.gradient,color:f.color.If()};P.rampGradients.push(Y)}P.useRampGradients=f.useRampGradients}const m=f.getColorRemapGradients();if(m){P.colorRemapGradients=[];for(const f of m){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.colorRemapGradients.push(Y)}}const L=f.getAlphaRemapGradients();if(L){P.alphaRemapGradients=[];for(const f of L){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.alphaRemapGradients.push(Y)}}const o=f.getSizeGradients();if(o){P.sizeGradients=[];for(const f of o){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.sizeGradients.push(Y)}}const w=f.getAngularSpeedGradients();if(w){P.angularSpeedGradients=[];for(const f of w){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.angularSpeedGradients.push(Y)}}const d=f.getVelocityGradients();if(d){P.velocityGradients=[];for(const f of d){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.velocityGradients.push(Y)}}const R=f.getDragGradients();if(R){P.dragGradients=[];for(const f of R){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.dragGradients.push(Y)}}const y=f.getEmitRateGradients();if(y){P.emitRateGradients=[];for(const f of y){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.emitRateGradients.push(Y)}}const r=f.getStartSizeGradients();if(r){P.startSizeGradients=[];for(const f of r){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.startSizeGradients.push(Y)}}const i=f.getLifeTimeGradients();if(i){P.lifeTimeGradients=[];for(const f of i){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.lifeTimeGradients.push(Y)}}const u=f.getLimitVelocityGradients();if(u){P.limitVelocityGradients=[];for(const f of u){const Y={gradient:f.gradient,factor1:f.factor1};void 0!==f.factor2?Y.factor2=f.factor2:Y.factor2=f.factor1,P.limitVelocityGradients.push(Y)}P.limitVelocityDamping=f.limitVelocityDamping}f.noiseTexture&&(P.noiseTexture=f.noiseTexture.serialize())}clone(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let q=null;const m=this._engine;if(m.createEffectForParticles&&null!=this.customShader){q=this.customShader;const P=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"",f=m.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,P);C[0]?C[0].effect=f:this.setCustomEffect(f,0)}const L=this.serialize(Y),o=of.Parse(L,this._scene||this._engine,this._rootUrl);return o.name=P,o.customShader=q,o._customWrappers=C,void 0===f&&(f=this.k),this.noiseTexture&&(o.noiseTexture=this.noiseTexture.clone()),o.k=f,this.preventAutoStart||o.start(),o}}of.BILLBOARDMODE_Y=2,of.BILLBOARDMODE_ALL=7,of.BILLBOARDMODE_STRETCHED=8,of.BILLBOARDMODE_STRETCHED_LOCAL=9,BP._ParseParticleSystem=of.Parse;var wf=Y(11438),df=Y(11429),Rf=Y(11319);Rf.c.prototype.createTransformFeedback=function(){const P=this._gl.createTransformFeedback();if(!P)throw new Error("Unable to create Transform Feedback");return P},Rf.c.prototype.deleteTransformFeedback=function(P){this._gl.deleteTransformFeedback(P)},Rf.c.prototype.bindTransformFeedback=function(P){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,P)},Rf.c.prototype.beginTransformFeedback=function(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(P?this._gl.POINTS:this._gl.TRIANGLES)},Rf.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Rf.c.prototype.setTranformFeedbackVaryings=function(P,f){this._gl.transformFeedbackVaryings(P,f,this._gl.INTERLEAVED_ATTRIBS)},Rf.c.prototype.bindTransformFeedbackBuffer=function(P){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,P?P.underlyingResource:null)},Rf.c.prototype.readTransformFeedbackBuffer=function(P){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,P)};const yf="clipPlaneFragmentDeclaration2",rf="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";c.e.IncludesShadersStore[yf]||(c.e.IncludesShadersStore[yf]=rf);Y(12532),Y(12535),Y(12540),Y(12545),Y(12548),Y(12551),Y(12558),Y(12562);const uf="gpuRenderParticlesPixelShader",gf="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";c.e.ShadersStore[uf]||(c.e.ShadersStore[uf]=gf);const Sf="clipPlaneVertexDeclaration2",Kf="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";c.e.IncludesShadersStore[Sf]||(c.e.IncludesShadersStore[Sf]=Kf);Y(12567),Y(12576),Y(12581),Y(12583);const Mf="gpuRenderParticlesVertexShader",Vf="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";c.e.ShadersStore[Mf]||(c.e.ShadersStore[Mf]=Vf);class Of extends w{static get IsSupported(){if(!h.e.LastCreatedEngine)return!1;const P=h.e.LastCreatedEngine.getCaps();return P.supportTransformFeedbacks||P.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(P){this._maxActiveParticleCount=Math.min(P,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(P){this.maxActiveParticleCount=P}createPointEmitter(P,f){const Y=HP(P,f);return this.particleEmitterType=Y,Y}createHemisphericEmitter(){const P=WP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createSphereEmitter(){const P=pP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=P,P}createDirectedSphereEmitter(){const P=hP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.Of(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0));return this.particleEmitterType=P,P}createCylinderEmitter(){const P=FP(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=P,P}createDirectedCylinderEmitter(){const P=Pf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.Of(0,1,0));return this.particleEmitterType=P,P}createConeEmitter(){const P=ff(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=P,P}createDirectedConeEmitter(){const P=Yf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.Of(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.Of(0,1,0));return this.particleEmitterType=P,P}createBoxEmitter(P,f,Y,C){const q=new y;return this.particleEmitterType=q,this.direction1=P,this.direction2=f,this.minEmitBox=Y,this.maxEmitBox=C,q}get flowMap(){return this._flowMap}set flowMap(P){this._flowMap!==P&&(this._flowMap=P)}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==of.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(of.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(of.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";P?setTimeout((()=>{this.start(0)}),P):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var P;let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(P=this._customWrappers[f])||void 0===P?void 0:P.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[P]??this._customWrappers[0]}setCustomEffect(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[f]=new PP.d(this._engine),this._customWrappers[f].effect=P}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new W.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(P,f,Y){return super._removeGradientAndTexture(P,f,Y),this._releaseBuffers(),this}addColorGradient(P,f){this._colorGradients||(this._colorGradients=[]);const Y=new z(P,f);return this._colorGradients.push(Y),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(P&&this._colorGradients.sort(((P,f)=>P.gradient<f.gradient?-1:P.gradient>f.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(P){return this._removeGradientAndTexture(P,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const f in this._drawWrappers){var P;null===(P=this._drawWrappers[f].drawContext)||void 0===P||P.reset()}}_addFactorGradient(P,f,Y){const C=new b(f,Y);P.push(C),this._releaseBuffers()}addSizeGradient(P,f){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,P,f),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(P){return this._removeGradientAndTexture(P,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(P,f){if(!P)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&P.sort(((P,f)=>P.gradient<f.gradient?-1:P.gradient>f.gradient?1:0));const Y=this;Y[f]&&(Y[f].dispose(),Y[f]=null)}addAngularSpeedGradient(P,f){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,P,f),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(P){return this._removeGradientAndTexture(P,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(P,f){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,P,f),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(P){return this._removeGradientAndTexture(P,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(P,f){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,P,f),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(P){return this._removeGradientAndTexture(P,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(P,f){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,P,f),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(P){return this._removeGradientAndTexture(P,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(P){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(P),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.vf=new W.e,this.onStoppedObservable=new W.e,this.onStartedObservable=new W.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,Y&&"Scene"!==Y.getClassName()?(this._engine=Y,this.defaultProjectionMatrix=C.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Y||h.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Rr.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,o.c)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,o.c)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,o.c)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,o.c)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new PP.d(this._engine)},this._customWrappers[0].effect=q,this._drawWrappers={0:new PP.d(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(f=f??{}).randomTextureSize||delete f.randomTextureSize;const L={eY:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...f},w=f;isFinite(w)&&(L.eY=w),this._capacity=L.eY,this._maxActiveParticleCount=L.eY,this._currentActiveCount=0,this._isAnimationSheetEnabled=m,this.particleEmitterType=new y;const d=Math.min(this._engine.getCaps().maxTextureSize,L.randomTextureSize);let R=[];for(let C=0;C<d;++C)R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),R.push(Math.random());this._randomTexture=new p.d(new Float32Array(R),d,1,5,Y,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,R=[];for(let C=0;C<d;++C)R.push(Math.random()),R.push(Math.random()),R.push(Math.random()),R.push(Math.random());this._randomTexture2=new p.d(new Float32Array(R),d,1,5,Y,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=d}_reset(){this._releaseBuffers()}_createVertexBuffers(P,f,Y){const C={};C.position=f.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let q=3;C.age=f.createVertexBuffer("age",q,1,this._attributesStrideSize,!0),q+=1,C.size=f.createVertexBuffer("size",q,3,this._attributesStrideSize,!0),q+=3,C.life=f.createVertexBuffer("life",q,1,this._attributesStrideSize,!0),q+=1,q+=4,this.billboardMode===of.BILLBOARDMODE_STRETCHED&&(C.direction=f.createVertexBuffer("direction",q,3,this._attributesStrideSize,!0)),q+=3,this._platform.alignDataInBuffer&&(q+=1),this.particleEmitterType instanceof O&&(q+=3,this._platform.alignDataInBuffer&&(q+=1)),this._colorGradientsTexture||(C.color=f.createVertexBuffer("color",q,4,this._attributesStrideSize,!0),q+=4),this._isBillboardBased||(C.initialDirection=f.createVertexBuffer("initialDirection",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),this.noiseTexture&&(C.noiseCoordinates1=f.createVertexBuffer("noiseCoordinates1",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1),C.noiseCoordinates2=f.createVertexBuffer("noiseCoordinates2",q,3,this._attributesStrideSize,!0),q+=3,this._platform.alignDataInBuffer&&(q+=1)),C.angle=f.createVertexBuffer("angle",q,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?q++:q+=2,this._isAnimationSheetEnabled&&(C.cellIndex=f.createVertexBuffer("cellIndex",q,1,this._attributesStrideSize,!0),q+=1,this.spriteRandomStartCell&&(C.cellStartOffset=f.createVertexBuffer("cellStartOffset",q,1,this._attributesStrideSize,!0),q+=1)),C.offset=Y.createVertexBuffer("offset",0,2),C.uv=Y.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(C),this._platform.createVertexBuffers(P,C),this.resetDrawCache()}_initialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!P)return;const f=this._engine,Y=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof O&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const q=this.particleEmitterType instanceof O,m=C.TmpVectors.Of[0];let L=0;for(let C=0;C<this._capacity;C++)if(Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(0),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),q?(this.particleEmitterType.particleDestinationGenerator(C,null,m),Y.push(m.x),Y.push(m.y),Y.push(m.z)):(Y.push(0),Y.push(0),Y.push(0)),this._platform.alignDataInBuffer&&Y.push(0),L+=16,q&&(this.particleEmitterType.particlePositionGenerator(C,null,m),Y.push(m.x),Y.push(m.y),Y.push(m.z),this._platform.alignDataInBuffer&&Y.push(0),L+=4),this._colorGradientsTexture||(Y.push(0),Y.push(0),Y.push(0),Y.push(0),L+=4),this.isBillboardBased||(Y.push(0),Y.push(0),Y.push(0),this._platform.alignDataInBuffer&&Y.push(0),L+=4),this.noiseTexture&&(Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),this._platform.alignDataInBuffer&&Y.push(0),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),this._platform.alignDataInBuffer&&Y.push(0),L+=8),Y.push(0),L+=1,this._angularSpeedGradientsTexture||(Y.push(0),L+=1),this._isAnimationSheetEnabled&&(Y.push(0),L+=1,this.spriteRandomStartCell&&(Y.push(0),L+=1)),this._platform.alignDataInBuffer){let P=3-(L+3&3);for(L+=P;P-- >0;)Y.push(0)}const o=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),w=this._platform.createParticleBuffer(Y),d=this._platform.createParticleBuffer(Y);this._buffer0=new n.c(f,w,!1,this._attributesStrideSize),this._buffer1=new n.c(f,d,!1,this._attributesStrideSize),this._spriteBuffer=new n.c(f,o,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let P=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(P+="\n#define BILLBOARD"),this._colorGradientsTexture&&(P+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(P+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(P+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(P+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(P+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(P+="\n#define DRAGGRADIENTS"),this._flowMap&&(P+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(P+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(P+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(P+="\n#define NOISE"),this.isLocal&&(P+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===P||(this._cachedUpdateDefines=P,this._updateBuffer=this._platform.createUpdateBuffer(P)),this._platform.isUpdateBufferReady()}_getWrapper(P){const f=this._getCustomDrawWrapper(P);if(null!==f&&void 0!==f&&f.effect)return f;const Y=[];this.fillDefines(Y,P);let C=this._drawWrappers[P];C||(C=new PP.d(this._engine),C.drawContext&&(C.drawContext.useInstancing=!0),this._drawWrappers[P]=C);const q=Y.join("\n");if(C.defines!==q){const P=[],f=[],Y=[];this.fillUniformsAttributesAndSamplerNames(f,P,Y),C.setEffect(this._engine.createEffect("gpuRenderParticles",P,f,Y,q),q)}return C}static _GetAttributeNamesOrOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const q=[n.d.PositionKind,"age","life","size","angle"];return P||q.push(n.d.ColorKind),f&&q.push("cellIndex"),Y||q.push("initialDirection"),C&&q.push("direction"),q.push("offset",n.d.UVKind),q}static _GetEffectCreationOptions(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["emitterWM","hw","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,fP.d)(C),P&&C.push("sheetInfos"),f&&C.push("logarithmicDepthConstant"),Y&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,fP.l)(this,this._scene,P),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==df.e.FOGMODE_NONE&&P.push("#define FOG")),f===of.BLENDMODE_MULTIPLY&&P.push("#define BLENDMULTIPLYMODE"),this.isLocal&&P.push("#define LOCAL"),this.useLogarithmicDepth&&P.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(P.push("#define BILLBOARD"),this.billboardMode){case of.BILLBOARDMODE_Y:P.push("#define BILLBOARDY");break;case of.BILLBOARDMODE_STRETCHED:P.push("#define BILLBOARDSTRETCHED");break;case of.BILLBOARDMODE_ALL:P.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&P.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&P.push("#define ANIMATESHEET"),Y&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),P.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(P,f,Y){f.push(...Of._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===of.BILLBOARDMODE_STRETCHED)),P.push(...Of._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Y.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(wf.d.PrepareUniforms(P,this._imageProcessingConfigurationDefines),wf.d.PrepareSamplers(Y,this._imageProcessingConfigurationDefines))}animate(){var P;let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(f?this.preWarmStepOffset:(null===(P=this._scene)||void 0===P?void 0:P.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(P,f){const Y=this[f];if(!P||!P.length||Y)return;const C=new Float32Array(this._rawTextureWidth);for(let q=0;q<this._rawTextureWidth;q++){const f=q/this._rawTextureWidth;H.GetCurrentGradient(f,P,((P,f,Y)=>{C[q]=(0,d.Lerp)(P.factor1,f.factor1,Y)}))}this[f]=p.d.CreateRTexture(C,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[f].name=f.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const P=new Uint8Array(4*this._rawTextureWidth),f=L.TmpColors.ro[0];for(let Y=0;Y<this._rawTextureWidth;Y++){const C=Y/this._rawTextureWidth;H.GetCurrentGradient(C,this._colorGradients,((C,q,m)=>{L.ro.LerpToRef(C.color1,q.color1,m,f),P[4*Y]=255*f.r,P[4*Y+1]=255*f.g,P[4*Y+2]=255*f.b,P[4*Y+3]=255*f.a}))}this._colorGradientsTexture=p.d.CreateRGBATexture(P,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(P,f){var Y,q,m,L;const o=this._getWrapper(P),w=o.effect;this._engine.enableEffect(o);const d=(null===(Y=this._scene)||void 0===Y?void 0:Y.getViewMatrix())||C.Matrix.IdentityReadOnly;if(w.setMatrix("view",d),w.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),w.setTexture("diffuseSampler",this.particleTexture),w.setVector2("translationPivot",this.translationPivot),w.setVector3("hw",this.hw),this.isLocal&&w.setMatrix("emitterWM",f),this._colorGradientsTexture?w.setTexture("colorGradientSampler",this._colorGradientsTexture):w.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const P=this.particleTexture.getBaseSize();w.setFloat3("sheetInfos",this.spriteCellWidth/P.width,this.spriteCellHeight/P.height,P.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const P=this._scene.activeCamera;w.setVector3("eyePosition",P.globalPosition)}const R=w.defines;if(this._scene&&((0,fP.f)(w,this,this._scene),this.applyFog&&(0,YP.d)(this._scene,void 0,w)),R.indexOf("#define BILLBOARDMODE_ALL")>=0){const P=d.clone();P.invert(),w.setMatrix("invView",P)}return this.useLogarithmicDepth&&this._scene&&(0,YP.i)(R,w,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(w),this._setEngineBasedOnBlendMode(P),this._platform.bindDrawBuffers(this._targetIndex,w,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(w),null!==(m=this._scene)&&void 0!==m&&m.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(L=this._scene)&&void 0!==L&&L.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(P){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!P)if(this.k.position){P=this.k.getWorldMatrix()}else{const f=this.k;P=C.TmpVectors.Matrix[0],C.Matrix.TranslationToRef(f.x,f.y,f.z,P)}const f=this._engine,Y=f.getDepthWrite();if(f.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const P=this.vP();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",P.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",P),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const q=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=q,f.setDepthWrite(Y)}render(){let P,f=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!f&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let P=0;P<this.preWarmCycles;P++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const P=0|this._accumulatedCount;this._accumulatedCount-=P,this._currentActiveCount+=P}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){P=this.k.getWorldMatrix()}else{const f=this.k;P=C.TmpVectors.Matrix[0],C.Matrix.TranslationToRef(f.x,f.y,f.z,P)}const q=this._engine;this.updateInAnimate||this._update(P);let m=0;return f||Y||(q.setState(!1),this.forceDepthWrite&&q.setDepthWrite(!0),m=this.blendMode===of.BLENDMODE_MULTIPLYADD?this._render(of.BLENDMODE_MULTIPLY,P)+this._render(of.BLENDMODE_ADD,P):this._render(this.blendMode,P),this._engine.setAlphaMode(0)),m}rebuild(){const P=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(P,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,P()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const f in this._drawWrappers){this._drawWrappers[f].dispose()}if(this._drawWrappers={},this._scene){const P=this._scene.Rr.indexOf(this);P>-1&&this._scene.Rr.splice(P,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let f=0;f<this._renderVertexBuffers.length;++f){const P=this._renderVertexBuffers[f];for(const f in P)P[f].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),P&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),P&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.vf.notifyObservers(this),this.vf.clear()}clone(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let q=null;const m=this._engine;if(m.createEffectForParticles&&null!=this.customShader){q=this.customShader;const P=q.shaderOptions.defines.length>0?q.shaderOptions.defines.join("\n"):"";C[0]=m.createEffectForParticles(q.shaderPath.fragmentElement,q.shaderOptions.uniforms,q.shaderOptions.samplers,P,void 0,void 0,void 0,this)}const L=this.serialize(Y),o=Of.Parse(L,this._scene||this._engine,this._rootUrl);return o.name=P,o.customShader=q,o._customWrappers=C,void 0===f&&(f=this.k),this.noiseTexture&&(o.noiseTexture=this.noiseTexture.clone()),o.k=f,o}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={};return of._Serialize(f,this,P),f.activeParticleCount=this.activeParticleCount,f.randomTextureSize=this._randomTextureSize,f.customShader=this.customShader,f}static Parse(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4?arguments[4]:void 0;const m=P.name;let L,o;f instanceof bP.c?L=f:(o=f,L=o.getEngine());const w=new Of(m,{eY:q||P.eY,randomTextureSize:P.randomTextureSize},f,null,P.isAnimationSheetEnabled);if(w._rootUrl=Y,P.customShader&&L.createEffectForParticles){const f=P.customShader,Y=f.shaderOptions.defines.length>0?f.shaderOptions.defines.join("\n"):"",C=L.createEffectForParticles(f.shaderPath.fragmentElement,f.shaderOptions.uniforms,f.shaderOptions.samplers,Y,void 0,void 0,void 0,w);w.setCustomEffect(C,0),w.customShader=f}return P.id&&(w.id=P.id),P.activeParticleCount&&(w.activeParticleCount=P.activeParticleCount),of._Parse(P,w,f,Y),P.preventAutoStart&&(w.preventAutoStart=P.preventAutoStart),C||w.preventAutoStart||w.start(),w}}var nf=Y(11014),lf=Y(12586),vf=Y(11569);class cf{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(P){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const f of this.systems)f.k=P;this._emitterNode=P}setEmitterAsSphere(P,f,Y){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:P,renderingGroupId:f};const C=(0,lf.e)("emitterSphere",{diameter:P.diameter,segments:P.segments},Y);C.renderingGroupId=f;const q=new vf.Uf("emitterSphereMaterial",Y);q.emissiveColor=P.color,C.material=q;for(const m of this.systems)m.k=C;this._emitterNode=C}start(P){for(const f of this.systems)P&&(f.k=P),f.start()}dispose(){for(const P of this.systems)P.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const f={systems:[]};for(const Y of this.systems)f.systems.push(Y.serialize(P));return this._emitterNode&&(f.k=this._emitterCreationOptions),f}static Parse(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;const q=new cf,m=this.BaseAssetsUrl+"/textures/";f=f||h.e.LastCreatedScene;for(const L of P.systems)q.systems.push(Y?Of.Parse(L,f,m,!0,C):of.Parse(L,f,m,!0,C));if(P.k){const Y=P.k.options;if("Sphere"===P.k.kind)q.setEmitterAsSphere({diameter:Y.diameter,segments:Y.segments,color:L.Df.ef(Y.color)},P.k.renderingGroupId,f)}return q}}cf.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Tf=Y(11046);class Uf{static CreateDefault(P){let f,Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,C=arguments.length>2?arguments[2]:void 0;f=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Of("default system",{eY:Y},C):new of("default system",Y,C),f.k=P;const q=nf.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return f.particleTexture=new J.c(q,f.vP()),f.createConeEmitter(.1,Math.PI/4),f.color1=new L.ro(1,1,1,1),f.color2=new L.ro(1,1,1,1),f.colorDead=new L.ro(1,1,1,0),f.minSize=.1,f.maxSize=.1,f.minEmitPower=2,f.maxEmitPower=2,f.updateSpeed=1/60,f.emitRate=30,f}static CreateAsync(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;f||(f=h.e.LastCreatedScene);const q={};return f.addPendingData(q),new Promise(((m,L)=>{if(Y&&!Of.IsSupported)return f.removePendingData(q),L("Particle system with GPU is not supported.");nf.Tools.LoadFile(`${Uf.BaseAssetsUrl}/systems/${P}.json`,(P=>{f.removePendingData(q);const L=JSON.parse(P.toString());return m(cf.Parse(L,f,Y,C))}),void 0,void 0,void 0,(()=>(f.removePendingData(q),L(`An error occurred with the creation of your particle system. Check if your type '${P}' exists.`))))}))}static ExportSet(P){const f=new cf;for(const Y of P)f.systems.push(Y);return f}static ParseFromFileAsync(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",m=arguments.length>5?arguments[5]:void 0;return new Promise(((L,o)=>{const w=new Tf.d;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const f=JSON.parse(w.responseText);let o;o=C?Of.Parse(f,Y,q,!1,m):of.Parse(f,Y,q,!1,m),P&&(o.name=P),L(o)}else o("Unable to load the particle system")})),w.open("GET",f),w.send()}))}static ParseFromSnippetAsync(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",q=arguments.length>4?arguments[4]:void 0;if("_BLANK"===P){const P=this.CreateDefault(null);return P.start(),Promise.resolve(P)}return new Promise(((m,L)=>{const o=new Tf.d;o.addEventListener("readystatechange",(()=>{if(4==o.readyState)if(200==o.status){const L=JSON.parse(JSON.parse(o.responseText).jsonPayload),w=JSON.parse(L.particleSystem);let d;d=Y?Of.Parse(w,f,C,!1,q):of.Parse(w,f,C,!1,q),d.snippetId=P,m(d)}else L("Unable to load the snippet "+P)})),o.open("GET",this.SnippetUrl+"/"+P.replace(/#/g,"/")),o.send()}))}}Uf.BaseAssetsUrl=cf.BaseAssetsUrl,Uf.SnippetUrl="https://snippet.babylonjs.com",Uf.CreateFromSnippetAsync=Uf.ParseFromSnippetAsync;var Df=Y(11648),jf=Y(11467),ef=Y(12595);(0,ef.g)(jf.d.NAME_PARTICLESYSTEM,((P,f,Y,C)=>{const q=(0,ef.j)(jf.d.NAME_PARTICLESYSTEM);if(q&&void 0!==P.Rr&&null!==P.Rr)for(let m=0,L=P.Rr.length;m<L;m++){const L=P.Rr[m];Y.Rr.push(q(L,f,C))}})),(0,ef.c)(jf.d.NAME_PARTICLESYSTEM,((P,f,Y)=>{if(P.activeParticleCount){return Of.Parse(P,f,Y)}return of.Parse(P,f,Y)})),bP.c.prototype.createEffectForParticles=function(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",m=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,w=arguments.length>7?arguments[7]:void 0,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,R=arguments.length>9?arguments[9]:void 0,y=[],r=[];const i=[];return w?w.fillUniformsAttributesAndSamplerNames(r,y,i):(y=of._GetAttributeNamesOrOptions(),r=of._GetEffectCreationOptions()),-1===q.indexOf(" BILLBOARD")&&(q+="\n#define BILLBOARD\n"),null!==w&&void 0!==w&&w.isAnimationSheetEnabled&&-1===q.indexOf(" ANIMATESHEET")&&(q+="\n#define ANIMATESHEET\n"),-1===C.indexOf("diffuseSampler")&&C.push("diffuseSampler"),this.createEffect({vertex:R??(null===w||void 0===w?void 0:w.vertexShaderName)??"particles",fragmentElement:P},y,r.concat(f),i.concat(C),q,m,L,o,void 0,d,(async()=>{0===d?await Promise.resolve().then(Y.bind(Y,12620)):await Promise.resolve().then(Y.bind(Y,12677))}))},Df.c.prototype.getEmittedParticleSystems=function(){const P=[];for(let f=0;f<this.vP().Rr.length;f++){const Y=this.vP().Rr[f];Y.k===this&&P.push(Y)}return P},Df.c.prototype.getHierarchyEmittedParticleSystems=function(){const P=[],f=this.getDescendants();f.push(this);for(let Y=0;Y<this.vP().Rr.length;Y++){const C=this.vP().Rr[Y],q=C.k;q.position&&-1!==f.indexOf(q)&&P.push(C)}return P};Y(11533),Y(11545),Y(11622);Y(11625),Y(12598),Y(11391),Y(11526),Y(11665);Y(11382);var sf;Y(12600),Y(11203);!function(P){P[P.Color=2]="Color",P[P.UV=1]="UV",P[P.Random=0]="Random",P[P.Stated=3]="Stated"}(sf||(sf={}));var af=Y(11421);const Qf=new C.Of(0,0,0),Jf=new C.Of(0,0,0),Nf=new C.Of(0,0,0);class If{constructor(P,f,Y){this.width=P,this.height=f,this.data=Y}processFlowable(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2?arguments[2]:void 0;if(!Y)return;Y instanceof C.Matrix?C.Of.TransformCoordinatesToRef(P.position,Y,Nf):(Nf.x=Y.x,Nf.y=Y.y,Nf.z=Y.z);const q=.5*Nf.x+.5,m=1-(.5*Nf.y+.5),L=Math.floor(q*this.width),o=Math.floor(m*this.height);if(L<0||L>=this.width||o<0||o>=this.height)return;const w=4*(o*this.width+L),d=this.data[w]/255*2-1,R=this.data[w+1]/255*2-1,y=this.data[w+2]/255*2-1,r=this.data[w+3]/255;Qf.set(d,R,y),Qf.scaleToRef(f*r,Jf),P.direction.addInPlace(Jf)}_processParticle(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Y=arguments.length>2?arguments[2]:void 0;this.processFlowable(P,f,Y)}static async FromUrlAsync(P){return await new Promise(((f,Y)=>{const C=document.createElement("canvas"),q=C.getContext("2d");let m=null;const L=new Image;L.crossOrigin="anonymous",L.src=P,L.onerror=f=>{Y(new Error(`Failed to load image: ${P} : ${f}`))},L.onload=()=>{C.width=L.width,C.height=L.height,q.drawImage(L,0,0),m=q.getImageData(0,0,C.width,C.height),f(new If(C.width,C.height,m.data))}}))}static async ExtractFromTextureAsync(P){return await new Promise(((f,Y)=>{if(!P.isReady())return void P.onLoadObservable.addOnce((async()=>{try{const Y=await this.ExtractFromTextureAsync(P);f(Y)}catch(C){Y(C)}}));const C=P.getSize();af.h.GetTextureDataAsync(P,C.width,C.height).then((P=>{f(new If(C.width,C.height,new Uint8ClampedArray(P)))})).catch(Y)}))}}var Xf,xf,kf,Zf,Af,Ef,tf,Gf,zf;!function(P){P[P.Int=1]="Int",P[P.Float=2]="Float",P[P.Vector2=4]="Vector2",P[P.Of=8]="Of",P[P.Matrix=16]="Matrix",P[P.Particle=32]="Particle",P[P.Texture=64]="Texture",P[P.ro=128]="ro",P[P.FloatGradient=256]="FloatGradient",P[P.Vector2Gradient=512]="Vector2Gradient",P[P.Vector3Gradient=1024]="Vector3Gradient",P[P.Color4Gradient=2048]="Color4Gradient",P[P.System=4096]="System",P[P.AutoDetect=8192]="AutoDetect",P[P.BasedOnInput=16384]="BasedOnInput",P[P.Undefined=32768]="Undefined",P[P.All=65535]="All"}(Xf||(Xf={})),function(P){P[P.Compatible=0]="Compatible",P[P.TypeIncompatible=1]="TypeIncompatible",P[P.HierarchyIssue=2]="HierarchyIssue"}(xf||(xf={})),function(P){P[P.Input=0]="Input",P[P.Output=1]="Output"}(kf||(kf={}));class Bf{get direction(){return this._direction}get type(){if(this._type===Xf.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Xf.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(P){this._type=P}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((P=>P.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(P,f,Y){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Xf.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new W.e,this.onDisconnectionObservable=new W.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=f,this.name=P,this._direction=Y}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(P){var f;return this.isConnected?null!==(f=this._connectedPoint)&&void 0!==f&&f._storedFunction?this._connectedPoint._storedFunction(P):this._connectedPoint._storedValue:this.value}canConnectTo(P){return 0===this.checkCompatibilityState(P)}checkCompatibilityState(P){const f=this._ownerBlock,Y=P.ownerBlock;if(this.type!==P.type&&P.innerType!==Xf.AutoDetect)return P.acceptedConnectionPointTypes&&-1!==P.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(P.excludedConnectionPointTypes&&-1!==P.excludedConnectionPointTypes.indexOf(this.type))return 1;let C=Y,q=f;return 0===this.direction&&(C=f,q=Y),C.isAnAncestorOf(q)?2:0}connectTo(P){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(P))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${P.ownerBlock.name}".${P.name}`;return this._endpoints.push(P),P._connectedPoint=this,this.onConnectionObservable.notifyObservers(P),P.onConnectionObservable.notifyObservers(this),this}disconnectFrom(P){const f=this._endpoints.indexOf(P);return-1===f||(this._endpoints.splice(f,1),P._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(P),P.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(P){let f=1;for(;f<Xf.All;)P&f||this.excludedConnectionPointTypes.push(f),f<<=1}serialize(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const f={};return f.name=this.name,f.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.If?(f.valueType="BABYLON."+this.value.getClassName(),f.value=this.value.If()):(f.valueType="number",f.value=this.value)),P&&this.connectedPoint&&(f.inputName=this.name,f.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,f.targetConnectionName=this.connectedPoint.name,f.isExposedOnFrame=!0,f.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(f.isExposedOnFrame=!0,f.exposedPortPosition=this.exposedPortPosition),f}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class bf{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(P){this._name=P}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(P){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new W.e,this.vf=new W.e,this.onInputChangedObservable=new W.e,this.visibleOnFrame=!1,this._name=P,this.uniqueId=N.b.UniqueId}_inputRename(P){return P}_outputRename(P){return P}isAnAncestorOf(P){for(const f of this._outputs)if(f.hasEndpoints)for(const Y of f.endpoints){if(Y.ownerBlock===P)return!0;if(Y.ownerBlock.isAnAncestorOf(P))return!0}return!1}isAnAncestorOfType(P){if(this.getClassName()===P)return!0;for(const f of this._outputs)if(f.hasEndpoints)for(const Y of f.endpoints)if(Y.ownerBlock.isAnAncestorOfType(P))return!0;return!1}getInputByName(P){const f=this._inputs.filter((f=>f.name===P));return f.length?f[0]:null}_linkConnectionTypes(P,f){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[f]._acceptedConnectionPointType=this._inputs[P]:(this._inputs[P]._linkedConnectionSource=this._inputs[f],this._inputs[P]._isMainLinkSource=!0),this._inputs[f]._linkedConnectionSource=this._inputs[P]}registerInput(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0,q=arguments.length>4?arguments[4]:void 0,m=arguments.length>5?arguments[5]:void 0;const L=new Bf(P,this,0);return L.type=f,L.isOptional=Y,L.defaultValue=C,L.value=C,L.valueMin=q,L.valueMax=m,this._inputs.push(L),this.onInputChangedObservable.notifyObservers(L),this}registerOutput(P,f,Y){return(Y=Y??new Bf(P,this,1)).type=f,this._outputs.push(Y),this}_build(P){}_customBuildStep(P){}build(P){if(this._buildId===P.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((P=>P.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=P.buildId;for(const f of this._inputs){if(!f.connectedPoint){f.isOptional||P.notConnectedNonOptionalInputs.push(f);continue}const Y=f.connectedPoint.ownerBlock;Y&&Y!==this&&!Y.isSystem&&Y.build(P)}return this._customBuildStep(P),P.verbose&&I.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(P),this.onBuildObservable.notifyObservers(this),!1}serialize(){const P={};P.customType="BABYLON."+this.getClassName(),P.id=this.uniqueId,P.name=this.name,P.visibleOnFrame=this.visibleOnFrame,P.inputs=[],P.outputs=[];for(const f of this.inputs)P.inputs.push(f.serialize());for(const f of this.outputs)P.outputs.push(f.serialize(!1));return P}_deserialize(P){this._name=P.name,this.comments=P.comments,this.visibleOnFrame=!!P.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(P)}_deserializePortDisplayNamesAndExposedOnFrame(P){const f=P.inputs,Y=P.outputs;if(f)for(const C of f){const P=this.inputs.find((P=>P.name===C.name));if(!P)return;if(C.displayName&&(P.displayName=C.displayName),C.isExposedOnFrame&&(P.isExposedOnFrame=C.isExposedOnFrame,P.exposedPortPosition=C.exposedPortPosition),void 0!==C.value&&null!==C.value)if("number"===C.valueType)P.value=C.value;else{const f=(0,o.c)(C.valueType);f&&(P.value=f.ef(C.value))}}if(Y)for(let C=0;C<Y.length;C++){const P=Y[C];P.displayName&&(this.outputs[C].displayName=P.displayName),P.isExposedOnFrame&&(this.outputs[C].isExposedOnFrame=P.isExposedOnFrame,this.outputs[C].exposedPortPosition=P.exposedPortPosition)}}clone(){const P=this.serialize(),f=(0,o.c)(P.customType);if(f){const Y=new f;return Y._deserialize(P),Y}return null}dispose(){this.vf.notifyObservers(this),this.vf.clear();for(const P of this.inputs)P.dispose();for(const P of this.outputs)P.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Hf(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",C=arguments.length>3?arguments[3]:void 0;return(q,m)=>{let L=q._propStore;L||(L=[],q._propStore=L),L.push({propertyName:m,displayName:P,type:f,groupName:Y,options:C??{},className:q.getClassName()})}}(0,s.b)([(0,a.F)("comment")],bf.prototype,"comments",void 0),function(P){P[P.Boolean=0]="Boolean",P[P.Float=1]="Float",P[P.Int=2]="Int",P[P.Vector2=3]="Vector2",P[P.List=4]="List",P[P.ro=5]="ro",P[P.SamplingMode=6]="SamplingMode",P[P.TextureFormat=7]="TextureFormat",P[P.TextureType=8]="TextureType"}(Zf||(Zf={})),function(P){P[P.None=0]="None",P[P.Position=1]="Position",P[P.Direction=2]="Direction",P[P.Age=3]="Age",P[P.Lifetime=4]="Lifetime",P[P.Color=5]="Color",P[P.ScaledDirection=6]="ScaledDirection",P[P.Scale=7]="Scale",P[P.AgeGradient=8]="AgeGradient",P[P.Angle=9]="Angle",P[P.SpriteCellIndex=16]="SpriteCellIndex",P[P.SpriteCellStart=17]="SpriteCellStart",P[P.SpriteCellEnd=18]="SpriteCellEnd"}(Af||(Af={})),function(P){P[P.None=0]="None",P[P.Time=1]="Time",P[P.Delta=2]="Delta",P[P.Emitter=3]="Emitter"}(Ef||(Ef={}));class Wf{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let P="";for(const f of this.notConnectedNonOptionalInputs)P+=`input ${f.name} from block ${f.ownerBlock.name}[${f.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(P)throw"Build of Node Particle System Set failed:\n"+P}adapt(P,f){const Y=P.getConnectedValue(this)||0;if(P.type===f)return Y;switch(f){case Xf.Vector2:return new C.Vector2(Y,Y);case Xf.Of:return new C.Of(Y,Y,Y);case Xf.ro:return new L.ro(Y,Y,Y,Y)}return null}getContextualValue(P){if(!this.particleContext||!this.systemContext)return null;switch(P){case Af.Position:return this.particleContext.position;case Af.Direction:return this.particleContext.direction;case Af.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Af.Color:return this.particleContext.color;case Af.Age:return this.particleContext.age;case Af.Lifetime:return this.particleContext.lifeTime;case Af.Angle:return this.particleContext.angle;case Af.Scale:return this.particleContext.scale;case Af.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Af.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Af.SpriteCellIndex:return this.particleContext.cellIndex;case Af.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.k.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.k.absolutePosition:this.systemContext.k:null}getSystemValue(P){if(!this.particleContext||!this.systemContext)return null;switch(P){case Ef.Time:return this.systemContext._actualFrame;case Ef.Delta:return this.systemContext._scaledUpdateSpeed;case Ef.Emitter:if(this.isEmitterTransformNode){return this.systemContext.k.absolutePosition}return this.systemContext.k}return null}}function pf(P,f,Y){const C=new Wf;C.lf=f;const q=P.createSystem(C);return q.canStart=()=>!0,q.k=Y.clone(),q.disposeOnStop=!0,q.start(),q}class hf extends bf{constructor(P){super(P),this.blendMode=w.BLENDMODE_ONEONE,this.eY=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Xf.Particle),this.registerInput("texture",Xf.Texture),this.registerInput("onStart",Xf.System,!0),this.registerInput("onEnd",Xf.System,!0),this.registerOutput("system",Xf.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(P){P.eY=this.eY,P.buildId=this._buildId++,this.build(P);const f=this.particle.getConnectedValue(P);return f.particleTexture=this.texture.getConnectedValue(P),f.emitRate=this.emitRate,f.blendMode=this.blendMode,f.name=this.name,f._nodeGenerated=!0,f._targetStopDuration=this.targetStopDuration,f.startDelay=this.startDelay,this.system._storedValue=this,f.canStart=()=>!this.doNoStart,f.onStartedObservable.add((Y=>{const C=this.onStart.getConnectedValue(P);C&&Y.onStartedObservable.addOnce((()=>{P.systemContext=f;const Y=pf(C,P.lf,P.emitterPosition);this.vf.addOnce((()=>{Y.dispose()}))}));const q=this.onEnd.getConnectedValue(P);q&&Y.onStoppedObservable.addOnce((()=>{P.systemContext=f;const Y=pf(q,P.lf,P.emitterPosition);this.vf.addOnce((()=>{Y.dispose()}))}))})),this.vf.addOnce((()=>{f.dispose()})),f}serialize(){const P=super.serialize();return P.eY=this.eY,P.emitRate=this.emitRate,P.blendMode=this.blendMode,P.doNoStart=this.doNoStart,P.targetStopDuration=this.targetStopDuration,P.startDelay=this.startDelay,P}_deserialize(P){super._deserialize(P),this.eY=P.eY,this.emitRate=P.emitRate,this.doNoStart=!!P.doNoStart,void 0!==P.blendMode&&(this.blendMode=P.blendMode),void 0!==P.targetStopDuration&&(this.targetStopDuration=P.targetStopDuration),void 0!==P.startDelay&&(this.startDelay=P.startDelay)}}(0,s.b)([Hf("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:w.BLENDMODE_ONEONE},{label:"Standard",value:w.BLENDMODE_STANDARD},{label:"Add",value:w.BLENDMODE_ADD},{label:"Multiply",value:w.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:w.BLENDMODE_MULTIPLYADD}]})],hf.prototype,"blendMode",void 0),(0,s.b)([Hf("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],hf.prototype,"eY",void 0),(0,s.b)([Hf("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hf.prototype,"emitRate",void 0),(0,s.b)([Hf("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hf.prototype,"targetStopDuration",void 0),(0,s.b)([Hf("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hf.prototype,"startDelay",void 0),(0,s.b)([Hf("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],hf.prototype,"doNoStart",void 0),(0,o.d)("BABYLON.SystemBlock",hf);class Ff extends bf{get type(){if(this._type===Xf.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Xf.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Xf.Vector2,this._type;case"Of":return this._type=Xf.Of,this._type;case"ro":return this._type=Xf.ro,this._type;case"Matrix":return this._type=Xf.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Af.None&&this._systemSource!==Ef.None}get systemSource(){return this._systemSource}set systemSource(P){if(this._systemSource=P,P!==Ef.None){switch(this._contextualSource=Af.None,this._type=Xf.Float,P){case Ef.Time:case Ef.Delta:this._type=Xf.Float;break;case Ef.Emitter:this._type=Xf.Of}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Af.None}get contextualValue(){return this._contextualSource}set contextualValue(P){if(this._contextualSource=P,P!==Af.None){switch(this._systemSource=Ef.None,P){case Af.Scale:this._type=Xf.Vector2;break;case Af.Position:case Af.Direction:case Af.ScaledDirection:this._type=Xf.Of;break;case Af.Color:this._type=Xf.ro;break;case Af.Age:case Af.Lifetime:case Af.Angle:case Af.AgeGradient:this._type=Xf.Float;break;case Af.SpriteCellEnd:case Af.SpriteCellStart:case Af.SpriteCellIndex:this._type=Xf.Int}this.output&&(this.output.type=this._type)}}constructor(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xf.AutoDetect;super(P),this._type=Xf.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new W.e,this._systemSource=Ef.None,this._contextualSource=Af.None,this._type=f,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",f)}get value(){return this._storedValue}set value(P){this.type===Xf.Float&&this.min!==this.max&&(P=Math.max(this.min,P),P=Math.min(this.max,P)),this._storedValue=P,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(P){this._valueCallback=P}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Xf.Int:case Xf.Float:this.value=0;break;case Xf.Vector2:this.value=C.Vector2.Zero();break;case Xf.Of:this.value=C.Of.Zero();break;case Xf.ro:this.value=new L.ro(1,1,1,1);break;case Xf.Matrix:this.value=C.Matrix.Identity()}}_build(P){super._build(P),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=P=>P.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=P=>P.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const P=super.serialize();return P.type=this.type,P.contextualValue=this.contextualValue,P.systemSource=this.systemSource,P.min=this.min,P.max=this.max,P.groupInInspector=this.groupInInspector,P.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.If?(P.valueType="BABYLON."+this._storedValue.getClassName(),P.value=this._storedValue.If()):(P.valueType="number",P.value=this._storedValue)),P}_deserialize(P){if(super._deserialize(P),this._type=P.type,this.contextualValue=P.contextualValue,this.systemSource=P.systemSource||Ef.None,this.min=P.min||0,this.max=P.max||0,this.groupInInspector=P.groupInInspector||"",void 0!==P.displayInInspector&&(this.displayInInspector=P.displayInInspector),P.valueType)if("number"===P.valueType)this._storedValue=P.value;else{const f=(0,o.c)(P.valueType);f&&(this._storedValue=f.ef(P.value))}}}(0,o.d)("BABYLON.ParticleInputBlock",Ff);class PY extends bf{get url(){return this._url}set url(P){this._url!==P&&(this._cachedData=null,this._url=P,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(P){this._textureDataUrl!==P&&(this._cachedData=null,this._textureDataUrl=P,this._url="",this._sourceTexture=null)}set sourceTexture(P){this._sourceTexture!==P&&(this._cachedData=null,this._sourceTexture=P,this._url="",this._textureDataUrl="")}constructor(P){super(P),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Xf.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const P=this.texture._storedValue;return await new Promise(((f,Y)=>{if(!P.isReady())return void P.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),f(this._cachedData)}catch(P){Y(P)}}));const C=P.getSize();af.h.GetTextureDataAsync(P,C.width,C.height).then((Y=>{this._cachedData={width:C.width,height:C.height,data:new Uint8ClampedArray(Y)},P.dispose(),f(this._cachedData)})).catch(Y)}))}_build(P){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new J.c(this._textureDataUrl,P.lf):this.texture._storedValue=new J.c(this._url,P.lf):this.texture._storedValue=null}serialize(){const P=super.serialize();return P.url=this.url,P.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(P.textureDataUrl=this.textureDataUrl),P}_deserialize(P){super._deserialize(P),this.url=P.url,this.serializedCachedData=!!P.serializedCachedData,P.textureDataUrl&&(this.textureDataUrl=P.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,o.d)("BABYLON.ParticleTextureSourceBlock",PY);class fY extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("position",Xf.Of),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(P){const f=this.particle.getConnectedValue(P);if(this.output._storedValue=f,!this.position.isConnected)return;const Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.position.q(this.position.getConnectedValue(P))},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y}}(0,o.d)("BABYLON.UpdatePositionBlock",fY),function(P){P[P.Add=0]="Add",P[P.Subtract=1]="Subtract",P[P.Multiply=2]="Multiply",P[P.Divide=3]="Divide",P[P.Max=4]="Max",P[P.Min=5]="Min"}(tf||(tf={}));class YY extends bf{constructor(P){super(P),this.operation=tf.Add,this.registerInput("left",Xf.AutoDetect),this.registerInput("right",Xf.AutoDetect),this.registerOutput("output",Xf.BasedOnInput),this.output._typeConnectionSource=this.left;const f=[Xf.Matrix,Xf.Particle,Xf.Texture,Xf.System,Xf.FloatGradient,Xf.Color4Gradient,Xf.Vector2Gradient,Xf.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...f),this.right.excludedConnectionPointTypes.push(...f),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(P){let f;const Y=this.left,q=this.right;if(!Y.isConnected||!q.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const m=Y.type===Xf.Float||Y.type===Xf.Int,o=q.type===Xf.Float||q.type===Xf.Int,w=m&&o;switch(this.operation){case tf.Add:f=w?P=>Y.getConnectedValue(P)+q.getConnectedValue(P):m?P=>P.adapt(Y,q.type).add(q.getConnectedValue(P)):P=>Y.getConnectedValue(P).add(P.adapt(q,Y.type));break;case tf.Subtract:f=w?P=>Y.getConnectedValue(P)-q.getConnectedValue(P):m?P=>P.adapt(Y,q.type).nf(q.getConnectedValue(P)):P=>Y.getConnectedValue(P).nf(P.adapt(q,Y.type));break;case tf.Multiply:f=w?P=>Y.getConnectedValue(P)*q.getConnectedValue(P):m?P=>P.adapt(Y,q.type).multiply(q.getConnectedValue(P)):P=>Y.getConnectedValue(P).multiply(P.adapt(q,Y.type));break;case tf.Divide:f=w?P=>Y.getConnectedValue(P)/q.getConnectedValue(P):m?P=>P.adapt(Y,q.type).divide(q.getConnectedValue(P)):P=>Y.getConnectedValue(P).divide(P.adapt(q,Y.type));break;case tf.Min:if(w)f=P=>Math.min(Y.getConnectedValue(P),q.getConnectedValue(P));else{const[P,o]=m?[q,Y]:[Y,q];switch(P.type){case Xf.Vector2:f=f=>C.Vector2.Minimize(P.getConnectedValue(f),f.adapt(o,P.type));break;case Xf.Of:f=f=>C.Of.Minimize(P.getConnectedValue(f),f.adapt(o,P.type));break;case Xf.ro:f=f=>{const Y=P.getConnectedValue(f),{r:C,g:q,b:m,a:w}=f.adapt(o,P.type);return new L.ro(Math.min(Y.r,C),Math.min(Y.g,q),Math.min(Y.b,m),Math.min(Y.a,w))}}}break;case tf.Max:if(!w){const[P,o]=m?[q,Y]:[Y,q];switch(P.type){case Xf.Vector2:f=f=>C.Vector2.Maximize(P.getConnectedValue(f),f.adapt(o,P.type));break;case Xf.Of:f=f=>C.Of.Maximize(P.getConnectedValue(f),f.adapt(o,P.type));break;case Xf.ro:f=f=>{const Y=P.getConnectedValue(f),{r:C,g:q,b:m,a:w}=f.adapt(o,P.type);return new L.ro(Math.max(Y.r,C),Math.min(Y.g,q),Math.min(Y.b,m),Math.min(Y.a,w))}}break}f=P=>Math.max(Y.getConnectedValue(P),q.getConnectedValue(P))}this.output._storedFunction=P=>Y.type===Xf.Int?0|f(P):f(P)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Xf.Int||this.left.type===Xf.Float&&this.right.type!==Xf.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[P,f]of[[this.left,this.right],[this.right,this.left]])P.acceptedConnectionPointTypes=[Xf.Int,Xf.Float],f.isConnected&&(P.acceptedConnectionPointTypes.push(f.type),f.type!==Xf.Int&&f.type!==Xf.Float||P.acceptedConnectionPointTypes.push(Xf.Vector2,Xf.Of,Xf.ro))}dispose(){super.dispose();for(const P of this._connectionObservers)P.remove();this._connectionObservers.length=0}serialize(){const P=super.serialize();return P.operation=this.operation,P}_deserialize(P){super._deserialize(P),this.operation=P.operation}}(0,s.b)([Hf("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:tf.Add},{label:"Subtract",value:tf.Subtract},{label:"Multiply",value:tf.Multiply},{label:"Divide",value:tf.Divide},{label:"Max",value:tf.Max},{label:"Min",value:tf.Min}]})],YY.prototype,"operation",void 0),(0,o.d)("BABYLON.ParticleMathBlock",YY);class CY extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("direction1",Xf.Of,!0,new C.Of(0,1,0)),this.registerInput("direction2",Xf.Of,!0,new C.Of(0,1,0)),this.registerInput("minEmitBox",Xf.Of,!0,new C.Of(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Xf.Of,!0,new C.Of(.5,.5,.5)),this.registerOutput("output",Xf.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(P){const f=this.particle.getConnectedValue(P);f._directionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.direction1.getConnectedValue(P),m=this.direction2.getConnectedValue(P),L=(0,d.RandomRange)(q.x,m.x),o=(0,d.RandomRange)(q.y,m.y),w=(0,d.RandomRange)(q.z,m.z);P.isEmitterTransformNode?C.Of.TransformNormalFromFloatsToRef(L,o,w,P.emitterWorldMatrix,Y.direction):Y.direction.do(L,o,w)},f._positionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.minEmitBox.getConnectedValue(P),m=this.maxEmitBox.getConnectedValue(P),L=(0,d.RandomRange)(q.x,m.x),o=(0,d.RandomRange)(q.y,m.y),w=(0,d.RandomRange)(q.z,m.z);P.isEmitterTransformNode?C.Of.TransformCoordinatesFromFloatsToRef(L,o,w,P.emitterWorldMatrix,Y.position):(Y.position.do(L,o,w),Y.position.addInPlace(P.emitterPosition))},this.output._storedValue=f}}(0,o.d)("BABYLON.BoxShapeBlock",CY);class qY extends bf{constructor(P){super(P),this.registerInput("emitPower",Xf.Float,!0,1),this.registerInput("lifeTime",Xf.Float,!0,1),this.registerInput("color",Xf.ro,!0,new L.ro(1,1,1,1)),this.registerInput("scale",Xf.Vector2,!0,new C.Vector2(1,1)),this.registerInput("angle",Xf.Float,!0,0),this.registerOutput("particle",Xf.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(P){const f=new of(this.name,P.eY,P.lf,null,!1,void 0,!0);f.particleEmitterType=new K,f._lifeTimeCreation.process=(f,Y)=>{P.particleContext=f,f.lifeTime=this.lifeTime.getConnectedValue(P),Y._emitPower=this.emitPower.getConnectedValue(P)},f._colorCreation.process=f=>{P.particleContext=f,f.color.q(this.color.getConnectedValue(P))},f._sizeCreation.process=f=>{P.particleContext=f,f.size=1,f.scale.q(this.scale.getConnectedValue(P))},f._angleCreation.process=f=>{P.particleContext=f,f.angle=this.angle.getConnectedValue(P)},this.particle._storedValue=f}}(0,o.d)("BABYLON.CreateParticleBlock",qY);class mY{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const P=[];for(const f of this.attachedBlocks)f.isInput&&P.push(f);return P}constructor(P){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new W.e,this.name=P}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(P)&&this.attachedBlocks.push(P);for(const Y of P.inputs){const C=Y.connectedPoint;if(C){const Y=C.ownerBlock;Y!==P&&this._initializeBlock(Y,f)}}}async buildAsync(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((Y=>{const C=new cf;for(const P of this._systemBlocks)this._initializeBlock(P);for(const q of this.systemBlocks){const Y=new Wf;Y.buildId=this._buildId++,Y.lf=P,Y.verbose=f;const m=q.createSystem(Y);Y.emitErrors(),C.systems.push(m)}this.onBuildObservable.notifyObservers(this),Y(C)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const P=new hf("Particle system"),f=new fY("Update position");f.output.connectTo(P.particle);const Y=new Ff("Position");Y.contextualValue=Af.Position;const C=new Ff("Scaled direction");C.contextualValue=Af.ScaledDirection;const q=new YY("Add");q.operation=tf.Add,Y.output.connectTo(q.left),C.output.connectTo(q.right),q.output.connectTo(f.position);const m=new qY("Create particle"),L=new CY("Box shape");m.particle.connectTo(L.particle),L.output.connectTo(f.particle);const o=new PY("Texture");o.texture.connectTo(P.texture),o.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(P)}removeBlock(P){const f=this.attachedBlocks.indexOf(P);if(f>-1&&this.attachedBlocks.splice(f,1),P.isSystem){const f=this._systemBlocks.indexOf(P);f>-1&&this._systemBlocks.splice(f,1)}}parseSerializedObject(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f||this.clear();const Y={};for(const C of P.OR){const P=(0,o.c)(C.customType);if(P){const f=new P;f._deserialize(C),Y[C.id]=f,this.attachedBlocks.push(f),f.isSystem&&this._systemBlocks.push(f)}}for(const C of this.attachedBlocks)if(C.isTeleportOut){const P=C,f=P._tempEntryPointUniqueId;if(f){const C=Y[f];C&&C.attachToEndpoint(P)}}for(let C=0;C<P.OR.length;C++){const q=P.OR[C],m=Y[q.id];m&&(m.inputs.length&&q.inputs.some((P=>P.targetConnectionName))&&!f||this._restoreConnections(m,P,Y))}if(P.locations||P.editorData&&P.editorData.locations){const C=P.locations||P.editorData.locations;for(const P of C)Y[P.eC]&&(P.eC=Y[P.eC].uniqueId);f&&this.editorData&&this.editorData.locations&&C.concat(this.editorData.locations),P.locations?this.editorData={locations:C}:(this.editorData=P.editorData,this.editorData.locations=C);const q=[];for(const P in Y)q[P]=Y[P].uniqueId;this.editorData.map=q}this.comment=P.comment}_restoreConnections(P,f,Y){for(const C of P.outputs)for(const q of f.OR){const m=Y[q.id];if(m)for(const L of q.inputs)if(Y[L.targetBlockId]!==P||L.targetConnectionName!==C.name);else{const P=m.getInputByName(L.inputName);if(!P||P.isConnected)continue;C.connectTo(P,!0),this._restoreConnections(m,f,Y)}}}serialize(P){const f=P?{}:Q.e.Serialize(this);f.editorData=JSON.parse(JSON.stringify(this.editorData));let Y=[];P?Y=P:f.customType="BABYLON.NodeParticleSystemSet",f.OR=[];for(const C of Y)f.OR.push(C.serialize());if(!P)for(const C of this.attachedBlocks)-1===Y.indexOf(C)&&f.OR.push(C.serialize());return f}dispose(){for(const P of this.attachedBlocks)P.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(P){const f=new mY(P);return f.setToDefault(),f}static Parse(P){const f=Q.e.Parse((()=>new mY(P.name)),P,null);return f.parseSerializedObject(P),f}static ParseFromSnippetAsync(P,f){return"_BLANK"===P?Promise.resolve(mY.CreateDefault("blank")):new Promise(((Y,C)=>{const q=new Tf.d;q.addEventListener("readystatechange",(()=>{if(4==q.readyState)if(200==q.status){const L=JSON.parse(JSON.parse(q.responseText).jsonPayload),o=JSON.parse(L.nodeParticle);f||(f=Q.e.Parse((()=>new mY(P)),o,null)),f.parseSerializedObject(o),f.snippetId=P;try{Y(f)}catch(m){C(m)}}else C("Unable to load the snippet "+P)})),q.open("GET",this.SnippetUrl+"/"+P.replace(/#/g,"/")),q.send()}))}}mY.EditorURL=`${nf.Tools._DefaultCdnUrl}/v${bP.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,mY.SnippetUrl="https://snippet.babylonjs.com",(0,s.b)([(0,a.F)()],mY.prototype,"name",void 0),(0,s.b)([(0,a.F)("comment")],mY.prototype,"comment",void 0),function(P){P[P.None=0]="None",P[P.PerParticle=1]="PerParticle",P[P.PerSystem=2]="PerSystem"}(Gf||(Gf={}));class LY extends bf{constructor(P){super(P),this._currentLockId=-2,this.lockMode=Gf.PerParticle,this.registerInput("min",Xf.AutoDetect,!0,0),this.registerInput("max",Xf.AutoDetect,!0,1),this.registerOutput("output",Xf.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xf.Float|Xf.Int|Xf.Vector2|Xf.Of|Xf.ro),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Xf.Float|Xf.Int|Xf.Vector2|Xf.Of|Xf.ro),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Xf.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let P=null;switch(this._currentLockId=-2,this.min.type){case Xf.AutoDetect:case Xf.Int:case Xf.Float:P=P=>{const f=this.min.getConnectedValue(P)||0,Y=this.max.getConnectedValue(P)||1;return f+Math.random()*(Y-f)};break;case Xf.Vector2:P=P=>{const f=this.min.getConnectedValue(P)||C.Vector2.Zero(),Y=this.max.getConnectedValue(P)||C.Vector2.One();return new C.Vector2(f.x+Math.random()*(Y.x-f.x),f.y+Math.random()*(Y.y-f.y))};break;case Xf.Of:P=P=>{const f=this.min.getConnectedValue(P)||C.Of.Zero(),Y=this.max.getConnectedValue(P)||C.Of.One();return new C.Of(f.x+Math.random()*(Y.x-f.x),f.y+Math.random()*(Y.y-f.y),f.z+Math.random()*(Y.z-f.z))};break;case Xf.ro:P=P=>{const f=this.min.getConnectedValue(P)||new L.ro(0,0,0,0),Y=this.max.getConnectedValue(P)||new L.ro(1,1,1,1);return new L.ro(f.x+Math.random()*(Y.x-f.x),f.y+Math.random()*(Y.y-f.y),f.z+Math.random()*(Y.z-f.z),f.w+Math.random()*(Y.w-f.w))}}this.output._storedFunction=f=>{var Y;let C=0;switch(this.lockMode){case Gf.PerParticle:C=(null===(Y=f.particleContext)||void 0===Y?void 0:Y.id)||-1;break;case Gf.PerSystem:C=f.buildId||0}return this._currentLockId!==C&&(this.lockMode!==Gf.None&&(this._currentLockId=C),this.output._storedValue=P(f)),this.output._storedValue}}serialize(){const P=super.serialize();return P.lockMode=this.lockMode,P}_deserialize(P){super._deserialize(P),this.lockMode=P.lockMode}}(0,s.b)([Hf("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Gf.None},{label:"Per particle",value:Gf.PerParticle},{label:"Per system",value:Gf.PerSystem}]})],LY.prototype,"lockMode",void 0),(0,o.d)("BABYLON.ParticleRandomBlock",LY);class oY extends bf{constructor(P){super(P),this._currentLockId=-2,this.lockMode=Gf.PerParticle,this.registerInput("min",Xf.AutoDetect),this.registerInput("max",Xf.AutoDetect),this.registerOutput("output",Xf.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const f=[Xf.Matrix,Xf.Particle,Xf.Texture,Xf.System,Xf.FloatGradient,Xf.Color4Gradient,Xf.Vector2Gradient,Xf.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...f),this.max.excludedConnectionPointTypes.push(...f)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let P=null;switch(this._currentLockId=-2,this.min.type){case Xf.Float:case Xf.Int:P=P=>{const f=this.min.getConnectedValue(P),Y=this.max.getConnectedValue(P);return Math.random()*(Y-f)+f};break;case Xf.Vector2:P=P=>{const f=this.min.getConnectedValue(P),Y=this.max.getConnectedValue(P);return new C.Vector2(Math.random()*(Y.x-f.x)+f.x,Math.random()*(Y.y-f.y)+f.y)};break;case Xf.Of:P=P=>{const f=this.min.getConnectedValue(P),Y=this.max.getConnectedValue(P);return new C.Of(Math.random()*(Y.x-f.x)+f.x,Math.random()*(Y.y-f.y)+f.y,Math.random()*(Y.z-f.z)+f.z)};break;case Xf.ro:P=P=>{const f=this.min.getConnectedValue(P),Y=this.max.getConnectedValue(P);return new L.ro(Math.random()*(Y.r-f.r)+f.r,Math.random()*(Y.g-f.g)+f.g,Math.random()*(Y.b-f.b)+f.b,Math.random()*(Y.a-f.a)+f.a)}}this.output._storedFunction=f=>{var Y;let C=0;switch(this.lockMode){case Gf.PerParticle:C=(null===(Y=f.particleContext)||void 0===Y?void 0:Y.id)||-1;break;case Gf.PerSystem:C=f.buildId||0}return this._currentLockId!==C&&(this.lockMode!==Gf.None&&(this._currentLockId=C),this.output._storedValue=P(f)),this.output._storedValue}}serialize(){const P=super.serialize();return P.lockMode=this.lockMode,P}_deserialize(P){super._deserialize(P),void 0!==P.lockMode&&(this.lockMode=P.lockMode)}}(0,s.b)([Hf("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Gf.None},{label:"Per particle",value:Gf.PerParticle},{label:"Per system",value:Gf.PerSystem}]})],oY.prototype,"lockMode",void 0),(0,o.d)("BABYLON.RandomRangeBlock",oY);(0,o.d)("BABYLON.ParticleLerpBlock",class extends bf{constructor(P){super(P),this.registerInput("left",Xf.AutoDetect),this.registerInput("right",Xf.AutoDetect),this.registerInput("gradient",Xf.Float,!0,0,0,1),this.registerOutput("output",Xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xf.Float|Xf.Int|Xf.Vector2|Xf.Of|Xf.ro)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const P=(P,f,Y)=>(1-P)*f+P*Y;this.output._storedFunction=f=>{const Y=this.left.getConnectedValue(f),q=this.right.getConnectedValue(f),m=this.gradient.getConnectedValue(f);switch(this.left.type){case Xf.Int:case Xf.Float:return P(m,Y,q);case Xf.Vector2:return new C.Vector2(P(m,Y.x,q.x),P(m,Y.y,q.y));case Xf.Of:return new C.Of(P(m,Y.x,q.x),P(m,Y.y,q.y),P(m,Y.z,q.z));case Xf.ro:return new L.ro(P(m,Y.r,q.r),P(m,Y.g,q.g),P(m,Y.b,q.b),P(m,Y.a,q.a))}return 0}}});(0,o.d)("BABYLON.UpdateDirectionBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("direction",Xf.Of),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(P){const f=this.particle.getConnectedValue(P);if(this.output._storedValue=f,!this.direction.isConnected)return;const Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.direction.q(this.direction.getConnectedValue(P))},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y}});(0,o.d)("BABYLON.UpdateColorBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("color",Xf.ro),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(P){const f=this.particle.getConnectedValue(P);if(this.output._storedValue=f,!this.color.isConnected)return;const Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.color.q(this.color.getConnectedValue(P))},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y}});(0,o.d)("BABYLON.UpdateScaleBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("scale",Xf.Vector2),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(P){const f=this.particle.getConnectedValue(P);if(this.output._storedValue=f,!this.scale.isConnected)return;const Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.scale.q(this.scale.getConnectedValue(P))},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y}});(0,o.d)("BABYLON.UpdateAngleBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("angle",Xf.Float),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(P){const f=this.particle.getConnectedValue(P);if(this.output._storedValue=f,!this.angle.isConnected)return;const Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.angle=this.angle.getConnectedValue(P)},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y}});(0,o.d)("BABYLON.BasicPositionUpdateBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(P){const f=this.particle.getConnectedValue(P),Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.direction.scaleToRef(f._directionScale,f._scaledDirection),Y.position.addInPlace(f._scaledDirection)},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y,this.output._storedValue=f}});(0,o.d)("BABYLON.BasicSpriteUpdateBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(P){const f=this.particle.getConnectedValue(P),Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.updateCellIndex()},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y,this.output._storedValue=f}});(0,o.d)("BABYLON.UpdateSpriteCellIndexBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("cellIndex",Xf.Int),this.registerOutput("output",Xf.Particle),this.cellIndex.acceptedConnectionPointTypes=[Xf.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(P){const f=this.particle.getConnectedValue(P);if(this.output._storedValue=f,!this.cellIndex.isConnected)return;const Y={process:Y=>{P.particleContext=Y,P.systemContext=f,Y.cellIndex=Math.floor(this.cellIndex.getConnectedValue(P))},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y}});class wY extends bf{constructor(P){super(P),this.strength=1,this.registerInput("particle",Xf.Particle),this.registerInput("flowMap",Xf.Texture),this.registerOutput("output",Xf.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(P){var f;const Y=this.particle.getConnectedValue(P),C=P.lf;let q;(null===(f=this.flowMap.connectedPoint)||void 0===f?void 0:f.ownerBlock).extractTextureContentAsync().then((P=>{P&&(q=new If(P.width,P.height,P.data))}));const m={process:P=>{const f=C.getTransformMatrix();q&&q._processParticle(P,this.strength*Y._tempScaledUpdateSpeed,f)},previousItem:null,nextItem:null};Y._updateQueueStart?AP(m,Y._updateQueueStart):Y._updateQueueStart=m,this.output._storedValue=Y}serialize(){const P=super.serialize();return P.strength=this.strength,P}_deserialize(P){super._deserialize(P),this.strength=P.strength}}(0,s.b)([Hf("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],wY.prototype,"strength",void 0),(0,o.d)("BABYLON.UpdateFlowMapBlock",wY);(0,o.d)("BABYLON.SphereShapeBlock",class extends bf{constructor(P){super(P),this.registerInput("input",Xf.Particle),this.registerInput("radius",Xf.Float,!0,1),this.registerInput("radiusRange",Xf.Float,!0,1,0,1),this.registerInput("directionRandomizer",Xf.Float,!0,0,0,1),this.registerOutput("output",Xf.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(P){const f=this.input.getConnectedValue(P);f._directionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.directionRandomizer.getConnectedValue(P),m=Y.position.nf(P.emitterPosition).normalize(),L=(0,d.RandomRange)(0,q),o=(0,d.RandomRange)(0,q),w=(0,d.RandomRange)(0,q);m.x+=L,m.y+=o,m.z+=w,m.normalize(),P.isEmitterTransformNode?C.Of.TransformNormalFromFloatsToRef(L,o,w,P.emitterWorldMatrix,Y.direction):Y.direction.do(L,o,w)},f._positionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.radius.getConnectedValue(P),m=this.radiusRange.getConnectedValue(P),L=q-(0,d.RandomRange)(0,q*m),o=(0,d.RandomRange)(0,1),w=(0,d.RandomRange)(0,2*Math.PI),R=Math.acos(2*o-1),y=L*Math.cos(w)*Math.sin(R),r=L*Math.cos(R),i=L*Math.sin(w)*Math.sin(R);P.isEmitterTransformNode?C.Of.TransformCoordinatesFromFloatsToRef(y,r,i,P.emitterWorldMatrix,Y.position):(Y.position.do(y,r,i),Y.position.addInPlace(P.emitterPosition))},this.output._storedValue=f}});(0,o.d)("BABYLON.PointShapeBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("direction1",Xf.Of,!0,new C.Of(0,1,0)),this.registerInput("direction2",Xf.Of,!0,new C.Of(0,1,0)),this.registerOutput("output",Xf.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){const f=this.particle.getConnectedValue(P);f._directionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.direction1.getConnectedValue(P),m=this.direction2.getConnectedValue(P),L=(0,d.RandomRange)(q.x,m.x),o=(0,d.RandomRange)(q.y,m.y),w=(0,d.RandomRange)(q.z,m.z);P.isEmitterTransformNode?C.Of.TransformNormalFromFloatsToRef(L,o,w,P.emitterWorldMatrix,Y.direction):Y.direction.do(L,o,w)},f._positionCreation.process=Y=>{P.systemContext=f,P.isEmitterTransformNode?C.Of.TransformCoordinatesFromFloatsToRef(0,0,0,P.emitterWorldMatrix,Y.position):Y.position.q(P.emitterPosition)},this.output._storedValue=f}});(0,o.d)("BABYLON.CustomShapeBlock",class extends bf{constructor(P){super(P),this.registerInput("particle",Xf.Particle),this.registerInput("position",Xf.Of,!0,new C.Of(0,0,0)),this.registerInput("direction",Xf.Of,!0,new C.Of(0,1,0)),this.registerOutput("output",Xf.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){const f=this.particle.getConnectedValue(P);f._directionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.direction.getConnectedValue(P);P.isEmitterTransformNode?C.Of.TransformNormalToRef(q,P.emitterWorldMatrix,Y.direction):Y.direction.q(q)},f._positionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.position.getConnectedValue(P);P.isEmitterTransformNode?C.Of.TransformCoordinatesToRef(q,P.emitterWorldMatrix,Y.position):(Y.position.q(q),Y.position.addInPlace(P.emitterPosition))},this.output._storedValue=f}});(0,o.d)("BABYLON.CylinderShapeBlock",class extends bf{constructor(P){super(P),this._tempVector=C.Of.Zero(),this.registerInput("particle",Xf.Particle),this.registerInput("radius",Xf.Float,!0,1),this.registerInput("height",Xf.Float,!0,1,0),this.registerInput("radiusRange",Xf.Float,!0,1,0,1),this.registerInput("directionRandomizer",Xf.Float,!0,0,0,1),this.registerOutput("output",Xf.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(P){const f=this.particle.getConnectedValue(P);f._directionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.directionRandomizer.getConnectedValue(P);Y.position.subtractToRef(P.emitterPosition,this._tempVector),this._tempVector.normalize(),P.isEmitterTransformNode&&C.Of.TransformNormalToRef(this._tempVector,P.emitterInverseWorldMatrix,this._tempVector);const m=(0,d.RandomRange)(-q/2,q/2);let L=Math.atan2(this._tempVector.x,this._tempVector.z);L+=(0,d.RandomRange)(-Math.PI/2,Math.PI/2)*q,this._tempVector.y=m,this._tempVector.x=Math.sin(L),this._tempVector.z=Math.cos(L),this._tempVector.normalize(),P.isEmitterTransformNode?C.Of.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,P.emitterWorldMatrix,Y.direction):Y.direction.q(this._tempVector)},f._positionCreation.process=Y=>{P.particleContext=Y,P.systemContext=f;const q=this.height.getConnectedValue(P),m=this.radiusRange.getConnectedValue(P),L=this.radius.getConnectedValue(P),o=(0,d.RandomRange)(-q/2,q/2),w=(0,d.RandomRange)(0,2*Math.PI),R=(0,d.RandomRange)((1-m)*(1-m),1),y=Math.sqrt(R)*L,r=y*Math.cos(w),i=y*Math.sin(w);P.isEmitterTransformNode?C.Of.TransformCoordinatesFromFloatsToRef(r,o,i,P.emitterWorldMatrix,Y.position):(Y.position.do(r,o,i),Y.position.addInPlace(P.emitterPosition))},this.output._storedValue=f}});class dY extends bf{constructor(P){super(P),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Xf.Particle),this.registerOutput("output",Xf.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);const f=this.particle.getConnectedValue(P);f._isAnimationSheetEnabled=!0,f.spriteCellWidth=this.width,f.spriteCellHeight=this.height,f.startSpriteCellID=this.start,f.endSpriteCellID=this.end,f.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=f}serialize(){const P=super.serialize();return P.width=this.width,P.height=this.height,P.start=this.start,P.end=this.end,P.randomStartCell=this.randomStartCell,P}_deserialize(P){super._deserialize(P),this.width=P.width,this.height=P.height,this.start=P.start,this.end=P.end,this.randomStartCell=P.randomStartCell}}(0,s.b)([Hf("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dY.prototype,"start",void 0),(0,s.b)([Hf("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dY.prototype,"end",void 0),(0,s.b)([Hf("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dY.prototype,"width",void 0),(0,s.b)([Hf("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],dY.prototype,"height",void 0),(0,s.b)([Hf("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],dY.prototype,"loop",void 0),(0,s.b)([Hf("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],dY.prototype,"randomStartCell",void 0),(0,o.d)("BABYLON.SetupSpriteSheetBlock",dY);class RY extends bf{constructor(P){super(P),this.reference=0,this.registerInput("value",Xf.AutoDetect),this.registerOutput("output",Xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=P=>{switch(P){case Xf.Float:return Xf.FloatGradient;case Xf.Vector2:return Xf.Vector2Gradient;case Xf.Of:return Xf.Vector3Gradient;case Xf.ro:return Xf.Color4Gradient}return P},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xf.Float|Xf.Vector2|Xf.Of|Xf.ro)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=P=>null}serialize(){const P=super.serialize();return P.reference=this.reference,P}_deserialize(P){super._deserialize(P),this.reference=P.reference}}(0,s.b)([Hf("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],RY.prototype,"reference",void 0),(0,o.d)("BABYLON.ParticleGradientValueBlock",RY);(0,o.d)("BABYLON.ParticleGradientBlock",class extends bf{constructor(P){super(P),this._entryCount=1,this.registerInput("gradient",Xf.Float,!0,1,0,1),this.registerInput("value0",Xf.AutoDetect),this.registerOutput("output",Xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=P=>{switch(P){case Xf.FloatGradient:return Xf.Float;case Xf.Vector2Gradient:return Xf.Vector2;case Xf.Vector3Gradient:return Xf.Of;case Xf.Color4Gradient:return Xf.ro}return P},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Xf.FloatGradient|Xf.Vector2Gradient|Xf.Vector3Gradient|Xf.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(P){this._inputs[P].onConnectionObservable.add((()=>{this._entryCount>P||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Xf.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const P=[];for(let Y=1;Y<this._inputs.length;Y++){var f;if(this._inputs[Y].isConnected)P.push(null===(f=this._inputs[Y].connectedPoint)||void 0===f?void 0:f.ownerBlock)}P.sort(((P,f)=>P.reference-f.reference)),this.output._storedFunction=f=>{const Y=this.gradient.getConnectedValue(f);if(1===P.length)return P[0].value.getConnectedValue(f);let q=null;for(let m=P.length-1;m>=0;m--){const o=P[m];if(o.reference<=Y){const P=o.value.getConnectedValue(f);if(q){const m=q.value.getConnectedValue(f),w=q.reference,R=o.reference,y=Math.max(0,Math.min(1,(Y-R)/(w-R)));switch(this.output.type){case Xf.Float:return(0,d.Lerp)(P,m,y);case Xf.Vector2:return C.Vector2.Lerp(P,m,y);case Xf.Of:return C.Of.Lerp(P,m,y);case Xf.ro:return L.ro.Lerp(P,m,y)}}return P}q=o}return 0}}});(0,o.d)("BABYLON.ParticleConverterBlock",class extends bf{constructor(P){super(P),this.registerInput("color ",Xf.ro,!0),this.registerInput("xyz ",Xf.Of,!0),this.registerInput("xy ",Xf.Vector2,!0),this.registerInput("zw ",Xf.Vector2,!0),this.registerInput("x ",Xf.Float,!0),this.registerInput("y ",Xf.Float,!0),this.registerInput("z ",Xf.Float,!0),this.registerInput("w ",Xf.Float,!0),this.registerOutput("color",Xf.ro),this.registerOutput("xyz",Xf.Of),this.registerOutput("xy",Xf.Vector2),this.registerOutput("zw",Xf.Vector2),this.registerOutput("x",Xf.Float),this.registerOutput("y",Xf.Float),this.registerOutput("z",Xf.Float),this.registerOutput("w",Xf.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(P){return"color "===P?"colorIn":"xyz "===P?"xyzIn":"xy "===P?"xyIn":"zw "===P?"zwIn":"x "===P?"xIn":"y "===P?"yIn":"z "===P?"zIn":"w "===P?"wIn":P}_outputRename(P){switch(P){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return P}}_build(P){super._build(P);const f=this.xIn,Y=this.yIn,q=this.zIn,m=this.wIn,o=this.xyIn,w=this.zwIn,d=this.xyzIn,R=this.colorIn,y=this.colorOut,r=this.xyzOut,i=this.xyOut,u=this.zwOut,g=this.xOut,S=this.yOut,K=this.zOut,M=this.wOut,V=P=>{if(R.isConnected)return R.getConnectedValue(P);let C=0,y=0,r=0,i=0;if(f.isConnected&&(C=f.getConnectedValue(P)),Y.isConnected&&(y=Y.getConnectedValue(P)),q.isConnected&&(r=q.getConnectedValue(P)),m.isConnected&&(i=m.getConnectedValue(P)),o.isConnected){const f=o.getConnectedValue(P);f&&(C=f.x,y=f.y)}if(w.isConnected){const f=w.getConnectedValue(P);f&&(r=f.x,i=f.y)}if(d.isConnected){const f=d.getConnectedValue(P);f&&(C=f.x,y=f.y,r=f.z)}return new L.ro(C,y,r,i)};y._storedFunction=P=>V(P),r._storedFunction=P=>{const f=V(P);return new C.Of(f.r,f.g,f.b)},i._storedFunction=P=>{const f=V(P);return new C.Vector2(f.r,f.g)},u._storedFunction=P=>{const f=V(P);return new C.Vector2(f.b,f.a)},g._storedFunction=P=>V(P).r,S._storedFunction=P=>V(P).g,K._storedFunction=P=>V(P).b,M._storedFunction=P=>V(P).a}}),function(P){P[P.Cos=0]="Cos",P[P.Sin=1]="Sin",P[P.Abs=2]="Abs",P[P.Exp=3]="Exp",P[P.Exp2=4]="Exp2",P[P.Round=5]="Round",P[P.Floor=6]="Floor",P[P.Ceiling=7]="Ceiling",P[P.Sqrt=8]="Sqrt",P[P.Log=9]="Log",P[P.Tan=10]="Tan",P[P.ArcTan=11]="ArcTan",P[P.ArcCos=12]="ArcCos",P[P.ArcSin=13]="ArcSin",P[P.Sign=14]="Sign",P[P.Negate=15]="Negate",P[P.OneMinus=16]="OneMinus",P[P.Reciprocal=17]="Reciprocal",P[P.ToDegrees=18]="ToDegrees",P[P.ToRadians=19]="ToRadians",P[P.Fract=20]="Fract"}(zf||(zf={}));class yY extends bf{constructor(P){super(P),this.operation=zf.Cos,this.registerInput("input",Xf.AutoDetect),this.registerOutput("output",Xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Xf.Float|Xf.Int|Xf.Vector2|Xf.Of|Xf.ro)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);let f=null;switch(this.operation){case zf.Cos:f=P=>Math.cos(P);break;case zf.Sin:f=P=>Math.sin(P);break;case zf.Abs:f=P=>Math.abs(P);break;case zf.Exp:f=P=>Math.exp(P);break;case zf.Exp2:f=P=>Math.pow(2,P);break;case zf.Round:f=P=>Math.round(P);break;case zf.Floor:f=P=>Math.floor(P);break;case zf.Ceiling:f=P=>Math.ceil(P);break;case zf.Sqrt:f=P=>Math.sqrt(P);break;case zf.Log:f=P=>Math.log(P);break;case zf.Tan:f=P=>Math.tan(P);break;case zf.ArcTan:f=P=>Math.atan(P);break;case zf.ArcCos:f=P=>Math.acos(P);break;case zf.ArcSin:f=P=>Math.asin(P);break;case zf.Sign:f=P=>Math.sign(P);break;case zf.Negate:f=P=>-P;break;case zf.OneMinus:f=P=>1-P;break;case zf.Reciprocal:f=P=>1/P;break;case zf.ToRadians:f=P=>P*Math.PI/180;break;case zf.ToDegrees:f=P=>180*P/Math.PI;break;case zf.Fract:f=P=>P>=0?P-Math.floor(P):P-Math.ceil(P)}if(!f)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Xf.Int:case Xf.Float:this.output._storedFunction=P=>{const Y=this.input.getConnectedValue(P);return f(Y)};break;case Xf.Vector2:this.output._storedFunction=P=>{const Y=this.input.getConnectedValue(P);return new C.Vector2(f(Y.x),f(Y.y))};break;case Xf.Of:this.output._storedFunction=P=>{const Y=this.input.getConnectedValue(P);return new C.Of(f(Y.x),f(Y.y),f(Y.z))};break;case Xf.ro:this.output._storedFunction=P=>{const Y=this.input.getConnectedValue(P);return new L.ro(f(Y.r),f(Y.g),f(Y.b),f(Y.a))}}return this}serialize(){const P=super.serialize();return P.operation=this.operation,P}_deserialize(P){super._deserialize(P),this.operation=P.operation}}(0,s.b)([Hf("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:zf.Cos},{label:"Sin",value:zf.Sin},{label:"Abs",value:zf.Abs},{label:"Exp",value:zf.Exp},{label:"Exp2",value:zf.Exp2},{label:"Round",value:zf.Round},{label:"Floor",value:zf.Floor},{label:"Ceiling",value:zf.Ceiling},{label:"Sqrt",value:zf.Sqrt},{label:"Log",value:zf.Log},{label:"Tan",value:zf.Tan},{label:"ArcTan",value:zf.ArcTan},{label:"ArcCos",value:zf.ArcCos},{label:"ArcSin",value:zf.ArcSin},{label:"Sign",value:zf.Sign},{label:"Negate",value:zf.Negate},{label:"OneMinus",value:zf.OneMinus},{label:"Reciprocal",value:zf.Reciprocal},{label:"ToDegrees",value:zf.ToDegrees},{label:"ToRadians",value:zf.ToRadians},{label:"Fract",value:zf.Fract}]})],yY.prototype,"operation",void 0),(0,o.d)("BABYLON.ParticleTrigonometryBlock",yY);var rY,iY=Y(12603);class uY extends bf{constructor(P){super(P),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Xf.AutoDetect),this.registerOutput("output",Xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Xf.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Xf.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xf.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xf.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Xf.System),this._inputs[0].excludedConnectionPointTypes.push(Xf.Particle),this._inputs[0].excludedConnectionPointTypes.push(Xf.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const f=P=>{const f=this.input.getConnectedValue(P);if(this.log.length>=this.stackSize)return f;if(null===f||void 0===f)return this.log.push(["null",""]),f;switch(this.input.type){case Xf.Vector2:this.log.push([(0,iY.h)(f,4),f.toString()]);break;case Xf.Of:this.log.push([(0,iY.k)(f,4),f.toString()]);break;case Xf.ro:this.log.push([`{R: ${f.r.toFixed(4)} G: ${f.g.toFixed(4)} B: ${f.b.toFixed(4)} A: ${f.a.toFixed(4)}}`,f.toString()]);break;default:this.log.push([f.toString(),f.toString()])}return f};this.output.isConnected?this.output._storedFunction=f:this.output._storedValue=f(P)}serialize(){const P=super.serialize();return P.stackSize=this.stackSize,P}_deserialize(P){super._deserialize(P),this.stackSize=P.stackSize}}(0,s.b)([Hf("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],uY.prototype,"stackSize",void 0),(0,o.d)("BABYLON.ParticleDebugBlock",uY);(0,o.d)("BABYLON.ParticleElbowBlock",class extends bf{constructor(P){super(P),this.registerInput("input",Xf.AutoDetect),this.registerOutput("output",Xf.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(P){super._build(P);const f=this._outputs[0],Y=this._inputs[0];f._storedFunction=P=>Y.getConnectedValue(P)}});(0,o.d)("BABYLON.ParticleTeleportInBlock",class extends bf{get endpoints(){return this._endpoints}constructor(P){super(P),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Xf.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(P){if(this.getClassName()===P)return!0;for(const f of this.endpoints)if(f.isAnAncestorOfType(P))return!0;return!1}isAnAncestorOf(P){for(const f of this.endpoints){if(f===P)return!0;if(f.isAnAncestorOf(P))return!0}return!1}attachToEndpoint(P){P.detach(),this._endpoints.push(P),P._entryPoint=this,P._outputs[0]._typeConnectionSource=this._inputs[0],P._tempEntryPointUniqueId=null,P.name="> "+this.name}detachFromEndpoint(P){const f=this._endpoints.indexOf(P);-1!==f&&(this._endpoints.splice(f,1),P._outputs[0]._typeConnectionSource=null,P._entryPoint=null)}_build(){for(const P of this._endpoints)P.output._storedFunction=P=>this.input.getConnectedValue(P)}});(0,o.d)("BABYLON.ParticleTeleportOutBlock",class extends bf{constructor(P){super(P),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Xf.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(P){this.entryPoint&&this.entryPoint.build(P)}clone(){const P=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(P),P}serialize(){var P;const f=super.serialize();return f.entryPoint=(null===(P=this.entryPoint)||void 0===P?void 0:P.uniqueId)??"",f}_deserialize(P){super._deserialize(P),this._tempEntryPointUniqueId=P.entryPoint}}),function(P){P[P.Equal=0]="Equal",P[P.NotEqual=1]="NotEqual",P[P.LessThan=2]="LessThan",P[P.GreaterThan=3]="GreaterThan",P[P.LessOrEqual=4]="LessOrEqual",P[P.GreaterOrEqual=5]="GreaterOrEqual",P[P.Xor=6]="Xor",P[P.Or=7]="Or",P[P.And=8]="And"}(rY||(rY={}));class gY extends bf{constructor(P){super(P),this.test=rY.Equal,this.epsilon=0,this.registerInput("left",Xf.Float),this.registerInput("right",Xf.Float,!0,0),this.registerInput("ifTrue",Xf.AutoDetect,!0,1),this.registerInput("ifFalse",Xf.AutoDetect,!0,0),this.registerOutput("output",Xf.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Xf.Float,this._inputs[0].acceptedConnectionPointTypes.push(Xf.Int),this._inputs[1].acceptedConnectionPointTypes.push(Xf.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const P=P=>{const f=this.left.getConnectedValue(P),Y=this.right.getConnectedValue(P);let C=!1;switch(this.test){case rY.Equal:C=(0,d.WithinEpsilon)(f,Y,this.epsilon);break;case rY.NotEqual:C=!(0,d.WithinEpsilon)(f,Y,this.epsilon);break;case rY.LessThan:C=f<Y+this.epsilon;break;case rY.GreaterThan:C=f>Y-this.epsilon;break;case rY.LessOrEqual:C=f<=Y+this.epsilon;break;case rY.GreaterOrEqual:C=f>=Y-this.epsilon;break;case rY.Xor:C=!!f&&!Y||!f&&!!Y;break;case rY.Or:C=!!f||!!Y;break;case rY.And:C=!!f&&!!Y}return C};this.output._storedFunction=f=>P(f)?this.ifTrue.getConnectedValue(f):this.ifFalse.getConnectedValue(f)}serialize(){const P=super.serialize();return P.test=this.test,P.epsilon=this.epsilon,P}_deserialize(P){super._deserialize(P),this.test=P.test,void 0!==P.epsilon&&(this.epsilon=P.epsilon)}}(0,s.b)([Hf("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:rY.Equal},{label:"NotEqual",value:rY.NotEqual},{label:"LessThan",value:rY.LessThan},{label:"GreaterThan",value:rY.GreaterThan},{label:"LessOrEqual",value:rY.LessOrEqual},{label:"GreaterOrEqual",value:rY.GreaterOrEqual},{label:"Xor",value:rY.Xor},{label:"Or",value:rY.Or},{label:"And",value:rY.And}]})],gY.prototype,"test",void 0),(0,s.b)([Hf("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gY.prototype,"epsilon",void 0),(0,o.d)("BABYLON.ParticleConditionBlock",gY);class SY extends bf{constructor(P){super(P),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Xf.Particle),this.registerInput("condition",Xf.Float,!0,0),this.registerInput("system",Xf.System),this.registerOutput("output",Xf.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(P){this._triggerCount=0;const f=this.input.getConnectedValue(P),Y={process:Y=>{if(P.particleContext=Y,P.systemContext=f,0!==this.condition.getConnectedValue(P)&&(0===this.limit||this._triggerCount<this.limit)){const C=(new Date).getTime();if(this._previousOne&&C-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=C;const q=this.system.getConnectedValue(P);if(q){const C=pf(q,P.lf,Y.position);C.vf.addOnce((()=>{this._triggerCount--})),f.vf.addOnce((()=>{C.dispose()}))}}},previousItem:null,nextItem:null};f._updateQueueStart?AP(Y,f._updateQueueStart):f._updateQueueStart=Y,this.output._storedValue=f}serialize(){const P=super.serialize();return P.limit=this.limit,P.delay=this.delay,P}_deserialize(P){super._deserialize(P),void 0!==P.limit&&(this.limit=P.limit),void 0!==P.delay&&(this.delay=P.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,s.b)([Hf("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],SY.prototype,"limit",void 0),(0,s.b)([Hf("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],SY.prototype,"delay",void 0),(0,o.d)("BABYLON.ParticleTriggerBlock",SY);Y(12606),Y(12620),Y(12630),Y(12677)},12660:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneFragment",m="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12633:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneFragmentDeclaration",m="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12697:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneVertex",m="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12682:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneVertexDeclaration",m="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12674:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogFragment",m="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12657:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogFragmentDeclaration",m="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12701:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogVertex",m="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12690:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogVertexDeclaration",m="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12647:(P,f,Y)=>{"use strict";var C=Y(11101);const q="helperFunctions",m="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12639:(P,f,Y)=>{"use strict";var C=Y(11101);const q="imageProcessingDeclaration",m="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12654:(P,f,Y)=>{"use strict";var C=Y(11101);const q="imageProcessingFunctions",m="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12642:(P,f,Y)=>{"use strict";var C=Y(11101);const q="logDepthDeclaration",m="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12667:(P,f,Y)=>{"use strict";var C=Y(11101);const q="logDepthFragment",m="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12708:(P,f,Y)=>{"use strict";var C=Y(11101);const q="logDepthVertex",m="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";C.e.IncludesShadersStoreWGSL[q]||(C.e.IncludesShadersStoreWGSL[q]=m)},12630:(P,f,Y)=>{"use strict";Y.r(f),Y.d(f,{particlesPixelShaderWGSL:()=>L});var C=Y(11101);Y(12633),Y(12639),Y(12642),Y(12647),Y(12654),Y(12657),Y(12660),Y(12667),Y(12674);const q="particlesPixelShader",m="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.e.ShadersStoreWGSL[q]||(C.e.ShadersStoreWGSL[q]=m);const L={name:q,shader:m}},12677:(P,f,Y)=>{"use strict";Y.r(f),Y.d(f,{particlesVertexShaderWGSL:()=>L});var C=Y(11101);Y(12682),Y(12690),Y(12642),Y(12697),Y(12701),Y(12708);const q="particlesVertexShader",m="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.e.ShadersStoreWGSL[q]||(C.e.ShadersStoreWGSL[q]=m);const L={name:q,shader:m}},12551:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneFragment",m="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12613:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneFragmentDeclaration",m="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12576:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneVertex",m="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12623:(P,f,Y)=>{"use strict";var C=Y(11101);const q="clipPlaneVertexDeclaration",m="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12562:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogFragment",m="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12548:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogFragmentDeclaration",m="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12581:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogVertex",m="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12567:(P,f,Y)=>{"use strict";var C=Y(11101);const q="fogVertexDeclaration",m="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12540:(P,f,Y)=>{"use strict";var C=Y(11101);const q="helperFunctions",m="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12532:(P,f,Y)=>{"use strict";var C=Y(11101);const q="imageProcessingDeclaration",m="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12545:(P,f,Y)=>{"use strict";var C=Y(11101);const q="imageProcessingFunctions",m="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12535:(P,f,Y)=>{"use strict";var C=Y(11101);const q="logDepthDeclaration",m="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12558:(P,f,Y)=>{"use strict";var C=Y(11101);const q="logDepthFragment",m="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12583:(P,f,Y)=>{"use strict";var C=Y(11101);const q="logDepthVertex",m="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";C.e.IncludesShadersStore[q]||(C.e.IncludesShadersStore[q]=m)},12606:(P,f,Y)=>{"use strict";Y.r(f),Y.d(f,{particlesPixelShader:()=>L});var C=Y(11101);Y(12613),Y(12532),Y(12535),Y(12540),Y(12545),Y(12548),Y(12551),Y(12558),Y(12562);const q="particlesPixelShader",m="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.e.ShadersStore[q]||(C.e.ShadersStore[q]=m);const L={name:q,shader:m}},12620:(P,f,Y)=>{"use strict";Y.r(f),Y.d(f,{particlesVertexShader:()=>L});var C=Y(11101);Y(12623),Y(12567),Y(12535),Y(12576),Y(12581),Y(12583);const q="particlesVertexShader",m="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.e.ShadersStore[q]||(C.e.ShadersStore[q]=m);const L={name:q,shader:m}},12982:(P,f,Y)=>{"use strict";Y.r(f),Y.d(f,{FlowGraphGLTFDataProvider:()=>m});var C=Y(12947),q=Y(12917);class m extends C.b{constructor(P){var f,Y;super();const C=P.glTF,m=(null===(f=C.animations)||void 0===f?void 0:f.map((P=>P._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",q.d,m);const L=(null===(Y=C.nodes)||void 0===Y?void 0:Y.map((P=>P._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",q.d,L)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12859:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>S,i:()=>u,k:()=>i,n:()=>g});var C=Y(11179),q=Y(11676),m=Y(11228),L=Y(12863);const o=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class w{constructor(P,f){this._gltf=P,this._infoTree=f}convert(P){let f,Y=this._gltf,C=this._infoTree;if(!P.startsWith("/"))throw new Error("Path must start with a /");const q=P.split("/");if(q.shift(),q[q.length-1].includes(".length")){const P=q[q.length-1].split(".");q.pop(),q.push(...P)}let m=!1;for(const w of q){const q="length"===w;if(q&&!C.__array__)throw new Error(`Path ${P} is invalid`);if(C.__ignoreObjectTree__&&(m=!0),C.__array__&&!q)C=C.__array__;else if(C=C[w],!C)throw new Error(`Path ${P} is invalid`);if(!m)if(void 0===Y){if(!o.find((f=>f.regex.test(P))))throw new Error(`Path ${P} is invalid`)}else if(!q){var L;Y=null===(L=Y)||void 0===L?void 0:L[w]}(C.__target__||q)&&(f=Y)}return{object:f,info:C}}}function d(P,f,Y,C){const q=R(P,f);return C?q[Y][C]:q[Y]}function R(P,f,Y){var C,m;return null===(C=P._data)||void 0===C||null===(m=C[(null===Y||void 0===Y?void 0:Y.fillMode)??q.e.MATERIAL_TriangleFillMode])||void 0===m?void 0:m.babylonMaterial}function y(P,f){return{offset:{componentsCount:2,type:"Vector2",get:(Y,q,m)=>{const L=d(Y,m,P,f);return new C.Vector2(null===L||void 0===L?void 0:L.uOffset,null===L||void 0===L?void 0:L.vOffset)},getTarget:R,set:(Y,C,q,m)=>{const L=d(C,m,P,f);L.uOffset=Y.x,L.vOffset=Y.y},getPropertyName:[()=>`${P}${f?"."+f:""}.uOffset`,()=>`${P}${f?"."+f:""}.vOffset`]},rotation:{type:"number",get:(Y,C,q)=>{var m;return null===(m=d(Y,q,P,f))||void 0===m?void 0:m.wAng},getTarget:R,set:(Y,C,q,m)=>d(C,m,P,f).wAng=Y,getPropertyName:[()=>`${P}${f?"."+f:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(Y,q,m)=>{const L=d(Y,m,P,f);return new C.Vector2(null===L||void 0===L?void 0:L.uScale,null===L||void 0===L?void 0:L.vScale)},getTarget:R,set:(Y,C,q,m)=>{const L=d(C,m,P,f);L.uScale=Y.x,L.vScale=Y.y},getPropertyName:[()=>`${P}${f?"."+f:""}.uScale`,()=>`${P}${f?"."+f:""}.vScale`]}}}const r={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:P=>{var f,Y;return new C.Vector2((null===(f=P._babylonCamera)||void 0===f?void 0:f.orthoLeft)??0,(null===(Y=P._babylonCamera)||void 0===Y?void 0:Y.orthoRight)??0)},set:(P,f)=>{f._babylonCamera&&(f._babylonCamera.orthoLeft=P.x,f._babylonCamera.orthoRight=P.y)},getTarget:P=>P,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:P=>{var f,Y;return new C.Vector2((null===(f=P._babylonCamera)||void 0===f?void 0:f.orthoBottom)??0,(null===(Y=P._babylonCamera)||void 0===Y?void 0:Y.orthoTop)??0)},set:(P,f)=>{f._babylonCamera&&(f._babylonCamera.orthoBottom=P.x,f._babylonCamera.orthoTop=P.y)},getTarget:P=>P,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:P=>{var f;return null===(f=P._babylonCamera)||void 0===f?void 0:f.maxZ},set:(P,f)=>{f._babylonCamera&&(f._babylonCamera.maxZ=P)},getTarget:P=>P,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:P=>{var f;return null===(f=P._babylonCamera)||void 0===f?void 0:f.zf},set:(P,f)=>{f._babylonCamera&&(f._babylonCamera.zf=P)},getTarget:P=>P,getPropertyName:[()=>"zf"]}},perspective:{aspectRatio:{type:"number",get:P=>{var f;return null===(f=P._babylonCamera)||void 0===f?void 0:f.getEngine().getAspectRatio(P._babylonCamera)},getTarget:P=>P,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:P=>{var f;return null===(f=P._babylonCamera)||void 0===f?void 0:f.fov},set:(P,f)=>{f._babylonCamera&&(f._babylonCamera.fov=P)},getTarget:P=>P,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:P=>{var f;return null===(f=P._babylonCamera)||void 0===f?void 0:f.maxZ},set:(P,f)=>{f._babylonCamera&&(f._babylonCamera.maxZ=P)},getTarget:P=>P,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:P=>{var f;return null===(f=P._babylonCamera)||void 0===f?void 0:f.zf},set:(P,f)=>{f._babylonCamera&&(f._babylonCamera.zf=P)},getTarget:P=>P,getPropertyName:[()=>"zf"]}}}},nodes:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Of",get:P=>{var f;return null===(f=P._babylonTransformNode)||void 0===f?void 0:f.position},set:(P,f)=>{var Y;return null===(Y=f._babylonTransformNode)||void 0===Y?void 0:Y.position.q(P)},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:P=>{var f;return null===(f=P._babylonTransformNode)||void 0===f?void 0:f.rotationQuaternion},set:(P,f)=>{var Y,C;return null===(Y=f._babylonTransformNode)||void 0===Y||null===(C=Y.rotationQuaternion)||void 0===C?void 0:C.q(P)},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Of",get:P=>{var f;return null===(f=P._babylonTransformNode)||void 0===f?void 0:f.Ro},set:(P,f)=>{var Y;return null===(Y=f._babylonTransformNode)||void 0===Y?void 0:Y.Ro.q(P)},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"Ro"]},weights:{length:{type:"number",get:P=>P._numMorphTargets,getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(P,f)=>{var Y,C;return void 0!==f?null===(Y=P._primitiveBabylonMeshes)||void 0===Y||null===(C=Y[0].morphTargetManager)||void 0===C?void 0:C.getTarget(f).influence:void 0},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(P,f)=>[0],getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:P=>{var f,Y,q;return C.Matrix.Compose(null===(f=P._babylonTransformNode)||void 0===f?void 0:f.Ro,null===(Y=P._babylonTransformNode)||void 0===Y?void 0:Y.rotationQuaternion,null===(q=P._babylonTransformNode)||void 0===q?void 0:q.position)},getTarget:P=>P._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:P=>{var f,Y,q,m;const L=C.Matrix.Identity();let o=P.parent;for(;o&&o.parent;)o=o.parent;const w=(null===(f=P._babylonTransformNode)||void 0===f?void 0:f.position._isDirty)||(null===(Y=P._babylonTransformNode)||void 0===Y||null===(q=Y.rotationQuaternion)||void 0===q?void 0:q._isDirty)||(null===(m=P._babylonTransformNode)||void 0===m?void 0:m.Ro._isDirty);if(o){var d;const f=null===(d=o._babylonTransformNode)||void 0===d?void 0:d.XC(!0).invert();var R,y;if(f)null===(R=P._babylonTransformNode)||void 0===R||null===(y=R.XC(w))||void 0===y||y.multiplyToRef(f,L)}else P._babylonTransformNode&&L.q(P._babylonTransformNode.XC(w));return L},getTarget:P=>P._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:P=>{var f,Y;return null===(f=P._babylonTransformNode)||void 0===f||null===(Y=f.getChildren((P=>P instanceof L.e),!0)[0])||void 0===Y?void 0:Y.So},getTarget:P=>{var f;return null===(f=P._babylonTransformNode)||void 0===f?void 0:f.getChildren((P=>P instanceof L.e),!0)[0]},set:(P,f)=>{if(f._babylonTransformNode){const Y=f._babylonTransformNode.getChildren((P=>P instanceof L.e),!0)[0];Y&&(Y.So=P)}}},color:{type:"Df",get:P=>{var f,Y;return null===(f=P._babylonTransformNode)||void 0===f||null===(Y=f.getChildren((P=>P instanceof L.e),!0)[0])||void 0===Y?void 0:Y.Ko},getTarget:P=>{var f;return null===(f=P._babylonTransformNode)||void 0===f?void 0:f.getChildren((P=>P instanceof L.e),!0)[0]},set:(P,f)=>{if(f._babylonTransformNode){const Y=f._babylonTransformNode.getChildren((P=>P instanceof L.e),!0)[0];Y&&(Y.Ko=P)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Df",get:(P,f,Y)=>R(P,f,Y).emissiveColor,set:(P,f,Y,C)=>R(f,Y,C).emissiveColor.q(P),getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:y("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(P,f,Y)=>{var C;return null===(C=d(P,Y,"bumpTexture"))||void 0===C?void 0:C.level},set:(P,f,Y,C)=>{const q=d(f,C,"bumpTexture");q&&(q.level=P)},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:y("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(P,f,Y)=>R(P,f,Y).ambientTextureStrength,set:(P,f,Y,C)=>{const q=R(f,Y,C);q&&(q.ambientTextureStrength=P)},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:y("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"ro",get:(P,f,Y)=>{const C=R(P,f,Y);return m.ro.FromColor3(C.albedoColor,C.alpha)},set:(P,f,Y,C)=>{const q=R(f,Y,C);q.albedoColor.set(P.r,P.g,P.b),q.alpha=P.a},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:y("albedoTexture")}},metallicFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).metallic,set:(P,f,Y,C)=>{const q=R(f,Y,C);q&&(q.metallic=P)},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).roughness,set:(P,f,Y,C)=>{const q=R(f,Y,C);q&&(q.roughness=P)},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:y("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(P,f,Y)=>R(P,f,Y).anisotropy.So,set:(P,f,Y,C)=>{R(f,Y,C).anisotropy.So=P},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(P,f,Y)=>R(P,f,Y).anisotropy.angle,set:(P,f,Y,C)=>{R(f,Y,C).anisotropy.angle=P},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:y("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).clearCoat.So,set:(P,f,Y,C)=>{R(f,Y,C).clearCoat.So=P},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).clearCoat.roughness,set:(P,f,Y,C)=>{R(f,Y,C).clearCoat.roughness=P},getTarget:(P,f,Y)=>R(P,f,Y),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:y("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(P,f,Y)=>{var C;return null===(C=R(P,f,Y).clearCoat.bumpTexture)||void 0===C?void 0:C.level},getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).clearCoat.bumpTexture.level=P},extensions:{KHR_texture_transform:y("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:y("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(P,f,Y)=>R(P,f,Y).subSurface.dispersion,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).subSurface.dispersion=P}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(P,f,Y)=>R(P,f,Y).emissiveIntensity,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).emissiveIntensity=P}},KHR_materials_ior:{ior:{type:"number",get:(P,f,Y)=>R(P,f,Y).indexOfRefraction,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).indexOfRefraction=P}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).iridescence.So,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).iridescence.So=P},iridescenceIor:{type:"number",get:(P,f,Y)=>R(P,f,Y).iridescence.indexOfRefraction,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).iridescence.indexOfRefraction=P},iridescenceTexture:{extensions:{KHR_texture_transform:y("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(P,f,Y)=>R(P,f,Y).iridescence.maximumThickness,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).iridescence.maximumThickness=P},iridescenceThicknessMinimum:{type:"number",get:(P,f,Y)=>R(P,f,Y).iridescence.minimumThickness,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).iridescence.minimumThickness=P},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:y("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Df",get:(P,f,Y)=>R(P,f,Y).sheen.color,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).sheen.color.q(P)},sheenColorTexture:{extensions:{KHR_texture_transform:y("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).sheen.So,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).sheen.So=P},sheenRoughnessTexture:{extensions:{KHR_texture_transform:y("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).metallicF0Factor,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).metallicF0Factor=P,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Df",get:(P,f,Y)=>R(P,f,Y).metallicReflectanceColor,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).metallicReflectanceColor.q(P),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:y("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:y("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).subSurface.refractionIntensity,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).subSurface.refractionIntensity=P,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).subSurface.translucencyIntensity,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).subSurface.translucencyIntensity=P},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Df",get:(P,f,Y)=>R(P,f,Y).subSurface.translucencyColor,getTarget:R,set:(P,f,Y,C)=>{var q;return P&&(null===(q=R(f,Y,C).subSurface.translucencyColor)||void 0===q?void 0:q.q(P))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:y("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Df",get:(P,f,Y)=>R(P,f,Y).subSurface.tintColor,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).subSurface.tintColor.q(P)},attenuationDistance:{type:"number",get:(P,f,Y)=>R(P,f,Y).subSurface.tintColorAtDistance,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).subSurface.tintColorAtDistance=P},thicknessFactor:{type:"number",get:(P,f,Y)=>R(P,f,Y).subSurface.maximumThickness,getTarget:R,set:(P,f,Y,C)=>R(f,Y,C).subSurface.maximumThickness=P},thicknessTexture:{extensions:{KHR_texture_transform:y("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonLight)),getPropertyName:[P=>"length"]},__array__:{__target__:!0,color:{type:"Df",get:P=>{var f;return null===(f=P._babylonLight)||void 0===f?void 0:f.Ko},set:(P,f)=>{var Y;return null===(Y=f._babylonLight)||void 0===Y?void 0:Y.Ko.q(P)},getTarget:P=>P._babylonLight,getPropertyName:[P=>"diffuse"]},So:{type:"number",get:P=>{var f;return null===(f=P._babylonLight)||void 0===f?void 0:f.So},set:(P,f)=>f._babylonLight?f._babylonLight.So=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"intensity"]},range:{type:"number",get:P=>{var f;return null===(f=P._babylonLight)||void 0===f?void 0:f.range},set:(P,f)=>f._babylonLight?f._babylonLight.range=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"range"]},spot:{innerConeAngle:{type:"number",get:P=>{var f;return null===(f=P._babylonLight)||void 0===f?void 0:f.innerAngle},set:(P,f)=>f._babylonLight?f._babylonLight.innerAngle=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"innerConeAngle"]},outerConeAngle:{type:"number",get:P=>{var f;return null===(f=P._babylonLight)||void 0===f?void 0:f.angle},set:(P,f)=>f._babylonLight?f._babylonLight.angle=P:void 0,getTarget:P=>P._babylonLight,getPropertyName:[P=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonLight)),getPropertyName:[P=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonTexture)),getPropertyName:[P=>"length"]},__array__:{__target__:!0,So:{type:"number",get:P=>{var f;return null===(f=P._babylonTexture)||void 0===f?void 0:f.level},set:(P,f)=>{f._babylonTexture&&(f._babylonTexture.level=P)},getTarget:P=>P._babylonTexture},rotation:{type:"Quaternion",get:P=>{var f;return P._babylonTexture&&C.Quaternion.FromRotationMatrix(null===(f=P._babylonTexture)||void 0===f?void 0:f.getReflectionTextureMatrix())},set:(P,f)=>{var Y;f._babylonTexture&&(null!==(Y=f._babylonTexture.vP())&&void 0!==Y&&Y.useRightHandedSystem||(P=C.Quaternion.Inverse(P)),C.Matrix.FromQuaternionToRef(P,f._babylonTexture.getReflectionTextureMatrix()))},getTarget:P=>P._babylonTexture}}}}},animations:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>P._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:P=>P.length,getTarget:P=>P.map((P=>{var f;return null===(f=P.primitives[0]._instanceData)||void 0===f?void 0:f.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function i(P){return new w(P,r)}function u(P){const f=P.split("/").map((P=>P.replace(/{}/g,"__array__")));let Y=r;for(const C of f)C&&(Y=Y[C]);if(Y&&Y.type&&Y.get)return Y}function g(P,f){const Y=P.split("/").map((P=>P.replace(/{}/g,"__array__")));let C=r;for(const q of Y)q&&(C=C[q]);C&&C.type&&C.get&&(C.interpolation=f)}function S(P,f){const Y=P.split("/").map((P=>P.replace(/{}/g,"__array__")));let C=r;for(const q of Y)if(q){if(!C[q]){if("?"===q){C.__ignoreObjectTree__=!0;continue}C[q]={},"__array__"===q&&(C[q].__target__=!0)}C=C[q]}Object.assign(C,f)}},12866:(P,f,Y)=>{"use strict";Y.r(f),Y.d(f,{AnimationPropertyInfo:()=>d,TransformNodeAnimationPropertyInfo:()=>R,WeightAnimationPropertyInfo:()=>y,getQuaternion:()=>o,getVector3:()=>L,getWeights:()=>w});var C=Y(11727),q=Y(11179),m=Y(12859);function L(P,f,Y,C){return q.Of.ef(f,Y).scaleInPlace(C)}function o(P,f,Y,C){return q.Quaternion.ef(f,Y).scaleInPlace(C)}function w(P,f,Y,C){const q=new Array(P._numMorphTargets);for(let m=0;m<q.length;m++)q[m]=f[Y++]*C;return q}class d{constructor(P,f,Y,C){this.type=P,this.name=f,this.getValue=Y,this.getStride=C}_buildAnimation(P,f,Y){const q=new C.b(P,this.name,f,this.type);return q.setKeys(Y),q}}class R extends d{buildAnimations(P,f,Y,C){const q=[];return q.push({babylonAnimatable:P._babylonTransformNode,babylonAnimation:this._buildAnimation(f,Y,C)}),q}}class y extends d{buildAnimations(P,f,Y,q){const m=[];if(P._numMorphTargets)for(let L=0;L<P._numMorphTargets;L++){const o=new C.b(`${f}_${L}`,this.name,Y,this.type);if(o.setKeys(q.map((P=>({frame:P.frame,inTangent:P.inTangent?P.inTangent[L]:void 0,value:P.value[L],outTangent:P.outTangent?P.outTangent[L]:void 0,interpolation:P.interpolation})))),P._primitiveBabylonMeshes)for(const f of P._primitiveBabylonMeshes)if(f.morphTargetManager){const P=f.morphTargetManager.getTarget(L),Y=o.clone();P.animations.push(Y),m.push({babylonAnimatable:P,babylonAnimation:Y})}}return m}}(0,m.n)("/nodes/{}/translation",[new R(C.b.ANIMATIONTYPE_VECTOR3,"position",L,(()=>3))]),(0,m.n)("/nodes/{}/rotation",[new R(C.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",o,(()=>4))]),(0,m.n)("/nodes/{}/scale",[new R(C.b.ANIMATIONTYPE_VECTOR3,"Ro",L,(()=>3))]),(0,m.n)("/nodes/{}/weights",[new y(C.b.ANIMATIONTYPE_FLOAT,"influence",w,(P=>P._numMorphTargets))])},12826:(P,f,Y)=>{"use strict";class C{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((P,f)=>{this._resolve=P,this._reject=f}))}}var q=Y(11179),m=Y(11228),L=Y(11014),o=Y(11657),w=Y(12833),d=Y(12840),R=Y(11018),y=Y(11671),r=Y(11727),i=Y(11730),u=Y(11052),g=Y(11025),S=Y(11031);class K{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(P){this._useTextureToStoreBoneMatrices=P,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(P){this._animationPropertiesOverride=P}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(P,f,Y){this.name=P,this.id=f,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=q.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new R.e,this.bones=[],this._scene=Y||u.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const C=this._scene.getEngine().getCaps();this._canUseTextureForBones=C.textureFloat&&C.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((P=>!P.getParent()))}getTransformMatrices(P){if(this.needInitialSkinMatrix){if(!P)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return P._bonesTransformMatrices||this.prepare(!0),P._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(P){return this.needInitialSkinMatrix&&P._transformMatrixTexture?P._transformMatrixTexture:this._transformMatrixTexture}vP(){return this._scene}toString(P){let f=`Name: ${this.name}, nBones: ${this.bones.length}`;if(f+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,P){f+=", Ranges: {";let P=!0;for(const Y in this._ranges)P&&(f+=", ",P=!1),f+=Y;f+="}"}return f}getBoneIndexByName(P){for(let f=0,Y=this.bones.length;f<Y;f++)if(this.bones[f].name===P)return f;return-1}createAnimationRange(P,f,Y){if(!this._ranges[P]){this._ranges[P]=new i.d(P,f,Y);for(let C=0,q=this.bones.length;C<q;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].createRange(P,f,Y)}}deleteAnimationRange(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Y=0,C=this.bones.length;Y<C;Y++)this.bones[Y].animations[0]&&this.bones[Y].animations[0].deleteRange(P,f);this._ranges[P]=null}getAnimationRange(P){return this._ranges[P]||null}getAnimationRanges(){const P=[];let f;for(f in this._ranges)P.push(this._ranges[f]);return P}copyAnimationRange(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[f]||!P.getAnimationRange(f))return!1;let C=!0;const q=this._getHighestAnimationFrame()+1,m={},L=P.bones;let o,w;for(w=0,o=L.length;w<o;w++)m[L[w].name]=L[w];this.bones.length!==L.length&&(g.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${L.length}`),C=!1);const d=Y&&this.dimensionsAtRest&&P.dimensionsAtRest?this.dimensionsAtRest.divide(P.dimensionsAtRest):null;for(w=0,o=this.bones.length;w<o;w++){const P=this.bones[w].name,L=m[P];L?C=C&&this.bones[w].copyAnimationRange(L,f,q,Y,d):(g.e.Warn("copyAnimationRange: not same rig, missing source bone "+P),C=!1)}const R=P.getAnimationRange(f);return R&&(this._ranges[f]=new i.d(f,R.from+q,R.to+q)),C}returnToRest(){for(const P of this.bones)-1!==P._index&&P.returnToRest()}_getHighestAnimationFrame(){let P=0;for(let f=0,Y=this.bones.length;f<Y;f++)if(this.bones[f].animations[0]){const Y=this.bones[f].animations[0].getHighestFrame();P<Y&&(P=Y)}return P}beginAnimation(P,f,Y,C){const q=this.getAnimationRange(P);return q?this._scene.beginAnimation(this,q.from,q.to,f,Y,C):null}static MakeAnimationAdditive(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Y=arguments.length>2?arguments[2]:void 0;const C=P.getAnimationRange(Y);if(!C)return null;const q=P._scene.getAllAnimatablesByTarget(P);let m=null;for(let o=0;o<q.length;o++){const P=q[o];if(P.fromFrame===(null===C||void 0===C?void 0:C.from)&&P.toFrame===(null===C||void 0===C?void 0:C.to)){m=P;break}}const L=P.getAnimatables();for(let o=0;o<L.length;o++){const P=L[o].animations;if(P)for(let C=0;C<P.length;C++)r.b.MakeAnimationAdditive(P[C],f,Y)}return m&&(m.isAdditive=!0),P}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(P){this._meshesWithPoseMatrix.push(P)}_unregisterMeshWithPoseMatrix(P){const f=this._meshesWithPoseMatrix.indexOf(P);f>-1&&this._meshesWithPoseMatrix.splice(f,1)}_computeTransformMatrices(P,f){this.onBeforeComputeObservable.notifyObservers(this);for(let Y=0;Y<this.bones.length;Y++){const C=this.bones[Y];C._childUpdateId++;const q=C.getParent();if(q?C.getLocalMatrix().multiplyToRef(q.getFinalMatrix(),C.getFinalMatrix()):f?C.getLocalMatrix().multiplyToRef(f,C.getFinalMatrix()):C.getFinalMatrix().q(C.getLocalMatrix()),-1!==C._index){const f=null===C._index?Y:C._index;C.getAbsoluteInverseBindMatrix().multiplyToArray(C.getFinalMatrix(),P,16*f)}}this._identity.copyToArray(P,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const P=this.vP().getRenderId();if(this._currentRenderId===P)return;this._currentRenderId=P}if(this._numBonesWithLinkedTransformNode>0)for(const P of this.bones)if(P._linkedTransformNode){const f=P._linkedTransformNode;P.position=f.position,f.rotationQuaternion?P.rotationQuaternion=f.rotationQuaternion:P.rotation=f.rotation,P.Ro=f.Ro}if(this.needInitialSkinMatrix)for(const P of this._meshesWithPoseMatrix){const f=P.getPoseMatrix();let Y=this._isDirty;if(P._bonesTransformMatrices&&P._bonesTransformMatrices.length===16*(this.bones.length+1)||(P._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Y=!0),Y){if(this._synchronizedWithMesh!==P){this._synchronizedWithMesh=P;for(const P of this.bones)if(!P.getParent()){P.getBindMatrix().multiplyToRef(f,q.TmpVectors.Matrix[1]),P._updateAbsoluteBindMatrices(q.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const f=4*(this.bones.length+1);P._transformMatrixTexture&&P._transformMatrixTexture.getSize().width===f||(P._transformMatrixTexture&&P._transformMatrixTexture.dispose(),P._transformMatrixTexture=y.d.CreateRGBATexture(P._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(P._bonesTransformMatrices,f),this.isUsingTextureForMatrices&&P._transformMatrixTexture&&P._transformMatrixTexture.update(P._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=y.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let P=0;P<this.bones.length;P++)this._animatables.push(this.bones[P])}return this._animatables}clone(P,f){const Y=new K(P,f||P,this._scene);Y.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){const P=this.bones[C];let f=null;const q=P.getParent();if(q){const P=this.bones.indexOf(q);f=Y.bones[P]}const m=new d.d(P.name,Y,f,P.getBindMatrix().clone(),P.getRestMatrix().clone());m._index=P._index,P._linkedTransformNode&&m.linkTransformNode(P._linkedTransformNode),S.e.DeepCopy(P.animations,m.animations)}if(this._ranges){Y._ranges={};for(const P in this._ranges){const f=this._ranges[P];f&&(Y._ranges[P]=f.clone())}}return this._isDirty=!0,Y.prepare(!0),Y}enableBlending(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const f of this.bones)for(const Y of f.animations)Y.enableBlending=!0,Y.blendingSpeed=P}dispose(){if(this._meshesWithPoseMatrix.length=0,this.vP().stopAnimation(this),this.vP().removeSkeleton(this),this._parentContainer){const P=this._parentContainer.skeletons.indexOf(this);P>-1&&this._parentContainer.skeletons.splice(P,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const P={};P.name=this.name,P.id=this.id,this.dimensionsAtRest&&(P.dimensionsAtRest=this.dimensionsAtRest.If()),P.bones=[],P.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Y=0;Y<this.bones.length;Y++){var f;const C=this.bones[Y],q=C.getParent(),m={parentBoneIndex:q?this.bones.indexOf(q):-1,index:C.getIndex(),name:C.name,id:C.id,matrix:C.getBindMatrix().If(),rest:C.getRestMatrix().If(),linkedTransformNodeId:null===(f=C.getTransformNode())||void 0===f?void 0:f.id};P.bones.push(m),C.length&&(m.length=C.length),C.metadata&&(m.metadata=C.metadata),C.animations&&C.animations.length>0&&(m.animation=C.animations[0].serialize()),P.ranges=[];for(const f in this._ranges){const Y=this._ranges[f];if(!Y)continue;const C={};C.name=f,C.from=Y.from,C.to=Y.to,P.ranges.push(C)}}return P}static Parse(P,f){const Y=new K(P.name,P.id,f);let C;for(P.dimensionsAtRest&&(Y.dimensionsAtRest=q.Of.ef(P.dimensionsAtRest)),Y.needInitialSkinMatrix=P.needInitialSkinMatrix,C=0;C<P.bones.length;C++){const f=P.bones[C],m=P.bones[C].index;let L=null;f.parentBoneIndex>-1&&(L=Y.bones[f.parentBoneIndex]);const o=f.rest?q.Matrix.ef(f.rest):null,w=new d.d(f.name,Y,L,q.Matrix.ef(f.matrix),o,null,m);void 0!==f.id&&null!==f.id&&(w.id=f.id),f.length&&(w.length=f.length),f.metadata&&(w.metadata=f.metadata),f.animation&&w.animations.push(r.b.Parse(f.animation)),void 0!==f.linkedTransformNodeId&&null!==f.linkedTransformNodeId&&(Y._hasWaitingData=!0,w._waitingTransformNodeId=f.linkedTransformNodeId)}if(P.ranges)for(C=0;C<P.ranges.length;C++){const f=P.ranges[C];Y.createAnimationRange(f.name,f.from,f.to)}return Y}computeAbsoluteMatrices(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||P)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(P)}getPoseMatrix(){let P=null;return this._meshesWithPoseMatrix.length>0&&(P=this._meshesWithPoseMatrix[0].getPoseMatrix()),P}sortBones(){const P=[],f=new Array(this.bones.length);for(let Y=0;Y<this.bones.length;Y++)this._sortBones(Y,P,f);this.bones=P}_sortBones(P,f,Y){if(Y[P])return;Y[P]=!0;const C=this.bones[P];if(!C)return;void 0===C._index&&(C._index=P);const q=C.getParent();q&&this._sortBones(this.bones.indexOf(q),f,Y),f.push(C)}setCurrentPoseAsRest(){for(const P of this.bones)P.setCurrentPoseAsRest()}}var M=Y(11524),V=Y(11687),O=Y(11160),n=Y(11612),l=Y(11255),v=Y(11660),c=Y(11622),T=Y(11648),U=Y(11734),D=Y(11280),j=Y(12792);class e{set areUpdatesFrozen(P){P?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new D.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,P||(P=u.e.LastCreatedScene),this._scene=P,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const P=this._scene.getEngine().getCaps();this._canUseTextureForTargets=P.canUseGLVertexID&&P.textureFloat&&P.maxVertexTextureImageUnits>0&&P.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return e.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?e.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(P){this._numMaxInfluencers!==P&&(this._numMaxInfluencers=P,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(P){this._useTextureToStoreTargets!==P&&(this._useTextureToStoreTargets=P,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var P;return e.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(P=this._scene)&&void 0!==P&&P.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(P){return this._activeTargets.data[P]}getTarget(P){return this._targets[P]}getTargetByName(P){for(const f of this._targets)if(f.name===P)return f;return null}addTarget(P){this._targets.push(P),this._targetInfluenceChangedObservers.push(P.onInfluenceChanged.add((P=>{this.areUpdatesFrozen&&P&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(P)}))),this._targetDataLayoutChangedObservers.push(P._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(P){const f=this._targets.indexOf(P);f>=0&&(this._targets.splice(f,1),P.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(f,1)[0]),P._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(f,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(P)}_bind(P){P.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),P.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),P.setTexture("morphTargets",this._targetStoreTexture),P.setInt("morphTargetCount",this.numInfluencers)}clone(){const P=new e(this._scene);for(const f of this._targets)P.addTarget(f.clone());return P.enablePositionMorphing=this.enablePositionMorphing,P.enableNormalMorphing=this.enableNormalMorphing,P.enableTangentMorphing=this.enableTangentMorphing,P.enableUVMorphing=this.enableUVMorphing,P.enableUV2Morphing=this.enableUV2Morphing,P.enableColorMorphing=this.enableColorMorphing,P}serialize(){const P={};P.id=this.uniqueId,P.targets=[];for(const f of this._targets)P.targets.push(f.serialize());return P}_syncActiveTargets(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const f=!!this._targetStoreTexture,Y=this.isUsingTextureForTargets;(this._mustSynchronize||f!==Y)&&(this._mustSynchronize=!1,this.synchronize());let C=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let q=-1;for(const m of this._targets)if(q++,0!==m.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=e.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(m),this._morphTargetTextureIndices[C]=q,this._tempInfluences[C++]=m.influence}this._morphTargetTextureIndices.length!==C&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,C)),this._influences&&this._influences.length===C||(this._influences=new Float32Array(C));for(let m=0;m<C;m++)this._influences[m]=this._tempInfluences[m];if(P&&this._scene)for(const m of this._scene.meshes)m.morphTargetManager===this&&(Y?m._markSubMeshesAsAttributesDirty():m._syncGeometryWithMorphTargetManager())}synchronize(){var P;if(!this._scene||this.areUpdatesFrozen)return;const f=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(P=this._targetStoreTexture)||void 0===P||P.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>f.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const Y of this._targets){this._supportsPositions=this._supportsPositions&&Y.hasPositions,this._supportsNormals=this._supportsNormals&&Y.hasNormals,this._supportsTangents=this._supportsTangents&&Y.hasTangents,this._supportsUVs=this._supportsUVs&&Y.hasUVs,this._supportsUV2s=this._supportsUV2s&&Y.hasUV2s,this._supportsColors=this._supportsColors&&Y.hasColors;const P=Y.vertexCount;if(0===this._vertexCount)this._vertexCount=P;else if(this._vertexCount!==P)return void g.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${Y.name}": ${P}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const P=f.getCaps().maxTextureSize;this._textureWidth>P&&(this._textureHeight=Math.ceil(this._textureWidth/P),this._textureWidth=P);const Y=this._targets.length,C=new Float32Array(Y*this._textureWidth*this._textureHeight*4);let q=0;for(let f=0;f<Y;f++){const P=this._targets[f],Y=P.getPositions(),m=P.getNormals(),L=P.getUVs(),o=P.getTangents(),w=P.getUV2s(),d=P.getColors();q=f*this._textureWidth*this._textureHeight*4;for(let f=0;f<this._vertexCount;f++)this._supportsPositions&&Y&&(C[q]=Y[3*f],C[q+1]=Y[3*f+1],C[q+2]=Y[3*f+2],q+=4),this._supportsNormals&&m&&(C[q]=m[3*f],C[q+1]=m[3*f+1],C[q+2]=m[3*f+2],q+=4),this._supportsUVs&&L&&(C[q]=L[2*f],C[q+1]=L[2*f+1],q+=4),this._supportsTangents&&o&&(C[q]=o[3*f],C[q+1]=o[3*f+1],C[q+2]=o[3*f+2],q+=4),this._supportsUV2s&&w&&(C[q]=w[2*f],C[q+1]=w[2*f+1],q+=4),this._supportsColors&&d&&(C[q]=d[4*f],C[q+1]=d[4*f+1],C[q+2]=d[4*f+2],C[q+3]=d[4*f+3],q+=4)}this._targetStoreTexture=j.d.CreateRGBATexture(C,this._textureWidth,this._textureHeight,Y,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const Y of this._scene.meshes)Y.morphTargetManager===this&&Y._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const P=this._parentContainer.morphTargetManagers.indexOf(this);P>-1&&this._parentContainer.morphTargetManagers.splice(P,1),this._parentContainer=null}for(const P of this._targets)this._scene.stopAnimation(P)}}static Parse(P,f){const Y=new e(f);for(const C of P.targets)Y.addTarget(U.e.Parse(C,f));return Y}}e.EnableTextureStorage=!0,e.MaxActiveMorphTargetsInVertexAttributeMode=8,e.ConstantTargetCountForTextureMode=0;var s=Y(12848),a=Y(11059),Q=Y(11533);const J=new Map,N=J;function I(P,f,Y){X(P)&&g.e.Warn(`Extension with the name '${P}' already exists`),J.set(P,{isGLTFExtension:f,factory:Y})}function X(P){return J.delete(P)}var x=Y(12859),k=Y(11806),Z=Y(11273);class A{static Get(P,f,Y){if(!f||void 0==Y||!f[Y])throw new Error(`${P}: Failed to find index (${Y})`);return f[Y]}static TryGet(P,f){return P&&void 0!=f&&P[f]?P[f]:null}static Assign(P){if(P)for(let f=0;f<P.length;f++)P[f].index=f}}function E(P){if(P.min&&P.max){const f=P.min,Y=P.max,C=q.TmpVectors.Of[0].do(f[0],f[1],f[2]),m=q.TmpVectors.Of[1].do(Y[0],Y[1],Y[2]);if(P.normalized&&5126!==P.componentType){let f=1;switch(P.componentType){case 5120:f=127;break;case 5121:f=255;break;case 5122:f=32767;break;case 5123:f=65535}const Y=1/f;C.scaleInPlace(Y),m.scaleInPlace(Y)}return new Q.c(C,m)}return null}class t{static RegisterExtension(P,f){I(P,!1,f)}static UnregisterExtension(P){return X(P)}get jf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(P){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=P}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((P=>P.dispose&&P.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(P,f,Y,C,q,m){let L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=f,this._assetContainer=Y,this._loadData(C);let m=null;if(P){const f={};if(this._gltf.nodes)for(const P of this._gltf.nodes)P.name&&(f[P.name]=P.index);m=(P instanceof Array?P:[P]).map((P=>{const Y=f[P];if(void 0===Y)throw new Error(`Failed to find node '${P}'`);return Y}))}return await this._loadAsync(q,L,m,(()=>({meshes:this._getMeshes(),Rr:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=P,this._loadData(f),await this._loadAsync(Y,q,null,(()=>{}))}async _loadAsync(P,f,Y,C){return await Promise.resolve().then((async()=>{this._rootUrl=P,this._uniqueRootUrl=!P.startsWith("file:")&&f?P:`${P}${Date.now()}/`,this._fileName=f,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const q=`${s.i[s.i.LOADING]} => ${s.i[s.i.READY]}`,m=`${s.i[s.i.LOADING]} => ${s.i[s.i.COMPLETE]}`;this._parent._startPerformanceCounter(q),this._parent._startPerformanceCounter(m),this._parent._setState(s.i.LOADING),this._extensionsOnLoading();const o=new Array;if(!this.parent.loadOnlyMaterials)if(Y)o.push(this.loadSceneAsync("/nodes",{nodes:Y,index:-1}));else if(void 0!=this._gltf.lf||this._gltf.scenes&&this._gltf.scenes[0]){const P=A.Get("/scene",this._gltf.scenes,this._gltf.lf||0);o.push(this.loadSceneAsync(`/scenes/${P.index}`,P))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let P=0;P<this._gltf.materials.length;++P){const f=this._gltf.materials[P],Y="/materials/"+P,C=M.d.TriangleFillMode;o.push(this._loadMaterialAsync(Y,f,null,C,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&o.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&o.push(this._compileShadowGeneratorsAsync());const w=Promise.all(o).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.No(!0);for(const P of this._babylonScene.materials){const f=P;void 0!==f.maxSimultaneousLights&&(f.maxSimultaneousLights=Math.max(f.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(s.i.READY),this._skipStartAnimationStep||this._startAnimations(),C()}));return await w.then((P=>(this._parent._endPerformanceCounter(q),L.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(m),this._parent._setState(s.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(P=>{this._parent.onErrorObservable.notifyObservers(P),this._parent.onErrorObservable.clear(),this.dispose()}))})),P)))})).catch((P=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(P),this._parent.onErrorObservable.clear(),this.dispose()),P}))}_loadData(P){if(this._gltf=P.json,this._setupData(),P.bin){const f=this._gltf.buffers;if(f&&f[0]&&!f[0].uri){const Y=f[0];(Y.byteLength<P.bin.byteLength-3||Y.byteLength>P.bin.byteLength)&&g.e.Warn(`Binary buffer length (${Y.byteLength}) from JSON does not match chunk length (${P.bin.byteLength})`),this._bin=P.bin}else g.e.Warn("Unexpected BIN chunk")}}_setupData(){if(A.Assign(this._gltf.accessors),A.Assign(this._gltf.animations),A.Assign(this._gltf.buffers),A.Assign(this._gltf.bufferViews),A.Assign(this._gltf.cameras),A.Assign(this._gltf.images),A.Assign(this._gltf.materials),A.Assign(this._gltf.meshes),A.Assign(this._gltf.nodes),A.Assign(this._gltf.samplers),A.Assign(this._gltf.scenes),A.Assign(this._gltf.skins),A.Assign(this._gltf.textures),this._gltf.nodes){const P={};for(const Y of this._gltf.nodes)if(Y.children)for(const f of Y.children)P[f]=Y.index;const f=this._createRootNode();for(const Y of this._gltf.nodes){const C=P[Y.index];Y.parent=void 0===C?f:this._gltf.nodes[C]}}}async _loadExtensionsAsync(){const P=[];if(N.forEach(((f,Y)=>{var C;!1===(null===(C=this.parent.extensionOptions[Y])||void 0===C?void 0:C.enabled)?f.isGLTFExtension&&this.isExtensionUsed(Y)&&g.e.Warn(`Extension ${Y} is used but has been explicitly disabled.`):f.isGLTFExtension&&!this.isExtensionUsed(Y)||P.push((async()=>{const P=await f.factory(this);return P.name!==Y&&g.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${P.name} !== ${Y}`),this._parent.onExtensionLoadedObservable.notifyObservers(P),P})())})),this._extensions.push(...await Promise.all(P)),this._extensions.sort(((P,f)=>(P.order||Number.MAX_VALUE)-(f.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Y of this._gltf.extensionsRequired){if(!this._extensions.some((P=>P.name===Y&&P.enabled))){var f;if(!1===(null===(f=this.parent.extensionOptions[Y])||void 0===f?void 0:f.enabled))throw new Error(`Required extension ${Y} is disabled`);throw new Error(`Required extension ${Y} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const P=new T.c("__root__",this._babylonScene);this._rootBabylonMesh=P,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.No(!1);const f={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case s.f.AUTO:this._babylonScene.useRightHandedSystem||(f.rotation=[0,1,0,0],f.scale=[1,1,-1],t._LoadTransform(f,this._rootBabylonMesh));break;case s.f.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(P),f}loadSceneAsync(P,f){const Y=this._extensionsLoadSceneAsync(P,f);if(Y)return Y;const C=new Array;if(this.logOpen(`${P} ${f.name||""}`),f.nodes)for(const q of f.nodes){const f=A.Get(`${P}/nodes/${q}`,this._gltf.nodes,q);C.push(this.loadNodeAsync(`/nodes/${f.index}`,f,(P=>{P.parent=this._rootBabylonMesh})))}for(const q of this._postSceneLoadActions)q();return C.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(C).then((()=>{}))}_forEachPrimitive(P,f){if(P._primitiveBabylonMeshes)for(const Y of P._primitiveBabylonMeshes)f(Y)}_getGeometries(){const P=[],f=this._gltf.nodes;if(f)for(const Y of f)this._forEachPrimitive(Y,(f=>{const Y=f.qq;Y&&-1===P.indexOf(Y)&&P.push(Y)}));return P}_getMeshes(){const P=[];this._rootBabylonMesh instanceof c.b&&P.push(this._rootBabylonMesh);const f=this._gltf.nodes;if(f)for(const Y of f)this._forEachPrimitive(Y,(f=>{P.push(f)}));return P}_getTransformNodes(){const P=[],f=this._gltf.nodes;if(f)for(const Y of f)Y._babylonTransformNode&&"Rd"===Y._babylonTransformNode.getClassName()&&P.push(Y._babylonTransformNode),Y._babylonTransformNodeForSkin&&P.push(Y._babylonTransformNodeForSkin);return P}_getSkeletons(){const P=[],f=this._gltf.skins;if(f)for(const Y of f)Y._data&&P.push(Y._data.babylonSkeleton);return P}_getAnimationGroups(){const P=[],f=this._gltf.animations;if(f)for(const Y of f)Y._babylonAnimationGroup&&P.push(Y._babylonAnimationGroup);return P}_startAnimations(){switch(this._parent.animationStartMode){case s.e.NONE:break;case s.e.FIRST:{const P=this._getAnimationGroups();0!==P.length&&P[0].start(!0);break}case s.e.ALL:{const P=this._getAnimationGroups();for(const f of P)f.start(!0);break}default:return void g.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadNodeAsync(P,f,Y);if(C)return C;if(f._babylonTransformNode)throw new Error(`${P}: Invalid recursive node hierarchy`);const q=new Array;this.logOpen(`${P} ${f.name||""}`);const m=C=>{if(t.AddPointerMetadata(C,P),t._LoadTransform(f,C),void 0!=f.camera){const Y=A.Get(`${P}/camera`,this._gltf.cameras,f.camera);q.push(this.loadCameraAsync(`/cameras/${Y.index}`,Y,(P=>{P.parent=C,this._babylonScene.useRightHandedSystem||(C.Ro.x=-1)})))}if(f.children)for(const Y of f.children){const f=A.Get(`${P}/children/${Y}`,this._gltf.nodes,Y);q.push(this.loadNodeAsync(`/nodes/${f.index}`,f,(P=>{P.parent=C})))}Y(C)},L=void 0!=f.mesh,o=this._parent.loadSkins&&void 0!=f.skin;if(!L||o){const P=f.name||`node${f.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new n.c(P,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==f.mesh?f._babylonTransformNode=Y:f._babylonTransformNodeForSkin=Y,m(Y)}if(L)if(o){const Y=A.Get(`${P}/mesh`,this._gltf.meshes,f.mesh);q.push(this._loadMeshAsync(`/meshes/${Y.index}`,f,Y,(Y=>{const C=f._babylonTransformNodeForSkin;Y.metadata=(0,k.b)(C.metadata,Y.metadata||{});const m=A.Get(`${P}/skin`,this._gltf.skins,f.skin);q.push(this._loadSkinAsync(`/skins/${m.index}`,f,m,(P=>{this._forEachPrimitive(f,(f=>{f.skeleton=P})),this._postSceneLoadActions.push((()=>{if(void 0!=m.skeleton){const P=A.Get(`/skins/${m.index}/skeleton`,this._gltf.nodes,m.skeleton).parent;f.index===P.index?Y.parent=C.parent:Y.parent=P._babylonTransformNode}else Y.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:C,skinnedNode:Y})}))})))})))}else{const Y=A.Get(`${P}/mesh`,this._gltf.meshes,f.mesh);q.push(this._loadMeshAsync(`/meshes/${Y.index}`,f,Y,m))}return this.logClose(),Promise.all(q).then((()=>(this._forEachPrimitive(f,(P=>{const f=P;!f.isAnInstance&&f.qq&&f.qq.useBoundingInfoFromGeometry?P.QP():P.refreshBoundingInfo(!0,!0)})),f._babylonTransformNode)))}_loadMeshAsync(P,f,Y,C){const q=Y.primitives;if(!q||!q.length)throw new Error(`${P}: Primitives are missing`);void 0==q[0].index&&A.Assign(q);const m=new Array;this.logOpen(`${P} ${Y.name||""}`);const L=f.name||`node${f.index}`;if(1===q.length){const C=Y.primitives[0];m.push(this._loadMeshPrimitiveAsync(`${P}/primitives/${C.index}`,L,f,Y,C,(P=>{f._babylonTransformNode=P,f._primitiveBabylonMeshes=[P]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,f._babylonTransformNode=new n.c(L,this._babylonScene),f._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._primitiveBabylonMeshes=[];for(const C of q)m.push(this._loadMeshPrimitiveAsync(`${P}/primitives/${C.index}`,`${L}_primitive${C.index}`,f,Y,C,(P=>{P.parent=f._babylonTransformNode,f._primitiveBabylonMeshes.push(P)})))}return C(f._babylonTransformNode),this.logClose(),Promise.all(m).then((()=>f._babylonTransformNode))}_loadMeshPrimitiveAsync(P,f,Y,C,q,m){const L=this._extensionsLoadMeshPrimitiveAsync(P,f,Y,C,q,m);if(L)return L;this.logOpen(`${P}`);const o=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Y.skin&&!C.primitives[0].targets;let w,d;if(o&&q._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,w=q._instanceData.babylonSourceMesh.createInstance(f),w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,d=q._instanceData.promise;else{const m=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new T.c(f,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,L.sideOrientation=this._babylonScene.useRightHandedSystem?M.d.CounterClockWiseSideOrientation:M.d.ClockWiseSideOrientation,this._createMorphTargets(P,Y,C,q,L),m.push(this._loadVertexDataAsync(P,q,L).then((async f=>await this._loadMorphTargetsAsync(P,q,L,f).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,f.sP(L),f._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const R=t._GetDrawMode(P,q.mode);if(void 0==q.material){let P=this._defaultBabylonMaterialData[R];P||(P=this._createDefaultMaterial("__GLTFLoader._default",R),this._parent.onMaterialLoadedObservable.notifyObservers(P),this._defaultBabylonMaterialData[R]=P),L.material=P}else if(!this.parent.skipMaterials){const f=A.Get(`${P}/material`,this._gltf.materials,q.material);m.push(this._loadMaterialAsync(`/materials/${f.index}`,f,L,R,(P=>{L.material=P})))}d=Promise.all(m),o&&(q._instanceData={babylonSourceMesh:L,promise:d}),w=L}return t.AddPointerMetadata(w,P),this._parent.onMeshLoadedObservable.notifyObservers(w),m(w),this.logClose(),d.then((()=>w))}_loadVertexDataAsync(P,f,Y){const C=this._extensionsLoadVertexDataAsync(P,f,Y);if(C)return C;const q=f.attributes;if(!q)throw new Error(`${P}: Attributes are missing`);const m=new Array,L=new v.c(Y.name,this._babylonScene);if(void 0==f.indices)Y.isUnIndexed=!0;else{const Y=A.Get(`${P}/indices`,this._gltf.accessors,f.indices);m.push(this._loadIndicesAccessorAsync(`/accessors/${Y.index}`,Y).then((P=>{L.setIndices(P)})))}const o=(f,C,o)=>{if(void 0==q[f])return;Y._delayInfo=Y._delayInfo||[],-1===Y._delayInfo.indexOf(C)&&Y._delayInfo.push(C);const w=A.Get(`${P}/attributes/${f}`,this._gltf.accessors,q[f]);m.push(this._loadVertexAccessorAsync(`/accessors/${w.index}`,w,C).then((P=>{if(P.getKind()===l.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Y.skeleton){const P=E(w);P&&(L._boundingInfo=P,L.useBoundingInfoFromGeometry=!0)}L.setVerticesBuffer(P,w.count)}))),C==l.d.MatricesIndicesExtraKind&&(Y.numBoneInfluencers=8),o&&o(w)};return o("POSITION",l.d.PositionKind),o("NORMAL",l.d.NormalKind),o("TANGENT",l.d.TangentKind),o("TEXCOORD_0",l.d.UVKind),o("TEXCOORD_1",l.d.UV2Kind),o("TEXCOORD_2",l.d.UV3Kind),o("TEXCOORD_3",l.d.UV4Kind),o("TEXCOORD_4",l.d.UV5Kind),o("TEXCOORD_5",l.d.UV6Kind),o("JOINTS_0",l.d.MatricesIndicesKind),o("WEIGHTS_0",l.d.MatricesWeightsKind),o("JOINTS_1",l.d.MatricesIndicesExtraKind),o("WEIGHTS_1",l.d.MatricesWeightsExtraKind),o("COLOR_0",l.d.ColorKind,(P=>{"VEC4"===P.type&&(Y.hasVertexAlpha=!0)})),Promise.all(m).then((()=>L))}_createMorphTargets(P,f,Y,C,q){if(!C.targets||!this._parent.loadMorphTargets)return;if(void 0==f._numMorphTargets)f._numMorphTargets=C.targets.length;else if(C.targets.length!==f._numMorphTargets)throw new Error(`${P}: Primitives do not have the same number of targets`);const m=Y.extras?Y.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,q.morphTargetManager=new e(this._babylonScene),q.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q.morphTargetManager.areUpdatesFrozen=!0;for(let L=0;L<C.targets.length;L++){const P=f.weights?f.weights[L]:Y.weights?Y.weights[L]:0,C=m?m[L]:`morphTarget${L}`;q.morphTargetManager.addTarget(new U.e(C,P,q.vP()))}}_loadMorphTargetsAsync(P,f,Y,C){if(!f.targets||!this._parent.loadMorphTargets)return Promise.resolve();const q=new Array,m=Y.morphTargetManager;for(let L=0;L<m.numTargets;L++){const Y=m.getTarget(L);q.push(this._loadMorphTargetVertexDataAsync(`${P}/targets/${L}`,C,f.targets[L],Y))}return Promise.all(q).then((()=>{m.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(P,f,Y,C){const q=new Array,m=(C,m,L)=>{if(void 0==Y[C])return;const o=f.getVertexBuffer(m);if(!o)return;const w=A.Get(`${P}/${C}`,this._gltf.accessors,Y[C]);q.push(this._loadFloatAccessorAsync(`/accessors/${w.index}`,w).then((P=>{L(o,P)})))};return m("POSITION",l.d.PositionKind,((P,f)=>{const Y=new Float32Array(f.length);P.forEach(f.length,((P,C)=>{Y[C]=f[C]+P})),C.setPositions(Y)})),m("NORMAL",l.d.NormalKind,((P,f)=>{const Y=new Float32Array(f.length);P.forEach(Y.length,((P,C)=>{Y[C]=f[C]+P})),C.setNormals(Y)})),m("TANGENT",l.d.TangentKind,((P,f)=>{const Y=new Float32Array(f.length/3*4);let q=0;P.forEach(f.length/3*4,((P,C)=>{(C+1)%4!==0&&(Y[q]=f[q]+P,q++)})),C.setTangents(Y)})),m("TEXCOORD_0",l.d.UVKind,((P,f)=>{const Y=new Float32Array(f.length);P.forEach(f.length,((P,C)=>{Y[C]=f[C]+P})),C.setUVs(Y)})),m("TEXCOORD_1",l.d.UV2Kind,((P,f)=>{const Y=new Float32Array(f.length);P.forEach(f.length,((P,C)=>{Y[C]=f[C]+P})),C.setUV2s(Y)})),m("COLOR_0",l.d.ColorKind,((f,Y)=>{let q=null;const m=f.getSize();if(3===m){q=new Float32Array(Y.length/3*4),f.forEach(Y.length,((P,f)=>{const C=Math.floor(f/3),m=f%3;q[4*C+m]=Y[3*C+m]+P}));for(let P=0;P<Y.length/3;++P)q[4*P+3]=1}else{if(4!==m)throw new Error(`${P}: Invalid number of components (${m}) for COLOR_0 attribute`);q=new Float32Array(Y.length),f.forEach(Y.length,((P,f)=>{q[f]=Y[f]+P}))}C.setColors(q)})),await Promise.all(q).then((()=>{}))}static _LoadTransform(P,f){if(void 0!=P.skin)return;let Y=q.Of.Zero(),C=q.Quaternion.Identity(),m=q.Of.One();if(P.matrix){q.Matrix.ef(P.matrix).decompose(m,C,Y)}else P.translation&&(Y=q.Of.ef(P.translation)),P.rotation&&(C=q.Quaternion.ef(P.rotation)),P.scale&&(m=q.Of.ef(P.scale));f.position=Y,f.rotationQuaternion=C,f.Ro=m}_loadSkinAsync(P,f,Y,C){if(!this._parent.loadSkins)return Promise.resolve();const q=this._extensionsLoadSkinAsync(P,f,Y);if(q)return q;if(Y._data)return C(Y._data.babylonSkeleton),Y._data.promise;const m=`skeleton${Y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new K(Y.name||m,m,this._babylonScene);L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(P,Y,L);const o=this._loadSkinInverseBindMatricesDataAsync(P,Y).then((P=>{this._updateBoneMatrices(L,P)}));return Y._data={babylonSkeleton:L,promise:o},C(L),o}_loadBones(P,f,Y){if(void 0==f.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Y=this._findSkeletonRootNode(`${P}/joints`,f.joints);if(Y)if(void 0===f.skeleton)f.skeleton=Y.index;else{const C=(P,f)=>{for(;f.parent;f=f.parent)if(f.parent===P)return!0;return!1},q=A.Get(`${P}/skeleton`,this._gltf.nodes,f.skeleton);q===Y||C(q,Y)||(g.e.Warn(`${P}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),f.skeleton=Y.index)}else g.e.Warn(`${P}: Failed to find common root`)}const C={};for(const q of f.joints){const m=A.Get(`${P}/joints/${q}`,this._gltf.nodes,q);this._loadBone(m,f,Y,C)}}_findSkeletonRootNode(P,f){if(0===f.length)return null;const Y={};for(const q of f){const f=[];let C=A.Get(`${P}/${q}`,this._gltf.nodes,q);for(;-1!==C.index;)f.unshift(C),C=C.parent;Y[q]=f}let C=null;for(let q=0;;++q){let P=Y[f[0]];if(q>=P.length)return C;const m=P[q];for(let L=1;L<f.length;++L)if(P=Y[f[L]],q>=P.length||m!==P[q])return C;C=m}}_loadBone(P,f,Y,C){P._isJoint=!0;let q=C[P.index];if(q)return q;let m=null;P.index!==f.skeleton&&(P.parent&&-1!==P.parent.index?m=this._loadBone(P.parent,f,Y,C):void 0!==f.skeleton&&g.e.Warn(`/skins/${f.index}/skeleton: Skeleton node is not a common root`));const L=f.joints.indexOf(P.index);return q=new d.d(P.name||`joint${P.index}`,Y,m,this._getNodeMatrix(P),null,null,L),C[P.index]=q,this._postSceneLoadActions.push((()=>{q.linkTransformNode(P._babylonTransformNode)})),q}_loadSkinInverseBindMatricesDataAsync(P,f){if(void 0==f.inverseBindMatrices)return Promise.resolve(null);const Y=A.Get(`${P}/inverseBindMatrices`,this._gltf.accessors,f.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Y.index}`,Y)}_updateBoneMatrices(P,f){for(const Y of P.bones){const P=q.Matrix.Identity(),C=Y._index;f&&-1!==C&&(q.Matrix.FromArrayToRef(f,16*C,P),P.invertToRef(P));const m=Y.getParent();m&&P.multiplyToRef(m.getAbsoluteInverseBindMatrix(),P),Y.bf(P,!1,!1),Y._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(P){return P.matrix?q.Matrix.ef(P.matrix):q.Matrix.Compose(P.scale?q.Of.ef(P.scale):q.Of.One(),P.rotation?q.Quaternion.ef(P.rotation):q.Quaternion.Identity(),P.translation?q.Of.ef(P.translation):q.Of.Zero())}loadCameraAsync(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadCameraAsync(P,f,Y);if(C)return C;const m=new Array;this.logOpen(`${P} ${f.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const L=new w.b(f.name||`camera${f.index}`,q.Of.Zero(),this._babylonScene,!1);switch(L._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._babylonCamera=L,L.setTarget(new q.Of(0,0,-1)),f.type){case"perspective":{const Y=f.perspective;if(!Y)throw new Error(`${P}: Camera perspective properties are missing`);L.fov=Y.yfov,L.zf=Y.znear,L.maxZ=Y.zfar||0;break}case"orthographic":if(!f.orthographic)throw new Error(`${P}: Camera orthographic properties are missing`);L.mode=o.e.ORTHOGRAPHIC_CAMERA,L.orthoLeft=-f.orthographic.xmag,L.orthoRight=f.orthographic.xmag,L.orthoBottom=-f.orthographic.ymag,L.orthoTop=f.orthographic.ymag,L.zf=f.orthographic.znear,L.maxZ=f.orthographic.zfar;break;default:throw new Error(`${P}: Invalid camera type (${f.type})`)}return t.AddPointerMetadata(L,P),this._parent.onCameraLoadedObservable.notifyObservers(L),Y(L),this.logClose(),Promise.all(m).then((()=>L))}_loadAnimationsAsync(){const P=this._gltf.animations;if(!P)return Promise.resolve();const f=new Array;for(let Y=0;Y<P.length;Y++){const C=P[Y];f.push(this.loadAnimationAsync(`/animations/${C.index}`,C).then((P=>{0===P.targetedAnimations.length&&P.dispose()})))}return Promise.all(f).then((()=>{}))}loadAnimationAsync(P,f){const C=this._extensionsLoadAnimationAsync(P,f);return C||Y.e(78).then(Y.bind(Y,14348)).then((Y=>{let{AnimationGroup:C}=Y;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q=new C(f.name||`animation${f.index}`,this._babylonScene);q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,f._babylonAnimationGroup=q;const m=new Array;A.Assign(f.channels),A.Assign(f.samplers);for(const L of f.channels)m.push(this._loadAnimationChannelAsync(`${P}/channels/${L.index}`,P,f,L,((P,f)=>{P.animations=P.animations||[],P.animations.push(f),q.addTargetedAnimation(f,P)})));return Promise.all(m).then((()=>(q.normalize(0),q)))}))}async _loadAnimationChannelAsync(P,f,C,q,m){const L=this._extensionsLoadAnimationChannelAsync(P,f,C,q,m);if(L)return await L;if(void 0==q.target.node)return await Promise.resolve();const o=A.Get(`${P}/target/node`,this._gltf.nodes,q.target.node),w=q.target.path,d="weights"===w;if(d&&!o._numMorphTargets||!d&&!o._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!d&&!o._isJoint)return await Promise.resolve();let R;switch(await Promise.resolve().then(Y.bind(Y,12866)),w){case"translation":var y;R=null===(y=(0,x.i)("/nodes/{}/translation"))||void 0===y?void 0:y.interpolation;break;case"rotation":var r;R=null===(r=(0,x.i)("/nodes/{}/rotation"))||void 0===r?void 0:r.interpolation;break;case"scale":var i;R=null===(i=(0,x.i)("/nodes/{}/scale"))||void 0===i?void 0:i.interpolation;break;case"weights":var u;R=null===(u=(0,x.i)("/nodes/{}/weights"))||void 0===u?void 0:u.interpolation;break;default:throw new Error(`${P}/target/path: Invalid value (${q.target.path})`)}if(!R)throw new Error(`${P}/target/path: Could not find interpolation properties for target path (${q.target.path})`);const g={object:o,info:R};return await this._loadAnimationChannelFromTargetInfoAsync(P,f,C,q,g,m)}_loadAnimationChannelFromTargetInfoAsync(P,f,Y,C,q,m){const L=this.parent.targetFps,o=1/L,w=A.Get(`${P}/sampler`,Y.samplers,C.sampler);return this._loadAnimationSamplerAsync(`${f}/samplers/${C.sampler}`,w).then((P=>{let f=0;const w=q.object,d=q.info;for(const q of d){const d=q.getStride(w),R=P.input,y=P.output,r=new Array(R.length);let i=0;switch(P.interpolation){case"STEP":for(let P=0;P<R.length;P++){const f=q.getValue(w,y,i,1);i+=d,r[P]={frame:R[P]*L,value:f,interpolation:1}}break;case"CUBICSPLINE":for(let P=0;P<R.length;P++){const f=q.getValue(w,y,i,o);i+=d;const Y=q.getValue(w,y,i,1);i+=d;const C=q.getValue(w,y,i,o);i+=d,r[P]={frame:R[P]*L,inTangent:f,value:Y,outTangent:C}}break;case"LINEAR":for(let P=0;P<R.length;P++){const f=q.getValue(w,y,i,1);i+=d,r[P]={frame:R[P]*L,value:f}}}if(i>0){const P=`${Y.name||`animation${Y.index}`}_channel${C.index}_${f}`,o=q.buildAnimations(w,P,L,r);for(const Y of o)f++,m(Y.babylonAnimatable,Y.babylonAnimation)}}}))}_loadAnimationSamplerAsync(P,f){if(f._data)return f._data;const Y=f.interpolation||"LINEAR";switch(Y){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${P}/interpolation: Invalid value (${f.interpolation})`)}const C=A.Get(`${P}/input`,this._gltf.accessors,f.input),q=A.Get(`${P}/output`,this._gltf.accessors,f.output);return f._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${C.index}`,C),this._loadFloatAccessorAsync(`/accessors/${q.index}`,q)]).then((P=>{let[f,C]=P;return{input:f,interpolation:Y,output:C}})),f._data}loadBufferAsync(P,f,Y,C){const q=this._extensionsLoadBufferAsync(P,f,Y,C);if(q)return q;if(!f._data)if(f.uri)f._data=this.loadUriAsync(`${P}/uri`,f,f.uri);else{if(!this._bin)throw new Error(`${P}: Uri is missing or the binary glTF is missing its binary chunk`);f._data=this._bin.readAsync(0,f.byteLength)}return f._data.then((f=>{try{return new Uint8Array(f.buffer,f.byteOffset+Y,C)}catch(q){throw new Error(`${P}: ${q.message}`)}}))}loadBufferViewAsync(P,f){const Y=this._extensionsLoadBufferViewAsync(P,f);if(Y)return Y;if(f._data)return f._data;const C=A.Get(`${P}/buffer`,this._gltf.buffers,f.buffer);return f._data=this.loadBufferAsync(`/buffers/${C.index}`,C,f.byteOffset||0,f.byteLength),f._data}_loadAccessorAsync(P,f,Y){if(f._data)return f._data;const C=t._GetNumComponents(P,f.type),q=C*l.d.GetTypeByteLength(f.componentType),m=C*f.count;if(void 0==f.bufferView)f._data=Promise.resolve(new Y(m));else{const L=A.Get(`${P}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${L.index}`,L).then((o=>{if(5126!==f.componentType||f.normalized||L.byteStride&&L.byteStride!==q){const P=new Y(m);return l.d.ForEach(o,f.byteOffset||0,L.byteStride||q,C,f.componentType,P.length,f.normalized||!1,((f,Y)=>{P[Y]=f})),P}return t._GetTypedArray(P,f.componentType,o,f.byteOffset,m)}))}if(f.sparse){const m=f.sparse;f._data=f._data.then((L=>{const o=L,w=A.Get(`${P}/sparse/indices/bufferView`,this._gltf.bufferViews,m.indices.bufferView),d=A.Get(`${P}/sparse/values/bufferView`,this._gltf.bufferViews,m.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${w.index}`,w),this.loadBufferViewAsync(`/bufferViews/${d.index}`,d)]).then((L=>{let[w,d]=L;const R=t._GetTypedArray(`${P}/sparse/indices`,m.indices.componentType,w,m.indices.byteOffset,m.count),y=C*m.count;let r;if(5126!==f.componentType||f.normalized){const L=t._GetTypedArray(`${P}/sparse/values`,f.componentType,d,m.values.byteOffset,y);r=new Y(y),l.d.ForEach(L,0,q,C,f.componentType,r.length,f.normalized||!1,((P,f)=>{r[f]=P}))}else r=t._GetTypedArray(`${P}/sparse/values`,f.componentType,d,m.values.byteOffset,y);let i=0;for(let P=0;P<R.length;P++){let f=R[P]*C;for(let P=0;P<C;P++)o[f++]=r[i++]}return o}))}))}return f._data}_loadFloatAccessorAsync(P,f){return this._loadAccessorAsync(P,f,Float32Array)}_loadIndicesAccessorAsync(P,f){if("SCALAR"!==f.type)throw new Error(`${P}/type: Invalid value ${f.type}`);if(5121!==f.componentType&&5123!==f.componentType&&5125!==f.componentType)throw new Error(`${P}/componentType: Invalid value ${f.componentType}`);if(f._data)return f._data;if(f.sparse){const Y=t._GetTypedArrayConstructor(`${P}/componentType`,f.componentType);f._data=this._loadAccessorAsync(P,f,Y)}else{const Y=A.Get(`${P}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((Y=>t._GetTypedArray(P,f.componentType,Y,f.byteOffset,f.count)))}return f._data}_loadVertexBufferViewAsync(P){if(P._babylonBuffer)return P._babylonBuffer;const f=this._babylonScene.getEngine();return P._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${P.index}`,P).then((P=>new l.c(f,P,!1))),P._babylonBuffer}_loadVertexAccessorAsync(P,f,Y){var C;if(null!==(C=f._babylonVertexBuffer)&&void 0!==C&&C[Y])return f._babylonVertexBuffer[Y];f._babylonVertexBuffer||(f._babylonVertexBuffer={});const q=this._babylonScene.getEngine();if(f.sparse||void 0==f.bufferView)f._babylonVertexBuffer[Y]=this._loadFloatAccessorAsync(P,f).then((P=>new l.d(q,P,Y,!1)));else{const C=A.Get(`${P}/bufferView`,this._gltf.bufferViews,f.bufferView);f._babylonVertexBuffer[Y]=this._loadVertexBufferViewAsync(C).then((m=>{const L=t._GetNumComponents(P,f.type);return new l.d(q,m,Y,!1,void 0,C.byteStride,void 0,f.byteOffset,L,f.componentType,f.normalized,!0,void 0,!0)}))}return f._babylonVertexBuffer[Y]}_loadMaterialMetallicRoughnessPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return f&&(f.baseColorFactor?(Y.albedoColor=m.Df.ef(f.baseColorFactor),Y.alpha=f.baseColorFactor[3]):Y.albedoColor=m.Df.White(),Y.metallic=void 0==f.metallicFactor?1:f.metallicFactor,Y.roughness=void 0==f.roughnessFactor?1:f.roughnessFactor,f.baseColorTexture&&C.push(this.loadTextureInfoAsync(`${P}/baseColorTexture`,f.baseColorTexture,(P=>{P.name=`${Y.name} (Base Color)`,Y.albedoTexture=P}))),f.metallicRoughnessTexture&&(f.metallicRoughnessTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${P}/metallicRoughnessTexture`,f.metallicRoughnessTexture,(P=>{P.name=`${Y.name} (Metallic Roughness)`,Y.metallicTexture=P}))),Y.useMetallnessFromMetallicTextureBlue=!0,Y.useRoughnessFromMetallicTextureGreen=!0,Y.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(C).then((()=>{}))}_loadMaterialAsync(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const m=this._extensionsLoadMaterialAsync(P,f,Y,C,q);if(m)return m;f._data=f._data||{};let L=f._data[C];if(!L){this.logOpen(`${P} ${f.name||""}`);const Y=this.createMaterial(P,f,C);L={babylonMaterial:Y,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(P,f,Y)},f._data[C]=L,t.AddPointerMetadata(Y,P),this._parent.onMaterialLoadedObservable.notifyObservers(Y),this.logClose()}return Y&&(L.babylonMeshes.push(Y),Y.vf.addOnce((()=>{const P=L.babylonMeshes.indexOf(Y);-1!==P&&L.babylonMeshes.splice(P,1)}))),q(L.babylonMaterial),L.promise.then((()=>L.babylonMaterial))}_createDefaultMaterial(P,f){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new V.d(P,this._babylonScene);return Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.fillMode=f,Y.enableSpecularAntiAliasing=!0,Y.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Y.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Y.transparencyMode=V.d.PBRMATERIAL_OPAQUE,Y.metallic=1,Y.roughness=1,Y}createMaterial(P,f,Y){const C=this._extensionsCreateMaterial(P,f,Y);if(C)return C;const q=f.name||`material${f.index}`;return this._createDefaultMaterial(q,Y)}loadMaterialPropertiesAsync(P,f,Y){const C=this._extensionsLoadMaterialPropertiesAsync(P,f,Y);if(C)return C;const q=new Array;return q.push(this.loadMaterialBasePropertiesAsync(P,f,Y)),f.pbrMetallicRoughness&&q.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${P}/pbrMetallicRoughness`,f.pbrMetallicRoughness,Y)),this.loadMaterialAlphaProperties(P,f,Y),Promise.all(q).then((()=>{}))}loadMaterialBasePropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return Y.emissiveColor=f.emissiveFactor?m.Df.ef(f.emissiveFactor):new m.Df(0,0,0),f.doubleSided&&(Y.XL=!1,Y.twoSidedLighting=!0),f.normalTexture&&(f.normalTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${P}/normalTexture`,f.normalTexture,(P=>{P.name=`${Y.name} (Normal)`,Y.bumpTexture=P}))),Y.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Y.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=f.normalTexture.scale&&Y.bumpTexture&&(Y.bumpTexture.level=f.normalTexture.scale),Y.forceIrradianceInFragment=!0),f.occlusionTexture&&(f.occlusionTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${P}/occlusionTexture`,f.occlusionTexture,(P=>{P.name=`${Y.name} (Occlusion)`,Y.ambientTexture=P}))),Y.useAmbientInGrayScale=!0,void 0!=f.occlusionTexture.strength&&(Y.ambientTextureStrength=f.occlusionTexture.strength)),f.emissiveTexture&&C.push(this.loadTextureInfoAsync(`${P}/emissiveTexture`,f.emissiveTexture,(P=>{P.name=`${Y.name} (Emissive)`,Y.emissiveTexture=P}))),Promise.all(C).then((()=>{}))}loadMaterialAlphaProperties(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);switch(f.alphaMode||"OPAQUE"){case"OPAQUE":Y.transparencyMode=V.d.PBRMATERIAL_OPAQUE,Y.alpha=1;break;case"MASK":Y.transparencyMode=V.d.PBRMATERIAL_ALPHATEST,Y.alphaCutOff=void 0==f.alphaCutoff?.5:f.alphaCutoff,Y.albedoTexture&&(Y.albedoTexture.Gf=!0);break;case"BLEND":Y.transparencyMode=V.d.PBRMATERIAL_ALPHABLEND,Y.albedoTexture&&(Y.albedoTexture.Gf=!0,Y.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${P}/alphaMode: Invalid value (${f.alphaMode})`)}}loadTextureInfoAsync(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureInfoAsync(P,f,Y);if(C)return C;if(this.logOpen(`${P}`),f.texCoord>=6)throw new Error(`${P}/texCoord: Invalid value (${f.texCoord})`);const q=A.Get(`${P}/index`,this._gltf.textures,f.index);q._textureInfo=f;const m=this._loadTextureAsync(`/textures/${f.index}`,q,(C=>{C.coordinatesIndex=f.texCoord||0,t.AddPointerMetadata(C,P),this._parent.onTextureLoadedObservable.notifyObservers(C),Y(C)}));return this.logClose(),m}_loadTextureAsync(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureAsync(P,f,Y);if(C)return C;this.logOpen(`${P} ${f.name||""}`);const q=void 0==f.sampler?t.DefaultSampler:A.Get(`${P}/sampler`,this._gltf.samplers,f.sampler),m=A.Get(`${P}/source`,this._gltf.images,f.source),L=this._createTextureAsync(P,q,m,Y,void 0,!f._textureInfo.nonColorData);return this.logClose(),L}_createTextureAsync(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},m=arguments.length>4?arguments[4]:void 0,L=arguments.length>5?arguments[5]:void 0;const o=this._loadSampler(`/samplers/${f.index}`,f),w=new Array,d=new C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const R={noMipmap:o.noMipMaps,invertY:!1,samplingMode:o.samplingMode,p:()=>{this._disposed||d.resolve()},onError:(f,Y)=>{this._disposed||d.reject(new Error(`${P}: ${Y&&Y.message?Y.message:f||"Failed to load texture"}`))},mimeType:Y.mimeType??(0,a.h)(Y.uri??""),loaderOptions:m,useSRGBBuffer:!!L&&this._parent.useSRGBBuffers},y=new O.c(null,this._babylonScene,R);return y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.push(d.promise),w.push(this.loadImageAsync(`/images/${Y.index}`,Y).then((P=>{const f=Y.uri||`${this._fileName}#image${Y.index}`,C=`data:${this._uniqueRootUrl}${f}`;y.updateURL(C,P);const q=y.getInternalTexture();q&&(q.label=Y.name)}))),y.wrapU=o.wrapU,y.wrapV=o.wrapV,q(y),this._parent.useGltfTextureNames&&(y.name=Y.name||Y.uri||`image${Y.index}`),Promise.all(w).then((()=>y))}_loadSampler(P,f){return f._data||(f._data={noMipMaps:9728===f.minFilter||9729===f.minFilter,samplingMode:t._GetTextureSamplingMode(P,f),wrapU:t._GetTextureWrapMode(`${P}/wrapS`,f.wrapS),wrapV:t._GetTextureWrapMode(`${P}/wrapT`,f.wrapT)}),f._data}loadImageAsync(P,f){if(!f._data){if(this.logOpen(`${P} ${f.name||""}`),f.uri)f._data=this.loadUriAsync(`${P}/uri`,f,f.uri);else{const Y=A.Get(`${P}/bufferView`,this._gltf.bufferViews,f.bufferView);f._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y)}this.logClose()}return f._data}loadUriAsync(P,f,Y){const C=this._extensionsLoadUriAsync(P,f,Y);if(C)return C;if(!t._ValidateUri(Y))throw new Error(`${P}: '${Y}' is invalid`);if((0,a.j)(Y)){const f=new Uint8Array((0,a.e)(Y));return this.log(`${P}: Decoded ${Y.substring(0,64)}... (${f.length} bytes)`),Promise.resolve(f)}return this.log(`${P}: Loading ${Y}`),this._parent.preprocessUrlAsync(this._rootUrl+Y).then((f=>new Promise(((C,q)=>{this._parent._loadFile(this._babylonScene,f,(f=>{this._disposed||(this.log(`${P}: Loaded ${Y} (${f.byteLength} bytes)`),C(new Uint8Array(f)))}),!0,(f=>{q(new a.k(`${P}: Failed to load '${Y}'${f?": "+f.status+" "+f.statusText:""}`,f))}))}))))}static AddPointerMetadata(P,f){P.metadata=P.metadata||{};const Y=P._internalMetadata=P._internalMetadata||{},C=Y.jf=Y.jf||{};(C.pointers=C.pointers||[]).push(f)}static _GetTextureWrapMode(P,f){switch(f=void 0==f?10497:f){case 33071:return O.c.CLAMP_ADDRESSMODE;case 33648:return O.c.MIRROR_ADDRESSMODE;case 10497:return O.c.WRAP_ADDRESSMODE;default:return g.e.Warn(`${P}: Invalid value (${f})`),O.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(P,f){const Y=void 0==f.magFilter?9729:f.magFilter,C=void 0==f.minFilter?9987:f.minFilter;if(9729===Y)switch(C){case 9728:return O.c.LINEAR_NEAREST;case 9729:return O.c.LINEAR_LINEAR;case 9984:return O.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return O.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return O.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return O.c.LINEAR_LINEAR_MIPLINEAR;default:return g.e.Warn(`${P}/minFilter: Invalid value (${C})`),O.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Y&&g.e.Warn(`${P}/magFilter: Invalid value (${Y})`),C){case 9728:return O.c.NEAREST_NEAREST;case 9729:return O.c.NEAREST_LINEAR;case 9984:return O.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return O.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return O.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return O.c.NEAREST_LINEAR_MIPLINEAR;default:return g.e.Warn(`${P}/minFilter: Invalid value (${C})`),O.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(P,f){try{return(0,Z.p)(f)}catch(Y){throw new Error(`${P}: ${Y.message}`)}}static _GetTypedArray(P,f,Y,C,q){const m=Y.buffer;C=Y.byteOffset+(C||0);const L=t._GetTypedArrayConstructor(`${P}/componentType`,f),o=l.d.GetTypeByteLength(f);return C%o!==0?(g.e.Warn(`${P}: Copying buffer as byte offset (${C}) is not a multiple of component type byte length (${o})`),new L(m.slice(C,C+q*o),0)):new L(m,C,q)}static _GetNumComponents(P,f){switch(f){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${P}: Invalid type (${f})`)}static _ValidateUri(P){return L.Tools.IsBase64(P)||-1===P.indexOf("..")}static _GetDrawMode(P,f){switch(void 0==f&&(f=4),f){case 0:return M.d.PointListDrawMode;case 1:return M.d.LineListDrawMode;case 2:return M.d.LineLoopDrawMode;case 3:return M.d.LineStripDrawMode;case 4:return M.d.TriangleFillMode;case 5:return M.d.TriangleStripDrawMode;case 6:return M.d.TriangleFanDrawMode}throw new Error(`${P}: Invalid mesh primitive mode (${f})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const P=new Array;if(this._gltf.materials)for(const f of this._gltf.materials)if(f._data)for(const Y in f._data){const C=f._data[Y];for(const f of C.babylonMeshes){f.XC(!0);const Y=C.babylonMaterial;P.push(Y.forceCompilationAsync(f)),P.push(Y.forceCompilationAsync(f,{useInstances:!0})),this._parent.useClipPlane&&(P.push(Y.forceCompilationAsync(f,{clipPlane:!0})),P.push(Y.forceCompilationAsync(f,{clipPlane:!0,useInstances:!0})))}}return Promise.all(P).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const P=new Array,f=this._babylonScene.lights;for(const Y of f){const f=Y.getShadowGenerator();f&&P.push(f.forceCompilationAsync())}return Promise.all(P).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(P){for(const f of this._extensions)f.enabled&&P(f)}_applyExtensions(P,f,Y){for(const C of this._extensions)if(C.enabled){const q=`${C.name}.${f}`,m=P;m._activeLoaderExtensionFunctions=m._activeLoaderExtensionFunctions||{};const L=m._activeLoaderExtensionFunctions;if(!L[q]){L[q]=!0;try{const P=Y(C);if(P)return P}finally{delete L[q]}}}return null}_extensionsOnLoading(){this._forEachExtensions((P=>P.onLoading&&P.onLoading()))}_extensionsOnReady(){this._forEachExtensions((P=>P.onReady&&P.onReady()))}_extensionsLoadSceneAsync(P,f){return this._applyExtensions(f,"loadScene",(Y=>Y.loadSceneAsync&&Y.loadSceneAsync(P,f)))}_extensionsLoadNodeAsync(P,f,Y){return this._applyExtensions(f,"loadNode",(C=>C.loadNodeAsync&&C.loadNodeAsync(P,f,Y)))}_extensionsLoadCameraAsync(P,f,Y){return this._applyExtensions(f,"loadCamera",(C=>C.loadCameraAsync&&C.loadCameraAsync(P,f,Y)))}_extensionsLoadVertexDataAsync(P,f,Y){return this._applyExtensions(f,"loadVertexData",(C=>C._loadVertexDataAsync&&C._loadVertexDataAsync(P,f,Y)))}_extensionsLoadMeshPrimitiveAsync(P,f,Y,C,q,m){return this._applyExtensions(q,"loadMeshPrimitive",(L=>L._loadMeshPrimitiveAsync&&L._loadMeshPrimitiveAsync(P,f,Y,C,q,m)))}_extensionsLoadMaterialAsync(P,f,Y,C,q){return this._applyExtensions(f,"loadMaterial",(m=>m._loadMaterialAsync&&m._loadMaterialAsync(P,f,Y,C,q)))}_extensionsCreateMaterial(P,f,Y){return this._applyExtensions(f,"createMaterial",(C=>C.createMaterial&&C.createMaterial(P,f,Y)))}_extensionsLoadMaterialPropertiesAsync(P,f,Y){return this._applyExtensions(f,"loadMaterialProperties",(C=>C.loadMaterialPropertiesAsync&&C.loadMaterialPropertiesAsync(P,f,Y)))}_extensionsLoadTextureInfoAsync(P,f,Y){return this._applyExtensions(f,"loadTextureInfo",(C=>C.loadTextureInfoAsync&&C.loadTextureInfoAsync(P,f,Y)))}_extensionsLoadTextureAsync(P,f,Y){return this._applyExtensions(f,"loadTexture",(C=>C._loadTextureAsync&&C._loadTextureAsync(P,f,Y)))}_extensionsLoadAnimationAsync(P,f){return this._applyExtensions(f,"loadAnimation",(Y=>Y.loadAnimationAsync&&Y.loadAnimationAsync(P,f)))}_extensionsLoadAnimationChannelAsync(P,f,Y,C,q){return this._applyExtensions(Y,"loadAnimationChannel",(m=>m._loadAnimationChannelAsync&&m._loadAnimationChannelAsync(P,f,Y,C,q)))}_extensionsLoadSkinAsync(P,f,Y){return this._applyExtensions(Y,"loadSkin",(C=>C._loadSkinAsync&&C._loadSkinAsync(P,f,Y)))}_extensionsLoadUriAsync(P,f,Y){return this._applyExtensions(f,"loadUri",(C=>C._loadUriAsync&&C._loadUriAsync(P,f,Y)))}_extensionsLoadBufferViewAsync(P,f){return this._applyExtensions(f,"loadBufferView",(Y=>Y.loadBufferViewAsync&&Y.loadBufferViewAsync(P,f)))}_extensionsLoadBufferAsync(P,f,Y,C){return this._applyExtensions(f,"loadBuffer",(q=>q.loadBufferAsync&&q.loadBufferAsync(P,f,Y,C)))}static LoadExtensionAsync(P,f,Y,C){if(!f.extensions)return null;const q=f.extensions[Y];return q?C(`${P}/extensions/${Y}`,q):null}static LoadExtraAsync(P,f,Y,C){if(!f.extras)return null;const q=f.extras[Y];return q?C(`${P}/extras/${Y}`,q):null}isExtensionUsed(P){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(P)}logOpen(P){this._parent._logOpen(P)}logClose(){this._parent._logClose()}log(P){this._parent._log(P)}startPerformanceCounter(P){this._parent._startPerformanceCounter(P)}endPerformanceCounter(P){this._parent._endPerformanceCounter(P)}}t.DefaultSampler={index:-1},s.b._CreateGLTF2Loader=P=>new t(P);var G=Y(12866),z=Y(11377),B=Y(11216),b=Y(12873),H=Y(12880);class W extends H.d{constructor(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,w=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",P),this._texture=P.getEngine().createRawCubeTexture(f,Y,C,q,m,L,o,w)}update(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,P,f,Y,C,q)}updateRGBDAsync(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,b.k)(this._texture,P,f,Y,C).then((()=>{}))}clone(){return B.e.Clone((()=>{const P=this.vP(),f=this._texture,Y=new W(P,f._bufferViewArray,f.width,f.format,f.type,f.generateMipMaps,f.invertY,f.samplingMode,f._compression);return 13===f.source&&Y.updateRGBDAsync(f._bufferViewArrayArray,f._sphericalPolynomial,f._lodGenerationScale,f._lodGenerationOffset),Y}),this)}}const p="EXT_lights_image_based";class h{constructor(P){this.name=p,this._loader=P,this.enabled=this._loader.isExtensionUsed(p)}dispose(){this._loader=null,delete this._lights}onLoading(){const P=this._loader.jf.extensions;if(P&&P[this.name]){const f=P[this.name];this._lights=f.lights}}loadSceneAsync(P,f){return t.LoadExtensionAsync(P,f,this.name,(async(Y,C)=>{this._loader._allMaterialsDirtyRequired=!0;const q=new Array;q.push(this._loader.loadSceneAsync(P,f)),this._loader.logOpen(`${Y}`);const m=A.Get(`${Y}/light`,this._lights,C.Sf);return q.push(this._loadLightAsync(`/extensions/${this.name}/lights/${C.Sf}`,m).then((P=>{this._loader.babylonScene.environmentTexture=P}))),this._loader.logClose(),await Promise.all(q).then((()=>{}))}))}_loadLightAsync(P,f){if(!f._loaded){const Y=new Array;this._loader.logOpen(`${P}`);const C=new Array(f.specularImages.length);for(let q=0;q<f.specularImages.length;q++){const m=f.specularImages[q];C[q]=new Array(m.length);for(let f=0;f<m.length;f++){const L=`${P}/specularImages/${q}/${f}`;this._loader.logOpen(`${L}`);const o=m[f],w=A.Get(L,this._loader.jf.images,o);Y.push(this._loader.loadImageAsync(`/images/${o}`,w).then((P=>{C[q][f]=P}))),this._loader.logClose()}}this._loader.logClose(),f._loaded=Promise.all(Y).then((async()=>{const Y=new W(this._loader.babylonScene,null,f.specularImageSize);if(Y.name=f.name||"environment",f._babylonTexture=Y,void 0!=f.So&&(Y.level=f.So),f.rotation){let P=q.Quaternion.ef(f.rotation);this._loader.babylonScene.useRightHandedSystem||(P=q.Quaternion.Inverse(P)),q.Matrix.FromQuaternionToRef(P,Y.getReflectionTextureMatrix())}if(!f.irradianceCoefficients)throw new Error(`${P}: Irradiance coefficients are missing`);const m=z.e.ef(f.irradianceCoefficients);m.scaleInPlace(f.So),m.convertIrradianceToLambertianRadiance();const L=z.f.FromHarmonics(m),o=(C.length-1)/Math.log2(f.specularImageSize);return await Y.updateRGBDAsync(C,L,o)}))}return f._loaded.then((()=>f._babylonTexture))}}X(p),I(p,!0,(P=>new h(P)));Y(11773);const F="EXT_mesh_gpu_instancing";class PP{constructor(P){this.name=F,this._loader=P,this.enabled=this._loader.isExtensionUsed(F)}dispose(){this._loader=null}loadNodeAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(P,C)=>{this._loader._disableInstancedMesh++;const m=this._loader.loadNodeAsync(`/nodes/${f.index}`,f,Y);if(this._loader._disableInstancedMesh--,!f._primitiveBabylonMeshes)return await m;const L=new Array;let o=0;const w=f=>{if(void 0==C.attributes[f])return void L.push(Promise.resolve(null));const Y=A.Get(`${P}/attributes/${f}`,this._loader.jf.accessors,C.attributes[f]);if(L.push(this._loader._loadFloatAccessorAsync(`/accessors/${Y.bufferView}`,Y)),0===o)o=Y.count;else if(o!==Y.count)throw new Error(`${P}/attributes: Instance buffer accessors do not have the same count.`)};return w("TRANSLATION"),w("ROTATION"),w("SCALE"),await m.then((async P=>{const[Y,C,m]=await Promise.all(L),w=new Float32Array(16*o);q.TmpVectors.Of[0].do(0,0,0),q.TmpVectors.Quaternion[0].do(0,0,0,1),q.TmpVectors.Of[1].do(1,1,1);for(let f=0;f<o;++f)Y&&q.Of.FromArrayToRef(Y,3*f,q.TmpVectors.Of[0]),C&&q.Quaternion.FromArrayToRef(C,4*f,q.TmpVectors.Quaternion[0]),m&&q.Of.FromArrayToRef(m,3*f,q.TmpVectors.Of[1]),q.Matrix.ComposeToRef(q.TmpVectors.Of[1],q.TmpVectors.Quaternion[0],q.TmpVectors.Of[0],q.TmpVectors.Matrix[0]),q.TmpVectors.Matrix[0].copyToArray(w,16*f);for(const q of f._primitiveBabylonMeshes)q.Uy("matrix",w,16,!0);return P}))}))}}X(F),I(F,!0,(P=>new PP(P)));let fP=0,YP=null;class CP{static get Default(){return CP._Default||(CP._Default=new CP),CP._Default}constructor(){const P=CP.Configuration.decoder;this._decoderModulePromise=L.Tools.LoadBabylonScriptAsync(P.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(P,f,Y,C,q){await this._decoderModulePromise,0===fP&&(MeshoptDecoder.useWorkers(1),fP=1);const m=await MeshoptDecoder.decodeGltfBufferAsync(f,Y,P,C,q);return null!==YP&&clearTimeout(YP),YP=setTimeout((()=>{MeshoptDecoder.useWorkers(0),fP=0,YP=null}),1e3),m}}CP.Configuration={decoder:{url:`${L.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},CP._Default=null;const qP="EXT_meshopt_compression";class mP{constructor(P){this.name=qP,this.enabled=P.isExtensionUsed(qP),this._loader=P}dispose(){this._loader=null}loadBufferViewAsync(P,f){return t.LoadExtensionAsync(P,f,this.name,(async(Y,C)=>{const q=f;if(q._meshOptData)return await q._meshOptData;const m=A.Get(`${P}/buffer`,this._loader.jf.buffers,C.buffer);return q._meshOptData=this._loader.loadBufferAsync(`/buffers/${m.index}`,m,C.byteOffset||0,C.byteLength).then((async P=>await CP.Default.decodeGltfBufferAsync(P,C.count,C.byteStride,C.mode,C.filter))),await q._meshOptData}))}}X(qP),I(qP,!0,(P=>new mP(P)));const LP="EXT_texture_webp";class oP{constructor(P){this.name=LP,this._loader=P,this.enabled=P.isExtensionUsed(LP)}dispose(){this._loader=null}_loadTextureAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=void 0==f.sampler?t.DefaultSampler:A.Get(`${P}/sampler`,this._loader.jf.samplers,f.sampler),L=A.Get(`${C}/source`,this._loader.jf.images,q.source);return await this._loader._createTextureAsync(P,m,L,(P=>{Y(P)}),void 0,!f._textureInfo.nonColorData)}))}}X(LP),I(LP,!0,(P=>new oP(P)));const wP="EXT_texture_avif";class dP{constructor(P){this.name=wP,this._loader=P,this.enabled=P.isExtensionUsed(wP)}dispose(){this._loader=null}_loadTextureAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=void 0==f.sampler?t.DefaultSampler:A.Get(`${P}/sampler`,this._loader.jf.samplers,f.sampler),L=A.Get(`${C}/source`,this._loader.jf.images,q.source);return await this._loader._createTextureAsync(P,m,L,(P=>{Y(P)}),void 0,!f._textureInfo.nonColorData)}))}}X(wP),I(wP,!0,(P=>new dP(P)));var RP=Y(12863),yP=Y(11742);const rP="EXT_lights_ies";class iP{constructor(P){this.name=rP,this._loader=P,this.enabled=this._loader.isExtensionUsed(rP)}dispose(){this._loader=null,delete this._lights}onLoading(){const P=this._loader.jf.extensions;if(P&&P[this.name]){const f=P[this.name];this._lights=f.lights,A.Assign(this._lights)}}loadNodeAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,L)=>{let o,w;this._loader._allMaterialsDirtyRequired=!0;const d=await this._loader.loadNodeAsync(P,f,(P=>{w=A.Get(C,this._lights,L.Sf);const f=w.name||P.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,o=new RP.e(f,q.Of.Zero(),q.Of.Backward(),0,1,this._loader.babylonScene),o.angle=Math.PI/2,o.innerAngle=0,o._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,w._babylonLight=o,o.falloffType=yP.d.FALLOFF_GLTF,o.Ko=L.color?m.Df.ef(L.color):m.Df.White(),o.So=L.multiplier||1,o.range=Number.MAX_VALUE,o.parent=P,this._loader._babylonLights.push(o),t.AddPointerMetadata(o,C),Y(P)}));let R;if(w.uri)R=await this._loader.loadUriAsync(P,w,w.uri);else{const f=A.Get(`${P}/bufferView`,this._loader.jf.bufferViews,w.bufferView);R=await this._loader.loadBufferViewAsync(`/bufferViews/${f.index}`,f)}return o.iesProfileTexture=new O.c(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,R,!0,void 0,void 0,void 0,void 0,".ies"),d}))}}X(rP),I(rP,!0,(P=>new iP(P)));var uP=Y(12890);const gP="KHR_draco_mesh_compression";class SP{constructor(P){this.name=gP,this.useNormalizedFlagFromAccessor=!0,this._loader=P,this.enabled=uP.b.DefaultAvailable&&this._loader.isExtensionUsed(gP)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{if(void 0!=f.mode&&4!==f.mode&&5!==f.mode)throw new Error(`${P}: Unsupported mode ${f.mode}`);const m={},L={},o=(P,C)=>{const o=q.attributes[P];if(void 0!=o&&(Y._delayInfo=Y._delayInfo||[],-1===Y._delayInfo.indexOf(C)&&Y._delayInfo.push(C),m[C]=o,this.useNormalizedFlagFromAccessor)){const Y=A.TryGet(this._loader.jf.accessors,f.attributes[P]);Y&&(L[C]=Y.normalized||!1)}};o("POSITION",l.d.PositionKind),o("NORMAL",l.d.NormalKind),o("TANGENT",l.d.TangentKind),o("TEXCOORD_0",l.d.UVKind),o("TEXCOORD_1",l.d.UV2Kind),o("TEXCOORD_2",l.d.UV3Kind),o("TEXCOORD_3",l.d.UV4Kind),o("TEXCOORD_4",l.d.UV5Kind),o("TEXCOORD_5",l.d.UV6Kind),o("JOINTS_0",l.d.MatricesIndicesKind),o("WEIGHTS_0",l.d.MatricesWeightsKind),o("COLOR_0",l.d.ColorKind);const w=A.Get(C,this._loader.jf.bufferViews,q.bufferView);return w._dracoBabylonGeometry||(w._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w).then((async C=>{const q=this.dracoDecoder||uP.b.Default,o=A.TryGet(this._loader.jf.accessors,f.attributes.POSITION),w=this._loader.parent.alwaysComputeBoundingBox||Y.skeleton||!o?null:E(o);return await q._decodeMeshToGeometryForGltfAsync(Y.name,this._loader.babylonScene,C,m,L,w).catch((f=>{throw new Error(`${P}: ${f.message}`)}))}))),await w._dracoBabylonGeometry}))}}X(gP),I(gP,!0,(P=>new SP(P)));var KP=Y(12892),MP=Y(11165),VP=Y(11170),OP=Y(11620),nP=Y(11812),lP=Y(11134);OP.b.AddNodeConstructor("Light_Type_0",((P,f)=>()=>new vP(P,q.Of.Zero(),f)));class vP extends nP.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(P){this._shadowAngle=P,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(P){const f=this.needCube();if(this._direction=P,this.needCube()!==f&&this._shadowGenerators){const P=this._shadowGenerators.values();for(let f=P.next();!0!==f.done;f=P.next()){f.value.recreateShadowMap()}}}constructor(P,f,Y){super(P,Y),this._shadowAngle=Math.PI/2,this.position=f}getClassName(){return"PointLight"}getTypeID(){return yP.d.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(P){if(this.direction)return super.getShadowDirection(P);switch(P){case 0:return new q.Of(1,0,0);case 1:return new q.Of(-1,0,0);case 2:return new q.Of(0,-1,0);case 3:return new q.Of(0,1,0);case 4:return new q.Of(0,0,1);case 5:return new q.Of(0,0,-1)}return q.Of.Zero()}_setDefaultShadowProjectionMatrix(P,f,Y){const C=this.vP().activeCamera;if(!C)return;const m=void 0!==this.shadowMinZ?this.shadowMinZ:C.zf,L=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,o=this.vP().getEngine().useReverseDepthBuffer;q.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,o?L:m,o?m:L,P,!0,this._scene.getEngine().isNDCHalfZRange,void 0,o)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(P,f){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,f):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,f),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,f),this}transferToNodeMaterialEffect(P,f){return this.computeTransformedInformation()?P.setFloat3(f,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):P.setFloat3(f,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(P,f){P["POINTLIGHT"+f]=!0}}(0,MP.b)([(0,VP.F)()],vP.prototype,"shadowAngle",null),(0,lP.d)("BABYLON.PointLight",vP);const cP="KHR_lights_punctual";class TP{constructor(P){this.name=cP,this._loader=P,this.enabled=this._loader.isExtensionUsed(cP)}dispose(){this._loader=null,delete this._lights}onLoading(){const P=this._loader.jf.extensions;if(P&&P[this.name]){const f=P[this.name];this._lights=f.lights,A.Assign(this._lights)}}loadNodeAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,L)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(P,f,(P=>{let f;const o=A.Get(C,this._lights,L.Sf),w=o.name||P.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,o.type){case"directional":{const P=new KP.c(w,q.Of.Backward(),this._loader.babylonScene);P.position.yo(0),f=P;break}case"point":f=new vP(w,q.Of.Zero(),this._loader.babylonScene);break;case"spot":{const P=new RP.e(w,q.Of.Zero(),q.Of.Backward(),0,1,this._loader.babylonScene);P.angle=2*(o.spot&&o.spot.outerConeAngle||Math.PI/4),P.innerAngle=2*(o.spot&&o.spot.innerConeAngle||0),f=P;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${C}: Invalid light type (${o.type})`)}f._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,o._babylonLight=f,f.falloffType=yP.d.FALLOFF_GLTF,f.Ko=o.color?m.Df.ef(o.color):m.Df.White(),f.So=void 0==o.So?1:o.So,f.range=void 0==o.range?Number.MAX_VALUE:o.range,f.parent=P,this._loader._babylonLights.push(f),t.AddPointerMetadata(f,C),Y(P)})))))}}X(cP),I(cP,!0,(P=>new TP(P)));const UP="KHR_materials_pbrSpecularGlossiness";class DP{constructor(P){this.name=UP,this.order=200,this._loader=P,this.enabled=this._loader.isExtensionUsed(UP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialBasePropertiesAsync(P,f,Y)),m.push(this._loadSpecularGlossinessPropertiesAsync(C,q,Y)),this._loader.loadMaterialAlphaProperties(P,f,Y),await Promise.all(m).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return Y.metallic=null,Y.roughness=null,f.diffuseFactor?(Y.albedoColor=m.Df.ef(f.diffuseFactor),Y.alpha=f.diffuseFactor[3]):Y.albedoColor=m.Df.White(),Y.reflectivityColor=f.specularFactor?m.Df.ef(f.specularFactor):m.Df.White(),Y.microSurface=void 0==f.glossinessFactor?1:f.glossinessFactor,f.diffuseTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/diffuseTexture`,f.diffuseTexture,(P=>{P.name=`${Y.name} (Diffuse)`,Y.albedoTexture=P}))),f.specularGlossinessTexture&&(C.push(this._loader.loadTextureInfoAsync(`${P}/specularGlossinessTexture`,f.specularGlossinessTexture,(P=>{P.name=`${Y.name} (Specular Glossiness)`,Y.reflectivityTexture=P,Y.reflectivityTexture.Gf=!0}))),Y.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(C).then((()=>{}))}}X(UP),I(UP,!0,(P=>new DP(P)));const jP="KHR_materials_unlit";class eP{constructor(P){this.name=jP,this.order=210,this._loader=P,this.enabled=this._loader.isExtensionUsed(jP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async()=>await this._loadUnlitPropertiesAsync(P,f,Y)))}_loadUnlitPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;Y.unlit=!0;const q=f.pbrMetallicRoughness;return q&&(q.baseColorFactor?(Y.albedoColor=m.Df.ef(q.baseColorFactor),Y.alpha=q.baseColorFactor[3]):Y.albedoColor=m.Df.White(),q.baseColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/baseColorTexture`,q.baseColorTexture,(P=>{P.name=`${Y.name} (Base Color)`,Y.albedoTexture=P})))),f.doubleSided&&(Y.XL=!1,Y.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(P,f,Y),Promise.all(C).then((()=>{}))}}X(jP),I(jP,!0,(P=>new eP(P)));const sP="KHR_materials_clearcoat";class aP{constructor(P){this.name=sP,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(sP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadClearCoatPropertiesAsync(C,q,Y)),await Promise.all(m)}))}_loadClearCoatPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return Y.clearCoat.isEnabled=!0,Y.clearCoat.useRoughnessFromMainTexture=!1,Y.clearCoat.remapF0OnInterfaceChange=!1,void 0!=f.clearcoatFactor?Y.clearCoat.So=f.clearcoatFactor:Y.clearCoat.So=0,f.clearcoatTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/clearcoatTexture`,f.clearcoatTexture,(P=>{P.name=`${Y.name} (ClearCoat)`,Y.clearCoat.texture=P}))),void 0!=f.clearcoatRoughnessFactor?Y.clearCoat.roughness=f.clearcoatRoughnessFactor:Y.clearCoat.roughness=0,f.clearcoatRoughnessTexture&&(f.clearcoatRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${P}/clearcoatRoughnessTexture`,f.clearcoatRoughnessTexture,(P=>{P.name=`${Y.name} (ClearCoat Roughness)`,Y.clearCoat.textureRoughness=P})))),f.clearcoatNormalTexture&&(f.clearcoatNormalTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${P}/clearcoatNormalTexture`,f.clearcoatNormalTexture,(P=>{P.name=`${Y.name} (ClearCoat Normal)`,Y.clearCoat.bumpTexture=P}))),Y.invertNormalMapX=!Y.vP().useRightHandedSystem,Y.invertNormalMapY=Y.vP().useRightHandedSystem,void 0!=f.clearcoatNormalTexture.scale&&(Y.clearCoat.bumpTexture.level=f.clearcoatNormalTexture.scale)),Promise.all(C).then((()=>{}))}}X(sP),I(sP,!0,(P=>new aP(P)));const QP="KHR_materials_iridescence";class JP{constructor(P){this.name=QP,this.order=195,this._loader=P,this.enabled=this._loader.isExtensionUsed(QP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadIridescencePropertiesAsync(C,q,Y)),await Promise.all(m).then((()=>{}))}))}_loadIridescencePropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return Y.iridescence.isEnabled=!0,Y.iridescence.So=f.iridescenceFactor??0,Y.iridescence.indexOfRefraction=f.iridescenceIor??f.iridescenceIOR??1.3,Y.iridescence.minimumThickness=f.iridescenceThicknessMinimum??100,Y.iridescence.maximumThickness=f.iridescenceThicknessMaximum??400,f.iridescenceTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/iridescenceTexture`,f.iridescenceTexture,(P=>{P.name=`${Y.name} (Iridescence)`,Y.iridescence.texture=P}))),f.iridescenceThicknessTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/iridescenceThicknessTexture`,f.iridescenceThicknessTexture,(P=>{P.name=`${Y.name} (Iridescence Thickness)`,Y.iridescence.thicknessTexture=P}))),Promise.all(C).then((()=>{}))}}X(QP),I(QP,!0,(P=>new JP(P)));const NP="KHR_materials_anisotropy";class IP{constructor(P){this.name=NP,this.order=195,this._loader=P,this.enabled=this._loader.isExtensionUsed(NP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadIridescencePropertiesAsync(C,q,Y)),await Promise.all(m)}))}async _loadIridescencePropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;Y.anisotropy.isEnabled=!0,Y.anisotropy.So=f.anisotropyStrength??0,Y.anisotropy.angle=f.anisotropyRotation??0,f.anisotropyTexture&&(f.anisotropyTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${P}/anisotropyTexture`,f.anisotropyTexture,(P=>{P.name=`${Y.name} (Anisotropy Intensity)`,Y.anisotropy.texture=P})))),await Promise.all(C)}}X(NP),I(NP,!0,(P=>new IP(P)));const XP="KHR_materials_emissive_strength";class xP{constructor(P){this.name=XP,this.order=170,this._loader=P,this.enabled=this._loader.isExtensionUsed(XP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>await this._loader.loadMaterialPropertiesAsync(P,f,Y).then((()=>{this._loadEmissiveProperties(C,q,Y)}))))}_loadEmissiveProperties(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);void 0!==f.emissiveStrength&&(Y.emissiveIntensity=f.emissiveStrength)}}X(XP),I(XP,!0,(P=>new xP(P)));const kP="KHR_materials_sheen";class ZP{constructor(P){this.name=kP,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(kP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadSheenPropertiesAsync(C,q,Y)),await Promise.all(m).then((()=>{}))}))}_loadSheenPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return Y.sheen.isEnabled=!0,Y.sheen.So=1,void 0!=f.sheenColorFactor?Y.sheen.color=m.Df.ef(f.sheenColorFactor):Y.sheen.color=m.Df.Black(),f.sheenColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/sheenColorTexture`,f.sheenColorTexture,(P=>{P.name=`${Y.name} (Sheen Color)`,Y.sheen.texture=P}))),void 0!==f.sheenRoughnessFactor?Y.sheen.roughness=f.sheenRoughnessFactor:Y.sheen.roughness=0,f.sheenRoughnessTexture&&(f.sheenRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${P}/sheenRoughnessTexture`,f.sheenRoughnessTexture,(P=>{P.name=`${Y.name} (Sheen Roughness)`,Y.sheen.textureRoughness=P})))),Y.sheen.albedoScaling=!0,Y.sheen.useRoughnessFromMainTexture=!1,Promise.all(C).then((()=>{}))}}X(kP),I(kP,!0,(P=>new ZP(P)));var AP=Y(11676);const EP="KHR_materials_specular";class tP{constructor(P){this.name=EP,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(EP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;if(m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadSpecularPropertiesAsync(C,q,Y)),q.extensions&&q.extensions.EXT_materials_specular_edge_color&&Y instanceof V.d){q.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(Y.brdf.dielectricSpecularModel=AP.e.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,Y.brdf.conductorSpecularModel=AP.e.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(m).then((()=>{}))}))}_loadSpecularPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return void 0!==f.specularFactor&&(Y.metallicF0Factor=f.specularFactor),void 0!==f.specularColorFactor&&(Y.metallicReflectanceColor=m.Df.ef(f.specularColorFactor)),f.specularTexture&&(f.specularTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${P}/specularTexture`,f.specularTexture,(P=>{P.name=`${Y.name} (Specular)`,Y.metallicReflectanceTexture=P,Y.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),f.specularColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/specularColorTexture`,f.specularColorTexture,(P=>{P.name=`${Y.name} (Specular Color)`,Y.reflectanceTexture=P}))),Promise.all(C).then((()=>{}))}}X(EP),I(EP,!0,(P=>new tP(P)));const GP="KHR_materials_ior";class zP{constructor(P){this.name=GP,this.order=180,this._loader=P,this.enabled=this._loader.isExtensionUsed(GP)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadIorPropertiesAsync(C,q,Y)),await Promise.all(m).then((()=>{}))}))}_loadIorPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);return void 0!==f.ior?Y.indexOfRefraction=f.ior:Y.indexOfRefraction=zP._DEFAULT_IOR,Promise.resolve()}}zP._DEFAULT_IOR=1.5,X(GP),I(GP,!0,(P=>new zP(P)));const BP="KHR_materials_variants";class bP{constructor(P){this.name=BP,this._loader=P,this.enabled=this._loader.isExtensionUsed(BP)}dispose(){this._loader=null}static GetAvailableVariants(P){const f=this._GetExtensionMetadata(P);return f?Object.keys(f.variants):[]}getAvailableVariants(P){return bP.GetAvailableVariants(P)}static SelectVariant(P,f){const Y=this._GetExtensionMetadata(P);if(!Y)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${BP} extension`);const C=P=>{const f=Y.variants[P];if(f)for(const Y of f)Y.mesh.material=Y.material};if(f instanceof Array)for(const q of f)C(q);else C(f);Y.lastSelected=f}selectVariant(P,f){bP.SelectVariant(P,f)}static Reset(P){const f=this._GetExtensionMetadata(P);if(!f)throw new Error(`Cannot reset on a glTF mesh that does not have the ${BP} extension`);for(const Y of f.original)Y.mesh.material=Y.material;f.lastSelected=null}reset(P){bP.Reset(P)}static GetLastSelectedVariant(P){const f=this._GetExtensionMetadata(P);if(!f)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${BP} extension`);return f.lastSelected}getLastSelectedVariant(P){return bP.GetLastSelectedVariant(P)}static _GetExtensionMetadata(P){var f,Y;return(null===P||void 0===P||null===(f=P._internalMetadata)||void 0===f||null===(Y=f.jf)||void 0===Y?void 0:Y[BP])||null}onLoading(){const P=this._loader.jf.extensions;if(P&&P[this.name]){const f=P[this.name];this._variants=f.variants}}onReady(){const P=this._loader.rootBabylonMesh;if(P){var f;const Y=this._loader.parent.extensionOptions[BP];null!==Y&&void 0!==Y&&Y.defaultVariant&&bP.SelectVariant(P,Y.defaultVariant),null===Y||void 0===Y||null===(f=Y.onLoaded)||void 0===f||f.call(Y,{get variants(){return bP.GetAvailableVariants(P)},get selectedVariant(){const f=bP.GetLastSelectedVariant(P);return f?Array.isArray(f)?f[0]:f:bP.GetAvailableVariants(P)[0]},set selectedVariant(f){bP.SelectVariant(P,f)}})}}_loadMeshPrimitiveAsync(P,f,Y,C,q,m){return t.LoadExtensionAsync(P,q,this.name,(async(L,o)=>{const w=new Array;return w.push(this._loader._loadMeshPrimitiveAsync(P,f,Y,C,q,(f=>{if(m(f),f instanceof T.c){const Y=t._GetDrawMode(P,q.mode),C=this._loader.rootBabylonMesh,m=C?C._internalMetadata=C._internalMetadata||{}:{},d=m.jf=m.jf||{},R=d[BP]=d[BP]||{lastSelected:null,original:[],variants:{}};R.original.push({mesh:f,material:f.material});for(let P=0;P<o.mappings.length;++P){const q=o.mappings[P],m=A.Get(`${L}/mappings/${P}/material`,this._loader.jf.materials,q.material);w.push(this._loader._loadMaterialAsync(`#/materials/${q.material}`,m,f,Y,(P=>{for(let Y=0;Y<q.variants.length;++Y){const m=q.variants[Y],L=A.Get(`/extensions/${BP}/variants/${m}`,this._variants,m);R.variants[L.name]=R.variants[L.name]||[],R.variants[L.name].push({mesh:f,material:P}),f.onClonedObservable.add((P=>{const Y=P;let q=null,m=Y;do{if(m=m.parent,!m)return;q=bP._GetExtensionMetadata(m)}while(null===q);if(C&&q===bP._GetExtensionMetadata(C)){m._internalMetadata={};for(const P in C._internalMetadata)m._internalMetadata[P]=C._internalMetadata[P];m._internalMetadata.jf=[];for(const P in C._internalMetadata.jf)m._internalMetadata.jf[P]=C._internalMetadata.jf[P];m._internalMetadata.jf[BP]={lastSelected:null,original:[],variants:{}};for(const P of q.original)m._internalMetadata.jf[BP].original.push({mesh:P.mesh,material:P.material});for(const P in q.variants)if(Object.prototype.hasOwnProperty.call(q.variants,P)){m._internalMetadata.jf[BP].variants[P]=[];for(const f of q.variants[P])m._internalMetadata.jf[BP].variants[P].push({mesh:f.mesh,material:f.material})}q=m._internalMetadata.jf[BP]}for(const C of q.original)C.mesh===f&&(C.mesh=Y);for(const C of q.variants[L.name])C.mesh===f&&(C.mesh=Y)}))}})))}}}))),await Promise.all(w).then((P=>{let[f]=P;return f}))}))}}X(BP),I(BP,!0,(P=>new bP(P)));var HP=Y(11243);class WP{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:AP.e.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(P,f){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...WP._GetDefaultOptions(),...P},this._scene=f,this._scene._transmissionHelper=this,this.onErrorObservable=new R.e,this._scene.vf.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(P){if(!Object.keys(P).filter((f=>this._options[f]!==P[f])).length)return;const f={...this._options,...P},Y=this._options;this._options=f,f.renderSize===Y.renderSize&&f.renderTargetTextureType===Y.renderTargetTextureType&&f.generateMipmaps===Y.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=f.samples,this._opaqueRenderTarget.lodGenerationScale=f.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=f.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(P){return!!P&&!!(P instanceof V.d&&P.subSurface.isRefractionEnabled)}_addMesh(P){this._materialObservers[P.uniqueId]=P.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),L.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(P.material)?(P.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(P)&&this._transparentMeshesCache.push(P)):-1===this._opaqueMeshesCache.indexOf(P)&&this._opaqueMeshesCache.push(P)}))}_removeMesh(P){P.onMaterialChangedObservable.remove(this._materialObservers[P.uniqueId]),delete this._materialObservers[P.uniqueId];let f=this._transparentMeshesCache.indexOf(P);-1!==f&&this._transparentMeshesCache.splice(f,1),f=this._opaqueMeshesCache.indexOf(P),-1!==f&&this._opaqueMeshesCache.splice(f,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(P){const f=this._transparentMeshesCache.indexOf(P),Y=this._opaqueMeshesCache.indexOf(P);this._shouldRenderAsTransmission(P.material)?(P.material instanceof V.d&&(P.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Y?(this._opaqueMeshesCache.splice(Y,1),this._transparentMeshesCache.push(P)):-1===f&&this._transparentMeshesCache.push(P)):-1!==f?(this._transparentMeshesCache.splice(f,1),this._opaqueMeshesCache.push(P)):-1===Y&&this._opaqueMeshesCache.push(P)}_isRenderTargetValid(){var P;return null!==(null===(P=this._opaqueRenderTarget)||void 0===P?void 0:P.getInternalTexture())}_setupRenderTargets(){var P;let f;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new HP.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(P=this._options.clearColor)||void 0===P?void 0:P.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((P=>{f=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?P.clearColor.q(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(P.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=f}));for(const Y of this._transparentMeshesCache)this._shouldRenderAsTransmission(Y.material)&&(Y.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const pP="KHR_materials_transmission";class hP{constructor(P){this.name=pP,this.order=175,this._loader=P,this.enabled=this._loader.isExtensionUsed(pP),this.enabled&&(P.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadTransparentPropertiesAsync(C,f,Y,q)),await Promise.all(m).then((()=>{}))}))}_loadTransparentPropertiesAsync(P,f,Y,C){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const q=Y;if(q.subSurface.isRefractionEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.useAlbedoToTintRefraction=!0,void 0===C.transmissionFactor)return q.subSurface.refractionIntensity=0,q.subSurface.isRefractionEnabled=!1,Promise.resolve();{var m;q.subSurface.refractionIntensity=C.transmissionFactor;const P=q.vP();if(q.subSurface.refractionIntensity&&!P._transmissionHelper)new WP({},q.vP());else if(q.subSurface.refractionIntensity&&(null===(m=P._transmissionHelper)||void 0===m||!m._isRenderTargetValid())){var L;null===(L=P._transmissionHelper)||void 0===L||L._setupRenderTargets()}}return q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,C.transmissionTexture?(C.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${P}/transmissionTexture`,C.transmissionTexture,void 0).then((P=>{P.name=`${Y.name} (Transmission)`,q.subSurface.refractionIntensityTexture=P,q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}X(pP),I(pP,!0,(P=>new hP(P)));const FP="KHR_materials_diffuse_transmission";class Pf{constructor(P){this.name=FP,this.order=174,this._loader=P,this.enabled=this._loader.isExtensionUsed(FP),this.enabled&&(P.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadTranslucentPropertiesAsync(C,f,Y,q)),await Promise.all(m).then((()=>{}))}))}_loadTranslucentPropertiesAsync(P,f,Y,C){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const q=Y;if(q.subSurface.isTranslucencyEnabled=!0,q.subSurface.volumeIndexOfRefraction=1,q.subSurface.minimumThickness=0,q.subSurface.maximumThickness=0,q.subSurface.useAlbedoToTintTranslucency=!1,void 0===C.diffuseTransmissionFactor)return q.subSurface.translucencyIntensity=0,q.subSurface.isTranslucencyEnabled=!1,Promise.resolve();q.subSurface.translucencyIntensity=C.diffuseTransmissionFactor;const L=new Array;return q.subSurface.useGltfStyleTextures=!0,C.diffuseTransmissionTexture&&(C.diffuseTransmissionTexture.nonColorData=!0,L.push(this._loader.loadTextureInfoAsync(`${P}/diffuseTransmissionTexture`,C.diffuseTransmissionTexture).then((P=>{P.name=`${Y.name} (Diffuse Transmission)`,q.subSurface.translucencyIntensityTexture=P})))),void 0!==C.diffuseTransmissionColorFactor?q.subSurface.translucencyColor=m.Df.ef(C.diffuseTransmissionColorFactor):q.subSurface.translucencyColor=m.Df.White(),C.diffuseTransmissionColorTexture&&L.push(this._loader.loadTextureInfoAsync(`${P}/diffuseTransmissionColorTexture`,C.diffuseTransmissionColorTexture).then((P=>{P.name=`${Y.name} (Diffuse Transmission Color)`,q.subSurface.translucencyColorTexture=P}))),Promise.all(L).then((()=>{}))}}X(FP),I(FP,!0,(P=>new Pf(P)));const ff="KHR_materials_volume";class Yf{constructor(P){this.name=ff,this.order=173,this._loader=P,this.enabled=this._loader.isExtensionUsed(ff),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadVolumePropertiesAsync(C,f,Y,q)),await Promise.all(m).then((()=>{}))}))}_loadVolumePropertiesAsync(P,f,Y,C){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);if(!Y.subSurface.isRefractionEnabled&&!Y.subSurface.isTranslucencyEnabled||!C.thicknessFactor)return Promise.resolve();Y.subSurface.volumeIndexOfRefraction=Y.indexOfRefraction;const q=void 0!==C.attenuationDistance?C.attenuationDistance:Number.MAX_VALUE;return Y.subSurface.tintColorAtDistance=q,void 0!==C.attenuationColor&&3==C.attenuationColor.length&&Y.subSurface.tintColor.do(C.attenuationColor[0],C.attenuationColor[1],C.attenuationColor[2]),Y.subSurface.minimumThickness=0,Y.subSurface.maximumThickness=C.thicknessFactor,Y.subSurface.useThicknessAsDepth=!0,C.thicknessTexture?(C.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${P}/thicknessTexture`,C.thicknessTexture).then((P=>{P.name=`${Y.name} (Thickness)`,Y.subSurface.thicknessTexture=P,Y.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}X(ff),I(ff,!0,(P=>new Yf(P)));const Cf="KHR_materials_dispersion";class qf{constructor(P){this.name=Cf,this.order=174,this._loader=P,this.enabled=this._loader.isExtensionUsed(Cf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadDispersionPropertiesAsync(C,f,Y,q)),await Promise.all(m).then((()=>{}))}))}_loadDispersionPropertiesAsync(P,f,Y,C){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);return Y.subSurface.isRefractionEnabled&&C.dispersion?(Y.subSurface.isDispersionEnabled=!0,Y.subSurface.dispersion=C.dispersion,Promise.resolve()):Promise.resolve()}}X(Cf),I(Cf,!0,(P=>new qf(P)));const mf="EXT_materials_diffuse_roughness";class Lf{constructor(P){this.name=mf,this.order=190,this._loader=P,this.enabled=this._loader.isExtensionUsed(mf)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=new Array;return m.push(this._loader.loadMaterialPropertiesAsync(P,f,Y)),m.push(this._loadDiffuseRoughnessPropertiesAsync(C,q,Y)),await Promise.all(m).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(P,f,Y){if(!(Y instanceof V.d))throw new Error(`${P}: Material type not supported`);const C=new Array;return Y.brdf.baseDiffuseModel=AP.e.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=f.diffuseRoughnessFactor?Y.baseDiffuseRoughness=f.diffuseRoughnessFactor:Y.baseDiffuseRoughness=0,f.diffuseRoughnessTexture&&C.push(this._loader.loadTextureInfoAsync(`${P}/diffuseRoughnessTexture`,f.diffuseRoughnessTexture,(P=>{P.name=`${Y.name} (Diffuse Roughness)`,Y.baseDiffuseRoughnessTexture=P}))),Promise.all(C).then((()=>{}))}}X(mf),I(mf,!0,(P=>new Lf(P)));const of="KHR_mesh_quantization";class wf{constructor(P){this.name=of,this.enabled=P.isExtensionUsed(of)}dispose(){}}X(of),I(of,!0,(P=>new wf(P)));const df="KHR_texture_basisu";class Rf{constructor(P){this.name=df,this._loader=P,this.enabled=P.isExtensionUsed(df)}dispose(){this._loader=null}_loadTextureAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>{const m=void 0==f.sampler?t.DefaultSampler:A.Get(`${P}/sampler`,this._loader.jf.samplers,f.sampler),L=A.Get(`${C}/source`,this._loader.jf.images,q.source);return await this._loader._createTextureAsync(P,m,L,(P=>{Y(P)}),f._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!f._textureInfo.nonColorData)}))}}X(df),I(df,!0,(P=>new Rf(P)));const yf="KHR_texture_transform";class rf{constructor(P){this.name=yf,this._loader=P,this.enabled=this._loader.isExtensionUsed(yf)}dispose(){this._loader=null}loadTextureInfoAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(C,q)=>await this._loader.loadTextureInfoAsync(P,f,(P=>{if(!(P instanceof O.c))throw new Error(`${C}: Texture type not supported`);q.offset&&(P.uOffset=q.offset[0],P.vOffset=q.offset[1]),P.uRotationCenter=0,P.vRotationCenter=0,q.rotation&&(P.wAng=-q.rotation),q.scale&&(P.uScale=q.scale[0],P.vScale=q.scale[1]),void 0!=q.texCoord&&(P.coordinatesIndex=q.texCoord),Y(P)}))))}}X(yf),I(yf,!0,(P=>new rf(P)));const uf="KHR_xmp_json_ld";class gf{constructor(P){this.name=uf,this.order=100,this._loader=P,this.enabled=this._loader.isExtensionUsed(uf)}dispose(){this._loader=null}onLoading(){var P,f,Y;if(null===this._loader.rootBabylonMesh)return;const C=null===(P=this._loader.jf.extensions)||void 0===P?void 0:P.KHR_xmp_json_ld,q=null===(f=this._loader.jf.asset)||void 0===f||null===(Y=f.extensions)||void 0===Y?void 0:Y.KHR_xmp_json_ld;if(C&&q){const P=+q.packet;C.packets&&P<C.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=C.packets[P])}}}function Sf(P,f,Y,C){return m.Df.ef(f,Y).scale(C)}function Kf(P,f,Y,C){return f[Y]*C}function Mf(P,f,Y,C){return-f[Y]*C}function Vf(P,f,Y,C){return f[Y+1]*C}function Of(P,f,Y,C){return f[Y]*C*2}function nf(P){return{scale:[new vf(r.b.ANIMATIONTYPE_FLOAT,`${P}.uScale`,Kf,(()=>2)),new vf(r.b.ANIMATIONTYPE_FLOAT,`${P}.vScale`,Vf,(()=>2))],offset:[new vf(r.b.ANIMATIONTYPE_FLOAT,`${P}.uOffset`,Kf,(()=>2)),new vf(r.b.ANIMATIONTYPE_FLOAT,`${P}.vOffset`,Vf,(()=>2))],rotation:[new vf(r.b.ANIMATIONTYPE_FLOAT,`${P}.wAng`,Mf,(()=>1))]}}X(uf),I(uf,!0,(P=>new gf(P)));class lf extends G.AnimationPropertyInfo{buildAnimations(P,f,Y,C){return[{babylonAnimatable:P._babylonCamera,babylonAnimation:this._buildAnimation(f,Y,C)}]}}class vf extends G.AnimationPropertyInfo{buildAnimations(P,f,Y,C){const q=[];for(const m in P._data)q.push({babylonAnimatable:P._data[m].babylonMaterial,babylonAnimation:this._buildAnimation(f,Y,C)});return q}}class cf extends G.AnimationPropertyInfo{buildAnimations(P,f,Y,C){return[{babylonAnimatable:P._babylonLight,babylonAnimation:this._buildAnimation(f,Y,C)}]}}(0,x.n)("/cameras/{}/orthographic/xmag",[new lf(r.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Mf,(()=>1)),new lf(r.b.ANIMATIONTYPE_FLOAT,"orthoRight",Vf,(()=>1))]),(0,x.n)("/cameras/{}/orthographic/ymag",[new lf(r.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Mf,(()=>1)),new lf(r.b.ANIMATIONTYPE_FLOAT,"orthoTop",Vf,(()=>1))]),(0,x.n)("/cameras/{}/orthographic/zfar",[new lf(r.b.ANIMATIONTYPE_FLOAT,"maxZ",Kf,(()=>1))]),(0,x.n)("/cameras/{}/orthographic/znear",[new lf(r.b.ANIMATIONTYPE_FLOAT,"zf",Kf,(()=>1))]),(0,x.n)("/cameras/{}/perspective/yfov",[new lf(r.b.ANIMATIONTYPE_FLOAT,"fov",Kf,(()=>1))]),(0,x.n)("/cameras/{}/perspective/zfar",[new lf(r.b.ANIMATIONTYPE_FLOAT,"maxZ",Kf,(()=>1))]),(0,x.n)("/cameras/{}/perspective/znear",[new lf(r.b.ANIMATIONTYPE_FLOAT,"zf",Kf,(()=>1))]),(0,x.n)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new vf(r.b.ANIMATIONTYPE_COLOR3,"albedoColor",Sf,(()=>4)),new vf(r.b.ANIMATIONTYPE_FLOAT,"alpha",(function(P,f,Y,C){return f[Y+3]*C}),(()=>4))]),(0,x.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"metallic",Kf,(()=>1))]),(0,x.n)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"roughness",Kf,(()=>1))]);const Tf=nf("albedoTexture");(0,x.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Tf.scale),(0,x.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Tf.offset),(0,x.n)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Tf.rotation);const Uf=nf("metallicTexture");(0,x.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Uf.scale),(0,x.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Uf.offset),(0,x.n)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Uf.rotation),(0,x.n)("/materials/{}/emissiveFactor",[new vf(r.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Sf,(()=>3))]);const Df=nf("bumpTexture");(0,x.n)("/materials/{}/normalTexture/scale",[new vf(r.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Kf,(()=>1))]),(0,x.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Df.scale),(0,x.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Df.offset),(0,x.n)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Df.rotation),(0,x.n)("/materials/{}/occlusionTexture/strength",[new vf(r.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Kf,(()=>1))]);const jf=nf("ambientTexture");(0,x.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",jf.scale),(0,x.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",jf.offset),(0,x.n)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",jf.rotation);const ef=nf("emissiveTexture");(0,x.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ef.scale),(0,x.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ef.offset),(0,x.n)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ef.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new vf(r.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new vf(r.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Kf,(()=>1))]);const sf=nf("anisotropy.texture");(0,x.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",sf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",sf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",sf.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Kf,(()=>1))]);const af=nf("clearCoat.texture");(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",af.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",af.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",af.rotation);const Qf=nf("clearCoat.bumpTexture");(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new vf(r.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Qf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Qf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Qf.rotation);const Jf=nf("clearCoat.textureRoughness");(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Jf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Jf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Jf.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new vf(r.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_ior/ior",[new vf(r.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new vf(r.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new vf(r.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Kf,(()=>1))]);const Nf=nf("iridescence.texture");(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Nf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Nf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Nf.rotation);const If=nf("iridescence.thicknessTexture");(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",If.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",If.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",If.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new vf(r.b.ANIMATIONTYPE_COLOR3,"sheen.color",Sf,(()=>3))]),(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",Kf,(()=>1))]);const Xf=nf("sheen.texture");(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Xf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Xf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Xf.rotation);const xf=nf("sheen.textureRoughness");(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",xf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",xf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",xf.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new vf(r.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Sf,(()=>3))]);const kf=nf("metallicReflectanceTexture");(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",kf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",kf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",kf.rotation);const Zf=nf("reflectanceTexture");(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Zf.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Zf.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Zf.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Kf,(()=>1))]);const Af=nf("subSurface.refractionIntensityTexture");(0,x.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Af.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Af.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Af.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new vf(r.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Sf,(()=>3))]),(0,x.n)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new vf(r.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Kf,(()=>1))]),(0,x.n)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Kf,(()=>1))]);const Ef=nf("subSurface.thicknessTexture");(0,x.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Ef.scale),(0,x.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Ef.offset),(0,x.n)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Ef.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new vf(r.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Kf,(()=>1))]);const tf=nf("subSurface.translucencyIntensityTexture");(0,x.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",tf.scale),(0,x.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",tf.offset),(0,x.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",tf.rotation),(0,x.n)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new vf(r.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Sf,(()=>3))]);const Gf=nf("subSurface.translucencyColorTexture");(0,x.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Gf.scale),(0,x.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Gf.offset),(0,x.n)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Gf.rotation),(0,x.n)("/extensions/KHR_lights_punctual/lights/{}/color",[new cf(r.b.ANIMATIONTYPE_COLOR3,"diffuse",Sf,(()=>3))]),(0,x.n)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new cf(r.b.ANIMATIONTYPE_FLOAT,"intensity",Kf,(()=>1))]),(0,x.n)("/extensions/KHR_lights_punctual/lights/{}/range",[new cf(r.b.ANIMATIONTYPE_FLOAT,"range",Kf,(()=>1))]),(0,x.n)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new cf(r.b.ANIMATIONTYPE_FLOAT,"innerAngle",Of,(()=>1))]),(0,x.n)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new cf(r.b.ANIMATIONTYPE_FLOAT,"angle",Of,(()=>1))]),(0,x.n)("/nodes/{}/extensions/EXT_lights_ies/color",[new cf(r.b.ANIMATIONTYPE_COLOR3,"diffuse",Sf,(()=>3))]),(0,x.n)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new cf(r.b.ANIMATIONTYPE_FLOAT,"intensity",Kf,(()=>1))]);const zf="KHR_animation_pointer";class Bf{constructor(P){this.name=zf,this._loader=P,this._pathToObjectConverter=(0,x.k)(this._loader.jf)}get enabled(){return this._loader.isExtensionUsed(zf)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(P,f,Y,C,q){var m;const L=null===(m=C.target.extensions)||void 0===m?void 0:m.KHR_animation_pointer;if(!L||!this._pathToObjectConverter)return null;"pointer"!==C.target.path&&g.e.Warn(`${P}/target/path: Value (${C.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=C.target.node&&g.e.Warn(`${P}/target/node: Value (${C.target.node}) must not be present when using the ${this.name} extension`);const o=`${P}/extensions/${this.name}`,w=L.pointer;if(!w)throw new Error(`${o}: Pointer is missing`);try{const m=this._pathToObjectConverter.convert(w);if(!m.info.interpolation)throw new Error(`${o}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(P,f,Y,C,{object:m.object,info:m.info.interpolation},q)}catch(d){return g.e.Warn(`${o}/pointer: Invalid pointer (${w}) skipped`),null}}}X(zf),I(zf,!0,(P=>new Bf(P)));class bf{constructor(P,f,Y){this.frame=P,this.action=f,this.onlyOnce=Y,this.isDone=!1}_clone(){return new bf(this.frame,this.action,this.onlyOnce)}}var Hf=Y(11043),Wf=Y(11089),pf=Y(11087);class hf{get loop(){return this._loop}set loop(P){P!==this._loop&&(this._loop=P,this.updateOptions({loop:P}))}get currentTime(){var P;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.audioContext&&(this.isPlaying||this.isPaused)){const P=this.isPaused?0:Wf.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+P}return 0}get spatialSound(){return this._spatialSound}set spatialSound(P){if(P==this._spatialSound)return;const f=this.isPlaying;this.pause(),P?(this._spatialSound=P,this._updateSpatialParameters()):this._disableSpatialSound(),f&&this.play()}constructor(P,f,Y){var C;let m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new R.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=q.Of.Zero(),this._localDirection=new q.Of(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=P,Y=Y||u.e.LastCreatedScene)if(this._scene=Y,hf._SceneComponentInitialization(Y),this._readyToPlayCallback=m,this._customAttenuationFunction=(P,f,Y,C,q)=>f<Y?P*(1-f/Y):0,o&&(this.autoplay=o.autoplay||!1,this._loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this._spatialSound=o.spatialSound??!1,this.maxDistance=o.maxDistance??100,this.useCustomAttenuation=o.useCustomAttenuation??!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=o.streaming??!1,this._length=o.length,this._offset=o.offset),null!==(C=Wf.c.audioEngine)&&void 0!==C&&C.canUseWebAudio&&Wf.c.audioEngine.audioContext){this._soundGain=Wf.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let P=!0;if(f)try{"string"===typeof f?(this._urlType="String",this._url=f):f instanceof ArrayBuffer?this._urlType="ArrayBuffer":f instanceof HTMLMediaElement?this._urlType="MediaElement":f instanceof MediaStream?this._urlType="MediaStream":f instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(f)&&(this._urlType="Array");let Y=[],C=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Wf.c.audioEngine.audioContext.createMediaElementSource(f),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Wf.c.audioEngine.audioContext.createMediaStreamSource(f),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":f.byteLength>0&&(C=!0,this._soundLoaded(f));break;case"AudioBuffer":this._audioBufferLoaded(f);break;case"String":Y.push(f);case"Array":0===Y.length&&(Y=f);for(let P=0;P<Y.length;P++){const f=Y[P];if(C=o&&o.skipCodecCheck||-1!==f.indexOf(".mp3",f.length-4)&&Wf.c.audioEngine.isMP3supported||-1!==f.indexOf(".ogg",f.length-4)&&Wf.c.audioEngine.isOGGsupported||-1!==f.indexOf(".wav",f.length-4)||-1!==f.indexOf(".m4a",f.length-4)||-1!==f.indexOf(".mp4",f.length-4)||-1!==f.indexOf("blob:"),C){this._streaming?(this._htmlAudioElement=new Audio(f),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,L.Tools.SetCorsBehavior(f,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(f,(P=>{this._soundLoaded(P)}),void 0,!0,!0,(P=>{P&&g.e.Error("XHR "+P.status+" error on: "+f+"."),g.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:P=!1}P?C||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):g.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(w){g.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Wf.c.audioEngine&&!Wf.c.audioEngine.WarnedWebAudioUnsupported&&(g.e.Error("Web Audio is not supported by your browser."),Wf.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var P;null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(P){var f;null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.audioContext&&(this._audioBuffer=P,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(P){var f;null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.audioContext&&Wf.c.audioEngine.audioContext.decodeAudioData(P,(P=>{this._audioBufferLoaded(P)}),(P=>{g.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+P)}))}setAudioBuffer(P){var f;null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&(this._audioBuffer=P,this._isReadyToPlay=!0)}updateOptions(P){P&&(this.loop=P.loop??this.loop,this.maxDistance=P.maxDistance??this.maxDistance,this.useCustomAttenuation=P.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=P.rolloffFactor??this.rolloffFactor,this.refDistance=P.refDistance??this.refDistance,this.distanceModel=P.distanceModel??this.distanceModel,this._playbackRate=P.playbackRate??this._playbackRate,this._length=P.length??void 0,this.spatialSound=P.spatialSound??this._spatialSound,this._setOffset(P.offset??void 0),this.setVolume(P.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var P;null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.canUseWebAudio&&Wf.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Wf.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var P;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(P=this._soundPanner)||void 0===P||P.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var P;null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(P){var f;null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(P),this._isOutputConnected=!0)}setDirectionalCone(P,f,Y){f<P?g.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=P,this._coneOuterAngle=f,this._coneOuterGain=Y,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(P){if(P!=this._coneInnerAngle){var f;if(this._coneOuterAngle<P)return void g.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=P,null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(P){if(P!=this._coneOuterAngle){var f;if(P<this._coneInnerAngle)return void g.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=P,null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(P){var f;P.equals(this._position)||(this._position.q(P),null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(P){var f;this._localDirection=P,null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const P=this._connectedTransformNode.getWorldMatrix(),f=q.Of.TransformNormal(this._localDirection,P);f.normalize(),this._soundPanner.orientationX.value=f.x,this._soundPanner.orientationY.value=f.y,this._soundPanner.orientationZ.value=f.z}updateDistanceFromListener(){var P;if(null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const P=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.nf(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,P,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(P){this._customAttenuationFunction=P}play(P,f,Y){var C;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(C=Wf.c.audioEngine)&&void 0!==C&&C.audioContext)try{var q,m;this._clearTimeoutsAndObservers();let C=P?(null===(q=Wf.c.audioEngine)||void 0===q?void 0:q.audioContext.currentTime)+P:null===(m=Wf.c.audioEngine)||void 0===m?void 0:m.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Wf.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const P=()=>{var Y;if(null!==(Y=Wf.c.audioEngine)&&void 0!==Y&&Y.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=f??0;const Y=this._htmlAudioElement.play();void 0!==Y&&Y.catch((()=>{var f,Y;(null===(f=Wf.c.audioEngine)||void 0===f||f.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Y=Wf.c.audioEngine)||void 0===Y?void 0:Y.onAudioUnlockedObservable.addOnce((()=>{P()})))}))}else{var C;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(C=Wf.c.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{P()}))}};P()}}else{var L;const q=()=>{var q;if(null!==(q=Wf.c.audioEngine)&&void 0!==q&&q.audioContext){var m;if(Y=Y||this._length,void 0!==f&&this._setOffset(f),this._soundSource){const P=this._soundSource;P.onended=()=>{P.disconnect()}}if(this._soundSource=null===(m=Wf.c.audioEngine)||void 0===m?void 0:m.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var L;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==f&&(this._soundSource.loopStart=f),void 0!==Y&&(this._soundSource.loopEnd=(0|f)+Y),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},C=P?(null===(L=Wf.c.audioEngine)||void 0===L?void 0:L.audioContext.currentTime)+P:Wf.c.audioEngine.audioContext.currentTime;const q=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(C,q,this.loop?void 0:Y)}}};"suspended"===(null===(L=Wf.c.audioEngine)||void 0===L?void 0:L.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var P;"suspended"===(null===(P=Wf.c.audioEngine)||void 0===P?void 0:P.audioContext.state)?(Wf.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Wf.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{q()})))):q()}),500):q()}this._startTime=C,this.isPlaying=!0,this.isPaused=!1}catch(o){g.e.Error("Error while trying to play audio: "+this.name+", "+o.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(P){var f;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Y;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Y=this._streamingSource)||void 0===Y||Y.disconnect();this.isPlaying=!1}else if(null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.audioContext&&this._soundSource){const f=P?Wf.c.audioEngine.audioContext.currentTime+P:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(f)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var P;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var f;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(f=this._streamingSource)||void 0===f||f.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Wf.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(P,f){var Y;null!==(Y=Wf.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio&&this._soundGain&&(f&&Wf.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Wf.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Wf.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(P,Wf.c.audioEngine.audioContext.currentTime+f)):this._soundGain.gain.value=P),this._volume=P}setPlaybackRate(P){this._playbackRate=P,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(P){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=P,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=P=>this._onRegisterAfterWorldMatrixUpdate(P),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(P){var f;if(P.getBoundingInfo){const f=P.getBoundingInfo();this.setPosition(f.boundingSphere.centerWorld)}else this.setPosition(P.absolutePosition);null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const P=()=>{(0,pf.e)((()=>this._isReadyToPlay),(()=>{Y._audioBuffer=this.getAudioBuffer(),Y._isReadyToPlay=!0,Y.autoplay&&Y.play(0,this._offset,this._length)}),void 0,300)},f={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Y=new hf(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,f);return this.useCustomAttenuation&&Y.setAttenuationFunction(this._customAttenuationFunction),Y.setPosition(this._position),Y.setPlaybackRate(this._playbackRate),P(),Y}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const P={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(P.connectedMeshId=this._connectedTransformNode.id),P.position=this._position.If(),P.refDistance=this.refDistance,P.distanceModel=this.distanceModel,P.isDirectional=this._isDirectional,P.localDirectionToMesh=this._localDirection.If(),P.coneInnerAngle=this._coneInnerAngle,P.coneOuterAngle=this._coneOuterAngle,P.coneOuterGain=this._coneOuterGain),P}static Parse(P,f,Y,C){const m=P.name;let L;L=P.url?Y+P.url:Y+m;const o={autoplay:P.autoplay,loop:P.loop,volume:P.volume,spatialSound:P.spatialSound,maxDistance:P.maxDistance,rolloffFactor:P.rolloffFactor,refDistance:P.refDistance,distanceModel:P.distanceModel,playbackRate:P.playbackRate};let w;if(C){const P=()=>{(0,pf.e)((()=>C._isReadyToPlay),(()=>{w._audioBuffer=C.getAudioBuffer(),w._isReadyToPlay=!0,w.autoplay&&w.play(0,w._offset,w._length)}),void 0,300)};w=new hf(m,new ArrayBuffer(0),f,null,o),P()}else w=new hf(m,L,f,(()=>{f.removePendingData(w)}),o),f.addPendingData(w);if(P.position){const f=q.Of.ef(P.position);w.setPosition(f)}if(P.isDirectional&&(w.setDirectionalCone(P.coneInnerAngle||360,P.coneOuterAngle||360,P.coneOuterGain||0),P.localDirectionToMesh)){const f=q.Of.ef(P.localDirectionToMesh);w.setLocalDirectionToMesh(f)}if(P.connectedMeshId){const Y=f.getMeshById(P.connectedMeshId);Y&&w.attachToMesh(Y)}return P.metadata&&(w.metadata=P.metadata),w}_setOffset(P){this._offset!==P&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=P)}_clearTimeoutsAndObservers(){var P;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(P=Wf.c.audioEngine)||void 0===P||P.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}hf._SceneComponentInitialization=P=>{throw(0,Hf.b)("AudioSceneComponent")},(0,lP.d)("BABYLON.Sound",hf);class Ff{constructor(P,f,Y){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],f.length!==Y.length)throw new Error("Sounds length does not equal weights length");this.loop=P,this._weights=Y;let C=0;for(const m of Y)C+=m;const q=C>0?1/C:0;for(let m=0;m<this._weights.length;m++)this._weights[m]*=q;this._sounds=f;for(const m of this._sounds)m.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(P){if(P!==this._coneInnerAngle){if(this._coneOuterAngle<P)return void g.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=P;for(const f of this._sounds)f.directionalConeInnerAngle=P}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(P){if(P!==this._coneOuterAngle){if(P<this._coneInnerAngle)return void g.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=P;for(const f of this._sounds)f.directionalConeOuterAngle=P}}get volume(){return this._volume}set volume(P){if(P!==this._volume)for(const f of this._sounds)f.setVolume(P)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(P){if(!this.isPaused){this.stop();const P=Math.random();let f=0;for(let Y=0;Y<this._weights.length;Y++)if(f+=this._weights[Y],P<=f){this._currentIndex=Y;break}}const f=this._sounds[this._currentIndex??0];f.isReady()?f.play(0,this.isPaused?void 0:P):f.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class PY{constructor(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(P=P||u.e.LastCreatedScene)&&(this._scene=P,this.soundCollection=[],this._options=f,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var P;null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.canUseWebAudio&&Wf.c.audioEngine.audioContext&&(this._outputAudioNode=Wf.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Wf.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Wf.c.audioEngine&&Wf.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(P){var f;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&P.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==P.soundTrackId&&(-1===P.soundTrackId?this._scene.mainSoundTrack.removeSound(P):this._scene.soundTracks&&this._scene.soundTracks[P.soundTrackId].removeSound(P)),this.soundCollection.push(P),P.soundTrackId=this.id}removeSound(P){const f=this.soundCollection.indexOf(P);-1!==f&&this.soundCollection.splice(f,1)}setVolume(P){var f;null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=P)}switchPanningModelToHRTF(){var P;if(null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.canUseWebAudio)for(let f=0;f<this.soundCollection.length;f++)this.soundCollection[f].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var P;if(null!==(P=Wf.c.audioEngine)&&void 0!==P&&P.canUseWebAudio)for(let f=0;f<this.soundCollection.length;f++)this.soundCollection[f].switchPanningModelToEqualPower()}connectToAnalyser(P){var f;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=P,null!==(f=Wf.c.audioEngine)&&void 0!==f&&f.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Wf.c.audioEngine.masterGain))}}var fY=Y(11467),YY=Y(11429),CY=Y(11021);Wf.c.AudioEngineFactory=(P,f,Y)=>new qY(P,f,Y);class qY{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new R.e,this.onAudioLockedObservable=new R.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,CY.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const C=document.createElement("audio");this._hostElement=P,this._audioContext=f,this._audioDestination=Y;try{C&&C.canPlayType&&(C.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||C.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(q){}try{C&&C.canPlayType&&C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(q){}}lock(){this._triggerSuspendedState()}unlock(){var P,f;if("running"===(null===(P=this._audioContext)||void 0===P?void 0:P.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(f=this._audioContext)||void 0===f||f.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{g.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var P;null===(P=this._audioContext)||void 0===P||P.addEventListener("statechange",(()=>{var P;this.unlocked&&"running"!==(null===(P=this._audioContext)||void 0===P?void 0:P.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var P;return null!==(P=this._audioContext)&&void 0!==P&&P.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(P){this.canUseWebAudio=!1,g.e.Error("Web Audio: "+P.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(P){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const P=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",f=document.createElement("style");f.appendChild(document.createTextNode(P)),document.getElementsByTagName("head")[0].appendChild(f),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var P;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(P=this._audioContext)||void 0===P||P.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(P){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=P)}connectToAnalyser(P){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=P,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var mY=Y(11035);(0,Y(12595).g)(fY.d.NAME_AUDIO,((P,f,Y,C)=>{let q,m=[];if(Y.zr=Y.zr||[],void 0!==P.zr&&null!==P.zr)for(let o=0,w=P.zr.length;o<w;o++){var L;const w=P.zr[o];null!==(L=Wf.c.audioEngine)&&void 0!==L&&L.canUseWebAudio?(w.url||(w.url=w.name),m[w.url]?Y.zr.push(hf.Parse(w,f,C,m[w.url])):(q=hf.Parse(w,f,C),m[w.url]=q,Y.zr.push(q))):Y.zr.push(new hf(w.name,null,f))}m=[]})),Object.defineProperty(YY.e.prototype,"mainSoundTrack",{get:function(){let P=this._getComponent(fY.d.NAME_AUDIO);return P||(P=new LY(this),this.mf(P)),this._mainSoundTrack||(this._mainSoundTrack=new PY(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),YY.e.prototype.getSoundByName=function(P){let f;for(f=0;f<this.mainSoundTrack.soundCollection.length;f++)if(this.mainSoundTrack.soundCollection[f].name===P)return this.mainSoundTrack.soundCollection[f];if(this.soundTracks)for(let Y=0;Y<this.soundTracks.length;Y++)for(f=0;f<this.soundTracks[Y].soundCollection.length;f++)if(this.soundTracks[Y].soundCollection[f].name===P)return this.soundTracks[Y].soundCollection[f];return null},Object.defineProperty(YY.e.prototype,"audioEnabled",{get:function(){let P=this._getComponent(fY.d.NAME_AUDIO);return P||(P=new LY(this),this.mf(P)),P.audioEnabled},set:function(P){let f=this._getComponent(fY.d.NAME_AUDIO);f||(f=new LY(this),this.mf(f)),P?f.enableAudio():f.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(YY.e.prototype,"headphone",{get:function(){let P=this._getComponent(fY.d.NAME_AUDIO);return P||(P=new LY(this),this.mf(P)),P.headphone},set:function(P){let f=this._getComponent(fY.d.NAME_AUDIO);f||(f=new LY(this),this.mf(f)),P?f.switchAudioModeForHeadphones():f.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(YY.e.prototype,"audioListenerPositionProvider",{get:function(){let P=this._getComponent(fY.d.NAME_AUDIO);return P||(P=new LY(this),this.mf(P)),P.audioListenerPositionProvider},set:function(P){let f=this._getComponent(fY.d.NAME_AUDIO);if(f||(f=new LY(this),this.mf(f)),P&&"function"!==typeof P)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");f.audioListenerPositionProvider=P},enumerable:!0,configurable:!0}),Object.defineProperty(YY.e.prototype,"audioListenerRotationProvider",{get:function(){let P=this._getComponent(fY.d.NAME_AUDIO);return P||(P=new LY(this),this.mf(P)),P.audioListenerRotationProvider},set:function(P){let f=this._getComponent(fY.d.NAME_AUDIO);if(f||(f=new LY(this),this.mf(f)),P&&"function"!==typeof P)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");f.audioListenerRotationProvider=P},enumerable:!0,configurable:!0}),Object.defineProperty(YY.e.prototype,"audioPositioningRefreshRate",{get:function(){let P=this._getComponent(fY.d.NAME_AUDIO);return P||(P=new LY(this),this.mf(P)),P.audioPositioningRefreshRate},set:function(P){let f=this._getComponent(fY.d.NAME_AUDIO);f||(f=new LY(this),this.mf(f)),f.audioPositioningRefreshRate=P},enumerable:!0,configurable:!0});class LY{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(P){this.name=fY.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new q.Of,this._cachedCameraPosition=new q.Of,this._lastCheck=0,this._invertMatrixTemp=new q.Matrix,this._cameraDirectionTemp=new q.Of,(P=P||u.e.LastCreatedScene)&&(this.lf=P,P.soundTracks=[],P.zr=[])}register(){this.lf._afterRenderStage.registerStep(fY.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(P){if(P.zr=[],this.lf.soundTracks)for(let f=0;f<this.lf.soundTracks.length;f++){const Y=this.lf.soundTracks[f];for(let f=0;f<Y.soundCollection.length;f++)P.zr.push(Y.soundCollection[f].serialize())}}addFromContainer(P){if(P.zr)for(const f of P.zr)f.play(),f.autoplay=!0,this.lf.mainSoundTrack.addSound(f)}removeFromContainer(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(P.zr)for(const Y of P.zr)Y.stop(),Y.autoplay=!1,this.lf.mainSoundTrack.removeSound(Y),f&&Y.dispose()}dispose(){const P=this.lf;if(P._mainSoundTrack&&P.mainSoundTrack.dispose(),P.soundTracks)for(let f=0;f<P.soundTracks.length;f++)P.soundTracks[f].dispose()}disableAudio(){const P=this.lf;let f;for(this._audioEnabled=!1,Wf.c.audioEngine&&Wf.c.audioEngine.audioContext&&Wf.c.audioEngine.audioContext.suspend(),f=0;f<P.mainSoundTrack.soundCollection.length;f++)P.mainSoundTrack.soundCollection[f].pause();if(P.soundTracks)for(f=0;f<P.soundTracks.length;f++)for(let Y=0;Y<P.soundTracks[f].soundCollection.length;Y++)P.soundTracks[f].soundCollection[Y].pause()}enableAudio(){const P=this.lf;let f;for(this._audioEnabled=!0,Wf.c.audioEngine&&Wf.c.audioEngine.audioContext&&Wf.c.audioEngine.audioContext.resume(),f=0;f<P.mainSoundTrack.soundCollection.length;f++)P.mainSoundTrack.soundCollection[f].isPaused&&P.mainSoundTrack.soundCollection[f].play();if(P.soundTracks)for(f=0;f<P.soundTracks.length;f++)for(let Y=0;Y<P.soundTracks[f].soundCollection.length;Y++)P.soundTracks[f].soundCollection[Y].isPaused&&P.soundTracks[f].soundCollection[Y].play()}switchAudioModeForHeadphones(){const P=this.lf;if(this._headphone=!0,P.mainSoundTrack.switchPanningModelToHRTF(),P.soundTracks)for(let f=0;f<P.soundTracks.length;f++)P.soundTracks[f].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const P=this.lf;if(this._headphone=!1,P.mainSoundTrack.switchPanningModelToEqualPower(),P.soundTracks)for(let f=0;f<P.soundTracks.length;f++)P.soundTracks[f].switchPanningModelToEqualPower()}_afterRender(){const P=mY.e.Now;if(this._lastCheck&&P-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=P;const f=this.lf;if(!this._audioEnabled||!f._mainSoundTrack||!f.soundTracks||0===f._mainSoundTrack.soundCollection.length&&1===f.soundTracks.length)return;const Y=Wf.c.audioEngine;if(Y&&Y.audioContext){let P,C=f.activeCamera;if(f.activeCameras&&f.activeCameras.length>0&&(C=f.activeCameras[0]),this.audioListenerPositionProvider){const P=this.audioListenerPositionProvider();Y.audioContext.listener.setPosition(P.x||0,P.y||0,P.z||0)}else C?this._cachedCameraPosition.equals(C.globalPosition)||(this._cachedCameraPosition.q(C.globalPosition),Y.audioContext.listener.setPosition(C.globalPosition.x,C.globalPosition.y,C.globalPosition.z)):Y.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const P=this.audioListenerRotationProvider();Y.audioContext.listener.setOrientation(P.x||0,P.y||0,P.z||0,0,1,0)}else C?(C.rigCameras&&C.rigCameras.length>0&&(C=C.rigCameras[0]),C.getViewMatrix().invertToRef(this._invertMatrixTemp),q.Of.TransformNormalToRef(LY._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.q(this._cameraDirectionTemp),Y.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Y.audioContext.listener.setOrientation(0,0,0,0,1,0);for(P=0;P<f.mainSoundTrack.soundCollection.length;P++){const Y=f.mainSoundTrack.soundCollection[P];Y.useCustomAttenuation&&Y.updateDistanceFromListener()}if(f.soundTracks)for(P=0;P<f.soundTracks.length;P++)for(let Y=0;Y<f.soundTracks[P].soundCollection.length;Y++){const C=f.soundTracks[P].soundCollection[Y];C.useCustomAttenuation&&C.updateDistanceFromListener()}}}}LY._CameraDirection=new q.Of(0,0,-1),hf._SceneComponentInitialization=P=>{let f=P._getComponent(fY.d.NAME_AUDIO);f||(f=new LY(P),P.mf(f))};const oY="MSFT_audio_emitter";class wY{constructor(P){this.name=oY,this._loader=P,this.enabled=this._loader.isExtensionUsed(oY)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const P=this._loader.jf.extensions;if(P&&P[this.name]){const f=P[this.name];this._clips=f.clips,this._emitters=f.emitters,A.Assign(this._clips),A.Assign(this._emitters)}}loadSceneAsync(P,f){return t.LoadExtensionAsync(P,f,this.name,(async(Y,C)=>{const q=new Array;q.push(this._loader.loadSceneAsync(P,f));for(const P of C.emitters){const f=A.Get(`${Y}/emitters`,this._emitters,P);if(void 0!=f.refDistance||void 0!=f.maxDistance||void 0!=f.rolloffFactor||void 0!=f.distanceModel||void 0!=f.innerAngle||void 0!=f.outerAngle)throw new Error(`${Y}: Direction or Distance properties are not allowed on emitters attached to a scene`);q.push(this._loadEmitterAsync(`${Y}/emitters/${f.index}`,f))}await Promise.all(q)}))}loadNodeAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(P,C)=>{const m=new Array,o=await this._loader.loadNodeAsync(P,f,(f=>{for(const Y of C.emitters){const C=A.Get(`${P}/emitters`,this._emitters,Y);m.push(this._loadEmitterAsync(`${P}/emitters/${C.index}`,C).then((()=>{for(const P of C._babylonSounds)P.attachToMesh(f),void 0==C.innerAngle&&void 0==C.outerAngle||(P.setLocalDirectionToMesh(q.Of.Forward()),P.setDirectionalCone(2*L.Tools.ToDegrees(void 0==C.innerAngle?Math.PI:C.innerAngle),2*L.Tools.ToDegrees(void 0==C.outerAngle?Math.PI:C.outerAngle),0))})))}Y(f)}));return await Promise.all(m),o}))}loadAnimationAsync(P,f){return t.LoadExtensionAsync(P,f,this.name,(async(Y,C)=>{const q=await this._loader.loadAnimationAsync(P,f),m=new Array;A.Assign(C.events);for(const L of C.events)m.push(this._loadAnimationEventAsync(`${Y}/events/${L.index}`,P,f,L,q));return await Promise.all(m),q}))}_loadClipAsync(P,f){if(f._objectURL)return f._objectURL;let Y;if(f.uri)Y=this._loader.loadUriAsync(P,f,f.uri);else{const C=A.Get(`${P}/bufferView`,this._loader.jf.bufferViews,f.bufferView);Y=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}return f._objectURL=Y.then((P=>URL.createObjectURL(new Blob([P],{type:f.mimeType})))),f._objectURL}_loadEmitterAsync(P,f){if(f._babylonSounds=f._babylonSounds||[],!f._babylonData){const P=new Array,Y=f.name||`emitter${f.index}`,C={loop:!1,autoplay:!1,volume:void 0==f.volume?1:f.volume};for(let m=0;m<f.clips.length;m++){const q=`/extensions/${this.name}/clips`,L=A.Get(q,this._clips,f.clips[m].clip);P.push(this._loadClipAsync(`${q}/${f.clips[m].clip}`,L).then((P=>{const q=f._babylonSounds[m]=new hf(Y,P,this._loader.babylonScene,null,C);q.refDistance=f.refDistance||1,q.maxDistance=f.maxDistance||256,q.rolloffFactor=f.rolloffFactor||1,q.distanceModel=f.distanceModel||"exponential"})))}const q=Promise.all(P).then((()=>{const P=f.clips.map((P=>P.weight||1)),Y=new Ff(f.loop||!1,f._babylonSounds,P);f.innerAngle&&(Y.directionalConeInnerAngle=2*L.Tools.ToDegrees(f.innerAngle)),f.outerAngle&&(Y.directionalConeOuterAngle=2*L.Tools.ToDegrees(f.outerAngle)),f.volume&&(Y.volume=f.volume),f._babylonData.sound=Y}));f._babylonData={loaded:q}}return f._babylonData.loaded}_getEventAction(P,f,Y,C,q){switch(Y){case"play":return P=>{const Y=(q||0)+(P-C);f.play(Y)};case"stop":return()=>{f.stop()};case"pause":return()=>{f.pause()};default:throw new Error(`${P}: Unsupported action ${Y}`)}}_loadAnimationEventAsync(P,f,Y,C,q){if(0==q.targetedAnimations.length)return Promise.resolve();const m=q.targetedAnimations[0],L=C.k,o=A.Get(`/extensions/${this.name}/emitters`,this._emitters,L);return this._loadEmitterAsync(P,o).then((()=>{const f=o._babylonData.sound;if(f){const Y=new bf(C.time,this._getEventAction(P,f,C.action,C.time,C.startOffset));m.animation.addEvent(Y),q.onAnimationGroupEndObservable.add((()=>{f.stop()})),q.onAnimationGroupPauseObservable.add((()=>{f.pause()}))}}))}}X(oY),I(oY,!0,(P=>new wY(P)));const dY="MSFT_lod";class RY{constructor(P){var f;this.name=dY,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new R.e,this.onMaterialLODsLoadedObservable=new R.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=P,this.maxLODsToLoad=(null===(f=this._loader.parent.extensionOptions[dY])||void 0===f?void 0:f.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(dY)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let P=0;P<this._nodePromiseLODs.length;P++){const f=Promise.all(this._nodePromiseLODs[P]).then((()=>{0!==P&&(this._loader.endPerformanceCounter(`Node LOD ${P}`),this._loader.log(`Loaded node LOD ${P}`)),this.onNodeLODsLoadedObservable.notifyObservers(P),P!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${P+1}`),this._loadBufferLOD(this._nodeBufferLODs,P+1),this._nodeSignalLODs[P]&&this._nodeSignalLODs[P].resolve())}));this._loader._completePromises.push(f)}for(let P=0;P<this._materialPromiseLODs.length;P++){const f=Promise.all(this._materialPromiseLODs[P]).then((()=>{0!==P&&(this._loader.endPerformanceCounter(`Material LOD ${P}`),this._loader.log(`Loaded material LOD ${P}`)),this.onMaterialLODsLoadedObservable.notifyObservers(P),P!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${P+1}`),this._loadBufferLOD(this._materialBufferLODs,P+1),this._materialSignalLODs[P]&&this._materialSignalLODs[P].resolve())}));this._loader._completePromises.push(f)}}loadSceneAsync(P,f){const Y=this._loader.loadSceneAsync(P,f);return this._loadBufferLOD(this._bufferLODs,0),Y}loadNodeAsync(P,f,Y){return t.LoadExtensionAsync(P,f,this.name,(async(P,q)=>{let m;const L=this._getLODs(P,f,this._loader.jf.nodes,q.ids);this._loader.logOpen(`${P}`);for(let f=0;f<L.length;f++){const P=L[f];0!==f&&(this._nodeIndexLOD=f,this._nodeSignalLODs[f]=this._nodeSignalLODs[f]||new C);const q=P=>{Y(P),P.No(!1)},o=this._loader.loadNodeAsync(`/nodes/${P.index}`,P,q).then((P=>{if(0!==f){const P=L[f-1];P._babylonTransformNode&&(this._disposeTransformNode(P._babylonTransformNode),delete P._babylonTransformNode)}return P.No(!0),P}));this._nodePromiseLODs[f]=this._nodePromiseLODs[f]||[],0===f?m=o:(this._nodeIndexLOD=null,this._nodePromiseLODs[f].push(o))}return this._loader.logClose(),await m}))}_loadMaterialAsync(P,f,Y,C,q){return this._nodeIndexLOD?null:t.LoadExtensionAsync(P,f,this.name,(async(P,m)=>{let L;const o=this._getLODs(P,f,this._loader.jf.materials,m.ids);this._loader.logOpen(`${P}`);for(let f=0;f<o.length;f++){const P=o[f];0!==f&&(this._materialIndexLOD=f);const m=this._loader._loadMaterialAsync(`/materials/${P.index}`,P,Y,C,(P=>{0===f&&q(P)})).then((P=>{if(0!==f){q(P);const Y=o[f-1]._data;Y[C]&&(this._disposeMaterials([Y[C].babylonMaterial]),delete Y[C])}return P}));this._materialPromiseLODs[f]=this._materialPromiseLODs[f]||[],0===f?L=m:(this._materialIndexLOD=null,this._materialPromiseLODs[f].push(m))}return this._loader.logClose(),await L}))}_loadUriAsync(P,f,Y){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const q=this._nodeIndexLOD-1;return this._nodeSignalLODs[q]=this._nodeSignalLODs[q]||new C,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(P,f,Y)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const q=this._materialIndexLOD-1;return this._materialSignalLODs[q]=this._materialSignalLODs[q]||new C,this._materialSignalLODs[q].promise.then((async()=>await this._loader.loadUriAsync(P,f,Y)))}return null}loadBufferAsync(P,f,Y,q){if(this._loader.parent.useRangeRequests&&!f.uri){if(!this._loader.bin)throw new Error(`${P}: Uri is missing or the binary glTF is missing its binary chunk`);const f=async(P,f)=>{const m=Y,L=m+q-1;let o=P[f];return o?(o.start=Math.min(o.start,m),o.end=Math.max(o.end,L)):(o={start:m,end:L,loaded:new C},P[f]=o),await o.loaded.promise.then((P=>new Uint8Array(P.buffer,P.byteOffset+Y-o.start,q)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?f(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?f(this._materialBufferLODs,this._materialIndexLOD):f(this._bufferLODs,0)}return null}_loadBufferLOD(P,f){const Y=P[f];Y&&(this._loader.log(`Loading buffer range [${Y.start}-${Y.end}]`),this._loader.bin.readAsync(Y.start,Y.end-Y.start+1).then((P=>{Y.loaded.resolve(P)}),(P=>{Y.loaded.reject(P)})))}_getLODs(P,f,Y,C){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const q=[];for(let m=C.length-1;m>=0;m--)if(q.push(A.Get(`${P}/ids/${C[m]}`,Y,C[m])),q.length===this.maxLODsToLoad)return q;return q.push(f),q}_disposeTransformNode(P){const f=[],Y=P.material;Y&&f.push(Y);for(const q of P.getChildMeshes())q.material&&f.push(q.material);P.dispose();const C=f.filter((P=>this._loader.babylonScene.meshes.every((f=>f.material!=P))));this._disposeMaterials(C)}_disposeMaterials(P){const f={};for(const Y of P){for(const P of Y.getActiveTextures())f[P.uniqueId]=P;Y.dispose()}for(const Y in f)for(const P of this._loader.babylonScene.materials)P.hasTexture(f[Y])&&delete f[Y];for(const Y in f)f[Y].dispose()}}X(dY),I(dY,!0,(P=>new RY(P)));const yY="MSFT_minecraftMesh";class rY{constructor(P){this.name=yY,this._loader=P,this.enabled=this._loader.isExtensionUsed(yY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtraAsync(P,f,this.name,(async(C,q)=>{if(q){if(!(Y instanceof V.d))throw new Error(`${C}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(P,f,Y);return Y.needAlphaBlending()&&(Y.forceDepthWrite=!0,Y.separateCullingPass=!0),Y.XL=Y.forceDepthWrite,Y.twoSidedLighting=!0,await q}}))}}X(yY),I(yY,!0,(P=>new rY(P)));const iY="MSFT_sRGBFactors";class uY{constructor(P){this.name=iY,this._loader=P,this.enabled=this._loader.isExtensionUsed(iY)}dispose(){this._loader=null}loadMaterialPropertiesAsync(P,f,Y){return t.LoadExtraAsync(P,f,this.name,(async(C,q)=>{if(q){if(!(Y instanceof V.d))throw new Error(`${C}: Material type not supported`);const q=this._loader.loadMaterialPropertiesAsync(P,f,Y),m=Y.vP().getEngine().useExactSrgbConversions;return Y.albedoTexture||Y.albedoColor.toLinearSpaceToRef(Y.albedoColor,m),Y.reflectivityTexture||Y.reflectivityColor.toLinearSpaceToRef(Y.reflectivityColor,m),await q}}))}}X(iY),I(iY,!0,(P=>new uY(P)));var gY=Y(12895);const SY={};var KY=Y(12962),MY=Y(12939),VY=Y(12899),OY=Y(12917);function nY(P,f){for(const Y of P)for(const P of Y.dataOutputs)if(P.uniqueId===f)return P;throw new Error("Could not find data out connection with unique id "+f)}function lY(P,f){for(const Y of P)if(Y instanceof MY.d)for(const P of Y.signalInputs)if(P.uniqueId===f)return P;throw new Error("Could not find signal in connection with unique id "+f)}async function vY(P,f){const C=await Promise.all(P.allBlocks.map((async P=>{const f=function(P){switch(P){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([Y.e(78),Y.e(79)]).then(Y.bind(Y,14357))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await Y.e(80).then(Y.bind(Y,14359))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await Y.e(81).then(Y.bind(Y,14365))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await Y.e(82).then(Y.bind(Y,14369))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await Y.e(83).then(Y.bind(Y,14376))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await Y.e(84).then(Y.bind(Y,14383))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await Y.e(85).then(Y.bind(Y,14385))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await Y.e(86).then(Y.bind(Y,14393))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await Y.e(87).then(Y.bind(Y,14395))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await Y.e(90).then(Y.bind(Y,14431))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await Y.e(90).then(Y.bind(Y,14431))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await Y.e(90).then(Y.bind(Y,14431))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await Y.e(90).then(Y.bind(Y,14431))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await Y.e(95).then(Y.bind(Y,14436))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await Y.e(96).then(Y.bind(Y,14440))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await Y.e(97).then(Y.bind(Y,14442))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await Y.e(98).then(Y.bind(Y,14446))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await Y.e(99).then(Y.bind(Y,14455))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await Y.e(100).then(Y.bind(Y,14463))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await Y.e(101).then(Y.bind(Y,14467))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await Y.e(102).then(Y.bind(Y,14471))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await Y.e(103).then(Y.bind(Y,14480))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await Y.e(104).then(Y.bind(Y,14488))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await Y.e(105).then(Y.bind(Y,14496))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await Y.e(106).then(Y.bind(Y,14503))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await Y.e(107).then(Y.bind(Y,14512))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await Y.e(108).then(Y.bind(Y,14521))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await Y.e(109).then(Y.bind(Y,14525))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await Y.e(110).then(Y.bind(Y,14527))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await Y.e(111).then(Y.bind(Y,14533))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await Y.e(112).then(Y.bind(Y,14536))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await Y.e(113).then(Y.bind(Y,14542))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await Y.e(92).then(Y.bind(Y,14550))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await Y.e(114).then(Y.bind(Y,14559))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await Y.e(115).then(Y.bind(Y,14562))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await Y.e(116).then(Y.bind(Y,14564))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await Y.e(93).then(Y.bind(Y,14571))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await Y.e(88).then(Y.bind(Y,14404))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await Y.e(94).then(Y.bind(Y,14573))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await Y.e(89).then(Y.bind(Y,14422))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await Y.e(90).then(Y.bind(Y,14431))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await Y.e(90).then(Y.bind(Y,14431))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await Y.e(91).then(Y.bind(Y,14576))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await Y.e(91).then(Y.bind(Y,14576))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await Y.e(91).then(Y.bind(Y,14576))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await Y.e(91).then(Y.bind(Y,14576))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await Y.e(91).then(Y.bind(Y,14576))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await Y.e(91).then(Y.bind(Y,14576))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await Y.e(117).then(Y.bind(Y,14578))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await Y.e(118).then(Y.bind(Y,14580))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await Y.e(119).then(Y.bind(Y,14582))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await Y.e(120).then(Y.bind(Y,14585))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await Y.e(121).then(Y.bind(Y,14592))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await Y.e(122).then(Y.bind(Y,14597))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await Y.e(123).then(Y.bind(Y,14603))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await Y.e(124).then(Y.bind(Y,14611))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await Y.e(125).then(Y.bind(Y,14616))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await Y.e(126).then(Y.bind(Y,14621))).FlowGraphDataSwitchBlock;default:if(SY[P])return SY[P];throw new Error(`Unknown block name ${P}`)}}(P.className);return await f()})));return function(P,f,Y){const C=f.coordinator.createGraph(),q=[],m=f.valueParseFunction??VY.c;for(let L=0;L<P.allBlocks.length;L++){const o=TY(P.allBlocks[L],{lf:f.coordinator.config.lf,pathConverter:f.pathConverter,assetsContainer:f.coordinator.config.lf,valueParseFunction:m},Y[L]);q.push(o),o instanceof KY.b&&C.addEventBlock(o)}for(const L of q){for(const P of L.dataInputs)for(const f of P.connectedPointIds){const Y=nY(q,f);P.connectTo(Y)}if(L instanceof MY.d)for(const P of L.signalOutputs)for(const f of P.connectedPointIds){const Y=lY(q,f);P.connectTo(Y)}}for(const L of P.executionContexts)cY(L,{graph:C,valueParseFunction:m},P.rightHanded);return C}(P,f,C)}function cY(P,f,Y){const C=f.graph.createContext();P.enableLogging&&(C.enableLogging=!0),C.treatDataAsRightHanded=Y||!1;const q=f.valueParseFunction??VY.c;C.uniqueId=P.uniqueId;const m=C.vP();if(P._assetsContext){var L,o,w,d,R,y,r,i,u,g;const f=P._assetsContext,Y={meshes:null===(L=f.meshes)||void 0===L?void 0:L.map((P=>m.getMeshById(P))),lights:null===(o=f.lights)||void 0===o?void 0:o.map((P=>m.getLightByName(P))),cameras:null===(w=f.cameras)||void 0===w?void 0:w.map((P=>m.getCameraByName(P))),materials:null===(d=f.materials)||void 0===d?void 0:d.map((P=>m.getMaterialById(P))),textures:null===(R=f.textures)||void 0===R?void 0:R.map((P=>m.getTextureByName(P))),animations:null===(y=f.animations)||void 0===y?void 0:y.map((P=>m.animations.find((f=>f.name===P)))),skeletons:null===(r=f.skeletons)||void 0===r?void 0:r.map((P=>m.getSkeletonByName(P))),Rr:null===(i=f.Rr)||void 0===i?void 0:i.map((P=>m.getParticleSystemById(P))),animationGroups:null===(u=f.animationGroups)||void 0===u?void 0:u.map((P=>m.getAnimationGroupByName(P))),transformNodes:null===(g=f.transformNodes)||void 0===g?void 0:g.map((P=>m.getTransformNodeById(P))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],zr:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};C.assetsContext=Y}for(const S in P._userVariables){const f=q(S,P._userVariables,C.assetsContext,m);C.userVariables[S]=f}for(const S in P._connectionValues){const f=q(S,P._connectionValues,C.assetsContext,m);C._setConnectionValueByKey(S,f)}return C}function TY(P,f,Y){const C={},q=f.valueParseFunction??VY.c;if(P.config)for(const L in P.config)C[L]=q(L,P.config,f.assetsContainer||f.lf,f.lf);if((0,VY.f)(P.className)){if(!f.pathConverter)throw new Error("Path converter is required for this block");C.pathConverter=f.pathConverter}const m=new Y(C);m.uniqueId=P.uniqueId;for(let L=0;L<P.dataInputs.length;L++){const f=m.getDataInput(P.dataInputs[L].name);if(!f)throw new Error("Could not find data input with name "+P.dataInputs[L].name+" in block "+P.className);f.deserialize(P.dataInputs[L])}for(let L=0;L<P.dataOutputs.length;L++){const f=m.getDataOutput(P.dataOutputs[L].name);if(!f)throw new Error("Could not find data output with name "+P.dataOutputs[L].name+" in block "+P.className);f.deserialize(P.dataOutputs[L])}return m.metadata=P.metadata,m.deserialize&&m.deserialize(P),m}function UY(P){const[f,Y]=P.split(":");return DY({op:f,extension:Y})}function DY(P){var f;let Y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=P.extension?null===(f=eY[P.extension])||void 0===f?void 0:f[P.op]:sY[P.op];if(!C&&(g.e.Warn(`No mapping found for operation ${P.op} and extension ${P.extension||"KHR_interactivity"}`),Y)){const f={},Y={flows:{}};if(P.inputValueSockets){f.values={};for(const Y in P.inputValueSockets)f.values[Y]={name:Y}}return P.outputValueSockets&&(Y.values={},Object.keys(P.outputValueSockets).forEach((P=>{Y.values[P]={name:P}}))),{OR:[],inputs:f,outputs:Y}}return C}function jY(P,f,Y){eY[f]||(eY[f]={}),eY[f][P]=Y}const eY={BABYLON:{"flow/log":{OR:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},sY={"event/onStart":{OR:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{OR:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{OR:["FlowGraphSendCustomEventBlock"],extraProcessor(P,f,Y,C,q){if("event/send"!==f.op||!P.configuration||1!==Object.keys(P.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const m=P.configuration.event.value[0];if("number"!==typeof m)throw new Error("Event id should be a number");const L=C.arrays.events[m],o=q[0];return o.config||(o.config={}),o.config.eventId=L.eventId,o.config.eventData=L.eventData,q}},"event/receive":{OR:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(P,f){var Y;if(!P.configuration)return g.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const C=P.configuration.event;if(!C)return g.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const q=C.value[0];if("number"!==typeof q)return g.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(Y=f.events)||void 0===Y?void 0:Y[q])?{valid:!0}:(g.e.Error(`Event with id ${q} not found`),{valid:!1,error:`Event with id ${q} not found`})},extraProcessor(P,f,Y,C,q){if("event/receive"!==f.op||!P.configuration||1!==Object.keys(P.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const m=P.configuration.event.value[0];if("number"!==typeof m)throw new Error("Event id should be a number");const L=C.arrays.events[m],o=q[0];return o.config||(o.config={}),o.config.eventId=L.eventId,o.config.eventData=L.eventData,q}},"math/e":aY("FlowGraphEBlock"),"math/pi":aY("FlowGraphPIBlock"),"math/inf":aY("FlowGraphInfBlock"),"math/nan":aY("FlowGraphNaNBlock"),"math/abs":aY("FlowGraphAbsBlock"),"math/sign":aY("FlowGraphSignBlock"),"math/trunc":aY("FlowGraphTruncBlock"),"math/floor":aY("FlowGraphFloorBlock"),"math/ceil":aY("FlowGraphCeilBlock"),"math/round":{OR:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q){var m;return(m=q[0]).config||(m.config={}),q[0].config.roundHalfAwayFromZero=!0,q}},"math/fract":aY("FlowGraphFractBlock"),"math/neg":aY("FlowGraphNegationBlock"),"math/add":aY("FlowGraphAddBlock",["a","b"],!0),"math/sub":aY("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{OR:["FlowGraphMultiplyBlock"],extraProcessor(P,f,Y,C,q){var m;(m=q[0]).config||(m.config={}),q[0].config.useMatrixPerComponent=!0,q[0].config.preventIntegerFloatArithmetic=!0;let L=-1;return Object.keys(P.values||{}).find((f=>{var Y;return void 0!==(null===(Y=P.values)||void 0===Y?void 0:Y[f].type)&&(L=P.values[f].type,!0)})),-1!==L&&(q[0].config.type=C.arrays.types[L].flowGraphType),q},validation:P=>P.values?QY(P):{valid:!0}},"math/div":aY("FlowGraphDivideBlock",["a","b"],!0),"math/rem":aY("FlowGraphModuloBlock",["a","b"]),"math/min":aY("FlowGraphMinBlock",["a","b"]),"math/max":aY("FlowGraphMaxBlock",["a","b"]),"math/clamp":aY("FlowGraphClampBlock",["a","b","c"]),"math/saturate":aY("FlowGraphSaturateBlock"),"math/mix":aY("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":aY("FlowGraphEqualityBlock",["a","b"]),"math/lt":aY("FlowGraphLessThanBlock",["a","b"]),"math/le":aY("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":aY("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":aY("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":aY("FlowGraphIsNaNBlock"),"math/isinf":aY("FlowGraphIsInfBlock"),"math/select":{OR:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{OR:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":aY("FlowGraphSinBlock"),"math/cos":aY("FlowGraphCosBlock"),"math/tan":aY("FlowGraphTanBlock"),"math/asin":aY("FlowGraphASinBlock"),"math/acos":aY("FlowGraphACosBlock"),"math/atan":aY("FlowGraphATanBlock"),"math/atan2":aY("FlowGraphATan2Block",["a","b"]),"math/sinh":aY("FlowGraphSinhBlock"),"math/cosh":aY("FlowGraphCoshBlock"),"math/tanh":aY("FlowGraphTanhBlock"),"math/asinh":aY("FlowGraphASinhBlock"),"math/acosh":aY("FlowGraphACoshBlock"),"math/atanh":aY("FlowGraphATanhBlock"),"math/exp":aY("FlowGraphExponentialBlock"),"math/log":aY("FlowGraphLogBlock"),"math/log2":aY("FlowGraphLog2Block"),"math/log10":aY("FlowGraphLog10Block"),"math/sqrt":aY("FlowGraphSquareRootBlock"),"math/cbrt":aY("FlowGraphCubeRootBlock"),"math/pow":aY("FlowGraphPowerBlock",["a","b"]),"math/length":aY("FlowGraphLengthBlock"),"math/normalize":aY("FlowGraphNormalizeBlock"),"math/dot":aY("FlowGraphDotBlock",["a","b"]),"math/cross":aY("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":aY("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":aY("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{OR:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{OR:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{OR:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{OR:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{OR:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{OR:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{OR:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":aY("FlowGraphTransposeBlock"),"math/determinant":aY("FlowGraphDeterminantBlock"),"math/inverse":aY("FlowGraphInvertMatrixBlock"),"math/matmul":aY("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{OR:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Ro",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q,m){const L=q[0].dataInputs.find((P=>"rotationQuaternion"===P.name));if(!L)throw new Error("Rotation quaternion input not found");return m._connectionValues[L.uniqueId]&&(m._connectionValues[L.uniqueId].type="Quaternion"),q}},"math/matDecompose":{OR:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Ro"}}}},"math/quatConjugate":aY("FlowGraphConjugateBlock",["a"]),"math/quatMul":{OR:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q){var m;return(m=q[0]).config||(m.config={}),q[0].config.type="Quaternion",q}},"math/quatAngleBetween":aY("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{OR:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":aY("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":aY("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{OR:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q){var m;return(m=q[0]).config||(m.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract2x2":{OR:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{OR:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q){var m;return(m=q[0]).config||(m.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract3x3":{OR:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{OR:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q){var m;return(m=q[0]).config||(m.config={}),q[0].config.inputIsColumnMajor=!0,q}},"math/extract4x4":{OR:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{OR:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q,m){var L,o;(o=q[0]).config||(o.config={});const w=q[0].dataInputs[0];return q[0].config.valueType=(null===(L=m._connectionValues[w.uniqueId])||void 0===L?void 0:L.type)??"FlowGraphInteger",q}},"math/and":{OR:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q,m){var L,o,w;(w=q[0]).config||(w.config={});const d=q[0].dataInputs[0],R=q[0].dataInputs[1];return q[0].config.valueType=(null===(L=m._connectionValues[d.uniqueId])||void 0===L?void 0:L.type)??(null===(o=m._connectionValues[R.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",q}},"math/or":{OR:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q,m){var L,o,w;(w=q[0]).config||(w.config={});const d=q[0].dataInputs[0],R=q[0].dataInputs[1];return q[0].config.valueType=(null===(L=m._connectionValues[d.uniqueId])||void 0===L?void 0:L.type)??(null===(o=m._connectionValues[R.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",q}},"math/xor":{OR:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(P,f,Y,C,q,m){var L,o,w;(w=q[0]).config||(w.config={});const d=q[0].dataInputs[0],R=q[0].dataInputs[1];return q[0].config.valueType=(null===(L=m._connectionValues[d.uniqueId])||void 0===L?void 0:L.type)??(null===(o=m._connectionValues[R.uniqueId])||void 0===o?void 0:o.type)??"FlowGraphInteger",q}},"math/asr":aY("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":aY("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":aY("FlowGraphLeadingZerosBlock"),"math/ctz":aY("FlowGraphTrailingZerosBlock"),"math/popcnt":aY("FlowGraphOneBitsCounterBlock"),"math/rad":aY("FlowGraphDegToRadBlock"),"math/deg":aY("FlowGraphRadToDegBlock"),"type/boolToInt":aY("FlowGraphBooleanToInt"),"type/boolToFloat":aY("FlowGraphBooleanToFloat"),"type/intToBool":aY("FlowGraphIntToBoolean"),"type/intToFloat":aY("FlowGraphIntToFloat"),"type/floatToInt":aY("FlowGraphFloatToInt"),"type/floatToBool":aY("FlowGraphFloatToBoolean"),"flow/sequence":{OR:["FlowGraphSequenceBlock"],extraProcessor(P,f,Y,C,q){const m=q[0];return m.config||(m.config={}),m.config.outputSignalCount=Object.keys(P.flows||[]).length,m.signalOutputs.forEach(((P,f)=>{P.name="out_"+f})),q}},"flow/branch":{OR:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{OR:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(P){if(P.configuration&&P.configuration.cases){const f=P.configuration.cases.value;if(!f.every((P=>"number"===typeof P&&/^-?\d+$/.test(P.toString()))))return g.e.Warn("Switch cases should be integers. Using empty array instead."),P.configuration.cases.value=[],{valid:!0};const Y=new Set(f);P.configuration.cases.value=Array.from(Y)}return{valid:!0}},extraProcessor(P,f,Y,C,q){if("flow/switch"!==f.op||!P.flows||0===Object.keys(P.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return q[0].signalOutputs.forEach((P=>{"default"!==P.name&&(P.name="out_"+P.name)})),q}},"flow/while":{OR:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{OR:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(P,f,Y,C,q){const m=q[0];return m.config||(m.config={}),m.config.incrementIndexWhenLoopDone=!0,q}},"flow/doN":{OR:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{OR:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(P,f,Y,C,q){if("flow/multiGate"!==f.op||!P.flows||0===Object.keys(P.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const m=q[0];return m.config||(m.config={}),m.config.outputSignalCount=Object.keys(P.flows).length,m.signalOutputs.forEach(((P,f)=>{P.name="out_"+f})),q}},"flow/waitAll":{OR:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(P){var f,Y;return"number"!==typeof(null===(f=P.configuration)||void 0===f||null===(Y=f.inputFlows)||void 0===Y?void 0:Y.value[0])&&(P.configuration=P.configuration||{inputFlows:{value:[0]}},P.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{OR:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{OR:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{OR:["FlowGraphCancelDelayBlock"]},"variable/get":{OR:["FlowGraphGetVariableBlock"],validation(P){var f,Y;return null!==(f=P.configuration)&&void 0!==f&&null!==(Y=f.variable)&&void 0!==Y&&Y.value?{valid:!0}:(g.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(P,f)=>[f.getVariableName(P[0])]}}},"variable/set":{OR:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(P,f)=>[f.getVariableName(P[0])]}}},"variable/setMultiple":{OR:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(P,f)=>[P[0].map((P=>f.getVariableName(P)))]}},extraProcessor:(P,f,Y,C,q)=>(q[0].dataInputs.forEach((P=>{P.name=C.getVariableName(+P.name)})),q)},"variable/interpolate":{OR:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(P,f)=>[f.getVariableName(P[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:P=>!0===P[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xY:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xY:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xY:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xY:"FlowGraphPlayAnimationBlock"},out:{name:"out",xY:"FlowGraphPlayAnimationBlock"},done:{name:"done",xY:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(P,f,Y,C,q){var m,L,o;const w=q[0],d=null===(m=P.configuration)||void 0===m?void 0:m.variable.value[0];if("number"!==typeof d)throw g.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const R=C.arrays.staticVariables[d];"undefined"===typeof w.config.animationType.value&&(C.arrays.staticVariables,w.config.animationType.value=(0,OY.y)(R.type));const y=q[4];return y.config||(y.config={}),(L=y.config).variable||(L.variable={}),y.config.variable.value=C.getVariableName(d),(o=q[3]).config||(o.config={}),q}},"pointer/get":{OR:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xY:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",xY:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(P,f,Y,C,q)=>(q.forEach((P=>{"FlowGraphJsonPointerParserBlock"===P.className&&(P.config||(P.config={}),P.config.outputValue=!0)})),q)},"pointer/set":{OR:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xY:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",xY:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(P,f,Y,C,q)=>(q.forEach((P=>{"FlowGraphJsonPointerParserBlock"===P.className&&(P.config||(P.config={}),P.config.outputValue=!0)})),q)},"pointer/interpolate":{OR:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",xY:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",xY:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xY:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xY:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xY:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xY:"FlowGraphPlayAnimationBlock"},out:{name:"out",xY:"FlowGraphPlayAnimationBlock"},done:{name:"done",xY:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(P,f,Y,C,q)=>(q.forEach((f=>{"FlowGraphJsonPointerParserBlock"===f.className?(f.config||(f.config={}),f.config.outputValue=!0):"FlowGraphInterpolationBlock"===f.className&&(f.config||(f.config={}),Object.keys(P.values||[]).forEach((Y=>{var q;const m=null===(q=P.values)||void 0===q?void 0:q[Y];if("value"===Y&&m){const P=m.type;void 0!==P&&(f.config.animationType=C.arrays.types[P].flowGraphType)}})))})),q)},"animation/start":{OR:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xY:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(P,f)=>[P[0]*f._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(P,f)=>[P[0]*f._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(P,f,Y,C,q,m,L){const o=q[q.length-1];return o.config||(o.config={}),o.config.glTF=L,q}},"animation/stop":{OR:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xY:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(P,f,Y,C,q,m,L){const o=q[q.length-1];return o.config||(o.config={}),o.config.glTF=L,q}},"animation/stopAt":{OR:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",xY:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(P,f)=>[P[0]*f._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(P,f,Y,C,q,m,L){const o=q[q.length-1];return o.config||(o.config={}),o.config.glTF=L,q}},"math/switch":{OR:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(P){if(P.configuration&&P.configuration.cases){const f=P.configuration.cases.value;if(!f.every((P=>"number"===typeof P&&/^-?\d+$/.test(P.toString()))))return g.e.Warn("Switch cases should be integers. Using empty array instead."),P.configuration.cases.value=[],{valid:!0};const Y=new Set(f);P.configuration.cases.value=Array.from(Y)}return{valid:!0}},extraProcessor(P,f,Y,C,q){const m=q[0];return m.dataInputs.forEach((P=>{"default"!==P.name&&"case"!==P.name&&(P.name="in_"+P.name)})),m.config||(m.config={}),m.config.treatCasesAsIntegers=!0,q}},"debug/log":{OR:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function aY(P){let f=arguments.length>2?arguments[2]:void 0;return{OR:[P],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((P,f)=>(P[f]={name:f},P)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(P,Y,C,q,m){var L;if(f){(L=m[0]).config||(L.config={}),m[0].config.preventIntegerFloatArithmetic=!0;let f=-1;Object.keys(P.values||{}).find((Y=>{var C;return void 0!==(null===(C=P.values)||void 0===C?void 0:C[Y].type)&&(f=P.values[Y].type,!0)})),-1!==f&&(m[0].config.type=q.arrays.types[f].flowGraphType)}return m},validation:P=>f?QY(P):{valid:!0}}}function QY(P){if(P.values){const f=Object.keys(P.values).map((f=>P.values[f].type)).filter((P=>void 0!==P));if(!f.every((P=>P===f[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}sY["math/compose"]=sY["math/matCompose"],sY["math/decompose"]=sY["math/matDecompose"];var JY=Y(11139);const NY={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Of",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class IY{constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=P,this._gltf=f,this._animationTargetFps=Y,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const P of this._interactivityGraph.types)this._types.push(NY[P.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const P of this._interactivityGraph.declarations){const f=DY(P);if(!f)throw g.e.Error(["No mapping found for declaration",P]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:f,fullOperationName:P.extension?P.op+":"+P.extension:P.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const P of this._interactivityGraph.variables){const f=this._parseVariable(P);this._staticVariables.push(f)}}_parseVariable(P,f){const Y=this._types[P.type];if(!Y)throw g.e.Error(["No type found for variable",P]),new Error("Error parsing variables");if(P.value&&P.value.length!==Y.length)throw g.e.Error(["Invalid value length for variable",P,Y]),new Error("Error parsing variables");const C=P.value||[];if(!C.length)switch(Y.flowGraphType){case"boolean":C.push(!1);break;case"FlowGraphInteger":C.push(0);break;case"number":C.push(NaN);break;case"Vector2":C.push(NaN,NaN);break;case"Of":C.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":C.fill(NaN,0,4);break;case"Matrix":C.fill(NaN,0,16);break;case"Matrix3D":C.fill(NaN,0,9)}return"number"===Y.elementType&&"string"===typeof C[0]&&(C[0]=parseFloat(C[0])),{type:Y.flowGraphType,value:f?f(C,this):C}}_parseEvents(){if(this._interactivityGraph.events)for(const P of this._interactivityGraph.events){const f={eventId:P.id||"internalEvent_"+this._internalEventsCounter++};P.values&&(f.eventData=Object.keys(P.values).map((f=>{var Y;const C=null===(Y=P.values)||void 0===Y?void 0:Y[f];if(!C)throw g.e.Error(["No value found for event key",f]),new Error("Error parsing events");const q=this._types[C.type];if(!q)throw g.e.Error(["No type found for event value",C]),new Error("Error parsing events");const m="undefined"!==typeof C.value?this._parseVariable(C):void 0;return{id:f,type:q.flowGraphType,eventData:!0,value:m}}))),this._events.push(f)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const f of this._interactivityGraph.nodes){if("number"!==typeof f.declaration)throw g.e.Error(["No declaration found for node",f]),new Error("Error parsing nodes");const Y=this._mappings[f.declaration];if(!Y)throw g.e.Error(["No mapping found for node",f]),new Error("Error parsing nodes");if(Y.flowGraphMapping.validation){const C=Y.flowGraphMapping.validation(f,this._interactivityGraph,this._gltf);var P;if(!C.valid)throw new Error(`Error validating interactivity node ${null===(P=this._interactivityGraph.declarations)||void 0===P?void 0:P[f.declaration].op} - ${C.error}`)}const C=[];for(const P of Y.flowGraphMapping.OR){const q=this._getEmptyBlock(P,Y.fullOperationName);this._parseNodeConfiguration(f,q,Y.flowGraphMapping,P),C.push(q)}this._nodes.push({OR:C,fullOperationName:Y.fullOperationName})}}_getEmptyBlock(P,f){return{uniqueId:(0,JY.b)(),className:P,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:f,metadata:{}}}_parseNodeConfiguration(P,f,Y,C){const q=f.config;if(P.configuration){const f=Object.keys(P.configuration);for(const o of f){var m,L;const f=null===(m=P.configuration)||void 0===m?void 0:m[o];if(!f)throw g.e.Error(["No value found for node configuration",o]),new Error("Error parsing node configuration");const w=null===(L=Y.configuration)||void 0===L?void 0:L[o];if(w&&w.xY?w.xY===C:0===Y.OR.indexOf(C)){const P=(null===w||void 0===w?void 0:w.name)||o;f&&"undefined"!==typeof f.value||"undefined"===typeof(null===w||void 0===w?void 0:w.defaultValue)?f.value.length>=0?q[P]={value:1===f.value.length?f.value[0]:f.value}:g.e.Warn(["Invalid value for node configuration",f]):q[P]={value:w.defaultValue},w&&w.dataTransformer&&(q[P].value=w.dataTransformer([q[P].value],this)[0])}}}}_parseNodeConnections(P){for(let l=0;l<this._nodes.length;l++){var f;const v=null===(f=this._interactivityGraph.nodes)||void 0===f?void 0:f[l];if(!v)throw g.e.Error(["No node found for interactivity node",this._nodes[l]]),new Error("Error parsing node connections");const c=this._nodes[l],T=this._mappings[v.declaration];if(!T)throw g.e.Error(["No mapping found for node",v]),new Error("Error parsing node connections");const U=v.flows||{},D=Object.keys(U).sort();for(const P of D){var Y,C,q,m;const f=U[P],d=null===(Y=T.flowGraphMapping.outputs)||void 0===Y||null===(C=Y.flows)||void 0===C?void 0:C[P],R=(null===d||void 0===d?void 0:d.name)||P,y=this._createNewSocketConnection(R,!0);(d&&d.xY&&c.OR.find((P=>P.className===d.xY))||c.OR[0]).signalOutputs.push(y);const r=f.node,i=this._nodes[r];if(!i)throw g.e.Error(["No node found for input node id",r]),new Error("Error parsing node connections");const u=UY(i.fullOperationName);if(!u)throw g.e.Error(["No mapping found for input node",i]),new Error("Error parsing node connections");let S=null===(q=u.inputs)||void 0===q||null===(m=q.flows)||void 0===m?void 0:m[f.socket||"in"],K=!1;if(!S)for(const P in null===(L=u.inputs)||void 0===L?void 0:L.flows){var L,o,w;if(P.startsWith("[")&&P.endsWith("]"))K=!0,S=null===(o=u.inputs)||void 0===o||null===(w=o.flows)||void 0===w?void 0:w[P]}const M=S?K?S.name.replace("$1",f.socket||""):S.name:f.socket||"in",V=S&&S.xY&&i.OR.find((P=>P.className===S.xY))||i.OR[0];let O=V.signalInputs.find((P=>P.name===M));O||(O=this._createNewSocketConnection(M),V.signalInputs.push(O)),O.connectedPointIds.push(y.uniqueId),y.connectedPointIds.push(O.uniqueId)}const j=v.values||{},e=Object.keys(j);for(const f of e){var d,R;const Y=j[f];let C=null===(d=T.flowGraphMapping.inputs)||void 0===d||null===(R=d.values)||void 0===R?void 0:R[f],q=!1;if(!C)for(const P in null===(y=T.flowGraphMapping.inputs)||void 0===y?void 0:y.values){var y,r,i;if(P.startsWith("[")&&P.endsWith("]"))q=!0,C=null===(r=T.flowGraphMapping.inputs)||void 0===r||null===(i=r.values)||void 0===i?void 0:i[P]}const m=C?q?C.name.replace("$1",f):C.name:f,L=this._createNewSocketConnection(m);if((C&&C.xY&&c.OR.find((P=>P.className===C.xY))||c.OR[0]).dataInputs.push(L),void 0!==Y.value){const f=this._parseVariable(Y,C&&C.dataTransformer);P._connectionValues[L.uniqueId]=f}else{if("undefined"===typeof Y.node)throw g.e.Error(["Invalid value for value connection",Y]),new Error("Error parsing node connections");{var u,S,K;const P=Y.node,f=Y.socket||"value",C=this._nodes[P];if(!C)throw g.e.Error(["No node found for output socket reference",Y]),new Error("Error parsing node connections");const q=UY(C.fullOperationName);if(!q)throw g.e.Error(["No mapping found for output socket reference",Y]),new Error("Error parsing node connections");let m=null===(u=q.outputs)||void 0===u||null===(S=u.values)||void 0===S?void 0:S[f],o=!1;if(!m)for(const Y in null===(M=q.outputs)||void 0===M?void 0:M.values){var M,V,O;if(Y.startsWith("[")&&Y.endsWith("]"))o=!0,m=null===(V=q.outputs)||void 0===V||null===(O=V.values)||void 0===O?void 0:O[Y]}const w=m?o?m.name.replace("$1",f):null===(K=m)||void 0===K?void 0:K.name:f,d=m&&m.xY&&C.OR.find((P=>P.className===m.xY))||C.OR[0];let R=d.dataOutputs.find((P=>P.name===w));R||(R=this._createNewSocketConnection(w,!0),d.dataOutputs.push(R)),L.connectedPointIds.push(R.uniqueId),R.connectedPointIds.push(L.uniqueId)}}}if(T.flowGraphMapping.interBlockConnectors)for(const P of T.flowGraphMapping.interBlockConnectors){const f=P.input,Y=P.output,C=P.isVariable;this._connectFlowGraphNodes(f,Y,c.OR[P.inputBlockIndex],c.OR[P.outputBlockIndex],C)}if(T.flowGraphMapping.extraProcessor){var n;const f=null===(n=this._interactivityGraph.declarations)||void 0===n?void 0:n[v.declaration];if(!f)throw g.e.Error(["No declaration found for extra processor",v]),new Error("Error parsing node connections");c.OR=T.flowGraphMapping.extraProcessor(v,f,T.flowGraphMapping,this,c.OR,P,this._gltf)}}}_createNewSocketConnection(P,f){return{uniqueId:(0,JY.b)(),name:P,_connectionType:f?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(P,f,Y,C,q){const m=q?Y.dataInputs:Y.signalInputs,L=q?C.dataOutputs:C.signalOutputs,o=m.find((f=>f.name===P))||this._createNewSocketConnection(P),w=L.find((P=>P.name===f))||this._createNewSocketConnection(f,!0);m.find((f=>f.name===P))||m.push(o),L.find((P=>P.name===f))||L.push(w),o.connectedPointIds.push(w.uniqueId),w.connectedPointIds.push(o.uniqueId)}getVariableName(P){return"staticVariable_"+P}serializeToFlowGraph(){const P={uniqueId:(0,JY.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(P);for(let f=0;f<this._staticVariables.length;f++){const Y=this._staticVariables[f];P._userVariables[this.getVariableName(f)]=Y}return{rightHanded:!0,allBlocks:this._nodes.reduce(((P,f)=>P.concat(f.OR)),[]),executionContexts:[P]}}}const XY="KHR_interactivity";class xY{constructor(P){this._loader=P,this.name=XY,this.enabled=this._loader.isExtensionUsed(XY),this._pathConverter=(0,x.k)(this._loader.jf),P._skipStartAnimationStep=!0;const f=P.babylonScene;f&&function(P){(0,x.e)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!P.activeCamera)return new q.Quaternion(NaN,NaN,NaN,NaN);const f=q.Quaternion.FromRotationMatrix(P.activeCamera.getWorldMatrix()).normalize();return P.useRightHandedSystem||(f.w*=-1,f.x*=-1),f},type:"Quaternion",getTarget:()=>P.activeCamera}),(0,x.e)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!P.activeCamera)return new q.Of(NaN,NaN,NaN);const f=P.activeCamera.getWorldMatrix().getTranslation();return P.useRightHandedSystem||(f.x*=-1),f},type:"Of",getTarget:()=>P.activeCamera}),(0,x.e)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:P=>{var f;return(null===(f=P._babylonAnimationGroup)||void 0===f?void 0:f.isPlaying)??!1},type:"boolean",getTarget:P=>P._babylonAnimationGroup}),(0,x.e)("/animations/{}/extensions/KHR_interactivity/minTime",{get:P=>{var f;return((null===(f=P._babylonAnimationGroup)||void 0===f?void 0:f.from)??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup}),(0,x.e)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:P=>{var f;return((null===(f=P._babylonAnimationGroup)||void 0===f?void 0:f.to)??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup}),(0,x.e)("/animations/{}/extensions/KHR_interactivity/playhead",{get:P=>{var f;return((null===(f=P._babylonAnimationGroup)||void 0===f?void 0:f.getCurrentFrame())??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup}),(0,x.e)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:P=>{var f;return((null===(f=P._babylonAnimationGroup)||void 0===f?void 0:f.getCurrentFrame())??0)/60},type:"number",getTarget:P=>P._babylonAnimationGroup})}(f)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var P;if(!this._loader.babylonScene||!this._pathConverter)return;const f=this._loader.babylonScene,Y=null===(P=this._loader.jf.extensions)||void 0===P?void 0:P.KHR_interactivity;if(!Y)return;const C=new gY.e({lf:f});C.dispatchEventsSynchronously=!1;const q=Y.graphs.map((P=>new IY(P,this._loader.jf,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(q.map((async P=>await vY(P,{coordinator:C,pathConverter:this._pathConverter})))),C.start()}}var kY;kY=async()=>(await Promise.resolve().then(Y.bind(Y,12982))).FlowGraphGLTFDataProvider,SY[`${XY}/${"FlowGraphGLTFDataProvider"}`]=kY,X(XY),I(XY,!0,(P=>new xY(P)));const ZY="KHR_node_visibility";(0,x.e)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:P=>{const f=P._babylonTransformNode;return!f||void 0===f.isVisible||f.isVisible},set:(P,f)=>{var Y,C;null===(Y=f._primitiveBabylonMeshes)||void 0===Y||Y.forEach((P=>{P.inheritVisibility=!0})),f._babylonTransformNode&&(f._babylonTransformNode.isVisible=P),null===(C=f._primitiveBabylonMeshes)||void 0===C||C.forEach((f=>{f.isVisible=P}))},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class AY{constructor(P){this.name=ZY,this._loader=P,this.enabled=P.isExtensionUsed(ZY)}async onReady(){var P;null===(P=this._loader.jf.nodes)||void 0===P||P.forEach((P=>{var f,Y,C,q;(null===(f=P._primitiveBabylonMeshes)||void 0===f||f.forEach((P=>{P.inheritVisibility=!0})),null!==(Y=P.extensions)&&void 0!==Y&&Y.KHR_node_visibility)&&(!1===(null===(C=P.extensions)||void 0===C?void 0:C.KHR_node_visibility.visible)&&(P._babylonTransformNode&&(P._babylonTransformNode.isVisible=!1),null===(q=P._primitiveBabylonMeshes)||void 0===q||q.forEach((P=>{P.isVisible=!1}))))}))}dispose(){this._loader=null}}X(ZY),I(ZY,!0,(P=>new AY(P)));const EY="KHR_node_selectability";jY("event/onSelect",EY,{OR:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xY:"FlowGraphGetVariableBlock",dataTransformer:P=>["pickedMesh_"+P[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",xY:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(P,f,Y,C,q,m,L){var o,w,d,R,y,r;const i=q[q.length-1];i.config=i.config||{},i.config.glTF=L;const u=null===(o=P.configuration)||void 0===o||null===(w=o.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const g="pickedMesh_"+u;return q[1].config.variable=g,m._userVariables[g]={className:"Mesh",id:null===L||void 0===L||null===(d=L.nodes)||void 0===d||null===(R=d[u]._babylonTransformNode)||void 0===R?void 0:R.id,uniqueId:null===L||void 0===L||null===(y=L.nodes)||void 0===y||null===(r=y[u]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},q}}),(0,x.e)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:P=>{const f=P._babylonTransformNode;return!f||void 0===f.nw||f.nw},set:(P,f)=>{var Y;null===(Y=f._primitiveBabylonMeshes)||void 0===Y||Y.forEach((f=>{f.nw=P}))},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"nw"],type:"boolean"});class tY{constructor(P){this.name=EY,this._loader=P,this.enabled=P.isExtensionUsed(EY)}async onReady(){var P;null===(P=this._loader.jf.nodes)||void 0===P||P.forEach((P=>{var f,Y,C;null!==(f=P.extensions)&&void 0!==f&&f.KHR_node_selectability&&!1===(null===(Y=P.extensions)||void 0===Y?void 0:Y.KHR_node_selectability.selectable)&&(null===(C=P._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((P=>{P.nw=!1})))}))}dispose(){this._loader=null}}X(EY),I(EY,!0,(P=>new tY(P)));const GY="KHR_node_hoverability",zY="targetMeshPointerOver_";jY("event/onHoverIn",GY,{OR:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xY:"FlowGraphGetVariableBlock",dataTransformer:P=>[zY+P[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xY:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(P,f,Y,C,q,m,L){var o,w,d,R,y,r;const i=q[q.length-1];i.config=i.config||{},i.config.glTF=L;const u=null===(o=P.configuration)||void 0===o||null===(w=o.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const g=zY+u;return q[1].config.variable=g,m._userVariables[g]={className:"Mesh",id:null===L||void 0===L||null===(d=L.nodes)||void 0===d||null===(R=d[u]._babylonTransformNode)||void 0===R?void 0:R.id,uniqueId:null===L||void 0===L||null===(y=L.nodes)||void 0===y||null===(r=y[u]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},q}});const BY="targetMeshPointerOut_";jY("event/onHoverOut",GY,{OR:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xY:"FlowGraphGetVariableBlock",dataTransformer:P=>[BY+P[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xY:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(P,f,Y,C,q,m,L){var o,w,d,R,y,r;const i=q[q.length-1];i.config=i.config||{},i.config.glTF=L;const u=null===(o=P.configuration)||void 0===o||null===(w=o.nodeIndex)||void 0===w?void 0:w.value[0];if(void 0===u||"number"!==typeof u)throw new Error("nodeIndex not found in configuration");const g=BY+u;return q[1].config.variable=g,m._userVariables[g]={className:"Mesh",id:null===L||void 0===L||null===(d=L.nodes)||void 0===d||null===(R=d[u]._babylonTransformNode)||void 0===R?void 0:R.id,uniqueId:null===L||void 0===L||null===(y=L.nodes)||void 0===y||null===(r=y[u]._babylonTransformNode)||void 0===r?void 0:r.uniqueId},q}}),(0,x.e)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:P=>{const f=P._babylonTransformNode;return!f||void 0===f.pointerOverDisableMeshTesting||f.pointerOverDisableMeshTesting},set:(P,f)=>{var Y;null===(Y=f._primitiveBabylonMeshes)||void 0===Y||Y.forEach((f=>{f.pointerOverDisableMeshTesting=!P}))},getTarget:P=>P._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class bY{constructor(P){this.name=GY,this._loader=P,this.enabled=P.isExtensionUsed(GY)}async onReady(){var P;null===(P=this._loader.jf.nodes)||void 0===P||P.forEach((P=>{var f,Y,C;null!==(f=P.extensions)&&void 0!==f&&f.KHR_node_hoverability&&!1===(null===(Y=P.extensions)||void 0===Y?void 0:Y.KHR_node_hoverability.hoverable)&&(null===(C=P._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((P=>{P.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}X(GY),I(GY,!0,(P=>new bY(P)));const HY="ExtrasAsMetadata";class WY{_assignExtras(P,f){if(f.extras&&Object.keys(f.extras).length>0){const Y=P.metadata=P.metadata||{};(Y.jf=Y.jf||{}).extras=f.extras}}constructor(P){this.name=HY,this.enabled=!0,this._loader=P}dispose(){this._loader=null}loadNodeAsync(P,f,Y){return this._loader.loadNodeAsync(P,f,(P=>{this._assignExtras(P,f),Y(P)}))}loadCameraAsync(P,f,Y){return this._loader.loadCameraAsync(P,f,(P=>{this._assignExtras(P,f),Y(P)}))}createMaterial(P,f,Y){const C=this._loader.createMaterial(P,f,Y);return this._assignExtras(C,f),C}}X(HY),I(HY,!1,(P=>new WY(P)));Y(12982)},12848:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>a,e:()=>T,f:()=>c,i:()=>U});var C=Y(11018),q=Y(11014),m=Y(12494),L=Y(11648),o=Y(11612),w=Y(11622),d=Y(11025),R=Y(11052),y=Y(11641),r=Y(11742),i=Y(11657),u=Y(11222);class g{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Rr=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.zr=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(P){this._environmentTexture=P}getNodes(){let P=[];P=P.concat(this.meshes),P=P.concat(this.lights),P=P.concat(this.cameras),P=P.concat(this.transformNodes);for(const f of this.skeletons)P=P.concat(f.bones);return P}}class S extends g{}class K{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const P=this.rootNodes;for(const C of P)C.dispose();P.length=0;const f=this.skeletons;for(const C of f)C.dispose();f.length=0;const Y=this.animationGroups;for(const C of Y)C.dispose();Y.length=0}}class M extends g{constructor(P){super(),this._wasAddedToScene=!1,(P=P||R.e.LastCreatedScene)&&(this.lf=P,this.proceduralTextures=[],P.vf.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=P.getEngine().onContextRestoredObservable.add((()=>{for(const P of this.geometries)P._rebuild();for(const P of this.meshes)P._rebuild();for(const P of this.Rr)P.rebuild();for(const P of this.textures)P._rebuild()})))}_topologicalSort(P){const f=new Map;for(const L of P)f.set(L.uniqueId,L);const Y={dependsOn:new Map,dependedBy:new Map};for(const L of P){const P=L.uniqueId;Y.dependsOn.set(P,new Set),Y.dependedBy.set(P,new Set)}for(const L of P){const P=L.uniqueId,C=Y.dependsOn.get(P);if(L instanceof y.b){const q=L.sourceMesh;f.has(q.uniqueId)&&(C.add(q.uniqueId),Y.dependedBy.get(q.uniqueId).add(P))}const q=Y.dependedBy.get(P);for(const m of L.getDescendants()){const C=m.uniqueId;if(f.has(C)){q.add(C);Y.dependsOn.get(C).add(P)}}}const C=[],q=[];for(const L of P){const P=L.uniqueId;0===Y.dependsOn.get(P).size&&(q.push(L),f.delete(P))}const m=q;for(;m.length>0;){const P=m.shift();C.push(P);const q=Y.dependedBy.get(P.uniqueId);for(const C of Array.from(q.values())){const q=Y.dependsOn.get(C);q.delete(P.uniqueId),0===q.size&&f.get(C)&&(m.push(f.get(C)),f.delete(C))}}return f.size>0&&(d.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),f.forEach((P=>{d.e.Error(P.name)}))),C}_addNodeAndDescendantsToList(P,f,Y,C){if(Y&&(!C||C(Y))&&!f.has(Y.uniqueId)){P.push(Y),f.add(Y.uniqueId);for(const q of Y.getDescendants(!0))this._addNodeAndDescendantsToList(P,f,q,C)}}_isNodeInContainer(P){return P instanceof w.b&&-1!==this.meshes.indexOf(P)||(P instanceof o.c&&-1!==this.transformNodes.indexOf(P)||(P instanceof r.d&&-1!==this.lights.indexOf(P)||P instanceof i.e&&-1!==this.cameras.indexOf(P)))}_isValidHierarchy(){for(const P of this.meshes)if(P.parent&&!this._isNodeInContainer(P.parent))return d.e.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;for(const P of this.transformNodes)if(P.parent&&!this._isNodeInContainer(P.parent))return d.e.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;for(const P of this.lights)if(P.parent&&!this._isNodeInContainer(P.parent))return d.e.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;for(const P of this.cameras)if(P.parent&&!this._isNodeInContainer(P.parent))return d.e.Warn(`Node ${P.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(P){let f=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Y=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const C={},m={},o=new K,w=[],d=[],R={doNotInstantiate:!0,...Y},y=[],r=new Set;for(const q of this.transformNodes)null===q.parent&&this._addNodeAndDescendantsToList(y,r,q,R.predicate);for(const q of this.meshes)null===q.parent&&this._addNodeAndDescendantsToList(y,r,q,R.predicate);const i=this._topologicalSort(y),u=(Y,q)=>{if(((f,Y)=>{if(C[f.uniqueId]=Y.uniqueId,m[Y.uniqueId]=Y,P&&(Y.name=P(f.name)),Y instanceof L.c){const P=Y;if(P.morphTargetManager){const Y=f.morphTargetManager;P.morphTargetManager=Y.clone();for(let f=0;f<Y.numTargets;f++){const q=Y.getTarget(f),L=P.morphTargetManager.getTarget(f);C[q.uniqueId]=L.uniqueId,m[L.uniqueId]=L}}}})(Y,q),Y.parent){const P=C[Y.parent.uniqueId],f=m[P];q.parent=f||Y.parent}if(q.position&&Y.position&&q.position.q(Y.position),q.rotationQuaternion&&Y.rotationQuaternion&&q.rotationQuaternion.q(Y.rotationQuaternion),q.rotation&&Y.rotation&&q.rotation.q(Y.rotation),q.Ro&&Y.Ro&&q.Ro.q(Y.Ro),q.material){const L=q;if(L.material)if(f){const f=Y.material;if(-1===d.indexOf(f)){let Y=f.clone(P?P(f.name):"Clone of "+f.name);if(d.push(f),C[f.uniqueId]=Y.uniqueId,m[Y.uniqueId]=Y,"MultiMaterial"===f.getClassName()){const q=f;for(const f of q.io)f&&(Y=f.clone(P?P(f.name):"Clone of "+f.name),d.push(f),C[f.uniqueId]=Y.uniqueId,m[Y.uniqueId]=Y);q.io=q.io.map((P=>P&&m[C[P.uniqueId]]))}}"InstancedMesh"!==L.getClassName()&&(L.material=m[C[f.uniqueId]])}else"MultiMaterial"===L.material.getClassName()?-1===this.lf.multiMaterials.indexOf(L.material)&&this.lf.addMultiMaterial(L.material):-1===this.lf.materials.indexOf(L.material)&&this.lf.addMaterial(L.material)}null===q.parent&&o.rootNodes.push(q)};for(const q of i)if("InstancedMesh"===q.getClassName()){const P=q,f=P.sourceMesh,Y=C[f.uniqueId];u(P,("number"===typeof Y?m[Y]:f).createInstance(P.name))}else{let P=!0;"Rd"===q.getClassName()||"Node"===q.getClassName()||q.skeleton||!q.getTotalVertices||0===q.getTotalVertices()?P=!1:R.doNotInstantiate&&(P="function"===typeof R.doNotInstantiate?!R.doNotInstantiate(q):!R.doNotInstantiate);const f=P?q.createInstance(`instance of ${q.name}`):q.clone(`Clone of ${q.name}`,null,!0);if(!f)throw new Error(`Could not clone or instantiate node on Asset Container ${q.name}`);u(q,f)}for(const q of this.skeletons){if(R.predicate&&!R.predicate(q))continue;const f=q.clone(P?P(q.name):"Clone of "+q.name);for(const P of this.meshes)if(P.skeleton===q&&!P.isAnInstance){const Y=m[C[P.uniqueId]];if(!Y||Y.isAnInstance)continue;if(Y.skeleton=f,-1!==w.indexOf(f))continue;w.push(f);for(const P of f.bones)P._linkedTransformNode&&(P._linkedTransformNode=m[C[P._linkedTransformNode.uniqueId]])}o.skeletons.push(f)}for(const q of this.animationGroups){if(R.predicate&&!R.predicate(q))continue;const f=q.clone(P?P(q.name):"Clone of "+q.name,(P=>m[C[P.uniqueId]]||P));o.animationGroups.push(f)}return o}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.lf.environmentTexture=this.environmentTexture);for(const P of this.lf._serializableComponents)P.addFromContainer(this);this.lf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const f=[];for(const Y of this.cameras)P&&!P(Y)||(this.lf.addCamera(Y),f.push(Y));for(const Y of this.lights)P&&!P(Y)||(this.lf.addLight(Y),f.push(Y));for(const Y of this.meshes)P&&!P(Y)||(this.lf.wR(Y),f.push(Y));for(const Y of this.skeletons)P&&!P(Y)||this.lf.addSkeleton(Y);for(const Y of this.animations)P&&!P(Y)||this.lf.addAnimation(Y);for(const Y of this.animationGroups)P&&!P(Y)||this.lf.addAnimationGroup(Y);for(const Y of this.multiMaterials)P&&!P(Y)||this.lf.addMultiMaterial(Y);for(const Y of this.materials)P&&!P(Y)||this.lf.addMaterial(Y);for(const Y of this.morphTargetManagers)P&&!P(Y)||this.lf.addMorphTargetManager(Y);for(const Y of this.geometries)P&&!P(Y)||this.lf.addGeometry(Y);for(const Y of this.transformNodes)P&&!P(Y)||(this.lf.addTransformNode(Y),f.push(Y));for(const Y of this.actionManagers)P&&!P(Y)||this.lf.addActionManager(Y);for(const Y of this.textures)P&&!P(Y)||this.lf.addTexture(Y);for(const Y of this.reflectionProbes)P&&!P(Y)||this.lf.addReflectionProbe(Y);for(const Y of f)Y.parent&&-1===this.lf.getNodes().indexOf(Y.parent)&&(Y.setParent?Y.setParent(null):Y.parent=null)}removeAllFromScene(){this._isValidHierarchy()||q.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.lf.environmentTexture&&(this.lf.environmentTexture=null);for(const P of this.lf._serializableComponents)P.removeFromContainer(this)}removeFromScene(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const f of this.cameras)P&&!P(f)||this.lf.removeCamera(f);for(const f of this.lights)P&&!P(f)||this.lf.removeLight(f);for(const f of this.meshes)P&&!P(f)||this.lf.oR(f,!0);for(const f of this.skeletons)P&&!P(f)||this.lf.removeSkeleton(f);for(const f of this.animations)P&&!P(f)||this.lf.removeAnimation(f);for(const f of this.animationGroups)P&&!P(f)||this.lf.removeAnimationGroup(f);for(const f of this.multiMaterials)P&&!P(f)||this.lf.removeMultiMaterial(f);for(const f of this.materials)P&&!P(f)||this.lf.removeMaterial(f);for(const f of this.morphTargetManagers)P&&!P(f)||this.lf.removeMorphTargetManager(f);for(const f of this.geometries)P&&!P(f)||this.lf.removeGeometry(f);for(const f of this.transformNodes)P&&!P(f)||this.lf.removeTransformNode(f);for(const f of this.actionManagers)P&&!P(f)||this.lf.removeActionManager(f);for(const f of this.textures)P&&!P(f)||this.lf.removeTexture(f);for(const f of this.reflectionProbes)P&&!P(f)||this.lf.removeReflectionProbe(f)}dispose(){const P=this.cameras.slice(0);for(const i of P)i.dispose();this.cameras.length=0;const f=this.lights.slice(0);for(const i of f)i.dispose();this.lights.length=0;const Y=this.meshes.slice(0);for(const i of Y)i.dispose();this.meshes.length=0;const C=this.skeletons.slice(0);for(const i of C)i.dispose();this.skeletons.length=0;const q=this.animationGroups.slice(0);for(const i of q)i.dispose();this.animationGroups.length=0;const m=this.multiMaterials.slice(0);for(const i of m)i.dispose();this.multiMaterials.length=0;const L=this.materials.slice(0);for(const i of L)i.dispose();this.materials.length=0;const o=this.geometries.slice(0);for(const i of o)i.dispose();this.geometries.length=0;const w=this.transformNodes.slice(0);for(const i of w)i.dispose();this.transformNodes.length=0;const d=this.actionManagers.slice(0);for(const i of d)i.dispose();this.actionManagers.length=0;const R=this.textures.slice(0);for(const i of R)i.dispose();this.textures.length=0;const y=this.reflectionProbes.slice(0);for(const i of y)i.dispose();this.reflectionProbes.length=0;const r=this.morphTargetManagers.slice(0);for(const i of r)i.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const i of this.lf._serializableComponents)i.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.lf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(P,f,Y){if(P&&f)for(const C of P){let P=!0;if(Y)for(const f of Y)if(C===f){P=!1;break}P&&(f.push(C),C._parentContainer=this)}}moveAllFromScene(P){this._wasAddedToScene=!1,void 0===P&&(P=new S);for(const f in this)Object.prototype.hasOwnProperty.call(this,f)&&(this[f]=this[f]||("_environmentTexture"===f?null:[]),this._moveAssets(this.lf[f],this[f],P[f]));this.environmentTexture=this.lf.environmentTexture,this.removeAllFromScene()}createRootMesh(){const P=new L.c("assetContainerRootMesh",this.lf);for(const f of this.meshes)f.parent||P.addChild(f);return this.meshes.unshift(P),P}mergeAnimationsTo(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.e.LastCreatedScene,f=arguments.length>1?arguments[1]:void 0,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!P)return d.e.Error("No scene available to merge animations to"),[];const C=Y||(f=>{let Y=null;const C=f.animations.length?f.animations[0].targetProperty:"",q=f.name.split(".").join("").split("_primitive")[0];switch(C){case"position":case"rotationQuaternion":Y=P.getTransformNodeByName(f.name)||P.getTransformNodeByName(q);break;case"influence":Y=P.getMorphTargetByName(f.name)||P.getMorphTargetByName(q);break;default:Y=P.getNodeByName(f.name)||P.getNodeByName(q)}return Y}),q=this.getNodes();for(const o of q){const P=C(o);if(null!==P){for(const f of o.animations){const Y=P.animations.filter((P=>P.targetProperty===f.targetProperty));for(const f of Y){const Y=P.animations.indexOf(f,0);Y>-1&&P.animations.splice(Y,1)}}P.animations=P.animations.concat(o.animations)}}const m=[],L=this.animationGroups.slice();for(const o of L){m.push(o.clone(o.name,C));for(const P of o.animatables)P.stop()}for(const o of f){const f=C(o.target);f&&(P.beginAnimation(f,o.fromFrame,o.toFrame,o.loopAnimation,o.speedRatio,o.onAnimationEnd?o.onAnimationEnd:void 0,void 0,!0,void 0,o.onAnimationLoop?o.onAnimationLoop:void 0),P.stopAnimation(o.target))}return m}populateRootNodes(){this.rootNodes.length=0;for(const P of this.meshes)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P);for(const P of this.transformNodes)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P);for(const P of this.lights)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P);for(const P of this.cameras)P.parent||-1!==this.rootNodes.indexOf(P)||this.rootNodes.push(P)}addAllAssetsToContainer(P){if(!P)return;const f=[],Y=new Set;for(f.push(P);f.length>0;){const P=f.pop();if(P instanceof L.c?(P.qq&&-1===this.geometries.indexOf(P.qq)&&this.geometries.push(P.qq),this.meshes.push(P)):P instanceof y.b?this.meshes.push(P):P instanceof o.c?this.transformNodes.push(P):P instanceof r.d?this.lights.push(P):P instanceof i.e&&this.cameras.push(P),P instanceof w.b){if(P.material&&-1===this.materials.indexOf(P.material)){this.materials.push(P.material);for(const f of P.material.getActiveTextures())-1===this.textures.indexOf(f)&&this.textures.push(f)}P.skeleton&&-1===this.skeletons.indexOf(P.skeleton)&&this.skeletons.push(P.skeleton),P.morphTargetManager&&-1===this.morphTargetManagers.indexOf(P.morphTargetManager)&&this.morphTargetManagers.push(P.morphTargetManager)}for(const C of P.getChildren())Y.has(C)||f.push(C);Y.add(P)}this.populateRootNodes()}_getByTags(P,f,Y){if(void 0===f)return P;const C=[];for(const q in P){const m=P[q];u.c&&u.c.MatchesQuery(m,f)&&(!Y||Y(m))&&C.push(m)}return C}getMeshesByTags(P,f){return this._getByTags(this.meshes,P,f)}getCamerasByTags(P,f){return this._getByTags(this.cameras,P,f)}getLightsByTags(P,f){return this._getByTags(this.lights,P,f)}getMaterialsByTags(P,f){return this._getByTags(this.materials,P,f).concat(this._getByTags(this.multiMaterials,P,f))}getTransformNodesByTags(P,f){return this._getByTags(this.transformNodes,P,f)}}var V=Y(11071);class O{constructor(P){this.byteOffset=0,this.buffer=P}async loadAsync(P){const f=await this.buffer.readAsync(this.byteOffset,P);this._dataView=new DataView(f.buffer,f.byteOffset,f.byteLength),this._dataByteOffset=0}readUint32(){const P=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,P}readUint8Array(P){const f=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,P);return this._dataByteOffset+=P,this.byteOffset+=P,f}readString(P){return(0,V.i)(this.readUint8Array(P))}skipBytes(P){this._dataByteOffset+=P,this.byteOffset+=P}}var n=Y(12853);const l="Z2xURg",v={name:"jf",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:P=>-1!==P.indexOf("asset")&&-1!==P.indexOf("version")||P.startsWith("data:base64,"+l)||P.startsWith("data:;base64,"+l)||P.startsWith("data:application/octet-stream;base64,"+l)||P.startsWith("data:model/gltf-binary;base64,"+l)};var c,T,U,D=Y(11059),j=Y(11063);function e(P,f,Y){try{return Promise.resolve(new Uint8Array(P,f,Y))}catch(C){return Promise.reject(C)}}!function(P){P[P.AUTO=0]="AUTO",P[P.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(c||(c={})),function(P){P[P.NONE=0]="NONE",P[P.FIRST=1]="FIRST",P[P.ALL=2]="ALL"}(T||(T={})),function(P){P[P.LOADING=0]="LOADING",P[P.READY=1]="READY",P[P.COMPLETE=2]="COMPLETE"}(U||(U={}));class s{constructor(){this.coordinateSystemMode=c.AUTO,this.animationStartMode=T.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=P=>Promise.resolve(P),this.extensionOptions={}}q(P){P&&(this.onParsed=P.onParsed,this.coordinateSystemMode=P.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=P.animationStartMode??this.animationStartMode,this.loadNodeAnimations=P.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=P.loadSkins??this.loadSkins,this.loadMorphTargets=P.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=P.compileMaterials??this.compileMaterials,this.useClipPlane=P.useClipPlane??this.useClipPlane,this.compileShadowGenerators=P.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=P.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=P.useRangeRequests??this.useRangeRequests,this.createInstances=P.createInstances??this.createInstances,this.alwaysComputeBoundingBox=P.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=P.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=P.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=P.skipMaterials??this.skipMaterials,this.useSRGBBuffers=P.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=P.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=P.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=P.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=P.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=P.customRootNode,this.onMeshLoaded=P.onMeshLoaded,this.onSkinLoaded=P.onSkinLoaded,this.onTextureLoaded=P.onTextureLoaded,this.onMaterialLoaded=P.onMaterialLoaded,this.onCameraLoaded=P.onCameraLoaded,this.extensionOptions=P.extensionOptions??this.extensionOptions)}}class a extends s{constructor(P){super(),this.onParsedObservable=new C.e,this.onMeshLoadedObservable=new C.e,this.onSkinLoadedObservable=new C.e,this.onTextureLoadedObservable=new C.e,this.onMaterialLoadedObservable=new C.e,this.onCameraLoadedObservable=new C.e,this.onCompleteObservable=new C.e,this.onErrorObservable=new C.e,this.vf=new C.e,this.onExtensionLoadedObservable=new C.e,this.validate=!1,this.onValidatedObservable=new C.e,this._loader=null,this._state=null,this._requests=new Array,this.name=v.name,this.extensions=v.extensions,this.onLoaderStateChangedObservable=new C.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.q(P)}set onParsed(P){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),P&&(this._onParsedObserver=this.onParsedObservable.add(P))}set onMeshLoaded(P){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),P&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(P))}set onSkinLoaded(P){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),P&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((f=>P(f.node,f.skinnedNode))))}set onTextureLoaded(P){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),P&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(P))}set onMaterialLoaded(P){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),P&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(P))}set onCameraLoaded(P){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),P&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(P))}set onComplete(P){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(P)}set onError(P){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(P)}set onDispose(P){this._onDisposeObserver&&this.vf.remove(this._onDisposeObserver),this._onDisposeObserver=this.vf.add(P)}set onExtensionLoaded(P){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(P)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(P){this._loggingEnabled!==P&&(this._loggingEnabled=P,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(P){this._capturePerformanceCounters!==P&&(this._capturePerformanceCounters=P,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(P){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(P)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const P of this._requests)P.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=P=>Promise.resolve(P),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.vf.notifyObservers(void 0),this.vf.clear()}loadFile(P,f,Y,m,L,o,w,R){if(ArrayBuffer.isView(f))return this._loadBinary(P,f,Y,m,w,R),null;this._progressCallback=L;const y=f.name||q.Tools.GetFilename(f);if(o){if(this.useRangeRequests){this.validate&&d.e.Warn("glTF validation is not supported when range requests are enabled");const Y={abort:()=>{},onCompleteObservable:new C.e},q={readAsync:(Y,C)=>new Promise(((q,m)=>{this._loadFile(P,f,(P=>{q(new Uint8Array(P))}),!0,(P=>{m(P)}),(P=>{P.setRequestHeader("Range",`bytes=${Y}-${Y+C-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new O(q)).then((P=>{Y.onCompleteObservable.notifyObservers(Y),m(P)}),w?P=>w(void 0,P):void 0),Y}return this._loadFile(P,f,(f=>{this._validate(P,new Uint8Array(f,0,f.byteLength),Y,y),this._unpackBinaryAsync(new O({readAsync:(P,Y)=>e(f,P,Y),byteLength:f.byteLength})).then((P=>{m(P)}),w?P=>w(void 0,P):void 0)}),!0,w)}return this._loadFile(P,f,(f=>{try{this._validate(P,f,Y,y),m({json:this._parseJson(f)})}catch{w&&w()}}),!1,w)}_loadBinary(P,f,Y,C,q,m){this._validate(P,new Uint8Array(f.buffer,f.byteOffset,f.byteLength),Y,m),this._unpackBinaryAsync(new O({readAsync:(P,Y)=>function(P,f,Y){try{if(f<0||f>=P.byteLength)throw new RangeError("Offset is out of range.");if(f+Y>P.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(P.buffer,P.byteOffset+f,Y))}catch(C){return Promise.reject(C)}}(f,P,Y),byteLength:f.byteLength})).then((P=>{C(P)}),q?P=>q(void 0,P):void 0)}importMeshAsync(P,f,Y,C,q,m){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Y),this.onParsedObservable.clear(),this._log(`Loading ${m||""}`),this._loader=this._getLoader(Y),this._loader.importMeshAsync(P,f,null,Y,C,q,m))))}loadAsync(P,f,Y,C,q){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(f),this._loader.loadAsync(P,f,Y,C,q))))}loadAssetContainerAsync(P,f,Y,C,q){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(f),this.onParsedObservable.clear(),this._log(`Loading ${q||""}`),this._loader=this._getLoader(f);const m=new M(P),L=[];this.onMaterialLoadedObservable.add((P=>{L.push(P)}));const o=[];this.onTextureLoadedObservable.add((P=>{o.push(P)}));const w=[];this.onCameraLoadedObservable.add((P=>{w.push(P)}));const d=[];return this.onMeshLoadedObservable.add((P=>{P.morphTargetManager&&d.push(P.morphTargetManager)})),this._loader.importMeshAsync(null,P,m,f,Y,C,q).then((P=>(Array.prototype.push.apply(m.geometries,P.geometries),Array.prototype.push.apply(m.meshes,P.meshes),Array.prototype.push.apply(m.Rr,P.Rr),Array.prototype.push.apply(m.skeletons,P.skeletons),Array.prototype.push.apply(m.animationGroups,P.animationGroups),Array.prototype.push.apply(m.materials,L),Array.prototype.push.apply(m.textures,o),Array.prototype.push.apply(m.lights,P.lights),Array.prototype.push.apply(m.transformNodes,P.transformNodes),Array.prototype.push.apply(m.cameras,w),Array.prototype.push.apply(m.morphTargetManagers,d),m)))}))}canDirectLoad(P){return v.canDirectLoad(P)}directLoad(P,f){if(f.startsWith("base64,"+l)||f.startsWith(";base64,"+l)||f.startsWith("application/octet-stream;base64,"+l)||f.startsWith("model/gltf-binary;base64,"+l)){const Y=(0,D.e)(f);return this._validate(P,new Uint8Array(Y,0,Y.byteLength)),this._unpackBinaryAsync(new O({readAsync:(P,f)=>e(Y,P,f),byteLength:Y.byteLength}))}return this._validate(P,f),Promise.resolve({json:this._parseJson(f)})}createPlugin(P){return new a(P[v.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((P,f)=>{this.onCompleteObservable.addOnce((()=>{P()})),this.onErrorObservable.addOnce((P=>{f(P)}))}))}_setState(P){this._state!==P&&(this._state=P,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(U[this._state]))}_loadFile(P,f,Y,C,q,m){const L=P._loadFile(f,Y,(P=>{this._onProgress(P,L)}),!0,C,q,m);return L.onCompleteObservable.add((()=>{L._lengthComputable=!0,L._total=L._loaded})),this._requests.push(L),L}_onProgress(P,f){if(!this._progressCallback)return;f._lengthComputable=P.lengthComputable,f._loaded=P.loaded,f._total=P.total;let Y=!0,C=0,q=0;for(const m of this._requests){if(void 0===m._lengthComputable||void 0===m._loaded||void 0===m._total)return;Y=Y&&m._lengthComputable,C+=m._loaded,q+=m._total}this._progressCallback({lengthComputable:Y,loaded:C,total:Y?q:0})}_validate(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),n.d.ValidateAsync(f,Y,C,(f=>this.preprocessUrlAsync(Y+f).then((f=>P._loadFileAsync(f,void 0,!0,!0).then((P=>new Uint8Array(P,0,P.byteLength))))))).then((P=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(P),this.onValidatedObservable.clear()}),(P=>{this._endPerformanceCounter("Validate JSON"),q.Tools.Warn(`Failed to validate: ${P.message}`),this.onValidatedObservable.clear()})))}_getLoader(P){const f=P.json.asset||{};this._log(`Asset version: ${f.version}`),f.minVersion&&this._log(`Asset minimum version: ${f.minVersion}`),f.generator&&this._log(`Asset generator: ${f.generator}`);const Y=a._parseVersion(f.version);if(!Y)throw new Error("Invalid version: "+f.version);if(void 0!==f.minVersion){const P=a._parseVersion(f.minVersion);if(!P)throw new Error("Invalid minimum version: "+f.minVersion);if(a._compareVersion(P,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+f.minVersion)}const C={1:a._CreateGLTF1Loader,2:a._CreateGLTF2Loader}[Y.major];if(!C)throw new Error("Unsupported version: "+f.version);return C(this)}_parseJson(P){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${P.length}`);const f=JSON.parse(P);return this._endPerformanceCounter("Parse JSON"),f}_unpackBinaryAsync(P){return this._startPerformanceCounter("Unpack Binary"),P.loadAsync(20).then((()=>{const f=P.readUint32();if(1179937895!==f)throw new j.j("Unexpected magic: "+f,j.g.GLTFLoaderUnexpectedMagicError);const Y=P.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Y}`);const C=P.readUint32();let q;switch(this.useRangeRequests||C===P.buffer.byteLength||d.e.Warn(`Length in header does not match actual data length: ${C} != ${P.buffer.byteLength}`),Y){case 1:q=this._unpackBinaryV1Async(P,C);break;case 2:q=this._unpackBinaryV2Async(P,C);break;default:throw new Error("Unsupported version: "+Y)}return this._endPerformanceCounter("Unpack Binary"),q}))}_unpackBinaryV1Async(P,f){const Y=P.readUint32(),C=P.readUint32();if(0!==C)throw new Error(`Unexpected content format: ${C}`);const q=f-P.byteOffset,m={json:this._parseJson(P.readString(Y)),bin:null};if(0!==q){const f=P.byteOffset;m.bin={readAsync:(Y,C)=>P.buffer.readAsync(f+Y,C),byteLength:q}}return Promise.resolve(m)}_unpackBinaryV2Async(P,f){const Y=1313821514,C=5130562,q=P.readUint32();if(P.readUint32()!==Y)throw new Error("First chunk format is not JSON");return P.byteOffset+q===f?P.loadAsync(q).then((()=>({json:this._parseJson(P.readString(q)),bin:null}))):P.loadAsync(q+8).then((()=>{const m={json:this._parseJson(P.readString(q)),bin:null},L=()=>{const q=P.readUint32();switch(P.readUint32()){case Y:throw new Error("Unexpected JSON chunk");case C:{const f=P.byteOffset;m.bin={readAsync:(Y,C)=>P.buffer.readAsync(f+Y,C),byteLength:q},P.skipBytes(q);break}default:P.skipBytes(q)}return P.byteOffset!==f?P.loadAsync(8).then(L):Promise.resolve(m)};return L()}))}static _parseVersion(P){if("1.0"===P||"1.0.1"===P)return{major:1,minor:0};const f=(P+"").match(/^(\d+)\.(\d+)/);return f?{major:parseInt(f[1]),minor:parseInt(f[2])}:null}static _compareVersion(P,f){return P.major>f.major?1:P.major<f.major?-1:P.minor>f.minor?1:P.minor<f.minor?-1:0}_logOpen(P){this._log(P),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(P){const f=a._logSpaces.substring(0,2*this._logIndentLevel);d.e.Log(`${f}${P}`)}_logDisabled(P){}_startPerformanceCounterEnabled(P){q.Tools.StartPerformanceCounter(P)}_startPerformanceCounterDisabled(P){}_endPerformanceCounterEnabled(P){q.Tools.EndPerformanceCounter(P)}_endPerformanceCounterDisabled(P){}}a.IncrementalLoading=!0,a.HomogeneousCoordinates=!1,a._logSpaces="                                ",(0,m.e)(new a)},12853:(P,f,Y)=>{"use strict";Y.d(f,{d:()=>L});var C=Y(11014);function q(P,f,Y,C){const q={externalResourceFunction:C};return Y&&(q.uri="file:"===f?Y:f+Y),ArrayBuffer.isView(P)?GLTFValidator.validateBytes(P,q):GLTFValidator.validateString(P,q)}function m(){const P=[];onmessage=f=>{const Y=f.data;switch(Y.id){case"init":importScripts(Y.url);break;case"validate":q(Y.data,Y.rootUrl,Y.fileName,(f=>new Promise(((Y,C)=>{const q=P.length;P.push({resolve:Y,reject:C}),postMessage({id:"getExternalResource",index:q,uri:f})})))).then((P=>{postMessage({id:"validate.resolve",value:P})}),(P=>{postMessage({id:"validate.reject",reason:P})}));break;case"getExternalResource.resolve":P[Y.index].resolve(Y.value);break;case"getExternalResource.reject":P[Y.index].reject(Y.reason)}}}class L{static ValidateAsync(P,f,Y,L){return"function"===typeof Worker?new Promise(((o,w)=>{const d=`${q}(${m})()`,R=URL.createObjectURL(new Blob([d],{type:"application/javascript"})),y=new Worker(R),r=P=>{y.removeEventListener("error",r),y.removeEventListener("message",i),w(P)},i=P=>{const f=P.data;switch(f.id){case"getExternalResource":L(f.uri).then((P=>{y.postMessage({id:"getExternalResource.resolve",index:f.index,value:P},[P.buffer])}),(P=>{y.postMessage({id:"getExternalResource.reject",index:f.index,reason:P})}));break;case"validate.resolve":y.removeEventListener("error",r),y.removeEventListener("message",i),o(f.value),y.terminate();break;case"validate.reject":y.removeEventListener("error",r),y.removeEventListener("message",i),w(f.reason),y.terminate()}};if(y.addEventListener("error",r),y.addEventListener("message",i),y.postMessage({id:"init",url:C.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(P)){const C=P.slice();y.postMessage({id:"validate",data:C,rootUrl:f,fileName:Y},[C.buffer])}else y.postMessage({id:"validate",data:P,rootUrl:f,fileName:Y})})):(this._LoadScriptPromise||(this._LoadScriptPromise=C.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>q(P,f,Y,L))))}}L.Configuration={url:`${C.Tools._DefaultCdnUrl}/gltf_validator.js`}},13374:(P,f,Y)=>{"use strict";Y.d(f,{e:()=>v});var C=Y(11165),q=Y(11170),m=Y(11216),L=Y(11179),o=Y(11583),w=Y(11520),d=Y(11255),R=Y(11429),y=Y(11134),r=Y(11101);Y(12613),Y(12535),Y(12548),Y(12540),Y(12551),Y(12558),Y(12562);const i="imageProcessingCompatibility",u="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";r.e.IncludesShadersStore[i]||(r.e.IncludesShadersStore[i]=u);const g="skyPixelShader",S="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";r.e.ShadersStore[g]||(r.e.ShadersStore[g]=S);Y(12623),Y(12567),Y(12576),Y(12583),Y(12581);const K="skyVertexShader",M="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";r.e.ShadersStore[K]||(r.e.ShadersStore[K]=M);var V=Y(11511),O=Y(11561),n=Y(11555);class l extends o.c{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class v extends w.b{constructor(P,f){super(P,f),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new L.Of(0,100,0),this.useSunPosition=!1,this.cameraOffset=L.Of.Zero(),this.up=L.Of.Up(),this.dithering=!1,this._cameraPosition=L.Of.Zero(),this._skyOrientation=new L.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(P,f){const Y=f._drawWrapper;if(this.isFrozen&&Y.effect&&Y._wasPreviouslyReady)return!0;f.materialDefines||(f.materialDefines=new l);const C=f.materialDefines,q=this.vP();if(this._isReadyForSubMesh(f))return!0;if((0,n.S)(P,q,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,C),(0,n.G)(P,C,!0,!1),C.IMAGEPROCESSINGPOSTPROCESS!==q.imageProcessingConfiguration.applyByPostProcess&&C.markAsMiscDirty(),C.DITHER!==this.dithering&&C.markAsMiscDirty(),C.isDirty){C.markAsProcessed(),q.resetCachedMaterial();const P=new V.d;C.FOG&&P.addFallback(1,"FOG"),C.IMAGEPROCESSINGPOSTPROCESS=q.imageProcessingConfiguration.applyByPostProcess,C.DITHER=this.dithering;const Y=[d.d.PositionKind];C.VERTEXCOLOR&&Y.push(d.d.ColorKind);const m="sky",L=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,O.d)(L);const o=C.toString();f.setEffect(q.getEngine().createEffect(m,Y,L,[],o,P,this.onCompiled,this.onError),C,this._materialContext)}return!(!f.effect||!f.effect.isReady())&&(C._renderId=q.getRenderId(),Y._wasPreviouslyReady=!0,!0)}bindForSubMesh(P,f,Y){const C=this.vP(),q=Y.materialDefines;if(!q)return;const m=Y.effect;if(!m)return;this._activeEffect=m,this.bindOnlyWorldMatrix(P),this._activeEffect.setMatrix("viewProjection",C.getTransformMatrix()),this._mustRebind(C,m,Y)&&((0,O.f)(m,this,C),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,n.i)(q,m,C)),C.fogEnabled&&f.applyFog&&C.fogMode!==R.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",C.getViewMatrix()),(0,n.d)(C,f,this._activeEffect);const o=C.activeCamera;if(o){const P=o.getWorldMatrix();this._cameraPosition.x=P.m[12],this._cameraPosition.y=P.m[13],this._cameraPosition.z=P.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const P=Math.PI*(this.inclination-.5),f=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(f)*Math.cos(P),this.sunPosition.y=this.distance*Math.sin(-P),this.sunPosition.z=this.distance*Math.sin(f)*Math.cos(P),L.Quaternion.FromUnitVectorsToRef(L.Of.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(f,this._activeEffect,Y)}getAnimatables(){return[]}dispose(P){super.dispose(P)}clone(P){return m.e.Clone((()=>new v(P,this.vP())),this)}serialize(){const P=super.serialize();return P.customType="BABYLON.SkyMaterial",P}getClassName(){return"SkyMaterial"}static Parse(P,f,Y){return m.e.Parse((()=>new v(P.name,f)),P,f,Y)}}(0,C.b)([(0,q.F)()],v.prototype,"luminance",void 0),(0,C.b)([(0,q.F)()],v.prototype,"turbidity",void 0),(0,C.b)([(0,q.F)()],v.prototype,"rayleigh",void 0),(0,C.b)([(0,q.F)()],v.prototype,"mieCoefficient",void 0),(0,C.b)([(0,q.F)()],v.prototype,"mieDirectionalG",void 0),(0,C.b)([(0,q.F)()],v.prototype,"distance",void 0),(0,C.b)([(0,q.F)()],v.prototype,"inclination",void 0),(0,C.b)([(0,q.F)()],v.prototype,"azimuth",void 0),(0,C.b)([(0,q.D)()],v.prototype,"sunPosition",void 0),(0,C.b)([(0,q.F)()],v.prototype,"useSunPosition",void 0),(0,C.b)([(0,q.D)()],v.prototype,"cameraOffset",void 0),(0,C.b)([(0,q.D)()],v.prototype,"up",void 0),(0,C.b)([(0,q.F)()],v.prototype,"dithering",void 0),(0,y.d)("BABYLON.SkyMaterial",v)},11837:(P,f,Y)=>{"use strict";function C(P,f){f.headers=P.headers||{},f.statusMessage=P.statusText,f.statusCode=P.status,f.data=P.response}function q(P,f,Y){return new Promise((function(q,m){Y=Y||{};var L,o,w,d=new XMLHttpRequest,R=Y.body,y=Y.headers||{};for(L in Y.timeout&&(d.timeout=Y.timeout),d.ontimeout=d.onerror=function(P){P.timeout="timeout"==P.type,m(P)},d.open(P,f.href||f),d.onload=function(){for(w=d.getAllResponseHeaders().trim().split(/[\r\n]+/),C(d,d);o=w.shift();)o=o.split(": "),d.headers[o.shift().toLowerCase()]=o.join(": ");if((o=d.headers["content-type"])&&~o.indexOf("application/json"))try{d.data=JSON.parse(d.data,Y.reviver)}catch(P){return C(d,P),m(P)}(d.status>=400?m:q)(d)},typeof FormData<"u"&&R instanceof FormData||R&&"object"==typeof R&&(y["content-type"]="application/json",R=JSON.stringify(R)),d.withCredentials=!!Y.withCredentials,y)d.setRequestHeader(L,y[L]);d.send(R)}))}Y.r(f),Y.d(f,{del:()=>w,get:()=>m,patch:()=>o,post:()=>L,put:()=>d,send:()=>q});var m=q.bind(q,"GET"),L=q.bind(q,"POST"),o=q.bind(q,"PATCH"),w=q.bind(q,"DELETE"),d=q.bind(q,"PUT")},13495:(P,f,Y)=>{"use strict";Y.d(f,{b:()=>y});const C=.5*(Math.sqrt(3)-1),q=(3-Math.sqrt(3))/6,m=1/3,L=1/6,o=(Math.sqrt(5)-1)/4,w=(5-Math.sqrt(5))/20,d=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),R=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const y=class{constructor(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const f="function"==typeof P?P:function(P){let f=0,Y=0,C=0,q=1;const m=function(){let P=4022871197;return function(f){f=f.toString();for(let Y=0;Y<f.length;Y++){P+=f.charCodeAt(Y);let C=.02519603282416938*P;P=C>>>0,C-=P,C*=P,P=C>>>0,C-=P,P+=4294967296*C}return 2.3283064365386963e-10*(P>>>0)}}();f=m(" "),Y=m(" "),C=m(" "),f-=m(P),f<0&&(f+=1);Y-=m(P),Y<0&&(Y+=1);C-=m(P),C<0&&(C+=1);return function(){const P=2091639*f+2.3283064365386963e-10*q;return f=Y,Y=C,C=P-(q=0|P)}}(P);this.p=function(P){const f=new Uint8Array(256);for(let Y=0;Y<256;Y++)f[Y]=Y;for(let Y=0;Y<255;Y++){const C=Y+~~(P()*(256-Y)),q=f[Y];f[Y]=f[C],f[C]=q}return f}(f),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Y=0;Y<512;Y++)this.perm[Y]=this.p[255&Y],this.permMod12[Y]=this.perm[Y]%12}noise2D(P,f){const Y=this.permMod12,m=this.perm;let L=0,o=0,w=0;const R=(P+f)*C,y=Math.floor(P+R),r=Math.floor(f+R),i=(y+r)*q,u=P-(y-i),g=f-(r-i);let S,K;u>g?(S=1,K=0):(S=0,K=1);const M=u-S+q,V=g-K+q,O=u-1+2*q,n=g-1+2*q,l=255&y,v=255&r;let c=.5-u*u-g*g;if(c>=0){const P=3*Y[l+m[v]];c*=c,L=c*c*(d[P]*u+d[P+1]*g)}let T=.5-M*M-V*V;if(T>=0){const P=3*Y[l+S+m[v+K]];T*=T,o=T*T*(d[P]*M+d[P+1]*V)}let U=.5-O*O-n*n;if(U>=0){const P=3*Y[l+1+m[v+1]];U*=U,w=U*U*(d[P]*O+d[P+1]*n)}return 70*(L+o+w)}noise3D(P,f,Y){const C=this.permMod12,q=this.perm;let o,w,R,y;const r=(P+f+Y)*m,i=Math.floor(P+r),u=Math.floor(f+r),g=Math.floor(Y+r),S=(i+u+g)*L,K=P-(i-S),M=f-(u-S),V=Y-(g-S);let O,n,l,v,c,T;K>=M?M>=V?(O=1,n=0,l=0,v=1,c=1,T=0):K>=V?(O=1,n=0,l=0,v=1,c=0,T=1):(O=0,n=0,l=1,v=1,c=0,T=1):M<V?(O=0,n=0,l=1,v=0,c=1,T=1):K<V?(O=0,n=1,l=0,v=0,c=1,T=1):(O=0,n=1,l=0,v=1,c=1,T=0);const U=K-O+L,D=M-n+L,j=V-l+L,e=K-v+2*L,s=M-c+2*L,a=V-T+2*L,Q=K-1+.5,J=M-1+.5,N=V-1+.5,I=255&i,X=255&u,x=255&g;let k=.6-K*K-M*M-V*V;if(k<0)o=0;else{const P=3*C[I+q[X+q[x]]];k*=k,o=k*k*(d[P]*K+d[P+1]*M+d[P+2]*V)}let Z=.6-U*U-D*D-j*j;if(Z<0)w=0;else{const P=3*C[I+O+q[X+n+q[x+l]]];Z*=Z,w=Z*Z*(d[P]*U+d[P+1]*D+d[P+2]*j)}let A=.6-e*e-s*s-a*a;if(A<0)R=0;else{const P=3*C[I+v+q[X+c+q[x+T]]];A*=A,R=A*A*(d[P]*e+d[P+1]*s+d[P+2]*a)}let E=.6-Q*Q-J*J-N*N;if(E<0)y=0;else{const P=3*C[I+1+q[X+1+q[x+1]]];E*=E,y=E*E*(d[P]*Q+d[P+1]*J+d[P+2]*N)}return 32*(o+w+R+y)}noise4D(P,f,Y,C){const q=this.perm;let m,L,d,y,r;const i=(P+f+Y+C)*o,u=Math.floor(P+i),g=Math.floor(f+i),S=Math.floor(Y+i),K=Math.floor(C+i),M=(u+g+S+K)*w,V=P-(u-M),O=f-(g-M),n=Y-(S-M),l=C-(K-M);let v=0,c=0,T=0,U=0;V>O?v++:c++,V>n?v++:T++,V>l?v++:U++,O>n?c++:T++,O>l?c++:U++,n>l?T++:U++;const D=v>=3?1:0,j=c>=3?1:0,e=T>=3?1:0,s=U>=3?1:0,a=v>=2?1:0,Q=c>=2?1:0,J=T>=2?1:0,N=U>=2?1:0,I=v>=1?1:0,X=c>=1?1:0,x=T>=1?1:0,k=U>=1?1:0,Z=V-D+w,A=O-j+w,E=n-e+w,t=l-s+w,G=V-a+2*w,z=O-Q+2*w,B=n-J+2*w,b=l-N+2*w,H=V-I+3*w,W=O-X+3*w,p=n-x+3*w,h=l-k+3*w,F=V-1+4*w,PP=O-1+4*w,fP=n-1+4*w,YP=l-1+4*w,CP=255&u,qP=255&g,mP=255&S,LP=255&K;let oP=.6-V*V-O*O-n*n-l*l;if(oP<0)m=0;else{const P=q[CP+q[qP+q[mP+q[LP]]]]%32*4;oP*=oP,m=oP*oP*(R[P]*V+R[P+1]*O+R[P+2]*n+R[P+3]*l)}let wP=.6-Z*Z-A*A-E*E-t*t;if(wP<0)L=0;else{const P=q[CP+D+q[qP+j+q[mP+e+q[LP+s]]]]%32*4;wP*=wP,L=wP*wP*(R[P]*Z+R[P+1]*A+R[P+2]*E+R[P+3]*t)}let dP=.6-G*G-z*z-B*B-b*b;if(dP<0)d=0;else{const P=q[CP+a+q[qP+Q+q[mP+J+q[LP+N]]]]%32*4;dP*=dP,d=dP*dP*(R[P]*G+R[P+1]*z+R[P+2]*B+R[P+3]*b)}let RP=.6-H*H-W*W-p*p-h*h;if(RP<0)y=0;else{const P=q[CP+I+q[qP+X+q[mP+x+q[LP+k]]]]%32*4;RP*=RP,y=RP*RP*(R[P]*H+R[P+1]*W+R[P+2]*p+R[P+3]*h)}let yP=.6-F*F-PP*PP-fP*fP-YP*YP;if(yP<0)r=0;else{const P=q[CP+1+q[qP+1+q[mP+1+q[LP+1]]]]%32*4;yP*=yP,r=yP*yP*(R[P]*F+R[P+1]*PP+R[P+2]*fP+R[P+3]*YP)}return 27*(m+L+d+y+r)}}}}]);