/*! For license information please see 18k1w.32.010c3265.chunk.js.LICENSE.txt */
(self.rvold1i0ywi=self.rvold1i0ywi||[]).push([[32],{13227:(F,b,Q)=>{"use strict";var C=Q(13234),z=Q(13236),t=Q(13238);Q.g.__TYPEDARRAY_POOL||(Q.g.__TYPEDARRAY_POOL={UINT8:z([32,0]),UINT16:z([32,0]),UINT32:z([32,0]),INT8:z([32,0]),INT16:z([32,0]),INT32:z([32,0]),FLOAT:z([32,0]),DOUBLE:z([32,0]),DATA:z([32,0]),UINT8C:z([32,0]),BUFFER:z([32,0])});var g="undefined"!==typeof Uint8ClampedArray,W=Q.g.__TYPEDARRAY_POOL;W.UINT8C||(W.UINT8C=z([32,0])),W.BUFFER||(W.BUFFER=z([32,0]));var Z=W.DATA,q=W.BUFFER;function G(F){if(F){var b=F.length||F.byteLength,Q=C.log2(b);Z[Q].push(F)}}function K(F){F=C.nextPow2(F);var b=C.log2(F),Q=Z[b];return Q.length>0?Q.pop():new ArrayBuffer(F)}function e(F){return new Uint8Array(K(F),0,F)}function N(F){return new Uint16Array(K(2*F),0,F)}function y(F){return new Uint32Array(K(4*F),0,F)}function E(F){return new Int8Array(K(F),0,F)}function c(F){return new Int16Array(K(2*F),0,F)}function X(F){return new Int32Array(K(4*F),0,F)}function L(F){return new Float32Array(K(4*F),0,F)}function i(F){return new Float64Array(K(8*F),0,F)}function f(F){return g?new Uint8ClampedArray(K(F),0,F):e(F)}function k(F){return new DataView(K(F),0,F)}b.free=function(F){if(t(F))q[C.log2(F.length)].push(F);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(F)&&(F=F.buffer),!F)return;var b=F.length||F.byteLength,Q=0|C.log2(b);Z[Q].push(F)}},b.freeUint8=b.freeUint16=b.freeUint32=b.freeInt8=b.freeInt16=b.freeInt32=b.freeFloat32=b.freeFloat=b.freeFloat64=b.freeDouble=b.freeUint8Clamped=b.freeDataView=function(F){G(F.buffer)},b.freeArrayBuffer=G,b.freeBuffer=function(F){q[C.log2(F.length)].push(F)},b.malloc=function(F,b){if(void 0===b||"arraybuffer"===b)return K(F);switch(b){case"uint8":return e(F);case"uint16":return N(F);case"uint32":return y(F);case"int8":return E(F);case"int16":return c(F);case"int32":return X(F);case"float":case"float32":return L(F);case"double":case"float64":return i(F);case"uint8_clamped":return f(F);case"buffer":throw"Buffer not supported";case"data":case"dataview":return k(F);default:return null}return null},b.mallocArrayBuffer=K,b.mallocUint8=e,b.mallocUint16=N,b.mallocUint32=y,b.mallocInt8=E,b.mallocInt16=c,b.mallocInt32=X,b.mallocFloat32=b.mallocFloat=L,b.mallocFloat64=b.mallocDouble=i,b.mallocUint8Clamped=f,b.mallocDataView=k,b.clearCache=function(){for(var F=0;F<32;++F)W.UINT8[F].length=0,W.UINT16[F].length=0,W.UINT32[F].length=0,W.INT8[F].length=0,W.INT16[F].length=0,W.INT32[F].length=0,W.FLOAT[F].length=0,W.DOUBLE[F].length=0,W.UINT8C[F].length=0,Z[F].length=0,q[F].length=0}},13321:(F,b,Q)=>{F.exports=z;var C=Q(12089);function z(F,b){if(!(this instanceof z))return new z(F,b);var Q=C.create();C.add(Q,F,b),this.base=C.min(C.create(),F,Q),this.pG=C.clone(b),this.max=C.max(C.create(),F,Q),this.mag=C.length(this.pG)}var t=z.prototype;t.width=function(){return this.pG[0]},t.height=function(){return this.pG[1]},t.depth=function(){return this.pG[2]},t.x0=function(){return this.base[0]},t.y0=function(){return this.base[1]},t.z0=function(){return this.base[2]},t.x1=function(){return this.max[0]},t.y1=function(){return this.max[1]},t.z1=function(){return this.max[2]},t.translate=function(F){return C.add(this.max,this.max,F),C.add(this.base,this.base,F),this},t.setPosition=function(F){return C.add(this.max,F,this.pG),C.j(this.base,F),this},t.expand=function(F){var b=C.create(),Q=C.create();return C.max(b,F.max,this.max),C.min(Q,F.base,this.base),C.WQ(b,b,Q),new z(Q,b)},t.intersects=function(F){return!(F.base[0]>this.max[0])&&(!(F.base[1]>this.max[1])&&(!(F.base[2]>this.max[2])&&(!(F.max[0]<this.base[0])&&(!(F.max[1]<this.base[1])&&!(F.max[2]<this.base[2])))))},t.touches=function(F){var b=this.union(F);return null!==b&&(0==b.width()||0==b.height()||0==b.depth())},t.union=function(F){if(!this.intersects(F))return null;var b=Math.max(F.base[0],this.base[0]),Q=Math.max(F.base[1],this.base[1]),C=Math.max(F.base[2],this.base[2]);return new z([b,Q,C],[Math.min(F.max[0],this.max[0])-b,Math.min(F.max[1],this.max[1])-Q,Math.min(F.max[2],this.max[2])-C])}},13234:(F,b)=>{"use strict";function Q(F){var b=32;return(F&=-F)&&b--,65535&F&&(b-=16),16711935&F&&(b-=8),252645135&F&&(b-=4),858993459&F&&(b-=2),1431655765&F&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(F){return(F>0)-(F<0)},b.abs=function(F){var b=F>>31;return(F^b)-b},b.min=function(F,b){return b^(F^b)&-(F<b)},b.max=function(F,b){return F^(F^b)&-(F<b)},b.isPow2=function(F){return!(F&F-1)&&!!F},b.log2=function(F){var b,Q;return b=(F>65535)<<4,b|=Q=((F>>>=b)>255)<<3,b|=Q=((F>>>=Q)>15)<<2,(b|=Q=((F>>>=Q)>3)<<1)|(F>>>=Q)>>1},b.log10=function(F){return F>=1e9?9:F>=1e8?8:F>=1e7?7:F>=1e6?6:F>=1e5?5:F>=1e4?4:F>=1e3?3:F>=100?2:F>=10?1:0},b.popCount=function(F){return 16843009*((F=(858993459&(F-=F>>>1&1431655765))+(F>>>2&858993459))+(F>>>4)&252645135)>>>24},b.countTrailingZeros=Q,b.nextPow2=function(F){return F+=0===F,--F,F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)+1},b.prevPow2=function(F){return F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)-(F>>>1)},b.parity=function(F){return F^=F>>>16,F^=F>>>8,F^=F>>>4,27030>>>(F&=15)&1};var C=new Array(256);!function(F){for(var b=0;b<256;++b){var Q=b,C=b,z=7;for(Q>>>=1;Q;Q>>>=1)C<<=1,C|=1&Q,--z;F[b]=C<<z&255}}(C),b.reverse=function(F){return C[255&F]<<24|C[F>>>8&255]<<16|C[F>>>16&255]<<8|C[F>>>24&255]},b.interleave2=function(F,b){return(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F&=65535)|F<<8))|F<<4))|F<<2))|F<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(F,b){return(F=65535&((F=16711935&((F=252645135&((F=858993459&((F=F>>>b&1431655765)|F>>>1))|F>>>2))|F>>>4))|F>>>16))<<16>>16},b.interleave3=function(F,b,Q){return F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2),(F|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<2},b.deinterleave3=function(F,b){return(F=1023&((F=4278190335&((F=251719695&((F=3272356035&((F=F>>>b&1227133513)|F>>>2))|F>>>4))|F>>>8))|F>>>16))<<22>>22},b.nextCombination=function(F){var b=F|F-1;return b+1|(~b&-~b)-1>>>Q(F)+1}},13222:(F,b,Q)=>{"use strict";F.exports=function(F,b,Q){switch(arguments.length){case 1:return C=[],q(z=F,z,G,!0),C;case 2:return"function"===typeof b?q(F,F,b,!0):function(F,b){return C=[],q(F,b,G,!1),C}(F,b);case 3:return q(F,b,Q,!1);default:throw new Error("box-intersect: Invalid arguments")}var z};var C,z=Q(13227),t=Q(13247),g=Q(13257);function W(F,b){for(var Q=0;Q<F;++Q)if(!(b[Q]<=b[Q+F]))return!0;return!1}function Z(F,b,Q,C){for(var z=0,t=0,g=0,Z=F.length;g<Z;++g){var q=F[g];if(!W(b,q)){for(var G=0;G<2*b;++G)Q[z++]=q[G];C[t++]=g}}return t}function q(F,b,Q,C){var W=F.length,q=b.length;if(!(W<=0||q<=0)){var G=F[0].length>>>1;if(!(G<=0)){var K,e=z.mallocDouble(2*G*W),N=z.mallocInt32(W);if((W=Z(F,G,e,N))>0){if(1===G&&C)t.init(W),K=t.sweepComplete(G,Q,0,W,e,N,0,W,e,N);else{var y=z.mallocDouble(2*G*q),E=z.mallocInt32(q);(q=Z(b,G,y,E))>0&&(t.init(W+q),K=1===G?t.sweepBipartite(G,Q,0,W,e,N,0,q,y,E):g(G,Q,C,W,e,N,q,y,E),z.free(y),z.free(E))}z.free(e),z.free(N)}return K}}}function G(F,b){C.push([F,b])}},13261:(F,b)=>{"use strict";var Q="d",C="ax",z="fp",t="es",g="rs",W="re",Z="rb",q="bs",G="be",K="bb",e=[Q,C,"vv",g,W,Z,"ri",q,G,K,"bi"];function N(F){var b="bruteForce"+(F?"Full":"Partial"),C=[],g=e.slice();F||g.splice(3,0,z);var W=["function "+b+"("+g.join()+"){"];function Z(b,z){var g=function(F,b,C){var z="bruteForce"+(F?"Red":"Blue")+(b?"Flip":"")+(C?"Full":""),g=["function ",z,"(",e.join(),"){","var ",t,"=2*",Q,";"],W="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",Z="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(C?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return F?g.push(W,"Q",":",Z):g.push(Z,"Q",":",W),C?g.push("if(y1<x0||x1<y0)continue;"):b?g.push("if(y0<=x0||x1<y0)continue;"):g.push("if(y0<x0||x1<y0)continue;"),g.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),b?g.push("yi,xi"):g.push("xi,yi"),g.push(");if(rv!==void 0)return rv;}}}"),{name:z,code:g.join("")}}(b,z,F);C.push(g.code),W.push("return "+g.name+"("+e.join()+");")}W.push("if(re-rs>be-bs){"),F?(Z(!0,!1),W.push("}else{"),Z(!1,!1)):(W.push("if(fp){"),Z(!0,!0),W.push("}else{"),Z(!0,!1),W.push("}}else{if(fp){"),Z(!1,!0),W.push("}else{"),Z(!1,!1),W.push("}")),W.push("}}return "+b);var q=C.join("")+W.join("");return new Function(q)()}b.partial=N(!1),b.full=N(!0)},13257:(F,b,Q)=>{"use strict";F.exports=function(F,b,Q,t,G,n,j,w,Y){!function(F,b){var Q=8*z.log2(b+1)*(F+1)|0,t=z.nextPow2(f*Q);m.length<t&&(C.free(m),m=C.mallocInt32(t));var g=z.nextPow2(k*Q);R.length<g&&(C.free(R),R=C.mallocDouble(g))}(F,t+j);var s,V=0,h=2*F;p(V++,0,0,t,0,j,Q?16:0,-1/0,1/0),Q||p(V++,0,0,j,0,t,1,-1/0,1/0);for(;V>0;){var l=(V-=1)*f,T=m[l],o=m[l+1],S=m[l+2],O=m[l+3],x=m[l+4],a=m[l+5],A=V*k,U=R[A],u=R[A+1],v=1&a,J=!!(16&a),I=G,M=n,r=w,H=Y;if(v&&(I=w,M=Y,r=G,H=n),!(2&a&&o>=(S=c(F,T,o,S,I,M,u)))&&!(4&a&&(o=X(F,T,o,S,I,M,U))>=S)){var B=S-o,d=x-O;if(J){if(F*B*(B+d)<N){if(void 0!==(s=Z.scanComplete(F,T,b,o,S,I,M,O,x,r,H)))return s;continue}}else{if(F*Math.min(B,d)<K){if(void 0!==(s=g(F,T,b,v,o,S,I,M,O,x,r,H)))return s;continue}if(F*B*d<e){if(void 0!==(s=Z.scanBipartite(F,T,b,v,o,S,I,M,O,x,r,H)))return s;continue}}var FF=y(F,T,o,S,I,M,U,u);if(o<FF)if(F*(FF-o)<K){if(void 0!==(s=W(F,T+1,b,o,FF,I,M,O,x,r,H)))return s}else if(T===F-2){if(void 0!==(s=v?Z.sweepBipartite(F,b,O,x,r,H,o,FF,I,M):Z.sweepBipartite(F,b,o,FF,I,M,O,x,r,H)))return s}else p(V++,T+1,o,FF,O,x,v,-1/0,1/0),p(V++,T+1,O,x,o,FF,1^v,-1/0,1/0);if(FF<S){var bF=q(F,T,O,x,r,H),QF=r[h*bF+T],CF=E(F,T,bF,x,r,H,QF);if(CF<x&&p(V++,T,FF,S,CF,x,(4|v)+(J?16:0),QF,u),O<bF&&p(V++,T,FF,S,O,bF,(2|v)+(J?16:0),U,QF),bF+1===CF){if(void 0!==(s=J?P(F,T,b,FF,S,I,M,bF,r,H[bF]):D(F,T,b,v,FF,S,I,M,bF,r,H[bF])))return s}else if(bF<CF){var zF;if(J){if(FF<(zF=L(F,T,FF,S,I,M,QF))){var tF=E(F,T,FF,zF,I,M,QF);if(T===F-2){if(FF<tF&&void 0!==(s=Z.sweepComplete(F,b,FF,tF,I,M,bF,CF,r,H)))return s;if(tF<zF&&void 0!==(s=Z.sweepBipartite(F,b,tF,zF,I,M,bF,CF,r,H)))return s}else FF<tF&&p(V++,T+1,FF,tF,bF,CF,16,-1/0,1/0),tF<zF&&(p(V++,T+1,tF,zF,bF,CF,0,-1/0,1/0),p(V++,T+1,bF,CF,tF,zF,1,-1/0,1/0))}}else FF<(zF=v?i(F,T,FF,S,I,M,QF):L(F,T,FF,S,I,M,QF))&&(T===F-2?s=v?Z.sweepBipartite(F,b,bF,CF,r,H,FF,zF,I,M):Z.sweepBipartite(F,b,FF,zF,I,M,bF,CF,r,H):(p(V++,T+1,FF,zF,bF,CF,v,-1/0,1/0),p(V++,T+1,bF,CF,FF,zF,1^v,-1/0,1/0)))}}}}};var C=Q(13227),z=Q(13234),t=Q(13261),g=t.partial,W=t.full,Z=Q(13247),q=Q(13263),G=Q(13272),K=128,e=1<<22,N=1<<22,y=G("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),E=G("lo===p0",["p0"]),c=G("lo<p0",["p0"]),X=G("hi<=p0",["p0"]),L=G("lo<=p0&&p0<=hi",["p0"]),i=G("lo<p0&&p0<=hi",["p0"]),f=6,k=2,m=C.mallocInt32(1024),R=C.mallocDouble(1024);function p(F,b,Q,C,z,t,g,W,Z){var q=f*F;m[q]=b,m[q+1]=Q,m[q+2]=C,m[q+3]=z,m[q+4]=t,m[q+5]=g;var G=k*F;R[G]=W,R[G+1]=Z}function D(F,b,Q,C,z,t,g,W,Z,q,G){var K=2*F,e=Z*K,N=q[e+b];F:for(var y=z,E=z*K;y<t;++y,E+=K){var c=g[E+b],X=g[E+b+F];if(!(N<c||X<N)&&(!C||N!==c)){for(var L,i=W[y],f=b+1;f<F;++f){c=g[E+f],X=g[E+f+F];var k=q[e+f],m=q[e+f+F];if(X<k||m<c)continue F}if(void 0!==(L=C?Q(G,i):Q(i,G)))return L}}}function P(F,b,Q,C,z,t,g,W,Z,q){var G=2*F,K=W*G,e=Z[K+b];F:for(var N=C,y=C*G;N<z;++N,y+=G){var E=g[N];if(E!==q){var c=t[y+b],X=t[y+b+F];if(!(e<c||X<e)){for(var L=b+1;L<F;++L){c=t[y+L],X=t[y+L+F];var i=Z[K+L],f=Z[K+L+F];if(X<i||f<c)continue F}var k=Q(E,q);if(void 0!==k)return k}}}}},13263:(F,b,Q)=>{"use strict";F.exports=function(F,b,Q,g,W,Z){if(g<=Q+1)return Q;var q=Q,G=g,K=g+Q>>>1,e=2*F,N=K,y=W[e*K+b];for(;q<G;){if(G-q<z){t(F,b,q,G,W,Z),y=W[e*K+b];break}var E=G-q,c=Math.random()*E+q|0,X=W[e*c+b],L=Math.random()*E+q|0,i=W[e*L+b],f=Math.random()*E+q|0,k=W[e*f+b];X<=i?k>=i?(N=L,y=i):X>=k?(N=c,y=X):(N=f,y=k):i>=k?(N=L,y=i):k>=X?(N=c,y=X):(N=f,y=k);for(var m=e*(G-1),R=e*N,p=0;p<e;++p,++m,++R){var D=W[m];W[m]=W[R],W[R]=D}var P=Z[G-1];Z[G-1]=Z[N],Z[N]=P;for(m=e*(G-1),R=e*(N=C(F,b,q,G-1,W,Z,y)),p=0;p<e;++p,++m,++R){D=W[m];W[m]=W[R],W[R]=D}P=Z[G-1];if(Z[G-1]=Z[N],Z[N]=P,K<N){for(G=N-1;q<G&&W[e*(G-1)+b]===y;)G-=1;G+=1}else{if(!(N<K))break;for(q=N+1;q<G&&W[e*q+b]===y;)q+=1}}return C(F,b,Q,K,W,Z,W[e*K+b])};var C=Q(13272)("lo<p0",["p0"]),z=8;function t(F,b,Q,C,z,t){for(var g=2*F,W=g*(Q+1)+b,Z=Q+1;Z<C;++Z,W+=g)for(var q=z[W],G=Z,K=g*(Z-1);G>Q&&z[K+b]>q;--G,K-=g){for(var e=K,N=K+g,y=0;y<g;++y,++e,++N){var E=z[e];z[e]=z[N],z[N]=E}var c=t[G];t[G]=t[G-1],t[G-1]=c}}},13272:F=>{"use strict";F.exports=function(F,Q){var C="abcdef".split("").concat(Q),z=[];F.indexOf("lo")>=0&&z.push("lo=e[k+n]");F.indexOf("hi")>=0&&z.push("hi=e[k+o]");return C.push(b.replace("_",z.join()).replace("$",F)),Function.apply(void 0,C)};var b="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13251:F=>{"use strict";F.exports=function(F,C){C<=4*b?Q(0,C-1,F):q(0,C-1,F)};var b=32;function Q(F,b,Q){for(var C=2*(F+1),z=F+1;z<=b;++z){for(var t=Q[C++],g=Q[C++],W=z,Z=C-2;W-- >F;){var q=Q[Z-2],G=Q[Z-1];if(q<t)break;if(q===t&&G<g)break;Q[Z]=q,Q[Z+1]=G,Z-=2}Q[Z]=t,Q[Z+1]=g}}function C(F,b,Q){b*=2;var C=Q[F*=2],z=Q[F+1];Q[F]=Q[b],Q[F+1]=Q[b+1],Q[b]=C,Q[b+1]=z}function z(F,b,Q){b*=2,Q[F*=2]=Q[b],Q[F+1]=Q[b+1]}function t(F,b,Q,C){b*=2,Q*=2;var z=C[F*=2],t=C[F+1];C[F]=C[b],C[F+1]=C[b+1],C[b]=C[Q],C[b+1]=C[Q+1],C[Q]=z,C[Q+1]=t}function g(F,b,Q,C,z){b*=2,z[F*=2]=z[b],z[b]=Q,z[F+1]=z[b+1],z[b+1]=C}function W(F,b,Q){b*=2;var C=Q[F*=2],z=Q[b];return!(C<z)&&(C!==z||Q[F+1]>Q[b+1])}function Z(F,b,Q,C){var z=C[F*=2];return z<b||z===b&&C[F+1]<Q}function q(F,G,K){var e=(G-F+1)/6|0,N=F+e,y=G-e,E=F+G>>1,c=E-e,X=E+e,L=N,i=c,f=E,k=X,m=y,R=F+1,p=G-1,D=0;W(L,i,K)&&(D=L,L=i,i=D),W(k,m,K)&&(D=k,k=m,m=D),W(L,f,K)&&(D=L,L=f,f=D),W(i,f,K)&&(D=i,i=f,f=D),W(L,k,K)&&(D=L,L=k,k=D),W(f,k,K)&&(D=f,f=k,k=D),W(i,m,K)&&(D=i,i=m,m=D),W(i,f,K)&&(D=i,i=f,f=D),W(k,m,K)&&(D=k,k=m,m=D);for(var P=K[2*i],n=K[2*i+1],j=K[2*k],w=K[2*k+1],Y=2*L,s=2*f,V=2*m,h=2*N,l=2*E,T=2*y,o=0;o<2;++o){var S=K[Y+o],O=K[s+o],x=K[V+o];K[h+o]=S,K[l+o]=O,K[T+o]=x}z(c,F,K),z(X,G,K);for(var a=R;a<=p;++a)if(Z(a,P,n,K))a!==R&&C(a,R,K),++R;else if(!Z(a,j,w,K))for(;;){if(Z(p,j,w,K)){Z(p,P,n,K)?(t(a,R,p,K),++R,--p):(C(a,p,K),--p);break}if(--p<a)break}g(F,R-1,P,n,K),g(G,p+1,j,w,K),R-2-F<=b?Q(F,R-2,K):q(F,R-2,K),G-(p+2)<=b?Q(p+2,G,K):q(p+2,G,K),p-R<=b?Q(R,p,K):q(R,p,K)}},13247:(F,b,Q)=>{"use strict";F.exports={init:function(F){var b=z.nextPow2(F);Z.length<b&&(C.free(Z),Z=C.mallocInt32(b));q.length<b&&(C.free(q),q=C.mallocInt32(b));G.length<b&&(C.free(G),G=C.mallocInt32(b));K.length<b&&(C.free(K),K=C.mallocInt32(b));e.length<b&&(C.free(e),e=C.mallocInt32(b));N.length<b&&(C.free(N),N=C.mallocInt32(b));var Q=8*b;y.length<Q&&(C.free(y),y=C.mallocDouble(Q))},sweepBipartite:function(F,b,Q,C,z,W,e,N,X,L){for(var i=0,f=2*F,k=F-1,m=f-1,R=Q;R<C;++R){var p=W[R],D=f*R;y[i++]=z[D+k],y[i++]=-(p+1),y[i++]=z[D+m],y[i++]=p}for(R=e;R<N;++R){p=L[R]+g;var P=f*R;y[i++]=X[P+k],y[i++]=-p,y[i++]=X[P+m],y[i++]=p}var n=i>>>1;t(y,n);var j=0,w=0;for(R=0;R<n;++R){var Y=0|y[2*R+1];if(Y>=g)E(G,K,w--,Y=Y-g|0);else if(Y>=0)E(Z,q,j--,Y);else if(Y<=-g){Y=-Y-g|0;for(var s=0;s<j;++s){if(void 0!==(V=b(Z[s],Y)))return V}c(G,K,w++,Y)}else{Y=-Y-1|0;for(s=0;s<w;++s){var V;if(void 0!==(V=b(Y,G[s])))return V}c(Z,q,j++,Y)}}},sweepComplete:function(F,b,Q,C,z,g,W,X,L,i){for(var f=0,k=2*F,m=F-1,R=k-1,p=Q;p<C;++p){var D=g[p]+1<<1,P=k*p;y[f++]=z[P+m],y[f++]=-D,y[f++]=z[P+R],y[f++]=D}for(p=W;p<X;++p){D=i[p]+1<<1;var n=k*p;y[f++]=L[n+m],y[f++]=1|-D,y[f++]=L[n+R],y[f++]=1|D}var j=f>>>1;t(y,j);var w=0,Y=0,s=0;for(p=0;p<j;++p){var V=0|y[2*p+1],h=1&V;if(p<j-1&&V>>1===y[2*p+3]>>1&&(h=2,p+=1),V<0){for(var l=-(V>>1)-1,T=0;T<s;++T){if(void 0!==(o=b(e[T],l)))return o}if(0!==h)for(T=0;T<w;++T){if(void 0!==(o=b(Z[T],l)))return o}if(1!==h)for(T=0;T<Y;++T){var o;if(void 0!==(o=b(G[T],l)))return o}0===h?c(Z,q,w++,l):1===h?c(G,K,Y++,l):2===h&&c(e,N,s++,l)}else{l=(V>>1)-1;0===h?E(Z,q,w--,l):1===h?E(G,K,Y--,l):2===h&&E(e,N,s--,l)}}},scanBipartite:function(F,b,Q,C,z,W,G,K,e,N,X,L){var i=0,f=2*F,k=b,m=b+F,R=1,p=1;C?p=g:R=g;for(var D=z;D<W;++D){var P=D+R,n=f*D;y[i++]=G[n+k],y[i++]=-P,y[i++]=G[n+m],y[i++]=P}for(D=e;D<N;++D){P=D+p;var j=f*D;y[i++]=X[j+k],y[i++]=-P}var w=i>>>1;t(y,w);var Y=0;for(D=0;D<w;++D){var s=0|y[2*D+1];if(s<0){var V=!1;if((P=-s)>=g?(V=!C,P-=g):(V=!!C,P-=1),V)c(Z,q,Y++,P);else{var h=L[P],l=f*P,T=X[l+b+1],o=X[l+b+1+F];F:for(var S=0;S<Y;++S){var O=Z[S],x=f*O;if(!(o<G[x+b+1]||G[x+b+1+F]<T)){for(var a=b+2;a<F;++a)if(X[l+a+F]<G[x+a]||G[x+a+F]<X[l+a])continue F;var A,U=K[O];if(void 0!==(A=C?Q(h,U):Q(U,h)))return A}}}}else E(Z,q,Y--,s-R)}},scanComplete:function(F,b,Q,C,z,W,q,G,K,e,N){for(var E=0,c=2*F,X=b,L=b+F,i=C;i<z;++i){var f=i+g,k=c*i;y[E++]=W[k+X],y[E++]=-f,y[E++]=W[k+L],y[E++]=f}for(i=G;i<K;++i){f=i+1;var m=c*i;y[E++]=e[m+X],y[E++]=-f}var R=E>>>1;t(y,R);var p=0;for(i=0;i<R;++i){var D=0|y[2*i+1];if(D<0){if((f=-D)>=g)Z[p++]=f-g;else{var P=N[f-=1],n=c*f,j=e[n+b+1],w=e[n+b+1+F];F:for(var Y=0;Y<p;++Y){var s=Z[Y],V=q[s];if(V===P)break;var h=c*s;if(!(w<W[h+b+1]||W[h+b+1+F]<j)){for(var l=b+2;l<F;++l)if(e[n+l+F]<W[h+l]||W[h+l+F]<e[n+l])continue F;var T=Q(V,P);if(void 0!==T)return T}}}}else{for(f=D-g,Y=p-1;Y>=0;--Y)if(Z[Y]===f){for(l=Y+1;l<p;++l)Z[l-1]=Z[l];break}--p}}}};var C=Q(13227),z=Q(13234),t=Q(13251),g=1<<28,W=1024,Z=C.mallocInt32(W),q=C.mallocInt32(W),G=C.mallocInt32(W),K=C.mallocInt32(W),e=C.mallocInt32(W),N=C.mallocInt32(W),y=C.mallocDouble(8192);function E(F,b,Q,C){var z=b[C],t=F[Q-1];F[z]=t,b[t]=z}function c(F,b,Q,C){F[Q]=C,b[C]=Q}},13236:F=>{"use strict";function b(F,Q,C){var z=0|F[C];if(z<=0)return[];var t,g=new Array(z);if(C===F.length-1)for(t=0;t<z;++t)g[t]=Q;else for(t=0;t<z;++t)g[t]=b(F,Q,C+1);return g}F.exports=function(F,Q){switch("undefined"===typeof Q&&(Q=0),typeof F){case"number":if(F>0)return function(F,b){var Q,C;for(Q=new Array(F),C=0;C<F;++C)Q[C]=b;return Q}(0|F,Q);break;case"object":if("number"===typeof F.length)return b(F,Q,0)}return[]}},13199:(F,b,Q)=>{F.exports=function(){var F=this;this.components={},this.comps=this.components;var b=this.components,Q=1,z={},t=[],g=[],W={timeout:!1,removals:[],multiComps:[]};function Z(F,Q){var C=b[Q],t=z[Q],g=t.hash[F];g&&(t.remove(F),C.tb&&(C.multi?(g.forEach((b=>{b&&C.tb(F,b)})),g.length=0):C.tb(F,g)),W.removals.push(t),q())}function q(){W.timeout||(W.timeout=!0,setTimeout(G,1))}function G(){W.timeout=!1,K()}function K(){W.multiComps.length&&function(F){for(var b=0;b<F.length;b++){var{entID:Q,data:C}=F[b],z=C.hash[Q];if(z){for(var t=0;t<z.length;t++)z[t]||(z.splice(t,1),t--);0===z.length&&(C.remove(Q),W.removals.push(C))}}F.length=0}(W.multiComps),W.removals.length&&function(F){for(var b=0;b<F.length;b++){F[b].flush()}F.length=0}(W.removals)}this.xK=z,this._systems=t,this._renderSystems=g,this.nG=function(b){var C=Q++;return Array.isArray(b)&&b.forEach((b=>F.Gq(C,b))),C},this.deleteEntity=function(b){return Object.keys(z).forEach((F=>{z[F].hash[b]&&Z(b,F)})),F},this.UG=function(F){if(!F)throw new Error("Missing component definition");var Q=F.name;if(!Q)throw new Error("Component definition must have a name property.");if("string"!==typeof Q)throw new Error("Component name must be a string.");if(""===Q)throw new Error("Component name must be a non-empty string.");if(z[Q])throw new Error(`Component ${Q} already exists.`);var W={};return W.name=Q,W.multi=!!F.multi,W.order=isNaN(F.order)?99:F.order,W.stateConstructor=F.stateConstructor||null,W.state=F.state||{},W.gt=F.gt||null,W.tb=F.tb||null,W.system=F.system||null,W.NZ=F.NZ||null,b[Q]=W,z[Q]=new C,z[Q]._pendingMultiCleanup=!1,z[Q]._multiCleanupIDs=W.multi?[]:null,W.system&&(t.push(Q),t.sort(((F,Q)=>b[F].order-b[Q].order))),W.NZ&&(g.push(Q),g.sort(((F,Q)=>b[F].order-b[Q].order))),Q},this.overwriteComponent=function(F,Q){var C=b[F];if(!C)throw new Error(`Unknown component: ${F}`);if(!Q)throw new Error("Missing component definition");if(C.name!==Q.name)throw new Error("Overwriting component must use the same name property.");var W={};W.name=F,W.multi=!!Q.multi,W.order=isNaN(Q.order)?99:Q.order,W.state=Q.state||{},W.gt=Q.gt||null,W.tb=Q.tb||null,W.system=Q.system||null,W.NZ=Q.NZ||null,b[F]=W,z[F]._pendingMultiCleanup=!1,z[F]._multiCleanupIDs=W.multi?[]:null;var Z=t.indexOf(F);W.system&&Z<0&&t.push(F),!W.system&&Z>=0&&t.splice(Z,1),t.sort(((F,Q)=>b[F].order-b[Q].order));var q=g.indexOf(F);W.NZ&&q<0&&g.push(F),!W.NZ&&q>=0&&g.splice(q,1),g.sort(((F,Q)=>b[F].order-b[Q].order));var G=W.state;return this.ZG(F).forEach((F=>{for(var b in G)b in F||(F[b]=G[b]);W.gt&&W.gt(F.Sg,F)})),F},this.deleteComponent=function(Q){var C=z[Q];if(!C)throw new Error(`Unknown component: ${Q}`);C.flush(),C.list.forEach((F=>{F&&Z(F.Sg||F[0].Sg,Q)}));var W=t.indexOf(Q),q=g.indexOf(Q);return W>-1&&t.splice(W,1),q>-1&&g.splice(q,1),z[Q].dispose(),delete z[Q],delete b[Q],F},this.Gq=function(F,Q,C){var t,g=b[Q],W=z[Q];if(!W)throw new Error(`Unknown component: ${Q}.`);if(W.hash[F]&&!g.multi)throw new Error(`Entity ${F} already has component: ${Q}.`);if(g.stateConstructor){if(!(t=new g.stateConstructor).hasOwnProperty("Sg"))throw new Error(`Component ${g.name} stateConstructor type does not have property __id`)}else t=Object.assign({},{Sg:F},g.state,C);if(t.Sg=F,g.multi){var Z=W.hash[F];Z||(Z=[],W.add(F,Z)),Z.push(t)}else W.add(F,t);return g.gt&&g.gt(F,t),this},this.fq=function(F,b){var Q=z[b];if(!Q)throw new Error(`Unknown component: ${b}.`);return!!Q.hash[F]},this.yq=function(b,Q){if(!z[Q])throw new Error(`Unknown component: ${Q}.`);return Z(b,Q),F},this.getState=function(F,b){var Q=z[b];if(!Q)throw new Error(`Unknown component: ${b}.`);return Q.hash[F]},this.ZG=function(F){var b=z[F];if(!b)throw new Error(`Unknown component: ${F}.`);return K(),b.list},this.JN=function(F){if(!z[F])throw new Error(`Unknown component: ${F}.`);var b=z[F].hash;return F=>b[F]},this.rN=function(F){if(!z[F])throw new Error(`Unknown component: ${F}.`);var b=z[F].hash;return F=>!!b[F]},this.eZ=function(Q){K();for(var C=0;C<t.length;C++){var g=t[C],W=b[g],Z=z[g];W.system(Q,Z.list),K()}return F},this.render=function(Q){K();for(var C=0;C<g.length;C++){var t=g[C],W=b[t],Z=z[t];W.NZ(Q,Z.list),K()}return F},this.removeMultiComponent=function(Q,C,t){var g=b[C],Z=z[C];if(!Z)throw new Error(`Unknown component: ${C}.`);if(!g.multi)throw new Error("removeMultiComponent called on non-multi component");return function(F,b,Q,C){var z=Q.hash[F];if(z){var t=z[C];t&&(z[C]=null,b.tb&&b.tb(F,t),W.multiComps.push({entID:F,data:Q}),q())}}(Q,g,Z,t),F}};var C=Q(13202)},13202:F=>{function b(F,b){var Q=F._map[b];if(delete F.hash[b],delete F._map[b],Q===F.list.length-1)F.list.pop();else{var C=F.list.pop();if(F.list[Q]=C,null===C||null===C[0]){var z=F.list.length;for(var t in F._map)if(F._map[t]===z)return void(F._map[t]=Q)}else{var g=C.Sg||C[0].Sg;F._map[g]=Q}}}F.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(F,b){if("number"===typeof this._map[F]){var Q=this._map[F];this.hash[F]=b,this.list[Q]=b}else this._map[F]=this.list.length,this.hash[F]=b,this.list.push(b)}remove(F){var b=this._map[F];this.hash[F]=null,this.list[b]=null,this._pendingRemovals.push(F)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var F=0;F<this._pendingRemovals.length;F++){var Q=this._pendingRemovals[F];null===this.hash[Q]&&b(this,Q)}this._pendingRemovals.length=0}}},13154:F=>{"use strict";var b,Q="object"===typeof Reflect?Reflect:null,C=function(F,b,Q){return Function.prototype.apply.call(F,b,Q)};b=Q&&"function"===typeof Q.ownKeys?Q.ownKeys:Object.getOwnPropertySymbols?function(F){return Object.getOwnPropertyNames(F).concat(Object.getOwnPropertySymbols(F))}:function(F){return Object.getOwnPropertyNames(F)};var z=Number.isNaN||function(F){return F!==F};function t(){t.init.call(this)}F.exports=t,F.exports.once=function(F,b){return new Promise((function(Q,C){function z(Q){F.removeListener(b,t),C(Q)}function t(){"function"===typeof F.removeListener&&F.removeListener("error",z),Q([].slice.call(arguments))}E(F,b,t,{once:!0}),"error"!==b&&function(F,b,Q){"function"===typeof F.on&&E(F,"error",b,Q)}(F,z,{once:!0})}))},t.EventEmitter=t,t.prototype._events=void 0,t.prototype._eventsCount=0,t.prototype._maxListeners=void 0;var g=10;function W(F){if("function"!==typeof F)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof F)}function Z(F){return void 0===F._maxListeners?t.defaultMaxListeners:F._maxListeners}function q(F,b,Q,C){var z,t,g,q;if(W(Q),void 0===(t=F._events)?(t=F._events=Object.create(null),F._eventsCount=0):(void 0!==t.newListener&&(F.emit("newListener",b,Q.listener?Q.listener:Q),t=F._events),g=t[b]),void 0===g)g=t[b]=Q,++F._eventsCount;else if("function"===typeof g?g=t[b]=C?[Q,g]:[g,Q]:C?g.unshift(Q):g.push(Q),(z=Z(F))>0&&g.length>z&&!g.warned){g.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.Cb=F,G.type=b,G.count=g.length,q=G,console&&console.warn&&console.warn(q)}return F}function G(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function K(F,b,Q){var C={fired:!1,wrapFn:void 0,target:F,type:b,listener:Q},z=G.bind(C);return z.listener=Q,C.wrapFn=z,z}function e(F,b,Q){var C=F._events;if(void 0===C)return[];var z=C[b];return void 0===z?[]:"function"===typeof z?Q?[z.listener||z]:[z]:Q?function(F){for(var b=new Array(F.length),Q=0;Q<b.length;++Q)b[Q]=F[Q].listener||F[Q];return b}(z):y(z,z.length)}function N(F){var b=this._events;if(void 0!==b){var Q=b[F];if("function"===typeof Q)return 1;if(void 0!==Q)return Q.length}return 0}function y(F,b){for(var Q=new Array(b),C=0;C<b;++C)Q[C]=F[C];return Q}function E(F,b,Q,C){if("function"===typeof F.on)C.once?F.once(b,Q):F.on(b,Q);else{if("function"!==typeof F.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof F);F.addEventListener(b,(function z(t){C.once&&F.removeEventListener(b,z),Q(t)}))}}Object.defineProperty(t,"defaultMaxListeners",{enumerable:!0,get:function(){return g},set:function(F){if("number"!==typeof F||F<0||z(F))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+F+".");g=F}}),t.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},t.prototype.setMaxListeners=function(F){if("number"!==typeof F||F<0||z(F))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+F+".");return this._maxListeners=F,this},t.prototype.getMaxListeners=function(){return Z(this)},t.prototype.emit=function(F){for(var b=[],Q=1;Q<arguments.length;Q++)b.push(arguments[Q]);var z="error"===F,t=this._events;if(void 0!==t)z=z&&void 0===t.error;else if(!z)return!1;if(z){var g;if(b.length>0&&(g=b[0]),g instanceof Error)throw g;var W=new Error("Unhandled error."+(g?" ("+g.message+")":""));throw W.context=g,W}var Z=t[F];if(void 0===Z)return!1;if("function"===typeof Z)C(Z,this,b);else{var q=Z.length,G=y(Z,q);for(Q=0;Q<q;++Q)C(G[Q],this,b)}return!0},t.prototype.addListener=function(F,b){return q(this,F,b,!1)},t.prototype.on=t.prototype.addListener,t.prototype.prependListener=function(F,b){return q(this,F,b,!0)},t.prototype.once=function(F,b){return W(b),this.on(F,K(this,F,b)),this},t.prototype.prependOnceListener=function(F,b){return W(b),this.prependListener(F,K(this,F,b)),this},t.prototype.removeListener=function(F,b){var Q,C,z,t,g;if(W(b),void 0===(C=this._events))return this;if(void 0===(Q=C[F]))return this;if(Q===b||Q.listener===b)0===--this._eventsCount?this._events=Object.create(null):(delete C[F],C.removeListener&&this.emit("removeListener",F,Q.listener||b));else if("function"!==typeof Q){for(z=-1,t=Q.length-1;t>=0;t--)if(Q[t]===b||Q[t].listener===b){g=Q[t].listener,z=t;break}if(z<0)return this;0===z?Q.shift():function(F,b){for(;b+1<F.length;b++)F[b]=F[b+1];F.pop()}(Q,z),1===Q.length&&(C[F]=Q[0]),void 0!==C.removeListener&&this.emit("removeListener",F,g||b)}return this},t.prototype.off=t.prototype.removeListener,t.prototype.zb=function(F){var b,Q,C;if(void 0===(Q=this._events))return this;if(void 0===Q.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Q[F]&&(0===--this._eventsCount?this._events=Object.create(null):delete Q[F]),this;if(0===arguments.length){var z,t=Object.keys(Q);for(C=0;C<t.length;++C)"removeListener"!==(z=t[C])&&this.zb(z);return this.zb("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(b=Q[F]))this.removeListener(F,b);else if(void 0!==b)for(C=b.length-1;C>=0;C--)this.removeListener(F,b[C]);return this},t.prototype.listeners=function(F){return e(this,F,!0)},t.prototype.rawListeners=function(F){return e(this,F,!1)},t.listenerCount=function(F,b){return"function"===typeof F.listenerCount?F.listenerCount(b):N.call(F,b)},t.prototype.listenerCount=N,t.prototype.eventNames=function(){return this._eventsCount>0?b(this._events):[]}},13446:F=>{"use strict";F.exports=function(F,b,Q,C,z,t){var g=+b[0],W=+b[1],Z=+b[2],q=+Q[0],G=+Q[1],K=+Q[2],e=Math.sqrt(q*q+G*G+K*K);if(0===e)throw new Error("Can't raycast along a zero vector");return function(F,b,Q,C,z,t,g,W,Z,q){for(var G=0,K=Math.floor,e=0|K(b),N=0|K(Q),y=0|K(C),E=z>0?1:-1,c=t>0?1:-1,X=g>0?1:-1,L=Math.abs(1/z),i=Math.abs(1/t),f=Math.abs(1/g),k=L<1/0?L*(E>0?e+1-b:b-e):1/0,m=i<1/0?i*(c>0?N+1-Q:Q-N):1/0,R=f<1/0?f*(X>0?y+1-C:C-y):1/0,p=-1;G<=W;){var D=F(e,N,y);if(D)return Z&&(Z[0]=b+G*z,Z[1]=Q+G*t,Z[2]=C+G*g),q&&(q[0]=q[1]=q[2]=0,0===p&&(q[0]=-E),1===p&&(q[1]=-c),2===p&&(q[2]=-X)),D;k<m?k<R?(e+=E,G=k,k+=L,p=0):(y+=X,G=R,R+=f,p=2):m<R?(N+=c,G=m,m+=i,p=1):(y+=X,G=R,R+=f,p=2)}return Z&&(Z[0]=b+G*z,Z[1]=Q+G*t,Z[2]=C+G*g),q&&(q[0]=q[1]=q[2]=0),0}(F,g,W,Z,q/=e,G/=e,K/=e,C="undefined"===typeof C?64:+C,z,t)}},13489:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>t});var C=Q(13154);function z(){this.ve=!1,this.stopPropagation=!1,this.Je=!1,this.disabled=!1}class t{constructor(F,b){this.version="0.7.0";var Q=Object.assign({},new z,b||{});this.element=F||document,this.ve=!!Q.ve,this.stopPropagation=!!Q.stopPropagation,this.Je=!!Q.Je,this.disabled=!!Q.disabled,this.filterEvents=(F,b)=>!0,this.down=new C.EventEmitter,this.up=new C.EventEmitter,this.state={},this.QG={dx:0,dy:0,oN:0,bG:0,SN:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?W(this):document.addEventListener("DOMContentLoaded",(F=>{W(this)}),{once:!0})}bind(F){for(var b=arguments.length,Q=new Array(b>1?b-1:0),C=1;C<b;C++)Q[C-1]=arguments[C];Q.forEach((b=>{var Q=this._keyBindmap[b]||[];Q.includes(F)||(Q.push(F),this._keyBindmap[b]=Q)})),this.state[F]=!!this.state[F],this.pressCount[F]=this.pressCount[F]||0,this.releaseCount[F]=this.releaseCount[F]||0}unbind(F){for(var b in this._keyBindmap){var Q=this._keyBindmap[b],C=Q.indexOf(F);C>-1&&Q.splice(C,1)}}getBindings(){var F={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((Q=>{F[Q]=F[Q]||[],F[Q].push(b)}))}return F}eZ(){g(this.QG),g(this.pressCount),g(this.releaseCount)}}function g(F){for(var b in F)F[b]=0}function W(F){window.addEventListener("keydown",y.bind(null,F,!0),!1),window.addEventListener("keyup",y.bind(null,F,!1),!1);var b={passive:!0};F.element.addEventListener("touchstart",K.bind(void 0,F),{passive:!1}),F.element.addEventListener("touchend",N.bind(void 0,F),b),F.element.addEventListener("mousedown",E.bind(null,F,!0),b),window.document.addEventListener("mouseup",E.bind(null,F,!1),b),F.element.addEventListener("touchmove",c.bind(null,F),b),F.element.addEventListener("mousemove",c.bind(null,F),b),window.PointerEvent,F.element.addEventListener("wheel",X.bind(null,F),b),F.element.addEventListener("contextmenu",L.bind(null,F),!1),window.addEventListener("blur",i.bind(null,F),!1)}var Z=0,q=0,G=null;function K(F,b){b.preventDefault(),e(b)}function e(F){let b=!1;for(let Q=0;Q<F.touches.length;++Q)if(F.touches[Q].identifier===G){b=!0;break}if(!b){const b=F.changedTouches[0];Z=b.clientX,q=b.clientY,G=b.identifier}}function N(F,b){for(var Q=b.changedTouches,C=0;C<Q.length;++C)Q[C].identifier===G&&(G=null)}function y(F,b,Q){f(Q.code,b,F,Q)}function E(F,b,Q){if("pointerId"in Q)if(b){if(null!==F._touches.currID)return;F._touches.currID=Q.pointerId}else{if(F._touches.currID!==Q.pointerId)return;F._touches.currID=null}return f("Mouse"+("button"in Q?Q.button+1:1),b,F,Q),!1}function c(F,b){var Q=b.movementX||b.mozMovementX||0,C=b.movementY||b.mozMovementY||0;if(b.touches&&0===(Q|C)){var z=function(F){e(F);for(let b=0;b<F.changedTouches.length;++b)if(F.changedTouches[b].identifier==G){const Q=F.changedTouches[b],C=[Q.clientX-Z,Q.clientY-q];return Z=Q.clientX,q=Q.clientY,C}return console.error(`Did not find touch id ${G}`),[0,0]}(b);Q=z[0],C=z[1]}F.QG.dx+=Q,F.QG.dy+=C}function X(F,b){var Q=1;switch(b.deltaMode){case 0:Q=1;break;case 1:Q=12;break;case 2:Q=F.element.clientHeight||window.innerHeight}F.QG.oN+=(b.deltaX||0)*Q,F.QG.bG+=(b.deltaY||0)*Q,F.QG.SN+=(b.deltaZ||0)*Q}function L(F,b){if(!F.Je)return b.preventDefault(),!1}function i(F){for(var b in F._keyStates)F._keyStates[b]&&(/^Mouse\d/.test(b)||f(b,!1,F,{code:b,note:"zwru5aibxa8",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(F,b,Q,C){var z=Q._keyBindmap[F];z&&(k(Q._keyStates[F],b)&&(Q._keyStates[F]=b,z.forEach((F=>{(!Q.filterEvents||Q.filterEvents(C,F))&&function(F,b,Q,C){var z=b?Q.pressCount:Q.releaseCount;z[F]=(z[F]||0)+1;var t=Q._bindPressCount[F]||0;(t+=b?1:-1)<0&&(t=0);Q._bindPressCount[F]=t;var g=Q.state[F];if(k(g,t)){Q.state[F]=t>0;var W=b?Q.down:Q.up;Q.disabled||W.emit(F,C)}}(F,b,Q,C)}))),"button"in C||(Q.ve&&!C.defaultPrevented&&C.preventDefault(),Q.stopPropagation&&C.stopPropagation()))}function k(F,b){return F?!b:b}},12144:F=>{F.exports=function(F,b,Q){return F[0]=b[0]+Q[0],F[1]=b[1]+Q[1],F[2]=b[2]+Q[2],F}},12109:(F,b,Q)=>{F.exports=function(F,b){var Q=C(F[0],F[1],F[2]),g=C(b[0],b[1],b[2]);z(Q,Q),z(g,g);var W=t(Q,g);return W>1?0:Math.acos(W)};var C=Q(12118),z=Q(12121),t=Q(12124)},12203:F=>{F.exports=function(F,b){return F[0]=Math.ceil(b[0]),F[1]=Math.ceil(b[1]),F[2]=Math.ceil(b[2]),F}},12104:F=>{F.exports=function(F){var b=new Float32Array(3);return b[0]=F[0],b[1]=F[1],b[2]=F[2],b}},12126:F=>{F.exports=function(F,b){return F[0]=b[0],F[1]=b[1],F[2]=b[2],F}},12102:F=>{F.exports=function(){var F=new Float32Array(3);return F[0]=0,F[1]=0,F[2]=0,F}},12277:F=>{F.exports=function(F,b,Q){var C=b[0],z=b[1],t=b[2],g=Q[0],W=Q[1],Z=Q[2];return F[0]=z*Z-t*W,F[1]=t*g-C*Z,F[2]=C*W-z*g,F}},12225:(F,b,Q)=>{F.exports=Q(12223)},12223:F=>{F.exports=function(F,b){var Q=b[0]-F[0],C=b[1]-F[1],z=b[2]-F[2];return Math.sqrt(Q*Q+C*C+z*z)}},12184:(F,b,Q)=>{F.exports=Q(12178)},12178:F=>{F.exports=function(F,b,Q){return F[0]=b[0]/Q[0],F[1]=b[1]/Q[1],F[2]=b[2]/Q[2],F}},12124:F=>{F.exports=function(F,b){return F[0]*b[0]+F[1]*b[1]+F[2]*b[2]}},12098:F=>{F.exports=1e-6},12134:(F,b,Q)=>{F.exports=function(F,b){var Q=F[0],z=F[1],t=F[2],g=b[0],W=b[1],Z=b[2];return Math.abs(Q-g)<=C*Math.max(1,Math.abs(Q),Math.abs(g))&&Math.abs(z-W)<=C*Math.max(1,Math.abs(z),Math.abs(W))&&Math.abs(t-Z)<=C*Math.max(1,Math.abs(t),Math.abs(Z))};var C=Q(12098)},12139:F=>{F.exports=function(F,b){return F[0]===b[0]&&F[1]===b[1]&&F[2]===b[2]}},12200:F=>{F.exports=function(F,b){return F[0]=Math.floor(b[0]),F[1]=Math.floor(b[1]),F[2]=Math.floor(b[2]),F}},12323:(F,b,Q)=>{F.exports=function(F,b,Q,z,t,g){var W,Z;b||(b=3);Q||(Q=0);Z=z?Math.min(z*b+Q,F.length):F.length;for(W=Q;W<Z;W+=b)C[0]=F[W],C[1]=F[W+1],C[2]=F[W+2],t(C,C,g),F[W]=C[0],F[W+1]=C[1],F[W+2]=C[2];return F};var C=Q(12102)()},12118:F=>{F.exports=function(F,b,Q){var C=new Float32Array(3);return C[0]=F,C[1]=b,C[2]=Q,C}},12089:(F,b,Q)=>{F.exports={EPSILON:Q(12098),create:Q(12102),clone:Q(12104),angle:Q(12109),CZ:Q(12118),j:Q(12126),set:Q(12130),equals:Q(12134),exactEquals:Q(12139),add:Q(12144),WQ:Q(12151),sub:Q(12160),multiply:Q(12163),mul:Q(12169),divide:Q(12178),div:Q(12184),min:Q(12189),max:Q(12194),floor:Q(12200),ceil:Q(12203),round:Q(12208),scale:Q(12214),zZ:Q(12216),distance:Q(12223),i:Q(12225),squaredDistance:Q(12228),sqrDist:Q(12230),length:Q(12238),len:Q(12242),squaredLength:Q(12249),tZ:Q(12258),negate:Q(12261),inverse:Q(12270),normalize:Q(12121),dot:Q(12124),cross:Q(12277),FZ:Q(12286),random:Q(12291),transformMat4:Q(12294),transformMat3:Q(12297),transformQuat:Q(12305),gZ:Q(12310),WZ:Q(12312),ZZ:Q(12317),forEach:Q(12323)}},12270:F=>{F.exports=function(F,b){return F[0]=1/b[0],F[1]=1/b[1],F[2]=1/b[2],F}},12242:(F,b,Q)=>{F.exports=Q(12238)},12238:F=>{F.exports=function(F){var b=F[0],Q=F[1],C=F[2];return Math.sqrt(b*b+Q*Q+C*C)}},12286:F=>{F.exports=function(F,b,Q,C){var z=b[0],t=b[1],g=b[2];return F[0]=z+C*(Q[0]-z),F[1]=t+C*(Q[1]-t),F[2]=g+C*(Q[2]-g),F}},12194:F=>{F.exports=function(F,b,Q){return F[0]=Math.max(b[0],Q[0]),F[1]=Math.max(b[1],Q[1]),F[2]=Math.max(b[2],Q[2]),F}},12189:F=>{F.exports=function(F,b,Q){return F[0]=Math.min(b[0],Q[0]),F[1]=Math.min(b[1],Q[1]),F[2]=Math.min(b[2],Q[2]),F}},12169:(F,b,Q)=>{F.exports=Q(12163)},12163:F=>{F.exports=function(F,b,Q){return F[0]=b[0]*Q[0],F[1]=b[1]*Q[1],F[2]=b[2]*Q[2],F}},12261:F=>{F.exports=function(F,b){return F[0]=-b[0],F[1]=-b[1],F[2]=-b[2],F}},12121:F=>{F.exports=function(F,b){var Q=b[0],C=b[1],z=b[2],t=Q*Q+C*C+z*z;t>0&&(t=1/Math.sqrt(t),F[0]=b[0]*t,F[1]=b[1]*t,F[2]=b[2]*t);return F}},12291:F=>{F.exports=function(F,b){b=b||1;var Q=2*Math.random()*Math.PI,C=2*Math.random()-1,z=Math.sqrt(1-C*C)*b;return F[0]=Math.cos(Q)*z,F[1]=Math.sin(Q)*z,F[2]=C*b,F}},12310:F=>{F.exports=function(F,b,Q,C){var z=Q[1],t=Q[2],g=b[1]-z,W=b[2]-t,Z=Math.sin(C),q=Math.cos(C);return F[0]=b[0],F[1]=z+g*q-W*Z,F[2]=t+g*Z+W*q,F}},12312:F=>{F.exports=function(F,b,Q,C){var z=Q[0],t=Q[2],g=b[0]-z,W=b[2]-t,Z=Math.sin(C),q=Math.cos(C);return F[0]=z+W*Z+g*q,F[1]=b[1],F[2]=t+W*q-g*Z,F}},12317:F=>{F.exports=function(F,b,Q,C){var z=Q[0],t=Q[1],g=b[0]-z,W=b[1]-t,Z=Math.sin(C),q=Math.cos(C);return F[0]=z+g*q-W*Z,F[1]=t+g*Z+W*q,F[2]=b[2],F}},12208:F=>{F.exports=function(F,b){return F[0]=Math.round(b[0]),F[1]=Math.round(b[1]),F[2]=Math.round(b[2]),F}},12214:F=>{F.exports=function(F,b,Q){return F[0]=b[0]*Q,F[1]=b[1]*Q,F[2]=b[2]*Q,F}},12216:F=>{F.exports=function(F,b,Q,C){return F[0]=b[0]+Q[0]*C,F[1]=b[1]+Q[1]*C,F[2]=b[2]+Q[2]*C,F}},12130:F=>{F.exports=function(F,b,Q,C){return F[0]=b,F[1]=Q,F[2]=C,F}},12230:(F,b,Q)=>{F.exports=Q(12228)},12258:(F,b,Q)=>{F.exports=Q(12249)},12228:F=>{F.exports=function(F,b){var Q=b[0]-F[0],C=b[1]-F[1],z=b[2]-F[2];return Q*Q+C*C+z*z}},12249:F=>{F.exports=function(F){var b=F[0],Q=F[1],C=F[2];return b*b+Q*Q+C*C}},12160:(F,b,Q)=>{F.exports=Q(12151)},12151:F=>{F.exports=function(F,b,Q){return F[0]=b[0]-Q[0],F[1]=b[1]-Q[1],F[2]=b[2]-Q[2],F}},12297:F=>{F.exports=function(F,b,Q){var C=b[0],z=b[1],t=b[2];return F[0]=C*Q[0]+z*Q[3]+t*Q[6],F[1]=C*Q[1]+z*Q[4]+t*Q[7],F[2]=C*Q[2]+z*Q[5]+t*Q[8],F}},12294:F=>{F.exports=function(F,b,Q){var C=b[0],z=b[1],t=b[2],g=Q[3]*C+Q[7]*z+Q[11]*t+Q[15];return g=g||1,F[0]=(Q[0]*C+Q[4]*z+Q[8]*t+Q[12])/g,F[1]=(Q[1]*C+Q[5]*z+Q[9]*t+Q[13])/g,F[2]=(Q[2]*C+Q[6]*z+Q[10]*t+Q[14])/g,F}},12305:F=>{F.exports=function(F,b,Q){var C=b[0],z=b[1],t=b[2],g=Q[0],W=Q[1],Z=Q[2],q=Q[3],G=q*C+W*t-Z*z,K=q*z+Z*C-g*t,e=q*t+g*z-W*C,N=-g*C-W*z-Z*t;return F[0]=G*q+N*-g+K*-Z-e*-W,F[1]=K*q+N*-W+e*-g-G*-Z,F[2]=e*q+N*-Z+G*-W-K*-g,F}},13182:F=>{"use strict";F.exports=function(F){for(var b=new Array(F),Q=0;Q<F;++Q)b[Q]=Q;return b}},13238:F=>{F.exports=function(F){return null!=F&&null!=F.constructor&&"function"===typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}},13452:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>C});class C{constructor(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.GK=!1,this.KK=!1,this.ZK=30,this.qK=0,this.iK=!1,this.fullscreen=!1,this.NK=function(F){},this.yK=function(){},this.XK=function(){},this.gb=function(){},this.EK=function(F){},this.onFullscreenChanged=function(F){},q((()=>{!function(F,b){F._nowObject=performance||Date,F._lastTick=0,F._renderAccum=0,F._rt=0,F._frameCB=W.bind(null,F),requestAnimationFrame(F._frameCB),b>0&&(F._intervalCB=g.bind(null,F),F._interval=setInterval(F._intervalCB,Math.max(b,1e3/F.ZK/2)))}(this,b),function(F,b){if(!b)return;var Q=!1,C=!1;document.addEventListener("pointerlockchange",(C=>{Q=document.pointerLockElement===b,F.EK(Q)})),document.addEventListener("fullscreenchange",(Q=>{C=document.fullscreenElement===b,F.onFullscreenChanged(C)})),Object.defineProperty(F,"iK",{get:()=>Q,set:F=>{F&&!Q?Z(b):Q&&!F&&function(F){F.exitPointerLock&&F.exitPointerLock()}(document)}}),Object.defineProperty(F,"fullscreen",{get:()=>C,set:F=>{F&&!C?b.requestFullscreen():C&&!F&&document.exitFullscreen()}}),b.addEventListener("click",(z=>{F.GK&&!Q&&Z(b),F.KK&&!C&&b.requestFullscreen()}));var z=()=>F.gb();if(window.ResizeObserver){new ResizeObserver(z).observe(b)}else window.addEventListener("resize",z)}(this,F),this.XK()}))}}var z=3,t=20;function g(F){for(var b=1e3/F.ZK,Q=F._nowObject.now()+t,C=0;F._nowObject.now()>=F._lastTick+b&&F._nowObject.now()<Q&&++C<=z;)F.NK(b),F._lastTick+=b;var g=5*(b+5),W=F._nowObject.now();if(W-F._lastTick>g)for(;W>=F._lastTick+b;)F._lastTick+=b}function W(F){requestAnimationFrame(F._frameCB),g(F);var b=F._nowObject.now(),Q=b-F._rt;if(F._rt=b,F.qK>0){F._renderAccum+=Q;var C=1e3/F.qK;if(F._renderAccum<C)return;F._renderAccum=Math.min(F._renderAccum-C,C)}var z=1e3/F.ZK,t=(b-F._lastTick)/z;F.yK(Q,t,z)}function Z(F){F.requestPointerLock&&F.requestPointerLock()}var q=F=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),F()};document.addEventListener("readystatechange",b)}else setTimeout(F,1)}},13174:(F,b,Q)=>{var C=Q(13182),z=Q(13186),t="undefined"!==typeof Float64Array;function g(F,b){return F[0]-b[0]}function W(){var F,b=this.stride,Q=new Array(b.length);for(F=0;F<Q.length;++F)Q[F]=[Math.abs(b[F]),F];Q.sort(g);var C=new Array(Q.length);for(F=0;F<C.length;++F)C[F]=Q[F][1];return C}function Z(F,b){var Q=["View",b,"d",F].join("");b<0&&(Q="View_Nil"+F);var z="generic"===F;if(-1===b){var t="function "+Q+"(a){this.data=a;};var proto="+Q+".prototype;proto.dtype='"+F+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Q+"(a){return new "+Q+"(a);}";return new Function(t)()}if(0===b){t="function "+Q+"(a,d) {this.data = a;this.offset = d};var proto="+Q+".prototype;proto.dtype='"+F+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Q+"_copy() {return new "+Q+"(this.data,this.offset)};proto.pick=function "+Q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Q+"_get(){return "+(z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Q+"_set(v){return "+(z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Q+"(a,b,c,d){return new "+Q+"(a,d)}";return new Function("TrivialArray",t)(q[F][0])}t=["'use strict'"];var g=C(b),Z=g.map((function(F){return"i"+F})),G="this.offset+"+g.map((function(F){return"this.stride["+F+"]*i"+F})).join("+"),K=g.map((function(F){return"b"+F})).join(","),e=g.map((function(F){return"c"+F})).join(",");t.push("function "+Q+"(a,"+K+","+e+",d){this.data=a","this.shape=["+K+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+Q+".prototype","proto.dtype='"+F+"'","proto.dimension="+b),t.push("Object.defineProperty(proto,'size',{get:function "+Q+"_size(){return "+g.map((function(F){return"this.shape["+F+"]"})).join("*"),"}})"),1===b?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),b<4?(t.push("function "+Q+"_order(){"),2===b?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+Q+"_set("+Z.join(",")+",v){"),z?t.push("return this.data.set("+G+",v)}"):t.push("return this.data["+G+"]=v}"),t.push("proto.get=function "+Q+"_get("+Z.join(",")+"){"),z?t.push("return this.data.get("+G+")}"):t.push("return this.data["+G+"]}"),t.push("proto.index=function "+Q+"_index(",Z.join(),"){return "+G+"}"),t.push("proto.hi=function "+Q+"_hi("+Z.join(",")+"){return new "+Q+"(this.data,"+g.map((function(F){return["(typeof i",F,"!=='number'||i",F,"<0)?this.shape[",F,"]:i",F,"|0"].join("")})).join(",")+","+g.map((function(F){return"this.stride["+F+"]"})).join(",")+",this.offset)}");var N=g.map((function(F){return"a"+F+"=this.shape["+F+"]"})),y=g.map((function(F){return"c"+F+"=this.stride["+F+"]"}));t.push("proto.lo=function "+Q+"_lo("+Z.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+y.join(","));for(var E=0;E<b;++E)t.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");t.push("return new "+Q+"(this.data,"+g.map((function(F){return"a"+F})).join(",")+","+g.map((function(F){return"c"+F})).join(",")+",b)}"),t.push("proto.step=function "+Q+"_step("+Z.join(",")+"){var "+g.map((function(F){return"a"+F+"=this.shape["+F+"]"})).join(",")+","+g.map((function(F){return"b"+F+"=this.stride["+F+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<b;++E)t.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");t.push("return new "+Q+"(this.data,"+g.map((function(F){return"a"+F})).join(",")+","+g.map((function(F){return"b"+F})).join(",")+",c)}");var c=new Array(b),X=new Array(b);for(E=0;E<b;++E)c[E]="a[i"+E+"]",X[E]="b[i"+E+"]";t.push("proto.transpose=function "+Q+"_transpose("+Z+"){"+Z.map((function(F,b){return F+"=("+F+"===undefined?"+b+":"+F+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Q+"(this.data,"+c.join(",")+","+X.join(",")+",this.offset)}"),t.push("proto.pick=function "+Q+"_pick("+Z+"){var a=[],b=[],c=this.offset");for(E=0;E<b;++E)t.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+Q+"(data,shape,stride,offset){return new "+Q+"(data,"+g.map((function(F){return"shape["+F+"]"})).join(",")+","+g.map((function(F){return"stride["+F+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(q[F],W)}var q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};F.exports=function(F,b,Q,C){if(void 0===F)return(0,q.array[0])([]);"number"===typeof F&&(F=[F]),void 0===b&&(b=[F.length]);var g=b.length;if(void 0===Q){Q=new Array(g);for(var W=g-1,G=1;W>=0;--W)Q[W]=G,G*=b[W]}if(void 0===C){C=0;for(W=0;W<g;++W)Q[W]<0&&(C-=(b[W]-1)*Q[W])}for(var K=function(F){if(z(F))return"buffer";if(t)switch(Object.prototype.toString.call(F)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(F)?"array":"generic"}(F),e=q[K];e.length<=g+1;)e.push(Z(K,e.length-1));return(0,e[g+1])(F,b,Q,C)}},13186:F=>{function b(F){return!!F.constructor&&"function"===typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}F.exports=function(F){return null!=F&&(b(F)||function(F){return"function"===typeof F.readFloatLE&&"function"===typeof F.slice&&b(F.slice(0,0))}(F)||!!F._isBuffer)}},13325:F=>{"use strict";var b=[],Q=[],C=[],z=[],t=[],g=[],W=[],Z=[],q=[],G=[],K=[],e=[];F.exports=function(F,N,y,E,c,X){for(var L=W,i=q,f=G,k=e,m=0;m<3;m++)L[m]=+y[m],f[m]=+N.max[m],i[m]=+N.base[m];X||(X=1e-10);var R=function(F,W,q,G,e,N){var y=b,E=Q,c=C,X=z,L=t,i=g,f=Z,k=Math.floor,m=0,R=0,p=0,D=0,P=0;if(n(),0===p)return 0;for(D=Y();R<=p;){if(j(D)&&w())return m;D=Y()}for(m+=p,P=0;P<3;P++)G[P]+=q[P],e[P]+=q[P];return m;function n(){if(R=0,0!==(p=Math.sqrt(q[0]*q[0]+q[1]*q[1]+q[2]*q[2])))for(var F=0;F<3;F++){var b=q[F]>=0;X[F]=b?1:-1;var Q=b?e[F]:G[F];y[F]=b?G[F]:e[F],E[F]=s(Q,X[F]),c[F]=V(y[F],X[F]),f[F]=q[F]/p,L[F]=Math.abs(1/f[F]);var C=b?E[F]+1-Q:Q-E[F];i[F]=L[F]<1/0?L[F]*C:1/0}}function j(b){for(var Q=X[0],C=0===b?E[0]:c[0],z=E[0]+Q,t=X[1],g=1===b?E[1]:c[1],W=E[1]+t,Z=X[2],q=2===b?E[2]:c[2],G=E[2]+Z,K=C;K!=z;K+=Q)for(var e=g;e!=W;e+=t)for(var N=q;N!=G;N+=Z)if(F(K,e,N))return!0;return!1}function w(){m+=R;var F=X[D],b=R/p,Q=K;for(P=0;P<3;P++){var C=q[P]*b;G[P]+=C,e[P]+=C,Q[P]=q[P]-C}if(F>0?e[D]=Math.round(e[D]):G[D]=Math.round(G[D]),W(m,D,F,Q))return!0;for(P=0;P<3;P++)q[P]=Q[P];return n(),0===p}function Y(){var F=i[0]<i[1]?i[0]<i[2]?0:2:i[1]<i[2]?1:2,b=i[F]-R;for(R=i[F],E[F]+=X[F],i[F]+=L[F],P=0;P<3;P++)y[P]+=b*f[P],c[P]=V(y[P],X[P]);return F}function s(F,b){return k(F-b*N)}function V(F,b){return k(F+b*N)}}(F,E,L,i,f,X);if(!c){for(m=0;m<3;m++)k[m]=y[m]>0?f[m]-N.max[m]:i[m]-N.base[m];N.translate(k)}return R}},13492:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>K});var C=Q(13321),z=Q(12089);class t{constructor(F,b,Q,t,g,W,Z){this.WG=new C(F.base,F.pG),this.vz=b,this.friction=Q,this.restitution=t,this.JW=g,this.zy=W,this.IW=!!Z,this.mG=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.Hy=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Tq=z.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=z.create(),this._impulses=z.create(),this._sleepFrameCount=10}loadFromCopy(F){z.j(this.WG.base,F.WG.base),z.j(this.WG.pG,F.WG.pG),z.j(this.WG.max,F.WG.max),this.WG.mag=F.WG.mag,this.vz=F.vz,this.friction=F.friction,this.restitution=F.restitution,this.JW=F.JW,this.zy=F.zy,this.IW=F.IW,this.mG=F.mG,this.fluidDrag=F.fluidDrag,this.Hy=F.Hy,this.preventFallOffEdge=F.preventFallOffEdge,this.rolledBackLastTick=F.rolledBackLastTick,z.j(this.Tq,F.Tq),z.j(this.resting,F.resting),this.inFluid=F.inFluid,this._ratioInFluid=F._ratioInFluid,z.j(this._forces,F._forces),z.j(this._impulses,F._impulses),this._sleepFrameCount=F._sleepFrameCount}setPosition(F){g(F),z.WQ(F,F,this.WG.base),this.WG.translate(F),this.Oq()}Wb(){return z.clone(this.WG.base)}applyForce(F){g(F),z.add(this._forces,this._forces,F),this.Oq()}applyImpulse(F){g(F),z.add(this._impulses,this._impulses,F),this.Oq()}Oq(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var g=F=>{};var W=Q(13321),Z=Q(12089),q=Q(13325);function G(){this.mG=.1,this.fluidDrag=.4,this.dW=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function K(F,b,Q){F=Object.assign(new G,F),this.gravity=F.gravity||[0,-10,0],this.mG=F.mG||.1,this.dW=F.dW||2,this.fluidDrag=F.fluidDrag||.4,this.minBounceImpulse=F.minBounceImpulse,this.bodies=[],this.PN=F.PN,this.testSolid=b,this.testFluid=Q}K.prototype.Ky=function(F,b,Q,C,z,g){F=F||new W([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof Q&&(Q=1),"undefined"==typeof C&&(C=0),"undefined"==typeof z&&(z=1);var Z=new t(F,b,Q,C,z,g);return this.bodies.push(Z),Z},K.prototype.ey=function(F){var b=this.bodies.indexOf(F);b<0||(this.bodies.splice(b,1),F.WG=F.zy=null)};var e=Z.create(),N=Z.create(),y=Z.create(),E=Z.create(),c=Z.create(),X=Z.create(),L=Z.create(),i=new W([0,0,0],[1,1,1]),f=new t(i,1,1,0,1,(()=>{}),!1);function k(F,b,Q){return b=Q,b*=1-(1-F.ratioInFluid)**2}K.prototype.eZ=function(F){F/=1e3;var b=S(0,Z.squaredLength(this.gravity));this.bodies.forEach((Q=>function(F,b,Q,C){Z.j(c,b.resting),F.PN&&f.loadFromCopy(b);if(b.vz<=0)return Z.set(b.Tq,0,0,0),Z.set(b._forces,0,0,0),void Z.set(b._impulses,0,0,0);var z=C||0===b.JW;if(function(F,b,Q,C){if(b._sleepFrameCount>0)return!1;if(C)return!0;var z=!1,t=.5*Q*Q*b.JW;return Z.scale(o,F.gravity,t),q(F.testSolid,b.WG,o,(function(){return z=!0,!0}),!0),z}(F,b,Q,z))return;b._sleepFrameCount--,function(F,b){var Q=b.WG,C=Math.floor(Q.base[0]),z=Math.floor(Q.base[2]),t=Math.floor(Q.base[1]),g=Math.floor(Q.max[1]);if(!F.testFluid(C,t,z))return b.inFluid=!1,void(b.ratioInFluid=0);var W=1,q=t+1;for(;q<=g&&F.testFluid(C,q,z);)W++,q++;var G=(t+W-Q.base[1])/Q.pG[1];G>1&&(G=1);var K=Q.pG[0]*Q.pG[1]*Q.pG[2]*G,e=R;Z.scale(e,F.gravity,-F.dW*K*b.JW),b.applyForce(e),b.inFluid=!0,b.ratioInFluid=G}(F,b),x(b._forces),x(b._impulses),x(b.Tq),x(b.resting),Z.scale(e,b._forces,1/b.vz),Z.zZ(e,e,F.gravity,b.JW),Z.scale(N,b._impulses,1/b.vz),Z.zZ(N,N,e,Q),Z.add(b.Tq,b.Tq,N),b.friction&&(p(F,0,b,N,Q),p(F,1,b,N,Q),p(F,2,b,N,Q));var t=b.fluidDrag>=0?b.fluidDrag:F.fluidDrag,g=b.mG>=0?b.mG:F.mG,W=g,G=g;b.inFluid&&(W=k(b,W,b.fluidDragHoriz>=0?b.fluidDragHoriz:t),G=k(b,G,b.fluidDragVert>=0?b.fluidDragVert:t));W=Math.max(1-W*Q/b.vz,0),G=Math.max(1-G*Q/b.vz,0),Z.set(m,W,G,W),Z.multiply(b.Tq,b.Tq,m),Z.scale(y,b.Tq,Q),Z.set(b._forces,0,0,0),Z.set(b._impulses,0,0,0),b.IW&&O(n,b.WG);Z.j(X,y),Z.set(L,0,0,0),b.preventFallOffEdge&&function(F,b,Q,C){if(!b.resting[1]||Q[1]>0)return;var z=h;O(z,b.WG);for(var t=0;t<3;t+=2){Z.set(V,0,0,0),V[t]=Q[t];var g=!0;(g=(g=(g=(g=g&&!T(F,z.base[0]+V[0]+1e-5,z.base[1],z.base[2]+V[2]+1e-5))&&!T(F,z.max[0]+V[0]-1e-5,z.base[1],z.base[2]+V[2]+1e-5))&&!T(F,z.base[0]+V[0]+1e-5,z.base[1],z.max[2]+V[2]-1e-5))&&!T(F,z.max[0]+V[0]-1e-5,z.base[1],z.max[2]+V[2]-1e-5))?(C[t]=Q[t]>0?1:-1,Q[t]=0):0===t&&(Z.set(l,Q[0],0,0),P(F,z,l,C,b.slideOnCollision))}}(F,b,y,L);P(F,b.WG,y,b.resting,b.slideOnCollision),b.IW&&function(F,b,Q,C){if(b.resting[1]>=0&&!b.inFluid)return;var z=0!==b.resting[0],t=0!==b.resting[2];if(!z&&!t)return;var g=Math.abs(C[0]/C[2]),W=4;if(!z&&g>W)return;if(!t&&g<1/W)return;Z.add(w,Q.base,C);var G=F.testSolid;q(G,Q,C,(function(F,b,Q,C){if(1!==b)return!0;C[b]=0}));var K=Q.base[1],e=b.inFluid?1.951:1.001,N=Math.floor(K+e)-K;Z.set(Y,0,N,0);var y=!1;if(q(G,Q,Y,(function(F,b,Q,C){return y=!0,!0})),y)return;Z.WQ(s,w,Q.base),s[1]=0,P(F,Q,s,j,!0);var E=S(Q.base[0],w[0]),c=S(Q.base[2],w[2]);if(z&&!E&&(!c||!t))return;if(t&&(!E||!z)&&!c)return;var X=!0;if(X=X&&!T(F,Q.base[0]+1e-5,Q.base[1],Q.base[2]+1e-5),X=X&&!T(F,Q.max[0]-1e-5,Q.base[1],Q.base[2]+1e-5),X=X&&!T(F,Q.base[0]+1e-5,Q.base[1],Q.max[2]-1e-5),X=X&&!T(F,Q.max[0]-1e-5,Q.base[1],Q.max[2]-1e-5),X)return;O(b.WG,Q),b.resting[0]=j[0],b.resting[2]=j[2],b.Hy&&b.Hy()}(F,b,n,X);for(var K=0;K<3;++K)b.resting[K]=b.resting[K]||L[K],E[K]=0,b.resting[K]&&(c[K]||(E[K]=-b.Tq[K]),b.Tq[K]=0);var i=Z.length(E);i>.001&&(Z.scale(E,E,b.vz),b.zy&&b.zy(E),b.restitution>0&&i>F.minBounceImpulse&&(Z.scale(E,E,b.restitution),b.applyImpulse(E)));var D=Z.squaredLength(b.Tq);D>1e-5&&b.Oq();F.PN&&F.PN(b)?(b.loadFromCopy(f),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,Q,F,b)))};var m=Z.create([0,0,0]);var R=Z.create();function p(F,b,Q,C,z){var t=Q.resting[b],g=C[b];if(!Q.alwaysApplyHorizFriction||1!==b){if(0===t)return;if(t*g<=0)return}Z.j(D,Q.Tq),D[b]=0;var W=Z.length(D);if(!S(W,0)){var q=Math.abs(Q.friction*F.gravity[b]*z),G=W>q?(W-q)/W:0;Q.Tq[(b+1)%3]*=G,Q.Tq[(b+2)%3]*=G}}var D=Z.create();function P(F,b,Q,C,z){return Z.set(C,0,0,0),q(F.testSolid,b,Q,(function(F,b,Q,t){C[b]=Q,t[b]=0,z||(t[0]=0,t[1]=0,t[2]=0)}))}var n=new W([],[]),j=Z.create(),w=Z.create(),Y=Z.create(),s=Z.create();var V=Z.create(),h=new W([],[]),l=Z.create();function T(F,b,Q,C){return F.testSolid(Math.floor(b),Math.floor(Q-1),Math.floor(C))}var o=Z.create();function S(F,b){return Math.abs(F-b)<1e-5}function O(F,b){for(var Q=0;Q<3;Q++)F.base[Q]=b.base[Q],F.max[Q]=b.max[Q],F.pG[Q]=b.pG[Q]}var x=function(F){}},11957:function(F,b){!function(F){"use strict";var b=function(F,Q){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(F,b){F.__proto__=b}||function(F,b){for(var Q in b)Object.prototype.hasOwnProperty.call(b,Q)&&(F[Q]=b[Q])},b(F,Q)};function Q(F,Q){if("function"!==typeof Q&&null!==Q)throw new TypeError("Class extends value "+String(Q)+" is not a constructor or null");function C(){this.constructor=F}b(F,Q),F.prototype=null===Q?Object.create(Q):(C.prototype=Q.prototype,new C)}function C(F,b,Q,C){var z,t=arguments.length,g=t<3?b:null===C?C=Object.getOwnPropertyDescriptor(b,Q):C;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(F,b,Q,C);else for(var W=F.length-1;W>=0;W--)(z=F[W])&&(g=(t<3?z(g):t>3?z(b,Q,g):z(b,Q))||g);return t>3&&g&&Object.defineProperty(b,Q,g),g}function z(F,b,Q){if(Q||2===arguments.length)for(var C,z=0,t=b.length;z<t;z++)!C&&z in b||(C||(C=Array.prototype.slice.call(b,0,z)),C[z]=b[z]);return F.concat(C||Array.prototype.slice.call(b))}var t,g=255,W=213;F.OPERATION=void 0,(t=F.OPERATION||(F.OPERATION={}))[t.ADD=128]="ADD",t[t.REPLACE=0]="REPLACE",t[t.DELETE=64]="DELETE",t[t.DELETE_AND_ADD=192]="DELETE_AND_ADD",t[t.TOUCH=1]="TOUCH",t[t.CLEAR=10]="CLEAR";var Z=function(){function b(F,b,Q){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=F,this.setParent(b,Q)}return b.prototype.setParent=function(F,b,Q){var C=this;if(this.indexes||(this.indexes=this.ref instanceof sF?this.ref._definition.indexes:{}),this.parent=F,this.parentIndex=Q,b)if(this.root=b,this.ref instanceof sF){var z=this.ref._definition;for(var t in z.schema){var g=this.ref[t];if(g&&g.$changes){var W=z.indexes[t];g.$changes.setParent(this.ref,b,W)}}}else"object"===typeof this.ref&&this.ref.forEach((function(F,b){if(F instanceof sF){var Q=F.$changes,z=C.ref.$changes.indexes[b];Q.setParent(C.ref,C.root,z)}}))},b.prototype.operation=function(F){this.changes.set(--this.currentCustomOperation,F)},b.prototype.change=function(b,Q){void 0===Q&&(Q=F.OPERATION.ADD);var C="number"===typeof b?b:this.indexes[b];this.assertValidIndex(C,b);var z=this.changes.get(C);z&&z.op!==F.OPERATION.DELETE&&z.op!==F.OPERATION.TOUCH||this.changes.set(C,{op:z&&z.op===F.OPERATION.DELETE?F.OPERATION.DELETE_AND_ADD:Q,index:C}),this.allChanges.add(C),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var Q="number"===typeof b?b:this.indexes[b];this.assertValidIndex(Q,b),this.changes.has(Q)||this.changes.set(Q,{op:F.OPERATION.TOUCH,index:Q}),this.allChanges.add(Q),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(F){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[F]];var b,Q=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(Q)[0]},b.prototype.getChildrenFilter=function(){var F=this.parent._definition.childFilters;return F&&F[this.parentIndex]},b.prototype.getValue=function(F){return this.ref.getByIndex(F)},b.prototype.delete=function(b){var Q="number"===typeof b?b:this.indexes[b];if(void 0!==Q){var C=this.getValue(Q);this.changes.set(Q,{op:F.OPERATION.DELETE,index:Q}),this.allChanges.delete(Q),delete this.caches[Q],C&&C.$changes&&(C.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(Q,")"))},b.prototype.discard=function(b,Q){var C=this;void 0===b&&(b=!1),void 0===Q&&(Q=!1),this.ref instanceof sF||this.changes.forEach((function(b){if(b.op===F.OPERATION.DELETE){var Q=C.ref.getIndex(b.index);delete C.indexes[Q]}})),this.changes.clear(),this.changed=b,Q&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var F=this;this.changes.forEach((function(b){var Q=F.getValue(b.index);Q&&Q.$changes&&Q.$changes.discardAll()})),this.discard()},b.prototype.cache=function(F,b){this.caches[F]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(F,b){if(void 0===F)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function q(F,b,Q,C){return F[b]||(F[b]=[]),F[b].push(Q),null===C||void 0===C||C.forEach((function(F,b){return Q(F,b)})),function(){return K(F[b],F[b].indexOf(Q))}}function G(b){var Q=this,C="string"!==typeof this.$changes.getType();this.$items.forEach((function(z,t){b.push({refId:Q.$changes.refId,op:F.OPERATION.DELETE,field:t,value:void 0,previousValue:z}),C&&Q.$changes.root.removeRef(z.$changes.refId)}))}function K(F,b){if(-1===b||b>=F.length)return!1;for(var Q=F.length-1,C=b;C<Q;C++)F[C]=F[C+1];return F.length=Q,!0}var e=function(F,b){var Q=F.toString(),C=b.toString();return Q<C?-1:Q>C?1:0};function N(F){return F.$proxy=!0,F=new Proxy(F,{get:function(F,b){return"symbol"===typeof b||isNaN(b)?F[b]:F.at(b)},set:function(F,b,Q){if("symbol"===typeof b||isNaN(b))F[b]=Q;else{var C=Array.from(F.$items.keys()),z=parseInt(C[b]||b);void 0===Q||null===Q?F.deleteAt(z):F.setAt(z,Q)}return!0},deleteProperty:function(F,b){return"number"===typeof b?F.deleteAt(b):delete F[b],!0}})}var y=function(){function b(){for(var F=[],b=0;b<arguments.length;b++)F[b]=arguments[b];this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,F)}return b.prototype.gt=function(b,Q){return void 0===Q&&(Q=!0),q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,b,Q?this.$items:void 0)},b.prototype.tb=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,b)},b.is=function(F){return Array.isArray(F)||void 0!==F.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(F){0===F?this.clear():this.splice(F,this.length-F)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var F,b=this,Q=[],C=0;C<arguments.length;C++)Q[C]=arguments[C];return Q.forEach((function(Q){F=b.$refId++,b.setAt(F,Q)})),F},b.prototype.pop=function(){var F=Array.from(this.$indexes.values()).pop();if(void 0!==F){this.$changes.delete(F),this.$indexes.delete(F);var b=this.$items.get(F);return this.$items.delete(F),b}},b.prototype.at=function(F){var b=Array.from(this.$items.keys())[F];return this.$items.get(b)},b.prototype.setAt=function(b,Q){var C,z;if(void 0!==Q&&null!==Q){if(this.$items.get(b)!==Q){void 0!==Q.$changes&&Q.$changes.setParent(this,this.$changes.root,b);var t=null!==(z=null===(C=this.$changes.indexes[b])||void 0===C?void 0:C.op)&&void 0!==z?z:F.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,Q),this.$changes.change(b,t)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(F){var b=Array.from(this.$items.keys())[F];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(F){return this.$changes.delete(F),this.$indexes.delete(F),this.$items.delete(F)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&G.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var F,Q=[],C=0;C<arguments.length;C++)Q[C]=arguments[C];return new(b.bind.apply(b,z([void 0],(F=Array.from(this.$items.values())).concat.apply(F,Q),!1)))},b.prototype.join=function(F){return Array.from(this.$items.values()).join(F)},b.prototype.reverse=function(){var F=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(Q,C){F.setAt(b[C],Q)})),this},b.prototype.shift=function(){var F=Array.from(this.$items.keys()).shift();if(void 0!==F){var b=this.$items.get(F);return this.$deleteAt(F),b}},b.prototype.slice=function(F,Q){var C=new b;return C.push.apply(C,Array.from(this.$items.values()).slice(F,Q)),C},b.prototype.sort=function(F){var b=this;void 0===F&&(F=e);var Q=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(F).forEach((function(F,C){b.setAt(Q[C],F)})),this},b.prototype.splice=function(F,b){void 0===b&&(b=this.length-F);for(var Q=Array.from(this.$items.keys()),C=[],z=F;z<F+b;z++)C.push(this.$items.get(Q[z])),this.$deleteAt(Q[z]);return C},b.prototype.unshift=function(){for(var F=this,b=[],Q=0;Q<arguments.length;Q++)b[Q]=arguments[Q];var C=this.length,z=b.length,t=Array.from(this.$items.values());return b.forEach((function(b,Q){F.setAt(Q,b)})),t.forEach((function(b,Q){F.setAt(z+Q,b)})),C+z},b.prototype.indexOf=function(F,b){return Array.from(this.$items.values()).indexOf(F,b)},b.prototype.lastIndexOf=function(F,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(F,b)},b.prototype.every=function(F,b){return Array.from(this.$items.values()).every(F,b)},b.prototype.some=function(F,b){return Array.from(this.$items.values()).some(F,b)},b.prototype.forEach=function(F,b){Array.from(this.$items.values()).forEach(F,b)},b.prototype.map=function(F,b){return Array.from(this.$items.values()).map(F,b)},b.prototype.filter=function(F,b){return Array.from(this.$items.values()).filter(F,b)},b.prototype.reduce=function(F,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(F,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(F,b){return Array.from(this.$items.values()).find(F,b)},b.prototype.findIndex=function(F,b){return Array.from(this.$items.values()).findIndex(F,b)},b.prototype.fill=function(F,b,Q){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(F,b,Q){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(F,b){return Array.from(this.$items.values()).includes(F,b)},b.prototype.flatMap=function(F,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(F){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var F=Array.from(this.$items.values());return F.findLast.apply(F,arguments)},b.prototype.findLastIndex=function(){var F=Array.from(this.$items.values());return F.findLastIndex.apply(F,arguments)},b.prototype.setIndex=function(F,b){this.$indexes.set(F,b)},b.prototype.getIndex=function(F){return this.$indexes.get(F)},b.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},b.prototype.deleteByIndex=function(F){var b=this.$indexes.get(F);this.$items.delete(b),this.$indexes.delete(F)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(F){return"function"===typeof F.toJSON?F.toJSON():F}))},b.prototype.clone=function(F){return F?new(b.bind.apply(b,z([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,z([void 0],this.map((function(F){return F.$changes?F.clone():F})),!1)))},b}();function E(F){return F.$proxy=!0,F=new Proxy(F,{get:function(F,b){return"symbol"!==typeof b&&"undefined"===typeof F[b]?F.get(b):F[b]},set:function(F,b,Q){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"gt"!==b&&"tb"!==b&&"onChange"!==b?F.set(b,Q):F[b]=Q,!0},deleteProperty:function(F,b){return F.delete(b),!0}})}var c=function(){function b(F){var Q=this;if(this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,F)if(F instanceof Map||F instanceof b)F.forEach((function(F,b){return Q.set(b,F)}));else for(var C in F)this.set(C,F[C])}return b.prototype.gt=function(b,Q){return void 0===Q&&(Q=!0),q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,b,Q?this.$items:void 0)},b.prototype.tb=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,b)},b.is=function(F){return void 0!==F.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,Q){if(void 0===Q||null===Q)throw new Error("MapSchema#set('".concat(b,"', ").concat(Q,"): trying to set ").concat(Q," value on '").concat(b,"'."));b=b.toString();var C="undefined"!==typeof this.$changes.indexes[b],z=C?this.$changes.indexes[b]:this.$refId++,t=C?F.OPERATION.REPLACE:F.OPERATION.ADD,g=void 0!==Q.$changes;if(g&&Q.$changes.setParent(this,this.$changes.root,z),C){if(!g&&this.$items.get(b)===Q)return;g&&this.$items.get(b)!==Q&&(t=F.OPERATION.ADD)}else this.$changes.indexes[b]=z,this.$indexes.set(z,b);return this.$items.set(b,Q),this.$changes.change(b,t),this},b.prototype.get=function(F){return this.$items.get(F)},b.prototype.delete=function(F){return this.$changes.delete(F),this.$items.delete(F)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&G.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(F){return this.$items.has(F)},b.prototype.forEach=function(F){this.$items.forEach(F)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(F,b){this.$indexes.set(F,b)},b.prototype.getIndex=function(F){return this.$indexes.get(F)},b.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},b.prototype.deleteByIndex=function(F){var b=this.$indexes.get(F);this.$items.delete(b),this.$indexes.delete(F)},b.prototype.toJSON=function(){var F={};return this.forEach((function(b,Q){F[Q]="function"===typeof b.toJSON?b.toJSON():b})),F},b.prototype.clone=function(F){var Q;return F?Q=Object.assign(new b,this):(Q=new b,this.forEach((function(F,b){F.$changes?Q.set(b,F.clone()):Q.set(b,F)}))),Q},b}(),X={};function L(F,b){X[F]=b}function i(F){return X[F]}var f=function(){function F(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return F.create=function(b){var Q=new F;return Q.schema=Object.assign({},b&&b.schema||{}),Q.indexes=Object.assign({},b&&b.indexes||{}),Q.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),Q.descriptors=Object.assign({},b&&b.descriptors||{}),Q.deprecated=Object.assign({},b&&b.deprecated||{}),Q},F.prototype.addField=function(F,b){var Q=this.getNextFieldIndex();this.fieldsByIndex[Q]=F,this.indexes[F]=Q,this.schema[F]=Array.isArray(b)?{array:b[0]}:b},F.prototype.hasField=function(F){return void 0!==this.indexes[F]},F.prototype.addFilter=function(F,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[F]]=b,this.indexesWithFilters.push(this.indexes[F]),!0},F.prototype.addChildrenFilter=function(F,b){var Q=this.indexes[F],C=this.schema[F];if(i(Object.keys(C)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[Q]=b,!0;console.warn("@filterChildren: field '".concat(F,"' can't have children. Ignoring filter."))},F.prototype.getChildrenFilter=function(F){return this.childFilters&&this.childFilters[this.indexes[F]]},F.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},F}();function k(F){return F._context&&F._context.useFilters}var m=function(){function F(){this.types={},this.schemas=new Map,this.useFilters=!1}return F.prototype.has=function(F){return this.schemas.has(F)},F.prototype.get=function(F){return this.types[F]},F.prototype.add=function(F,b){void 0===b&&(b=this.schemas.size),F._definition=f.create(F._definition),F._typeid=b,this.types[b]=F,this.schemas.set(F,b)},F.create=function(b){return void 0===b&&(b={}),function(Q){return b.context||(b.context=new F),p(Q,b)}},F}(),R=new m;function p(F,b){return void 0===b&&(b={}),function(Q,C){var t=b.context||R,g=Q.constructor;if(g._context=t,!F)throw new Error("".concat(g.name,': @type() reference provided for "').concat(C,"\" is undefined. Make sure you don't have any circular dependencies."));t.has(g)||t.add(g);var W=g._definition;if(W.addField(C,F),W.descriptors[C]){if(W.deprecated[C])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(C,"' definition on '").concat(g.name,"'.\nCheck @type() annotation"))}catch(X){var Z=X.stack.split("\n")[4].trim();throw new Error("".concat(X.message," ").concat(Z))}}var q=y.is(F),G=!q&&c.is(F);if("string"!==typeof F&&!sF.is(F)){var K=Object.values(F)[0];"string"===typeof K||t.has(K)||t.add(K)}if(b.manual)W.descriptors[C]={enumerable:!0,configurable:!0,writable:!0};else{var e="_".concat(C);W.descriptors[e]={enumerable:!1,configurable:!1,writable:!0},W.descriptors[C]={get:function(){return this[e]},set:function(F){F!==this[e]&&(void 0!==F&&null!==F?(!q||F instanceof y||(F=new(y.bind.apply(y,z([void 0],F,!1)))),!G||F instanceof c||(F=new c(F)),void 0===F.$proxy&&(G?F=E(F):q&&(F=N(F))),this.$changes.change(C),F.$changes&&F.$changes.setParent(this,this.$changes.root,this._definition.indexes[C])):this[e]&&this.$changes.delete(C),this[e]=F)},enumerable:!0,configurable:!0}}}}function D(F){return function(b,Q){var C=b.constructor;C._definition.addFilter(Q,F)&&(C._context.useFilters=!0)}}function P(F){return function(b,Q){var C=b.constructor;C._definition.addChildrenFilter(Q,F)&&(C._context.useFilters=!0)}}function n(F){return void 0===F&&(F=!0),function(b,Q){var C=b.constructor._definition;C.deprecated[Q]=!0,F&&(C.descriptors[Q]={get:function(){throw new Error("".concat(Q," is deprecated."))},set:function(F){},enumerable:!1,configurable:!0})}}function j(F,b,Q){for(var C in void 0===Q&&(Q={}),Q.context||(Q.context=F._context||Q.context||R),b)p(b[C],Q)(F.prototype,C);return F}function w(F){for(var b=0,Q=0,C=0,z=F.length;C<z;C++)(b=F.charCodeAt(C))<128?Q+=1:b<2048?Q+=2:b<55296||b>=57344?Q+=3:(C++,Q+=4);return Q}function Y(F,b,Q){for(var C=0,z=0,t=Q.length;z<t;z++)(C=Q.charCodeAt(z))<128?F[b++]=C:C<2048?(F[b++]=192|C>>6,F[b++]=128|63&C):C<55296||C>=57344?(F[b++]=224|C>>12,F[b++]=128|C>>6&63,F[b++]=128|63&C):(z++,C=65536+((1023&C)<<10|1023&Q.charCodeAt(z)),F[b++]=240|C>>18,F[b++]=128|C>>12&63,F[b++]=128|C>>6&63,F[b++]=128|63&C)}function s(F,b){F.push(255&b)}function V(F,b){F.push(255&b)}function h(F,b){F.push(255&b),F.push(b>>8&255)}function l(F,b){F.push(255&b),F.push(b>>8&255)}function T(F,b){F.push(255&b),F.push(b>>8&255),F.push(b>>16&255),F.push(b>>24&255)}function o(F,b){var Q=b>>24,C=b>>16,z=b>>8,t=b;F.push(255&t),F.push(255&z),F.push(255&C),F.push(255&Q)}function S(F,b){var Q=Math.floor(b/Math.pow(2,32));o(F,b>>>0),o(F,Q)}function O(F,b){var Q=b/Math.pow(2,32)|0;o(F,b>>>0),o(F,Q)}function x(F,b){v(F,b)}function a(F,b){J(F,b)}var A=new Int32Array(2),U=new Float32Array(A.buffer),u=new Float64Array(A.buffer);function v(F,b){U[0]=b,T(F,A[0])}function J(F,b){u[0]=b,T(F,A[0]),T(F,A[1])}function I(F,b){return V(F,b?1:0)}function M(F,b){b||(b="");var Q=w(b),C=0;if(Q<32)F.push(160|Q),C=1;else if(Q<256)F.push(217),V(F,Q),C=2;else if(Q<65536)F.push(218),l(F,Q),C=3;else{if(!(Q<4294967296))throw new Error("String too long");F.push(219),o(F,Q),C=5}return Y(F,F.length,b),C+Q}function r(F,b){return isNaN(b)?r(F,0):isFinite(b)?b!==(0|b)?(F.push(203),J(F,b),9):b>=0?b<128?(V(F,b),1):b<256?(F.push(204),V(F,b),2):b<65536?(F.push(205),l(F,b),3):b<4294967296?(F.push(206),o(F,b),5):(F.push(207),O(F,b),9):b>=-32?(F.push(224|b+32),1):b>=-128?(F.push(208),s(F,b),2):b>=-32768?(F.push(209),h(F,b),3):b>=-2147483648?(F.push(210),T(F,b),5):(F.push(211),S(F,b),9):r(F,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var H=Object.freeze({__proto__:null,utf8Write:Y,int8:s,uint8:V,int16:h,uint16:l,int32:T,uint32:o,int64:S,uint64:O,float32:x,float64:a,writeFloat32:v,writeFloat64:J,boolean:I,string:M,number:r});function B(F,b,Q){for(var C="",z=0,t=b,g=b+Q;t<g;t++){var W=F[t];0!==(128&W)?192!==(224&W)?224!==(240&W)?240!==(248&W)?console.error("Invalid byte "+W.toString(16)):(z=(7&W)<<18|(63&F[++t])<<12|(63&F[++t])<<6|63&F[++t])>=65536?(z-=65536,C+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):C+=String.fromCharCode(z):C+=String.fromCharCode((15&W)<<12|(63&F[++t])<<6|63&F[++t]):C+=String.fromCharCode((31&W)<<6|63&F[++t]):C+=String.fromCharCode(W)}return C}function d(F,b){return FF(F,b)<<24>>24}function FF(F,b){return F[b.offset++]}function bF(F,b){return QF(F,b)<<16>>16}function QF(F,b){return F[b.offset++]|F[b.offset++]<<8}function CF(F,b){return F[b.offset++]|F[b.offset++]<<8|F[b.offset++]<<16|F[b.offset++]<<24}function zF(F,b){return CF(F,b)>>>0}function tF(F,b){return eF(F,b)}function gF(F,b){return NF(F,b)}function WF(F,b){var Q=zF(F,b);return CF(F,b)*Math.pow(2,32)+Q}function ZF(F,b){var Q=zF(F,b);return zF(F,b)*Math.pow(2,32)+Q}var qF=new Int32Array(2),GF=new Float32Array(qF.buffer),KF=new Float64Array(qF.buffer);function eF(F,b){return qF[0]=CF(F,b),GF[0]}function NF(F,b){return qF[0]=CF(F,b),qF[1]=CF(F,b),KF[0]}function yF(F,b){return FF(F,b)>0}function EF(F,b){var Q,C=F[b.offset++];C<192?Q=31&C:217===C?Q=FF(F,b):218===C?Q=QF(F,b):219===C&&(Q=zF(F,b));var z=B(F,b.offset,Q);return b.offset+=Q,z}function cF(F,b){var Q=F[b.offset];return Q<192&&Q>160||217===Q||218===Q||219===Q}function XF(F,b){var Q=F[b.offset++];return Q<128?Q:202===Q?eF(F,b):203===Q?NF(F,b):204===Q?FF(F,b):205===Q?QF(F,b):206===Q?zF(F,b):207===Q?ZF(F,b):208===Q?d(F,b):209===Q?bF(F,b):210===Q?CF(F,b):211===Q?WF(F,b):Q>223?-1*(255-Q+1):void 0}function LF(F,b){var Q=F[b.offset];return Q<128||Q>=202&&Q<=211}function iF(F,b){return F[b.offset]<160}function fF(F,b){return F[b.offset-1]===g&&(F[b.offset]<128||F[b.offset]>=202&&F[b.offset]<=211)}var kF=Object.freeze({__proto__:null,int8:d,uint8:FF,int16:bF,uint16:QF,int32:CF,uint32:zF,float32:tF,float64:gF,int64:WF,uint64:ZF,readFloat32:eF,readFloat64:NF,boolean:yF,string:EF,stringCheck:cF,number:XF,numberCheck:LF,arrayCheck:iF,switchStructureCheck:fF}),mF=function(){function b(F){var b=this;this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,F&&F.forEach((function(F){return b.add(F)}))}return b.prototype.gt=function(b,Q){return void 0===Q&&(Q=!0),q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,b,Q?this.$items:void 0)},b.prototype.tb=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,b)},b.is=function(F){return void 0!==F.collection},b.prototype.add=function(F){var b=this.$refId++;return void 0!==F.$changes&&F.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,F),this.$changes.change(b),b},b.prototype.at=function(F){var b=Array.from(this.$items.keys())[F];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(F){for(var b,Q,C=this.$items.entries();(Q=C.next())&&!Q.done;)if(F===Q.value[1]){b=Q.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&G.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(F){return Array.from(this.$items.values()).some((function(b){return b===F}))},b.prototype.forEach=function(F){var b=this;this.$items.forEach((function(Q,C,z){return F(Q,C,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(F,b){this.$indexes.set(F,b)},b.prototype.getIndex=function(F){return this.$indexes.get(F)},b.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},b.prototype.deleteByIndex=function(F){var b=this.$indexes.get(F);this.$items.delete(b),this.$indexes.delete(F)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var F=[];return this.forEach((function(b,Q){F.push("function"===typeof b.toJSON?b.toJSON():b)})),F},b.prototype.clone=function(F){var Q;return F?Q=Object.assign(new b,this):(Q=new b,this.forEach((function(F){F.$changes?Q.add(F.clone()):Q.add(F)}))),Q},b}(),RF=function(){function b(F){var b=this;this.$changes=new Z(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,F&&F.forEach((function(F){return b.add(F)}))}return b.prototype.gt=function(b,Q){return void 0===Q&&(Q=!0),q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.ADD,b,Q?this.$items:void 0)},b.prototype.tb=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,b)},b.is=function(F){return void 0!==F.set},b.prototype.add=function(b){var Q,C;if(this.has(b))return!1;var z=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,z);var t=null!==(C=null===(Q=this.$changes.indexes[z])||void 0===Q?void 0:Q.op)&&void 0!==C?C:F.OPERATION.ADD;return this.$changes.indexes[z]=z,this.$indexes.set(z,z),this.$items.set(z,b),this.$changes.change(z,t),z},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(F){for(var b,Q,C=this.$items.entries();(Q=C.next())&&!Q.done;)if(F===Q.value[1]){b=Q.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&G.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:F.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(F){for(var b,Q=this.$items.values(),C=!1;(b=Q.next())&&!b.done;)if(F===b.value){C=!0;break}return C},b.prototype.forEach=function(F){var b=this;this.$items.forEach((function(Q,C,z){return F(Q,C,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(F,b){this.$indexes.set(F,b)},b.prototype.getIndex=function(F){return this.$indexes.get(F)},b.prototype.getByIndex=function(F){return this.$items.get(this.$indexes.get(F))},b.prototype.deleteByIndex=function(F){var b=this.$indexes.get(F);this.$items.delete(b),this.$indexes.delete(F)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var F=[];return this.forEach((function(b,Q){F.push("function"===typeof b.toJSON?b.toJSON():b)})),F},b.prototype.clone=function(F){var Q;return F?Q=Object.assign(new b,this):(Q=new b,this.forEach((function(F){F.$changes?Q.add(F.clone()):Q.add(F)}))),Q},b}(),pF=function(){function F(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return F.prototype.addRefId=function(F){this.refIds.has(F)||(this.refIds.add(F),this.containerIndexes.set(F,new Set))},F.get=function(b){return void 0===b.$filterState&&(b.$filterState=new F),b.$filterState},F}(),DF=function(){function F(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return F.prototype.getNextUniqueId=function(){return this.nextUniqueId++},F.prototype.addRef=function(F,b,Q){void 0===Q&&(Q=!0),this.refs.set(F,b),Q&&(this.refCounts[F]=(this.refCounts[F]||0)+1)},F.prototype.removeRef=function(F){this.refCounts[F]=this.refCounts[F]-1,this.deletedRefs.add(F)},F.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},F.prototype.garbageCollectDeletedRefs=function(){var F=this;this.deletedRefs.forEach((function(b){if(!(F.refCounts[b]>0)){var Q=F.refs.get(b);if(Q instanceof sF)for(var C in Q._definition.schema)"string"!==typeof Q._definition.schema[C]&&Q[C]&&Q[C].$changes&&F.removeRef(Q[C].$changes.refId);else{var z=Q.$changes.parent._definition,t=z.schema[z.fieldsByIndex[Q.$changes.parentIndex]];"function"===typeof Object.values(t)[0]&&Array.from(Q.values()).forEach((function(b){return F.removeRef(b.$changes.refId)}))}F.refs.delete(b),delete F.refCounts[b]}})),this.deletedRefs.clear()},F}(),PF=function(F){function b(){return null!==F&&F.apply(this,arguments)||this}return Q(b,F),b}(Error);function nF(F,b,Q,C){var z,t=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":z="number",isNaN(F)&&console.log('trying to encode "NaN" in '.concat(Q.constructor.name,"#").concat(C));break;case"string":z="string",t=!0;break;case"boolean":return}if(typeof F!==z&&(!t||t&&null!==F)){var g="'".concat(JSON.stringify(F),"'").concat(F&&F.constructor&&" (".concat(F.constructor.name,")")||"");throw new PF("a '".concat(z,"' was expected, but ").concat(g," was provided in ").concat(Q.constructor.name,"#").concat(C))}}function jF(F,b,Q,C){if(!(F instanceof b))throw new PF("a '".concat(b.name,"' was expected, but '").concat(F.constructor.name,"' was provided in ").concat(Q.constructor.name,"#").concat(C))}function wF(F,b,Q,C,z){nF(Q,F,C,z);var t=H[F];if(!t)throw new PF("a '".concat(F,"' was expected, but ").concat(Q," was provided in ").concat(C.constructor.name,"#").concat(z));t(b,Q)}function YF(F,b,Q){return kF[F](b,Q)}var sF=function(){function b(){for(var F=[],b=0;b<arguments.length;b++)F[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new Z(this,void 0,new DF),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var Q=this._definition.descriptors;Q&&Object.defineProperties(this,Q),F[0]&&this.assign(F[0])}return b.onError=function(F){console.error(F)},b.is=function(F){return F._definition&&void 0!==F._definition.schema},b.prototype.onChange=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.REPLACE,b)},b.prototype.tb=function(b){return q(this.$callbacks||(this.$callbacks=[]),F.OPERATION.DELETE,b)},b.prototype.assign=function(F){return Object.assign(this,F),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(F,b){this.$changes.change(F,b)},b.prototype.listen=function(F,b,Q){var C=this;return void 0===Q&&(Q=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[F]||(this.$callbacks[F]=[]),this.$callbacks[F].push(b),Q&&void 0!==this[F]&&b(this[F],void 0),function(){return K(C.$callbacks[F],C.$callbacks[F].indexOf(b))}},b.prototype.decode=function(Q,C,z){var t;void 0===C&&(C={offset:0}),void 0===z&&(z=this);var W=[],Z=this.$changes.root,q=Q.length,G=0;for(Z.refs.set(G,this);C.offset<q;){var K=Q[C.offset++];if(K!=g){var e=z.$changes,N=void 0!==z._definition,E=N?K>>6<<6:K;if(E!==F.OPERATION.CLEAR){var X=N?K%(E||255):XF(Q,C),L=N?z._definition.fieldsByIndex[X]:"",f=e.getType(X),k=void 0,m=void 0,R=void 0;if(N?m=z["_".concat(L)]:(m=z.getByIndex(X),(E&F.OPERATION.ADD)===F.OPERATION.ADD?(R=z instanceof c?EF(Q,C):X,z.setIndex(X,R)):R=z.getIndex(X)),(E&F.OPERATION.DELETE)===F.OPERATION.DELETE&&(E!==F.OPERATION.DELETE_AND_ADD&&z.deleteByIndex(X),m&&m.$changes&&Z.removeRef(m.$changes.refId),k=null),void 0!==L){if(E===F.OPERATION.DELETE);else if(b.is(f)){var p=XF(Q,C);if(k=Z.refs.get(p),E!==F.OPERATION.REPLACE){var D=this.getSchemaType(Q,C,f);k||((k=this.createTypeInstance(D)).$changes.refId=p,m&&(k.$callbacks=m.$callbacks,m.$changes.refId&&p!==m.$changes.refId&&Z.removeRef(m.$changes.refId))),Z.addRef(p,k,k!==m)}}else if("string"===typeof f)k=YF(f,Q,C);else{var P=i(Object.keys(f)[0]),n=XF(Q,C),j=Z.refs.has(n)?m||Z.refs.get(n):new P.constructor;if((k=j.clone(!0)).$changes.refId=n,m&&(k.$callbacks=m.$callbacks,m.$changes.refId&&n!==m.$changes.refId)){Z.removeRef(m.$changes.refId);for(var w=m.entries(),Y=void 0;(Y=w.next())&&!Y.done;){var s=(t=Y.value)[0],V=t[1];W.push({refId:n,op:F.OPERATION.DELETE,field:s,value:void 0,previousValue:V})}}Z.addRef(n,k,j!==m)}if(null!==k&&void 0!==k)if(k.$changes&&k.$changes.setParent(e.ref,e.root,X),z instanceof b)z[L]=k;else if(z instanceof c)s=R,z.$items.set(s,k),z.$changes.allChanges.add(X);else if(z instanceof y)z.setAt(X,k);else if(z instanceof mF){var h=z.add(k);z.setIndex(X,h)}else z instanceof RF&&!1!==(h=z.add(k))&&z.setIndex(X,h);m!==k&&W.push({refId:G,op:E,field:L,dynamicIndex:R,value:k,previousValue:m})}else{console.warn("@colyseus/schema: definition mismatch");for(var l={offset:C.offset};C.offset<q&&(!fF(Q,C)||(l.offset=C.offset+1,!Z.refs.has(XF(Q,l))));)C.offset++}}else z.clear(W)}else{G=XF(Q,C);var T=Z.refs.get(G);if(!T)throw new Error('"refId" not found: '.concat(G));z=T}}return this._triggerChanges(W),Z.garbageCollectDeletedRefs(),W},b.prototype.encode=function(Q,C,z){void 0===Q&&(Q=!1),void 0===C&&(C=[]),void 0===z&&(z=!1);for(var t=this.$changes,W=new WeakSet,Z=[t],q=1,G=0;G<q;G++){var K=Z[G],e=K.ref,N=e instanceof b;K.ensureRefId(),W.add(K),K!==t&&(K.changed||Q)&&(V(C,g),r(C,K.refId));for(var y=Q?Array.from(K.allChanges):Array.from(K.changes.values()),E=0,X=y.length;E<X;E++){var L=Q?{op:F.OPERATION.ADD,index:y[E]}:y[E],f=L.index,k=N?e._definition.fieldsByIndex&&e._definition.fieldsByIndex[f]:f,m=C.length;if(L.op!==F.OPERATION.TOUCH)if(N)V(C,f|L.op);else{if(V(C,L.op),L.op===F.OPERATION.CLEAR)continue;r(C,f)}if(N||(L.op&F.OPERATION.ADD)!=F.OPERATION.ADD||e instanceof c&&M(C,K.ref.$indexes.get(f)),L.op!==F.OPERATION.DELETE){var R=K.getType(f),p=K.getValue(f);if(p&&p.$changes&&!W.has(p.$changes)&&(Z.push(p.$changes),p.$changes.ensureRefId(),q++),L.op!==F.OPERATION.TOUCH){if(b.is(R))jF(p,R,e,k),r(C,p.$changes.refId),(L.op&F.OPERATION.ADD)===F.OPERATION.ADD&&this.tryEncodeTypeId(C,R,p.constructor);else if("string"===typeof R)wF(R,C,p,e,k);else{var D=i(Object.keys(R)[0]);jF(e["_".concat(k)],D.constructor,e,k),r(C,p.$changes.refId)}z&&K.cache(f,C.slice(m))}}}Q||z||K.discard()}return C},b.prototype.encodeAll=function(F){return this.encode(!0,[],F)},b.prototype.applyFilters=function(Q,C){var z,t;void 0===C&&(C=!1);for(var W=this,Z=new Set,q=pF.get(Q),G=[this.$changes],K=1,e=[],N=function(N){var y=G[N];if(Z.has(y.refId))return"continue";var E=y.ref,X=E instanceof b;V(e,g),r(e,y.refId);var L=q.refIds.has(y),i=C||!L;q.addRefId(y);var f=q.containerIndexes.get(y),k=i?Array.from(y.allChanges):Array.from(y.changes.values());!C&&X&&E._definition.indexesWithFilters&&E._definition.indexesWithFilters.forEach((function(b){!f.has(b)&&y.allChanges.has(b)&&(i?k.push(b):k.push({op:F.OPERATION.ADD,index:b}))}));for(var m=0,R=k.length;m<R;m++){var p=i?{op:F.OPERATION.ADD,index:k[m]}:k[m];if(p.op!==F.OPERATION.CLEAR){var D=p.index;if(p.op!==F.OPERATION.DELETE){var P=y.getValue(D),n=y.getType(D);if(X){if((j=E._definition.filters&&E._definition.filters[D])&&!j.call(E,Q,P,W)){P&&P.$changes&&Z.add(P.$changes.refId);continue}}else{var j,w=y.parent;if((j=y.getChildrenFilter())&&!j.call(w,Q,E.$indexes.get(D),P,W)){P&&P.$changes&&Z.add(P.$changes.refId);continue}}if(P.$changes&&(G.push(P.$changes),K++),p.op!==F.OPERATION.TOUCH)if(p.op===F.OPERATION.ADD||X)e.push.apply(e,null!==(z=y.caches[D])&&void 0!==z?z:[]),f.add(D);else if(f.has(D))e.push.apply(e,null!==(t=y.caches[D])&&void 0!==t?t:[]);else{if(f.add(D),V(e,F.OPERATION.ADD),r(e,D),E instanceof c){var Y=y.ref.$indexes.get(D);M(e,Y)}P.$changes?r(e,P.$changes.refId):H[n](e,P)}else P.$changes&&!X&&(V(e,F.OPERATION.ADD),r(e,D),E instanceof c&&(Y=y.ref.$indexes.get(D),M(e,Y)),r(e,P.$changes.refId))}else X?V(e,p.op|D):(V(e,p.op),r(e,D))}else V(e,p.op)}},y=0;y<K;y++)N(y);return e},b.prototype.clone=function(){var F,b=new this.constructor,Q=this._definition.schema;for(var C in Q)"object"===typeof this[C]&&"function"===typeof(null===(F=this[C])||void 0===F?void 0:F.clone)?b[C]=this[C].clone():b[C]=this[C];return b},b.prototype.toJSON=function(){var F=this._definition.schema,b=this._definition.deprecated,Q={};for(var C in F)b[C]||null===this[C]||"undefined"===typeof this[C]||(Q[C]="function"===typeof this[C].toJSON?this[C].toJSON():this["_".concat(C)]);return Q},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(F){return this[this._definition.fieldsByIndex[F]]},b.prototype.deleteByIndex=function(F){this[this._definition.fieldsByIndex[F]]=void 0},b.prototype.tryEncodeTypeId=function(F,b,Q){b._typeid!==Q._typeid&&(V(F,W),r(F,Q._typeid))},b.prototype.getSchemaType=function(F,b,Q){var C;return F[b.offset]===W&&(b.offset++,C=this.constructor._context.get(XF(F,b))),C||Q},b.prototype.createTypeInstance=function(F){var b=new F;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(Q){for(var C,z,t,g,W,Z,q,G,K,e=new Set,N=this.$changes.root.refs,y=function(y){var E=Q[y],c=E.refId,X=N.get(c),L=X.$callbacks;if((E.op&F.OPERATION.DELETE)===F.OPERATION.DELETE&&E.previousValue instanceof b&&(null===(z=null===(C=E.previousValue.$callbacks)||void 0===C?void 0:C[F.OPERATION.DELETE])||void 0===z||z.forEach((function(F){return F()}))),!L)return"continue";if(X instanceof b){if(!e.has(c))try{null===(t=null===L||void 0===L?void 0:L[F.OPERATION.REPLACE])||void 0===t||t.forEach((function(F){return F()}))}catch(i){b.onError(i)}try{L.hasOwnProperty(E.field)&&(null===(g=L[E.field])||void 0===g||g.forEach((function(F){return F(E.value,E.previousValue)})))}catch(i){b.onError(i)}}else E.op===F.OPERATION.ADD&&void 0===E.previousValue?null===(W=L[F.OPERATION.ADD])||void 0===W||W.forEach((function(F){var b;return F(E.value,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)})):E.op===F.OPERATION.DELETE?void 0!==E.previousValue&&(null===(Z=L[F.OPERATION.DELETE])||void 0===Z||Z.forEach((function(F){var b;return F(E.previousValue,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)}))):E.op===F.OPERATION.DELETE_AND_ADD&&(void 0!==E.previousValue&&(null===(q=L[F.OPERATION.DELETE])||void 0===q||q.forEach((function(F){var b;return F(E.previousValue,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)}))),null===(G=L[F.OPERATION.ADD])||void 0===G||G.forEach((function(F){var b;return F(E.value,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)}))),E.value!==E.previousValue&&(null===(K=L[F.OPERATION.REPLACE])||void 0===K||K.forEach((function(F){var b;return F(E.value,null!==(b=E.dynamicIndex)&&void 0!==b?b:E.field)})));e.add(c)},E=0;E<Q.length;E++)y(E)},b._definition=f.create(),b}();function VF(F){for(var b=[F.$changes],Q=1,C={},z=C,t=function(F){var Q=b[F];Q.changes.forEach((function(F){var b=Q.ref,C=F.index,t=b._definition?b._definition.fieldsByIndex[C]:b.$indexes.get(C);z[t]=Q.getValue(C)}))},g=0;g<Q;g++)t(g);return C}var hF={context:new m},lF=function(F){function b(){return null!==F&&F.apply(this,arguments)||this}return Q(b,F),C([p("string",hF)],b.prototype,"name",void 0),C([p("string",hF)],b.prototype,"type",void 0),C([p("number",hF)],b.prototype,"referencedType",void 0),b}(sF),TF=function(F){function b(){var b=null!==F&&F.apply(this,arguments)||this;return b.fields=new y,b}return Q(b,F),C([p("number",hF)],b.prototype,"id",void 0),C([p([lF],hF)],b.prototype,"fields",void 0),b}(sF),oF=function(F){function b(){var b=null!==F&&F.apply(this,arguments)||this;return b.types=new y,b}return Q(b,F),b.encode=function(F){var Q=F.constructor,C=new b;C.rootType=Q._typeid;var z=function(F,b){for(var Q in b){var z=new lF;z.name=Q;var t=void 0;if("string"===typeof b[Q])t=b[Q];else{var g=b[Q],W=void 0;sF.is(g)?(t="ref",W=b[Q]):"string"===typeof g[t=Object.keys(g)[0]]?t+=":"+g[t]:W=g[t],z.referencedType=W?W._typeid:-1}z.type=t,F.fields.push(z)}C.types.push(F)},t=Q._context.types;for(var g in t){var W=new TF;W.id=Number(g),z(W,t[g]._definition.schema)}return C.encodeAll()},b.decode=function(F,C){var z=new m,t=new b;t.decode(F,C);var g=t.types.reduce((function(F,b){var C=function(F){function b(){return null!==F&&F.apply(this,arguments)||this}return Q(b,F),b}(sF),t=b.id;return F[t]=C,z.add(C,t),F}),{});t.types.forEach((function(F){var b=g[F.id];F.fields.forEach((function(F){var Q;if(void 0!==F.referencedType){var C=F.type,t=g[F.referencedType];if(!t){var W=F.type.split(":");C=W[0],t=W[1]}"ref"===C?p(t,{context:z})(b.prototype,F.name):p(((Q={})[C]=t,Q),{context:z})(b.prototype,F.name)}else p(F.type,{context:z})(b.prototype,F.name)}))}));var W=g[t.rootType],Z=new W;for(var q in W._definition.schema){var G=W._definition.schema[q];"string"!==typeof G&&(Z[q]="function"===typeof G?new G:new(i(Object.keys(G)[0]).constructor))}return Z},C([p([TF],hF)],b.prototype,"types",void 0),C([p("number",hF)],b.prototype,"rootType",void 0),b}(sF);L("map",{constructor:c}),L("array",{constructor:y}),L("set",{constructor:RF}),L("collection",{constructor:mF}),F.ArraySchema=y,F.CollectionSchema=mF,F.Context=m,F.MapSchema=c,F.Reflection=oF,F.ReflectionField=lF,F.ReflectionType=TF,F.Schema=sF,F.SchemaDefinition=f,F.SetSchema=RF,F.decode=kF,F.defineTypes=j,F.deprecated=n,F.dumpChanges=VF,F.encode=H,F.filter=D,F.filterChildren=P,F.hasFilter=k,F.registerType=L,F.type=p,Object.defineProperty(F,"__esModule",{value:!0})}(b)},13371:F=>{"use strict";F.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13367:(F,b,Q)=>{var C=Q(13371),z=Q(13378),t=Object.hasOwnProperty,g=Object.create(null);for(var W in C)t.call(C,W)&&(g[C[W]]=W);var Z=F.exports={to:{},get:{}};function q(F,b,Q){return Math.min(Math.max(b,F),Q)}function G(F){var b=Math.round(F).toString(16).toUpperCase();return b.length<2?"0"+b:b}Z.get=function(F){var b,Q;switch(F.substring(0,3).toLowerCase()){case"hsl":b=Z.get.hsl(F),Q="hsl";break;case"hwb":b=Z.get.hwb(F),Q="hwb";break;default:b=Z.get.rgb(F),Q="rgb"}return b?{model:Q,value:b}:null},Z.get.rgb=function(F){if(!F)return null;var b,Q,z,g=[0,0,0,1];if(b=F.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(z=b[2],b=b[1],Q=0;Q<3;Q++){var W=2*Q;g[Q]=parseInt(b.slice(W,W+2),16)}z&&(g[3]=parseInt(z,16)/255)}else if(b=F.match(/^#([a-f0-9]{3,4})$/i)){for(z=(b=b[1])[3],Q=0;Q<3;Q++)g[Q]=parseInt(b[Q]+b[Q],16);z&&(g[3]=parseInt(z+z,16)/255)}else if(b=F.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(Q=0;Q<3;Q++)g[Q]=parseInt(b[Q+1],0);b[4]&&(b[5]?g[3]=.01*parseFloat(b[4]):g[3]=parseFloat(b[4]))}else{if(!(b=F.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=F.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:t.call(C,b[1])?((g=C[b[1]])[3]=1,g):null:null;for(Q=0;Q<3;Q++)g[Q]=Math.round(2.55*parseFloat(b[Q+1]));b[4]&&(b[5]?g[3]=.01*parseFloat(b[4]):g[3]=parseFloat(b[4]))}for(Q=0;Q<3;Q++)g[Q]=q(g[Q],0,255);return g[3]=q(g[3],0,1),g},Z.get.hsl=function(F){if(!F)return null;var b=F.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var Q=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,q(parseFloat(b[2]),0,100),q(parseFloat(b[3]),0,100),q(isNaN(Q)?1:Q,0,1)]}return null},Z.get.hwb=function(F){if(!F)return null;var b=F.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var Q=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,q(parseFloat(b[2]),0,100),q(parseFloat(b[3]),0,100),q(isNaN(Q)?1:Q,0,1)]}return null},Z.to.hex=function(){var F=z(arguments);return"#"+G(F[0])+G(F[1])+G(F[2])+(F[3]<1?G(Math.round(255*F[3])):"")},Z.to.rgb=function(){var F=z(arguments);return F.length<4||1===F[3]?"rgb("+Math.round(F[0])+", "+Math.round(F[1])+", "+Math.round(F[2])+")":"rgba("+Math.round(F[0])+", "+Math.round(F[1])+", "+Math.round(F[2])+", "+F[3]+")"},Z.to.rgb.percent=function(){var F=z(arguments),b=Math.round(F[0]/255*100),Q=Math.round(F[1]/255*100),C=Math.round(F[2]/255*100);return F.length<4||1===F[3]?"rgb("+b+"%, "+Q+"%, "+C+"%)":"rgba("+b+"%, "+Q+"%, "+C+"%, "+F[3]+")"},Z.to.hsl=function(){var F=z(arguments);return F.length<4||1===F[3]?"hsl("+F[0]+", "+F[1]+"%, "+F[2]+"%)":"hsla("+F[0]+", "+F[1]+"%, "+F[2]+"%, "+F[3]+")"},Z.to.hwb=function(){var F=z(arguments),b="";return F.length>=4&&1!==F[3]&&(b=", "+F[3]),"hwb("+F[0]+", "+F[1]+"%, "+F[2]+"%"+b+")"},Z.to.keyword=function(F){return g[F.slice(0,3)]}},13359:(F,b,Q)=>{const C=Q(13367),z=Q(13385),t=["keyword","gray","hex"],g={};for(const N of Object.keys(z))g[[...z[N].labels].sort().join("")]=N;const W={};function Z(F,b){if(!(this instanceof Z))return new Z(F,b);if(b&&b in t&&(b=null),b&&!(b in z))throw new Error("Unknown model: "+b);let Q,q;if(null==F)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(F instanceof Z)this.model=F.model,this.color=[...F.color],this.valpha=F.valpha;else if("string"===typeof F){const b=C.get(F);if(null===b)throw new Error("Unable to parse color from string: "+F);this.model=b.model,q=z[this.model].channels,this.color=b.value.slice(0,q),this.valpha="number"===typeof b.value[q]?b.value[q]:1}else if(F.length>0){this.model=b||"rgb",q=z[this.model].channels;const Q=Array.prototype.slice.call(F,0,q);this.color=e(Q,q),this.valpha="number"===typeof F[q]?F[q]:1}else if("number"===typeof F)this.model="rgb",this.color=[F>>16&255,F>>8&255,255&F],this.valpha=1;else{this.valpha=1;const b=Object.keys(F);"alpha"in F&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof F.alpha?F.alpha:0);const C=b.sort().join("");if(!(C in g))throw new Error("Unable to parse color from object: "+JSON.stringify(F));this.model=g[C];const{labels:t}=z[this.model],W=[];for(Q=0;Q<t.length;Q++)W.push(F[t[Q]]);this.color=e(W)}if(W[this.model])for(q=z[this.model].channels,Q=0;Q<q;Q++){const F=W[this.model][Q];F&&(this.color[Q]=F(this.color[Q]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}Z.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(F){let b=this.model in C.to?this:this.rgb();b=b.round("number"===typeof F?F:1);const Q=1===b.valpha?b.color:[...b.color,this.valpha];return C.to[b.model](Q)},percentString(F){const b=this.rgb().round("number"===typeof F?F:1),Q=1===b.valpha?b.color:[...b.color,this.valpha];return C.to.rgb.percent(Q)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const F={},{channels:b}=z[this.model],{labels:Q}=z[this.model];for(let C=0;C<b;C++)F[Q[C]]=this.color[C];return 1!==this.valpha&&(F.alpha=this.valpha),F},unitArray(){const F=this.rgb().color;return F[0]/=255,F[1]/=255,F[2]/=255,1!==this.valpha&&F.push(this.valpha),F},unitObject(){const F=this.rgb().object();return F.r/=255,F.g/=255,F.b/=255,1!==this.valpha&&(F.alpha=this.valpha),F},round(F){return F=Math.max(F||0,0),new Z([...this.color.map(q(F)),this.valpha],this.model)},alpha(F){return void 0!==F?new Z([...this.color,Math.max(0,Math.min(1,F))],this.model):this.valpha},red:G("rgb",0,K(255)),green:G("rgb",1,K(255)),blue:G("rgb",2,K(255)),hue:G(["hsl","hsv","hsl","hwb","hcg"],0,(F=>(F%360+360)%360)),saturationl:G("hsl",1,K(100)),lightness:G("hsl",2,K(100)),saturationv:G("hsv",1,K(100)),value:G("hsv",2,K(100)),chroma:G("hcg",1,K(100)),gray:G("hcg",2,K(100)),white:G("hwb",1,K(100)),wblack:G("hwb",2,K(100)),cyan:G("cmyk",0,K(100)),magenta:G("cmyk",1,K(100)),yellow:G("cmyk",2,K(100)),black:G("cmyk",3,K(100)),x:G("xyz",0,K(95.047)),y:G("xyz",1,K(100)),z:G("xyz",2,K(108.833)),l:G("lab",0,K(100)),a:G("lab",1),b:G("lab",2),keyword(F){return void 0!==F?new Z(F):z[this.model].keyword(this.color)},hex(F){return void 0!==F?new Z(F):C.to.hex(this.rgb().round().color)},hexa(F){if(void 0!==F)return new Z(F);const b=this.rgb().round().color;let Q=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===Q.length&&(Q="0"+Q),C.to.hex(b)+Q},rgbNumber(){const F=this.rgb().color;return(255&F[0])<<16|(255&F[1])<<8|255&F[2]},luminosity(){const F=this.rgb().color,b=[];for(const[Q,C]of F.entries()){const F=C/255;b[Q]=F<=.04045?F/12.92:((F+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(F){const b=this.luminosity(),Q=F.luminosity();return b>Q?(b+.05)/(Q+.05):(Q+.05)/(b+.05)},level(F){const b=this.contrast(F);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const F=this.rgb().color;return(2126*F[0]+7152*F[1]+722*F[2])/1e4<128},isLight(){return!this.isDark()},negate(){const F=this.rgb();for(let b=0;b<3;b++)F.color[b]=255-F.color[b];return F},lighten(F){const b=this.hsl();return b.color[2]+=b.color[2]*F,b},darken(F){const b=this.hsl();return b.color[2]-=b.color[2]*F,b},saturate(F){const b=this.hsl();return b.color[1]+=b.color[1]*F,b},desaturate(F){const b=this.hsl();return b.color[1]-=b.color[1]*F,b},whiten(F){const b=this.hwb();return b.color[1]+=b.color[1]*F,b},blacken(F){const b=this.hwb();return b.color[2]+=b.color[2]*F,b},grayscale(){const F=this.rgb().color,b=.3*F[0]+.59*F[1]+.11*F[2];return Z.rgb(b,b,b)},fade(F){return this.alpha(this.valpha-this.valpha*F)},opaquer(F){return this.alpha(this.valpha+this.valpha*F)},rotate(F){const b=this.hsl();let Q=b.color[0];return Q=(Q+F)%360,Q=Q<0?360+Q:Q,b.color[0]=Q,b},mix(F,b){if(!F||!F.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof F);const Q=F.rgb(),C=this.rgb(),z=void 0===b?.5:b,t=2*z-1,g=Q.alpha()-C.alpha(),W=((t*g===-1?t:(t+g)/(1+t*g))+1)/2,q=1-W;return Z.rgb(W*Q.red()+q*C.red(),W*Q.green()+q*C.green(),W*Q.blue()+q*C.blue(),Q.alpha()*z+C.alpha()*(1-z))}};for(const N of Object.keys(z)){if(t.includes(N))continue;const{channels:F}=z[N];Z.prototype[N]=function(){if(this.model===N)return new Z(this);for(var F=arguments.length,b=new Array(F),Q=0;Q<F;Q++)b[Q]=arguments[Q];return b.length>0?new Z(b,N):new Z([...(C=z[this.model][N].raw(this.color),Array.isArray(C)?C:[C]),this.valpha],N);var C},Z[N]=function(){for(var b=arguments.length,Q=new Array(b),C=0;C<b;C++)Q[C]=arguments[C];let z=Q[0];return"number"===typeof z&&(z=e(Q,F)),new Z(z,N)}}function q(F){return function(b){return function(F,b){return Number(F.toFixed(b))}(b,F)}}function G(F,b,Q){F=Array.isArray(F)?F:[F];for(const C of F)(W[C]||(W[C]=[]))[b]=Q;return F=F[0],function(C){let z;return void 0!==C?(Q&&(C=Q(C)),z=this[F](),z.color[b]=C,z):(z=this[F]().color[b],Q&&(z=Q(z)),z)}}function K(F){return function(b){return Math.max(0,Math.min(F,b))}}function e(F,b){for(let Q=0;Q<b;Q++)"number"!==typeof F[Q]&&(F[Q]=0);return F}F.exports=Z},13393:(F,b,Q)=>{const C=Q(13395),z={};for(const g of Object.keys(C))z[C[g]]=g;const t={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};F.exports=t;for(const g of Object.keys(t)){if(!("channels"in t[g]))throw new Error("missing channels property: "+g);if(!("labels"in t[g]))throw new Error("missing channel labels property: "+g);if(t[g].labels.length!==t[g].channels)throw new Error("channel and label counts mismatch: "+g);const{channels:F,labels:b}=t[g];delete t[g].channels,delete t[g].labels,Object.defineProperty(t[g],"channels",{value:F}),Object.defineProperty(t[g],"labels",{value:b})}t.rgb.hsl=function(F){const b=F[0]/255,Q=F[1]/255,C=F[2]/255,z=Math.min(b,Q,C),t=Math.max(b,Q,C),g=t-z;let W,Z;t===z?W=0:b===t?W=(Q-C)/g:Q===t?W=2+(C-b)/g:C===t&&(W=4+(b-Q)/g),W=Math.min(60*W,360),W<0&&(W+=360);const q=(z+t)/2;return Z=t===z?0:q<=.5?g/(t+z):g/(2-t-z),[W,100*Z,100*q]},t.rgb.hsv=function(F){let b,Q,C,z,t;const g=F[0]/255,W=F[1]/255,Z=F[2]/255,q=Math.max(g,W,Z),G=q-Math.min(g,W,Z),K=function(F){return(q-F)/6/G+.5};return 0===G?(z=0,t=0):(t=G/q,b=K(g),Q=K(W),C=K(Z),g===q?z=C-Q:W===q?z=1/3+b-C:Z===q&&(z=2/3+Q-b),z<0?z+=1:z>1&&(z-=1)),[360*z,100*t,100*q]},t.rgb.hwb=function(F){const b=F[0],Q=F[1];let C=F[2];const z=t.rgb.hsl(F)[0],g=1/255*Math.min(b,Math.min(Q,C));return C=1-1/255*Math.max(b,Math.max(Q,C)),[z,100*g,100*C]},t.rgb.cmyk=function(F){const b=F[0]/255,Q=F[1]/255,C=F[2]/255,z=Math.min(1-b,1-Q,1-C);return[100*((1-b-z)/(1-z)||0),100*((1-Q-z)/(1-z)||0),100*((1-C-z)/(1-z)||0),100*z]},t.rgb.keyword=function(F){const b=z[F];if(b)return b;let Q,t=1/0;for(const z of Object.keys(C)){const b=C[z],Z=(W=b,((g=F)[0]-W[0])**2+(g[1]-W[1])**2+(g[2]-W[2])**2);Z<t&&(t=Z,Q=z)}var g,W;return Q},t.keyword.rgb=function(F){return C[F]},t.rgb.xyz=function(F){let b=F[0]/255,Q=F[1]/255,C=F[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,Q=Q>.04045?((Q+.055)/1.055)**2.4:Q/12.92,C=C>.04045?((C+.055)/1.055)**2.4:C/12.92;return[100*(.4124*b+.3576*Q+.1805*C),100*(.2126*b+.7152*Q+.0722*C),100*(.0193*b+.1192*Q+.9505*C)]},t.rgb.lab=function(F){const b=t.rgb.xyz(F);let Q=b[0],C=b[1],z=b[2];Q/=95.047,C/=100,z/=108.883,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,C=C>.008856?C**(1/3):7.787*C+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*C-16,500*(Q-C),200*(C-z)]},t.hsl.rgb=function(F){const b=F[0]/360,Q=F[1]/100,C=F[2]/100;let z,t,g;if(0===Q)return g=255*C,[g,g,g];z=C<.5?C*(1+Q):C+Q-C*Q;const W=2*C-z,Z=[0,0,0];for(let q=0;q<3;q++)t=b+1/3*-(q-1),t<0&&t++,t>1&&t--,g=6*t<1?W+6*(z-W)*t:2*t<1?z:3*t<2?W+(z-W)*(2/3-t)*6:W,Z[q]=255*g;return Z},t.hsl.hsv=function(F){const b=F[0];let Q=F[1]/100,C=F[2]/100,z=Q;const t=Math.max(C,.01);C*=2,Q*=C<=1?C:2-C,z*=t<=1?t:2-t;return[b,100*(0===C?2*z/(t+z):2*Q/(C+Q)),100*((C+Q)/2)]},t.hsv.rgb=function(F){const b=F[0]/60,Q=F[1]/100;let C=F[2]/100;const z=Math.floor(b)%6,t=b-Math.floor(b),g=255*C*(1-Q),W=255*C*(1-Q*t),Z=255*C*(1-Q*(1-t));switch(C*=255,z){case 0:return[C,Z,g];case 1:return[W,C,g];case 2:return[g,C,Z];case 3:return[g,W,C];case 4:return[Z,g,C];case 5:return[C,g,W]}},t.hsv.hsl=function(F){const b=F[0],Q=F[1]/100,C=F[2]/100,z=Math.max(C,.01);let t,g;g=(2-Q)*C;const W=(2-Q)*z;return t=Q*z,t/=W<=1?W:2-W,t=t||0,g/=2,[b,100*t,100*g]},t.hwb.rgb=function(F){const b=F[0]/360;let Q=F[1]/100,C=F[2]/100;const z=Q+C;let t;z>1&&(Q/=z,C/=z);const g=Math.floor(6*b),W=1-C;t=6*b-g,0!==(1&g)&&(t=1-t);const Z=Q+t*(W-Q);let q,G,K;switch(g){default:case 6:case 0:q=W,G=Z,K=Q;break;case 1:q=Z,G=W,K=Q;break;case 2:q=Q,G=W,K=Z;break;case 3:q=Q,G=Z,K=W;break;case 4:q=Z,G=Q,K=W;break;case 5:q=W,G=Q,K=Z}return[255*q,255*G,255*K]},t.cmyk.rgb=function(F){const b=F[0]/100,Q=F[1]/100,C=F[2]/100,z=F[3]/100;return[255*(1-Math.min(1,b*(1-z)+z)),255*(1-Math.min(1,Q*(1-z)+z)),255*(1-Math.min(1,C*(1-z)+z))]},t.xyz.rgb=function(F){const b=F[0]/100,Q=F[1]/100,C=F[2]/100;let z,t,g;return z=3.2406*b+-1.5372*Q+-.4986*C,t=-.9689*b+1.8758*Q+.0415*C,g=.0557*b+-.204*Q+1.057*C,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,t=t>.0031308?1.055*t**(1/2.4)-.055:12.92*t,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,z=Math.min(Math.max(0,z),1),t=Math.min(Math.max(0,t),1),g=Math.min(Math.max(0,g),1),[255*z,255*t,255*g]},t.xyz.lab=function(F){let b=F[0],Q=F[1],C=F[2];b/=95.047,Q/=100,C/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,Q=Q>.008856?Q**(1/3):7.787*Q+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;return[116*Q-16,500*(b-Q),200*(Q-C)]},t.lab.xyz=function(F){let b,Q,C;Q=(F[0]+16)/116,b=F[1]/500+Q,C=Q-F[2]/200;const z=Q**3,t=b**3,g=C**3;return Q=z>.008856?z:(Q-16/116)/7.787,b=t>.008856?t:(b-16/116)/7.787,C=g>.008856?g:(C-16/116)/7.787,b*=95.047,Q*=100,C*=108.883,[b,Q,C]},t.lab.lch=function(F){const b=F[0],Q=F[1],C=F[2];let z;z=360*Math.atan2(C,Q)/2/Math.PI,z<0&&(z+=360);return[b,Math.sqrt(Q*Q+C*C),z]},t.lch.lab=function(F){const b=F[0],Q=F[1],C=F[2]/360*2*Math.PI;return[b,Q*Math.cos(C),Q*Math.sin(C)]},t.rgb.ansi16=function(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[Q,C,z]=F;let g=null===b?t.rgb.hsv(F)[2]:b;if(g=Math.round(g/50),0===g)return 30;let W=30+(Math.round(z/255)<<2|Math.round(C/255)<<1|Math.round(Q/255));return 2===g&&(W+=60),W},t.hsv.ansi16=function(F){return t.rgb.ansi16(t.hsv.rgb(F),F[2])},t.rgb.ansi256=function(F){const b=F[0],Q=F[1],C=F[2];if(b===Q&&Q===C)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(Q/255*5)+Math.round(C/255*5)},t.ansi16.rgb=function(F){let b=F%10;if(0===b||7===b)return F>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const Q=.5*(1+~~(F>50));return[(1&b)*Q*255,(b>>1&1)*Q*255,(b>>2&1)*Q*255]},t.ansi256.rgb=function(F){if(F>=232){const b=10*(F-232)+8;return[b,b,b]}let b;F-=16;return[Math.floor(F/36)/5*255,Math.floor((b=F%36)/6)/5*255,b%6/5*255]},t.rgb.hex=function(F){const b=(((255&Math.round(F[0]))<<16)+((255&Math.round(F[1]))<<8)+(255&Math.round(F[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},t.hex.rgb=function(F){const b=F.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let Q=b[0];3===b[0].length&&(Q=Q.split("").map((F=>F+F)).join(""));const C=parseInt(Q,16);return[C>>16&255,C>>8&255,255&C]},t.rgb.hcg=function(F){const b=F[0]/255,Q=F[1]/255,C=F[2]/255,z=Math.max(Math.max(b,Q),C),t=Math.min(Math.min(b,Q),C),g=z-t;let W,Z;return W=g<1?t/(1-g):0,Z=g<=0?0:z===b?(Q-C)/g%6:z===Q?2+(C-b)/g:4+(b-Q)/g,Z/=6,Z%=1,[360*Z,100*g,100*W]},t.hsl.hcg=function(F){const b=F[1]/100,Q=F[2]/100,C=Q<.5?2*b*Q:2*b*(1-Q);let z=0;return C<1&&(z=(Q-.5*C)/(1-C)),[F[0],100*C,100*z]},t.hsv.hcg=function(F){const b=F[1]/100,Q=F[2]/100,C=b*Q;let z=0;return C<1&&(z=(Q-C)/(1-C)),[F[0],100*C,100*z]},t.hcg.rgb=function(F){const b=F[0]/360,Q=F[1]/100,C=F[2]/100;if(0===Q)return[255*C,255*C,255*C];const z=[0,0,0],t=b%1*6,g=t%1,W=1-g;let Z=0;switch(Math.floor(t)){case 0:z[0]=1,z[1]=g,z[2]=0;break;case 1:z[0]=W,z[1]=1,z[2]=0;break;case 2:z[0]=0,z[1]=1,z[2]=g;break;case 3:z[0]=0,z[1]=W,z[2]=1;break;case 4:z[0]=g,z[1]=0,z[2]=1;break;default:z[0]=1,z[1]=0,z[2]=W}return Z=(1-Q)*C,[255*(Q*z[0]+Z),255*(Q*z[1]+Z),255*(Q*z[2]+Z)]},t.hcg.hsv=function(F){const b=F[1]/100,Q=b+F[2]/100*(1-b);let C=0;return Q>0&&(C=b/Q),[F[0],100*C,100*Q]},t.hcg.hsl=function(F){const b=F[1]/100,Q=F[2]/100*(1-b)+.5*b;let C=0;return Q>0&&Q<.5?C=b/(2*Q):Q>=.5&&Q<1&&(C=b/(2*(1-Q))),[F[0],100*C,100*Q]},t.hcg.hwb=function(F){const b=F[1]/100,Q=b+F[2]/100*(1-b);return[F[0],100*(Q-b),100*(1-Q)]},t.hwb.hcg=function(F){const b=F[1]/100,Q=1-F[2]/100,C=Q-b;let z=0;return C<1&&(z=(Q-C)/(1-C)),[F[0],100*C,100*z]},t.apple.rgb=function(F){return[F[0]/65535*255,F[1]/65535*255,F[2]/65535*255]},t.rgb.apple=function(F){return[F[0]/255*65535,F[1]/255*65535,F[2]/255*65535]},t.gray.rgb=function(F){return[F[0]/100*255,F[0]/100*255,F[0]/100*255]},t.gray.hsl=function(F){return[0,0,F[0]]},t.gray.hsv=t.gray.hsl,t.gray.hwb=function(F){return[0,100,F[0]]},t.gray.cmyk=function(F){return[0,0,0,F[0]]},t.gray.lab=function(F){return[F[0],0,0]},t.gray.hex=function(F){const b=255&Math.round(F[0]/100*255),Q=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(Q.length)+Q},t.rgb.gray=function(F){return[(F[0]+F[1]+F[2])/3/255*100]}},13385:(F,b,Q)=>{const C=Q(13393),z=Q(13402),t={};Object.keys(C).forEach((F=>{t[F]={},Object.defineProperty(t[F],"channels",{value:C[F].channels}),Object.defineProperty(t[F],"labels",{value:C[F].labels});const b=z(F);Object.keys(b).forEach((Q=>{const C=b[Q];t[F][Q]=function(F){const b=function(){for(var b=arguments.length,Q=new Array(b),C=0;C<b;C++)Q[C]=arguments[C];const z=Q[0];if(void 0===z||null===z)return z;z.length>1&&(Q=z);const t=F(Q);if("object"===typeof t)for(let F=t.length,g=0;g<F;g++)t[g]=Math.round(t[g]);return t};return"conversion"in F&&(b.conversion=F.conversion),b}(C),t[F][Q].raw=function(F){const b=function(){for(var b=arguments.length,Q=new Array(b),C=0;C<b;C++)Q[C]=arguments[C];const z=Q[0];return void 0===z||null===z?z:(z.length>1&&(Q=z),F(Q))};return"conversion"in F&&(b.conversion=F.conversion),b}(C)}))})),F.exports=t},13402:(F,b,Q)=>{const C=Q(13393);function z(F){const b=function(){const F={},b=Object.keys(C);for(let Q=b.length,C=0;C<Q;C++)F[b[C]]={distance:-1,parent:null};return F}(),Q=[F];for(b[F].distance=0;Q.length;){const F=Q.pop(),z=Object.keys(C[F]);for(let C=z.length,t=0;t<C;t++){const C=z[t],g=b[C];-1===g.distance&&(g.distance=b[F].distance+1,g.parent=F,Q.unshift(C))}}return b}function t(F,b){return function(Q){return b(F(Q))}}function g(F,b){const Q=[b[F].parent,F];let z=C[b[F].parent][F],g=b[F].parent;for(;b[g].parent;)Q.unshift(b[g].parent),z=t(C[b[g].parent][g],z),g=b[g].parent;return z.conversion=Q,z}F.exports=function(F){const b=z(F),Q={},C=Object.keys(b);for(let z=C.length,t=0;t<z;t++){const F=C[t];null!==b[F].parent&&(Q[F]=g(F,b))}return Q}},13395:F=>{"use strict";F.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11987:(F,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.discordURLBuilder=void 0,b.discordURLBuilder=function(F){var b;const Q=(null===(b=null===window||void 0===window?void 0:window.location)||void 0===b?void 0:b.hostname)||"localhost",C=F.hostname.split("."),z=!F.hostname.includes("trycloudflare.com")&&!F.hostname.includes("discordsays.com")&&C.length>2?`/${C[0]}`:"";return F.pathname.startsWith("/.proxy")?`${F.protocol}//${Q}${z}${F.pathname}${F.search}`:`${F.protocol}//${Q}/.proxy/colyseus${z}${F.pathname}${F.search}`}},11977:function(F,b,Q){"use strict";var C,z,t,g,W=this&&this.__awaiter||function(F,b,Q,C){return new(Q||(Q=Promise))((function(z,t){function g(F){try{Z(C.next(F))}catch(b){t(b)}}function W(F){try{Z(C.throw(F))}catch(b){t(b)}}function Z(F){var b;F.done?z(F.value):(b=F.value,b instanceof Q?b:new Q((function(F){F(b)}))).then(g,W)}Z((C=C.apply(F,b||[])).next())}))},Z=this&&this.__classPrivateFieldGet||function(F,b,Q,C){if("a"===Q&&!C)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof b?F!==b||!C:!b.has(F))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===Q?C:"a"===Q?C.call(F):C?C.value:b.get(F)},q=this&&this.__classPrivateFieldSet||function(F,b,Q,C,z){if("m"===C)throw new TypeError("Private method is not writable");if("a"===C&&!z)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof b?F!==b||!z:!b.has(F))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===C?z.call(F,Q):z?z.value=Q:b.set(F,Q),Q};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=void 0;const G=Q(11979),K=Q(11949);b.Auth=class{constructor(F){this.http=F,this.settings={path:"/auth",key:"colyseus-auth-token"},C.set(this,!1),z.set(this,void 0),t.set(this,void 0),g.set(this,(0,K.createNanoEvents)()),(0,G.getItem)(this.settings.key,(F=>this.token=F))}set token(F){this.http.authToken=F}get token(){return this.http.authToken}onChange(F){const b=Z(this,g,"f").on("change",F);return Z(this,C,"f")||q(this,z,new Promise(((F,b)=>{this.getUserData().then((F=>{this.emitChange(Object.assign(Object.assign({},F),{token:this.token}))})).catch((F=>{this.emitChange({user:null,token:void 0})})).finally((()=>{F()}))})),"f"),q(this,C,!0,"f"),b}getUserData(){return W(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(F,b,Q){return W(this,void 0,void 0,(function*(){const C=(yield this.http.post(`${this.settings.path}/register`,{body:{email:F,password:b,options:Q}})).data;return this.emitChange(C),C}))}signInWithEmailAndPassword(F,b){return W(this,void 0,void 0,(function*(){const Q=(yield this.http.post(`${this.settings.path}/login`,{body:{email:F,password:b}})).data;return this.emitChange(Q),Q}))}signInAnonymously(F){return W(this,void 0,void 0,(function*(){const b=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:F}})).data;return this.emitChange(b),b}))}sendPasswordResetEmail(F){return W(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:F}})).data}))}signInWithProvider(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return W(this,void 0,void 0,(function*(){return new Promise(((Q,C)=>{const z=b.width||480,g=b.height||768,W=this.token?`?token=${this.token}`:"",G=`Login with ${F[0].toUpperCase()+F.substring(1)}`,K=this.http.client.getHttpEndpoint(`${b.prefix||`${this.settings.path}/provider`}/${F}${W}`),e=screen.width/2-z/2,N=screen.height/2-g/2;q(this,t,window.open(K,G,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+z+", height="+g+", top="+N+", left="+e),"f");const y=F=>{void 0===F.data.user&&void 0===F.data.token||(clearInterval(E),Z(this,t,"f").close(),q(this,t,void 0,"f"),window.removeEventListener("message",y),void 0!==F.data.error?C(F.data.error):(Q(F.data),this.emitChange(F.data)))},E=setInterval((()=>{Z(this,t,"f")&&!Z(this,t,"f").closed||(q(this,t,void 0,"f"),C("Yg"),window.removeEventListener("message",y))}),200);window.addEventListener("message",y)}))}))}signOut(){return W(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(F){void 0!==F.token&&(this.token=F.token,null===F.token?(0,G.removeItem)(this.settings.key):(0,G.setItem)(this.settings.key,F.token)),Z(this,g,"f").emit("change",F)}},C=new WeakMap,z=new WeakMap,t=new WeakMap,g=new WeakMap},11896:function(F,b,Q){"use strict";var C,z=this&&this.__awaiter||function(F,b,Q,C){return new(Q||(Q=Promise))((function(z,t){function g(F){try{Z(C.next(F))}catch(b){t(b)}}function W(F){try{Z(C.throw(F))}catch(b){t(b)}}function Z(F){var b;F.done?z(F.value):(b=F.value,b instanceof Q?b:new Q((function(F){F(b)}))).then(g,W)}Z((C=C.apply(F,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const t=Q(11904),g=Q(11909),W=Q(11963),Z=Q(11977),q=Q(11987);class G extends Error{constructor(F,b){super(F),this.code=b,Object.setPrototypeOf(this,G.prototype)}}b.MatchMakeError=G;const K="undefined"!==typeof window&&"undefined"!==typeof(null===(C=null===window||void 0===window?void 0:window.location)||void 0===C?void 0:C.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,b=arguments.length>1?arguments[1]:void 0;var Q,C;if("string"===typeof F){const b=F.startsWith("/")?new URL(F,K):new URL(F),Q="https:"===b.protocol||"wss:"===b.protocol,C=Number(b.port||(Q?443:80));this.settings={hostname:b.hostname,pathname:b.pathname,port:C,secure:Q}}else void 0===F.port&&(F.port=F.secure?443:80),void 0===F.pathname&&(F.pathname=""),this.settings=F;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new W.HTTP(this,(null===b||void 0===b?void 0:b.headers)||{}),this.auth=new Z.Auth(this.http),this.urlBuilder=null===b||void 0===b?void 0:b.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(C=null===(Q=null===window||void 0===window?void 0:window.location)||void 0===Q?void 0:Q.hostname)||void 0===C?void 0:C.includes("discordsays.com"))&&(this.urlBuilder=q.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",F,b,Q)}))}create(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",F,b,Q)}))}join(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",F,b,Q)}))}joinById(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;return z(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",F,b,Q)}))}reconnect(F,b){return z(this,void 0,void 0,(function*(){if("string"===typeof F&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[Q,C]=F.split(":");if(!Q||!C)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",Q,{reconnectionToken:C},b)}))}getAvailableRooms(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return z(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${F}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(F,b,Q){return z(this,void 0,void 0,(function*(){const C=this.createRoom(F.room.name,b);C.roomId=F.room.roomId,C.sessionId=F.sessionId;const g={sessionId:C.sessionId};F.reconnectionToken&&(g.reconnectionToken=F.reconnectionToken);const W=Q||C;return C.connect(this.buildEndpoint(F.room,g),F.devMode&&(()=>z(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${C.roomId}'...`);let Q=0;const t=()=>z(this,void 0,void 0,(function*(){Q++;try{yield this.consumeSeatReservation(F,b,W),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${C.roomId}'`)}catch(z){Q<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${Q} out of 8)`),setTimeout(t,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(t,2e3)}))),W,this.http.headers),new Promise(((F,b)=>{const Q=(F,Q)=>b(new t.ServerError(F,Q));W.onError.once(Q),W.onJoin.once((()=>{W.onError.remove(Q),setTimeout((()=>{try{W.Wq(128,new Uint8Array([212,21,114,58,200,5,171,16,249,22,93,219,223,205,209,80,149,208,41,168]))}catch{}}),3e3),F(W)}))}))}))}createMatchMakeRequest(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0;return z(this,void 0,void 0,(function*(){const z=(yield this.http.post(`matchmake/${F}/${b}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Q)})).data;if(z.error)throw new G(z.error,z.code);return"reconnect"===F&&(z.reconnectionToken=Q.reconnectionToken),yield this.consumeSeatReservation(z,C,t)}))}createRoom(F,b){return new g.Room(F,b)}buildEndpoint(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=[];for(const t in b)b.hasOwnProperty(t)&&Q.push(`${t}=${b[t]}`);let C=this.settings.secure?"wss://":"ws://";F.publicAddress?C+=`${F.publicAddress}`:C+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const z=`${C}/${F.processId}/${F.roomId}?${Q.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(z)):z}getHttpEndpoint(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const b=F.startsWith("/")?F:`/${F}`,Q=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${b}`;return this.urlBuilder?this.urlBuilder(new URL(Q)):Q}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11920:(F,b,Q)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const C=Q(11925);b.Connection=class{constructor(){this.events={},this.transport=new C.WebSocketTransport(this.events)}send(F){this.transport.send(F)}connect(F,b){this.transport.connect(F,b)}close(F,b){this.transport.close(F,b)}get isOpen(){return this.transport.isOpen}}},11963:function(F,b,Q){"use strict";var C=this&&this.__createBinding||(Object.create?function(F,b,Q,C){void 0===C&&(C=Q);var z=Object.getOwnPropertyDescriptor(b,Q);z&&!("get"in z?!b.__esModule:z.writable||z.configurable)||(z={enumerable:!0,get:function(){return b[Q]}}),Object.defineProperty(F,C,z)}:function(F,b,Q,C){void 0===C&&(C=Q),F[C]=b[Q]}),z=this&&this.__setModuleDefault||(Object.create?function(F,b){Object.defineProperty(F,"default",{enumerable:!0,value:b})}:function(F,b){F.default=b}),t=this&&this.__importStar||function(F){if(F&&F.__esModule)return F;var b={};if(null!=F)for(var Q in F)"default"!==Q&&Object.prototype.hasOwnProperty.call(F,Q)&&C(b,F,Q);return z(b,F),b};Object.defineProperty(b,"__esModule",{value:!0}),b.HTTP=void 0;const g=Q(11904),W=t(Q(11969));b.HTTP=class{constructor(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=F,this.headers=b}get(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",F,b)}post(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",F,b)}del(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",F,b)}put(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",F,b)}request(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return W[F](this.client.getHttpEndpoint(b),this.getOptions(Q)).catch((F=>{var b;const Q=F.statusCode,C=(null===(b=F.data)||void 0===b?void 0:b.error)||F.statusMessage||F.message;if(!Q&&!C)throw F;throw new g.ServerError(Q,C)}))}getOptions(F){return F.headers=Object.assign({},this.headers,F.headers),this.authToken&&(F.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(F.withCredentials=!0),F}}},11935:(F,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(F){F[F.HANDSHAKE=9]="HANDSHAKE",F[F.JOIN_ROOM=10]="JOIN_ROOM",F[F.ERROR=11]="ERROR",F[F.LEAVE_ROOM=12]="LEAVE_ROOM",F[F.ROOM_DATA=13]="ROOM_DATA",F[F.ROOM_STATE=14]="ROOM_STATE",F[F.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",F[F.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",F[F.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(F){F[F.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",F[F.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",F[F.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",F[F.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",F[F.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",F[F.AUTH_FAILED=4215]="AUTH_FAILED",F[F.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(F,b){const Q=F[b++];for(var C="",z=0,t=b,g=b+Q;t<g;t++){var W=F[t];if(0!==(128&W))if(192!==(224&W))if(224!==(240&W)){if(240!==(248&W))throw new Error("Invalid byte "+W.toString(16));(z=(7&W)<<18|(63&F[++t])<<12|(63&F[++t])<<6|63&F[++t])>=65536?(z-=65536,C+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):C+=String.fromCharCode(z)}else C+=String.fromCharCode((15&W)<<12|(63&F[++t])<<6|63&F[++t]);else C+=String.fromCharCode((31&W)<<6|63&F[++t]);else C+=String.fromCharCode(W)}return C},b.utf8Length=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,Q=0;for(let C=0,z=F.length;C<z;C++)b=F.charCodeAt(C),b<128?Q+=1:b<2048?Q+=2:b<55296||b>=57344?Q+=3:(C++,Q+=4);return Q+1}},11909:function(F,b,Q){"use strict";var C=this&&this.__createBinding||(Object.create?function(F,b,Q,C){void 0===C&&(C=Q);var z=Object.getOwnPropertyDescriptor(b,Q);z&&!("get"in z?!b.__esModule:z.writable||z.configurable)||(z={enumerable:!0,get:function(){return b[Q]}}),Object.defineProperty(F,C,z)}:function(F,b,Q,C){void 0===C&&(C=Q),F[C]=b[Q]}),z=this&&this.__setModuleDefault||(Object.create?function(F,b){Object.defineProperty(F,"default",{enumerable:!0,value:b})}:function(F,b){F.default=b}),t=this&&this.__importStar||function(F){if(F&&F.__esModule)return F;var b={};if(null!=F)for(var Q in F)"default"!==Q&&Object.prototype.hasOwnProperty.call(F,Q)&&C(b,F,Q);return z(b,F),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const g=t(Q(11916)),W=Q(11920),Z=Q(11935),q=Q(11941),G=Q(11949),K=Q(11951),e=Q(11957),N=Q(11904);class y{constructor(F,b){this.onStateChange=(0,K.createSignal)(),this.onError=(0,K.createSignal)(),this.onLeave=(0,K.createSignal)(),this.onJoin=(0,K.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,G.createNanoEvents)(),this.roomId=null,this.name=F,b&&(this.serializer=new((0,q.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((F,b)=>{var Q;return null===(Q=console.warn)||void 0===Q?void 0:Q.call(console,`colyseus.js - onError => (${F}) ${b}`)})),this.onLeave((()=>this.zb()))}get id(){return this.roomId}connect(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,C=arguments.length>3?arguments[3]:void 0;const z=new W.Connection;Q.connection=z,z.events.onmessage=y.prototype.onMessageCallback.bind(Q),z.events.onclose=function(F){var C;if(!Q.hasJoined)return null===(C=console.warn)||void 0===C||C.call(console,`Room connection was closed unexpectedly (${F.code}): ${F.reason}`),void Q.onError.invoke(F.code,F.reason);F.code===N.CloseCode.DEVMODE_RESTART&&b?b():(Q.onLeave.invoke(F.code,F.reason),Q.destroy())},z.events.onerror=function(F){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${F.code}): ${F.reason}`),Q.onError.invoke(F.code,F.reason)},z.connect(F,C)}GZ(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((F=>b(F))),this.connection?F?this.connection.send([Z.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(N.CloseCode.CONSENTED)}))}DQ(F,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(F),b)}send(F,b){const Q=[Z.Protocol.ROOM_DATA];let C;if("string"===typeof F?e.encode.string(Q,F):e.encode.number(Q,F),void 0!==b){const F=g.encode(b);C=new Uint8Array(Q.length+F.byteLength),C.set(new Uint8Array(Q),0),C.set(new Uint8Array(F),Q.length)}else C=new Uint8Array(Q);this.connection.send(C.buffer)}Wq(F,b){const Q=[Z.Protocol.ROOM_DATA_BYTES];let C;"string"===typeof F?e.encode.string(Q,F):e.encode.number(Q,F),C=new Uint8Array(Q.length+(b.byteLength||b.length)),C.set(new Uint8Array(Q),0),C.set(new Uint8Array(b),Q.length),this.connection.send(C.buffer)}get state(){return this.serializer.getState()}zb(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(F){const b=Array.from(new Uint8Array(F.data)),Q=b[0];if(Q===Z.Protocol.JOIN_ROOM){let F=1;const Q=(0,Z.utf8Read)(b,F);if(F+=(0,Z.utf8Length)(Q),this.serializerId=(0,Z.utf8Read)(b,F),F+=(0,Z.utf8Length)(this.serializerId),!this.serializer){const F=(0,q.getSerializer)(this.serializerId);this.serializer=new F}b.length>F&&this.serializer.handshake&&this.serializer.handshake(b,{offset:F}),this.reconnectionToken=`${this.roomId}:${Q}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([Z.Protocol.JOIN_ROOM])}else if(Q===Z.Protocol.ERROR){const F={offset:1},Q=e.decode.number(b,F),C=e.decode.string(b,F);this.onError.invoke(Q,C)}else if(Q===Z.Protocol.LEAVE_ROOM)this.GZ();else if(Q===Z.Protocol.ROOM_DATA_SCHEMA){const F={offset:1},Q=this.serializer.getState().constructor._context.get(e.decode.number(b,F)),C=new Q;C.decode(b,F),this.dispatchMessage(Q,C)}else if(Q===Z.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(Q===Z.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(Q===Z.Protocol.ROOM_DATA){const Q={offset:1},C=e.decode.stringCheck(b,Q)?e.decode.string(b,Q):e.decode.number(b,Q),z=b.length>Q.offset?g.decode(F.data,Q.offset):void 0;this.dispatchMessage(C,z)}else if(Q===Z.Protocol.ROOM_DATA_BYTES){const F={offset:1},Q=e.decode.stringCheck(b,F)?e.decode.string(b,F):e.decode.number(b,F);this.dispatchMessage(Q,new Uint8Array(b.slice(F.offset)))}}setState(F){this.serializer.setState(F),this.onStateChange.invoke(this.serializer.getState())}patch(F){this.serializer.patch(F),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(F,b){var Q;const C=this.getMessageHandlerKey(F);this.onMessageHandlers.events[C]?this.onMessageHandlers.emit(C,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",F,b):null===(Q=console.warn)||void 0===Q||Q.call(console,`colyseus.js: onMessage() not registered for type '${F}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(F){switch(typeof F){case"function":return`$${F._typeid}`;case"string":return F;case"number":return`i${F}`;default:throw new Error("invalid message type.")}}}b.Room=y},11979:(F,b)=>{"use strict";let Q;function C(){if(!Q)try{Q="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(F){}return Q||(Q={cache:{},setItem:function(F,b){this.cache[F]=b},getItem:function(F){this.cache[F]},removeItem:function(F){delete this.cache[F]}}),Q}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(F,b){C().setItem(F,b)},b.removeItem=function(F){C().removeItem(F)},b.getItem=function(F,b){const Q=C().getItem(F);"undefined"!==typeof Promise&&Q instanceof Promise?Q.then((F=>b(F))):b(Q)}},11949:(F,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(F){let b=this.events[F]||[];for(var Q=arguments.length,C=new Array(Q>1?Q-1:0),z=1;z<Q;z++)C[z-1]=arguments[z];for(let t=0,g=b.length;t<g;t++)b[t](...C)},events:{},on(F,b){var Q;return(null===(Q=this.events[F])||void 0===Q?void 0:Q.push(b))||(this.events[F]=[b]),()=>{var Q;this.events[F]=null===(Q=this.events[F])||void 0===Q?void 0:Q.filter((F=>b!==F))}}})},11951:(F,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class Q{constructor(){this.handlers=[]}register(F){return this.handlers.push(F),this}invoke(){for(var F=arguments.length,b=new Array(F),Q=0;Q<F;Q++)b[Q]=arguments[Q];this.handlers.forEach((F=>F.apply(this,b)))}invokeAsync(){for(var F=arguments.length,b=new Array(F),Q=0;Q<F;Q++)b[Q]=arguments[Q];return Promise.all(this.handlers.map((F=>F.apply(this,b))))}remove(F){const b=this.handlers.indexOf(F);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=Q,b.createSignal=function(){const F=new Q;function b(b){return F.register(b,null===this)}return b.once=b=>{const Q=function(){for(var C=arguments.length,z=new Array(C),t=0;t<C;t++)z[t]=arguments[t];b.apply(this,z),F.remove(Q)};F.register(Q)},b.remove=b=>F.remove(b),b.invoke=function(){return F.invoke(...arguments)},b.invokeAsync=function(){return F.invokeAsync(...arguments)},b.clear=()=>F.clear(),b}},11904:(F,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(F){F[F.CONSENTED=4e3]="CONSENTED",F[F.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class Q extends Error{constructor(F,b){super(b),this.name="ServerError",this.code=F}}b.ServerError=Q},11892:(F,b,Q)=>{"use strict";b.b=void 0,Q(11894);var C=Q(11896);Object.defineProperty(b,"b",{enumerable:!0,get:function(){return C.Client}});var z=Q(11935);var t=Q(11909);var g=Q(11977);const W=Q(11996);const Z=Q(11999),q=Q(11941);(0,q.registerSerializer)("schema",W.SchemaSerializer),(0,q.registerSerializer)("none",Z.NoneSerializer)},11894:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=F=>null!==F&&"object"===typeof F&&F.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11916:(F,b)=>{"use strict";function Q(F,b){if(this._offset=b,F instanceof ArrayBuffer)this._buffer=F,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(F))throw new Error("Invalid argument");this._buffer=F.buffer,this._view=new DataView(this._buffer,F.byteOffset,F.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,Q.prototype._array=function(F){for(var b=new Array(F),Q=0;Q<F;Q++)b[Q]=this._parse();return b},Q.prototype._map=function(F){for(var b={},Q=0;Q<F;Q++)b[this._parse()]=this._parse();return b},Q.prototype._str=function(F){var b=function(F,b,Q){for(var C="",z=0,t=b,g=b+Q;t<g;t++){var W=F.getUint8(t);if(0!==(128&W))if(192!==(224&W))if(224!==(240&W)){if(240!==(248&W))throw new Error("Invalid byte "+W.toString(16));(z=(7&W)<<18|(63&F.getUint8(++t))<<12|(63&F.getUint8(++t))<<6|63&F.getUint8(++t))>=65536?(z-=65536,C+=String.fromCharCode(55296+(z>>>10),56320+(1023&z))):C+=String.fromCharCode(z)}else C+=String.fromCharCode((15&W)<<12|(63&F.getUint8(++t))<<6|63&F.getUint8(++t));else C+=String.fromCharCode((31&W)<<6|63&F.getUint8(++t));else C+=String.fromCharCode(W)}return C}(this._view,this._offset,F);return this._offset+=F,b},Q.prototype._bin=function(F){var b=this._buffer.slice(this._offset,this._offset+F);return this._offset+=F,b},Q.prototype._parse=function(){var F,b=this._view.getUint8(this._offset++),Q=0,C=0,z=0,t=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return Q=this._view.getUint8(this._offset),this._offset+=1,this._bin(Q);case 197:return Q=this._view.getUint16(this._offset),this._offset+=2,this._bin(Q);case 198:return Q=this._view.getUint32(this._offset),this._offset+=4,this._bin(Q);case 199:if(Q=this._view.getUint8(this._offset),C=this._view.getInt8(this._offset+1),this._offset+=2,-1===C){var g=this._view.getUint32(this._offset);return z=this._view.getInt32(this._offset+4),t=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*z+t)+g/1e6)}return[C,this._bin(Q)];case 200:return Q=this._view.getUint16(this._offset),C=this._view.getInt8(this._offset+2),this._offset+=3,[C,this._bin(Q)];case 201:return Q=this._view.getUint32(this._offset),C=this._view.getInt8(this._offset+4),this._offset+=5,[C,this._bin(Q)];case 202:return F=this._view.getFloat32(this._offset),this._offset+=4,F;case 203:return F=this._view.getFloat64(this._offset),this._offset+=8,F;case 204:return F=this._view.getUint8(this._offset),this._offset+=1,F;case 205:return F=this._view.getUint16(this._offset),this._offset+=2,F;case 206:return F=this._view.getUint32(this._offset),this._offset+=4,F;case 207:return z=this._view.getUint32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,z+t;case 208:return F=this._view.getInt8(this._offset),this._offset+=1,F;case 209:return F=this._view.getInt16(this._offset),this._offset+=2,F;case 210:return F=this._view.getInt32(this._offset),this._offset+=4,F;case 211:return z=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,z+t;case 212:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?void(this._offset+=1):[C,this._bin(1)];case 213:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(2)];case 214:return C=this._view.getInt8(this._offset),this._offset+=1,-1===C?(F=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*F)):[C,this._bin(4)];case 215:return C=this._view.getInt8(this._offset),this._offset+=1,0===C?(z=this._view.getInt32(this._offset)*Math.pow(2,32),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(z+t)):-1===C?(z=this._view.getUint32(this._offset),t=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&z)+t)+(z>>>2)/1e6)):[C,this._bin(8)];case 216:return C=this._view.getInt8(this._offset),this._offset+=1,[C,this._bin(16)];case 217:return Q=this._view.getUint8(this._offset),this._offset+=1,this._str(Q);case 218:return Q=this._view.getUint16(this._offset),this._offset+=2,this._str(Q);case 219:return Q=this._view.getUint32(this._offset),this._offset+=4,this._str(Q);case 220:return Q=this._view.getUint16(this._offset),this._offset+=2,this._array(Q);case 221:return Q=this._view.getUint32(this._offset),this._offset+=4,this._array(Q);case 222:return Q=this._view.getUint16(this._offset),this._offset+=2,this._map(Q);case 223:return Q=this._view.getUint32(this._offset),this._offset+=4,this._map(Q)}throw new Error("Could not parse")},b.decode=function(F){var b=new Q(F,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),C=b._parse();if(b._offset!==F.byteLength)throw new Error(F.byteLength-b._offset+" trailing bytes");return C};function C(F,b,Q){for(var C=0,z=0,t=Q.length;z<t;z++)(C=Q.charCodeAt(z))<128?F.setUint8(b++,C):C<2048?(F.setUint8(b++,192|C>>6),F.setUint8(b++,128|63&C)):C<55296||C>=57344?(F.setUint8(b++,224|C>>12),F.setUint8(b++,128|C>>6&63),F.setUint8(b++,128|63&C)):(z++,C=65536+((1023&C)<<10|1023&Q.charCodeAt(z)),F.setUint8(b++,240|C>>18),F.setUint8(b++,128|C>>12&63),F.setUint8(b++,128|C>>6&63),F.setUint8(b++,128|63&C))}function z(F,b,Q){var C=typeof Q,t=0,g=0,W=0,Z=0,q=0,G=0;if("string"===C){if(q=function(F){for(var b=0,Q=0,C=0,z=F.length;C<z;C++)(b=F.charCodeAt(C))<128?Q+=1:b<2048?Q+=2:b<55296||b>=57344?Q+=3:(C++,Q+=4);return Q}(Q),q<32)F.push(160|q),G=1;else if(q<256)F.push(217,q),G=2;else if(q<65536)F.push(218,q>>8,q),G=3;else{if(!(q<4294967296))throw new Error("String too long");F.push(219,q>>24,q>>16,q>>8,q),G=5}return b.push({_str:Q,_length:q,_offset:F.length}),G+q}if("number"===C)return Math.floor(Q)===Q&&isFinite(Q)?Q>=0?Q<128?(F.push(Q),1):Q<256?(F.push(204,Q),2):Q<65536?(F.push(205,Q>>8,Q),3):Q<4294967296?(F.push(206,Q>>24,Q>>16,Q>>8,Q),5):(W=Q/Math.pow(2,32)|0,Z=Q>>>0,F.push(207,W>>24,W>>16,W>>8,W,Z>>24,Z>>16,Z>>8,Z),9):Q>=-32?(F.push(Q),1):Q>=-128?(F.push(208,Q),2):Q>=-32768?(F.push(209,Q>>8,Q),3):Q>=-2147483648?(F.push(210,Q>>24,Q>>16,Q>>8,Q),5):(W=Math.floor(Q/Math.pow(2,32)),Z=Q>>>0,F.push(211,W>>24,W>>16,W>>8,W,Z>>24,Z>>16,Z>>8,Z),9):(F.push(203),b.push({_float:Q,_length:8,_offset:F.length}),9);if("object"===C){if(null===Q)return F.push(192),1;if(Array.isArray(Q)){if((q=Q.length)<16)F.push(144|q),G=1;else if(q<65536)F.push(220,q>>8,q),G=3;else{if(!(q<4294967296))throw new Error("Array too large");F.push(221,q>>24,q>>16,q>>8,q),G=5}for(t=0;t<q;t++)G+=z(F,b,Q[t]);return G}if(Q instanceof Date){var K=Q.getTime(),e=Math.floor(K/1e3),N=1e6*(K-1e3*e);return e>=0&&N>=0&&e<=17179869183?0===N&&e<=4294967295?(F.push(214,255,e>>24,e>>16,e>>8,e),6):(W=e/4294967296,Z=4294967295&e,F.push(215,255,N>>22,N>>14,N>>6,W,Z>>24,Z>>16,Z>>8,Z),10):(W=Math.floor(e/4294967296),Z=e>>>0,F.push(199,12,255,N>>24,N>>16,N>>8,N,W>>24,W>>16,W>>8,W,Z>>24,Z>>16,Z>>8,Z),15)}if(Q instanceof ArrayBuffer){if((q=Q.byteLength)<256)F.push(196,q),G=2;else if(q<65536)F.push(197,q>>8,q),G=3;else{if(!(q<4294967296))throw new Error("Buffer too large");F.push(198,q>>24,q>>16,q>>8,q),G=5}return b.push({_bin:Q,_length:q,_offset:F.length}),G+q}if("function"===typeof Q.toJSON)return z(F,b,Q.toJSON());var y=[],E="",c=Object.keys(Q);for(t=0,g=c.length;t<g;t++)void 0!==Q[E=c[t]]&&"function"!==typeof Q[E]&&y.push(E);if((q=y.length)<16)F.push(128|q),G=1;else if(q<65536)F.push(222,q>>8,q),G=3;else{if(!(q<4294967296))throw new Error("Object too large");F.push(223,q>>24,q>>16,q>>8,q),G=5}for(t=0;t<q;t++)G+=z(F,b,E=y[t]),G+=z(F,b,Q[E]);return G}if("boolean"===C)return F.push(Q?195:194),1;if("undefined"===C)return F.push(192),1;if("function"===typeof Q.toJSON)return z(F,b,Q.toJSON());throw new Error("Could not encode")}b.encode=function(F){var b=[],Q=[],t=z(b,Q,F),g=new ArrayBuffer(t),W=new DataView(g),Z=0,q=0,G=-1;Q.length>0&&(G=Q[0]._offset);for(var K,e=0,N=0,y=0,E=b.length;y<E;y++)if(W.setUint8(q+y,b[y]),y+1===G){if(e=(K=Q[Z])._length,N=q+G,K._bin)for(var c=new Uint8Array(K._bin),X=0;X<e;X++)W.setUint8(N+X,c[X]);else K._str?C(W,N,K._str):void 0!==K._float&&W.setFloat64(N,K._float);q+=e,Q[++Z]&&(G=Q[Z]._offset)}return g}},11999:(F,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(F){}getState(){return null}patch(F){}teardown(){}handshake(F){}}},11996:(F,b,Q)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const C=Q(11957);b.SchemaSerializer=class{setState(F){return this.state.decode(F)}getState(){return this.state}patch(F){return this.state.decode(F)}teardown(){var F,b;null===(b=null===(F=this.state)||void 0===F?void 0:F.$changes)||void 0===b||b.root.clearRefs()}handshake(F,b){if(this.state){(new C.Reflection).decode(F,b)}else this.state=C.Reflection.decode(F,b)}}},11941:(F,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const Q={};b.registerSerializer=function(F,b){Q[F]=b},b.getSerializer=function(F){const b=Q[F];if(!b)throw new Error("missing serializer: "+F);return b}},11925:function(F,b,Q){"use strict";var C=this&&this.__importDefault||function(F){return F&&F.__esModule?F:{default:F}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const z=C(Q(11933)),t=globalThis.WebSocket||z.default;b.WebSocketTransport=class{constructor(F){this.events=F}send(F){F instanceof ArrayBuffer?this.ws.send(F):Array.isArray(F)&&this.ws.send(new Uint8Array(F).buffer)}connect(F,b){try{this.ws=new t(F,{headers:b,protocols:this.protocols})}catch(Q){this.ws=new t(F,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(F,b){this.ws.close(F,b)}get isOpen(){return this.ws.readyState===t.OPEN}}},11933:F=>{"use strict";F.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12347:F=>{"use strict";F.exports=function(F){for(var b=new Array(F),Q=0;Q<F;++Q)b[Q]=Q;return b}},12355:F=>{function b(F){return!!F.constructor&&"function"===typeof F.constructor.isBuffer&&F.constructor.isBuffer(F)}F.exports=function(F){return null!=F&&(b(F)||function(F){return"function"===typeof F.readFloatLE&&"function"===typeof F.slice&&b(F.slice(0,0))}(F)||!!F._isBuffer)}},12344:(F,b,Q)=>{var C=Q(12347),z=Q(12355),t="undefined"!==typeof Float64Array;function g(F,b){return F[0]-b[0]}function W(){var F,b=this.stride,Q=new Array(b.length);for(F=0;F<Q.length;++F)Q[F]=[Math.abs(b[F]),F];Q.sort(g);var C=new Array(Q.length);for(F=0;F<C.length;++F)C[F]=Q[F][1];return C}function Z(F,b){var Q=["View",b,"d",F].join("");b<0&&(Q="View_Nil"+F);var z="generic"===F;if(-1===b){var t="function "+Q+"(a){this.data=a;};var proto="+Q+".prototype;proto.dtype='"+F+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+Q+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+Q+"(a){return new "+Q+"(a);}";return new Function(t)()}if(0===b){t="function "+Q+"(a,d) {this.data = a;this.offset = d};var proto="+Q+".prototype;proto.dtype='"+F+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+Q+"_copy() {return new "+Q+"(this.data,this.offset)};proto.pick=function "+Q+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+Q+"_get(){return "+(z?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+Q+"_set(v){return "+(z?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+Q+"(a,b,c,d){return new "+Q+"(a,d)}";return new Function("TrivialArray",t)(q[F][0])}t=["'use strict'"];var g=C(b),Z=g.map((function(F){return"i"+F})),G="this.offset+"+g.map((function(F){return"this.stride["+F+"]*i"+F})).join("+"),K=g.map((function(F){return"b"+F})).join(","),e=g.map((function(F){return"c"+F})).join(",");t.push("function "+Q+"(a,"+K+","+e+",d){this.data=a","this.shape=["+K+"]","this.stride=["+e+"]","this.offset=d|0}","var proto="+Q+".prototype","proto.dtype='"+F+"'","proto.dimension="+b),t.push("Object.defineProperty(proto,'size',{get:function "+Q+"_size(){return "+g.map((function(F){return"this.shape["+F+"]"})).join("*"),"}})"),1===b?t.push("proto.order=[0]"):(t.push("Object.defineProperty(proto,'order',{get:"),b<4?(t.push("function "+Q+"_order(){"),2===b?t.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&t.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):t.push("ORDER})")),t.push("proto.set=function "+Q+"_set("+Z.join(",")+",v){"),z?t.push("return this.data.set("+G+",v)}"):t.push("return this.data["+G+"]=v}"),t.push("proto.get=function "+Q+"_get("+Z.join(",")+"){"),z?t.push("return this.data.get("+G+")}"):t.push("return this.data["+G+"]}"),t.push("proto.index=function "+Q+"_index(",Z.join(),"){return "+G+"}"),t.push("proto.hi=function "+Q+"_hi("+Z.join(",")+"){return new "+Q+"(this.data,"+g.map((function(F){return["(typeof i",F,"!=='number'||i",F,"<0)?this.shape[",F,"]:i",F,"|0"].join("")})).join(",")+","+g.map((function(F){return"this.stride["+F+"]"})).join(",")+",this.offset)}");var N=g.map((function(F){return"a"+F+"=this.shape["+F+"]"})),y=g.map((function(F){return"c"+F+"=this.stride["+F+"]"}));t.push("proto.lo=function "+Q+"_lo("+Z.join(",")+"){var b=this.offset,d=0,"+N.join(",")+","+y.join(","));for(var E=0;E<b;++E)t.push("if(typeof i"+E+"==='number'&&i"+E+">=0){d=i"+E+"|0;b+=c"+E+"*d;a"+E+"-=d}");t.push("return new "+Q+"(this.data,"+g.map((function(F){return"a"+F})).join(",")+","+g.map((function(F){return"c"+F})).join(",")+",b)}"),t.push("proto.step=function "+Q+"_step("+Z.join(",")+"){var "+g.map((function(F){return"a"+F+"=this.shape["+F+"]"})).join(",")+","+g.map((function(F){return"b"+F+"=this.stride["+F+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(E=0;E<b;++E)t.push("if(typeof i"+E+"==='number'){d=i"+E+"|0;if(d<0){c+=b"+E+"*(a"+E+"-1);a"+E+"=ceil(-a"+E+"/d)}else{a"+E+"=ceil(a"+E+"/d)}b"+E+"*=d}");t.push("return new "+Q+"(this.data,"+g.map((function(F){return"a"+F})).join(",")+","+g.map((function(F){return"b"+F})).join(",")+",c)}");var c=new Array(b),X=new Array(b);for(E=0;E<b;++E)c[E]="a[i"+E+"]",X[E]="b[i"+E+"]";t.push("proto.transpose=function "+Q+"_transpose("+Z+"){"+Z.map((function(F,b){return F+"=("+F+"===undefined?"+b+":"+F+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+Q+"(this.data,"+c.join(",")+","+X.join(",")+",this.offset)}"),t.push("proto.pick=function "+Q+"_pick("+Z+"){var a=[],b=[],c=this.offset");for(E=0;E<b;++E)t.push("if(typeof i"+E+"==='number'&&i"+E+">=0){c=(c+this.stride["+E+"]*i"+E+")|0}else{a.push(this.shape["+E+"]);b.push(this.stride["+E+"])}");return t.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),t.push("return function construct_"+Q+"(data,shape,stride,offset){return new "+Q+"(data,"+g.map((function(F){return"shape["+F+"]"})).join(",")+","+g.map((function(F){return"stride["+F+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",t.join("\n"))(q[F],W)}var q={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};F.exports=function(F,b,Q,C){if(void 0===F)return(0,q.array[0])([]);"number"===typeof F&&(F=[F]),void 0===b&&(b=[F.length]);var g=b.length;if(void 0===Q){Q=new Array(g);for(var W=g-1,G=1;W>=0;--W)Q[W]=G,G*=b[W]}if(void 0===C){C=0;for(W=0;W<g;++W)Q[W]<0&&(C-=(b[W]-1)*Q[W])}for(var K=function(F){if(z(F))return"buffer";if(t)switch(Object.prototype.toString.call(F)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(F)?"array":"generic"}(F),e=q[K];e.length<=g+1;)e.push(Z(K,e.length-1));return(0,e[g+1])(F,b,Q,C)}},13337:F=>{var b;self,b=()=>(()=>{"use strict";var F={d:(b,Q)=>{for(var C in Q)F.o(Q,C)&&!F.o(b,C)&&Object.defineProperty(b,C,{enumerable:!0,get:Q[C]})},o:(F,b)=>Object.prototype.hasOwnProperty.call(F,b)},b={};F.d(b,{default:()=>V});var Q,C=function(F,b){var Q=b.x-F.x,C=b.y-F.y;return Math.sqrt(Q*Q+C*C)},z=function(F){return F*(Math.PI/180)},t=new Map,g=function(F){t.has(F)&&clearTimeout(t.get(F)),t.set(F,setTimeout(F,100))},W=function(F,b,Q){for(var C,z=b.split(/[ ,]+/g),t=0;t<z.length;t+=1)C=z[t],F.addEventListener?F.addEventListener(C,Q,!1):F.attachEvent&&F.attachEvent(C,Q)},Z=function(F,b,Q){for(var C,z=b.split(/[ ,]+/g),t=0;t<z.length;t+=1)C=z[t],F.removeEventListener?F.removeEventListener(C,Q):F.detachEvent&&F.detachEvent(C,Q)},q=function(F){return F.preventDefault(),F.type.match(/^touch/)?F.changedTouches:F},G=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},K=function(F,b){b.top||b.right||b.bottom||b.left?(F.style.top=b.top,F.style.right=b.right,F.style.bottom=b.bottom,F.style.left=b.left):(F.style.left=b.x+"px",F.style.top=b.y+"px")},e=function(F,b,Q){var C=N(F);for(var z in C)if(C.hasOwnProperty(z))if("string"==typeof b)C[z]=b+" "+Q;else{for(var t="",g=0,W=b.length;g<W;g+=1)t+=b[g]+" "+Q+", ";C[z]=t.slice(0,-2)}return C},N=function(F){var b={};return b[F]="",["webkit","Moz","o"].forEach((function(Q){b[Q+F.charAt(0).toUpperCase()+F.slice(1)]=""})),b},y=function(F,b){for(var Q in b)b.hasOwnProperty(Q)&&(F[Q]=b[Q]);return F},E=function(F,b){if(F.length)for(var Q=0,C=F.length;Q<C;Q+=1)b(F[Q]);else b(F)},c="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,X=window.matchMedia("(any-hover: none)").matches,L=!!("ontouchstart"in window),i=!!window.PointerEvent,f=!!window.MSPointerEvent,k={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},m={start:"mousedown",move:"mousemove",end:"mouseup"},R={};function p(){}c&&!X?Q=k:i?Q={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?Q={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:L?(Q=k,R=m):Q=m,p.prototype.on=function(F,b){var Q,C=this,z=F.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var t=0;t<z.length;t+=1)Q=z[t],C._handlers_[Q]=C._handlers_[Q]||[],C._handlers_[Q].push(b);return C},p.prototype.off=function(F,b){var Q=this;return Q._handlers_=Q._handlers_||{},void 0===F?Q._handlers_={}:void 0===b?Q._handlers_[F]=null:Q._handlers_[F]&&Q._handlers_[F].indexOf(b)>=0&&Q._handlers_[F].splice(Q._handlers_[F].indexOf(b),1),Q},p.prototype.trigger=function(F,b){var Q,C=this,z=F.split(/[ ,]+/g);C._handlers_=C._handlers_||{};for(var t=0;t<z.length;t+=1)Q=z[t],C._handlers_[Q]&&C._handlers_[Q].length&&C._handlers_[Q].forEach((function(F){F.call(C,{type:Q,target:C},b)}))},p.prototype.config=function(F){var b=this;b.options=b.defaults||{},F&&(b.options=function(F,b){var Q={};for(var C in F)F.hasOwnProperty(C)&&b.hasOwnProperty(C)?Q[C]=b[C]:F.hasOwnProperty(C)&&(Q[C]=F[C]);return Q}(b.options,F))},p.prototype.bindEvt=function(F,b){var C=this;return C._domHandlers_=C._domHandlers_||{},C._domHandlers_[b]=function(){"function"==typeof C["on"+b]?C["on"+b].apply(C,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},W(F,Q[b],C._domHandlers_[b]),R[b]&&W(F,R[b],C._domHandlers_[b]),C},p.prototype.unbindEvt=function(F,b){var C=this;return C._domHandlers_=C._domHandlers_||{},Z(F,Q[b],C._domHandlers_[b]),R[b]&&Z(F,R[b],C._domHandlers_[b]),delete C._domHandlers_[b],this};const D=p;function P(F,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=F,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=P.id,P.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}P.prototype=new D,P.constructor=P,P.id=0,P.prototype.buildEl=function(F){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},P.prototype.stylize=function(){if(this.options.dataOnly)return this;var F=this.options.fadeTime+"ms",b=function(){var F=N("borderRadius");for(var b in F)F.hasOwnProperty(b)&&(F[b]="50%");return F}(),Q=e("transition","opacity",F),C={};return C.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},C.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},C.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},y(C.el,Q),"circle"===this.options.shape&&y(C.back,b),y(C.front,b),this.applyStyles(C),this},P.prototype.applyStyles=function(F){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var Q in F[b])this.ui[b].style[Q]=F[b][Q];return this},P.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},P.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},P.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},P.prototype.show=function(F){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof F&&F.call(this)}),b.options.fadeTime)),b},P.prototype.hide=function(F){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var Q="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=Q,"function"==typeof F&&F.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var Q=b.options.restJoystick,C={};C.x=!0===Q||!1!==Q.x?0:b.instance.frontPosition.x,C.y=!0===Q||!1!==Q.y?0:b.instance.frontPosition.y,b.setPosition(F,C)}return b},P.prototype.setPosition=function(F,b){var Q=this;Q.frontPosition={x:b.x,y:b.y};var C=Q.options.fadeTime+"ms",z={};z.front=e("transition",["transform"],C);var t={front:{}};t.front={transform:"translate("+Q.frontPosition.x+"px,"+Q.frontPosition.y+"px)"},Q.applyStyles(z),Q.applyStyles(t),Q.restTimeout=setTimeout((function(){"function"==typeof F&&F.call(Q),Q.restCallback()}),Q.options.fadeTime)},P.prototype.restCallback=function(){var F=this,b={};b.front=e("transition","none",""),F.applyStyles(b),F.trigger("rested",F.instance)},P.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},P.prototype.computeDirection=function(F){var b,Q,C,z=F.angle.radian,t=Math.PI/4,g=Math.PI/2;if(z>t&&z<3*t&&!F.lockX?b="up":z>-t&&z<=t&&!F.lockY?b="left":z>3*-t&&z<=-t&&!F.lockX?b="down":F.lockY||(b="right"),F.lockY||(Q=z>-g&&z<g?"left":"right"),F.lockX||(C=z>0?"up":"down"),F.force>this.options.threshold){var W,Z={};for(W in this.direction)this.direction.hasOwnProperty(W)&&(Z[W]=this.direction[W]);var q={};for(W in this.direction={x:Q,y:C,angle:b},F.direction=this.direction,Z)Z[W]===this.direction[W]&&(q[W]=!0);if(q.x&&q.y&&q.angle)return F;q.x&&q.y||this.trigger("plain",F),q.x||this.trigger("plain:"+Q,F),q.y||this.trigger("plain:"+C,F),q.angle||this.trigger("dir dir:"+b,F)}else this.resetDirection();return F};const n=P;function j(F,b){var Q=this;Q.nipples=[],Q.idles=[],Q.actives=[],Q.ids=[],Q.pressureIntervals={},Q.manager=F,Q.id=j.id,j.id+=1,Q.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},Q.config(b),"static"!==Q.options.mode&&"semi"!==Q.options.mode||(Q.options.multitouch=!1),Q.options.multitouch||(Q.options.maxNumberOfNipples=1);var C=getComputedStyle(Q.options.zone.parentElement);return C&&"flex"===C.display&&(Q.parentIsFlex=!0),Q.updateBox(),Q.prepareNipples(),Q.Ie(),Q.begin(),Q.nipples}j.prototype=new D,j.constructor=j,j.id=0,j.prototype.prepareNipples=function(){var F=this,b=F.nipples;b.on=F.on.bind(F),b.off=F.off.bind(F),b.options=F.options,b.destroy=F.destroy.bind(F),b.ids=F.ids,b.id=F.id,b.processOnMove=F.processOnMove.bind(F),b.processOnEnd=F.processOnEnd.bind(F),b.get=function(F){if(void 0===F)return b[0];for(var Q=0,C=b.length;Q<C;Q+=1)if(b[Q].identifier===F)return b[Q];return!1}},j.prototype.Ie=function(){var F=this;F.bindEvt(F.options.zone,"start"),F.options.zone.style.touchAction="none",F.options.zone.style.msTouchAction="none"},j.prototype.begin=function(){var F=this,b=F.options;if("static"===b.mode){var Q=F.createNipple(b.position,F.manager.getIdentifier());Q.add(),F.idles.push(Q)}},j.prototype.createNipple=function(F,b){var Q=this,C=Q.manager.scroll,z={},t=Q.options,g=Q.parentIsFlex?C.x:C.x+Q.box.left,W=Q.parentIsFlex?C.y:C.y+Q.box.top;if(F.x&&F.y)z={x:F.x-g,y:F.y-W};else if(F.top||F.right||F.bottom||F.left){var Z=document.createElement("DIV");Z.style.display="hidden",Z.style.top=F.top,Z.style.right=F.right,Z.style.bottom=F.bottom,Z.style.left=F.left,Z.style.position="absolute",t.zone.appendChild(Z);var q=Z.getBoundingClientRect();t.zone.removeChild(Z),z=F,F={x:q.left+C.x,y:q.top+C.y}}var G=new n(Q,{color:t.color,size:t.size,threshold:t.threshold,fadeTime:t.fadeTime,dataOnly:t.dataOnly,restJoystick:t.restJoystick,restOpacity:t.restOpacity,mode:t.mode,identifier:b,position:F,zone:t.zone,frontPosition:{x:0,y:0},shape:t.shape});return t.dataOnly||(K(G.ui.el,z),K(G.ui.front,G.frontPosition)),Q.nipples.push(G),Q.trigger("added "+G.identifier+":added",G),Q.manager.trigger("added "+G.identifier+":added",G),Q.bindNipple(G),G},j.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},j.prototype.bindNipple=function(F){var b,Q=this,C=function(F,C){b=F.type+" "+C.id+":"+F.type,Q.trigger(b,C)};F.on("destroyed",Q.onDestroyed.bind(Q)),F.on("shown hidden rested dir plain",C),F.on("dir:up dir:right dir:down dir:left",C),F.on("plain:up plain:right plain:down plain:left",C)},j.prototype.pressureFn=function(F,b,Q){var C=this,z=0;clearInterval(C.pressureIntervals[Q]),C.pressureIntervals[Q]=setInterval(function(){var Q=F.force||F.pressure||F.webkitForce||0;Q!==z&&(b.trigger("pressure",Q),C.trigger("pressure "+b.identifier+":pressure",Q),z=Q)}.bind(C),100)},j.prototype.onstart=function(F){var b=this,Q=b.options,C=F;return F=q(F),b.updateBox(),E(F,(function(z){b.actives.length<Q.maxNumberOfNipples?b.processOnStart(z):C.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(Q){if(Object.values(C.touches).findIndex((function(F){return F.identifier===Q}))<0){var z=[F[0]];z.identifier=Q,b.processOnEnd(z)}})),b.actives.length<Q.maxNumberOfNipples&&b.processOnStart(z))})),b.manager.bindDocument(),!1},j.prototype.processOnStart=function(F){var b,Q=this,z=Q.options,t=Q.manager.getIdentifier(F),g=F.force||F.pressure||F.webkitForce||0,W={x:F.pageX,y:F.pageY},Z=Q.getOrCreate(t,W);Z.identifier!==t&&Q.manager.removeIdentifier(Z.identifier),Z.identifier=t;var q=function(b){b.trigger("start",b),Q.trigger("start "+b.id+":start",b),b.show(),g>0&&Q.pressureFn(F,b,b.identifier),Q.processOnMove(F)};if((b=Q.idles.indexOf(Z))>=0&&Q.idles.splice(b,1),Q.actives.push(Z),Q.ids.push(Z.identifier),"semi"!==z.mode)q(Z);else{if(!(C(W,Z.position)<=z.catchDistance))return Z.destroy(),void Q.processOnStart(F);q(Z)}return Z},j.prototype.getOrCreate=function(F,b){var Q,C=this,z=C.options;return/(semi|static)/.test(z.mode)?(Q=C.idles[0])?(C.idles.splice(0,1),Q):"semi"===z.mode?C.createNipple(b,F):(console.warn("Coudln't find the needed nipple."),!1):Q=C.createNipple(b,F)},j.prototype.processOnMove=function(F){var b=this,Q=b.options,t=b.manager.getIdentifier(F),g=b.nipples.get(t),W=b.manager.scroll;if(function(F){return isNaN(F.buttons)?0!==F.pressure:0!==F.buttons}(F)){if(!g)return console.error("Found zombie joystick with ID "+t),void b.manager.removeIdentifier(t);if(Q.dynamicPage){var Z=g.el.getBoundingClientRect();g.position={x:W.x+Z.left,y:W.y+Z.top}}g.identifier=t;var q=g.options.size/2,G={x:F.pageX,y:F.pageY};Q.lockX&&(G.y=g.position.y),Q.lockY&&(G.x=g.position.x);var K,e,N,y,E,c,X,L,i,f,k=C(G,g.position),m=(K=G,N=(e=g.position).x-K.x,y=e.y-K.y,function(F){return F*(180/Math.PI)}(Math.atan2(y,N))),R=z(m),p=k/q,D={distance:k,position:G};if("circle"===g.options.shape?(E=Math.min(k,q),X=g.position,L=E,f={x:0,y:0},i=z(i=m),f.x=X.x-L*Math.cos(i),f.y=X.y-L*Math.sin(i),c=f):(c=function(F,b,Q){return{x:Math.min(Math.max(F.x,b.x-Q),b.x+Q),y:Math.min(Math.max(F.y,b.y-Q),b.y+Q)}}(G,g.position,q),E=C(c,g.position)),Q.follow){if(k>q){var P=G.x-c.x,n=G.y-c.y;g.position.x+=P,g.position.y+=n,g.el.style.top=g.position.y-(b.box.top+W.y)+"px",g.el.style.left=g.position.x-(b.box.left+W.x)+"px",k=C(G,g.position)}}else G=c,k=E;var j=G.x-g.position.x,w=G.y-g.position.y;g.frontPosition={x:j,y:w},Q.dataOnly||(g.ui.front.style.transform="translate("+j+"px,"+w+"px)");var Y={identifier:g.identifier,position:G,force:p,pressure:F.force||F.pressure||F.webkitForce||0,distance:k,angle:{radian:R,degree:m},vector:{x:j/q,y:-w/q},raw:D,instance:g,lockX:Q.lockX,lockY:Q.lockY};(Y=g.computeDirection(Y)).angle={radian:z(180-m),degree:180-m},g.trigger("move",Y),b.trigger("move "+g.id+":move",Y)}else this.processOnEnd(F)},j.prototype.processOnEnd=function(F){var b=this,Q=b.options,C=b.manager.getIdentifier(F),z=b.nipples.get(C),t=b.manager.removeIdentifier(z.identifier);z&&(Q.dataOnly||z.hide((function(){"dynamic"===Q.mode&&(z.trigger("removed",z),b.trigger("removed "+z.id+":removed",z),b.manager.trigger("removed "+z.id+":removed",z),z.destroy())})),clearInterval(b.pressureIntervals[z.identifier]),z.resetDirection(),z.trigger("end",z),b.trigger("end "+z.id+":end",z),b.ids.indexOf(z.identifier)>=0&&b.ids.splice(b.ids.indexOf(z.identifier),1),b.actives.indexOf(z)>=0&&b.actives.splice(b.actives.indexOf(z),1),/(semi|static)/.test(Q.mode)?b.idles.push(z):b.nipples.indexOf(z)>=0&&b.nipples.splice(b.nipples.indexOf(z),1),b.manager.unbindDocument(),/(semi|static)/.test(Q.mode)&&(b.manager.ids[t.id]=t.identifier))},j.prototype.onDestroyed=function(F,b){var Q=this;Q.nipples.indexOf(b)>=0&&Q.nipples.splice(Q.nipples.indexOf(b),1),Q.actives.indexOf(b)>=0&&Q.actives.splice(Q.actives.indexOf(b),1),Q.idles.indexOf(b)>=0&&Q.idles.splice(Q.idles.indexOf(b),1),Q.ids.indexOf(b.identifier)>=0&&Q.ids.splice(Q.ids.indexOf(b.identifier),1),Q.manager.removeIdentifier(b.identifier),Q.manager.unbindDocument()},j.prototype.destroy=function(){var F=this;for(var b in F.unbindEvt(F.options.zone,"start"),F.nipples.forEach((function(F){F.destroy()})),F.pressureIntervals)F.pressureIntervals.hasOwnProperty(b)&&clearInterval(F.pressureIntervals[b]);F.trigger("destroyed",F.nipples),F.manager.unbindDocument(),F.off()};const w=j;function Y(F){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=G(),b.config(F),b.prepareCollections();var Q=function(){var F;b.collections.forEach((function(Q){Q.forEach((function(Q){F=Q.el.getBoundingClientRect(),Q.position={x:b.scroll.x+F.left,y:b.scroll.y+F.top}}))}))};W(window,"resize",(function(){g(Q)}));var C=function(){b.scroll=G()};return W(window,"scroll",(function(){g(C)})),b.collections}Y.prototype=new D,Y.constructor=Y,Y.prototype.prepareCollections=function(){var F=this;F.collections.create=F.create.bind(F),F.collections.on=F.on.bind(F),F.collections.off=F.off.bind(F),F.collections.destroy=F.destroy.bind(F),F.collections.get=function(b){var Q;return F.collections.every((function(F){return!(Q=F.get(b))})),Q}},Y.prototype.create=function(F){return this.createCollection(F)},Y.prototype.createCollection=function(F){var b=this,Q=new w(b,F);return b.bindCollection(Q),b.collections.push(Q),Q},Y.prototype.bindCollection=function(F){var b,Q=this,C=function(F,C){b=F.type+" "+C.id+":"+F.type,Q.trigger(b,C)};F.on("destroyed",Q.onDestroyed.bind(Q)),F.on("shown hidden rested dir plain",C),F.on("dir:up dir:right dir:down dir:left",C),F.on("plain:up plain:right plain:down plain:left",C)},Y.prototype.bindDocument=function(){var F=this;F.binded||(F.bindEvt(document,"move").bindEvt(document,"end"),F.binded=!0)},Y.prototype.unbindDocument=function(F){var b=this;Object.keys(b.ids).length&&!0!==F||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},Y.prototype.getIdentifier=function(F){var b;return F?void 0===(b=void 0===F.identifier?F.pointerId:F.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},Y.prototype.removeIdentifier=function(F){var b={};for(var Q in this.ids)if(this.ids[Q]===F){b.id=Q,b.identifier=this.ids[Q],delete this.ids[Q];break}return b},Y.prototype.onmove=function(F){return this.onAny("move",F),!1},Y.prototype.onend=function(F){return this.onAny("end",F),!1},Y.prototype.oncancel=function(F){return this.onAny("end",F),!1},Y.prototype.onAny=function(F,b){var Q,C=this,z="processOn"+F.charAt(0).toUpperCase()+F.slice(1);b=q(b);var t=function(F,b,Q){Q.ids.indexOf(b)>=0&&(Q[z](F),F._found_=!0)};return E(b,(function(F){Q=C.getIdentifier(F),E(C.collections,t.bind(null,F,Q)),F._found_||C.removeIdentifier(Q)})),!1},Y.prototype.destroy=function(){var F=this;F.unbindDocument(!0),F.ids={},F.index=0,F.collections.forEach((function(F){F.destroy()})),F.off()},Y.prototype.onDestroyed=function(F,b){var Q=this;if(Q.collections.indexOf(b)<0)return!1;Q.collections.splice(Q.collections.indexOf(b),1)};var s=new Y;const V={create:function(F){return s.create(F)},factory:s};return b.default})(),F.exports=b()},12365:(F,b,Q)=>{"use strict";const{Deflate:C,deflate:z,deflateRaw:t,gzip:g}=Q(12372),{Inflate:W,inflate:Z,inflateRaw:q,ungzip:G}=Q(12419),K=Q(12404);F.exports.Deflate=C,F.exports.deflate=z,F.exports.deflateRaw=t,F.exports.gzip=g,F.exports.Inflate=W,F.exports.inflate=Z,F.exports.inflateRaw=q,F.exports.ungzip=G,F.exports.constants=K},12372:(F,b,Q)=>{"use strict";const C=Q(12377),z=Q(12406),t=Q(12408),g=Q(12397),W=Q(12415),Z=Object.prototype.toString,{Z_NO_FLUSH:q,Z_SYNC_FLUSH:G,Z_FULL_FLUSH:K,Z_FINISH:e,Z_OK:N,Z_STREAM_END:y,Z_DEFAULT_COMPRESSION:E,Z_DEFAULT_STRATEGY:c,Z_DEFLATED:X}=Q(12404);function L(F){this.options=z.assign({level:E,method:X,SF:16384,windowBits:15,memLevel:8,strategy:c},F||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.FQ="",this.ended=!1,this.chunks=[],this.strm=new W,this.strm.avail_out=0;let Q=C.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(Q!==N)throw new Error(g[Q]);if(b.header&&C.deflateSetHeader(this.strm,b.header),b.dictionary){let F;if(F="string"===typeof b.dictionary?t.string2buf(b.dictionary):"[object ArrayBuffer]"===Z.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,Q=C.deflateSetDictionary(this.strm,F),Q!==N)throw new Error(g[Q]);this._dict_set=!0}}function i(F,b){const Q=new L(b);if(Q.push(F,!0),Q.err)throw Q.FQ||g[Q.err];return Q.result}L.prototype.push=function(F,b){const Q=this.strm,z=this.options.SF;let g,W;if(this.ended)return!1;for(W=b===~~b?b:!0===b?e:q,"string"===typeof F?Q.input=t.string2buf(F):"[object ArrayBuffer]"===Z.call(F)?Q.input=new Uint8Array(F):Q.input=F,Q.next_in=0,Q.avail_in=Q.input.length;;)if(0===Q.avail_out&&(Q.output=new Uint8Array(z),Q.next_out=0,Q.avail_out=z),(W===G||W===K)&&Q.avail_out<=6)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else{if(g=C.deflate(Q,W),g===y)return Q.next_out>0&&this.onData(Q.output.subarray(0,Q.next_out)),g=C.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===N;if(0!==Q.avail_out){if(W>0&&Q.next_out>0)this.onData(Q.output.subarray(0,Q.next_out)),Q.avail_out=0;else if(0===Q.avail_in)break}else this.onData(Q.output)}return!0},L.prototype.onData=function(F){this.chunks.push(F)},L.prototype.onEnd=function(F){F===N&&(this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.FQ=this.strm.FQ},F.exports.Deflate=L,F.exports.deflate=i,F.exports.deflateRaw=function(F,b){return(b=b||{}).raw=!0,i(F,b)},F.exports.gzip=function(F,b){return(b=b||{}).gzip=!0,i(F,b)},F.exports.constants=Q(12404)},12419:(F,b,Q)=>{"use strict";const C=Q(12427),z=Q(12406),t=Q(12408),g=Q(12397),W=Q(12415),Z=Q(12440),q=Object.prototype.toString,{Z_NO_FLUSH:G,Z_FINISH:K,Z_OK:e,Z_STREAM_END:N,Z_NEED_DICT:y,Z_STREAM_ERROR:E,Z_DATA_ERROR:c,Z_MEM_ERROR:X}=Q(12404);function L(F){this.options=z.assign({SF:65536,windowBits:15,to:""},F||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||F&&F.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.FQ="",this.ended=!1,this.chunks=[],this.strm=new W,this.strm.avail_out=0;let Q=C.inflateInit2(this.strm,b.windowBits);if(Q!==e)throw new Error(g[Q]);if(this.header=new Z,C.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=t.string2buf(b.dictionary):"[object ArrayBuffer]"===q.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(Q=C.inflateSetDictionary(this.strm,b.dictionary),Q!==e)))throw new Error(g[Q])}function i(F,b){const Q=new L(b);if(Q.push(F),Q.err)throw Q.FQ||g[Q.err];return Q.result}L.prototype.push=function(F,b){const Q=this.strm,z=this.options.SF,g=this.options.dictionary;let W,Z,L;if(this.ended)return!1;for(Z=b===~~b?b:!0===b?K:G,"[object ArrayBuffer]"===q.call(F)?Q.input=new Uint8Array(F):Q.input=F,Q.next_in=0,Q.avail_in=Q.input.length;;){for(0===Q.avail_out&&(Q.output=new Uint8Array(z),Q.next_out=0,Q.avail_out=z),W=C.inflate(Q,Z),W===y&&g&&(W=C.inflateSetDictionary(Q,g),W===e?W=C.inflate(Q,Z):W===c&&(W=y));Q.avail_in>0&&W===N&&Q.state.wrap>0&&0!==F[Q.next_in];)C.inflateReset(Q),W=C.inflate(Q,Z);switch(W){case E:case c:case y:case X:return this.onEnd(W),this.ended=!0,!1}if(L=Q.avail_out,Q.next_out&&(0===Q.avail_out||W===N))if("string"===this.options.to){let F=t.utf8border(Q.output,Q.next_out),b=Q.next_out-F,C=t.buf2string(Q.output,F);Q.next_out=b,Q.avail_out=z-b,b&&Q.output.set(Q.output.subarray(F,F+b),0),this.onData(C)}else this.onData(Q.output.length===Q.next_out?Q.output:Q.output.subarray(0,Q.next_out));if(W!==e||0!==L){if(W===N)return W=C.inflateEnd(this.strm),this.onEnd(W),this.ended=!0,!0;if(0===Q.avail_in)break}}return!0},L.prototype.onData=function(F){this.chunks.push(F)},L.prototype.onEnd=function(F){F===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=z.flattenChunks(this.chunks)),this.chunks=[],this.err=F,this.FQ=this.strm.FQ},F.exports.Inflate=L,F.exports.inflate=i,F.exports.inflateRaw=function(F,b){return(b=b||{}).raw=!0,i(F,b)},F.exports.ungzip=i,F.exports.constants=Q(12404)},12406:F=>{"use strict";const b=(F,b)=>Object.prototype.hasOwnProperty.call(F,b);F.exports.assign=function(F){const Q=Array.prototype.slice.call(arguments,1);for(;Q.length;){const C=Q.shift();if(C){if("object"!==typeof C)throw new TypeError(C+"must be non-object");for(const Q in C)b(C,Q)&&(F[Q]=C[Q])}}return F},F.exports.flattenChunks=F=>{let b=0;for(let C=0,z=F.length;C<z;C++)b+=F[C].length;const Q=new Uint8Array(b);for(let C=0,z=0,t=F.length;C<t;C++){let b=F[C];Q.set(b,z),z+=b.length}return Q}},12408:F=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(C){b=!1}const Q=new Uint8Array(256);for(let z=0;z<256;z++)Q[z]=z>=252?6:z>=248?5:z>=240?4:z>=224?3:z>=192?2:1;Q[254]=Q[254]=1,F.exports.string2buf=F=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(F);let b,Q,C,z,t,g=F.length,W=0;for(z=0;z<g;z++)Q=F.charCodeAt(z),55296===(64512&Q)&&z+1<g&&(C=F.charCodeAt(z+1),56320===(64512&C)&&(Q=65536+(Q-55296<<10)+(C-56320),z++)),W+=Q<128?1:Q<2048?2:Q<65536?3:4;for(b=new Uint8Array(W),t=0,z=0;t<W;z++)Q=F.charCodeAt(z),55296===(64512&Q)&&z+1<g&&(C=F.charCodeAt(z+1),56320===(64512&C)&&(Q=65536+(Q-55296<<10)+(C-56320),z++)),Q<128?b[t++]=Q:Q<2048?(b[t++]=192|Q>>>6,b[t++]=128|63&Q):Q<65536?(b[t++]=224|Q>>>12,b[t++]=128|Q>>>6&63,b[t++]=128|63&Q):(b[t++]=240|Q>>>18,b[t++]=128|Q>>>12&63,b[t++]=128|Q>>>6&63,b[t++]=128|63&Q);return b};F.exports.buf2string=(F,C)=>{const z=C||F.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(F.subarray(0,C));let t,g;const W=new Array(2*z);for(g=0,t=0;t<z;){let b=F[t++];if(b<128){W[g++]=b;continue}let C=Q[b];if(C>4)W[g++]=65533,t+=C-1;else{for(b&=2===C?31:3===C?15:7;C>1&&t<z;)b=b<<6|63&F[t++],C--;C>1?W[g++]=65533:b<65536?W[g++]=b:(b-=65536,W[g++]=55296|b>>10&1023,W[g++]=56320|1023&b)}}return((F,Q)=>{if(Q<65534&&F.subarray&&b)return String.fromCharCode.apply(null,F.length===Q?F:F.subarray(0,Q));let C="";for(let b=0;b<Q;b++)C+=String.fromCharCode(F[b]);return C})(W,g)},F.exports.utf8border=(F,b)=>{(b=b||F.length)>F.length&&(b=F.length);let C=b-1;for(;C>=0&&128===(192&F[C]);)C--;return C<0||0===C?b:C+Q[F[C]]>b?C:b}},12387:F=>{"use strict";F.exports=(F,b,Q,C)=>{let z=65535&F,t=F>>>16&65535,g=0;for(;0!==Q;){g=Q>2e3?2e3:Q,Q-=g;do{z=z+b[C++]|0,t=t+z|0}while(--g);z%=65521,t%=65521}return z|t<<16}},12404:F=>{"use strict";F.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12389:F=>{"use strict";const b=new Uint32Array((()=>{let F,b=[];for(var Q=0;Q<256;Q++){F=Q;for(var C=0;C<8;C++)F=1&F?3988292384^F>>>1:F>>>1;b[Q]=F}return b})());F.exports=(F,Q,C,z)=>{const t=b,g=z+C;F^=-1;for(let b=z;b<g;b++)F=F>>>8^t[255&(F^Q[b])];return~F}},12377:(F,b,Q)=>{"use strict";const{_tr_init:C,_tr_stored_block:z,_tr_flush_block:t,_tr_tally:g,_tr_align:W}=Q(12384),Z=Q(12387),q=Q(12389),G=Q(12397),{Z_NO_FLUSH:K,Z_PARTIAL_FLUSH:e,Z_FULL_FLUSH:N,Z_FINISH:y,Z_BLOCK:E,Z_OK:c,Z_STREAM_END:X,Z_STREAM_ERROR:L,Z_DATA_ERROR:i,Z_BUF_ERROR:f,Z_DEFAULT_COMPRESSION:k,Z_FILTERED:m,Z_HUFFMAN_ONLY:R,Z_RLE:p,Z_FIXED:D,Z_DEFAULT_STRATEGY:P,Z_UNKNOWN:n,Z_DEFLATED:j}=Q(12404),w=258,Y=262,s=103,V=113,h=666,l=(F,b)=>(F.FQ=G[b],b),T=F=>(F<<1)-(F>4?9:0),o=F=>{let b=F.length;for(;--b>=0;)F[b]=0};let S=(F,b,Q)=>(b<<F.hash_shift^Q)&F.hash_mask;const O=F=>{const b=F.state;let Q=b.pending;Q>F.avail_out&&(Q=F.avail_out),0!==Q&&(F.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+Q),F.next_out),F.next_out+=Q,b.pending_out+=Q,F.total_out+=Q,F.avail_out-=Q,b.pending-=Q,0===b.pending&&(b.pending_out=0))},x=(F,b)=>{t(F,F.block_start>=0?F.block_start:-1,F.strstart-F.block_start,b),F.block_start=F.strstart,O(F.strm)},a=(F,b)=>{F.pending_buf[F.pending++]=b},A=(F,b)=>{F.pending_buf[F.pending++]=b>>>8&255,F.pending_buf[F.pending++]=255&b},U=(F,b,Q,C)=>{let z=F.avail_in;return z>C&&(z=C),0===z?0:(F.avail_in-=z,b.set(F.input.subarray(F.next_in,F.next_in+z),Q),1===F.state.wrap?F.adler=Z(F.adler,b,z,Q):2===F.state.wrap&&(F.adler=q(F.adler,b,z,Q)),F.next_in+=z,F.total_in+=z,z)},u=(F,b)=>{let Q,C,z=F.max_chain_length,t=F.strstart,g=F.prev_length,W=F.nice_match;const Z=F.strstart>F.w_size-Y?F.strstart-(F.w_size-Y):0,q=F.window,G=F.w_mask,K=F.prev,e=F.strstart+w;let N=q[t+g-1],y=q[t+g];F.prev_length>=F.good_match&&(z>>=2),W>F.lookahead&&(W=F.lookahead);do{if(Q=b,q[Q+g]===y&&q[Q+g-1]===N&&q[Q]===q[t]&&q[++Q]===q[t+1]){t+=2,Q++;do{}while(q[++t]===q[++Q]&&q[++t]===q[++Q]&&q[++t]===q[++Q]&&q[++t]===q[++Q]&&q[++t]===q[++Q]&&q[++t]===q[++Q]&&q[++t]===q[++Q]&&q[++t]===q[++Q]&&t<e);if(C=w-(e-t),t=e-w,C>g){if(F.match_start=b,g=C,C>=W)break;N=q[t+g-1],y=q[t+g]}}}while((b=K[b&G])>Z&&0!==--z);return g<=F.lookahead?g:F.lookahead},v=F=>{const b=F.w_size;let Q,C,z,t,g;do{if(t=F.window_size-F.lookahead-F.strstart,F.strstart>=b+(b-Y)){F.window.set(F.window.subarray(b,b+b),0),F.match_start-=b,F.strstart-=b,F.block_start-=b,C=F.hash_size,Q=C;do{z=F.head[--Q],F.head[Q]=z>=b?z-b:0}while(--C);C=b,Q=C;do{z=F.prev[--Q],F.prev[Q]=z>=b?z-b:0}while(--C);t+=b}if(0===F.strm.avail_in)break;if(C=U(F.strm,F.window,F.strstart+F.lookahead,t),F.lookahead+=C,F.lookahead+F.insert>=3)for(g=F.strstart-F.insert,F.ins_h=F.window[g],F.ins_h=S(F,F.ins_h,F.window[g+1]);F.insert&&(F.ins_h=S(F,F.ins_h,F.window[g+3-1]),F.prev[g&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=g,g++,F.insert--,!(F.lookahead+F.insert<3)););}while(F.lookahead<Y&&0!==F.strm.avail_in)},J=(F,b)=>{let Q,C;for(;;){if(F.lookahead<Y){if(v(F),F.lookahead<Y&&b===K)return 1;if(0===F.lookahead)break}if(Q=0,F.lookahead>=3&&(F.ins_h=S(F,F.ins_h,F.window[F.strstart+3-1]),Q=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),0!==Q&&F.strstart-Q<=F.w_size-Y&&(F.match_length=u(F,Q)),F.match_length>=3)if(C=g(F,F.strstart-F.match_start,F.match_length-3),F.lookahead-=F.match_length,F.match_length<=F.max_lazy_match&&F.lookahead>=3){F.match_length--;do{F.strstart++,F.ins_h=S(F,F.ins_h,F.window[F.strstart+3-1]),Q=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart}while(0!==--F.match_length);F.strstart++}else F.strstart+=F.match_length,F.match_length=0,F.ins_h=F.window[F.strstart],F.ins_h=S(F,F.ins_h,F.window[F.strstart+1]);else C=g(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++;if(C&&(x(F,!1),0===F.strm.avail_out))return 1}return F.insert=F.strstart<2?F.strstart:2,b===y?(x(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(x(F,!1),0===F.strm.avail_out)?1:2},I=(F,b)=>{let Q,C,z;for(;;){if(F.lookahead<Y){if(v(F),F.lookahead<Y&&b===K)return 1;if(0===F.lookahead)break}if(Q=0,F.lookahead>=3&&(F.ins_h=S(F,F.ins_h,F.window[F.strstart+3-1]),Q=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart),F.prev_length=F.match_length,F.prev_match=F.match_start,F.match_length=2,0!==Q&&F.prev_length<F.max_lazy_match&&F.strstart-Q<=F.w_size-Y&&(F.match_length=u(F,Q),F.match_length<=5&&(F.strategy===m||3===F.match_length&&F.strstart-F.match_start>4096)&&(F.match_length=2)),F.prev_length>=3&&F.match_length<=F.prev_length){z=F.strstart+F.lookahead-3,C=g(F,F.strstart-1-F.prev_match,F.prev_length-3),F.lookahead-=F.prev_length-1,F.prev_length-=2;do{++F.strstart<=z&&(F.ins_h=S(F,F.ins_h,F.window[F.strstart+3-1]),Q=F.prev[F.strstart&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=F.strstart)}while(0!==--F.prev_length);if(F.match_available=0,F.match_length=2,F.strstart++,C&&(x(F,!1),0===F.strm.avail_out))return 1}else if(F.match_available){if(C=g(F,0,F.window[F.strstart-1]),C&&x(F,!1),F.strstart++,F.lookahead--,0===F.strm.avail_out)return 1}else F.match_available=1,F.strstart++,F.lookahead--}return F.match_available&&(C=g(F,0,F.window[F.strstart-1]),F.match_available=0),F.insert=F.strstart<2?F.strstart:2,b===y?(x(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(x(F,!1),0===F.strm.avail_out)?1:2};function M(F,b,Q,C,z){this.good_length=F,this.max_lazy=b,this.nice_length=Q,this.max_chain=C,this.func=z}const r=[new M(0,0,0,0,((F,b)=>{let Q=65535;for(Q>F.pending_buf_size-5&&(Q=F.pending_buf_size-5);;){if(F.lookahead<=1){if(v(F),0===F.lookahead&&b===K)return 1;if(0===F.lookahead)break}F.strstart+=F.lookahead,F.lookahead=0;const C=F.block_start+Q;if((0===F.strstart||F.strstart>=C)&&(F.lookahead=F.strstart-C,F.strstart=C,x(F,!1),0===F.strm.avail_out))return 1;if(F.strstart-F.block_start>=F.w_size-Y&&(x(F,!1),0===F.strm.avail_out))return 1}return F.insert=0,b===y?(x(F,!0),0===F.strm.avail_out?3:4):(F.strstart>F.block_start&&(x(F,!1),F.strm.avail_out),1)})),new M(4,4,8,4,J),new M(4,5,16,8,J),new M(4,6,32,32,J),new M(4,4,16,16,I),new M(8,16,32,32,I),new M(8,16,128,128,I),new M(8,32,128,256,I),new M(32,128,258,1024,I),new M(32,258,258,4096,I)];function H(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=j,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const B=F=>{if(!F||!F.state)return l(F,L);F.total_in=F.total_out=0,F.data_type=n;const b=F.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:V,F.adler=2===b.wrap?0:1,b.last_flush=K,C(b),c},d=F=>{const b=B(F);var Q;return b===c&&((Q=F.state).window_size=2*Q.w_size,o(Q.head),Q.max_lazy_match=r[Q.level].max_lazy,Q.good_match=r[Q.level].good_length,Q.nice_match=r[Q.level].nice_length,Q.max_chain_length=r[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=2,Q.match_available=0,Q.ins_h=0),b},FF=(F,b,Q,C,z,t)=>{if(!F)return L;let g=1;if(b===k&&(b=6),C<0?(g=0,C=-C):C>15&&(g=2,C-=16),z<1||z>9||Q!==j||C<8||C>15||b<0||b>9||t<0||t>D)return l(F,L);8===C&&(C=9);const W=new H;return F.state=W,W.strm=F,W.wrap=g,W.gzhead=null,W.w_bits=C,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=z+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+3-1)/3),W.window=new Uint8Array(2*W.w_size),W.head=new Uint16Array(W.hash_size),W.prev=new Uint16Array(W.w_size),W.lit_bufsize=1<<z+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new Uint8Array(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=b,W.strategy=t,W.method=Q,d(F)};F.exports.deflateInit=(F,b)=>FF(F,b,j,15,8,P),F.exports.deflateInit2=FF,F.exports.deflateReset=d,F.exports.deflateResetKeep=B,F.exports.deflateSetHeader=(F,b)=>F&&F.state?2!==F.state.wrap?L:(F.state.gzhead=b,c):L,F.exports.deflate=(F,b)=>{let Q,C;if(!F||!F.state||b>E||b<0)return F?l(F,L):L;const t=F.state;if(!F.output||!F.input&&0!==F.avail_in||t.status===h&&b!==y)return l(F,0===F.avail_out?f:L);t.strm=F;const Z=t.last_flush;if(t.last_flush=b,42===t.status)if(2===t.wrap)F.adler=0,a(t,31),a(t,139),a(t,8),t.gzhead?(a(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),a(t,255&t.gzhead.time),a(t,t.gzhead.time>>8&255),a(t,t.gzhead.time>>16&255),a(t,t.gzhead.time>>24&255),a(t,9===t.level?2:t.strategy>=R||t.level<2?4:0),a(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(a(t,255&t.gzhead.extra.length),a(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(F.adler=q(F.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69):(a(t,0),a(t,0),a(t,0),a(t,0),a(t,0),a(t,9===t.level?2:t.strategy>=R||t.level<2?4:0),a(t,3),t.status=V);else{let b=j+(t.w_bits-8<<4)<<8,Q=-1;Q=t.strategy>=R||t.level<2?0:t.level<6?1:6===t.level?2:3,b|=Q<<6,0!==t.strstart&&(b|=32),b+=31-b%31,t.status=V,A(t,b),0!==t.strstart&&(A(t,F.adler>>>16),A(t,65535&F.adler)),F.adler=1}if(69===t.status)if(t.gzhead.extra){for(Q=t.pending;t.gzindex<(65535&t.gzhead.extra.length)&&(t.pending!==t.pending_buf_size||(t.gzhead.hcrc&&t.pending>Q&&(F.adler=q(F.adler,t.pending_buf,t.pending-Q,Q)),O(F),Q=t.pending,t.pending!==t.pending_buf_size));)a(t,255&t.gzhead.extra[t.gzindex]),t.gzindex++;t.gzhead.hcrc&&t.pending>Q&&(F.adler=q(F.adler,t.pending_buf,t.pending-Q,Q)),t.gzindex===t.gzhead.extra.length&&(t.gzindex=0,t.status=73)}else t.status=73;if(73===t.status)if(t.gzhead.name){Q=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>Q&&(F.adler=q(F.adler,t.pending_buf,t.pending-Q,Q)),O(F),Q=t.pending,t.pending===t.pending_buf_size)){C=1;break}C=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,a(t,C)}while(0!==C);t.gzhead.hcrc&&t.pending>Q&&(F.adler=q(F.adler,t.pending_buf,t.pending-Q,Q)),0===C&&(t.gzindex=0,t.status=91)}else t.status=91;if(91===t.status)if(t.gzhead.comment){Q=t.pending;do{if(t.pending===t.pending_buf_size&&(t.gzhead.hcrc&&t.pending>Q&&(F.adler=q(F.adler,t.pending_buf,t.pending-Q,Q)),O(F),Q=t.pending,t.pending===t.pending_buf_size)){C=1;break}C=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,a(t,C)}while(0!==C);t.gzhead.hcrc&&t.pending>Q&&(F.adler=q(F.adler,t.pending_buf,t.pending-Q,Q)),0===C&&(t.status=s)}else t.status=s;if(t.status===s&&(t.gzhead.hcrc?(t.pending+2>t.pending_buf_size&&O(F),t.pending+2<=t.pending_buf_size&&(a(t,255&F.adler),a(t,F.adler>>8&255),F.adler=0,t.status=V)):t.status=V),0!==t.pending){if(O(F),0===F.avail_out)return t.last_flush=-1,c}else if(0===F.avail_in&&T(b)<=T(Z)&&b!==y)return l(F,f);if(t.status===h&&0!==F.avail_in)return l(F,f);if(0!==F.avail_in||0!==t.lookahead||b!==K&&t.status!==h){let Q=t.strategy===R?((F,b)=>{let Q;for(;;){if(0===F.lookahead&&(v(F),0===F.lookahead)){if(b===K)return 1;break}if(F.match_length=0,Q=g(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++,Q&&(x(F,!1),0===F.strm.avail_out))return 1}return F.insert=0,b===y?(x(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(x(F,!1),0===F.strm.avail_out)?1:2})(t,b):t.strategy===p?((F,b)=>{let Q,C,z,t;const W=F.window;for(;;){if(F.lookahead<=w){if(v(F),F.lookahead<=w&&b===K)return 1;if(0===F.lookahead)break}if(F.match_length=0,F.lookahead>=3&&F.strstart>0&&(z=F.strstart-1,C=W[z],C===W[++z]&&C===W[++z]&&C===W[++z])){t=F.strstart+w;do{}while(C===W[++z]&&C===W[++z]&&C===W[++z]&&C===W[++z]&&C===W[++z]&&C===W[++z]&&C===W[++z]&&C===W[++z]&&z<t);F.match_length=w-(t-z),F.match_length>F.lookahead&&(F.match_length=F.lookahead)}if(F.match_length>=3?(Q=g(F,1,F.match_length-3),F.lookahead-=F.match_length,F.strstart+=F.match_length,F.match_length=0):(Q=g(F,0,F.window[F.strstart]),F.lookahead--,F.strstart++),Q&&(x(F,!1),0===F.strm.avail_out))return 1}return F.insert=0,b===y?(x(F,!0),0===F.strm.avail_out?3:4):F.last_lit&&(x(F,!1),0===F.strm.avail_out)?1:2})(t,b):r[t.level].func(t,b);if(3!==Q&&4!==Q||(t.status=h),1===Q||3===Q)return 0===F.avail_out&&(t.last_flush=-1),c;if(2===Q&&(b===e?W(t):b!==E&&(z(t,0,0,!1),b===N&&(o(t.head),0===t.lookahead&&(t.strstart=0,t.block_start=0,t.insert=0))),O(F),0===F.avail_out))return t.last_flush=-1,c}return b!==y?c:t.wrap<=0?X:(2===t.wrap?(a(t,255&F.adler),a(t,F.adler>>8&255),a(t,F.adler>>16&255),a(t,F.adler>>24&255),a(t,255&F.total_in),a(t,F.total_in>>8&255),a(t,F.total_in>>16&255),a(t,F.total_in>>24&255)):(A(t,F.adler>>>16),A(t,65535&F.adler)),O(F),t.wrap>0&&(t.wrap=-t.wrap),0!==t.pending?c:X)},F.exports.deflateEnd=F=>{if(!F||!F.state)return L;const b=F.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==s&&b!==V&&b!==h?l(F,L):(F.state=null,b===V?l(F,i):c)},F.exports.deflateSetDictionary=(F,b)=>{let Q=b.length;if(!F||!F.state)return L;const C=F.state,z=C.wrap;if(2===z||1===z&&42!==C.status||C.lookahead)return L;if(1===z&&(F.adler=Z(F.adler,b,Q,0)),C.wrap=0,Q>=C.w_size){0===z&&(o(C.head),C.strstart=0,C.block_start=0,C.insert=0);let F=new Uint8Array(C.w_size);F.set(b.subarray(Q-C.w_size,Q),0),b=F,Q=C.w_size}const t=F.avail_in,g=F.next_in,W=F.input;for(F.avail_in=Q,F.next_in=0,F.input=b,v(C);C.lookahead>=3;){let F=C.strstart,b=C.lookahead-2;do{C.ins_h=S(C,C.ins_h,C.window[F+3-1]),C.prev[F&C.w_mask]=C.head[C.ins_h],C.head[C.ins_h]=F,F++}while(--b);C.strstart=F,C.lookahead=2,v(C)}return C.strstart+=C.lookahead,C.block_start=C.strstart,C.insert=C.lookahead,C.lookahead=0,C.match_length=C.prev_length=2,C.match_available=0,F.next_in=g,F.input=W,F.avail_in=t,C.wrap=z,c},F.exports.deflateInfo="pako deflate (from Nodeca project)"},12440:F=>{"use strict";F.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12429:F=>{"use strict";F.exports=function(F,b){let Q,C,z,t,g,W,Z,q,G,K,e,N,y,E,c,X,L,i,f,k,m,R,p,D;const P=F.state;Q=F.next_in,p=F.input,C=Q+(F.avail_in-5),z=F.next_out,D=F.output,t=z-(b-F.avail_out),g=z+(F.avail_out-257),W=P.dmax,Z=P.wsize,q=P.whave,G=P.wnext,K=P.window,e=P.hold,N=P.bits,y=P.lencode,E=P.distcode,c=(1<<P.lenbits)-1,X=(1<<P.distbits)-1;F:do{N<15&&(e+=p[Q++]<<N,N+=8,e+=p[Q++]<<N,N+=8),L=y[e&c];b:for(;;){if(i=L>>>24,e>>>=i,N-=i,i=L>>>16&255,0===i)D[z++]=65535&L;else{if(!(16&i)){if(0===(64&i)){L=y[(65535&L)+(e&(1<<i)-1)];continue b}if(32&i){P.mode=12;break F}F.FQ="invalid literal/length code",P.mode=30;break F}f=65535&L,i&=15,i&&(N<i&&(e+=p[Q++]<<N,N+=8),f+=e&(1<<i)-1,e>>>=i,N-=i),N<15&&(e+=p[Q++]<<N,N+=8,e+=p[Q++]<<N,N+=8),L=E[e&X];Q:for(;;){if(i=L>>>24,e>>>=i,N-=i,i=L>>>16&255,!(16&i)){if(0===(64&i)){L=E[(65535&L)+(e&(1<<i)-1)];continue Q}F.FQ="invalid distance code",P.mode=30;break F}if(k=65535&L,i&=15,N<i&&(e+=p[Q++]<<N,N+=8,N<i&&(e+=p[Q++]<<N,N+=8)),k+=e&(1<<i)-1,k>W){F.FQ="invalid distance too far back",P.mode=30;break F}if(e>>>=i,N-=i,i=z-t,k>i){if(i=k-i,i>q&&P.sane){F.FQ="invalid distance too far back",P.mode=30;break F}if(m=0,R=K,0===G){if(m+=Z-i,i<f){f-=i;do{D[z++]=K[m++]}while(--i);m=z-k,R=D}}else if(G<i){if(m+=Z+G-i,i-=G,i<f){f-=i;do{D[z++]=K[m++]}while(--i);if(m=0,G<f){i=G,f-=i;do{D[z++]=K[m++]}while(--i);m=z-k,R=D}}}else if(m+=G-i,i<f){f-=i;do{D[z++]=K[m++]}while(--i);m=z-k,R=D}for(;f>2;)D[z++]=R[m++],D[z++]=R[m++],D[z++]=R[m++],f-=3;f&&(D[z++]=R[m++],f>1&&(D[z++]=R[m++]))}else{m=z-k;do{D[z++]=D[m++],D[z++]=D[m++],D[z++]=D[m++],f-=3}while(f>2);f&&(D[z++]=D[m++],f>1&&(D[z++]=D[m++]))}break}}break}}while(Q<C&&z<g);f=N>>3,Q-=f,N-=f<<3,e&=(1<<N)-1,F.next_in=Q,F.next_out=z,F.avail_in=Q<C?C-Q+5:5-(Q-C),F.avail_out=z<g?g-z+257:257-(z-g),P.hold=e,P.bits=N}},12427:(F,b,Q)=>{"use strict";const C=Q(12387),z=Q(12389),t=Q(12429),g=Q(12431),{Z_FINISH:W,Z_BLOCK:Z,Z_TREES:q,Z_OK:G,Z_STREAM_END:K,Z_NEED_DICT:e,Z_STREAM_ERROR:N,Z_DATA_ERROR:y,Z_MEM_ERROR:E,Z_BUF_ERROR:c,Z_DEFLATED:X}=Q(12404),L=12,i=30,f=F=>(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24);function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const m=F=>{if(!F||!F.state)return N;const b=F.state;return F.total_in=F.total_out=b.total=0,F.FQ="",b.wrap&&(F.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,G},R=F=>{if(!F||!F.state)return N;const b=F.state;return b.wsize=0,b.whave=0,b.wnext=0,m(F)},p=(F,b)=>{let Q;if(!F||!F.state)return N;const C=F.state;return b<0?(Q=0,b=-b):(Q=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?N:(null!==C.window&&C.wbits!==b&&(C.window=null),C.wrap=Q,C.wbits=b,R(F))},D=(F,b)=>{if(!F)return N;const Q=new k;F.state=Q,Q.window=null;const C=p(F,b);return C!==G&&(F.state=null),C};let P,n,j=!0;const w=F=>{if(j){P=new Int32Array(512),n=new Int32Array(32);let b=0;for(;b<144;)F.lens[b++]=8;for(;b<256;)F.lens[b++]=9;for(;b<280;)F.lens[b++]=7;for(;b<288;)F.lens[b++]=8;for(g(1,F.lens,0,288,P,0,F.work,{bits:9}),b=0;b<32;)F.lens[b++]=5;g(2,F.lens,0,32,n,0,F.work,{bits:5}),j=!1}F.lencode=P,F.lenbits=9,F.distcode=n,F.distbits=5},Y=(F,b,Q,C)=>{let z;const t=F.state;return null===t.window&&(t.wsize=1<<t.wbits,t.wnext=0,t.whave=0,t.window=new Uint8Array(t.wsize)),C>=t.wsize?(t.window.set(b.subarray(Q-t.wsize,Q),0),t.wnext=0,t.whave=t.wsize):(z=t.wsize-t.wnext,z>C&&(z=C),t.window.set(b.subarray(Q-C,Q-C+z),t.wnext),(C-=z)?(t.window.set(b.subarray(Q-C,Q),0),t.wnext=C,t.whave=t.wsize):(t.wnext+=z,t.wnext===t.wsize&&(t.wnext=0),t.whave<t.wsize&&(t.whave+=z))),0};F.exports.inflateReset=R,F.exports.inflateReset2=p,F.exports.inflateResetKeep=m,F.exports.inflateInit=F=>D(F,15),F.exports.inflateInit2=D,F.exports.inflate=(F,b)=>{let Q,k,m,R,p,D,P,n,j,s,V,h,l,T,o,S,O,x,a,A,U,u,v=0;const J=new Uint8Array(4);let I,M;const r=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!F||!F.state||!F.output||!F.input&&0!==F.avail_in)return N;Q=F.state,Q.mode===L&&(Q.mode=13),p=F.next_out,m=F.output,P=F.avail_out,R=F.next_in,k=F.input,D=F.avail_in,n=Q.hold,j=Q.bits,s=D,V=P,u=G;F:for(;;)switch(Q.mode){case 1:if(0===Q.wrap){Q.mode=13;break}for(;j<16;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(2&Q.wrap&&35615===n){Q.check=0,J[0]=255&n,J[1]=n>>>8&255,Q.check=z(Q.check,J,2,0),n=0,j=0,Q.mode=2;break}if(Q.flags=0,Q.head&&(Q.head.done=!1),!(1&Q.wrap)||(((255&n)<<8)+(n>>8))%31){F.FQ="incorrect header check",Q.mode=i;break}if((15&n)!==X){F.FQ="unknown compression method",Q.mode=i;break}if(n>>>=4,j-=4,U=8+(15&n),0===Q.wbits)Q.wbits=U;else if(U>Q.wbits){F.FQ="invalid window size",Q.mode=i;break}Q.dmax=1<<Q.wbits,F.adler=Q.check=1,Q.mode=512&n?10:L,n=0,j=0;break;case 2:for(;j<16;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(Q.flags=n,(255&Q.flags)!==X){F.FQ="unknown compression method",Q.mode=i;break}if(57344&Q.flags){F.FQ="unknown header flags set",Q.mode=i;break}Q.head&&(Q.head.text=n>>8&1),512&Q.flags&&(J[0]=255&n,J[1]=n>>>8&255,Q.check=z(Q.check,J,2,0)),n=0,j=0,Q.mode=3;case 3:for(;j<32;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}Q.head&&(Q.head.time=n),512&Q.flags&&(J[0]=255&n,J[1]=n>>>8&255,J[2]=n>>>16&255,J[3]=n>>>24&255,Q.check=z(Q.check,J,4,0)),n=0,j=0,Q.mode=4;case 4:for(;j<16;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}Q.head&&(Q.head.xflags=255&n,Q.head.os=n>>8),512&Q.flags&&(J[0]=255&n,J[1]=n>>>8&255,Q.check=z(Q.check,J,2,0)),n=0,j=0,Q.mode=5;case 5:if(1024&Q.flags){for(;j<16;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}Q.length=n,Q.head&&(Q.head.extra_len=n),512&Q.flags&&(J[0]=255&n,J[1]=n>>>8&255,Q.check=z(Q.check,J,2,0)),n=0,j=0}else Q.head&&(Q.head.extra=null);Q.mode=6;case 6:if(1024&Q.flags&&(h=Q.length,h>D&&(h=D),h&&(Q.head&&(U=Q.head.extra_len-Q.length,Q.head.extra||(Q.head.extra=new Uint8Array(Q.head.extra_len)),Q.head.extra.set(k.subarray(R,R+h),U)),512&Q.flags&&(Q.check=z(Q.check,k,h,R)),D-=h,R+=h,Q.length-=h),Q.length))break F;Q.length=0,Q.mode=7;case 7:if(2048&Q.flags){if(0===D)break F;h=0;do{U=k[R+h++],Q.head&&U&&Q.length<65536&&(Q.head.name+=String.fromCharCode(U))}while(U&&h<D);if(512&Q.flags&&(Q.check=z(Q.check,k,h,R)),D-=h,R+=h,U)break F}else Q.head&&(Q.head.name=null);Q.length=0,Q.mode=8;case 8:if(4096&Q.flags){if(0===D)break F;h=0;do{U=k[R+h++],Q.head&&U&&Q.length<65536&&(Q.head.comment+=String.fromCharCode(U))}while(U&&h<D);if(512&Q.flags&&(Q.check=z(Q.check,k,h,R)),D-=h,R+=h,U)break F}else Q.head&&(Q.head.comment=null);Q.mode=9;case 9:if(512&Q.flags){for(;j<16;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(n!==(65535&Q.check)){F.FQ="header crc mismatch",Q.mode=i;break}n=0,j=0}Q.head&&(Q.head.hcrc=Q.flags>>9&1,Q.head.done=!0),F.adler=Q.check=0,Q.mode=L;break;case 10:for(;j<32;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}F.adler=Q.check=f(n),n=0,j=0,Q.mode=11;case 11:if(0===Q.havedict)return F.next_out=p,F.avail_out=P,F.next_in=R,F.avail_in=D,Q.hold=n,Q.bits=j,e;F.adler=Q.check=1,Q.mode=L;case L:if(b===Z||b===q)break F;case 13:if(Q.last){n>>>=7&j,j-=7&j,Q.mode=27;break}for(;j<3;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}switch(Q.last=1&n,n>>>=1,j-=1,3&n){case 0:Q.mode=14;break;case 1:if(w(Q),Q.mode=20,b===q){n>>>=2,j-=2;break F}break;case 2:Q.mode=17;break;case 3:F.FQ="invalid block type",Q.mode=i}n>>>=2,j-=2;break;case 14:for(n>>>=7&j,j-=7&j;j<32;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if((65535&n)!==(n>>>16^65535)){F.FQ="invalid stored block lengths",Q.mode=i;break}if(Q.length=65535&n,n=0,j=0,Q.mode=15,b===q)break F;case 15:Q.mode=16;case 16:if(h=Q.length,h){if(h>D&&(h=D),h>P&&(h=P),0===h)break F;m.set(k.subarray(R,R+h),p),D-=h,R+=h,P-=h,p+=h,Q.length-=h;break}Q.mode=L;break;case 17:for(;j<14;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(Q.nlen=257+(31&n),n>>>=5,j-=5,Q.ndist=1+(31&n),n>>>=5,j-=5,Q.ncode=4+(15&n),n>>>=4,j-=4,Q.nlen>286||Q.ndist>30){F.FQ="too many length or distance symbols",Q.mode=i;break}Q.have=0,Q.mode=18;case 18:for(;Q.have<Q.ncode;){for(;j<3;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}Q.lens[r[Q.have++]]=7&n,n>>>=3,j-=3}for(;Q.have<19;)Q.lens[r[Q.have++]]=0;if(Q.lencode=Q.lendyn,Q.lenbits=7,I={bits:Q.lenbits},u=g(0,Q.lens,0,19,Q.lencode,0,Q.work,I),Q.lenbits=I.bits,u){F.FQ="invalid code lengths set",Q.mode=i;break}Q.have=0,Q.mode=19;case 19:for(;Q.have<Q.nlen+Q.ndist;){for(;v=Q.lencode[n&(1<<Q.lenbits)-1],o=v>>>24,S=v>>>16&255,O=65535&v,!(o<=j);){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(O<16)n>>>=o,j-=o,Q.lens[Q.have++]=O;else{if(16===O){for(M=o+2;j<M;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(n>>>=o,j-=o,0===Q.have){F.FQ="invalid bit length repeat",Q.mode=i;break}U=Q.lens[Q.have-1],h=3+(3&n),n>>>=2,j-=2}else if(17===O){for(M=o+3;j<M;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}n>>>=o,j-=o,U=0,h=3+(7&n),n>>>=3,j-=3}else{for(M=o+7;j<M;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}n>>>=o,j-=o,U=0,h=11+(127&n),n>>>=7,j-=7}if(Q.have+h>Q.nlen+Q.ndist){F.FQ="invalid bit length repeat",Q.mode=i;break}for(;h--;)Q.lens[Q.have++]=U}}if(Q.mode===i)break;if(0===Q.lens[256]){F.FQ="invalid code -- missing end-of-block",Q.mode=i;break}if(Q.lenbits=9,I={bits:Q.lenbits},u=g(1,Q.lens,0,Q.nlen,Q.lencode,0,Q.work,I),Q.lenbits=I.bits,u){F.FQ="invalid literal/lengths set",Q.mode=i;break}if(Q.distbits=6,Q.distcode=Q.distdyn,I={bits:Q.distbits},u=g(2,Q.lens,Q.nlen,Q.ndist,Q.distcode,0,Q.work,I),Q.distbits=I.bits,u){F.FQ="invalid distances set",Q.mode=i;break}if(Q.mode=20,b===q)break F;case 20:Q.mode=21;case 21:if(D>=6&&P>=258){F.next_out=p,F.avail_out=P,F.next_in=R,F.avail_in=D,Q.hold=n,Q.bits=j,t(F,V),p=F.next_out,m=F.output,P=F.avail_out,R=F.next_in,k=F.input,D=F.avail_in,n=Q.hold,j=Q.bits,Q.mode===L&&(Q.back=-1);break}for(Q.back=0;v=Q.lencode[n&(1<<Q.lenbits)-1],o=v>>>24,S=v>>>16&255,O=65535&v,!(o<=j);){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(S&&0===(240&S)){for(x=o,a=S,A=O;v=Q.lencode[A+((n&(1<<x+a)-1)>>x)],o=v>>>24,S=v>>>16&255,O=65535&v,!(x+o<=j);){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}n>>>=x,j-=x,Q.back+=x}if(n>>>=o,j-=o,Q.back+=o,Q.length=O,0===S){Q.mode=26;break}if(32&S){Q.back=-1,Q.mode=L;break}if(64&S){F.FQ="invalid literal/length code",Q.mode=i;break}Q.extra=15&S,Q.mode=22;case 22:if(Q.extra){for(M=Q.extra;j<M;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}Q.length+=n&(1<<Q.extra)-1,n>>>=Q.extra,j-=Q.extra,Q.back+=Q.extra}Q.was=Q.length,Q.mode=23;case 23:for(;v=Q.distcode[n&(1<<Q.distbits)-1],o=v>>>24,S=v>>>16&255,O=65535&v,!(o<=j);){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(0===(240&S)){for(x=o,a=S,A=O;v=Q.distcode[A+((n&(1<<x+a)-1)>>x)],o=v>>>24,S=v>>>16&255,O=65535&v,!(x+o<=j);){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}n>>>=x,j-=x,Q.back+=x}if(n>>>=o,j-=o,Q.back+=o,64&S){F.FQ="invalid distance code",Q.mode=i;break}Q.offset=O,Q.extra=15&S,Q.mode=24;case 24:if(Q.extra){for(M=Q.extra;j<M;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}Q.offset+=n&(1<<Q.extra)-1,n>>>=Q.extra,j-=Q.extra,Q.back+=Q.extra}if(Q.offset>Q.dmax){F.FQ="invalid distance too far back",Q.mode=i;break}Q.mode=25;case 25:if(0===P)break F;if(h=V-P,Q.offset>h){if(h=Q.offset-h,h>Q.whave&&Q.sane){F.FQ="invalid distance too far back",Q.mode=i;break}h>Q.wnext?(h-=Q.wnext,l=Q.wsize-h):l=Q.wnext-h,h>Q.length&&(h=Q.length),T=Q.window}else T=m,l=p-Q.offset,h=Q.length;h>P&&(h=P),P-=h,Q.length-=h;do{m[p++]=T[l++]}while(--h);0===Q.length&&(Q.mode=21);break;case 26:if(0===P)break F;m[p++]=Q.length,P--,Q.mode=21;break;case 27:if(Q.wrap){for(;j<32;){if(0===D)break F;D--,n|=k[R++]<<j,j+=8}if(V-=P,F.total_out+=V,Q.total+=V,V&&(F.adler=Q.check=Q.flags?z(Q.check,m,V,p-V):C(Q.check,m,V,p-V)),V=P,(Q.flags?n:f(n))!==Q.check){F.FQ="incorrect data check",Q.mode=i;break}n=0,j=0}Q.mode=28;case 28:if(Q.wrap&&Q.flags){for(;j<32;){if(0===D)break F;D--,n+=k[R++]<<j,j+=8}if(n!==(4294967295&Q.total)){F.FQ="incorrect length check",Q.mode=i;break}n=0,j=0}Q.mode=29;case 29:u=K;break F;case i:u=y;break F;case 31:return E;default:return N}return F.next_out=p,F.avail_out=P,F.next_in=R,F.avail_in=D,Q.hold=n,Q.bits=j,(Q.wsize||V!==F.avail_out&&Q.mode<i&&(Q.mode<27||b!==W))&&Y(F,F.output,F.next_out,V-F.avail_out)?(Q.mode=31,E):(s-=F.avail_in,V-=F.avail_out,F.total_in+=s,F.total_out+=V,Q.total+=V,Q.wrap&&V&&(F.adler=Q.check=Q.flags?z(Q.check,m,V,F.next_out-V):C(Q.check,m,V,F.next_out-V)),F.data_type=Q.bits+(Q.last?64:0)+(Q.mode===L?128:0)+(20===Q.mode||15===Q.mode?256:0),(0===s&&0===V||b===W)&&u===G&&(u=c),u)},F.exports.inflateEnd=F=>{if(!F||!F.state)return N;let b=F.state;return b.window&&(b.window=null),F.state=null,G},F.exports.inflateGetHeader=(F,b)=>{if(!F||!F.state)return N;const Q=F.state;return 0===(2&Q.wrap)?N:(Q.head=b,b.done=!1,G)},F.exports.inflateSetDictionary=(F,b)=>{const Q=b.length;let z,t,g;return F&&F.state?(z=F.state,0!==z.wrap&&11!==z.mode?N:11===z.mode&&(t=1,t=C(t,b,Q,0),t!==z.check)?y:(g=Y(F,b,Q,Q),g?(z.mode=31,E):(z.havedict=1,G))):N},F.exports.inflateInfo="pako inflate (from Nodeca project)"},12431:F=>{"use strict";const b=15,Q=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),C=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),z=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),t=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);F.exports=(F,g,W,Z,q,G,K,e)=>{const N=e.bits;let y,E,c,X,L,i,f=0,k=0,m=0,R=0,p=0,D=0,P=0,n=0,j=0,w=0,Y=null,s=0;const V=new Uint16Array(16),h=new Uint16Array(16);let l,T,o,S=null,O=0;for(f=0;f<=b;f++)V[f]=0;for(k=0;k<Z;k++)V[g[W+k]]++;for(p=N,R=b;R>=1&&0===V[R];R--);if(p>R&&(p=R),0===R)return q[G++]=20971520,q[G++]=20971520,e.bits=1,0;for(m=1;m<R&&0===V[m];m++);for(p<m&&(p=m),n=1,f=1;f<=b;f++)if(n<<=1,n-=V[f],n<0)return-1;if(n>0&&(0===F||1!==R))return-1;for(h[1]=0,f=1;f<b;f++)h[f+1]=h[f]+V[f];for(k=0;k<Z;k++)0!==g[W+k]&&(K[h[g[W+k]]++]=k);if(0===F?(Y=S=K,i=19):1===F?(Y=Q,s-=257,S=C,O-=257,i=256):(Y=z,S=t,i=-1),w=0,k=0,f=m,L=G,D=p,P=0,c=-1,j=1<<p,X=j-1,1===F&&j>852||2===F&&j>592)return 1;for(;;){l=f-P,K[k]<i?(T=0,o=K[k]):K[k]>i?(T=S[O+K[k]],o=Y[s+K[k]]):(T=96,o=0),y=1<<f-P,E=1<<D,m=E;do{E-=y,q[L+(w>>P)+E]=l<<24|T<<16|o}while(0!==E);for(y=1<<f-1;w&y;)y>>=1;if(0!==y?(w&=y-1,w+=y):w=0,k++,0===--V[f]){if(f===R)break;f=g[W+K[k]]}if(f>p&&(w&X)!==c){for(0===P&&(P=p),L+=m,D=f-P,n=1<<D;D+P<R&&(n-=V[D+P],!(n<=0));)D++,n<<=1;if(j+=1<<D,1===F&&j>852||2===F&&j>592)return 1;c=w&X,q[c]=p<<24|D<<16|L-G}}return 0!==w&&(q[L+w]=f-P<<24|64<<16),e.bits=p,0}},12397:F=>{"use strict";F.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12384:F=>{"use strict";function b(F){let b=F.length;for(;--b>=0;)F[b]=0}const Q=256,C=286,z=30,t=15,g=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),W=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Z=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),q=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),G=new Array(576);b(G);const K=new Array(60);b(K);const e=new Array(512);b(e);const N=new Array(256);b(N);const y=new Array(29);b(y);const E=new Array(z);function c(F,b,Q,C,z){this.static_tree=F,this.extra_bits=b,this.extra_base=Q,this.elems=C,this.max_length=z,this.has_stree=F&&F.length}let X,L,i;function f(F,b){this.dyn_tree=F,this.max_code=0,this.stat_desc=b}b(E);const k=F=>F<256?e[F]:e[256+(F>>>7)],m=(F,b)=>{F.pending_buf[F.pending++]=255&b,F.pending_buf[F.pending++]=b>>>8&255},R=(F,b,Q)=>{F.bi_valid>16-Q?(F.bi_buf|=b<<F.bi_valid&65535,m(F,F.bi_buf),F.bi_buf=b>>16-F.bi_valid,F.bi_valid+=Q-16):(F.bi_buf|=b<<F.bi_valid&65535,F.bi_valid+=Q)},p=(F,b,Q)=>{R(F,Q[2*b],Q[2*b+1])},D=(F,b)=>{let Q=0;do{Q|=1&F,F>>>=1,Q<<=1}while(--b>0);return Q>>>1},P=(F,b,Q)=>{const C=new Array(16);let z,g,W=0;for(z=1;z<=t;z++)C[z]=W=W+Q[z-1]<<1;for(g=0;g<=b;g++){let b=F[2*g+1];0!==b&&(F[2*g]=D(C[b]++,b))}},n=F=>{let b;for(b=0;b<C;b++)F.dyn_ltree[2*b]=0;for(b=0;b<z;b++)F.dyn_dtree[2*b]=0;for(b=0;b<19;b++)F.bl_tree[2*b]=0;F.dyn_ltree[512]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0},j=F=>{F.bi_valid>8?m(F,F.bi_buf):F.bi_valid>0&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0},w=(F,b,Q,C)=>{const z=2*b,t=2*Q;return F[z]<F[t]||F[z]===F[t]&&C[b]<=C[Q]},Y=(F,b,Q)=>{const C=F.heap[Q];let z=Q<<1;for(;z<=F.heap_len&&(z<F.heap_len&&w(b,F.heap[z+1],F.heap[z],F.depth)&&z++,!w(b,C,F.heap[z],F.depth));)F.heap[Q]=F.heap[z],Q=z,z<<=1;F.heap[Q]=C},s=(F,b,C)=>{let z,t,Z,q,G=0;if(0!==F.last_lit)do{z=F.pending_buf[F.d_buf+2*G]<<8|F.pending_buf[F.d_buf+2*G+1],t=F.pending_buf[F.l_buf+G],G++,0===z?p(F,t,b):(Z=N[t],p(F,Z+Q+1,b),q=g[Z],0!==q&&(t-=y[Z],R(F,t,q)),z--,Z=k(z),p(F,Z,C),q=W[Z],0!==q&&(z-=E[Z],R(F,z,q)))}while(G<F.last_lit);p(F,256,b)},V=(F,b)=>{const Q=b.dyn_tree,C=b.stat_desc.static_tree,z=b.stat_desc.has_stree,g=b.stat_desc.elems;let W,Z,q,G=-1;for(F.heap_len=0,F.heap_max=573,W=0;W<g;W++)0!==Q[2*W]?(F.heap[++F.heap_len]=G=W,F.depth[W]=0):Q[2*W+1]=0;for(;F.heap_len<2;)q=F.heap[++F.heap_len]=G<2?++G:0,Q[2*q]=1,F.depth[q]=0,F.opt_len--,z&&(F.static_len-=C[2*q+1]);for(b.max_code=G,W=F.heap_len>>1;W>=1;W--)Y(F,Q,W);q=g;do{W=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Y(F,Q,1),Z=F.heap[1],F.heap[--F.heap_max]=W,F.heap[--F.heap_max]=Z,Q[2*q]=Q[2*W]+Q[2*Z],F.depth[q]=(F.depth[W]>=F.depth[Z]?F.depth[W]:F.depth[Z])+1,Q[2*W+1]=Q[2*Z+1]=q,F.heap[1]=q++,Y(F,Q,1)}while(F.heap_len>=2);F.heap[--F.heap_max]=F.heap[1],((F,b)=>{const Q=b.dyn_tree,C=b.max_code,z=b.stat_desc.static_tree,g=b.stat_desc.has_stree,W=b.stat_desc.extra_bits,Z=b.stat_desc.extra_base,q=b.stat_desc.max_length;let G,K,e,N,y,E,c=0;for(N=0;N<=t;N++)F.bl_count[N]=0;for(Q[2*F.heap[F.heap_max]+1]=0,G=F.heap_max+1;G<573;G++)K=F.heap[G],N=Q[2*Q[2*K+1]+1]+1,N>q&&(N=q,c++),Q[2*K+1]=N,K>C||(F.bl_count[N]++,y=0,K>=Z&&(y=W[K-Z]),E=Q[2*K],F.opt_len+=E*(N+y),g&&(F.static_len+=E*(z[2*K+1]+y)));if(0!==c){do{for(N=q-1;0===F.bl_count[N];)N--;F.bl_count[N]--,F.bl_count[N+1]+=2,F.bl_count[q]--,c-=2}while(c>0);for(N=q;0!==N;N--)for(K=F.bl_count[N];0!==K;)e=F.heap[--G],e>C||(Q[2*e+1]!==N&&(F.opt_len+=(N-Q[2*e+1])*Q[2*e],Q[2*e+1]=N),K--)}})(F,b),P(Q,G,F.bl_count)},h=(F,b,Q)=>{let C,z,t=-1,g=b[1],W=0,Z=7,q=4;for(0===g&&(Z=138,q=3),b[2*(Q+1)+1]=65535,C=0;C<=Q;C++)z=g,g=b[2*(C+1)+1],++W<Z&&z===g||(W<q?F.bl_tree[2*z]+=W:0!==z?(z!==t&&F.bl_tree[2*z]++,F.bl_tree[32]++):W<=10?F.bl_tree[34]++:F.bl_tree[36]++,W=0,t=z,0===g?(Z=138,q=3):z===g?(Z=6,q=3):(Z=7,q=4))},l=(F,b,Q)=>{let C,z,t=-1,g=b[1],W=0,Z=7,q=4;for(0===g&&(Z=138,q=3),C=0;C<=Q;C++)if(z=g,g=b[2*(C+1)+1],!(++W<Z&&z===g)){if(W<q)do{p(F,z,F.bl_tree)}while(0!==--W);else 0!==z?(z!==t&&(p(F,z,F.bl_tree),W--),p(F,16,F.bl_tree),R(F,W-3,2)):W<=10?(p(F,17,F.bl_tree),R(F,W-3,3)):(p(F,18,F.bl_tree),R(F,W-11,7));W=0,t=z,0===g?(Z=138,q=3):z===g?(Z=6,q=3):(Z=7,q=4)}};let T=!1;const o=(F,b,Q,C)=>{R(F,0+(C?1:0),3),((F,b,Q,C)=>{j(F),C&&(m(F,Q),m(F,~Q)),F.pending_buf.set(F.window.subarray(b,b+Q),F.pending),F.pending+=Q})(F,b,Q,!0)};F.exports._tr_init=F=>{T||((()=>{let F,b,Q,q,f;const k=new Array(16);for(Q=0,q=0;q<28;q++)for(y[q]=Q,F=0;F<1<<g[q];F++)N[Q++]=q;for(N[Q-1]=q,f=0,q=0;q<16;q++)for(E[q]=f,F=0;F<1<<W[q];F++)e[f++]=q;for(f>>=7;q<z;q++)for(E[q]=f<<7,F=0;F<1<<W[q]-7;F++)e[256+f++]=q;for(b=0;b<=t;b++)k[b]=0;for(F=0;F<=143;)G[2*F+1]=8,F++,k[8]++;for(;F<=255;)G[2*F+1]=9,F++,k[9]++;for(;F<=279;)G[2*F+1]=7,F++,k[7]++;for(;F<=287;)G[2*F+1]=8,F++,k[8]++;for(P(G,287,k),F=0;F<z;F++)K[2*F+1]=5,K[2*F]=D(F,5);X=new c(G,g,257,C,t),L=new c(K,W,0,z,t),i=new c(new Array(0),Z,0,19,7)})(),T=!0),F.l_desc=new f(F.dyn_ltree,X),F.d_desc=new f(F.dyn_dtree,L),F.bl_desc=new f(F.bl_tree,i),F.bi_buf=0,F.bi_valid=0,n(F)},F.exports._tr_stored_block=o,F.exports._tr_flush_block=(F,b,C,z)=>{let t,g,W=0;F.level>0?(2===F.strm.data_type&&(F.strm.data_type=(F=>{let b,C=4093624447;for(b=0;b<=31;b++,C>>>=1)if(1&C&&0!==F.dyn_ltree[2*b])return 0;if(0!==F.dyn_ltree[18]||0!==F.dyn_ltree[20]||0!==F.dyn_ltree[26])return 1;for(b=32;b<Q;b++)if(0!==F.dyn_ltree[2*b])return 1;return 0})(F)),V(F,F.l_desc),V(F,F.d_desc),W=(F=>{let b;for(h(F,F.dyn_ltree,F.l_desc.max_code),h(F,F.dyn_dtree,F.d_desc.max_code),V(F,F.bl_desc),b=18;b>=3&&0===F.bl_tree[2*q[b]+1];b--);return F.opt_len+=3*(b+1)+5+5+4,b})(F),t=F.opt_len+3+7>>>3,g=F.static_len+3+7>>>3,g<=t&&(t=g)):t=g=C+5,C+4<=t&&-1!==b?o(F,b,C,z):4===F.strategy||g===t?(R(F,2+(z?1:0),3),s(F,G,K)):(R(F,4+(z?1:0),3),((F,b,Q,C)=>{let z;for(R(F,b-257,5),R(F,Q-1,5),R(F,C-4,4),z=0;z<C;z++)R(F,F.bl_tree[2*q[z]+1],3);l(F,F.dyn_ltree,b-1),l(F,F.dyn_dtree,Q-1)})(F,F.l_desc.max_code+1,F.d_desc.max_code+1,W+1),s(F,F.dyn_ltree,F.dyn_dtree)),n(F),z&&j(F)},F.exports._tr_tally=(F,b,C)=>(F.pending_buf[F.d_buf+2*F.last_lit]=b>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&b,F.pending_buf[F.l_buf+F.last_lit]=255&C,F.last_lit++,0===b?F.dyn_ltree[2*C]++:(F.matches++,b--,F.dyn_ltree[2*(N[C]+Q+1)]++,F.dyn_dtree[2*k(b)]++),F.last_lit===F.lit_bufsize-1),F.exports._tr_align=F=>{R(F,2,3),p(F,256,G),(F=>{16===F.bi_valid?(m(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):F.bi_valid>=8&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)})(F)}},12415:F=>{"use strict";F.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.FQ="",this.state=null,this.data_type=2,this.adler=0}},12075:F=>{function b(F,b,Q){for(var C=F.length,z=-1/0,t=1/0,g=0;g<C;g++){var W=(Q[0][g]-F[g])/b[g],Z=(Q[1][g]-F[g])/b[g];if(W>Z){var q=W;W=Z,Z=q}if(Z<z||W>t)return 1/0;W>z&&(z=W),Z<t&&(t=Z)}return z>t?1/0:z}F.exports=function(F,Q,C,z){var t=b(Q,C,z);if(t===1/0)F=null;else{F=F||[];for(var g=0;g<Q.length;g++)F[g]=Q[g]+C[g]*t}return F},F.exports.distance=b},13418:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>g});var C=Q(25);const z=C.useLayoutEffect;const t=function(F){var b=(0,C.useRef)(F);return z((function(){b.current=F})),b};var g=function(F){var b=t(F);(0,C.Db)((function(){var F=function(F){var Q;if(null!=b.current&&(Q=b.current(F)),F.defaultPrevented&&(F.returnValue=""),"string"===typeof Q)return F.returnValue=Q,Q};return window.addEventListener("beforeunload",F),function(){window.removeEventListener("beforeunload",F)}}),[])}},13378:(F,b,Q)=>{"use strict";var C=Q(13383),z=Array.prototype.concat,t=Array.prototype.slice,g=F.exports=function(F){for(var b=[],Q=0,g=F.length;Q<g;Q++){var W=F[Q];C(W)?b=z.call(b,t.call(W)):b.push(W)}return b};g.wrap=function(F){return function(){return F(g(arguments))}}},13383:F=>{F.exports=function(F){return!(!F||"string"===typeof F)&&(F instanceof Array||Array.isArray(F)||F.length>=0&&(F.splice instanceof Function||Object.getOwnPropertyDescriptor(F,F.length-1)&&"String"!==F.constructor.name))}},12333:(F,b,Q)=>{var C=Q(12340);function z(F){for(var b,Q,z=0,t=F.length,g=0;g<F.length;){for(b=F[g],Q=0;g<t&&F[g]===b;)++g,++Q;z+=C.log2(Q)/7|0,z+=C.log2(b>>>0)/7|0,z+=2}return z}b.size=z,b.encode=function(F,b){b||(b=new Uint8Array(z(F)));for(var Q,C,t=0,g=b.length,W=0;W<F.length;){for(Q=F[W],C=0;W<F.length&&F[W]===Q;)++W,++C;for(;t<g&&C>=128;)b[t++]=128+(127&C),C>>>=7;if(t>=g)throw new Error("RLE buffer overflow");for(b[t++]=C,Q>>>=0;t<g&&Q>=128;)b[t++]=128+(127&Q),Q>>>=7;if(t>=g)throw new Error("RLE buffer overflow");b[t++]=Q}return b},b.decode=function(F,b){for(var Q,C,z,t,g=b.length,W=F.length,Z=0,q=0;q<W;){for(Q=0,C=0;q<W&&F[q]>=128;)Q+=(127&F[q++])<<C,C+=7;if(Q+=F[q++]<<C,q>=W)throw new Error("RLE buffer underrun");if(Z+Q>g)throw new Error("Chunk buffer overflow");for(z=0,C=0;q<W&&F[q]>=128;)z+=(127&F[q++])<<C,C+=7;if(q>=W)throw new Error("RLE buffer underrun");for(z+=F[q++]<<C,t=0;t<Q;++t)b[Z++]=z}return b}},12340:(F,b)=>{"use strict";function Q(F){var b=32;return(F&=-F)&&b--,65535&F&&(b-=16),16711935&F&&(b-=8),252645135&F&&(b-=4),858993459&F&&(b-=2),1431655765&F&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(F){return(F>0)-(F<0)},b.abs=function(F){var b=F>>31;return(F^b)-b},b.min=function(F,b){return b^(F^b)&-(F<b)},b.max=function(F,b){return F^(F^b)&-(F<b)},b.isPow2=function(F){return!(F&F-1)&&!!F},b.log2=function(F){var b,Q;return b=(F>65535)<<4,b|=Q=((F>>>=b)>255)<<3,b|=Q=((F>>>=Q)>15)<<2,(b|=Q=((F>>>=Q)>3)<<1)|(F>>>=Q)>>1},b.log10=function(F){return F>=1e9?9:F>=1e8?8:F>=1e7?7:F>=1e6?6:F>=1e5?5:F>=1e4?4:F>=1e3?3:F>=100?2:F>=10?1:0},b.popCount=function(F){return 16843009*((F=(858993459&(F-=F>>>1&1431655765))+(F>>>2&858993459))+(F>>>4)&252645135)>>>24},b.countTrailingZeros=Q,b.nextPow2=function(F){return F+=0===F,--F,F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)+1},b.prevPow2=function(F){return F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,(F|=F>>>16)-(F>>>1)},b.parity=function(F){return F^=F>>>16,F^=F>>>8,F^=F>>>4,27030>>>(F&=15)&1};var C=new Array(256);!function(F){for(var b=0;b<256;++b){var Q=b,C=b,z=7;for(Q>>>=1;Q;Q>>>=1)C<<=1,C|=1&Q,--z;F[b]=C<<z&255}}(C),b.reverse=function(F){return C[255&F]<<24|C[F>>>8&255]<<16|C[F>>>16&255]<<8|C[F>>>24&255]},b.interleave2=function(F,b){return(F=1431655765&((F=858993459&((F=252645135&((F=16711935&((F&=65535)|F<<8))|F<<4))|F<<2))|F<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(F,b){return(F=65535&((F=16711935&((F=252645135&((F=858993459&((F=F>>>b&1431655765)|F>>>1))|F>>>2))|F>>>4))|F>>>16))<<16>>16},b.interleave3=function(F,b,Q){return F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2),(F|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(Q=1227133513&((Q=3272356035&((Q=251719695&((Q=4278190335&((Q&=1023)|Q<<16))|Q<<8))|Q<<4))|Q<<2))<<2},b.deinterleave3=function(F,b){return(F=1023&((F=4278190335&((F=251719695&((F=3272356035&((F=F>>>b&1227133513)|F>>>2))|F>>>4))|F>>>8))|F>>>16))<<22>>22},b.nextCombination=function(F){var b=F|F-1;return b+1|(~b&-~b)-1>>>Q(F)+1}},12362:F=>{"use strict";F.exports=function(F,b,Q,C){var z=self||window;try{try{var t;try{t=new z.Blob([F])}catch(q){(t=new(z.BlobBuilder||z.WebKitBlobBuilder||z.MozBlobBuilder||z.MSBlobBuilder)).append(F),t=t.getBlob()}var g=z.URL||z.webkitURL,W=g.createObjectURL(t),Z=new z[b](W,Q);return g.revokeObjectURL(W),Z}catch(q){return new z[b]("data:application/javascript,".concat(encodeURIComponent(F)),Q)}}catch(q){if(!C)throw Error("Inline worker is not supported");return new z[b](C,Q)}}},12053:(F,b,Q)=>{"use strict";function C(F,b,Q,C,z){var t={};return Object.keys(C).forEach((function(F){t[F]=C[F]})),t.enumerable=!!t.enumerable,t.configurable=!!t.configurable,("value"in t||t.initializer)&&(t.writable=!0),t=Q.slice().reverse().reduce((function(Q,C){return C(F,b,Q)||Q}),t),z&&void 0!==t.initializer&&(t.value=t.initializer?t.initializer.call(z):void 0,t.initializer=void 0),void 0===t.initializer&&(Object.defineProperty(F,b,t),t=null),t}Q.d(b,{d:()=>C})},12044:(F,b,Q)=>{"use strict";function C(F,b,Q,C){Q&&Object.defineProperty(F,b,{enumerable:Q.enumerable,configurable:Q.configurable,writable:Q.writable,value:Q.initializer?Q.initializer.call(C):void 0})}Q.d(b,{d:()=>C})},13413:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>g,e:()=>K,f:()=>W,i:()=>t,k:()=>Z,l:()=>z,n:()=>q,q:()=>G});var C=Q(11515);class z{constructor(){this._easingMode=z.EASINGMODE_EASEIN}setEasingMode(F){const b=Math.min(Math.max(F,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(F){throw new Error("You must implement this method")}ease(F){switch(this._easingMode){case z.EASINGMODE_EASEIN:return this.easeInCore(F);case z.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-F)}return F>=.5?.5*(1-this.easeInCore(2*(1-F)))+.5:.5*this.easeInCore(2*F)}}z.EASINGMODE_EASEIN=0,z.EASINGMODE_EASEOUT=1,z.EASINGMODE_EASEINOUT=2;class t extends z{easeInCore(F){return F=Math.max(0,Math.min(1,F)),1-Math.sqrt(1-F*F)}}class g extends z{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=F}easeInCore(F){const b=Math.max(0,this.amplitude);return Math.pow(F,3)-F*b*Math.sin(3.141592653589793*F)}}class W extends z{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=F,this.bounciness=b}easeInCore(F){const b=Math.max(0,this.bounces);let Q=this.bounciness;Q<=1&&(Q=1.001);const C=Math.pow(Q,b),z=1-Q,t=(1-C)/z+.5*C,g=F*t,W=Math.log(-g*(1-Q)+1)/Math.log(Q),Z=Math.floor(W),q=Z+1,G=(1-Math.pow(Q,Z))/(z*t),K=.5*(G+(1-Math.pow(Q,q))/(z*t)),e=F-K,N=K-G;return-Math.pow(1/Q,b-Z)/(N*N)*(e-N)*(e+N)}}class Z extends z{easeInCore(F){return F*F*F}}class q extends z{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=F,this.springiness=b}easeInCore(F){let b;const Q=Math.max(0,this.oscillations),C=Math.max(0,this.springiness);return b=0==C?F:(Math.exp(C*F)-1)/(Math.exp(C)-1),b*Math.sin((6.283185307179586*Q+1.5707963267948966)*F)}}class G extends z{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=F}easeInCore(F){return this.exponent<=0?F:(Math.exp(this.exponent*F)-1)/(Math.exp(this.exponent)-1)}}class K extends z{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=F,this.y1=b,this.x2=Q,this.y2=C}easeInCore(F){return C.e.Interpolate(F,this.x1,this.y1,this.x2,this.y2)}}},12876:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>g});var C=Q(11309),z=Q(11320),t=Q(11715);class g extends t.c{get _matrix(){return this._compose(),this.KN}set _matrix(F){(F.updateFlag!==this.KN.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.KN.W(F),this._markAsDirtyAndDecompose())}constructor(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(F,b.RF(),!1),this.name=F,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.KN=(null===z||void 0===z?void 0:z.clone())??C.Matrix.Identity(),this._restMatrix=t??this.KN.clone(),this._bindMatrix=g??this.KN.clone(),this._index=W,this._absoluteMatrix=new C.Matrix,this._absoluteBindMatrix=new C.Matrix,this._absoluteInverseBindMatrix=new C.Matrix,this._finalMatrix=new C.Matrix,b.bones.push(this),this.setParent(Q,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(F){this.setParent(F)}setParent(F){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==F){if(this.parent){const F=this.parent.children.indexOf(this);-1!==F&&this.parent.children.splice(F,1)}this._parentNode=F,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.EG()}}getLocalMatrix(){return this._compose(),this.KN}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(F){this._restMatrix.W(F)}setRestPose(F){this.setRestMatrix(F)}getBindPose(){return this.getBindMatrix()}setBindMatrix(F){this.mb(F)}setBindPose(F){this.setBindMatrix(F)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const F=C.TmpVectors.gQ[0],b=C.TmpVectors.Quaternion[0],Q=C.TmpVectors.gQ[1];this.getRestMatrix().decompose(F,b,Q),this._linkedTransformNode.position.W(Q),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??C.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.W(b),this._linkedTransformNode.wb.W(F)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(F){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=F,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.iZ}set position(F){this._decompose(),this.iZ.W(F),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(F){this.setRotation(F)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(F){this.setRotationQuaternion(F)}get wb(){return this.getScale()}set wb(F){this.setScale(F)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=C.gQ.Zero(),this._localRotation=C.Quaternion.Zero(),this.iZ=C.gQ.Zero()),this.KN.decompose(this._localScaling,this._localRotation,this.iZ))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,C.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.iZ,this.KN)):this._needToCompose=!1)}mb(F){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.W(F),b&&this._updateAbsoluteBindMatrices(),Q?this._matrix=F:this.EG()}_updateAbsoluteBindMatrices(F){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(F||(F=this._bindMatrix),this.parent?F.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.W(F),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let Q=0;Q<this.children.length;Q++)this.children[Q]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}EG(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.EG(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.EG(),this._needToDecompose=!0}_updatePosition(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const t=this.getLocalMatrix();if(0==b)z?(t.addAtIndex(12,F.x),t.addAtIndex(13,F.y),t.addAtIndex(14,F.z)):t.setTranslationFromFloats(F.x,F.y,F.z);else{let b=null;Q&&(b=Q.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const W=g._TmpMats[0],Z=g._TmpVecs[0];this.parent?Q&&b?(W.W(this.parent.getAbsoluteMatrix()),W.multiplyToRef(b,W)):W.W(this.parent.getAbsoluteMatrix()):C.Matrix.IdentityToRef(W),z&&W.setTranslationFromFloats(0,0,0),W.invert(),C.gQ.TransformCoordinatesToRef(F,W,Z),z?(t.addAtIndex(12,Z.x),t.addAtIndex(13,Z.y),t.addAtIndex(14,Z.z)):t.setTranslationFromFloats(Z.x,Z.y,Z.z)}this._markAsDirtyAndDecompose()}translate(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(F,b,Q,!0)}setPosition(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this._updatePosition(F,b,Q,!1)}setAbsolutePosition(F,b){this.setPosition(F,1,b)}scale(F,b,Q){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=this.getLocalMatrix(),W=g._TmpMats[0];C.Matrix.ScalingToRef(F,b,Q,W),W.multiplyToRef(t,t),W.invert();for(const C of this.children){const z=C.getLocalMatrix();z.multiplyToRef(W,z),z.multiplyAtIndex(12,F),z.multiplyAtIndex(13,b),z.multiplyAtIndex(14,Q),C._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),z)for(const C of this.children)C.scale(F,b,Q,z)}setScale(F){this._decompose(),this._localScaling.W(F),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(F){this._decompose(),F.W(this._localScaling)}setYawPitchRoll(F,b,Q){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4?arguments[4]:void 0;if(0===z){const W=g._TmpQuat;return C.Quaternion.RotationYawPitchRollToRef(F,b,Q,W),void this.setRotationQuaternion(W,z,t)}const W=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(W,t))return;const Z=g._TmpMats[1];C.Matrix.RotationYawPitchRollToRef(F,b,Q,Z),W.multiplyToRef(Z,Z),this._rotateWithMatrix(Z,z,t)}rotate(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3?arguments[3]:void 0;const t=g._TmpMats[0];t.setTranslationFromFloats(0,0,0),C.Matrix.RotationAxisToRef(F,b,t),this._rotateWithMatrix(t,Q,z)}setAxisAngle(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3?arguments[3]:void 0;if(0===Q){const t=g._TmpQuat;return C.Quaternion.RotationAxisToRef(F,b,t),void this.setRotationQuaternion(t,Q,z)}const t=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,z))return;const W=g._TmpMats[1];C.Matrix.RotationAxisToRef(F,b,W),t.multiplyToRef(W,W),this._rotateWithMatrix(W,Q,z)}setRotation(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(F.y,F.x,F.z,b,Q)}setRotationQuaternion(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.W(F),void this._markAsDirtyAndCompose();const z=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,Q))return;const t=g._TmpMats[1];C.Matrix.FromQuaternionToRef(F,t),z.multiplyToRef(t,t),this._rotateWithMatrix(t,b,Q)}setRotationMatrix(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;if(0===b){const z=g._TmpQuat;return C.Quaternion.FromRotationMatrixToRef(F,z),void this.setRotationQuaternion(z,b,Q)}const z=g._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,Q))return;const t=g._TmpMats[1];t.W(F),z.multiplyToRef(F,t),this._rotateWithMatrix(t,b,Q)}_rotateWithMatrix(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const C=this.getLocalMatrix(),z=C.m[12],t=C.m[13],W=C.m[14],Z=this.getParent(),q=g._TmpMats[3],G=g._TmpMats[4];Z&&1==b?(Q?(q.W(Q.getWorldMatrix()),Z.getAbsoluteMatrix().multiplyToRef(q,q)):q.W(Z.getAbsoluteMatrix()),G.W(q),G.invert(),C.multiplyToRef(q,C),C.multiplyToRef(F,C),C.multiplyToRef(G,C)):1==b&&Q?(q.W(Q.getWorldMatrix()),G.W(q),G.invert(),C.multiplyToRef(q,C),C.multiplyToRef(F,C),C.multiplyToRef(G,C)):C.multiplyToRef(F,C),C.setTranslationFromFloats(z,t,W),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(F,b){const Q=g._TmpMats[2];return F.W(this.getAbsoluteMatrix()),b?(F.multiplyToRef(b.getWorldMatrix(),F),C.Matrix.ScalingToRef(b.wb.x,b.wb.y,b.wb.z,Q)):C.Matrix.IdentityToRef(Q),F.invert(),!isNaN(F.m[0])&&(Q.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyToRef(Q,F),!0)}Wb(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=C.gQ.Zero();return this.getPositionToRef(F,b,Q),Q}getPositionToRef(){let F=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const F=this.getLocalMatrix();b.x=F.m[12],b.y=F.m[13],b.z=F.m[14]}else{let Q=null;F&&(Q=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let C=g._TmpMats[0];F&&Q?(C.W(this.getAbsoluteMatrix()),C.multiplyToRef(Q,C)):C=this.getAbsoluteMatrix(),b.x=C.m[12],b.y=C.m[13],b.z=C.m[14]}}getAbsolutePosition(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=C.gQ.Zero();return this.getPositionToRef(1,F,b),b}getAbsolutePositionToRef(F,b){this.getPositionToRef(1,F,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.KN.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.W(this.KN);const F=this._skeleton.getPoseMatrix();F&&this._absoluteMatrix.multiplyToRef(F,this._absoluteMatrix)}const F=this.children,b=F.length;for(let Q=0;Q<b;Q++)F[Q].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}IZ(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=C.gQ.Zero();return this.getDirectionToRef(F,b,Q),Q}getDirectionToRef(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,z=null;b&&(z=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=g._TmpMats[0];t.W(this.getAbsoluteMatrix()),b&&z&&t.multiplyToRef(z,t),C.gQ.TransformNormalToRef(F,t,Q),Q.normalize()}getRotation(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=C.gQ.Zero();return this.getRotationToRef(F,b,Q),Q}getRotationToRef(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;const C=g._TmpQuat;this.getRotationQuaternionToRef(F,b,C),C.toEulerAnglesToRef(Q)}getRotationQuaternion(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=C.Quaternion.Identity();return this.getRotationQuaternionToRef(F,b,Q),Q}getRotationQuaternionToRef(){let F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.W(this._localRotation);else{const Q=g._TmpMats[0],C=this.getAbsoluteMatrix();F?C.multiplyToRef(F.getWorldMatrix(),Q):Q.W(C),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.decompose(void 0,b,void 0)}}getRotationMatrix(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const Q=C.Matrix.Identity();return this.getRotationMatrixToRef(F,b,Q),Q}getRotationMatrixToRef(){let F=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const Q=g._TmpMats[0],C=this.getAbsoluteMatrix();F?C.multiplyToRef(F.getWorldMatrix(),Q):Q.W(C),Q.multiplyAtIndex(0,this._scalingDeterminant),Q.multiplyAtIndex(1,this._scalingDeterminant),Q.multiplyAtIndex(2,this._scalingDeterminant),Q.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=C.gQ.Zero();return this.getAbsolutePositionFromLocalToRef(F,b,Q),Q}getAbsolutePositionFromLocalToRef(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,z=null;b&&(z=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=g._TmpMats[0];t.W(this.getAbsoluteMatrix()),b&&z&&t.multiplyToRef(z,t),C.gQ.TransformCoordinatesToRef(F,t,Q)}getLocalPositionFromAbsolute(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=C.gQ.Zero();return this.getLocalPositionFromAbsoluteToRef(F,b,Q),Q}getLocalPositionFromAbsoluteToRef(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0,z=null;b&&(z=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=g._TmpMats[0];t.W(this.getAbsoluteMatrix()),b&&z&&t.multiplyToRef(z,t),t.invert(),C.gQ.TransformCoordinatesToRef(F,t,Q)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const F=this._skeleton.bones.indexOf(this);if(-1!==F&&this._skeleton.bones.splice(F,1),this._parentNode&&this._parentNode.children){const F=this._parentNode.children,b=F.indexOf(this);-1!==b&&F.splice(b,1)}super.dispose()}}g._TmpVecs=(0,z.b)(2,C.gQ.Zero),g._TmpQuat=C.Quaternion.Identity(),g._TmpMats=(0,z.b)(5,C.Matrix.Identity)},13409:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>V});var C=Q(11293),z=Q(11296),t=Q(11133),g=Q(11309),W=Q(11329),Z=Q(11715),q=Q(11746),G=Q(11570),K=Q(11153),e=Q(11318);class N{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(F){this._zoomStopsAnimation=F}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(F){this._idleRotationSpeed=F}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(F){this._idleRotationWaitTime=F}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(F){this._idleRotationSpinupTime=F}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(F){this._attachedCamera=F;const b=this._attachedCamera.RF();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((F=>{F.type!==G.e.POINTERDOWN?F.type===G.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=F.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const F=K.d.Now;let b=0;null!=this._lastFrameTime&&(b=F-this._lastFrameTime),this._lastFrameTime=F,this._applyUserInteraction();const Q=F-this._lastInteractionTime-this._idleRotationWaitTime,C=Math.max(Math.min(Q/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*C,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const F=this._attachedCamera.RF();this._onPrePointerObservableObserver&&F.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(F){this._lastInteractionTime=F??K.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<e.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let F=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(F=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?F:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=K.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var y=Q(13413),E=Q(11812);class c{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(F){if(this._autoTransitionRange===F)return;this._autoTransitionRange=F;const b=this._attachedCamera;b&&(F?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((F=>{if(F&&(F.Rb(!0),F.getBoundingInfo)){const b=F.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(F){this._attachedCamera=F,this._onAfterCheckInputsObserver=F.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(F){return!!this._attachedCamera&&(this._attachedCamera.radius===F&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(F){if(!this._attachedCamera)return;this._radiusBounceTransition||(c.EasingFunction.setEasingMode(c.EasingMode),this._radiusBounceTransition=E.b.CreateAnimation("radius",E.b.ANIMATIONTYPE_FLOAT,60,c.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=E.b.TransitionTo("radius",this._attachedCamera.radius+F,this._attachedCamera,this._attachedCamera.RF(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}c.EasingFunction=new y.c(.3),c.EasingMode=y.l.EASINGMODE_EASEOUT;class X{constructor(){this.onTargetFramingAnimationEndObservable=new t.c,this._mode=X.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(F){this._mode=F}get mode(){return this._mode}set radiusScale(F){this._radiusScale=F}get radiusScale(){return this._radiusScale}set positionScale(F){this._positionScale=F}get positionScale(){return this._positionScale}set defaultElevation(F){this._defaultElevation=F}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(F){this._elevationReturnTime=F}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(F){this._elevationReturnWaitTime=F}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(F){this._zoomStopsAnimation=F}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(F){this._framingTime=F}get framingTime(){return this._framingTime}init(){}attach(F){this._attachedCamera=F;const b=this._attachedCamera.RF();X.EasingFunction.setEasingMode(X.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((F=>{F.type!==G.e.POINTERDOWN?F.type===G.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=F.onMeshTargetChangedObservable.add((F=>{F&&F.getBoundingInfo&&this.zoomOnMesh(F,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=F.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const F=this._attachedCamera.RF();this._onPrePointerObservableObserver&&F.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F.Rb(!0);const C=F.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(C.minimumWorld,C.maximumWorld,b,Q)}zoomOnMeshHierarchy(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F.Rb(!0);const C=F.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(C.min,C.max,b,Q)}zoomOnMeshesHierarchy(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new g.gQ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),z=new g.gQ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let t=0;t<F.length;t++){const b=F[t].getHierarchyBoundingVectors(!0);g.gQ.CheckExtends(b.min,C,z),g.gQ.CheckExtends(b.max,C,z)}this.zoomOnBoundingInfo(C,z,b,Q)}zoomOnBoundingInfo(F,b){let Q,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const t=F.y,W=t+(b.y-t)*this._positionScale,Z=b.WQ(F).scale(.5);if(!isFinite(W))return!1;if(C)Q=new g.gQ(0,W,0);else{const b=F.add(Z);Q=new g.gQ(b.x,W,b.z)}this._vectorTransition||(this._vectorTransition=E.b.CreateAnimation("target",E.b.ANIMATIONTYPE_VECTOR3,60,X.EasingFunction)),this._betaIsAnimating=!0;let q=E.b.TransitionTo("target",Q,this._attachedCamera,this._attachedCamera.RF(),60,this._vectorTransition,this._framingTime);q&&this._animatables.push(q);let G=0;if(this._mode===X.FitFrustumSidesMode){const Q=this._calculateLowerRadiusFromModelBoundingSphere(F,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=Z.length()+this._attachedCamera.kb),G=Q}else this._mode===X.IgnoreBoundsSizeMode&&(G=this._calculateLowerRadiusFromModelBoundingSphere(F,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.kb));if(this.autoCorrectCameraLimitsAndSensibility){const Q=b.WQ(F).length();this._attachedCamera.panningSensibility=5e3/Q,this._attachedCamera.wheelPrecision=100/G}return this._radiusTransition||(this._radiusTransition=E.b.CreateAnimation("radius",E.b.ANIMATIONTYPE_FLOAT,60,X.EasingFunction)),q=E.b.TransitionTo("radius",G,this._attachedCamera,this._attachedCamera.RF(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),z&&z(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),q&&this._animatables.push(q),!0}_calculateLowerRadiusFromModelBoundingSphere(F,b){const Q=this._attachedCamera;if(!Q)return 0;let C=Q._calculateLowerRadiusFromModelBoundingSphere(F,b,this._radiusScale);return Q.lowerRadiusLimit&&this._mode===X.IgnoreBoundsSizeMode&&(C=C<Q.lowerRadiusLimit?Q.lowerRadiusLimit:C),Q.upperRadiusLimit&&(C=C>Q.upperRadiusLimit?Q.upperRadiusLimit:C),C}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const F=K.d.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,Q=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>Q&&F>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=E.b.CreateAnimation("beta",E.b.ANIMATIONTYPE_FLOAT,60,X.EasingFunction));const F=E.b.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.RF(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));F&&this._animatables.push(F)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=K.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}X.EasingFunction=new y.q,X.EasingMode=y.l.EASINGMODE_EASEINOUT,X.IgnoreBoundsSizeMode=0,X.FitFrustumSidesMode=1;var L=Q(11750),i=Q(11783),f=Q(12870),k=Q(11128);class m{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(F){F=k.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),Q=b.getInputElement();let C=0,z=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=t=>{var g,W;const Z=t.event,q="touch"===Z.pointerType;if(t.type!==G.e.POINTERMOVE&&-1===this.buttons.indexOf(Z.button))return;const K=Z.target;if(this._altKey=Z.altKey,this._ctrlKey=Z.ctrlKey,this._metaKey=Z.metaKey,this._shiftKey=Z.shiftKey,this._buttonsPressed=Z.buttons,b.isPointerLock){const F=Z.movementX,b=Z.movementY;this.onTouch(null,F,b),this._pointA=null,this._pointB=null}else{if(t.type!==G.e.POINTERDOWN&&t.type!==G.e.POINTERDOUBLETAP&&q&&(null===(g=this._pointA)||void 0===g?void 0:g.pointerId)!==Z.pointerId&&(null===(W=this._pointB)||void 0===W?void 0:W.pointerId)!==Z.pointerId)return;if(t.type!==G.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!q)if(t.type===G.e.POINTERDOUBLETAP)this.onDoubleTap(Z.pointerType);else if(t.type!==G.e.POINTERUP||this._currentMousePointerIdDown!==Z.pointerId&&!q){if(t.type===G.e.POINTERMOVE)if(F||Z.preventDefault(),this._pointA&&null===this._pointB){const F=Z.clientX-this._pointA.x,b=Z.clientY-this._pointA.y;this._pointA.x=Z.clientX,this._pointA.y=Z.clientY,this.onTouch(this._pointA,F,b)}else if(this._pointA&&this._pointB){const F=this._pointA.pointerId===Z.pointerId?this._pointA:this._pointB;F.x=Z.clientX,F.y=Z.clientY;const b=this._pointA.x-this._pointB.x,Q=this._pointA.y-this._pointB.y,g=b*b+Q*Q,W={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:Z.pointerId,type:t.type};this.onMultiTouch(this._pointA,this._pointB,C,g,z,W),z=W,C=g}}else{try{null===K||void 0===K||K.releasePointerCapture(Z.pointerId)}catch(e){}q||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==Z.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==Z.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==C||z)&&(this.onMultiTouch(this._pointA,this._pointB,C,0,z,null),C=0,z=null),this._currentMousePointerIdDown=-1,this.onButtonUp(Z),F||Z.preventDefault()}else{try{null===K||void 0===K||K.setPointerCapture(Z.pointerId)}catch(e){}if(null===this._pointA)this._pointA={x:Z.clientX,y:Z.clientY,pointerId:Z.pointerId,type:Z.pointerType};else{if(null!==this._pointB)return;this._pointB={x:Z.clientX,y:Z.clientY,pointerId:Z.pointerId,type:Z.pointerType}}-1!==this._currentMousePointerIdDown||q||(this._currentMousePointerIdDown=Z.pointerId),this.onButtonDown(Z),F||(Z.preventDefault(),Q&&Q.focus())}}},this._observer=this.camera.RF()._inputManager._addCameraPointerObserver(this._pointerInput,G.e.POINTERDOWN|G.e.POINTERUP|G.e.POINTERMOVE|G.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,C=0,z=null,this.onLostFocus()},this._contextMenuBind=F=>this.onContextMenu(F),Q&&Q.addEventListener("contextmenu",this._contextMenuBind,!1);const t=this.camera.RF().getEngine().getHostWindow();t&&k.Tools.RegisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])}te(){if(this._onLostFocus){const F=this.camera.RF().getEngine().getHostWindow();F&&k.Tools.UnregisterTopRootEvents(F,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.RF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const F=this.camera.RF().getEngine().getInputElement();F&&F.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(F){}onTouch(F,b,Q){}onMultiTouch(F,b,Q,C,z,t){}onContextMenu(F){F.preventDefault()}onButtonDown(F){}onButtonUp(F){}onLostFocus(){}}(0,C.b)([(0,z.A)()],m.prototype,"buttons",void 0);class R extends m{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(F,b){if(0!==this.panningSensibility&&F&&b){const Q=b.x-F.x,C=b.y-F.y;this.camera.inertialPanningX+=-Q/this.panningSensibility,this.camera.inertialPanningY+=C/this.panningSensibility}}_computePinchZoom(F,b){const Q=this.camera.radius||R.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=Q*Math.sqrt(F)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-F)*Q*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-F)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(F,b,Q){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=Q/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=Q/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(F,b,Q,C,z,t){0===Q&&null===z||0===C&&null===t||(this.multiTouchPanAndZoom?(this._computePinchZoom(Q,C),this._computeMultiTouchPanning(z,t)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(C)-Math.sqrt(Q))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(Q,C),this._isPinching=!0):this._computeMultiTouchPanning(z,t)):this.multiTouchPanning?this._computeMultiTouchPanning(z,t):this.pinchZoom&&this._computePinchZoom(Q,C))}onButtonDown(F){this._isPanClick=F.button===this.camera._panningMouseButton}onButtonUp(F){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}R.MinimumRadiusForPinch=.001,(0,C.b)([(0,z.A)()],R.prototype,"buttons",void 0),(0,C.b)([(0,z.A)()],R.prototype,"angularSensibilityX",void 0),(0,C.b)([(0,z.A)()],R.prototype,"angularSensibilityY",void 0),(0,C.b)([(0,z.A)()],R.prototype,"pinchPrecision",void 0),(0,C.b)([(0,z.A)()],R.prototype,"pinchDeltaPercentage",void 0),(0,C.b)([(0,z.A)()],R.prototype,"useNaturalPinchZoom",void 0),(0,C.b)([(0,z.A)()],R.prototype,"pinchZoom",void 0),(0,C.b)([(0,z.A)()],R.prototype,"panningSensibility",void 0),(0,C.b)([(0,z.A)()],R.prototype,"multiTouchPanning",void 0),(0,C.b)([(0,z.A)()],R.prototype,"multiTouchPanAndZoom",void 0),f.b.ArcRotateCameraPointersInput=R;var p=Q(11579);class D{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(F){F=k.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.RF(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const Q=b.event;if(!Q.metaKey)if(b.type===p.e.KEYDOWN){if(this._ctrlPressed=Q.ctrlKey,this._altPressed=Q.altKey,-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),Q.preventDefault&&(F||Q.preventDefault())}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysReset.indexOf(Q.keyCode)){const b=this._keys.indexOf(Q.keyCode);b>=0&&this._keys.splice(b,1),Q.preventDefault&&(F||Q.preventDefault())}})))}te(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const F=this.camera;for(let b=0;b<this._keys.length;b++){const Q=this._keys[b];-1!==this.keysLeft.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningX-=1/this.panningSensibility:F.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?F.inertialRadiusOffset+=1/this.zoomingSensibility:F.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningX+=1/this.panningSensibility:F.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(Q)?this._ctrlPressed&&this.camera._useCtrlForPanning?F.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?F.inertialRadiusOffset-=1/this.zoomingSensibility:F.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(Q)&&F.useInputToRestoreState&&F.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,C.b)([(0,z.A)()],D.prototype,"keysUp",void 0),(0,C.b)([(0,z.A)()],D.prototype,"keysDown",void 0),(0,C.b)([(0,z.A)()],D.prototype,"keysLeft",void 0),(0,C.b)([(0,z.A)()],D.prototype,"keysRight",void 0),(0,C.b)([(0,z.A)()],D.prototype,"keysReset",void 0),(0,C.b)([(0,z.A)()],D.prototype,"panningSensibility",void 0),(0,C.b)([(0,z.A)()],D.prototype,"zoomingSensibility",void 0),(0,C.b)([(0,z.A)()],D.prototype,"useAltToZoom",void 0),(0,C.b)([(0,z.A)()],D.prototype,"angularSpeed",void 0),f.b.ArcRotateCameraKeyboardMoveInput=D;var P=Q(11362),n=Q(11581);class j{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new g.gQ(0,0,0),this._globalOffset=new g.gQ(0,0,0),this._inertialPanning=g.gQ.Zero()}_computeDeltaFromMouseWheelLegacyEvent(F,b){let Q=0;const C=.01*F*this.wheelDeltaPercentage*b;return Q=F>0?C/(1+this.wheelDeltaPercentage):C*(1+this.wheelDeltaPercentage),Q}attachControl(F){F=k.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==G.e.POINTERWHEEL)return;const Q=b.event;let C=0;const z=Q.deltaMode===n.b.DOM_DELTA_LINE?40:1,t=-Q.deltaY*z;if(this.customComputeDeltaFromMouseWheel)C=this.customComputeDeltaFromMouseWheel(t,this,Q);else if(this.wheelDeltaPercentage){if(C=this._computeDeltaFromMouseWheelLegacyEvent(t,this.camera.radius),C>0){let F=this.camera.radius,b=this.camera.inertialRadiusOffset+C;for(let Q=0;Q<20&&!(F<=b)&&!(Math.abs(b*this.camera.inertia)<.001);Q++)F-=b,b*=this.camera.inertia;F=(0,W.Clamp)(F,0,Number.MAX_VALUE),C=this._computeDeltaFromMouseWheelLegacyEvent(t,F)}}else C=t/(40*this.wheelPrecision);C&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(C)):this.camera.inertialRadiusOffset+=C),Q.preventDefault&&(F||Q.preventDefault())},this._observer=this.camera.RF()._inputManager._addCameraPointerObserver(this._wheel,G.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Yb(0)}te(){this._observer&&(this.camera.RF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const F=this.camera;0+F.inertialAlphaOffset+F.inertialBetaOffset+F.inertialRadiusOffset&&(this._updateHitPlane(),F.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(F.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const F=this.camera,b=F.target.WQ(F.position);this._hitPlane=P.d.FromPositionAndNormal(F.target,b)}_getPosition(){const F=this.camera,b=F.RF(),Q=b.createPickingRay(b.pointerX,b.pointerY,g.Matrix.Identity(),F,!1);0===F.targetScreenOffset.x&&0===F.targetScreenOffset.y||(this._viewOffset.set(F.targetScreenOffset.x,F.targetScreenOffset.y,0),F.getViewMatrix().invertToRef(F._cameraTransformMatrix),this._globalOffset=g.gQ.TransformNormal(this._viewOffset,F._cameraTransformMatrix),Q.origin.addInPlace(this._globalOffset));let C=0;return this._hitPlane&&(C=Q.intersectsPlane(this._hitPlane)??0),Q.origin.addInPlace(Q.direction.scaleInPlace(C))}_zoomToMouse(F){const b=this.camera,Q=1-b.inertia;if(b.lowerRadiusLimit){const C=b.lowerRadiusLimit??0;b.radius-(b.inertialRadiusOffset+F)/Q<C&&(F=(b.radius-C)*Q-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const C=b.upperRadiusLimit??0;b.radius-(b.inertialRadiusOffset+F)/Q>C&&(F=(b.radius-C)*Q-b.inertialRadiusOffset)}const C=F/Q/b.radius,z=this._getPosition(),t=g.TmpVectors.gQ[6];z.subtractToRef(b.target,t),t.scaleInPlace(C),t.scaleInPlace(Q),this._inertialPanning.addInPlace(t),b.inertialRadiusOffset+=F}_zeroIfClose(F){Math.abs(F.x)<e.c&&(F.x=0),Math.abs(F.y)<e.c&&(F.y=0),Math.abs(F.z)<e.c&&(F.z=0)}}(0,C.b)([(0,z.A)()],j.prototype,"wheelPrecision",void 0),(0,C.b)([(0,z.A)()],j.prototype,"zoomToMouseLocation",void 0),(0,C.b)([(0,z.A)()],j.prototype,"wheelDeltaPercentage",void 0),f.b.ArcRotateCameraMouseWheelInput=j;class w extends f.e{constructor(F){super(F)}addMouseWheel(){return this.add(new j),this}addPointers(){return this.add(new R),this}addKeyboard(){return this.add(new D),this}}var Y=Q(11265);function s(F,b){return isNaN(F)?b:F}Z.c.AddNodeConstructor("ArcRotateCamera",((F,b)=>()=>new V(F,0,0,1,g.gQ.Zero(),b)));class V extends i.e{get target(){return this._target}set target(F){this.setTarget(F)}get targetHost(){return this._targetHost}set targetHost(F){F&&this.setTarget(F)}getTarget(){return this.target}get position(){return this._position}set position(F){this.setPosition(F)}set upVector(F){this._upToYMatrix||(this._yToUpMatrix=new g.Matrix,this._upToYMatrix=new g.Matrix,this._upVector=g.gQ.Zero()),F.normalize(),this._upVector.W(F),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){g.Matrix.RotationAlignToRef(g.gQ.UpReadOnly,this._upVector,this._yToUpMatrix),g.Matrix.RotationAlignToRef(this._upVector,g.gQ.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const F=this.inputs.attached.pointers;return F?F.angularSensibilityX:0}set angularSensibilityX(F){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=F)}get angularSensibilityY(){const F=this.inputs.attached.pointers;return F?F.angularSensibilityY:0}set angularSensibilityY(F){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=F)}get pinchPrecision(){const F=this.inputs.attached.pointers;return F?F.pinchPrecision:0}set pinchPrecision(F){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=F)}get pinchDeltaPercentage(){const F=this.inputs.attached.pointers;return F?F.pinchDeltaPercentage:0}set pinchDeltaPercentage(F){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=F)}get useNaturalPinchZoom(){const F=this.inputs.attached.pointers;return!!F&&F.useNaturalPinchZoom}set useNaturalPinchZoom(F){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=F)}get panningSensibility(){const F=this.inputs.attached.pointers;return F?F.panningSensibility:0}set panningSensibility(F){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=F)}get keysUp(){const F=this.inputs.attached.keyboard;return F?F.keysUp:[]}set keysUp(F){const b=this.inputs.attached.keyboard;b&&(b.keysUp=F)}get keysDown(){const F=this.inputs.attached.keyboard;return F?F.keysDown:[]}set keysDown(F){const b=this.inputs.attached.keyboard;b&&(b.keysDown=F)}get keysLeft(){const F=this.inputs.attached.keyboard;return F?F.keysLeft:[]}set keysLeft(F){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=F)}get keysRight(){const F=this.inputs.attached.keyboard;return F?F.keysRight:[]}set keysRight(F){const b=this.inputs.attached.keyboard;b&&(b.keysRight=F)}get wheelPrecision(){const F=this.inputs.attached.mousewheel;return F?F.wheelPrecision:0}set wheelPrecision(F){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=F)}get zoomToMouseLocation(){const F=this.inputs.attached.mousewheel;return!!F&&F.zoomToMouseLocation}set zoomToMouseLocation(F){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=F)}get wheelDeltaPercentage(){const F=this.inputs.attached.mousewheel;return F?F.wheelDeltaPercentage:0}set wheelDeltaPercentage(F){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=F)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(F){F!==this.useBouncingBehavior&&(F?(this._bouncingBehavior=new c,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(F){F!==this.useFramingBehavior&&(F?(this._framingBehavior=new X,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(F){F!==this.useAutoRotationBehavior&&(F?(this._autoRotationBehavior=new N,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(F,b,Q,C,z,W){var Z;let q=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(F,g.gQ.Zero(),W,q),Z=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=g.gQ.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=g.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new g.Matrix,this.panningAxis=new g.gQ(1,1,0),this._transformedDirection=new g.gQ,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new t.c,this.checkCollisions=!1,this.collisionRadius=new g.gQ(.5,.5,.5),this._previousPosition=g.gQ.Zero(),this._collisionVelocity=g.gQ.Zero(),this._newPosition=g.gQ.Zero(),this._computationVector=g.gQ.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new g.gQ(NaN,NaN,NaN),this._goalTargetScreenOffset=new g.Vector2(NaN,NaN),this._onCollisionPositionChange=function(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Q?(Z.setPosition(b),Z.zy&&Z.zy(Q)):Z._previousPosition.W(Z._position);const C=Math.cos(Z.alpha),z=Math.sin(Z.alpha),t=Math.cos(Z.beta);let g=Math.sin(Z.beta);0===g&&(g=1e-4);const W=Z._getTargetPosition();Z._computationVector.jb(Z.radius*C*g,Z.radius*t,Z.radius*z*g),W.addToRef(Z._computationVector,Z._newPosition),Z._position.W(Z._newPosition);let q=Z.upVector;Z.allowUpsideDown&&Z.beta<0&&(q=q.clone(),q=q.negate()),Z._computeViewMatrix(Z._position,W,q),Z._viewMatrix.addAtIndex(12,Z.targetScreenOffset.x),Z._viewMatrix.addAtIndex(13,Z.targetScreenOffset.y),Z._collisionTriggered=!1},this._target=g.gQ.Zero(),z&&this.setTarget(z),this.alpha=b,this.beta=Q,this.radius=C,this.getViewMatrix(),this.inputs=new w(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new g.gQ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=g.Vector2.Zero()}_updateCache(F){F||super._updateCache(),this._cache._target.W(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.W(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const F=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?F.addToRef(this._targetBoundingCenter,this._target):this._target.W(F)}const F=this._getLockedTargetPosition();return F||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>e.c&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,t=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=t?this._currentInterpolationFactor=t:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=s(F,this._goalAlpha),this._goalBeta=s(b,this._goalBeta),this._goalRadius=s(Q,this._goalRadius),this._goalTarget.set(s(C.x,this._goalTarget.x),s(C.y,this._goalTarget.y),s(C.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(s(z.x,this._goalTargetScreenOffset.x),s(z.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,W.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,W.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,W.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,W.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(F,b){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const z=arguments;b=k.Tools.BackCompatCameraNoPreventDefault(z),this._useCtrlForPanning=Q,this._panningMouseButton=C,"boolean"===typeof z[0]&&(z.length>1&&(this._useCtrlForPanning=z[1]),z.length>2&&(this._panningMouseButton=z[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}te(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let F=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){F=!0;const b=this.invertRotation?-1:1,Q=this._calculateHandednessMultiplier();let C=this.inertialAlphaOffset*Q;this.beta<0&&(C*=-1),this.alpha+=C*b,this.beta+=this.inertialBetaOffset*b,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*e.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){F=!0;const b=new g.gQ(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),b.multiplyInPlace(this.panningAxis),g.gQ.TransformNormalToRef(b,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const F=this.upVector,b=g.gQ.CrossToRef(this._transformedDirection,F,this._transformedDirection);g.gQ.CrossToRef(F,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);g.gQ.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.W(this._transformedDirection)}else{if(this.parent){const F=g.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(F),F.transposeToRef(F),g.gQ.TransformCoordinatesToRef(this._transformedDirection,F,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*e.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*e.c&&(this.inertialPanningY=0)}if(F)this.stopInterpolation();else if(this._isInterpolating){let F=!1;const b=this._scene.getEngine().getDeltaTime()/1e3,Q=1-Math.pow(2,-b/this._currentInterpolationFactor),C=s(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const b=g.TmpVectors.gQ[0].set(s(this._goalTarget.x,this._target.x),s(this._goalTarget.y,this._target.y),s(this._goalTarget.z,this._target.z));g.gQ.LerpToRef(this.target,b,Q,this._target),10*g.gQ.Distance(this.target,b)/C<e.c?(this._goalTarget.set(NaN,NaN,NaN),this.target.W(b),this.setTarget(this.target,!1,!0,!0)):F=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const b=g.Quaternion.RotationAlphaBetaGammaToRef(s(this._goalAlpha,this.alpha),s(this._goalBeta,this.beta),0,g.TmpVectors.Quaternion[0]),C=g.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,g.TmpVectors.Quaternion[1]),z=g.Quaternion.SlerpToRef(C,b,Q,g.TmpVectors.Quaternion[2]);z.normalize();const t=z.toAlphaBetaGammaToRef(g.TmpVectors.gQ[0]);if(this.alpha=t.x,this.beta=t.y,z.isApprox(b,e.c/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const F=b.toAlphaBetaGammaToRef(g.TmpVectors.gQ[0]);this.alpha=F.x,this.beta=F.y}else F=!0}if(isNaN(this._goalRadius)||(this.radius+=(C-this.radius)*Q,Math.abs(C/this.radius-1)<e.c?(this._goalRadius=NaN,this.radius=C):F=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const b=g.TmpVectors.Vector2[0].set(s(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),s(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));g.Vector2.LerpToRef(this.targetScreenOffset,b,Q,this.targetScreenOffset),g.Vector2.Distance(this.targetScreenOffset,b)<e.c?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.W(b)):F=!0}this._isInterpolating=F}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.gQ.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const F=this.alpha;var b,Q;this.alpha=function(F){let b=Math.PI/2;return 0===F.x&&0===F.z||(b=Math.acos(F.x/Math.sqrt(Math.pow(F.x,2)+Math.pow(F.z,2)))),F.z<0&&(b=2*Math.PI-b),b}(this._computationVector),this.beta=(b=this._computationVector.y,Q=this.radius,Math.acos(b/Q));const C=Math.round((F-this.alpha)/(2*Math.PI));this.alpha+=2*C*Math.PI,this._checkLimits()}setPosition(F){this._position.equals(F)||(this._position.W(F),this.rebuildAnglesAndRadius())}setTarget(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(C=this.overrideCloneAlphaBetaRadius??C,F.Rb)b&&F.getBoundingInfo?this._targetBoundingCenter=F.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,F.Rb(),this._targetHost=F,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=F,C=this._getTargetPosition();if(C&&!Q&&C.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}C||this.rebuildAnglesAndRadius()}_getViewMatrix(){const F=Math.cos(this.alpha),b=Math.sin(this.alpha),Q=Math.cos(this.beta);let C=Math.sin(this.beta);0===C&&(C=1e-4),0===this.radius&&(this.radius=1e-4);const z=this._getTargetPosition();if(this._computationVector.jb(this.radius*F*C,this.radius*Q,this.radius*b*C),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||g.gQ.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),z.addToRef(this._computationVector,this._newPosition),this.RF().collisionsEnabled&&this.checkCollisions){const F=this.RF().collisionCoordinator;this._collider||(this._collider=F.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,F.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.W(this._newPosition);let F=this.upVector;this.allowUpsideDown&&C<0&&(F=F.negate()),this._computeViewMatrix(this._position,z,F),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.W(z),this._viewMatrix}zoomOn(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];F=F||this.RF().meshes;const Q=q.b.MinMax(F);let C=this._calculateLowerRadiusFromModelBoundingSphere(Q.min,Q.max);if(C=Math.max(Math.min(C,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=C*this.zoomOnFactor,this.mode===L.b.ORTHOGRAPHIC_CAMERA){const F=this.RF().getEngine().getAspectRatio(this),b=C*this.zoomOnFactor/2;this.orthoLeft=-b*F,this.orthoRight=b*F,this.orthoBottom=-b,this.orthoTop=b}this.focusOn({min:Q.min,max:Q.max,distance:C},b)}focusOn(F){let b,Q,C=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===F.min){const C=F||this.RF().meshes;b=q.b.MinMax(C),Q=g.gQ.Distance(b.min,b.max)}else{b=F,Q=F.distance}this._target=q.b.Center(b),C||(this.maxZ=2*Q)}createRigCamera(F,b){let Q=0;switch(this.cameraRigMode){case L.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.b.RIG_MODE_VR:Q=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case L.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:Q=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const C=new V(F,this.alpha+Q,this.beta,this.radius,this._target,this.RF());return C._cameraRigParams={},C.isRigCamera=!0,C.rigParent=this,C.upVector=this.upVector,C.mode=this.mode,C.orthoLeft=this.orthoLeft,C.orthoRight=this.orthoRight,C.orthoBottom=this.orthoBottom,C.orthoTop=this.orthoTop,C}_updateRigCameras(){const F=this._rigCameras[0],b=this._rigCameras[1];switch(F.beta=b.beta=this.beta,this.cameraRigMode){case L.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case L.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case L.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case L.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case L.b.RIG_MODE_VR:F.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case L.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:F.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const C=g.gQ.Distance(F,b),z=this.RF().getEngine().getAspectRatio(this),t=Math.tan(this.fov/2),W=t*z,Z=.5*C*Q,q=Z*Math.sqrt(1+1/(W*W)),G=Z*Math.sqrt(1+1/(t*t));return Math.max(q,G)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,C.b)([(0,z.A)()],V.prototype,"alpha",void 0),(0,C.b)([(0,z.A)()],V.prototype,"beta",void 0),(0,C.b)([(0,z.A)()],V.prototype,"radius",void 0),(0,C.b)([(0,z.A)()],V.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,C.b)([(0,z.y)("target")],V.prototype,"_target",void 0),(0,C.b)([(0,z.t)("targetHost")],V.prototype,"_targetHost",void 0),(0,C.b)([(0,z.A)()],V.prototype,"inertialAlphaOffset",void 0),(0,C.b)([(0,z.A)()],V.prototype,"inertialBetaOffset",void 0),(0,C.b)([(0,z.A)()],V.prototype,"inertialRadiusOffset",void 0),(0,C.b)([(0,z.A)()],V.prototype,"lowerAlphaLimit",void 0),(0,C.b)([(0,z.A)()],V.prototype,"upperAlphaLimit",void 0),(0,C.b)([(0,z.A)()],V.prototype,"lowerBetaLimit",void 0),(0,C.b)([(0,z.A)()],V.prototype,"upperBetaLimit",void 0),(0,C.b)([(0,z.A)()],V.prototype,"lowerRadiusLimit",void 0),(0,C.b)([(0,z.A)()],V.prototype,"upperRadiusLimit",void 0),(0,C.b)([(0,z.A)()],V.prototype,"lowerTargetYLimit",void 0),(0,C.b)([(0,z.A)()],V.prototype,"inertialPanningX",void 0),(0,C.b)([(0,z.A)()],V.prototype,"inertialPanningY",void 0),(0,C.b)([(0,z.A)()],V.prototype,"pinchToPanMaxDistance",void 0),(0,C.b)([(0,z.A)()],V.prototype,"panningDistanceLimit",void 0),(0,C.b)([(0,z.y)()],V.prototype,"panningOriginTarget",void 0),(0,C.b)([(0,z.A)()],V.prototype,"panningInertia",void 0),(0,C.b)([(0,z.A)()],V.prototype,"zoomToMouseLocation",null),(0,C.b)([(0,z.A)()],V.prototype,"zoomOnFactor",void 0),(0,C.b)([(0,z.x)()],V.prototype,"targetScreenOffset",void 0),(0,C.b)([(0,z.A)()],V.prototype,"allowUpsideDown",void 0),(0,C.b)([(0,z.A)()],V.prototype,"useInputToRestoreState",void 0),(0,C.b)([(0,z.A)()],V.prototype,"restoreStateInterpolationFactor",void 0),(0,Y.g)("BABYLON.ArcRotateCamera",V)},12870:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>g,e:()=>W});var C=Q(11146),z=Q(11349),t=Q(11750),g={};class W{constructor(F){this.attachedToElement=!1,this.attached={},this.camera=F,this.checkInputs=()=>{}}add(F){const b=F.getSimpleName();this.attached[b]?C.e.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=F,F.camera=this.camera,F.checkInputs&&(this.checkInputs=this._addCheckInputs(F.checkInputs.bind(F))),this.attachedToElement&&F.attachControl(this.noPreventDefault))}remove(F){for(const b in this.attached){const Q=this.attached[b];if(Q===F)return Q.te(),Q.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(F){for(const b in this.attached){const Q=this.attached[b];Q.getClassName()===F&&(Q.te(),Q.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(F){const b=this.checkInputs;return()=>{b(),F()}}attachInput(F){this.attachedToElement&&F.attachControl(this.noPreventDefault)}attachElement(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){F=!t.b.ForceAttachControlToAlwaysPreventDefault&&F,this.attachedToElement=!0,this.noPreventDefault=F;for(const b in this.attached)this.attached[b].attachControl(F)}}detachElement(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].te(),F&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const F in this.attached){const b=this.attached[F];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(F){const b={};for(const Q in this.attached){const F=this.attached[Q],C=z.e.Serialize(F);b[F.getClassName()]=C}F.inputsmgr=b}parse(F){const b=F.inputsmgr;if(b){this.clear();for(const F in b){const Q=g[F];if(Q){const C=b[F],t=z.e.Parse((()=>new Q),C,null);this.add(t)}}}else for(const Q in this.attached){const b=g[this.attached[Q].getClassName()];if(b){const C=z.e.Parse((()=>new b),F,null);this.remove(this.attached[Q]),this.add(C)}}}}},12865:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>m});var C=Q(11293),z=Q(11296),t=Q(11309),g=Q(11783),W=Q(12870),Z=Q(11579),q=Q(11128);class G{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(F){F=q.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.RF(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const Q=b.event;if(!Q.metaKey)if(b.type===Z.e.KEYDOWN){if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){-1===this._keys.indexOf(Q.keyCode)&&this._keys.push(Q.keyCode),F||Q.preventDefault()}}else if(-1!==this.keysUp.indexOf(Q.keyCode)||-1!==this.keysDown.indexOf(Q.keyCode)||-1!==this.keysLeft.indexOf(Q.keyCode)||-1!==this.keysRight.indexOf(Q.keyCode)||-1!==this.keysUpward.indexOf(Q.keyCode)||-1!==this.keysDownward.indexOf(Q.keyCode)||-1!==this.keysRotateLeft.indexOf(Q.keyCode)||-1!==this.keysRotateRight.indexOf(Q.keyCode)||-1!==this.keysRotateUp.indexOf(Q.keyCode)||-1!==this.keysRotateDown.indexOf(Q.keyCode)){const b=this._keys.indexOf(Q.keyCode);b>=0&&this._keys.splice(b,1),F||Q.preventDefault()}})))}te(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const F=this.camera;for(let b=0;b<this._keys.length;b++){const Q=this._keys[b],C=F._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(Q)?F._localDirection.jb(-C,0,0):-1!==this.keysUp.indexOf(Q)?F._localDirection.jb(0,0,C):-1!==this.keysRight.indexOf(Q)?F._localDirection.jb(C,0,0):-1!==this.keysDown.indexOf(Q)?F._localDirection.jb(0,0,-C):-1!==this.keysUpward.indexOf(Q)?F._localDirection.jb(0,C,0):-1!==this.keysDownward.indexOf(Q)?F._localDirection.jb(0,-C,0):-1!==this.keysRotateLeft.indexOf(Q)?(F._localDirection.jb(0,0,0),F.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(Q)?(F._localDirection.jb(0,0,0),F.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(Q)?(F._localDirection.jb(0,0,0),F.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(Q)&&(F._localDirection.jb(0,0,0),F.cameraRotation.x+=this._getLocalRotation()),F.RF().useRightHandedSystem&&(F._localDirection.z*=-1),F.getViewMatrix().invertToRef(F._cameraTransformMatrix),t.gQ.TransformNormalToRef(F._localDirection,F._cameraTransformMatrix,F._transformedDirection),F.cameraDirection.addInPlace(F._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const F=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*F}}(0,C.b)([(0,z.A)()],G.prototype,"keysUp",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysUpward",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysDown",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysDownward",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysLeft",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysRight",void 0),(0,C.b)([(0,z.A)()],G.prototype,"rotationSpeed",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysRotateLeft",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysRotateRight",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysRotateUp",void 0),(0,C.b)([(0,z.A)()],G.prototype,"keysRotateDown",void 0),W.b.FreeCameraKeyboardMoveInput=G;var K=Q(11133),e=Q(11570);class N{constructor(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=F,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new K.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(F){F=q.Tools.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),Q=b.getInputElement();this._pointerInput||(this._pointerInput=C=>{const z=C.event,t="touch"===z.pointerType;if(!this.touchEnabled&&t)return;if(C.type!==e.e.POINTERMOVE&&-1===this.buttons.indexOf(z.button))return;const g=z.target;if(C.type===e.e.POINTERDOWN){if(t&&-1!==this._activePointerId||!t&&-1!==this._currentActiveButton)return;this._activePointerId=z.pointerId;try{null===g||void 0===g||g.setPointerCapture(z.pointerId)}catch(W){}-1===this._currentActiveButton&&(this._currentActiveButton=z.button),this._previousPosition={x:z.clientX,y:z.clientY},F||(z.preventDefault(),Q&&Q.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(C.event)}else if(C.type===e.e.POINTERUP){if(t&&this._activePointerId!==z.pointerId||!t&&this._currentActiveButton!==z.button)return;try{null===g||void 0===g||g.releasePointerCapture(z.pointerId)}catch(W){}this._currentActiveButton=-1,this._previousPosition=null,F||z.preventDefault(),this._activePointerId=-1}else if(C.type===e.e.POINTERMOVE&&(this._activePointerId===z.pointerId||!t))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(C.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),Q=(z.clientX-this._previousPosition.x)*b,C=z.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=Q/this.angularSensibility,this.camera.cameraRotation.x+=C/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:Q,offsetY:C}),this._previousPosition={x:z.clientX,y:z.clientY},F||z.preventDefault()}}),this._onMouseMove=Q=>{if(!b.isPointerLock)return;const C=this.camera._calculateHandednessMultiplier(),z=Q.movementX*C;this.camera.cameraRotation.y+=z/this.angularSensibility;const t=Q.movementY;this.camera.cameraRotation.x+=t/this.angularSensibility,this._previousPosition=null,F||Q.preventDefault()},this._observer=this.camera.RF()._inputManager._addCameraPointerObserver(this._pointerInput,e.e.POINTERDOWN|e.e.POINTERUP|e.e.POINTERMOVE),Q&&(this._contextMenuBind=F=>this.onContextMenu(F),Q.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(F){F.preventDefault()}te(){if(this._observer){if(this.camera.RF()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const F=this.camera.getEngine().getInputElement();F&&F.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,C.b)([(0,z.A)()],N.prototype,"buttons",void 0),(0,C.b)([(0,z.A)()],N.prototype,"angularSensibility",void 0),W.b.FreeCameraMouseInput=N;var y,E=Q(11581);class c{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new K.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(F){F=q.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==e.e.POINTERWHEEL)return;const Q=b.event,C=Q.deltaMode===E.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*C*Q.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*C*Q.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*C*Q.deltaZ/this._normalize,Q.preventDefault&&(F||Q.preventDefault())},this._observer=this.camera.RF()._inputManager._addCameraPointerObserver(this._wheel,e.e.POINTERWHEEL)}te(){this._observer&&(this.camera.RF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,C.b)([(0,z.A)()],c.prototype,"wheelPrecisionX",void 0),(0,C.b)([(0,z.A)()],c.prototype,"wheelPrecisionY",void 0),(0,C.b)([(0,z.A)()],c.prototype,"wheelPrecisionZ",void 0),function(F){F[F.MoveRelative=0]="MoveRelative",F[F.RotateRelative=1]="RotateRelative",F[F.MoveScene=2]="MoveScene"}(y||(y={}));class X extends c{constructor(){super(...arguments),this._moveRelative=t.gQ.Zero(),this._rotateRelative=t.gQ.Zero(),this._moveScene=t.gQ.Zero(),this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(F){null===F&&this._wheelXAction!==y.MoveRelative||(this._wheelXAction=y.MoveRelative,this._wheelXActionCoordinate=F)}get wheelXMoveRelative(){return this._wheelXAction!==y.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(F){null===F&&this._wheelYAction!==y.MoveRelative||(this._wheelYAction=y.MoveRelative,this._wheelYActionCoordinate=F)}get wheelYMoveRelative(){return this._wheelYAction!==y.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(F){null===F&&this._wheelZAction!==y.MoveRelative||(this._wheelZAction=y.MoveRelative,this._wheelZActionCoordinate=F)}get wheelZMoveRelative(){return this._wheelZAction!==y.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(F){null===F&&this._wheelXAction!==y.RotateRelative||(this._wheelXAction=y.RotateRelative,this._wheelXActionCoordinate=F)}get wheelXRotateRelative(){return this._wheelXAction!==y.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(F){null===F&&this._wheelYAction!==y.RotateRelative||(this._wheelYAction=y.RotateRelative,this._wheelYActionCoordinate=F)}get wheelYRotateRelative(){return this._wheelYAction!==y.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(F){null===F&&this._wheelZAction!==y.RotateRelative||(this._wheelZAction=y.RotateRelative,this._wheelZActionCoordinate=F)}get wheelZRotateRelative(){return this._wheelZAction!==y.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(F){null===F&&this._wheelXAction!==y.MoveScene||(this._wheelXAction=y.MoveScene,this._wheelXActionCoordinate=F)}get wheelXMoveScene(){return this._wheelXAction!==y.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(F){null===F&&this._wheelYAction!==y.MoveScene||(this._wheelYAction=y.MoveScene,this._wheelYActionCoordinate=F)}get wheelYMoveScene(){return this._wheelYAction!==y.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(F){null===F&&this._wheelZAction!==y.MoveScene||(this._wheelZAction=y.MoveScene,this._wheelZActionCoordinate=F)}get wheelZMoveScene(){return this._wheelZAction!==y.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Yb(0),this._rotateRelative.Yb(0),this._moveScene.Yb(0),this._updateCamera(),this.camera.RF().useRightHandedSystem&&(this._moveRelative.z*=-1);const F=t.Matrix.Zero();this.camera.getViewMatrix().invertToRef(F);const b=t.gQ.Zero();t.gQ.TransformNormalToRef(this._moveRelative,F,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(F,b,Q){if(0===F)return;if(null===b||null===Q)return;let C=null;switch(b){case y.MoveRelative:C=this._moveRelative;break;case y.RotateRelative:C=this._rotateRelative;break;case y.MoveScene:C=this._moveScene}switch(Q){case 0:C.set(F,0,0);break;case 1:C.set(0,F,0);break;case 2:C.set(0,0,F)}}}(0,C.b)([(0,z.A)()],X.prototype,"wheelXMoveRelative",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelYMoveRelative",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelZMoveRelative",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelXRotateRelative",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelYRotateRelative",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelZRotateRelative",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelXMoveScene",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelYMoveScene",null),(0,C.b)([(0,z.A)()],X.prototype,"wheelZMoveScene",null),W.b.FreeCameraMouseWheelInput=X;class L{constructor(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=F,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=q.Tools.IsSafari()}attachControl(F){F=q.Tools.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=Q=>{const C=Q.event,z="mouse"===C.pointerType||this._isSafari&&"undefined"===typeof C.pointerType;if(this.allowMouse||!z)if(Q.type===e.e.POINTERDOWN){if(F||C.preventDefault(),this._pointerPressed.push(C.pointerId),1!==this._pointerPressed.length)return;b={x:C.clientX,y:C.clientY}}else if(Q.type===e.e.POINTERUP){F||C.preventDefault();const Q=this._pointerPressed.indexOf(C.pointerId);if(-1===Q)return;if(this._pointerPressed.splice(Q,1),0!=Q)return;b=null,this._offsetX=null,this._offsetY=null}else if(Q.type===e.e.POINTERMOVE){if(F||C.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(C.pointerId))return;this._offsetX=C.clientX-b.x,this._offsetY=-(C.clientY-b.y)}}),this._observer=this.camera.RF()._inputManager._addCameraPointerObserver(this._pointerInput,e.e.POINTERDOWN|e.e.POINTERUP|e.e.POINTERMOVE),this._onLostFocus){const F=this.camera.getEngine().getInputElement();F&&F.addEventListener("blur",this._onLostFocus)}}te(){if(this._pointerInput){if(this._observer&&(this.camera.RF()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const F=this.camera.getEngine().getInputElement();F&&F.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const F=this.camera,b=F._calculateHandednessMultiplier();F.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)F.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=F._computeLocalCameraSpeed(),Q=new t.gQ(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);t.Matrix.RotationYawPitchRollToRef(F.rotation.y,F.rotation.x,0,F._cameraRotationMatrix),F.cameraDirection.addInPlace(t.gQ.TransformCoordinates(Q,F._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,C.b)([(0,z.A)()],L.prototype,"touchAngularSensibility",void 0),(0,C.b)([(0,z.A)()],L.prototype,"touchMoveSensibility",void 0),W.b.FreeCameraTouchInput=L;class i extends W.e{constructor(F){super(F),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new G),this}addMouse(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new N(F),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new X,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new L),this}clear(){super.clear(),this._mouseInput=null}}var f=Q(11265),k=Q(11203);class m extends g.e{get angularSensibility(){const F=this.inputs.attached.mouse;return F?F.angularSensibility:0}set angularSensibility(F){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=F)}get keysUp(){const F=this.inputs.attached.keyboard;return F?F.keysUp:[]}set keysUp(F){const b=this.inputs.attached.keyboard;b&&(b.keysUp=F)}get keysUpward(){const F=this.inputs.attached.keyboard;return F?F.keysUpward:[]}set keysUpward(F){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=F)}get keysDown(){const F=this.inputs.attached.keyboard;return F?F.keysDown:[]}set keysDown(F){const b=this.inputs.attached.keyboard;b&&(b.keysDown=F)}get keysDownward(){const F=this.inputs.attached.keyboard;return F?F.keysDownward:[]}set keysDownward(F){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=F)}get keysLeft(){const F=this.inputs.attached.keyboard;return F?F.keysLeft:[]}set keysLeft(F){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=F)}get keysRight(){const F=this.inputs.attached.keyboard;return F?F.keysRight:[]}set keysRight(F){const b=this.inputs.attached.keyboard;b&&(b.keysRight=F)}get keysRotateLeft(){const F=this.inputs.attached.keyboard;return F?F.keysRotateLeft:[]}set keysRotateLeft(F){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=F)}get keysRotateRight(){const F=this.inputs.attached.keyboard;return F?F.keysRotateRight:[]}set keysRotateRight(F){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=F)}get keysRotateUp(){const F=this.inputs.attached.keyboard;return F?F.keysRotateUp:[]}set keysRotateUp(F){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=F)}get keysRotateDown(){const F=this.inputs.attached.keyboard;return F?F.keysRotateDown:[]}set keysRotateDown(F){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=F)}constructor(F,b,Q){var C;super(F,b,Q,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),C=this,this.ellipsoid=new t.gQ(.5,1,.5),this.ellipsoidOffset=new t.gQ(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=t.gQ.Zero(),this._diffPosition=t.gQ.Zero(),this._newPosition=t.gQ.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;C._newPosition.W(b),C._newPosition.subtractToRef(C._oldPosition,C._diffPosition),C._diffPosition.length()>k.d.CollisionsEpsilon&&(C.position.addToRef(C._diffPosition,C._deferredPositionUpdate),C._deferOnly?C._deferredUpdated=!0:C.position.W(C._deferredPositionUpdate),C.zy&&Q&&C.zy(Q))},this.inputs=new i(this),this.inputs.addKeyboard().addMouse()}attachControl(F,b){b=q.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}te(){this.inputs.detachElement(),this.cameraDirection=new t.gQ(0,0,0),this.cameraRotation=new t.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(F){this._collisionMask=isNaN(F)?-1:F}_collideWithWorld(F){let b;b=this.parent?t.gQ.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const Q=this.RF().collisionCoordinator;this._collider||(this._collider=Q.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let C=F;this.applyGravity&&(C=F.add(this.RF().gravity)),Q.getNewPosition(this._oldPosition,C,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=t.gQ.Zero(),this._transformedDirection=t.gQ.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(F){this._needMoveForGravity=F}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.RF().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ab"}}(0,C.b)([(0,z.y)()],m.prototype,"ellipsoid",void 0),(0,C.b)([(0,z.y)()],m.prototype,"ellipsoidOffset",void 0),(0,C.b)([(0,z.A)()],m.prototype,"checkCollisions",void 0),(0,C.b)([(0,z.A)()],m.prototype,"applyGravity",void 0),(0,f.g)("BABYLON.FreeCamera",m)},13459:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>t});var C=Q(11395),z=Q(13468);class t{constructor(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=Q,this.mK=[],this._maxBlockCapacity=b||64,this._selectionContent=new C.b(1024),this._creationFunc=F}update(F,b,Q){z.d._CreateBlocks(F,b,Q,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}wG(F){for(let b=0;b<this.AG.length;b++){this.AG[b].addEntry(F)}}jG(F){for(let b=0;b<this.AG.length;b++){this.AG[b].removeEntry(F)}}select(F,b){this._selectionContent.reset();for(let Q=0;Q<this.AG.length;Q++){this.AG[Q].select(F,this._selectionContent,b)}return b?this._selectionContent.concat(this.mK):this._selectionContent.concatWithNoDuplicate(this.mK),this._selectionContent}intersects(F,b,Q){this._selectionContent.reset();for(let C=0;C<this.AG.length;C++){this.AG[C].intersects(F,b,this._selectionContent,Q)}return Q?this._selectionContent.concat(this.mK):this._selectionContent.concatWithNoDuplicate(this.mK),this._selectionContent}intersectsRay(F){this._selectionContent.reset();for(let b=0;b<this.AG.length;b++){this.AG[b].intersectsRay(F,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.mK),this._selectionContent}}t.CreationFuncForMeshes=(F,b)=>{const Q=F.getBoundingInfo();!F.isBlocked&&Q.boundingBox.intersectsMinMax(b.nK,b.jK)&&b.entries.push(F)},t.CreationFuncForSubMeshes=(F,b)=>{F.getBoundingInfo().boundingBox.intersectsMinMax(b.nK,b.jK)&&b.entries.push(F)}},13468:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>t});var C=Q(11309),z=Q(11631);class t{constructor(F,b,Q,C,z,t){this.entries=[],this.wK=new Array,this._capacity=Q,this._depth=C,this._maxDepth=z,this._creationFunc=t,this._minPoint=F,this._maxPoint=b,this.wK.push(F.clone()),this.wK.push(b.clone()),this.wK.push(F.clone()),this.wK[2].x=b.x,this.wK.push(F.clone()),this.wK[3].y=b.y,this.wK.push(F.clone()),this.wK[4].z=b.z,this.wK.push(b.clone()),this.wK[5].z=F.z,this.wK.push(b.clone()),this.wK[6].x=F.x,this.wK.push(b.clone()),this.wK[7].y=F.y}get NQ(){return this._capacity}get nK(){return this._minPoint}get jK(){return this._maxPoint}addEntry(F){if(this.AG)for(let b=0;b<this.AG.length;b++){this.AG[b].addEntry(F)}else this._creationFunc(F,this),this.entries.length>this.NQ&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(F){if(this.AG){for(let b=0;b<this.AG.length;b++){this.AG[b].removeEntry(F)}return}const b=this.entries.indexOf(F);b>-1&&this.entries.splice(b,1)}addEntries(F){for(let b=0;b<F.length;b++){const Q=F[b];this.addEntry(Q)}}select(F,b,Q){if(z.d.IsInFrustum(this.wK,F)){if(this.AG){for(let C=0;C<this.AG.length;C++){this.AG[C].select(F,b,Q)}return}Q?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(F,b,Q,C){if(z.d.IntersectsSphere(this._minPoint,this._maxPoint,F,b)){if(this.AG){for(let z=0;z<this.AG.length;z++){this.AG[z].intersects(F,b,Q,C)}return}C?Q.concat(this.entries):Q.concatWithNoDuplicate(this.entries)}}intersectsRay(F,b){if(F.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.AG){for(let Q=0;Q<this.AG.length;Q++){this.AG[Q].intersectsRay(F,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){t._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(F,b,Q,z,g,W,Z,q){Z.AG=new Array;const G=new C.gQ((b.x-F.x)/2,(b.y-F.y)/2,(b.z-F.z)/2);for(let C=0;C<2;C++)for(let b=0;b<2;b++)for(let K=0;K<2;K++){const e=F.add(G.multiplyByFloats(C,b,K)),N=F.add(G.multiplyByFloats(C+1,b+1,K+1)),y=new t(e,N,z,g+1,W,q);y.addEntries(Q),Z.AG.push(y)}}}},13477:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>G});var C=Q(11537),z=Q(11309),t=Q(11724),g=Q(12651),W=Q(11561),Z=Q(13459),q=Q(11161);C.c.prototype.createOrUpdateSelectionOctree=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,Q=this._getComponent(W.c.NAME_OCTREE);Q||(Q=new G(this),this.o(Q)),this.fK||(this.fK=new Z.c(Z.c.CreationFuncForMeshes,F,b));const C=this.getWorldExtends();return this.fK.update(C.min,C.max,this.meshes),this.fK},Object.defineProperty(C.c.prototype,"selectionOctree",{get:function(){return this.fK},enumerable:!0,configurable:!0}),t.d.prototype.createOrUpdateSubmeshesOctree=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const Q=this.RF();let C=Q._getComponent(W.c.NAME_OCTREE);C||(C=new G(Q),Q.o(C)),this._submeshesOctree||(this._submeshesOctree=new Z.c(Z.c.CreationFuncForSubMeshes,F,b)),this.Rb(!0);const z=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(z.minimumWorld,z.maximumWorld,this.Xb),this._submeshesOctree};class G{constructor(F){this.name=W.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new g.e(z.gQ.Zero(),new z.gQ(1,1,1)),(F=F||q.d.LastCreatedScene)&&(this.ZQ=F,this.ZQ.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ZQ.getActiveSubMeshCandidates=F=>this.getActiveSubMeshCandidates(F),this.ZQ.getCollidingSubMeshCandidates=(F,b)=>this.getCollidingSubMeshCandidates(F,b),this.ZQ.getIntersectingSubMeshCandidates=(F,b)=>this.getIntersectingSubMeshCandidates(F,b))}register(){this.ZQ.onMeshRemovedObservable.add((F=>{const b=this.ZQ.selectionOctree;if(void 0!==b&&null!==b){const Q=b.mK.indexOf(F);-1!==Q&&b.mK.splice(Q,1)}})),this.ZQ.onMeshImportedObservable.add((F=>{const b=this.ZQ.selectionOctree;void 0!==b&&null!==b&&b.wG(F)}))}getActiveMeshCandidates(){var F;return(null===(F=this.ZQ.fK)||void 0===F?void 0:F.select(this.ZQ.frustumPlanes))||this.ZQ._getDefaultMeshCandidates()}getActiveSubMeshCandidates(F){if(F._submeshesOctree&&F.useOctreeForRenderingSelection){return F._submeshesOctree.select(this.ZQ.frustumPlanes)}return this.ZQ._getDefaultSubMeshCandidates(F)}getIntersectingSubMeshCandidates(F,b){if(F._submeshesOctree&&F.useOctreeForPicking){g.e.TransformToRef(b,F.getWorldMatrix(),this._tempRay);return F._submeshesOctree.intersectsRay(this._tempRay)}return this.ZQ._getDefaultSubMeshCandidates(F)}getCollidingSubMeshCandidates(F,b){if(F._submeshesOctree&&F.useOctreeForCollisions){const Q=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return F._submeshesOctree.intersects(b._basePointWorld,Q)}return this.ZQ._getDefaultSubMeshCandidates(F)}rebuild(){}dispose(){}}},12651:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>N});var C=Q(11537),z=Q(11750),t=Q(11318),g=Q(11309),W=Q(11320),Z=Q(11620),q=Q(11555),G=Q(11161),K=Q(11590);const e={internalPickerForMesh:void 0};class N{constructor(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.c;this.origin=F,this.direction=b,this.length=Q,this.epsilon=C}clone(){return new N(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const C=N._TmpVector3[0].jb(F.x-Q,F.y-Q,F.z-Q),z=N._TmpVector3[1].jb(b.x+Q,b.y+Q,b.z+Q);let t,g,W,Z,q=0,G=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<C.x||this.origin.x>z.x)return!1}else if(t=1/this.direction.x,g=(C.x-this.origin.x)*t,W=(z.x-this.origin.x)*t,W===-1/0&&(W=1/0),g>W&&(Z=g,g=W,W=Z),q=Math.max(g,q),G=Math.min(W,G),q>G)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<C.y||this.origin.y>z.y)return!1}else if(t=1/this.direction.y,g=(C.y-this.origin.y)*t,W=(z.y-this.origin.y)*t,W===-1/0&&(W=1/0),g>W&&(Z=g,g=W,W=Z),q=Math.max(g,q),G=Math.min(W,G),q>G)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<C.z||this.origin.z>z.z)return!1}else if(t=1/this.direction.z,g=(C.z-this.origin.z)*t,W=(z.z-this.origin.z)*t,W===-1/0&&(W=1/0),g>W&&(Z=g,g=W,W=Z),q=Math.max(g,q),G=Math.min(W,G),q>G)return!1;return!0}intersectsBox(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(F.minimum,F.maximum,b)}intersectsSphere(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=F.center.x-this.origin.x,C=F.center.y-this.origin.y,z=F.center.z-this.origin.z,t=Q*Q+C*C+z*z,g=F.radius+b,W=g*g;if(t<=W)return!0;const Z=Q*this.direction.x+C*this.direction.y+z*this.direction.z;if(Z<0)return!1;return t-Z*Z<=W}intersectsTriangle(F,b,Q){const C=N._TmpVector3[0],z=N._TmpVector3[1],t=N._TmpVector3[2],W=N._TmpVector3[3],q=N._TmpVector3[4];b.subtractToRef(F,C),Q.subtractToRef(F,z),g.gQ.CrossToRef(this.direction,z,t);const G=g.gQ.Dot(C,t);if(0===G)return null;const K=1/G;this.origin.subtractToRef(F,W);const e=g.gQ.Dot(W,t)*K;if(e<-this.epsilon||e>1+this.epsilon)return null;g.gQ.CrossToRef(W,C,q);const y=g.gQ.Dot(this.direction,q)*K;if(y<-this.epsilon||e+y>1+this.epsilon)return null;const E=g.gQ.Dot(z,q)*K;return E>this.length?null:new Z.d(1-e-y,e,E)}intersectsPlane(F){let b;const Q=g.gQ.Dot(F.normal,this.direction);if(Math.abs(Q)<9.99999997475243e-7)return null;{const C=g.gQ.Dot(F.normal,this.origin);return b=(-F.d-C)/Q,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(F){case"y":{const F=(this.origin.y-b)/this.direction.y;return F>0?null:new g.gQ(this.origin.x+this.direction.x*-F,b,this.origin.z+this.direction.z*-F)}case"x":{const F=(this.origin.x-b)/this.direction.x;return F>0?null:new g.gQ(b,this.origin.y+this.direction.y*-F,this.origin.z+this.direction.z*-F)}case"z":{const F=(this.origin.z-b)/this.direction.z;return F>0?null:new g.gQ(this.origin.x+this.direction.x*-F,this.origin.y+this.direction.y*-F,b)}default:return null}}intersectsMesh(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const W=g.TmpVectors.Matrix[0];return F.getWorldMatrix().invertToRef(W),this._tmpRay?N.TransformToRef(this,W,this._tmpRay):this._tmpRay=N.Transform(this,W),F.intersects(this._tmpRay,b,Q,C,z,t)}intersectsMeshes(F,b,Q){Q?Q.length=0:Q=[];for(let C=0;C<F.length;C++){const z=this.intersectsMesh(F[C],b);z.hit&&Q.push(z)}return Q.sort(this._comparePickingInfo),Q}_comparePickingInfo(F,b){return F.distance<b.distance?-1:F.distance>b.distance?1:0}intersectionSegment(F,b,Q){const C=this.origin,z=g.TmpVectors.gQ[0],t=g.TmpVectors.gQ[1],W=g.TmpVectors.gQ[2],Z=g.TmpVectors.gQ[3];b.subtractToRef(F,z),this.direction.scaleToRef(N._Rayl,W),C.addToRef(W,t),F.subtractToRef(C,Z);const q=g.gQ.Dot(z,z),G=g.gQ.Dot(z,W),K=g.gQ.Dot(W,W),e=g.gQ.Dot(z,Z),y=g.gQ.Dot(W,Z),E=q*K-G*G;let c,X,L=E,i=E;E<N._Smallnum?(c=0,L=1,X=y,i=K):(c=G*y-K*e,X=q*y-G*e,c<0?(c=0,X=y,i=K):c>L&&(c=L,X=y+G,i=K)),X<0?(X=0,-e<0?c=0:-e>q?c=L:(c=-e,L=q)):X>i&&(X=i,-e+G<0?c=0:-e+G>q?c=L:(c=-e+G,L=q));const f=Math.abs(c)<N._Smallnum?0:c/L,k=Math.abs(X)<N._Smallnum?0:X/i,m=g.TmpVectors.gQ[4];W.scaleToRef(k,m);const R=g.TmpVectors.gQ[5];z.scaleToRef(f,R),R.addInPlace(Z);const p=g.TmpVectors.gQ[6];R.subtractToRef(m,p);return k>0&&k<=this.length&&p.lengthSquared()<Q*Q?R.length():-1}update(F,b,Q,C,z,t,W){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){N._RayDistant||(N._RayDistant=N.Zero()),N._RayDistant.unprojectRayToRef(F,b,Q,C,g.Matrix.IdentityReadOnly,t,W);const Z=g.TmpVectors.Matrix[0];z.invertToRef(Z),N.TransformToRef(N._RayDistant,Z,this)}else this.unprojectRayToRef(F,b,Q,C,z,t,W);return this}static Zero(){return new N(g.gQ.Zero(),g.gQ.Zero())}static CreateNew(F,b,Q,C,z,t,g){return N.Zero().update(F,b,Q,C,z,t,g)}static CreateNewFromTo(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.Matrix.IdentityReadOnly;const C=new N(new g.gQ(0,0,0),new g.gQ(0,0,0));return N.CreateFromToToRef(F,b,C,Q)}static CreateFromToToRef(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:g.Matrix.IdentityReadOnly;Q.origin.W(F);const z=b.subtractToRef(F,Q.direction),t=Math.sqrt(z.x*z.x+z.y*z.y+z.z*z.z);return Q.length=t,Q.direction.normalize(),N.TransformToRef(Q,C,Q)}static Transform(F,b){const Q=new N(new g.gQ(0,0,0),new g.gQ(0,0,0));return N.TransformToRef(F,b,Q),Q}static TransformToRef(F,b,Q){g.gQ.TransformCoordinatesToRef(F.origin,b,Q.origin),g.gQ.TransformNormalToRef(F.direction,b,Q.direction),Q.length=F.length,Q.epsilon=F.epsilon;const C=Q.direction,z=C.length();if(0!==z&&1!==z){const F=1/z;C.x*=F,C.y*=F,C.z*=F,Q.length*=z}return Q}unprojectRayToRef(F,b,Q,C,z,t,W){const Z=g.TmpVectors.Matrix[0];z.multiplyToRef(t,Z),Z.multiplyToRef(W,Z),Z.invert();const q=G.d.LastCreatedEngine,K=g.TmpVectors.gQ[0];K.x=F/Q*2-1,K.y=-(b/C*2-1),K.z=null!==q&&void 0!==q&&q.useReverseDepthBuffer?1:null!==q&&void 0!==q&&q.isNDCHalfZRange?0:-1;const e=g.TmpVectors.gQ[1].jb(K.x,K.y,1-1e-8),N=g.TmpVectors.gQ[2],y=g.TmpVectors.gQ[3];g.gQ._UnprojectFromInvertedMatrixToRef(K,Z,N),g.gQ._UnprojectFromInvertedMatrixToRef(e,Z,y),this.origin.W(N),y.subtractToRef(N,this.direction),this.direction.normalize()}}function y(F,b,Q,C,z){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=N.Zero();return E(F,b,Q,C,g,z,t),g}function E(F,b,Q,C,z,t){let W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const q=F.getEngine();if(!t&&!(t=F.activeCamera))return F;const G=t.viewport,K=q.getRenderHeight(),{x:e,y:N,width:y,height:E}=G.toGlobal(q.getRenderWidth(),K),c=1/q.getHardwareScalingLevel();return b=b*c-e,Q=Q*c-(K-N-E),z.update(b,Q,y,E,C||g.Matrix.IdentityReadOnly,W?g.Matrix.IdentityReadOnly:t.getViewMatrix(),t.getProjectionMatrix(),Z),F}function c(F,b,Q,C,z){if(!q.c)return F;const t=F.getEngine();if(!z&&!(z=F.activeCamera))throw new Error("Active camera not set");const W=z.viewport,Z=t.getRenderHeight(),{x:G,y:K,width:e,height:N}=W.toGlobal(t.getRenderWidth(),Z),y=g.Matrix.Identity(),E=1/t.getHardwareScalingLevel();return b=b*E-G,Q=Q*E-(Z-K-N),C.update(b,Q,e,N,y,y,z.getProjectionMatrix()),F}function X(F,b,Q,C,z,t,g,W){const Z=b(C,Q.enableDistantPicking),q=Q.intersects(Z,z,g,t,C,W);return q&&q.hit?!z&&null!=F&&q.distance>=F.distance?null:q:null}function L(F,b,Q,C,z,t){let W=null;const Z=!!(F.activeCameras&&F.activeCameras.length>1&&F.cameraToUseForPointers!==F.activeCamera),G=F.cameraToUseForPointers||F.activeCamera,K=e.internalPickerForMesh||X;for(let q=0;q<F.meshes.length;q++){const e=F.meshes[q];if(Q){if(!Q(e,-1))continue}else if(!e.isEnabled()||!e.isVisible||!e.eq)continue;const N=Z&&e.isWorldMatrixCameraDependent(),y=e.Rb(N,G);if(e.hasThinInstances&&e.vq){const F=K(W,b,e,y,!0,!0,t);if(F){if(z)return F;const Z=g.TmpVectors.Matrix[1],q=e.thinInstanceGetWorldMatrices();for(let F=0;F<q.length;F++){if(Q&&!Q(e,F))continue;q[F].multiplyToRef(y,Z);const g=K(W,b,e,Z,C,z,t,!0);if(g&&(W=g,W.thinInstanceIndex=F,C))return W}}}else{const F=K(W,b,e,y,C,z,t);if(F&&(W=F,C))return W}}return W||new q.c}function i(F,b,Q,C){if(!q.c)return null;const z=[],t=!!(F.activeCameras&&F.activeCameras.length>1&&F.cameraToUseForPointers!==F.activeCamera),W=F.cameraToUseForPointers||F.activeCamera,Z=e.internalPickerForMesh||X;for(let q=0;q<F.meshes.length;q++){const G=F.meshes[q];if(Q){if(!Q(G,-1))continue}else if(!G.isEnabled()||!G.isVisible||!G.eq)continue;const K=t&&G.isWorldMatrixCameraDependent(),e=G.Rb(K,W);if(G.hasThinInstances&&G.vq){if(Z(null,b,G,e,!0,!0,C)){const F=g.TmpVectors.Matrix[1],t=G.thinInstanceGetWorldMatrices();for(let g=0;g<t.length;g++){if(Q&&!Q(G,g))continue;t[g].multiplyToRef(e,F);const W=Z(null,b,G,F,!1,!1,C,!0);W&&(W.thinInstanceIndex=g,z.push(W))}}}else{const F=Z(null,b,G,e,!1,!1,C);F&&z.push(F)}}return z}function f(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,C=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;C||(C=F.getWorldMatrix()),b.length=Q,z?b.origin.W(z):b.origin.W(F.position);const t=g.TmpVectors.gQ[2];t.set(0,0,F._scene.useRightHandedSystem?-1:1);const W=g.TmpVectors.gQ[3];return g.gQ.TransformNormalToRef(t,C,W),g.gQ.NormalizeToRef(W,b.direction),b}var k,m;N._TmpVector3=(0,W.b)(6,g.gQ.Zero),N._RayDistant=N.Zero(),N._Smallnum=1e-8,N._Rayl=1e9,k=C.c,(m=z.b)&&(m.prototype.getForwardRay=function(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2?arguments[2]:void 0;return f(this,new N(g.gQ.Zero(),g.gQ.Zero(),F),F,b,Q)},m.prototype.getForwardRayToRef=function(F){return f(this,F,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),k&&(K.d._IsPickingAvailable=!0,k.prototype.createPickingRay=function(F,b,Q,C){return y(this,F,b,Q,C,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),C.c.prototype.createPickingRayToRef=function(F,b,Q,C,z){return E(this,F,b,Q,C,z,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},C.c.prototype.createPickingRayInCameraSpace=function(F,b,Q){return function(F,b,Q,C){const z=N.Zero();return c(F,b,Q,z,C),z}(this,F,b,Q)},C.c.prototype.createPickingRayInCameraSpaceToRef=function(F,b,Q,C){return c(this,F,b,Q,C)},C.c.prototype.pickWithBoundingInfo=function(F,b,Q,C,z){return function(F,b,Q,C,z,t){if(!q.c)return null;const W=L(F,(C=>(F._tempPickingRay||(F._tempPickingRay=N.Zero()),E(F,b,Q,C,F._tempPickingRay,t||null),F._tempPickingRay)),C,z,!0);return W&&(W.ray=y(F,b,Q,g.Matrix.Identity(),t||null)),W}(this,F,b,Q,C,z)},C.c.prototype.zC=function(F,b,Q,C,z,t){return function(F,b,Q,C,z,t,W){const Z=L(F,((C,z)=>(F._tempPickingRay||(F._tempPickingRay=N.Zero()),E(F,b,Q,C,F._tempPickingRay,t||null,!1,z),F._tempPickingRay)),C,z,!1,W);return Z&&(Z.ray=y(F,b,Q,g.Matrix.Identity(),t||null)),Z}(this,F,b,Q,C,z,t)},C.c.prototype.pickWithRay=function(F,b,Q,C){return function(F,b,Q,C,z){const t=L(F,(Q=>(F._pickWithRayInverseMatrix||(F._pickWithRayInverseMatrix=g.Matrix.Identity()),Q.invertToRef(F._pickWithRayInverseMatrix),F._cachedRayForTransform||(F._cachedRayForTransform=N.Zero()),N.TransformToRef(b,F._pickWithRayInverseMatrix,F._cachedRayForTransform),F._cachedRayForTransform)),Q,C,!1,z);return t&&(t.ray=b),t}(this,F,b,Q,C)},C.c.prototype.multiPick=function(F,b,Q,C,z){return function(F,b,Q,C,z,t){return i(F,(C=>y(F,b,Q,C,z||null)),C,t)}(this,F,b,Q,C,z)},C.c.prototype.multiPickWithRay=function(F,b,Q){return function(F,b,Q,C){return i(F,(Q=>(F._pickWithRayInverseMatrix||(F._pickWithRayInverseMatrix=g.Matrix.Identity()),Q.invertToRef(F._pickWithRayInverseMatrix),F._cachedRayForTransform||(F._cachedRayForTransform=N.Zero()),N.TransformToRef(b,F._pickWithRayInverseMatrix,F._cachedRayForTransform),F._cachedRayForTransform)),Q,C)}(this,F,b,Q)}},12920:(F,b,Q)=>{"use strict";var C=Q(11241),z=Q(11146),t=Q(11170),g=Q(11272),W=Q(11203),Z=Q(11259);W.d.prototype._partialLoadFile=function(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(F,(F=>{Q[b]=F,Q._internalCount++,6===Q._internalCount&&C(Q)}),void 0,void 0,!0,((F,b)=>{z&&F&&z(F.status+" "+F.statusText,b)}))},W.d.prototype._cascadeLoadFiles=function(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=[];z._internalCount=0;for(let t=0;t<6;t++)this._partialLoadFile(Q[t],t,z,b,C)},W.d.prototype._cascadeLoadImgs=function(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5?arguments[5]:void 0;const g=[];g._internalCount=0;for(let W=0;W<6;W++)this._partialLoadImg(C[W],W,g,F,b,Q,z,t)},W.d.prototype._partialLoadImg=function(F,b,Q,C,z,W){let Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7?arguments[7]:void 0;const G=(0,g.b)();(0,t.t)(F,(F=>{Q[b]=F,Q._internalCount++,C&&C.removePendingData(G),6===Q._internalCount&&W&&W(z,Q)}),((F,b)=>{C&&C.removePendingData(G),Z&&Z(F,b)}),C?C.offlineProvider:null,q),C&&C.addPendingData(G)},W.d.prototype.createCubeTextureBase=function(F,b,Q,t){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6?arguments[6]:void 0,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,y=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,c=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,X=arguments.length>14&&void 0!==arguments[14]&&arguments[14],L=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const i=y||new C.b(this,7);i.isCube=!0,i.url=F,i.generateMipMaps=!t,i._lodGenerationScale=e,i._lodGenerationOffset=N,i._useSRGBBuffer=!!X&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!t),i!==y&&(i.label=F.substring(0,60)),this._doNotHandleContextLost||(i._extension=G,i._files=Q,i._buffer=L);const f=F;this._transformTextureUrl&&!y&&(F=this._transformTextureUrl(F));const k=G??function(F){const b=F.split("?")[0],Q=b.lastIndexOf(".");return Q>-1?b.substring(Q).toLowerCase():""}(F),m=(0,Z.b)(k),R=(F,b)=>{i.dispose(),W?W(F,b):F&&z.e.Warn(F)},p=(C,W)=>{F===f?C&&R(C.status+" "+C.statusText,W):(z.e.Warn(`Failed to load ${F}, falling back to the ${f}`),this.createCubeTextureBase(f,b,Q,!!t,g,R,q,G,K,e,N,i,E,c,X,L))};if(m)m.then((C=>{const z=F=>{E&&E(i,F),C.loadCubeData(F,i,K,g,((F,b)=>{R(F,b)}))};L?z(L):Q&&6===Q.length?C.supportCascades?this._cascadeLoadFiles(b,(F=>z(F.map((F=>new Uint8Array(F))))),Q,R):R("Textures type does not support cascades."):this._loadFile(F,(F=>z(new Uint8Array(F))),void 0,void 0,!0,p)}));else{if(!Q||0===Q.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(b,i,((F,b)=>{c&&c(F,b)}),Q,R)}return this._internalTexturesCache.push(i),i}},13482:(F,b,Q)=>{"use strict";Q(11146);var C=Q(11441);Q(11241),Q(11378),Q(11236),Q(11501),Q(11452);C.c},12948:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>z});var C=Q(11265);class z{constructor(F){this.value=this._toInt(F)}_toInt(F){return 0|F}add(F){return new z(this.value+F.value)}WQ(F){return new z(this.value-F.value)}multiply(F){return new z(Math.imul(this.value,F.value))}divide(F){return new z(this.value/F.value)}getClassName(){return z.ClassName}equals(F){return this.value===F.value}static FromValue(F){return new z(F)}toString(){return this.value.toString()}}z.ClassName="FlowGraphInteger",(0,C.g)("FlowGraphInteger",z)},12958:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>z,e:()=>t});var C=Q(11309);class z{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.eb=F}get m(){return this.eb}transformVector(F){return this.transformVectorToRef(F,new C.Vector2)}transformVectorToRef(F,b){return b.x=F.x*this.eb[0]+F.y*this.eb[1],b.y=F.x*this.eb[2]+F.y*this.eb[3],b}Lb(){return this.toArray()}toArray(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<4;b++)F[b]=this.eb[b];return F}tC(F){for(let b=0;b<4;b++)this.eb[b]=F[b];return this}multiplyToRef(F,b){const Q=F.eb,C=this.eb,z=b.eb;return z[0]=Q[0]*C[0]+Q[1]*C[2],z[1]=Q[0]*C[1]+Q[1]*C[3],z[2]=Q[2]*C[0]+Q[3]*C[2],z[3]=Q[2]*C[1]+Q[3]*C[3],b}multiply(F){return this.multiplyToRef(F,new z)}divideToRef(F,b){const Q=this.eb,C=F.eb,z=b.eb;return z[0]=Q[0]/C[0],z[1]=Q[1]/C[1],z[2]=Q[2]/C[2],z[3]=Q[3]/C[3],b}divide(F){return this.divideToRef(F,new z)}addToRef(F,b){const Q=this.eb,C=F.m,z=b.m;return z[0]=Q[0]+C[0],z[1]=Q[1]+C[1],z[2]=Q[2]+C[2],z[3]=Q[3]+C[3],b}add(F){return this.addToRef(F,new z)}subtractToRef(F,b){const Q=this.eb,C=F.m,z=b.m;return z[0]=Q[0]-C[0],z[1]=Q[1]-C[1],z[2]=Q[2]-C[2],z[3]=Q[3]-C[3],b}WQ(F){return this.subtractToRef(F,new z)}transpose(){const F=this.eb;return new z([F[0],F[2],F[1],F[3]])}determinant(){const F=this.eb;return F[0]*F[3]-F[1]*F[2]}inverse(){const F=this.determinant();if(0===F)throw new Error("Matrix is not invertible");const b=this.eb,Q=1/F;return new z([b[3]*Q,-b[1]*Q,-b[2]*Q,b[0]*Q])}equals(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=this.eb,C=F.m;return 0===b?Q[0]===C[0]&&Q[1]===C[1]&&Q[2]===C[2]&&Q[3]===C[3]:Math.abs(Q[0]-C[0])<b&&Math.abs(Q[1]-C[1])<b&&Math.abs(Q[2]-C[2])<b&&Math.abs(Q[3]-C[3])<b}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.eb.join(", ")})`}}class t{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.eb=F}get m(){return this.eb}transformVector(F){return this.transformVectorToRef(F,new C.gQ)}transformVectorToRef(F,b){const Q=this.eb;return b.x=F.x*Q[0]+F.y*Q[1]+F.z*Q[2],b.y=F.x*Q[3]+F.y*Q[4]+F.z*Q[5],b.z=F.x*Q[6]+F.y*Q[7]+F.z*Q[8],b}multiplyToRef(F,b){const Q=F.eb,C=this.eb,z=b.m;return z[0]=Q[0]*C[0]+Q[1]*C[3]+Q[2]*C[6],z[1]=Q[0]*C[1]+Q[1]*C[4]+Q[2]*C[7],z[2]=Q[0]*C[2]+Q[1]*C[5]+Q[2]*C[8],z[3]=Q[3]*C[0]+Q[4]*C[3]+Q[5]*C[6],z[4]=Q[3]*C[1]+Q[4]*C[4]+Q[5]*C[7],z[5]=Q[3]*C[2]+Q[4]*C[5]+Q[5]*C[8],z[6]=Q[6]*C[0]+Q[7]*C[3]+Q[8]*C[6],z[7]=Q[6]*C[1]+Q[7]*C[4]+Q[8]*C[7],z[8]=Q[6]*C[2]+Q[7]*C[5]+Q[8]*C[8],b}multiply(F){return this.multiplyToRef(F,new t)}divideToRef(F,b){const Q=this.eb,C=F.m,z=b.m;return z[0]=Q[0]/C[0],z[1]=Q[1]/C[1],z[2]=Q[2]/C[2],z[3]=Q[3]/C[3],z[4]=Q[4]/C[4],z[5]=Q[5]/C[5],z[6]=Q[6]/C[6],z[7]=Q[7]/C[7],z[8]=Q[8]/C[8],b}divide(F){return this.divideToRef(F,new t)}addToRef(F,b){const Q=this.eb,C=F.m,z=b.m;return z[0]=Q[0]+C[0],z[1]=Q[1]+C[1],z[2]=Q[2]+C[2],z[3]=Q[3]+C[3],z[4]=Q[4]+C[4],z[5]=Q[5]+C[5],z[6]=Q[6]+C[6],z[7]=Q[7]+C[7],z[8]=Q[8]+C[8],b}add(F){return this.addToRef(F,new t)}subtractToRef(F,b){const Q=this.eb,C=F.m,z=b.m;return z[0]=Q[0]-C[0],z[1]=Q[1]-C[1],z[2]=Q[2]-C[2],z[3]=Q[3]-C[3],z[4]=Q[4]-C[4],z[5]=Q[5]-C[5],z[6]=Q[6]-C[6],z[7]=Q[7]-C[7],z[8]=Q[8]-C[8],b}WQ(F){return this.subtractToRef(F,new t)}toArray(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let b=0;b<9;b++)F[b]=this.eb[b];return F}Lb(){return this.toArray()}tC(F){for(let b=0;b<9;b++)this.eb[b]=F[b];return this}transpose(){const F=this.eb;return new t([F[0],F[3],F[6],F[1],F[4],F[7],F[2],F[5],F[8]])}determinant(){const F=this.eb;return F[0]*(F[4]*F[8]-F[5]*F[7])-F[1]*(F[3]*F[8]-F[5]*F[6])+F[2]*(F[3]*F[7]-F[4]*F[6])}inverse(){const F=this.determinant();if(0===F)throw new Error("Matrix is not invertible");const b=this.eb,Q=1/F;return new t([(b[4]*b[8]-b[5]*b[7])*Q,(b[2]*b[7]-b[1]*b[8])*Q,(b[1]*b[5]-b[2]*b[4])*Q,(b[5]*b[6]-b[3]*b[8])*Q,(b[0]*b[8]-b[2]*b[6])*Q,(b[2]*b[3]-b[0]*b[5])*Q,(b[3]*b[7]-b[4]*b[6])*Q,(b[1]*b[6]-b[0]*b[7])*Q,(b[0]*b[4]-b[1]*b[3])*Q])}equals(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const Q=this.eb,C=F.m;return 0===b?Q[0]===C[0]&&Q[1]===C[1]&&Q[2]===C[2]&&Q[3]===C[3]&&Q[4]===C[4]&&Q[5]===C[5]&&Q[6]===C[6]&&Q[7]===C[7]&&Q[8]===C[8]:Math.abs(Q[0]-C[0])<b&&Math.abs(Q[1]-C[1])<b&&Math.abs(Q[2]-C[2])<b&&Math.abs(Q[3]-C[3])<b&&Math.abs(Q[4]-C[4])<b&&Math.abs(Q[5]-C[5])<b&&Math.abs(Q[6]-C[6])<b&&Math.abs(Q[7]-C[7])<b&&Math.abs(Q[8]-C[8])<b}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.eb.join(", ")})`}}},12961:(F,b,Q)=>{"use strict";var C;function z(F,b,Q,C){switch(b){case"Animation":return C?F.animations.find((F=>F.uniqueId===Q))??null:F.animations[Q]??null;case"AnimationGroup":return C?F.animationGroups.find((F=>F.uniqueId===Q))??null:F.animationGroups[Q]??null;case"Mesh":return C?F.meshes.find((F=>F.uniqueId===Q))??null:F.meshes[Q]??null;case"Material":return C?F.materials.find((F=>F.uniqueId===Q))??null:F.materials[Q]??null;case"SG":return C?F.cameras.find((F=>F.uniqueId===Q))??null:F.cameras[Q]??null;case"Light":return C?F.lights.find((F=>F.uniqueId===Q))??null:F.lights[Q]??null;default:return null}}Q.d(b,{e:()=>z}),function(F){F.Animation="Animation",F.AnimationGroup="AnimationGroup",F.Mesh="Mesh",F.Material="Material",F.SG="SG",F.Light="Light"}(C||(C={}))},12995:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>z});var C=Q(13e3);class z extends C.d{constructor(F,b){if(super(F),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),b)for(const Q of b)this._eventsSignalOutputs[Q]=this._registerSignalOutput(Q+"Event")}_executeOnTick(F){}_startPendingTasks(F){F._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(F),this._resetAfterCanceled(F)),this._preparePendingTasks(F),F._addPendingBlock(this),this.out._activateSignal(F),F._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(F){F._deleteExecutionVariable(this,"_initialized"),F._removePendingBlock(this)}}},12972:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>q});var C=Q(11272),z=Q(11265),t=Q(12979),g=Q(11133),W=Q(12941);class Z extends t.c{constructor(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:C.defaultValue,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(F,b,Q),this.richType=C,this._defaultValue=z,this._optional=t,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new g.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(F){this._isDisabled!==F&&(this._isDisabled=F,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(F,b){b._getConnectionValue(this)!==F&&(b._setConnectionValue(this,F),this.onValueChangedObservable.notifyObservers(F))}resetToDefaultValue(F){F._setConnectionValue(this,this._defaultValue)}connectTo(F){this._isDisabled||super.connectTo(F)}_getValueOrDefault(F){const b=F._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(b):b}getValue(F){if(1===this.connectionType){F._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(F);const b=this._getValueOrDefault(F);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}const b=this.isConnected()?this._connectedPoint[0].getValue(F):this._getValueOrDefault(F);return this._lastValue=b,this.richType.typeTransformer?this.richType.typeTransformer(b):b}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(F),F.richType={},this.richType.serialize(F.richType),F.optional=this._optional,(0,W.f)("defaultValue",this._defaultValue,F)}}(0,z.g)("FlowGraphDataConnection",Z);class q{constructor(F){var b;this.config=F,this.uniqueId=(0,C.b)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(F){}registerDataInput(F,b,Q){const C=new Z(F,0,this,b,Q);return this.dataInputs.push(C),C}registerDataOutput(F,b,Q){const C=new Z(F,1,this,b,Q);return this.dataOutputs.push(C),C}getDataInput(F){return this.dataInputs.find((b=>b.name===F))}getDataOutput(F){return this.dataOutputs.find((b=>b.name===F))}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.f;if(F.uniqueId=this.uniqueId,F.config={},this.config){const Q=this.config,C=Object.keys(Q);for(const z of C)b(z,Q[z],F.config)}F.dataInputs=[],F.dataOutputs=[],F.className=this.getClassName();for(const Q of this.dataInputs){const b={};Q.serialize(b),F.dataInputs.push(b)}for(const Q of this.dataOutputs){const b={};Q.serialize(b),F.dataOutputs.push(b)}}deserialize(F){}_log(F,b,Q){var C;null===(C=F.logger)||void 0===C||C.addLogItem({action:b,gC:Q,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12979:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>t});var C,z=Q(11272);!function(F){F[F.Input=0]="Input",F[F.Output=1]="Output"}(C||(C={}));class t{constructor(F,b,Q){this._ownerBlock=Q,this._connectedPoint=[],this.uniqueId=(0,z.b)(),this.connectedPointIds=[],this.name=F,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(F){if(this._connectionType===F._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||F._isSingularConnection()&&F._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(F),F._connectedPoint.push(this)}disconnectFrom(F){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Q=this._connectedPoint.indexOf(F),C=F._connectedPoint.indexOf(this);-1!==Q&&-1!==C&&(b&&this._connectedPoint.splice(Q,1),F._connectedPoint.splice(C,1))}disconnectFromAll(){for(const F of this._connectedPoint)this.disconnectFrom(F,!1);this._connectedPoint.length=0}dispose(){for(const F of this._connectedPoint)this.disconnectFrom(F)}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};F.uniqueId=this.uniqueId,F.name=this.name,F._connectionType=this._connectionType,F.connectedPointIds=[],F.className=this.getClassName();for(const b of this._connectedPoint)F.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(F){this.uniqueId=F.uniqueId,this.name=F.name,this._connectionType=F._connectionType,this.connectedPointIds=F.connectedPointIds}}},12938:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>i});var C,z=Q(11133),t=Q(11293),g=Q(11296),W=Q(11272),Z=Q(12941),q=Q(12961),G=Q(11146);!function(F){F.ExecuteBlock="ExecuteBlock",F.ExecuteEvent="ExecuteEvent",F.TriggerConnection="TriggerConnection",F.ContextVariableSet="ContextVariableSet",F.GlobalVariableSet="GlobalVariableSet",F.GlobalVariableDelete="GlobalVariableDelete",F.GlobalVariableGet="GlobalVariableGet",F.AddConnection="AddConnection",F.GetConnectionValue="GetConnectionValue",F.SetConnectionValue="SetConnectionValue",F.ActivateSignal="ActivateSignal",F.ContextVariableGet="ContextVariableGet"}(C||(C={}));class K{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(F){if(F.time||(F.time=Date.now()),this.log.push(F),this.logToConsole){var b;const Q=null===(b=F.gC)||void 0===b?void 0:b.value;"object"===typeof Q&&Q.getClassName?G.e.Log(`[FGLog] ${F.className}:${F.uniqueId.split("-")[0]} ${F.action} - ${JSON.stringify(Q.getClassName())}: ${Q.toString()}`):G.e.Log(`[FGLog] ${F.className}:${F.uniqueId.split("-")[0]} ${F.action} - ${JSON.stringify(F.gC)}`)}}getItemsOfType(F){return this.log.filter((b=>b.action===F))}}class e{get enableLogging(){return this._enableLogging}set enableLogging(F){this._enableLogging!==F&&(this._enableLogging=F,this._enableLogging?(this.logger=new K,this.logger.logToConsole=!0):this.logger=null)}constructor(F){this.uniqueId=(0,W.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new z.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=F,this.assetsContext=F.assetsContext??F.ZQ}hasVariable(F){return F in this._userVariables}setVariable(F,b){var Q;this._userVariables[F]=b,null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",gC:{name:F,value:b}})}getAsset(F,b){return(0,q.e)(this.assetsContext,F,b)}getVariable(F){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",gC:{name:F,value:this._userVariables[F]}}),this._userVariables[F]}get userVariables(){return this._userVariables}RF(){return this._configuration.ZQ}_getUniqueIdPrefixedName(F,b){return`${F.uniqueId}_${b}`}_getGlobalContextVariable(F,b){var Q;return null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",gC:{name:F,defaultValue:b,possibleValue:this._globalContextVariables[F]}}),this._hasGlobalContextVariable(F)?this._globalContextVariables[F]:b}_setGlobalContextVariable(F,b){var Q;null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",gC:{name:F,value:b}}),this._globalContextVariables[F]=b}_deleteGlobalContextVariable(F){var b;null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",gC:{name:F}}),delete this._globalContextVariables[F]}_hasGlobalContextVariable(F){return F in this._globalContextVariables}_setExecutionVariable(F,b,Q){this._executionVariables[this._getUniqueIdPrefixedName(F,b)]=Q}_getExecutionVariable(F,b,Q){return this._hasExecutionVariable(F,b)?this._executionVariables[this._getUniqueIdPrefixedName(F,b)]:Q}_deleteExecutionVariable(F,b){delete this._executionVariables[this._getUniqueIdPrefixedName(F,b)]}_hasExecutionVariable(F,b){return this._getUniqueIdPrefixedName(F,b)in this._executionVariables}_hasConnectionValue(F){return F.uniqueId in this._connectionValues}_setConnectionValue(F,b){var Q;this._connectionValues[F.uniqueId]=b,null===(Q=this.logger)||void 0===Q||Q.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",gC:{connectionPointId:F.uniqueId,value:b}})}_setConnectionValueByKey(F,b){this._connectionValues[F]=b}_getConnectionValue(F){var b;return null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",gC:{connectionPointId:F.uniqueId,value:this._connectionValues[F.uniqueId]}}),this._connectionValues[F.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(F){this._pendingBlocks.includes(F)||(this._pendingBlocks.push(F),this._pendingBlocks.sort(((F,b)=>F.priority-b.priority)))}_removePendingBlock(F){const b=this._pendingBlocks.indexOf(F);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const F of this._pendingBlocks)F._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(F){var b;this.onNodeExecutedObservable.notifyObservers(F),null===(b=this.logger)||void 0===b||b.addLogItem({time:Date.now(),className:F.getClassName(),uniqueId:F.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(F){this._setGlobalContextVariable("timeSinceStart",F.timeSinceStart),this._setGlobalContextVariable("deltaTime",F.deltaTime);for(const Q of this._pendingBlocks){var b;null===(b=Q._executeOnTick)||void 0===b||b.call(Q,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.f;F.uniqueId=this.uniqueId,F._userVariables={};for(const C in this._userVariables)b(C,this._userVariables[C],F._userVariables);F._connectionValues={};for(const C in this._connectionValues)b(C,this._connectionValues[C],F._connectionValues);var Q;this.assetsContext!==this.RF()&&(F._assetsContext={meshes:this.assetsContext.meshes.map((F=>F.id)),materials:this.assetsContext.materials.map((F=>F.id)),textures:this.assetsContext.textures.map((F=>F.name)),animations:this.assetsContext.animations.map((F=>F.name)),lights:this.assetsContext.lights.map((F=>F.id)),cameras:this.assetsContext.cameras.map((F=>F.id)),mN:null===(Q=this.assetsContext.mN)||void 0===Q?void 0:Q.map((F=>F.name)),skeletons:this.assetsContext.skeletons.map((F=>F.id)),Te:this.assetsContext.Te.map((F=>F.name)),geometries:this.assetsContext.geometries.map((F=>F.id)),multiMaterials:this.assetsContext.multiMaterials.map((F=>F.id)),transformNodes:this.assetsContext.transformNodes.map((F=>F.id))})}getClassName(){return"FlowGraphContext"}}(0,t.b)([(0,g.A)()],e.prototype,"uniqueId",void 0);var N=Q(12967),y=Q(11570);class E{constructor(F){this.onEventTriggeredObservable=new z.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=F,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Kb.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const F=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",gC:{timeSinceStart:this._startingTime,deltaTime:F}}),this._startingTime+=F})),this._meshPickedObserver=this._scene.onPointerObservable.add((F=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",gC:F})}),y.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((F=>{const b=F.pointerId,Q=F.mesh,C=this._pointerUnderMeshState[b];!C&&Q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",gC:{pointerId:b,mesh:Q}}):C&&!Q?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",gC:{pointerId:b,mesh:C}}):C&&Q&&C!==Q&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",gC:{pointerId:b,mesh:C,over:Q}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",gC:{pointerId:b,mesh:Q,out:C}})),this._pointerUnderMeshState[b]=Q}),y.e.POINTERMOVE)}dispose(){var F,b,Q,C,z;null===(F=this._sceneDisposeObserver)||void 0===F||F.remove(),null===(b=this._sceneReadyObserver)||void 0===b||b.remove(),null===(Q=this._sceneOnBeforeRenderObserver)||void 0===Q||Q.remove(),null===(C=this._meshPickedObserver)||void 0===C||C.remove(),null===(z=this._meshUnderPointerObserver)||void 0===z||z.remove(),this.onEventTriggeredObservable.clear()}}var c,X=Q(12985);!function(F){F[F.Stopped=0]="Stopped",F[F.Started=1]="Started"}(c||(c={}));class L{get state(){return this._state}set state(F){this._state=F,this.onStateChangedObservable.notifyObservers(F)}constructor(F){this.onStateChangedObservable=new z.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=F.ZQ,this._sceneEventCoordinator=new E(this._scene),this._coordinator=F.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((F=>{for(const b of this._executionContexts){const Q=this._getContextualOrder(F.type,b);for(const C of Q)if(!C._executeEvent(b,F.gC))break}switch(F.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const b of this._executionContexts)b._notifyOnTick(F.gC);break;case"SceneDispose":this.dispose()}}))}createContext(){const F=new e({ZQ:this._scene,coordinator:this._coordinator});return this._executionContexts.push(F),F}getContext(F){return this._executionContexts[F]}addEventBlock(F){if("PointerOver"!==F.type&&"PointerOut"!==F.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==F.type&&this._eventBlocks[F.type].push(F),1===this.state)for(const b of this._executionContexts)F._startPendingTasks(b);else this.onStateChangedObservable.addOnce((b=>{if(1===b)for(const Q of this._executionContexts)F._startPendingTasks(Q)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((F=>{1===F&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const F of this._executionContexts)for(const b in this._eventBlocks){const Q=this._getContextualOrder(b,F);for(const b of Q)b._startPendingTasks(F)}}_getContextualOrder(F,b){const Q=this._eventBlocks[F].sort(((F,b)=>b.initPriority-F.initPriority));if("MeshPick"===F){const F=[];for(const C of Q){const z=C.asset.getValue(b);let t=0;for(;t<Q.length;t++){const F=Q[t].asset.getValue(b);if(z&&F&&(0,X.l)(z,F))break}F.splice(t,0,C)}return F}return Q}dispose(){var F;if(0!==this.state){this.state=0;for(const F of this._executionContexts)F._clearPendingBlocks();this._executionContexts.length=0;for(const F in this._eventBlocks)this._eventBlocks[F].length=0;null===(F=this._eventObserver)||void 0===F||F.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(F){const b=[],Q=new Set;for(const C in this._eventBlocks)for(const F of this._eventBlocks[C])b.push(F),Q.add(F.uniqueId);for(;b.length>0;){const C=b.pop();F(C);for(const F of C.dataInputs)for(const C of F._connectedPoint)Q.has(C._ownerBlock.uniqueId)||(b.push(C._ownerBlock),Q.add(C._ownerBlock.uniqueId));if(C instanceof N.d)for(const F of C.signalOutputs)for(const C of F._connectedPoint)Q.has(C._ownerBlock.uniqueId)||(b.push(C._ownerBlock),Q.add(C._ownerBlock.uniqueId))}}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;F.allBlocks=[],this.visitAllBlocks((b=>{const Q={};b.serialize(Q),F.allBlocks.push(Q)})),F.executionContexts=[];for(const Q of this._executionContexts){const C={};Q.serialize(C,b),F.executionContexts.push(C)}}}class i{constructor(F){this.config=F,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ZQ.Kb.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ZQ.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const F=this._executeOnNextFrame.slice(0);if(F.length)for(const b of F){this.notifyCustomEvent(b.id,b.data,!1);const F=this._executeOnNextFrame.findIndex((F=>F.uniqueId===b.uniqueId));-1!==F&&this._executeOnNextFrame.splice(F,1)}}));(i.SceneCoordinators.get(this.config.ZQ)??[]).push(this)}createGraph(){const F=new L({ZQ:this.config.ZQ,coordinator:this});return this._flowGraphs.push(F),F}removeGraph(F){const b=this._flowGraphs.indexOf(F);-1!==b&&(F.dispose(),this._flowGraphs.splice(b,1))}start(){for(const F of this._flowGraphs)F.start()}dispose(){var F,b;for(const z of this._flowGraphs)z.dispose();this._flowGraphs.length=0,null===(F=this._disposeObserver)||void 0===F||F.remove(),null===(b=this._onBeforeRenderObserver)||void 0===b||b.remove();const Q=i.SceneCoordinators.get(this.config.ZQ)??[],C=Q.indexOf(this);-1!==C&&Q.splice(C,1)}serialize(F,b){F._flowGraphs=[];for(const Q of this._flowGraphs){const C={};Q.serialize(C,b),F._flowGraphs.push(C)}F.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(F){let b=this._customEventsMap.get(F);return b||(b=new z.c,this._customEventsMap.set(F,b)),b}notifyCustomEvent(F,b){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:F,data:b,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(F)){const b=this._eventExecutionCounter.get(F);if(this._eventExecutionCounter.set(F,b+1),b>=i.MaxEventTypeExecutionPerFrame)return void(b===i.MaxEventTypeExecutionPerFrame&&G.e.Warn(`FlowGraphCoordinator: Too many executions of event "${F}".`))}else this._eventExecutionCounter.set(F,1);const Q=this._customEventsMap.get(F);Q&&Q.notifyObservers(b)}}i.MaxEventsPerType=30,i.MaxEventTypeExecutionPerFrame=30,i.SceneCoordinators=new Map},12989:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>z});var C=Q(12995);class z extends C.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(F){F._notifyExecuteNode(this),this.done._activateSignal(F)}}},12967:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>W});var C=Q(12972),z=Q(12979),t=Q(11265);class g extends z.c{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(F){super.connectTo(F),this._connectedPoint.sort(((F,b)=>b.priority-F.priority))}_activateSignal(F){var b;if(null===(b=F.logger)||void 0===b||b.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,gC:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)F._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(F,this),F._increaseExecutionId();else for(const Q of this._connectedPoint)Q._activateSignal(F)}}(0,t.g)("FlowGraphSignalConnection",g);class W extends C.b{constructor(F){super(F),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(F){const b=new g(F,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(F){const b=new g(F,1,this);return this.signalOutputs.push(b),b}_unregisterSignalInput(F){const b=this.signalInputs.findIndex((b=>b.name===F));-1!==b&&(this.signalInputs[b].dispose(),this.signalInputs.splice(b,1))}_unregisterSignalOutput(F){const b=this.signalOutputs.findIndex((b=>b.name===F));-1!==b&&(this.signalOutputs[b].dispose(),this.signalOutputs.splice(b,1))}_reportError(F,b){this.error.gC="string"===typeof b?new Error(b):b,this.error._activateSignal(F)}getSignalInput(F){return this.signalInputs.find((b=>b.name===F))}getSignalOutput(F){return this.signalOutputs.find((b=>b.name===F))}serialize(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(F),F.signalInputs=[],F.signalOutputs=[];for(const b of this.signalInputs){const Q={};b.serialize(Q),F.signalInputs.push(Q)}for(const b of this.signalOutputs){const Q={};b.serialize(Q),F.signalOutputs.push(Q)}}deserialize(F){for(let b=0;b<F.signalInputs.length;b++){const Q=this.getSignalInput(F.signalInputs[b].name);if(!Q)throw new Error("Could not find signal input with name "+F.signalInputs[b].name+" in block "+F.className);Q.deserialize(F.signalInputs[b])}for(let b=0;b<F.signalOutputs.length;b++){const Q=this.getSignalOutput(F.signalOutputs[b].name);if(!Q)throw new Error("Could not find signal output with name "+F.signalOutputs[b].name+" in block "+F.className);Q.deserialize(F.signalOutputs[b])}}getClassName(){return"FlowGraphExecutionBlock"}}},13e3:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>z});var C=Q(12967);class z extends C.d{constructor(F){super(F),this.out=this._registerSignalOutput("out")}}},12951:(F,b,Q)=>{"use strict";Q.d(b,{B:()=>P,F:()=>p,H:()=>R,b:()=>q,e:()=>e,g:()=>m,j:()=>c,k:()=>X,l:()=>L,m:()=>K,n:()=>k,q:()=>G,r:()=>N,t:()=>y,v:()=>E,z:()=>D});var C,z=Q(11309),t=Q(11359),g=Q(12948),W=Q(12958);!function(F){F.Any="any",F.String="string",F.Number="number",F.Boolean="boolean",F.Object="object",F.Integer="FlowGraphInteger",F.Vector2="Vector2",F.gQ="gQ",F.Vector4="Vector4",F.Quaternion="Quaternion",F.Matrix="Matrix",F.Matrix2D="Matrix2D",F.Matrix3D="Matrix3D",F.GQ="GQ",F.sb="sb"}(C||(C={}));class Z{constructor(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=F,this.defaultValue=b,this.animationType=Q}serialize(F){F.typeName=this.typeName,F.defaultValue=this.defaultValue}}const q=new Z("any",void 0),G=new Z("string",""),K=new Z("number",0,0),e=new Z("boolean",!1),N=new Z("Vector2",z.Vector2.Zero(),5),y=new Z("gQ",z.gQ.Zero(),1),E=new Z("Vector4",z.Vector4.Zero()),c=new Z("Matrix",z.Matrix.Identity(),3),X=new Z("Matrix2D",new W.b),L=new Z("Matrix3D",new W.e),i=new Z("GQ",t.GQ.Black(),4),f=new Z("sb",new t.sb(0,0,0,0),7),k=new Z("Quaternion",z.Quaternion.Identity(),2);k.typeTransformer=F=>{if(F.getClassName){if("Vector4"===F.getClassName())return z.Quaternion.KQ(F.Lb());if("gQ"===F.getClassName())return z.Quaternion.FromEulerVector(F);if("Matrix"===F.getClassName())return z.Quaternion.FromRotationMatrix(F)}return F};const m=new Z("FlowGraphInteger",new g.b(0),0);function R(F){const b=F;switch(typeof F){case"string":return G;case"number":return K;case"boolean":return e;case"object":if(b.getClassName)switch(b.getClassName()){case"Vector2":return N;case"gQ":return y;case"Vector4":return E;case"Matrix":return c;case"GQ":return i;case"sb":return f;case"Quaternion":return k;case"FlowGraphInteger":return m;case"Matrix2D":return X;case"Matrix3D":return L}return q;default:return q}}function p(F){switch(F){case"string":return G;case"number":return K;case"boolean":return e;case"Vector2":return N;case"gQ":return y;case"Vector4":return E;case"Matrix":return c;case"GQ":return i;case"sb":return f;case"Quaternion":return k;case"FlowGraphInteger":return m;case"Matrix2D":return X;case"Matrix3D":return L;default:return q}}function D(F){switch(F){case"number":default:return 0;case"Vector2":return 5;case"gQ":return 1;case"Matrix":return 3;case"GQ":return 4;case"sb":return 7;case"Quaternion":return 2}}function P(F){switch(F){case 0:return K;case 5:return N;case 1:return y;case 3:return c;case 4:return i;case 7:return f;case 2:return k;default:return q}}},12941:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>G,f:()=>q,g:()=>K});var C=Q(11359),z=Q(11309),t=Q(12948),g=Q(12951),W=Q(12958);function Z(F){return"Vector2"===F||"gQ"===F||"Vector4"===F||"Quaternion"===F||"GQ"===F||"sb"===F}function q(F,b,Q){var C;const z=(null===b||void 0===b||null===(C=b.getClassName)||void 0===C?void 0:C.call(b))??"";if(Z(z)||function(F){return"Matrix"===F||"Matrix2D"===F||"Matrix3D"===F}(z))Q[F]={value:b.Lb(),className:z};else if("FlowGraphInteger"===z)Q[F]={value:b.value,className:z};else if(z&&(b.id||b.name))Q[F]={id:b.id,name:b.name,className:z};else{if("object"===typeof b)throw new Error(`Could not serialize value ${b}`);Q[F]=b}}function G(F,b,Q,q){const K=b[F];let e;const N=(null===K||void 0===K?void 0:K.type)??(null===K||void 0===K?void 0:K.className);if(function(F){return"Mesh"===F||"AbstractMesh"===F||"GroundMesh"===F||"InstanceMesh"===F||"LinesMesh"===F||"GoldbergMesh"===F||"GreasedLineMesh"===F||"TrailMesh"===F}(N)){let F=q.meshes.filter((F=>K.id?F.id===K.id:F.name===K.name));0===F.length&&(F=q.transformNodes.filter((F=>K.id?F.id===K.id:F.name===K.name))),e=K.uniqueId?F.find((F=>F.uniqueId===K.uniqueId)):F[0]}else if(Z(N))e=function(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===F)return z.Vector2.KQ(b);if("gQ"===F)return Q&&(b[2]*=-1),z.gQ.KQ(b);if("Vector4"===F)return z.Vector4.KQ(b);if("Quaternion"===F)return Q&&(b[2]*=-1,b[3]*=-1),z.Quaternion.KQ(b);if("GQ"===F)return new C.GQ(b[0],b[1],b[2]);if("sb"===F)return new C.sb(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${F}`)}(N,K.value);else if(function(F){return"AnimationGroup"===F}(N)){const F=q.animationGroups.filter((F=>F.name===K.name));e=1===F.length?F[0]:F.find((F=>F.uniqueId===K.uniqueId))}else e="Matrix"===N?z.Matrix.KQ(K.value):"Matrix2D"===N?new W.b(K.value):"Matrix3D"===N?new W.e(K.value):"FlowGraphInteger"===N?t.b.FromValue(K.value):"number"===N||"string"===N||"boolean"===N?K.value[0]:K&&void 0!==K.value?K.value:Array.isArray(K)?K.reduce(((F,b)=>b.eventData?(F[b.id]={type:(0,g.F)(b.type)},"undefined"!==typeof b.value&&(F[b.id].value=G("value",b,Q,q)),F):F),{}):K;return e}function K(F){return"FlowGraphJsonPointerParserBlock"===F}},12985:(F,b,Q)=>{"use strict";function C(F,b){return!(!F.parent||F.parent!==b&&!C(F.parent,b))}function z(F){if(F.getClassName)return F.getClassName()}function t(F,b){return F===b&&("Vector2"===F||"gQ"===F||"Vector4"===F||"Quaternion"===F)}function g(F,b){return F===b&&("Matrix"===F||"Matrix2D"===F||"Matrix3D"===F)}function W(F,b){return"FlowGraphInteger"===F&&"FlowGraphInteger"===b}function Z(F,b){const Q="number"===typeof F||"number"===typeof(null===F||void 0===F?void 0:F.value);return Q&&!b?!isNaN(q(F)):Q}function q(F){return"number"===typeof F?F:F.value}Q.d(b,{b:()=>W,e:()=>g,g:()=>t,j:()=>z,l:()=>C,n:()=>q,q:()=>Z})},12357:(F,b,Q)=>{"use strict";Q.r(b),Q.d(b,{SceneInstrumentation:()=>t});var C=Q(11128),z=Q(11520);class t{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(F){F!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=F,F?(this._onBeforeActiveMeshesEvaluationObserver=this.ZQ.onBeforeActiveMeshesEvaluationObservable.add((()=>{C.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ZQ.onAfterActiveMeshesEvaluationObservable.add((()=>{C.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ZQ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ZQ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(F){F!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=F,F?(this._onBeforeRenderTargetsRenderObserver=this.ZQ.onBeforeRenderTargetsRenderObservable.add((()=>{C.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ZQ.onAfterRenderTargetsRenderObservable.add((()=>{C.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ZQ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ZQ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(F){F!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=F,F?(this._onBeforeParticlesRenderingObserver=this.ZQ.onBeforeParticlesRenderingObservable.add((()=>{C.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ZQ.onAfterParticlesRenderingObservable.add((()=>{C.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ZQ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ZQ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(F){F!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=F,this.ZQ.spriteManagers&&(F?(this._onBeforeSpritesRenderingObserver=this.ZQ.onBeforeSpritesRenderingObservable.add((()=>{C.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ZQ.onAfterSpritesRenderingObservable.add((()=>{C.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ZQ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ZQ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(F){F!==this._capturePhysicsTime&&this.ZQ.onBeforePhysicsObservable&&(this._capturePhysicsTime=F,F?(this._onBeforePhysicsObserver=this.ZQ.onBeforePhysicsObservable.add((()=>{C.Tools.StartPerformanceCounter("Ab"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ZQ.onAfterPhysicsObservable.add((()=>{C.Tools.EndPerformanceCounter("Ab"),this._physicsTime.endMonitoring()}))):(this.ZQ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ZQ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(F){F!==this._captureAnimationsTime&&(this._captureAnimationsTime=F,F?this._onAfterAnimationsObserver=this.ZQ.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ZQ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(F){this._captureFrameTime=F}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(F){this._captureInterFrameTime=F}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(F){F!==this._captureRenderTime&&(this._captureRenderTime=F,F?(this._onBeforeDrawPhaseObserver=this.ZQ.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),C.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ZQ.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),C.Tools.EndPerformanceCounter("Main render")}))):(this.ZQ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ZQ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(F){F!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=F,F?(this._onBeforeCameraRenderObserver=this.ZQ.onBeforeCameraRenderObservable.add((F=>{this._cameraRenderTime.beginMonitoring(),C.Tools.StartPerformanceCounter(`Rendering camera ${F.name}`)})),this._onAfterCameraRenderObserver=this.ZQ.onAfterCameraRenderObservable.add((F=>{this._cameraRenderTime.endMonitoring(!1),C.Tools.EndPerformanceCounter(`Rendering camera ${F.name}`)}))):(this.ZQ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ZQ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ZQ.getEngine()._drawCalls}constructor(F){this.ZQ=F,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new z.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new z.e,this._captureFrameTime=!1,this._frameTime=new z.e,this._captureRenderTime=!1,this._renderTime=new z.e,this._captureInterFrameTime=!1,this._interFrameTime=new z.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new z.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new z.e,this._capturePhysicsTime=!1,this._physicsTime=new z.e,this._captureAnimationsTime=!1,this._animationsTime=new z.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new z.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=F.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(C.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ZQ.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=F.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(C.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Gb(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Gb(),this._captureParticlesRenderTime&&this._particlesRenderTime.Gb(),this._captureSpritesRenderTime&&this._spritesRenderTime.Gb(),this._captureRenderTime&&this._renderTime.Gb(),this._captureCameraRenderTime&&this._cameraRenderTime.Gb()}))}dispose(){this._disposed||(this.ZQ.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ZQ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ZQ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ZQ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ZQ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ZQ.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ZQ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ZQ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ZQ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ZQ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ZQ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ZQ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ZQ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ZQ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ZQ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ZQ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ZQ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ZQ=null,this._disposed=!0)}}},12933:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>G});var C=Q(11293),z=Q(11296),t=Q(11309),g=Q(11715),W=Q(11827),Z=Q(11881),q=Q(11265);g.c.AddNodeConstructor("Light_Type_1",((F,b)=>()=>new G(F,t.gQ.Zero(),b)));class G extends Z.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(F){this._shadowFrustumSize=F,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(F){this._shadowOrthoScale=F,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(F){this._orthoLeft=F}get orthoRight(){return this._orthoRight}set orthoRight(F){this._orthoRight=F}get orthoTop(){return this._orthoTop}set orthoTop(F){this._orthoTop=F}get orthoBottom(){return this._orthoBottom}set orthoBottom(F){this._orthoBottom=F}constructor(F,b,Q){super(F,Q),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"Ub"}getTypeID(){return W.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(F,b,Q){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(F):this._setDefaultAutoExtendShadowProjectionMatrix(F,b,Q)}_setDefaultFixedFrustumShadowProjectionMatrix(F){const b=this.RF().activeCamera;b&&t.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b.kb,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,F,this.RF().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(F,b,Q){const C=this.RF().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const F=t.gQ.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let C=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(let g=0;g<Q.length;g++){const W=Q[g];if(!W)continue;const Z=W.getBoundingInfo().boundingBox;for(let Q=0;Q<Z.vectorsWorld.length;Q++)t.gQ.TransformCoordinatesToRef(Z.vectorsWorld[Q],b,F),F.x<this._orthoLeft&&(this._orthoLeft=F.x),F.y<this._orthoBottom&&(this._orthoBottom=F.y),F.x>this._orthoRight&&(this._orthoRight=F.x),F.y>this._orthoTop&&(this._orthoTop=F.y),this.autoCalcShadowZBounds&&(F.z<C&&(C=F.z),F.z>z&&(z=F.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=C,this._shadowMaxZ=z)}const z=this._orthoRight-this._orthoLeft,g=this._orthoTop-this._orthoBottom,W=void 0!==this.shadowMinZ?this.shadowMinZ:(null===C||void 0===C?void 0:C.kb)||0,Z=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===C||void 0===C?void 0:C.maxZ)||1e4,q=this.RF().getEngine().useReverseDepthBuffer;t.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-z*this.shadowOrthoScale,this._orthoRight+z*this.shadowOrthoScale,this._orthoBottom-g*this.shadowOrthoScale,this._orthoTop+g*this.shadowOrthoScale,q?Z:W,q?W:Z,F,this.RF().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(F,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(F,b){return this.computeTransformedInformation()?(F.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(F.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(F){const b=this._scene.getEngine();return!b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}getDepthMaxZ(F){const b=this._scene.getEngine();return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(F,b){F["DIRLIGHT"+b]=!0}}(0,C.b)([(0,z.A)()],G.prototype,"shadowFrustumSize",null),(0,C.b)([(0,z.A)()],G.prototype,"shadowOrthoScale",null),(0,C.b)([(0,z.A)()],G.prototype,"autoUpdateExtends",void 0),(0,C.b)([(0,z.A)()],G.prototype,"autoCalcShadowZBounds",void 0),(0,C.b)([(0,z.A)("orthoLeft")],G.prototype,"_orthoLeft",void 0),(0,C.b)([(0,z.A)("orthoRight")],G.prototype,"_orthoRight",void 0),(0,C.b)([(0,z.A)("orthoTop")],G.prototype,"_orthoTop",void 0),(0,C.b)([(0,z.A)("orthoBottom")],G.prototype,"_orthoBottom",void 0),(0,q.g)("BABYLON.DirectionalLight",G)},13415:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>G});var C=Q(11293),z=Q(11296),t=Q(11309),g=Q(11359),W=Q(11715),Z=Q(11827),q=Q(11265);W.c.AddNodeConstructor("Light_Type_3",((F,b)=>()=>new G(F,t.gQ.Zero(),b)));class G extends Z.e{constructor(F,b,Q){super(F,Q),this.groundColor=new g.GQ(0,0,0),this.direction=b||t.gQ.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"ub"}setDirectionToTarget(F){return this.direction=t.gQ.Normalize(F.WQ(t.gQ.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(F,b){const Q=t.gQ.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",Q.x,Q.y,Q.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.lb),b),this}transferToNodeMaterialEffect(F,b){const Q=t.gQ.Normalize(this.direction);return F.setFloat3(b,Q.x,Q.y,Q.z),this}Rb(){return this._worldMatrix||(this._worldMatrix=t.Matrix.Identity()),this._worldMatrix}getTypeID(){return Z.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(F,b){F["HEMILIGHT"+b]=!0}}(0,C.b)([(0,z.i)()],G.prototype,"groundColor",void 0),(0,C.b)([(0,z.y)()],G.prototype,"direction",void 0),(0,q.g)("BABYLON.HemisphericLight",G)},12903:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>K});var C=Q(11293),z=Q(11296),t=Q(11309),g=Q(11715),W=Q(11827),Z=Q(11881),q=Q(11287),G=Q(11265);g.c.AddNodeConstructor("Light_Type_2",((F,b)=>()=>new K(F,t.gQ.Zero(),t.gQ.Zero(),0,0,b)));class K extends Z.e{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(F){this._iesProfileTexture!==F&&(this._iesProfileTexture=F,this._iesProfileTexture&&K._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(F){this._angle=F,this._cosHalfAngle=Math.cos(.5*F),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(F){this._innerAngle=F,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(F){this._shadowAngleScale=F,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(F){this._projectionTextureLightNear=F,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(F){this._projectionTextureLightFar=F,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(F){this._projectionTextureUpDirection=F,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(F){this._projectionTexture!==F&&(this._projectionTexture=F,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(K._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):K._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(F){return void 0!==F.onGeneratedObservable}static _IsTexture(F){return void 0!==F.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(F){this._projectionTextureProjectionLightMatrix=F,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(F,b,Q,C,z,g){super(F,g),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=t.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=t.gQ.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=t.gQ.Zero(),this._projectionTextureViewLightMatrix=t.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=t.Matrix.Zero(),this._projectionTextureScalingMatrix=t.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=Q,this.angle=C,this.exponent=z}getClassName(){return"SpotLight"}getTypeID(){return W.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(F){super._setDirection(F),this._projectionTextureViewLightDirty=!0}_setPosition(F){super._setPosition(F),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(F,b,Q){const C=this.RF().activeCamera;if(!C)return;this._shadowAngleScale=this._shadowAngleScale||1;const z=this._shadowAngleScale*this._angle,g=void 0!==this.shadowMinZ?this.shadowMinZ:C.kb,W=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,Z=this.RF().getEngine().useReverseDepthBuffer;t.Matrix.PerspectiveFovLHToRef(z,1,Z?W:g,Z?g:W,F,!0,this._scene.getEngine().isNDCHalfZRange,void 0,Z)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),t.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const F=this.projectionTextureLightFar,b=this.projectionTextureLightNear,Q=F/(F-b),C=-Q*b,z=1/Math.tan(this._angle/2);t.Matrix.FromValuesToRef(z/1,0,0,0,0,z,0,0,0,0,Q,1,0,0,C,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof q.b){const F=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;t.Matrix.FromValuesToRef(F,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(F,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),F.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),F.setTexture("projectionLightTexture"+b,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&F.setTexture("iesLightTexture"+b,this._iesProfileTexture),this}transferToEffect(F,b){let Q;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),Q=t.gQ.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),Q=t.gQ.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",Q.x,Q.y,Q.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(F,b){let Q;return Q=this.computeTransformedInformation()?t.gQ.Normalize(this.transformedDirection):t.gQ.Normalize(this.direction),this.RF().useRightHandedSystem?F.setFloat3(b,-Q.x,-Q.y,-Q.z):F.setFloat3(b,Q.x,Q.y,Q.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(F){const b=this._scene.getEngine(),Q=void 0!==this.shadowMinZ?this.shadowMinZ:(null===F||void 0===F?void 0:F.kb)??0;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?Q:this._scene.getEngine().isNDCHalfZRange?0:Q}getDepthMaxZ(F){const b=this._scene.getEngine(),Q=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===F||void 0===F?void 0:F.maxZ)??1e4;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:Q}prepareLightSpecificDefines(F,b){F["SPOTLIGHT"+b]=!0,F["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady()),F["IESLIGHTTEXTURE"+b]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,C.b)([(0,z.A)()],K.prototype,"angle",null),(0,C.b)([(0,z.A)()],K.prototype,"innerAngle",null),(0,C.b)([(0,z.A)()],K.prototype,"shadowAngleScale",null),(0,C.b)([(0,z.A)()],K.prototype,"exponent",void 0),(0,C.b)([(0,z.A)()],K.prototype,"projectionTextureLightNear",null),(0,C.b)([(0,z.A)()],K.prototype,"projectionTextureLightFar",null),(0,C.b)([(0,z.A)()],K.prototype,"projectionTextureUpDirection",null),(0,C.b)([(0,z.w)("projectedLightTexture")],K.prototype,"_projectionTexture",void 0),(0,G.g)("BABYLON.SpotLight",K)},12644:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>g,f:()=>t,i:()=>W});const C={},z={};function t(F,b){C[F]=b}function g(F,b){z[F]=b}function W(F){return z[F]?z[F]:null}},12525:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>R,f:()=>l});var C,z=Q(11128),t=Q(11133),g=Q(11537),W=Q(11161),Z=Q(11146),q=Q(11755),G=Q(11170),K=Q(11174),e=Q(11272),N=Q(11203),y=Q(11159);!function(F){F[F.Clean=0]="Clean",F[F.Stop=1]="Stop",F[F.Sync=2]="Sync",F[F.NoSync=3]="NoSync"}(C||(C={}));const E=new t.c,c={};let X=!1;function L(){return c[".babylon"]}function i(F,b){const Q=c[F];return Q||(Z.e.Warn("Unable to find a plugin to load "+F+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),b?L():void 0)}function f(F,b,Q){let C="Unable to load from "+(F.rawData?"binary data":F.url);return b?C+=`: ${b}`:Q&&(C+=`: ${Q}`),C}async function k(F,b,Q,C,z,t,g,W,Z){var q;const K="data:"===(e=F.url).substring(0,5)?e.substring(5):null;var e;if(F.rawData&&!g)throw"When using ArrayBufferView to load data the file extension must be provided.";const X=K||g?"":function(F){const b=F.indexOf("?");-1!==b&&(F=F.substring(0,b));const Q=F.lastIndexOf(".");return F.substring(Q,F.length).toLowerCase()}(F.url);let f=g?i(g,!0):K?function(F){for(const b in c){const Q=c[b].plugin;if(Q.canDirectLoad&&Q.canDirectLoad(F))return c[b]}return L()}(F.url):i(X,!1);if(!f&&X){if(F.url&&!F.url.startsWith("blob:")){const b=await async function(F,b){const Q=b.method||"GET";return await new Promise(((C,z)=>{const t=new y.b;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const F={};if(b.responseHeaders)for(const Q of b.responseHeaders)F[Q]=t.getResponseHeader(Q)||"";C({response:t.response,headerValues:F})}else z(`Unable to fetch data from ${F}. Error code: ${t.status}`)})),t.open(Q,F),t.send()}))}(F.url,{method:"HEAD",responseHeaders:["Content-Type"]}),Q=b.headerValues?b.headerValues["Content-Type"]:"";Q&&(f=function(F){for(const b in c){const Q=c[b];if(Q.mimeType===F)return Q}}(Q))}f||(f=L())}if(!f)throw new Error(`No plugin or fallback for ${g??F.url}`);if(!1===(null===Z||void 0===Z||null===(q=Z[f.plugin.name])||void 0===q?void 0:q.enabled))throw new Error(`The '${f.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(F.rawData&&!f.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(F=>{if(f.plugin.createPlugin){const b=f.plugin.createPlugin(Z??{});return b instanceof Promise?(b.then(F).catch((F=>{z("Error instantiating plugin.",F)})),null):(F(b),b)}return F(f.plugin),f.plugin})((Z=>{var q;if(!Z)throw`The loader plugin corresponding to the '${g}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(E.notifyObservers(Z),K&&(Z.canDirectLoad&&Z.canDirectLoad(F.url)||!(0,G.n)(F.url))){if(Z.directLoad){const F=Z.directLoad(b,K);F instanceof Promise?F.then((F=>{Q(Z,F)})).catch((F=>{z("Error in directLoad of _loadData: "+F,F)})):Q(Z,F)}else Q(Z,K);return}const e=f.isBinary,y=(F,C)=>{b.G?z("Scene has been disposed"):Q(Z,F,C)};let c=null,X=!1;null===(q=Z.Kb)||void 0===q||q.add((()=>{X=!0,c&&(c.abort(),c=null),t()}));const L=()=>{if(X)return;const Q=(F,b)=>{z(null===F||void 0===F?void 0:F.statusText,b)};if(!Z.loadFile&&F.rawData)throw"Plugin does not support loading ArrayBufferView.";c=Z.loadFile?Z.loadFile(b,F.rawData||F.file||F.url,F.rootUrl,y,C,e,Q,W):b._loadFile(F.file||F.url,y,C,!0,e,Q)},i=b.getEngine();let k=i.enableOfflineSupport;if(k){let Q=!1;for(const C of b.disableOfflineSupportExceptionRules)if(C.test(F.url)){Q=!0;break}k=!Q}k&&N.d.OfflineProviderFactory?b.offlineProvider=N.d.OfflineProviderFactory(F.url,L,i.disableManifestCheck):L()}))}function m(F,b){let Q,C,t=null,g=null;if(b)if(b.name)Q=`file:${b.name}`,C=b.name,t=b;else if(ArrayBuffer.isView(b))Q="",C=(0,e.b)(),g=b;else if(b.startsWith("data:"))Q=b,C="";else if(F){const t=b;if("/"===t.substring(0,1))return z.Tools.Error("Wrong sceneFilename parameter"),null;Q=F+t,C=t}else Q=b,C=z.Tools.GetFilename(b),F=z.Tools.GetFolderPath(b);else Q=F,C=z.Tools.GetFilename(F),F=z.Tools.GetFolderPath(F);return{url:Q,rootUrl:F,name:C,file:t,rawData:g}}function R(F){if("string"===typeof F.extensions){const b=F.extensions;c[b.toLowerCase()]={plugin:F,isBinary:!1}}else{const b=F.extensions,Q=Object.keys(b);for(const C of Q)c[C.toLowerCase()]={plugin:F,isBinary:b[C].isBinary,mimeType:b[C].mimeType}}}async function p(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:W.d.LastCreatedScene,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",e=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!C)return Z.e.Error("No scene available to import mesh to"),null;const N=m(b,Q);if(!N)return null;const y={};C.addPendingData(y);const E=()=>{C.removePendingData(y)},c=(F,b)=>{const Q=f(N,F,b);g?g(C,Q,new K.l(Q,K.h.SceneLoaderError,b)):Z.e.Error(Q),E()},X=t?F=>{try{t(F)}catch(b){c("Error in onProgress callback: "+b,b)}}:void 0,L=(F,b,Q,t,g,W,Z,q)=>{if(C.importedMeshesFiles.push(N.url),z)try{z(F,b,Q,t,g,W,Z,q)}catch(G){c("Error in onSuccess callback: "+G,G)}C.removePendingData(y)};return await k(N,C,((b,Q,z)=>{if(b.rewriteRootURL&&(N.rootUrl=b.rewriteRootURL(N.rootUrl,z)),b.importMesh){const z=[],t=[],g=[];if(!b.importMesh(F,C,Q,N.rootUrl,z,t,g,c))return;C.loadingPluginName=b.name,L(z,t,g,[],[],[],[],[])}else{b.importMeshAsync(F,C,Q,N.rootUrl,X,N.name).then((F=>{C.loadingPluginName=b.name,L(F.meshes,F.Te,F.skeletons,F.animationGroups,F.transformNodes,F.geometries,F.lights,F.spriteManagers)})).catch((F=>{c(F.message,F)}))}}),X,c,E,q,G,e)}async function D(F,b,Q,C,z,t,g,W){return await new Promise(((Z,q)=>{try{p(F,b,Q,C,((F,b,Q,C,z,t,g,W)=>{Z({meshes:F,Te:b,skeletons:Q,animationGroups:C,transformNodes:z,geometries:t,lights:g,spriteManagers:W})}),z,((F,b,Q)=>{q(Q||new Error(b))}),t,g,W).catch(q)}catch(K){q(K)}}))}async function P(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.d.LastCreatedEngine,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};Q?await j(F,b,new g.c(Q),C,t,Z,q,G,K):z.Tools.Error("No engine available")}async function n(F,b,Q,C,z,t,g){return await new Promise(((W,Z)=>{P(F,b,Q,(F=>{W(F)}),C,((F,b,Q)=>{Z(Q||new Error(b))}),z,t,g)}))}async function j(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.d.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return Z.e.Error("No scene available to append to"),null;const N=m(F,b);if(!N)return null;const y={};Q.addPendingData(y);const E=()=>{Q.removePendingData(y)};q.c.ShowLoadingScreen&&!X&&(X=!0,Q.getEngine().displayLoadingUI(),Q.executeWhenReady((()=>{Q.getEngine().hideLoadingUI(),X=!1})));const c=(F,b)=>{const C=f(N,F,b);t?t(Q,C,new K.l(C,K.h.SceneLoaderError,b)):Z.e.Error(C),E()},L=z?F=>{try{z(F)}catch(b){c("Error in onProgress callback",b)}}:void 0,i=()=>{if(C)try{C(Q)}catch(F){c("Error in onSuccess callback",F)}Q.removePendingData(y)};return await k(N,Q,((F,b)=>{if(F.load){if(!F.load(Q,b,N.rootUrl,c))return;Q.loadingPluginName=F.name,i()}else{F.loadAsync(Q,b,N.rootUrl,L,N.name).then((()=>{Q.loadingPluginName=F.name,i()})).catch((F=>{c(F.message,F)}))}}),L,c,E,g,G,e)}async function w(F,b,Q,C,z,t,g){return await new Promise(((W,Z)=>{try{j(F,b,Q,(F=>{W(F)}),C,((F,b,Q)=>{Z(Q||new Error(b))}),z,t,g).catch(Z)}catch(K){Z(K)}}))}async function Y(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.d.LastCreatedScene,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!Q)return Z.e.Error("No scene available to load asset container to"),null;const e=m(F,b);if(!e)return null;const N={};Q.addPendingData(N);const y=()=>{Q.removePendingData(N)},E=(F,b)=>{const C=f(e,F,b);t?t(Q,C,new K.l(C,K.h.SceneLoaderError,b)):Z.e.Error(C),y()},c=z?F=>{try{z(F)}catch(b){E("Error in onProgress callback",b)}}:void 0,X=F=>{if(C)try{C(F)}catch(b){E("Error in onSuccess callback",b)}Q.removePendingData(N)};return await k(e,Q,((F,b)=>{if(F.loadAssetContainer){const C=F.loadAssetContainer(Q,b,e.rootUrl,E);if(!C)return;C.populateRootNodes(),Q.loadingPluginName=F.name,X(C)}else if(F.loadAssetContainerAsync){F.loadAssetContainerAsync(Q,b,e.rootUrl,c,e.name).then((b=>{b.populateRootNodes(),Q.loadingPluginName=F.name,X(b)})).catch((F=>{E(F.message,F)}))}else E("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),c,E,y,g,q,G)}async function s(F,b,Q,C,z,t,g){return await new Promise(((W,Z)=>{try{Y(F,b,Q,(F=>{W(F)}),C,((F,b,Q)=>{Z(Q||new Error(b))}),z,t,g).catch(Z)}catch(K){Z(K)}}))}async function V(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.d.LastCreatedScene,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,e=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",N=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!Q)return void Z.e.Error("No scene available to load animations to");if(C){for(const C of Q.animatables)C.reset();Q.stopAllAnimations();const F=Q.animationGroups.slice();for(const Q of F)Q.dispose();const b=Q.getNodes();for(const Q of b)Q.animations&&(Q.animations=[])}else switch(z){case 0:const F=Q.animationGroups.slice();for(const b of F)b.dispose();break;case 1:for(const b of Q.animationGroups)b.stop();break;case 2:for(const b of Q.animationGroups)b.reset(),b.restart();break;case 3:break;default:return void Z.e.Error("Unknown animation group loading mode value '"+z+"'")}const y=Q.animatables.length;await Y(F,b,Q,(F=>{F.mergeAnimationsTo(Q,Q.animatables.slice(y),t),F.dispose(),Q.onAnimationFileImportedObservable.notifyObservers(Q),g&&g(Q)}),q,G,K,e,N)}async function h(F,b,Q,C,z,t,g,W,Z,q){return await new Promise(((G,e)=>{try{V(F,b,Q,C,z,t,(F=>{G(F)}),g,((F,b,Q)=>{e(Q||new Error(b))}),W,Z,q).catch(e)}catch(K){e(K)}}))}class l{static get ForceFullSceneLoadingForIncremental(){return q.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(F){q.c.ForceFullSceneLoadingForIncremental=F}static get ShowLoadingScreen(){return q.c.ShowLoadingScreen}static set ShowLoadingScreen(F){q.c.ShowLoadingScreen=F}static get loggingLevel(){return q.c.loggingLevel}static set loggingLevel(F){q.c.loggingLevel=F}static get CleanBoneMatrixWeights(){return q.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(F){q.c.CleanBoneMatrixWeights=F}static GetDefaultPlugin(){return L()}static GetPluginForExtension(F){var b;return null===(b=i(F,!0))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(F){return function(F){return!!c[F]}(F)}static RegisterPlugin(F){R(F)}static ImportMesh(F,b,Q,C,z,t,g,Z,q){p(F,b,Q,C,z,t,g,Z,q).catch((F=>null===g||void 0===g?void 0:g(W.d.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async ImportMeshAsync(F,b,Q,C,z,t,g){return await D(F,b,Q,C,z,t,g)}static Load(F,b,Q,C,z,t,g,Z){P(F,b,Q,C,z,t,g,Z).catch((F=>null===t||void 0===t?void 0:t(W.d.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async LoadAsync(F,b,Q,C,z,t){return await n(F,b,Q,C,z,t)}static Append(F,b,Q,C,z,t,g,Z){j(F,b,Q,C,z,t,g,Z).catch((F=>null===t||void 0===t?void 0:t(Q??W.d.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async AppendAsync(F,b,Q,C,z,t){return await w(F,b,Q,C,z,t)}static LoadAssetContainer(F,b,Q,C,z,t,g,Z){Y(F,b,Q,C,z,t,g,Z).catch((F=>null===t||void 0===t?void 0:t(Q??W.d.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async LoadAssetContainerAsync(F,b,Q,C,z,t){return await s(F,b,Q,C,z,t)}static ImportAnimations(F,b,Q,C,z,t,g,Z,q,G,K){V(F,b,Q,C,z,t,g,Z,q,G,K).catch((F=>null===q||void 0===q?void 0:q(Q??W.d.LastCreatedScene,null===F||void 0===F?void 0:F.message,F)))}static async ImportAnimationsAsync(F,b,Q,C,z,t,g,W,Z,q,G){return await h(F,b,Q,C,z,t,W,q,G)}}l.NO_LOGGING=0,l.MINIMAL_LOGGING=1,l.SUMMARY_LOGGING=2,l.DETAILED_LOGGING=3,l.OnPluginActivatedObservable=E},12914:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>e});var C=Q(11293),z=Q(11296),t=Q(11128),g=Q(11309),W=Q(11332),Z=Q(11287),q=Q(11265),G=Q(11133),K=Q(11349);Q(12920);class e extends W.e{set boundingBoxSize(F){if(this._boundingBoxSize&&this._boundingBoxSize.equals(F))return;this._boundingBoxSize=F;const b=this.RF();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(F){this._rotationY=F,this.setReflectionTextureMatrix(g.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(F,b,Q){let C="";for(const z of F)C+=z;return new e(C,b,null,Q,F)}static CreateFromPrefilteredData(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const t=new e(F,b,null,!1,null,null,null,void 0,!0,Q,C);return b.useDelayedTextureLoading=z,t}constructor(F,b){var Q;let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,K=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,e=arguments.length>8&&void 0!==arguments[8]&&arguments[8],N=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],E=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,X=arguments.length>13?arguments[13]:void 0,L=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new G.c,this.boundingBoxPosition=g.gQ.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new g.Matrix,this._buffer=null,this.name=F,this.url=F,this._noMipmap=z,this.ib=!1,this.isCube=!0,this._textureMatrix=g.Matrix.Identity(),this.coordinatesMode=Z.b.CUBIC_MODE;let i=null,f=null;null===C||Array.isArray(C)?(this._noMipmap=z,this._format=K,this._createPolynomials=y,i=C,this._loaderOptions=X,this._useSRGBBuffer=L,this._lodScale=E,this._lodOffset=c):(i=C.extensions??null,this._noMipmap=C.noMipmap??!1,t=C.files??null,f=C.buffer??null,this._format=C.format??5,e=C.prefiltered??!1,N=C.forcedExtension??null,this._createPolynomials=C.createPolynomials??!1,this._lodScale=C.lodScale??.8,this._lodOffset=C.lodOffset??0,this._loaderOptions=C.loaderOptions,this._useSRGBBuffer=C.useSRGBBuffer,W=C.M??null,q=C.onError??null),(F||t)&&this.updateURL(F,N,W,e,q,i,null===(Q=this.RF())||void 0===Q?void 0:Q.useDelayedTextureLoading,t,f)}getClassName(){return"CubeTexture"}updateURL(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=F),this.url=F,b&&(this._forcedExtension=b);const q=F.lastIndexOf("."),G=b||(q>-1?F.substring(q).toLowerCase():""),K=0===G.indexOf(".dds"),e=0===G.indexOf(".env"),N=0===G.indexOf(".basis");if(e?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=C,C&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),W)this._files=W;else if(N||e||K||t||(t=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,t){for(let b=0;b<t.length;b++)this._files.push(F+t[b]);this._extensions=t}this._buffer=Z,g?(this.delayLoadState=4,this._delayedOnLoad=Q,this._delayedOnError=z):this._loadTexture(Q,z)}delayLoad(F){4===this.delayLoadState&&(F&&(this._forcedExtension=F),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(F){var b,Q;if(F.updateFlag===this._textureMatrix.updateFlag)return;F.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(Q=this.RF())||void 0===Q||Q.markAllMaterialsAsDirty(1,(F=>-1!==F.getActiveTextures().indexOf(this))));if(this._textureMatrix=F,null===(b=this.RF())||void 0===b||!b.useRightHandedSystem)return;const C=g.TmpVectors.gQ[0],z=g.TmpVectors.Quaternion[0],t=g.TmpVectors.gQ[1];this._textureMatrix.decompose(C,z,t),z.z*=-1,z.w*=-1,g.Matrix.ComposeToRef(C,z,t,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var F;return null!==(F=this.RF())&&void 0!==F&&F.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Q=this.RF(),C=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const z=()=>{var b;(this.onLoadObservable.notifyObservers(this),C)&&(C.dispose(),null===(b=this.RF())||void 0===b||b.markAllMaterialsAsDirty(1));F&&F()},g=(F,Q)=>{this._loadingError=!0,this._errorObject={message:F,exception:Q},b&&b(F,Q),Z.b.OnTextureLoadErrorObservable.notifyObservers(this)};var W;this._texture?this._texture.isReady?t.Tools.SetImmediate((()=>z())):this._texture.onLoadedObservable.add((()=>z())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,Q,this._lodScale,this._lodOffset,F,g,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,Q,this._files,this._noMipmap,F,g,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(W=this._texture)||void 0===W||W.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(F,b,Q){const C=K.e.Parse((()=>{let C=!1;return F.prefiltered&&(C=F.prefiltered),new e(Q+(F.url??F.name),b,F.extensions,!1,F.files||null,null,null,void 0,C,F.forcedExtension)}),F,b);if(F.boundingBoxPosition&&(C.boundingBoxPosition=g.gQ.KQ(F.boundingBoxPosition)),F.boundingBoxSize&&(C.boundingBoxSize=g.gQ.KQ(F.boundingBoxSize)),F.animations)for(let z=0;z<F.animations.length;z++){const b=F.animations[z],Q=(0,q.d)("BABYLON.Animation");Q&&C.animations.push(Q.Parse(b))}return C}clone(){let F=0;const b=K.e.Clone((()=>{const b=new e(this.url,this.RF()||this._getEngine(),this._extensions,this._noMipmap,this._files);return F=b.uniqueId,b}),this);return b.uniqueId=F,b}}(0,C.b)([(0,z.A)()],e.prototype,"url",void 0),(0,C.b)([(0,z.y)()],e.prototype,"boundingBoxPosition",void 0),(0,C.b)([(0,z.y)()],e.prototype,"boundingBoxSize",null),(0,C.b)([(0,z.A)("rotationY")],e.prototype,"rotationY",null),(0,C.b)([(0,z.A)("files")],e.prototype,"_files",void 0),(0,C.b)([(0,z.A)("forcedExtension")],e.prototype,"_forcedExtension",void 0),(0,C.b)([(0,z.A)("extensions")],e.prototype,"_extensions",void 0),(0,C.b)([(0,z.q)("textureMatrix")],e.prototype,"_textureMatrix",void 0),(0,C.b)([(0,z.q)("textureMatrixRefraction")],e.prototype,"_textureMatrixRefraction",void 0),Z.b._CubeTextureParser=e.Parse,(0,q.g)("BABYLON.CubeTexture",e)},13422:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>Z});var C=Q(11146),z=Q(11287),t=Q(11277),g=Q(11446),W=Q(11241);g.ThinEngine.prototype.createDynamicTexture=function(F,b,Q,C){const z=new W.b(this,4);return z.baseWidth=F,z.baseHeight=b,Q&&(F=this.needPOTTextures?(0,t.c)(F,this._caps.maxTextureSize):F,b=this.needPOTTextures?(0,t.c)(b,this._caps.maxTextureSize):b),z.width=F,z.height=b,z.isReady=!1,z.generateMipMaps=Q,z.samplingMode=C,this.updateTextureSamplingMode(C,z),this._internalTexturesCache.push(z),z},g.ThinEngine.prototype.updateDynamicTexture=function(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!F)return;const g=this._gl,W=g.TEXTURE_2D,Z=this._bindTextureDirectly(W,F,!0,t);this._unpackFlipY(void 0===Q?F.invertY:Q),C&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const q=this._getWebGLTextureType(F.type),G=this._getInternalFormat(z||F.format),K=this._getRGBABufferInternalSizedFormat(F.type,G);g.texImage2D(W,0,K,G,q,b),F.generateMipMaps&&g.generateMipmap(W),Z||this._bindTextureDirectly(W,null),C&&g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),z&&(F.format=z),F._dynamicTextureSource=b,F._premulAlpha=C,F.invertY=Q||!1,F.isReady=!0};class Z extends z.b{constructor(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,W=arguments.length>6?arguments[6]:void 0;const Z=!Q||Q._isScene;super(null,Z?Q:null===Q||void 0===Q?void 0:Q.ZQ,Z?!C:Q,W,t,void 0,void 0,void 0,void 0,g),this.name=F,this.wrapU=z.b.CLAMP_ADDRESSMODE,this.wrapV=z.b.CLAMP_ADDRESSMODE,this._generateMipMaps=C;const q=this._getEngine();if(!q)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=q.createDynamicTexture(this._canvas.width,this._canvas.height,C,t);else{this._canvas=q.createCanvas(1,1),this._ownCanvas=!0;const F=b;F.width||0===F.width?this._texture=q.createDynamicTexture(F.width,F.height,C,t):this._texture=q.createDynamicTexture(b,b,C,t)}const G=this.getSize();this._canvas.width!==G.width&&(this._canvas.width=G.width),this._canvas.height!==G.height&&(this._canvas.height=G.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(F){this._canvas.width=F.width,this._canvas.height=F.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(F.width,F.height,this._generateMipMaps,this.samplingMode)}scale(F){const b=this.getSize();b.width*=F,b.height*=F,this._recreate(b)}scaleTo(F,b){const Q=this.getSize();Q.width=F,Q.height=b,this._recreate(Q)}getContext(){return this._context}clear(F){const b=this.getSize();F&&(this._context.fillStyle=F),this._context.clearRect(0,0,b.width,b.height)}update(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===F||F,b,this._format||void 0,void 0,Q)}drawText(F,b,Q,C,z,t,g){let W=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const Z=this.getSize();if(t&&(this._context.fillStyle=t,this._context.fillRect(0,0,Z.width,Z.height)),this._context.font=C,null===b||void 0===b){const Q=this._context.measureText(F);b=(Z.width-Q.width)/2}if(null===Q||void 0===Q){const F=parseInt(C.replace(/\D/g,""));Q=Z.height/2+F/3.65}this._context.fillStyle=z||"",this._context.fillText(F,b,Q),W&&this.update(g)}dispose(){var F,b;(super.dispose(),this._ownCanvas)&&(null===(F=this._canvas)||void 0===F||null===(b=F.remove)||void 0===b||b.call(F));this._canvas=null,this._context=null}clone(){const F=this.RF();if(!F)return this;const b=this.getSize(),Q=new Z(this.name,b,F,this._generateMipMaps);return Q.ib=this.ib,Q.level=this.level,Q.wrapU=this.wrapU,Q.wrapV=this.wrapV,Q}serialize(){const F=this.RF();F&&!F.isReady()&&C.e.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return Z._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(F){return void 0!==F.toDataURL}_rebuild(){this.update()}}},12838:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>z});var C=Q(11287);class z extends C.b{get depth(){return this._depth}constructor(F,b,Q,z,t,g){let W=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],Z=arguments.length>7&&void 0!==arguments[7]&&arguments[7],q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:C.b.TRILINEAR_SAMPLINGMODE,G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,K=arguments.length>10?arguments[10]:void 0;super(null,g,!W,Z),this.format=t,this._texture=g.getEngine().createRawTexture2DArray(F,b,Q,z,t,W,Z,q,null,G,K),this._depth=z,this.is2DArray=!0}update(F){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,F,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(F,b,Q,C,t){return new z(F,b,Q,C,5,t,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12659:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>W,h:()=>Z,l:()=>t,m:()=>g});var C=Q(11329),z=Q(11309);function t(F,b){return`{X: ${F.x.toFixed(b)} Y: ${F.y.toFixed(b)}}`}function g(F,b){return`{X: ${F._x.toFixed(b)} Y: ${F._y.toFixed(b)} Z: ${F._z.toFixed(b)}}`}function W(F,b){return 2*Math.acos((0,C.Clamp)(z.Quaternion.Dot(F,b)))}function Z(F,b){const Q=new z.Quaternion;return function(F,b,Q){const t=z.gQ.Cross(F,b),g=Math.acos((0,C.Clamp)(z.gQ.Dot(F,b),-1,1));z.Quaternion.RotationAxisToRef(t,g,Q)}(F,b,Q),Q}},12480:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>q});var C=Q(11309),z=Q(11359),t=Q(11746),g=Q(11730),W=Q(11364);Q(12489);function Z(F){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const Q=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],t=[];let Z=[];const q=F.width||F.size||1,G=F.height||F.size||1,K=F.depth||F.size||1,e=F.wrap||!1;let N=void 0===F.topBaseAt?1:F.topBaseAt,y=void 0===F.bottomBaseAt?0:F.bottomBaseAt;N=(N+4)%4,y=(y+4)%4;let E=[2,0,3,1][N],c=[2,0,1,3][y],X=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(e){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],X=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let F=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],Q=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const C=[17,18,19,16],z=[22,23,20,21];for(;E>0;)F.unshift(F.pop()),C.unshift(C.pop()),E--;for(;c>0;)Q.unshift(Q.pop()),z.unshift(z.pop()),c--;F=F.flat(),Q=Q.flat(),X=X.concat(F).concat(Q),b.push(C[0],C[2],C[3],C[0],C[1],C[2]),b.push(z[0],z[2],z[3],z[0],z[1],z[2])}const L=[q/2,G/2,K/2];Z=X.reduce(((F,b,Q)=>F.concat(b*L[Q%3])),[]);const i=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE,f=F.faceUV||new Array(6),k=F.faceColors,m=[];for(let g=0;g<6;g++)void 0===f[g]&&(f[g]=new C.Vector4(0,0,1,1)),k&&void 0===k[g]&&(k[g]=new z.sb(1,1,1,1));for(let C=0;C<6;C++)if(t.push(f[C].z,W.b?1-f[C].w:f[C].w),t.push(f[C].x,W.b?1-f[C].w:f[C].w),t.push(f[C].x,W.b?1-f[C].y:f[C].y),t.push(f[C].z,W.b?1-f[C].y:f[C].y),k)for(let F=0;F<4;F++)m.push(k[C].r,k[C].g,k[C].b,k[C].a);g.d._ComputeSides(i,Z,b,Q,t,F.frontUVs,F.backUVs);const R=new g.d;if(R.indices=b,R.DF=Z,R.PF=Q,R.jF=t,k){const F=i===g.d.DOUBLESIDE?m.concat(m):m;R.nF=F}return R}function q(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new t.b(F,Q);b.sideOrientation=t.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return Z(b).YF(C,b.updatable),C}g.d.CreateBox=Z,t.b.CreateBox=function(F,b){return q(F,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12649:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>W});var C=Q(11746),z=Q(11730),t=Q(11364);function g(F){const b=[],Q=[],C=[],g=[],W=F.radius||.5,Z=F.tessellation||64,q=F.arc&&(F.arc<=0||F.arc>1)?1:F.arc||1,G=0===F.sideOrientation?0:F.sideOrientation||z.d.DEFAULTSIDE;b.push(0,0,0),g.push(.5,.5);const K=2*Math.PI*q,e=1===q?K/Z:K/(Z-1);let N=0;for(let z=0;z<Z;z++){const F=Math.cos(N),Q=Math.sin(N),C=(F+1)/2,z=(1-Q)/2;b.push(W*F,W*Q,0),g.push(C,t.b?1-z:z),N+=e}1===q&&(b.push(b[3],b[4],b[5]),g.push(g[2],t.b?1-g[3]:g[3]));const y=b.length/3;for(let z=1;z<y-1;z++)Q.push(z+1,0,z);z.d.ComputeNormals(b,Q,C),z.d._ComputeSides(G,b,Q,C,g,F.frontUVs,F.backUVs);const E=new z.d;return E.indices=Q,E.DF=b,E.PF=C,E.jF=g,E}function W(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new C.b(F,Q);b.sideOrientation=C.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return g(b).YF(z,b.updatable),z}z.d.CreateDisc=g,C.b.CreateDisc=function(F,b,Q){return W(F,{radius:b,tessellation:Q,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12489:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>c,c:()=>L,i:()=>X});var C=Q(11309),z=Q(11359),t=Q(11746),g=Q(11730),W=Q(11372);t.b._GroundMeshParser=(F,b)=>Z.Parse(F,b);class Z extends t.b{constructor(F,b){super(F,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=F,this._subdivisionsY=F,this.subdivide(F);const Q=this;Q.createOrUpdateSubmeshesOctree&&Q.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(F,b){const Q=this.getWorldMatrix(),z=C.TmpVectors.Matrix[5];Q.invertToRef(z);const t=C.TmpVectors.gQ[8];if(C.gQ.TransformCoordinatesFromFloatsToRef(F,0,b,z,t),F=t.x,b=t.z,F<this._minX||F>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const g=this._getFacetAt(F,b),W=-(g.x*F+g.z*b+g.w)/g.y;return C.gQ.TransformCoordinatesFromFloatsToRef(0,W,0,Q,t),t.y}getNormalAtCoordinates(F,b){const Q=new C.gQ(0,1,0);return this.getNormalAtCoordinatesToRef(F,b,Q),Q}getNormalAtCoordinatesToRef(F,b,Q){const z=this.getWorldMatrix(),t=C.TmpVectors.Matrix[5];z.invertToRef(t);const g=C.TmpVectors.gQ[8];if(C.gQ.TransformCoordinatesFromFloatsToRef(F,0,b,t,g),F=g.x,b=g.z,F<this._minX||F>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const W=this._getFacetAt(F,b);return C.gQ.TransformNormalFromFloatsToRef(W.x,W.y,W.z,z,Q),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(F,b){const Q=Math.floor((F+this._maxX)*this._subdivisionsX/this._width),C=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),z=this._heightQuads[C*this._subdivisionsX+Q];let t;return t=b<z.slope.x*F+z.slope.y?z.facet1:z.facet2,t}_initHeightQuads(){const F=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=[];for(let Q=0;Q<b;Q++)for(let b=0;b<F;b++){const z={slope:C.Vector2.Zero(),facet1:new C.Vector4(0,0,0,0),facet2:new C.Vector4(0,0,0,0)};this._heightQuads[Q*F+b]=z}return this}_computeHeightQuads(){const F=this.getVerticesData(W.e.PositionKind);if(!F)return this;const b=C.TmpVectors.gQ[3],Q=C.TmpVectors.gQ[2],z=C.TmpVectors.gQ[1],t=C.TmpVectors.gQ[0],g=C.TmpVectors.gQ[4],Z=C.TmpVectors.gQ[5],q=C.TmpVectors.gQ[6],G=C.TmpVectors.gQ[7],K=C.TmpVectors.gQ[8];let e=0,N=0,y=0,E=0,c=0,X=0,L=0;const i=this._subdivisionsX,f=this._subdivisionsY;for(let W=0;W<f;W++)for(let f=0;f<i;f++){e=3*f,N=W*(i+1)*3,y=(W+1)*(i+1)*3,b.x=F[N+e],b.y=F[N+e+1],b.z=F[N+e+2],Q.x=F[N+e+3],Q.y=F[N+e+4],Q.z=F[N+e+5],z.x=F[y+e],z.y=F[y+e+1],z.z=F[y+e+2],t.x=F[y+e+3],t.y=F[y+e+4],t.z=F[y+e+5],E=(t.z-b.z)/(t.x-b.x),c=b.z-E*b.x,Q.subtractToRef(b,g),z.subtractToRef(b,Z),t.subtractToRef(b,q),C.gQ.CrossToRef(q,Z,G),C.gQ.CrossToRef(g,q,K),G.normalize(),K.normalize(),X=-(G.x*b.x+G.y*b.y+G.z*b.z),L=-(K.x*Q.x+K.y*Q.y+K.z*Q.z);const k=this._heightQuads[W*i+f];k.slope.jb(E,c),k.facet1.jb(G.x,G.y,G.z,X),k.facet2.jb(K.x,K.y,K.z,L)}return this}serialize(F){super.serialize(F),F.subdivisionsX=this._subdivisionsX,F.subdivisionsY=this._subdivisionsY,F.minX=this._minX,F.maxX=this._maxX,F.kb=this._minZ,F.maxZ=this._maxZ,F.width=this._width,F.height=this._height}static Parse(F,b){const Q=new Z(F.name,b);return Q._subdivisionsX=F.subdivisionsX||1,Q._subdivisionsY=F.subdivisionsY||1,Q._minX=F.minX,Q._maxX=F.maxX,Q._minZ=F.kb,Q._maxZ=F.maxZ,Q._width=F.width,Q._height=F.height,Q}}var q=Q(11128),G=Q(11161),K=Q(11318),e=Q(11364);function N(F){const b=[],Q=[],z=[],t=[];let W,Z;const q=F.width||F.size||1,G=F.height||F.size||1,K=0|(F.subdivisionsX||F.subdivisions||1),N=0|(F.subdivisionsY||F.subdivisions||1);for(W=0;W<=N;W++)for(Z=0;Z<=K;Z++){const F=new C.gQ(Z*q/K-q/2,0,(N-W)*G/N-G/2),b=new C.gQ(0,1,0);Q.push(F.x,F.y,F.z),z.push(b.x,b.y,b.z),t.push(Z/K,e.b?W/N:1-W/N)}for(W=0;W<N;W++)for(Z=0;Z<K;Z++)b.push(Z+1+(W+1)*(K+1)),b.push(Z+1+W*(K+1)),b.push(Z+W*(K+1)),b.push(Z+(W+1)*(K+1)),b.push(Z+1+(W+1)*(K+1)),b.push(Z+W*(K+1));const y=new g.d;return y.indices=b,y.DF=Q,y.PF=z,y.jF=t,y}function y(F){const b=void 0!==F.xmin&&null!==F.xmin?F.xmin:-1,Q=void 0!==F.zmin&&null!==F.zmin?F.zmin:-1,z=void 0!==F.xmax&&null!==F.xmax?F.xmax:1,t=void 0!==F.zmax&&null!==F.zmax?F.zmax:1,W=F.subdivisions||{w:1,h:1},Z=F.precision||{w:1,h:1},q=[],G=[],K=[],e=[];let N,y,E,c;W.h=W.h<1?1:W.h,W.w=W.w<1?1:W.w,Z.w=Z.w<1?1:Z.w,Z.h=Z.h<1?1:Z.h;const X=(z-b)/W.w,L=(t-Q)/W.h;function i(F,b,Q,z){const t=G.length/3,g=Z.w+1;for(N=0;N<Z.h;N++)for(y=0;y<Z.w;y++){const F=[t+y+N*g,t+(y+1)+N*g,t+(y+1)+(N+1)*g,t+y+(N+1)*g];q.push(F[1]),q.push(F[2]),q.push(F[3]),q.push(F[0]),q.push(F[1]),q.push(F[3])}const W=C.gQ.Zero(),E=new C.gQ(0,1,0);for(N=0;N<=Z.h;N++)for(W.z=N*(z-b)/Z.h+b,y=0;y<=Z.w;y++)W.x=y*(Q-F)/Z.w+F,W.y=0,G.push(W.x,W.y,W.z),K.push(E.x,E.y,E.z),e.push(y/Z.w,N/Z.h)}for(E=0;E<W.h;E++)for(c=0;c<W.w;c++)i(b+c*X,Q+E*L,b+(c+1)*X,Q+(E+1)*L);const f=new g.d;return f.indices=q,f.DF=G,f.PF=K,f.jF=e,f}function E(F){const b=[],Q=[],t=[],W=[];let Z,q;const G=F.colorFilter||new z.GQ(.3,.59,.11),e=F.alphaFilter||0;let N=!1;if(F.minHeight>F.maxHeight){N=!0;const b=F.maxHeight;F.maxHeight=F.minHeight,F.minHeight=b}for(Z=0;Z<=F.subdivisions;Z++)for(q=0;q<=F.subdivisions;q++){const b=new C.gQ(q*F.width/F.subdivisions-F.width/2,0,(F.subdivisions-Z)*F.height/F.subdivisions-F.height/2),z=4*(((b.x+F.width/2)/F.width*(F.bufferWidth-1)|0)+((1-(b.z+F.height/2)/F.height)*(F.bufferHeight-1)|0)*F.bufferWidth);let g=F.buffer[z]/255,y=F.buffer[z+1]/255,E=F.buffer[z+2]/255;const c=F.buffer[z+3]/255;N&&(g=1-g,y=1-y,E=1-E);const X=g*G.r+y*G.g+E*G.b;b.y=c>=e?F.minHeight+(F.maxHeight-F.minHeight)*X:F.minHeight-K.c,F.heightBuffer&&(F.heightBuffer[Z*(F.subdivisions+1)+q]=b.y),Q.push(b.x,b.y,b.z),t.push(0,0,0),W.push(q/F.subdivisions,1-Z/F.subdivisions)}for(Z=0;Z<F.subdivisions;Z++)for(q=0;q<F.subdivisions;q++){const C=q+1+(Z+1)*(F.subdivisions+1),z=q+1+Z*(F.subdivisions+1),t=q+Z*(F.subdivisions+1),g=q+(Z+1)*(F.subdivisions+1),W=Q[3*C+1]>=F.minHeight,G=Q[3*z+1]>=F.minHeight,K=Q[3*t+1]>=F.minHeight;W&&G&&K&&(b.push(C),b.push(z),b.push(t));Q[3*g+1]>=F.minHeight&&W&&K&&(b.push(g),b.push(C),b.push(t))}g.d.ComputeNormals(Q,b,t);const y=new g.d;return y.indices=b,y.DF=Q,y.PF=t,y.jF=W,y}function c(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const Q=new Z(F,arguments.length>2?arguments[2]:void 0);Q._setReady(!1),Q._subdivisionsX=b.subdivisionsX||b.subdivisions||1,Q._subdivisionsY=b.subdivisionsY||b.subdivisions||1,Q._width=b.width||1,Q._height=b.height||1,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ;return N(b).YF(Q,b.updatable),Q._setReady(!0),Q}function X(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new t.b(F,Q);return y(b).YF(C,b.updatable),C}function L(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=Q.width||10,g=Q.height||10,W=Q.subdivisions||1,K=Q.minHeight||0,e=Q.maxHeight||1,N=Q.colorFilter||new z.GQ(.3,.59,.11),y=Q.alphaFilter||0,c=Q.updatable,X=Q.onReady;C=C||G.d.LastCreatedScene;const L=new Z(F,C);let i;L._subdivisionsX=W,L._subdivisionsY=W,L._width=t,L._height=g,L._maxX=L._width/2,L._maxZ=L._height/2,L._minX=-L._maxX,L._minZ=-L._maxZ,L._setReady(!1),Q.passHeightBufferInCallback&&(i=new Float32Array((W+1)*(W+1)));const f=(F,b,Q)=>{E({width:t,height:g,subdivisions:W,minHeight:K,maxHeight:e,colorFilter:N,buffer:F,bufferWidth:b,bufferHeight:Q,alphaFilter:y,heightBuffer:i}).YF(L,c),X&&X(L,i),L._setReady(!0)};if("string"===typeof b){const F=F=>{var b;const Q=F.width,z=F.height;if(C.G)return;const t=null===(b=C)||void 0===b?void 0:b.getEngine().resizeImageBitmap(F,Q,z);f(t,Q,z)};q.Tools.LoadImage(b,F,Q.onError?Q.onError:()=>{},C.offlineProvider)}else f(b.data,b.width,b.height);return L}g.d.CreateGround=N,g.d.CreateTiledGround=y,g.d.CreateGroundFromHeightMap=E,t.b.CreateGround=(F,b,Q,C,z,t)=>c(F,{width:b,height:Q,subdivisions:C,updatable:t},z),t.b.CreateTiledGround=(F,b,Q,C,z,t,g,W,Z)=>X(F,{xmin:b,zmin:Q,xmax:C,zmax:z,subdivisions:t,precision:g,updatable:Z},W),t.b.CreateGroundFromHeightMap=(F,b,Q,C,z,t,g,W,Z,q,G)=>L(F,b,{width:Q,height:C,subdivisions:z,minHeight:t,maxHeight:g,updatable:Z,onReady:q,alphaFilter:G},W)},13124:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>N,f:()=>K,i:()=>e});var C=Q(11309),z=Q(11746),t=Q(11730),g=Q(11835),W=Q(11372),Z=Q(11146);function q(F){const b=[],Q=[],C=F.lines,z=F.nF,g=[];let W=0;for(let t=0;t<C.length;t++){const F=C[t];for(let C=0;C<F.length;C++){const{x:Z,y:q,z:G}=F[C];if(Q.push(Z,q,G),z){const F=z[t],{r:b,g:Q,b:W,a:Z}=F[C];g.push(b,Q,W,Z)}C>0&&(b.push(W-1),b.push(W)),W++}}const Z=new t.d;return Z.indices=b,Z.DF=Q,z&&(Z.nF=g),Z}function G(F){const b=F.dashSize||3,Q=F.gapSize||1,z=F.dashNb||200,g=F.points,W=[],Z=[],q=C.gQ.Zero();let G=0,K=0,e=0,N=0,y=0,E=0,c=0;for(c=0;c<g.length-1;c++)g[c+1].subtractToRef(g[c],q),G+=q.length();for(e=G/z,N=b*e/(b+Q),c=0;c<g.length-1;c++){g[c+1].subtractToRef(g[c],q),K=Math.floor(q.length()/e),q.normalize();for(let F=0;F<K;F++)y=e*F,W.push(g[c].x+y*q.x,g[c].y+y*q.y,g[c].z+y*q.z),W.push(g[c].x+(y+N)*q.x,g[c].y+(y+N)*q.y,g[c].z+(y+N)*q.z),Z.push(E,E+1),E+=2}const X=new t.d;return X.DF=W,X.indices=Z,X}function K(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=b.instance,z=b.lines,t=b.nF;if(C){const F=C.getVerticesData(W.e.PositionKind);let b,Q;t&&(b=C.getVerticesData(W.e.ColorKind));let g=0,Z=0;for(let C=0;C<z.length;C++){const W=z[C];for(let z=0;z<W.length;z++)F[g]=W[z].x,F[g+1]=W[z].y,F[g+2]=W[z].z,t&&b&&(Q=t[C],b[Z]=Q[z].r,b[Z+1]=Q[z].g,b[Z+2]=Q[z].b,b[Z+3]=Q[z].a,Z+=4),g+=3}return C.updateVerticesData(W.e.PositionKind,F,!1,!1),t&&b&&C.updateVerticesData(W.e.ColorKind,b,!1,!1),C.refreshBoundingInfo(),C}const Z=!!t,G=new g.d(F,Q,null,void 0,void 0,Z,b.useVertexAlpha,b.material);return q(b).YF(G,b.updatable),G}function e(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=b.nF?[b.nF]:null;return K(F,{lines:[b.points],updatable:b.updatable,instance:b.instance,nF:C,useVertexAlpha:b.useVertexAlpha,material:b.material},Q)}function N(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=b.points,W=b.instance,q=b.gapSize||1,K=b.dashSize||3;if(W){const F=F=>{const b=C.gQ.Zero(),Q=F.length/6;let z=0,g=0,Z=0,q=0,G=0,K=0,e=0,N=0;for(e=0;e<t.length-1;e++)t[e+1].subtractToRef(t[e],b),z+=b.length();Z=z/Q;const y=W._creationDataStorage.dashSize;for(q=y*Z/(y+W._creationDataStorage.gapSize),e=0;e<t.length-1;e++)for(t[e+1].subtractToRef(t[e],b),g=Math.floor(b.length()/Z),b.normalize(),N=0;N<g&&K<F.length;)G=Z*N,F[K]=t[e].x+G*b.x,F[K+1]=t[e].y+G*b.y,F[K+2]=t[e].z+G*b.z,F[K+3]=t[e].x+(G+q)*b.x,F[K+4]=t[e].y+(G+q)*b.y,F[K+5]=t[e].z+(G+q)*b.z,K+=6,N++;for(;K<F.length;)F[K]=t[e].x,F[K+1]=t[e].y,F[K+2]=t[e].z,K+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&Z.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),W.updateMeshPositions(F,!1),W}const e=new g.d(F,Q,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return G(b).YF(e,b.updatable),e._creationDataStorage=new z.e,e._creationDataStorage.dashSize=K,e._creationDataStorage.gapSize=q,e}t.d.CreateLineSystem=q,t.d.CreateDashedLines=G,z.b.uq=function(F,b){return e(F,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},z.b.CreateDashedLines=function(F,b,Q,C,z){return N(F,{points:b,dashSize:Q,gapSize:C,dashNb:z,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12533:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>W,h:()=>Z});var C=Q(11746),z=Q(11730),t=Q(11364);function g(F){const b=[],Q=[],C=[],g=[],W=void 0!==F.width?F.width:void 0!==F.size?F.size:1,Z=void 0!==F.height?F.height:void 0!==F.size?F.size:1,q=0===F.sideOrientation?0:F.sideOrientation||z.d.DEFAULTSIDE,G=W/2,K=Z/2;Q.push(-G,-K,0),C.push(0,0,-1),g.push(0,t.b?1:0),Q.push(G,-K,0),C.push(0,0,-1),g.push(1,t.b?1:0),Q.push(G,K,0),C.push(0,0,-1),g.push(1,t.b?0:1),Q.push(-G,K,0),C.push(0,0,-1),g.push(0,t.b?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),z.d._ComputeSides(q,Q,b,C,g,F.frontUVs,F.backUVs);const e=new z.d;return e.indices=b,e.DF=Q,e.PF=C,e.jF=g,e}function W(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new C.b(F,Q);b.sideOrientation=C.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return g(b).YF(z,b.updatable),b.sourcePlane&&(z.translate(b.sourcePlane.normal,-b.sourcePlane.d),z.setDirection(b.sourcePlane.normal.scale(-1))),z}const Z={Iq:W};z.d.Iq=g,C.b.Iq=(F,b,Q,C,z)=>W(F,{size:b,width:b,height:b,sideOrientation:z,updatable:C},Q)},12636:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>Z});var C=Q(11309),z=Q(11746),t=Q(11730),g=Q(11364);function W(F){const b=0|(F.segments||32),Q=F.diameterX||F.diameter||1,z=F.diameterY||F.diameter||1,W=F.diameterZ||F.diameter||1,Z=F.arc&&(F.arc<=0||F.arc>1)?1:F.arc||1,q=F.slice&&F.slice<=0?1:F.slice||1,G=0===F.sideOrientation?0:F.sideOrientation||t.d.DEFAULTSIDE,K=!!F.dedupTopBottomIndices,e=new C.gQ(Q/2,z/2,W/2),N=2+b,y=2*N,E=[],c=[],X=[],L=[];for(let t=0;t<=N;t++){const F=t/N,b=F*Math.PI*q;for(let Q=0;Q<=y;Q++){const z=Q/y,t=z*Math.PI*2*Z,W=C.Matrix.RotationZ(-b),q=C.Matrix.RotationY(t),G=C.gQ.TransformCoordinates(C.gQ.Up(),W),K=C.gQ.TransformCoordinates(G,q),N=K.multiply(e),E=K.divide(e).normalize();c.push(N.x,N.y,N.z),X.push(E.x,E.y,E.z),L.push(z,g.b?1-F:F)}if(t>0){const F=c.length/3;for(let b=F-2*(y+1);b+y+2<F;b++)K?(t>1&&(E.push(b),E.push(b+1),E.push(b+y+1)),(t<N||q<1)&&(E.push(b+y+1),E.push(b+1),E.push(b+y+2))):(E.push(b),E.push(b+1),E.push(b+y+1),E.push(b+y+1),E.push(b+1),E.push(b+y+2))}}t.d._ComputeSides(G,c,E,X,L,F.frontUVs,F.backUVs);const i=new t.d;return i.indices=E,i.DF=c,i.PF=X,i.jF=L,i}function Z(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return W(b).YF(C,b.updatable),C}t.d.CreateSphere=W,z.b.CreateSphere=(F,b,Q,C,z,t)=>Z(F,{segments:b,diameterX:Q,diameterY:Q,diameterZ:Q,sideOrientation:t,updatable:z},C)},13432:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>W});var C=Q(11856),z=Q(12926),t=Q(11870),g=Q(11730);class W{static get Configuration(){return{get decoder(){return z.c.DefaultConfiguration},set decoder(F){z.c.DefaultConfiguration=F}}}static set Configuration(F){z.c.DefaultConfiguration=F.decoder}static get DecoderAvailable(){return(0,C.i)(z.c.DefaultConfiguration)}static get Default(){return W._Default??(W._Default=new W),W._Default}static ResetDefault(F){W._Default&&(F||W._Default.dispose(),W._Default=null)}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W.DefaultNumWorkers;const b="number"===typeof F?{...z.c.DefaultConfiguration,numWorkers:F}:{...z.c.DefaultConfiguration,...F};this._decoder=new z.c(b)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(F,b,Q){return this._decoder.decodeMeshToMeshDataAsync(F,b,Q)}async decodeMeshToGeometryAsync(F,b,Q,C){return await this._decoder.decodeMeshToGeometryAsync(F,b,Q,C)}async _decodeMeshToGeometryForGltfAsync(F,b,Q,C,z,t){return await this._decoder._decodeMeshToGeometryForGltfAsync(F,b,Q,C,z,t)}async decodeMeshAsync(F,b){const Q=await this._decoder.decodeMeshToMeshDataAsync(F,b),C=new g.d;Q.indices&&(C.indices=Q.indices);for(const z of Q.attributes){const F=t.e.GetFloatData(z.data,z.size,t.e.GetDataType(z.data),z.byteOffset,z.byteStride,z.normalized,Q.totalVertices);C.set(F,z.kind)}return C}}W.DefaultNumWorkers=(0,C.e)(),W._Default=null},12926:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>q});var C=Q(11856),z=Q(11128),t=Q(11752),g=Q(11870),W=Q(11146),Z=Q(11861);class q extends C.b{static get DefaultAvailable(){return(0,C.i)(q.DefaultConfiguration)}static get Default(){return q._Default??(q._Default=new q),q._Default}static ResetDefault(F){q._Default&&(F||q._Default.dispose(),q._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(F,b){return{module:await(b||DracoDecoderModule)({wasmBinary:F})}}_getWorkerContent(){return`${Z.c}(${Z.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.DefaultConfiguration)}decodeMeshToMeshDataAsync(F,b,Q){const C=F instanceof ArrayBuffer?new Int8Array(F):new Int8Array(F.buffer,F.byteOffset,F.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async F=>await new Promise(((z,t)=>{F.push(((F,g)=>{let Z=null;const q=[],G=b=>{F.removeEventListener("error",G),F.removeEventListener("message",K),t(b),g()},K=b=>{const C=b.data;switch(C.id){case"indices":Z=C.data;break;case"attribute":q.push({kind:C.kind,data:C.data,size:C.size,byteOffset:C.byteOffset,byteStride:C.byteStride,normalized:(t=C.kind,e=C.normalized,Q&&void 0!==Q[t]?(e!==Q[t]&&W.e.Warn(`Normalized flag from Draco data (${e}) does not match normalized flag from glTF accessor (${Q[t]}). Using flag from glTF accessor.`),Q[t]):e)});break;case"decodeMeshDone":F.removeEventListener("error",G),F.removeEventListener("message",K),z({indices:Z,attributes:q,totalVertices:C.totalVertices}),g()}var t,e};F.addEventListener("error",G),F.addEventListener("message",K);const e=C.slice();F.postMessage({id:"decodeMesh",dataView:e,attributes:b},[e.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((F=>{let Q=null;const z=[],t=(0,Z.c)(F.module,C,b,(F=>{Q=F}),((F,b,Q,C,t,g)=>{z.push({kind:F,data:b,size:Q,byteOffset:C,byteStride:t,normalized:g})}));return{indices:Q,attributes:z,totalVertices:t}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(F,b,Q,C){const z=await this.decodeMeshToMeshDataAsync(Q,C),W=new t.d(F,b);z.indices&&W.setIndices(z.indices);for(const t of z.attributes)W.setVerticesBuffer(new g.e(b.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),z.totalVertices);return W}async _decodeMeshToGeometryForGltfAsync(F,b,Q,C,z,W){const Z=await this.decodeMeshToMeshDataAsync(Q,C,z),q=new t.d(F,b);W&&(q._boundingInfo=W,q.useBoundingInfoFromGeometry=!0),Z.indices&&q.setIndices(Z.indices);for(const t of Z.attributes)q.setVerticesBuffer(new g.e(b.getEngine(),t.data,t.kind,!1,void 0,t.byteStride,void 0,t.byteOffset,t.size,void 0,t.normalized,!0),Z.totalVertices);return q}}q.DefaultConfiguration={wasmUrl:`${z.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${z.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${z.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},q._Default=null},13120:(F,b,Q)=>{"use strict";Q.d(b,{c:()=>WF});var C=Q(11309),z=Q(11746),t=Q(11372),g=Q(11730),W=Q(11364);function Z(F){let b=F.pathArray;const Q=F.closeArray||!1,C=F.closePath||!1,z=F.invertUV||!1,Z=Math.floor(b[0].length/2);let q=F.offset||Z;q=q>Z?Z:Math.floor(q);const G=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE,K=F.jF,e=F.nF,N=[],y=[],E=[],c=[],X=[],L=[],i=[],f=[];let k;const m=[],R=[];let p,D,P;if(b.length<2){const F=[],Q=[];for(D=0;D<b[0].length-q;D++)F.push(b[0][D]),Q.push(b[0][D+q]);b=[F,Q]}let n=0;const j=C?1:0,w=Q?1:0;let Y,s,V,h,l,T;for(k=b[0].length,p=0;p<b.length+w;p++){for(i[p]=0,X[p]=[0],Y=p===b.length?b[0]:b[p],s=Y.length,k=k<s?k:s,P=0;P<s;)N.push(Y[P].x,Y[P].y,Y[P].z),P>0&&(V=Y[P].WQ(Y[P-1]).length(),h=V+i[p],X[p].push(h),i[p]=h),P++;C&&(P--,N.push(Y[0].x,Y[0].y,Y[0].z),V=Y[P].WQ(Y[0]).length(),h=V+i[p],X[p].push(h),i[p]=h),m[p]=s+j,R[p]=n,n+=s+j}let o,S,O=null,x=null;for(D=0;D<k+j;D++)for(f[D]=0,L[D]=[0],p=0;p<b.length-1+w;p++)l=b[p],T=p===b.length-1?b[0]:b[p+1],D===k?(O=l[0],x=T[0]):(O=l[D],x=T[D]),V=x.WQ(O).length(),h=V+f[D],L[D].push(h),f[D]=h;if(K)for(p=0;p<K.length;p++)c.push(K[p].x,W.b?1-K[p].y:K[p].y);else for(p=0;p<b.length+w;p++)for(D=0;D<k+j;D++)o=0!=i[p]?X[p][D]/i[p]:0,S=0!=f[D]?L[D][p]/f[D]:0,z?c.push(S,o):c.push(o,W.b?1-S:S);p=0;let a=0,A=m[p]-1,U=m[p+1]-1,u=A<U?A:U,v=R[1]-R[0];const J=m.length-1;for(;a<=u&&p<J;)y.push(a,a+v,a+1),y.push(a+v+1,a+1,a+v),a+=1,a===u&&(p++,v=R[p+1]-R[p],A=m[p]-1,U=m[p+1]-1,a=R[p],u=A<U?A+a:U+a);if(g.d.ComputeNormals(N,y,E),C){let F=0,Q=0;for(p=0;p<b.length;p++){F=3*R[p],Q=p+1<b.length?3*(R[p+1]-1):E.length-3,E[F]=.5*(E[F]+E[Q]),E[F+1]=.5*(E[F+1]+E[Q+1]),E[F+2]=.5*(E[F+2]+E[Q+2]);const C=Math.sqrt(E[F]*E[F]+E[F+1]*E[F+1]+E[F+2]*E[F+2]);E[F]/=C,E[F+1]/=C,E[F+2]/=C,E[Q]=E[F],E[Q+1]=E[F+1],E[Q+2]=E[F+2]}}if(Q){let F=3*R[0],Q=3*R[b.length];for(D=0;D<k+j;D++){E[F]=.5*(E[F]+E[Q]),E[F+1]=.5*(E[F+1]+E[Q+1]),E[F+2]=.5*(E[F+2]+E[Q+2]);const b=Math.sqrt(E[F]*E[F]+E[F+1]*E[F+1]+E[F+2]*E[F+2]);E[F]/=b,E[F+1]/=b,E[F+2]/=b,E[Q]=E[F],E[Q+1]=E[F+1],E[Q+2]=E[F+2],F+=3,Q+=3}}g.d._ComputeSides(G,N,y,E,c,F.frontUVs,F.backUVs);let I=null;if(e){I=new Float32Array(4*e.length);for(let F=0;F<e.length;F++)I[4*F]=e[F].r,I[4*F+1]=e[F].g,I[4*F+2]=e[F].b,I[4*F+3]=e[F].a}const M=new g.d,r=new Float32Array(N),H=new Float32Array(E),B=new Float32Array(c);return M.indices=y,M.DF=r,M.PF=H,M.jF=B,I&&M.set(I,t.e.ColorKind),C&&(M._idx=R),M}function q(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=b.pathArray,G=b.closeArray,K=b.closePath,e=z.b._GetDefaultSideOrientation(b.sideOrientation),N=b.instance,y=b.updatable;if(N){const F=C.TmpVectors.gQ[0].Yb(Number.MAX_VALUE),Q=C.TmpVectors.gQ[1].Yb(-Number.MAX_VALUE),Z=b=>{let C=q[0].length;const t=N;let g=0;const W=t._originalBuilderSideOrientation===z.b.DOUBLESIDE?2:1;for(let z=1;z<=W;++z)for(let W=0;W<q.length;++W){const z=q[W],Z=z.length;C=C<Z?C:Z;for(let t=0;t<C;++t){const C=z[t];b[g]=C.x,b[g+1]=C.y,b[g+2]=C.z,F.minimizeInPlaceFromFloats(C.x,C.y,C.z),Q.maximizeInPlaceFromFloats(C.x,C.y,C.z),g+=3}if(t._creationDataStorage&&t._creationDataStorage.closePath){const F=z[0];b[g]=F.x,b[g+1]=F.y,b[g+2]=F.z,g+=3}}},G=N.getVerticesData(t.e.PositionKind);if(Z(G),N.hasBoundingInfo?N.getBoundingInfo().reConstruct(F,Q,N._worldMatrix):N.buildBoundingInfo(F,Q,N._worldMatrix),N.updateVerticesData(t.e.PositionKind,G,!1,!1),b.nF){const F=N.getVerticesData(t.e.ColorKind);for(let Q=0,C=0;Q<b.nF.length;Q++,C+=4){const z=b.nF[Q];F[C]=z.r,F[C+1]=z.g,F[C+2]=z.b,F[C+3]=z.a}N.updateVerticesData(t.e.ColorKind,F,!1,!1)}if(b.jF){const F=N.getVerticesData(t.e.UVKind);for(let Q=0;Q<b.jF.length;Q++)F[2*Q]=b.jF[Q].x,F[2*Q+1]=W.b?1-b.jF[Q].y:b.jF[Q].y;N.updateVerticesData(t.e.UVKind,F,!1,!1)}if(!N.areNormalsFrozen||N.isFacetDataEnabled){const F=N.Pb(),b=N.getVerticesData(t.e.NormalKind),Q=N.isFacetDataEnabled?N.getFacetDataParameters():null;if(g.d.ComputeNormals(G,F,b,Q),N._creationDataStorage&&N._creationDataStorage.closePath){let F=0,Q=0;for(let C=0;C<q.length;C++)F=3*N._creationDataStorage.idx[C],Q=C+1<q.length?3*(N._creationDataStorage.idx[C+1]-1):b.length-3,b[F]=.5*(b[F]+b[Q]),b[F+1]=.5*(b[F+1]+b[Q+1]),b[F+2]=.5*(b[F+2]+b[Q+2]),b[Q]=b[F],b[Q+1]=b[F+1],b[Q+2]=b[F+2]}N.areNormalsFrozen||N.updateVerticesData(t.e.NormalKind,b,!1,!1)}return N}{const C=new z.b(F,Q);C._originalBuilderSideOrientation=e,C._creationDataStorage=new z.e;const t=Z(b);return K&&(C._creationDataStorage.idx=t._idx),C._creationDataStorage.closePath=K,C._creationDataStorage.closeArray=G,t.YF(C,y),C}}g.d.CreateRibbon=Z,z.b.CreateRibbon=function(F,b){return q(F,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var G=Q(12649),K=Q(12480),e=Q(11359);function N(F){const b=F.pattern||z.b.NO_FLIP,Q=F.tileWidth||F.tileSize||1,C=F.tileHeight||F.tileSize||1,t=F.alignHorizontal||0,W=F.alignVertical||0,Z=F.width||F.size||1,q=Math.floor(Z/Q);let G=Z-q*Q;const K=F.height||F.size||1,e=Math.floor(K/C);let N=K-e*C;const y=Q*q/2,E=C*e/2;let c=0,X=0,L=0,i=0,f=0,k=0;if(G>0||N>0){switch(L=-y,i=-E,f=y,k=E,t){case z.b.CENTER:G/=2,L-=G,f+=G;break;case z.b.LEFT:f+=G,c=-G/2;break;case z.b.RIGHT:L-=G,c=G/2}switch(W){case z.b.CENTER:N/=2,i-=N,k+=N;break;case z.b.BOTTOM:k+=N,X=-N/2;break;case z.b.TOP:i-=N,X=N/2}}const m=[],R=[],p=[];p[0]=[0,0,1,0,1,1,0,1],p[1]=[0,0,1,0,1,1,0,1],b!==z.b.ROTATE_TILE&&b!==z.b.ROTATE_ROW||(p[1]=[1,1,0,1,0,0,1,0]),b!==z.b.FLIP_TILE&&b!==z.b.FLIP_ROW||(p[1]=[1,0,0,0,0,1,1,1]),b!==z.b.FLIP_N_ROTATE_TILE&&b!==z.b.FLIP_N_ROTATE_ROW||(p[1]=[0,1,1,1,1,0,0,0]);let D=[];const P=[],n=[];let j=0;for(let g=0;g<e;g++)for(let F=0;F<q;F++)m.push(F*Q-y+c,g*C-E+X,0),m.push((F+1)*Q-y+c,g*C-E+X,0),m.push((F+1)*Q-y+c,(g+1)*C-E+X,0),m.push(F*Q-y+c,(g+1)*C-E+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),D=b===z.b.FLIP_TILE||b===z.b.ROTATE_TILE||b===z.b.FLIP_N_ROTATE_TILE?D.concat(p[(F%2+g%2)%2]):b===z.b.FLIP_ROW||b===z.b.ROTATE_ROW||b===z.b.FLIP_N_ROTATE_ROW?D.concat(p[g%2]):D.concat(p[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),j+=4;if(G>0||N>0){const F=N>0&&(W===z.b.CENTER||W===z.b.TOP),g=N>0&&(W===z.b.CENTER||W===z.b.BOTTOM),Z=G>0&&(t===z.b.CENTER||t===z.b.RIGHT),K=G>0&&(t===z.b.CENTER||t===z.b.LEFT);let p,w,Y,s,V=[];if(F&&Z&&(m.push(L+c,i+X,0),m.push(-y+c,i+X,0),m.push(-y+c,i+N+X,0),m.push(L+c,i+N+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=1-G/Q,w=1-N/C,Y=1,s=1,V=[p,w,Y,w,Y,s,p,s],b===z.b.ROTATE_ROW&&(V=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),b===z.b.FLIP_ROW&&(V=[1-p,w,1-Y,w,1-Y,s,1-p,s]),b===z.b.FLIP_N_ROTATE_ROW&&(V=[p,1-w,Y,1-w,Y,1-s,p,1-s]),D=D.concat(V),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F&&K&&(m.push(y+c,i+X,0),m.push(f+c,i+X,0),m.push(f+c,i+N+X,0),m.push(y+c,i+N+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=0,w=1-N/C,Y=G/Q,s=1,V=[p,w,Y,w,Y,s,p,s],(b===z.b.ROTATE_ROW||b===z.b.ROTATE_TILE&&q%2===0)&&(V=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),(b===z.b.FLIP_ROW||b===z.b.FLIP_TILE&&q%2===0)&&(V=[1-p,w,1-Y,w,1-Y,s,1-p,s]),(b===z.b.FLIP_N_ROTATE_ROW||b===z.b.FLIP_N_ROTATE_TILE&&q%2===0)&&(V=[p,1-w,Y,1-w,Y,1-s,p,1-s]),D=D.concat(V),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&Z&&(m.push(L+c,E+X,0),m.push(-y+c,E+X,0),m.push(-y+c,k+X,0),m.push(L+c,k+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=1-G/Q,w=0,Y=1,s=N/C,V=[p,w,Y,w,Y,s,p,s],(b===z.b.ROTATE_ROW&&e%2===1||b===z.b.ROTATE_TILE&&e%1===0)&&(V=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),(b===z.b.FLIP_ROW&&e%2===1||b===z.b.FLIP_TILE&&e%2===0)&&(V=[1-p,w,1-Y,w,1-Y,s,1-p,s]),(b===z.b.FLIP_N_ROTATE_ROW&&e%2===1||b===z.b.FLIP_N_ROTATE_TILE&&e%2===0)&&(V=[p,1-w,Y,1-w,Y,1-s,p,1-s]),D=D.concat(V),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),g&&K&&(m.push(y+c,E+X,0),m.push(f+c,E+X,0),m.push(f+c,k+X,0),m.push(y+c,k+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,p=0,w=0,Y=G/Q,s=N/C,V=[p,w,Y,w,Y,s,p,s],(b===z.b.ROTATE_ROW&&e%2===1||b===z.b.ROTATE_TILE&&(e+q)%2===1)&&(V=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),(b===z.b.FLIP_ROW&&e%2===1||b===z.b.FLIP_TILE&&(e+q)%2===1)&&(V=[1-p,w,1-Y,w,1-Y,s,1-p,s]),(b===z.b.FLIP_N_ROTATE_ROW&&e%2===1||b===z.b.FLIP_N_ROTATE_TILE&&(e+q)%2===1)&&(V=[p,1-w,Y,1-w,Y,1-s,p,1-s]),D=D.concat(V),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),F){const F=[];p=0,w=1-N/C,Y=1,s=1,F[0]=[p,w,Y,w,Y,s,p,s],F[1]=[p,w,Y,w,Y,s,p,s],b!==z.b.ROTATE_TILE&&b!==z.b.ROTATE_ROW||(F[1]=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),b!==z.b.FLIP_TILE&&b!==z.b.FLIP_ROW||(F[1]=[1-p,w,1-Y,w,1-Y,s,1-p,s]),b!==z.b.FLIP_N_ROTATE_TILE&&b!==z.b.FLIP_N_ROTATE_ROW||(F[1]=[p,1-w,Y,1-w,Y,1-s,p,1-s]);for(let C=0;C<q;C++)m.push(C*Q-y+c,i+X,0),m.push((C+1)*Q-y+c,i+X,0),m.push((C+1)*Q-y+c,i+N+X,0),m.push(C*Q-y+c,i+N+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,D=b===z.b.FLIP_TILE||b===z.b.ROTATE_TILE||b===z.b.FLIP_N_ROTATE_TILE?D.concat(F[(C+1)%2]):b===z.b.FLIP_ROW||b===z.b.ROTATE_ROW||b===z.b.FLIP_N_ROTATE_ROW?D.concat(F[1]):D.concat(F[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(g){const F=[];p=0,w=0,Y=1,s=N/C,F[0]=[p,w,Y,w,Y,s,p,s],F[1]=[p,w,Y,w,Y,s,p,s],b!==z.b.ROTATE_TILE&&b!==z.b.ROTATE_ROW||(F[1]=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),b!==z.b.FLIP_TILE&&b!==z.b.FLIP_ROW||(F[1]=[1-p,w,1-Y,w,1-Y,s,1-p,s]),b!==z.b.FLIP_N_ROTATE_TILE&&b!==z.b.FLIP_N_ROTATE_ROW||(F[1]=[p,1-w,Y,1-w,Y,1-s,p,1-s]);for(let C=0;C<q;C++)m.push(C*Q-y+c,k-N+X,0),m.push((C+1)*Q-y+c,k-N+X,0),m.push((C+1)*Q-y+c,k+X,0),m.push(C*Q-y+c,k+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,D=b===z.b.FLIP_TILE||b===z.b.ROTATE_TILE||b===z.b.FLIP_N_ROTATE_TILE?D.concat(F[(C+e)%2]):b===z.b.FLIP_ROW||b===z.b.ROTATE_ROW||b===z.b.FLIP_N_ROTATE_ROW?D.concat(F[e%2]):D.concat(F[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Z){const F=[];p=1-G/Q,w=0,Y=1,s=1,F[0]=[p,w,Y,w,Y,s,p,s],F[1]=[p,w,Y,w,Y,s,p,s],b!==z.b.ROTATE_TILE&&b!==z.b.ROTATE_ROW||(F[1]=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),b!==z.b.FLIP_TILE&&b!==z.b.FLIP_ROW||(F[1]=[1-p,w,1-Y,w,1-Y,s,1-p,s]),b!==z.b.FLIP_N_ROTATE_TILE&&b!==z.b.FLIP_N_ROTATE_ROW||(F[1]=[p,1-w,Y,1-w,Y,1-s,p,1-s]);for(let Q=0;Q<e;Q++)m.push(L+c,Q*C-E+X,0),m.push(L+G+c,Q*C-E+X,0),m.push(L+G+c,(Q+1)*C-E+X,0),m.push(L+c,(Q+1)*C-E+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,D=b===z.b.FLIP_TILE||b===z.b.ROTATE_TILE||b===z.b.FLIP_N_ROTATE_TILE?D.concat(F[(Q+1)%2]):b===z.b.FLIP_ROW||b===z.b.ROTATE_ROW||b===z.b.FLIP_N_ROTATE_ROW?D.concat(F[Q%2]):D.concat(F[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(K){const F=[];p=0,w=0,Y=G/C,s=1,F[0]=[p,w,Y,w,Y,s,p,s],F[1]=[p,w,Y,w,Y,s,p,s],b!==z.b.ROTATE_TILE&&b!==z.b.ROTATE_ROW||(F[1]=[1-p,1-w,1-Y,1-w,1-Y,1-s,1-p,1-s]),b!==z.b.FLIP_TILE&&b!==z.b.FLIP_ROW||(F[1]=[1-p,w,1-Y,w,1-Y,s,1-p,s]),b!==z.b.FLIP_N_ROTATE_TILE&&b!==z.b.FLIP_N_ROTATE_ROW||(F[1]=[p,1-w,Y,1-w,Y,1-s,p,1-s]);for(let Q=0;Q<e;Q++)m.push(f-G+c,Q*C-E+X,0),m.push(f+c,Q*C-E+X,0),m.push(f+c,(Q+1)*C-E+X,0),m.push(f-G+c,(Q+1)*C-E+X,0),n.push(j,j+1,j+3,j+1,j+2,j+3),j+=4,D=b===z.b.FLIP_TILE||b===z.b.ROTATE_TILE||b===z.b.FLIP_N_ROTATE_TILE?D.concat(F[(Q+q)%2]):b===z.b.FLIP_ROW||b===z.b.ROTATE_ROW||b===z.b.FLIP_N_ROTATE_ROW?D.concat(F[Q%2]):D.concat(F[0]),P.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),R.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const w=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE;g.d._ComputeSides(w,m,n,R,D,F.frontUVs,F.backUVs);const Y=new g.d;Y.indices=n,Y.DF=m,Y.PF=R,Y.jF=D;const s=w===g.d.DOUBLESIDE?P.concat(P):P;return Y.nF=s,Y}function y(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return N(b).YF(C,b.updatable),C}function E(F){const b=F.faceUV||new Array(6),Q=F.faceColors,t=F.pattern||z.b.NO_FLIP,Z=F.width||F.size||1,q=F.height||F.size||1,G=F.depth||F.size||1,K=F.tileWidth||F.tileSize||1,y=F.tileHeight||F.tileSize||1,E=F.alignHorizontal||0,c=F.alignVertical||0,X=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE;for(let z=0;z<6;z++)void 0===b[z]&&(b[z]=new C.Vector4(0,0,1,1)),Q&&void 0===Q[z]&&(Q[z]=new e.sb(1,1,1,1));const L=Z/2,i=q/2,f=G/2,k=[];for(let C=0;C<2;C++)k[C]=N({pattern:t,tileWidth:K,tileHeight:y,width:Z,height:q,alignVertical:c,alignHorizontal:E,sideOrientation:X});for(let C=2;C<4;C++)k[C]=N({pattern:t,tileWidth:K,tileHeight:y,width:G,height:q,alignVertical:c,alignHorizontal:E,sideOrientation:X});let m=c;c===z.b.BOTTOM?m=z.b.TOP:c===z.b.TOP&&(m=z.b.BOTTOM);for(let C=4;C<6;C++)k[C]=N({pattern:t,tileWidth:K,tileHeight:y,width:Z,height:G,alignVertical:m,alignHorizontal:E,sideOrientation:X});let R=[],p=[],D=[],P=[];const n=[],j=[],w=[],Y=[];let s=0,V=0;for(let z=0;z<6;z++){const F=k[z].DF.length;j[z]=[],w[z]=[];for(let b=0;b<F/3;b++)j[z].push(new C.gQ(k[z].DF[3*b],k[z].DF[3*b+1],k[z].DF[3*b+2])),w[z].push(new C.gQ(k[z].PF[3*b],k[z].PF[3*b+1],k[z].PF[3*b+2]));s=k[z].jF.length,Y[z]=[];for(let Q=0;Q<s;Q+=2)Y[z][Q]=b[z].x+(b[z].z-b[z].x)*k[z].jF[Q],Y[z][Q+1]=b[z].y+(b[z].w-b[z].y)*k[z].jF[Q+1],W.b&&(Y[z][Q+1]=1-Y[z][Q+1]);if(D=D.concat(Y[z]),P=P.concat(k[z].indices.map((F=>F+V))),V+=j[z].length,Q)for(let b=0;b<4;b++)n.push(Q[z].r,Q[z].g,Q[z].b,Q[z].a)}const h=new C.gQ(0,0,f),l=C.Matrix.RotationY(Math.PI);R=j[0].map((F=>C.gQ.TransformNormal(F,l).add(h))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[]),p=w[0].map((F=>C.gQ.TransformNormal(F,l))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[]),R=R.concat(j[1].map((F=>F.WQ(h))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[])),p=p.concat(w[1].map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[]));const T=new C.gQ(L,0,0),o=C.Matrix.RotationY(-Math.PI/2);R=R.concat(j[2].map((F=>C.gQ.TransformNormal(F,o).add(T))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[])),p=p.concat(w[2].map((F=>C.gQ.TransformNormal(F,o))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[]));const S=C.Matrix.RotationY(Math.PI/2);R=R.concat(j[3].map((F=>C.gQ.TransformNormal(F,S).WQ(T))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[])),p=p.concat(w[3].map((F=>C.gQ.TransformNormal(F,S))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[]));const O=new C.gQ(0,i,0),x=C.Matrix.RotationX(Math.PI/2);R=R.concat(j[4].map((F=>C.gQ.TransformNormal(F,x).add(O))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[])),p=p.concat(w[4].map((F=>C.gQ.TransformNormal(F,x))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[]));const a=C.Matrix.RotationX(-Math.PI/2);R=R.concat(j[5].map((F=>C.gQ.TransformNormal(F,a).WQ(O))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[])),p=p.concat(w[5].map((F=>C.gQ.TransformNormal(F,a))).map((F=>[F.x,F.y,F.z])).reduce(((F,b)=>F.concat(b)),[])),g.d._ComputeSides(X,R,P,p,D);const A=new g.d;if(A.indices=P,A.DF=R,A.PF=p,A.jF=D,Q){const F=X===g.d.DOUBLESIDE?n.concat(n):n;A.nF=F}return A}function c(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return E(b).YF(C,b.updatable),C}g.d.CreateTiledPlane=N;g.d.CreateTiledBox=E;var X=Q(12636),L=Q(11537),i=Q(11510);function f(F){const b=F.height||2;let Q=0===F.diameterTop?0:F.diameterTop||F.diameter||1,t=0===F.diameterBottom?0:F.diameterBottom||F.diameter||1;Q=Q||1e-5,t=t||1e-5;const Z=0|(F.tessellation||24),q=0|(F.subdivisions||1),G=!!F.hasRings,K=!!F.enclose,N=0===F.cap?0:F.cap||z.b.CAP_ALL,y=F.arc&&(F.arc<=0||F.arc>1)?1:F.arc||1,E=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE,c=F.faceUV||new Array(3),X=F.faceColors,L=2+(1+(1!==y&&K?2:0))*(G?q:1);let f;for(f=0;f<L;f++)X&&void 0===X[f]&&(X[f]=new e.sb(1,1,1,1));for(f=0;f<L;f++)c&&void 0===c[f]&&(c[f]=new C.Vector4(0,0,1,1));const k=[],m=[],R=[],p=[],D=[],P=2*Math.PI*y/Z;let n,j,w;const Y=(t-Q)/2/b,s=C.gQ.Zero(),V=C.gQ.Zero(),h=C.gQ.Zero(),l=C.gQ.Zero(),T=C.gQ.Zero(),o=i.c.Y;let S,O,x,a=1,A=1,U=0,u=0;for(S=0;S<=q;S++)for(j=S/q,w=(j*(Q-t)+t)/2,a=G&&0!==S&&S!==q?2:1,x=0;x<a;x++){for(G&&(A+=x),K&&(A+=2*x),O=0;O<=Z;O++)n=O*P,s.x=Math.cos(-n)*w,s.y=-b/2+j*b,s.z=Math.sin(-n)*w,0===Q&&S===q?(V.x=R[R.length-3*(Z+1)],V.y=R[R.length-3*(Z+1)+1],V.z=R[R.length-3*(Z+1)+2]):(V.x=s.x,V.z=s.z,V.y=Math.sqrt(V.x*V.x+V.z*V.z)*Y,V.normalize()),0===O&&(h.W(s),l.W(V)),m.push(s.x,s.y,s.z),R.push(V.x,V.y,V.z),u=G?U!==A?c[A].y:c[A].w:c[A].y+(c[A].w-c[A].y)*j,p.push(c[A].x+(c[A].z-c[A].x)*O/Z,W.b?1-u:u),X&&D.push(X[A].r,X[A].g,X[A].b,X[A].a);1!==y&&K&&(m.push(s.x,s.y,s.z),m.push(0,s.y,0),m.push(0,s.y,0),m.push(h.x,h.y,h.z),C.gQ.CrossToRef(o,V,T),T.normalize(),R.push(T.x,T.y,T.z,T.x,T.y,T.z),C.gQ.CrossToRef(l,o,T),T.normalize(),R.push(T.x,T.y,T.z,T.x,T.y,T.z),u=G?U!==A?c[A+1].y:c[A+1].w:c[A+1].y+(c[A+1].w-c[A+1].y)*j,p.push(c[A+1].x,W.b?1-u:u),p.push(c[A+1].z,W.b?1-u:u),u=G?U!==A?c[A+2].y:c[A+2].w:c[A+2].y+(c[A+2].w-c[A+2].y)*j,p.push(c[A+2].x,W.b?1-u:u),p.push(c[A+2].z,W.b?1-u:u),X&&(D.push(X[A+1].r,X[A+1].g,X[A+1].b,X[A+1].a),D.push(X[A+1].r,X[A+1].g,X[A+1].b,X[A+1].a),D.push(X[A+2].r,X[A+2].g,X[A+2].b,X[A+2].a),D.push(X[A+2].r,X[A+2].g,X[A+2].b,X[A+2].a))),U!==A&&(U=A)}const v=1!==y&&K?Z+4:Z;for(S=0,A=0;A<q;A++){let F=0,b=0,Q=0,C=0;for(O=0;O<Z;O++)F=S*(v+1)+O,b=(S+1)*(v+1)+O,Q=S*(v+1)+(O+1),C=(S+1)*(v+1)+(O+1),k.push(F,b,Q),k.push(C,Q,b);1!==y&&K&&(k.push(F+2,b+2,Q+2),k.push(C+2,Q+2,b+2),k.push(F+4,b+4,Q+4),k.push(C+4,Q+4,b+4)),S=G?S+2:S+1}const J=F=>{const z=F?Q/2:t/2;if(0===z)return;let g,q,G;const K=F?c[L-1]:c[0];let e=null;X&&(e=F?X[L-1]:X[0]);const N=m.length/3,E=F?b/2:-b/2,i=new C.gQ(0,E,0);m.push(i.x,i.y,i.z),R.push(0,F?1:-1,0);const f=K.y+.5*(K.w-K.y);p.push(K.x+.5*(K.z-K.x),W.b?1-f:f),e&&D.push(e.r,e.g,e.b,e.a);const P=new C.Vector2(.5,.5);for(G=0;G<=Z;G++){g=2*Math.PI*G*y/Z;const b=Math.cos(-g),Q=Math.sin(-g);q=new C.gQ(b*z,E,Q*z);const t=new C.Vector2(b*P.x+.5,Q*P.y+.5);m.push(q.x,q.y,q.z),R.push(0,F?1:-1,0);const N=K.y+(K.w-K.y)*t.y;p.push(K.x+(K.z-K.x)*t.x,W.b?1-N:N),e&&D.push(e.r,e.g,e.b,e.a)}for(G=0;G<Z;G++)F?(k.push(N),k.push(N+(G+2)),k.push(N+(G+1))):(k.push(N),k.push(N+(G+1)),k.push(N+(G+2)))};N!==z.b.CAP_START&&N!==z.b.CAP_ALL||J(!1),N!==z.b.CAP_END&&N!==z.b.CAP_ALL||J(!0),g.d._ComputeSides(E,m,k,R,p,F.frontUVs,F.backUVs);const I=new g.d;return I.indices=k,I.DF=m,I.PF=R,I.jF=p,X&&(I.nF=D),I}function k(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return f(b).YF(C,b.updatable),C}function m(F){const b=[],Q=[],z=[],t=[],Z=F.diameter||1,q=F.thickness||.5,G=0|(F.tessellation||16),K=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE,e=G+1;for(let g=0;g<=G;g++){const F=g/G,K=g*Math.PI*2/G-Math.PI/2,N=C.Matrix.Translation(Z/2,0,0).multiply(C.Matrix.RotationY(K));for(let Z=0;Z<=G;Z++){const K=1-Z/G,y=Z*Math.PI*2/G+Math.PI,E=Math.cos(y),c=Math.sin(y);let X=new C.gQ(E,c,0),L=X.scale(q/2);const i=new C.Vector2(F,K);L=C.gQ.TransformCoordinates(L,N),X=C.gQ.TransformNormal(X,N),Q.push(L.x,L.y,L.z),z.push(X.x,X.y,X.z),t.push(i.x,W.b?1-i.y:i.y);const f=(g+1)%e,k=(Z+1)%e;b.push(g*e+Z),b.push(g*e+k),b.push(f*e+Z),b.push(g*e+k),b.push(f*e+k),b.push(f*e+Z)}}g.d._ComputeSides(K,Q,b,z,t,F.frontUVs,F.backUVs);const N=new g.d;return N.indices=b,N.DF=Q,N.PF=z,N.jF=t,N}function R(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return m(b).YF(C,b.updatable),C}g.d.CreateCylinder=f,z.b.CreateCylinder=(F,b,Q,C,t,g,W,Z,q)=>{void 0!==W&&W instanceof L.c||(void 0!==W&&(q=Z||z.b.DEFAULTSIDE,Z=W),W=g,g=1);return k(F,{height:b,diameterTop:Q,diameterBottom:C,tessellation:t,subdivisions:g,sideOrientation:q,updatable:Z},W)};function p(F){const b=[],Q=[],z=[],t=[],Z=F.radius||2,q=F.tube||.5,G=F.radialSegments||32,K=F.tubularSegments||32,e=F.p||2,N=F.q||3,y=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE,E=F=>{const b=Math.cos(F),Q=Math.sin(F),z=N/e*F,t=Math.cos(z),g=Z*(2+t)*.5*b,W=Z*(2+t)*Q*.5,q=Z*Math.sin(z)*.5;return new C.gQ(g,W,q)};let c,X;for(c=0;c<=G;c++){const F=c%G/G*2*e*Math.PI,b=E(F),z=E(F+.01),g=z.WQ(b);let Z=z.add(b);const N=C.gQ.Cross(g,Z);for(Z=C.gQ.Cross(N,g),N.normalize(),Z.normalize(),X=0;X<K;X++){const F=X%K/K*2*Math.PI,C=-q*Math.cos(F),z=q*Math.sin(F);Q.push(b.x+C*Z.x+z*N.x),Q.push(b.y+C*Z.y+z*N.y),Q.push(b.z+C*Z.z+z*N.z),t.push(c/G),t.push(W.b?1-X/K:X/K)}}for(c=0;c<G;c++)for(X=0;X<K;X++){const F=(X+1)%K,Q=c*K+X,C=(c+1)*K+X,z=(c+1)*K+F,t=c*K+F;b.push(t),b.push(C),b.push(Q),b.push(t),b.push(z),b.push(C)}g.d.ComputeNormals(Q,b,z),g.d._ComputeSides(y,Q,b,z,t,F.frontUVs,F.backUVs);const L=new g.d;return L.indices=b,L.DF=Q,L.PF=z,L.jF=t,L}function D(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2?arguments[2]:void 0;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return p(b).YF(C,b.updatable),C}g.d.CreateTorus=m,z.b.CreateTorus=(F,b,Q,C,z,t,g)=>R(F,{diameter:b,thickness:Q,tessellation:C,sideOrientation:g,updatable:t},z);g.d.CreateTorusKnot=p,z.b.CreateTorusKnot=(F,b,Q,C,z,t,g,W,Z,q)=>D(F,{radius:b,tube:Q,radialSegments:C,tubularSegments:z,p:t,q:g,sideOrientation:q,updatable:Z},W);var P=Q(13124),n=Q(11845),j=Q(11515);function w(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=b.path,t=b.shape,g=b.scale||1,W=b.rotation||0,Z=0===b.cap?0:b.cap||z.b.NO_CAP,q=b.updatable,G=z.b._GetDefaultSideOrientation(b.sideOrientation),K=b.instance||null,e=b.invertUV||!1,N=b.closeShape||!1,y=b.closePath||!1,E=b.capFunction||null;return s(F,t,C,g,W,null,null,y,N,Z,!1,Q,!!q,G,K,e,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame,E)}function Y(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=b.path,t=b.shape,g=b.scaleFunction||(()=>1),W=b.rotationFunction||(()=>0),Z=b.closePath||b.ribbonCloseArray||!1,q=b.closeShape||b.ribbonClosePath||!1,G=0===b.cap?0:b.cap||z.b.NO_CAP,K=b.updatable,e=b.firstNormal||null,N=b.adjustFrame||!1,y=z.b._GetDefaultSideOrientation(b.sideOrientation),E=b.instance,c=b.invertUV||!1,X=b.capFunction||null;return s(F,t,C,null,null,g,W,Z,q,G,!0,Q,!!K,y,E||null,c,b.frontUVs||null,b.backUVs||null,e,N,X||null)}function s(F,b,Q,t,g,W,Z,G,K,e,N,y,E,c,X,L,i,f,k,m,R){const p=(F,b,Q,t,g,W,Z,q,G,K,e)=>{const N=Q.getTangents(),y=Q.getNormals(),E=Q.getBinormals(),c=Q.getDistances();if(e)for(let z=0;z<N.length;z++)if(0==N[z].x&&0==N[z].y&&0==N[z].z&&N[z].W(N[z-1]),0==y[z].x&&0==y[z].y&&0==y[z].z&&y[z].W(y[z-1]),0==E[z].x&&0==E[z].y&&0==E[z].z&&E[z].W(E[z-1]),z>0){let F=N[z-1];C.gQ.Dot(F,N[z])<0&&N[z].scaleInPlace(-1),F=y[z-1],C.gQ.Dot(F,y[z])<0&&y[z].scaleInPlace(-1),F=E[z-1],C.gQ.Dot(F,E[z])<0&&E[z].scaleInPlace(-1)}let X=0;const L=K&&q?q:()=>null!==W?W:0,i=K&&Z?Z:()=>null!==g?g:1;let f=G===z.b.NO_CAP||G===z.b.CAP_END?0:2;const k=C.TmpVectors.Matrix[0];for(let z=0;z<b.length;z++){const Q=[],g=L(z,c[z]),W=i(z,c[z]);C.Matrix.RotationAxisToRef(N[z],X,k);for(let t=0;t<F.length;t++){const g=N[z].scale(F[t].z).add(y[z].scale(F[t].x)).add(E[z].scale(F[t].y)),Z=C.gQ.Zero();C.gQ.TransformCoordinatesToRef(g,k,Z),Z.scaleInPlace(W).addInPlace(b[z]),Q[t]=Z}t[f]=Q,X+=g,f++}const m=R||(F=>{const b=Array(),Q=C.gQ.Zero();let z;for(z=0;z<F.length;z++)Q.addInPlace(F[z]);for(Q.scaleInPlace(1/F.length),z=0;z<F.length;z++)b.push(Q);return b});switch(G){case z.b.NO_CAP:break;case z.b.CAP_START:t[0]=m(t[2]),t[1]=t[2];break;case z.b.CAP_END:t[f]=t[f-1],t[f+1]=m(t[f-1]);break;case z.b.CAP_ALL:t[0]=m(t[2]),t[1]=t[2],t[f]=t[f-1],t[f+1]=m(t[f-1])}return t};let D,P;if(X){const F=X._creationDataStorage;return D=k?F.path3D.update(Q,k):F.path3D.update(Q),P=p(b,Q,F.path3D,F.pathArray,t,g,W,Z,F.cap,N,m),X=q("",{pathArray:P,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:X},y||void 0)}D=k?new j.j(Q,k):new j.j(Q);P=p(b,Q,D,new Array,t,g,W,Z,e=e<0||e>3?0:e,N,m);const n=q(F,{pathArray:P,closeArray:G,closePath:K,updatable:E,sideOrientation:c,invertUV:L,frontUVs:i||void 0,backUVs:f||void 0},y);return n._creationDataStorage.pathArray=P,n._creationDataStorage.path3D=D,n._creationDataStorage.cap=e,n}function V(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,g=void 0===b.closed||b.closed,W=b.shape,Z=b.radius||1,G=b.tessellation||64,K=b.clip||0,e=b.updatable,N=z.b._GetDefaultSideOrientation(b.sideOrientation),y=b.cap||z.b.NO_CAP,E=2*Math.PI,c=[],X=b.invertUV||!1;let L=0,i=0;const f=E/G*t;let k,m;for(L=0;L<=G-K;L++){for(m=[],y!=z.b.CAP_START&&y!=z.b.CAP_ALL||(m.push(new C.gQ(0,W[0].y,0)),m.push(new C.gQ(Math.cos(L*f)*W[0].x*Z,W[0].y,Math.sin(L*f)*W[0].x*Z))),i=0;i<W.length;i++)k=new C.gQ(Math.cos(L*f)*W[i].x*Z,W[i].y,Math.sin(L*f)*W[i].x*Z),m.push(k);y!=z.b.CAP_END&&y!=z.b.CAP_ALL||(m.push(new C.gQ(Math.cos(L*f)*W[W.length-1].x*Z,W[W.length-1].y,Math.sin(L*f)*W[W.length-1].x*Z)),m.push(new C.gQ(0,W[W.length-1].y,0))),c.push(m)}return q(F,{pathArray:c,closeArray:g,sideOrientation:N,updatable:e,invertUV:X,frontUVs:b.frontUVs,backUVs:b.backUVs},Q)}z.b.ExtrudeShape=function(F,b,Q,C,t,g){let W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7?arguments[7]:void 0,q=arguments.length>8?arguments[8]:void 0,G=arguments.length>9?arguments[9]:void 0;return w(F,{shape:b,path:Q,scale:C,rotation:t,cap:0===g?0:g||z.b.NO_CAP,sideOrientation:q,instance:G,updatable:Z},W)},z.b.ExtrudeShapeCustom=(F,b,Q,C,t,g,W,Z,q,G,K,e)=>Y(F,{shape:b,path:Q,scaleFunction:C,rotationFunction:t,ribbonCloseArray:g,ribbonClosePath:W,cap:0===Z?0:Z||z.b.NO_CAP,sideOrientation:K,instance:e,updatable:G},q);z.b.CreateLathe=(F,b,Q,C,z,t,g)=>V(F,{shape:b,radius:Q,tessellation:C,sideOrientation:g,updatable:t},z);var h=Q(12533),l=Q(12489);function T(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=b.path;let g=b.instance,W=1;void 0!==b.radius?W=b.radius:g&&(W=g._creationDataStorage.radius);const Z=b.tessellation||64,G=b.radiusFunction||null;let K=b.cap||z.b.NO_CAP;const e=b.invertUV||!1,N=b.updatable,y=z.b._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const E=(F,b,Q,t,g,W,Z,q)=>{const G=b.getTangents(),K=b.getNormals(),e=b.getDistances(),N=2*Math.PI/g*q,y=W||(()=>t);let E,c,X,L;const i=C.TmpVectors.Matrix[0];let f=Z===z.b.NO_CAP||Z===z.b.CAP_END?0:2;for(let z=0;z<F.length;z++){c=y(z,e[z]),E=Array(),X=K[z];for(let b=0;b<g;b++)C.Matrix.RotationAxisToRef(G[z],N*b,i),L=E[b]?E[b]:C.gQ.Zero(),C.gQ.TransformCoordinatesToRef(X,i,L),L.scaleInPlace(c).addInPlace(F[z]),E[b]=L;Q[f]=E,f++}const k=(b,Q)=>{const C=Array();for(let z=0;z<b;z++)C.push(F[Q]);return C};switch(Z){case z.b.NO_CAP:break;case z.b.CAP_START:Q[0]=k(g,0),Q[1]=Q[2].slice(0);break;case z.b.CAP_END:Q[f]=Q[f-1].slice(0),Q[f+1]=k(g,F.length-1);break;case z.b.CAP_ALL:Q[0]=k(g,0),Q[1]=Q[2].slice(0),Q[f]=Q[f-1].slice(0),Q[f+1]=k(g,F.length-1)}return Q};let c,X;if(g){const F=g._creationDataStorage,Q=b.arc||F.arc;return c=F.path3D.update(t),X=E(t,c,F.pathArray,W,F.tessellation,G,F.cap,Q),g=q("",{pathArray:X,instance:g}),F.path3D=c,F.pathArray=X,F.arc=Q,F.radius=W,g}c=new j.j(t);K=K<0||K>3?0:K,X=E(t,c,new Array,W,Z,G,K,b.arc);const L=q(F,{pathArray:X,closePath:!0,closeArray:!1,updatable:N,sideOrientation:y,invertUV:e,frontUVs:b.frontUVs,backUVs:b.backUVs},Q);return L._creationDataStorage.pathArray=X,L._creationDataStorage.path3D=c,L._creationDataStorage.tessellation=Z,L._creationDataStorage.cap=K,L._creationDataStorage.arc=b.arc,L._creationDataStorage.radius=W,L}function o(F){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const Q=F.type&&(F.type<0||F.type>=b.length)?0:F.type||0,z=F.size,t=F.sizeX||z||1,Z=F.sizeY||z||1,q=F.sizeZ||z||1,G=F.custom||b[Q],K=G.face.length,N=F.faceUV||new Array(K),y=F.faceColors,E=void 0===F.flat||F.flat,c=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE,X=[],L=[],i=[],f=[],k=[];let m=0,R=0;const p=[];let D,P,n,j,w,Y,s=0,V=0;if(E)for(V=0;V<K;V++)y&&void 0===y[V]&&(y[V]=new e.sb(1,1,1,1)),N&&void 0===N[V]&&(N[V]=new C.Vector4(0,0,1,1));if(E)for(V=0;V<K;V++){const F=G.face[V].length;for(n=2*Math.PI/F,j=.5*Math.tan(n/2),w=.5,s=0;s<F;s++)X.push(G.vertex[G.face[V][s]][0]*t,G.vertex[G.face[V][s]][1]*Z,G.vertex[G.face[V][s]][2]*q),p.push(m),m++,D=N[V].x+(N[V].z-N[V].x)*(.5+j),P=N[V].y+(N[V].w-N[V].y)*(w-.5),f.push(D,W.b?1-P:P),Y=j*Math.cos(n)-w*Math.sin(n),w=j*Math.sin(n)+w*Math.cos(n),j=Y,y&&k.push(y[V].r,y[V].g,y[V].b,y[V].a);for(s=0;s<F-2;s++)L.push(p[0+R],p[s+2+R],p[s+1+R]);R+=F}else{for(s=0;s<G.vertex.length;s++)X.push(G.vertex[s][0]*t,G.vertex[s][1]*Z,G.vertex[s][2]*q),f.push(0,W.b?1:0);for(V=0;V<K;V++)for(s=0;s<G.face[V].length-2;s++)L.push(G.face[V][0],G.face[V][s+2],G.face[V][s+1])}g.d.ComputeNormals(X,L,i),g.d._ComputeSides(c,X,L,i,f,F.frontUVs,F.backUVs);const h=new g.d;return h.DF=X,h.indices=L,h.PF=i,h.jF=f,y&&E&&(h.nF=k),h}function S(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return o(b).YF(C,b.updatable),C}z.b.CreateTube=(F,b,Q,C,z,t,g,W,Z,q)=>T(F,{path:b,radius:Q,tessellation:C,radiusFunction:z,arc:1,cap:t,updatable:W,sideOrientation:Z,instance:q},g);function O(F){const b=F.sideOrientation||g.d.DEFAULTSIDE,Q=F.radius||1,z=void 0===F.flat||F.flat,t=0|(F.subdivisions||4),Z=F.radiusX||Q,q=F.radiusY||Q,G=F.radiusZ||Q,K=(1+Math.sqrt(5))/2,e=[-1,K,-0,1,K,0,-1,-K,0,1,-K,0,0,-1,-K,0,1,-K,0,-1,K,0,1,K,K,0,1,K,0,-1,-K,0,1,-K,0,-1],N=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],y=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],E=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],c=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],X=[],L=[],i=[],f=[];let k=0;const m=new Array(3),R=new Array(3);let p;for(p=0;p<3;p++)m[p]=C.gQ.Zero(),R[p]=C.Vector2.Zero();for(let g=0;g<20;g++){for(p=0;p<3;p++){const F=N[3*g+p];m[p].jb(e[3*y[F]],e[3*y[F]+1],e[3*y[F]+2]),m[p].normalize(),R[p].jb(.134765625*E[2*F]+.05859375+-.0390625*c[g],.2333984375*E[2*F+1]+.025390625+.01953125*c[g])}const F=(F,b,Q,g)=>{const K=C.gQ.Lerp(m[0],m[2],b/t),e=C.gQ.Lerp(m[1],m[2],b/t),N=t===b?m[2]:C.gQ.Lerp(K,e,F/(t-b));let y;if(N.normalize(),z){const F=C.gQ.Lerp(m[0],m[2],g/t),b=C.gQ.Lerp(m[1],m[2],g/t);y=C.gQ.Lerp(F,b,Q/(t-g))}else y=new C.gQ(N.x,N.y,N.z);y.x/=Z,y.y/=q,y.z/=G,y.normalize();const E=C.Vector2.Lerp(R[0],R[2],b/t),c=C.Vector2.Lerp(R[1],R[2],b/t),p=t===b?R[2]:C.Vector2.Lerp(E,c,F/(t-b));L.push(N.x*Z,N.y*q,N.z*G),i.push(y.x,y.y,y.z),f.push(p.x,W.b?1-p.y:p.y),X.push(k),k++};for(let b=0;b<t;b++)for(let Q=0;Q+b<t;Q++)F(Q,b,Q+1/3,b+1/3),F(Q+1,b,Q+1/3,b+1/3),F(Q,b+1,Q+1/3,b+1/3),Q+b+1<t&&(F(Q+1,b,Q+2/3,b+2/3),F(Q+1,b+1,Q+2/3,b+2/3),F(Q,b+1,Q+2/3,b+2/3))}g.d._ComputeSides(b,L,X,i,f,F.frontUVs,F.backUVs);const D=new g.d;return D.indices=X,D.DF=L,D.PF=i,D.jF=f,D}function x(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const C=new z.b(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),C._originalBuilderSideOrientation=b.sideOrientation;return O(b).YF(C,b.updatable),C}g.d.CreatePolyhedron=o,z.b.CreatePolyhedron=(F,b,Q)=>S(F,b,Q);g.d.CreateIcoSphere=O,z.b.CreateIcoSphere=(F,b,Q)=>x(F,b,Q);var a=Q(11329);const A=new C.gQ(1,0,0),U=new C.gQ(-1,0,0),u=new C.gQ(0,1,0),v=new C.gQ(0,-1,0),J=new C.gQ(0,0,1),I=new C.gQ(0,0,-1);class M{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.gQ.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.gQ.Up(),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.Vector2.Zero(),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=F,this.normal=b,this.uv=Q,this.vertexIdx=z,this.vertexIdxForBones=t,this.localPositionOverride=g,this.localNormalOverride=W,this.matrixIndicesOverride=Z,this.matrixWeightsOverride=q}clone(){var F,b,Q,C;return new M(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(F=this.localPositionOverride)||void 0===F?void 0:F.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(Q=this.matrixIndicesOverride)||void 0===Q?void 0:Q.slice(),null===(C=this.matrixWeightsOverride)||void 0===C?void 0:C.slice())}}function r(F,b,Q){var Z,q,G,K,e;const N=!!b.skeleton,y=!(null===(Z=b.morphTargetManager)||void 0===Z||!Z.numTargets),E=Q.localMode||N,c=b.Pb(),X=N||y?b.bg(!0,!0):b.getVerticesData(t.e.PositionKind),L=N||y?b.getNormalsData(!0,!0):b.getVerticesData(t.e.NormalKind),i=E?N?b.getVerticesData(t.e.PositionKind):X:null,f=E?N?b.getVerticesData(t.e.NormalKind):L:null,k=b.getVerticesData(t.e.UVKind),m=N?b.getVerticesData(t.e.MatricesIndicesKind):null,R=N?b.getVerticesData(t.e.MatricesWeightsKind):null,p=N?b.getVerticesData(t.e.MatricesIndicesExtraKind):null,D=N?b.getVerticesData(t.e.MatricesWeightsExtraKind):null,P=Q.position||C.gQ.Zero();let n=Q.normal||C.gQ.Up();const j=Q.size||C.gQ.One(),w=Q.angle||0;if(!n){const F=new C.gQ(0,0,1),Q=b.RF().activeCamera,z=C.gQ.TransformCoordinates(F,Q.getWorldMatrix());n=Q.globalPosition.WQ(z)}const Y=-Math.atan2(n.z,n.x)-Math.PI/2,s=Math.sqrt(n.x*n.x+n.z*n.z),V=Math.atan2(n.y,s),h=new g.d;h.indices=[],h.DF=[],h.PF=[],h.jF=[],h.matricesIndices=N?[]:null,h.matricesWeights=N?[]:null,h.matricesIndicesExtra=p?[]:null,h.matricesWeightsExtra=D?[]:null;let l=0;const T=(F,b)=>{const z=new M;if(!c||!X||!L)return z;const t=c[F];if(z.vertexIdx=3*t,z.vertexIdxForBones=4*t,z.position=new C.gQ(X[3*t],X[3*t+1],X[3*t+2]),C.gQ.TransformCoordinatesToRef(z.position,b,z.position),z.normal=new C.gQ(L[3*t],L[3*t+1],L[3*t+2]),C.gQ.TransformNormalToRef(z.normal,b,z.normal),Q.captureUVS&&k){const F=k[2*t+1];z.uv=new C.Vector2(k[2*t],W.b?1-F:F)}return z},o=[0,0,0,0],S=(F,b)=>{if(0===F.length)return F;const Q=.5*Math.abs(C.gQ.Dot(j,b)),z=(F,b,Q,C)=>{for(let z=0;z<C;++z)if(F[Q+z]===b)return Q+z;return-1},t=(F,t)=>{const g=C.gQ.GetClipFactor(F.position,t.position,b,Q);let W=o,Z=o;if(m&&R){const b=F.matrixIndicesOverride?0:F.vertexIdxForBones,Q=F.matrixIndicesOverride??m,C=F.matrixWeightsOverride??R,q=t.matrixIndicesOverride?0:t.vertexIdxForBones,G=t.matrixIndicesOverride??m,K=t.matrixWeightsOverride??R;W=[0,0,0,0],Z=[0,0,0,0];let e=0;for(let F=0;F<4;++F)if(C[b+F]>0){const t=z(G,Q[b+F],q,4);W[e]=Q[b+F],Z[e]=(0,a.Lerp)(C[b+F],t>=0?K[t]:0,g),e++}for(let F=0;F<4&&e<4;++F){const C=G[q+F];-1===z(Q,C,b,4)&&(W[e]=C,Z[e]=(0,a.Lerp)(0,K[q+F],g),e++)}const N=Z[0]+Z[1]+Z[2]+Z[3];Z[0]/=N,Z[1]/=N,Z[2]/=N,Z[3]/=N}const q=F.localPositionOverride?F.localPositionOverride[0]:(null===i||void 0===i?void 0:i[F.vertexIdx])??0,G=F.localPositionOverride?F.localPositionOverride[1]:(null===i||void 0===i?void 0:i[F.vertexIdx+1])??0,K=F.localPositionOverride?F.localPositionOverride[2]:(null===i||void 0===i?void 0:i[F.vertexIdx+2])??0,e=t.localPositionOverride?t.localPositionOverride[0]:(null===i||void 0===i?void 0:i[t.vertexIdx])??0,N=t.localPositionOverride?t.localPositionOverride[1]:(null===i||void 0===i?void 0:i[t.vertexIdx+1])??0,y=t.localPositionOverride?t.localPositionOverride[2]:(null===i||void 0===i?void 0:i[t.vertexIdx+2])??0,E=F.localNormalOverride?F.localNormalOverride[0]:(null===f||void 0===f?void 0:f[F.vertexIdx])??0,c=F.localNormalOverride?F.localNormalOverride[1]:(null===f||void 0===f?void 0:f[F.vertexIdx+1])??0,X=F.localNormalOverride?F.localNormalOverride[2]:(null===f||void 0===f?void 0:f[F.vertexIdx+2])??0,L=E+((t.localNormalOverride?t.localNormalOverride[0]:(null===f||void 0===f?void 0:f[t.vertexIdx])??0)-E)*g,k=c+((t.localNormalOverride?t.localNormalOverride[1]:(null===f||void 0===f?void 0:f[t.vertexIdx+1])??0)-c)*g,p=X+((t.localNormalOverride?t.localNormalOverride[2]:(null===f||void 0===f?void 0:f[t.vertexIdx+2])??0)-X)*g,D=Math.sqrt(L*L+k*k+p*p);return new M(C.gQ.Lerp(F.position,t.position,g),C.gQ.Lerp(F.normal,t.normal,g).normalize(),C.Vector2.Lerp(F.uv,t.uv,g),-1,-1,i?[q+(e-q)*g,G+(N-G)*g,K+(y-K)*g]:null,f?[L/D,k/D,p/D]:null,W,Z)};let g=null;F.length>3&&(g=[]);for(let W=0;W<F.length;W+=3){let z=0,Z=null,q=null,G=null,K=null;const e=C.gQ.Dot(F[W].position,b)-Q>0,N=C.gQ.Dot(F[W+1].position,b)-Q>0,y=C.gQ.Dot(F[W+2].position,b)-Q>0;switch(z=(e?1:0)+(N?1:0)+(y?1:0),z){case 0:F.length>3?(g.push(F[W]),g.push(F[W+1]),g.push(F[W+2])):g=F;break;case 1:if(g=g??new Array,e&&(Z=F[W+1],q=F[W+2],G=t(F[W],Z),K=t(F[W],q)),N){Z=F[W],q=F[W+2],G=t(F[W+1],Z),K=t(F[W+1],q),g.push(G),g.push(q.clone()),g.push(Z.clone()),g.push(q.clone()),g.push(G.clone()),g.push(K);break}y&&(Z=F[W],q=F[W+1],G=t(F[W+2],Z),K=t(F[W+2],q)),Z&&q&&G&&K&&(g.push(Z.clone()),g.push(q.clone()),g.push(G),g.push(K),g.push(G.clone()),g.push(q.clone()));break;case 2:g=g??new Array,e||(Z=F[W].clone(),q=t(Z,F[W+1]),G=t(Z,F[W+2]),g.push(Z),g.push(q),g.push(G)),N||(Z=F[W+1].clone(),q=t(Z,F[W+2]),G=t(Z,F[W]),g.push(Z),g.push(q),g.push(G)),y||(Z=F[W+2].clone(),q=t(Z,F[W]),G=t(Z,F[W+1]),g.push(Z),g.push(q),g.push(G))}}return g},O=b instanceof z.b?b:null,x=null===O||void 0===O?void 0:O._thinInstanceDataStorage.matrixData,r=(null===O||void 0===O?void 0:O.hb)||1,H=C.TmpVectors.Matrix[0];H.W(C.Matrix.IdentityReadOnly);for(let z=0;z<r;++z){if(null!==O&&void 0!==O&&O.hasThinInstances&&x){const F=16*z;H.setRowFromFloats(0,x[F+0],x[F+1],x[F+2],x[F+3]),H.setRowFromFloats(1,x[F+4],x[F+5],x[F+6],x[F+7]),H.setRowFromFloats(2,x[F+8],x[F+9],x[F+10],x[F+11]),H.setRowFromFloats(3,x[F+12],x[F+13],x[F+14],x[F+15])}const F=C.Matrix.RotationYawPitchRoll(Y,V,w).multiply(C.Matrix.Translation(P.x,P.y,P.z)),t=C.Matrix.Invert(F),g=b.getWorldMatrix(),Z=H.multiply(g).multiply(t),q=new Array(3);for(let b=0;b<c.length;b+=3){let F=q;if(F[0]=T(b,Z),F[1]=T(b+1,Z),F[2]=T(b+2,Z),!(Q.cullBackFaces&&-F[0].normal.z<=0&&-F[1].normal.z<=0&&-F[2].normal.z<=0)&&(F=S(F,A),F&&(F=S(F,U),F&&(F=S(F,u),F&&(F=S(F,v),F&&(F=S(F,J),F&&(F=S(F,I),F)))))))for(let b=0;b<F.length;b++){const C=F[b];if(h.indices.push(l),E?(C.localPositionOverride?(h.DF[3*l]=C.localPositionOverride[0],h.DF[3*l+1]=C.localPositionOverride[1],h.DF[3*l+2]=C.localPositionOverride[2]):i&&(h.DF[3*l]=i[C.vertexIdx],h.DF[3*l+1]=i[C.vertexIdx+1],h.DF[3*l+2]=i[C.vertexIdx+2]),C.localNormalOverride?(h.PF[3*l]=C.localNormalOverride[0],h.PF[3*l+1]=C.localNormalOverride[1],h.PF[3*l+2]=C.localNormalOverride[2]):f&&(h.PF[3*l]=f[C.vertexIdx],h.PF[3*l+1]=f[C.vertexIdx+1],h.PF[3*l+2]=f[C.vertexIdx+2])):(C.position.toArray(h.DF,3*l),C.normal.toArray(h.PF,3*l)),h.matricesIndices&&h.matricesWeights&&(C.matrixIndicesOverride?(h.matricesIndices[4*l]=C.matrixIndicesOverride[0],h.matricesIndices[4*l+1]=C.matrixIndicesOverride[1],h.matricesIndices[4*l+2]=C.matrixIndicesOverride[2],h.matricesIndices[4*l+3]=C.matrixIndicesOverride[3]):(m&&(h.matricesIndices[4*l]=m[C.vertexIdxForBones],h.matricesIndices[4*l+1]=m[C.vertexIdxForBones+1],h.matricesIndices[4*l+2]=m[C.vertexIdxForBones+2],h.matricesIndices[4*l+3]=m[C.vertexIdxForBones+3]),p&&h.matricesIndicesExtra&&(h.matricesIndicesExtra[4*l]=p[C.vertexIdxForBones],h.matricesIndicesExtra[4*l+1]=p[C.vertexIdxForBones+1],h.matricesIndicesExtra[4*l+2]=p[C.vertexIdxForBones+2],h.matricesIndicesExtra[4*l+3]=p[C.vertexIdxForBones+3])),C.matrixWeightsOverride?(h.matricesWeights[4*l]=C.matrixWeightsOverride[0],h.matricesWeights[4*l+1]=C.matrixWeightsOverride[1],h.matricesWeights[4*l+2]=C.matrixWeightsOverride[2],h.matricesWeights[4*l+3]=C.matrixWeightsOverride[3]):(R&&(h.matricesWeights[4*l]=R[C.vertexIdxForBones],h.matricesWeights[4*l+1]=R[C.vertexIdxForBones+1],h.matricesWeights[4*l+2]=R[C.vertexIdxForBones+2],h.matricesWeights[4*l+3]=R[C.vertexIdxForBones+3]),D&&h.matricesWeightsExtra&&(h.matricesWeightsExtra[4*l]=D[C.vertexIdxForBones],h.matricesWeightsExtra[4*l+1]=D[C.vertexIdxForBones+1],h.matricesWeightsExtra[4*l+2]=D[C.vertexIdxForBones+2],h.matricesWeightsExtra[4*l+3]=D[C.vertexIdxForBones+3]))),Q.captureUVS)C.uv.toArray(h.jF,2*l);else{h.jF.push(.5+C.position.x/j.x);const F=.5+C.position.y/j.y;h.jF.push(W.b?1-F:F)}l++}}}0===h.indices.length&&(h.indices=null),0===h.DF.length&&(h.DF=null),0===h.PF.length&&(h.PF=null),0===h.jF.length&&(h.jF=null),0===(null===(q=h.matricesIndices)||void 0===q?void 0:q.length)&&(h.matricesIndices=null),0===(null===(G=h.matricesWeights)||void 0===G?void 0:G.length)&&(h.matricesWeights=null),0===(null===(K=h.matricesIndicesExtra)||void 0===K?void 0:K.length)&&(h.matricesIndicesExtra=null),0===(null===(e=h.matricesWeightsExtra)||void 0===e?void 0:e.length)&&(h.matricesWeightsExtra=null);const B=new z.b(F,b.RF());return h.YF(B),E?(B.skeleton=b.skeleton,B.parent=b):(B.position=P.clone(),B.rotation=new C.gQ(V,Y,w)),B.Rb(!0),B.refreshBoundingInfo(!0,!0),B}function H(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const b=0|Math.max(F.subdivisions?F.subdivisions:2,1),Q=0|Math.max(F.tessellation?F.tessellation:16,3),z=Math.max(F.height?F.height:1,0),t=Math.max(F.radius?F.radius:.25,0),Z=0|Math.max(F.capSubdivisions?F.capSubdivisions:6,1),q=Q,G=b,K=Math.max(F.radiusTop?F.radiusTop:t,0),e=Math.max(F.radiusBottom?F.radiusBottom:t,0),N=z-(K+e),y=2*Math.PI,E=Math.max(F.topCapSubdivisions?F.topCapSubdivisions:Z,1),c=Math.max(F.bottomCapSubdivisions?F.bottomCapSubdivisions:Z,1),X=Math.acos((e-K)/z);let L=[];const i=[],f=[],k=[];let m=0;const R=[],p=.5*N,D=.5*Math.PI;let P,n;const j=C.gQ.Zero(),w=C.gQ.Zero(),Y=Math.cos(X),s=Math.sin(X),V=new C.Vector2(K*s,p+K*Y).WQ(new C.Vector2(e*s,e*Y-p)).length(),h=K*X+V+e*(D-X);let l=0;for(n=0;n<=E;n++){const F=[],b=D-X*(n/E);l+=K*X/E;const Q=Math.cos(b),C=Math.sin(b),z=Q*K;for(P=0;P<=q;P++){const b=P/q,t=b*y+0,g=Math.sin(t),Z=Math.cos(t);w.x=z*g,w.y=p+C*K,w.z=z*Z,i.push(w.x,w.y,w.z),j.set(Q*g,C,Q*Z),f.push(j.x,j.y,j.z),k.push(b,W.b?l/h:1-l/h),F.push(m),m++}R.push(F)}const T=z-K-e+Y*K-Y*e,o=s*(e-K)/T;for(n=1;n<=G;n++){const F=[];l+=V/G;const b=s*(n*(e-K)/G+K);for(P=0;P<=q;P++){const Q=P/q,C=Q*y+0,z=Math.sin(C),t=Math.cos(C);w.x=b*z,w.y=p+Y*K-n*T/G,w.z=b*t,i.push(w.x,w.y,w.z),j.set(z,o,t).normalize(),f.push(j.x,j.y,j.z),k.push(Q,W.b?l/h:1-l/h),F.push(m),m++}R.push(F)}for(n=1;n<=c;n++){const F=[],b=D-X-(Math.PI-X)*(n/c);l+=e*X/c;const Q=Math.cos(b),C=Math.sin(b),z=Q*e;for(P=0;P<=q;P++){const b=P/q,t=b*y+0,g=Math.sin(t),Z=Math.cos(t);w.x=z*g,w.y=C*e-p,w.z=z*Z,i.push(w.x,w.y,w.z),j.set(Q*g,C,Q*Z),f.push(j.x,j.y,j.z),k.push(b,W.b?l/h:1-l/h),F.push(m),m++}R.push(F)}for(P=0;P<q;P++)for(n=0;n<E+G+c;n++){const F=R[n][P],b=R[n+1][P],Q=R[n+1][P+1],C=R[n][P+1];L.push(F),L.push(b),L.push(C),L.push(b),L.push(Q),L.push(C)}if(L=L.reverse(),F.orientation&&!F.orientation.equals(C.gQ.Up())){const b=new C.Matrix;F.orientation.clone().scale(.5*Math.PI).cross(C.gQ.Up()).toQuaternion().toRotationMatrix(b);const Q=C.gQ.Zero();for(let F=0;F<i.length;F+=3)Q.set(i[F],i[F+1],i[F+2]),C.gQ.TransformCoordinatesToRef(Q.clone(),b,Q),i[F]=Q.x,i[F+1]=Q.y,i[F+2]=Q.z}const S=new g.d;return S.DF=i,S.PF=f,S.jF=k,S.indices=L,S}function B(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:C.gQ.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=new z.b(F,Q);return H(b).YF(t,b.updatable),t}z.b.CreateDecal=(F,b,Q,C,z,t)=>r(F,b,{position:Q,normal:C,size:z,angle:t});z.b.CreateCapsule=(F,b,Q)=>B(F,b,Q),g.d.CreateCapsule=H;var d=Q(11146),FF=Q(11318);class bF{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=F,this.y=b,F!==Math.floor(F)&&(F=Math.floor(F),d.e.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),d.e.Warn("y is not an integer, floor(y) used"))}clone(){return new bF(this.x,this.y)}rotate60About(F){const b=this.x;return this.x=F.x+F.y-this.y,this.y=b+this.y-F.x,this}rotateNeg60About(F){const b=this.x;return this.x=b+this.y-F.y,this.y=F.x+F.y-b,this}rotate120(F,b){F!==Math.floor(F)&&(F=Math.floor(F),d.e.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),d.e.Warn("n not an integer only floor(n) used"));const Q=this.x;return this.x=F-Q-this.y,this.y=b+Q,this}rotateNeg120(F,b){F!==Math.floor(F)&&(F=Math.floor(F),d.e.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),d.e.Warn("n is not an integer,   floor(n) used"));const Q=this.x;return this.x=this.y-b,this.y=F+b-Q-this.y,this}toCartesianOrigin(F,b){const Q=C.gQ.Zero();return Q.x=F.x+2*this.x*b+this.y*b,Q.y=F.y+Math.sqrt(3)*this.y*b,Q}static Zero(){return new bF(0,0)}}class QF{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new CF("icosahedron","Regular",[[0,FF.e,-1],[-FF.e,1,0],[-1,0,-FF.e],[1,0,-FF.e],[FF.e,1,0],[0,FF.e,1],[-1,0,FF.e],[-FF.e,-1,0],[0,-FF.e,-1],[FF.e,-1,0],[1,0,FF.e],[0,-FF.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let F=12;const b={},Q=this.m,C=this.n;let z,t,g,W,Z,q=Q,G=1,K=0;0!==C&&(q=(0,a.HighestCommonFactor)(Q,C)),G=Q/q,K=C/q;const e=bF.Zero(),N=new bF(Q,C),y=new bF(-C,Q+C),E=bF.Zero(),c=bF.Zero(),X=bF.Zero();let L,i,f,k,m=[];const R=[],p=this.vertByDist,D=(Q,C,z,t)=>{L=Q+"|"+z,i=C+"|"+t,L in b||i in b?L in b&&!(i in b)?b[i]=b[L]:i in b&&!(L in b)&&(b[L]=b[i]):(b[L]=F,b[i]=F,F++),p[z][0]>2?R[b[L]]=[-p[z][0],p[z][1],b[L]]:R[b[L]]=[m[p[z][0]],p[z][1],b[L]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let P=0;P<20;P++){if(m=this.IDATA.face[P],g=m[2],W=m[1],Z=m[0],f=e.x+"|"+e.y,L=P+"|"+f,L in b||(b[L]=g,R[g]=[m[p[f][0]],p[f][1]]),f=N.x+"|"+N.y,L=P+"|"+f,L in b||(b[L]=W,R[W]=[m[p[f][0]],p[f][1]]),f=y.x+"|"+y.y,L=P+"|"+f,L in b||(b[L]=Z,R[Z]=[m[p[f][0]],p[f][1]]),z=this.IDATA.edgematch[P][0],t=this.IDATA.edgematch[P][1],"B"===t)for(let F=1;F<q;F++)c.x=Q-F*(G+K),c.y=C+F*G,X.x=-F*K,X.y=F*(G+K),f=c.x+"|"+c.y,k=X.x+"|"+X.y,D(P,z,f,k);if("O"===t)for(let F=1;F<q;F++)X.x=-F*K,X.y=F*(G+K),E.x=F*G,E.y=F*K,f=X.x+"|"+X.y,k=E.x+"|"+E.y,D(P,z,f,k);if(z=this.IDATA.edgematch[P][2],t=this.IDATA.edgematch[P][3],t&&"A"===t)for(let F=1;F<q;F++)E.x=F*G,E.y=F*K,c.x=Q-(q-F)*(G+K),c.y=C+(q-F)*G,f=E.x+"|"+E.y,k=c.x+"|"+c.y,D(P,z,f,k);for(let Q=0;Q<this.vertices.length;Q++)f=this.vertices[Q].x+"|"+this.vertices[Q].y,L=P+"|"+f,L in b||(b[L]=F++,p[f][0]>2?R[b[L]]=[-p[f][0],p[f][1],b[L]]:R[b[L]]=[m[p[f][0]],p[f][1],b[L]])}this.closestTo=R,this.vecToidx=b}calcCoeffs(){const F=this.m,b=this.n,Q=Math.sqrt(3)/3,C=F*F+b*b+F*b;this.coau=(F+b)/C,this.cobu=-b/C,this.coav=-Q*(F-b)/C,this.cobv=Q*(2*F+b)/C}createInnerFacets(){const F=this.m,b=this.n;for(let Q=0;Q<b+F+1;Q++)for(let F=this.min[Q];F<this.max[Q]+1;F++)F<this.max[Q]&&F<this.max[Q+1]+1&&this.innerFacets.push(["|"+F+"|"+Q,"|"+F+"|"+(Q+1),"|"+(F+1)+"|"+Q]),Q>0&&F<this.max[Q-1]&&F+1<this.max[Q]+1&&this.innerFacets.push(["|"+F+"|"+Q,"|"+(F+1)+"|"+Q,"|"+(F+1)+"|"+(Q-1)])}edgeVecsABOB(){const F=this.m,b=this.n,Q=new bF(-b,F+b);for(let C=1;C<F+b;C++){const F=new bF(this.min[C],C),b=new bF(this.min[C-1],C-1),z=new bF(this.min[C+1],C+1),t=F.clone(),g=b.clone(),W=z.clone();t.rotate60About(Q),g.rotate60About(Q),W.rotate60About(Q);const Z=new bF(this.max[t.y],t.y),q=new bF(this.max[t.y-1],t.y-1),G=new bF(this.max[t.y-1]-1,t.y-1);t.x===Z.x&&t.y===Z.y||(t.x!==q.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([F,q,G]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([F,G,Z])):t.y===W.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([F,b,q]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([F,q,z])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([F,b,q]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([F,q,Z])))}}mapABOBtoOBOA(){const F=new bF(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const Q=[];for(let C=0;C<3;C++)F.x=this.isoVecsABOB[b][C].x,F.y=this.isoVecsABOB[b][C].y,0===this.vertexTypes[b][C]&&F.rotateNeg120(this.m,this.n),Q.push(F.clone());this.isoVecsOBOA.push(Q)}}mapABOBtoBAOA(){const F=new bF(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const Q=[];for(let C=0;C<3;C++)F.x=this.isoVecsABOB[b][C].x,F.y=this.isoVecsABOB[b][C].y,1===this.vertexTypes[b][C]&&F.rotate120(this.m,this.n),Q.push(F.clone());this.isoVecsBAOA.push(Q)}}MapToFace(F,b){const Q=this.IDATA.face[F],z=Q[2],t=Q[1],g=Q[0],W=C.gQ.KQ(this.IDATA.vertex[z]),Z=C.gQ.KQ(this.IDATA.vertex[t]),q=C.gQ.KQ(this.IDATA.vertex[g]),G=Z.WQ(W),K=q.WQ(W),e=G.scale(this.coau).add(K.scale(this.cobu)),N=G.scale(this.coav).add(K.scale(this.cobv)),y=[];let E,c=C.TmpVectors.gQ[0];for(let C=0;C<this.cartesian.length;C++)c=e.scale(this.cartesian[C].x).add(N.scale(this.cartesian[C].y)).add(W),y[C]=[c.x,c.y,c.z],E=F+"|"+this.vertices[C].x+"|"+this.vertices[C].y,b.vertex[this.vecToidx[E]]=[c.x,c.y,c.z]}build(F,b){const Q=[],C=bF.Zero(),z=new bF(F,b),t=new bF(-b,F+b);Q.push(C,z,t);for(let f=b;f<F+1;f++)for(let b=0;b<F+1-f;b++)Q.push(new bF(b,f));if(b>0){const C=(0,a.HighestCommonFactor)(F,b),z=F/C,t=b/C;for(let W=1;W<C;W++)Q.push(new bF(W*z,W*t)),Q.push(new bF(-W*t,W*(z+t))),Q.push(new bF(F-W*(z+t),b+W*z));const g=F/b;for(let W=1;W<b;W++)for(let C=0;C<W*g;C++)Q.push(new bF(C,W)),Q.push(new bF(C,W).rotate120(F,b)),Q.push(new bF(C,W).rotateNeg120(F,b))}Q.sort(((F,b)=>F.x-b.x)),Q.sort(((F,b)=>F.y-b.y));const g=new Array(F+b+1),W=new Array(F+b+1);for(let f=0;f<g.length;f++)g[f]=1/0,W[f]=-1/0;let Z=0,q=0;const G=Q.length;for(let f=0;f<G;f++)q=Q[f].x,Z=Q[f].y,g[Z]=Math.min(q,g[Z]),W[Z]=Math.max(q,W[Z]);const K=(Q,C)=>{const z=Q.clone();return"A"===C&&z.rotateNeg120(F,b),"B"===C&&z.rotate120(F,b),z.x<0?z.y:z.x+z.y},e=[],N=[],y=[],E=[],c={},X=[];let L=-1,i=-1;for(let f=0;f<G;f++)e[f]=Q[f].toCartesianOrigin(new bF(0,0),.5),N[f]=K(Q[f],"O"),y[f]=K(Q[f],"A"),E[f]=K(Q[f],"B"),N[f]===y[f]&&y[f]===E[f]?(L=3,i=N[f]):N[f]===y[f]?(L=4,i=N[f]):y[f]===E[f]?(L=5,i=y[f]):E[f]===N[f]&&(L=6,i=N[f]),N[f]<y[f]&&N[f]<E[f]&&(L=2,i=N[f]),y[f]<N[f]&&y[f]<E[f]&&(L=1,i=y[f]),E[f]<y[f]&&E[f]<N[f]&&(L=0,i=E[f]),X.push([L,i,Q[f].x,Q[f].y]);X.sort(((F,b)=>F[2]-b[2])),X.sort(((F,b)=>F[3]-b[3])),X.sort(((F,b)=>F[1]-b[1])),X.sort(((F,b)=>F[0]-b[0]));for(let f=0;f<X.length;f++)c[X[f][2]+"|"+X[f][3]]=[X[f][0],X[f][1],f];return this.m=F,this.n=b,this.vertices=Q,this.vertByDist=c,this.cartesian=e,this.min=g,this.max=W,this}}class CF{constructor(F,b,Q,C){this.name=F,this.category=b,this.vertex=Q,this.face=C}}class zF extends CF{innerToData(F,b){for(let Q=0;Q<b.innerFacets.length;Q++)this.face.push(b.innerFacets[Q].map((Q=>b.vecToidx[F+Q])))}mapABOBtoDATA(F,b){const Q=b.IDATA.edgematch[F][0];for(let C=0;C<b.isoVecsABOB.length;C++){const z=[];for(let t=0;t<3;t++)0===b.vertexTypes[C][t]?z.push(F+"|"+b.isoVecsABOB[C][t].x+"|"+b.isoVecsABOB[C][t].y):z.push(Q+"|"+b.isoVecsABOB[C][t].x+"|"+b.isoVecsABOB[C][t].y);this.face.push([b.vecToidx[z[0]],b.vecToidx[z[1]],b.vecToidx[z[2]]])}}mapOBOAtoDATA(F,b){const Q=b.IDATA.edgematch[F][0];for(let C=0;C<b.isoVecsOBOA.length;C++){const z=[];for(let t=0;t<3;t++)1===b.vertexTypes[C][t]?z.push(F+"|"+b.isoVecsOBOA[C][t].x+"|"+b.isoVecsOBOA[C][t].y):z.push(Q+"|"+b.isoVecsOBOA[C][t].x+"|"+b.isoVecsOBOA[C][t].y);this.face.push([b.vecToidx[z[0]],b.vecToidx[z[1]],b.vecToidx[z[2]]])}}mapBAOAtoDATA(F,b){const Q=b.IDATA.edgematch[F][2];for(let C=0;C<b.isoVecsBAOA.length;C++){const z=[];for(let t=0;t<3;t++)1===b.vertexTypes[C][t]?z.push(F+"|"+b.isoVecsBAOA[C][t].x+"|"+b.isoVecsBAOA[C][t].y):z.push(Q+"|"+b.isoVecsBAOA[C][t].x+"|"+b.isoVecsBAOA[C][t].y);this.face.push([b.vecToidx[z[0]],b.vecToidx[z[1]],b.vecToidx[z[2]]])}}orderData(F){const b=[];for(let t=0;t<13;t++)b[t]=[];const Q=F.closestTo;for(let t=0;t<Q.length;t++)Q[t][0]>-1?Q[t][1]>0&&b[Q[t][0]].push([t,Q[t][1]]):b[12].push([t,Q[t][0]]);const C=[];for(let t=0;t<12;t++)C[t]=t;let z=12;for(let t=0;t<12;t++){b[t].sort(((F,b)=>F[1]-b[1]));for(let F=0;F<b[t].length;F++)C[b[t][F][0]]=z++}for(let t=0;t<b[12].length;t++)C[b[12][t][0]]=z++;for(let t=0;t<this.vertex.length;t++)this.vertex[t].push(C[t]);this.vertex.sort(((F,b)=>F[3]-b[3]));for(let t=0;t<this.vertex.length;t++)this.vertex[t].pop();for(let t=0;t<this.face.length;t++)for(let F=0;F<this.face[t].length;F++)this.face[t][F]=C[this.face[t][F]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(F,b){const Q=[],C=[];let z=b.pop();C.push(z);let t=this.face[z].indexOf(F);t=(t+2)%3;let g=this.face[z][t];Q.push(g);let W=0;for(;b.length>0;)z=b[W],this.face[z].indexOf(g)>-1?(t=(this.face[z].indexOf(g)+1)%3,g=this.face[z][t],Q.push(g),C.push(z),b.splice(W,1),W=0):W++;return this.adjacentFaces.push(Q),C}toGoldbergPolyhedronData(){const F=new CF("GeoDual","Goldberg",[],[]);F.name="GD dual";const b=this.vertex.length,Q=new Array(b);for(let Z=0;Z<b;Z++)Q[Z]=[];for(let Z=0;Z<this.face.length;Z++)for(let F=0;F<3;F++)Q[this.face[Z][F]].push(Z);let C=0,z=0,t=0,g=[],W=[];this.adjacentFaces=[];for(let Z=0;Z<Q.length;Z++){F.face[Z]=this.setOrder(Z,Q[Z].concat([]));for(const b of Q[Z]){C=0,z=0,t=0,g=this.face[b];for(let F=0;F<3;F++)W=this.vertex[g[F]],C+=W[0],z+=W[1],t+=W[2];F.vertex[b]=[C/3,z/3,t/3]}}return F}static BuildGeodesicData(F){const b=new zF("Geodesic-m-n","Geodesic",[[0,FF.e,-1],[-FF.e,1,0],[-1,0,-FF.e],[1,0,-FF.e],[FF.e,1,0],[0,FF.e,1],[-1,0,FF.e],[-FF.e,-1,0],[0,-FF.e,-1],[FF.e,-1,0],[1,0,FF.e],[0,-FF.e,1]],[]);F.setIndices(),F.calcCoeffs(),F.createInnerFacets(),F.edgeVecsABOB(),F.mapABOBtoOBOA(),F.mapABOBtoBAOA();for(let Q=0;Q<F.IDATA.face.length;Q++)F.MapToFace(Q,b),b.innerToData(Q,F),"B"===F.IDATA.edgematch[Q][1]&&b.mapABOBtoDATA(Q,F),"O"===F.IDATA.edgematch[Q][1]&&b.mapOBOAtoDATA(Q,F),"A"===F.IDATA.edgematch[Q][3]&&b.mapBAOAtoDATA(Q,F);b.orderData(F);return b.vertex=b.vertex.map((function(F){const b=F[0],Q=F[1],C=F[2],z=Math.sqrt(b*b+Q*Q+C*C);return F[0]*=1/z,F[1]*=1/z,F[2]*=1/z,F})),b}}z.b._GoldbergMeshParser=(F,b)=>tF.Parse(F,b);class tF extends z.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(F,b){return void 0===b?(F>this.goldbergData.nbUnsharedFaces-1&&(d.e.Warn("Maximum number of unshared faces used"),F=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+F):(F>11&&(d.e.Warn("Last pole used"),F=11),b>this.goldbergData.nbFacesAtPole-1&&(d.e.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+F*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(F){for(let Q=0;Q<F.length;Q++){const b=F[Q][0],C=F[Q][1],z=F[Q][2];for(let F=b;F<C+1;F++)this.goldbergData.faceColors[F]=z}const b=[];for(let Q=0;Q<12;Q++)for(let F=0;F<5;F++)b.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);for(let Q=12;Q<this.goldbergData.faceColors.length;Q++)for(let F=0;F<6;F++)b.push(this.goldbergData.faceColors[Q].r,this.goldbergData.faceColors[Q].g,this.goldbergData.faceColors[Q].b,this.goldbergData.faceColors[Q].a);return b}setGoldbergFaceColors(F){const b=this._changeGoldbergFaceColors(F);this.lF(t.e.ColorKind,b)}updateGoldbergFaceColors(F){const b=this._changeGoldbergFaceColors(F);this.updateVerticesData(t.e.ColorKind,b)}_changeGoldbergFaceUVs(F){const b=this.getVerticesData(t.e.UVKind);for(let Q=0;Q<F.length;Q++){const C=F[Q][0],z=F[Q][1],t=F[Q][2],g=F[Q][3],W=F[Q][4],Z=[],q=[];let G,K;for(let F=0;F<5;F++)G=t.x+g*Math.cos(W+F*Math.PI/2.5),K=t.y+g*Math.sin(W+F*Math.PI/2.5),G<0&&(G=0),G>1&&(G=1),Z.push(G,K);for(let F=0;F<6;F++)G=t.x+g*Math.cos(W+F*Math.PI/3),K=t.y+g*Math.sin(W+F*Math.PI/3),G<0&&(G=0),G>1&&(G=1),q.push(G,K);for(let F=C;F<Math.min(12,z+1);F++)for(let Q=0;Q<5;Q++)b[10*F+2*Q]=Z[2*Q],b[10*F+2*Q+1]=Z[2*Q+1];for(let F=Math.max(12,C);F<z+1;F++)for(let Q=0;Q<6;Q++)b[12*F-24+2*Q]=q[2*Q],b[12*F-23+2*Q]=q[2*Q+1]}return b}setGoldbergFaceUVs(F){const b=this._changeGoldbergFaceUVs(F);this.lF(t.e.UVKind,b)}updateGoldbergFaceUVs(F){const b=this._changeGoldbergFaceUVs(F);this.updateVerticesData(t.e.UVKind,b)}placeOnGoldbergFaceAt(F,b,Q){const z=C.gQ.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);F.rotation=z,F.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(Q.x)).add(this.goldbergData.faceYaxis[b].scale(Q.y)).add(this.goldbergData.faceZaxis[b].scale(Q.z))}serialize(F){super.serialize(F),F.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const F of this.goldbergData.faceColors)b.faceColors.push(F.Lb())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const F of this.goldbergData.faceCenters)b.faceCenters.push(F.Lb())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const F of this.goldbergData.faceZaxis)b.faceZaxis.push(F.Lb())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const F of this.goldbergData.faceYaxis)b.faceYaxis.push(F.Lb())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const F of this.goldbergData.faceXaxis)b.faceXaxis.push(F.Lb())}F.goldbergData=b}static Parse(F,b){const Q=F.goldbergData;Q.faceColors=Q.faceColors.map((F=>e.sb.KQ(F))),Q.faceCenters=Q.faceCenters.map((F=>C.gQ.KQ(F))),Q.faceZaxis=Q.faceZaxis.map((F=>C.gQ.KQ(F))),Q.faceXaxis=Q.faceXaxis.map((F=>C.gQ.KQ(F))),Q.faceYaxis=Q.faceYaxis.map((F=>C.gQ.KQ(F)));const z=new tF(F.name,b);return z.goldbergData=Q,z}}var gF=Q(11840);const WF={CreateBox:K.e,CreateTiledBox:c,CreateSphere:X.e,CreateDisc:G.e,CreateIcoSphere:x,CreateRibbon:q,CreateCylinder:k,CreateTorus:R,CreateTorusKnot:D,CreateLineSystem:P.f,uq:P.i,CreateDashedLines:P.e,ExtrudeShape:w,ExtrudeShapeCustom:Y,CreateLathe:V,CreateTiledPlane:y,Iq:h.d,CreateGround:l.e,CreateTiledGround:l.i,CreateGroundFromHeightMap:l.c,CreatePolygon:n.e,ExtrudePolygon:n.f,CreateTube:T,CreatePolyhedron:S,CreateGeodesic:function(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=b.m||1;C!==Math.floor(C)&&(C=Math.floor(C),d.e.Warn("m not an integer only floor(m) used"));let z=b.n||0;if(z!==Math.floor(z)&&(z=Math.floor(z),d.e.Warn("n not an integer only floor(n) used")),z>C){const F=z;z=C,C=F,d.e.Warn("n > m therefore m and n swapped")}const t=new QF;return t.build(C,z),S(F,{custom:zF.BuildGeodesicData(t),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},Q)},CreateGoldberg:function(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const t=b.size,Z=b.sizeX||t||1,q=b.sizeY||t||1,G=b.sizeZ||t||1;let K=b.m||1;K!==Math.floor(K)&&(K=Math.floor(K),d.e.Warn("m not an integer only floor(m) used"));let N=b.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),d.e.Warn("n not an integer only floor(n) used")),N>K){const F=N;N=K,K=F,d.e.Warn("n > m therefore m and n swapped")}const y=new QF;y.build(K,N);const E=zF.BuildGeodesicData(y),c=E.toGoldbergPolyhedronData(),X=new tF(F,Q);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),X._originalBuilderSideOrientation=b.sideOrientation;(function(F,b){const Q=F.size,z=F.sizeX||Q||1,t=F.sizeY||Q||1,Z=F.sizeZ||Q||1,q=0===F.sideOrientation?0:F.sideOrientation||g.d.DEFAULTSIDE,G=[],K=[],e=[],N=[];let y=1/0,E=-1/0,c=1/0,X=-1/0;for(let C=0;C<b.vertex.length;C++)y=Math.min(y,b.vertex[C][0]*z),E=Math.max(E,b.vertex[C][0]*z),c=Math.min(c,b.vertex[C][1]*t),X=Math.max(X,b.vertex[C][1]*t);let L=0;for(let g=0;g<b.face.length;g++){const F=b.face[g],Q=C.gQ.KQ(b.vertex[F[0]]),q=C.gQ.KQ(b.vertex[F[2]]),i=C.gQ.KQ(b.vertex[F[1]]),f=q.WQ(Q),k=i.WQ(Q),m=C.gQ.Cross(k,f).normalize();for(let C=0;C<F.length;C++){e.push(m.x,m.y,m.z);const Q=b.vertex[F[C]];G.push(Q[0]*z,Q[1]*t,Q[2]*Z);const g=(Q[1]*t-c)/(X-c);N.push((Q[0]*z-y)/(E-y),W.b?1-g:g)}for(let b=0;b<F.length-2;b++)K.push(L,L+b+2,L+b+1);L+=F.length}g.d._ComputeSides(q,G,K,e,N);const i=new g.d;return i.DF=G,i.indices=K,i.PF=e,i.jF=N,i})(b,c).YF(X,b.updatable),X.goldbergData.nbSharedFaces=E.sharedNodes,X.goldbergData.nbUnsharedFaces=E.poleNodes,X.goldbergData.adjacentFaces=E.adjacentFaces,X.goldbergData.nbFaces=X.goldbergData.nbSharedFaces+X.goldbergData.nbUnsharedFaces,X.goldbergData.nbFacesAtPole=(X.goldbergData.nbUnsharedFaces-12)/12;for(let z=0;z<E.vertex.length;z++)X.goldbergData.faceCenters.push(C.gQ.KQ(E.vertex[z])),X.goldbergData.faceCenters[z].x*=Z,X.goldbergData.faceCenters[z].y*=q,X.goldbergData.faceCenters[z].z*=G,X.goldbergData.faceColors.push(new e.sb(1,1,1,1));for(let z=0;z<c.face.length;z++){const F=c.face[z],b=C.gQ.KQ(c.vertex[F[0]]),Q=C.gQ.KQ(c.vertex[F[2]]),t=C.gQ.KQ(c.vertex[F[1]]),g=Q.WQ(b),W=t.WQ(b),Z=C.gQ.Cross(W,g).normalize(),q=C.gQ.Cross(W,Z).normalize();X.goldbergData.faceXaxis.push(W.normalize()),X.goldbergData.faceYaxis.push(Z),X.goldbergData.faceZaxis.push(q)}return X},CreateDecal:r,CreateCapsule:B,CreateText:gF.c}},12555:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>Wb});var C=Q(11309),z=Q(11673);class t extends z.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var g=Q(11359),W=(Q(11490),Q(11265));class Z{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(F){this._targetStopDuration!==F&&(this._targetStopDuration=F)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(F){this._noiseTexture!==F&&(this._noiseTexture=F,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(F){this._animationSheetEnabled!==F&&(this._animationSheetEnabled=F)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(F){this._isAnimationSheetEnabled!=F&&(this._isAnimationSheetEnabled=F,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(F){this._useLogarithmicDepth=F&&this.RF().getEngine().getCaps().fragmentDepthSupported}RF(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(F){switch(F){case Z.BLENDMODE_MULTIPLYADD:return;case Z.BLENDMODE_ADD:F=1;break;case Z.BLENDMODE_ONEONE:F=6;break;case Z.BLENDMODE_STANDARD:F=2;break;case Z.BLENDMODE_MULTIPLY:F=4;break;case Z.BLENDMODE_SUBTRACT:F=3}this._engine.setAlphaMode(F)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:C.gQ.Zero()}set direction1(F){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=F)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:C.gQ.Zero()}set direction2(F){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=F)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:C.gQ.Zero()}set minEmitBox(F){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=F)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:C.gQ.Zero()}set maxEmitBox(F){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=F)}get billboardMode(){return this._billboardMode}set billboardMode(F){this._billboardMode!==F&&(this._billboardMode=F,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(F){this._isBillboardBased!==F&&(this._isBillboardBased=F,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(F){this._attachImageProcessingConfiguration(F)}_attachImageProcessingConfiguration(F){F!==this._imageProcessingConfiguration&&(!F&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=F)}_reset(){}_removeGradientAndTexture(F,b,Q){if(!b)return this;let C=0;for(const z of b){if(z.gradient===F){b.splice(C,1);break}C++}return Q&&Q.dispose(),this}constructor(F){this.animations=[],this.renderingGroupId=0,this.Cb=C.gQ.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new C.gQ(10,10,10),this.onAnimationEnd=null,this.blendMode=Z.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new C.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.aq=new C.gQ(0,0,0),this._useLogarithmicDepth=!1,this.gravity=C.gQ.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new g.sb(1,1,1,1),this.color2=new g.sb(1,1,1,1),this.colorDead=new g.sb(0,0,0,1),this.textureMask=new g.sb(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new t,this.id=F,this.name=F}createPointEmitter(F,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new C.gQ(0,1,0),arguments.length>2&&void 0!==arguments[2]||new C.gQ(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new C.gQ(0,1,0),arguments.length>4&&void 0!==arguments[4]||new C.gQ(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new C.gQ(0,1,0),arguments.length>3&&void 0!==arguments[3]||new C.gQ(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(F,b,Q,C){throw new Error("Method not implemented.")}}Z.BLENDMODE_ONEONE=0,Z.BLENDMODE_STANDARD=1,Z.BLENDMODE_ADD=2,Z.BLENDMODE_MULTIPLY=3,Z.BLENDMODE_MULTIPLYADD=4,Z.BLENDMODE_SUBTRACT=-1,(0,W.g)("BABYLON.BaseParticleSystem",Z);var q=Q(11329),G=Q(11148);class K{constructor(){this.direction1=new C.gQ(0,1,0),this.direction2=new C.gQ(0,1,0),this.minEmitBox=new C.gQ(-.5,-.5,-.5),this.maxEmitBox=new C.gQ(.5,.5,.5)}startDirectionFunction(F,b,Q,z){const t=(0,q.RandomRange)(this.direction1.x,this.direction2.x),g=(0,q.RandomRange)(this.direction1.y,this.direction2.y),W=(0,q.RandomRange)(this.direction1.z,this.direction2.z);if(z)return b.x=t,b.y=g,void(b.z=W);C.gQ.TransformNormalFromFloatsToRef(t,g,W,F,b)}startPositionFunction(F,b,Q,z){const t=(0,q.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),g=(0,q.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),W=(0,q.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(z)return b.x=t,b.y=g,void(b.z=W);C.gQ.TransformCoordinatesFromFloatsToRef(t,g,W,F,b)}clone(){const F=new K;return G.d.DeepCopy(this,F),F}applyToShader(F){F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2),F.setVector3("minEmitBox",this.minEmitBox),F.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(F){F.addUniform("direction1",3),F.addUniform("direction2",3),F.addUniform("minEmitBox",3),F.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.direction1=this.direction1.Lb(),F.direction2=this.direction2.Lb(),F.minEmitBox=this.minEmitBox.Lb(),F.maxEmitBox=this.maxEmitBox.Lb(),F}parse(F){C.gQ.FromArrayToRef(F.direction1,0,this.direction1),C.gQ.FromArrayToRef(F.direction2,0,this.direction2),C.gQ.FromArrayToRef(F.minEmitBox,0,this.minEmitBox),C.gQ.FromArrayToRef(F.maxEmitBox,0,this.maxEmitBox)}}class e{get radius(){return this._radius}set radius(F){this._radius=F,this._buildHeight()}get angle(){return this._angle}set angle(F){this._angle=F,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=Q,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=F}startDirectionFunction(F,b,Q,z){z?C.TmpVectors.gQ[0].W(Q.iZ).normalize():Q.position.subtractToRef(F.getTranslation(),C.TmpVectors.gQ[0]).normalize();const t=(0,q.RandomRange)(0,this.directionRandomizer),g=(0,q.RandomRange)(0,this.directionRandomizer),W=(0,q.RandomRange)(0,this.directionRandomizer);b.x=C.TmpVectors.gQ[0].x+t,b.y=C.TmpVectors.gQ[0].y+g,b.z=C.TmpVectors.gQ[0].z+W,b.normalize()}startPositionFunction(F,b,Q,z){const t=(0,q.RandomRange)(0,2*Math.PI);let g;this.emitFromSpawnPointOnly?g=1e-4:(g=(0,q.RandomRange)(0,this.heightRange),g=1-g*g);let W=this._radius-(0,q.RandomRange)(0,this._radius*this.radiusRange);W*=g;const Z=W*Math.sin(t),G=W*Math.cos(t),K=g*this._height;if(z)return b.x=Z,b.y=K,void(b.z=G);C.gQ.TransformCoordinatesFromFloatsToRef(Z,K,G,F,b)}clone(){const F=new e(this._radius,this._angle,this.directionRandomizer);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setFloat2("radius",this._radius,this.radiusRange),F.setFloat("coneAngle",this._angle),F.setFloat2("height",this._height,this.heightRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",2),F.addUniform("coneAngle",1),F.addUniform("height",2),F.addUniform("directionRandomizer",1)}getEffectDefines(){let F="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(F+="\n#define CONEEMITTERSPAWNPOINT"),F}getClassName(){return"ConeParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this._radius,F.angle=this._angle,F.directionRandomizer=this.directionRandomizer,F.radiusRange=this.radiusRange,F.heightRange=this.heightRange,F.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,F}parse(F){this.radius=F.radius,this.angle=F.angle,this.directionRandomizer=F.directionRandomizer,this.radiusRange=void 0!==F.radiusRange?F.radiusRange:1,this.heightRange=void 0!==F.radiusRange?F.heightRange:1,this.emitFromSpawnPointOnly=void 0!==F.emitFromSpawnPointOnly&&F.emitFromSpawnPointOnly}}class N extends e{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0);super(F,b),this.direction1=Q,this.direction2=z}startDirectionFunction(F,b){const Q=(0,q.RandomRange)(this.direction1.x,this.direction2.x),z=(0,q.RandomRange)(this.direction1.y,this.direction2.y),t=(0,q.RandomRange)(this.direction1.z,this.direction2.z);C.gQ.TransformNormalFromFloatsToRef(Q,z,t,F,b)}clone(){const F=new N(this.radius,this.angle,this.direction1,this.direction2);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const F=super.serialize();return F.direction1=this.direction1.Lb(),F.direction2=this.direction2.Lb(),F}parse(F){super.parse(F),this.direction1.W(F.direction1),this.direction2.W(F.direction2)}}class y{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=F,this.height=b,this.radiusRange=Q,this.directionRandomizer=z,this._tempVector=C.gQ.Zero()}startDirectionFunction(F,b,Q,z,t){Q.position.subtractToRef(F.getTranslation(),this._tempVector),this._tempVector.normalize(),C.gQ.TransformNormalToRef(this._tempVector,t,this._tempVector);const g=(0,q.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let W=Math.atan2(this._tempVector.x,this._tempVector.z);W+=(0,q.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=g,this._tempVector.x=Math.sin(W),this._tempVector.z=Math.cos(W),this._tempVector.normalize(),z?b.W(this._tempVector):C.gQ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,F,b)}startPositionFunction(F,b,Q,z){const t=(0,q.RandomRange)(-this.height/2,this.height/2),g=(0,q.RandomRange)(0,2*Math.PI),W=(0,q.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),Z=Math.sqrt(W)*this.radius,G=Z*Math.cos(g),K=Z*Math.sin(g);z?b.jb(G,t,K):C.gQ.TransformCoordinatesFromFloatsToRef(G,t,K,F,b)}clone(){const F=new y(this.radius,this.directionRandomizer);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("height",this.height),F.setFloat("radiusRange",this.radiusRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("height",1),F.addUniform("radiusRange",1),F.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this.radius,F.height=this.height,F.radiusRange=this.radiusRange,F.directionRandomizer=this.directionRandomizer,F}parse(F){this.radius=F.radius,this.height=F.height,this.radiusRange=F.radiusRange,this.directionRandomizer=F.directionRandomizer}}class E extends y{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.gQ(0,1,0);super(F,b,Q),this.direction1=z,this.direction2=t}startDirectionFunction(F,b,Q,z){const t=(0,q.RandomRange)(this.direction1.x,this.direction2.x),g=(0,q.RandomRange)(this.direction1.y,this.direction2.y),W=(0,q.RandomRange)(this.direction1.z,this.direction2.z);z?b.jb(t,g,W):C.gQ.TransformNormalFromFloatsToRef(t,g,W,F,b)}clone(){const F=new E(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("height",this.height),F.setFloat("radiusRange",this.radiusRange),F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("height",1),F.addUniform("radiusRange",1),F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const F=super.serialize();return F.direction1=this.direction1.Lb(),F.direction2=this.direction2.Lb(),F}parse(F){super.parse(F),C.gQ.FromArrayToRef(F.direction1,0,this.direction1),C.gQ.FromArrayToRef(F.direction2,0,this.direction2)}}class c{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=F,this.radiusRange=b,this.directionRandomizer=Q}startDirectionFunction(F,b,Q,z){const t=Q.position.WQ(F.getTranslation()).normalize(),g=(0,q.RandomRange)(0,this.directionRandomizer),W=(0,q.RandomRange)(0,this.directionRandomizer),Z=(0,q.RandomRange)(0,this.directionRandomizer);t.x+=g,t.y+=W,t.z+=Z,t.normalize(),z?b.W(t):C.gQ.TransformNormalFromFloatsToRef(t.x,t.y,t.z,F,b)}startPositionFunction(F,b,Q,z){const t=this.radius-(0,q.RandomRange)(0,this.radius*this.radiusRange),g=(0,q.RandomRange)(0,1),W=(0,q.RandomRange)(0,2*Math.PI),Z=Math.acos(2*g-1),G=t*Math.cos(W)*Math.sin(Z),K=t*Math.cos(Z),e=t*Math.sin(W)*Math.sin(Z);z?b.jb(G,Math.abs(K),e):C.gQ.TransformCoordinatesFromFloatsToRef(G,Math.abs(K),e,F,b)}clone(){const F=new c(this.radius,this.directionRandomizer);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this.radius,F.radiusRange=this.radiusRange,F.directionRandomizer=this.directionRandomizer,F}parse(F){this.radius=F.radius,this.radiusRange=F.radiusRange,this.directionRandomizer=F.directionRandomizer}}class X{constructor(){this.direction1=new C.gQ(0,1,0),this.direction2=new C.gQ(0,1,0)}startDirectionFunction(F,b,Q,z){const t=(0,q.RandomRange)(this.direction1.x,this.direction2.x),g=(0,q.RandomRange)(this.direction1.y,this.direction2.y),W=(0,q.RandomRange)(this.direction1.z,this.direction2.z);z?b.jb(t,g,W):C.gQ.TransformNormalFromFloatsToRef(t,g,W,F,b)}startPositionFunction(F,b,Q,z){z?b.jb(0,0,0):C.gQ.TransformCoordinatesFromFloatsToRef(0,0,0,F,b)}clone(){const F=new X;return G.d.DeepCopy(this,F),F}applyToShader(F){F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.direction1=this.direction1.Lb(),F.direction2=this.direction2.Lb(),F}parse(F){C.gQ.FromArrayToRef(F.direction1,0,this.direction1),C.gQ.FromArrayToRef(F.direction2,0,this.direction2)}}class L{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=F,this.radiusRange=b,this.directionRandomizer=Q}startDirectionFunction(F,b,Q,z){const t=Q.position.WQ(F.getTranslation()).normalize(),g=(0,q.RandomRange)(0,this.directionRandomizer),W=(0,q.RandomRange)(0,this.directionRandomizer),Z=(0,q.RandomRange)(0,this.directionRandomizer);t.x+=g,t.y+=W,t.z+=Z,t.normalize(),z?b.W(t):C.gQ.TransformNormalFromFloatsToRef(t.x,t.y,t.z,F,b)}startPositionFunction(F,b,Q,z){const t=this.radius-(0,q.RandomRange)(0,this.radius*this.radiusRange),g=(0,q.RandomRange)(0,1),W=(0,q.RandomRange)(0,2*Math.PI),Z=Math.acos(2*g-1),G=t*Math.cos(W)*Math.sin(Z),K=t*Math.cos(Z),e=t*Math.sin(W)*Math.sin(Z);z?b.jb(G,K,e):C.gQ.TransformCoordinatesFromFloatsToRef(G,K,e,F,b)}clone(){const F=new L(this.radius,this.directionRandomizer);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.radius=this.radius,F.radiusRange=this.radiusRange,F.directionRandomizer=this.directionRandomizer,F}parse(F){this.radius=F.radius,this.radiusRange=F.radiusRange,this.directionRandomizer=F.directionRandomizer}}class i extends L{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.gQ(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0);super(F),this.direction1=b,this.direction2=Q}startDirectionFunction(F,b){const Q=(0,q.RandomRange)(this.direction1.x,this.direction2.x),z=(0,q.RandomRange)(this.direction1.y,this.direction2.y),t=(0,q.RandomRange)(this.direction1.z,this.direction2.z);C.gQ.TransformNormalFromFloatsToRef(Q,z,t,F,b)}clone(){const F=new i(this.radius,this.direction1,this.direction2);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setFloat("radius",this.radius),F.setFloat("radiusRange",this.radiusRange),F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("radius",1),F.addUniform("radiusRange",1),F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const F=super.serialize();return F.direction1=this.direction1.Lb(),F.direction2=this.direction2.Lb(),F}parse(F){super.parse(F),this.direction1.W(F.direction1),this.direction2.W(F.direction2)}}class f{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(F,b,Q,z){const t=C.TmpVectors.gQ[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,Q,t);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,Q,t);const F=C.TmpVectors.gQ[1];t.subtractToRef(Q.position,F),F.scaleToRef(1/Q.lifeTime,t)}else t.set(0,0,0);z?b.W(t):C.gQ.TransformNormalToRef(t,F,b)}startPositionFunction(F,b,Q,z){const t=C.TmpVectors.gQ[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,Q,t):t.set(0,0,0),z?b.W(t):C.gQ.TransformCoordinatesToRef(t,F,b)}clone(){const F=new f;return G.d.DeepCopy(this,F),F}applyToShader(F){}buildUniformLayout(F){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const F={};return F.type=this.getClassName(),F.particlePositionGenerator=this.particlePositionGenerator,F.particleDestinationGenerator=this.particleDestinationGenerator,F}parse(F){F.particlePositionGenerator&&(this.particlePositionGenerator=F.particlePositionGenerator),F.particleDestinationGenerator&&(this.particleDestinationGenerator=F.particleDestinationGenerator)}}var k=Q(11372);class m{get mesh(){return this._mesh}set mesh(F){this._mesh!==F&&(this._mesh=F,F?(this._indices=F.Pb(),this._positions=F.getVerticesData(k.e.PositionKind),this._normals=F.getVerticesData(k.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=C.gQ.Zero(),this._mesh=null,this.direction1=new C.gQ(0,1,0),this.direction2=new C.gQ(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=F}startDirectionFunction(F,b,Q,z){if(this.useMeshNormalsForDirection&&this._normals)return void C.gQ.TransformNormalToRef(this._storedNormal,F,b);const t=(0,q.RandomRange)(this.direction1.x,this.direction2.x),g=(0,q.RandomRange)(this.direction1.y,this.direction2.y),W=(0,q.RandomRange)(this.direction1.z,this.direction2.z);z?b.jb(t,g,W):C.gQ.TransformNormalFromFloatsToRef(t,g,W,F,b)}startPositionFunction(F,b,Q,z){if(!this._indices||!this._positions)return;const t=3*(Math.random()*(this._indices.length/3)|0),g=Math.random(),W=Math.random()*(1-g),Z=1-g-W,q=this._indices[t],G=this._indices[t+1],K=this._indices[t+2],e=C.TmpVectors.gQ[0],N=C.TmpVectors.gQ[1],y=C.TmpVectors.gQ[2],E=C.TmpVectors.gQ[3];C.gQ.FromArrayToRef(this._positions,3*q,e),C.gQ.FromArrayToRef(this._positions,3*G,N),C.gQ.FromArrayToRef(this._positions,3*K,y),E.x=g*e.x+W*N.x+Z*y.x,E.y=g*e.y+W*N.y+Z*y.y,E.z=g*e.z+W*N.z+Z*y.z,z?b.jb(E.x,E.y,E.z):C.gQ.TransformCoordinatesFromFloatsToRef(E.x,E.y,E.z,F,b),this.useMeshNormalsForDirection&&this._normals&&(C.gQ.FromArrayToRef(this._normals,3*q,e),C.gQ.FromArrayToRef(this._normals,3*G,N),C.gQ.FromArrayToRef(this._normals,3*K,y),this._storedNormal.x=g*e.x+W*N.x+Z*y.x,this._storedNormal.y=g*e.y+W*N.y+Z*y.y,this._storedNormal.z=g*e.z+W*N.z+Z*y.z)}clone(){const F=new m(this.mesh);return G.d.DeepCopy(this,F),F}applyToShader(F){F.setVector3("direction1",this.direction1),F.setVector3("direction2",this.direction2)}buildUniformLayout(F){F.addUniform("direction1",3),F.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var F;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.Lb(),b.direction2=this.direction2.Lb(),b.meshId=null===(F=this.mesh)||void 0===F?void 0:F.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(F,b){C.gQ.FromArrayToRef(F.direction1,0,this.direction1),C.gQ.FromArrayToRef(F.direction2,0,this.direction2),F.meshId&&b&&(this.mesh=b.getLastMeshById(F.meshId)),this.useMeshNormalsForDirection=F.useMeshNormalsForDirection}}class R{_isUbo(F){return void 0!==F.addUniform}constructor(F){this._isUbo(F)?(this.setMatrix3x3=F.updateMatrix3x3.bind(F),this.setMatrix2x2=F.updateMatrix2x2.bind(F),this.setFloat=F.updateFloat.bind(F),this.setFloat2=F.updateFloat2.bind(F),this.setFloat3=F.updateFloat3.bind(F),this.setFloat4=F.updateFloat4.bind(F),this.setFloatArray=F.updateFloatArray.bind(F),this.setArray=F.updateArray.bind(F),this.setIntArray=F.updateIntArray.bind(F),this.setMatrix=F.mb.bind(F),this.setMatrices=F.updateMatrices.bind(F),this.setVector3=F.updateVector3.bind(F),this.setVector4=F.updateVector4.bind(F),this.setColor3=F.updateColor3.bind(F),this.setColor4=F.updateColor4.bind(F),this.setDirectColor4=F.updateDirectColor4.bind(F),this.setInt=F.updateInt.bind(F),this.setInt2=F.updateInt2.bind(F),this.setInt3=F.updateInt3.bind(F),this.setInt4=F.updateInt4.bind(F)):(this.setMatrix3x3=F.setMatrix3x3.bind(F),this.setMatrix2x2=F.setMatrix2x2.bind(F),this.setFloat=F.setFloat.bind(F),this.setFloat2=F.setFloat2.bind(F),this.setFloat3=F.setFloat3.bind(F),this.setFloat4=F.setFloat4.bind(F),this.setFloatArray=F.setFloatArray.bind(F),this.setArray=F.setArray.bind(F),this.setIntArray=F.setIntArray.bind(F),this.setMatrix=F.setMatrix.bind(F),this.setMatrices=F.setMatrices.bind(F),this.setVector3=F.setVector3.bind(F),this.setVector4=F.setVector4.bind(F),this.setColor3=F.setColor3.bind(F),this.setColor4=F.setColor4.bind(F),this.setDirectColor4=F.setDirectColor4.bind(F),this.setInt=F.setInt.bind(F),this.setInt2=F.setInt2.bind(F),this.setInt3=F.setInt3.bind(F),this.setInt4=F.setInt4.bind(F))}}var p=Q(11219);const D="gpuUpdateParticlesPixelShader",P="#version 300 es\nvoid main() {discard;}\n";p.e.ShadersStore[D]||(p.e.ShadersStore[D]=P);const n="gpuUpdateParticlesVertexShader",j="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";p.e.ShadersStore[n]||(p.e.ShadersStore[n]=j);(0,W.g)("BABYLON.WebGL2ParticleSystem",class{constructor(F,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=F,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var F;return(null===(F=this._updateEffect)||void 0===F?void 0:F.isReady())??!1}createUpdateBuffer(F){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof f&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=F,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new R(this._updateEffect)}createVertexBuffers(F,b){this._updateVAO.push(this._createUpdateVAO(F)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(F){return F}bindDrawBuffers(F,b,Q){Q?this._engine.bindBuffers(this._renderVertexBuffers,Q,b):this._engine.bindVertexArrayObject(this._renderVAO[F],null)}preUpdateParticleBuffer(){const F=this._engine;if(this._engine.enableEffect(this._updateEffect),!F.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(F,b,Q){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[F],null);const C=this._engine;C.bindTransformFeedbackBuffer(b.getBuffer()),C.setRasterizerState(!1),C.beginTransformFeedback(!0),C.drawArraysType(3,0,Q),C.endTransformFeedback(),C.setRasterizerState(!0),C.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let F=0;F<this._updateVAO.length;F++)this._engine.releaseVertexArrayObject(this._updateVAO[F]);this._updateVAO.length=0;for(let F=0;F<this._renderVAO.length;F++)this._engine.releaseVertexArrayObject(this._renderVAO[F]);this._renderVAO.length=0}_createUpdateVAO(F){const b={};b.position=F.createVertexBuffer("position",0,3);let Q=3;b.age=F.createVertexBuffer("age",Q,1),Q+=1,b.size=F.createVertexBuffer("size",Q,3),Q+=3,b.life=F.createVertexBuffer("life",Q,1),Q+=1,b.seed=F.createVertexBuffer("seed",Q,4),Q+=4,b.direction=F.createVertexBuffer("direction",Q,3),Q+=3,this._parent.particleEmitterType instanceof f&&(b.initialPosition=F.createVertexBuffer("initialPosition",Q,3),Q+=3),this._parent._colorGradientsTexture||(b.color=F.createVertexBuffer("color",Q,4),Q+=4),this._parent._isBillboardBased||(b.initialDirection=F.createVertexBuffer("initialDirection",Q,3),Q+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=F.createVertexBuffer("noiseCoordinates1",Q,3),Q+=3,b.noiseCoordinates2=F.createVertexBuffer("noiseCoordinates2",Q,3),Q+=3),this._parent._angularSpeedGradientsTexture?(b.angle=F.createVertexBuffer("angle",Q,1),Q+=1):(b.angle=F.createVertexBuffer("angle",Q,2),Q+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=F.createVertexBuffer("cellIndex",Q,1),Q+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=F.createVertexBuffer("cellStartOffset",Q,1),Q+=1));const C=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),C}});class w{constructor(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,C=arguments.length>3?arguments[3]:void 0;this._engine=F,this._label=C,this._engine._storageBuffers.push(this),this._create(b,Q)}_create(F,b){this._bufferSize=F,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(F,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(F,b,Q){this._buffer&&this._engine.updateStorageBuffer(this._buffer,F,b,Q)}async read(F,b,Q,C){return await this._engine.readFromStorageBuffer(this._buffer,F,b,Q,C)}dispose(){const F=this._engine._storageBuffers,b=F.indexOf(this);-1!==b&&(F[b]=F[F.length-1],F.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var Y=Q(11293),s=Q(11296),V=Q(11349),h=Q(11287),l=Q(11593),T=Q(11146),o=Q(11250),S=Q(11520);class O{constructor(){this._gpuTimeInFrameId=-1,this.counter=new S.e}_addDuration(F,b){F<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==F?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=F):this.counter.addCount(b,!1))}}var x=Q(11198);class a{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=F,this._engine=b,this.uniqueId=l.e.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new O),this._engine.getCaps().supportComputeShaders?C.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=Q,this._options={bindingsMapping:{},defines:[],...C}):T.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):T.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(F,b){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const C=this._bindings[F];this._bindings[F]={type:Q?0:4,object:b,indexInGroupEntries:null===C||void 0===C?void 0:C.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!C||C.object!==b||C.type!==this._bindings[F].type)}setStorageTexture(F,b){const Q=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==b),this._bindings[F]={type:1,object:b,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setExternalTexture(F,b){const Q=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==b),this._bindings[F]={type:6,object:b,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setVideoTexture(F,b){return!!b.externalTexture&&(this.setExternalTexture(F,b.externalTexture),!0)}setUniformBuffer(F,b){const Q=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==b),this._bindings[F]={type:a._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setStorageBuffer(F,b){const Q=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!Q||Q.object!==b),this._bindings[F]={type:a._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}setTextureSampler(F,b){const Q=this._bindings[F];this._contextIsDirty||(this._contextIsDirty=!Q||!b.compareSampler(Q.object)),this._bindings[F]={type:5,object:b,indexInGroupEntries:null===Q||void 0===Q?void 0:Q.indexInGroupEntries}}isReady(){let F=this._effect;for(const z in this._bindings){const F=this._bindings[z],b=F.type,Q=F.object;switch(b){case 0:case 4:case 1:if(!Q.isReady())return!1;break;case 6:if(!Q.isReady())return!1;break}}const b=[],Q=this._shaderPath;if(this._options.defines)for(let z=0;z<this._options.defines.length;z++)b.push(this._options.defines[z]);const C=b.join("\n");return this._cachedDefines!==C&&(this._cachedDefines=C,F=this._engine.createComputeEffect(Q,{defines:C,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=F),!!F.isReady()}dispatch(F,b,Q){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,F,b,Q,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const Q=a._BufferIsDataBuffer(F)?F:F.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,Q,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const Q=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(Q.type){case 0:{const C=this._samplers[b],z=Q.object;var F;if(!C||!z._texture||!C.compareSampler(z._texture))this._samplers[b]=(new o.d).setParameters(z.wrapU,z.wrapV,z.wrapR,z.anisotropicFilteringLevel,z._texture.samplingMode,null===(F=z._texture)||void 0===F?void 0:F._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const F=Q.object;F.getBuffer()!==Q.buffer&&(Q.buffer=F.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((z=>{(0,x.f)((()=>this.dispatch(F,b,Q)),z,void 0,C)}))}serialize(){const F=V.e.Serialize(this);F.options=this._options,F.shaderPath=this._shaderPath,F.Ie={},F.textures={};for(const b in this._bindings){const Q=this._bindings[b],C=Q.object;switch(Q.type){case 0:case 4:case 1:{const z=C.serialize();z&&(F.textures[b]=z,F.Ie[b]={type:Q.type});break}}}return F}static Parse(F,b,Q){const C=V.e.Parse((()=>new a(F.name,b.getEngine(),F.shaderPath,F.options)),F,b,Q);for(const z in F.textures){const t=F.Ie[z],g=h.b.Parse(F.textures[z],b,Q);0===t.type?C.setTexture(z,g):4===t.type?C.setTexture(z,g,!1):C.setStorageTexture(z,g)}return C}static _BufferIsDataBuffer(F){return void 0!==F.underlyingResource}}(0,Y.b)([(0,s.A)()],a.prototype,"name",void 0),(0,Y.b)([(0,s.A)()],a.prototype,"fastMode",void 0),(0,W.g)("BABYLON.ComputeShader",a);var A=Q(11553);const U="gpuUpdateParticlesComputeShader",u="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";p.e.ShadersStoreWGSL[U]||(p.e.ShadersStoreWGSL[U]=u);(0,W.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(F,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=F,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var F;return(null===(F=this._updateComputeShader)||void 0===F?void 0:F.isReady())??!1}createUpdateBuffer(F){var b;const Q={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(Q.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(Q.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(Q.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(Q.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(Q.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(Q.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(Q.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new a("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:Q,defines:F.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new A.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new R(this._simParamsComputeShader)}createVertexBuffers(F,b){this._renderVertexBuffers.push(b)}createParticleBuffer(F){const b=new w(this._engine,4*F.length,11,"ComputeShaderParticleSystemBuffer");return b.update(F),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(F,b,Q){this._engine.bindBuffers(this._renderVertexBuffers[F],Q,b)}preUpdateParticleBuffer(){}updateParticleBuffer(F,b,Q){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[F]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^F]),this._updateComputeShader.dispatch(Math.ceil(Q/64))}releaseBuffers(){var F;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(F=this._simParamsComputeShader)||void 0===F||F.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class v{constructor(F,b,Q){this.gradient=F,this.color1=b,this.color2=Q}getColorToRef(F){this.color2?g.sb.LerpToRef(this.color1,this.color2,Math.random(),F):F.W(this.color1)}}class J{constructor(F,b){this.gradient=F,this.color=b}}class I{constructor(F,b,Q){this.gradient=F,this.factor1=b,this.factor2=Q}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class M{static GetCurrentGradient(F,b,Q){if(b[0].gradient>F)return void Q(b[0],b[0],1);for(let z=0;z<b.length-1;z++){const C=b[z],t=b[z+1];if(F>=C.gradient&&F<=t.gradient){return void Q(C,t,(F-C.gradient)/(t.gradient-C.gradient))}}const C=b.length-1;Q(b[C],b[C],1)}}var r=Q(11133),H=Q(11768),B=Q(11161);class d{constructor(F){this.particleSystem=F,this.position=C.gQ.Zero(),this.direction=C.gQ.Zero(),this.color=new g.sb(0,0,0,0),this.colorStep=new g.sb(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new C.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new g.sb(0,0,0,0),this._currentColor2=new g.sb(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=d._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let F=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,F=this._randomCellOffset):F+=this._randomCellOffset);const Q=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let C;C=this._initialSpriteCellLoop?(0,q.Clamp)(F*b%this.lifeTime/this.lifeTime):(0,q.Clamp)(F*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+C*Q|0}_inheritParticleInfoToSubEmitter(F){if(F.particleSystem.Cb.position){const b=F.particleSystem.Cb;if(b.position.W(this.position),F.inheritDirection){const F=C.TmpVectors.gQ[0];this.direction.normalizeToRef(F),b.setDirection(F,0,Math.PI/2)}}else{F.particleSystem.Cb.W(this.position)}this.direction.scaleToRef(F.inheritedVelocityAmount/2,C.TmpVectors.gQ[0]),F.particleSystem._inheritedVelocityOffset.W(C.TmpVectors.gQ[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const F of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(F)}_reset(){this.age=0,this.id=d._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(F){F.position.W(this.position),this._initialDirection?F._initialDirection?F._initialDirection.W(this._initialDirection):F._initialDirection=this._initialDirection.clone():F._initialDirection=null,F.direction.W(this.direction),this.iZ&&(F.iZ?F.iZ.W(this.iZ):F.iZ=this.iZ.clone()),F.color.W(this.color),F.colorStep.W(this.colorStep),F.lifeTime=this.lifeTime,F.age=this.age,F._randomCellOffset=this._randomCellOffset,F.size=this.size,F.scale.W(this.scale),F.angle=this.angle,F.angularSpeed=this.angularSpeed,F.particleSystem=this.particleSystem,F.cellIndex=this.cellIndex,F.id=this.id,F._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(F._currentColorGradient=this._currentColorGradient,F._currentColor1.W(this._currentColor1),F._currentColor2.W(this._currentColor2)),this._currentSizeGradient&&(F._currentSizeGradient=this._currentSizeGradient,F._currentSize1=this._currentSize1,F._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(F._currentAngularSpeedGradient=this._currentAngularSpeedGradient,F._currentAngularSpeed1=this._currentAngularSpeed1,F._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(F._currentVelocityGradient=this._currentVelocityGradient,F._currentVelocity1=this._currentVelocity1,F._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(F._currentLimitVelocityGradient=this._currentLimitVelocityGradient,F._currentLimitVelocity1=this._currentLimitVelocity1,F._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(F._currentDragGradient=this._currentDragGradient,F._currentDrag1=this._currentDrag1,F._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(F._initialStartSpriteCellId=this._initialStartSpriteCellId,F._initialEndSpriteCellId=this._initialEndSpriteCellId,F._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(F.remapData&&this.remapData?F.remapData.W(this.remapData):F.remapData=new C.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(F._randomNoiseCoordinates1?(F._randomNoiseCoordinates1.W(this._randomNoiseCoordinates1),F._randomNoiseCoordinates2.W(this._randomNoiseCoordinates2)):(F._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),F._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}d._Count=0;var FF=Q(11423),bF=(Q(11481),Q(11655)),QF=Q(11650),CF=Q(11549);function zF(F,b){const Q=(0,q.RandomRange)(0,1);g.sb.LerpToRef(b.color1,b.color2,Q,F.color),b.colorDead.subtractToRef(F.color,b._colorDiff),b._colorDiff.scaleToRef(1/F.lifeTime,F.colorStep)}function tF(F,b){F._currentColorGradient=b._colorGradients[0],F._currentColorGradient.getColorToRef(F.color),F._currentColor1.W(F.color),b._colorGradients.length>1?b._colorGradients[1].getColorToRef(F._currentColor2):F._currentColor2.W(F.color)}function gF(F,b){const Q=b._colorGradients;M.GetCurrentGradient(b._ratio,Q,((b,Q,C)=>{b!==F._currentColorGradient&&(F._currentColor1.W(F._currentColor2),Q.getColorToRef(F._currentColor2),F._currentColorGradient=b),g.sb.LerpToRef(F._currentColor1,F._currentColor2,C,F.color)}))}function WF(F,b){F.colorStep.scaleToRef(b._scaledUpdateSpeed,b._scaledColorStep),F.color.addInPlace(b._scaledColorStep),F.color.a<0&&(F.color.a=0)}function ZF(F,b){M.GetCurrentGradient(b._ratio,b._angularSpeedGradients,((b,Q,C)=>{b!==F._currentAngularSpeedGradient&&(F._currentAngularSpeed1=F._currentAngularSpeed2,F._currentAngularSpeed2=Q.getFactor(),F._currentAngularSpeedGradient=b),F.angularSpeed=(0,q.Lerp)(F._currentAngularSpeed1,F._currentAngularSpeed2,C)}))}function qF(F,b){F.angle+=F.angularSpeed*b._scaledUpdateSpeed}function GF(F,b){b.particleEmitterType.startDirectionFunction(b._emitterWorldMatrix,F.direction,F,b.isLocal,b._emitterInverseWorldMatrix)}function KF(F,b){b.startDirectionFunction(b._emitterWorldMatrix,F.direction,F,b.isLocal)}function eF(F,b){F._currentVelocityGradient=b._velocityGradients[0],F._currentVelocity1=F._currentVelocityGradient.getFactor(),b._velocityGradients.length>1?F._currentVelocity2=b._velocityGradients[1].getFactor():F._currentVelocity2=F._currentVelocity1}function NF(F,b){F._currentLimitVelocityGradient=b._limitVelocityGradients[0],F._currentLimitVelocity1=F._currentLimitVelocityGradient.getFactor(),b._limitVelocityGradients.length>1?F._currentLimitVelocity2=b._limitVelocityGradients[1].getFactor():F._currentLimitVelocity2=F._currentLimitVelocity1}function yF(F,b){M.GetCurrentGradient(b._ratio,b._velocityGradients,((Q,C,z)=>{Q!==F._currentVelocityGradient&&(F._currentVelocity1=F._currentVelocity2,F._currentVelocity2=C.getFactor(),F._currentVelocityGradient=Q),b._directionScale*=(0,q.Lerp)(F._currentVelocity1,F._currentVelocity2,z)}))}function EF(F,b){M.GetCurrentGradient(b._ratio,b._limitVelocityGradients,((Q,C,z)=>{Q!==F._currentLimitVelocityGradient&&(F._currentLimitVelocity1=F._currentLimitVelocity2,F._currentLimitVelocity2=C.getFactor(),F._currentLimitVelocityGradient=Q);const t=(0,q.Lerp)(F._currentLimitVelocity1,F._currentLimitVelocity2,z);F.direction.length()>t&&F.direction.scaleInPlace(b.limitVelocityDamping)}))}function cF(F,b){F.direction.scaleToRef(b._directionScale,b._scaledDirection)}function XF(F,b){b.particleEmitterType.startPositionFunction(b._emitterWorldMatrix,F.position,F,b.isLocal)}function LF(F,b){b.startPositionFunction(b._emitterWorldMatrix,F.position,F,b.isLocal)}function iF(F,b){F.iZ?F.iZ.W(F.position):F.iZ=F.position.clone(),C.gQ.TransformCoordinatesToRef(F.iZ,b._emitterWorldMatrix,F.position)}function fF(F,b){b.isLocal&&F.iZ?(F.iZ.addInPlace(b._scaledDirection),C.gQ.TransformCoordinatesToRef(F.iZ,b._emitterWorldMatrix,F.position)):F.position.addInPlace(b._scaledDirection)}function kF(F,b){F._currentDragGradient=b._dragGradients[0],F._currentDrag1=F._currentDragGradient.getFactor(),b._dragGradients.length>1?F._currentDrag2=b._dragGradients[1].getFactor():F._currentDrag2=F._currentDrag1}function mF(F,b){M.GetCurrentGradient(b._ratio,b._dragGradients,((Q,C,z)=>{Q!==F._currentDragGradient&&(F._currentDrag1=F._currentDrag2,F._currentDrag2=C.getFactor(),F._currentDragGradient=Q);const t=(0,q.Lerp)(F._currentDrag1,F._currentDrag2,z);b._scaledDirection.scaleInPlace(1-t)}))}function RF(F,b){F._randomNoiseCoordinates1?(F._randomNoiseCoordinates1.jb(Math.random(),Math.random(),Math.random()),F._randomNoiseCoordinates2.jb(Math.random(),Math.random(),Math.random())):(F._randomNoiseCoordinates1=new C.gQ(Math.random(),Math.random(),Math.random()),F._randomNoiseCoordinates2=new C.gQ(Math.random(),Math.random(),Math.random()))}function pF(F,b){const Q=b._noiseTextureData,z=b._noiseTextureSize;if(Q&&z&&F._randomNoiseCoordinates1){const t=b._fetchR(F._randomNoiseCoordinates1.x,F._randomNoiseCoordinates1.y,z.width,z.height,Q),g=b._fetchR(F._randomNoiseCoordinates1.z,F._randomNoiseCoordinates2.x,z.width,z.height,Q),W=b._fetchR(F._randomNoiseCoordinates2.y,F._randomNoiseCoordinates2.z,z.width,z.height,Q),Z=C.TmpVectors.gQ[0],q=C.TmpVectors.gQ[1];Z.jb((2*t-1)*b.noiseStrength.x,(2*g-1)*b.noiseStrength.y,(2*W-1)*b.noiseStrength.z),Z.scaleToRef(b._tempScaledUpdateSpeed,q),F.direction.addInPlace(q)}}function DF(F,b){b.gravity.scaleToRef(b._tempScaledUpdateSpeed,b._scaledGravity),F.direction.addInPlace(b._scaledGravity)}function PF(F,b){F.size=(0,q.RandomRange)(b.minSize,b.maxSize),F.scale.jb((0,q.RandomRange)(b.minScaleX,b.maxScaleX),(0,q.RandomRange)(b.minScaleY,b.maxScaleY))}function nF(F,b){F._currentSizeGradient=b._sizeGradients[0],F._currentSize1=F._currentSizeGradient.getFactor(),F.size=F._currentSize1,b._sizeGradients.length>1?F._currentSize2=b._sizeGradients[1].getFactor():F._currentSize2=F._currentSize1,F.scale.jb((0,q.RandomRange)(b.minScaleX,b.maxScaleX),(0,q.RandomRange)(b.minScaleY,b.maxScaleY))}function jF(F,b){const Q=b._actualFrame/b.targetStopDuration;M.GetCurrentGradient(Q,b._startSizeGradients,((Q,C,z)=>{Q!==b._currentStartSizeGradient&&(b._currentStartSize1=b._currentStartSize2,b._currentStartSize2=C.getFactor(),b._currentStartSizeGradient=Q);const t=(0,q.Lerp)(b._currentStartSize1,b._currentStartSize2,z);F.scale.scaleInPlace(t)}))}function wF(F,b){M.GetCurrentGradient(b._ratio,b._sizeGradients,((b,Q,C)=>{b!==F._currentSizeGradient&&(F._currentSize1=F._currentSize2,F._currentSize2=Q.getFactor(),F._currentSizeGradient=b),F.size=(0,q.Lerp)(F._currentSize1,F._currentSize2,C)}))}function YF(F,b){F.remapData=new C.Vector4(0,1,0,1)}function sF(F,b){b._colorRemapGradients&&b._colorRemapGradients.length>0&&M.GetCurrentGradient(b._ratio,b._colorRemapGradients,((b,Q,C)=>{const z=(0,q.Lerp)(b.factor1,Q.factor1,C),t=(0,q.Lerp)(b.factor2,Q.factor2,C);F.remapData.x=z,F.remapData.y=t-z})),b._alphaRemapGradients&&b._alphaRemapGradients.length>0&&M.GetCurrentGradient(b._ratio,b._alphaRemapGradients,((b,Q,C)=>{const z=(0,q.Lerp)(b.factor1,Q.factor1,C),t=(0,q.Lerp)(b.factor2,Q.factor2,C);F.remapData.z=z,F.remapData.w=t-z}))}function VF(F,b){const Q=(0,q.Clamp)(b._actualFrame/b.targetStopDuration);M.GetCurrentGradient(Q,b._lifeTimeGradients,((b,C)=>{const z=b,t=C,g=z.getFactor(),W=t.getFactor(),Z=(Q-z.gradient)/(t.gradient-z.gradient);F.lifeTime=(0,q.Lerp)(g,W,Z)})),b._emitPower=(0,q.RandomRange)(b.minEmitPower,b.maxEmitPower)}function hF(F,b){F.lifeTime=(0,q.RandomRange)(b.minLifeTime,b.maxLifeTime),b._emitPower=(0,q.RandomRange)(b.minEmitPower,b.maxEmitPower)}function lF(F,b){0===b._emitPower?(F._initialDirection?F._initialDirection.W(F.direction):F._initialDirection=F.direction.clone(),F.direction.set(0,0,0)):(F._initialDirection=null,F.direction.scaleInPlace(b._emitPower)),F.direction.addInPlace(b._inheritedVelocityOffset)}function TF(F,b){F.angularSpeed=(0,q.RandomRange)(b.minAngularSpeed,b.maxAngularSpeed),F.angle=(0,q.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function oF(F,b){F._currentAngularSpeedGradient=b._angularSpeedGradients[0],F.angularSpeed=F._currentAngularSpeedGradient.getFactor(),F._currentAngularSpeed1=F.angularSpeed,b._angularSpeedGradients.length>1?F._currentAngularSpeed2=b._angularSpeedGradients[1].getFactor():F._currentAngularSpeed2=F._currentAngularSpeed1,F.angle=(0,q.RandomRange)(b.minInitialRotation,b.maxInitialRotation)}function SF(F,b){F._initialStartSpriteCellId=b.startSpriteCellID,F._initialEndSpriteCellId=b.endSpriteCellID,F._initialSpriteCellLoop=b.spriteCellLoop}function OF(F,b){F.previousItem=b.previousItem,F.nextItem=b,b.previousItem&&(b.previousItem.nextItem=F),b.previousItem=F}function xF(F,b){F.previousItem=b,F.nextItem=b.nextItem,b.nextItem&&(b.nextItem.previousItem=F),b.nextItem=F}function aF(F,b){let Q=b;for(;Q.nextItem;)Q=Q.nextItem;F.previousItem=Q,F.nextItem=Q.nextItem,Q.nextItem=F}function AF(F){F.previousItem&&(F.previousItem.nextItem=F.nextItem),F.nextItem&&(F.nextItem.previousItem=F.previousItem)}class UF extends Z{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(F){this._startDirectionFunction!==F&&(this._startDirectionFunction=F,this._directionProcessing.process=F?KF:GF)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(F){this._startPositionFunction!==F&&(this._startPositionFunction=F,this._positionCreation.process=F?LF:XF)}set onDispose(F){this._onDisposeObserver&&this.Kb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Kb.add(F)}get G(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(F){this._useRampGradients!==F&&(this._useRampGradients=F,this._resetEffect(),F?(this._rampCreation={process:YF,previousItem:null,nextItem:null},xF(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:sF,previousItem:null,nextItem:null},xF(this._remapGradientProcessing,this._gravityProcessing)):(AF(this._rampCreation),AF(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(F){this._isLocal!==F&&(this._isLocal=F,F?(this._isLocalCreation={process:iF,previousItem:null,nextItem:null},xF(this._isLocalCreation,this._positionCreation)):AF(this._isLocalCreation))}get particles(){return this.xe}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(F){this._animationSheetEnabled!==F&&(this._animationSheetEnabled=F,F?(this._sheetCreation={process:SF,previousItem:null,nextItem:null},xF(this._sheetCreation,this._colorCreation)):AF(this._sheetCreation),this._reset())}getActiveCount(){return this.xe.length}getClassName(){return"ob"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var F;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(F=this._customWrappers[b])||void 0===F?void 0:F.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[F]??this._customWrappers[0]}setCustomEffect(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new FF.c(this._engine),this._customWrappers[b].effect=F,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new r.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(F){if(this.noiseTexture!==F){if(this._noiseTexture=F,!F)return AF(this._noiseCreation),void AF(this._noiseProcessing);this._noiseCreation={process:RF,previousItem:null,nextItem:null},xF(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:pF,previousItem:null,nextItem:null},xF(this._noiseProcessing,this._positionProcessing)}}constructor(F,b,Q){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,Z=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(F),this._emitterInverseWorldMatrix=C.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new C.gQ,this.Kb=new r.c,this.onStoppedObservable=new r.c,this.onStartedObservable=new r.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.xe=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new g.sb(0,0,0,0),this._colorDiff=new g.sb(0,0,0,0),this._scaledDirection=C.gQ.Zero(),this._scaledGravity=C.gQ.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=F=>{},this.recycleParticle=F=>{const b=this.xe.pop();b!==F&&b.copyTo(F),this._stockParticles.push(b)},this._createParticle=()=>{let F;return 0!==this._stockParticles.length?(F=this._stockParticles.pop(),F._reset()):F=new d(this),this._prepareParticle(F),F},this.paused=!1,this._shadersLoaded=!1,this._capacity=b,this._epsilon=W,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=C.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||B.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Te.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:hF,previousItem:null,nextItem:null},this._positionCreation={process:XF,previousItem:null,nextItem:null},xF(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:GF,previousItem:null,nextItem:null},xF(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:lF,previousItem:null,nextItem:null},xF(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:PF,previousItem:null,nextItem:null},xF(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:TF,previousItem:null,nextItem:null},xF(this._angleCreation,this._sizeCreation),this._colorCreation={process:zF,previousItem:null,nextItem:null},xF(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,Z||(this._colorProcessing={process:WF,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:qF,previousItem:null,nextItem:null},xF(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:cF,previousItem:null,nextItem:null},xF(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:fF,previousItem:null,nextItem:null},xF(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:DF,previousItem:null,nextItem:null},xF(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=t,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new FF.c(this._engine)},this._customWrappers[0].effect=z,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new K,this.updateFunction=F=>{var b;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(b=this.noiseTexture.getContent())||void 0===b||b.then((F=>{this._noiseTextureData=F})));const Q=F===this.xe;for(let C=0;C<F.length;C++){const b=F[C];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const z=b.age;if(b.age+=this._tempScaledUpdateSpeed,b.age>b.lifeTime){const F=b.age-z,Q=b.lifeTime-z;this._tempScaledUpdateSpeed=Q*this._tempScaledUpdateSpeed/F,b.age=b.lifeTime}this._ratio=b.age/b.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let t=this._updateQueueStart;for(;t;)t.process(b,this),t=t.nextItem;if(this._isAnimationSheetEnabled&&!Z&&b.updateCellIndex(),b._inheritParticleInfoToSubEmitters(),b.age>=b.lifeTime){if(this._emitFromParticle(b),b._attachedSubEmitters){for(const F of b._attachedSubEmitters)F.particleSystem.disposeOnStop=!0,F.particleSystem.stop();b._attachedSubEmitters=null}this.recycleParticle(b),Q&&C--}else;}}}serialize(F){throw new Error("Method not implemented.")}clone(F,b){throw new Error("Method not implemented.")}_addFactorGradient(F,b,Q,C){const z=new I(b,Q,C);F.push(z),F.sort(((F,b)=>F.gradient<b.gradient?-1:F.gradient>b.gradient?1:0))}_removeFactorGradient(F,b){if(!F)return;let Q=0;for(const C of F){if(C.gradient===b){F.splice(Q,1);break}Q++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=VF:this._lifeTimeCreation.process=hF}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:jF,previousItem:null,nextItem:null},xF(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(AF(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(F){this.targetStopDuration!==F&&(this._targetStopDuration=F,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(F,b,Q){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,F,b,Q),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(F){return this._removeFactorGradient(this._lifeTimeGradients,F),this._syncLifeTimeCreation(),this}addSizeGradient(F,b,Q){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=nF,this._sizeGradientProcessing={process:wF,previousItem:null,nextItem:null},OF(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,F,b,Q),this}removeSizeGradient(F){var b;return this._removeFactorGradient(this._sizeGradients,F),0===(null===(b=this._sizeGradients)||void 0===b?void 0:b.length)&&(AF(this._sizeGradientProcessing),this._sizeCreation.process=PF),this}addColorRemapGradient(F,b,Q){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,F,b,Q),this}removeColorRemapGradient(F){return this._removeFactorGradient(this._colorRemapGradients,F),this}addAlphaRemapGradient(F,b,Q){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,F,b,Q),this}removeAlphaRemapGradient(F){return this._removeFactorGradient(this._alphaRemapGradients,F),this}addAngularSpeedGradient(F,b,Q){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=oF,this._angularSpeedGradientProcessing={process:ZF,previousItem:null,nextItem:null},OF(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,F,b,Q),this}removeAngularSpeedGradient(F){var b;return this._removeFactorGradient(this._angularSpeedGradients,F),0===(null===(b=this._angularSpeedGradients)||void 0===b?void 0:b.length)&&(this._angleCreation.process=TF,AF(this._angularSpeedGradientProcessing)),this}addVelocityGradient(F,b,Q){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:eF,previousItem:null,nextItem:null},xF(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:yF,previousItem:null,nextItem:null},OF(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,F,b,Q),this}removeVelocityGradient(F){var b;return this._removeFactorGradient(this._velocityGradients,F),0===(null===(b=this._velocityGradients)||void 0===b?void 0:b.length)&&(AF(this._velocityCreation),AF(this._velocityGradientProcessing)),this}addLimitVelocityGradient(F,b,Q){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:NF,previousItem:null,nextItem:null},xF(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:EF,previousItem:null,nextItem:null},xF(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,F,b,Q),this}removeLimitVelocityGradient(F){var b;return this._removeFactorGradient(this._limitVelocityGradients,F),0===(null===(b=this._limitVelocityGradients)||void 0===b?void 0:b.length)&&(AF(this._limitVelocityCreation),AF(this._limitVelocityGradientProcessing)),this}addDragGradient(F,b,Q){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:kF,previousItem:null,nextItem:null},OF(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:mF,previousItem:null,nextItem:null},OF(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,F,b,Q),this}removeDragGradient(F){var b;return this._removeFactorGradient(this._dragGradients,F),0===(null===(b=this._dragGradients)||void 0===b?void 0:b.length)&&(AF(this._dragCreation),AF(this._dragGradientProcessing)),this}addEmitRateGradient(F,b,Q){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,F,b,Q),this}removeEmitRateGradient(F){return this._removeFactorGradient(this._emitRateGradients,F),this}addStartSizeGradient(F,b,Q){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,F,b,Q),this._syncStartSizeCreation(),this}removeStartSizeGradient(F){return this._removeFactorGradient(this._startSizeGradients,F),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const F=new Uint8Array(4*this._rawTextureWidth),b=g.TmpColors.GQ[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const C=Q/this._rawTextureWidth;M.GetCurrentGradient(C,this._rampGradients,((C,z,t)=>{g.GQ.LerpToRef(C.color,z.color,t,b),F[4*Q]=255*b.r,F[4*Q+1]=255*b.g,F[4*Q+2]=255*b.b,F[4*Q+3]=255}))}this._rampGradientsTexture=H.c.CreateRGBATexture(F,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((F,b)=>F.gradient<b.gradient?-1:F.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(F,b){this._rampGradients||(this._rampGradients=[]);const Q=new J(F,b);return this._rampGradients.push(Q),this._syncRampGradientTexture(),this}removeRampGradient(F){return this._removeGradientAndTexture(F,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(F,b,Q){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=tF,this._colorProcessing.process=gF);const C=new v(F,b,Q);return this._colorGradients.push(C),this._colorGradients.sort(((F,b)=>F.gradient<b.gradient?-1:F.gradient>b.gradient?1:0)),this}removeColorGradient(F){if(!this._colorGradients)return this;let b=0;for(const Q of this._colorGradients){if(Q.gradient===F){this._colorGradients.splice(b,1);break}b++}return 0===this._colorGradients.length&&(this._colorCreation.process=zF,this._colorProcessing.process=WF),this}resetDrawCache(){if(this._drawWrappers){for(const F of this._drawWrappers)if(F)for(const b of F)null===b||void 0===b||b.dispose();this._drawWrappers=[]}}_fetchR(F,b,Q,C,z){return z[4*(((F=.5*Math.abs(F)+.5)*Q%Q|0)+((b=.5*Math.abs(b)+.5)*C%C|0)*Q)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const F=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new k.d(F,this._vertexData,!0,b);let Q=0;const C=this._vertexBuffer.createVertexBuffer(k.e.PositionKind,Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[k.e.PositionKind]=C,Q+=3;const z=this._vertexBuffer.createVertexBuffer(k.e.ColorKind,Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[k.e.ColorKind]=z,Q+=4;const t=this._vertexBuffer.createVertexBuffer("angle",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=t,Q+=1;const g=this._vertexBuffer.createVertexBuffer("size",Q,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=g,Q+=2,this._isAnimationSheetEnabled){const F=this._vertexBuffer.createVertexBuffer("cellIndex",Q,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=F,Q+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const F=this._vertexBuffer.createVertexBuffer("direction",Q,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=F,Q+=3}if(this._useRampGradients){const F=this._vertexBuffer.createVertexBuffer("remapData",Q,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=F,Q+=4}let W;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new k.d(F,b,!1,2),W=this._spriteBuffer.createVertexBuffer("offset",0,2)}else W=this._vertexBuffer.createVertexBuffer("offset",Q,2,this._vertexBufferSize,this._useInstancing),Q+=2;this._vertexBuffers.offset=W,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const F=[],b=[];let Q=0;for(let C=0;C<this._capacity;C++)F.push(Q),F.push(Q+1),F.push(Q+2),F.push(Q),F.push(Q+2),F.push(Q+3),b.push(Q,Q+1,Q+1,Q+2,Q+2,Q+3,Q+3,Q,Q,Q+3),Q+=4;this._indexBuffer=this._engine.createIndexBuffer(F),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(F)setTimeout((()=>{this.start(0)}),F);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.Cb)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.Cb.Rb(!0);const F=this.noiseTexture;if(F&&F.onGeneratedObservable)F.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),F.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(F))}_postStop(F){}reset(){this._stockParticles.length=0,this.xe.length=0}_appendParticleVertex(F,b,Q,z){let t=F*this._vertexBufferSize;if(this._vertexData[t++]=b.position.x+this.aq.x,this._vertexData[t++]=b.position.y+this.aq.y,this._vertexData[t++]=b.position.z+this.aq.z,this._vertexData[t++]=b.color.r,this._vertexData[t++]=b.color.g,this._vertexData[t++]=b.color.b,this._vertexData[t++]=b.color.a,this._vertexData[t++]=b.angle,this._vertexData[t++]=b.scale.x*b.size,this._vertexData[t++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[t++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[t++]=b.direction.x,this._vertexData[t++]=b.direction.y,this._vertexData[t++]=b.direction.z);else if(b._initialDirection){let F=b._initialDirection;this.isLocal&&(C.gQ.TransformNormalToRef(F,this._emitterWorldMatrix,C.TmpVectors.gQ[0]),F=C.TmpVectors.gQ[0]),0===F.x&&0===F.z&&(F.x=.001),this._vertexData[t++]=F.x,this._vertexData[t++]=F.y,this._vertexData[t++]=F.z}else{let F=b.direction;this.isLocal&&(C.gQ.TransformNormalToRef(F,this._emitterWorldMatrix,C.TmpVectors.gQ[0]),F=C.TmpVectors.gQ[0]),0===F.x&&0===F.z&&(F.x=.001),this._vertexData[t++]=F.x,this._vertexData[t++]=F.y,this._vertexData[t++]=F.z}this._useRampGradients&&b.remapData&&(this._vertexData[t++]=b.remapData.x,this._vertexData[t++]=b.remapData.y,this._vertexData[t++]=b.remapData.z,this._vertexData[t++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===Q?Q=this._epsilon:1===Q&&(Q=1-this._epsilon),0===z?z=this._epsilon:1===z&&(z=1-this._epsilon)),this._vertexData[t++]=Q,this._vertexData[t++]=z)}_prepareParticle(F){}_createNewOnes(F){let b;for(let Q=0;Q<F&&this.xe.length!==this._capacity;Q++){b=this._createParticle(),this.xe.push(b);let F=this._createQueueStart;for(;F;)F.process(b,this),F=F.nextItem;b._inheritParticleInfoToSubEmitters()}}_update(F){if(this._alive=this.xe.length>0,this.Cb.position){const F=this.Cb;this._emitterWorldMatrix=F.getWorldMatrix()}else{const F=this.Cb;this._emitterWorldMatrix=C.Matrix.Translation(F.x,F.y,F.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.xe),this._createNewOnes(F)}static _GetAttributeNamesOrOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=[k.e.PositionKind,k.e.ColorKind,"angle","offset","size"];return F&&C.push("cellIndex"),b||C.push("direction"),Q&&C.push("remapData"),C}static _GetEffectCreationOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bF.b)(C),F&&C.push("particlesInfos"),b&&C.push("logarithmicDepthConstant"),Q&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(F,b){let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bF.j)(this,this._scene,F),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&F.push("#define FOG")),this._isAnimationSheetEnabled&&F.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&F.push("#define LOGARITHMICDEPTH"),b===Z.BLENDMODE_MULTIPLY&&F.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&F.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(F.push("#define BILLBOARD"),this.billboardMode){case 2:F.push("#define BILLBOARDY");break;case 8:case 9:F.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&F.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:F.push("#define BILLBOARDMODE_ALL")}Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),F.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(F,b,Q){b.push(...UF._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),F.push(...UF._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,CF.f)(F,this._imageProcessingConfigurationDefines),(0,CF.b)(Q,this._imageProcessingConfigurationDefines))}_getWrapper(F){const b=this._getCustomDrawWrapper(F);if(null!==b&&void 0!==b&&b.effect)return b;const Q=[];this.fillDefines(Q,F);const C=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let z=this._drawWrappers[C];z||(z=this._drawWrappers[C]=[]);let t=z[F];t||(t=new FF.c(this._engine),t.drawContext&&(t.drawContext.useInstancing=this._useInstancing),z[F]=t);const g=Q.join("\n");if(t.defines!==g){const F=[],b=[],Q=[];this.fillUniformsAttributesAndSamplerNames(b,F,Q),t.setEffect(this._engine.createEffect("particles",F,b,Q,g,void 0,void 0,void 0,void 0,this._shaderLanguage),g)}return t}animate(){var F;let b,Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!Q&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(Q?this.preWarmStepOffset:(null===(F=this._scene)||void 0===F?void 0:F.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let F=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;M.GetCurrentGradient(b,this._emitRateGradients,((b,Q,C)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=Q.getFactor(),this._currentEmitRateGradient=b),F=(0,q.Lerp)(this._currentEmitRate1,this._currentEmitRate2,C)}))}b=F*this._scaledUpdateSpeed|0,this._newPartsExcess+=F*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!Q){let F=0;for(let b=0;b<this.xe.length;b++){const Q=this.xe[b];this._appendParticleVertices(F,Q),F+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.xe.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(F,b){this._appendParticleVertex(F++,b,0,0),this._useInstancing||(this._appendParticleVertex(F++,b,1,0),this._appendParticleVertex(F++,b,1,1),this._appendParticleVertex(F++,b,0,1))}rebuild(){var F;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(F=this._spriteBuffer)||void 0===F||F._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!UF.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(Q.bind(Q,12740)),Promise.resolve().then(Q.bind(Q,12687))])):await Promise.all([Promise.resolve().then(Q.bind(Q,12680)),Promise.resolve().then(Q.bind(Q,12663))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Cb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==Z.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Z.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Z.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(F){const b=this._getWrapper(F),Q=b.effect,z=this._engine;z.enableEffect(b);const t=this.defaultViewMatrix??this._scene.getViewMatrix();if(Q.setTexture("diffuseSampler",this.particleTexture),Q.setMatrix("view",t),Q.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const F=this.particleTexture.getBaseSize();Q.setFloat3("particlesInfos",this.spriteCellWidth/F.width,this.spriteCellHeight/F.height,this.spriteCellWidth/F.width)}if(Q.setVector2("translationPivot",this.translationPivot),Q.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const F=this._scene.activeCamera;Q.setVector3("eyePosition",F.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),Q.setTexture("rampSampler",this._rampGradientsTexture));const g=Q.defines;var W,Z,q,G,K,e;(this._scene&&((0,bF.e)(Q,this,this._scene),this.applyFog&&(0,QF.h)(this._scene,void 0,Q)),g.indexOf("#define BILLBOARDMODE_ALL")>=0&&(t.invertToRef(C.TmpVectors.Matrix[0]),Q.setMatrix("invView",C.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?z.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,Q):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,Q)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?z.bindBuffers(this._vertexBuffers,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBuffer:this._indexBuffer,Q):z.bindBuffers(this._vertexBuffers,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:null,Q);(this.useLogarithmicDepth&&this._scene&&(0,QF.k)(g,Q,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Q),this._setEngineBasedOnBlendMode(F),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Q),this._useInstancing)?null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?z.drawElementsType(6,0,10,this.xe.length):z.drawArraysType(7,0,4,this.xe.length):null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?z.drawElementsType(1,0,10*this.xe.length):z.drawElementsType(0,0,6*this.xe.length);return this.xe.length}render(){if(!this.isReady()||!this.xe.length)return 0;const F=this._engine;F.setState&&(F.setState(!1),this.forceDepthWrite&&F.setDepthWrite(!0));let b=0;return b=this.blendMode===Z.BLENDMODE_MULTIPLYADD?this._render(Z.BLENDMODE_MULTIPLY)+this._render(Z.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),F&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),F&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,Q),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const F=this._scene.Te.indexOf(this);F>-1&&this._scene.Te.splice(F,1),this._scene._activeParticleSystems.dispose()}this.Kb.notifyObservers(this),this.Kb.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}UF.ForceGLSL=!1;var uF,vF=Q(11155);!function(F){F[F.ATTACHED=0]="ATTACHED",F[F.END=1]="END"}(uF||(uF={}));class JF{constructor(F){if(this.particleSystem=F,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!F.Cb||!F.Cb.dispose){const b=(0,W.d)("BABYLON.AbstractMesh");F.Cb=new b("SubemitterSystemEmitter",F.RF()),F._disposeEmitterOnDispose=!0}}clone(){let F=this.particleSystem.Cb;if(F){if(F instanceof C.gQ)F=F.clone();else if(-1!==F.getClassName().indexOf("Mesh")){F=new((0,W.d)("BABYLON.Mesh"))("",F.RF()),F.isVisible=!1}}else F=new C.gQ;const b=new JF(this.particleSystem.clone(this.particleSystem.name,F));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(F),b}static _ParseParticleSystem(F,b,Q){throw(0,vF.c)("ParseParticle")}static Parse(F,b,Q){const C=F.particleSystem,z=new JF(JF._ParseParticleSystem(C,b,Q,!0));return z.type=F.type,z.inheritDirection=F.inheritDirection,z.inheritedVelocityAmount=F.inheritedVelocityAmount,z.particleSystem._isSubEmitter=!0,z}dispose(){this.particleSystem.dispose()}}var IF=Q(11203);function MF(F,b){const Q=new X;return Q.direction1=F,Q.direction2=b,Q}function rF(){return new c(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function HF(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function BF(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.gQ(0,1,0),Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0);return new i(F,b,Q)}function dF(){return new y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Fb(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0),t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.gQ(0,1,0);return new E(F,b,Q,z,t)}function bb(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new e(F,b)}function Qb(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0),z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0);return new N(F,b,Q,z)}const Cb=C.gQ.Zero(),zb=C.gQ.Zero(),tb=C.gQ.Zero();class gb{constructor(){this.strength=0,this.position=C.gQ.Zero()}_processParticle(F,b){this.position.subtractToRef(F.position,Cb);const Q=Cb.lengthSquared()+1;Cb.normalize().scaleToRef(this.strength/Q,zb),zb.scaleToRef(b._tempScaledUpdateSpeed,tb),F.direction.addInPlace(tb)}serialize(){return{position:this.position.Lb(),strength:this.strength}}}class Wb extends UF{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=F=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);for(const Q of this._subEmitters[b])if(1===Q.type){const b=Q.clone();F._inheritParticleInfoToSubEmitter(b),b.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(b.particleSystem),b.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(F,b){const Q=MF(F,b);return this.particleEmitterType=Q,Q}get flowMap(){return this._flowMap}set flowMap(F){this._flowMap!==F&&(this._flowMap=F,this._flowMapUpdate&&(AF(this._flowMapUpdate),this._flowMapUpdate=null),F&&(this._flowMapUpdate={process:F=>{var b;const Q=null===(b=this.RF())||void 0===b?void 0:b.getTransformMatrix();this._flowMap._processParticle(F,this.flowMapStrength*this._tempScaledUpdateSpeed,Q)},previousItem:null,nextItem:null},xF(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(F){this._attractors.push(F),1===this._attractors.length&&(this._attractorUpdate={process:F=>{for(const b of this._attractors)b._processParticle(F,this)},previousItem:null,nextItem:null},xF(this._attractorUpdate,this._directionProcessing))}removeAttractor(F){const b=this._attractors.indexOf(F);-1!==b&&this._attractors.splice(b,1),0===this._attractors.length&&AF(this._attractorUpdate)}start(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(F)}createHemisphericEmitter(){const F=rF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createSphereEmitter(){const F=HF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createDirectedSphereEmitter(){const F=BF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.gQ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0));return this.particleEmitterType=F,F}createCylinderEmitter(){const F=dF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=F,F}createDirectedCylinderEmitter(){const F=Fb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.gQ(0,1,0));return this.particleEmitterType=F,F}createConeEmitter(){const F=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=F,F}createDirectedConeEmitter(){const F=Qb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0));return this.particleEmitterType=F,F}createBoxEmitter(F,b,Q,C){const z=new K;return this.particleEmitterType=z,this.direction1=F,this.direction2=b,this.minEmitBox=Q,this.maxEmitBox=C,z}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const F of this.subEmitters)F instanceof Wb?this._subEmitters.push([new JF(F)]):F instanceof JF?this._subEmitters.push([F]):F instanceof Array&&this._subEmitters.push(F)}_stopSubEmitters(){if(this.activeSubSystems){for(const F of this.activeSubSystems)F.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const F=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==F&&this._rootParticleSystem.activeSubSystems.splice(F,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(F){F&&this._stopSubEmitters()}_prepareParticle(F){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];F._attachedSubEmitters=[];for(const Q of b)if(0===Q.type){const b=Q.clone();F._attachedSubEmitters.push(b),b.particleSystem.start()}}}_onDispose(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),F&&this.particles)for(const Q of this.particles)if(Q._attachedSubEmitters)for(let F=Q._attachedSubEmitters.length-1;F>=0;F-=1)Q._attachedSubEmitters[F].dispose();if(b&&this.activeSubSystems)for(let Q=this.activeSubSystems.length-1;Q>=0;Q-=1)this.activeSubSystems[Q].dispose();if(this._subEmitters&&this._subEmitters.length){for(let F=0;F<this._subEmitters.length;F++)for(const b of this._subEmitters[F])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Cb&&this.Cb.dispose&&this.Cb.dispose(!0)}static _Parse(F,b,Q,z){let t;t=Q instanceof IF.d?null:Q;const Z=(0,W.d)("BABYLON.Texture");if(Z&&t&&(F.texture?b.particleTexture=Z.Parse(F.texture,t,z):F.textureName&&(b.particleTexture=new Z(z+F.textureName,t,!1,void 0===F.invertY||F.invertY),b.particleTexture.name=F.textureName)),F.emitterId||0===F.emitterId||void 0!==F.Cb?F.emitterId&&t?b.Cb=t.getLastMeshById(F.emitterId):b.Cb=C.gQ.KQ(F.Cb):b.Cb=C.gQ.Zero(),b.isLocal=!!F.isLocal,void 0!==F.renderingGroupId&&(b.renderingGroupId=F.renderingGroupId),void 0!==F.isBillboardBased&&(b.isBillboardBased=F.isBillboardBased),void 0!==F.billboardMode&&(b.billboardMode=F.billboardMode),void 0!==F.useLogarithmicDepth&&(b.useLogarithmicDepth=F.useLogarithmicDepth),F.animations){for(let Q=0;Q<F.animations.length;Q++){const C=F.animations[Q],z=(0,W.d)("BABYLON.Animation");z&&b.animations.push(z.Parse(C))}b.beginAnimationOnStart=F.beginAnimationOnStart,b.beginAnimationFrom=F.beginAnimationFrom,b.beginAnimationTo=F.beginAnimationTo,b.beginAnimationLoop=F.beginAnimationLoop}if(F.autoAnimate&&t&&t.beginAnimation(b,F.autoAnimateFrom,F.autoAnimateTo,F.autoAnimateLoop,F.autoAnimateSpeed||1),b.startDelay=0|F.startDelay,b.minAngularSpeed=F.minAngularSpeed,b.maxAngularSpeed=F.maxAngularSpeed,b.minSize=F.minSize,b.maxSize=F.maxSize,F.minScaleX&&(b.minScaleX=F.minScaleX,b.maxScaleX=F.maxScaleX,b.minScaleY=F.minScaleY,b.maxScaleY=F.maxScaleY),void 0!==F.preWarmCycles&&(b.preWarmCycles=F.preWarmCycles,b.preWarmStepOffset=F.preWarmStepOffset),void 0!==F.minInitialRotation&&(b.minInitialRotation=F.minInitialRotation,b.maxInitialRotation=F.maxInitialRotation),b.minLifeTime=F.minLifeTime,b.maxLifeTime=F.maxLifeTime,b.minEmitPower=F.minEmitPower,b.maxEmitPower=F.maxEmitPower,b.emitRate=F.emitRate,b.gravity=C.gQ.KQ(F.gravity),F.noiseStrength&&(b.noiseStrength=C.gQ.KQ(F.noiseStrength)),b.color1=g.sb.KQ(F.color1),b.color2=g.sb.KQ(F.color2),b.colorDead=g.sb.KQ(F.colorDead),b.updateSpeed=F.updateSpeed,b.targetStopDuration=F.targetStopDuration,b.blendMode=F.blendMode,F.colorGradients)for(const C of F.colorGradients)b.addColorGradient(C.gradient,g.sb.KQ(C.color1),C.color2?g.sb.KQ(C.color2):void 0);if(F.rampGradients){for(const Q of F.rampGradients)b.addRampGradient(Q.gradient,g.GQ.KQ(Q.color));b.useRampGradients=F.useRampGradients}if(F.colorRemapGradients)for(const C of F.colorRemapGradients)b.addColorRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.alphaRemapGradients)for(const C of F.alphaRemapGradients)b.addAlphaRemapGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.sizeGradients)for(const C of F.sizeGradients)b.addSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.angularSpeedGradients)for(const C of F.angularSpeedGradients)b.addAngularSpeedGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.velocityGradients)for(const C of F.velocityGradients)b.addVelocityGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.dragGradients)for(const C of F.dragGradients)b.addDragGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.emitRateGradients)for(const C of F.emitRateGradients)b.addEmitRateGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.startSizeGradients)for(const C of F.startSizeGradients)b.addStartSizeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.lifeTimeGradients)for(const C of F.lifeTimeGradients)b.addLifeTimeGradient(C.gradient,void 0!==C.factor1?C.factor1:C.factor,C.factor2);if(F.limitVelocityGradients){for(const Q of F.limitVelocityGradients)b.addLimitVelocityGradient(Q.gradient,void 0!==Q.factor1?Q.factor1:Q.factor,Q.factor2);b.limitVelocityDamping=F.limitVelocityDamping}if(F.noiseTexture&&t){const Q=(0,W.d)("BABYLON.ProceduralTexture");b.noiseTexture=Q.Parse(F.noiseTexture,t,z)}let q;if(F.particleEmitterType){switch(F.particleEmitterType.type){case"SphereParticleEmitter":q=new L;break;case"SphereDirectedParticleEmitter":q=new i;break;case"ConeEmitter":case"ConeParticleEmitter":q=new e;break;case"ConeDirectedParticleEmitter":q=new N;break;case"CylinderParticleEmitter":q=new y;break;case"CylinderDirectedParticleEmitter":q=new E;break;case"HemisphericParticleEmitter":q=new c;break;case"PointParticleEmitter":q=new X;break;case"MeshParticleEmitter":q=new m;break;case"CustomParticleEmitter":q=new f;break;default:q=new K}q.parse(F.particleEmitterType,t)}else q=new K,q.parse(F,t);b.particleEmitterType=q,b.startSpriteCellID=F.startSpriteCellID,b.endSpriteCellID=F.endSpriteCellID,b.spriteCellLoop=F.spriteCellLoop??!0,b.spriteCellWidth=F.spriteCellWidth,b.spriteCellHeight=F.spriteCellHeight,b.spriteCellChangeSpeed=F.spriteCellChangeSpeed,b.spriteRandomStartCell=F.spriteRandomStartCell,b.disposeOnStop=F.disposeOnStop??!1,b.manualEmitCount=F.manualEmitCount??-1}static Parse(F,b,Q){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0;const W=F.name;let Z,q,G=null,K=null;if(b instanceof IF.d?Z=b:(q=b,Z=q.getEngine()),F.customShader&&Z.createEffectForParticles){K=F.customShader;const b=K.shaderOptions.defines.length>0?K.shaderOptions.defines.join("\n"):"";G=Z.createEffectForParticles(K.shaderPath.fragmentElement,K.shaderOptions.uniforms,K.shaderOptions.samplers,b)}const e=new Wb(W,t||F.NQ,b,G,F.isAnimationSheetEnabled);if(e.customShader=K,e._rootUrl=Q,F.id&&(e.id=F.id),F.subEmitters){e.subEmitters=[];for(const C of F.subEmitters){const F=[];for(const z of C)F.push(JF.Parse(z,b,Q));e.subEmitters.push(F)}}if(F.attractors)for(const g of F.attractors){const F=new gb;F.position=C.gQ.KQ(g.position),F.strength=g.strength,e.addAttractor(F)}return Wb._Parse(F,e,b,Q),F.textureMask&&(e.textureMask=g.sb.KQ(F.textureMask)),F.aq&&(e.aq=C.gQ.KQ(F.aq)),F.preventAutoStart&&(e.preventAutoStart=F.preventAutoStart),z||e.preventAutoStart||e.start(),e}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(Wb._Serialize(b,this,F),b.textureMask=this.textureMask.Lb(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.aq=this.aq.Lb(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const Q of this._subEmitters){const C=[];for(const b of Q)C.push(b.serialize(F));b.subEmitters.push(C)}}if(this._attractors&&this._attractors.length){b.attractors=[];for(const F of this._attractors)b.attractors.push(F.serialize())}return b}static _Serialize(F,b,Q){if(F.name=b.name,F.id=b.id,F.NQ=b.getCapacity(),F.disposeOnStop=b.disposeOnStop,F.manualEmitCount=b.manualEmitCount,b.Cb.position){const Q=b.Cb;F.emitterId=Q.id}else{const Q=b.Cb;F.Cb=Q.Lb()}b.particleEmitterType&&(F.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(Q?F.texture=b.particleTexture.serialize():(F.textureName=b.particleTexture.name,F.invertY=!!b.particleTexture._invertY)),F.isLocal=b.isLocal,V.e.AppendSerializedAnimations(b,F),F.beginAnimationOnStart=b.beginAnimationOnStart,F.beginAnimationFrom=b.beginAnimationFrom,F.beginAnimationTo=b.beginAnimationTo,F.beginAnimationLoop=b.beginAnimationLoop,F.startDelay=b.startDelay,F.renderingGroupId=b.renderingGroupId,F.isBillboardBased=b.isBillboardBased,F.billboardMode=b.billboardMode,F.minAngularSpeed=b.minAngularSpeed,F.maxAngularSpeed=b.maxAngularSpeed,F.minSize=b.minSize,F.maxSize=b.maxSize,F.minScaleX=b.minScaleX,F.maxScaleX=b.maxScaleX,F.minScaleY=b.minScaleY,F.maxScaleY=b.maxScaleY,F.minEmitPower=b.minEmitPower,F.maxEmitPower=b.maxEmitPower,F.minLifeTime=b.minLifeTime,F.maxLifeTime=b.maxLifeTime,F.emitRate=b.emitRate,F.gravity=b.gravity.Lb(),F.noiseStrength=b.noiseStrength.Lb(),F.color1=b.color1.Lb(),F.color2=b.color2.Lb(),F.colorDead=b.colorDead.Lb(),F.updateSpeed=b.updateSpeed,F.targetStopDuration=b.targetStopDuration,F.blendMode=b.blendMode,F.preWarmCycles=b.preWarmCycles,F.preWarmStepOffset=b.preWarmStepOffset,F.minInitialRotation=b.minInitialRotation,F.maxInitialRotation=b.maxInitialRotation,F.startSpriteCellID=b.startSpriteCellID,F.spriteCellLoop=b.spriteCellLoop,F.endSpriteCellID=b.endSpriteCellID,F.spriteCellChangeSpeed=b.spriteCellChangeSpeed,F.spriteCellWidth=b.spriteCellWidth,F.spriteCellHeight=b.spriteCellHeight,F.spriteRandomStartCell=b.spriteRandomStartCell,F.isAnimationSheetEnabled=b.isAnimationSheetEnabled,F.useLogarithmicDepth=b.useLogarithmicDepth;const C=b.getColorGradients();if(C){F.colorGradients=[];for(const b of C){const Q={gradient:b.gradient,color1:b.color1.Lb()};b.color2?Q.color2=b.color2.Lb():Q.color2=b.color1.Lb(),F.colorGradients.push(Q)}}const z=b.getRampGradients();if(z){F.rampGradients=[];for(const b of z){const Q={gradient:b.gradient,color:b.color.Lb()};F.rampGradients.push(Q)}F.useRampGradients=b.useRampGradients}const t=b.getColorRemapGradients();if(t){F.colorRemapGradients=[];for(const b of t){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.colorRemapGradients.push(Q)}}const g=b.getAlphaRemapGradients();if(g){F.alphaRemapGradients=[];for(const b of g){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.alphaRemapGradients.push(Q)}}const W=b.getSizeGradients();if(W){F.sizeGradients=[];for(const b of W){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.sizeGradients.push(Q)}}const Z=b.getAngularSpeedGradients();if(Z){F.angularSpeedGradients=[];for(const b of Z){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.angularSpeedGradients.push(Q)}}const q=b.getVelocityGradients();if(q){F.velocityGradients=[];for(const b of q){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.velocityGradients.push(Q)}}const G=b.getDragGradients();if(G){F.dragGradients=[];for(const b of G){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.dragGradients.push(Q)}}const K=b.getEmitRateGradients();if(K){F.emitRateGradients=[];for(const b of K){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.emitRateGradients.push(Q)}}const e=b.getStartSizeGradients();if(e){F.startSizeGradients=[];for(const b of e){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.startSizeGradients.push(Q)}}const N=b.getLifeTimeGradients();if(N){F.lifeTimeGradients=[];for(const b of N){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.lifeTimeGradients.push(Q)}}const y=b.getLimitVelocityGradients();if(y){F.limitVelocityGradients=[];for(const b of y){const Q={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?Q.factor2=b.factor2:Q.factor2=b.factor1,F.limitVelocityGradients.push(Q)}F.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(F.noiseTexture=b.noiseTexture.serialize())}clone(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let z=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){z=this.customShader;const F=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"",b=t.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,F);C[0]?C[0].effect=b:this.setCustomEffect(b,0)}const g=this.serialize(Q),W=Wb.Parse(g,this._scene||this._engine,this._rootUrl);return W.name=F,W.customShader=z,W._customWrappers=C,void 0===b&&(b=this.Cb),this.noiseTexture&&(W.noiseTexture=this.noiseTexture.clone()),W.Cb=b,this.preventAutoStart||W.start(),W}}Wb.BILLBOARDMODE_Y=2,Wb.BILLBOARDMODE_ALL=7,Wb.BILLBOARDMODE_STRETCHED=8,Wb.BILLBOARDMODE_STRETCHED_LOCAL=9,JF._ParseParticleSystem=Wb.Parse;var Zb=Q(11541),qb=Q(11537),Gb=Q(11441);Gb.c.prototype.createTransformFeedback=function(){const F=this._gl.createTransformFeedback();if(!F)throw new Error("Unable to create Transform Feedback");return F},Gb.c.prototype.deleteTransformFeedback=function(F){this._gl.deleteTransformFeedback(F)},Gb.c.prototype.bindTransformFeedback=function(F){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,F)},Gb.c.prototype.beginTransformFeedback=function(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(F?this._gl.POINTS:this._gl.TRIANGLES)},Gb.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Gb.c.prototype.setTranformFeedbackVaryings=function(F,b){this._gl.transformFeedbackVaryings(F,b,this._gl.INTERLEAVED_ATTRIBS)},Gb.c.prototype.bindTransformFeedbackBuffer=function(F){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,F?F.underlyingResource:null)},Gb.c.prototype.readTransformFeedbackBuffer=function(F){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,F)};const Kb="clipPlaneFragmentDeclaration2",eb="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";p.e.IncludesShadersStore[Kb]||(p.e.IncludesShadersStore[Kb]=eb);Q(12563),Q(12565),Q(12573),Q(12577),Q(12584),Q(12586),Q(12595),Q(12602);const Nb="gpuRenderParticlesPixelShader",yb="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";p.e.ShadersStore[Nb]||(p.e.ShadersStore[Nb]=yb);const Eb="clipPlaneVertexDeclaration2",cb="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";p.e.IncludesShadersStore[Eb]||(p.e.IncludesShadersStore[Eb]=cb);Q(12609),Q(12617),Q(12622),Q(12631);const Xb="gpuRenderParticlesVertexShader",Lb="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";p.e.ShadersStore[Xb]||(p.e.ShadersStore[Xb]=Lb);class ib extends Z{static get IsSupported(){if(!B.d.LastCreatedEngine)return!1;const F=B.d.LastCreatedEngine.getCaps();return F.supportTransformFeedbacks||F.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(F){this._maxActiveParticleCount=Math.min(F,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(F){this.maxActiveParticleCount=F}createPointEmitter(F,b){const Q=MF(F,b);return this.particleEmitterType=Q,Q}createHemisphericEmitter(){const F=rF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createSphereEmitter(){const F=HF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=F,F}createDirectedSphereEmitter(){const F=BF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C.gQ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0));return this.particleEmitterType=F,F}createCylinderEmitter(){const F=dF(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=F,F}createDirectedCylinderEmitter(){const F=Fb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new C.gQ(0,1,0));return this.particleEmitterType=F,F}createConeEmitter(){const F=bb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=F,F}createDirectedConeEmitter(){const F=Qb(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new C.gQ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new C.gQ(0,1,0));return this.particleEmitterType=F,F}createBoxEmitter(F,b,Q,C){const z=new K;return this.particleEmitterType=z,this.direction1=F,this.direction2=b,this.minEmitBox=Q,this.maxEmitBox=C,z}get flowMap(){return this._flowMap}set flowMap(F){this._flowMap!==F&&(this._flowMap=F)}isReady(){if(!this.Cb||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Wb.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Wb.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Wb.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";F?setTimeout((()=>{this.start(0)}),F):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var F;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(F=this._customWrappers[b])||void 0===F?void 0:F.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[F]??this._customWrappers[0]}setCustomEffect(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new FF.c(this._engine),this._customWrappers[b].effect=F}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new r.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(F,b,Q){return super._removeGradientAndTexture(F,b,Q),this._releaseBuffers(),this}addColorGradient(F,b){this._colorGradients||(this._colorGradients=[]);const Q=new v(F,b);return this._colorGradients.push(Q),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(F&&this._colorGradients.sort(((F,b)=>F.gradient<b.gradient?-1:F.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(F){return this._removeGradientAndTexture(F,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var F;null===(F=this._drawWrappers[b].drawContext)||void 0===F||F.reset()}}_addFactorGradient(F,b,Q){const C=new I(b,Q);F.push(C),this._releaseBuffers()}addSizeGradient(F,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,F,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(F){return this._removeGradientAndTexture(F,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(F,b){if(!F)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&F.sort(((F,b)=>F.gradient<b.gradient?-1:F.gradient>b.gradient?1:0));const Q=this;Q[b]&&(Q[b].dispose(),Q[b]=null)}addAngularSpeedGradient(F,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,F,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(F){return this._removeGradientAndTexture(F,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(F,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,F,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(F){return this._removeGradientAndTexture(F,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(F,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,F,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(F){return this._removeGradientAndTexture(F,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(F,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,F,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(F){return this._removeGradientAndTexture(F,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(F){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(F,b,Q){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(F),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Kb=new r.c,this.onStoppedObservable=new r.c,this.onStartedObservable=new r.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,Q&&"Scene"!==Q.getClassName()?(this._engine=Q,this.defaultProjectionMatrix=C.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=Q||B.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.Te.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,W.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,W.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,W.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,W.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new FF.c(this._engine)},this._customWrappers[0].effect=z,this._drawWrappers={0:new FF.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const g={NQ:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},Z=b;isFinite(Z)&&(g.NQ=Z),this._capacity=g.NQ,this._maxActiveParticleCount=g.NQ,this._currentActiveCount=0,this._isAnimationSheetEnabled=t,this.particleEmitterType=new K;const q=Math.min(this._engine.getCaps().maxTextureSize,g.randomTextureSize);let G=[];for(let C=0;C<q;++C)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture=new H.c(new Float32Array(G),q,1,5,Q,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,G=[];for(let C=0;C<q;++C)G.push(Math.random()),G.push(Math.random()),G.push(Math.random()),G.push(Math.random());this._randomTexture2=new H.c(new Float32Array(G),q,1,5,Q,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=q}_reset(){this._releaseBuffers()}_createVertexBuffers(F,b,Q){const C={};C.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let z=3;C.age=b.createVertexBuffer("age",z,1,this._attributesStrideSize,!0),z+=1,C.size=b.createVertexBuffer("size",z,3,this._attributesStrideSize,!0),z+=3,C.life=b.createVertexBuffer("life",z,1,this._attributesStrideSize,!0),z+=1,z+=4,this.billboardMode===Wb.BILLBOARDMODE_STRETCHED&&(C.direction=b.createVertexBuffer("direction",z,3,this._attributesStrideSize,!0)),z+=3,this._platform.alignDataInBuffer&&(z+=1),this.particleEmitterType instanceof f&&(z+=3,this._platform.alignDataInBuffer&&(z+=1)),this._colorGradientsTexture||(C.color=b.createVertexBuffer("color",z,4,this._attributesStrideSize,!0),z+=4),this._isBillboardBased||(C.initialDirection=b.createVertexBuffer("initialDirection",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1)),this.noiseTexture&&(C.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1),C.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",z,3,this._attributesStrideSize,!0),z+=3,this._platform.alignDataInBuffer&&(z+=1)),C.angle=b.createVertexBuffer("angle",z,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?z++:z+=2,this._isAnimationSheetEnabled&&(C.cellIndex=b.createVertexBuffer("cellIndex",z,1,this._attributesStrideSize,!0),z+=1,this.spriteRandomStartCell&&(C.cellStartOffset=b.createVertexBuffer("cellStartOffset",z,1,this._attributesStrideSize,!0),z+=1)),C.offset=Q.createVertexBuffer("offset",0,2),C.uv=Q.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(C),this._platform.createVertexBuffers(F,C),this.resetDrawCache()}_initialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!F)return;const b=this._engine,Q=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof f&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const z=this.particleEmitterType instanceof f,t=C.TmpVectors.gQ[0];let g=0;for(let C=0;C<this._capacity;C++)if(Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),z?(this.particleEmitterType.particleDestinationGenerator(C,null,t),Q.push(t.x),Q.push(t.y),Q.push(t.z)):(Q.push(0),Q.push(0),Q.push(0)),this._platform.alignDataInBuffer&&Q.push(0),g+=16,z&&(this.particleEmitterType.particlePositionGenerator(C,null,t),Q.push(t.x),Q.push(t.y),Q.push(t.z),this._platform.alignDataInBuffer&&Q.push(0),g+=4),this._colorGradientsTexture||(Q.push(0),Q.push(0),Q.push(0),Q.push(0),g+=4),this.isBillboardBased||(Q.push(0),Q.push(0),Q.push(0),this._platform.alignDataInBuffer&&Q.push(0),g+=4),this.noiseTexture&&(Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),Q.push(Math.random()),Q.push(Math.random()),Q.push(Math.random()),this._platform.alignDataInBuffer&&Q.push(0),g+=8),Q.push(0),g+=1,this._angularSpeedGradientsTexture||(Q.push(0),g+=1),this._isAnimationSheetEnabled&&(Q.push(0),g+=1,this.spriteRandomStartCell&&(Q.push(0),g+=1)),this._platform.alignDataInBuffer){let F=3-(g+3&3);for(g+=F;F-- >0;)Q.push(0)}const W=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),Z=this._platform.createParticleBuffer(Q),q=this._platform.createParticleBuffer(Q);this._buffer0=new k.d(b,Z,!1,this._attributesStrideSize),this._buffer1=new k.d(b,q,!1,this._attributesStrideSize),this._spriteBuffer=new k.d(b,W,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let F=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(F+="\n#define BILLBOARD"),this._colorGradientsTexture&&(F+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(F+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(F+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(F+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(F+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(F+="\n#define DRAGGRADIENTS"),this._flowMap&&(F+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(F+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(F+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(F+="\n#define NOISE"),this.isLocal&&(F+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===F||(this._cachedUpdateDefines=F,this._updateBuffer=this._platform.createUpdateBuffer(F)),this._platform.isUpdateBufferReady()}_getWrapper(F){const b=this._getCustomDrawWrapper(F);if(null!==b&&void 0!==b&&b.effect)return b;const Q=[];this.fillDefines(Q,F);let C=this._drawWrappers[F];C||(C=new FF.c(this._engine),C.drawContext&&(C.drawContext.useInstancing=!0),this._drawWrappers[F]=C);const z=Q.join("\n");if(C.defines!==z){const F=[],b=[],Q=[];this.fillUniformsAttributesAndSamplerNames(b,F,Q),C.setEffect(this._engine.createEffect("gpuRenderParticles",F,b,Q,z),z)}return C}static _GetAttributeNamesOrOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=[k.e.PositionKind,"age","life","size","angle"];return F||z.push(k.e.ColorKind),b&&z.push("cellIndex"),Q||z.push("initialDirection"),C&&z.push("direction"),z.push("offset",k.e.UVKind),z}static _GetEffectCreationOptions(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C=["emitterWM","aq","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bF.b)(C),F&&C.push("sheetInfos"),b&&C.push("logarithmicDepthConstant"),Q&&(C.push("vFogInfos"),C.push("vFogColor")),C}fillDefines(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bF.j)(this,this._scene,F),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==qb.c.FOGMODE_NONE&&F.push("#define FOG")),b===Wb.BLENDMODE_MULTIPLY&&F.push("#define BLENDMULTIPLYMODE"),this.isLocal&&F.push("#define LOCAL"),this.useLogarithmicDepth&&F.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(F.push("#define BILLBOARD"),this.billboardMode){case Wb.BILLBOARDMODE_Y:F.push("#define BILLBOARDY");break;case Wb.BILLBOARDMODE_STRETCHED:F.push("#define BILLBOARDSTRETCHED");break;case Wb.BILLBOARDMODE_ALL:F.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&F.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&F.push("#define ANIMATESHEET"),Q&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),F.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(F,b,Q){b.push(...ib._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Wb.BILLBOARDMODE_STRETCHED)),F.push(...ib._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),Q.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Zb.c.PrepareUniforms(F,this._imageProcessingConfigurationDefines),Zb.c.PrepareSamplers(Q,this._imageProcessingConfigurationDefines))}animate(){var F;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(F=this._scene)||void 0===F?void 0:F.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(F,b){const Q=this[b];if(!F||!F.length||Q)return;const C=new Float32Array(this._rawTextureWidth);for(let z=0;z<this._rawTextureWidth;z++){const b=z/this._rawTextureWidth;M.GetCurrentGradient(b,F,((F,b,Q)=>{C[z]=(0,q.Lerp)(F.factor1,b.factor1,Q)}))}this[b]=H.c.CreateRTexture(C,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const F=new Uint8Array(4*this._rawTextureWidth),b=g.TmpColors.sb[0];for(let Q=0;Q<this._rawTextureWidth;Q++){const C=Q/this._rawTextureWidth;M.GetCurrentGradient(C,this._colorGradients,((C,z,t)=>{g.sb.LerpToRef(C.color1,z.color1,t,b),F[4*Q]=255*b.r,F[4*Q+1]=255*b.g,F[4*Q+2]=255*b.b,F[4*Q+3]=255*b.a}))}this._colorGradientsTexture=H.c.CreateRGBATexture(F,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(F,b){var Q,z,t,g;const W=this._getWrapper(F),Z=W.effect;this._engine.enableEffect(W);const q=(null===(Q=this._scene)||void 0===Q?void 0:Q.getViewMatrix())||C.Matrix.IdentityReadOnly;if(Z.setMatrix("view",q),Z.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),Z.setTexture("diffuseSampler",this.particleTexture),Z.setVector2("translationPivot",this.translationPivot),Z.setVector3("aq",this.aq),this.isLocal&&Z.setMatrix("emitterWM",b),this._colorGradientsTexture?Z.setTexture("colorGradientSampler",this._colorGradientsTexture):Z.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const F=this.particleTexture.getBaseSize();Z.setFloat3("sheetInfos",this.spriteCellWidth/F.width,this.spriteCellHeight/F.height,F.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const F=this._scene.activeCamera;Z.setVector3("eyePosition",F.globalPosition)}const G=Z.defines;if(this._scene&&((0,bF.e)(Z,this,this._scene),this.applyFog&&(0,QF.h)(this._scene,void 0,Z)),G.indexOf("#define BILLBOARDMODE_ALL")>=0){const F=q.clone();F.invert(),Z.setMatrix("invView",F)}return this.useLogarithmicDepth&&this._scene&&(0,QF.k)(G,Z,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(Z),this._setEngineBasedOnBlendMode(F),this._platform.bindDrawBuffers(this._targetIndex,Z,null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(Z),null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(g=this._scene)&&void 0!==g&&g.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(F){if(!this.Cb||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!F)if(this.Cb.position){F=this.Cb.getWorldMatrix()}else{const b=this.Cb;F=C.TmpVectors.Matrix[0],C.Matrix.TranslationToRef(b.x,b.y,b.z,F)}const b=this._engine,Q=b.getDepthWrite();if(b.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const F=this.RF();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",F.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",F),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const z=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=z,b.setDepthWrite(Q)}render(){let F,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],Q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let F=0;F<this.preWarmCycles;F++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const F=0|this._accumulatedCount;this._accumulatedCount-=F,this._currentActiveCount+=F}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Cb.position){F=this.Cb.getWorldMatrix()}else{const b=this.Cb;F=C.TmpVectors.Matrix[0],C.Matrix.TranslationToRef(b.x,b.y,b.z,F)}const z=this._engine;this.updateInAnimate||this._update(F);let t=0;return b||Q||(z.setState(!1),this.forceDepthWrite&&z.setDepthWrite(!0),t=this.blendMode===Wb.BLENDMODE_MULTIPLYADD?this._render(Wb.BLENDMODE_MULTIPLY,F)+this._render(Wb.BLENDMODE_ADD,F):this._render(this.blendMode,F),this._engine.setAlphaMode(0)),t}rebuild(){const F=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(F,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,F()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const F=this._scene.Te.indexOf(this);F>-1&&this._scene.Te.splice(F,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const F=this._renderVertexBuffers[b];for(const b in F)F[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),F&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),F&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Kb.notifyObservers(this),this.Kb.clear()}clone(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const C={...this._customWrappers};let z=null;const t=this._engine;if(t.createEffectForParticles&&null!=this.customShader){z=this.customShader;const F=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"";C[0]=t.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,F,void 0,void 0,void 0,this)}const g=this.serialize(Q),W=ib.Parse(g,this._scene||this._engine,this._rootUrl);return W.name=F,W.customShader=z,W._customWrappers=C,void 0===b&&(b=this.Cb),this.noiseTexture&&(W.noiseTexture=this.noiseTexture.clone()),W.Cb=b,W}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return Wb._Serialize(b,this,F),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const t=F.name;let g,W;b instanceof IF.d?g=b:(W=b,g=W.getEngine());const Z=new ib(t,{NQ:z||F.NQ,randomTextureSize:F.randomTextureSize},b,null,F.isAnimationSheetEnabled);if(Z._rootUrl=Q,F.customShader&&g.createEffectForParticles){const b=F.customShader,Q=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",C=g.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,Q,void 0,void 0,void 0,Z);Z.setCustomEffect(C,0),Z.customShader=b}return F.id&&(Z.id=F.id),F.activeParticleCount&&(Z.activeParticleCount=F.activeParticleCount),Wb._Parse(F,Z,b,Q),F.preventAutoStart&&(Z.preventAutoStart=F.preventAutoStart),C||Z.preventAutoStart||Z.start(),Z}}var fb=Q(11128),kb=Q(12636),mb=Q(11662);class Rb{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(F){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.Cb=F;this._emitterNode=F}setEmitterAsSphere(F,b,Q){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:F,renderingGroupId:b};const C=(0,kb.e)("emitterSphere",{diameter:F.diameter,segments:F.segments},Q);C.renderingGroupId=b;const z=new mb.qQ("emitterSphereMaterial",Q);z.emissiveColor=F.color,C.material=z;for(const t of this.systems)t.Cb=C;this._emitterNode=C}start(F){for(const b of this.systems)F&&(b.Cb=F),b.start()}dispose(){for(const F of this.systems)F.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const Q of this.systems)b.systems.push(Q.serialize(F));return this._emitterNode&&(b.Cb=this._emitterCreationOptions),b}static Parse(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;const z=new Rb,t=this.BaseAssetsUrl+"/textures/";b=b||B.d.LastCreatedScene;for(const g of F.systems)z.systems.push(Q?ib.Parse(g,b,t,!0,C):Wb.Parse(g,b,t,!0,C));if(F.Cb){const Q=F.Cb.options;if("Sphere"===F.Cb.kind)z.setEmitterAsSphere({diameter:Q.diameter,segments:Q.segments,color:g.GQ.KQ(Q.color)},F.Cb.renderingGroupId,b)}return z}}Rb.BaseAssetsUrl="https://assets.babylonjs.com/particles";var pb=Q(11159);class Db{static CreateDefault(F){let b,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,C=arguments.length>2?arguments[2]:void 0;b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new ib("default system",{NQ:Q},C):new Wb("default system",Q,C),b.Cb=F;const z=fb.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return b.particleTexture=new h.b(z,b.RF()),b.createConeEmitter(.1,Math.PI/4),b.color1=new g.sb(1,1,1,1),b.color2=new g.sb(1,1,1,1),b.colorDead=new g.sb(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0;b||(b=B.d.LastCreatedScene);const z={};return b.addPendingData(z),new Promise(((t,g)=>{if(Q&&!ib.IsSupported)return b.removePendingData(z),g("Particle system with GPU is not supported.");fb.Tools.LoadFile(`${Db.BaseAssetsUrl}/systems/${F}.json`,(F=>{b.removePendingData(z);const g=JSON.parse(F.toString());return t(Rb.Parse(g,b,Q,C))}),void 0,void 0,void 0,(()=>(b.removePendingData(z),g(`An error occurred with the creation of your particle system. Check if your type '${F}' exists.`))))}))}static ExportSet(F){const b=new Rb;for(const Q of F)b.systems.push(Q);return b}static ParseFromFileAsync(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",t=arguments.length>5?arguments[5]:void 0;return new Promise(((g,W)=>{const Z=new pb.b;Z.addEventListener("readystatechange",(()=>{if(4==Z.readyState)if(200==Z.status){const b=JSON.parse(Z.responseText);let W;W=C?ib.Parse(b,Q,z,!1,t):Wb.Parse(b,Q,z,!1,t),F&&(W.name=F),g(W)}else W("Unable to load the particle system")})),Z.open("GET",b),Z.send()}))}static ParseFromSnippetAsync(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0;if("_BLANK"===F){const F=this.CreateDefault(null);return F.start(),Promise.resolve(F)}return new Promise(((t,g)=>{const W=new pb.b;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const g=JSON.parse(JSON.parse(W.responseText).jsonPayload),Z=JSON.parse(g.particleSystem);let q;q=Q?ib.Parse(Z,b,C,!1,z):Wb.Parse(Z,b,C,!1,z),q.snippetId=F,t(q)}else g("Unable to load the snippet "+F)})),W.open("GET",this.SnippetUrl+"/"+F.replace(/#/g,"/")),W.send()}))}}Db.BaseAssetsUrl=Rb.BaseAssetsUrl,Db.SnippetUrl="https://snippet.babylonjs.com",Db.CreateFromSnippetAsync=Db.ParseFromSnippetAsync;var Pb=Q(11746),nb=Q(11561),jb=Q(12644);(0,jb.f)(nb.c.NAME_PARTICLESYSTEM,((F,b,Q,C)=>{const z=(0,jb.i)(nb.c.NAME_PARTICLESYSTEM);if(z&&void 0!==F.Te&&null!==F.Te)for(let t=0,g=F.Te.length;t<g;t++){const g=F.Te[t];Q.Te.push(z(g,b,C))}})),(0,jb.b)(nb.c.NAME_PARTICLESYSTEM,((F,b,Q)=>{if(F.activeParticleCount){return ib.Parse(F,b,Q)}return Wb.Parse(F,b,Q)})),IF.d.prototype.createEffectForParticles=function(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",t=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,W=arguments.length>6?arguments[6]:void 0,Z=arguments.length>7?arguments[7]:void 0,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,G=arguments.length>9?arguments[9]:void 0,K=[],e=[];const N=[];return Z?Z.fillUniformsAttributesAndSamplerNames(e,K,N):(K=Wb._GetAttributeNamesOrOptions(),e=Wb._GetEffectCreationOptions()),-1===z.indexOf(" BILLBOARD")&&(z+="\n#define BILLBOARD\n"),null!==Z&&void 0!==Z&&Z.isAnimationSheetEnabled&&-1===z.indexOf(" ANIMATESHEET")&&(z+="\n#define ANIMATESHEET\n"),-1===C.indexOf("diffuseSampler")&&C.push("diffuseSampler"),this.createEffect({vertex:G??(null===Z||void 0===Z?void 0:Z.vertexShaderName)??"particles",fragmentElement:F},K,e.concat(b),N.concat(C),z,t,g,W,void 0,q,(async()=>{0===q?await Promise.resolve().then(Q.bind(Q,12680)):await Promise.resolve().then(Q.bind(Q,12740))}))},Pb.b.prototype.getEmittedParticleSystems=function(){const F=[];for(let b=0;b<this.RF().Te.length;b++){const Q=this.RF().Te[b];Q.Cb===this&&F.push(Q)}return F},Pb.b.prototype.getHierarchyEmittedParticleSystems=function(){const F=[],b=this.getDescendants();b.push(this);for(let Q=0;Q<this.RF().Te.length;Q++){const C=this.RF().Te[Q],z=C.Cb;z.position&&-1!==b.indexOf(z)&&F.push(C)}return F};Q(11623),Q(11636),Q(11724);Q(11730),Q(12649),Q(11510),Q(11612),Q(11764);Q(11507);var wb;Q(12651),Q(11332);!function(F){F[F.Color=2]="Color",F[F.UV=1]="UV",F[F.Random=0]="Random",F[F.Stated=3]="Stated"}(wb||(wb={}));var Yb=Q(11529);const sb=new C.gQ(0,0,0),Vb=new C.gQ(0,0,0),hb=new C.gQ(0,0,0);class lb{constructor(F,b,Q){this.width=F,this.height=b,this.data=Q}processFlowable(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2?arguments[2]:void 0;if(!Q)return;Q instanceof C.Matrix?C.gQ.TransformCoordinatesToRef(F.position,Q,hb):(hb.x=Q.x,hb.y=Q.y,hb.z=Q.z);const z=.5*hb.x+.5,t=1-(.5*hb.y+.5),g=Math.floor(z*this.width),W=Math.floor(t*this.height);if(g<0||g>=this.width||W<0||W>=this.height)return;const Z=4*(W*this.width+g),q=this.data[Z]/255*2-1,G=this.data[Z+1]/255*2-1,K=this.data[Z+2]/255*2-1,e=this.data[Z+3]/255;sb.set(q,G,K),sb.scaleToRef(b*e,Vb),F.direction.addInPlace(Vb)}_processParticle(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,Q=arguments.length>2?arguments[2]:void 0;this.processFlowable(F,b,Q)}static async FromUrlAsync(F){return await new Promise(((b,Q)=>{const C=document.createElement("canvas"),z=C.getContext("2d");let t=null;const g=new Image;g.crossOrigin="anonymous",g.src=F,g.onerror=b=>{Q(new Error(`Failed to load image: ${F} : ${b}`))},g.onload=()=>{C.width=g.width,C.height=g.height,z.drawImage(g,0,0),t=z.getImageData(0,0,C.width,C.height),b(new lb(C.width,C.height,t.data))}}))}static async ExtractFromTextureAsync(F){return await new Promise(((b,Q)=>{if(!F.isReady())return void F.onLoadObservable.addOnce((async()=>{try{const Q=await this.ExtractFromTextureAsync(F);b(Q)}catch(C){Q(C)}}));const C=F.getSize();Yb.j.GetTextureDataAsync(F,C.width,C.height).then((F=>{b(new lb(C.width,C.height,new Uint8ClampedArray(F)))})).catch(Q)}))}}var Tb,ob,Sb,Ob,xb,ab,Ab,Ub,ub;!function(F){F[F.Int=1]="Int",F[F.Float=2]="Float",F[F.Vector2=4]="Vector2",F[F.gQ=8]="gQ",F[F.Matrix=16]="Matrix",F[F.Particle=32]="Particle",F[F.Texture=64]="Texture",F[F.sb=128]="sb",F[F.FloatGradient=256]="FloatGradient",F[F.Vector2Gradient=512]="Vector2Gradient",F[F.Vector3Gradient=1024]="Vector3Gradient",F[F.Color4Gradient=2048]="Color4Gradient",F[F.System=4096]="System",F[F.AutoDetect=8192]="AutoDetect",F[F.BasedOnInput=16384]="BasedOnInput",F[F.Undefined=32768]="Undefined",F[F.All=65535]="All"}(Tb||(Tb={})),function(F){F[F.Compatible=0]="Compatible",F[F.TypeIncompatible=1]="TypeIncompatible",F[F.HierarchyIssue=2]="HierarchyIssue"}(ob||(ob={})),function(F){F[F.Input=0]="Input",F[F.Output=1]="Output"}(Sb||(Sb={}));class vb{get direction(){return this._direction}get type(){if(this._type===Tb.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Tb.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(F){this._type=F}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((F=>F.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(F,b,Q){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Tb.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new r.c,this.onDisconnectionObservable=new r.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=b,this.name=F,this._direction=Q}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(F){var b;return this.isConnected?null!==(b=this._connectedPoint)&&void 0!==b&&b._storedFunction?this._connectedPoint._storedFunction(F):this._connectedPoint._storedValue:this.value}canConnectTo(F){return 0===this.checkCompatibilityState(F)}checkCompatibilityState(F){const b=this._ownerBlock,Q=F.ownerBlock;if(this.type!==F.type&&F.innerType!==Tb.AutoDetect)return F.acceptedConnectionPointTypes&&-1!==F.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(F.excludedConnectionPointTypes&&-1!==F.excludedConnectionPointTypes.indexOf(this.type))return 1;let C=Q,z=b;return 0===this.direction&&(C=b,z=Q),C.isAnAncestorOf(z)?2:0}connectTo(F){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(F))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${F.ownerBlock.name}".${F.name}`;return this._endpoints.push(F),F._connectedPoint=this,this.onConnectionObservable.notifyObservers(F),F.onConnectionObservable.notifyObservers(this),this}disconnectFrom(F){const b=this._endpoints.indexOf(F);return-1===b||(this._endpoints.splice(b,1),F._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(F),F.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(F){let b=1;for(;b<Tb.All;)F&b||this.excludedConnectionPointTypes.push(b),b<<=1}serialize(){let F=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b={};return b.name=this.name,b.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Lb?(b.valueType="BABYLON."+this.value.getClassName(),b.value=this.value.Lb()):(b.valueType="number",b.value=this.value)),F&&this.connectedPoint&&(b.inputName=this.name,b.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,b.targetConnectionName=this.connectedPoint.name,b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(b.isExposedOnFrame=!0,b.exposedPortPosition=this.exposedPortPosition),b}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class Jb{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(F){this._name=F}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(F){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new r.c,this.Kb=new r.c,this.onInputChangedObservable=new r.c,this.visibleOnFrame=!1,this._name=F,this.uniqueId=l.e.UniqueId}_inputRename(F){return F}_outputRename(F){return F}isAnAncestorOf(F){for(const b of this._outputs)if(b.hasEndpoints)for(const Q of b.endpoints){if(Q.ownerBlock===F)return!0;if(Q.ownerBlock.isAnAncestorOf(F))return!0}return!1}isAnAncestorOfType(F){if(this.getClassName()===F)return!0;for(const b of this._outputs)if(b.hasEndpoints)for(const Q of b.endpoints)if(Q.ownerBlock.isAnAncestorOfType(F))return!0;return!1}getInputByName(F){const b=this._inputs.filter((b=>b.name===F));return b.length?b[0]:null}_linkConnectionTypes(F,b){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[b]._acceptedConnectionPointType=this._inputs[F]:(this._inputs[F]._linkedConnectionSource=this._inputs[b],this._inputs[F]._isMainLinkSource=!0),this._inputs[b]._linkedConnectionSource=this._inputs[F]}registerInput(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0,t=arguments.length>5?arguments[5]:void 0;const g=new vb(F,this,0);return g.type=b,g.isOptional=Q,g.defaultValue=C,g.value=C,g.valueMin=z,g.valueMax=t,this._inputs.push(g),this.onInputChangedObservable.notifyObservers(g),this}registerOutput(F,b,Q){return(Q=Q??new vb(F,this,1)).type=b,this._outputs.push(Q),this}_build(F){}_customBuildStep(F){}build(F){if(this._buildId===F.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((F=>F.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=F.buildId;for(const b of this._inputs){if(!b.connectedPoint){b.isOptional||F.notConnectedNonOptionalInputs.push(b);continue}const Q=b.connectedPoint.ownerBlock;Q&&Q!==this&&!Q.isSystem&&Q.build(F)}return this._customBuildStep(F),F.verbose&&T.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(F),this.onBuildObservable.notifyObservers(this),!1}serialize(){const F={};F.customType="BABYLON."+this.getClassName(),F.id=this.uniqueId,F.name=this.name,F.visibleOnFrame=this.visibleOnFrame,F.inputs=[],F.outputs=[];for(const b of this.inputs)F.inputs.push(b.serialize());for(const b of this.outputs)F.outputs.push(b.serialize(!1));return F}_deserialize(F){this._name=F.name,this.comments=F.comments,this.visibleOnFrame=!!F.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(F)}_deserializePortDisplayNamesAndExposedOnFrame(F){const b=F.inputs,Q=F.outputs;if(b)for(const C of b){const F=this.inputs.find((F=>F.name===C.name));if(!F)return;if(C.displayName&&(F.displayName=C.displayName),C.isExposedOnFrame&&(F.isExposedOnFrame=C.isExposedOnFrame,F.exposedPortPosition=C.exposedPortPosition),void 0!==C.value&&null!==C.value)if("number"===C.valueType)F.value=C.value;else{const b=(0,W.d)(C.valueType);b&&(F.value=b.KQ(C.value))}}if(Q)for(let C=0;C<Q.length;C++){const F=Q[C];F.displayName&&(this.outputs[C].displayName=F.displayName),F.isExposedOnFrame&&(this.outputs[C].isExposedOnFrame=F.isExposedOnFrame,this.outputs[C].exposedPortPosition=F.exposedPortPosition)}}clone(){const F=this.serialize(),b=(0,W.d)(F.customType);if(b){const Q=new b;return Q._deserialize(F),Q}return null}dispose(){this.Kb.notifyObservers(this),this.Kb.clear();for(const F of this.inputs)F.dispose();for(const F of this.outputs)F.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Ib(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",C=arguments.length>3?arguments[3]:void 0;return(z,t)=>{let g=z._propStore;g||(g=[],z._propStore=g),g.push({propertyName:t,displayName:F,type:b,groupName:Q,options:C??{},className:z.getClassName()})}}(0,Y.b)([(0,s.A)("comment")],Jb.prototype,"comments",void 0),function(F){F[F.Boolean=0]="Boolean",F[F.Float=1]="Float",F[F.Int=2]="Int",F[F.Vector2=3]="Vector2",F[F.List=4]="List",F[F.sb=5]="sb",F[F.SamplingMode=6]="SamplingMode",F[F.TextureFormat=7]="TextureFormat",F[F.TextureType=8]="TextureType"}(Ob||(Ob={})),function(F){F[F.None=0]="None",F[F.Position=1]="Position",F[F.Direction=2]="Direction",F[F.Age=3]="Age",F[F.Lifetime=4]="Lifetime",F[F.Color=5]="Color",F[F.ScaledDirection=6]="ScaledDirection",F[F.Scale=7]="Scale",F[F.AgeGradient=8]="AgeGradient",F[F.Angle=9]="Angle",F[F.SpriteCellIndex=16]="SpriteCellIndex",F[F.SpriteCellStart=17]="SpriteCellStart",F[F.SpriteCellEnd=18]="SpriteCellEnd"}(xb||(xb={})),function(F){F[F.None=0]="None",F[F.Time=1]="Time",F[F.Delta=2]="Delta",F[F.Emitter=3]="Emitter"}(ab||(ab={}));class Mb{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let F="";for(const b of this.notConnectedNonOptionalInputs)F+=`input ${b.name} from block ${b.ownerBlock.name}[${b.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(F)throw"Build of Node Particle System Set failed:\n"+F}adapt(F,b){const Q=F.getConnectedValue(this)||0;if(F.type===b)return Q;switch(b){case Tb.Vector2:return new C.Vector2(Q,Q);case Tb.gQ:return new C.gQ(Q,Q,Q);case Tb.sb:return new g.sb(Q,Q,Q,Q)}return null}getContextualValue(F){if(!this.particleContext||!this.systemContext)return null;switch(F){case xb.Position:return this.particleContext.position;case xb.Direction:return this.particleContext.direction;case xb.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case xb.Color:return this.particleContext.color;case xb.Age:return this.particleContext.age;case xb.Lifetime:return this.particleContext.lifeTime;case xb.Angle:return this.particleContext.angle;case xb.Scale:return this.particleContext.scale;case xb.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case xb.SpriteCellEnd:return this.systemContext.endSpriteCellID;case xb.SpriteCellIndex:return this.particleContext.cellIndex;case xb.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Cb.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Cb.absolutePosition:this.systemContext.Cb:null}getSystemValue(F){if(!this.particleContext||!this.systemContext)return null;switch(F){case ab.Time:return this.systemContext._actualFrame;case ab.Delta:return this.systemContext._scaledUpdateSpeed;case ab.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Cb.absolutePosition}return this.systemContext.Cb}return null}}function rb(F,b,Q){const C=new Mb;C.ZQ=b;const z=F.createSystem(C);return z.canStart=()=>!0,z.Cb=Q.clone(),z.disposeOnStop=!0,z.start(),z}class Hb extends Jb{constructor(F){super(F),this.blendMode=Z.BLENDMODE_ONEONE,this.NQ=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Tb.Particle),this.registerInput("texture",Tb.Texture),this.registerInput("onStart",Tb.System,!0),this.registerInput("onEnd",Tb.System,!0),this.registerOutput("system",Tb.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(F){F.NQ=this.NQ,F.buildId=this._buildId++,this.build(F);const b=this.particle.getConnectedValue(F);return b.particleTexture=this.texture.getConnectedValue(F),b.emitRate=this.emitRate,b.blendMode=this.blendMode,b.name=this.name,b._nodeGenerated=!0,b._targetStopDuration=this.targetStopDuration,b.startDelay=this.startDelay,this.system._storedValue=this,b.canStart=()=>!this.doNoStart,b.onStartedObservable.add((Q=>{const C=this.onStart.getConnectedValue(F);C&&Q.onStartedObservable.addOnce((()=>{F.systemContext=b;const Q=rb(C,F.ZQ,F.emitterPosition);this.Kb.addOnce((()=>{Q.dispose()}))}));const z=this.onEnd.getConnectedValue(F);z&&Q.onStoppedObservable.addOnce((()=>{F.systemContext=b;const Q=rb(z,F.ZQ,F.emitterPosition);this.Kb.addOnce((()=>{Q.dispose()}))}))})),this.Kb.addOnce((()=>{b.dispose()})),b}serialize(){const F=super.serialize();return F.NQ=this.NQ,F.emitRate=this.emitRate,F.blendMode=this.blendMode,F.doNoStart=this.doNoStart,F.targetStopDuration=this.targetStopDuration,F.startDelay=this.startDelay,F}_deserialize(F){super._deserialize(F),this.NQ=F.NQ,this.emitRate=F.emitRate,this.doNoStart=!!F.doNoStart,void 0!==F.blendMode&&(this.blendMode=F.blendMode),void 0!==F.targetStopDuration&&(this.targetStopDuration=F.targetStopDuration),void 0!==F.startDelay&&(this.startDelay=F.startDelay)}}(0,Y.b)([Ib("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:Z.BLENDMODE_ONEONE},{label:"Standard",value:Z.BLENDMODE_STANDARD},{label:"Add",value:Z.BLENDMODE_ADD},{label:"Multiply",value:Z.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:Z.BLENDMODE_MULTIPLYADD}]})],Hb.prototype,"blendMode",void 0),(0,Y.b)([Ib("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Hb.prototype,"NQ",void 0),(0,Y.b)([Ib("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hb.prototype,"emitRate",void 0),(0,Y.b)([Ib("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hb.prototype,"targetStopDuration",void 0),(0,Y.b)([Ib("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Hb.prototype,"startDelay",void 0),(0,Y.b)([Ib("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Hb.prototype,"doNoStart",void 0),(0,W.g)("BABYLON.SystemBlock",Hb);class Bb extends Jb{get type(){if(this._type===Tb.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Tb.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Tb.Vector2,this._type;case"gQ":return this._type=Tb.gQ,this._type;case"sb":return this._type=Tb.sb,this._type;case"Matrix":return this._type=Tb.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===xb.None&&this._systemSource!==ab.None}get systemSource(){return this._systemSource}set systemSource(F){if(this._systemSource=F,F!==ab.None){switch(this._contextualSource=xb.None,this._type=Tb.Float,F){case ab.Time:case ab.Delta:this._type=Tb.Float;break;case ab.Emitter:this._type=Tb.gQ}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==xb.None}get contextualValue(){return this._contextualSource}set contextualValue(F){if(this._contextualSource=F,F!==xb.None){switch(this._systemSource=ab.None,F){case xb.Scale:this._type=Tb.Vector2;break;case xb.Position:case xb.Direction:case xb.ScaledDirection:this._type=Tb.gQ;break;case xb.Color:this._type=Tb.sb;break;case xb.Age:case xb.Lifetime:case xb.Angle:case xb.AgeGradient:this._type=Tb.Float;break;case xb.SpriteCellEnd:case xb.SpriteCellStart:case xb.SpriteCellIndex:this._type=Tb.Int}this.output&&(this.output.type=this._type)}}constructor(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tb.AutoDetect;super(F),this._type=Tb.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new r.c,this._systemSource=ab.None,this._contextualSource=xb.None,this._type=b,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",b)}get value(){return this._storedValue}set value(F){this.type===Tb.Float&&this.min!==this.max&&(F=Math.max(this.min,F),F=Math.min(this.max,F)),this._storedValue=F,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(F){this._valueCallback=F}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Tb.Int:case Tb.Float:this.value=0;break;case Tb.Vector2:this.value=C.Vector2.Zero();break;case Tb.gQ:this.value=C.gQ.Zero();break;case Tb.sb:this.value=new g.sb(1,1,1,1);break;case Tb.Matrix:this.value=C.Matrix.Identity()}}_build(F){super._build(F),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=F=>F.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=F=>F.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const F=super.serialize();return F.type=this.type,F.contextualValue=this.contextualValue,F.systemSource=this.systemSource,F.min=this.min,F.max=this.max,F.groupInInspector=this.groupInInspector,F.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Lb?(F.valueType="BABYLON."+this._storedValue.getClassName(),F.value=this._storedValue.Lb()):(F.valueType="number",F.value=this._storedValue)),F}_deserialize(F){if(super._deserialize(F),this._type=F.type,this.contextualValue=F.contextualValue,this.systemSource=F.systemSource||ab.None,this.min=F.min||0,this.max=F.max||0,this.groupInInspector=F.groupInInspector||"",void 0!==F.displayInInspector&&(this.displayInInspector=F.displayInInspector),F.valueType)if("number"===F.valueType)this._storedValue=F.value;else{const b=(0,W.d)(F.valueType);b&&(this._storedValue=b.KQ(F.value))}}}(0,W.g)("BABYLON.ParticleInputBlock",Bb);class db extends Jb{get url(){return this._url}set url(F){this._url!==F&&(this._cachedData=null,this._url=F,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(F){this._textureDataUrl!==F&&(this._cachedData=null,this._textureDataUrl=F,this._url="",this._sourceTexture=null)}set sourceTexture(F){this._sourceTexture!==F&&(this._cachedData=null,this._sourceTexture=F,this._url="",this._textureDataUrl="")}constructor(F){super(F),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Tb.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const F=this.texture._storedValue;return await new Promise(((b,Q)=>{if(!F.isReady())return void F.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),b(this._cachedData)}catch(F){Q(F)}}));const C=F.getSize();Yb.j.GetTextureDataAsync(F,C.width,C.height).then((Q=>{this._cachedData={width:C.width,height:C.height,data:new Uint8ClampedArray(Q)},F.dispose(),b(this._cachedData)})).catch(Q)}))}_build(F){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new h.b(this._textureDataUrl,F.ZQ):this.texture._storedValue=new h.b(this._url,F.ZQ):this.texture._storedValue=null}serialize(){const F=super.serialize();return F.url=this.url,F.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(F.textureDataUrl=this.textureDataUrl),F}_deserialize(F){super._deserialize(F),this.url=F.url,this.serializedCachedData=!!F.serializedCachedData,F.textureDataUrl&&(this.textureDataUrl=F.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,W.g)("BABYLON.ParticleTextureSourceBlock",db);class FQ extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("position",Tb.gQ),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(F){const b=this.particle.getConnectedValue(F);if(this.output._storedValue=b,!this.position.isConnected)return;const Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.position.W(this.position.getConnectedValue(F))},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q}}(0,W.g)("BABYLON.UpdatePositionBlock",FQ),function(F){F[F.Add=0]="Add",F[F.Subtract=1]="Subtract",F[F.Multiply=2]="Multiply",F[F.Divide=3]="Divide",F[F.Max=4]="Max",F[F.Min=5]="Min"}(Ab||(Ab={}));class bQ extends Jb{constructor(F){super(F),this.operation=Ab.Add,this.registerInput("left",Tb.AutoDetect),this.registerInput("right",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this.output._typeConnectionSource=this.left;const b=[Tb.Matrix,Tb.Particle,Tb.Texture,Tb.System,Tb.FloatGradient,Tb.Color4Gradient,Tb.Vector2Gradient,Tb.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...b),this.right.excludedConnectionPointTypes.push(...b),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(F){let b;const Q=this.left,z=this.right;if(!Q.isConnected||!z.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const t=Q.type===Tb.Float||Q.type===Tb.Int,W=z.type===Tb.Float||z.type===Tb.Int,Z=t&&W;switch(this.operation){case Ab.Add:b=Z?F=>Q.getConnectedValue(F)+z.getConnectedValue(F):t?F=>F.adapt(Q,z.type).add(z.getConnectedValue(F)):F=>Q.getConnectedValue(F).add(F.adapt(z,Q.type));break;case Ab.Subtract:b=Z?F=>Q.getConnectedValue(F)-z.getConnectedValue(F):t?F=>F.adapt(Q,z.type).WQ(z.getConnectedValue(F)):F=>Q.getConnectedValue(F).WQ(F.adapt(z,Q.type));break;case Ab.Multiply:b=Z?F=>Q.getConnectedValue(F)*z.getConnectedValue(F):t?F=>F.adapt(Q,z.type).multiply(z.getConnectedValue(F)):F=>Q.getConnectedValue(F).multiply(F.adapt(z,Q.type));break;case Ab.Divide:b=Z?F=>Q.getConnectedValue(F)/z.getConnectedValue(F):t?F=>F.adapt(Q,z.type).divide(z.getConnectedValue(F)):F=>Q.getConnectedValue(F).divide(F.adapt(z,Q.type));break;case Ab.Min:if(Z)b=F=>Math.min(Q.getConnectedValue(F),z.getConnectedValue(F));else{const[F,W]=t?[z,Q]:[Q,z];switch(F.type){case Tb.Vector2:b=b=>C.Vector2.Minimize(F.getConnectedValue(b),b.adapt(W,F.type));break;case Tb.gQ:b=b=>C.gQ.Minimize(F.getConnectedValue(b),b.adapt(W,F.type));break;case Tb.sb:b=b=>{const Q=F.getConnectedValue(b),{r:C,g:z,b:t,a:Z}=b.adapt(W,F.type);return new g.sb(Math.min(Q.r,C),Math.min(Q.g,z),Math.min(Q.b,t),Math.min(Q.a,Z))}}}break;case Ab.Max:if(!Z){const[F,W]=t?[z,Q]:[Q,z];switch(F.type){case Tb.Vector2:b=b=>C.Vector2.Maximize(F.getConnectedValue(b),b.adapt(W,F.type));break;case Tb.gQ:b=b=>C.gQ.Maximize(F.getConnectedValue(b),b.adapt(W,F.type));break;case Tb.sb:b=b=>{const Q=F.getConnectedValue(b),{r:C,g:z,b:t,a:Z}=b.adapt(W,F.type);return new g.sb(Math.max(Q.r,C),Math.min(Q.g,z),Math.min(Q.b,t),Math.min(Q.a,Z))}}break}b=F=>Math.max(Q.getConnectedValue(F),z.getConnectedValue(F))}this.output._storedFunction=F=>Q.type===Tb.Int?0|b(F):b(F)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Tb.Int||this.left.type===Tb.Float&&this.right.type!==Tb.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[F,b]of[[this.left,this.right],[this.right,this.left]])F.acceptedConnectionPointTypes=[Tb.Int,Tb.Float],b.isConnected&&(F.acceptedConnectionPointTypes.push(b.type),b.type!==Tb.Int&&b.type!==Tb.Float||F.acceptedConnectionPointTypes.push(Tb.Vector2,Tb.gQ,Tb.sb))}dispose(){super.dispose();for(const F of this._connectionObservers)F.remove();this._connectionObservers.length=0}serialize(){const F=super.serialize();return F.operation=this.operation,F}_deserialize(F){super._deserialize(F),this.operation=F.operation}}(0,Y.b)([Ib("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Ab.Add},{label:"Subtract",value:Ab.Subtract},{label:"Multiply",value:Ab.Multiply},{label:"Divide",value:Ab.Divide},{label:"Max",value:Ab.Max},{label:"Min",value:Ab.Min}]})],bQ.prototype,"operation",void 0),(0,W.g)("BABYLON.ParticleMathBlock",bQ);class QQ extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("direction1",Tb.gQ,!0,new C.gQ(0,1,0)),this.registerInput("direction2",Tb.gQ,!0,new C.gQ(0,1,0)),this.registerInput("minEmitBox",Tb.gQ,!0,new C.gQ(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Tb.gQ,!0,new C.gQ(.5,.5,.5)),this.registerOutput("output",Tb.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(F){const b=this.particle.getConnectedValue(F);b._directionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.direction1.getConnectedValue(F),t=this.direction2.getConnectedValue(F),g=(0,q.RandomRange)(z.x,t.x),W=(0,q.RandomRange)(z.y,t.y),Z=(0,q.RandomRange)(z.z,t.z);F.isEmitterTransformNode?C.gQ.TransformNormalFromFloatsToRef(g,W,Z,F.emitterWorldMatrix,Q.direction):Q.direction.jb(g,W,Z)},b._positionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.minEmitBox.getConnectedValue(F),t=this.maxEmitBox.getConnectedValue(F),g=(0,q.RandomRange)(z.x,t.x),W=(0,q.RandomRange)(z.y,t.y),Z=(0,q.RandomRange)(z.z,t.z);F.isEmitterTransformNode?C.gQ.TransformCoordinatesFromFloatsToRef(g,W,Z,F.emitterWorldMatrix,Q.position):(Q.position.jb(g,W,Z),Q.position.addInPlace(F.emitterPosition))},this.output._storedValue=b}}(0,W.g)("BABYLON.BoxShapeBlock",QQ);class CQ extends Jb{constructor(F){super(F),this.registerInput("emitPower",Tb.Float,!0,1),this.registerInput("lifeTime",Tb.Float,!0,1),this.registerInput("color",Tb.sb,!0,new g.sb(1,1,1,1)),this.registerInput("scale",Tb.Vector2,!0,new C.Vector2(1,1)),this.registerInput("angle",Tb.Float,!0,0),this.registerOutput("particle",Tb.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(F){const b=new Wb(this.name,F.NQ,F.ZQ,null,!1,void 0,!0);b.particleEmitterType=new X,b._lifeTimeCreation.process=(b,Q)=>{F.particleContext=b,b.lifeTime=this.lifeTime.getConnectedValue(F),Q._emitPower=this.emitPower.getConnectedValue(F)},b._colorCreation.process=b=>{F.particleContext=b,b.color.W(this.color.getConnectedValue(F))},b._sizeCreation.process=b=>{F.particleContext=b,b.size=1,b.scale.W(this.scale.getConnectedValue(F))},b._angleCreation.process=b=>{F.particleContext=b,b.angle=this.angle.getConnectedValue(F)},this.particle._storedValue=b}}(0,W.g)("BABYLON.CreateParticleBlock",CQ);class zQ{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const F=[];for(const b of this.attachedBlocks)b.isInput&&F.push(b);return F}constructor(F){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new r.c,this.name=F}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(F){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(F)&&this.attachedBlocks.push(F);for(const Q of F.inputs){const C=Q.connectedPoint;if(C){const Q=C.ownerBlock;Q!==F&&this._initializeBlock(Q,b)}}}async buildAsync(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((Q=>{const C=new Rb;for(const F of this._systemBlocks)this._initializeBlock(F);for(const z of this.systemBlocks){const Q=new Mb;Q.buildId=this._buildId++,Q.ZQ=F,Q.verbose=b;const t=z.createSystem(Q);Q.emitErrors(),C.systems.push(t)}this.onBuildObservable.notifyObservers(this),Q(C)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const F=new Hb("Particle system"),b=new FQ("Update position");b.output.connectTo(F.particle);const Q=new Bb("Position");Q.contextualValue=xb.Position;const C=new Bb("Scaled direction");C.contextualValue=xb.ScaledDirection;const z=new bQ("Add");z.operation=Ab.Add,Q.output.connectTo(z.left),C.output.connectTo(z.right),z.output.connectTo(b.position);const t=new CQ("Create particle"),g=new QQ("Box shape");t.particle.connectTo(g.particle),g.output.connectTo(b.particle);const W=new db("Texture");W.texture.connectTo(F.texture),W.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(F)}removeBlock(F){const b=this.attachedBlocks.indexOf(F);if(b>-1&&this.attachedBlocks.splice(b,1),F.isSystem){const b=this._systemBlocks.indexOf(F);b>-1&&this._systemBlocks.splice(b,1)}}parseSerializedObject(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b||this.clear();const Q={};for(const C of F.AG){const F=(0,W.d)(C.customType);if(F){const b=new F;b._deserialize(C),Q[C.id]=b,this.attachedBlocks.push(b),b.isSystem&&this._systemBlocks.push(b)}}for(const C of this.attachedBlocks)if(C.isTeleportOut){const F=C,b=F._tempEntryPointUniqueId;if(b){const C=Q[b];C&&C.attachToEndpoint(F)}}for(let C=0;C<F.AG.length;C++){const z=F.AG[C],t=Q[z.id];t&&(t.inputs.length&&z.inputs.some((F=>F.targetConnectionName))&&!b||this._restoreConnections(t,F,Q))}if(F.locations||F.editorData&&F.editorData.locations){const C=F.locations||F.editorData.locations;for(const F of C)Q[F.BC]&&(F.BC=Q[F.BC].uniqueId);b&&this.editorData&&this.editorData.locations&&C.concat(this.editorData.locations),F.locations?this.editorData={locations:C}:(this.editorData=F.editorData,this.editorData.locations=C);const z=[];for(const F in Q)z[F]=Q[F].uniqueId;this.editorData.map=z}this.comment=F.comment}_restoreConnections(F,b,Q){for(const C of F.outputs)for(const z of b.AG){const t=Q[z.id];if(t)for(const g of z.inputs)if(Q[g.targetBlockId]!==F||g.targetConnectionName!==C.name);else{const F=t.getInputByName(g.inputName);if(!F||F.isConnected)continue;C.connectTo(F,!0),this._restoreConnections(t,b,Q)}}}serialize(F){const b=F?{}:V.e.Serialize(this);b.editorData=JSON.parse(JSON.stringify(this.editorData));let Q=[];F?Q=F:b.customType="BABYLON.NodeParticleSystemSet",b.AG=[];for(const C of Q)b.AG.push(C.serialize());if(!F)for(const C of this.attachedBlocks)-1===Q.indexOf(C)&&b.AG.push(C.serialize());return b}dispose(){for(const F of this.attachedBlocks)F.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(F){const b=new zQ(F);return b.setToDefault(),b}static Parse(F){const b=V.e.Parse((()=>new zQ(F.name)),F,null);return b.parseSerializedObject(F),b}static ParseFromSnippetAsync(F,b){return"_BLANK"===F?Promise.resolve(zQ.CreateDefault("blank")):new Promise(((Q,C)=>{const z=new pb.b;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const g=JSON.parse(JSON.parse(z.responseText).jsonPayload),W=JSON.parse(g.nodeParticle);b||(b=V.e.Parse((()=>new zQ(F)),W,null)),b.parseSerializedObject(W),b.snippetId=F;try{Q(b)}catch(t){C(t)}}else C("Unable to load the snippet "+F)})),z.open("GET",this.SnippetUrl+"/"+F.replace(/#/g,"/")),z.send()}))}}zQ.EditorURL=`${fb.Tools._DefaultCdnUrl}/v${IF.d.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,zQ.SnippetUrl="https://snippet.babylonjs.com",(0,Y.b)([(0,s.A)()],zQ.prototype,"name",void 0),(0,Y.b)([(0,s.A)("comment")],zQ.prototype,"comment",void 0),function(F){F[F.None=0]="None",F[F.PerParticle=1]="PerParticle",F[F.PerSystem=2]="PerSystem"}(Ub||(Ub={}));class tQ extends Jb{constructor(F){super(F),this._currentLockId=-2,this.lockMode=Ub.PerParticle,this.registerInput("min",Tb.AutoDetect,!0,0),this.registerInput("max",Tb.AutoDetect,!0,1),this.registerOutput("output",Tb.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.gQ|Tb.sb),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.gQ|Tb.sb),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Tb.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let F=null;switch(this._currentLockId=-2,this.min.type){case Tb.AutoDetect:case Tb.Int:case Tb.Float:F=F=>{const b=this.min.getConnectedValue(F)||0,Q=this.max.getConnectedValue(F)||1;return b+Math.random()*(Q-b)};break;case Tb.Vector2:F=F=>{const b=this.min.getConnectedValue(F)||C.Vector2.Zero(),Q=this.max.getConnectedValue(F)||C.Vector2.One();return new C.Vector2(b.x+Math.random()*(Q.x-b.x),b.y+Math.random()*(Q.y-b.y))};break;case Tb.gQ:F=F=>{const b=this.min.getConnectedValue(F)||C.gQ.Zero(),Q=this.max.getConnectedValue(F)||C.gQ.One();return new C.gQ(b.x+Math.random()*(Q.x-b.x),b.y+Math.random()*(Q.y-b.y),b.z+Math.random()*(Q.z-b.z))};break;case Tb.sb:F=F=>{const b=this.min.getConnectedValue(F)||new g.sb(0,0,0,0),Q=this.max.getConnectedValue(F)||new g.sb(1,1,1,1);return new g.sb(b.x+Math.random()*(Q.x-b.x),b.y+Math.random()*(Q.y-b.y),b.z+Math.random()*(Q.z-b.z),b.w+Math.random()*(Q.w-b.w))}}this.output._storedFunction=b=>{var Q;let C=0;switch(this.lockMode){case Ub.PerParticle:C=(null===(Q=b.particleContext)||void 0===Q?void 0:Q.id)||-1;break;case Ub.PerSystem:C=b.buildId||0}return this._currentLockId!==C&&(this.lockMode!==Ub.None&&(this._currentLockId=C),this.output._storedValue=F(b)),this.output._storedValue}}serialize(){const F=super.serialize();return F.lockMode=this.lockMode,F}_deserialize(F){super._deserialize(F),this.lockMode=F.lockMode}}(0,Y.b)([Ib("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Ub.None},{label:"Per particle",value:Ub.PerParticle},{label:"Per system",value:Ub.PerSystem}]})],tQ.prototype,"lockMode",void 0),(0,W.g)("BABYLON.ParticleRandomBlock",tQ);class gQ extends Jb{constructor(F){super(F),this._currentLockId=-2,this.lockMode=Ub.PerParticle,this.registerInput("min",Tb.AutoDetect),this.registerInput("max",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const b=[Tb.Matrix,Tb.Particle,Tb.Texture,Tb.System,Tb.FloatGradient,Tb.Color4Gradient,Tb.Vector2Gradient,Tb.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...b),this.max.excludedConnectionPointTypes.push(...b)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let F=null;switch(this._currentLockId=-2,this.min.type){case Tb.Float:case Tb.Int:F=F=>{const b=this.min.getConnectedValue(F),Q=this.max.getConnectedValue(F);return Math.random()*(Q-b)+b};break;case Tb.Vector2:F=F=>{const b=this.min.getConnectedValue(F),Q=this.max.getConnectedValue(F);return new C.Vector2(Math.random()*(Q.x-b.x)+b.x,Math.random()*(Q.y-b.y)+b.y)};break;case Tb.gQ:F=F=>{const b=this.min.getConnectedValue(F),Q=this.max.getConnectedValue(F);return new C.gQ(Math.random()*(Q.x-b.x)+b.x,Math.random()*(Q.y-b.y)+b.y,Math.random()*(Q.z-b.z)+b.z)};break;case Tb.sb:F=F=>{const b=this.min.getConnectedValue(F),Q=this.max.getConnectedValue(F);return new g.sb(Math.random()*(Q.r-b.r)+b.r,Math.random()*(Q.g-b.g)+b.g,Math.random()*(Q.b-b.b)+b.b,Math.random()*(Q.a-b.a)+b.a)}}this.output._storedFunction=b=>{var Q;let C=0;switch(this.lockMode){case Ub.PerParticle:C=(null===(Q=b.particleContext)||void 0===Q?void 0:Q.id)||-1;break;case Ub.PerSystem:C=b.buildId||0}return this._currentLockId!==C&&(this.lockMode!==Ub.None&&(this._currentLockId=C),this.output._storedValue=F(b)),this.output._storedValue}}serialize(){const F=super.serialize();return F.lockMode=this.lockMode,F}_deserialize(F){super._deserialize(F),void 0!==F.lockMode&&(this.lockMode=F.lockMode)}}(0,Y.b)([Ib("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Ub.None},{label:"Per particle",value:Ub.PerParticle},{label:"Per system",value:Ub.PerSystem}]})],gQ.prototype,"lockMode",void 0),(0,W.g)("BABYLON.RandomRangeBlock",gQ);(0,W.g)("BABYLON.ParticleLerpBlock",class extends Jb{constructor(F){super(F),this.registerInput("left",Tb.AutoDetect),this.registerInput("right",Tb.AutoDetect),this.registerInput("gradient",Tb.Float,!0,0,0,1),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.gQ|Tb.sb)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const F=(F,b,Q)=>(1-F)*b+F*Q;this.output._storedFunction=b=>{const Q=this.left.getConnectedValue(b),z=this.right.getConnectedValue(b),t=this.gradient.getConnectedValue(b);switch(this.left.type){case Tb.Int:case Tb.Float:return F(t,Q,z);case Tb.Vector2:return new C.Vector2(F(t,Q.x,z.x),F(t,Q.y,z.y));case Tb.gQ:return new C.gQ(F(t,Q.x,z.x),F(t,Q.y,z.y),F(t,Q.z,z.z));case Tb.sb:return new g.sb(F(t,Q.r,z.r),F(t,Q.g,z.g),F(t,Q.b,z.b),F(t,Q.a,z.a))}return 0}}});(0,W.g)("BABYLON.UpdateDirectionBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("direction",Tb.gQ),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(F){const b=this.particle.getConnectedValue(F);if(this.output._storedValue=b,!this.direction.isConnected)return;const Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.direction.W(this.direction.getConnectedValue(F))},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q}});(0,W.g)("BABYLON.UpdateColorBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("color",Tb.sb),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(F){const b=this.particle.getConnectedValue(F);if(this.output._storedValue=b,!this.color.isConnected)return;const Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.color.W(this.color.getConnectedValue(F))},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q}});(0,W.g)("BABYLON.UpdateScaleBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("scale",Tb.Vector2),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(F){const b=this.particle.getConnectedValue(F);if(this.output._storedValue=b,!this.scale.isConnected)return;const Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.scale.W(this.scale.getConnectedValue(F))},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q}});(0,W.g)("BABYLON.UpdateAngleBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("angle",Tb.Float),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(F){const b=this.particle.getConnectedValue(F);if(this.output._storedValue=b,!this.angle.isConnected)return;const Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.angle=this.angle.getConnectedValue(F)},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q}});(0,W.g)("BABYLON.BasicPositionUpdateBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(F){const b=this.particle.getConnectedValue(F),Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.direction.scaleToRef(b._directionScale,b._scaledDirection),Q.position.addInPlace(b._scaledDirection)},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q,this.output._storedValue=b}});(0,W.g)("BABYLON.BasicSpriteUpdateBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(F){const b=this.particle.getConnectedValue(F),Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.updateCellIndex()},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q,this.output._storedValue=b}});(0,W.g)("BABYLON.UpdateSpriteCellIndexBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("cellIndex",Tb.Int),this.registerOutput("output",Tb.Particle),this.cellIndex.acceptedConnectionPointTypes=[Tb.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(F){const b=this.particle.getConnectedValue(F);if(this.output._storedValue=b,!this.cellIndex.isConnected)return;const Q={process:Q=>{F.particleContext=Q,F.systemContext=b,Q.cellIndex=Math.floor(this.cellIndex.getConnectedValue(F))},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q}});class WQ extends Jb{constructor(F){super(F),this.strength=1,this.registerInput("particle",Tb.Particle),this.registerInput("flowMap",Tb.Texture),this.registerOutput("output",Tb.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(F){var b;const Q=this.particle.getConnectedValue(F),C=F.ZQ;let z;(null===(b=this.flowMap.connectedPoint)||void 0===b?void 0:b.ownerBlock).extractTextureContentAsync().then((F=>{F&&(z=new lb(F.width,F.height,F.data))}));const t={process:F=>{const b=C.getTransformMatrix();z&&z._processParticle(F,this.strength*Q._tempScaledUpdateSpeed,b)},previousItem:null,nextItem:null};Q._updateQueueStart?aF(t,Q._updateQueueStart):Q._updateQueueStart=t,this.output._storedValue=Q}serialize(){const F=super.serialize();return F.strength=this.strength,F}_deserialize(F){super._deserialize(F),this.strength=F.strength}}(0,Y.b)([Ib("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WQ.prototype,"strength",void 0),(0,W.g)("BABYLON.UpdateFlowMapBlock",WQ);(0,W.g)("BABYLON.SphereShapeBlock",class extends Jb{constructor(F){super(F),this.registerInput("input",Tb.Particle),this.registerInput("radius",Tb.Float,!0,1),this.registerInput("radiusRange",Tb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tb.Float,!0,0,0,1),this.registerOutput("output",Tb.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(F){const b=this.input.getConnectedValue(F);b._directionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.directionRandomizer.getConnectedValue(F),t=Q.position.WQ(F.emitterPosition).normalize(),g=(0,q.RandomRange)(0,z),W=(0,q.RandomRange)(0,z),Z=(0,q.RandomRange)(0,z);t.x+=g,t.y+=W,t.z+=Z,t.normalize(),F.isEmitterTransformNode?C.gQ.TransformNormalFromFloatsToRef(g,W,Z,F.emitterWorldMatrix,Q.direction):Q.direction.jb(g,W,Z)},b._positionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.radius.getConnectedValue(F),t=this.radiusRange.getConnectedValue(F),g=z-(0,q.RandomRange)(0,z*t),W=(0,q.RandomRange)(0,1),Z=(0,q.RandomRange)(0,2*Math.PI),G=Math.acos(2*W-1),K=g*Math.cos(Z)*Math.sin(G),e=g*Math.cos(G),N=g*Math.sin(Z)*Math.sin(G);F.isEmitterTransformNode?C.gQ.TransformCoordinatesFromFloatsToRef(K,e,N,F.emitterWorldMatrix,Q.position):(Q.position.jb(K,e,N),Q.position.addInPlace(F.emitterPosition))},this.output._storedValue=b}});(0,W.g)("BABYLON.PointShapeBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("direction1",Tb.gQ,!0,new C.gQ(0,1,0)),this.registerInput("direction2",Tb.gQ,!0,new C.gQ(0,1,0)),this.registerOutput("output",Tb.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(F){const b=this.particle.getConnectedValue(F);b._directionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.direction1.getConnectedValue(F),t=this.direction2.getConnectedValue(F),g=(0,q.RandomRange)(z.x,t.x),W=(0,q.RandomRange)(z.y,t.y),Z=(0,q.RandomRange)(z.z,t.z);F.isEmitterTransformNode?C.gQ.TransformNormalFromFloatsToRef(g,W,Z,F.emitterWorldMatrix,Q.direction):Q.direction.jb(g,W,Z)},b._positionCreation.process=Q=>{F.systemContext=b,F.isEmitterTransformNode?C.gQ.TransformCoordinatesFromFloatsToRef(0,0,0,F.emitterWorldMatrix,Q.position):Q.position.W(F.emitterPosition)},this.output._storedValue=b}});(0,W.g)("BABYLON.CustomShapeBlock",class extends Jb{constructor(F){super(F),this.registerInput("particle",Tb.Particle),this.registerInput("position",Tb.gQ,!0,new C.gQ(0,0,0)),this.registerInput("direction",Tb.gQ,!0,new C.gQ(0,1,0)),this.registerOutput("output",Tb.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(F){const b=this.particle.getConnectedValue(F);b._directionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.direction.getConnectedValue(F);F.isEmitterTransformNode?C.gQ.TransformNormalToRef(z,F.emitterWorldMatrix,Q.direction):Q.direction.W(z)},b._positionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.position.getConnectedValue(F);F.isEmitterTransformNode?C.gQ.TransformCoordinatesToRef(z,F.emitterWorldMatrix,Q.position):(Q.position.W(z),Q.position.addInPlace(F.emitterPosition))},this.output._storedValue=b}});(0,W.g)("BABYLON.CylinderShapeBlock",class extends Jb{constructor(F){super(F),this._tempVector=C.gQ.Zero(),this.registerInput("particle",Tb.Particle),this.registerInput("radius",Tb.Float,!0,1),this.registerInput("height",Tb.Float,!0,1,0),this.registerInput("radiusRange",Tb.Float,!0,1,0,1),this.registerInput("directionRandomizer",Tb.Float,!0,0,0,1),this.registerOutput("output",Tb.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(F){const b=this.particle.getConnectedValue(F);b._directionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.directionRandomizer.getConnectedValue(F);Q.position.subtractToRef(F.emitterPosition,this._tempVector),this._tempVector.normalize(),F.isEmitterTransformNode&&C.gQ.TransformNormalToRef(this._tempVector,F.emitterInverseWorldMatrix,this._tempVector);const t=(0,q.RandomRange)(-z/2,z/2);let g=Math.atan2(this._tempVector.x,this._tempVector.z);g+=(0,q.RandomRange)(-Math.PI/2,Math.PI/2)*z,this._tempVector.y=t,this._tempVector.x=Math.sin(g),this._tempVector.z=Math.cos(g),this._tempVector.normalize(),F.isEmitterTransformNode?C.gQ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,F.emitterWorldMatrix,Q.direction):Q.direction.W(this._tempVector)},b._positionCreation.process=Q=>{F.particleContext=Q,F.systemContext=b;const z=this.height.getConnectedValue(F),t=this.radiusRange.getConnectedValue(F),g=this.radius.getConnectedValue(F),W=(0,q.RandomRange)(-z/2,z/2),Z=(0,q.RandomRange)(0,2*Math.PI),G=(0,q.RandomRange)((1-t)*(1-t),1),K=Math.sqrt(G)*g,e=K*Math.cos(Z),N=K*Math.sin(Z);F.isEmitterTransformNode?C.gQ.TransformCoordinatesFromFloatsToRef(e,W,N,F.emitterWorldMatrix,Q.position):(Q.position.jb(e,W,N),Q.position.addInPlace(F.emitterPosition))},this.output._storedValue=b}});class ZQ extends Jb{constructor(F){super(F),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Tb.Particle),this.registerOutput("output",Tb.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){super._build(F);const b=this.particle.getConnectedValue(F);b._isAnimationSheetEnabled=!0,b.spriteCellWidth=this.width,b.spriteCellHeight=this.height,b.startSpriteCellID=this.start,b.endSpriteCellID=this.end,b.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=b}serialize(){const F=super.serialize();return F.width=this.width,F.height=this.height,F.start=this.start,F.end=this.end,F.randomStartCell=this.randomStartCell,F}_deserialize(F){super._deserialize(F),this.width=F.width,this.height=F.height,this.start=F.start,this.end=F.end,this.randomStartCell=F.randomStartCell}}(0,Y.b)([Ib("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ZQ.prototype,"start",void 0),(0,Y.b)([Ib("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ZQ.prototype,"end",void 0),(0,Y.b)([Ib("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ZQ.prototype,"width",void 0),(0,Y.b)([Ib("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ZQ.prototype,"height",void 0),(0,Y.b)([Ib("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ZQ.prototype,"loop",void 0),(0,Y.b)([Ib("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ZQ.prototype,"randomStartCell",void 0),(0,W.g)("BABYLON.SetupSpriteSheetBlock",ZQ);class qQ extends Jb{constructor(F){super(F),this.reference=0,this.registerInput("value",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=F=>{switch(F){case Tb.Float:return Tb.FloatGradient;case Tb.Vector2:return Tb.Vector2Gradient;case Tb.gQ:return Tb.Vector3Gradient;case Tb.sb:return Tb.Color4Gradient}return F},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Vector2|Tb.gQ|Tb.sb)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=F=>null}serialize(){const F=super.serialize();return F.reference=this.reference,F}_deserialize(F){super._deserialize(F),this.reference=F.reference}}(0,Y.b)([Ib("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],qQ.prototype,"reference",void 0),(0,W.g)("BABYLON.ParticleGradientValueBlock",qQ);(0,W.g)("BABYLON.ParticleGradientBlock",class extends Jb{constructor(F){super(F),this._entryCount=1,this.registerInput("gradient",Tb.Float,!0,1,0,1),this.registerInput("value0",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=F=>{switch(F){case Tb.FloatGradient:return Tb.Float;case Tb.Vector2Gradient:return Tb.Vector2;case Tb.Vector3Gradient:return Tb.gQ;case Tb.Color4Gradient:return Tb.sb}return F},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Tb.FloatGradient|Tb.Vector2Gradient|Tb.Vector3Gradient|Tb.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(F){this._inputs[F].onConnectionObservable.add((()=>{this._entryCount>F||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Tb.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const F=[];for(let Q=1;Q<this._inputs.length;Q++){var b;if(this._inputs[Q].isConnected)F.push(null===(b=this._inputs[Q].connectedPoint)||void 0===b?void 0:b.ownerBlock)}F.sort(((F,b)=>F.reference-b.reference)),this.output._storedFunction=b=>{const Q=this.gradient.getConnectedValue(b);if(1===F.length)return F[0].value.getConnectedValue(b);let z=null;for(let t=F.length-1;t>=0;t--){const W=F[t];if(W.reference<=Q){const F=W.value.getConnectedValue(b);if(z){const t=z.value.getConnectedValue(b),Z=z.reference,G=W.reference,K=Math.max(0,Math.min(1,(Q-G)/(Z-G)));switch(this.output.type){case Tb.Float:return(0,q.Lerp)(F,t,K);case Tb.Vector2:return C.Vector2.Lerp(F,t,K);case Tb.gQ:return C.gQ.Lerp(F,t,K);case Tb.sb:return g.sb.Lerp(F,t,K)}}return F}z=W}return 0}}});(0,W.g)("BABYLON.ParticleConverterBlock",class extends Jb{constructor(F){super(F),this.registerInput("color ",Tb.sb,!0),this.registerInput("xyz ",Tb.gQ,!0),this.registerInput("xy ",Tb.Vector2,!0),this.registerInput("zw ",Tb.Vector2,!0),this.registerInput("x ",Tb.Float,!0),this.registerInput("y ",Tb.Float,!0),this.registerInput("z ",Tb.Float,!0),this.registerInput("w ",Tb.Float,!0),this.registerOutput("color",Tb.sb),this.registerOutput("xyz",Tb.gQ),this.registerOutput("xy",Tb.Vector2),this.registerOutput("zw",Tb.Vector2),this.registerOutput("x",Tb.Float),this.registerOutput("y",Tb.Float),this.registerOutput("z",Tb.Float),this.registerOutput("w",Tb.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(F){return"color "===F?"colorIn":"xyz "===F?"xyzIn":"xy "===F?"xyIn":"zw "===F?"zwIn":"x "===F?"xIn":"y "===F?"yIn":"z "===F?"zIn":"w "===F?"wIn":F}_outputRename(F){switch(F){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return F}}_build(F){super._build(F);const b=this.xIn,Q=this.yIn,z=this.zIn,t=this.wIn,W=this.xyIn,Z=this.zwIn,q=this.xyzIn,G=this.colorIn,K=this.colorOut,e=this.xyzOut,N=this.xyOut,y=this.zwOut,E=this.xOut,c=this.yOut,X=this.zOut,L=this.wOut,i=F=>{if(G.isConnected)return G.getConnectedValue(F);let C=0,K=0,e=0,N=0;if(b.isConnected&&(C=b.getConnectedValue(F)),Q.isConnected&&(K=Q.getConnectedValue(F)),z.isConnected&&(e=z.getConnectedValue(F)),t.isConnected&&(N=t.getConnectedValue(F)),W.isConnected){const b=W.getConnectedValue(F);b&&(C=b.x,K=b.y)}if(Z.isConnected){const b=Z.getConnectedValue(F);b&&(e=b.x,N=b.y)}if(q.isConnected){const b=q.getConnectedValue(F);b&&(C=b.x,K=b.y,e=b.z)}return new g.sb(C,K,e,N)};K._storedFunction=F=>i(F),e._storedFunction=F=>{const b=i(F);return new C.gQ(b.r,b.g,b.b)},N._storedFunction=F=>{const b=i(F);return new C.Vector2(b.r,b.g)},y._storedFunction=F=>{const b=i(F);return new C.Vector2(b.b,b.a)},E._storedFunction=F=>i(F).r,c._storedFunction=F=>i(F).g,X._storedFunction=F=>i(F).b,L._storedFunction=F=>i(F).a}}),function(F){F[F.Cos=0]="Cos",F[F.Sin=1]="Sin",F[F.Abs=2]="Abs",F[F.Exp=3]="Exp",F[F.Exp2=4]="Exp2",F[F.Round=5]="Round",F[F.Floor=6]="Floor",F[F.Ceiling=7]="Ceiling",F[F.Sqrt=8]="Sqrt",F[F.Log=9]="Log",F[F.Tan=10]="Tan",F[F.ArcTan=11]="ArcTan",F[F.ArcCos=12]="ArcCos",F[F.ArcSin=13]="ArcSin",F[F.Sign=14]="Sign",F[F.Negate=15]="Negate",F[F.OneMinus=16]="OneMinus",F[F.Reciprocal=17]="Reciprocal",F[F.ToDegrees=18]="ToDegrees",F[F.ToRadians=19]="ToRadians",F[F.Fract=20]="Fract"}(ub||(ub={}));class GQ extends Jb{constructor(F){super(F),this.operation=ub.Cos,this.registerInput("input",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Tb.Float|Tb.Int|Tb.Vector2|Tb.gQ|Tb.sb)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){super._build(F);let b=null;switch(this.operation){case ub.Cos:b=F=>Math.cos(F);break;case ub.Sin:b=F=>Math.sin(F);break;case ub.Abs:b=F=>Math.abs(F);break;case ub.Exp:b=F=>Math.exp(F);break;case ub.Exp2:b=F=>Math.pow(2,F);break;case ub.Round:b=F=>Math.round(F);break;case ub.Floor:b=F=>Math.floor(F);break;case ub.Ceiling:b=F=>Math.ceil(F);break;case ub.Sqrt:b=F=>Math.sqrt(F);break;case ub.Log:b=F=>Math.log(F);break;case ub.Tan:b=F=>Math.tan(F);break;case ub.ArcTan:b=F=>Math.atan(F);break;case ub.ArcCos:b=F=>Math.acos(F);break;case ub.ArcSin:b=F=>Math.asin(F);break;case ub.Sign:b=F=>Math.sign(F);break;case ub.Negate:b=F=>-F;break;case ub.OneMinus:b=F=>1-F;break;case ub.Reciprocal:b=F=>1/F;break;case ub.ToRadians:b=F=>F*Math.PI/180;break;case ub.ToDegrees:b=F=>180*F/Math.PI;break;case ub.Fract:b=F=>F>=0?F-Math.floor(F):F-Math.ceil(F)}if(!b)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Tb.Int:case Tb.Float:this.output._storedFunction=F=>{const Q=this.input.getConnectedValue(F);return b(Q)};break;case Tb.Vector2:this.output._storedFunction=F=>{const Q=this.input.getConnectedValue(F);return new C.Vector2(b(Q.x),b(Q.y))};break;case Tb.gQ:this.output._storedFunction=F=>{const Q=this.input.getConnectedValue(F);return new C.gQ(b(Q.x),b(Q.y),b(Q.z))};break;case Tb.sb:this.output._storedFunction=F=>{const Q=this.input.getConnectedValue(F);return new g.sb(b(Q.r),b(Q.g),b(Q.b),b(Q.a))}}return this}serialize(){const F=super.serialize();return F.operation=this.operation,F}_deserialize(F){super._deserialize(F),this.operation=F.operation}}(0,Y.b)([Ib("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:ub.Cos},{label:"Sin",value:ub.Sin},{label:"Abs",value:ub.Abs},{label:"Exp",value:ub.Exp},{label:"Exp2",value:ub.Exp2},{label:"Round",value:ub.Round},{label:"Floor",value:ub.Floor},{label:"Ceiling",value:ub.Ceiling},{label:"Sqrt",value:ub.Sqrt},{label:"Log",value:ub.Log},{label:"Tan",value:ub.Tan},{label:"ArcTan",value:ub.ArcTan},{label:"ArcCos",value:ub.ArcCos},{label:"ArcSin",value:ub.ArcSin},{label:"Sign",value:ub.Sign},{label:"Negate",value:ub.Negate},{label:"OneMinus",value:ub.OneMinus},{label:"Reciprocal",value:ub.Reciprocal},{label:"ToDegrees",value:ub.ToDegrees},{label:"ToRadians",value:ub.ToRadians},{label:"Fract",value:ub.Fract}]})],GQ.prototype,"operation",void 0),(0,W.g)("BABYLON.ParticleTrigonometryBlock",GQ);var KQ,eQ=Q(12659);class NQ extends Jb{constructor(F){super(F),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Tb.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Tb.System),this._inputs[0].excludedConnectionPointTypes.push(Tb.Particle),this._inputs[0].excludedConnectionPointTypes.push(Tb.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const b=F=>{const b=this.input.getConnectedValue(F);if(this.log.length>=this.stackSize)return b;if(null===b||void 0===b)return this.log.push(["null",""]),b;switch(this.input.type){case Tb.Vector2:this.log.push([(0,eQ.l)(b,4),b.toString()]);break;case Tb.gQ:this.log.push([(0,eQ.m)(b,4),b.toString()]);break;case Tb.sb:this.log.push([`{R: ${b.r.toFixed(4)} G: ${b.g.toFixed(4)} B: ${b.b.toFixed(4)} A: ${b.a.toFixed(4)}}`,b.toString()]);break;default:this.log.push([b.toString(),b.toString()])}return b};this.output.isConnected?this.output._storedFunction=b:this.output._storedValue=b(F)}serialize(){const F=super.serialize();return F.stackSize=this.stackSize,F}_deserialize(F){super._deserialize(F),this.stackSize=F.stackSize}}(0,Y.b)([Ib("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],NQ.prototype,"stackSize",void 0),(0,W.g)("BABYLON.ParticleDebugBlock",NQ);(0,W.g)("BABYLON.ParticleElbowBlock",class extends Jb{constructor(F){super(F),this.registerInput("input",Tb.AutoDetect),this.registerOutput("output",Tb.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(F){super._build(F);const b=this._outputs[0],Q=this._inputs[0];b._storedFunction=F=>Q.getConnectedValue(F)}});(0,W.g)("BABYLON.ParticleTeleportInBlock",class extends Jb{get endpoints(){return this._endpoints}constructor(F){super(F),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Tb.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(F){if(this.getClassName()===F)return!0;for(const b of this.endpoints)if(b.isAnAncestorOfType(F))return!0;return!1}isAnAncestorOf(F){for(const b of this.endpoints){if(b===F)return!0;if(b.isAnAncestorOf(F))return!0}return!1}attachToEndpoint(F){F.detach(),this._endpoints.push(F),F._entryPoint=this,F._outputs[0]._typeConnectionSource=this._inputs[0],F._tempEntryPointUniqueId=null,F.name="> "+this.name}detachFromEndpoint(F){const b=this._endpoints.indexOf(F);-1!==b&&(this._endpoints.splice(b,1),F._outputs[0]._typeConnectionSource=null,F._entryPoint=null)}_build(){for(const F of this._endpoints)F.output._storedFunction=F=>this.input.getConnectedValue(F)}});(0,W.g)("BABYLON.ParticleTeleportOutBlock",class extends Jb{constructor(F){super(F),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Tb.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(F){this.entryPoint&&this.entryPoint.build(F)}clone(){const F=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(F),F}serialize(){var F;const b=super.serialize();return b.entryPoint=(null===(F=this.entryPoint)||void 0===F?void 0:F.uniqueId)??"",b}_deserialize(F){super._deserialize(F),this._tempEntryPointUniqueId=F.entryPoint}}),function(F){F[F.Equal=0]="Equal",F[F.NotEqual=1]="NotEqual",F[F.LessThan=2]="LessThan",F[F.GreaterThan=3]="GreaterThan",F[F.LessOrEqual=4]="LessOrEqual",F[F.GreaterOrEqual=5]="GreaterOrEqual",F[F.Xor=6]="Xor",F[F.Or=7]="Or",F[F.And=8]="And"}(KQ||(KQ={}));class yQ extends Jb{constructor(F){super(F),this.test=KQ.Equal,this.epsilon=0,this.registerInput("left",Tb.Float),this.registerInput("right",Tb.Float,!0,0),this.registerInput("ifTrue",Tb.AutoDetect,!0,1),this.registerInput("ifFalse",Tb.AutoDetect,!0,0),this.registerOutput("output",Tb.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Tb.Float,this._inputs[0].acceptedConnectionPointTypes.push(Tb.Int),this._inputs[1].acceptedConnectionPointTypes.push(Tb.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const F=F=>{const b=this.left.getConnectedValue(F),Q=this.right.getConnectedValue(F);let C=!1;switch(this.test){case KQ.Equal:C=(0,q.WithinEpsilon)(b,Q,this.epsilon);break;case KQ.NotEqual:C=!(0,q.WithinEpsilon)(b,Q,this.epsilon);break;case KQ.LessThan:C=b<Q+this.epsilon;break;case KQ.GreaterThan:C=b>Q-this.epsilon;break;case KQ.LessOrEqual:C=b<=Q+this.epsilon;break;case KQ.GreaterOrEqual:C=b>=Q-this.epsilon;break;case KQ.Xor:C=!!b&&!Q||!b&&!!Q;break;case KQ.Or:C=!!b||!!Q;break;case KQ.And:C=!!b&&!!Q}return C};this.output._storedFunction=b=>F(b)?this.ifTrue.getConnectedValue(b):this.ifFalse.getConnectedValue(b)}serialize(){const F=super.serialize();return F.test=this.test,F.epsilon=this.epsilon,F}_deserialize(F){super._deserialize(F),this.test=F.test,void 0!==F.epsilon&&(this.epsilon=F.epsilon)}}(0,Y.b)([Ib("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:KQ.Equal},{label:"NotEqual",value:KQ.NotEqual},{label:"LessThan",value:KQ.LessThan},{label:"GreaterThan",value:KQ.GreaterThan},{label:"LessOrEqual",value:KQ.LessOrEqual},{label:"GreaterOrEqual",value:KQ.GreaterOrEqual},{label:"Xor",value:KQ.Xor},{label:"Or",value:KQ.Or},{label:"And",value:KQ.And}]})],yQ.prototype,"test",void 0),(0,Y.b)([Ib("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],yQ.prototype,"epsilon",void 0),(0,W.g)("BABYLON.ParticleConditionBlock",yQ);class EQ extends Jb{constructor(F){super(F),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Tb.Particle),this.registerInput("condition",Tb.Float,!0,0),this.registerInput("system",Tb.System),this.registerOutput("output",Tb.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(F){this._triggerCount=0;const b=this.input.getConnectedValue(F),Q={process:Q=>{if(F.particleContext=Q,F.systemContext=b,0!==this.condition.getConnectedValue(F)&&(0===this.limit||this._triggerCount<this.limit)){const C=(new Date).getTime();if(this._previousOne&&C-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=C;const z=this.system.getConnectedValue(F);if(z){const C=rb(z,F.ZQ,Q.position);C.Kb.addOnce((()=>{this._triggerCount--})),b.Kb.addOnce((()=>{C.dispose()}))}}},previousItem:null,nextItem:null};b._updateQueueStart?aF(Q,b._updateQueueStart):b._updateQueueStart=Q,this.output._storedValue=b}serialize(){const F=super.serialize();return F.limit=this.limit,F.delay=this.delay,F}_deserialize(F){super._deserialize(F),void 0!==F.limit&&(this.limit=F.limit),void 0!==F.delay&&(this.delay=F.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,Y.b)([Ib("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],EQ.prototype,"limit",void 0),(0,Y.b)([Ib("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],EQ.prototype,"delay",void 0),(0,W.g)("BABYLON.ParticleTriggerBlock",EQ);Q(12663),Q(12680),Q(12687),Q(12740)},12725:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12696:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12756:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneVertex",t="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12748:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12737:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogFragment",t="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12717:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12759:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogVertex",t="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12751:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogVertexDeclaration",t="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12711:(F,b,Q)=>{"use strict";var C=Q(11219);const z="helperFunctions",t="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12703:(F,b,Q)=>{"use strict";var C=Q(11219);const z="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12714:(F,b,Q)=>{"use strict";var C=Q(11219);const z="imageProcessingFunctions",t="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12706:(F,b,Q)=>{"use strict";var C=Q(11219);const z="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12728:(F,b,Q)=>{"use strict";var C=Q(11219);const z="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12767:(F,b,Q)=>{"use strict";var C=Q(11219);const z="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";C.e.IncludesShadersStoreWGSL[z]||(C.e.IncludesShadersStoreWGSL[z]=t)},12687:(F,b,Q)=>{"use strict";Q.r(b),Q.d(b,{particlesPixelShaderWGSL:()=>g});var C=Q(11219);Q(12696),Q(12703),Q(12706),Q(12711),Q(12714),Q(12717),Q(12725),Q(12728),Q(12737);const z="particlesPixelShader",t="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.e.ShadersStoreWGSL[z]||(C.e.ShadersStoreWGSL[z]=t);const g={name:z,shader:t}},12740:(F,b,Q)=>{"use strict";Q.r(b),Q.d(b,{particlesVertexShaderWGSL:()=>g});var C=Q(11219);Q(12748),Q(12751),Q(12706),Q(12756),Q(12759),Q(12767);const z="particlesVertexShader",t="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.e.ShadersStoreWGSL[z]||(C.e.ShadersStoreWGSL[z]=t);const g={name:z,shader:t}},12586:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneFragment",t="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12672:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneFragmentDeclaration",t="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12617:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneVertex",t="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12682:(F,b,Q)=>{"use strict";var C=Q(11219);const z="clipPlaneVertexDeclaration",t="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12602:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogFragment",t="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12584:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogFragmentDeclaration",t="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12622:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogVertex",t="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12609:(F,b,Q)=>{"use strict";var C=Q(11219);const z="fogVertexDeclaration",t="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12573:(F,b,Q)=>{"use strict";var C=Q(11219);const z="helperFunctions",t="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12563:(F,b,Q)=>{"use strict";var C=Q(11219);const z="imageProcessingDeclaration",t="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12577:(F,b,Q)=>{"use strict";var C=Q(11219);const z="imageProcessingFunctions",t="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12565:(F,b,Q)=>{"use strict";var C=Q(11219);const z="logDepthDeclaration",t="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12595:(F,b,Q)=>{"use strict";var C=Q(11219);const z="logDepthFragment",t="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12631:(F,b,Q)=>{"use strict";var C=Q(11219);const z="logDepthVertex",t="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";C.e.IncludesShadersStore[z]||(C.e.IncludesShadersStore[z]=t)},12663:(F,b,Q)=>{"use strict";Q.r(b),Q.d(b,{particlesPixelShader:()=>g});var C=Q(11219);Q(12672),Q(12563),Q(12565),Q(12573),Q(12577),Q(12584),Q(12586),Q(12595),Q(12602);const z="particlesPixelShader",t="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";C.e.ShadersStore[z]||(C.e.ShadersStore[z]=t);const g={name:z,shader:t}},12680:(F,b,Q)=>{"use strict";Q.r(b),Q.d(b,{particlesVertexShader:()=>g});var C=Q(11219);Q(12682),Q(12609),Q(12565),Q(12617),Q(12622),Q(12631);const z="particlesVertexShader",t="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";C.e.ShadersStore[z]||(C.e.ShadersStore[z]=t);const g={name:z,shader:t}},13007:(F,b,Q)=>{"use strict";Q.r(b),Q.d(b,{FlowGraphGLTFDataProvider:()=>t});var C=Q(12972),z=Q(12951);class t extends C.b{constructor(F){var b,Q;super();const C=F.glTF,t=(null===(b=C.animations)||void 0===b?void 0:b.map((F=>F._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",z.b,t);const g=(null===(Q=C.nodes)||void 0===Q?void 0:Q.map((F=>F._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",z.b,g)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12895:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>c,c:()=>y,e:()=>N,g:()=>E});var C=Q(11309),z=Q(11776),t=Q(11359),g=Q(12903);const W=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class Z{constructor(F,b){this._gltf=F,this._infoTree=b}convert(F){let b,Q=this._gltf,C=this._infoTree;if(!F.startsWith("/"))throw new Error("Path must start with a /");const z=F.split("/");if(z.shift(),z[z.length-1].includes(".length")){const F=z[z.length-1].split(".");z.pop(),z.push(...F)}let t=!1;for(const Z of z){const z="length"===Z;if(z&&!C.__array__)throw new Error(`Path ${F} is invalid`);if(C.__ignoreObjectTree__&&(t=!0),C.__array__&&!z)C=C.__array__;else if(C=C[Z],!C)throw new Error(`Path ${F} is invalid`);if(!t)if(void 0===Q){if(!W.find((b=>b.regex.test(F))))throw new Error(`Path ${F} is invalid`)}else if(!z){var g;Q=null===(g=Q)||void 0===g?void 0:g[Z]}(C.__target__||z)&&(b=Q)}return{object:b,info:C}}}function q(F,b,Q,C){const z=G(F,b);return C?z[Q][C]:z[Q]}function G(F,b,Q){var C,t;return null===(C=F._data)||void 0===C||null===(t=C[(null===Q||void 0===Q?void 0:Q.fillMode)??z.c.MATERIAL_TriangleFillMode])||void 0===t?void 0:t.babylonMaterial}function K(F,b){return{offset:{componentsCount:2,type:"Vector2",get:(Q,z,t)=>{const g=q(Q,t,F,b);return new C.Vector2(null===g||void 0===g?void 0:g.uOffset,null===g||void 0===g?void 0:g.vOffset)},getTarget:G,set:(Q,C,z,t)=>{const g=q(C,t,F,b);g.uOffset=Q.x,g.vOffset=Q.y},getPropertyName:[()=>`${F}${b?"."+b:""}.uOffset`,()=>`${F}${b?"."+b:""}.vOffset`]},rotation:{type:"number",get:(Q,C,z)=>{var t;return null===(t=q(Q,z,F,b))||void 0===t?void 0:t.wAng},getTarget:G,set:(Q,C,z,t)=>q(C,t,F,b).wAng=Q,getPropertyName:[()=>`${F}${b?"."+b:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(Q,z,t)=>{const g=q(Q,t,F,b);return new C.Vector2(null===g||void 0===g?void 0:g.uScale,null===g||void 0===g?void 0:g.vScale)},getTarget:G,set:(Q,C,z,t)=>{const g=q(C,t,F,b);g.uScale=Q.x,g.vScale=Q.y},getPropertyName:[()=>`${F}${b?"."+b:""}.uScale`,()=>`${F}${b?"."+b:""}.vScale`]}}}const e={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:F=>{var b,Q;return new C.Vector2((null===(b=F._babylonCamera)||void 0===b?void 0:b.orthoLeft)??0,(null===(Q=F._babylonCamera)||void 0===Q?void 0:Q.orthoRight)??0)},set:(F,b)=>{b._babylonCamera&&(b._babylonCamera.orthoLeft=F.x,b._babylonCamera.orthoRight=F.y)},getTarget:F=>F,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:F=>{var b,Q;return new C.Vector2((null===(b=F._babylonCamera)||void 0===b?void 0:b.orthoBottom)??0,(null===(Q=F._babylonCamera)||void 0===Q?void 0:Q.orthoTop)??0)},set:(F,b)=>{b._babylonCamera&&(b._babylonCamera.orthoBottom=F.x,b._babylonCamera.orthoTop=F.y)},getTarget:F=>F,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:F=>{var b;return null===(b=F._babylonCamera)||void 0===b?void 0:b.maxZ},set:(F,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=F)},getTarget:F=>F,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:F=>{var b;return null===(b=F._babylonCamera)||void 0===b?void 0:b.kb},set:(F,b)=>{b._babylonCamera&&(b._babylonCamera.kb=F)},getTarget:F=>F,getPropertyName:[()=>"kb"]}},perspective:{aspectRatio:{type:"number",get:F=>{var b;return null===(b=F._babylonCamera)||void 0===b?void 0:b.getEngine().getAspectRatio(F._babylonCamera)},getTarget:F=>F,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:F=>{var b;return null===(b=F._babylonCamera)||void 0===b?void 0:b.fov},set:(F,b)=>{b._babylonCamera&&(b._babylonCamera.fov=F)},getTarget:F=>F,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:F=>{var b;return null===(b=F._babylonCamera)||void 0===b?void 0:b.maxZ},set:(F,b)=>{b._babylonCamera&&(b._babylonCamera.maxZ=F)},getTarget:F=>F,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:F=>{var b;return null===(b=F._babylonCamera)||void 0===b?void 0:b.kb},set:(F,b)=>{b._babylonCamera&&(b._babylonCamera.kb=F)},getTarget:F=>F,getPropertyName:[()=>"kb"]}}}},nodes:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"gQ",get:F=>{var b;return null===(b=F._babylonTransformNode)||void 0===b?void 0:b.position},set:(F,b)=>{var Q;return null===(Q=b._babylonTransformNode)||void 0===Q?void 0:Q.position.W(F)},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:F=>{var b;return null===(b=F._babylonTransformNode)||void 0===b?void 0:b.rotationQuaternion},set:(F,b)=>{var Q,C;return null===(Q=b._babylonTransformNode)||void 0===Q||null===(C=Q.rotationQuaternion)||void 0===C?void 0:C.W(F)},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"gQ",get:F=>{var b;return null===(b=F._babylonTransformNode)||void 0===b?void 0:b.wb},set:(F,b)=>{var Q;return null===(Q=b._babylonTransformNode)||void 0===Q?void 0:Q.wb.W(F)},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"wb"]},weights:{length:{type:"number",get:F=>F._numMorphTargets,getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(F,b)=>{var Q,C;return void 0!==b?null===(Q=F._primitiveBabylonMeshes)||void 0===Q||null===(C=Q[0].morphTargetManager)||void 0===C?void 0:C.getTarget(b).influence:void 0},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(F,b)=>[0],getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:F=>{var b,Q,z;return C.Matrix.Compose(null===(b=F._babylonTransformNode)||void 0===b?void 0:b.wb,null===(Q=F._babylonTransformNode)||void 0===Q?void 0:Q.rotationQuaternion,null===(z=F._babylonTransformNode)||void 0===z?void 0:z.position)},getTarget:F=>F._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:F=>{var b,Q,z,t;const g=C.Matrix.Identity();let W=F.parent;for(;W&&W.parent;)W=W.parent;const Z=(null===(b=F._babylonTransformNode)||void 0===b?void 0:b.position._isDirty)||(null===(Q=F._babylonTransformNode)||void 0===Q||null===(z=Q.rotationQuaternion)||void 0===z?void 0:z._isDirty)||(null===(t=F._babylonTransformNode)||void 0===t?void 0:t.wb._isDirty);if(W){var q;const b=null===(q=W._babylonTransformNode)||void 0===q?void 0:q.Rb(!0).invert();var G,K;if(b)null===(G=F._babylonTransformNode)||void 0===G||null===(K=G.Rb(Z))||void 0===K||K.multiplyToRef(b,g)}else F._babylonTransformNode&&g.W(F._babylonTransformNode.Rb(Z));return g},getTarget:F=>F._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:F=>{var b,Q;return null===(b=F._babylonTransformNode)||void 0===b||null===(Q=b.getChildren((F=>F instanceof g.b),!0)[0])||void 0===Q?void 0:Q.lb},getTarget:F=>{var b;return null===(b=F._babylonTransformNode)||void 0===b?void 0:b.getChildren((F=>F instanceof g.b),!0)[0]},set:(F,b)=>{if(b._babylonTransformNode){const Q=b._babylonTransformNode.getChildren((F=>F instanceof g.b),!0)[0];Q&&(Q.lb=F)}}},color:{type:"GQ",get:F=>{var b,Q;return null===(b=F._babylonTransformNode)||void 0===b||null===(Q=b.getChildren((F=>F instanceof g.b),!0)[0])||void 0===Q?void 0:Q.Tb},getTarget:F=>{var b;return null===(b=F._babylonTransformNode)||void 0===b?void 0:b.getChildren((F=>F instanceof g.b),!0)[0]},set:(F,b)=>{if(b._babylonTransformNode){const Q=b._babylonTransformNode.getChildren((F=>F instanceof g.b),!0)[0];Q&&(Q.Tb=F)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"GQ",get:(F,b,Q)=>G(F,b,Q).emissiveColor,set:(F,b,Q,C)=>G(b,Q,C).emissiveColor.W(F),getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:K("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(F,b,Q)=>{var C;return null===(C=q(F,Q,"bumpTexture"))||void 0===C?void 0:C.level},set:(F,b,Q,C)=>{const z=q(b,C,"bumpTexture");z&&(z.level=F)},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:K("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(F,b,Q)=>G(F,b,Q).ambientTextureStrength,set:(F,b,Q,C)=>{const z=G(b,Q,C);z&&(z.ambientTextureStrength=F)},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:K("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"sb",get:(F,b,Q)=>{const C=G(F,b,Q);return t.sb.FromColor3(C.albedoColor,C.alpha)},set:(F,b,Q,C)=>{const z=G(b,Q,C);z.albedoColor.set(F.r,F.g,F.b),z.alpha=F.a},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:K("albedoTexture")}},metallicFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).metallic,set:(F,b,Q,C)=>{const z=G(b,Q,C);z&&(z.metallic=F)},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).roughness,set:(F,b,Q,C)=>{const z=G(b,Q,C);z&&(z.roughness=F)},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:K("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(F,b,Q)=>G(F,b,Q).anisotropy.lb,set:(F,b,Q,C)=>{G(b,Q,C).anisotropy.lb=F},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(F,b,Q)=>G(F,b,Q).anisotropy.angle,set:(F,b,Q,C)=>{G(b,Q,C).anisotropy.angle=F},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:K("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).clearCoat.lb,set:(F,b,Q,C)=>{G(b,Q,C).clearCoat.lb=F},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).clearCoat.roughness,set:(F,b,Q,C)=>{G(b,Q,C).clearCoat.roughness=F},getTarget:(F,b,Q)=>G(F,b,Q),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:K("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(F,b,Q)=>{var C;return null===(C=G(F,b,Q).clearCoat.bumpTexture)||void 0===C?void 0:C.level},getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).clearCoat.bumpTexture.level=F},extensions:{KHR_texture_transform:K("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:K("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(F,b,Q)=>G(F,b,Q).subSurface.dispersion,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).subSurface.dispersion=F}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(F,b,Q)=>G(F,b,Q).emissiveIntensity,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).emissiveIntensity=F}},KHR_materials_ior:{ior:{type:"number",get:(F,b,Q)=>G(F,b,Q).indexOfRefraction,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).indexOfRefraction=F}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).iridescence.lb,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).iridescence.lb=F},iridescenceIor:{type:"number",get:(F,b,Q)=>G(F,b,Q).iridescence.indexOfRefraction,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).iridescence.indexOfRefraction=F},iridescenceTexture:{extensions:{KHR_texture_transform:K("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(F,b,Q)=>G(F,b,Q).iridescence.maximumThickness,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).iridescence.maximumThickness=F},iridescenceThicknessMinimum:{type:"number",get:(F,b,Q)=>G(F,b,Q).iridescence.minimumThickness,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).iridescence.minimumThickness=F},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:K("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"GQ",get:(F,b,Q)=>G(F,b,Q).sheen.color,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).sheen.color.W(F)},sheenColorTexture:{extensions:{KHR_texture_transform:K("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).sheen.lb,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).sheen.lb=F},sheenRoughnessTexture:{extensions:{KHR_texture_transform:K("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).metallicF0Factor,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).metallicF0Factor=F,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"GQ",get:(F,b,Q)=>G(F,b,Q).metallicReflectanceColor,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).metallicReflectanceColor.W(F),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:K("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:K("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).subSurface.refractionIntensity,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).subSurface.refractionIntensity=F,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).subSurface.translucencyIntensity,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).subSurface.translucencyIntensity=F},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"GQ",get:(F,b,Q)=>G(F,b,Q).subSurface.translucencyColor,getTarget:G,set:(F,b,Q,C)=>{var z;return F&&(null===(z=G(b,Q,C).subSurface.translucencyColor)||void 0===z?void 0:z.W(F))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:K("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"GQ",get:(F,b,Q)=>G(F,b,Q).subSurface.tintColor,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).subSurface.tintColor.W(F)},attenuationDistance:{type:"number",get:(F,b,Q)=>G(F,b,Q).subSurface.tintColorAtDistance,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).subSurface.tintColorAtDistance=F},thicknessFactor:{type:"number",get:(F,b,Q)=>G(F,b,Q).subSurface.maximumThickness,getTarget:G,set:(F,b,Q,C)=>G(b,Q,C).subSurface.maximumThickness=F},thicknessTexture:{extensions:{KHR_texture_transform:K("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonLight)),getPropertyName:[F=>"length"]},__array__:{__target__:!0,color:{type:"GQ",get:F=>{var b;return null===(b=F._babylonLight)||void 0===b?void 0:b.Tb},set:(F,b)=>{var Q;return null===(Q=b._babylonLight)||void 0===Q?void 0:Q.Tb.W(F)},getTarget:F=>F._babylonLight,getPropertyName:[F=>"diffuse"]},lb:{type:"number",get:F=>{var b;return null===(b=F._babylonLight)||void 0===b?void 0:b.lb},set:(F,b)=>b._babylonLight?b._babylonLight.lb=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"intensity"]},range:{type:"number",get:F=>{var b;return null===(b=F._babylonLight)||void 0===b?void 0:b.range},set:(F,b)=>b._babylonLight?b._babylonLight.range=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"range"]},spot:{innerConeAngle:{type:"number",get:F=>{var b;return null===(b=F._babylonLight)||void 0===b?void 0:b.innerAngle},set:(F,b)=>b._babylonLight?b._babylonLight.innerAngle=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"innerConeAngle"]},outerConeAngle:{type:"number",get:F=>{var b;return null===(b=F._babylonLight)||void 0===b?void 0:b.angle},set:(F,b)=>b._babylonLight?b._babylonLight.angle=F:void 0,getTarget:F=>F._babylonLight,getPropertyName:[F=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonLight)),getPropertyName:[F=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonTexture)),getPropertyName:[F=>"length"]},__array__:{__target__:!0,lb:{type:"number",get:F=>{var b;return null===(b=F._babylonTexture)||void 0===b?void 0:b.level},set:(F,b)=>{b._babylonTexture&&(b._babylonTexture.level=F)},getTarget:F=>F._babylonTexture},rotation:{type:"Quaternion",get:F=>{var b;return F._babylonTexture&&C.Quaternion.FromRotationMatrix(null===(b=F._babylonTexture)||void 0===b?void 0:b.getReflectionTextureMatrix())},set:(F,b)=>{var Q;b._babylonTexture&&(null!==(Q=b._babylonTexture.RF())&&void 0!==Q&&Q.useRightHandedSystem||(F=C.Quaternion.Inverse(F)),C.Matrix.FromQuaternionToRef(F,b._babylonTexture.getReflectionTextureMatrix()))},getTarget:F=>F._babylonTexture}}}}},animations:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>F._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:F=>F.length,getTarget:F=>F.map((F=>{var b;return null===(b=F.primitives[0]._instanceData)||void 0===b?void 0:b.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function N(F){return new Z(F,e)}function y(F){const b=F.split("/").map((F=>F.replace(/{}/g,"__array__")));let Q=e;for(const C of b)C&&(Q=Q[C]);if(Q&&Q.type&&Q.get)return Q}function E(F,b){const Q=F.split("/").map((F=>F.replace(/{}/g,"__array__")));let C=e;for(const z of Q)z&&(C=C[z]);C&&C.type&&C.get&&(C.interpolation=b)}function c(F,b){const Q=F.split("/").map((F=>F.replace(/{}/g,"__array__")));let C=e;for(const z of Q)if(z){if(!C[z]){if("?"===z){C.__ignoreObjectTree__=!0;continue}C[z]={},"__array__"===z&&(C[z].__target__=!0)}C=C[z]}Object.assign(C,b)}},12908:(F,b,Q)=>{"use strict";Q.r(b),Q.d(b,{AnimationPropertyInfo:()=>q,TransformNodeAnimationPropertyInfo:()=>G,WeightAnimationPropertyInfo:()=>K,getQuaternion:()=>W,getVector3:()=>g,getWeights:()=>Z});var C=Q(11812),z=Q(11309),t=Q(12895);function g(F,b,Q,C){return z.gQ.KQ(b,Q).scaleInPlace(C)}function W(F,b,Q,C){return z.Quaternion.KQ(b,Q).scaleInPlace(C)}function Z(F,b,Q,C){const z=new Array(F._numMorphTargets);for(let t=0;t<z.length;t++)z[t]=b[Q++]*C;return z}class q{constructor(F,b,Q,C){this.type=F,this.name=b,this.getValue=Q,this.getStride=C}_buildAnimation(F,b,Q){const z=new C.b(F,this.name,b,this.type);return z.setKeys(Q),z}}class G extends q{buildAnimations(F,b,Q,C){const z=[];return z.push({babylonAnimatable:F._babylonTransformNode,babylonAnimation:this._buildAnimation(b,Q,C)}),z}}class K extends q{buildAnimations(F,b,Q,z){const t=[];if(F._numMorphTargets)for(let g=0;g<F._numMorphTargets;g++){const W=new C.b(`${b}_${g}`,this.name,Q,this.type);if(W.setKeys(z.map((F=>({frame:F.frame,inTangent:F.inTangent?F.inTangent[g]:void 0,value:F.value[g],outTangent:F.outTangent?F.outTangent[g]:void 0,interpolation:F.interpolation})))),F._primitiveBabylonMeshes)for(const b of F._primitiveBabylonMeshes)if(b.morphTargetManager){const F=b.morphTargetManager.getTarget(g),Q=W.clone();F.animations.push(Q),t.push({babylonAnimatable:F,babylonAnimation:Q})}}return t}}(0,t.g)("/nodes/{}/translation",[new G(C.b.ANIMATIONTYPE_VECTOR3,"position",g,(()=>3))]),(0,t.g)("/nodes/{}/rotation",[new G(C.b.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",W,(()=>4))]),(0,t.g)("/nodes/{}/scale",[new G(C.b.ANIMATIONTYPE_VECTOR3,"wb",g,(()=>3))]),(0,t.g)("/nodes/{}/weights",[new K(C.b.ANIMATIONTYPE_FLOAT,"influence",Z,(F=>F._numMorphTargets))])},12858:(F,b,Q)=>{"use strict";class C{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((F,b)=>{this._resolve=F,this._reject=b}))}}var z=Q(11309),t=Q(11359),g=Q(11128),W=Q(11750),Z=Q(12865),q=Q(12876),G=Q(11133),K=Q(11768),e=Q(11812),N=Q(11818),y=Q(11161),E=Q(11146),c=Q(11148);class X{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(F){this._useTextureToStoreBoneMatrices=F,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(F){this._animationPropertiesOverride=F}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(F,b,Q){this.name=F,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=z.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new G.c,this.bones=[],this._scene=Q||y.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const C=this._scene.getEngine().getCaps();this._canUseTextureForBones=C.textureFloat&&C.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((F=>!F.getParent()))}getTransformMatrices(F){if(this.needInitialSkinMatrix){if(!F)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return F._bonesTransformMatrices||this.prepare(!0),F._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(F){return this.needInitialSkinMatrix&&F._transformMatrixTexture?F._transformMatrixTexture:this._transformMatrixTexture}RF(){return this._scene}toString(F){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,F){b+=", Ranges: {";let F=!0;for(const Q in this._ranges)F&&(b+=", ",F=!1),b+=Q;b+="}"}return b}getBoneIndexByName(F){for(let b=0,Q=this.bones.length;b<Q;b++)if(this.bones[b].name===F)return b;return-1}createAnimationRange(F,b,Q){if(!this._ranges[F]){this._ranges[F]=new N.c(F,b,Q);for(let C=0,z=this.bones.length;C<z;C++)this.bones[C].animations[0]&&this.bones[C].animations[0].createRange(F,b,Q)}}deleteAnimationRange(F){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let Q=0,C=this.bones.length;Q<C;Q++)this.bones[Q].animations[0]&&this.bones[Q].animations[0].deleteRange(F,b);this._ranges[F]=null}getAnimationRange(F){return this._ranges[F]||null}getAnimationRanges(){const F=[];let b;for(b in this._ranges)F.push(this._ranges[b]);return F}copyAnimationRange(F,b){let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!F.getAnimationRange(b))return!1;let C=!0;const z=this._getHighestAnimationFrame()+1,t={},g=F.bones;let W,Z;for(Z=0,W=g.length;Z<W;Z++)t[g[Z].name]=g[Z];this.bones.length!==g.length&&(E.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${g.length}`),C=!1);const q=Q&&this.dimensionsAtRest&&F.dimensionsAtRest?this.dimensionsAtRest.divide(F.dimensionsAtRest):null;for(Z=0,W=this.bones.length;Z<W;Z++){const F=this.bones[Z].name,g=t[F];g?C=C&&this.bones[Z].copyAnimationRange(g,b,z,Q,q):(E.e.Warn("copyAnimationRange: not same rig, missing source bone "+F),C=!1)}const G=F.getAnimationRange(b);return G&&(this._ranges[b]=new N.c(b,G.from+z,G.to+z)),C}returnToRest(){for(const F of this.bones)-1!==F._index&&F.returnToRest()}_getHighestAnimationFrame(){let F=0;for(let b=0,Q=this.bones.length;b<Q;b++)if(this.bones[b].animations[0]){const Q=this.bones[b].animations[0].getHighestFrame();F<Q&&(F=Q)}return F}beginAnimation(F,b,Q,C){const z=this.getAnimationRange(F);return z?this._scene.beginAnimation(this,z.from,z.to,b,Q,C):null}static MakeAnimationAdditive(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,Q=arguments.length>2?arguments[2]:void 0;const C=F.getAnimationRange(Q);if(!C)return null;const z=F._scene.getAllAnimatablesByTarget(F);let t=null;for(let W=0;W<z.length;W++){const F=z[W];if(F.fromFrame===(null===C||void 0===C?void 0:C.from)&&F.toFrame===(null===C||void 0===C?void 0:C.to)){t=F;break}}const g=F.getAnimatables();for(let W=0;W<g.length;W++){const F=g[W].animations;if(F)for(let C=0;C<F.length;C++)e.b.MakeAnimationAdditive(F[C],b,Q)}return t&&(t.isAdditive=!0),F}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(F){this._meshesWithPoseMatrix.push(F)}_unregisterMeshWithPoseMatrix(F){const b=this._meshesWithPoseMatrix.indexOf(F);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(F,b){this.onBeforeComputeObservable.notifyObservers(this);for(let Q=0;Q<this.bones.length;Q++){const C=this.bones[Q];C._childUpdateId++;const z=C.getParent();if(z?C.getLocalMatrix().multiplyToRef(z.getFinalMatrix(),C.getFinalMatrix()):b?C.getLocalMatrix().multiplyToRef(b,C.getFinalMatrix()):C.getFinalMatrix().W(C.getLocalMatrix()),-1!==C._index){const b=null===C._index?Q:C._index;C.getAbsoluteInverseBindMatrix().multiplyToArray(C.getFinalMatrix(),F,16*b)}}this._identity.copyToArray(F,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const F=this.RF().getRenderId();if(this._currentRenderId===F)return;this._currentRenderId=F}if(this._numBonesWithLinkedTransformNode>0)for(const F of this.bones)if(F._linkedTransformNode){const b=F._linkedTransformNode;F.position=b.position,b.rotationQuaternion?F.rotationQuaternion=b.rotationQuaternion:F.rotation=b.rotation,F.wb=b.wb}if(this.needInitialSkinMatrix)for(const F of this._meshesWithPoseMatrix){const b=F.getPoseMatrix();let Q=this._isDirty;if(F._bonesTransformMatrices&&F._bonesTransformMatrices.length===16*(this.bones.length+1)||(F._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),Q=!0),Q){if(this._synchronizedWithMesh!==F){this._synchronizedWithMesh=F;for(const F of this.bones)if(!F.getParent()){F.getBindMatrix().multiplyToRef(b,z.TmpVectors.Matrix[1]),F._updateAbsoluteBindMatrices(z.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);F._transformMatrixTexture&&F._transformMatrixTexture.getSize().width===b||(F._transformMatrixTexture&&F._transformMatrixTexture.dispose(),F._transformMatrixTexture=K.c.CreateRGBATexture(F._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(F._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&F._transformMatrixTexture&&F._transformMatrixTexture.update(F._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=K.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let F=0;F<this.bones.length;F++)this._animatables.push(this.bones[F])}return this._animatables}clone(F,b){const Q=new X(F,b||F,this._scene);Q.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let C=0;C<this.bones.length;C++){const F=this.bones[C];let b=null;const z=F.getParent();if(z){const F=this.bones.indexOf(z);b=Q.bones[F]}const t=new q.b(F.name,Q,b,F.getBindMatrix().clone(),F.getRestMatrix().clone());t._index=F._index,F._linkedTransformNode&&t.linkTransformNode(F._linkedTransformNode),c.d.DeepCopy(F.animations,t.animations)}if(this._ranges){Q._ranges={};for(const F in this._ranges){const b=this._ranges[F];b&&(Q._ranges[F]=b.clone())}}return this._isDirty=!0,Q.prepare(!0),Q}enableBlending(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const b of this.bones)for(const Q of b.animations)Q.enableBlending=!0,Q.blendingSpeed=F}dispose(){if(this._meshesWithPoseMatrix.length=0,this.RF().stopAnimation(this),this.RF().removeSkeleton(this),this._parentContainer){const F=this._parentContainer.skeletons.indexOf(this);F>-1&&this._parentContainer.skeletons.splice(F,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const F={};F.name=this.name,F.id=this.id,this.dimensionsAtRest&&(F.dimensionsAtRest=this.dimensionsAtRest.Lb()),F.bones=[],F.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Q=0;Q<this.bones.length;Q++){var b;const C=this.bones[Q],z=C.getParent(),t={parentBoneIndex:z?this.bones.indexOf(z):-1,index:C.getIndex(),name:C.name,id:C.id,matrix:C.getBindMatrix().Lb(),rest:C.getRestMatrix().Lb(),linkedTransformNodeId:null===(b=C.getTransformNode())||void 0===b?void 0:b.id};F.bones.push(t),C.length&&(t.length=C.length),C.metadata&&(t.metadata=C.metadata),C.animations&&C.animations.length>0&&(t.animation=C.animations[0].serialize()),F.ranges=[];for(const b in this._ranges){const Q=this._ranges[b];if(!Q)continue;const C={};C.name=b,C.from=Q.from,C.to=Q.to,F.ranges.push(C)}}return F}static Parse(F,b){const Q=new X(F.name,F.id,b);let C;for(F.dimensionsAtRest&&(Q.dimensionsAtRest=z.gQ.KQ(F.dimensionsAtRest)),Q.needInitialSkinMatrix=F.needInitialSkinMatrix,C=0;C<F.bones.length;C++){const b=F.bones[C],t=F.bones[C].index;let g=null;b.parentBoneIndex>-1&&(g=Q.bones[b.parentBoneIndex]);const W=b.rest?z.Matrix.KQ(b.rest):null,Z=new q.b(b.name,Q,g,z.Matrix.KQ(b.matrix),W,null,t);void 0!==b.id&&null!==b.id&&(Z.id=b.id),b.length&&(Z.length=b.length),b.metadata&&(Z.metadata=b.metadata),b.animation&&Z.animations.push(e.b.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(Q._hasWaitingData=!0,Z._waitingTransformNodeId=b.linkedTransformNodeId)}if(F.ranges)for(C=0;C<F.ranges.length;C++){const b=F.ranges[C];Q.createAnimationRange(b.name,b.from,b.to)}return Q}computeAbsoluteMatrices(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||F)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(F)}getPoseMatrix(){let F=null;return this._meshesWithPoseMatrix.length>0&&(F=this._meshesWithPoseMatrix[0].getPoseMatrix()),F}sortBones(){const F=[],b=new Array(this.bones.length);for(let Q=0;Q<this.bones.length;Q++)this._sortBones(Q,F,b);this.bones=F}_sortBones(F,b,Q){if(Q[F])return;Q[F]=!0;const C=this.bones[F];if(!C)return;void 0===C._index&&(C._index=F);const z=C.getParent();z&&this._sortBones(this.bones.indexOf(z),b,Q),b.push(C)}setCurrentPoseAsRest(){for(const F of this.bones)F.setCurrentPoseAsRest()}}var L=Q(11607),i=Q(11791),f=Q(11287),k=Q(11706),m=Q(11372),R=Q(11752),p=Q(11724),D=Q(11746),P=Q(11823),n=Q(11395),j=Q(12838);class w{set areUpdatesFrozen(F){F?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new n.d(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,F||(F=y.d.LastCreatedScene),this._scene=F,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const F=this._scene.getEngine().getCaps();this._canUseTextureForTargets=F.canUseGLVertexID&&F.textureFloat&&F.maxVertexTextureImageUnits>0&&F.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return w.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?w.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(F){this._numMaxInfluencers!==F&&(this._numMaxInfluencers=F,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(F){this._useTextureToStoreTargets!==F&&(this._useTextureToStoreTargets=F,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var F;return w.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(F=this._scene)&&void 0!==F&&F.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(F){return this._activeTargets.data[F]}getTarget(F){return this._targets[F]}getTargetByName(F){for(const b of this._targets)if(b.name===F)return b;return null}addTarget(F){this._targets.push(F),this._targetInfluenceChangedObservers.push(F.onInfluenceChanged.add((F=>{this.areUpdatesFrozen&&F&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(F)}))),this._targetDataLayoutChangedObservers.push(F._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(F){const b=this._targets.indexOf(F);b>=0&&(this._targets.splice(b,1),F.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),F._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(F)}_bind(F){F.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),F.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),F.setTexture("morphTargets",this._targetStoreTexture),F.setInt("morphTargetCount",this.numInfluencers)}clone(){const F=new w(this._scene);for(const b of this._targets)F.addTarget(b.clone());return F.enablePositionMorphing=this.enablePositionMorphing,F.enableNormalMorphing=this.enableNormalMorphing,F.enableTangentMorphing=this.enableTangentMorphing,F.enableUVMorphing=this.enableUVMorphing,F.enableUV2Morphing=this.enableUV2Morphing,F.enableColorMorphing=this.enableColorMorphing,F}serialize(){const F={};F.id=this.uniqueId,F.targets=[];for(const b of this._targets)F.targets.push(b.serialize());return F}_syncActiveTargets(){let F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const b=!!this._targetStoreTexture,Q=this.isUsingTextureForTargets;(this._mustSynchronize||b!==Q)&&(this._mustSynchronize=!1,this.synchronize());let C=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let z=-1;for(const t of this._targets)if(z++,0!==t.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=w.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(t),this._morphTargetTextureIndices[C]=z,this._tempInfluences[C++]=t.influence}this._morphTargetTextureIndices.length!==C&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,C)),this._influences&&this._influences.length===C||(this._influences=new Float32Array(C));for(let t=0;t<C;t++)this._influences[t]=this._tempInfluences[t];if(F&&this._scene)for(const t of this._scene.meshes)t.morphTargetManager===this&&(Q?t._markSubMeshesAsAttributesDirty():t._syncGeometryWithMorphTargetManager())}synchronize(){var F;if(!this._scene||this.areUpdatesFrozen)return;const b=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(F=this._targetStoreTexture)||void 0===F||F.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>b.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const Q of this._targets){this._supportsPositions=this._supportsPositions&&Q.hasPositions,this._supportsNormals=this._supportsNormals&&Q.hasNormals,this._supportsTangents=this._supportsTangents&&Q.hasTangents,this._supportsUVs=this._supportsUVs&&Q.hasUVs,this._supportsUV2s=this._supportsUV2s&&Q.hasUV2s,this._supportsColors=this._supportsColors&&Q.hasColors;const F=Q.vertexCount;if(0===this._vertexCount)this._vertexCount=F;else if(this._vertexCount!==F)return void E.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${Q.name}": ${F}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const F=b.getCaps().maxTextureSize;this._textureWidth>F&&(this._textureHeight=Math.ceil(this._textureWidth/F),this._textureWidth=F);const Q=this._targets.length,C=new Float32Array(Q*this._textureWidth*this._textureHeight*4);let z=0;for(let b=0;b<Q;b++){const F=this._targets[b],Q=F.getPositions(),t=F.getNormals(),g=F.getUVs(),W=F.getTangents(),Z=F.getUV2s(),q=F.getColors();z=b*this._textureWidth*this._textureHeight*4;for(let b=0;b<this._vertexCount;b++)this._supportsPositions&&Q&&(C[z]=Q[3*b],C[z+1]=Q[3*b+1],C[z+2]=Q[3*b+2],z+=4),this._supportsNormals&&t&&(C[z]=t[3*b],C[z+1]=t[3*b+1],C[z+2]=t[3*b+2],z+=4),this._supportsUVs&&g&&(C[z]=g[2*b],C[z+1]=g[2*b+1],z+=4),this._supportsTangents&&W&&(C[z]=W[3*b],C[z+1]=W[3*b+1],C[z+2]=W[3*b+2],z+=4),this._supportsUV2s&&Z&&(C[z]=Z[2*b],C[z+1]=Z[2*b+1],z+=4),this._supportsColors&&q&&(C[z]=q[4*b],C[z+1]=q[4*b+1],C[z+2]=q[4*b+2],C[z+3]=q[4*b+3],z+=4)}this._targetStoreTexture=j.e.CreateRGBATexture(C,this._textureWidth,this._textureHeight,Q,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const Q of this._scene.meshes)Q.morphTargetManager===this&&Q._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const F=this._parentContainer.morphTargetManagers.indexOf(this);F>-1&&this._parentContainer.morphTargetManagers.splice(F,1),this._parentContainer=null}for(const F of this._targets)this._scene.stopAnimation(F)}}static Parse(F,b){const Q=new w(b);for(const C of F.targets)Q.addTarget(P.d.Parse(C,b));return Q}}w.EnableTextureStorage=!0,w.MaxActiveMorphTargetsInVertexAttributeMode=8,w.ConstantTargetCountForTextureMode=0;var Y=Q(12881),s=Q(11170),V=Q(11623);const h=new Map,l=h;function T(F,b,Q){o(F)&&E.e.Warn(`Extension with the name '${F}' already exists`),h.set(F,{isGLTFExtension:b,factory:Q})}function o(F){return h.delete(F)}var S=Q(12895),O=Q(11878),x=Q(11384);class a{static Get(F,b,Q){if(!b||void 0==Q||!b[Q])throw new Error(`${F}: Failed to find index (${Q})`);return b[Q]}static TryGet(F,b){return F&&void 0!=b&&F[b]?F[b]:null}static Assign(F){if(F)for(let b=0;b<F.length;b++)F[b].index=b}}function A(F){if(F.min&&F.max){const b=F.min,Q=F.max,C=z.TmpVectors.gQ[0].jb(b[0],b[1],b[2]),t=z.TmpVectors.gQ[1].jb(Q[0],Q[1],Q[2]);if(F.normalized&&5126!==F.componentType){let b=1;switch(F.componentType){case 5120:b=127;break;case 5121:b=255;break;case 5122:b=32767;break;case 5123:b=65535}const Q=1/b;C.scaleInPlace(Q),t.scaleInPlace(Q)}return new V.d(C,t)}return null}class U{static RegisterExtension(F,b){T(F,!1,b)}static UnregisterExtension(F){return o(F)}get yb(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(F){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=F}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((F=>F.dispose&&F.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(F,b,Q,C,z,t){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=b,this._assetContainer=Q,this._loadData(C);let t=null;if(F){const b={};if(this._gltf.nodes)for(const F of this._gltf.nodes)F.name&&(b[F.name]=F.index);t=(F instanceof Array?F:[F]).map((F=>{const Q=b[F];if(void 0===Q)throw new Error(`Failed to find node '${F}'`);return Q}))}return await this._loadAsync(z,g,t,(()=>({meshes:this._getMeshes(),Te:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=F,this._loadData(b),await this._loadAsync(Q,z,null,(()=>{}))}async _loadAsync(F,b,Q,C){return await Promise.resolve().then((async()=>{this._rootUrl=F,this._uniqueRootUrl=!F.startsWith("file:")&&b?F:`${F}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const z=`${Y.k[Y.k.LOADING]} => ${Y.k[Y.k.READY]}`,t=`${Y.k[Y.k.LOADING]} => ${Y.k[Y.k.COMPLETE]}`;this._parent._startPerformanceCounter(z),this._parent._startPerformanceCounter(t),this._parent._setState(Y.k.LOADING),this._extensionsOnLoading();const W=new Array;if(!this.parent.loadOnlyMaterials)if(Q)W.push(this.loadSceneAsync("/nodes",{nodes:Q,index:-1}));else if(void 0!=this._gltf.ZQ||this._gltf.scenes&&this._gltf.scenes[0]){const F=a.Get("/scene",this._gltf.scenes,this._gltf.ZQ||0);W.push(this.loadSceneAsync(`/scenes/${F.index}`,F))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let F=0;F<this._gltf.materials.length;++F){const b=this._gltf.materials[F],Q="/materials/"+F,C=L.c.TriangleFillMode;W.push(this._loadMaterialAsync(Q,b,null,C,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&W.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&W.push(this._compileShadowGeneratorsAsync());const Z=Promise.all(W).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.XZ(!0);for(const F of this._babylonScene.materials){const b=F;void 0!==b.maxSimultaneousLights&&(b.maxSimultaneousLights=Math.max(b.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(Y.k.READY),this._skipStartAnimationStep||this._startAnimations(),C()}));return await Z.then((F=>(this._parent._endPerformanceCounter(z),g.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(t),this._parent._setState(Y.k.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(F=>{this._parent.onErrorObservable.notifyObservers(F),this._parent.onErrorObservable.clear(),this.dispose()}))})),F)))})).catch((F=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(F),this._parent.onErrorObservable.clear(),this.dispose()),F}))}_loadData(F){if(this._gltf=F.json,this._setupData(),F.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const Q=b[0];(Q.byteLength<F.bin.byteLength-3||Q.byteLength>F.bin.byteLength)&&E.e.Warn(`Binary buffer length (${Q.byteLength}) from JSON does not match chunk length (${F.bin.byteLength})`),this._bin=F.bin}else E.e.Warn("Unexpected BIN chunk")}}_setupData(){if(a.Assign(this._gltf.accessors),a.Assign(this._gltf.animations),a.Assign(this._gltf.buffers),a.Assign(this._gltf.bufferViews),a.Assign(this._gltf.cameras),a.Assign(this._gltf.images),a.Assign(this._gltf.materials),a.Assign(this._gltf.meshes),a.Assign(this._gltf.nodes),a.Assign(this._gltf.samplers),a.Assign(this._gltf.scenes),a.Assign(this._gltf.skins),a.Assign(this._gltf.textures),this._gltf.nodes){const F={};for(const Q of this._gltf.nodes)if(Q.children)for(const b of Q.children)F[b]=Q.index;const b=this._createRootNode();for(const Q of this._gltf.nodes){const C=F[Q.index];Q.parent=void 0===C?b:this._gltf.nodes[C]}}}async _loadExtensionsAsync(){const F=[];if(l.forEach(((b,Q)=>{var C;!1===(null===(C=this.parent.extensionOptions[Q])||void 0===C?void 0:C.enabled)?b.isGLTFExtension&&this.isExtensionUsed(Q)&&E.e.Warn(`Extension ${Q} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(Q)||F.push((async()=>{const F=await b.factory(this);return F.name!==Q&&E.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${F.name} !== ${Q}`),this._parent.onExtensionLoadedObservable.notifyObservers(F),F})())})),this._extensions.push(...await Promise.all(F)),this._extensions.sort(((F,b)=>(F.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const Q of this._gltf.extensionsRequired){if(!this._extensions.some((F=>F.name===Q&&F.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[Q])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${Q} is disabled`);throw new Error(`Required extension ${Q} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new D.b("__root__",this._babylonScene);this._rootBabylonMesh=F,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.XZ(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case Y.i.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],U._LoadTransform(b,this._rootBabylonMesh));break;case Y.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(F),b}loadSceneAsync(F,b){const Q=this._extensionsLoadSceneAsync(F,b);if(Q)return Q;const C=new Array;if(this.logOpen(`${F} ${b.name||""}`),b.nodes)for(const z of b.nodes){const b=a.Get(`${F}/nodes/${z}`,this._gltf.nodes,z);C.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(F=>{F.parent=this._rootBabylonMesh})))}for(const z of this._postSceneLoadActions)z();return C.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(C).then((()=>{}))}_forEachPrimitive(F,b){if(F._primitiveBabylonMeshes)for(const Q of F._primitiveBabylonMeshes)b(Q)}_getGeometries(){const F=[],b=this._gltf.nodes;if(b)for(const Q of b)this._forEachPrimitive(Q,(b=>{const Q=b.pb;Q&&-1===F.indexOf(Q)&&F.push(Q)}));return F}_getMeshes(){const F=[];this._rootBabylonMesh instanceof p.d&&F.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const Q of b)this._forEachPrimitive(Q,(b=>{F.push(b)}));return F}_getTransformNodes(){const F=[],b=this._gltf.nodes;if(b)for(const Q of b)Q._babylonTransformNode&&"xb"===Q._babylonTransformNode.getClassName()&&F.push(Q._babylonTransformNode),Q._babylonTransformNodeForSkin&&F.push(Q._babylonTransformNodeForSkin);return F}_getSkeletons(){const F=[],b=this._gltf.skins;if(b)for(const Q of b)Q._data&&F.push(Q._data.babylonSkeleton);return F}_getAnimationGroups(){const F=[],b=this._gltf.animations;if(b)for(const Q of b)Q._babylonAnimationGroup&&F.push(Q._babylonAnimationGroup);return F}_startAnimations(){switch(this._parent.animationStartMode){case Y.g.NONE:break;case Y.g.FIRST:{const F=this._getAnimationGroups();0!==F.length&&F[0].start(!0);break}case Y.g.ALL:{const F=this._getAnimationGroups();for(const b of F)b.start(!0);break}default:return void E.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadNodeAsync(F,b,Q);if(C)return C;if(b._babylonTransformNode)throw new Error(`${F}: Invalid recursive node hierarchy`);const z=new Array;this.logOpen(`${F} ${b.name||""}`);const t=C=>{if(U.AddPointerMetadata(C,F),U._LoadTransform(b,C),void 0!=b.camera){const Q=a.Get(`${F}/camera`,this._gltf.cameras,b.camera);z.push(this.loadCameraAsync(`/cameras/${Q.index}`,Q,(F=>{F.parent=C,this._babylonScene.useRightHandedSystem||(C.wb.x=-1)})))}if(b.children)for(const Q of b.children){const b=a.Get(`${F}/children/${Q}`,this._gltf.nodes,Q);z.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(F=>{F.parent=C})))}Q(C)},g=void 0!=b.mesh,W=this._parent.loadSkins&&void 0!=b.skin;if(!g||W){const F=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new k.d(F,this._babylonScene);Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=Q:b._babylonTransformNodeForSkin=Q,t(Q)}if(g)if(W){const Q=a.Get(`${F}/mesh`,this._gltf.meshes,b.mesh);z.push(this._loadMeshAsync(`/meshes/${Q.index}`,b,Q,(Q=>{const C=b._babylonTransformNodeForSkin;Q.metadata=(0,O.d)(C.metadata,Q.metadata||{});const t=a.Get(`${F}/skin`,this._gltf.skins,b.skin);z.push(this._loadSkinAsync(`/skins/${t.index}`,b,t,(F=>{this._forEachPrimitive(b,(b=>{b.skeleton=F})),this._postSceneLoadActions.push((()=>{if(void 0!=t.skeleton){const F=a.Get(`/skins/${t.index}/skeleton`,this._gltf.nodes,t.skeleton).parent;b.index===F.index?Q.parent=C.parent:Q.parent=F._babylonTransformNode}else Q.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:C,skinnedNode:Q})}))})))})))}else{const Q=a.Get(`${F}/mesh`,this._gltf.meshes,b.mesh);z.push(this._loadMeshAsync(`/meshes/${Q.index}`,b,Q,t))}return this.logClose(),Promise.all(z).then((()=>(this._forEachPrimitive(b,(F=>{const b=F;!b.isAnInstance&&b.pb&&b.pb.useBoundingInfoFromGeometry?F.VF():F.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(F,b,Q,C){const z=Q.primitives;if(!z||!z.length)throw new Error(`${F}: Primitives are missing`);void 0==z[0].index&&a.Assign(z);const t=new Array;this.logOpen(`${F} ${Q.name||""}`);const g=b.name||`node${b.index}`;if(1===z.length){const C=Q.primitives[0];t.push(this._loadMeshPrimitiveAsync(`${F}/primitives/${C.index}`,g,b,Q,C,(F=>{b._babylonTransformNode=F,b._primitiveBabylonMeshes=[F]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new k.d(g,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const C of z)t.push(this._loadMeshPrimitiveAsync(`${F}/primitives/${C.index}`,`${g}_primitive${C.index}`,b,Q,C,(F=>{F.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(F)})))}return C(b._babylonTransformNode),this.logClose(),Promise.all(t).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(F,b,Q,C,z,t){const g=this._extensionsLoadMeshPrimitiveAsync(F,b,Q,C,z,t);if(g)return g;this.logOpen(`${F}`);const W=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==Q.skin&&!C.primitives[0].targets;let Z,q;if(W&&z._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,Z=z._instanceData.babylonSourceMesh.createInstance(b),Z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,q=z._instanceData.promise;else{const t=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new D.b(b,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,g.sideOrientation=this._babylonScene.useRightHandedSystem?L.c.CounterClockWiseSideOrientation:L.c.ClockWiseSideOrientation,this._createMorphTargets(F,Q,C,z,g),t.push(this._loadVertexDataAsync(F,z,g).then((async b=>await this._loadMorphTargetsAsync(F,z,g,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.YF(g),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const G=U._GetDrawMode(F,z.mode);if(void 0==z.material){let F=this._defaultBabylonMaterialData[G];F||(F=this._createDefaultMaterial("__GLTFLoader._default",G),this._parent.onMaterialLoadedObservable.notifyObservers(F),this._defaultBabylonMaterialData[G]=F),g.material=F}else if(!this.parent.skipMaterials){const b=a.Get(`${F}/material`,this._gltf.materials,z.material);t.push(this._loadMaterialAsync(`/materials/${b.index}`,b,g,G,(F=>{g.material=F})))}q=Promise.all(t),W&&(z._instanceData={babylonSourceMesh:g,promise:q}),Z=g}return U.AddPointerMetadata(Z,F),this._parent.onMeshLoadedObservable.notifyObservers(Z),t(Z),this.logClose(),q.then((()=>Z))}_loadVertexDataAsync(F,b,Q){const C=this._extensionsLoadVertexDataAsync(F,b,Q);if(C)return C;const z=b.attributes;if(!z)throw new Error(`${F}: Attributes are missing`);const t=new Array,g=new R.d(Q.name,this._babylonScene);if(void 0==b.indices)Q.isUnIndexed=!0;else{const Q=a.Get(`${F}/indices`,this._gltf.accessors,b.indices);t.push(this._loadIndicesAccessorAsync(`/accessors/${Q.index}`,Q).then((F=>{g.setIndices(F)})))}const W=(b,C,W)=>{if(void 0==z[b])return;Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(C)&&Q._delayInfo.push(C);const Z=a.Get(`${F}/attributes/${b}`,this._gltf.accessors,z[b]);t.push(this._loadVertexAccessorAsync(`/accessors/${Z.index}`,Z,C).then((F=>{if(F.getKind()===m.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!Q.skeleton){const F=A(Z);F&&(g._boundingInfo=F,g.useBoundingInfoFromGeometry=!0)}g.setVerticesBuffer(F,Z.count)}))),C==m.e.MatricesIndicesExtraKind&&(Q.numBoneInfluencers=8),W&&W(Z)};return W("POSITION",m.e.PositionKind),W("NORMAL",m.e.NormalKind),W("TANGENT",m.e.TangentKind),W("TEXCOORD_0",m.e.UVKind),W("TEXCOORD_1",m.e.UV2Kind),W("TEXCOORD_2",m.e.UV3Kind),W("TEXCOORD_3",m.e.UV4Kind),W("TEXCOORD_4",m.e.UV5Kind),W("TEXCOORD_5",m.e.UV6Kind),W("JOINTS_0",m.e.MatricesIndicesKind),W("WEIGHTS_0",m.e.MatricesWeightsKind),W("JOINTS_1",m.e.MatricesIndicesExtraKind),W("WEIGHTS_1",m.e.MatricesWeightsExtraKind),W("COLOR_0",m.e.ColorKind,(F=>{"VEC4"===F.type&&(Q.hasVertexAlpha=!0)})),Promise.all(t).then((()=>g))}_createMorphTargets(F,b,Q,C,z){if(!C.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=C.targets.length;else if(C.targets.length!==b._numMorphTargets)throw new Error(`${F}: Primitives do not have the same number of targets`);const t=Q.extras?Q.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,z.morphTargetManager=new w(this._babylonScene),z.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,z.morphTargetManager.areUpdatesFrozen=!0;for(let g=0;g<C.targets.length;g++){const F=b.weights?b.weights[g]:Q.weights?Q.weights[g]:0,C=t?t[g]:`morphTarget${g}`;z.morphTargetManager.addTarget(new P.d(C,F,z.RF()))}}_loadMorphTargetsAsync(F,b,Q,C){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const z=new Array,t=Q.morphTargetManager;for(let g=0;g<t.numTargets;g++){const Q=t.getTarget(g);z.push(this._loadMorphTargetVertexDataAsync(`${F}/targets/${g}`,C,b.targets[g],Q))}return Promise.all(z).then((()=>{t.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(F,b,Q,C){const z=new Array,t=(C,t,g)=>{if(void 0==Q[C])return;const W=b.getVertexBuffer(t);if(!W)return;const Z=a.Get(`${F}/${C}`,this._gltf.accessors,Q[C]);z.push(this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z).then((F=>{g(W,F)})))};return t("POSITION",m.e.PositionKind,((F,b)=>{const Q=new Float32Array(b.length);F.forEach(b.length,((F,C)=>{Q[C]=b[C]+F})),C.setPositions(Q)})),t("NORMAL",m.e.NormalKind,((F,b)=>{const Q=new Float32Array(b.length);F.forEach(Q.length,((F,C)=>{Q[C]=b[C]+F})),C.setNormals(Q)})),t("TANGENT",m.e.TangentKind,((F,b)=>{const Q=new Float32Array(b.length/3*4);let z=0;F.forEach(b.length/3*4,((F,C)=>{(C+1)%4!==0&&(Q[z]=b[z]+F,z++)})),C.setTangents(Q)})),t("TEXCOORD_0",m.e.UVKind,((F,b)=>{const Q=new Float32Array(b.length);F.forEach(b.length,((F,C)=>{Q[C]=b[C]+F})),C.setUVs(Q)})),t("TEXCOORD_1",m.e.UV2Kind,((F,b)=>{const Q=new Float32Array(b.length);F.forEach(b.length,((F,C)=>{Q[C]=b[C]+F})),C.setUV2s(Q)})),t("COLOR_0",m.e.ColorKind,((b,Q)=>{let z=null;const t=b.getSize();if(3===t){z=new Float32Array(Q.length/3*4),b.forEach(Q.length,((F,b)=>{const C=Math.floor(b/3),t=b%3;z[4*C+t]=Q[3*C+t]+F}));for(let F=0;F<Q.length/3;++F)z[4*F+3]=1}else{if(4!==t)throw new Error(`${F}: Invalid number of components (${t}) for COLOR_0 attribute`);z=new Float32Array(Q.length),b.forEach(Q.length,((F,b)=>{z[b]=Q[b]+F}))}C.setColors(z)})),await Promise.all(z).then((()=>{}))}static _LoadTransform(F,b){if(void 0!=F.skin)return;let Q=z.gQ.Zero(),C=z.Quaternion.Identity(),t=z.gQ.One();if(F.matrix){z.Matrix.KQ(F.matrix).decompose(t,C,Q)}else F.translation&&(Q=z.gQ.KQ(F.translation)),F.rotation&&(C=z.Quaternion.KQ(F.rotation)),F.scale&&(t=z.gQ.KQ(F.scale));b.position=Q,b.rotationQuaternion=C,b.wb=t}_loadSkinAsync(F,b,Q,C){if(!this._parent.loadSkins)return Promise.resolve();const z=this._extensionsLoadSkinAsync(F,b,Q);if(z)return z;if(Q._data)return C(Q._data.babylonSkeleton),Q._data.promise;const t=`skeleton${Q.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new X(Q.name||t,t,this._babylonScene);g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(F,Q,g);const W=this._loadSkinInverseBindMatricesDataAsync(F,Q).then((F=>{this._updateBoneMatrices(g,F)}));return Q._data={babylonSkeleton:g,promise:W},C(g),W}_loadBones(F,b,Q){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const Q=this._findSkeletonRootNode(`${F}/joints`,b.joints);if(Q)if(void 0===b.skeleton)b.skeleton=Q.index;else{const C=(F,b)=>{for(;b.parent;b=b.parent)if(b.parent===F)return!0;return!1},z=a.Get(`${F}/skeleton`,this._gltf.nodes,b.skeleton);z===Q||C(z,Q)||(E.e.Warn(`${F}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=Q.index)}else E.e.Warn(`${F}: Failed to find common root`)}const C={};for(const z of b.joints){const t=a.Get(`${F}/joints/${z}`,this._gltf.nodes,z);this._loadBone(t,b,Q,C)}}_findSkeletonRootNode(F,b){if(0===b.length)return null;const Q={};for(const z of b){const b=[];let C=a.Get(`${F}/${z}`,this._gltf.nodes,z);for(;-1!==C.index;)b.unshift(C),C=C.parent;Q[z]=b}let C=null;for(let z=0;;++z){let F=Q[b[0]];if(z>=F.length)return C;const t=F[z];for(let g=1;g<b.length;++g)if(F=Q[b[g]],z>=F.length||t!==F[z])return C;C=t}}_loadBone(F,b,Q,C){F._isJoint=!0;let z=C[F.index];if(z)return z;let t=null;F.index!==b.skeleton&&(F.parent&&-1!==F.parent.index?t=this._loadBone(F.parent,b,Q,C):void 0!==b.skeleton&&E.e.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const g=b.joints.indexOf(F.index);return z=new q.b(F.name||`joint${F.index}`,Q,t,this._getNodeMatrix(F),null,null,g),C[F.index]=z,this._postSceneLoadActions.push((()=>{z.linkTransformNode(F._babylonTransformNode)})),z}_loadSkinInverseBindMatricesDataAsync(F,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const Q=a.Get(`${F}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${Q.index}`,Q)}_updateBoneMatrices(F,b){for(const Q of F.bones){const F=z.Matrix.Identity(),C=Q._index;b&&-1!==C&&(z.Matrix.FromArrayToRef(b,16*C,F),F.invertToRef(F));const t=Q.getParent();t&&F.multiplyToRef(t.getAbsoluteInverseBindMatrix(),F),Q.mb(F,!1,!1),Q._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(F){return F.matrix?z.Matrix.KQ(F.matrix):z.Matrix.Compose(F.scale?z.gQ.KQ(F.scale):z.gQ.One(),F.rotation?z.Quaternion.KQ(F.rotation):z.Quaternion.Identity(),F.translation?z.gQ.KQ(F.translation):z.gQ.Zero())}loadCameraAsync(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadCameraAsync(F,b,Q);if(C)return C;const t=new Array;this.logOpen(`${F} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const g=new Z.e(b.name||`camera${b.index}`,z.gQ.Zero(),this._babylonScene,!1);switch(g._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonCamera=g,g.setTarget(new z.gQ(0,0,-1)),b.type){case"perspective":{const Q=b.perspective;if(!Q)throw new Error(`${F}: Camera perspective properties are missing`);g.fov=Q.yfov,g.kb=Q.znear,g.maxZ=Q.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${F}: Camera orthographic properties are missing`);g.mode=W.b.ORTHOGRAPHIC_CAMERA,g.orthoLeft=-b.orthographic.xmag,g.orthoRight=b.orthographic.xmag,g.orthoBottom=-b.orthographic.ymag,g.orthoTop=b.orthographic.ymag,g.kb=b.orthographic.znear,g.maxZ=b.orthographic.zfar;break;default:throw new Error(`${F}: Invalid camera type (${b.type})`)}return U.AddPointerMetadata(g,F),this._parent.onCameraLoadedObservable.notifyObservers(g),Q(g),this.logClose(),Promise.all(t).then((()=>g))}_loadAnimationsAsync(){const F=this._gltf.animations;if(!F)return Promise.resolve();const b=new Array;for(let Q=0;Q<F.length;Q++){const C=F[Q];b.push(this.loadAnimationAsync(`/animations/${C.index}`,C).then((F=>{0===F.targetedAnimations.length&&F.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(F,b){const C=this._extensionsLoadAnimationAsync(F,b);return C||Q.e(78).then(Q.bind(Q,14411)).then((Q=>{let{AnimationGroup:C}=Q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const z=new C(b.name||`animation${b.index}`,this._babylonScene);z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=z;const t=new Array;a.Assign(b.channels),a.Assign(b.samplers);for(const g of b.channels)t.push(this._loadAnimationChannelAsync(`${F}/channels/${g.index}`,F,b,g,((F,b)=>{F.animations=F.animations||[],F.animations.push(b),z.addTargetedAnimation(b,F)})));return Promise.all(t).then((()=>(z.normalize(0),z)))}))}async _loadAnimationChannelAsync(F,b,C,z,t){const g=this._extensionsLoadAnimationChannelAsync(F,b,C,z,t);if(g)return await g;if(void 0==z.target.node)return await Promise.resolve();const W=a.Get(`${F}/target/node`,this._gltf.nodes,z.target.node),Z=z.target.path,q="weights"===Z;if(q&&!W._numMorphTargets||!q&&!W._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!q&&!W._isJoint)return await Promise.resolve();let G;switch(await Promise.resolve().then(Q.bind(Q,12908)),Z){case"translation":var K;G=null===(K=(0,S.c)("/nodes/{}/translation"))||void 0===K?void 0:K.interpolation;break;case"rotation":var e;G=null===(e=(0,S.c)("/nodes/{}/rotation"))||void 0===e?void 0:e.interpolation;break;case"scale":var N;G=null===(N=(0,S.c)("/nodes/{}/scale"))||void 0===N?void 0:N.interpolation;break;case"weights":var y;G=null===(y=(0,S.c)("/nodes/{}/weights"))||void 0===y?void 0:y.interpolation;break;default:throw new Error(`${F}/target/path: Invalid value (${z.target.path})`)}if(!G)throw new Error(`${F}/target/path: Could not find interpolation properties for target path (${z.target.path})`);const E={object:W,info:G};return await this._loadAnimationChannelFromTargetInfoAsync(F,b,C,z,E,t)}_loadAnimationChannelFromTargetInfoAsync(F,b,Q,C,z,t){const g=this.parent.targetFps,W=1/g,Z=a.Get(`${F}/sampler`,Q.samplers,C.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${C.sampler}`,Z).then((F=>{let b=0;const Z=z.object,q=z.info;for(const z of q){const q=z.getStride(Z),G=F.input,K=F.output,e=new Array(G.length);let N=0;switch(F.interpolation){case"STEP":for(let F=0;F<G.length;F++){const b=z.getValue(Z,K,N,1);N+=q,e[F]={frame:G[F]*g,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let F=0;F<G.length;F++){const b=z.getValue(Z,K,N,W);N+=q;const Q=z.getValue(Z,K,N,1);N+=q;const C=z.getValue(Z,K,N,W);N+=q,e[F]={frame:G[F]*g,inTangent:b,value:Q,outTangent:C}}break;case"LINEAR":for(let F=0;F<G.length;F++){const b=z.getValue(Z,K,N,1);N+=q,e[F]={frame:G[F]*g,value:b}}}if(N>0){const F=`${Q.name||`animation${Q.index}`}_channel${C.index}_${b}`,W=z.buildAnimations(Z,F,g,e);for(const Q of W)b++,t(Q.babylonAnimatable,Q.babylonAnimation)}}}))}_loadAnimationSamplerAsync(F,b){if(b._data)return b._data;const Q=b.interpolation||"LINEAR";switch(Q){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${F}/interpolation: Invalid value (${b.interpolation})`)}const C=a.Get(`${F}/input`,this._gltf.accessors,b.input),z=a.Get(`${F}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${C.index}`,C),this._loadFloatAccessorAsync(`/accessors/${z.index}`,z)]).then((F=>{let[b,C]=F;return{input:b,interpolation:Q,output:C}})),b._data}loadBufferAsync(F,b,Q,C){const z=this._extensionsLoadBufferAsync(F,b,Q,C);if(z)return z;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${F}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${F}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+Q,C)}catch(z){throw new Error(`${F}: ${z.message}`)}}))}loadBufferViewAsync(F,b){const Q=this._extensionsLoadBufferViewAsync(F,b);if(Q)return Q;if(b._data)return b._data;const C=a.Get(`${F}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${C.index}`,C,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(F,b,Q){if(b._data)return b._data;const C=U._GetNumComponents(F,b.type),z=C*m.e.GetTypeByteLength(b.componentType),t=C*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new Q(t));else{const g=a.Get(`${F}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${g.index}`,g).then((W=>{if(5126!==b.componentType||b.normalized||g.byteStride&&g.byteStride!==z){const F=new Q(t);return m.e.ForEach(W,b.byteOffset||0,g.byteStride||z,C,b.componentType,F.length,b.normalized||!1,((b,Q)=>{F[Q]=b})),F}return U._GetTypedArray(F,b.componentType,W,b.byteOffset,t)}))}if(b.sparse){const t=b.sparse;b._data=b._data.then((g=>{const W=g,Z=a.Get(`${F}/sparse/indices/bufferView`,this._gltf.bufferViews,t.indices.bufferView),q=a.Get(`${F}/sparse/values/bufferView`,this._gltf.bufferViews,t.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z),this.loadBufferViewAsync(`/bufferViews/${q.index}`,q)]).then((g=>{let[Z,q]=g;const G=U._GetTypedArray(`${F}/sparse/indices`,t.indices.componentType,Z,t.indices.byteOffset,t.count),K=C*t.count;let e;if(5126!==b.componentType||b.normalized){const g=U._GetTypedArray(`${F}/sparse/values`,b.componentType,q,t.values.byteOffset,K);e=new Q(K),m.e.ForEach(g,0,z,C,b.componentType,e.length,b.normalized||!1,((F,b)=>{e[b]=F}))}else e=U._GetTypedArray(`${F}/sparse/values`,b.componentType,q,t.values.byteOffset,K);let N=0;for(let F=0;F<G.length;F++){let b=G[F]*C;for(let F=0;F<C;F++)W[b++]=e[N++]}return W}))}))}return b._data}_loadFloatAccessorAsync(F,b){return this._loadAccessorAsync(F,b,Float32Array)}_loadIndicesAccessorAsync(F,b){if("SCALAR"!==b.type)throw new Error(`${F}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${F}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const Q=U._GetTypedArrayConstructor(`${F}/componentType`,b.componentType);b._data=this._loadAccessorAsync(F,b,Q)}else{const Q=a.Get(`${F}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q).then((Q=>U._GetTypedArray(F,b.componentType,Q,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(F){if(F._babylonBuffer)return F._babylonBuffer;const b=this._babylonScene.getEngine();return F._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((F=>new m.d(b,F,!1))),F._babylonBuffer}_loadVertexAccessorAsync(F,b,Q){var C;if(null!==(C=b._babylonVertexBuffer)&&void 0!==C&&C[Q])return b._babylonVertexBuffer[Q];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const z=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[Q]=this._loadFloatAccessorAsync(F,b).then((F=>new m.e(z,F,Q,!1)));else{const C=a.Get(`${F}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[Q]=this._loadVertexBufferViewAsync(C).then((t=>{const g=U._GetNumComponents(F,b.type);return new m.e(z,t,Q,!1,void 0,C.byteStride,void 0,b.byteOffset,g,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[Q]}_loadMaterialMetallicRoughnessPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return b&&(b.baseColorFactor?(Q.albedoColor=t.GQ.KQ(b.baseColorFactor),Q.alpha=b.baseColorFactor[3]):Q.albedoColor=t.GQ.White(),Q.metallic=void 0==b.metallicFactor?1:b.metallicFactor,Q.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&C.push(this.loadTextureInfoAsync(`${F}/baseColorTexture`,b.baseColorTexture,(F=>{F.name=`${Q.name} (Base Color)`,Q.albedoTexture=F}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${F}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(F=>{F.name=`${Q.name} (Metallic Roughness)`,Q.metallicTexture=F}))),Q.useMetallnessFromMetallicTextureBlue=!0,Q.useRoughnessFromMetallicTextureGreen=!0,Q.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(C).then((()=>{}))}_loadMaterialAsync(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const t=this._extensionsLoadMaterialAsync(F,b,Q,C,z);if(t)return t;b._data=b._data||{};let g=b._data[C];if(!g){this.logOpen(`${F} ${b.name||""}`);const Q=this.createMaterial(F,b,C);g={babylonMaterial:Q,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(F,b,Q)},b._data[C]=g,U.AddPointerMetadata(Q,F),this._parent.onMaterialLoadedObservable.notifyObservers(Q),this.logClose()}return Q&&(g.babylonMeshes.push(Q),Q.Kb.addOnce((()=>{const F=g.babylonMeshes.indexOf(Q);-1!==F&&g.babylonMeshes.splice(F,1)}))),z(g.babylonMaterial),g.promise.then((()=>g.babylonMaterial))}_createDefaultMaterial(F,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const Q=new i.c(F,this._babylonScene);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Q.fillMode=b,Q.enableSpecularAntiAliasing=!0,Q.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,Q.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,Q.transparencyMode=i.c.PBRMATERIAL_OPAQUE,Q.metallic=1,Q.roughness=1,Q}createMaterial(F,b,Q){const C=this._extensionsCreateMaterial(F,b,Q);if(C)return C;const z=b.name||`material${b.index}`;return this._createDefaultMaterial(z,Q)}loadMaterialPropertiesAsync(F,b,Q){const C=this._extensionsLoadMaterialPropertiesAsync(F,b,Q);if(C)return C;const z=new Array;return z.push(this.loadMaterialBasePropertiesAsync(F,b,Q)),b.pbrMetallicRoughness&&z.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${F}/pbrMetallicRoughness`,b.pbrMetallicRoughness,Q)),this.loadMaterialAlphaProperties(F,b,Q),Promise.all(z).then((()=>{}))}loadMaterialBasePropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return Q.emissiveColor=b.emissiveFactor?t.GQ.KQ(b.emissiveFactor):new t.GQ(0,0,0),b.doubleSided&&(Q.nb=!1,Q.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${F}/normalTexture`,b.normalTexture,(F=>{F.name=`${Q.name} (Normal)`,Q.bumpTexture=F}))),Q.invertNormalMapX=!this._babylonScene.useRightHandedSystem,Q.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&Q.bumpTexture&&(Q.bumpTexture.level=b.normalTexture.scale),Q.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,C.push(this.loadTextureInfoAsync(`${F}/occlusionTexture`,b.occlusionTexture,(F=>{F.name=`${Q.name} (Occlusion)`,Q.ambientTexture=F}))),Q.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(Q.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&C.push(this.loadTextureInfoAsync(`${F}/emissiveTexture`,b.emissiveTexture,(F=>{F.name=`${Q.name} (Emissive)`,Q.emissiveTexture=F}))),Promise.all(C).then((()=>{}))}loadMaterialAlphaProperties(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":Q.transparencyMode=i.c.PBRMATERIAL_OPAQUE,Q.alpha=1;break;case"MASK":Q.transparencyMode=i.c.PBRMATERIAL_ALPHATEST,Q.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,Q.albedoTexture&&(Q.albedoTexture.ib=!0);break;case"BLEND":Q.transparencyMode=i.c.PBRMATERIAL_ALPHABLEND,Q.albedoTexture&&(Q.albedoTexture.ib=!0,Q.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${F}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureInfoAsync(F,b,Q);if(C)return C;if(this.logOpen(`${F}`),b.texCoord>=6)throw new Error(`${F}/texCoord: Invalid value (${b.texCoord})`);const z=a.Get(`${F}/index`,this._gltf.textures,b.index);z._textureInfo=b;const t=this._loadTextureAsync(`/textures/${b.index}`,z,(C=>{C.coordinatesIndex=b.texCoord||0,U.AddPointerMetadata(C,F),this._parent.onTextureLoadedObservable.notifyObservers(C),Q(C)}));return this.logClose(),t}_loadTextureAsync(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const C=this._extensionsLoadTextureAsync(F,b,Q);if(C)return C;this.logOpen(`${F} ${b.name||""}`);const z=void 0==b.sampler?U.DefaultSampler:a.Get(`${F}/sampler`,this._gltf.samplers,b.sampler),t=a.Get(`${F}/source`,this._gltf.images,b.source),g=this._createTextureAsync(F,z,t,Q,void 0,!b._textureInfo.nonColorData);return this.logClose(),g}_createTextureAsync(F,b,Q){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},t=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0;const W=this._loadSampler(`/samplers/${b.index}`,b),Z=new Array,q=new C;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G={noMipmap:W.noMipMaps,invertY:!1,samplingMode:W.samplingMode,M:()=>{this._disposed||q.resolve()},onError:(b,Q)=>{this._disposed||q.reject(new Error(`${F}: ${Q&&Q.message?Q.message:b||"Failed to load texture"}`))},mimeType:Q.mimeType??(0,s.k)(Q.uri??""),loaderOptions:t,useSRGBBuffer:!!g&&this._parent.useSRGBBuffers},K=new f.b(null,this._babylonScene,G);return K._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Z.push(q.promise),Z.push(this.loadImageAsync(`/images/${Q.index}`,Q).then((F=>{const b=Q.uri||`${this._fileName}#image${Q.index}`,C=`data:${this._uniqueRootUrl}${b}`;K.updateURL(C,F);const z=K.getInternalTexture();z&&(z.label=Q.name)}))),K.wrapU=W.wrapU,K.wrapV=W.wrapV,z(K),this._parent.useGltfTextureNames&&(K.name=Q.name||Q.uri||`image${Q.index}`),Promise.all(Z).then((()=>K))}_loadSampler(F,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:U._GetTextureSamplingMode(F,b),wrapU:U._GetTextureWrapMode(`${F}/wrapS`,b.wrapS),wrapV:U._GetTextureWrapMode(`${F}/wrapT`,b.wrapT)}),b._data}loadImageAsync(F,b){if(!b._data){if(this.logOpen(`${F} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${F}/uri`,b,b.uri);else{const Q=a.Get(`${F}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${Q.index}`,Q)}this.logClose()}return b._data}loadUriAsync(F,b,Q){const C=this._extensionsLoadUriAsync(F,b,Q);if(C)return C;if(!U._ValidateUri(Q))throw new Error(`${F}: '${Q}' is invalid`);if((0,s.n)(Q)){const b=new Uint8Array((0,s.d)(Q));return this.log(`${F}: Decoded ${Q.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${F}: Loading ${Q}`),this._parent.preprocessUrlAsync(this._rootUrl+Q).then((b=>new Promise(((C,z)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${F}: Loaded ${Q} (${b.byteLength} bytes)`),C(new Uint8Array(b)))}),!0,(b=>{z(new s.p(`${F}: Failed to load '${Q}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(F,b){F.metadata=F.metadata||{};const Q=F._internalMetadata=F._internalMetadata||{},C=Q.yb=Q.yb||{};(C.pointers=C.pointers||[]).push(b)}static _GetTextureWrapMode(F,b){switch(b=void 0==b?10497:b){case 33071:return f.b.CLAMP_ADDRESSMODE;case 33648:return f.b.MIRROR_ADDRESSMODE;case 10497:return f.b.WRAP_ADDRESSMODE;default:return E.e.Warn(`${F}: Invalid value (${b})`),f.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(F,b){const Q=void 0==b.magFilter?9729:b.magFilter,C=void 0==b.minFilter?9987:b.minFilter;if(9729===Q)switch(C){case 9728:return f.b.LINEAR_NEAREST;case 9729:return f.b.LINEAR_LINEAR;case 9984:return f.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return f.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return f.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return f.b.LINEAR_LINEAR_MIPLINEAR;default:return E.e.Warn(`${F}/minFilter: Invalid value (${C})`),f.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==Q&&E.e.Warn(`${F}/magFilter: Invalid value (${Q})`),C){case 9728:return f.b.NEAREST_NEAREST;case 9729:return f.b.NEAREST_LINEAR;case 9984:return f.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return f.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return f.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return f.b.NEAREST_LINEAR_MIPLINEAR;default:return E.e.Warn(`${F}/minFilter: Invalid value (${C})`),f.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(F,b){try{return(0,x.v)(b)}catch(Q){throw new Error(`${F}: ${Q.message}`)}}static _GetTypedArray(F,b,Q,C,z){const t=Q.buffer;C=Q.byteOffset+(C||0);const g=U._GetTypedArrayConstructor(`${F}/componentType`,b),W=m.e.GetTypeByteLength(b);return C%W!==0?(E.e.Warn(`${F}: Copying buffer as byte offset (${C}) is not a multiple of component type byte length (${W})`),new g(t.slice(C,C+z*W),0)):new g(t,C,z)}static _GetNumComponents(F,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${F}: Invalid type (${b})`)}static _ValidateUri(F){return g.Tools.IsBase64(F)||-1===F.indexOf("..")}static _GetDrawMode(F,b){switch(void 0==b&&(b=4),b){case 0:return L.c.PointListDrawMode;case 1:return L.c.LineListDrawMode;case 2:return L.c.LineLoopDrawMode;case 3:return L.c.LineStripDrawMode;case 4:return L.c.TriangleFillMode;case 5:return L.c.TriangleStripDrawMode;case 6:return L.c.TriangleFanDrawMode}throw new Error(`${F}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const F=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const Q in b._data){const C=b._data[Q];for(const b of C.babylonMeshes){b.Rb(!0);const Q=C.babylonMaterial;F.push(Q.forceCompilationAsync(b)),F.push(Q.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(F.push(Q.forceCompilationAsync(b,{clipPlane:!0})),F.push(Q.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(F).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const F=new Array,b=this._babylonScene.lights;for(const Q of b){const b=Q.getShadowGenerator();b&&F.push(b.forceCompilationAsync())}return Promise.all(F).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(F){for(const b of this._extensions)b.enabled&&F(b)}_applyExtensions(F,b,Q){for(const C of this._extensions)if(C.enabled){const z=`${C.name}.${b}`,t=F;t._activeLoaderExtensionFunctions=t._activeLoaderExtensionFunctions||{};const g=t._activeLoaderExtensionFunctions;if(!g[z]){g[z]=!0;try{const F=Q(C);if(F)return F}finally{delete g[z]}}}return null}_extensionsOnLoading(){this._forEachExtensions((F=>F.onLoading&&F.onLoading()))}_extensionsOnReady(){this._forEachExtensions((F=>F.onReady&&F.onReady()))}_extensionsLoadSceneAsync(F,b){return this._applyExtensions(b,"loadScene",(Q=>Q.loadSceneAsync&&Q.loadSceneAsync(F,b)))}_extensionsLoadNodeAsync(F,b,Q){return this._applyExtensions(b,"loadNode",(C=>C.loadNodeAsync&&C.loadNodeAsync(F,b,Q)))}_extensionsLoadCameraAsync(F,b,Q){return this._applyExtensions(b,"loadCamera",(C=>C.loadCameraAsync&&C.loadCameraAsync(F,b,Q)))}_extensionsLoadVertexDataAsync(F,b,Q){return this._applyExtensions(b,"loadVertexData",(C=>C._loadVertexDataAsync&&C._loadVertexDataAsync(F,b,Q)))}_extensionsLoadMeshPrimitiveAsync(F,b,Q,C,z,t){return this._applyExtensions(z,"loadMeshPrimitive",(g=>g._loadMeshPrimitiveAsync&&g._loadMeshPrimitiveAsync(F,b,Q,C,z,t)))}_extensionsLoadMaterialAsync(F,b,Q,C,z){return this._applyExtensions(b,"loadMaterial",(t=>t._loadMaterialAsync&&t._loadMaterialAsync(F,b,Q,C,z)))}_extensionsCreateMaterial(F,b,Q){return this._applyExtensions(b,"createMaterial",(C=>C.createMaterial&&C.createMaterial(F,b,Q)))}_extensionsLoadMaterialPropertiesAsync(F,b,Q){return this._applyExtensions(b,"loadMaterialProperties",(C=>C.loadMaterialPropertiesAsync&&C.loadMaterialPropertiesAsync(F,b,Q)))}_extensionsLoadTextureInfoAsync(F,b,Q){return this._applyExtensions(b,"loadTextureInfo",(C=>C.loadTextureInfoAsync&&C.loadTextureInfoAsync(F,b,Q)))}_extensionsLoadTextureAsync(F,b,Q){return this._applyExtensions(b,"loadTexture",(C=>C._loadTextureAsync&&C._loadTextureAsync(F,b,Q)))}_extensionsLoadAnimationAsync(F,b){return this._applyExtensions(b,"loadAnimation",(Q=>Q.loadAnimationAsync&&Q.loadAnimationAsync(F,b)))}_extensionsLoadAnimationChannelAsync(F,b,Q,C,z){return this._applyExtensions(Q,"loadAnimationChannel",(t=>t._loadAnimationChannelAsync&&t._loadAnimationChannelAsync(F,b,Q,C,z)))}_extensionsLoadSkinAsync(F,b,Q){return this._applyExtensions(Q,"loadSkin",(C=>C._loadSkinAsync&&C._loadSkinAsync(F,b,Q)))}_extensionsLoadUriAsync(F,b,Q){return this._applyExtensions(b,"loadUri",(C=>C._loadUriAsync&&C._loadUriAsync(F,b,Q)))}_extensionsLoadBufferViewAsync(F,b){return this._applyExtensions(b,"loadBufferView",(Q=>Q.loadBufferViewAsync&&Q.loadBufferViewAsync(F,b)))}_extensionsLoadBufferAsync(F,b,Q,C){return this._applyExtensions(b,"loadBuffer",(z=>z.loadBufferAsync&&z.loadBufferAsync(F,b,Q,C)))}static LoadExtensionAsync(F,b,Q,C){if(!b.extensions)return null;const z=b.extensions[Q];return z?C(`${F}/extensions/${Q}`,z):null}static LoadExtraAsync(F,b,Q,C){if(!b.extras)return null;const z=b.extras[Q];return z?C(`${F}/extras/${Q}`,z):null}isExtensionUsed(F){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(F)}logOpen(F){this._parent._logOpen(F)}logClose(){this._parent._logClose()}log(F){this._parent._log(F)}startPerformanceCounter(F){this._parent._startPerformanceCounter(F)}endPerformanceCounter(F){this._parent._endPerformanceCounter(F)}}U.DefaultSampler={index:-1},Y.e._CreateGLTF2Loader=F=>new U(F);var u=Q(12908),v=Q(11505),J=Q(11349),I=Q(12910),M=Q(12914);class r extends M.e{constructor(F,b,Q){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",F),this._texture=F.getEngine().createRawCubeTexture(b,Q,C,z,t,g,W,Z)}update(F,b,Q,C){let z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,F,b,Q,C,z)}updateRGBDAsync(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,I.f)(this._texture,F,b,Q,C).then((()=>{}))}clone(){return J.e.Clone((()=>{const F=this.RF(),b=this._texture,Q=new r(F,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&Q.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),Q}),this)}}const H="EXT_lights_image_based";class B{constructor(F){this.name=H,this._loader=F,this.enabled=this._loader.isExtensionUsed(H)}dispose(){this._loader=null,delete this._lights}onLoading(){const F=this._loader.yb.extensions;if(F&&F[this.name]){const b=F[this.name];this._lights=b.lights}}loadSceneAsync(F,b){return U.LoadExtensionAsync(F,b,this.name,(async(Q,C)=>{this._loader._allMaterialsDirtyRequired=!0;const z=new Array;z.push(this._loader.loadSceneAsync(F,b)),this._loader.logOpen(`${Q}`);const t=a.Get(`${Q}/light`,this._lights,C.Zb);return z.push(this._loadLightAsync(`/extensions/${this.name}/lights/${C.Zb}`,t).then((F=>{this._loader.babylonScene.environmentTexture=F}))),this._loader.logClose(),await Promise.all(z).then((()=>{}))}))}_loadLightAsync(F,b){if(!b._loaded){const Q=new Array;this._loader.logOpen(`${F}`);const C=new Array(b.specularImages.length);for(let z=0;z<b.specularImages.length;z++){const t=b.specularImages[z];C[z]=new Array(t.length);for(let b=0;b<t.length;b++){const g=`${F}/specularImages/${z}/${b}`;this._loader.logOpen(`${g}`);const W=t[b],Z=a.Get(g,this._loader.yb.images,W);Q.push(this._loader.loadImageAsync(`/images/${W}`,Z).then((F=>{C[z][b]=F}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(Q).then((async()=>{const Q=new r(this._loader.babylonScene,null,b.specularImageSize);if(Q.name=b.name||"environment",b._babylonTexture=Q,void 0!=b.lb&&(Q.level=b.lb),b.rotation){let F=z.Quaternion.KQ(b.rotation);this._loader.babylonScene.useRightHandedSystem||(F=z.Quaternion.Inverse(F)),z.Matrix.FromQuaternionToRef(F,Q.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${F}: Irradiance coefficients are missing`);const t=v.c.KQ(b.irradianceCoefficients);t.scaleInPlace(b.lb),t.convertIrradianceToLambertianRadiance();const g=v.e.FromHarmonics(t),W=(C.length-1)/Math.log2(b.specularImageSize);return await Q.updateRGBDAsync(C,g,W)}))}return b._loaded.then((()=>b._babylonTexture))}}o(H),T(H,!0,(F=>new B(F)));Q(11849);const d="EXT_mesh_gpu_instancing";class FF{constructor(F){this.name=d,this._loader=F,this.enabled=this._loader.isExtensionUsed(d)}dispose(){this._loader=null}loadNodeAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(F,C)=>{this._loader._disableInstancedMesh++;const t=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,Q);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return await t;const g=new Array;let W=0;const Z=b=>{if(void 0==C.attributes[b])return void g.push(Promise.resolve(null));const Q=a.Get(`${F}/attributes/${b}`,this._loader.yb.accessors,C.attributes[b]);if(g.push(this._loader._loadFloatAccessorAsync(`/accessors/${Q.bufferView}`,Q)),0===W)W=Q.count;else if(W!==Q.count)throw new Error(`${F}/attributes: Instance buffer accessors do not have the same count.`)};return Z("TRANSLATION"),Z("ROTATION"),Z("SCALE"),await t.then((async F=>{const[Q,C,t]=await Promise.all(g),Z=new Float32Array(16*W);z.TmpVectors.gQ[0].jb(0,0,0),z.TmpVectors.Quaternion[0].jb(0,0,0,1),z.TmpVectors.gQ[1].jb(1,1,1);for(let b=0;b<W;++b)Q&&z.gQ.FromArrayToRef(Q,3*b,z.TmpVectors.gQ[0]),C&&z.Quaternion.FromArrayToRef(C,4*b,z.TmpVectors.Quaternion[0]),t&&z.gQ.FromArrayToRef(t,3*b,z.TmpVectors.gQ[1]),z.Matrix.ComposeToRef(z.TmpVectors.gQ[1],z.TmpVectors.Quaternion[0],z.TmpVectors.gQ[0],z.TmpVectors.Matrix[0]),z.TmpVectors.Matrix[0].copyToArray(Z,16*b);for(const z of b._primitiveBabylonMeshes)z.uK("matrix",Z,16,!0);return F}))}))}}o(d),T(d,!0,(F=>new FF(F)));let bF=0,QF=null;class CF{static get Default(){return CF._Default||(CF._Default=new CF),CF._Default}constructor(){const F=CF.Configuration.decoder;this._decoderModulePromise=g.Tools.LoadBabylonScriptAsync(F.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(F,b,Q,C,z){await this._decoderModulePromise,0===bF&&(MeshoptDecoder.useWorkers(1),bF=1);const t=await MeshoptDecoder.decodeGltfBufferAsync(b,Q,F,C,z);return null!==QF&&clearTimeout(QF),QF=setTimeout((()=>{MeshoptDecoder.useWorkers(0),bF=0,QF=null}),1e3),t}}CF.Configuration={decoder:{url:`${g.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},CF._Default=null;const zF="EXT_meshopt_compression";class tF{constructor(F){this.name=zF,this.enabled=F.isExtensionUsed(zF),this._loader=F}dispose(){this._loader=null}loadBufferViewAsync(F,b){return U.LoadExtensionAsync(F,b,this.name,(async(Q,C)=>{const z=b;if(z._meshOptData)return await z._meshOptData;const t=a.Get(`${F}/buffer`,this._loader.yb.buffers,C.buffer);return z._meshOptData=this._loader.loadBufferAsync(`/buffers/${t.index}`,t,C.byteOffset||0,C.byteLength).then((async F=>await CF.Default.decodeGltfBufferAsync(F,C.count,C.byteStride,C.mode,C.filter))),await z._meshOptData}))}}o(zF),T(zF,!0,(F=>new tF(F)));const gF="EXT_texture_webp";class WF{constructor(F){this.name=gF,this._loader=F,this.enabled=F.isExtensionUsed(gF)}dispose(){this._loader=null}_loadTextureAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=void 0==b.sampler?U.DefaultSampler:a.Get(`${F}/sampler`,this._loader.yb.samplers,b.sampler),g=a.Get(`${C}/source`,this._loader.yb.images,z.source);return await this._loader._createTextureAsync(F,t,g,(F=>{Q(F)}),void 0,!b._textureInfo.nonColorData)}))}}o(gF),T(gF,!0,(F=>new WF(F)));const ZF="EXT_texture_avif";class qF{constructor(F){this.name=ZF,this._loader=F,this.enabled=F.isExtensionUsed(ZF)}dispose(){this._loader=null}_loadTextureAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=void 0==b.sampler?U.DefaultSampler:a.Get(`${F}/sampler`,this._loader.yb.samplers,b.sampler),g=a.Get(`${C}/source`,this._loader.yb.images,z.source);return await this._loader._createTextureAsync(F,t,g,(F=>{Q(F)}),void 0,!b._textureInfo.nonColorData)}))}}o(ZF),T(ZF,!0,(F=>new qF(F)));var GF=Q(12903),KF=Q(11827);const eF="EXT_lights_ies";class NF{constructor(F){this.name=eF,this._loader=F,this.enabled=this._loader.isExtensionUsed(eF)}dispose(){this._loader=null,delete this._lights}onLoading(){const F=this._loader.yb.extensions;if(F&&F[this.name]){const b=F[this.name];this._lights=b.lights,a.Assign(this._lights)}}loadNodeAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,g)=>{let W,Z;this._loader._allMaterialsDirtyRequired=!0;const q=await this._loader.loadNodeAsync(F,b,(F=>{Z=a.Get(C,this._lights,g.Zb);const b=Z.name||F.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,W=new GF.b(b,z.gQ.Zero(),z.gQ.Backward(),0,1,this._loader.babylonScene),W.angle=Math.PI/2,W.innerAngle=0,W._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,Z._babylonLight=W,W.falloffType=KF.e.FALLOFF_GLTF,W.Tb=g.color?t.GQ.KQ(g.color):t.GQ.White(),W.lb=g.multiplier||1,W.range=Number.MAX_VALUE,W.parent=F,this._loader._babylonLights.push(W),U.AddPointerMetadata(W,C),Q(F)}));let G;if(Z.uri)G=await this._loader.loadUriAsync(F,Z,Z.uri);else{const b=a.Get(`${F}/bufferView`,this._loader.yb.bufferViews,Z.bufferView);G=await this._loader.loadBufferViewAsync(`/bufferViews/${b.index}`,b)}return W.iesProfileTexture=new f.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,G,!0,void 0,void 0,void 0,void 0,".ies"),q}))}}o(eF),T(eF,!0,(F=>new NF(F)));var yF=Q(12926);const EF="KHR_draco_mesh_compression";class cF{constructor(F){this.name=EF,this.useNormalizedFlagFromAccessor=!0,this._loader=F,this.enabled=yF.c.DefaultAvailable&&this._loader.isExtensionUsed(EF)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${F}: Unsupported mode ${b.mode}`);const t={},g={},W=(F,C)=>{const W=z.attributes[F];if(void 0!=W&&(Q._delayInfo=Q._delayInfo||[],-1===Q._delayInfo.indexOf(C)&&Q._delayInfo.push(C),t[C]=W,this.useNormalizedFlagFromAccessor)){const Q=a.TryGet(this._loader.yb.accessors,b.attributes[F]);Q&&(g[C]=Q.normalized||!1)}};W("POSITION",m.e.PositionKind),W("NORMAL",m.e.NormalKind),W("TANGENT",m.e.TangentKind),W("TEXCOORD_0",m.e.UVKind),W("TEXCOORD_1",m.e.UV2Kind),W("TEXCOORD_2",m.e.UV3Kind),W("TEXCOORD_3",m.e.UV4Kind),W("TEXCOORD_4",m.e.UV5Kind),W("TEXCOORD_5",m.e.UV6Kind),W("JOINTS_0",m.e.MatricesIndicesKind),W("WEIGHTS_0",m.e.MatricesWeightsKind),W("COLOR_0",m.e.ColorKind);const Z=a.Get(C,this._loader.yb.bufferViews,z.bufferView);return Z._dracoBabylonGeometry||(Z._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z).then((async C=>{const z=this.dracoDecoder||yF.c.Default,W=a.TryGet(this._loader.yb.accessors,b.attributes.POSITION),Z=this._loader.parent.alwaysComputeBoundingBox||Q.skeleton||!W?null:A(W);return await z._decodeMeshToGeometryForGltfAsync(Q.name,this._loader.babylonScene,C,t,g,Z).catch((b=>{throw new Error(`${F}: ${b.message}`)}))}))),await Z._dracoBabylonGeometry}))}}o(EF),T(EF,!0,(F=>new cF(F)));var XF=Q(12933),LF=Q(11293),iF=Q(11296),fF=Q(11715),kF=Q(11881),mF=Q(11265);fF.c.AddNodeConstructor("Light_Type_0",((F,b)=>()=>new RF(F,z.gQ.Zero(),b)));class RF extends kF.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(F){this._shadowAngle=F,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(F){const b=this.needCube();if(this._direction=F,this.needCube()!==b&&this._shadowGenerators){const F=this._shadowGenerators.values();for(let b=F.next();!0!==b.done;b=F.next()){b.value.recreateShadowMap()}}}constructor(F,b,Q){super(F,Q),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return KF.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(F){if(this.direction)return super.getShadowDirection(F);switch(F){case 0:return new z.gQ(1,0,0);case 1:return new z.gQ(-1,0,0);case 2:return new z.gQ(0,-1,0);case 3:return new z.gQ(0,1,0);case 4:return new z.gQ(0,0,1);case 5:return new z.gQ(0,0,-1)}return z.gQ.Zero()}_setDefaultShadowProjectionMatrix(F,b,Q){const C=this.RF().activeCamera;if(!C)return;const t=void 0!==this.shadowMinZ?this.shadowMinZ:C.kb,g=void 0!==this.shadowMaxZ?this.shadowMaxZ:C.maxZ,W=this.RF().getEngine().useReverseDepthBuffer;z.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,W?g:t,W?t:g,F,!0,this._scene.getEngine().isNDCHalfZRange,void 0,W)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(F,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(F,b){return this.computeTransformedInformation()?F.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):F.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(F,b){F["POINTLIGHT"+b]=!0}}(0,LF.b)([(0,iF.A)()],RF.prototype,"shadowAngle",null),(0,mF.g)("BABYLON.PointLight",RF);const pF="KHR_lights_punctual";class DF{constructor(F){this.name=pF,this._loader=F,this.enabled=this._loader.isExtensionUsed(pF)}dispose(){this._loader=null,delete this._lights}onLoading(){const F=this._loader.yb.extensions;if(F&&F[this.name]){const b=F[this.name];this._lights=b.lights,a.Assign(this._lights)}}loadNodeAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,g)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(F,b,(F=>{let b;const W=a.Get(C,this._lights,g.Zb),Z=W.name||F.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,W.type){case"directional":{const F=new XF.b(Z,z.gQ.Backward(),this._loader.babylonScene);F.position.Yb(0),b=F;break}case"point":b=new RF(Z,z.gQ.Zero(),this._loader.babylonScene);break;case"spot":{const F=new GF.b(Z,z.gQ.Zero(),z.gQ.Backward(),0,1,this._loader.babylonScene);F.angle=2*(W.spot&&W.spot.outerConeAngle||Math.PI/4),F.innerAngle=2*(W.spot&&W.spot.innerConeAngle||0),b=F;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${C}: Invalid light type (${W.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,W._babylonLight=b,b.falloffType=KF.e.FALLOFF_GLTF,b.Tb=W.color?t.GQ.KQ(W.color):t.GQ.White(),b.lb=void 0==W.lb?1:W.lb,b.range=void 0==W.range?Number.MAX_VALUE:W.range,b.parent=F,this._loader._babylonLights.push(b),U.AddPointerMetadata(b,C),Q(F)})))))}}o(pF),T(pF,!0,(F=>new DF(F)));const PF="KHR_materials_pbrSpecularGlossiness";class nF{constructor(F){this.name=PF,this.order=200,this._loader=F,this.enabled=this._loader.isExtensionUsed(PF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialBasePropertiesAsync(F,b,Q)),t.push(this._loadSpecularGlossinessPropertiesAsync(C,z,Q)),this._loader.loadMaterialAlphaProperties(F,b,Q),await Promise.all(t).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return Q.metallic=null,Q.roughness=null,b.diffuseFactor?(Q.albedoColor=t.GQ.KQ(b.diffuseFactor),Q.alpha=b.diffuseFactor[3]):Q.albedoColor=t.GQ.White(),Q.reflectivityColor=b.specularFactor?t.GQ.KQ(b.specularFactor):t.GQ.White(),Q.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/diffuseTexture`,b.diffuseTexture,(F=>{F.name=`${Q.name} (Diffuse)`,Q.albedoTexture=F}))),b.specularGlossinessTexture&&(C.push(this._loader.loadTextureInfoAsync(`${F}/specularGlossinessTexture`,b.specularGlossinessTexture,(F=>{F.name=`${Q.name} (Specular Glossiness)`,Q.reflectivityTexture=F,Q.reflectivityTexture.ib=!0}))),Q.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(C).then((()=>{}))}}o(PF),T(PF,!0,(F=>new nF(F)));const jF="KHR_materials_unlit";class wF{constructor(F){this.name=jF,this.order=210,this._loader=F,this.enabled=this._loader.isExtensionUsed(jF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async()=>await this._loadUnlitPropertiesAsync(F,b,Q)))}_loadUnlitPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;Q.unlit=!0;const z=b.pbrMetallicRoughness;return z&&(z.baseColorFactor?(Q.albedoColor=t.GQ.KQ(z.baseColorFactor),Q.alpha=z.baseColorFactor[3]):Q.albedoColor=t.GQ.White(),z.baseColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/baseColorTexture`,z.baseColorTexture,(F=>{F.name=`${Q.name} (Base Color)`,Q.albedoTexture=F})))),b.doubleSided&&(Q.nb=!1,Q.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(F,b,Q),Promise.all(C).then((()=>{}))}}o(jF),T(jF,!0,(F=>new wF(F)));const YF="KHR_materials_clearcoat";class sF{constructor(F){this.name=YF,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(YF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadClearCoatPropertiesAsync(C,z,Q)),await Promise.all(t)}))}_loadClearCoatPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return Q.clearCoat.isEnabled=!0,Q.clearCoat.useRoughnessFromMainTexture=!1,Q.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?Q.clearCoat.lb=b.clearcoatFactor:Q.clearCoat.lb=0,b.clearcoatTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/clearcoatTexture`,b.clearcoatTexture,(F=>{F.name=`${Q.name} (ClearCoat)`,Q.clearCoat.texture=F}))),void 0!=b.clearcoatRoughnessFactor?Q.clearCoat.roughness=b.clearcoatRoughnessFactor:Q.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${F}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(F=>{F.name=`${Q.name} (ClearCoat Roughness)`,Q.clearCoat.textureRoughness=F})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${F}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(F=>{F.name=`${Q.name} (ClearCoat Normal)`,Q.clearCoat.bumpTexture=F}))),Q.invertNormalMapX=!Q.RF().useRightHandedSystem,Q.invertNormalMapY=Q.RF().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(Q.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(C).then((()=>{}))}}o(YF),T(YF,!0,(F=>new sF(F)));const VF="KHR_materials_iridescence";class hF{constructor(F){this.name=VF,this.order=195,this._loader=F,this.enabled=this._loader.isExtensionUsed(VF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadIridescencePropertiesAsync(C,z,Q)),await Promise.all(t).then((()=>{}))}))}_loadIridescencePropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return Q.iridescence.isEnabled=!0,Q.iridescence.lb=b.iridescenceFactor??0,Q.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,Q.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,Q.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/iridescenceTexture`,b.iridescenceTexture,(F=>{F.name=`${Q.name} (Iridescence)`,Q.iridescence.texture=F}))),b.iridescenceThicknessTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(F=>{F.name=`${Q.name} (Iridescence Thickness)`,Q.iridescence.thicknessTexture=F}))),Promise.all(C).then((()=>{}))}}o(VF),T(VF,!0,(F=>new hF(F)));const lF="KHR_materials_anisotropy";class TF{constructor(F){this.name=lF,this.order=195,this._loader=F,this.enabled=this._loader.isExtensionUsed(lF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadIridescencePropertiesAsync(C,z,Q)),await Promise.all(t)}))}async _loadIridescencePropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;Q.anisotropy.isEnabled=!0,Q.anisotropy.lb=b.anisotropyStrength??0,Q.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${F}/anisotropyTexture`,b.anisotropyTexture,(F=>{F.name=`${Q.name} (Anisotropy Intensity)`,Q.anisotropy.texture=F})))),await Promise.all(C)}}o(lF),T(lF,!0,(F=>new TF(F)));const oF="KHR_materials_emissive_strength";class SF{constructor(F){this.name=oF,this.order=170,this._loader=F,this.enabled=this._loader.isExtensionUsed(oF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>await this._loader.loadMaterialPropertiesAsync(F,b,Q).then((()=>{this._loadEmissiveProperties(C,z,Q)}))))}_loadEmissiveProperties(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);void 0!==b.emissiveStrength&&(Q.emissiveIntensity=b.emissiveStrength)}}o(oF),T(oF,!0,(F=>new SF(F)));const OF="KHR_materials_sheen";class xF{constructor(F){this.name=OF,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(OF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadSheenPropertiesAsync(C,z,Q)),await Promise.all(t).then((()=>{}))}))}_loadSheenPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return Q.sheen.isEnabled=!0,Q.sheen.lb=1,void 0!=b.sheenColorFactor?Q.sheen.color=t.GQ.KQ(b.sheenColorFactor):Q.sheen.color=t.GQ.Black(),b.sheenColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/sheenColorTexture`,b.sheenColorTexture,(F=>{F.name=`${Q.name} (Sheen Color)`,Q.sheen.texture=F}))),void 0!==b.sheenRoughnessFactor?Q.sheen.roughness=b.sheenRoughnessFactor:Q.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${F}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(F=>{F.name=`${Q.name} (Sheen Roughness)`,Q.sheen.textureRoughness=F})))),Q.sheen.albedoScaling=!0,Q.sheen.useRoughnessFromMainTexture=!1,Promise.all(C).then((()=>{}))}}o(OF),T(OF,!0,(F=>new xF(F)));var aF=Q(11776);const AF="KHR_materials_specular";class UF{constructor(F){this.name=AF,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(AF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;if(t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadSpecularPropertiesAsync(C,z,Q)),z.extensions&&z.extensions.EXT_materials_specular_edge_color&&Q instanceof i.c){z.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(Q.brdf.dielectricSpecularModel=aF.c.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,Q.brdf.conductorSpecularModel=aF.c.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(t).then((()=>{}))}))}_loadSpecularPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return void 0!==b.specularFactor&&(Q.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(Q.metallicReflectanceColor=t.GQ.KQ(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,C.push(this._loader.loadTextureInfoAsync(`${F}/specularTexture`,b.specularTexture,(F=>{F.name=`${Q.name} (Specular)`,Q.metallicReflectanceTexture=F,Q.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/specularColorTexture`,b.specularColorTexture,(F=>{F.name=`${Q.name} (Specular Color)`,Q.reflectanceTexture=F}))),Promise.all(C).then((()=>{}))}}o(AF),T(AF,!0,(F=>new UF(F)));const uF="KHR_materials_ior";class vF{constructor(F){this.name=uF,this.order=180,this._loader=F,this.enabled=this._loader.isExtensionUsed(uF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadIorPropertiesAsync(C,z,Q)),await Promise.all(t).then((()=>{}))}))}_loadIorPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);return void 0!==b.ior?Q.indexOfRefraction=b.ior:Q.indexOfRefraction=vF._DEFAULT_IOR,Promise.resolve()}}vF._DEFAULT_IOR=1.5,o(uF),T(uF,!0,(F=>new vF(F)));const JF="KHR_materials_variants";class IF{constructor(F){this.name=JF,this._loader=F,this.enabled=this._loader.isExtensionUsed(JF)}dispose(){this._loader=null}static GetAvailableVariants(F){const b=this._GetExtensionMetadata(F);return b?Object.keys(b.variants):[]}getAvailableVariants(F){return IF.GetAvailableVariants(F)}static SelectVariant(F,b){const Q=this._GetExtensionMetadata(F);if(!Q)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${JF} extension`);const C=F=>{const b=Q.variants[F];if(b)for(const Q of b)Q.mesh.material=Q.material};if(b instanceof Array)for(const z of b)C(z);else C(b);Q.lastSelected=b}selectVariant(F,b){IF.SelectVariant(F,b)}static Reset(F){const b=this._GetExtensionMetadata(F);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${JF} extension`);for(const Q of b.original)Q.mesh.material=Q.material;b.lastSelected=null}reset(F){IF.Reset(F)}static GetLastSelectedVariant(F){const b=this._GetExtensionMetadata(F);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${JF} extension`);return b.lastSelected}getLastSelectedVariant(F){return IF.GetLastSelectedVariant(F)}static _GetExtensionMetadata(F){var b,Q;return(null===F||void 0===F||null===(b=F._internalMetadata)||void 0===b||null===(Q=b.yb)||void 0===Q?void 0:Q[JF])||null}onLoading(){const F=this._loader.yb.extensions;if(F&&F[this.name]){const b=F[this.name];this._variants=b.variants}}onReady(){const F=this._loader.rootBabylonMesh;if(F){var b;const Q=this._loader.parent.extensionOptions[JF];null!==Q&&void 0!==Q&&Q.defaultVariant&&IF.SelectVariant(F,Q.defaultVariant),null===Q||void 0===Q||null===(b=Q.onLoaded)||void 0===b||b.call(Q,{get variants(){return IF.GetAvailableVariants(F)},get selectedVariant(){const b=IF.GetLastSelectedVariant(F);return b?Array.isArray(b)?b[0]:b:IF.GetAvailableVariants(F)[0]},set selectedVariant(b){IF.SelectVariant(F,b)}})}}_loadMeshPrimitiveAsync(F,b,Q,C,z,t){return U.LoadExtensionAsync(F,z,this.name,(async(g,W)=>{const Z=new Array;return Z.push(this._loader._loadMeshPrimitiveAsync(F,b,Q,C,z,(b=>{if(t(b),b instanceof D.b){const Q=U._GetDrawMode(F,z.mode),C=this._loader.rootBabylonMesh,t=C?C._internalMetadata=C._internalMetadata||{}:{},q=t.yb=t.yb||{},G=q[JF]=q[JF]||{lastSelected:null,original:[],variants:{}};G.original.push({mesh:b,material:b.material});for(let F=0;F<W.mappings.length;++F){const z=W.mappings[F],t=a.Get(`${g}/mappings/${F}/material`,this._loader.yb.materials,z.material);Z.push(this._loader._loadMaterialAsync(`#/materials/${z.material}`,t,b,Q,(F=>{for(let Q=0;Q<z.variants.length;++Q){const t=z.variants[Q],g=a.Get(`/extensions/${JF}/variants/${t}`,this._variants,t);G.variants[g.name]=G.variants[g.name]||[],G.variants[g.name].push({mesh:b,material:F}),b.onClonedObservable.add((F=>{const Q=F;let z=null,t=Q;do{if(t=t.parent,!t)return;z=IF._GetExtensionMetadata(t)}while(null===z);if(C&&z===IF._GetExtensionMetadata(C)){t._internalMetadata={};for(const F in C._internalMetadata)t._internalMetadata[F]=C._internalMetadata[F];t._internalMetadata.yb=[];for(const F in C._internalMetadata.yb)t._internalMetadata.yb[F]=C._internalMetadata.yb[F];t._internalMetadata.yb[JF]={lastSelected:null,original:[],variants:{}};for(const F of z.original)t._internalMetadata.yb[JF].original.push({mesh:F.mesh,material:F.material});for(const F in z.variants)if(Object.prototype.hasOwnProperty.call(z.variants,F)){t._internalMetadata.yb[JF].variants[F]=[];for(const b of z.variants[F])t._internalMetadata.yb[JF].variants[F].push({mesh:b.mesh,material:b.material})}z=t._internalMetadata.yb[JF]}for(const C of z.original)C.mesh===b&&(C.mesh=Q);for(const C of z.variants[g.name])C.mesh===b&&(C.mesh=Q)}))}})))}}}))),await Promise.all(Z).then((F=>{let[b]=F;return b}))}))}}o(JF),T(JF,!0,(F=>new IF(F)));var MF=Q(11367);class rF{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:aF.c.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(F,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...rF._GetDefaultOptions(),...F},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new G.c,this._scene.Kb.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(F){if(!Object.keys(F).filter((b=>this._options[b]!==F[b])).length)return;const b={...this._options,...F},Q=this._options;this._options=b,b.renderSize===Q.renderSize&&b.renderTargetTextureType===Q.renderTargetTextureType&&b.generateMipmaps===Q.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(F){return!!F&&!!(F instanceof i.c&&F.subSurface.isRefractionEnabled)}_addMesh(F){this._materialObservers[F.uniqueId]=F.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),g.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(F.material)?(F.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(F)&&this._transparentMeshesCache.push(F)):-1===this._opaqueMeshesCache.indexOf(F)&&this._opaqueMeshesCache.push(F)}))}_removeMesh(F){F.onMaterialChangedObservable.remove(this._materialObservers[F.uniqueId]),delete this._materialObservers[F.uniqueId];let b=this._transparentMeshesCache.indexOf(F);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(F),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(F){const b=this._transparentMeshesCache.indexOf(F),Q=this._opaqueMeshesCache.indexOf(F);this._shouldRenderAsTransmission(F.material)?(F.material instanceof i.c&&(F.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==Q?(this._opaqueMeshesCache.splice(Q,1),this._transparentMeshesCache.push(F)):-1===b&&this._transparentMeshesCache.push(F)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(F)):-1===Q&&this._opaqueMeshesCache.push(F)}_isRenderTargetValid(){var F;return null!==(null===(F=this._opaqueRenderTarget)||void 0===F?void 0:F.getInternalTexture())}_setupRenderTargets(){var F;let b;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new MF.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(F=this._options.clearColor)||void 0===F?void 0:F.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((F=>{b=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?F.clearColor.W(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(F.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=b}));for(const Q of this._transparentMeshesCache)this._shouldRenderAsTransmission(Q.material)&&(Q.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const HF="KHR_materials_transmission";class BF{constructor(F){this.name=HF,this.order=175,this._loader=F,this.enabled=this._loader.isExtensionUsed(HF),this.enabled&&(F.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadTransparentPropertiesAsync(C,b,Q,z)),await Promise.all(t).then((()=>{}))}))}_loadTransparentPropertiesAsync(F,b,Q,C){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const z=Q;if(z.subSurface.isRefractionEnabled=!0,z.subSurface.volumeIndexOfRefraction=1,z.subSurface.useAlbedoToTintRefraction=!0,void 0===C.transmissionFactor)return z.subSurface.refractionIntensity=0,z.subSurface.isRefractionEnabled=!1,Promise.resolve();{var t;z.subSurface.refractionIntensity=C.transmissionFactor;const F=z.RF();if(z.subSurface.refractionIntensity&&!F._transmissionHelper)new rF({},z.RF());else if(z.subSurface.refractionIntensity&&(null===(t=F._transmissionHelper)||void 0===t||!t._isRenderTargetValid())){var g;null===(g=F._transmissionHelper)||void 0===g||g._setupRenderTargets()}}return z.subSurface.minimumThickness=0,z.subSurface.maximumThickness=0,C.transmissionTexture?(C.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${F}/transmissionTexture`,C.transmissionTexture,void 0).then((F=>{F.name=`${Q.name} (Transmission)`,z.subSurface.refractionIntensityTexture=F,z.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(HF),T(HF,!0,(F=>new BF(F)));const dF="KHR_materials_diffuse_transmission";class Fb{constructor(F){this.name=dF,this.order=174,this._loader=F,this.enabled=this._loader.isExtensionUsed(dF),this.enabled&&(F.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadTranslucentPropertiesAsync(C,b,Q,z)),await Promise.all(t).then((()=>{}))}))}_loadTranslucentPropertiesAsync(F,b,Q,C){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const z=Q;if(z.subSurface.isTranslucencyEnabled=!0,z.subSurface.volumeIndexOfRefraction=1,z.subSurface.minimumThickness=0,z.subSurface.maximumThickness=0,z.subSurface.useAlbedoToTintTranslucency=!1,void 0===C.diffuseTransmissionFactor)return z.subSurface.translucencyIntensity=0,z.subSurface.isTranslucencyEnabled=!1,Promise.resolve();z.subSurface.translucencyIntensity=C.diffuseTransmissionFactor;const g=new Array;return z.subSurface.useGltfStyleTextures=!0,C.diffuseTransmissionTexture&&(C.diffuseTransmissionTexture.nonColorData=!0,g.push(this._loader.loadTextureInfoAsync(`${F}/diffuseTransmissionTexture`,C.diffuseTransmissionTexture).then((F=>{F.name=`${Q.name} (Diffuse Transmission)`,z.subSurface.translucencyIntensityTexture=F})))),void 0!==C.diffuseTransmissionColorFactor?z.subSurface.translucencyColor=t.GQ.KQ(C.diffuseTransmissionColorFactor):z.subSurface.translucencyColor=t.GQ.White(),C.diffuseTransmissionColorTexture&&g.push(this._loader.loadTextureInfoAsync(`${F}/diffuseTransmissionColorTexture`,C.diffuseTransmissionColorTexture).then((F=>{F.name=`${Q.name} (Diffuse Transmission Color)`,z.subSurface.translucencyColorTexture=F}))),Promise.all(g).then((()=>{}))}}o(dF),T(dF,!0,(F=>new Fb(F)));const bb="KHR_materials_volume";class Qb{constructor(F){this.name=bb,this.order=173,this._loader=F,this.enabled=this._loader.isExtensionUsed(bb),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadVolumePropertiesAsync(C,b,Q,z)),await Promise.all(t).then((()=>{}))}))}_loadVolumePropertiesAsync(F,b,Q,C){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);if(!Q.subSurface.isRefractionEnabled&&!Q.subSurface.isTranslucencyEnabled||!C.thicknessFactor)return Promise.resolve();Q.subSurface.volumeIndexOfRefraction=Q.indexOfRefraction;const z=void 0!==C.attenuationDistance?C.attenuationDistance:Number.MAX_VALUE;return Q.subSurface.tintColorAtDistance=z,void 0!==C.attenuationColor&&3==C.attenuationColor.length&&Q.subSurface.tintColor.jb(C.attenuationColor[0],C.attenuationColor[1],C.attenuationColor[2]),Q.subSurface.minimumThickness=0,Q.subSurface.maximumThickness=C.thicknessFactor,Q.subSurface.useThicknessAsDepth=!0,C.thicknessTexture?(C.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${F}/thicknessTexture`,C.thicknessTexture).then((F=>{F.name=`${Q.name} (Thickness)`,Q.subSurface.thicknessTexture=F,Q.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}o(bb),T(bb,!0,(F=>new Qb(F)));const Cb="KHR_materials_dispersion";class zb{constructor(F){this.name=Cb,this.order=174,this._loader=F,this.enabled=this._loader.isExtensionUsed(Cb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadDispersionPropertiesAsync(C,b,Q,z)),await Promise.all(t).then((()=>{}))}))}_loadDispersionPropertiesAsync(F,b,Q,C){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);return Q.subSurface.isRefractionEnabled&&C.dispersion?(Q.subSurface.isDispersionEnabled=!0,Q.subSurface.dispersion=C.dispersion,Promise.resolve()):Promise.resolve()}}o(Cb),T(Cb,!0,(F=>new zb(F)));const tb="EXT_materials_diffuse_roughness";class gb{constructor(F){this.name=tb,this.order=190,this._loader=F,this.enabled=this._loader.isExtensionUsed(tb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=new Array;return t.push(this._loader.loadMaterialPropertiesAsync(F,b,Q)),t.push(this._loadDiffuseRoughnessPropertiesAsync(C,z,Q)),await Promise.all(t).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(F,b,Q){if(!(Q instanceof i.c))throw new Error(`${F}: Material type not supported`);const C=new Array;return Q.brdf.baseDiffuseModel=aF.c.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=b.diffuseRoughnessFactor?Q.baseDiffuseRoughness=b.diffuseRoughnessFactor:Q.baseDiffuseRoughness=0,b.diffuseRoughnessTexture&&C.push(this._loader.loadTextureInfoAsync(`${F}/diffuseRoughnessTexture`,b.diffuseRoughnessTexture,(F=>{F.name=`${Q.name} (Diffuse Roughness)`,Q.baseDiffuseRoughnessTexture=F}))),Promise.all(C).then((()=>{}))}}o(tb),T(tb,!0,(F=>new gb(F)));const Wb="KHR_mesh_quantization";class Zb{constructor(F){this.name=Wb,this.enabled=F.isExtensionUsed(Wb)}dispose(){}}o(Wb),T(Wb,!0,(F=>new Zb(F)));const qb="KHR_texture_basisu";class Gb{constructor(F){this.name=qb,this._loader=F,this.enabled=F.isExtensionUsed(qb)}dispose(){this._loader=null}_loadTextureAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>{const t=void 0==b.sampler?U.DefaultSampler:a.Get(`${F}/sampler`,this._loader.yb.samplers,b.sampler),g=a.Get(`${C}/source`,this._loader.yb.images,z.source);return await this._loader._createTextureAsync(F,t,g,(F=>{Q(F)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}o(qb),T(qb,!0,(F=>new Gb(F)));const Kb="KHR_texture_transform";class eb{constructor(F){this.name=Kb,this._loader=F,this.enabled=this._loader.isExtensionUsed(Kb)}dispose(){this._loader=null}loadTextureInfoAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(C,z)=>await this._loader.loadTextureInfoAsync(F,b,(F=>{if(!(F instanceof f.b))throw new Error(`${C}: Texture type not supported`);z.offset&&(F.uOffset=z.offset[0],F.vOffset=z.offset[1]),F.uRotationCenter=0,F.vRotationCenter=0,z.rotation&&(F.wAng=-z.rotation),z.scale&&(F.uScale=z.scale[0],F.vScale=z.scale[1]),void 0!=z.texCoord&&(F.coordinatesIndex=z.texCoord),Q(F)}))))}}o(Kb),T(Kb,!0,(F=>new eb(F)));const Nb="KHR_xmp_json_ld";class yb{constructor(F){this.name=Nb,this.order=100,this._loader=F,this.enabled=this._loader.isExtensionUsed(Nb)}dispose(){this._loader=null}onLoading(){var F,b,Q;if(null===this._loader.rootBabylonMesh)return;const C=null===(F=this._loader.yb.extensions)||void 0===F?void 0:F.KHR_xmp_json_ld,z=null===(b=this._loader.yb.asset)||void 0===b||null===(Q=b.extensions)||void 0===Q?void 0:Q.KHR_xmp_json_ld;if(C&&z){const F=+z.packet;C.packets&&F<C.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=C.packets[F])}}}function Eb(F,b,Q,C){return t.GQ.KQ(b,Q).scale(C)}function cb(F,b,Q,C){return b[Q]*C}function Xb(F,b,Q,C){return-b[Q]*C}function Lb(F,b,Q,C){return b[Q+1]*C}function ib(F,b,Q,C){return b[Q]*C*2}function fb(F){return{scale:[new mb(e.b.ANIMATIONTYPE_FLOAT,`${F}.uScale`,cb,(()=>2)),new mb(e.b.ANIMATIONTYPE_FLOAT,`${F}.vScale`,Lb,(()=>2))],offset:[new mb(e.b.ANIMATIONTYPE_FLOAT,`${F}.uOffset`,cb,(()=>2)),new mb(e.b.ANIMATIONTYPE_FLOAT,`${F}.vOffset`,Lb,(()=>2))],rotation:[new mb(e.b.ANIMATIONTYPE_FLOAT,`${F}.wAng`,Xb,(()=>1))]}}o(Nb),T(Nb,!0,(F=>new yb(F)));class kb extends u.AnimationPropertyInfo{buildAnimations(F,b,Q,C){return[{babylonAnimatable:F._babylonCamera,babylonAnimation:this._buildAnimation(b,Q,C)}]}}class mb extends u.AnimationPropertyInfo{buildAnimations(F,b,Q,C){const z=[];for(const t in F._data)z.push({babylonAnimatable:F._data[t].babylonMaterial,babylonAnimation:this._buildAnimation(b,Q,C)});return z}}class Rb extends u.AnimationPropertyInfo{buildAnimations(F,b,Q,C){return[{babylonAnimatable:F._babylonLight,babylonAnimation:this._buildAnimation(b,Q,C)}]}}(0,S.g)("/cameras/{}/orthographic/xmag",[new kb(e.b.ANIMATIONTYPE_FLOAT,"orthoLeft",Xb,(()=>1)),new kb(e.b.ANIMATIONTYPE_FLOAT,"orthoRight",Lb,(()=>1))]),(0,S.g)("/cameras/{}/orthographic/ymag",[new kb(e.b.ANIMATIONTYPE_FLOAT,"orthoBottom",Xb,(()=>1)),new kb(e.b.ANIMATIONTYPE_FLOAT,"orthoTop",Lb,(()=>1))]),(0,S.g)("/cameras/{}/orthographic/zfar",[new kb(e.b.ANIMATIONTYPE_FLOAT,"maxZ",cb,(()=>1))]),(0,S.g)("/cameras/{}/orthographic/znear",[new kb(e.b.ANIMATIONTYPE_FLOAT,"kb",cb,(()=>1))]),(0,S.g)("/cameras/{}/perspective/yfov",[new kb(e.b.ANIMATIONTYPE_FLOAT,"fov",cb,(()=>1))]),(0,S.g)("/cameras/{}/perspective/zfar",[new kb(e.b.ANIMATIONTYPE_FLOAT,"maxZ",cb,(()=>1))]),(0,S.g)("/cameras/{}/perspective/znear",[new kb(e.b.ANIMATIONTYPE_FLOAT,"kb",cb,(()=>1))]),(0,S.g)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new mb(e.b.ANIMATIONTYPE_COLOR3,"albedoColor",Eb,(()=>4)),new mb(e.b.ANIMATIONTYPE_FLOAT,"alpha",(function(F,b,Q,C){return b[Q+3]*C}),(()=>4))]),(0,S.g)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"metallic",cb,(()=>1))]),(0,S.g)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"roughness",cb,(()=>1))]);const pb=fb("albedoTexture");(0,S.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",pb.scale),(0,S.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",pb.offset),(0,S.g)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",pb.rotation);const Db=fb("metallicTexture");(0,S.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Db.scale),(0,S.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Db.offset),(0,S.g)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Db.rotation),(0,S.g)("/materials/{}/emissiveFactor",[new mb(e.b.ANIMATIONTYPE_COLOR3,"emissiveColor",Eb,(()=>3))]);const Pb=fb("bumpTexture");(0,S.g)("/materials/{}/normalTexture/scale",[new mb(e.b.ANIMATIONTYPE_FLOAT,"bumpTexture.level",cb,(()=>1))]),(0,S.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Pb.scale),(0,S.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Pb.offset),(0,S.g)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Pb.rotation),(0,S.g)("/materials/{}/occlusionTexture/strength",[new mb(e.b.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",cb,(()=>1))]);const nb=fb("ambientTexture");(0,S.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",nb.scale),(0,S.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",nb.offset),(0,S.g)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",nb.rotation);const jb=fb("emissiveTexture");(0,S.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",jb.scale),(0,S.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",jb.offset),(0,S.g)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",jb.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new mb(e.b.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new mb(e.b.ANIMATIONTYPE_FLOAT,"anisotropy.angle",cb,(()=>1))]);const wb=fb("anisotropy.texture");(0,S.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",wb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",wb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",wb.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",cb,(()=>1))]);const Yb=fb("clearCoat.texture");(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Yb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Yb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Yb.rotation);const sb=fb("clearCoat.bumpTexture");(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new mb(e.b.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",sb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",sb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",sb.rotation);const Vb=fb("clearCoat.textureRoughness");(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Vb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Vb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Vb.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new mb(e.b.ANIMATIONTYPE_FLOAT,"emissiveIntensity",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_ior/ior",[new mb(e.b.ANIMATIONTYPE_FLOAT,"indexOfRefraction",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"iridescence.intensity",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new mb(e.b.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new mb(e.b.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",cb,(()=>1))]);const hb=fb("iridescence.texture");(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",hb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",hb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",hb.rotation);const lb=fb("iridescence.thicknessTexture");(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",lb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",lb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",lb.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new mb(e.b.ANIMATIONTYPE_COLOR3,"sheen.color",Eb,(()=>3))]),(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"sheen.roughness",cb,(()=>1))]);const Tb=fb("sheen.texture");(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Tb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Tb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Tb.rotation);const ob=fb("sheen.textureRoughness");(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",ob.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",ob.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",ob.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"metallicF0Factor",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new mb(e.b.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Eb,(()=>3))]);const Sb=fb("metallicReflectanceTexture");(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Sb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Sb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Sb.rotation);const Ob=fb("reflectanceTexture");(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Ob.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Ob.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Ob.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",cb,(()=>1))]);const xb=fb("subSurface.refractionIntensityTexture");(0,S.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",xb.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",xb.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",xb.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new mb(e.b.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Eb,(()=>3))]),(0,S.g)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new mb(e.b.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",cb,(()=>1))]),(0,S.g)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",cb,(()=>1))]);const ab=fb("subSurface.thicknessTexture");(0,S.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",ab.scale),(0,S.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",ab.offset),(0,S.g)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",ab.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new mb(e.b.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",cb,(()=>1))]);const Ab=fb("subSurface.translucencyIntensityTexture");(0,S.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Ab.scale),(0,S.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Ab.offset),(0,S.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Ab.rotation),(0,S.g)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new mb(e.b.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Eb,(()=>3))]);const Ub=fb("subSurface.translucencyColorTexture");(0,S.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Ub.scale),(0,S.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Ub.offset),(0,S.g)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Ub.rotation),(0,S.g)("/extensions/KHR_lights_punctual/lights/{}/color",[new Rb(e.b.ANIMATIONTYPE_COLOR3,"diffuse",Eb,(()=>3))]),(0,S.g)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Rb(e.b.ANIMATIONTYPE_FLOAT,"intensity",cb,(()=>1))]),(0,S.g)("/extensions/KHR_lights_punctual/lights/{}/range",[new Rb(e.b.ANIMATIONTYPE_FLOAT,"range",cb,(()=>1))]),(0,S.g)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Rb(e.b.ANIMATIONTYPE_FLOAT,"innerAngle",ib,(()=>1))]),(0,S.g)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Rb(e.b.ANIMATIONTYPE_FLOAT,"angle",ib,(()=>1))]),(0,S.g)("/nodes/{}/extensions/EXT_lights_ies/color",[new Rb(e.b.ANIMATIONTYPE_COLOR3,"diffuse",Eb,(()=>3))]),(0,S.g)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Rb(e.b.ANIMATIONTYPE_FLOAT,"intensity",cb,(()=>1))]);const ub="KHR_animation_pointer";class vb{constructor(F){this.name=ub,this._loader=F,this._pathToObjectConverter=(0,S.e)(this._loader.yb)}get enabled(){return this._loader.isExtensionUsed(ub)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(F,b,Q,C,z){var t;const g=null===(t=C.target.extensions)||void 0===t?void 0:t.KHR_animation_pointer;if(!g||!this._pathToObjectConverter)return null;"pointer"!==C.target.path&&E.e.Warn(`${F}/target/path: Value (${C.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=C.target.node&&E.e.Warn(`${F}/target/node: Value (${C.target.node}) must not be present when using the ${this.name} extension`);const W=`${F}/extensions/${this.name}`,Z=g.pointer;if(!Z)throw new Error(`${W}: Pointer is missing`);try{const t=this._pathToObjectConverter.convert(Z);if(!t.info.interpolation)throw new Error(`${W}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(F,b,Q,C,{object:t.object,info:t.info.interpolation},z)}catch(q){return E.e.Warn(`${W}/pointer: Invalid pointer (${Z}) skipped`),null}}}o(ub),T(ub,!0,(F=>new vb(F)));class Jb{constructor(F,b,Q){this.frame=F,this.action=b,this.onlyOnce=Q,this.isDone=!1}_clone(){return new Jb(this.frame,this.action,this.onlyOnce)}}var Ib=Q(11155),Mb=Q(11203),rb=Q(11198);class Hb{get loop(){return this._loop}set loop(F){F!==this._loop&&(this._loop=F,this.updateOptions({loop:F}))}get currentTime(){var F;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.audioContext&&(this.isPlaying||this.isPaused)){const F=this.isPaused?0:Mb.d.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+F}return 0}get spatialSound(){return this._spatialSound}set spatialSound(F){if(F==this._spatialSound)return;const b=this.isPlaying;this.pause(),F?(this._spatialSound=F,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(F,b,Q){var C;let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,W=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new G.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=z.gQ.Zero(),this._localDirection=new z.gQ(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=F,Q=Q||y.d.LastCreatedScene)if(this._scene=Q,Hb._SceneComponentInitialization(Q),this._readyToPlayCallback=t,this._customAttenuationFunction=(F,b,Q,C,z)=>b<Q?F*(1-b/Q):0,W&&(this.autoplay=W.autoplay||!1,this._loop=W.loop||!1,void 0!==W.volume&&(this._volume=W.volume),this._spatialSound=W.spatialSound??!1,this.maxDistance=W.maxDistance??100,this.useCustomAttenuation=W.useCustomAttenuation??!1,this.rolloffFactor=W.rolloffFactor||1,this.refDistance=W.refDistance||1,this.distanceModel=W.distanceModel||"linear",this._playbackRate=W.playbackRate||1,this._streaming=W.streaming??!1,this._length=W.length,this._offset=W.offset),null!==(C=Mb.d.audioEngine)&&void 0!==C&&C.canUseWebAudio&&Mb.d.audioEngine.audioContext){this._soundGain=Mb.d.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let F=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let Q=[],C=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Mb.d.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Mb.d.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(C=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":Q.push(b);case"Array":0===Q.length&&(Q=b);for(let F=0;F<Q.length;F++){const b=Q[F];if(C=W&&W.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&Mb.d.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&Mb.d.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),C){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,g.Tools.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(F=>{this._soundLoaded(F)}),void 0,!0,!0,(F=>{F&&E.e.Error("XHR "+F.status+" error on: "+b+"."),E.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:F=!1}F?C||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):E.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(Z){E.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Mb.d.audioEngine&&!Mb.d.audioEngine.WarnedWebAudioUnsupported&&(E.e.Error("Web Audio is not supported by your browser."),Mb.d.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var F;null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(F){var b;null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=F,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(F){var b;null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.audioContext&&Mb.d.audioEngine.audioContext.decodeAudioData(F,(F=>{this._audioBufferLoaded(F)}),(F=>{E.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+F)}))}setAudioBuffer(F){var b;null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=F,this._isReadyToPlay=!0)}updateOptions(F){F&&(this.loop=F.loop??this.loop,this.maxDistance=F.maxDistance??this.maxDistance,this.useCustomAttenuation=F.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=F.rolloffFactor??this.rolloffFactor,this.refDistance=F.refDistance??this.refDistance,this.distanceModel=F.distanceModel??this.distanceModel,this._playbackRate=F.playbackRate??this._playbackRate,this._length=F.length??void 0,this.spatialSound=F.spatialSound??this._spatialSound,this._setOffset(F.offset??void 0),this.setVolume(F.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var F;null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&Mb.d.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Mb.d.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var F;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(F=this._soundPanner)||void 0===F||F.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var F;null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(F){var b;null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(F),this._isOutputConnected=!0)}setDirectionalCone(F,b,Q){b<F?E.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=F,this._coneOuterAngle=b,this._coneOuterGain=Q,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(F){if(F!=this._coneInnerAngle){var b;if(this._coneOuterAngle<F)return void E.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=F,null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(F){if(F!=this._coneOuterAngle){var b;if(F<this._coneInnerAngle)return void E.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=F,null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(F){var b;F.equals(this._position)||(this._position.W(F),null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(F){var b;this._localDirection=F,null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const F=this._connectedTransformNode.getWorldMatrix(),b=z.gQ.TransformNormal(this._localDirection,F);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var F;if(null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const F=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.WQ(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,F,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(F){this._customAttenuationFunction=F}play(F,b,Q){var C;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(C=Mb.d.audioEngine)&&void 0!==C&&C.audioContext)try{var z,t;this._clearTimeoutsAndObservers();let C=F?(null===(z=Mb.d.audioEngine)||void 0===z?void 0:z.audioContext.currentTime)+F:null===(t=Mb.d.audioEngine)||void 0===t?void 0:t.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Mb.d.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const F=()=>{var Q;if(null!==(Q=Mb.d.audioEngine)&&void 0!==Q&&Q.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const Q=this._htmlAudioElement.play();void 0!==Q&&Q.catch((()=>{var b,Q;(null===(b=Mb.d.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(Q=Mb.d.audioEngine)||void 0===Q?void 0:Q.onAudioUnlockedObservable.addOnce((()=>{F()})))}))}else{var C;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(C=Mb.d.audioEngine)||void 0===C?void 0:C.onAudioUnlockedObservable.addOnce((()=>{F()}))}};F()}}else{var g;const z=()=>{var z;if(null!==(z=Mb.d.audioEngine)&&void 0!==z&&z.audioContext){var t;if(Q=Q||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const F=this._soundSource;F.onended=()=>{F.disconnect()}}if(this._soundSource=null===(t=Mb.d.audioEngine)||void 0===t?void 0:t.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var g;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==Q&&(this._soundSource.loopEnd=(0|b)+Q),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},C=F?(null===(g=Mb.d.audioEngine)||void 0===g?void 0:g.audioContext.currentTime)+F:Mb.d.audioEngine.audioContext.currentTime;const z=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(C,z,this.loop?void 0:Q)}}};"suspended"===(null===(g=Mb.d.audioEngine)||void 0===g?void 0:g.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var F;"suspended"===(null===(F=Mb.d.audioEngine)||void 0===F?void 0:F.audioContext.state)?(Mb.d.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Mb.d.audioEngine.onAudioUnlockedObservable.addOnce((()=>{z()})))):z()}),500):z()}this._startTime=C,this.isPlaying=!0,this.isPaused=!1}catch(W){E.e.Error("Error while trying to play audio: "+this.name+", "+W.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(F){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var Q;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(Q=this._streamingSource)||void 0===Q||Q.disconnect();this.isPlaying=!1}else if(null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=F?Mb.d.audioEngine.audioContext.currentTime+F:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var F;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Mb.d.audioEngine.audioContext.currentTime-this._startTime)}setVolume(F,b){var Q;null!==(Q=Mb.d.audioEngine)&&void 0!==Q&&Q.canUseWebAudio&&this._soundGain&&(b&&Mb.d.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Mb.d.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Mb.d.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(F,Mb.d.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=F),this._volume=F}setPlaybackRate(F){this._playbackRate=F,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(F){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=F,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=F=>this._onRegisterAfterWorldMatrixUpdate(F),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(F){var b;if(F.getBoundingInfo){const b=F.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(F.absolutePosition);null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const F=()=>{(0,rb.f)((()=>this._isReadyToPlay),(()=>{Q._audioBuffer=this.getAudioBuffer(),Q._isReadyToPlay=!0,Q.autoplay&&Q.play(0,this._offset,this._length)}),void 0,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},Q=new Hb(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&Q.setAttenuationFunction(this._customAttenuationFunction),Q.setPosition(this._position),Q.setPlaybackRate(this._playbackRate),F(),Q}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const F={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(F.connectedMeshId=this._connectedTransformNode.id),F.position=this._position.Lb(),F.refDistance=this.refDistance,F.distanceModel=this.distanceModel,F.isDirectional=this._isDirectional,F.localDirectionToMesh=this._localDirection.Lb(),F.coneInnerAngle=this._coneInnerAngle,F.coneOuterAngle=this._coneOuterAngle,F.coneOuterGain=this._coneOuterGain),F}static Parse(F,b,Q,C){const t=F.name;let g;g=F.url?Q+F.url:Q+t;const W={autoplay:F.autoplay,loop:F.loop,volume:F.volume,spatialSound:F.spatialSound,maxDistance:F.maxDistance,rolloffFactor:F.rolloffFactor,refDistance:F.refDistance,distanceModel:F.distanceModel,playbackRate:F.playbackRate};let Z;if(C){const F=()=>{(0,rb.f)((()=>C._isReadyToPlay),(()=>{Z._audioBuffer=C.getAudioBuffer(),Z._isReadyToPlay=!0,Z.autoplay&&Z.play(0,Z._offset,Z._length)}),void 0,300)};Z=new Hb(t,new ArrayBuffer(0),b,null,W),F()}else Z=new Hb(t,g,b,(()=>{b.removePendingData(Z)}),W),b.addPendingData(Z);if(F.position){const b=z.gQ.KQ(F.position);Z.setPosition(b)}if(F.isDirectional&&(Z.setDirectionalCone(F.coneInnerAngle||360,F.coneOuterAngle||360,F.coneOuterGain||0),F.localDirectionToMesh)){const b=z.gQ.KQ(F.localDirectionToMesh);Z.setLocalDirectionToMesh(b)}if(F.connectedMeshId){const Q=b.getMeshById(F.connectedMeshId);Q&&Z.attachToMesh(Q)}return F.metadata&&(Z.metadata=F.metadata),Z}_setOffset(F){this._offset!==F&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=F)}_clearTimeoutsAndObservers(){var F;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(F=Mb.d.audioEngine)||void 0===F||F.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Hb._SceneComponentInitialization=F=>{throw(0,Ib.c)("AudioSceneComponent")},(0,mF.g)("BABYLON.Sound",Hb);class Bb{constructor(F,b,Q){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==Q.length)throw new Error("Sounds length does not equal weights length");this.loop=F,this._weights=Q;let C=0;for(const t of Q)C+=t;const z=C>0?1/C:0;for(let t=0;t<this._weights.length;t++)this._weights[t]*=z;this._sounds=b;for(const t of this._sounds)t.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(F){if(F!==this._coneInnerAngle){if(this._coneOuterAngle<F)return void E.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=F;for(const b of this._sounds)b.directionalConeInnerAngle=F}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(F){if(F!==this._coneOuterAngle){if(F<this._coneInnerAngle)return void E.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=F;for(const b of this._sounds)b.directionalConeOuterAngle=F}}get volume(){return this._volume}set volume(F){if(F!==this._volume)for(const b of this._sounds)b.setVolume(F)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(F){if(!this.isPaused){this.stop();const F=Math.random();let b=0;for(let Q=0;Q<this._weights.length;Q++)if(b+=this._weights[Q],F<=b){this._currentIndex=Q;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:F):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class db{constructor(F){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(F=F||y.d.LastCreatedScene)&&(this._scene=F,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var F;null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.canUseWebAudio&&Mb.d.audioEngine.audioContext&&(this._outputAudioNode=Mb.d.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Mb.d.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Mb.d.audioEngine&&Mb.d.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(F){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&F.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==F.soundTrackId&&(-1===F.soundTrackId?this._scene.mainSoundTrack.removeSound(F):this._scene.soundTracks&&this._scene.soundTracks[F.soundTrackId].removeSound(F)),this.soundCollection.push(F),F.soundTrackId=this.id}removeSound(F){const b=this.soundCollection.indexOf(F);-1!==b&&this.soundCollection.splice(b,1)}setVolume(F){var b;null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=F)}switchPanningModelToHRTF(){var F;if(null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var F;if(null!==(F=Mb.d.audioEngine)&&void 0!==F&&F.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(F){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=F,null!==(b=Mb.d.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Mb.d.audioEngine.masterGain))}}var FQ=Q(11561),bQ=Q(11537),QQ=Q(11140);Mb.d.AudioEngineFactory=(F,b,Q)=>new CQ(F,b,Q);class CQ{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new G.c,this.onAudioLockedObservable=new G.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,QQ.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const C=document.createElement("audio");this._hostElement=F,this._audioContext=b,this._audioDestination=Q;try{C&&C.canPlayType&&(C.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||C.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(z){}try{C&&C.canPlayType&&C.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(z){}}lock(){this._triggerSuspendedState()}unlock(){var F,b;if("running"===(null===(F=this._audioContext)||void 0===F?void 0:F.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(b=this._audioContext)||void 0===b||b.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{E.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var F;null===(F=this._audioContext)||void 0===F||F.addEventListener("statechange",(()=>{var F;this.unlocked&&"running"!==(null===(F=this._audioContext)||void 0===F?void 0:F.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var F;return null!==(F=this._audioContext)&&void 0!==F&&F.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(F){this.canUseWebAudio=!1,E.e.Error("Web Audio: "+F.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(F){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const F=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",b=document.createElement("style");b.appendChild(document.createTextNode(F)),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var F;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(F=this._audioContext)||void 0===F||F.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(F){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=F)}connectToAnalyser(F){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=F,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var zQ=Q(11153);(0,Q(12644).f)(FQ.c.NAME_AUDIO,((F,b,Q,C)=>{let z,t=[];if(Q.mN=Q.mN||[],void 0!==F.mN&&null!==F.mN)for(let W=0,Z=F.mN.length;W<Z;W++){var g;const Z=F.mN[W];null!==(g=Mb.d.audioEngine)&&void 0!==g&&g.canUseWebAudio?(Z.url||(Z.url=Z.name),t[Z.url]?Q.mN.push(Hb.Parse(Z,b,C,t[Z.url])):(z=Hb.Parse(Z,b,C),t[Z.url]=z,Q.mN.push(z))):Q.mN.push(new Hb(Z.name,null,b))}t=[]})),Object.defineProperty(bQ.c.prototype,"mainSoundTrack",{get:function(){let F=this._getComponent(FQ.c.NAME_AUDIO);return F||(F=new tQ(this),this.o(F)),this._mainSoundTrack||(this._mainSoundTrack=new db(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),bQ.c.prototype.getSoundByName=function(F){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===F)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let Q=0;Q<this.soundTracks.length;Q++)for(b=0;b<this.soundTracks[Q].soundCollection.length;b++)if(this.soundTracks[Q].soundCollection[b].name===F)return this.soundTracks[Q].soundCollection[b];return null},Object.defineProperty(bQ.c.prototype,"audioEnabled",{get:function(){let F=this._getComponent(FQ.c.NAME_AUDIO);return F||(F=new tQ(this),this.o(F)),F.audioEnabled},set:function(F){let b=this._getComponent(FQ.c.NAME_AUDIO);b||(b=new tQ(this),this.o(b)),F?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(bQ.c.prototype,"headphone",{get:function(){let F=this._getComponent(FQ.c.NAME_AUDIO);return F||(F=new tQ(this),this.o(F)),F.headphone},set:function(F){let b=this._getComponent(FQ.c.NAME_AUDIO);b||(b=new tQ(this),this.o(b)),F?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(bQ.c.prototype,"audioListenerPositionProvider",{get:function(){let F=this._getComponent(FQ.c.NAME_AUDIO);return F||(F=new tQ(this),this.o(F)),F.audioListenerPositionProvider},set:function(F){let b=this._getComponent(FQ.c.NAME_AUDIO);if(b||(b=new tQ(this),this.o(b)),F&&"function"!==typeof F)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=F},enumerable:!0,configurable:!0}),Object.defineProperty(bQ.c.prototype,"audioListenerRotationProvider",{get:function(){let F=this._getComponent(FQ.c.NAME_AUDIO);return F||(F=new tQ(this),this.o(F)),F.audioListenerRotationProvider},set:function(F){let b=this._getComponent(FQ.c.NAME_AUDIO);if(b||(b=new tQ(this),this.o(b)),F&&"function"!==typeof F)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=F},enumerable:!0,configurable:!0}),Object.defineProperty(bQ.c.prototype,"audioPositioningRefreshRate",{get:function(){let F=this._getComponent(FQ.c.NAME_AUDIO);return F||(F=new tQ(this),this.o(F)),F.audioPositioningRefreshRate},set:function(F){let b=this._getComponent(FQ.c.NAME_AUDIO);b||(b=new tQ(this),this.o(b)),b.audioPositioningRefreshRate=F},enumerable:!0,configurable:!0});class tQ{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(F){this.name=FQ.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new z.gQ,this._cachedCameraPosition=new z.gQ,this._lastCheck=0,this._invertMatrixTemp=new z.Matrix,this._cameraDirectionTemp=new z.gQ,(F=F||y.d.LastCreatedScene)&&(this.ZQ=F,F.soundTracks=[],F.mN=[])}register(){this.ZQ._afterRenderStage.registerStep(FQ.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(F){if(F.mN=[],this.ZQ.soundTracks)for(let b=0;b<this.ZQ.soundTracks.length;b++){const Q=this.ZQ.soundTracks[b];for(let b=0;b<Q.soundCollection.length;b++)F.mN.push(Q.soundCollection[b].serialize())}}addFromContainer(F){if(F.mN)for(const b of F.mN)b.play(),b.autoplay=!0,this.ZQ.mainSoundTrack.addSound(b)}removeFromContainer(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(F.mN)for(const Q of F.mN)Q.stop(),Q.autoplay=!1,this.ZQ.mainSoundTrack.removeSound(Q),b&&Q.dispose()}dispose(){const F=this.ZQ;if(F._mainSoundTrack&&F.mainSoundTrack.dispose(),F.soundTracks)for(let b=0;b<F.soundTracks.length;b++)F.soundTracks[b].dispose()}disableAudio(){const F=this.ZQ;let b;for(this._audioEnabled=!1,Mb.d.audioEngine&&Mb.d.audioEngine.audioContext&&Mb.d.audioEngine.audioContext.suspend(),b=0;b<F.mainSoundTrack.soundCollection.length;b++)F.mainSoundTrack.soundCollection[b].pause();if(F.soundTracks)for(b=0;b<F.soundTracks.length;b++)for(let Q=0;Q<F.soundTracks[b].soundCollection.length;Q++)F.soundTracks[b].soundCollection[Q].pause()}enableAudio(){const F=this.ZQ;let b;for(this._audioEnabled=!0,Mb.d.audioEngine&&Mb.d.audioEngine.audioContext&&Mb.d.audioEngine.audioContext.resume(),b=0;b<F.mainSoundTrack.soundCollection.length;b++)F.mainSoundTrack.soundCollection[b].isPaused&&F.mainSoundTrack.soundCollection[b].play();if(F.soundTracks)for(b=0;b<F.soundTracks.length;b++)for(let Q=0;Q<F.soundTracks[b].soundCollection.length;Q++)F.soundTracks[b].soundCollection[Q].isPaused&&F.soundTracks[b].soundCollection[Q].play()}switchAudioModeForHeadphones(){const F=this.ZQ;if(this._headphone=!0,F.mainSoundTrack.switchPanningModelToHRTF(),F.soundTracks)for(let b=0;b<F.soundTracks.length;b++)F.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const F=this.ZQ;if(this._headphone=!1,F.mainSoundTrack.switchPanningModelToEqualPower(),F.soundTracks)for(let b=0;b<F.soundTracks.length;b++)F.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const F=zQ.d.Now;if(this._lastCheck&&F-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=F;const b=this.ZQ;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const Q=Mb.d.audioEngine;if(Q&&Q.audioContext){let F,C=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(C=b.activeCameras[0]),this.audioListenerPositionProvider){const F=this.audioListenerPositionProvider();Q.audioContext.listener.setPosition(F.x||0,F.y||0,F.z||0)}else C?this._cachedCameraPosition.equals(C.globalPosition)||(this._cachedCameraPosition.W(C.globalPosition),Q.audioContext.listener.setPosition(C.globalPosition.x,C.globalPosition.y,C.globalPosition.z)):Q.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const F=this.audioListenerRotationProvider();Q.audioContext.listener.setOrientation(F.x||0,F.y||0,F.z||0,0,1,0)}else C?(C.rigCameras&&C.rigCameras.length>0&&(C=C.rigCameras[0]),C.getViewMatrix().invertToRef(this._invertMatrixTemp),z.gQ.TransformNormalToRef(tQ._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.W(this._cameraDirectionTemp),Q.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):Q.audioContext.listener.setOrientation(0,0,0,0,1,0);for(F=0;F<b.mainSoundTrack.soundCollection.length;F++){const Q=b.mainSoundTrack.soundCollection[F];Q.useCustomAttenuation&&Q.updateDistanceFromListener()}if(b.soundTracks)for(F=0;F<b.soundTracks.length;F++)for(let Q=0;Q<b.soundTracks[F].soundCollection.length;Q++){const C=b.soundTracks[F].soundCollection[Q];C.useCustomAttenuation&&C.updateDistanceFromListener()}}}}tQ._CameraDirection=new z.gQ(0,0,-1),Hb._SceneComponentInitialization=F=>{let b=F._getComponent(FQ.c.NAME_AUDIO);b||(b=new tQ(F),F.o(b))};const gQ="MSFT_audio_emitter";class WQ{constructor(F){this.name=gQ,this._loader=F,this.enabled=this._loader.isExtensionUsed(gQ)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const F=this._loader.yb.extensions;if(F&&F[this.name]){const b=F[this.name];this._clips=b.clips,this._emitters=b.emitters,a.Assign(this._clips),a.Assign(this._emitters)}}loadSceneAsync(F,b){return U.LoadExtensionAsync(F,b,this.name,(async(Q,C)=>{const z=new Array;z.push(this._loader.loadSceneAsync(F,b));for(const F of C.emitters){const b=a.Get(`${Q}/emitters`,this._emitters,F);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${Q}: Direction or Distance properties are not allowed on emitters attached to a scene`);z.push(this._loadEmitterAsync(`${Q}/emitters/${b.index}`,b))}await Promise.all(z)}))}loadNodeAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(F,C)=>{const t=new Array,W=await this._loader.loadNodeAsync(F,b,(b=>{for(const Q of C.emitters){const C=a.Get(`${F}/emitters`,this._emitters,Q);t.push(this._loadEmitterAsync(`${F}/emitters/${C.index}`,C).then((()=>{for(const F of C._babylonSounds)F.attachToMesh(b),void 0==C.innerAngle&&void 0==C.outerAngle||(F.setLocalDirectionToMesh(z.gQ.Forward()),F.setDirectionalCone(2*g.Tools.ToDegrees(void 0==C.innerAngle?Math.PI:C.innerAngle),2*g.Tools.ToDegrees(void 0==C.outerAngle?Math.PI:C.outerAngle),0))})))}Q(b)}));return await Promise.all(t),W}))}loadAnimationAsync(F,b){return U.LoadExtensionAsync(F,b,this.name,(async(Q,C)=>{const z=await this._loader.loadAnimationAsync(F,b),t=new Array;a.Assign(C.events);for(const g of C.events)t.push(this._loadAnimationEventAsync(`${Q}/events/${g.index}`,F,b,g,z));return await Promise.all(t),z}))}_loadClipAsync(F,b){if(b._objectURL)return b._objectURL;let Q;if(b.uri)Q=this._loader.loadUriAsync(F,b,b.uri);else{const C=a.Get(`${F}/bufferView`,this._loader.yb.bufferViews,b.bufferView);Q=this._loader.loadBufferViewAsync(`/bufferViews/${C.index}`,C)}return b._objectURL=Q.then((F=>URL.createObjectURL(new Blob([F],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(F,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const F=new Array,Q=b.name||`emitter${b.index}`,C={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let t=0;t<b.clips.length;t++){const z=`/extensions/${this.name}/clips`,g=a.Get(z,this._clips,b.clips[t].clip);F.push(this._loadClipAsync(`${z}/${b.clips[t].clip}`,g).then((F=>{const z=b._babylonSounds[t]=new Hb(Q,F,this._loader.babylonScene,null,C);z.refDistance=b.refDistance||1,z.maxDistance=b.maxDistance||256,z.rolloffFactor=b.rolloffFactor||1,z.distanceModel=b.distanceModel||"exponential"})))}const z=Promise.all(F).then((()=>{const F=b.clips.map((F=>F.weight||1)),Q=new Bb(b.loop||!1,b._babylonSounds,F);b.innerAngle&&(Q.directionalConeInnerAngle=2*g.Tools.ToDegrees(b.innerAngle)),b.outerAngle&&(Q.directionalConeOuterAngle=2*g.Tools.ToDegrees(b.outerAngle)),b.volume&&(Q.volume=b.volume),b._babylonData.sound=Q}));b._babylonData={loaded:z}}return b._babylonData.loaded}_getEventAction(F,b,Q,C,z){switch(Q){case"play":return F=>{const Q=(z||0)+(F-C);b.play(Q)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${F}: Unsupported action ${Q}`)}}_loadAnimationEventAsync(F,b,Q,C,z){if(0==z.targetedAnimations.length)return Promise.resolve();const t=z.targetedAnimations[0],g=C.Cb,W=a.Get(`/extensions/${this.name}/emitters`,this._emitters,g);return this._loadEmitterAsync(F,W).then((()=>{const b=W._babylonData.sound;if(b){const Q=new Jb(C.time,this._getEventAction(F,b,C.action,C.time,C.startOffset));t.animation.addEvent(Q),z.onAnimationGroupEndObservable.add((()=>{b.stop()})),z.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}o(gQ),T(gQ,!0,(F=>new WQ(F)));const ZQ="MSFT_lod";class qQ{constructor(F){var b;this.name=ZQ,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new G.c,this.onMaterialLODsLoadedObservable=new G.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=F,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[ZQ])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(ZQ)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let F=0;F<this._nodePromiseLODs.length;F++){const b=Promise.all(this._nodePromiseLODs[F]).then((()=>{0!==F&&(this._loader.endPerformanceCounter(`Node LOD ${F}`),this._loader.log(`Loaded node LOD ${F}`)),this.onNodeLODsLoadedObservable.notifyObservers(F),F!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${F+1}`),this._loadBufferLOD(this._nodeBufferLODs,F+1),this._nodeSignalLODs[F]&&this._nodeSignalLODs[F].resolve())}));this._loader._completePromises.push(b)}for(let F=0;F<this._materialPromiseLODs.length;F++){const b=Promise.all(this._materialPromiseLODs[F]).then((()=>{0!==F&&(this._loader.endPerformanceCounter(`Material LOD ${F}`),this._loader.log(`Loaded material LOD ${F}`)),this.onMaterialLODsLoadedObservable.notifyObservers(F),F!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${F+1}`),this._loadBufferLOD(this._materialBufferLODs,F+1),this._materialSignalLODs[F]&&this._materialSignalLODs[F].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(F,b){const Q=this._loader.loadSceneAsync(F,b);return this._loadBufferLOD(this._bufferLODs,0),Q}loadNodeAsync(F,b,Q){return U.LoadExtensionAsync(F,b,this.name,(async(F,z)=>{let t;const g=this._getLODs(F,b,this._loader.yb.nodes,z.ids);this._loader.logOpen(`${F}`);for(let b=0;b<g.length;b++){const F=g[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new C);const z=F=>{Q(F),F.XZ(!1)},W=this._loader.loadNodeAsync(`/nodes/${F.index}`,F,z).then((F=>{if(0!==b){const F=g[b-1];F._babylonTransformNode&&(this._disposeTransformNode(F._babylonTransformNode),delete F._babylonTransformNode)}return F.XZ(!0),F}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?t=W:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(W))}return this._loader.logClose(),await t}))}_loadMaterialAsync(F,b,Q,C,z){return this._nodeIndexLOD?null:U.LoadExtensionAsync(F,b,this.name,(async(F,t)=>{let g;const W=this._getLODs(F,b,this._loader.yb.materials,t.ids);this._loader.logOpen(`${F}`);for(let b=0;b<W.length;b++){const F=W[b];0!==b&&(this._materialIndexLOD=b);const t=this._loader._loadMaterialAsync(`/materials/${F.index}`,F,Q,C,(F=>{0===b&&z(F)})).then((F=>{if(0!==b){z(F);const Q=W[b-1]._data;Q[C]&&(this._disposeMaterials([Q[C].babylonMaterial]),delete Q[C])}return F}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?g=t:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(t))}return this._loader.logClose(),await g}))}_loadUriAsync(F,b,Q){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const z=this._nodeIndexLOD-1;return this._nodeSignalLODs[z]=this._nodeSignalLODs[z]||new C,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(F,b,Q)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const z=this._materialIndexLOD-1;return this._materialSignalLODs[z]=this._materialSignalLODs[z]||new C,this._materialSignalLODs[z].promise.then((async()=>await this._loader.loadUriAsync(F,b,Q)))}return null}loadBufferAsync(F,b,Q,z){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${F}: Uri is missing or the binary glTF is missing its binary chunk`);const b=async(F,b)=>{const t=Q,g=t+z-1;let W=F[b];return W?(W.start=Math.min(W.start,t),W.end=Math.max(W.end,g)):(W={start:t,end:g,loaded:new C},F[b]=W),await W.loaded.promise.then((F=>new Uint8Array(F.buffer,F.byteOffset+Q-W.start,z)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(F,b){const Q=F[b];Q&&(this._loader.log(`Loading buffer range [${Q.start}-${Q.end}]`),this._loader.bin.readAsync(Q.start,Q.end-Q.start+1).then((F=>{Q.loaded.resolve(F)}),(F=>{Q.loaded.reject(F)})))}_getLODs(F,b,Q,C){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const z=[];for(let t=C.length-1;t>=0;t--)if(z.push(a.Get(`${F}/ids/${C[t]}`,Q,C[t])),z.length===this.maxLODsToLoad)return z;return z.push(b),z}_disposeTransformNode(F){const b=[],Q=F.material;Q&&b.push(Q);for(const z of F.getChildMeshes())z.material&&b.push(z.material);F.dispose();const C=b.filter((F=>this._loader.babylonScene.meshes.every((b=>b.material!=F))));this._disposeMaterials(C)}_disposeMaterials(F){const b={};for(const Q of F){for(const F of Q.getActiveTextures())b[F.uniqueId]=F;Q.dispose()}for(const Q in b)for(const F of this._loader.babylonScene.materials)F.hasTexture(b[Q])&&delete b[Q];for(const Q in b)b[Q].dispose()}}o(ZQ),T(ZQ,!0,(F=>new qQ(F)));const GQ="MSFT_minecraftMesh";class KQ{constructor(F){this.name=GQ,this._loader=F,this.enabled=this._loader.isExtensionUsed(GQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtraAsync(F,b,this.name,(async(C,z)=>{if(z){if(!(Q instanceof i.c))throw new Error(`${C}: Material type not supported`);const z=this._loader.loadMaterialPropertiesAsync(F,b,Q);return Q.needAlphaBlending()&&(Q.forceDepthWrite=!0,Q.separateCullingPass=!0),Q.nb=Q.forceDepthWrite,Q.twoSidedLighting=!0,await z}}))}}o(GQ),T(GQ,!0,(F=>new KQ(F)));const eQ="MSFT_sRGBFactors";class NQ{constructor(F){this.name=eQ,this._loader=F,this.enabled=this._loader.isExtensionUsed(eQ)}dispose(){this._loader=null}loadMaterialPropertiesAsync(F,b,Q){return U.LoadExtraAsync(F,b,this.name,(async(C,z)=>{if(z){if(!(Q instanceof i.c))throw new Error(`${C}: Material type not supported`);const z=this._loader.loadMaterialPropertiesAsync(F,b,Q),t=Q.RF().getEngine().useExactSrgbConversions;return Q.albedoTexture||Q.albedoColor.toLinearSpaceToRef(Q.albedoColor,t),Q.reflectivityTexture||Q.reflectivityColor.toLinearSpaceToRef(Q.reflectivityColor,t),await z}}))}}o(eQ),T(eQ,!0,(F=>new NQ(F)));var yQ=Q(12938);const EQ={};var cQ=Q(12989),XQ=Q(12967),LQ=Q(12941),iQ=Q(12951);function fQ(F,b){for(const Q of F)for(const F of Q.dataOutputs)if(F.uniqueId===b)return F;throw new Error("Could not find data out connection with unique id "+b)}function kQ(F,b){for(const Q of F)if(Q instanceof XQ.d)for(const F of Q.signalInputs)if(F.uniqueId===b)return F;throw new Error("Could not find signal in connection with unique id "+b)}async function mQ(F,b){const C=await Promise.all(F.allBlocks.map((async F=>{const b=function(F){switch(F){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([Q.e(78),Q.e(79)]).then(Q.bind(Q,14418))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await Q.e(80).then(Q.bind(Q,14421))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await Q.e(81).then(Q.bind(Q,14424))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await Q.e(82).then(Q.bind(Q,14432))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await Q.e(83).then(Q.bind(Q,14437))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await Q.e(84).then(Q.bind(Q,14441))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await Q.e(85).then(Q.bind(Q,14446))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await Q.e(86).then(Q.bind(Q,14452))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await Q.e(87).then(Q.bind(Q,14459))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await Q.e(90).then(Q.bind(Q,14489))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await Q.e(90).then(Q.bind(Q,14489))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await Q.e(90).then(Q.bind(Q,14489))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await Q.e(90).then(Q.bind(Q,14489))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await Q.e(95).then(Q.bind(Q,14491))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await Q.e(96).then(Q.bind(Q,14493))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await Q.e(97).then(Q.bind(Q,14498))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await Q.e(98).then(Q.bind(Q,14506))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await Q.e(99).then(Q.bind(Q,14514))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await Q.e(100).then(Q.bind(Q,14519))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await Q.e(101).then(Q.bind(Q,14525))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await Q.e(102).then(Q.bind(Q,14530))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await Q.e(103).then(Q.bind(Q,14536))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await Q.e(104).then(Q.bind(Q,14544))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await Q.e(105).then(Q.bind(Q,14547))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await Q.e(106).then(Q.bind(Q,14552))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await Q.e(107).then(Q.bind(Q,14554))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await Q.e(108).then(Q.bind(Q,14558))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await Q.e(109).then(Q.bind(Q,14562))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await Q.e(110).then(Q.bind(Q,14567))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await Q.e(111).then(Q.bind(Q,14574))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await Q.e(112).then(Q.bind(Q,14580))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await Q.e(113).then(Q.bind(Q,14585))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await Q.e(92).then(Q.bind(Q,14594))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await Q.e(114).then(Q.bind(Q,14597))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await Q.e(115).then(Q.bind(Q,14605))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await Q.e(116).then(Q.bind(Q,14612))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await Q.e(93).then(Q.bind(Q,14617))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await Q.e(88).then(Q.bind(Q,14464))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await Q.e(94).then(Q.bind(Q,14621))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await Q.e(89).then(Q.bind(Q,14484))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await Q.e(90).then(Q.bind(Q,14489))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await Q.e(90).then(Q.bind(Q,14489))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await Q.e(91).then(Q.bind(Q,14624))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await Q.e(91).then(Q.bind(Q,14624))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await Q.e(91).then(Q.bind(Q,14624))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await Q.e(91).then(Q.bind(Q,14624))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await Q.e(91).then(Q.bind(Q,14624))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await Q.e(91).then(Q.bind(Q,14624))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await Q.e(117).then(Q.bind(Q,14630))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await Q.e(118).then(Q.bind(Q,14636))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await Q.e(119).then(Q.bind(Q,14645))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await Q.e(120).then(Q.bind(Q,14653))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await Q.e(121).then(Q.bind(Q,14662))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await Q.e(122).then(Q.bind(Q,14667))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await Q.e(123).then(Q.bind(Q,14673))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await Q.e(124).then(Q.bind(Q,14679))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await Q.e(125).then(Q.bind(Q,14681))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await Q.e(126).then(Q.bind(Q,14685))).FlowGraphDataSwitchBlock;default:if(EQ[F])return EQ[F];throw new Error(`Unknown block name ${F}`)}}(F.className);return await b()})));return function(F,b,Q){const C=b.coordinator.createGraph(),z=[],t=b.valueParseFunction??LQ.b;for(let g=0;g<F.allBlocks.length;g++){const W=pQ(F.allBlocks[g],{ZQ:b.coordinator.config.ZQ,pathConverter:b.pathConverter,assetsContainer:b.coordinator.config.ZQ,valueParseFunction:t},Q[g]);z.push(W),W instanceof cQ.c&&C.addEventBlock(W)}for(const g of z){for(const F of g.dataInputs)for(const b of F.connectedPointIds){const Q=fQ(z,b);F.connectTo(Q)}if(g instanceof XQ.d)for(const F of g.signalOutputs)for(const b of F.connectedPointIds){const Q=kQ(z,b);F.connectTo(Q)}}for(const g of F.executionContexts)RQ(g,{graph:C,valueParseFunction:t},F.rightHanded);return C}(F,b,C)}function RQ(F,b,Q){const C=b.graph.createContext();F.enableLogging&&(C.enableLogging=!0),C.treatDataAsRightHanded=Q||!1;const z=b.valueParseFunction??LQ.b;C.uniqueId=F.uniqueId;const t=C.RF();if(F._assetsContext){var g,W,Z,q,G,K,e,N,y,E;const b=F._assetsContext,Q={meshes:null===(g=b.meshes)||void 0===g?void 0:g.map((F=>t.getMeshById(F))),lights:null===(W=b.lights)||void 0===W?void 0:W.map((F=>t.getLightByName(F))),cameras:null===(Z=b.cameras)||void 0===Z?void 0:Z.map((F=>t.getCameraByName(F))),materials:null===(q=b.materials)||void 0===q?void 0:q.map((F=>t.getMaterialById(F))),textures:null===(G=b.textures)||void 0===G?void 0:G.map((F=>t.getTextureByName(F))),animations:null===(K=b.animations)||void 0===K?void 0:K.map((F=>t.animations.find((b=>b.name===F)))),skeletons:null===(e=b.skeletons)||void 0===e?void 0:e.map((F=>t.getSkeletonByName(F))),Te:null===(N=b.Te)||void 0===N?void 0:N.map((F=>t.getParticleSystemById(F))),animationGroups:null===(y=b.animationGroups)||void 0===y?void 0:y.map((F=>t.getAnimationGroupByName(F))),transformNodes:null===(E=b.transformNodes)||void 0===E?void 0:E.map((F=>t.getTransformNodeById(F))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],mN:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};C.assetsContext=Q}for(const c in F._userVariables){const b=z(c,F._userVariables,C.assetsContext,t);C.userVariables[c]=b}for(const c in F._connectionValues){const b=z(c,F._connectionValues,C.assetsContext,t);C._setConnectionValueByKey(c,b)}return C}function pQ(F,b,Q){const C={},z=b.valueParseFunction??LQ.b;if(F.config)for(const g in F.config)C[g]=z(g,F.config,b.assetsContainer||b.ZQ,b.ZQ);if((0,LQ.g)(F.className)){if(!b.pathConverter)throw new Error("Path converter is required for this block");C.pathConverter=b.pathConverter}const t=new Q(C);t.uniqueId=F.uniqueId;for(let g=0;g<F.dataInputs.length;g++){const b=t.getDataInput(F.dataInputs[g].name);if(!b)throw new Error("Could not find data input with name "+F.dataInputs[g].name+" in block "+F.className);b.deserialize(F.dataInputs[g])}for(let g=0;g<F.dataOutputs.length;g++){const b=t.getDataOutput(F.dataOutputs[g].name);if(!b)throw new Error("Could not find data output with name "+F.dataOutputs[g].name+" in block "+F.className);b.deserialize(F.dataOutputs[g])}return t.metadata=F.metadata,t.deserialize&&t.deserialize(F),t}function DQ(F){const[b,Q]=F.split(":");return PQ({op:b,extension:Q})}function PQ(F){var b;let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const C=F.extension?null===(b=jQ[F.extension])||void 0===b?void 0:b[F.op]:wQ[F.op];if(!C&&(E.e.Warn(`No mapping found for operation ${F.op} and extension ${F.extension||"KHR_interactivity"}`),Q)){const b={},Q={flows:{}};if(F.inputValueSockets){b.values={};for(const Q in F.inputValueSockets)b.values[Q]={name:Q}}return F.outputValueSockets&&(Q.values={},Object.keys(F.outputValueSockets).forEach((F=>{Q.values[F]={name:F}}))),{AG:[],inputs:b,outputs:Q}}return C}function nQ(F,b,Q){jQ[b]||(jQ[b]={}),jQ[b][F]=Q}const jQ={BABYLON:{"flow/log":{AG:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},wQ={"event/onStart":{AG:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{AG:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{AG:["FlowGraphSendCustomEventBlock"],extraProcessor(F,b,Q,C,z){if("event/send"!==b.op||!F.configuration||1!==Object.keys(F.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=F.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const g=C.arrays.events[t],W=z[0];return W.config||(W.config={}),W.config.eventId=g.eventId,W.config.eventData=g.eventData,z}},"event/receive":{AG:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(F,b){var Q;if(!F.configuration)return E.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const C=F.configuration.event;if(!C)return E.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const z=C.value[0];if("number"!==typeof z)return E.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(Q=b.events)||void 0===Q?void 0:Q[z])?{valid:!0}:(E.e.Error(`Event with id ${z} not found`),{valid:!1,error:`Event with id ${z} not found`})},extraProcessor(F,b,Q,C,z){if("event/receive"!==b.op||!F.configuration||1!==Object.keys(F.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const t=F.configuration.event.value[0];if("number"!==typeof t)throw new Error("Event id should be a number");const g=C.arrays.events[t],W=z[0];return W.config||(W.config={}),W.config.eventId=g.eventId,W.config.eventData=g.eventData,z}},"math/e":YQ("FlowGraphEBlock"),"math/pi":YQ("FlowGraphPIBlock"),"math/inf":YQ("FlowGraphInfBlock"),"math/nan":YQ("FlowGraphNaNBlock"),"math/abs":YQ("FlowGraphAbsBlock"),"math/sign":YQ("FlowGraphSignBlock"),"math/trunc":YQ("FlowGraphTruncBlock"),"math/floor":YQ("FlowGraphFloorBlock"),"math/ceil":YQ("FlowGraphCeilBlock"),"math/round":{AG:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z){var t;return(t=z[0]).config||(t.config={}),z[0].config.roundHalfAwayFromZero=!0,z}},"math/fract":YQ("FlowGraphFractBlock"),"math/neg":YQ("FlowGraphNegationBlock"),"math/add":YQ("FlowGraphAddBlock",["a","b"],!0),"math/sub":YQ("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{AG:["FlowGraphMultiplyBlock"],extraProcessor(F,b,Q,C,z){var t;(t=z[0]).config||(t.config={}),z[0].config.useMatrixPerComponent=!0,z[0].config.preventIntegerFloatArithmetic=!0;let g=-1;return Object.keys(F.values||{}).find((b=>{var Q;return void 0!==(null===(Q=F.values)||void 0===Q?void 0:Q[b].type)&&(g=F.values[b].type,!0)})),-1!==g&&(z[0].config.type=C.arrays.types[g].flowGraphType),z},validation:F=>F.values?sQ(F):{valid:!0}},"math/div":YQ("FlowGraphDivideBlock",["a","b"],!0),"math/rem":YQ("FlowGraphModuloBlock",["a","b"]),"math/min":YQ("FlowGraphMinBlock",["a","b"]),"math/max":YQ("FlowGraphMaxBlock",["a","b"]),"math/clamp":YQ("FlowGraphClampBlock",["a","b","c"]),"math/saturate":YQ("FlowGraphSaturateBlock"),"math/mix":YQ("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":YQ("FlowGraphEqualityBlock",["a","b"]),"math/lt":YQ("FlowGraphLessThanBlock",["a","b"]),"math/le":YQ("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":YQ("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":YQ("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":YQ("FlowGraphIsNaNBlock"),"math/isinf":YQ("FlowGraphIsInfBlock"),"math/select":{AG:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{AG:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":YQ("FlowGraphSinBlock"),"math/cos":YQ("FlowGraphCosBlock"),"math/tan":YQ("FlowGraphTanBlock"),"math/asin":YQ("FlowGraphASinBlock"),"math/acos":YQ("FlowGraphACosBlock"),"math/atan":YQ("FlowGraphATanBlock"),"math/atan2":YQ("FlowGraphATan2Block",["a","b"]),"math/sinh":YQ("FlowGraphSinhBlock"),"math/cosh":YQ("FlowGraphCoshBlock"),"math/tanh":YQ("FlowGraphTanhBlock"),"math/asinh":YQ("FlowGraphASinhBlock"),"math/acosh":YQ("FlowGraphACoshBlock"),"math/atanh":YQ("FlowGraphATanhBlock"),"math/exp":YQ("FlowGraphExponentialBlock"),"math/log":YQ("FlowGraphLogBlock"),"math/log2":YQ("FlowGraphLog2Block"),"math/log10":YQ("FlowGraphLog10Block"),"math/sqrt":YQ("FlowGraphSquareRootBlock"),"math/cbrt":YQ("FlowGraphCubeRootBlock"),"math/pow":YQ("FlowGraphPowerBlock",["a","b"]),"math/length":YQ("FlowGraphLengthBlock"),"math/normalize":YQ("FlowGraphNormalizeBlock"),"math/dot":YQ("FlowGraphDotBlock",["a","b"]),"math/cross":YQ("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":YQ("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":YQ("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{AG:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{AG:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{AG:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{AG:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{AG:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{AG:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{AG:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":YQ("FlowGraphTransposeBlock"),"math/determinant":YQ("FlowGraphDeterminantBlock"),"math/inverse":YQ("FlowGraphInvertMatrixBlock"),"math/matmul":YQ("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{AG:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"wb",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z,t){const g=z[0].dataInputs.find((F=>"rotationQuaternion"===F.name));if(!g)throw new Error("Rotation quaternion input not found");return t._connectionValues[g.uniqueId]&&(t._connectionValues[g.uniqueId].type="Quaternion"),z}},"math/matDecompose":{AG:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"wb"}}}},"math/quatConjugate":YQ("FlowGraphConjugateBlock",["a"]),"math/quatMul":{AG:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z){var t;return(t=z[0]).config||(t.config={}),z[0].config.type="Quaternion",z}},"math/quatAngleBetween":YQ("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{AG:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":YQ("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":YQ("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{AG:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z){var t;return(t=z[0]).config||(t.config={}),z[0].config.inputIsColumnMajor=!0,z}},"math/extract2x2":{AG:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{AG:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z){var t;return(t=z[0]).config||(t.config={}),z[0].config.inputIsColumnMajor=!0,z}},"math/extract3x3":{AG:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{AG:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z){var t;return(t=z[0]).config||(t.config={}),z[0].config.inputIsColumnMajor=!0,z}},"math/extract4x4":{AG:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{AG:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z,t){var g,W;(W=z[0]).config||(W.config={});const Z=z[0].dataInputs[0];return z[0].config.valueType=(null===(g=t._connectionValues[Z.uniqueId])||void 0===g?void 0:g.type)??"FlowGraphInteger",z}},"math/and":{AG:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z,t){var g,W,Z;(Z=z[0]).config||(Z.config={});const q=z[0].dataInputs[0],G=z[0].dataInputs[1];return z[0].config.valueType=(null===(g=t._connectionValues[q.uniqueId])||void 0===g?void 0:g.type)??(null===(W=t._connectionValues[G.uniqueId])||void 0===W?void 0:W.type)??"FlowGraphInteger",z}},"math/or":{AG:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z,t){var g,W,Z;(Z=z[0]).config||(Z.config={});const q=z[0].dataInputs[0],G=z[0].dataInputs[1];return z[0].config.valueType=(null===(g=t._connectionValues[q.uniqueId])||void 0===g?void 0:g.type)??(null===(W=t._connectionValues[G.uniqueId])||void 0===W?void 0:W.type)??"FlowGraphInteger",z}},"math/xor":{AG:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(F,b,Q,C,z,t){var g,W,Z;(Z=z[0]).config||(Z.config={});const q=z[0].dataInputs[0],G=z[0].dataInputs[1];return z[0].config.valueType=(null===(g=t._connectionValues[q.uniqueId])||void 0===g?void 0:g.type)??(null===(W=t._connectionValues[G.uniqueId])||void 0===W?void 0:W.type)??"FlowGraphInteger",z}},"math/asr":YQ("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":YQ("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":YQ("FlowGraphLeadingZerosBlock"),"math/ctz":YQ("FlowGraphTrailingZerosBlock"),"math/popcnt":YQ("FlowGraphOneBitsCounterBlock"),"math/rad":YQ("FlowGraphDegToRadBlock"),"math/deg":YQ("FlowGraphRadToDegBlock"),"type/boolToInt":YQ("FlowGraphBooleanToInt"),"type/boolToFloat":YQ("FlowGraphBooleanToFloat"),"type/intToBool":YQ("FlowGraphIntToBoolean"),"type/intToFloat":YQ("FlowGraphIntToFloat"),"type/floatToInt":YQ("FlowGraphFloatToInt"),"type/floatToBool":YQ("FlowGraphFloatToBoolean"),"flow/sequence":{AG:["FlowGraphSequenceBlock"],extraProcessor(F,b,Q,C,z){const t=z[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(F.flows||[]).length,t.signalOutputs.forEach(((F,b)=>{F.name="out_"+b})),z}},"flow/branch":{AG:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{AG:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(F){if(F.configuration&&F.configuration.cases){const b=F.configuration.cases.value;if(!b.every((F=>"number"===typeof F&&/^-?\d+$/.test(F.toString()))))return E.e.Warn("Switch cases should be integers. Using empty array instead."),F.configuration.cases.value=[],{valid:!0};const Q=new Set(b);F.configuration.cases.value=Array.from(Q)}return{valid:!0}},extraProcessor(F,b,Q,C,z){if("flow/switch"!==b.op||!F.flows||0===Object.keys(F.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return z[0].signalOutputs.forEach((F=>{"default"!==F.name&&(F.name="out_"+F.name)})),z}},"flow/while":{AG:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{AG:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(F,b,Q,C,z){const t=z[0];return t.config||(t.config={}),t.config.incrementIndexWhenLoopDone=!0,z}},"flow/doN":{AG:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{AG:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(F,b,Q,C,z){if("flow/multiGate"!==b.op||!F.flows||0===Object.keys(F.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const t=z[0];return t.config||(t.config={}),t.config.outputSignalCount=Object.keys(F.flows).length,t.signalOutputs.forEach(((F,b)=>{F.name="out_"+b})),z}},"flow/waitAll":{AG:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(F){var b,Q;return"number"!==typeof(null===(b=F.configuration)||void 0===b||null===(Q=b.inputFlows)||void 0===Q?void 0:Q.value[0])&&(F.configuration=F.configuration||{inputFlows:{value:[0]}},F.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{AG:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{AG:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{AG:["FlowGraphCancelDelayBlock"]},"variable/get":{AG:["FlowGraphGetVariableBlock"],validation(F){var b,Q;return null!==(b=F.configuration)&&void 0!==b&&null!==(Q=b.variable)&&void 0!==Q&&Q.value?{valid:!0}:(E.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(F,b)=>[b.getVariableName(F[0])]}}},"variable/set":{AG:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(F,b)=>[b.getVariableName(F[0])]}}},"variable/setMultiple":{AG:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(F,b)=>[F[0].map((F=>b.getVariableName(F)))]}},extraProcessor:(F,b,Q,C,z)=>(z[0].dataInputs.forEach((F=>{F.name=C.getVariableName(+F.name)})),z)},"variable/interpolate":{AG:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(F,b)=>[b.getVariableName(F[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:F=>!0===F[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",yC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",yC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",yC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",yC:"FlowGraphPlayAnimationBlock"},out:{name:"out",yC:"FlowGraphPlayAnimationBlock"},done:{name:"done",yC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(F,b,Q,C,z){var t,g,W;const Z=z[0],q=null===(t=F.configuration)||void 0===t?void 0:t.variable.value[0];if("number"!==typeof q)throw E.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const G=C.arrays.staticVariables[q];"undefined"===typeof Z.config.animationType.value&&(C.arrays.staticVariables,Z.config.animationType.value=(0,iQ.z)(G.type));const K=z[4];return K.config||(K.config={}),(g=K.config).variable||(g.variable={}),K.config.variable.value=C.getVariableName(q),(W=z[3]).config||(W.config={}),z}},"pointer/get":{AG:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",yC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",yC:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(F,b,Q,C,z)=>(z.forEach((F=>{"FlowGraphJsonPointerParserBlock"===F.className&&(F.config||(F.config={}),F.config.outputValue=!0)})),z)},"pointer/set":{AG:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",yC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",yC:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(F,b,Q,C,z)=>(z.forEach((F=>{"FlowGraphJsonPointerParserBlock"===F.className&&(F.config||(F.config={}),F.config.outputValue=!0)})),z)},"pointer/interpolate":{AG:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",yC:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",yC:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",yC:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",yC:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",yC:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",yC:"FlowGraphPlayAnimationBlock"},out:{name:"out",yC:"FlowGraphPlayAnimationBlock"},done:{name:"done",yC:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(F,b,Q,C,z)=>(z.forEach((b=>{"FlowGraphJsonPointerParserBlock"===b.className?(b.config||(b.config={}),b.config.outputValue=!0):"FlowGraphInterpolationBlock"===b.className&&(b.config||(b.config={}),Object.keys(F.values||[]).forEach((Q=>{var z;const t=null===(z=F.values)||void 0===z?void 0:z[Q];if("value"===Q&&t){const F=t.type;void 0!==F&&(b.config.animationType=C.arrays.types[F].flowGraphType)}})))})),z)},"animation/start":{AG:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",yC:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(F,b)=>[F[0]*b._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(F,b)=>[F[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(F,b,Q,C,z,t,g){const W=z[z.length-1];return W.config||(W.config={}),W.config.glTF=g,z}},"animation/stop":{AG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",yC:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(F,b,Q,C,z,t,g){const W=z[z.length-1];return W.config||(W.config={}),W.config.glTF=g,z}},"animation/stopAt":{AG:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",yC:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(F,b)=>[F[0]*b._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(F,b,Q,C,z,t,g){const W=z[z.length-1];return W.config||(W.config={}),W.config.glTF=g,z}},"math/switch":{AG:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(F){if(F.configuration&&F.configuration.cases){const b=F.configuration.cases.value;if(!b.every((F=>"number"===typeof F&&/^-?\d+$/.test(F.toString()))))return E.e.Warn("Switch cases should be integers. Using empty array instead."),F.configuration.cases.value=[],{valid:!0};const Q=new Set(b);F.configuration.cases.value=Array.from(Q)}return{valid:!0}},extraProcessor(F,b,Q,C,z){const t=z[0];return t.dataInputs.forEach((F=>{"default"!==F.name&&"case"!==F.name&&(F.name="in_"+F.name)})),t.config||(t.config={}),t.config.treatCasesAsIntegers=!0,z}},"debug/log":{AG:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function YQ(F){let b=arguments.length>2?arguments[2]:void 0;return{AG:[F],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((F,b)=>(F[b]={name:b},F)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(F,Q,C,z,t){var g;if(b){(g=t[0]).config||(g.config={}),t[0].config.preventIntegerFloatArithmetic=!0;let b=-1;Object.keys(F.values||{}).find((Q=>{var C;return void 0!==(null===(C=F.values)||void 0===C?void 0:C[Q].type)&&(b=F.values[Q].type,!0)})),-1!==b&&(t[0].config.type=z.arrays.types[b].flowGraphType)}return t},validation:F=>b?sQ(F):{valid:!0}}}function sQ(F){if(F.values){const b=Object.keys(F.values).map((b=>F.values[b].type)).filter((F=>void 0!==F));if(!b.every((F=>F===b[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}wQ["math/compose"]=wQ["math/matCompose"],wQ["math/decompose"]=wQ["math/matDecompose"];var VQ=Q(11272);const hQ={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"gQ",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class lQ{constructor(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=F,this._gltf=b,this._animationTargetFps=Q,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const F of this._interactivityGraph.types)this._types.push(hQ[F.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const F of this._interactivityGraph.declarations){const b=PQ(F);if(!b)throw E.e.Error(["No mapping found for declaration",F]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:b,fullOperationName:F.extension?F.op+":"+F.extension:F.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const F of this._interactivityGraph.variables){const b=this._parseVariable(F);this._staticVariables.push(b)}}_parseVariable(F,b){const Q=this._types[F.type];if(!Q)throw E.e.Error(["No type found for variable",F]),new Error("Error parsing variables");if(F.value&&F.value.length!==Q.length)throw E.e.Error(["Invalid value length for variable",F,Q]),new Error("Error parsing variables");const C=F.value||[];if(!C.length)switch(Q.flowGraphType){case"boolean":C.push(!1);break;case"FlowGraphInteger":C.push(0);break;case"number":C.push(NaN);break;case"Vector2":C.push(NaN,NaN);break;case"gQ":C.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":C.fill(NaN,0,4);break;case"Matrix":C.fill(NaN,0,16);break;case"Matrix3D":C.fill(NaN,0,9)}return"number"===Q.elementType&&"string"===typeof C[0]&&(C[0]=parseFloat(C[0])),{type:Q.flowGraphType,value:b?b(C,this):C}}_parseEvents(){if(this._interactivityGraph.events)for(const F of this._interactivityGraph.events){const b={eventId:F.id||"internalEvent_"+this._internalEventsCounter++};F.values&&(b.eventData=Object.keys(F.values).map((b=>{var Q;const C=null===(Q=F.values)||void 0===Q?void 0:Q[b];if(!C)throw E.e.Error(["No value found for event key",b]),new Error("Error parsing events");const z=this._types[C.type];if(!z)throw E.e.Error(["No type found for event value",C]),new Error("Error parsing events");const t="undefined"!==typeof C.value?this._parseVariable(C):void 0;return{id:b,type:z.flowGraphType,eventData:!0,value:t}}))),this._events.push(b)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const b of this._interactivityGraph.nodes){if("number"!==typeof b.declaration)throw E.e.Error(["No declaration found for node",b]),new Error("Error parsing nodes");const Q=this._mappings[b.declaration];if(!Q)throw E.e.Error(["No mapping found for node",b]),new Error("Error parsing nodes");if(Q.flowGraphMapping.validation){const C=Q.flowGraphMapping.validation(b,this._interactivityGraph,this._gltf);var F;if(!C.valid)throw new Error(`Error validating interactivity node ${null===(F=this._interactivityGraph.declarations)||void 0===F?void 0:F[b.declaration].op} - ${C.error}`)}const C=[];for(const F of Q.flowGraphMapping.AG){const z=this._getEmptyBlock(F,Q.fullOperationName);this._parseNodeConfiguration(b,z,Q.flowGraphMapping,F),C.push(z)}this._nodes.push({AG:C,fullOperationName:Q.fullOperationName})}}_getEmptyBlock(F,b){return{uniqueId:(0,VQ.b)(),className:F,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:b,metadata:{}}}_parseNodeConfiguration(F,b,Q,C){const z=b.config;if(F.configuration){const b=Object.keys(F.configuration);for(const W of b){var t,g;const b=null===(t=F.configuration)||void 0===t?void 0:t[W];if(!b)throw E.e.Error(["No value found for node configuration",W]),new Error("Error parsing node configuration");const Z=null===(g=Q.configuration)||void 0===g?void 0:g[W];if(Z&&Z.yC?Z.yC===C:0===Q.AG.indexOf(C)){const F=(null===Z||void 0===Z?void 0:Z.name)||W;b&&"undefined"!==typeof b.value||"undefined"===typeof(null===Z||void 0===Z?void 0:Z.defaultValue)?b.value.length>=0?z[F]={value:1===b.value.length?b.value[0]:b.value}:E.e.Warn(["Invalid value for node configuration",b]):z[F]={value:Z.defaultValue},Z&&Z.dataTransformer&&(z[F].value=Z.dataTransformer([z[F].value],this)[0])}}}}_parseNodeConnections(F){for(let m=0;m<this._nodes.length;m++){var b;const R=null===(b=this._interactivityGraph.nodes)||void 0===b?void 0:b[m];if(!R)throw E.e.Error(["No node found for interactivity node",this._nodes[m]]),new Error("Error parsing node connections");const p=this._nodes[m],D=this._mappings[R.declaration];if(!D)throw E.e.Error(["No mapping found for node",R]),new Error("Error parsing node connections");const P=R.flows||{},n=Object.keys(P).sort();for(const F of n){var Q,C,z,t;const b=P[F],q=null===(Q=D.flowGraphMapping.outputs)||void 0===Q||null===(C=Q.flows)||void 0===C?void 0:C[F],G=(null===q||void 0===q?void 0:q.name)||F,K=this._createNewSocketConnection(G,!0);(q&&q.yC&&p.AG.find((F=>F.className===q.yC))||p.AG[0]).signalOutputs.push(K);const e=b.node,N=this._nodes[e];if(!N)throw E.e.Error(["No node found for input node id",e]),new Error("Error parsing node connections");const y=DQ(N.fullOperationName);if(!y)throw E.e.Error(["No mapping found for input node",N]),new Error("Error parsing node connections");let c=null===(z=y.inputs)||void 0===z||null===(t=z.flows)||void 0===t?void 0:t[b.socket||"in"],X=!1;if(!c)for(const F in null===(g=y.inputs)||void 0===g?void 0:g.flows){var g,W,Z;if(F.startsWith("[")&&F.endsWith("]"))X=!0,c=null===(W=y.inputs)||void 0===W||null===(Z=W.flows)||void 0===Z?void 0:Z[F]}const L=c?X?c.name.replace("$1",b.socket||""):c.name:b.socket||"in",i=c&&c.yC&&N.AG.find((F=>F.className===c.yC))||N.AG[0];let f=i.signalInputs.find((F=>F.name===L));f||(f=this._createNewSocketConnection(L),i.signalInputs.push(f)),f.connectedPointIds.push(K.uniqueId),K.connectedPointIds.push(f.uniqueId)}const j=R.values||{},w=Object.keys(j);for(const b of w){var q,G;const Q=j[b];let C=null===(q=D.flowGraphMapping.inputs)||void 0===q||null===(G=q.values)||void 0===G?void 0:G[b],z=!1;if(!C)for(const F in null===(K=D.flowGraphMapping.inputs)||void 0===K?void 0:K.values){var K,e,N;if(F.startsWith("[")&&F.endsWith("]"))z=!0,C=null===(e=D.flowGraphMapping.inputs)||void 0===e||null===(N=e.values)||void 0===N?void 0:N[F]}const t=C?z?C.name.replace("$1",b):C.name:b,g=this._createNewSocketConnection(t);if((C&&C.yC&&p.AG.find((F=>F.className===C.yC))||p.AG[0]).dataInputs.push(g),void 0!==Q.value){const b=this._parseVariable(Q,C&&C.dataTransformer);F._connectionValues[g.uniqueId]=b}else{if("undefined"===typeof Q.node)throw E.e.Error(["Invalid value for value connection",Q]),new Error("Error parsing node connections");{var y,c,X;const F=Q.node,b=Q.socket||"value",C=this._nodes[F];if(!C)throw E.e.Error(["No node found for output socket reference",Q]),new Error("Error parsing node connections");const z=DQ(C.fullOperationName);if(!z)throw E.e.Error(["No mapping found for output socket reference",Q]),new Error("Error parsing node connections");let t=null===(y=z.outputs)||void 0===y||null===(c=y.values)||void 0===c?void 0:c[b],W=!1;if(!t)for(const Q in null===(L=z.outputs)||void 0===L?void 0:L.values){var L,i,f;if(Q.startsWith("[")&&Q.endsWith("]"))W=!0,t=null===(i=z.outputs)||void 0===i||null===(f=i.values)||void 0===f?void 0:f[Q]}const Z=t?W?t.name.replace("$1",b):null===(X=t)||void 0===X?void 0:X.name:b,q=t&&t.yC&&C.AG.find((F=>F.className===t.yC))||C.AG[0];let G=q.dataOutputs.find((F=>F.name===Z));G||(G=this._createNewSocketConnection(Z,!0),q.dataOutputs.push(G)),g.connectedPointIds.push(G.uniqueId),G.connectedPointIds.push(g.uniqueId)}}}if(D.flowGraphMapping.interBlockConnectors)for(const F of D.flowGraphMapping.interBlockConnectors){const b=F.input,Q=F.output,C=F.isVariable;this._connectFlowGraphNodes(b,Q,p.AG[F.inputBlockIndex],p.AG[F.outputBlockIndex],C)}if(D.flowGraphMapping.extraProcessor){var k;const b=null===(k=this._interactivityGraph.declarations)||void 0===k?void 0:k[R.declaration];if(!b)throw E.e.Error(["No declaration found for extra processor",R]),new Error("Error parsing node connections");p.AG=D.flowGraphMapping.extraProcessor(R,b,D.flowGraphMapping,this,p.AG,F,this._gltf)}}}_createNewSocketConnection(F,b){return{uniqueId:(0,VQ.b)(),name:F,_connectionType:b?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(F,b,Q,C,z){const t=z?Q.dataInputs:Q.signalInputs,g=z?C.dataOutputs:C.signalOutputs,W=t.find((b=>b.name===F))||this._createNewSocketConnection(F),Z=g.find((F=>F.name===b))||this._createNewSocketConnection(b,!0);t.find((b=>b.name===F))||t.push(W),g.find((F=>F.name===b))||g.push(Z),W.connectedPointIds.push(Z.uniqueId),Z.connectedPointIds.push(W.uniqueId)}getVariableName(F){return"staticVariable_"+F}serializeToFlowGraph(){const F={uniqueId:(0,VQ.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(F);for(let b=0;b<this._staticVariables.length;b++){const Q=this._staticVariables[b];F._userVariables[this.getVariableName(b)]=Q}return{rightHanded:!0,allBlocks:this._nodes.reduce(((F,b)=>F.concat(b.AG)),[]),executionContexts:[F]}}}const TQ="KHR_interactivity";class oQ{constructor(F){this._loader=F,this.name=TQ,this.enabled=this._loader.isExtensionUsed(TQ),this._pathConverter=(0,S.e)(this._loader.yb),F._skipStartAnimationStep=!0;const b=F.babylonScene;b&&function(F){(0,S.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!F.activeCamera)return new z.Quaternion(NaN,NaN,NaN,NaN);const b=z.Quaternion.FromRotationMatrix(F.activeCamera.getWorldMatrix()).normalize();return F.useRightHandedSystem||(b.w*=-1,b.x*=-1),b},type:"Quaternion",getTarget:()=>F.activeCamera}),(0,S.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!F.activeCamera)return new z.gQ(NaN,NaN,NaN);const b=F.activeCamera.getWorldMatrix().getTranslation();return F.useRightHandedSystem||(b.x*=-1),b},type:"gQ",getTarget:()=>F.activeCamera}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:F=>{var b;return(null===(b=F._babylonAnimationGroup)||void 0===b?void 0:b.isPlaying)??!1},type:"boolean",getTarget:F=>F._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:F=>{var b;return((null===(b=F._babylonAnimationGroup)||void 0===b?void 0:b.from)??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:F=>{var b;return((null===(b=F._babylonAnimationGroup)||void 0===b?void 0:b.to)??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:F=>{var b;return((null===(b=F._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:F=>{var b;return((null===(b=F._babylonAnimationGroup)||void 0===b?void 0:b.getCurrentFrame())??0)/60},type:"number",getTarget:F=>F._babylonAnimationGroup})}(b)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var F;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,Q=null===(F=this._loader.yb.extensions)||void 0===F?void 0:F.KHR_interactivity;if(!Q)return;const C=new yQ.c({ZQ:b});C.dispatchEventsSynchronously=!1;const z=Q.graphs.map((F=>new lQ(F,this._loader.yb,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(z.map((async F=>await mQ(F,{coordinator:C,pathConverter:this._pathConverter})))),C.start()}}var SQ;SQ=async()=>(await Promise.resolve().then(Q.bind(Q,13007))).FlowGraphGLTFDataProvider,EQ[`${TQ}/${"FlowGraphGLTFDataProvider"}`]=SQ,o(TQ),T(TQ,!0,(F=>new oQ(F)));const OQ="KHR_node_visibility";(0,S.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:F=>{const b=F._babylonTransformNode;return!b||void 0===b.isVisible||b.isVisible},set:(F,b)=>{var Q,C;null===(Q=b._primitiveBabylonMeshes)||void 0===Q||Q.forEach((F=>{F.inheritVisibility=!0})),b._babylonTransformNode&&(b._babylonTransformNode.isVisible=F),null===(C=b._primitiveBabylonMeshes)||void 0===C||C.forEach((b=>{b.isVisible=F}))},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class xQ{constructor(F){this.name=OQ,this._loader=F,this.enabled=F.isExtensionUsed(OQ)}async onReady(){var F;null===(F=this._loader.yb.nodes)||void 0===F||F.forEach((F=>{var b,Q,C,z;(null===(b=F._primitiveBabylonMeshes)||void 0===b||b.forEach((F=>{F.inheritVisibility=!0})),null!==(Q=F.extensions)&&void 0!==Q&&Q.KHR_node_visibility)&&(!1===(null===(C=F.extensions)||void 0===C?void 0:C.KHR_node_visibility.visible)&&(F._babylonTransformNode&&(F._babylonTransformNode.isVisible=!1),null===(z=F._primitiveBabylonMeshes)||void 0===z||z.forEach((F=>{F.isVisible=!1}))))}))}dispose(){this._loader=null}}o(OQ),T(OQ,!0,(F=>new xQ(F)));const aQ="KHR_node_selectability";nQ("event/onSelect",aQ,{AG:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yC:"FlowGraphGetVariableBlock",dataTransformer:F=>["pickedMesh_"+F[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",yC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(F,b,Q,C,z,t,g){var W,Z,q,G,K,e;const N=z[z.length-1];N.config=N.config||{},N.config.glTF=g;const y=null===(W=F.configuration)||void 0===W||null===(Z=W.nodeIndex)||void 0===Z?void 0:Z.value[0];if(void 0===y||"number"!==typeof y)throw new Error("nodeIndex not found in configuration");const E="pickedMesh_"+y;return z[1].config.variable=E,t._userVariables[E]={className:"Mesh",id:null===g||void 0===g||null===(q=g.nodes)||void 0===q||null===(G=q[y]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===g||void 0===g||null===(K=g.nodes)||void 0===K||null===(e=K[y]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},z}}),(0,S.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:F=>{const b=F._babylonTransformNode;return!b||void 0===b.eq||b.eq},set:(F,b)=>{var Q;null===(Q=b._primitiveBabylonMeshes)||void 0===Q||Q.forEach((b=>{b.eq=F}))},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"eq"],type:"boolean"});class AQ{constructor(F){this.name=aQ,this._loader=F,this.enabled=F.isExtensionUsed(aQ)}async onReady(){var F;null===(F=this._loader.yb.nodes)||void 0===F||F.forEach((F=>{var b,Q,C;null!==(b=F.extensions)&&void 0!==b&&b.KHR_node_selectability&&!1===(null===(Q=F.extensions)||void 0===Q?void 0:Q.KHR_node_selectability.selectable)&&(null===(C=F._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((F=>{F.eq=!1})))}))}dispose(){this._loader=null}}o(aQ),T(aQ,!0,(F=>new AQ(F)));const UQ="KHR_node_hoverability",uQ="targetMeshPointerOver_";nQ("event/onHoverIn",UQ,{AG:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yC:"FlowGraphGetVariableBlock",dataTransformer:F=>[uQ+F[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",yC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(F,b,Q,C,z,t,g){var W,Z,q,G,K,e;const N=z[z.length-1];N.config=N.config||{},N.config.glTF=g;const y=null===(W=F.configuration)||void 0===W||null===(Z=W.nodeIndex)||void 0===Z?void 0:Z.value[0];if(void 0===y||"number"!==typeof y)throw new Error("nodeIndex not found in configuration");const E=uQ+y;return z[1].config.variable=E,t._userVariables[E]={className:"Mesh",id:null===g||void 0===g||null===(q=g.nodes)||void 0===q||null===(G=q[y]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===g||void 0===g||null===(K=g.nodes)||void 0===K||null===(e=K[y]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},z}});const vQ="targetMeshPointerOut_";nQ("event/onHoverOut",UQ,{AG:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",yC:"FlowGraphGetVariableBlock",dataTransformer:F=>[vQ+F[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",yC:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(F,b,Q,C,z,t,g){var W,Z,q,G,K,e;const N=z[z.length-1];N.config=N.config||{},N.config.glTF=g;const y=null===(W=F.configuration)||void 0===W||null===(Z=W.nodeIndex)||void 0===Z?void 0:Z.value[0];if(void 0===y||"number"!==typeof y)throw new Error("nodeIndex not found in configuration");const E=vQ+y;return z[1].config.variable=E,t._userVariables[E]={className:"Mesh",id:null===g||void 0===g||null===(q=g.nodes)||void 0===q||null===(G=q[y]._babylonTransformNode)||void 0===G?void 0:G.id,uniqueId:null===g||void 0===g||null===(K=g.nodes)||void 0===K||null===(e=K[y]._babylonTransformNode)||void 0===e?void 0:e.uniqueId},z}}),(0,S.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:F=>{const b=F._babylonTransformNode;return!b||void 0===b.pointerOverDisableMeshTesting||b.pointerOverDisableMeshTesting},set:(F,b)=>{var Q;null===(Q=b._primitiveBabylonMeshes)||void 0===Q||Q.forEach((b=>{b.pointerOverDisableMeshTesting=!F}))},getTarget:F=>F._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class JQ{constructor(F){this.name=UQ,this._loader=F,this.enabled=F.isExtensionUsed(UQ)}async onReady(){var F;null===(F=this._loader.yb.nodes)||void 0===F||F.forEach((F=>{var b,Q,C;null!==(b=F.extensions)&&void 0!==b&&b.KHR_node_hoverability&&!1===(null===(Q=F.extensions)||void 0===Q?void 0:Q.KHR_node_hoverability.hoverable)&&(null===(C=F._babylonTransformNode)||void 0===C||C.getChildMeshes().forEach((F=>{F.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}o(UQ),T(UQ,!0,(F=>new JQ(F)));const IQ="ExtrasAsMetadata";class MQ{_assignExtras(F,b){if(b.extras&&Object.keys(b.extras).length>0){const Q=F.metadata=F.metadata||{};(Q.yb=Q.yb||{}).extras=b.extras}}constructor(F){this.name=IQ,this.enabled=!0,this._loader=F}dispose(){this._loader=null}loadNodeAsync(F,b,Q){return this._loader.loadNodeAsync(F,b,(F=>{this._assignExtras(F,b),Q(F)}))}loadCameraAsync(F,b,Q){return this._loader.loadCameraAsync(F,b,(F=>{this._assignExtras(F,b),Q(F)}))}createMaterial(F,b,Q){const C=this._loader.createMaterial(F,b,Q);return this._assignExtras(C,b),C}}o(IQ),T(IQ,!1,(F=>new MQ(F)));Q(13007)},12881:(F,b,Q)=>{"use strict";Q.d(b,{e:()=>s,g:()=>D,i:()=>p,k:()=>P});var C=Q(11133),z=Q(11128),t=Q(12525),g=Q(11746),W=Q(11706),Z=Q(11724),q=Q(11146),G=Q(11161),K=Q(11738),e=Q(11827),N=Q(11750),y=Q(11352);class E{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.Te=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.mN=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(F){this._environmentTexture=F}getNodes(){let F=[];F=F.concat(this.meshes),F=F.concat(this.lights),F=F.concat(this.cameras),F=F.concat(this.transformNodes);for(const b of this.skeletons)F=F.concat(b.bones);return F}}class c extends E{}class X{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const F=this.rootNodes;for(const C of F)C.dispose();F.length=0;const b=this.skeletons;for(const C of b)C.dispose();b.length=0;const Q=this.animationGroups;for(const C of Q)C.dispose();Q.length=0}}class L extends E{constructor(F){super(),this._wasAddedToScene=!1,(F=F||G.d.LastCreatedScene)&&(this.ZQ=F,this.proceduralTextures=[],F.Kb.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=F.getEngine().onContextRestoredObservable.add((()=>{for(const F of this.geometries)F._rebuild();for(const F of this.meshes)F._rebuild();for(const F of this.Te)F.rebuild();for(const F of this.textures)F._rebuild()})))}_topologicalSort(F){const b=new Map;for(const g of F)b.set(g.uniqueId,g);const Q={dependsOn:new Map,dependedBy:new Map};for(const g of F){const F=g.uniqueId;Q.dependsOn.set(F,new Set),Q.dependedBy.set(F,new Set)}for(const g of F){const F=g.uniqueId,C=Q.dependsOn.get(F);if(g instanceof K.e){const z=g.sourceMesh;b.has(z.uniqueId)&&(C.add(z.uniqueId),Q.dependedBy.get(z.uniqueId).add(F))}const z=Q.dependedBy.get(F);for(const t of g.getDescendants()){const C=t.uniqueId;if(b.has(C)){z.add(C);Q.dependsOn.get(C).add(F)}}}const C=[],z=[];for(const g of F){const F=g.uniqueId;0===Q.dependsOn.get(F).size&&(z.push(g),b.delete(F))}const t=z;for(;t.length>0;){const F=t.shift();C.push(F);const z=Q.dependedBy.get(F.uniqueId);for(const C of Array.from(z.values())){const z=Q.dependsOn.get(C);z.delete(F.uniqueId),0===z.size&&b.get(C)&&(t.push(b.get(C)),b.delete(C))}}return b.size>0&&(q.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((F=>{q.e.Error(F.name)}))),C}_addNodeAndDescendantsToList(F,b,Q,C){if(Q&&(!C||C(Q))&&!b.has(Q.uniqueId)){F.push(Q),b.add(Q.uniqueId);for(const z of Q.getDescendants(!0))this._addNodeAndDescendantsToList(F,b,z,C)}}_isNodeInContainer(F){return F instanceof Z.d&&-1!==this.meshes.indexOf(F)||(F instanceof W.d&&-1!==this.transformNodes.indexOf(F)||(F instanceof e.e&&-1!==this.lights.indexOf(F)||F instanceof N.b&&-1!==this.cameras.indexOf(F)))}_isValidHierarchy(){for(const F of this.meshes)if(F.parent&&!this._isNodeInContainer(F.parent))return q.e.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;for(const F of this.transformNodes)if(F.parent&&!this._isNodeInContainer(F.parent))return q.e.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;for(const F of this.lights)if(F.parent&&!this._isNodeInContainer(F.parent))return q.e.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;for(const F of this.cameras)if(F.parent&&!this._isNodeInContainer(F.parent))return q.e.Warn(`Node ${F.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(F){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],Q=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||z.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const C={},t={},W=new X,Z=[],q=[],G={doNotInstantiate:!0,...Q},K=[],e=new Set;for(const z of this.transformNodes)null===z.parent&&this._addNodeAndDescendantsToList(K,e,z,G.predicate);for(const z of this.meshes)null===z.parent&&this._addNodeAndDescendantsToList(K,e,z,G.predicate);const N=this._topologicalSort(K),y=(Q,z)=>{if(((b,Q)=>{if(C[b.uniqueId]=Q.uniqueId,t[Q.uniqueId]=Q,F&&(Q.name=F(b.name)),Q instanceof g.b){const F=Q;if(F.morphTargetManager){const Q=b.morphTargetManager;F.morphTargetManager=Q.clone();for(let b=0;b<Q.numTargets;b++){const z=Q.getTarget(b),g=F.morphTargetManager.getTarget(b);C[z.uniqueId]=g.uniqueId,t[g.uniqueId]=g}}}})(Q,z),Q.parent){const F=C[Q.parent.uniqueId],b=t[F];z.parent=b||Q.parent}if(z.position&&Q.position&&z.position.W(Q.position),z.rotationQuaternion&&Q.rotationQuaternion&&z.rotationQuaternion.W(Q.rotationQuaternion),z.rotation&&Q.rotation&&z.rotation.W(Q.rotation),z.wb&&Q.wb&&z.wb.W(Q.wb),z.material){const g=z;if(g.material)if(b){const b=Q.material;if(-1===q.indexOf(b)){let Q=b.clone(F?F(b.name):"Clone of "+b.name);if(q.push(b),C[b.uniqueId]=Q.uniqueId,t[Q.uniqueId]=Q,"MultiMaterial"===b.getClassName()){const z=b;for(const b of z.Vb)b&&(Q=b.clone(F?F(b.name):"Clone of "+b.name),q.push(b),C[b.uniqueId]=Q.uniqueId,t[Q.uniqueId]=Q);z.Vb=z.Vb.map((F=>F&&t[C[F.uniqueId]]))}}"InstancedMesh"!==g.getClassName()&&(g.material=t[C[b.uniqueId]])}else"MultiMaterial"===g.material.getClassName()?-1===this.ZQ.multiMaterials.indexOf(g.material)&&this.ZQ.addMultiMaterial(g.material):-1===this.ZQ.materials.indexOf(g.material)&&this.ZQ.addMaterial(g.material)}null===z.parent&&W.rootNodes.push(z)};for(const z of N)if("InstancedMesh"===z.getClassName()){const F=z,b=F.sourceMesh,Q=C[b.uniqueId];y(F,("number"===typeof Q?t[Q]:b).createInstance(F.name))}else{let F=!0;"xb"===z.getClassName()||"Node"===z.getClassName()||z.skeleton||!z.getTotalVertices||0===z.getTotalVertices()?F=!1:G.doNotInstantiate&&(F="function"===typeof G.doNotInstantiate?!G.doNotInstantiate(z):!G.doNotInstantiate);const b=F?z.createInstance(`instance of ${z.name}`):z.clone(`Clone of ${z.name}`,null,!0);if(!b)throw new Error(`Could not clone or instantiate node on Asset Container ${z.name}`);y(z,b)}for(const z of this.skeletons){if(G.predicate&&!G.predicate(z))continue;const b=z.clone(F?F(z.name):"Clone of "+z.name);for(const F of this.meshes)if(F.skeleton===z&&!F.isAnInstance){const Q=t[C[F.uniqueId]];if(!Q||Q.isAnInstance)continue;if(Q.skeleton=b,-1!==Z.indexOf(b))continue;Z.push(b);for(const F of b.bones)F._linkedTransformNode&&(F._linkedTransformNode=t[C[F._linkedTransformNode.uniqueId]])}W.skeletons.push(b)}for(const z of this.animationGroups){if(G.predicate&&!G.predicate(z))continue;const b=z.clone(F?F(z.name):"Clone of "+z.name,(F=>t[C[F.uniqueId]]||F));W.animationGroups.push(b)}return W}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||z.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ZQ.environmentTexture=this.environmentTexture);for(const F of this.ZQ._serializableComponents)F.addFromContainer(this);this.ZQ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];for(const Q of this.cameras)F&&!F(Q)||(this.ZQ.addCamera(Q),b.push(Q));for(const Q of this.lights)F&&!F(Q)||(this.ZQ.addLight(Q),b.push(Q));for(const Q of this.meshes)F&&!F(Q)||(this.ZQ.wG(Q),b.push(Q));for(const Q of this.skeletons)F&&!F(Q)||this.ZQ.addSkeleton(Q);for(const Q of this.animations)F&&!F(Q)||this.ZQ.addAnimation(Q);for(const Q of this.animationGroups)F&&!F(Q)||this.ZQ.addAnimationGroup(Q);for(const Q of this.multiMaterials)F&&!F(Q)||this.ZQ.addMultiMaterial(Q);for(const Q of this.materials)F&&!F(Q)||this.ZQ.addMaterial(Q);for(const Q of this.morphTargetManagers)F&&!F(Q)||this.ZQ.addMorphTargetManager(Q);for(const Q of this.geometries)F&&!F(Q)||this.ZQ.addGeometry(Q);for(const Q of this.transformNodes)F&&!F(Q)||(this.ZQ.addTransformNode(Q),b.push(Q));for(const Q of this.actionManagers)F&&!F(Q)||this.ZQ.addActionManager(Q);for(const Q of this.textures)F&&!F(Q)||this.ZQ.addTexture(Q);for(const Q of this.reflectionProbes)F&&!F(Q)||this.ZQ.addReflectionProbe(Q);for(const Q of b)Q.parent&&-1===this.ZQ.getNodes().indexOf(Q.parent)&&(Q.setParent?Q.setParent(null):Q.parent=null)}removeAllFromScene(){this._isValidHierarchy()||z.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ZQ.environmentTexture&&(this.ZQ.environmentTexture=null);for(const F of this.ZQ._serializableComponents)F.removeFromContainer(this)}removeFromScene(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const b of this.cameras)F&&!F(b)||this.ZQ.removeCamera(b);for(const b of this.lights)F&&!F(b)||this.ZQ.removeLight(b);for(const b of this.meshes)F&&!F(b)||this.ZQ.jG(b,!0);for(const b of this.skeletons)F&&!F(b)||this.ZQ.removeSkeleton(b);for(const b of this.animations)F&&!F(b)||this.ZQ.removeAnimation(b);for(const b of this.animationGroups)F&&!F(b)||this.ZQ.removeAnimationGroup(b);for(const b of this.multiMaterials)F&&!F(b)||this.ZQ.removeMultiMaterial(b);for(const b of this.materials)F&&!F(b)||this.ZQ.removeMaterial(b);for(const b of this.morphTargetManagers)F&&!F(b)||this.ZQ.removeMorphTargetManager(b);for(const b of this.geometries)F&&!F(b)||this.ZQ.removeGeometry(b);for(const b of this.transformNodes)F&&!F(b)||this.ZQ.removeTransformNode(b);for(const b of this.actionManagers)F&&!F(b)||this.ZQ.removeActionManager(b);for(const b of this.textures)F&&!F(b)||this.ZQ.removeTexture(b);for(const b of this.reflectionProbes)F&&!F(b)||this.ZQ.removeReflectionProbe(b)}dispose(){const F=this.cameras.slice(0);for(const N of F)N.dispose();this.cameras.length=0;const b=this.lights.slice(0);for(const N of b)N.dispose();this.lights.length=0;const Q=this.meshes.slice(0);for(const N of Q)N.dispose();this.meshes.length=0;const C=this.skeletons.slice(0);for(const N of C)N.dispose();this.skeletons.length=0;const z=this.animationGroups.slice(0);for(const N of z)N.dispose();this.animationGroups.length=0;const t=this.multiMaterials.slice(0);for(const N of t)N.dispose();this.multiMaterials.length=0;const g=this.materials.slice(0);for(const N of g)N.dispose();this.materials.length=0;const W=this.geometries.slice(0);for(const N of W)N.dispose();this.geometries.length=0;const Z=this.transformNodes.slice(0);for(const N of Z)N.dispose();this.transformNodes.length=0;const q=this.actionManagers.slice(0);for(const N of q)N.dispose();this.actionManagers.length=0;const G=this.textures.slice(0);for(const N of G)N.dispose();this.textures.length=0;const K=this.reflectionProbes.slice(0);for(const N of K)N.dispose();this.reflectionProbes.length=0;const e=this.morphTargetManagers.slice(0);for(const N of e)N.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const N of this.ZQ._serializableComponents)N.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ZQ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(F,b,Q){if(F&&b)for(const C of F){let F=!0;if(Q)for(const b of Q)if(C===b){F=!1;break}F&&(b.push(C),C._parentContainer=this)}}moveAllFromScene(F){this._wasAddedToScene=!1,void 0===F&&(F=new c);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.ZQ[b],this[b],F[b]));this.environmentTexture=this.ZQ.environmentTexture,this.removeAllFromScene()}createRootMesh(){const F=new g.b("assetContainerRootMesh",this.ZQ);for(const b of this.meshes)b.parent||F.addChild(b);return this.meshes.unshift(F),F}mergeAnimationsTo(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G.d.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!F)return q.e.Error("No scene available to merge animations to"),[];const C=Q||(b=>{let Q=null;const C=b.animations.length?b.animations[0].targetProperty:"",z=b.name.split(".").join("").split("_primitive")[0];switch(C){case"position":case"rotationQuaternion":Q=F.getTransformNodeByName(b.name)||F.getTransformNodeByName(z);break;case"influence":Q=F.getMorphTargetByName(b.name)||F.getMorphTargetByName(z);break;default:Q=F.getNodeByName(b.name)||F.getNodeByName(z)}return Q}),z=this.getNodes();for(const W of z){const F=C(W);if(null!==F){for(const b of W.animations){const Q=F.animations.filter((F=>F.targetProperty===b.targetProperty));for(const b of Q){const Q=F.animations.indexOf(b,0);Q>-1&&F.animations.splice(Q,1)}}F.animations=F.animations.concat(W.animations)}}const t=[],g=this.animationGroups.slice();for(const W of g){t.push(W.clone(W.name,C));for(const F of W.animatables)F.stop()}for(const W of b){const b=C(W.target);b&&(F.beginAnimation(b,W.fromFrame,W.toFrame,W.loopAnimation,W.speedRatio,W.onAnimationEnd?W.onAnimationEnd:void 0,void 0,!0,void 0,W.onAnimationLoop?W.onAnimationLoop:void 0),F.stopAnimation(W.target))}return t}populateRootNodes(){this.rootNodes.length=0;for(const F of this.meshes)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F);for(const F of this.transformNodes)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F);for(const F of this.lights)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F);for(const F of this.cameras)F.parent||-1!==this.rootNodes.indexOf(F)||this.rootNodes.push(F)}addAllAssetsToContainer(F){if(!F)return;const b=[],Q=new Set;for(b.push(F);b.length>0;){const F=b.pop();if(F instanceof g.b?(F.pb&&-1===this.geometries.indexOf(F.pb)&&this.geometries.push(F.pb),this.meshes.push(F)):F instanceof K.e?this.meshes.push(F):F instanceof W.d?this.transformNodes.push(F):F instanceof e.e?this.lights.push(F):F instanceof N.b&&this.cameras.push(F),F instanceof Z.d){if(F.material&&-1===this.materials.indexOf(F.material)){this.materials.push(F.material);for(const b of F.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}F.skeleton&&-1===this.skeletons.indexOf(F.skeleton)&&this.skeletons.push(F.skeleton),F.morphTargetManager&&-1===this.morphTargetManagers.indexOf(F.morphTargetManager)&&this.morphTargetManagers.push(F.morphTargetManager)}for(const C of F.getChildren())Q.has(C)||b.push(C);Q.add(F)}this.populateRootNodes()}_getByTags(F,b,Q){if(void 0===b)return F;const C=[];for(const z in F){const t=F[z];y.e&&y.e.MatchesQuery(t,b)&&(!Q||Q(t))&&C.push(t)}return C}getMeshesByTags(F,b){return this._getByTags(this.meshes,F,b)}getCamerasByTags(F,b){return this._getByTags(this.cameras,F,b)}getLightsByTags(F,b){return this._getByTags(this.lights,F,b)}getMaterialsByTags(F,b){return this._getByTags(this.materials,F,b).concat(this._getByTags(this.multiMaterials,F,b))}getTransformNodesByTags(F,b){return this._getByTags(this.transformNodes,F,b)}}var i=Q(11177);class f{constructor(F){this.byteOffset=0,this.buffer=F}async loadAsync(F){const b=await this.buffer.readAsync(this.byteOffset,F);this._dataView=new DataView(b.buffer,b.byteOffset,b.byteLength),this._dataByteOffset=0}readUint32(){const F=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,F}readUint8Array(F){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,F);return this._dataByteOffset+=F,this.byteOffset+=F,b}readString(F){return(0,i.j)(this.readUint8Array(F))}skipBytes(F){this._dataByteOffset+=F,this.byteOffset+=F}}var k=Q(12886);const m="Z2xURg",R={name:"yb",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:F=>-1!==F.indexOf("asset")&&-1!==F.indexOf("version")||F.startsWith("data:base64,"+m)||F.startsWith("data:;base64,"+m)||F.startsWith("data:application/octet-stream;base64,"+m)||F.startsWith("data:model/gltf-binary;base64,"+m)};var p,D,P,n=Q(11170),j=Q(11174);function w(F,b,Q){try{return Promise.resolve(new Uint8Array(F,b,Q))}catch(C){return Promise.reject(C)}}!function(F){F[F.AUTO=0]="AUTO",F[F.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(p||(p={})),function(F){F[F.NONE=0]="NONE",F[F.FIRST=1]="FIRST",F[F.ALL=2]="ALL"}(D||(D={})),function(F){F[F.LOADING=0]="LOADING",F[F.READY=1]="READY",F[F.COMPLETE=2]="COMPLETE"}(P||(P={}));class Y{constructor(){this.coordinateSystemMode=p.AUTO,this.animationStartMode=D.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=F=>Promise.resolve(F),this.extensionOptions={}}W(F){F&&(this.onParsed=F.onParsed,this.coordinateSystemMode=F.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=F.animationStartMode??this.animationStartMode,this.loadNodeAnimations=F.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=F.loadSkins??this.loadSkins,this.loadMorphTargets=F.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=F.compileMaterials??this.compileMaterials,this.useClipPlane=F.useClipPlane??this.useClipPlane,this.compileShadowGenerators=F.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=F.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=F.useRangeRequests??this.useRangeRequests,this.createInstances=F.createInstances??this.createInstances,this.alwaysComputeBoundingBox=F.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=F.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=F.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=F.skipMaterials??this.skipMaterials,this.useSRGBBuffers=F.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=F.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=F.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=F.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=F.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=F.customRootNode,this.onMeshLoaded=F.onMeshLoaded,this.onSkinLoaded=F.onSkinLoaded,this.onTextureLoaded=F.onTextureLoaded,this.onMaterialLoaded=F.onMaterialLoaded,this.onCameraLoaded=F.onCameraLoaded,this.extensionOptions=F.extensionOptions??this.extensionOptions)}}class s extends Y{constructor(F){super(),this.onParsedObservable=new C.c,this.onMeshLoadedObservable=new C.c,this.onSkinLoadedObservable=new C.c,this.onTextureLoadedObservable=new C.c,this.onMaterialLoadedObservable=new C.c,this.onCameraLoadedObservable=new C.c,this.onCompleteObservable=new C.c,this.onErrorObservable=new C.c,this.Kb=new C.c,this.onExtensionLoadedObservable=new C.c,this.validate=!1,this.onValidatedObservable=new C.c,this._loader=null,this._state=null,this._requests=new Array,this.name=R.name,this.extensions=R.extensions,this.onLoaderStateChangedObservable=new C.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.W(F)}set onParsed(F){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),F&&(this._onParsedObserver=this.onParsedObservable.add(F))}set onMeshLoaded(F){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),F&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(F))}set onSkinLoaded(F){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),F&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>F(b.node,b.skinnedNode))))}set onTextureLoaded(F){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),F&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(F))}set onMaterialLoaded(F){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),F&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(F))}set onCameraLoaded(F){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),F&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(F))}set onComplete(F){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(F)}set onError(F){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(F)}set onDispose(F){this._onDisposeObserver&&this.Kb.remove(this._onDisposeObserver),this._onDisposeObserver=this.Kb.add(F)}set onExtensionLoaded(F){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(F)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(F){this._loggingEnabled!==F&&(this._loggingEnabled=F,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(F){this._capturePerformanceCounters!==F&&(this._capturePerformanceCounters=F,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(F){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(F)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const F of this._requests)F.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=F=>Promise.resolve(F),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Kb.notifyObservers(void 0),this.Kb.clear()}loadFile(F,b,Q,t,g,W,Z,G){if(ArrayBuffer.isView(b))return this._loadBinary(F,b,Q,t,Z,G),null;this._progressCallback=g;const K=b.name||z.Tools.GetFilename(b);if(W){if(this.useRangeRequests){this.validate&&q.e.Warn("glTF validation is not supported when range requests are enabled");const Q={abort:()=>{},onCompleteObservable:new C.c},z={readAsync:(Q,C)=>new Promise(((z,t)=>{this._loadFile(F,b,(F=>{z(new Uint8Array(F))}),!0,(F=>{t(F)}),(F=>{F.setRequestHeader("Range",`bytes=${Q}-${Q+C-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new f(z)).then((F=>{Q.onCompleteObservable.notifyObservers(Q),t(F)}),Z?F=>Z(void 0,F):void 0),Q}return this._loadFile(F,b,(b=>{this._validate(F,new Uint8Array(b,0,b.byteLength),Q,K),this._unpackBinaryAsync(new f({readAsync:(F,Q)=>w(b,F,Q),byteLength:b.byteLength})).then((F=>{t(F)}),Z?F=>Z(void 0,F):void 0)}),!0,Z)}return this._loadFile(F,b,(b=>{try{this._validate(F,b,Q,K),t({json:this._parseJson(b)})}catch{Z&&Z()}}),!1,Z)}_loadBinary(F,b,Q,C,z,t){this._validate(F,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),Q,t),this._unpackBinaryAsync(new f({readAsync:(F,Q)=>function(F,b,Q){try{if(b<0||b>=F.byteLength)throw new RangeError("Offset is out of range.");if(b+Q>F.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(F.buffer,F.byteOffset+b,Q))}catch(C){return Promise.reject(C)}}(b,F,Q),byteLength:b.byteLength})).then((F=>{C(F)}),z?F=>z(void 0,F):void 0)}importMeshAsync(F,b,Q,C,z,t){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(Q),this.onParsedObservable.clear(),this._log(`Loading ${t||""}`),this._loader=this._getLoader(Q),this._loader.importMeshAsync(F,b,null,Q,C,z,t))))}loadAsync(F,b,Q,C,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(F,b,Q,C,z))))}loadAssetContainerAsync(F,b,Q,C,z){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(b);const t=new L(F),g=[];this.onMaterialLoadedObservable.add((F=>{g.push(F)}));const W=[];this.onTextureLoadedObservable.add((F=>{W.push(F)}));const Z=[];this.onCameraLoadedObservable.add((F=>{Z.push(F)}));const q=[];return this.onMeshLoadedObservable.add((F=>{F.morphTargetManager&&q.push(F.morphTargetManager)})),this._loader.importMeshAsync(null,F,t,b,Q,C,z).then((F=>(Array.prototype.push.apply(t.geometries,F.geometries),Array.prototype.push.apply(t.meshes,F.meshes),Array.prototype.push.apply(t.Te,F.Te),Array.prototype.push.apply(t.skeletons,F.skeletons),Array.prototype.push.apply(t.animationGroups,F.animationGroups),Array.prototype.push.apply(t.materials,g),Array.prototype.push.apply(t.textures,W),Array.prototype.push.apply(t.lights,F.lights),Array.prototype.push.apply(t.transformNodes,F.transformNodes),Array.prototype.push.apply(t.cameras,Z),Array.prototype.push.apply(t.morphTargetManagers,q),t)))}))}canDirectLoad(F){return R.canDirectLoad(F)}directLoad(F,b){if(b.startsWith("base64,"+m)||b.startsWith(";base64,"+m)||b.startsWith("application/octet-stream;base64,"+m)||b.startsWith("model/gltf-binary;base64,"+m)){const Q=(0,n.d)(b);return this._validate(F,new Uint8Array(Q,0,Q.byteLength)),this._unpackBinaryAsync(new f({readAsync:(F,b)=>w(Q,F,b),byteLength:Q.byteLength}))}return this._validate(F,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(F){return new s(F[R.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((F,b)=>{this.onCompleteObservable.addOnce((()=>{F()})),this.onErrorObservable.addOnce((F=>{b(F)}))}))}_setState(F){this._state!==F&&(this._state=F,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(P[this._state]))}_loadFile(F,b,Q,C,z,t){const g=F._loadFile(b,Q,(F=>{this._onProgress(F,g)}),!0,C,z,t);return g.onCompleteObservable.add((()=>{g._lengthComputable=!0,g._total=g._loaded})),this._requests.push(g),g}_onProgress(F,b){if(!this._progressCallback)return;b._lengthComputable=F.lengthComputable,b._loaded=F.loaded,b._total=F.total;let Q=!0,C=0,z=0;for(const t of this._requests){if(void 0===t._lengthComputable||void 0===t._loaded||void 0===t._total)return;Q=Q&&t._lengthComputable,C+=t._loaded,z+=t._total}this._progressCallback({lengthComputable:Q,loaded:C,total:Q?z:0})}_validate(F,b){let Q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),k.d.ValidateAsync(b,Q,C,(b=>this.preprocessUrlAsync(Q+b).then((b=>F._loadFileAsync(b,void 0,!0,!0).then((F=>new Uint8Array(F,0,F.byteLength))))))).then((F=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(F),this.onValidatedObservable.clear()}),(F=>{this._endPerformanceCounter("Validate JSON"),z.Tools.Warn(`Failed to validate: ${F.message}`),this.onValidatedObservable.clear()})))}_getLoader(F){const b=F.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const Q=s._parseVersion(b.version);if(!Q)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const F=s._parseVersion(b.minVersion);if(!F)throw new Error("Invalid minimum version: "+b.minVersion);if(s._compareVersion(F,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const C={1:s._CreateGLTF1Loader,2:s._CreateGLTF2Loader}[Q.major];if(!C)throw new Error("Unsupported version: "+b.version);return C(this)}_parseJson(F){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${F.length}`);const b=JSON.parse(F);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(F){return this._startPerformanceCounter("Unpack Binary"),F.loadAsync(20).then((()=>{const b=F.readUint32();if(1179937895!==b)throw new j.l("Unexpected magic: "+b,j.h.GLTFLoaderUnexpectedMagicError);const Q=F.readUint32();this.loggingEnabled&&this._log(`Binary version: ${Q}`);const C=F.readUint32();let z;switch(this.useRangeRequests||C===F.buffer.byteLength||q.e.Warn(`Length in header does not match actual data length: ${C} != ${F.buffer.byteLength}`),Q){case 1:z=this._unpackBinaryV1Async(F,C);break;case 2:z=this._unpackBinaryV2Async(F,C);break;default:throw new Error("Unsupported version: "+Q)}return this._endPerformanceCounter("Unpack Binary"),z}))}_unpackBinaryV1Async(F,b){const Q=F.readUint32(),C=F.readUint32();if(0!==C)throw new Error(`Unexpected content format: ${C}`);const z=b-F.byteOffset,t={json:this._parseJson(F.readString(Q)),bin:null};if(0!==z){const b=F.byteOffset;t.bin={readAsync:(Q,C)=>F.buffer.readAsync(b+Q,C),byteLength:z}}return Promise.resolve(t)}_unpackBinaryV2Async(F,b){const Q=1313821514,C=5130562,z=F.readUint32();if(F.readUint32()!==Q)throw new Error("First chunk format is not JSON");return F.byteOffset+z===b?F.loadAsync(z).then((()=>({json:this._parseJson(F.readString(z)),bin:null}))):F.loadAsync(z+8).then((()=>{const t={json:this._parseJson(F.readString(z)),bin:null},g=()=>{const z=F.readUint32();switch(F.readUint32()){case Q:throw new Error("Unexpected JSON chunk");case C:{const b=F.byteOffset;t.bin={readAsync:(Q,C)=>F.buffer.readAsync(b+Q,C),byteLength:z},F.skipBytes(z);break}default:F.skipBytes(z)}return F.byteOffset!==b?F.loadAsync(8).then(g):Promise.resolve(t)};return g()}))}static _parseVersion(F){if("1.0"===F||"1.0.1"===F)return{major:1,minor:0};const b=(F+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(F,b){return F.major>b.major?1:F.major<b.major?-1:F.minor>b.minor?1:F.minor<b.minor?-1:0}_logOpen(F){this._log(F),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(F){const b=s._logSpaces.substring(0,2*this._logIndentLevel);q.e.Log(`${b}${F}`)}_logDisabled(F){}_startPerformanceCounterEnabled(F){z.Tools.StartPerformanceCounter(F)}_startPerformanceCounterDisabled(F){}_endPerformanceCounterEnabled(F){z.Tools.EndPerformanceCounter(F)}_endPerformanceCounterDisabled(F){}}s.IncrementalLoading=!0,s.HomogeneousCoordinates=!1,s._logSpaces="                                ",(0,t.d)(new s)},12886:(F,b,Q)=>{"use strict";Q.d(b,{d:()=>g});var C=Q(11128);function z(F,b,Q,C){const z={externalResourceFunction:C};return Q&&(z.uri="file:"===b?Q:b+Q),ArrayBuffer.isView(F)?GLTFValidator.validateBytes(F,z):GLTFValidator.validateString(F,z)}function t(){const F=[];onmessage=b=>{const Q=b.data;switch(Q.id){case"init":importScripts(Q.url);break;case"validate":z(Q.data,Q.rootUrl,Q.fileName,(b=>new Promise(((Q,C)=>{const z=F.length;F.push({resolve:Q,reject:C}),postMessage({id:"getExternalResource",index:z,uri:b})})))).then((F=>{postMessage({id:"validate.resolve",value:F})}),(F=>{postMessage({id:"validate.reject",reason:F})}));break;case"getExternalResource.resolve":F[Q.index].resolve(Q.value);break;case"getExternalResource.reject":F[Q.index].reject(Q.reason)}}}class g{static ValidateAsync(F,b,Q,g){return"function"===typeof Worker?new Promise(((W,Z)=>{const q=`${z}(${t})()`,G=URL.createObjectURL(new Blob([q],{type:"application/javascript"})),K=new Worker(G),e=F=>{K.removeEventListener("error",e),K.removeEventListener("message",N),Z(F)},N=F=>{const b=F.data;switch(b.id){case"getExternalResource":g(b.uri).then((F=>{K.postMessage({id:"getExternalResource.resolve",index:b.index,value:F},[F.buffer])}),(F=>{K.postMessage({id:"getExternalResource.reject",index:b.index,reason:F})}));break;case"validate.resolve":K.removeEventListener("error",e),K.removeEventListener("message",N),W(b.value),K.terminate();break;case"validate.reject":K.removeEventListener("error",e),K.removeEventListener("message",N),Z(b.reason),K.terminate()}};if(K.addEventListener("error",e),K.addEventListener("message",N),K.postMessage({id:"init",url:C.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(F)){const C=F.slice();K.postMessage({id:"validate",data:C,rootUrl:b,fileName:Q},[C.buffer])}else K.postMessage({id:"validate",data:F,rootUrl:b,fileName:Q})})):(this._LoadScriptPromise||(this._LoadScriptPromise=C.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>z(F,b,Q,g))))}}g.Configuration={url:`${C.Tools._DefaultCdnUrl}/gltf_validator.js`}},13427:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>R});var C=Q(11293),z=Q(11296),t=Q(11349),g=Q(11309),W=Q(11673),Z=Q(11602),q=Q(11372),G=Q(11537),K=Q(11265),e=Q(11219);Q(12672),Q(12565),Q(12584),Q(12573),Q(12586),Q(12595),Q(12602);const N="imageProcessingCompatibility",y="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";e.e.IncludesShadersStore[N]||(e.e.IncludesShadersStore[N]=y);const E="skyPixelShader",c="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";e.e.ShadersStore[E]||(e.e.ShadersStore[E]=c);Q(12682),Q(12609),Q(12617),Q(12631),Q(12622);const X="skyVertexShader",L="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";e.e.ShadersStore[X]||(e.e.ShadersStore[X]=L);var i=Q(11600),f=Q(11655),k=Q(11650);class m extends W.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class R extends Z.c{constructor(F,b){super(F,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new g.gQ(0,100,0),this.useSunPosition=!1,this.cameraOffset=g.gQ.Zero(),this.up=g.gQ.Up(),this.dithering=!1,this._cameraPosition=g.gQ.Zero(),this._skyOrientation=new g.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(F,b){const Q=b._drawWrapper;if(this.isFrozen&&Q.effect&&Q._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new m);const C=b.materialDefines,z=this.RF();if(this._isReadyForSubMesh(b))return!0;if((0,k.U)(F,z,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,C),(0,k.L)(F,C,!0,!1),C.IMAGEPROCESSINGPOSTPROCESS!==z.imageProcessingConfiguration.applyByPostProcess&&C.markAsMiscDirty(),C.DITHER!==this.dithering&&C.markAsMiscDirty(),C.isDirty){C.markAsProcessed(),z.resetCachedMaterial();const F=new i.c;C.FOG&&F.addFallback(1,"FOG"),C.IMAGEPROCESSINGPOSTPROCESS=z.imageProcessingConfiguration.applyByPostProcess,C.DITHER=this.dithering;const Q=[q.e.PositionKind];C.VERTEXCOLOR&&Q.push(q.e.ColorKind);const t="sky",g=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,f.b)(g);const W=C.toString();b.setEffect(z.getEngine().createEffect(t,Q,g,[],W,F,this.onCompiled,this.onError),C,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(C._renderId=z.getRenderId(),Q._wasPreviouslyReady=!0,!0)}bindForSubMesh(F,b,Q){const C=this.RF(),z=Q.materialDefines;if(!z)return;const t=Q.effect;if(!t)return;this._activeEffect=t,this.bindOnlyWorldMatrix(F),this._activeEffect.setMatrix("viewProjection",C.getTransformMatrix()),this._mustRebind(C,t,Q)&&((0,f.e)(t,this,C),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,k.k)(z,t,C)),C.fogEnabled&&b.applyFog&&C.fogMode!==G.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",C.getViewMatrix()),(0,k.h)(C,b,this._activeEffect);const W=C.activeCamera;if(W){const F=W.getWorldMatrix();this._cameraPosition.x=F.m[12],this._cameraPosition.y=F.m[13],this._cameraPosition.z=F.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const F=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(F),this.sunPosition.y=this.distance*Math.sin(-F),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(F),g.Quaternion.FromUnitVectorsToRef(g.gQ.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,Q)}getAnimatables(){return[]}dispose(F){super.dispose(F)}clone(F){return t.e.Clone((()=>new R(F,this.RF())),this)}serialize(){const F=super.serialize();return F.customType="BABYLON.SkyMaterial",F}getClassName(){return"SkyMaterial"}static Parse(F,b,Q){return t.e.Parse((()=>new R(F.name,b)),F,b,Q)}}(0,C.b)([(0,z.A)()],R.prototype,"luminance",void 0),(0,C.b)([(0,z.A)()],R.prototype,"turbidity",void 0),(0,C.b)([(0,z.A)()],R.prototype,"rayleigh",void 0),(0,C.b)([(0,z.A)()],R.prototype,"mieCoefficient",void 0),(0,C.b)([(0,z.A)()],R.prototype,"mieDirectionalG",void 0),(0,C.b)([(0,z.A)()],R.prototype,"distance",void 0),(0,C.b)([(0,z.A)()],R.prototype,"inclination",void 0),(0,C.b)([(0,z.A)()],R.prototype,"azimuth",void 0),(0,C.b)([(0,z.y)()],R.prototype,"sunPosition",void 0),(0,C.b)([(0,z.A)()],R.prototype,"useSunPosition",void 0),(0,C.b)([(0,z.y)()],R.prototype,"cameraOffset",void 0),(0,C.b)([(0,z.y)()],R.prototype,"up",void 0),(0,C.b)([(0,z.A)()],R.prototype,"dithering",void 0),(0,K.g)("BABYLON.SkyMaterial",R)},11969:(F,b,Q)=>{"use strict";function C(F,b){b.headers=F.headers||{},b.statusMessage=F.statusText,b.statusCode=F.status,b.data=F.response}function z(F,b,Q){return new Promise((function(z,t){Q=Q||{};var g,W,Z,q=new XMLHttpRequest,G=Q.body,K=Q.headers||{};for(g in Q.timeout&&(q.timeout=Q.timeout),q.ontimeout=q.onerror=function(F){F.timeout="timeout"==F.type,t(F)},q.open(F,b.href||b),q.onload=function(){for(Z=q.getAllResponseHeaders().trim().split(/[\r\n]+/),C(q,q);W=Z.shift();)W=W.split(": "),q.headers[W.shift().toLowerCase()]=W.join(": ");if((W=q.headers["content-type"])&&~W.indexOf("application/json"))try{q.data=JSON.parse(q.data,Q.reviver)}catch(F){return C(q,F),t(F)}(q.status>=400?t:z)(q)},typeof FormData<"u"&&G instanceof FormData||G&&"object"==typeof G&&(K["content-type"]="application/json",G=JSON.stringify(G)),q.withCredentials=!!Q.withCredentials,K)q.setRequestHeader(g,K[g]);q.send(G)}))}Q.r(b),Q.d(b,{del:()=>Z,get:()=>t,patch:()=>W,post:()=>g,put:()=>q,send:()=>z});var t=z.bind(z,"GET"),g=z.bind(z,"POST"),W=z.bind(z,"PATCH"),Z=z.bind(z,"DELETE"),q=z.bind(z,"PUT")},13548:(F,b,Q)=>{"use strict";Q.d(b,{b:()=>K});const C=.5*(Math.sqrt(3)-1),z=(3-Math.sqrt(3))/6,t=1/3,g=1/6,W=(Math.sqrt(5)-1)/4,Z=(5-Math.sqrt(5))/20,q=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),G=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const K=class{constructor(){let F=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof F?F:function(F){let b=0,Q=0,C=0,z=1;const t=function(){let F=4022871197;return function(b){b=b.toString();for(let Q=0;Q<b.length;Q++){F+=b.charCodeAt(Q);let C=.02519603282416938*F;F=C>>>0,C-=F,C*=F,F=C>>>0,C-=F,F+=4294967296*C}return 2.3283064365386963e-10*(F>>>0)}}();b=t(" "),Q=t(" "),C=t(" "),b-=t(F),b<0&&(b+=1);Q-=t(F),Q<0&&(Q+=1);C-=t(F),C<0&&(C+=1);return function(){const F=2091639*b+2.3283064365386963e-10*z;return b=Q,Q=C,C=F-(z=0|F)}}(F);this.p=function(F){const b=new Uint8Array(256);for(let Q=0;Q<256;Q++)b[Q]=Q;for(let Q=0;Q<255;Q++){const C=Q+~~(F()*(256-Q)),z=b[Q];b[Q]=b[C],b[C]=z}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let Q=0;Q<512;Q++)this.perm[Q]=this.p[255&Q],this.permMod12[Q]=this.perm[Q]%12}noise2D(F,b){const Q=this.permMod12,t=this.perm;let g=0,W=0,Z=0;const G=(F+b)*C,K=Math.floor(F+G),e=Math.floor(b+G),N=(K+e)*z,y=F-(K-N),E=b-(e-N);let c,X;y>E?(c=1,X=0):(c=0,X=1);const L=y-c+z,i=E-X+z,f=y-1+2*z,k=E-1+2*z,m=255&K,R=255&e;let p=.5-y*y-E*E;if(p>=0){const F=3*Q[m+t[R]];p*=p,g=p*p*(q[F]*y+q[F+1]*E)}let D=.5-L*L-i*i;if(D>=0){const F=3*Q[m+c+t[R+X]];D*=D,W=D*D*(q[F]*L+q[F+1]*i)}let P=.5-f*f-k*k;if(P>=0){const F=3*Q[m+1+t[R+1]];P*=P,Z=P*P*(q[F]*f+q[F+1]*k)}return 70*(g+W+Z)}noise3D(F,b,Q){const C=this.permMod12,z=this.perm;let W,Z,G,K;const e=(F+b+Q)*t,N=Math.floor(F+e),y=Math.floor(b+e),E=Math.floor(Q+e),c=(N+y+E)*g,X=F-(N-c),L=b-(y-c),i=Q-(E-c);let f,k,m,R,p,D;X>=L?L>=i?(f=1,k=0,m=0,R=1,p=1,D=0):X>=i?(f=1,k=0,m=0,R=1,p=0,D=1):(f=0,k=0,m=1,R=1,p=0,D=1):L<i?(f=0,k=0,m=1,R=0,p=1,D=1):X<i?(f=0,k=1,m=0,R=0,p=1,D=1):(f=0,k=1,m=0,R=1,p=1,D=0);const P=X-f+g,n=L-k+g,j=i-m+g,w=X-R+2*g,Y=L-p+2*g,s=i-D+2*g,V=X-1+.5,h=L-1+.5,l=i-1+.5,T=255&N,o=255&y,S=255&E;let O=.6-X*X-L*L-i*i;if(O<0)W=0;else{const F=3*C[T+z[o+z[S]]];O*=O,W=O*O*(q[F]*X+q[F+1]*L+q[F+2]*i)}let x=.6-P*P-n*n-j*j;if(x<0)Z=0;else{const F=3*C[T+f+z[o+k+z[S+m]]];x*=x,Z=x*x*(q[F]*P+q[F+1]*n+q[F+2]*j)}let a=.6-w*w-Y*Y-s*s;if(a<0)G=0;else{const F=3*C[T+R+z[o+p+z[S+D]]];a*=a,G=a*a*(q[F]*w+q[F+1]*Y+q[F+2]*s)}let A=.6-V*V-h*h-l*l;if(A<0)K=0;else{const F=3*C[T+1+z[o+1+z[S+1]]];A*=A,K=A*A*(q[F]*V+q[F+1]*h+q[F+2]*l)}return 32*(W+Z+G+K)}noise4D(F,b,Q,C){const z=this.perm;let t,g,q,K,e;const N=(F+b+Q+C)*W,y=Math.floor(F+N),E=Math.floor(b+N),c=Math.floor(Q+N),X=Math.floor(C+N),L=(y+E+c+X)*Z,i=F-(y-L),f=b-(E-L),k=Q-(c-L),m=C-(X-L);let R=0,p=0,D=0,P=0;i>f?R++:p++,i>k?R++:D++,i>m?R++:P++,f>k?p++:D++,f>m?p++:P++,k>m?D++:P++;const n=R>=3?1:0,j=p>=3?1:0,w=D>=3?1:0,Y=P>=3?1:0,s=R>=2?1:0,V=p>=2?1:0,h=D>=2?1:0,l=P>=2?1:0,T=R>=1?1:0,o=p>=1?1:0,S=D>=1?1:0,O=P>=1?1:0,x=i-n+Z,a=f-j+Z,A=k-w+Z,U=m-Y+Z,u=i-s+2*Z,v=f-V+2*Z,J=k-h+2*Z,I=m-l+2*Z,M=i-T+3*Z,r=f-o+3*Z,H=k-S+3*Z,B=m-O+3*Z,d=i-1+4*Z,FF=f-1+4*Z,bF=k-1+4*Z,QF=m-1+4*Z,CF=255&y,zF=255&E,tF=255&c,gF=255&X;let WF=.6-i*i-f*f-k*k-m*m;if(WF<0)t=0;else{const F=z[CF+z[zF+z[tF+z[gF]]]]%32*4;WF*=WF,t=WF*WF*(G[F]*i+G[F+1]*f+G[F+2]*k+G[F+3]*m)}let ZF=.6-x*x-a*a-A*A-U*U;if(ZF<0)g=0;else{const F=z[CF+n+z[zF+j+z[tF+w+z[gF+Y]]]]%32*4;ZF*=ZF,g=ZF*ZF*(G[F]*x+G[F+1]*a+G[F+2]*A+G[F+3]*U)}let qF=.6-u*u-v*v-J*J-I*I;if(qF<0)q=0;else{const F=z[CF+s+z[zF+V+z[tF+h+z[gF+l]]]]%32*4;qF*=qF,q=qF*qF*(G[F]*u+G[F+1]*v+G[F+2]*J+G[F+3]*I)}let GF=.6-M*M-r*r-H*H-B*B;if(GF<0)K=0;else{const F=z[CF+T+z[zF+o+z[tF+S+z[gF+O]]]]%32*4;GF*=GF,K=GF*GF*(G[F]*M+G[F+1]*r+G[F+2]*H+G[F+3]*B)}let KF=.6-d*d-FF*FF-bF*bF-QF*QF;if(KF<0)e=0;else{const F=z[CF+1+z[zF+1+z[tF+1+z[gF+1]]]]%32*4;KF*=KF,e=KF*KF*(G[F]*d+G[F+1]*FF+G[F+2]*bF+G[F+3]*QF)}return 27*(t+g+q+K+e)}}}}]);