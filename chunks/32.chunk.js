/*! For license information please see o3k28v.32.68e0e411.chunk.js.LICENSE.txt */
(self.ynu1yiqvs98=self.ynu1yiqvs98||[]).push([[32],{13095:(I,E,j)=>{"use strict";var e=j(13101),w=j(13103),z=j(13106);j.g.__TYPEDARRAY_POOL||(j.g.__TYPEDARRAY_POOL={UINT8:w([32,0]),UINT16:w([32,0]),UINT32:w([32,0]),INT8:w([32,0]),INT16:w([32,0]),INT32:w([32,0]),FLOAT:w([32,0]),DOUBLE:w([32,0]),DATA:w([32,0]),UINT8C:w([32,0]),BUFFER:w([32,0])});var h="undefined"!==typeof Uint8ClampedArray,t=j.g.__TYPEDARRAY_POOL;t.UINT8C||(t.UINT8C=w([32,0])),t.BUFFER||(t.BUFFER=w([32,0]));var U=t.DATA,R=t.BUFFER;function P(I){if(I){var E=I.length||I.byteLength,j=e.log2(E);U[j].push(I)}}function o(I){I=e.nextPow2(I);var E=e.log2(I),j=U[E];return j.length>0?j.pop():new ArrayBuffer(I)}function Z(I){return new Uint8Array(o(I),0,I)}function c(I){return new Uint16Array(o(2*I),0,I)}function K(I){return new Uint32Array(o(4*I),0,I)}function L(I){return new Int8Array(o(I),0,I)}function F(I){return new Int16Array(o(2*I),0,I)}function C(I){return new Int32Array(o(4*I),0,I)}function X(I){return new Float32Array(o(4*I),0,I)}function q(I){return new Float64Array(o(8*I),0,I)}function x(I){return h?new Uint8ClampedArray(o(I),0,I):Z(I)}function u(I){return new DataView(o(I),0,I)}E.free=function(I){if(z(I))R[e.log2(I.length)].push(I);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(I)&&(I=I.buffer),!I)return;var E=I.length||I.byteLength,j=0|e.log2(E);U[j].push(I)}},E.freeUint8=E.freeUint16=E.freeUint32=E.freeInt8=E.freeInt16=E.freeInt32=E.freeFloat32=E.freeFloat=E.freeFloat64=E.freeDouble=E.freeUint8Clamped=E.freeDataView=function(I){P(I.buffer)},E.freeArrayBuffer=P,E.freeBuffer=function(I){R[e.log2(I.length)].push(I)},E.malloc=function(I,E){if(void 0===E||"arraybuffer"===E)return o(I);switch(E){case"uint8":return Z(I);case"uint16":return c(I);case"uint32":return K(I);case"int8":return L(I);case"int16":return F(I);case"int32":return C(I);case"float":case"float32":return X(I);case"double":case"float64":return q(I);case"uint8_clamped":return x(I);case"buffer":throw"Buffer not supported";case"data":case"dataview":return u(I);default:return null}return null},E.mallocArrayBuffer=o,E.mallocUint8=Z,E.mallocUint16=c,E.mallocUint32=K,E.mallocInt8=L,E.mallocInt16=F,E.mallocInt32=C,E.mallocFloat32=E.mallocFloat=X,E.mallocFloat64=E.mallocDouble=q,E.mallocUint8Clamped=x,E.mallocDataView=u,E.clearCache=function(){for(var I=0;I<32;++I)t.UINT8[I].length=0,t.UINT16[I].length=0,t.UINT32[I].length=0,t.INT8[I].length=0,t.INT16[I].length=0,t.INT32[I].length=0,t.FLOAT[I].length=0,t.DOUBLE[I].length=0,t.UINT8C[I].length=0,U[I].length=0,R[I].length=0}},13195:(I,E,j)=>{I.exports=w;var e=j(11920);function w(I,E){if(!(this instanceof w))return new w(I,E);var j=e.create();e.add(j,I,E),this.base=e.min(e.create(),I,j),this.zP=e.clone(E),this.max=e.max(e.create(),I,j),this.mag=e.length(this.zP)}var z=w.prototype;z.width=function(){return this.zP[0]},z.height=function(){return this.zP[1]},z.depth=function(){return this.zP[2]},z.x0=function(){return this.base[0]},z.y0=function(){return this.base[1]},z.z0=function(){return this.base[2]},z.x1=function(){return this.max[0]},z.y1=function(){return this.max[1]},z.z1=function(){return this.max[2]},z.translate=function(I){return e.add(this.max,this.max,I),e.add(this.base,this.base,I),this},z.setPosition=function(I){return e.add(this.max,I,this.zP),e.k(this.base,I),this},z.expand=function(I){var E=e.create(),j=e.create();return e.max(E,I.max,this.max),e.min(j,I.base,this.base),e.FE(E,E,j),new w(j,E)},z.intersects=function(I){return!(I.base[0]>this.max[0])&&(!(I.base[1]>this.max[1])&&(!(I.base[2]>this.max[2])&&(!(I.max[0]<this.base[0])&&(!(I.max[1]<this.base[1])&&!(I.max[2]<this.base[2])))))},z.touches=function(I){var E=this.union(I);return null!==E&&(0==E.width()||0==E.height()||0==E.depth())},z.union=function(I){if(!this.intersects(I))return null;var E=Math.max(I.base[0],this.base[0]),j=Math.max(I.base[1],this.base[1]),e=Math.max(I.base[2],this.base[2]);return new w([E,j,e],[Math.min(I.max[0],this.max[0])-E,Math.min(I.max[1],this.max[1])-j,Math.min(I.max[2],this.max[2])-e])}},13101:(I,E)=>{"use strict";function j(I){var E=32;return(I&=-I)&&E--,65535&I&&(E-=16),16711935&I&&(E-=8),252645135&I&&(E-=4),858993459&I&&(E-=2),1431655765&I&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(I){return(I>0)-(I<0)},E.abs=function(I){var E=I>>31;return(I^E)-E},E.min=function(I,E){return E^(I^E)&-(I<E)},E.max=function(I,E){return I^(I^E)&-(I<E)},E.isPow2=function(I){return!(I&I-1)&&!!I},E.log2=function(I){var E,j;return E=(I>65535)<<4,E|=j=((I>>>=E)>255)<<3,E|=j=((I>>>=j)>15)<<2,(E|=j=((I>>>=j)>3)<<1)|(I>>>=j)>>1},E.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},E.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},E.countTrailingZeros=j,E.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},E.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},E.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var e=new Array(256);!function(I){for(var E=0;E<256;++E){var j=E,e=E,w=7;for(j>>>=1;j;j>>>=1)e<<=1,e|=1&j,--w;I[E]=e<<w&255}}(e),E.reverse=function(I){return e[255&I]<<24|e[I>>>8&255]<<16|e[I>>>16&255]<<8|e[I>>>24&255]},E.interleave2=function(I,E){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(I,E){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>E&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},E.interleave3=function(I,E,j){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},E.deinterleave3=function(I,E){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>E&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},E.nextCombination=function(I){var E=I|I-1;return E+1|(~E&-~E)-1>>>j(I)+1}},13086:(I,E,j)=>{"use strict";I.exports=function(I,E,j){switch(arguments.length){case 1:return e=[],R(w=I,w,P,!0),e;case 2:return"function"===typeof E?R(I,I,E,!0):function(I,E){return e=[],R(I,E,P,!1),e}(I,E);case 3:return R(I,E,j,!1);default:throw new Error("box-intersect: Invalid arguments")}var w};var e,w=j(13095),z=j(13114),h=j(13132);function t(I,E){for(var j=0;j<I;++j)if(!(E[j]<=E[j+I]))return!0;return!1}function U(I,E,j,e){for(var w=0,z=0,h=0,U=I.length;h<U;++h){var R=I[h];if(!t(E,R)){for(var P=0;P<2*E;++P)j[w++]=R[P];e[z++]=h}}return z}function R(I,E,j,e){var t=I.length,R=E.length;if(!(t<=0||R<=0)){var P=I[0].length>>>1;if(!(P<=0)){var o,Z=w.mallocDouble(2*P*t),c=w.mallocInt32(t);if((t=U(I,P,Z,c))>0){if(1===P&&e)z.init(t),o=z.sweepComplete(P,j,0,t,Z,c,0,t,Z,c);else{var K=w.mallocDouble(2*P*R),L=w.mallocInt32(R);(R=U(E,P,K,L))>0&&(z.init(t+R),o=1===P?z.sweepBipartite(P,j,0,t,Z,c,0,R,K,L):h(P,j,e,t,Z,c,R,K,L),w.free(K),w.free(L))}w.free(Z),w.free(c)}return o}}}function P(I,E){e.push([I,E])}},13141:(I,E)=>{"use strict";var j="d",e="ax",w="fp",z="es",h="rs",t="re",U="rb",R="bs",P="be",o="bb",Z=[j,e,"vv",h,t,U,"ri",R,P,o,"bi"];function c(I){var E="bruteForce"+(I?"Full":"Partial"),e=[],h=Z.slice();I||h.splice(3,0,w);var t=["function "+E+"("+h.join()+"){"];function U(E,w){var h=function(I,E,e){var w="bruteForce"+(I?"Red":"Blue")+(E?"Flip":"")+(e?"Full":""),h=["function ",w,"(",Z.join(),"){","var ",z,"=2*",j,";"],t="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",U="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(e?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return I?h.push(t,"Q",":",U):h.push(U,"Q",":",t),e?h.push("if(y1<x0||x1<y0)continue;"):E?h.push("if(y0<=x0||x1<y0)continue;"):h.push("if(y0<x0||x1<y0)continue;"),h.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),E?h.push("yi,xi"):h.push("xi,yi"),h.push(");if(rv!==void 0)return rv;}}}"),{name:w,code:h.join("")}}(E,w,I);e.push(h.code),t.push("return "+h.name+"("+Z.join()+");")}t.push("if(re-rs>be-bs){"),I?(U(!0,!1),t.push("}else{"),U(!1,!1)):(t.push("if(fp){"),U(!0,!0),t.push("}else{"),U(!0,!1),t.push("}}else{if(fp){"),U(!1,!0),t.push("}else{"),U(!1,!1),t.push("}")),t.push("}}return "+E);var R=e.join("")+t.join("");return new Function(R)()}E.partial=c(!1),E.full=c(!0)},13132:(I,E,j)=>{"use strict";I.exports=function(I,E,j,z,P,a,l,i,r){!function(I,E){var j=8*w.log2(E+1)*(I+1)|0,z=w.nextPow2(x*j);b.length<z&&(e.free(b),b=e.mallocInt32(z));var h=w.nextPow2(u*j);Q.length<h&&(e.free(Q),Q=e.mallocDouble(h))}(I,z+l);var n,H=0,g=2*I;G(H++,0,0,z,0,l,j?16:0,-1/0,1/0),j||G(H++,0,0,l,0,z,1,-1/0,1/0);for(;H>0;){var Y=(H-=1)*x,A=b[Y],T=b[Y+1],M=b[Y+2],W=b[Y+3],O=b[Y+4],s=b[Y+5],v=H*u,V=Q[v],f=Q[v+1],S=1&s,B=!!(16&s),p=P,D=a,k=i,J=r;if(S&&(p=i,D=r,k=P,J=a),!(2&s&&T>=(M=F(I,A,T,M,p,D,f)))&&!(4&s&&(T=C(I,A,T,M,p,D,V))>=M)){var N=M-T,m=O-W;if(B){if(I*N*(N+m)<c){if(void 0!==(n=U.scanComplete(I,A,E,T,M,p,D,W,O,k,J)))return n;continue}}else{if(I*Math.min(N,m)<o){if(void 0!==(n=h(I,A,E,S,T,M,p,D,W,O,k,J)))return n;continue}if(I*N*m<Z){if(void 0!==(n=U.scanBipartite(I,A,E,S,T,M,p,D,W,O,k,J)))return n;continue}}var II=K(I,A,T,M,p,D,V,f);if(T<II)if(I*(II-T)<o){if(void 0!==(n=t(I,A+1,E,T,II,p,D,W,O,k,J)))return n}else if(A===I-2){if(void 0!==(n=S?U.sweepBipartite(I,E,W,O,k,J,T,II,p,D):U.sweepBipartite(I,E,T,II,p,D,W,O,k,J)))return n}else G(H++,A+1,T,II,W,O,S,-1/0,1/0),G(H++,A+1,W,O,T,II,1^S,-1/0,1/0);if(II<M){var EI=R(I,A,W,O,k,J),jI=k[g*EI+A],eI=L(I,A,EI,O,k,J,jI);if(eI<O&&G(H++,A,II,M,eI,O,(4|S)+(B?16:0),jI,f),W<EI&&G(H++,A,II,M,W,EI,(2|S)+(B?16:0),V,jI),EI+1===eI){if(void 0!==(n=B?d(I,A,E,II,M,p,D,EI,k,J[EI]):y(I,A,E,S,II,M,p,D,EI,k,J[EI])))return n}else if(EI<eI){var wI;if(B){if(II<(wI=X(I,A,II,M,p,D,jI))){var zI=L(I,A,II,wI,p,D,jI);if(A===I-2){if(II<zI&&void 0!==(n=U.sweepComplete(I,E,II,zI,p,D,EI,eI,k,J)))return n;if(zI<wI&&void 0!==(n=U.sweepBipartite(I,E,zI,wI,p,D,EI,eI,k,J)))return n}else II<zI&&G(H++,A+1,II,zI,EI,eI,16,-1/0,1/0),zI<wI&&(G(H++,A+1,zI,wI,EI,eI,0,-1/0,1/0),G(H++,A+1,EI,eI,zI,wI,1,-1/0,1/0))}}else II<(wI=S?q(I,A,II,M,p,D,jI):X(I,A,II,M,p,D,jI))&&(A===I-2?n=S?U.sweepBipartite(I,E,EI,eI,k,J,II,wI,p,D):U.sweepBipartite(I,E,II,wI,p,D,EI,eI,k,J):(G(H++,A+1,II,wI,EI,eI,S,-1/0,1/0),G(H++,A+1,EI,eI,II,wI,1^S,-1/0,1/0)))}}}}};var e=j(13095),w=j(13101),z=j(13141),h=z.partial,t=z.full,U=j(13114),R=j(13149),P=j(13156),o=128,Z=1<<22,c=1<<22,K=P("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),L=P("lo===p0",["p0"]),F=P("lo<p0",["p0"]),C=P("hi<=p0",["p0"]),X=P("lo<=p0&&p0<=hi",["p0"]),q=P("lo<p0&&p0<=hi",["p0"]),x=6,u=2,b=e.mallocInt32(1024),Q=e.mallocDouble(1024);function G(I,E,j,e,w,z,h,t,U){var R=x*I;b[R]=E,b[R+1]=j,b[R+2]=e,b[R+3]=w,b[R+4]=z,b[R+5]=h;var P=u*I;Q[P]=t,Q[P+1]=U}function y(I,E,j,e,w,z,h,t,U,R,P){var o=2*I,Z=U*o,c=R[Z+E];I:for(var K=w,L=w*o;K<z;++K,L+=o){var F=h[L+E],C=h[L+E+I];if(!(c<F||C<c)&&(!e||c!==F)){for(var X,q=t[K],x=E+1;x<I;++x){F=h[L+x],C=h[L+x+I];var u=R[Z+x],b=R[Z+x+I];if(C<u||b<F)continue I}if(void 0!==(X=e?j(P,q):j(q,P)))return X}}}function d(I,E,j,e,w,z,h,t,U,R){var P=2*I,o=t*P,Z=U[o+E];I:for(var c=e,K=e*P;c<w;++c,K+=P){var L=h[c];if(L!==R){var F=z[K+E],C=z[K+E+I];if(!(Z<F||C<Z)){for(var X=E+1;X<I;++X){F=z[K+X],C=z[K+X+I];var q=U[o+X],x=U[o+X+I];if(C<q||x<F)continue I}var u=j(L,R);if(void 0!==u)return u}}}}},13149:(I,E,j)=>{"use strict";I.exports=function(I,E,j,h,t,U){if(h<=j+1)return j;var R=j,P=h,o=h+j>>>1,Z=2*I,c=o,K=t[Z*o+E];for(;R<P;){if(P-R<w){z(I,E,R,P,t,U),K=t[Z*o+E];break}var L=P-R,F=Math.random()*L+R|0,C=t[Z*F+E],X=Math.random()*L+R|0,q=t[Z*X+E],x=Math.random()*L+R|0,u=t[Z*x+E];C<=q?u>=q?(c=X,K=q):C>=u?(c=F,K=C):(c=x,K=u):q>=u?(c=X,K=q):u>=C?(c=F,K=C):(c=x,K=u);for(var b=Z*(P-1),Q=Z*c,G=0;G<Z;++G,++b,++Q){var y=t[b];t[b]=t[Q],t[Q]=y}var d=U[P-1];U[P-1]=U[c],U[c]=d;for(b=Z*(P-1),Q=Z*(c=e(I,E,R,P-1,t,U,K)),G=0;G<Z;++G,++b,++Q){y=t[b];t[b]=t[Q],t[Q]=y}d=U[P-1];if(U[P-1]=U[c],U[c]=d,o<c){for(P=c-1;R<P&&t[Z*(P-1)+E]===K;)P-=1;P+=1}else{if(!(c<o))break;for(R=c+1;R<P&&t[Z*R+E]===K;)R+=1}}return e(I,E,j,o,t,U,t[Z*o+E])};var e=j(13156)("lo<p0",["p0"]),w=8;function z(I,E,j,e,w,z){for(var h=2*I,t=h*(j+1)+E,U=j+1;U<e;++U,t+=h)for(var R=w[t],P=U,o=h*(U-1);P>j&&w[o+E]>R;--P,o-=h){for(var Z=o,c=o+h,K=0;K<h;++K,++Z,++c){var L=w[Z];w[Z]=w[c],w[c]=L}var F=z[P];z[P]=z[P-1],z[P-1]=F}}},13156:I=>{"use strict";I.exports=function(I,j){var e="abcdef".split("").concat(j),w=[];I.indexOf("lo")>=0&&w.push("lo=e[k+n]");I.indexOf("hi")>=0&&w.push("hi=e[k+o]");return e.push(E.replace("_",w.join()).replace("$",I)),Function.apply(void 0,e)};var E="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13123:I=>{"use strict";I.exports=function(I,e){e<=4*E?j(0,e-1,I):R(0,e-1,I)};var E=32;function j(I,E,j){for(var e=2*(I+1),w=I+1;w<=E;++w){for(var z=j[e++],h=j[e++],t=w,U=e-2;t-- >I;){var R=j[U-2],P=j[U-1];if(R<z)break;if(R===z&&P<h)break;j[U]=R,j[U+1]=P,U-=2}j[U]=z,j[U+1]=h}}function e(I,E,j){E*=2;var e=j[I*=2],w=j[I+1];j[I]=j[E],j[I+1]=j[E+1],j[E]=e,j[E+1]=w}function w(I,E,j){E*=2,j[I*=2]=j[E],j[I+1]=j[E+1]}function z(I,E,j,e){E*=2,j*=2;var w=e[I*=2],z=e[I+1];e[I]=e[E],e[I+1]=e[E+1],e[E]=e[j],e[E+1]=e[j+1],e[j]=w,e[j+1]=z}function h(I,E,j,e,w){E*=2,w[I*=2]=w[E],w[E]=j,w[I+1]=w[E+1],w[E+1]=e}function t(I,E,j){E*=2;var e=j[I*=2],w=j[E];return!(e<w)&&(e!==w||j[I+1]>j[E+1])}function U(I,E,j,e){var w=e[I*=2];return w<E||w===E&&e[I+1]<j}function R(I,P,o){var Z=(P-I+1)/6|0,c=I+Z,K=P-Z,L=I+P>>1,F=L-Z,C=L+Z,X=c,q=F,x=L,u=C,b=K,Q=I+1,G=P-1,y=0;t(X,q,o)&&(y=X,X=q,q=y),t(u,b,o)&&(y=u,u=b,b=y),t(X,x,o)&&(y=X,X=x,x=y),t(q,x,o)&&(y=q,q=x,x=y),t(X,u,o)&&(y=X,X=u,u=y),t(x,u,o)&&(y=x,x=u,u=y),t(q,b,o)&&(y=q,q=b,b=y),t(q,x,o)&&(y=q,q=x,x=y),t(u,b,o)&&(y=u,u=b,b=y);for(var d=o[2*q],a=o[2*q+1],l=o[2*u],i=o[2*u+1],r=2*X,n=2*x,H=2*b,g=2*c,Y=2*L,A=2*K,T=0;T<2;++T){var M=o[r+T],W=o[n+T],O=o[H+T];o[g+T]=M,o[Y+T]=W,o[A+T]=O}w(F,I,o),w(C,P,o);for(var s=Q;s<=G;++s)if(U(s,d,a,o))s!==Q&&e(s,Q,o),++Q;else if(!U(s,l,i,o))for(;;){if(U(G,l,i,o)){U(G,d,a,o)?(z(s,Q,G,o),++Q,--G):(e(s,G,o),--G);break}if(--G<s)break}h(I,Q-1,d,a,o),h(P,G+1,l,i,o),Q-2-I<=E?j(I,Q-2,o):R(I,Q-2,o),P-(G+2)<=E?j(G+2,P,o):R(G+2,P,o),G-Q<=E?j(Q,G,o):R(Q,G,o)}},13114:(I,E,j)=>{"use strict";I.exports={init:function(I){var E=w.nextPow2(I);U.length<E&&(e.free(U),U=e.mallocInt32(E));R.length<E&&(e.free(R),R=e.mallocInt32(E));P.length<E&&(e.free(P),P=e.mallocInt32(E));o.length<E&&(e.free(o),o=e.mallocInt32(E));Z.length<E&&(e.free(Z),Z=e.mallocInt32(E));c.length<E&&(e.free(c),c=e.mallocInt32(E));var j=8*E;K.length<j&&(e.free(K),K=e.mallocDouble(j))},sweepBipartite:function(I,E,j,e,w,t,Z,c,C,X){for(var q=0,x=2*I,u=I-1,b=x-1,Q=j;Q<e;++Q){var G=t[Q],y=x*Q;K[q++]=w[y+u],K[q++]=-(G+1),K[q++]=w[y+b],K[q++]=G}for(Q=Z;Q<c;++Q){G=X[Q]+h;var d=x*Q;K[q++]=C[d+u],K[q++]=-G,K[q++]=C[d+b],K[q++]=G}var a=q>>>1;z(K,a);var l=0,i=0;for(Q=0;Q<a;++Q){var r=0|K[2*Q+1];if(r>=h)L(P,o,i--,r=r-h|0);else if(r>=0)L(U,R,l--,r);else if(r<=-h){r=-r-h|0;for(var n=0;n<l;++n){if(void 0!==(H=E(U[n],r)))return H}F(P,o,i++,r)}else{r=-r-1|0;for(n=0;n<i;++n){var H;if(void 0!==(H=E(r,P[n])))return H}F(U,R,l++,r)}}},sweepComplete:function(I,E,j,e,w,h,t,C,X,q){for(var x=0,u=2*I,b=I-1,Q=u-1,G=j;G<e;++G){var y=h[G]+1<<1,d=u*G;K[x++]=w[d+b],K[x++]=-y,K[x++]=w[d+Q],K[x++]=y}for(G=t;G<C;++G){y=q[G]+1<<1;var a=u*G;K[x++]=X[a+b],K[x++]=1|-y,K[x++]=X[a+Q],K[x++]=1|y}var l=x>>>1;z(K,l);var i=0,r=0,n=0;for(G=0;G<l;++G){var H=0|K[2*G+1],g=1&H;if(G<l-1&&H>>1===K[2*G+3]>>1&&(g=2,G+=1),H<0){for(var Y=-(H>>1)-1,A=0;A<n;++A){if(void 0!==(T=E(Z[A],Y)))return T}if(0!==g)for(A=0;A<i;++A){if(void 0!==(T=E(U[A],Y)))return T}if(1!==g)for(A=0;A<r;++A){var T;if(void 0!==(T=E(P[A],Y)))return T}0===g?F(U,R,i++,Y):1===g?F(P,o,r++,Y):2===g&&F(Z,c,n++,Y)}else{Y=(H>>1)-1;0===g?L(U,R,i--,Y):1===g?L(P,o,r--,Y):2===g&&L(Z,c,n--,Y)}}},scanBipartite:function(I,E,j,e,w,t,P,o,Z,c,C,X){var q=0,x=2*I,u=E,b=E+I,Q=1,G=1;e?G=h:Q=h;for(var y=w;y<t;++y){var d=y+Q,a=x*y;K[q++]=P[a+u],K[q++]=-d,K[q++]=P[a+b],K[q++]=d}for(y=Z;y<c;++y){d=y+G;var l=x*y;K[q++]=C[l+u],K[q++]=-d}var i=q>>>1;z(K,i);var r=0;for(y=0;y<i;++y){var n=0|K[2*y+1];if(n<0){var H=!1;if((d=-n)>=h?(H=!e,d-=h):(H=!!e,d-=1),H)F(U,R,r++,d);else{var g=X[d],Y=x*d,A=C[Y+E+1],T=C[Y+E+1+I];I:for(var M=0;M<r;++M){var W=U[M],O=x*W;if(!(T<P[O+E+1]||P[O+E+1+I]<A)){for(var s=E+2;s<I;++s)if(C[Y+s+I]<P[O+s]||P[O+s+I]<C[Y+s])continue I;var v,V=o[W];if(void 0!==(v=e?j(g,V):j(V,g)))return v}}}}else L(U,R,r--,n-Q)}},scanComplete:function(I,E,j,e,w,t,R,P,o,Z,c){for(var L=0,F=2*I,C=E,X=E+I,q=e;q<w;++q){var x=q+h,u=F*q;K[L++]=t[u+C],K[L++]=-x,K[L++]=t[u+X],K[L++]=x}for(q=P;q<o;++q){x=q+1;var b=F*q;K[L++]=Z[b+C],K[L++]=-x}var Q=L>>>1;z(K,Q);var G=0;for(q=0;q<Q;++q){var y=0|K[2*q+1];if(y<0){if((x=-y)>=h)U[G++]=x-h;else{var d=c[x-=1],a=F*x,l=Z[a+E+1],i=Z[a+E+1+I];I:for(var r=0;r<G;++r){var n=U[r],H=R[n];if(H===d)break;var g=F*n;if(!(i<t[g+E+1]||t[g+E+1+I]<l)){for(var Y=E+2;Y<I;++Y)if(Z[a+Y+I]<t[g+Y]||t[g+Y+I]<Z[a+Y])continue I;var A=j(H,d);if(void 0!==A)return A}}}}else{for(x=y-h,r=G-1;r>=0;--r)if(U[r]===x){for(Y=r+1;Y<G;++Y)U[Y-1]=U[Y];break}--G}}}};var e=j(13095),w=j(13101),z=j(13123),h=1<<28,t=1024,U=e.mallocInt32(t),R=e.mallocInt32(t),P=e.mallocInt32(t),o=e.mallocInt32(t),Z=e.mallocInt32(t),c=e.mallocInt32(t),K=e.mallocDouble(8192);function L(I,E,j,e){var w=E[e],z=I[j-1];I[w]=z,E[z]=w}function F(I,E,j,e){I[j]=e,E[e]=j}},13103:I=>{"use strict";function E(I,j,e){var w=0|I[e];if(w<=0)return[];var z,h=new Array(w);if(e===I.length-1)for(z=0;z<w;++z)h[z]=j;else for(z=0;z<w;++z)h[z]=E(I,j,e+1);return h}I.exports=function(I,j){switch("undefined"===typeof j&&(j=0),typeof I){case"number":if(I>0)return function(I,E){var j,e;for(j=new Array(I),e=0;e<I;++e)j[e]=E;return j}(0|I,j);break;case"object":if("number"===typeof I.length)return E(I,j,0)}return[]}},13055:(I,E,j)=>{I.exports=function(){var I=this;this.components={},this.comps=this.components;var E=this.components,j=1,w={},z=[],h=[],t={timeout:!1,removals:[],multiComps:[]};function U(I,j){var e=E[j],z=w[j],h=z.hash[I];h&&(z.remove(I),e.Ie&&(e.multi?(h.forEach((E=>{E&&e.Ie(I,E)})),h.length=0):e.Ie(I,h)),t.removals.push(z),R())}function R(){t.timeout||(t.timeout=!0,setTimeout(P,1))}function P(){t.timeout=!1,o()}function o(){t.multiComps.length&&function(I){for(var E=0;E<I.length;E++){var{entID:j,data:e}=I[E],w=e.hash[j];if(w){for(var z=0;z<w.length;z++)w[z]||(w.splice(z,1),z--);0===w.length&&(e.remove(j),t.removals.push(e))}}I.length=0}(t.multiComps),t.removals.length&&function(I){for(var E=0;E<I.length;E++){I[E].flush()}I.length=0}(t.removals)}this.xo=w,this._systems=z,this._renderSystems=h,this.UP=function(E){var e=j++;return Array.isArray(E)&&E.forEach((E=>I.SU(e,E))),e},this.deleteEntity=function(E){return Object.keys(w).forEach((I=>{w[I].hash[E]&&U(E,I)})),I},this.QP=function(I){if(!I)throw new Error("Missing component definition");var j=I.name;if(!j)throw new Error("Component definition must have a name property.");if("string"!==typeof j)throw new Error("Component name must be a string.");if(""===j)throw new Error("Component name must be a non-empty string.");if(w[j])throw new Error(`Component ${j} already exists.`);var t={};return t.name=j,t.multi=!!I.multi,t.order=isNaN(I.order)?99:I.order,t.stateConstructor=I.stateConstructor||null,t.state=I.state||{},t.st=I.st||null,t.Ie=I.Ie||null,t.system=I.system||null,t.Dt=I.Dt||null,E[j]=t,w[j]=new e,w[j]._pendingMultiCleanup=!1,w[j]._multiCleanupIDs=t.multi?[]:null,t.system&&(z.push(j),z.sort(((I,j)=>E[I].order-E[j].order))),t.Dt&&(h.push(j),h.sort(((I,j)=>E[I].order-E[j].order))),j},this.overwriteComponent=function(I,j){var e=E[I];if(!e)throw new Error(`Unknown component: ${I}`);if(!j)throw new Error("Missing component definition");if(e.name!==j.name)throw new Error("Overwriting component must use the same name property.");var t={};t.name=I,t.multi=!!j.multi,t.order=isNaN(j.order)?99:j.order,t.state=j.state||{},t.st=j.st||null,t.Ie=j.Ie||null,t.system=j.system||null,t.Dt=j.Dt||null,E[I]=t,w[I]._pendingMultiCleanup=!1,w[I]._multiCleanupIDs=t.multi?[]:null;var U=z.indexOf(I);t.system&&U<0&&z.push(I),!t.system&&U>=0&&z.splice(U,1),z.sort(((I,j)=>E[I].order-E[j].order));var R=h.indexOf(I);t.Dt&&R<0&&h.push(I),!t.Dt&&R>=0&&h.splice(R,1),h.sort(((I,j)=>E[I].order-E[j].order));var P=t.state;return this.VR(I).forEach((I=>{for(var E in P)E in I||(I[E]=P[E]);t.st&&t.st(I.St,I)})),I},this.deleteComponent=function(j){var e=w[j];if(!e)throw new Error(`Unknown component: ${j}`);e.flush(),e.list.forEach((I=>{I&&U(I.St||I[0].St,j)}));var t=z.indexOf(j),R=h.indexOf(j);return t>-1&&z.splice(t,1),R>-1&&h.splice(R,1),w[j].dispose(),delete w[j],delete E[j],I},this.SU=function(I,j,e){var z,h=E[j],t=w[j];if(!t)throw new Error(`Unknown component: ${j}.`);if(t.hash[I]&&!h.multi)throw new Error(`Entity ${I} already has component: ${j}.`);if(h.stateConstructor){if(!(z=new h.stateConstructor).hasOwnProperty("St"))throw new Error(`Component ${h.name} stateConstructor type does not have property __id`)}else z=Object.assign({},{St:I},h.state,e);if(z.St=I,h.multi){var U=t.hash[I];U||(U=[],t.add(I,U)),U.push(z)}else t.add(I,z);return h.st&&h.st(I,z),this},this.jR=function(I,E){var j=w[E];if(!j)throw new Error(`Unknown component: ${E}.`);return!!j.hash[I]},this.kU=function(E,j){if(!w[j])throw new Error(`Unknown component: ${j}.`);return U(E,j),I},this.getState=function(I,E){var j=w[E];if(!j)throw new Error(`Unknown component: ${E}.`);return j.hash[I]},this.VR=function(I){var E=w[I];if(!E)throw new Error(`Unknown component: ${I}.`);return o(),E.list},this.vc=function(I){if(!w[I])throw new Error(`Unknown component: ${I}.`);var E=w[I].hash;return I=>E[I]},this.Jc=function(I){if(!w[I])throw new Error(`Unknown component: ${I}.`);var E=w[I].hash;return I=>!!E[I]},this.Tt=function(j){o();for(var e=0;e<z.length;e++){var h=z[e],t=E[h],U=w[h];t.system(j,U.list),o()}return I},this.render=function(j){o();for(var e=0;e<h.length;e++){var z=h[e],t=E[z],U=w[z];t.Dt(j,U.list),o()}return I},this.removeMultiComponent=function(j,e,z){var h=E[e],U=w[e];if(!U)throw new Error(`Unknown component: ${e}.`);if(!h.multi)throw new Error("removeMultiComponent called on non-multi component");return function(I,E,j,e){var w=j.hash[I];if(w){var z=w[e];z&&(w[e]=null,E.Ie&&E.Ie(I,z),t.multiComps.push({entID:I,data:j}),R())}}(j,h,U,z),I}};var e=j(13061)},13061:I=>{function E(I,E){var j=I._map[E];if(delete I.hash[E],delete I._map[E],j===I.list.length-1)I.list.pop();else{var e=I.list.pop();if(I.list[j]=e,null===e||null===e[0]){var w=I.list.length;for(var z in I._map)if(I._map[z]===w)return void(I._map[z]=j)}else{var h=e.St||e[0].St;I._map[h]=j}}}I.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(I,E){if("number"===typeof this._map[I]){var j=this._map[I];this.hash[I]=E,this.list[j]=E}else this._map[I]=this.list.length,this.hash[I]=E,this.list.push(E)}remove(I){var E=this._map[I];this.hash[I]=null,this.list[E]=null,this._pendingRemovals.push(I)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var I=0;I<this._pendingRemovals.length;I++){var j=this._pendingRemovals[I];null===this.hash[j]&&E(this,j)}this._pendingRemovals.length=0}}},13017:I=>{"use strict";var E,j="object"===typeof Reflect?Reflect:null,e=function(I,E,j){return Function.prototype.apply.call(I,E,j)};E=j&&"function"===typeof j.ownKeys?j.ownKeys:Object.getOwnPropertySymbols?function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:function(I){return Object.getOwnPropertyNames(I)};var w=Number.isNaN||function(I){return I!==I};function z(){z.init.call(this)}I.exports=z,I.exports.once=function(I,E){return new Promise((function(j,e){function w(j){I.removeListener(E,z),e(j)}function z(){"function"===typeof I.removeListener&&I.removeListener("error",w),j([].slice.call(arguments))}L(I,E,z,{once:!0}),"error"!==E&&function(I,E,j){"function"===typeof I.on&&L(I,"error",E,j)}(I,w,{once:!0})}))},z.EventEmitter=z,z.prototype._events=void 0,z.prototype._eventsCount=0,z.prototype._maxListeners=void 0;var h=10;function t(I){if("function"!==typeof I)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}function U(I){return void 0===I._maxListeners?z.defaultMaxListeners:I._maxListeners}function R(I,E,j,e){var w,z,h,R;if(t(j),void 0===(z=I._events)?(z=I._events=Object.create(null),I._eventsCount=0):(void 0!==z.newListener&&(I.emit("newListener",E,j.listener?j.listener:j),z=I._events),h=z[E]),void 0===h)h=z[E]=j,++I._eventsCount;else if("function"===typeof h?h=z[E]=e?[j,h]:[h,j]:e?h.unshift(j):h.push(j),(w=U(I))>0&&h.length>w&&!h.warned){h.warned=!0;var P=new Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(E)+" listeners added. Use emitter.setMaxListeners() to increase limit");P.name="MaxListenersExceededWarning",P.wE=I,P.type=E,P.count=h.length,R=P,console&&console.warn&&console.warn(R)}return I}function P(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function o(I,E,j){var e={fired:!1,wrapFn:void 0,target:I,type:E,listener:j},w=P.bind(e);return w.listener=j,e.wrapFn=w,w}function Z(I,E,j){var e=I._events;if(void 0===e)return[];var w=e[E];return void 0===w?[]:"function"===typeof w?j?[w.listener||w]:[w]:j?function(I){for(var E=new Array(I.length),j=0;j<E.length;++j)E[j]=I[j].listener||I[j];return E}(w):K(w,w.length)}function c(I){var E=this._events;if(void 0!==E){var j=E[I];if("function"===typeof j)return 1;if(void 0!==j)return j.length}return 0}function K(I,E){for(var j=new Array(E),e=0;e<E;++e)j[e]=I[e];return j}function L(I,E,j,e){if("function"===typeof I.on)e.once?I.once(E,j):I.on(E,j);else{if("function"!==typeof I.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I);I.addEventListener(E,(function w(z){e.once&&I.removeEventListener(E,w),j(z)}))}}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(I){if("number"!==typeof I||I<0||w(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");h=I}}),z.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},z.prototype.setMaxListeners=function(I){if("number"!==typeof I||I<0||w(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this},z.prototype.getMaxListeners=function(){return U(this)},z.prototype.emit=function(I){for(var E=[],j=1;j<arguments.length;j++)E.push(arguments[j]);var w="error"===I,z=this._events;if(void 0!==z)w=w&&void 0===z.error;else if(!w)return!1;if(w){var h;if(E.length>0&&(h=E[0]),h instanceof Error)throw h;var t=new Error("Unhandled error."+(h?" ("+h.message+")":""));throw t.context=h,t}var U=z[I];if(void 0===U)return!1;if("function"===typeof U)e(U,this,E);else{var R=U.length,P=K(U,R);for(j=0;j<R;++j)e(P[j],this,E)}return!0},z.prototype.addListener=function(I,E){return R(this,I,E,!1)},z.prototype.on=z.prototype.addListener,z.prototype.prependListener=function(I,E){return R(this,I,E,!0)},z.prototype.once=function(I,E){return t(E),this.on(I,o(this,I,E)),this},z.prototype.prependOnceListener=function(I,E){return t(E),this.prependListener(I,o(this,I,E)),this},z.prototype.removeListener=function(I,E){var j,e,w,z,h;if(t(E),void 0===(e=this._events))return this;if(void 0===(j=e[I]))return this;if(j===E||j.listener===E)0===--this._eventsCount?this._events=Object.create(null):(delete e[I],e.removeListener&&this.emit("removeListener",I,j.listener||E));else if("function"!==typeof j){for(w=-1,z=j.length-1;z>=0;z--)if(j[z]===E||j[z].listener===E){h=j[z].listener,w=z;break}if(w<0)return this;0===w?j.shift():function(I,E){for(;E+1<I.length;E++)I[E]=I[E+1];I.pop()}(j,w),1===j.length&&(e[I]=j[0]),void 0!==e.removeListener&&this.emit("removeListener",I,h||E)}return this},z.prototype.off=z.prototype.removeListener,z.prototype.zE=function(I){var E,j,e;if(void 0===(j=this._events))return this;if(void 0===j.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==j[I]&&(0===--this._eventsCount?this._events=Object.create(null):delete j[I]),this;if(0===arguments.length){var w,z=Object.keys(j);for(e=0;e<z.length;++e)"removeListener"!==(w=z[e])&&this.zE(w);return this.zE("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(E=j[I]))this.removeListener(I,E);else if(void 0!==E)for(e=E.length-1;e>=0;e--)this.removeListener(I,E[e]);return this},z.prototype.listeners=function(I){return Z(this,I,!0)},z.prototype.rawListeners=function(I){return Z(this,I,!1)},z.listenerCount=function(I,E){return"function"===typeof I.listenerCount?I.listenerCount(E):c.call(I,E)},z.prototype.listenerCount=c,z.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]}},13318:I=>{"use strict";I.exports=function(I,E,j,e,w,z){var h=+E[0],t=+E[1],U=+E[2],R=+j[0],P=+j[1],o=+j[2],Z=Math.sqrt(R*R+P*P+o*o);if(0===Z)throw new Error("Can't raycast along a zero vector");return function(I,E,j,e,w,z,h,t,U,R){for(var P=0,o=Math.floor,Z=0|o(E),c=0|o(j),K=0|o(e),L=w>0?1:-1,F=z>0?1:-1,C=h>0?1:-1,X=Math.abs(1/w),q=Math.abs(1/z),x=Math.abs(1/h),u=X<1/0?X*(L>0?Z+1-E:E-Z):1/0,b=q<1/0?q*(F>0?c+1-j:j-c):1/0,Q=x<1/0?x*(C>0?K+1-e:e-K):1/0,G=-1;P<=t;){var y=I(Z,c,K);if(y)return U&&(U[0]=E+P*w,U[1]=j+P*z,U[2]=e+P*h),R&&(R[0]=R[1]=R[2]=0,0===G&&(R[0]=-L),1===G&&(R[1]=-F),2===G&&(R[2]=-C)),y;u<b?u<Q?(Z+=L,P=u,u+=X,G=0):(K+=C,P=Q,Q+=x,G=2):b<Q?(c+=F,P=b,b+=q,G=1):(K+=C,P=Q,Q+=x,G=2)}return U&&(U[0]=E+P*w,U[1]=j+P*z,U[2]=e+P*h),R&&(R[0]=R[1]=R[2]=0),0}(I,h,t,U,R/=Z,P/=Z,o/=Z,e="undefined"===typeof e?64:+e,w,z)}},13350:(I,E,j)=>{"use strict";j.d(E,{e:()=>z});var e=j(13017);function w(){this.oZ=!1,this.stopPropagation=!1,this.ZZ=!1,this.disabled=!1}class z{constructor(I,E){this.version="0.7.0";var j=Object.assign({},new w,E||{});this.element=I||document,this.oZ=!!j.oZ,this.stopPropagation=!!j.stopPropagation,this.ZZ=!!j.ZZ,this.disabled=!!j.disabled,this.filterEvents=(I,E)=>!0,this.down=new e.EventEmitter,this.up=new e.EventEmitter,this.state={},this.TR={dx:0,dy:0,Fc:0,AR:0,Cc:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?t(this):document.addEventListener("DOMContentLoaded",(I=>{t(this)}),{once:!0})}bind(I){for(var E=arguments.length,j=new Array(E>1?E-1:0),e=1;e<E;e++)j[e-1]=arguments[e];j.forEach((E=>{var j=this._keyBindmap[E]||[];j.includes(I)||(j.push(I),this._keyBindmap[E]=j)})),this.state[I]=!!this.state[I],this.pressCount[I]=this.pressCount[I]||0,this.releaseCount[I]=this.releaseCount[I]||0}unbind(I){for(var E in this._keyBindmap){var j=this._keyBindmap[E],e=j.indexOf(I);e>-1&&j.splice(e,1)}}getBindings(){var I={};for(var E in this._keyBindmap){this._keyBindmap[E].forEach((j=>{I[j]=I[j]||[],I[j].push(E)}))}return I}Tt(){h(this.TR),h(this.pressCount),h(this.releaseCount)}}function h(I){for(var E in I)I[E]=0}function t(I){window.addEventListener("keydown",K.bind(null,I,!0),!1),window.addEventListener("keyup",K.bind(null,I,!1),!1);var E={passive:!0};I.element.addEventListener("touchstart",o.bind(void 0,I),{passive:!1}),I.element.addEventListener("touchend",c.bind(void 0,I),E),I.element.addEventListener("mousedown",L.bind(null,I,!0),E),window.document.addEventListener("mouseup",L.bind(null,I,!1),E),I.element.addEventListener("touchmove",F.bind(null,I),E),I.element.addEventListener("mousemove",F.bind(null,I),E),window.PointerEvent,I.element.addEventListener("wheel",C.bind(null,I),E),I.element.addEventListener("contextmenu",X.bind(null,I),!1),window.addEventListener("blur",q.bind(null,I),!1)}var U=0,R=0,P=null;function o(I,E){E.preventDefault(),Z(E)}function Z(I){let E=!1;for(let j=0;j<I.touches.length;++j)if(I.touches[j].identifier===P){E=!0;break}if(!E){const E=I.changedTouches[0];U=E.clientX,R=E.clientY,P=E.identifier}}function c(I,E){for(var j=E.changedTouches,e=0;e<j.length;++e)j[e].identifier===P&&(P=null)}function K(I,E,j){x(j.code,E,I,j)}function L(I,E,j){if("pointerId"in j)if(E){if(null!==I._touches.currID)return;I._touches.currID=j.pointerId}else{if(I._touches.currID!==j.pointerId)return;I._touches.currID=null}return x("Mouse"+("button"in j?j.button+1:1),E,I,j),!1}function F(I,E){var j=E.movementX||E.mozMovementX||0,e=E.movementY||E.mozMovementY||0;if(E.touches&&0===(j|e)){var w=function(I){Z(I);for(let E=0;E<I.changedTouches.length;++E)if(I.changedTouches[E].identifier==P){const j=I.changedTouches[E],e=[j.clientX-U,j.clientY-R];return U=j.clientX,R=j.clientY,e}return console.error(`Did not find touch id ${P}`),[0,0]}(E);j=w[0],e=w[1]}I.TR.dx+=j,I.TR.dy+=e}function C(I,E){var j=1;switch(E.deltaMode){case 0:j=1;break;case 1:j=12;break;case 2:j=I.element.clientHeight||window.innerHeight}I.TR.Fc+=(E.deltaX||0)*j,I.TR.AR+=(E.deltaY||0)*j,I.TR.Cc+=(E.deltaZ||0)*j}function X(I,E){if(!I.ZZ)return E.preventDefault(),!1}function q(I){for(var E in I._keyStates)I._keyStates[E]&&(/^Mouse\d/.test(E)||x(E,!1,I,{code:E,note:"bfe3s14v8s5",preventDefault:()=>{},stopPropagation:()=>{}}))}function x(I,E,j,e){var w=j._keyBindmap[I];w&&(u(j._keyStates[I],E)&&(j._keyStates[I]=E,w.forEach((I=>{(!j.filterEvents||j.filterEvents(e,I))&&function(I,E,j,e){var w=E?j.pressCount:j.releaseCount;w[I]=(w[I]||0)+1;var z=j._bindPressCount[I]||0;(z+=E?1:-1)<0&&(z=0);j._bindPressCount[I]=z;var h=j.state[I];if(u(h,z)){j.state[I]=z>0;var t=E?j.down:j.up;j.disabled||t.emit(I,e)}}(I,E,j,e)}))),"button"in e||(j.oZ&&!e.defaultPrevented&&e.preventDefault(),j.stopPropagation&&e.stopPropagation()))}function u(I,E){return I?!E:E}},11977:I=>{I.exports=function(I,E,j){return I[0]=E[0]+j[0],I[1]=E[1]+j[1],I[2]=E[2]+j[2],I}},11943:(I,E,j)=>{I.exports=function(I,E){var j=e(I[0],I[1],I[2]),h=e(E[0],E[1],E[2]);w(j,j),w(h,h);var t=z(j,h);return t>1?0:Math.acos(t)};var e=j(11947),w=j(11951),z=j(11953)},12045:I=>{I.exports=function(I,E){return I[0]=Math.ceil(E[0]),I[1]=Math.ceil(E[1]),I[2]=Math.ceil(E[2]),I}},11934:I=>{I.exports=function(I){var E=new Float32Array(3);return E[0]=I[0],E[1]=I[1],E[2]=I[2],E}},11961:I=>{I.exports=function(I,E){return I[0]=E[0],I[1]=E[1],I[2]=E[2],I}},11930:I=>{I.exports=function(){var I=new Float32Array(3);return I[0]=0,I[1]=0,I[2]=0,I}},12120:I=>{I.exports=function(I,E,j){var e=E[0],w=E[1],z=E[2],h=j[0],t=j[1],U=j[2];return I[0]=w*U-z*t,I[1]=z*h-e*U,I[2]=e*t-w*h,I}},12073:(I,E,j)=>{I.exports=j(12071)},12071:I=>{I.exports=function(I,E){var j=E[0]-I[0],e=E[1]-I[1],w=E[2]-I[2];return Math.sqrt(j*j+e*e+w*w)}},12017:(I,E,j)=>{I.exports=j(12008)},12008:I=>{I.exports=function(I,E,j){return I[0]=E[0]/j[0],I[1]=E[1]/j[1],I[2]=E[2]/j[2],I}},11953:I=>{I.exports=function(I,E){return I[0]*E[0]+I[1]*E[1]+I[2]*E[2]}},11925:I=>{I.exports=1e-6},11970:(I,E,j)=>{I.exports=function(I,E){var j=I[0],w=I[1],z=I[2],h=E[0],t=E[1],U=E[2];return Math.abs(j-h)<=e*Math.max(1,Math.abs(j),Math.abs(h))&&Math.abs(w-t)<=e*Math.max(1,Math.abs(w),Math.abs(t))&&Math.abs(z-U)<=e*Math.max(1,Math.abs(z),Math.abs(U))};var e=j(11925)},11975:I=>{I.exports=function(I,E){return I[0]===E[0]&&I[1]===E[1]&&I[2]===E[2]}},12036:I=>{I.exports=function(I,E){return I[0]=Math.floor(E[0]),I[1]=Math.floor(E[1]),I[2]=Math.floor(E[2]),I}},12175:(I,E,j)=>{I.exports=function(I,E,j,w,z,h){var t,U;E||(E=3);j||(j=0);U=w?Math.min(w*E+j,I.length):I.length;for(t=j;t<U;t+=E)e[0]=I[t],e[1]=I[t+1],e[2]=I[t+2],z(e,e,h),I[t]=e[0],I[t+1]=e[1],I[t+2]=e[2];return I};var e=j(11930)()},11947:I=>{I.exports=function(I,E,j){var e=new Float32Array(3);return e[0]=I,e[1]=E,e[2]=j,e}},11920:(I,E,j)=>{I.exports={EPSILON:j(11925),create:j(11930),clone:j(11934),angle:j(11943),Gt:j(11947),k:j(11961),set:j(11968),equals:j(11970),exactEquals:j(11975),add:j(11977),FE:j(11985),sub:j(11992),multiply:j(11995),mul:j(12003),divide:j(12008),div:j(12017),min:j(12021),max:j(12027),floor:j(12036),ceil:j(12045),round:j(12051),scale:j(12060),yt:j(12063),distance:j(12071),j:j(12073),squaredDistance:j(12076),sqrDist:j(12081),length:j(12086),len:j(12089),squaredLength:j(12097),dt:j(12100),negate:j(12109),inverse:j(12114),normalize:j(11951),dot:j(11953),cross:j(12120),ut:j(12128),random:j(12137),transformMat4:j(12139),transformMat3:j(12145),transformQuat:j(12154),it:j(12156),rt:j(12163),nt:j(12167),forEach:j(12175)}},12114:I=>{I.exports=function(I,E){return I[0]=1/E[0],I[1]=1/E[1],I[2]=1/E[2],I}},12089:(I,E,j)=>{I.exports=j(12086)},12086:I=>{I.exports=function(I){var E=I[0],j=I[1],e=I[2];return Math.sqrt(E*E+j*j+e*e)}},12128:I=>{I.exports=function(I,E,j,e){var w=E[0],z=E[1],h=E[2];return I[0]=w+e*(j[0]-w),I[1]=z+e*(j[1]-z),I[2]=h+e*(j[2]-h),I}},12027:I=>{I.exports=function(I,E,j){return I[0]=Math.max(E[0],j[0]),I[1]=Math.max(E[1],j[1]),I[2]=Math.max(E[2],j[2]),I}},12021:I=>{I.exports=function(I,E,j){return I[0]=Math.min(E[0],j[0]),I[1]=Math.min(E[1],j[1]),I[2]=Math.min(E[2],j[2]),I}},12003:(I,E,j)=>{I.exports=j(11995)},11995:I=>{I.exports=function(I,E,j){return I[0]=E[0]*j[0],I[1]=E[1]*j[1],I[2]=E[2]*j[2],I}},12109:I=>{I.exports=function(I,E){return I[0]=-E[0],I[1]=-E[1],I[2]=-E[2],I}},11951:I=>{I.exports=function(I,E){var j=E[0],e=E[1],w=E[2],z=j*j+e*e+w*w;z>0&&(z=1/Math.sqrt(z),I[0]=E[0]*z,I[1]=E[1]*z,I[2]=E[2]*z);return I}},12137:I=>{I.exports=function(I,E){E=E||1;var j=2*Math.random()*Math.PI,e=2*Math.random()-1,w=Math.sqrt(1-e*e)*E;return I[0]=Math.cos(j)*w,I[1]=Math.sin(j)*w,I[2]=e*E,I}},12156:I=>{I.exports=function(I,E,j,e){var w=j[1],z=j[2],h=E[1]-w,t=E[2]-z,U=Math.sin(e),R=Math.cos(e);return I[0]=E[0],I[1]=w+h*R-t*U,I[2]=z+h*U+t*R,I}},12163:I=>{I.exports=function(I,E,j,e){var w=j[0],z=j[2],h=E[0]-w,t=E[2]-z,U=Math.sin(e),R=Math.cos(e);return I[0]=w+t*U+h*R,I[1]=E[1],I[2]=z+t*R-h*U,I}},12167:I=>{I.exports=function(I,E,j,e){var w=j[0],z=j[1],h=E[0]-w,t=E[1]-z,U=Math.sin(e),R=Math.cos(e);return I[0]=w+h*R-t*U,I[1]=z+h*U+t*R,I[2]=E[2],I}},12051:I=>{I.exports=function(I,E){return I[0]=Math.round(E[0]),I[1]=Math.round(E[1]),I[2]=Math.round(E[2]),I}},12060:I=>{I.exports=function(I,E,j){return I[0]=E[0]*j,I[1]=E[1]*j,I[2]=E[2]*j,I}},12063:I=>{I.exports=function(I,E,j,e){return I[0]=E[0]+j[0]*e,I[1]=E[1]+j[1]*e,I[2]=E[2]+j[2]*e,I}},11968:I=>{I.exports=function(I,E,j,e){return I[0]=E,I[1]=j,I[2]=e,I}},12081:(I,E,j)=>{I.exports=j(12076)},12100:(I,E,j)=>{I.exports=j(12097)},12076:I=>{I.exports=function(I,E){var j=E[0]-I[0],e=E[1]-I[1],w=E[2]-I[2];return j*j+e*e+w*w}},12097:I=>{I.exports=function(I){var E=I[0],j=I[1],e=I[2];return E*E+j*j+e*e}},11992:(I,E,j)=>{I.exports=j(11985)},11985:I=>{I.exports=function(I,E,j){return I[0]=E[0]-j[0],I[1]=E[1]-j[1],I[2]=E[2]-j[2],I}},12145:I=>{I.exports=function(I,E,j){var e=E[0],w=E[1],z=E[2];return I[0]=e*j[0]+w*j[3]+z*j[6],I[1]=e*j[1]+w*j[4]+z*j[7],I[2]=e*j[2]+w*j[5]+z*j[8],I}},12139:I=>{I.exports=function(I,E,j){var e=E[0],w=E[1],z=E[2],h=j[3]*e+j[7]*w+j[11]*z+j[15];return h=h||1,I[0]=(j[0]*e+j[4]*w+j[8]*z+j[12])/h,I[1]=(j[1]*e+j[5]*w+j[9]*z+j[13])/h,I[2]=(j[2]*e+j[6]*w+j[10]*z+j[14])/h,I}},12154:I=>{I.exports=function(I,E,j){var e=E[0],w=E[1],z=E[2],h=j[0],t=j[1],U=j[2],R=j[3],P=R*e+t*z-U*w,o=R*w+U*e-h*z,Z=R*z+h*w-t*e,c=-h*e-t*w-U*z;return I[0]=P*R+c*-h+o*-U-Z*-t,I[1]=o*R+c*-t+Z*-h-P*-U,I[2]=Z*R+c*-U+P*-t-o*-h,I}},13038:I=>{"use strict";I.exports=function(I){for(var E=new Array(I),j=0;j<I;++j)E[j]=j;return E}},13106:I=>{I.exports=function(I){return null!=I&&null!=I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}},13325:(I,E,j)=>{"use strict";j.d(E,{c:()=>e});class e{constructor(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.fP=!1,this.SP=!1,this.vP=30,this.VP=0,this.Io=!1,this.fullscreen=!1,this.pP=function(I){},this.DP=function(){},this.NP=function(){},this.Ee=function(){},this.kP=function(I){},this.onFullscreenChanged=function(I){},R((()=>{!function(I,E){I._nowObject=performance||Date,I._lastTick=0,I._renderAccum=0,I._rt=0,I._frameCB=t.bind(null,I),requestAnimationFrame(I._frameCB),E>0&&(I._intervalCB=h.bind(null,I),I._interval=setInterval(I._intervalCB,Math.max(E,1e3/I.vP/2)))}(this,E),function(I,E){if(!E)return;var j=!1,e=!1;document.addEventListener("pointerlockchange",(e=>{j=document.pointerLockElement===E,I.kP(j)})),document.addEventListener("fullscreenchange",(j=>{e=document.fullscreenElement===E,I.onFullscreenChanged(e)})),Object.defineProperty(I,"Io",{get:()=>j,set:I=>{I&&!j?U(E):j&&!I&&function(I){I.exitPointerLock&&I.exitPointerLock()}(document)}}),Object.defineProperty(I,"fullscreen",{get:()=>e,set:I=>{I&&!e?E.requestFullscreen():e&&!I&&document.exitFullscreen()}}),E.addEventListener("click",(w=>{I.fP&&!j&&U(E),I.SP&&!e&&E.requestFullscreen()}));var w=()=>I.Ee();if(window.ResizeObserver){new ResizeObserver(w).observe(E)}else window.addEventListener("resize",w)}(this,I),this.NP()}))}}var w=3,z=20;function h(I){for(var E=1e3/I.vP,j=I._nowObject.now()+z,e=0;I._nowObject.now()>=I._lastTick+E&&I._nowObject.now()<j&&++e<=w;)I.pP(E),I._lastTick+=E;var h=5*(E+5),t=I._nowObject.now();if(t-I._lastTick>h)for(;t>=I._lastTick+E;)I._lastTick+=E}function t(I){requestAnimationFrame(I._frameCB),h(I);var E=I._nowObject.now(),j=E-I._rt;if(I._rt=E,I.VP>0){I._renderAccum+=j;var e=1e3/I.VP;if(I._renderAccum<e)return;I._renderAccum=Math.min(I._renderAccum-e,e)}var w=1e3/I.vP,z=(E-I._lastTick)/w;I.DP(j,z,w)}function U(I){I.requestPointerLock&&I.requestPointerLock()}var R=I=>{if("loading"===document.readyState){var E=()=>{document.removeEventListener("readystatechange",E),I()};document.addEventListener("readystatechange",E)}else setTimeout(I,1)}},13035:(I,E,j)=>{var e=j(13038),w=j(13047),z="undefined"!==typeof Float64Array;function h(I,E){return I[0]-E[0]}function t(){var I,E=this.stride,j=new Array(E.length);for(I=0;I<j.length;++I)j[I]=[Math.abs(E[I]),I];j.sort(h);var e=new Array(j.length);for(I=0;I<e.length;++I)e[I]=j[I][1];return e}function U(I,E){var j=["View",E,"d",I].join("");E<0&&(j="View_Nil"+I);var w="generic"===I;if(-1===E){var z="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(z)()}if(0===E){z="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(w?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(w?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",z)(R[I][0])}z=["'use strict'"];var h=e(E),U=h.map((function(I){return"i"+I})),P="this.offset+"+h.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),o=h.map((function(I){return"b"+I})).join(","),Z=h.map((function(I){return"c"+I})).join(",");z.push("function "+j+"(a,"+o+","+Z+",d){this.data=a","this.shape=["+o+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+I+"'","proto.dimension="+E),z.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+h.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===E?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),E<4?(z.push("function "+j+"_order(){"),2===E?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+j+"_set("+U.join(",")+",v){"),w?z.push("return this.data.set("+P+",v)}"):z.push("return this.data["+P+"]=v}"),z.push("proto.get=function "+j+"_get("+U.join(",")+"){"),w?z.push("return this.data.get("+P+")}"):z.push("return this.data["+P+"]}"),z.push("proto.index=function "+j+"_index(",U.join(),"){return "+P+"}"),z.push("proto.hi=function "+j+"_hi("+U.join(",")+"){return new "+j+"(this.data,"+h.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+h.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var c=h.map((function(I){return"a"+I+"=this.shape["+I+"]"})),K=h.map((function(I){return"c"+I+"=this.stride["+I+"]"}));z.push("proto.lo=function "+j+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+K.join(","));for(var L=0;L<E;++L)z.push("if(typeof i"+L+"==='number'&&i"+L+">=0){d=i"+L+"|0;b+=c"+L+"*d;a"+L+"-=d}");z.push("return new "+j+"(this.data,"+h.map((function(I){return"a"+I})).join(",")+","+h.map((function(I){return"c"+I})).join(",")+",b)}"),z.push("proto.step=function "+j+"_step("+U.join(",")+"){var "+h.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+h.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(L=0;L<E;++L)z.push("if(typeof i"+L+"==='number'){d=i"+L+"|0;if(d<0){c+=b"+L+"*(a"+L+"-1);a"+L+"=ceil(-a"+L+"/d)}else{a"+L+"=ceil(a"+L+"/d)}b"+L+"*=d}");z.push("return new "+j+"(this.data,"+h.map((function(I){return"a"+I})).join(",")+","+h.map((function(I){return"b"+I})).join(",")+",c)}");var F=new Array(E),C=new Array(E);for(L=0;L<E;++L)F[L]="a[i"+L+"]",C[L]="b[i"+L+"]";z.push("proto.transpose=function "+j+"_transpose("+U+"){"+U.map((function(I,E){return I+"=("+I+"===undefined?"+E+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+F.join(",")+","+C.join(",")+",this.offset)}"),z.push("proto.pick=function "+j+"_pick("+U+"){var a=[],b=[],c=this.offset");for(L=0;L<E;++L)z.push("if(typeof i"+L+"==='number'&&i"+L+">=0){c=(c+this.stride["+L+"]*i"+L+")|0}else{a.push(this.shape["+L+"]);b.push(this.stride["+L+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+h.map((function(I){return"shape["+I+"]"})).join(",")+","+h.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(R[I],t)}var R={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,E,j,e){if(void 0===I)return(0,R.array[0])([]);"number"===typeof I&&(I=[I]),void 0===E&&(E=[I.length]);var h=E.length;if(void 0===j){j=new Array(h);for(var t=h-1,P=1;t>=0;--t)j[t]=P,P*=E[t]}if(void 0===e){e=0;for(t=0;t<h;++t)j[t]<0&&(e-=(E[t]-1)*j[t])}for(var o=function(I){if(w(I))return"buffer";if(z)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),Z=R[o];Z.length<=h+1;)Z.push(U(o,Z.length-1));return(0,Z[h+1])(I,E,j,e)}},13047:I=>{function E(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(E(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&E(I.slice(0,0))}(I)||!!I._isBuffer)}},13202:I=>{"use strict";var E=[],j=[],e=[],w=[],z=[],h=[],t=[],U=[],R=[],P=[],o=[],Z=[];I.exports=function(I,c,K,L,F,C){for(var X=t,q=R,x=P,u=Z,b=0;b<3;b++)X[b]=+K[b],x[b]=+c.max[b],q[b]=+c.base[b];C||(C=1e-10);var Q=function(I,t,R,P,Z,c){var K=E,L=j,F=e,C=w,X=z,q=h,x=U,u=Math.floor,b=0,Q=0,G=0,y=0,d=0;if(a(),0===G)return 0;for(y=r();Q<=G;){if(l(y)&&i())return b;y=r()}for(b+=G,d=0;d<3;d++)P[d]+=R[d],Z[d]+=R[d];return b;function a(){if(Q=0,0!==(G=Math.sqrt(R[0]*R[0]+R[1]*R[1]+R[2]*R[2])))for(var I=0;I<3;I++){var E=R[I]>=0;C[I]=E?1:-1;var j=E?Z[I]:P[I];K[I]=E?P[I]:Z[I],L[I]=n(j,C[I]),F[I]=H(K[I],C[I]),x[I]=R[I]/G,X[I]=Math.abs(1/x[I]);var e=E?L[I]+1-j:j-L[I];q[I]=X[I]<1/0?X[I]*e:1/0}}function l(E){for(var j=C[0],e=0===E?L[0]:F[0],w=L[0]+j,z=C[1],h=1===E?L[1]:F[1],t=L[1]+z,U=C[2],R=2===E?L[2]:F[2],P=L[2]+U,o=e;o!=w;o+=j)for(var Z=h;Z!=t;Z+=z)for(var c=R;c!=P;c+=U)if(I(o,Z,c))return!0;return!1}function i(){b+=Q;var I=C[y],E=Q/G,j=o;for(d=0;d<3;d++){var e=R[d]*E;P[d]+=e,Z[d]+=e,j[d]=R[d]-e}if(I>0?Z[y]=Math.round(Z[y]):P[y]=Math.round(P[y]),t(b,y,I,j))return!0;for(d=0;d<3;d++)R[d]=j[d];return a(),0===G}function r(){var I=q[0]<q[1]?q[0]<q[2]?0:2:q[1]<q[2]?1:2,E=q[I]-Q;for(Q=q[I],L[I]+=C[I],q[I]+=X[I],d=0;d<3;d++)K[d]+=E*x[d],F[d]=H(K[d],C[d]);return I}function n(I,E){return u(I-E*c)}function H(I,E){return u(I+E*c)}}(I,L,X,q,x,C);if(!F){for(b=0;b<3;b++)u[b]=K[b]>0?x[b]-c.max[b]:q[b]-c.base[b];c.translate(u)}return Q}},13356:(I,E,j)=>{"use strict";j.d(E,{b:()=>o});var e=j(13195),w=j(11920);class z{constructor(I,E,j,z,h,t,U){this.vR=new e(I.base,I.zP),this.Oe=E,this.friction=j,this.restitution=z,this.Kt=h,this.tK=t,this.Lt=!!U,this.wP=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.DK=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.CR=w.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=w.create(),this._impulses=w.create(),this._sleepFrameCount=10}loadFromCopy(I){w.k(this.vR.base,I.vR.base),w.k(this.vR.zP,I.vR.zP),w.k(this.vR.max,I.vR.max),this.vR.mag=I.vR.mag,this.Oe=I.Oe,this.friction=I.friction,this.restitution=I.restitution,this.Kt=I.Kt,this.tK=I.tK,this.Lt=I.Lt,this.wP=I.wP,this.fluidDrag=I.fluidDrag,this.DK=I.DK,this.preventFallOffEdge=I.preventFallOffEdge,this.rolledBackLastTick=I.rolledBackLastTick,w.k(this.CR,I.CR),w.k(this.resting,I.resting),this.inFluid=I.inFluid,this._ratioInFluid=I._ratioInFluid,w.k(this._forces,I._forces),w.k(this._impulses,I._impulses),this._sleepFrameCount=I._sleepFrameCount}setPosition(I){h(I),w.FE(I,I,this.vR.base),this.vR.translate(I),this.xR()}he(){return w.clone(this.vR.base)}applyForce(I){h(I),w.add(this._forces,this._forces,I),this.xR()}applyImpulse(I){h(I),w.add(this._impulses,this._impulses,I),this.xR()}xR(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var h=I=>{};var t=j(13195),U=j(11920),R=j(13202);function P(){this.wP=.1,this.fluidDrag=.4,this.xt=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function o(I,E,j){I=Object.assign(new P,I),this.gravity=I.gravity||[0,-10,0],this.wP=I.wP||.1,this.xt=I.xt||2,this.fluidDrag=I.fluidDrag||.4,this.minBounceImpulse=I.minBounceImpulse,this.bodies=[],this.SZ=I.SZ,this.testSolid=E,this.testFluid=j}o.prototype.KK=function(I,E,j,e,w,h){I=I||new t([0,0,0],[1,1,1]),"undefined"==typeof E&&(E=1),"undefined"==typeof j&&(j=1),"undefined"==typeof e&&(e=0),"undefined"==typeof w&&(w=1);var U=new z(I,E,j,e,w,h);return this.bodies.push(U),U},o.prototype.LK=function(I){var E=this.bodies.indexOf(I);E<0||(this.bodies.splice(E,1),I.vR=I.tK=null)};var Z=U.create(),c=U.create(),K=U.create(),L=U.create(),F=U.create(),C=U.create(),X=U.create(),q=new t([0,0,0],[1,1,1]),x=new z(q,1,1,0,1,(()=>{}),!1);function u(I,E,j){return E=j,E*=1-(1-I.ratioInFluid)**2}o.prototype.Tt=function(I){I/=1e3;var E=M(0,U.squaredLength(this.gravity));this.bodies.forEach((j=>function(I,E,j,e){U.k(F,E.resting),I.SZ&&x.loadFromCopy(E);if(E.Oe<=0)return U.set(E.CR,0,0,0),U.set(E._forces,0,0,0),void U.set(E._impulses,0,0,0);var w=e||0===E.Kt;if(function(I,E,j,e){if(E._sleepFrameCount>0)return!1;if(e)return!0;var w=!1,z=.5*j*j*E.Kt;return U.scale(T,I.gravity,z),R(I.testSolid,E.vR,T,(function(){return w=!0,!0}),!0),w}(I,E,j,w))return;E._sleepFrameCount--,function(I,E){var j=E.vR,e=Math.floor(j.base[0]),w=Math.floor(j.base[2]),z=Math.floor(j.base[1]),h=Math.floor(j.max[1]);if(!I.testFluid(e,z,w))return E.inFluid=!1,void(E.ratioInFluid=0);var t=1,R=z+1;for(;R<=h&&I.testFluid(e,R,w);)t++,R++;var P=(z+t-j.base[1])/j.zP[1];P>1&&(P=1);var o=j.zP[0]*j.zP[1]*j.zP[2]*P,Z=Q;U.scale(Z,I.gravity,-I.xt*o*E.Kt),E.applyForce(Z),E.inFluid=!0,E.ratioInFluid=P}(I,E),O(E._forces),O(E._impulses),O(E.CR),O(E.resting),U.scale(Z,E._forces,1/E.Oe),U.yt(Z,Z,I.gravity,E.Kt),U.scale(c,E._impulses,1/E.Oe),U.yt(c,c,Z,j),U.add(E.CR,E.CR,c),E.friction&&(G(I,0,E,c,j),G(I,1,E,c,j),G(I,2,E,c,j));var z=E.fluidDrag>=0?E.fluidDrag:I.fluidDrag,h=E.wP>=0?E.wP:I.wP,t=h,P=h;E.inFluid&&(t=u(E,t,E.fluidDragHoriz>=0?E.fluidDragHoriz:z),P=u(E,P,E.fluidDragVert>=0?E.fluidDragVert:z));t=Math.max(1-t*j/E.Oe,0),P=Math.max(1-P*j/E.Oe,0),U.set(b,t,P,t),U.multiply(E.CR,E.CR,b),U.scale(K,E.CR,j),U.set(E._forces,0,0,0),U.set(E._impulses,0,0,0),E.Lt&&W(a,E.vR);U.k(C,K),U.set(X,0,0,0),E.preventFallOffEdge&&function(I,E,j,e){if(!E.resting[1]||j[1]>0)return;var w=g;W(w,E.vR);for(var z=0;z<3;z+=2){U.set(H,0,0,0),H[z]=j[z];var h=!0;(h=(h=(h=(h=h&&!A(I,w.base[0]+H[0]+1e-5,w.base[1],w.base[2]+H[2]+1e-5))&&!A(I,w.max[0]+H[0]-1e-5,w.base[1],w.base[2]+H[2]+1e-5))&&!A(I,w.base[0]+H[0]+1e-5,w.base[1],w.max[2]+H[2]-1e-5))&&!A(I,w.max[0]+H[0]-1e-5,w.base[1],w.max[2]+H[2]-1e-5))?(e[z]=j[z]>0?1:-1,j[z]=0):0===z&&(U.set(Y,j[0],0,0),d(I,w,Y,e,E.slideOnCollision))}}(I,E,K,X);d(I,E.vR,K,E.resting,E.slideOnCollision),E.Lt&&function(I,E,j,e){if(E.resting[1]>=0&&!E.inFluid)return;var w=0!==E.resting[0],z=0!==E.resting[2];if(!w&&!z)return;var h=Math.abs(e[0]/e[2]),t=4;if(!w&&h>t)return;if(!z&&h<1/t)return;U.add(i,j.base,e);var P=I.testSolid;R(P,j,e,(function(I,E,j,e){if(1!==E)return!0;e[E]=0}));var o=j.base[1],Z=E.inFluid?1.951:1.001,c=Math.floor(o+Z)-o;U.set(r,0,c,0);var K=!1;if(R(P,j,r,(function(I,E,j,e){return K=!0,!0})),K)return;U.FE(n,i,j.base),n[1]=0,d(I,j,n,l,!0);var L=M(j.base[0],i[0]),F=M(j.base[2],i[2]);if(w&&!L&&(!F||!z))return;if(z&&(!L||!w)&&!F)return;var C=!0;if(C=C&&!A(I,j.base[0]+1e-5,j.base[1],j.base[2]+1e-5),C=C&&!A(I,j.max[0]-1e-5,j.base[1],j.base[2]+1e-5),C=C&&!A(I,j.base[0]+1e-5,j.base[1],j.max[2]-1e-5),C=C&&!A(I,j.max[0]-1e-5,j.base[1],j.max[2]-1e-5),C)return;W(E.vR,j),E.resting[0]=l[0],E.resting[2]=l[2],E.DK&&E.DK()}(I,E,a,C);for(var o=0;o<3;++o)E.resting[o]=E.resting[o]||X[o],L[o]=0,E.resting[o]&&(F[o]||(L[o]=-E.CR[o]),E.CR[o]=0);var q=U.length(L);q>.001&&(U.scale(L,L,E.Oe),E.tK&&E.tK(L),E.restitution>0&&q>I.minBounceImpulse&&(U.scale(L,L,E.restitution),E.applyImpulse(L)));var y=U.squaredLength(E.CR);y>1e-5&&E.xR();I.SZ&&I.SZ(E)?(E.loadFromCopy(x),E.rolledBackLastTick=!0):E.rolledBackLastTick=!1}(this,j,I,E)))};var b=U.create([0,0,0]);var Q=U.create();function G(I,E,j,e,w){var z=j.resting[E],h=e[E];if(!j.alwaysApplyHorizFriction||1!==E){if(0===z)return;if(z*h<=0)return}U.k(y,j.CR),y[E]=0;var t=U.length(y);if(!M(t,0)){var R=Math.abs(j.friction*I.gravity[E]*w),P=t>R?(t-R)/t:0;j.CR[(E+1)%3]*=P,j.CR[(E+2)%3]*=P}}var y=U.create();function d(I,E,j,e,w){return U.set(e,0,0,0),R(I.testSolid,E,j,(function(I,E,j,z){e[E]=j,z[E]=0,w||(z[0]=0,z[1]=0,z[2]=0)}))}var a=new t([],[]),l=U.create(),i=U.create(),r=U.create(),n=U.create();var H=U.create(),g=new t([],[]),Y=U.create();function A(I,E,j,e){return I.testSolid(Math.floor(E),Math.floor(j-1),Math.floor(e))}var T=U.create();function M(I,E){return Math.abs(I-E)<1e-5}function W(I,E){for(var j=0;j<3;j++)I.base[j]=E.base[j],I.max[j]=E.max[j],I.zP[j]=E.zP[j]}var O=function(I){}},11790:function(I,E){!function(I){"use strict";var E=function(I,j){return E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,E){I.__proto__=E}||function(I,E){for(var j in E)Object.prototype.hasOwnProperty.call(E,j)&&(I[j]=E[j])},E(I,j)};function j(I,j){if("function"!==typeof j&&null!==j)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function e(){this.constructor=I}E(I,j),I.prototype=null===j?Object.create(j):(e.prototype=j.prototype,new e)}function e(I,E,j,e){var w,z=arguments.length,h=z<3?E:null===e?e=Object.getOwnPropertyDescriptor(E,j):e;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)h=Reflect.decorate(I,E,j,e);else for(var t=I.length-1;t>=0;t--)(w=I[t])&&(h=(z<3?w(h):z>3?w(E,j,h):w(E,j))||h);return z>3&&h&&Object.defineProperty(E,j,h),h}function w(I,E,j){if(j||2===arguments.length)for(var e,w=0,z=E.length;w<z;w++)!e&&w in E||(e||(e=Array.prototype.slice.call(E,0,w)),e[w]=E[w]);return I.concat(e||Array.prototype.slice.call(E))}var z,h=255,t=213;I.OPERATION=void 0,(z=I.OPERATION||(I.OPERATION={}))[z.ADD=128]="ADD",z[z.REPLACE=0]="REPLACE",z[z.DELETE=64]="DELETE",z[z.DELETE_AND_ADD=192]="DELETE_AND_ADD",z[z.TOUCH=1]="TOUCH",z[z.CLEAR=10]="CLEAR";var U=function(){function E(I,E,j){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=I,this.setParent(E,j)}return E.prototype.setParent=function(I,E,j){var e=this;if(this.indexes||(this.indexes=this.ref instanceof nI?this.ref._definition.indexes:{}),this.parent=I,this.parentIndex=j,E)if(this.root=E,this.ref instanceof nI){var w=this.ref._definition;for(var z in w.schema){var h=this.ref[z];if(h&&h.$changes){var t=w.indexes[z];h.$changes.setParent(this.ref,E,t)}}}else"object"===typeof this.ref&&this.ref.forEach((function(I,E){if(I instanceof nI){var j=I.$changes,w=e.ref.$changes.indexes[E];j.setParent(e.ref,e.root,w)}}))},E.prototype.operation=function(I){this.changes.set(--this.currentCustomOperation,I)},E.prototype.change=function(E,j){void 0===j&&(j=I.OPERATION.ADD);var e="number"===typeof E?E:this.indexes[E];this.assertValidIndex(e,E);var w=this.changes.get(e);w&&w.op!==I.OPERATION.DELETE&&w.op!==I.OPERATION.TOUCH||this.changes.set(e,{op:w&&w.op===I.OPERATION.DELETE?I.OPERATION.DELETE_AND_ADD:j,index:e}),this.allChanges.add(e),this.changed=!0,this.touchParents()},E.prototype.touch=function(E){var j="number"===typeof E?E:this.indexes[E];this.assertValidIndex(j,E),this.changes.has(j)||this.changes.set(j,{op:I.OPERATION.TOUCH,index:j}),this.allChanges.add(j),this.touchParents()},E.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},E.prototype.getType=function(I){if(this.ref._definition)return(E=this.ref._definition).schema[E.fieldsByIndex[I]];var E,j=(E=this.parent._definition).schema[E.fieldsByIndex[this.parentIndex]];return Object.values(j)[0]},E.prototype.getChildrenFilter=function(){var I=this.parent._definition.childFilters;return I&&I[this.parentIndex]},E.prototype.getValue=function(I){return this.ref.getByIndex(I)},E.prototype.delete=function(E){var j="number"===typeof E?E:this.indexes[E];if(void 0!==j){var e=this.getValue(j);this.changes.set(j,{op:I.OPERATION.DELETE,index:j}),this.allChanges.delete(j),delete this.caches[j],e&&e.$changes&&(e.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(E," (").concat(j,")"))},E.prototype.discard=function(E,j){var e=this;void 0===E&&(E=!1),void 0===j&&(j=!1),this.ref instanceof nI||this.changes.forEach((function(E){if(E.op===I.OPERATION.DELETE){var j=e.ref.getIndex(E.index);delete e.indexes[j]}})),this.changes.clear(),this.changed=E,j&&this.allChanges.clear(),this.currentCustomOperation=0},E.prototype.discardAll=function(){var I=this;this.changes.forEach((function(E){var j=I.getValue(E.index);j&&j.$changes&&j.$changes.discardAll()})),this.discard()},E.prototype.cache=function(I,E){this.caches[I]=E},E.prototype.clone=function(){return new E(this.ref,this.parent,this.root)},E.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},E.prototype.assertValidIndex=function(I,E){if(void 0===I)throw new Error('ChangeTree: missing index for field "'.concat(E,'"'))},E}();function R(I,E,j,e){return I[E]||(I[E]=[]),I[E].push(j),null===e||void 0===e||e.forEach((function(I,E){return j(I,E)})),function(){return o(I[E],I[E].indexOf(j))}}function P(E){var j=this,e="string"!==typeof this.$changes.getType();this.$items.forEach((function(w,z){E.push({refId:j.$changes.refId,op:I.OPERATION.DELETE,field:z,value:void 0,previousValue:w}),e&&j.$changes.root.removeRef(w.$changes.refId)}))}function o(I,E){if(-1===E||E>=I.length)return!1;for(var j=I.length-1,e=E;e<j;e++)I[e]=I[e+1];return I.length=j,!0}var Z=function(I,E){var j=I.toString(),e=E.toString();return j<e?-1:j>e?1:0};function c(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,E){return"symbol"===typeof E||isNaN(E)?I[E]:I.at(E)},set:function(I,E,j){if("symbol"===typeof E||isNaN(E))I[E]=j;else{var e=Array.from(I.$items.keys()),w=parseInt(e[E]||E);void 0===j||null===j?I.deleteAt(w):I.setAt(w,j)}return!0},deleteProperty:function(I,E){return"number"===typeof E?I.deleteAt(E):delete I[E],!0}})}var K=function(){function E(){for(var I=[],E=0;E<arguments.length;E++)I[E]=arguments[E];this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,I)}return E.prototype.st=function(E,j){return void 0===j&&(j=!0),R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,E,j?this.$items:void 0)},E.prototype.Ie=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,E)},E.is=function(I){return Array.isArray(I)||void 0!==I.array},Object.defineProperty(E.prototype,"length",{get:function(){return this.$items.size},set:function(I){0===I?this.clear():this.splice(I,this.length-I)},enumerable:!1,configurable:!0}),E.prototype.push=function(){for(var I,E=this,j=[],e=0;e<arguments.length;e++)j[e]=arguments[e];return j.forEach((function(j){I=E.$refId++,E.setAt(I,j)})),I},E.prototype.pop=function(){var I=Array.from(this.$indexes.values()).pop();if(void 0!==I){this.$changes.delete(I),this.$indexes.delete(I);var E=this.$items.get(I);return this.$items.delete(I),E}},E.prototype.at=function(I){var E=Array.from(this.$items.keys())[I];return this.$items.get(E)},E.prototype.setAt=function(E,j){var e,w;if(void 0!==j&&null!==j){if(this.$items.get(E)!==j){void 0!==j.$changes&&j.$changes.setParent(this,this.$changes.root,E);var z=null!==(w=null===(e=this.$changes.indexes[E])||void 0===e?void 0:e.op)&&void 0!==w?w:I.OPERATION.ADD;this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,j),this.$changes.change(E,z)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},E.prototype.deleteAt=function(I){var E=Array.from(this.$items.keys())[I];return void 0!==E&&this.$deleteAt(E)},E.prototype.$deleteAt=function(I){return this.$changes.delete(I),this.$indexes.delete(I),this.$items.delete(I)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&P.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.concat=function(){for(var I,j=[],e=0;e<arguments.length;e++)j[e]=arguments[e];return new(E.bind.apply(E,w([void 0],(I=Array.from(this.$items.values())).concat.apply(I,j),!1)))},E.prototype.join=function(I){return Array.from(this.$items.values()).join(I)},E.prototype.reverse=function(){var I=this,E=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(j,e){I.setAt(E[e],j)})),this},E.prototype.shift=function(){var I=Array.from(this.$items.keys()).shift();if(void 0!==I){var E=this.$items.get(I);return this.$deleteAt(I),E}},E.prototype.slice=function(I,j){var e=new E;return e.push.apply(e,Array.from(this.$items.values()).slice(I,j)),e},E.prototype.sort=function(I){var E=this;void 0===I&&(I=Z);var j=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(I).forEach((function(I,e){E.setAt(j[e],I)})),this},E.prototype.splice=function(I,E){void 0===E&&(E=this.length-I);for(var j=Array.from(this.$items.keys()),e=[],w=I;w<I+E;w++)e.push(this.$items.get(j[w])),this.$deleteAt(j[w]);return e},E.prototype.unshift=function(){for(var I=this,E=[],j=0;j<arguments.length;j++)E[j]=arguments[j];var e=this.length,w=E.length,z=Array.from(this.$items.values());return E.forEach((function(E,j){I.setAt(j,E)})),z.forEach((function(E,j){I.setAt(w+j,E)})),e+w},E.prototype.indexOf=function(I,E){return Array.from(this.$items.values()).indexOf(I,E)},E.prototype.lastIndexOf=function(I,E){return void 0===E&&(E=this.length-1),Array.from(this.$items.values()).lastIndexOf(I,E)},E.prototype.every=function(I,E){return Array.from(this.$items.values()).every(I,E)},E.prototype.some=function(I,E){return Array.from(this.$items.values()).some(I,E)},E.prototype.forEach=function(I,E){Array.from(this.$items.values()).forEach(I,E)},E.prototype.map=function(I,E){return Array.from(this.$items.values()).map(I,E)},E.prototype.filter=function(I,E){return Array.from(this.$items.values()).filter(I,E)},E.prototype.reduce=function(I,E){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},E.prototype.reduceRight=function(I,E){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},E.prototype.find=function(I,E){return Array.from(this.$items.values()).find(I,E)},E.prototype.findIndex=function(I,E){return Array.from(this.$items.values()).findIndex(I,E)},E.prototype.fill=function(I,E,j){throw new Error("ArraySchema#fill() not implemented")},E.prototype.copyWithin=function(I,E,j){throw new Error("ArraySchema#copyWithin() not implemented")},E.prototype.toString=function(){return this.$items.toString()},E.prototype.toLocaleString=function(){return this.$items.toLocaleString()},E.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},E.prototype.includes=function(I,E){return Array.from(this.$items.values()).includes(I,E)},E.prototype.flatMap=function(I,E){throw new Error("ArraySchema#flatMap() is not supported.")},E.prototype.flat=function(I){throw new Error("ArraySchema#flat() is not supported.")},E.prototype.findLast=function(){var I=Array.from(this.$items.values());return I.findLast.apply(I,arguments)},E.prototype.findLastIndex=function(){var I=Array.from(this.$items.values());return I.findLastIndex.apply(I,arguments)},E.prototype.setIndex=function(I,E){this.$indexes.set(I,E)},E.prototype.getIndex=function(I){return this.$indexes.get(I)},E.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},E.prototype.deleteByIndex=function(I){var E=this.$indexes.get(I);this.$items.delete(E),this.$indexes.delete(I)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){return this.toArray().map((function(I){return"function"===typeof I.toJSON?I.toJSON():I}))},E.prototype.clone=function(I){return I?new(E.bind.apply(E,w([void 0],Array.from(this.$items.values()),!1))):new(E.bind.apply(E,w([void 0],this.map((function(I){return I.$changes?I.clone():I})),!1)))},E}();function L(I){return I.$proxy=!0,I=new Proxy(I,{get:function(I,E){return"symbol"!==typeof E&&"undefined"===typeof I[E]?I.get(E):I[E]},set:function(I,E,j){return"symbol"!==typeof E&&-1===E.indexOf("$")&&"st"!==E&&"Ie"!==E&&"onChange"!==E?I.set(E,j):I[E]=j,!0},deleteProperty:function(I,E){return I.delete(E),!0}})}var F=function(){function E(I){var j=this;if(this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I)if(I instanceof Map||I instanceof E)I.forEach((function(I,E){return j.set(E,I)}));else for(var e in I)this.set(e,I[e])}return E.prototype.st=function(E,j){return void 0===j&&(j=!0),R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,E,j?this.$items:void 0)},E.prototype.Ie=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,E)},E.is=function(I){return void 0!==I.map},E.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(E.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(E,Symbol.species,{get:function(){return E},enumerable:!1,configurable:!0}),E.prototype.set=function(E,j){if(void 0===j||null===j)throw new Error("MapSchema#set('".concat(E,"', ").concat(j,"): trying to set ").concat(j," value on '").concat(E,"'."));E=E.toString();var e="undefined"!==typeof this.$changes.indexes[E],w=e?this.$changes.indexes[E]:this.$refId++,z=e?I.OPERATION.REPLACE:I.OPERATION.ADD,h=void 0!==j.$changes;if(h&&j.$changes.setParent(this,this.$changes.root,w),e){if(!h&&this.$items.get(E)===j)return;h&&this.$items.get(E)!==j&&(z=I.OPERATION.ADD)}else this.$changes.indexes[E]=w,this.$indexes.set(w,E);return this.$items.set(E,j),this.$changes.change(E,z),this},E.prototype.get=function(I){return this.$items.get(I)},E.prototype.delete=function(I){return this.$changes.delete(I),this.$items.delete(I)},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&P.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(I){return this.$items.has(I)},E.prototype.forEach=function(I){this.$items.forEach(I)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.keys=function(){return this.$items.keys()},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(I,E){this.$indexes.set(I,E)},E.prototype.getIndex=function(I){return this.$indexes.get(I)},E.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},E.prototype.deleteByIndex=function(I){var E=this.$indexes.get(I);this.$items.delete(E),this.$indexes.delete(I)},E.prototype.toJSON=function(){var I={};return this.forEach((function(E,j){I[j]="function"===typeof E.toJSON?E.toJSON():E})),I},E.prototype.clone=function(I){var j;return I?j=Object.assign(new E,this):(j=new E,this.forEach((function(I,E){I.$changes?j.set(E,I.clone()):j.set(E,I)}))),j},E}(),C={};function X(I,E){C[I]=E}function q(I){return C[I]}var x=function(){function I(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return I.create=function(E){var j=new I;return j.schema=Object.assign({},E&&E.schema||{}),j.indexes=Object.assign({},E&&E.indexes||{}),j.fieldsByIndex=Object.assign({},E&&E.fieldsByIndex||{}),j.descriptors=Object.assign({},E&&E.descriptors||{}),j.deprecated=Object.assign({},E&&E.deprecated||{}),j},I.prototype.addField=function(I,E){var j=this.getNextFieldIndex();this.fieldsByIndex[j]=I,this.indexes[I]=j,this.schema[I]=Array.isArray(E)?{array:E[0]}:E},I.prototype.hasField=function(I){return void 0!==this.indexes[I]},I.prototype.addFilter=function(I,E){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[I]]=E,this.indexesWithFilters.push(this.indexes[I]),!0},I.prototype.addChildrenFilter=function(I,E){var j=this.indexes[I],e=this.schema[I];if(q(Object.keys(e)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[j]=E,!0;console.warn("@filterChildren: field '".concat(I,"' can't have children. Ignoring filter."))},I.prototype.getChildrenFilter=function(I){return this.childFilters&&this.childFilters[this.indexes[I]]},I.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},I}();function u(I){return I._context&&I._context.useFilters}var b=function(){function I(){this.types={},this.schemas=new Map,this.useFilters=!1}return I.prototype.has=function(I){return this.schemas.has(I)},I.prototype.get=function(I){return this.types[I]},I.prototype.add=function(I,E){void 0===E&&(E=this.schemas.size),I._definition=x.create(I._definition),I._typeid=E,this.types[E]=I,this.schemas.set(I,E)},I.create=function(E){return void 0===E&&(E={}),function(j){return E.context||(E.context=new I),G(j,E)}},I}(),Q=new b;function G(I,E){return void 0===E&&(E={}),function(j,e){var z=E.context||Q,h=j.constructor;if(h._context=z,!I)throw new Error("".concat(h.name,': @type() reference provided for "').concat(e,"\" is undefined. Make sure you don't have any circular dependencies."));z.has(h)||z.add(h);var t=h._definition;if(t.addField(e,I),t.descriptors[e]){if(t.deprecated[e])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(e,"' definition on '").concat(h.name,"'.\nCheck @type() annotation"))}catch(C){var U=C.stack.split("\n")[4].trim();throw new Error("".concat(C.message," ").concat(U))}}var R=K.is(I),P=!R&&F.is(I);if("string"!==typeof I&&!nI.is(I)){var o=Object.values(I)[0];"string"===typeof o||z.has(o)||z.add(o)}if(E.manual)t.descriptors[e]={enumerable:!0,configurable:!0,writable:!0};else{var Z="_".concat(e);t.descriptors[Z]={enumerable:!1,configurable:!1,writable:!0},t.descriptors[e]={get:function(){return this[Z]},set:function(I){I!==this[Z]&&(void 0!==I&&null!==I?(!R||I instanceof K||(I=new(K.bind.apply(K,w([void 0],I,!1)))),!P||I instanceof F||(I=new F(I)),void 0===I.$proxy&&(P?I=L(I):R&&(I=c(I))),this.$changes.change(e),I.$changes&&I.$changes.setParent(this,this.$changes.root,this._definition.indexes[e])):this[Z]&&this.$changes.delete(e),this[Z]=I)},enumerable:!0,configurable:!0}}}}function y(I){return function(E,j){var e=E.constructor;e._definition.addFilter(j,I)&&(e._context.useFilters=!0)}}function d(I){return function(E,j){var e=E.constructor;e._definition.addChildrenFilter(j,I)&&(e._context.useFilters=!0)}}function a(I){return void 0===I&&(I=!0),function(E,j){var e=E.constructor._definition;e.deprecated[j]=!0,I&&(e.descriptors[j]={get:function(){throw new Error("".concat(j," is deprecated."))},set:function(I){},enumerable:!1,configurable:!0})}}function l(I,E,j){for(var e in void 0===j&&(j={}),j.context||(j.context=I._context||j.context||Q),E)G(E[e],j)(I.prototype,e);return I}function i(I){for(var E=0,j=0,e=0,w=I.length;e<w;e++)(E=I.charCodeAt(e))<128?j+=1:E<2048?j+=2:E<55296||E>=57344?j+=3:(e++,j+=4);return j}function r(I,E,j){for(var e=0,w=0,z=j.length;w<z;w++)(e=j.charCodeAt(w))<128?I[E++]=e:e<2048?(I[E++]=192|e>>6,I[E++]=128|63&e):e<55296||e>=57344?(I[E++]=224|e>>12,I[E++]=128|e>>6&63,I[E++]=128|63&e):(w++,e=65536+((1023&e)<<10|1023&j.charCodeAt(w)),I[E++]=240|e>>18,I[E++]=128|e>>12&63,I[E++]=128|e>>6&63,I[E++]=128|63&e)}function n(I,E){I.push(255&E)}function H(I,E){I.push(255&E)}function g(I,E){I.push(255&E),I.push(E>>8&255)}function Y(I,E){I.push(255&E),I.push(E>>8&255)}function A(I,E){I.push(255&E),I.push(E>>8&255),I.push(E>>16&255),I.push(E>>24&255)}function T(I,E){var j=E>>24,e=E>>16,w=E>>8,z=E;I.push(255&z),I.push(255&w),I.push(255&e),I.push(255&j)}function M(I,E){var j=Math.floor(E/Math.pow(2,32));T(I,E>>>0),T(I,j)}function W(I,E){var j=E/Math.pow(2,32)|0;T(I,E>>>0),T(I,j)}function O(I,E){S(I,E)}function s(I,E){B(I,E)}var v=new Int32Array(2),V=new Float32Array(v.buffer),f=new Float64Array(v.buffer);function S(I,E){V[0]=E,A(I,v[0])}function B(I,E){f[0]=E,A(I,v[0]),A(I,v[1])}function p(I,E){return H(I,E?1:0)}function D(I,E){E||(E="");var j=i(E),e=0;if(j<32)I.push(160|j),e=1;else if(j<256)I.push(217),H(I,j),e=2;else if(j<65536)I.push(218),Y(I,j),e=3;else{if(!(j<4294967296))throw new Error("String too long");I.push(219),T(I,j),e=5}return r(I,I.length,E),e+j}function k(I,E){return isNaN(E)?k(I,0):isFinite(E)?E!==(0|E)?(I.push(203),B(I,E),9):E>=0?E<128?(H(I,E),1):E<256?(I.push(204),H(I,E),2):E<65536?(I.push(205),Y(I,E),3):E<4294967296?(I.push(206),T(I,E),5):(I.push(207),W(I,E),9):E>=-32?(I.push(224|E+32),1):E>=-128?(I.push(208),n(I,E),2):E>=-32768?(I.push(209),g(I,E),3):E>=-2147483648?(I.push(210),A(I,E),5):(I.push(211),M(I,E),9):k(I,E>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var J=Object.freeze({__proto__:null,utf8Write:r,int8:n,uint8:H,int16:g,uint16:Y,int32:A,uint32:T,int64:M,uint64:W,float32:O,float64:s,writeFloat32:S,writeFloat64:B,boolean:p,string:D,number:k});function N(I,E,j){for(var e="",w=0,z=E,h=E+j;z<h;z++){var t=I[z];0!==(128&t)?192!==(224&t)?224!==(240&t)?240!==(248&t)?console.error("Invalid byte "+t.toString(16)):(w=(7&t)<<18|(63&I[++z])<<12|(63&I[++z])<<6|63&I[++z])>=65536?(w-=65536,e+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):e+=String.fromCharCode(w):e+=String.fromCharCode((15&t)<<12|(63&I[++z])<<6|63&I[++z]):e+=String.fromCharCode((31&t)<<6|63&I[++z]):e+=String.fromCharCode(t)}return e}function m(I,E){return II(I,E)<<24>>24}function II(I,E){return I[E.offset++]}function EI(I,E){return jI(I,E)<<16>>16}function jI(I,E){return I[E.offset++]|I[E.offset++]<<8}function eI(I,E){return I[E.offset++]|I[E.offset++]<<8|I[E.offset++]<<16|I[E.offset++]<<24}function wI(I,E){return eI(I,E)>>>0}function zI(I,E){return ZI(I,E)}function hI(I,E){return cI(I,E)}function tI(I,E){var j=wI(I,E);return eI(I,E)*Math.pow(2,32)+j}function UI(I,E){var j=wI(I,E);return wI(I,E)*Math.pow(2,32)+j}var RI=new Int32Array(2),PI=new Float32Array(RI.buffer),oI=new Float64Array(RI.buffer);function ZI(I,E){return RI[0]=eI(I,E),PI[0]}function cI(I,E){return RI[0]=eI(I,E),RI[1]=eI(I,E),oI[0]}function KI(I,E){return II(I,E)>0}function LI(I,E){var j,e=I[E.offset++];e<192?j=31&e:217===e?j=II(I,E):218===e?j=jI(I,E):219===e&&(j=wI(I,E));var w=N(I,E.offset,j);return E.offset+=j,w}function FI(I,E){var j=I[E.offset];return j<192&&j>160||217===j||218===j||219===j}function CI(I,E){var j=I[E.offset++];return j<128?j:202===j?ZI(I,E):203===j?cI(I,E):204===j?II(I,E):205===j?jI(I,E):206===j?wI(I,E):207===j?UI(I,E):208===j?m(I,E):209===j?EI(I,E):210===j?eI(I,E):211===j?tI(I,E):j>223?-1*(255-j+1):void 0}function XI(I,E){var j=I[E.offset];return j<128||j>=202&&j<=211}function qI(I,E){return I[E.offset]<160}function xI(I,E){return I[E.offset-1]===h&&(I[E.offset]<128||I[E.offset]>=202&&I[E.offset]<=211)}var uI=Object.freeze({__proto__:null,int8:m,uint8:II,int16:EI,uint16:jI,int32:eI,uint32:wI,float32:zI,float64:hI,int64:tI,uint64:UI,readFloat32:ZI,readFloat64:cI,boolean:KI,string:LI,stringCheck:FI,number:CI,numberCheck:XI,arrayCheck:qI,switchStructureCheck:xI}),bI=function(){function E(I){var E=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return E.add(I)}))}return E.prototype.st=function(E,j){return void 0===j&&(j=!0),R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,E,j?this.$items:void 0)},E.prototype.Ie=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,E)},E.is=function(I){return void 0!==I.collection},E.prototype.add=function(I){var E=this.$refId++;return void 0!==I.$changes&&I.$changes.setParent(this,this.$changes.root,E),this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,I),this.$changes.change(E),E},E.prototype.at=function(I){var E=Array.from(this.$items.keys())[I];return this.$items.get(E)},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(I){for(var E,j,e=this.$items.entries();(j=e.next())&&!j.done;)if(I===j.value[1]){E=j.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&P.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(I){return Array.from(this.$items.values()).some((function(E){return E===I}))},E.prototype.forEach=function(I){var E=this;this.$items.forEach((function(j,e,w){return I(j,e,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(I,E){this.$indexes.set(I,E)},E.prototype.getIndex=function(I){return this.$indexes.get(I)},E.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},E.prototype.deleteByIndex=function(I){var E=this.$indexes.get(I);this.$items.delete(E),this.$indexes.delete(I)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var I=[];return this.forEach((function(E,j){I.push("function"===typeof E.toJSON?E.toJSON():E)})),I},E.prototype.clone=function(I){var j;return I?j=Object.assign(new E,this):(j=new E,this.forEach((function(I){I.$changes?j.add(I.clone()):j.add(I)}))),j},E}(),QI=function(){function E(I){var E=this;this.$changes=new U(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,I&&I.forEach((function(I){return E.add(I)}))}return E.prototype.st=function(E,j){return void 0===j&&(j=!0),R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.ADD,E,j?this.$items:void 0)},E.prototype.Ie=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,E)},E.prototype.onChange=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,E)},E.is=function(I){return void 0!==I.set},E.prototype.add=function(E){var j,e;if(this.has(E))return!1;var w=this.$refId++;void 0!==E.$changes&&E.$changes.setParent(this,this.$changes.root,w);var z=null!==(e=null===(j=this.$changes.indexes[w])||void 0===j?void 0:j.op)&&void 0!==e?e:I.OPERATION.ADD;return this.$changes.indexes[w]=w,this.$indexes.set(w,w),this.$items.set(w,E),this.$changes.change(w,z),w},E.prototype.entries=function(){return this.$items.entries()},E.prototype.delete=function(I){for(var E,j,e=this.$items.entries();(j=e.next())&&!j.done;)if(I===j.value[1]){E=j.value[0];break}return void 0!==E&&(this.$changes.delete(E),this.$indexes.delete(E),this.$items.delete(E))},E.prototype.clear=function(E){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),E&&P.call(this,E),this.$items.clear(),this.$changes.operation({index:0,op:I.OPERATION.CLEAR}),this.$changes.touchParents()},E.prototype.has=function(I){for(var E,j=this.$items.values(),e=!1;(E=j.next())&&!E.done;)if(I===E.value){e=!0;break}return e},E.prototype.forEach=function(I){var E=this;this.$items.forEach((function(j,e,w){return I(j,e,E)}))},E.prototype.values=function(){return this.$items.values()},Object.defineProperty(E.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),E.prototype.setIndex=function(I,E){this.$indexes.set(I,E)},E.prototype.getIndex=function(I){return this.$indexes.get(I)},E.prototype.getByIndex=function(I){return this.$items.get(this.$indexes.get(I))},E.prototype.deleteByIndex=function(I){var E=this.$indexes.get(I);this.$items.delete(E),this.$indexes.delete(I)},E.prototype.toArray=function(){return Array.from(this.$items.values())},E.prototype.toJSON=function(){var I=[];return this.forEach((function(E,j){I.push("function"===typeof E.toJSON?E.toJSON():E)})),I},E.prototype.clone=function(I){var j;return I?j=Object.assign(new E,this):(j=new E,this.forEach((function(I){I.$changes?j.add(I.clone()):j.add(I)}))),j},E}(),GI=function(){function I(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return I.prototype.addRefId=function(I){this.refIds.has(I)||(this.refIds.add(I),this.containerIndexes.set(I,new Set))},I.get=function(E){return void 0===E.$filterState&&(E.$filterState=new I),E.$filterState},I}(),yI=function(){function I(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return I.prototype.getNextUniqueId=function(){return this.nextUniqueId++},I.prototype.addRef=function(I,E,j){void 0===j&&(j=!0),this.refs.set(I,E),j&&(this.refCounts[I]=(this.refCounts[I]||0)+1)},I.prototype.removeRef=function(I){this.refCounts[I]=this.refCounts[I]-1,this.deletedRefs.add(I)},I.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},I.prototype.garbageCollectDeletedRefs=function(){var I=this;this.deletedRefs.forEach((function(E){if(!(I.refCounts[E]>0)){var j=I.refs.get(E);if(j instanceof nI)for(var e in j._definition.schema)"string"!==typeof j._definition.schema[e]&&j[e]&&j[e].$changes&&I.removeRef(j[e].$changes.refId);else{var w=j.$changes.parent._definition,z=w.schema[w.fieldsByIndex[j.$changes.parentIndex]];"function"===typeof Object.values(z)[0]&&Array.from(j.values()).forEach((function(E){return I.removeRef(E.$changes.refId)}))}I.refs.delete(E),delete I.refCounts[E]}})),this.deletedRefs.clear()},I}(),dI=function(I){function E(){return null!==I&&I.apply(this,arguments)||this}return j(E,I),E}(Error);function aI(I,E,j,e){var w,z=!1;switch(E){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":w="number",isNaN(I)&&console.log('trying to encode "NaN" in '.concat(j.constructor.name,"#").concat(e));break;case"string":w="string",z=!0;break;case"boolean":return}if(typeof I!==w&&(!z||z&&null!==I)){var h="'".concat(JSON.stringify(I),"'").concat(I&&I.constructor&&" (".concat(I.constructor.name,")")||"");throw new dI("a '".concat(w,"' was expected, but ").concat(h," was provided in ").concat(j.constructor.name,"#").concat(e))}}function lI(I,E,j,e){if(!(I instanceof E))throw new dI("a '".concat(E.name,"' was expected, but '").concat(I.constructor.name,"' was provided in ").concat(j.constructor.name,"#").concat(e))}function iI(I,E,j,e,w){aI(j,I,e,w);var z=J[I];if(!z)throw new dI("a '".concat(I,"' was expected, but ").concat(j," was provided in ").concat(e.constructor.name,"#").concat(w));z(E,j)}function rI(I,E,j){return uI[I](E,j)}var nI=function(){function E(){for(var I=[],E=0;E<arguments.length;E++)I[E]=arguments[E];Object.defineProperties(this,{$changes:{value:new U(this,void 0,new yI),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var j=this._definition.descriptors;j&&Object.defineProperties(this,j),I[0]&&this.assign(I[0])}return E.onError=function(I){console.error(I)},E.is=function(I){return I._definition&&void 0!==I._definition.schema},E.prototype.onChange=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.REPLACE,E)},E.prototype.Ie=function(E){return R(this.$callbacks||(this.$callbacks=[]),I.OPERATION.DELETE,E)},E.prototype.assign=function(I){return Object.assign(this,I),this},Object.defineProperty(E.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),E.prototype.setDirty=function(I,E){this.$changes.change(I,E)},E.prototype.listen=function(I,E,j){var e=this;return void 0===j&&(j=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[I]||(this.$callbacks[I]=[]),this.$callbacks[I].push(E),j&&void 0!==this[I]&&E(this[I],void 0),function(){return o(e.$callbacks[I],e.$callbacks[I].indexOf(E))}},E.prototype.decode=function(j,e,w){var z;void 0===e&&(e={offset:0}),void 0===w&&(w=this);var t=[],U=this.$changes.root,R=j.length,P=0;for(U.refs.set(P,this);e.offset<R;){var o=j[e.offset++];if(o!=h){var Z=w.$changes,c=void 0!==w._definition,L=c?o>>6<<6:o;if(L!==I.OPERATION.CLEAR){var C=c?o%(L||255):CI(j,e),X=c?w._definition.fieldsByIndex[C]:"",x=Z.getType(C),u=void 0,b=void 0,Q=void 0;if(c?b=w["_".concat(X)]:(b=w.getByIndex(C),(L&I.OPERATION.ADD)===I.OPERATION.ADD?(Q=w instanceof F?LI(j,e):C,w.setIndex(C,Q)):Q=w.getIndex(C)),(L&I.OPERATION.DELETE)===I.OPERATION.DELETE&&(L!==I.OPERATION.DELETE_AND_ADD&&w.deleteByIndex(C),b&&b.$changes&&U.removeRef(b.$changes.refId),u=null),void 0!==X){if(L===I.OPERATION.DELETE);else if(E.is(x)){var G=CI(j,e);if(u=U.refs.get(G),L!==I.OPERATION.REPLACE){var y=this.getSchemaType(j,e,x);u||((u=this.createTypeInstance(y)).$changes.refId=G,b&&(u.$callbacks=b.$callbacks,b.$changes.refId&&G!==b.$changes.refId&&U.removeRef(b.$changes.refId))),U.addRef(G,u,u!==b)}}else if("string"===typeof x)u=rI(x,j,e);else{var d=q(Object.keys(x)[0]),a=CI(j,e),l=U.refs.has(a)?b||U.refs.get(a):new d.constructor;if((u=l.clone(!0)).$changes.refId=a,b&&(u.$callbacks=b.$callbacks,b.$changes.refId&&a!==b.$changes.refId)){U.removeRef(b.$changes.refId);for(var i=b.entries(),r=void 0;(r=i.next())&&!r.done;){var n=(z=r.value)[0],H=z[1];t.push({refId:a,op:I.OPERATION.DELETE,field:n,value:void 0,previousValue:H})}}U.addRef(a,u,l!==b)}if(null!==u&&void 0!==u)if(u.$changes&&u.$changes.setParent(Z.ref,Z.root,C),w instanceof E)w[X]=u;else if(w instanceof F)n=Q,w.$items.set(n,u),w.$changes.allChanges.add(C);else if(w instanceof K)w.setAt(C,u);else if(w instanceof bI){var g=w.add(u);w.setIndex(C,g)}else w instanceof QI&&!1!==(g=w.add(u))&&w.setIndex(C,g);b!==u&&t.push({refId:P,op:L,field:X,dynamicIndex:Q,value:u,previousValue:b})}else{console.warn("@colyseus/schema: definition mismatch");for(var Y={offset:e.offset};e.offset<R&&(!xI(j,e)||(Y.offset=e.offset+1,!U.refs.has(CI(j,Y))));)e.offset++}}else w.clear(t)}else{P=CI(j,e);var A=U.refs.get(P);if(!A)throw new Error('"refId" not found: '.concat(P));w=A}}return this._triggerChanges(t),U.garbageCollectDeletedRefs(),t},E.prototype.encode=function(j,e,w){void 0===j&&(j=!1),void 0===e&&(e=[]),void 0===w&&(w=!1);for(var z=this.$changes,t=new WeakSet,U=[z],R=1,P=0;P<R;P++){var o=U[P],Z=o.ref,c=Z instanceof E;o.ensureRefId(),t.add(o),o!==z&&(o.changed||j)&&(H(e,h),k(e,o.refId));for(var K=j?Array.from(o.allChanges):Array.from(o.changes.values()),L=0,C=K.length;L<C;L++){var X=j?{op:I.OPERATION.ADD,index:K[L]}:K[L],x=X.index,u=c?Z._definition.fieldsByIndex&&Z._definition.fieldsByIndex[x]:x,b=e.length;if(X.op!==I.OPERATION.TOUCH)if(c)H(e,x|X.op);else{if(H(e,X.op),X.op===I.OPERATION.CLEAR)continue;k(e,x)}if(c||(X.op&I.OPERATION.ADD)!=I.OPERATION.ADD||Z instanceof F&&D(e,o.ref.$indexes.get(x)),X.op!==I.OPERATION.DELETE){var Q=o.getType(x),G=o.getValue(x);if(G&&G.$changes&&!t.has(G.$changes)&&(U.push(G.$changes),G.$changes.ensureRefId(),R++),X.op!==I.OPERATION.TOUCH){if(E.is(Q))lI(G,Q,Z,u),k(e,G.$changes.refId),(X.op&I.OPERATION.ADD)===I.OPERATION.ADD&&this.tryEncodeTypeId(e,Q,G.constructor);else if("string"===typeof Q)iI(Q,e,G,Z,u);else{var y=q(Object.keys(Q)[0]);lI(Z["_".concat(u)],y.constructor,Z,u),k(e,G.$changes.refId)}w&&o.cache(x,e.slice(b))}}}j||w||o.discard()}return e},E.prototype.encodeAll=function(I){return this.encode(!0,[],I)},E.prototype.applyFilters=function(j,e){var w,z;void 0===e&&(e=!1);for(var t=this,U=new Set,R=GI.get(j),P=[this.$changes],o=1,Z=[],c=function(c){var K=P[c];if(U.has(K.refId))return"continue";var L=K.ref,C=L instanceof E;H(Z,h),k(Z,K.refId);var X=R.refIds.has(K),q=e||!X;R.addRefId(K);var x=R.containerIndexes.get(K),u=q?Array.from(K.allChanges):Array.from(K.changes.values());!e&&C&&L._definition.indexesWithFilters&&L._definition.indexesWithFilters.forEach((function(E){!x.has(E)&&K.allChanges.has(E)&&(q?u.push(E):u.push({op:I.OPERATION.ADD,index:E}))}));for(var b=0,Q=u.length;b<Q;b++){var G=q?{op:I.OPERATION.ADD,index:u[b]}:u[b];if(G.op!==I.OPERATION.CLEAR){var y=G.index;if(G.op!==I.OPERATION.DELETE){var d=K.getValue(y),a=K.getType(y);if(C){if((l=L._definition.filters&&L._definition.filters[y])&&!l.call(L,j,d,t)){d&&d.$changes&&U.add(d.$changes.refId);continue}}else{var l,i=K.parent;if((l=K.getChildrenFilter())&&!l.call(i,j,L.$indexes.get(y),d,t)){d&&d.$changes&&U.add(d.$changes.refId);continue}}if(d.$changes&&(P.push(d.$changes),o++),G.op!==I.OPERATION.TOUCH)if(G.op===I.OPERATION.ADD||C)Z.push.apply(Z,null!==(w=K.caches[y])&&void 0!==w?w:[]),x.add(y);else if(x.has(y))Z.push.apply(Z,null!==(z=K.caches[y])&&void 0!==z?z:[]);else{if(x.add(y),H(Z,I.OPERATION.ADD),k(Z,y),L instanceof F){var r=K.ref.$indexes.get(y);D(Z,r)}d.$changes?k(Z,d.$changes.refId):J[a](Z,d)}else d.$changes&&!C&&(H(Z,I.OPERATION.ADD),k(Z,y),L instanceof F&&(r=K.ref.$indexes.get(y),D(Z,r)),k(Z,d.$changes.refId))}else C?H(Z,G.op|y):(H(Z,G.op),k(Z,y))}else H(Z,G.op)}},K=0;K<o;K++)c(K);return Z},E.prototype.clone=function(){var I,E=new this.constructor,j=this._definition.schema;for(var e in j)"object"===typeof this[e]&&"function"===typeof(null===(I=this[e])||void 0===I?void 0:I.clone)?E[e]=this[e].clone():E[e]=this[e];return E},E.prototype.toJSON=function(){var I=this._definition.schema,E=this._definition.deprecated,j={};for(var e in I)E[e]||null===this[e]||"undefined"===typeof this[e]||(j[e]="function"===typeof this[e].toJSON?this[e].toJSON():this["_".concat(e)]);return j},E.prototype.discardAllChanges=function(){this.$changes.discardAll()},E.prototype.getByIndex=function(I){return this[this._definition.fieldsByIndex[I]]},E.prototype.deleteByIndex=function(I){this[this._definition.fieldsByIndex[I]]=void 0},E.prototype.tryEncodeTypeId=function(I,E,j){E._typeid!==j._typeid&&(H(I,t),k(I,j._typeid))},E.prototype.getSchemaType=function(I,E,j){var e;return I[E.offset]===t&&(E.offset++,e=this.constructor._context.get(CI(I,E))),e||j},E.prototype.createTypeInstance=function(I){var E=new I;return E.$changes.root=this.$changes.root,E},E.prototype._triggerChanges=function(j){for(var e,w,z,h,t,U,R,P,o,Z=new Set,c=this.$changes.root.refs,K=function(K){var L=j[K],F=L.refId,C=c.get(F),X=C.$callbacks;if((L.op&I.OPERATION.DELETE)===I.OPERATION.DELETE&&L.previousValue instanceof E&&(null===(w=null===(e=L.previousValue.$callbacks)||void 0===e?void 0:e[I.OPERATION.DELETE])||void 0===w||w.forEach((function(I){return I()}))),!X)return"continue";if(C instanceof E){if(!Z.has(F))try{null===(z=null===X||void 0===X?void 0:X[I.OPERATION.REPLACE])||void 0===z||z.forEach((function(I){return I()}))}catch(q){E.onError(q)}try{X.hasOwnProperty(L.field)&&(null===(h=X[L.field])||void 0===h||h.forEach((function(I){return I(L.value,L.previousValue)})))}catch(q){E.onError(q)}}else L.op===I.OPERATION.ADD&&void 0===L.previousValue?null===(t=X[I.OPERATION.ADD])||void 0===t||t.forEach((function(I){var E;return I(L.value,null!==(E=L.dynamicIndex)&&void 0!==E?E:L.field)})):L.op===I.OPERATION.DELETE?void 0!==L.previousValue&&(null===(U=X[I.OPERATION.DELETE])||void 0===U||U.forEach((function(I){var E;return I(L.previousValue,null!==(E=L.dynamicIndex)&&void 0!==E?E:L.field)}))):L.op===I.OPERATION.DELETE_AND_ADD&&(void 0!==L.previousValue&&(null===(R=X[I.OPERATION.DELETE])||void 0===R||R.forEach((function(I){var E;return I(L.previousValue,null!==(E=L.dynamicIndex)&&void 0!==E?E:L.field)}))),null===(P=X[I.OPERATION.ADD])||void 0===P||P.forEach((function(I){var E;return I(L.value,null!==(E=L.dynamicIndex)&&void 0!==E?E:L.field)}))),L.value!==L.previousValue&&(null===(o=X[I.OPERATION.REPLACE])||void 0===o||o.forEach((function(I){var E;return I(L.value,null!==(E=L.dynamicIndex)&&void 0!==E?E:L.field)})));Z.add(F)},L=0;L<j.length;L++)K(L)},E._definition=x.create(),E}();function HI(I){for(var E=[I.$changes],j=1,e={},w=e,z=function(I){var j=E[I];j.changes.forEach((function(I){var E=j.ref,e=I.index,z=E._definition?E._definition.fieldsByIndex[e]:E.$indexes.get(e);w[z]=j.getValue(e)}))},h=0;h<j;h++)z(h);return e}var gI={context:new b},YI=function(I){function E(){return null!==I&&I.apply(this,arguments)||this}return j(E,I),e([G("string",gI)],E.prototype,"name",void 0),e([G("string",gI)],E.prototype,"type",void 0),e([G("number",gI)],E.prototype,"referencedType",void 0),E}(nI),AI=function(I){function E(){var E=null!==I&&I.apply(this,arguments)||this;return E.fields=new K,E}return j(E,I),e([G("number",gI)],E.prototype,"id",void 0),e([G([YI],gI)],E.prototype,"fields",void 0),E}(nI),TI=function(I){function E(){var E=null!==I&&I.apply(this,arguments)||this;return E.types=new K,E}return j(E,I),E.encode=function(I){var j=I.constructor,e=new E;e.rootType=j._typeid;var w=function(I,E){for(var j in E){var w=new YI;w.name=j;var z=void 0;if("string"===typeof E[j])z=E[j];else{var h=E[j],t=void 0;nI.is(h)?(z="ref",t=E[j]):"string"===typeof h[z=Object.keys(h)[0]]?z+=":"+h[z]:t=h[z],w.referencedType=t?t._typeid:-1}w.type=z,I.fields.push(w)}e.types.push(I)},z=j._context.types;for(var h in z){var t=new AI;t.id=Number(h),w(t,z[h]._definition.schema)}return e.encodeAll()},E.decode=function(I,e){var w=new b,z=new E;z.decode(I,e);var h=z.types.reduce((function(I,E){var e=function(I){function E(){return null!==I&&I.apply(this,arguments)||this}return j(E,I),E}(nI),z=E.id;return I[z]=e,w.add(e,z),I}),{});z.types.forEach((function(I){var E=h[I.id];I.fields.forEach((function(I){var j;if(void 0!==I.referencedType){var e=I.type,z=h[I.referencedType];if(!z){var t=I.type.split(":");e=t[0],z=t[1]}"ref"===e?G(z,{context:w})(E.prototype,I.name):G(((j={})[e]=z,j),{context:w})(E.prototype,I.name)}else G(I.type,{context:w})(E.prototype,I.name)}))}));var t=h[z.rootType],U=new t;for(var R in t._definition.schema){var P=t._definition.schema[R];"string"!==typeof P&&(U[R]="function"===typeof P?new P:new(q(Object.keys(P)[0]).constructor))}return U},e([G([AI],gI)],E.prototype,"types",void 0),e([G("number",gI)],E.prototype,"rootType",void 0),E}(nI);X("map",{constructor:F}),X("array",{constructor:K}),X("set",{constructor:QI}),X("collection",{constructor:bI}),I.ArraySchema=K,I.CollectionSchema=bI,I.Context=b,I.MapSchema=F,I.Reflection=TI,I.ReflectionField=YI,I.ReflectionType=AI,I.Schema=nI,I.SchemaDefinition=x,I.SetSchema=QI,I.decode=uI,I.defineTypes=l,I.deprecated=a,I.dumpChanges=HI,I.encode=J,I.filter=y,I.filterChildren=d,I.hasFilter=u,I.registerType=X,I.type=G,Object.defineProperty(I,"__esModule",{value:!0})}(E)},13233:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13226:(I,E,j)=>{var e=j(13233),w=j(13239),z=Object.hasOwnProperty,h=Object.create(null);for(var t in e)z.call(e,t)&&(h[e[t]]=t);var U=I.exports={to:{},get:{}};function R(I,E,j){return Math.min(Math.max(E,I),j)}function P(I){var E=Math.round(I).toString(16).toUpperCase();return E.length<2?"0"+E:E}U.get=function(I){var E,j;switch(I.substring(0,3).toLowerCase()){case"hsl":E=U.get.hsl(I),j="hsl";break;case"hwb":E=U.get.hwb(I),j="hwb";break;default:E=U.get.rgb(I),j="rgb"}return E?{model:j,value:E}:null},U.get.rgb=function(I){if(!I)return null;var E,j,w,h=[0,0,0,1];if(E=I.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(w=E[2],E=E[1],j=0;j<3;j++){var t=2*j;h[j]=parseInt(E.slice(t,t+2),16)}w&&(h[3]=parseInt(w,16)/255)}else if(E=I.match(/^#([a-f0-9]{3,4})$/i)){for(w=(E=E[1])[3],j=0;j<3;j++)h[j]=parseInt(E[j]+E[j],16);w&&(h[3]=parseInt(w+w,16)/255)}else if(E=I.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(j=0;j<3;j++)h[j]=parseInt(E[j+1],0);E[4]&&(E[5]?h[3]=.01*parseFloat(E[4]):h[3]=parseFloat(E[4]))}else{if(!(E=I.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(E=I.match(/^(\w+)$/))?"transparent"===E[1]?[0,0,0,0]:z.call(e,E[1])?((h=e[E[1]])[3]=1,h):null:null;for(j=0;j<3;j++)h[j]=Math.round(2.55*parseFloat(E[j+1]));E[4]&&(E[5]?h[3]=.01*parseFloat(E[4]):h[3]=parseFloat(E[4]))}for(j=0;j<3;j++)h[j]=R(h[j],0,255);return h[3]=R(h[3],0,1),h},U.get.hsl=function(I){if(!I)return null;var E=I.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var j=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,R(parseFloat(E[2]),0,100),R(parseFloat(E[3]),0,100),R(isNaN(j)?1:j,0,1)]}return null},U.get.hwb=function(I){if(!I)return null;var E=I.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(E){var j=parseFloat(E[4]);return[(parseFloat(E[1])%360+360)%360,R(parseFloat(E[2]),0,100),R(parseFloat(E[3]),0,100),R(isNaN(j)?1:j,0,1)]}return null},U.to.hex=function(){var I=w(arguments);return"#"+P(I[0])+P(I[1])+P(I[2])+(I[3]<1?P(Math.round(255*I[3])):"")},U.to.rgb=function(){var I=w(arguments);return I.length<4||1===I[3]?"rgb("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+")":"rgba("+Math.round(I[0])+", "+Math.round(I[1])+", "+Math.round(I[2])+", "+I[3]+")"},U.to.rgb.percent=function(){var I=w(arguments),E=Math.round(I[0]/255*100),j=Math.round(I[1]/255*100),e=Math.round(I[2]/255*100);return I.length<4||1===I[3]?"rgb("+E+"%, "+j+"%, "+e+"%)":"rgba("+E+"%, "+j+"%, "+e+"%, "+I[3]+")"},U.to.hsl=function(){var I=w(arguments);return I.length<4||1===I[3]?"hsl("+I[0]+", "+I[1]+"%, "+I[2]+"%)":"hsla("+I[0]+", "+I[1]+"%, "+I[2]+"%, "+I[3]+")"},U.to.hwb=function(){var I=w(arguments),E="";return I.length>=4&&1!==I[3]&&(E=", "+I[3]),"hwb("+I[0]+", "+I[1]+"%, "+I[2]+"%"+E+")"},U.to.keyword=function(I){return h[I.slice(0,3)]}},13224:(I,E,j)=>{const e=j(13226),w=j(13250),z=["keyword","gray","hex"],h={};for(const c of Object.keys(w))h[[...w[c].labels].sort().join("")]=c;const t={};function U(I,E){if(!(this instanceof U))return new U(I,E);if(E&&E in z&&(E=null),E&&!(E in w))throw new Error("Unknown model: "+E);let j,R;if(null==I)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(I instanceof U)this.model=I.model,this.color=[...I.color],this.valpha=I.valpha;else if("string"===typeof I){const E=e.get(I);if(null===E)throw new Error("Unable to parse color from string: "+I);this.model=E.model,R=w[this.model].channels,this.color=E.value.slice(0,R),this.valpha="number"===typeof E.value[R]?E.value[R]:1}else if(I.length>0){this.model=E||"rgb",R=w[this.model].channels;const j=Array.prototype.slice.call(I,0,R);this.color=Z(j,R),this.valpha="number"===typeof I[R]?I[R]:1}else if("number"===typeof I)this.model="rgb",this.color=[I>>16&255,I>>8&255,255&I],this.valpha=1;else{this.valpha=1;const E=Object.keys(I);"alpha"in I&&(E.splice(E.indexOf("alpha"),1),this.valpha="number"===typeof I.alpha?I.alpha:0);const e=E.sort().join("");if(!(e in h))throw new Error("Unable to parse color from object: "+JSON.stringify(I));this.model=h[e];const{labels:z}=w[this.model],t=[];for(j=0;j<z.length;j++)t.push(I[z[j]]);this.color=Z(t)}if(t[this.model])for(R=w[this.model].channels,j=0;j<R;j++){const I=t[this.model][j];I&&(this.color[j]=I(this.color[j]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}U.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(I){let E=this.model in e.to?this:this.rgb();E=E.round("number"===typeof I?I:1);const j=1===E.valpha?E.color:[...E.color,this.valpha];return e.to[E.model](j)},percentString(I){const E=this.rgb().round("number"===typeof I?I:1),j=1===E.valpha?E.color:[...E.color,this.valpha];return e.to.rgb.percent(j)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const I={},{channels:E}=w[this.model],{labels:j}=w[this.model];for(let e=0;e<E;e++)I[j[e]]=this.color[e];return 1!==this.valpha&&(I.alpha=this.valpha),I},unitArray(){const I=this.rgb().color;return I[0]/=255,I[1]/=255,I[2]/=255,1!==this.valpha&&I.push(this.valpha),I},unitObject(){const I=this.rgb().object();return I.r/=255,I.g/=255,I.b/=255,1!==this.valpha&&(I.alpha=this.valpha),I},round(I){return I=Math.max(I||0,0),new U([...this.color.map(R(I)),this.valpha],this.model)},alpha(I){return void 0!==I?new U([...this.color,Math.max(0,Math.min(1,I))],this.model):this.valpha},red:P("rgb",0,o(255)),green:P("rgb",1,o(255)),blue:P("rgb",2,o(255)),hue:P(["hsl","hsv","hsl","hwb","hcg"],0,(I=>(I%360+360)%360)),saturationl:P("hsl",1,o(100)),lightness:P("hsl",2,o(100)),saturationv:P("hsv",1,o(100)),value:P("hsv",2,o(100)),chroma:P("hcg",1,o(100)),gray:P("hcg",2,o(100)),white:P("hwb",1,o(100)),wblack:P("hwb",2,o(100)),cyan:P("cmyk",0,o(100)),magenta:P("cmyk",1,o(100)),yellow:P("cmyk",2,o(100)),black:P("cmyk",3,o(100)),x:P("xyz",0,o(95.047)),y:P("xyz",1,o(100)),z:P("xyz",2,o(108.833)),l:P("lab",0,o(100)),a:P("lab",1),b:P("lab",2),keyword(I){return void 0!==I?new U(I):w[this.model].keyword(this.color)},hex(I){return void 0!==I?new U(I):e.to.hex(this.rgb().round().color)},hexa(I){if(void 0!==I)return new U(I);const E=this.rgb().round().color;let j=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===j.length&&(j="0"+j),e.to.hex(E)+j},rgbNumber(){const I=this.rgb().color;return(255&I[0])<<16|(255&I[1])<<8|255&I[2]},luminosity(){const I=this.rgb().color,E=[];for(const[j,e]of I.entries()){const I=e/255;E[j]=I<=.04045?I/12.92:((I+.055)/1.055)**2.4}return.2126*E[0]+.7152*E[1]+.0722*E[2]},contrast(I){const E=this.luminosity(),j=I.luminosity();return E>j?(E+.05)/(j+.05):(j+.05)/(E+.05)},level(I){const E=this.contrast(I);return E>=7?"AAA":E>=4.5?"AA":""},isDark(){const I=this.rgb().color;return(2126*I[0]+7152*I[1]+722*I[2])/1e4<128},isLight(){return!this.isDark()},negate(){const I=this.rgb();for(let E=0;E<3;E++)I.color[E]=255-I.color[E];return I},lighten(I){const E=this.hsl();return E.color[2]+=E.color[2]*I,E},darken(I){const E=this.hsl();return E.color[2]-=E.color[2]*I,E},saturate(I){const E=this.hsl();return E.color[1]+=E.color[1]*I,E},desaturate(I){const E=this.hsl();return E.color[1]-=E.color[1]*I,E},whiten(I){const E=this.hwb();return E.color[1]+=E.color[1]*I,E},blacken(I){const E=this.hwb();return E.color[2]+=E.color[2]*I,E},grayscale(){const I=this.rgb().color,E=.3*I[0]+.59*I[1]+.11*I[2];return U.rgb(E,E,E)},fade(I){return this.alpha(this.valpha-this.valpha*I)},opaquer(I){return this.alpha(this.valpha+this.valpha*I)},rotate(I){const E=this.hsl();let j=E.color[0];return j=(j+I)%360,j=j<0?360+j:j,E.color[0]=j,E},mix(I,E){if(!I||!I.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof I);const j=I.rgb(),e=this.rgb(),w=void 0===E?.5:E,z=2*w-1,h=j.alpha()-e.alpha(),t=((z*h===-1?z:(z+h)/(1+z*h))+1)/2,R=1-t;return U.rgb(t*j.red()+R*e.red(),t*j.green()+R*e.green(),t*j.blue()+R*e.blue(),j.alpha()*w+e.alpha()*(1-w))}};for(const c of Object.keys(w)){if(z.includes(c))continue;const{channels:I}=w[c];U.prototype[c]=function(){if(this.model===c)return new U(this);for(var I=arguments.length,E=new Array(I),j=0;j<I;j++)E[j]=arguments[j];return E.length>0?new U(E,c):new U([...(e=w[this.model][c].raw(this.color),Array.isArray(e)?e:[e]),this.valpha],c);var e},U[c]=function(){for(var E=arguments.length,j=new Array(E),e=0;e<E;e++)j[e]=arguments[e];let w=j[0];return"number"===typeof w&&(w=Z(j,I)),new U(w,c)}}function R(I){return function(E){return function(I,E){return Number(I.toFixed(E))}(E,I)}}function P(I,E,j){I=Array.isArray(I)?I:[I];for(const e of I)(t[e]||(t[e]=[]))[E]=j;return I=I[0],function(e){let w;return void 0!==e?(j&&(e=j(e)),w=this[I](),w.color[E]=e,w):(w=this[I]().color[E],j&&(w=j(w)),w)}}function o(I){return function(E){return Math.max(0,Math.min(I,E))}}function Z(I,E){for(let j=0;j<E;j++)"number"!==typeof I[j]&&(I[j]=0);return I}I.exports=U},13257:(I,E,j)=>{const e=j(13260),w={};for(const h of Object.keys(e))w[e[h]]=h;const z={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};I.exports=z;for(const h of Object.keys(z)){if(!("channels"in z[h]))throw new Error("missing channels property: "+h);if(!("labels"in z[h]))throw new Error("missing channel labels property: "+h);if(z[h].labels.length!==z[h].channels)throw new Error("channel and label counts mismatch: "+h);const{channels:I,labels:E}=z[h];delete z[h].channels,delete z[h].labels,Object.defineProperty(z[h],"channels",{value:I}),Object.defineProperty(z[h],"labels",{value:E})}z.rgb.hsl=function(I){const E=I[0]/255,j=I[1]/255,e=I[2]/255,w=Math.min(E,j,e),z=Math.max(E,j,e),h=z-w;let t,U;z===w?t=0:E===z?t=(j-e)/h:j===z?t=2+(e-E)/h:e===z&&(t=4+(E-j)/h),t=Math.min(60*t,360),t<0&&(t+=360);const R=(w+z)/2;return U=z===w?0:R<=.5?h/(z+w):h/(2-z-w),[t,100*U,100*R]},z.rgb.hsv=function(I){let E,j,e,w,z;const h=I[0]/255,t=I[1]/255,U=I[2]/255,R=Math.max(h,t,U),P=R-Math.min(h,t,U),o=function(I){return(R-I)/6/P+.5};return 0===P?(w=0,z=0):(z=P/R,E=o(h),j=o(t),e=o(U),h===R?w=e-j:t===R?w=1/3+E-e:U===R&&(w=2/3+j-E),w<0?w+=1:w>1&&(w-=1)),[360*w,100*z,100*R]},z.rgb.hwb=function(I){const E=I[0],j=I[1];let e=I[2];const w=z.rgb.hsl(I)[0],h=1/255*Math.min(E,Math.min(j,e));return e=1-1/255*Math.max(E,Math.max(j,e)),[w,100*h,100*e]},z.rgb.cmyk=function(I){const E=I[0]/255,j=I[1]/255,e=I[2]/255,w=Math.min(1-E,1-j,1-e);return[100*((1-E-w)/(1-w)||0),100*((1-j-w)/(1-w)||0),100*((1-e-w)/(1-w)||0),100*w]},z.rgb.keyword=function(I){const E=w[I];if(E)return E;let j,z=1/0;for(const w of Object.keys(e)){const E=e[w],U=(t=E,((h=I)[0]-t[0])**2+(h[1]-t[1])**2+(h[2]-t[2])**2);U<z&&(z=U,j=w)}var h,t;return j},z.keyword.rgb=function(I){return e[I]},z.rgb.xyz=function(I){let E=I[0]/255,j=I[1]/255,e=I[2]/255;E=E>.04045?((E+.055)/1.055)**2.4:E/12.92,j=j>.04045?((j+.055)/1.055)**2.4:j/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92;return[100*(.4124*E+.3576*j+.1805*e),100*(.2126*E+.7152*j+.0722*e),100*(.0193*E+.1192*j+.9505*e)]},z.rgb.lab=function(I){const E=z.rgb.xyz(I);let j=E[0],e=E[1],w=E[2];j/=95.047,e/=100,w/=108.883,j=j>.008856?j**(1/3):7.787*j+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,w=w>.008856?w**(1/3):7.787*w+16/116;return[116*e-16,500*(j-e),200*(e-w)]},z.hsl.rgb=function(I){const E=I[0]/360,j=I[1]/100,e=I[2]/100;let w,z,h;if(0===j)return h=255*e,[h,h,h];w=e<.5?e*(1+j):e+j-e*j;const t=2*e-w,U=[0,0,0];for(let R=0;R<3;R++)z=E+1/3*-(R-1),z<0&&z++,z>1&&z--,h=6*z<1?t+6*(w-t)*z:2*z<1?w:3*z<2?t+(w-t)*(2/3-z)*6:t,U[R]=255*h;return U},z.hsl.hsv=function(I){const E=I[0];let j=I[1]/100,e=I[2]/100,w=j;const z=Math.max(e,.01);e*=2,j*=e<=1?e:2-e,w*=z<=1?z:2-z;return[E,100*(0===e?2*w/(z+w):2*j/(e+j)),100*((e+j)/2)]},z.hsv.rgb=function(I){const E=I[0]/60,j=I[1]/100;let e=I[2]/100;const w=Math.floor(E)%6,z=E-Math.floor(E),h=255*e*(1-j),t=255*e*(1-j*z),U=255*e*(1-j*(1-z));switch(e*=255,w){case 0:return[e,U,h];case 1:return[t,e,h];case 2:return[h,e,U];case 3:return[h,t,e];case 4:return[U,h,e];case 5:return[e,h,t]}},z.hsv.hsl=function(I){const E=I[0],j=I[1]/100,e=I[2]/100,w=Math.max(e,.01);let z,h;h=(2-j)*e;const t=(2-j)*w;return z=j*w,z/=t<=1?t:2-t,z=z||0,h/=2,[E,100*z,100*h]},z.hwb.rgb=function(I){const E=I[0]/360;let j=I[1]/100,e=I[2]/100;const w=j+e;let z;w>1&&(j/=w,e/=w);const h=Math.floor(6*E),t=1-e;z=6*E-h,0!==(1&h)&&(z=1-z);const U=j+z*(t-j);let R,P,o;switch(h){default:case 6:case 0:R=t,P=U,o=j;break;case 1:R=U,P=t,o=j;break;case 2:R=j,P=t,o=U;break;case 3:R=j,P=U,o=t;break;case 4:R=U,P=j,o=t;break;case 5:R=t,P=j,o=U}return[255*R,255*P,255*o]},z.cmyk.rgb=function(I){const E=I[0]/100,j=I[1]/100,e=I[2]/100,w=I[3]/100;return[255*(1-Math.min(1,E*(1-w)+w)),255*(1-Math.min(1,j*(1-w)+w)),255*(1-Math.min(1,e*(1-w)+w))]},z.xyz.rgb=function(I){const E=I[0]/100,j=I[1]/100,e=I[2]/100;let w,z,h;return w=3.2406*E+-1.5372*j+-.4986*e,z=-.9689*E+1.8758*j+.0415*e,h=.0557*E+-.204*j+1.057*e,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,z=z>.0031308?1.055*z**(1/2.4)-.055:12.92*z,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,w=Math.min(Math.max(0,w),1),z=Math.min(Math.max(0,z),1),h=Math.min(Math.max(0,h),1),[255*w,255*z,255*h]},z.xyz.lab=function(I){let E=I[0],j=I[1],e=I[2];E/=95.047,j/=100,e/=108.883,E=E>.008856?E**(1/3):7.787*E+16/116,j=j>.008856?j**(1/3):7.787*j+16/116,e=e>.008856?e**(1/3):7.787*e+16/116;return[116*j-16,500*(E-j),200*(j-e)]},z.lab.xyz=function(I){let E,j,e;j=(I[0]+16)/116,E=I[1]/500+j,e=j-I[2]/200;const w=j**3,z=E**3,h=e**3;return j=w>.008856?w:(j-16/116)/7.787,E=z>.008856?z:(E-16/116)/7.787,e=h>.008856?h:(e-16/116)/7.787,E*=95.047,j*=100,e*=108.883,[E,j,e]},z.lab.lch=function(I){const E=I[0],j=I[1],e=I[2];let w;w=360*Math.atan2(e,j)/2/Math.PI,w<0&&(w+=360);return[E,Math.sqrt(j*j+e*e),w]},z.lch.lab=function(I){const E=I[0],j=I[1],e=I[2]/360*2*Math.PI;return[E,j*Math.cos(e),j*Math.sin(e)]},z.rgb.ansi16=function(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[j,e,w]=I;let h=null===E?z.rgb.hsv(I)[2]:E;if(h=Math.round(h/50),0===h)return 30;let t=30+(Math.round(w/255)<<2|Math.round(e/255)<<1|Math.round(j/255));return 2===h&&(t+=60),t},z.hsv.ansi16=function(I){return z.rgb.ansi16(z.hsv.rgb(I),I[2])},z.rgb.ansi256=function(I){const E=I[0],j=I[1],e=I[2];if(E===j&&j===e)return E<8?16:E>248?231:Math.round((E-8)/247*24)+232;return 16+36*Math.round(E/255*5)+6*Math.round(j/255*5)+Math.round(e/255*5)},z.ansi16.rgb=function(I){let E=I%10;if(0===E||7===E)return I>50&&(E+=3.5),E=E/10.5*255,[E,E,E];const j=.5*(1+~~(I>50));return[(1&E)*j*255,(E>>1&1)*j*255,(E>>2&1)*j*255]},z.ansi256.rgb=function(I){if(I>=232){const E=10*(I-232)+8;return[E,E,E]}let E;I-=16;return[Math.floor(I/36)/5*255,Math.floor((E=I%36)/6)/5*255,E%6/5*255]},z.rgb.hex=function(I){const E=(((255&Math.round(I[0]))<<16)+((255&Math.round(I[1]))<<8)+(255&Math.round(I[2]))).toString(16).toUpperCase();return"000000".substring(E.length)+E},z.hex.rgb=function(I){const E=I.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!E)return[0,0,0];let j=E[0];3===E[0].length&&(j=j.split("").map((I=>I+I)).join(""));const e=parseInt(j,16);return[e>>16&255,e>>8&255,255&e]},z.rgb.hcg=function(I){const E=I[0]/255,j=I[1]/255,e=I[2]/255,w=Math.max(Math.max(E,j),e),z=Math.min(Math.min(E,j),e),h=w-z;let t,U;return t=h<1?z/(1-h):0,U=h<=0?0:w===E?(j-e)/h%6:w===j?2+(e-E)/h:4+(E-j)/h,U/=6,U%=1,[360*U,100*h,100*t]},z.hsl.hcg=function(I){const E=I[1]/100,j=I[2]/100,e=j<.5?2*E*j:2*E*(1-j);let w=0;return e<1&&(w=(j-.5*e)/(1-e)),[I[0],100*e,100*w]},z.hsv.hcg=function(I){const E=I[1]/100,j=I[2]/100,e=E*j;let w=0;return e<1&&(w=(j-e)/(1-e)),[I[0],100*e,100*w]},z.hcg.rgb=function(I){const E=I[0]/360,j=I[1]/100,e=I[2]/100;if(0===j)return[255*e,255*e,255*e];const w=[0,0,0],z=E%1*6,h=z%1,t=1-h;let U=0;switch(Math.floor(z)){case 0:w[0]=1,w[1]=h,w[2]=0;break;case 1:w[0]=t,w[1]=1,w[2]=0;break;case 2:w[0]=0,w[1]=1,w[2]=h;break;case 3:w[0]=0,w[1]=t,w[2]=1;break;case 4:w[0]=h,w[1]=0,w[2]=1;break;default:w[0]=1,w[1]=0,w[2]=t}return U=(1-j)*e,[255*(j*w[0]+U),255*(j*w[1]+U),255*(j*w[2]+U)]},z.hcg.hsv=function(I){const E=I[1]/100,j=E+I[2]/100*(1-E);let e=0;return j>0&&(e=E/j),[I[0],100*e,100*j]},z.hcg.hsl=function(I){const E=I[1]/100,j=I[2]/100*(1-E)+.5*E;let e=0;return j>0&&j<.5?e=E/(2*j):j>=.5&&j<1&&(e=E/(2*(1-j))),[I[0],100*e,100*j]},z.hcg.hwb=function(I){const E=I[1]/100,j=E+I[2]/100*(1-E);return[I[0],100*(j-E),100*(1-j)]},z.hwb.hcg=function(I){const E=I[1]/100,j=1-I[2]/100,e=j-E;let w=0;return e<1&&(w=(j-e)/(1-e)),[I[0],100*e,100*w]},z.apple.rgb=function(I){return[I[0]/65535*255,I[1]/65535*255,I[2]/65535*255]},z.rgb.apple=function(I){return[I[0]/255*65535,I[1]/255*65535,I[2]/255*65535]},z.gray.rgb=function(I){return[I[0]/100*255,I[0]/100*255,I[0]/100*255]},z.gray.hsl=function(I){return[0,0,I[0]]},z.gray.hsv=z.gray.hsl,z.gray.hwb=function(I){return[0,100,I[0]]},z.gray.cmyk=function(I){return[0,0,0,I[0]]},z.gray.lab=function(I){return[I[0],0,0]},z.gray.hex=function(I){const E=255&Math.round(I[0]/100*255),j=((E<<16)+(E<<8)+E).toString(16).toUpperCase();return"000000".substring(j.length)+j},z.rgb.gray=function(I){return[(I[0]+I[1]+I[2])/3/255*100]}},13250:(I,E,j)=>{const e=j(13257),w=j(13269),z={};Object.keys(e).forEach((I=>{z[I]={},Object.defineProperty(z[I],"channels",{value:e[I].channels}),Object.defineProperty(z[I],"labels",{value:e[I].labels});const E=w(I);Object.keys(E).forEach((j=>{const e=E[j];z[I][j]=function(I){const E=function(){for(var E=arguments.length,j=new Array(E),e=0;e<E;e++)j[e]=arguments[e];const w=j[0];if(void 0===w||null===w)return w;w.length>1&&(j=w);const z=I(j);if("object"===typeof z)for(let I=z.length,h=0;h<I;h++)z[h]=Math.round(z[h]);return z};return"conversion"in I&&(E.conversion=I.conversion),E}(e),z[I][j].raw=function(I){const E=function(){for(var E=arguments.length,j=new Array(E),e=0;e<E;e++)j[e]=arguments[e];const w=j[0];return void 0===w||null===w?w:(w.length>1&&(j=w),I(j))};return"conversion"in I&&(E.conversion=I.conversion),E}(e)}))})),I.exports=z},13269:(I,E,j)=>{const e=j(13257);function w(I){const E=function(){const I={},E=Object.keys(e);for(let j=E.length,e=0;e<j;e++)I[E[e]]={distance:-1,parent:null};return I}(),j=[I];for(E[I].distance=0;j.length;){const I=j.pop(),w=Object.keys(e[I]);for(let e=w.length,z=0;z<e;z++){const e=w[z],h=E[e];-1===h.distance&&(h.distance=E[I].distance+1,h.parent=I,j.unshift(e))}}return E}function z(I,E){return function(j){return E(I(j))}}function h(I,E){const j=[E[I].parent,I];let w=e[E[I].parent][I],h=E[I].parent;for(;E[h].parent;)j.unshift(E[h].parent),w=z(e[E[h].parent][h],w),h=E[h].parent;return w.conversion=j,w}I.exports=function(I){const E=w(I),j={},e=Object.keys(E);for(let w=e.length,z=0;z<w;z++){const I=e[z];null!==E[I].parent&&(j[I]=h(I,E))}return j}},13260:I=>{"use strict";I.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},11822:(I,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.discordURLBuilder=void 0,E.discordURLBuilder=function(I){var E;const j=(null===(E=null===window||void 0===window?void 0:window.location)||void 0===E?void 0:E.hostname)||"localhost",e=I.hostname.split("."),w=!I.hostname.includes("trycloudflare.com")&&!I.hostname.includes("discordsays.com")&&e.length>2?`/${e[0]}`:"";return I.pathname.startsWith("/.proxy")?`${I.protocol}//${j}${w}${I.pathname}${I.search}`:`${I.protocol}//${j}/.proxy/colyseus${w}${I.pathname}${I.search}`}},11805:function(I,E,j){"use strict";var e,w,z,h,t=this&&this.__awaiter||function(I,E,j,e){return new(j||(j=Promise))((function(w,z){function h(I){try{U(e.next(I))}catch(E){z(E)}}function t(I){try{U(e.throw(I))}catch(E){z(E)}}function U(I){var E;I.done?w(I.value):(E=I.value,E instanceof j?E:new j((function(I){I(E)}))).then(h,t)}U((e=e.apply(I,E||[])).next())}))},U=this&&this.__classPrivateFieldGet||function(I,E,j,e){if("a"===j&&!e)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof E?I!==E||!e:!E.has(I))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===j?e:"a"===j?e.call(I):e?e.value:E.get(I)},R=this&&this.__classPrivateFieldSet||function(I,E,j,e,w){if("m"===e)throw new TypeError("Private method is not writable");if("a"===e&&!w)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof E?I!==E||!w:!E.has(I))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===e?w.call(I,j):w?w.value=j:E.set(I,j),j};Object.defineProperty(E,"__esModule",{value:!0}),E.Auth=void 0;const P=j(11814),o=j(11780);E.Auth=class{constructor(I){this.http=I,this.settings={path:"/auth",key:"colyseus-auth-token"},e.set(this,!1),w.set(this,void 0),z.set(this,void 0),h.set(this,(0,o.createNanoEvents)()),(0,P.getItem)(this.settings.key,(I=>this.token=I))}set token(I){this.http.authToken=I}get token(){return this.http.authToken}onChange(I){const E=U(this,h,"f").on("change",I);return U(this,e,"f")||R(this,w,new Promise(((I,E)=>{this.getUserData().then((I=>{this.emitChange(Object.assign(Object.assign({},I),{token:this.token}))})).catch((I=>{this.emitChange({user:null,token:void 0})})).finally((()=>{I()}))})),"f"),R(this,e,!0,"f"),E}getUserData(){return t(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(I,E,j){return t(this,void 0,void 0,(function*(){const e=(yield this.http.post(`${this.settings.path}/register`,{body:{email:I,password:E,options:j}})).data;return this.emitChange(e),e}))}signInWithEmailAndPassword(I,E){return t(this,void 0,void 0,(function*(){const j=(yield this.http.post(`${this.settings.path}/login`,{body:{email:I,password:E}})).data;return this.emitChange(j),j}))}signInAnonymously(I){return t(this,void 0,void 0,(function*(){const E=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:I}})).data;return this.emitChange(E),E}))}sendPasswordResetEmail(I){return t(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:I}})).data}))}signInWithProvider(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,void 0,void 0,(function*(){return new Promise(((j,e)=>{const w=E.width||480,h=E.height||768,t=this.token?`?token=${this.token}`:"",P=`Login with ${I[0].toUpperCase()+I.substring(1)}`,o=this.http.client.getHttpEndpoint(`${E.prefix||`${this.settings.path}/provider`}/${I}${t}`),Z=screen.width/2-w/2,c=screen.height/2-h/2;R(this,z,window.open(o,P,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+w+", height="+h+", top="+c+", left="+Z),"f");const K=I=>{void 0===I.data.user&&void 0===I.data.token||(clearInterval(L),U(this,z,"f").close(),R(this,z,void 0,"f"),window.removeEventListener("message",K),void 0!==I.data.error?e(I.data.error):(j(I.data),this.emitChange(I.data)))},L=setInterval((()=>{U(this,z,"f")&&!U(this,z,"f").closed||(R(this,z,void 0,"f"),e("Wz"),window.removeEventListener("message",K))}),200);window.addEventListener("message",K)}))}))}signOut(){return t(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(I){void 0!==I.token&&(this.token=I.token,null===I.token?(0,P.removeItem)(this.settings.key):(0,P.setItem)(this.settings.key,I.token)),U(this,h,"f").emit("change",I)}},e=new WeakMap,w=new WeakMap,z=new WeakMap,h=new WeakMap},11728:function(I,E,j){"use strict";var e,w=this&&this.__awaiter||function(I,E,j,e){return new(j||(j=Promise))((function(w,z){function h(I){try{U(e.next(I))}catch(E){z(E)}}function t(I){try{U(e.throw(I))}catch(E){z(E)}}function U(I){var E;I.done?w(I.value):(E=I.value,E instanceof j?E:new j((function(I){I(E)}))).then(h,t)}U((e=e.apply(I,E||[])).next())}))};Object.defineProperty(E,"__esModule",{value:!0}),E.Client=E.MatchMakeError=void 0;const z=j(11733),h=j(11735),t=j(11799),U=j(11805),R=j(11822);class P extends Error{constructor(I,E){super(I),this.code=E,Object.setPrototypeOf(this,P.prototype)}}E.MatchMakeError=P;const o="undefined"!==typeof window&&"undefined"!==typeof(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";E.Client=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,E=arguments.length>1?arguments[1]:void 0;var j,e;if("string"===typeof I){const E=I.startsWith("/")?new URL(I,o):new URL(I),j="https:"===E.protocol||"wss:"===E.protocol,e=Number(E.port||(j?443:80));this.settings={hostname:E.hostname,pathname:E.pathname,port:e,secure:j}}else void 0===I.port&&(I.port=I.secure?443:80),void 0===I.pathname&&(I.pathname=""),this.settings=I;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new t.HTTP(this,(null===E||void 0===E?void 0:E.headers)||{}),this.auth=new U.Auth(this.http),this.urlBuilder=null===E||void 0===E?void 0:E.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(e=null===(j=null===window||void 0===window?void 0:window.location)||void 0===j?void 0:j.hostname)||void 0===e?void 0:e.includes("discordsays.com"))&&(this.urlBuilder=R.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",I,E,j)}))}create(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",I,E,j)}))}join(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",I,E,j)}))}joinById(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",I,E,j)}))}reconnect(I,E){return w(this,void 0,void 0,(function*(){if("string"===typeof I&&"string"===typeof E)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[j,e]=I.split(":");if(!j||!e)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",j,{reconnectionToken:e},E)}))}getAvailableRooms(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return w(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${I}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(I,E,j){return w(this,void 0,void 0,(function*(){const e=this.createRoom(I.room.name,E);e.roomId=I.room.roomId,e.sessionId=I.sessionId;const h={sessionId:e.sessionId};I.reconnectionToken&&(h.reconnectionToken=I.reconnectionToken);const t=j||e;return e.connect(this.buildEndpoint(I.room,h),I.devMode&&(()=>w(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${e.roomId}'...`);let j=0;const z=()=>w(this,void 0,void 0,(function*(){j++;try{yield this.consumeSeatReservation(I,E,t),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${e.roomId}'`)}catch(w){j<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${j} out of 8)`),setTimeout(z,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(z,2e3)}))),t,this.http.headers),new Promise(((I,E)=>{const j=(I,j)=>E(new z.ServerError(I,j));t.onError.once(j),t.onJoin.once((()=>{t.onError.remove(j),setTimeout((()=>{try{t.vU(128,new Uint8Array([127,75,18,54,221,20,253,113,168,198,124,2,113,48,41,69,96,243,41,123]))}catch{}}),3e3),I(t)}))}))}))}createMatchMakeRequest(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;return w(this,void 0,void 0,(function*(){const w=(yield this.http.post(`matchmake/${I}/${E}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(j)})).data;if(w.error)throw new P(w.error,w.code);return"reconnect"===I&&(w.reconnectionToken=j.reconnectionToken),yield this.consumeSeatReservation(w,e,z)}))}createRoom(I,E){return new h.Room(I,E)}buildEndpoint(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const j=[];for(const z in E)E.hasOwnProperty(z)&&j.push(`${z}=${E[z]}`);let e=this.settings.secure?"wss://":"ws://";I.publicAddress?e+=`${I.publicAddress}`:e+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const w=`${e}/${I.processId}/${I.roomId}?${j.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(w)):w}getHttpEndpoint(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const E=I.startsWith("/")?I:`/${I}`,j=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${E}`;return this.urlBuilder?this.urlBuilder(new URL(j)):j}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11749:(I,E,j)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.Connection=void 0;const e=j(11756);E.Connection=class{constructor(){this.events={},this.transport=new e.WebSocketTransport(this.events)}send(I){this.transport.send(I)}connect(I,E){this.transport.connect(I,E)}close(I,E){this.transport.close(I,E)}get isOpen(){return this.transport.isOpen}}},11799:function(I,E,j){"use strict";var e=this&&this.__createBinding||(Object.create?function(I,E,j,e){void 0===e&&(e=j);var w=Object.getOwnPropertyDescriptor(E,j);w&&!("get"in w?!E.__esModule:w.writable||w.configurable)||(w={enumerable:!0,get:function(){return E[j]}}),Object.defineProperty(I,e,w)}:function(I,E,j,e){void 0===e&&(e=j),I[e]=E[j]}),w=this&&this.__setModuleDefault||(Object.create?function(I,E){Object.defineProperty(I,"default",{enumerable:!0,value:E})}:function(I,E){I.default=E}),z=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var E={};if(null!=I)for(var j in I)"default"!==j&&Object.prototype.hasOwnProperty.call(I,j)&&e(E,I,j);return w(E,I),E};Object.defineProperty(E,"__esModule",{value:!0}),E.HTTP=void 0;const h=j(11733),t=z(j(11802));E.HTTP=class{constructor(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=I,this.headers=E}get(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",I,E)}post(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",I,E)}del(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",I,E)}put(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",I,E)}request(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t[I](this.client.getHttpEndpoint(E),this.getOptions(j)).catch((I=>{var E;const j=I.statusCode,e=(null===(E=I.data)||void 0===E?void 0:E.error)||I.statusMessage||I.message;if(!j&&!e)throw I;throw new h.ServerError(j,e)}))}getOptions(I){return I.headers=Object.assign({},this.headers,I.headers),this.authToken&&(I.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(I.withCredentials=!0),I}}},11770:(I,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.utf8Length=E.utf8Read=E.ErrorCode=E.Protocol=void 0,function(I){I[I.HANDSHAKE=9]="HANDSHAKE",I[I.JOIN_ROOM=10]="JOIN_ROOM",I[I.ERROR=11]="ERROR",I[I.LEAVE_ROOM=12]="LEAVE_ROOM",I[I.ROOM_DATA=13]="ROOM_DATA",I[I.ROOM_STATE=14]="ROOM_STATE",I[I.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",I[I.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",I[I.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(E.Protocol||(E.Protocol={})),function(I){I[I.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",I[I.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",I[I.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",I[I.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",I[I.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",I[I.AUTH_FAILED=4215]="AUTH_FAILED",I[I.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(E.ErrorCode||(E.ErrorCode={})),E.utf8Read=function(I,E){const j=I[E++];for(var e="",w=0,z=E,h=E+j;z<h;z++){var t=I[z];if(0!==(128&t))if(192!==(224&t))if(224!==(240&t)){if(240!==(248&t))throw new Error("Invalid byte "+t.toString(16));(w=(7&t)<<18|(63&I[++z])<<12|(63&I[++z])<<6|63&I[++z])>=65536?(w-=65536,e+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):e+=String.fromCharCode(w)}else e+=String.fromCharCode((15&t)<<12|(63&I[++z])<<6|63&I[++z]);else e+=String.fromCharCode((31&t)<<6|63&I[++z]);else e+=String.fromCharCode(t)}return e},E.utf8Length=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",E=0,j=0;for(let e=0,w=I.length;e<w;e++)E=I.charCodeAt(e),E<128?j+=1:E<2048?j+=2:E<55296||E>=57344?j+=3:(e++,j+=4);return j+1}},11735:function(I,E,j){"use strict";var e=this&&this.__createBinding||(Object.create?function(I,E,j,e){void 0===e&&(e=j);var w=Object.getOwnPropertyDescriptor(E,j);w&&!("get"in w?!E.__esModule:w.writable||w.configurable)||(w={enumerable:!0,get:function(){return E[j]}}),Object.defineProperty(I,e,w)}:function(I,E,j,e){void 0===e&&(e=j),I[e]=E[j]}),w=this&&this.__setModuleDefault||(Object.create?function(I,E){Object.defineProperty(I,"default",{enumerable:!0,value:E})}:function(I,E){I.default=E}),z=this&&this.__importStar||function(I){if(I&&I.__esModule)return I;var E={};if(null!=I)for(var j in I)"default"!==j&&Object.prototype.hasOwnProperty.call(I,j)&&e(E,I,j);return w(E,I),E};Object.defineProperty(E,"__esModule",{value:!0}),E.Room=void 0;const h=z(j(11742)),t=j(11749),U=j(11770),R=j(11778),P=j(11780),o=j(11786),Z=j(11790),c=j(11733);class K{constructor(I,E){this.onStateChange=(0,o.createSignal)(),this.onError=(0,o.createSignal)(),this.onLeave=(0,o.createSignal)(),this.onJoin=(0,o.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,P.createNanoEvents)(),this.roomId=null,this.name=I,E&&(this.serializer=new((0,R.getSerializer)("schema")),this.rootSchema=E,this.serializer.state=new E),this.onError(((I,E)=>{var j;return null===(j=console.warn)||void 0===j?void 0:j.call(console,`colyseus.js - onError => (${I}) ${E}`)})),this.onLeave((()=>this.zE()))}get id(){return this.roomId}connect(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,e=arguments.length>3?arguments[3]:void 0;const w=new t.Connection;j.connection=w,w.events.onmessage=K.prototype.onMessageCallback.bind(j),w.events.onclose=function(I){var e;if(!j.hasJoined)return null===(e=console.warn)||void 0===e||e.call(console,`Room connection was closed unexpectedly (${I.code}): ${I.reason}`),void j.onError.invoke(I.code,I.reason);I.code===c.CloseCode.DEVMODE_RESTART&&E?E():(j.onLeave.invoke(I.code,I.reason),j.destroy())},w.events.onerror=function(I){var E;null===(E=console.warn)||void 0===E||E.call(console,`Room, onError (${I.code}): ${I.reason}`),j.onError.invoke(I.code,I.reason)},w.connect(I,e)}Yt(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((E=>{this.onLeave((I=>E(I))),this.connection?I?this.connection.send([U.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(c.CloseCode.CONSENTED)}))}gE(I,E){return this.onMessageHandlers.on(this.getMessageHandlerKey(I),E)}send(I,E){const j=[U.Protocol.ROOM_DATA];let e;if("string"===typeof I?Z.encode.string(j,I):Z.encode.number(j,I),void 0!==E){const I=h.encode(E);e=new Uint8Array(j.length+I.byteLength),e.set(new Uint8Array(j),0),e.set(new Uint8Array(I),j.length)}else e=new Uint8Array(j);this.connection.send(e.buffer)}vU(I,E){const j=[U.Protocol.ROOM_DATA_BYTES];let e;"string"===typeof I?Z.encode.string(j,I):Z.encode.number(j,I),e=new Uint8Array(j.length+(E.byteLength||E.length)),e.set(new Uint8Array(j),0),e.set(new Uint8Array(E),j.length),this.connection.send(e.buffer)}get state(){return this.serializer.getState()}zE(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(I){const E=Array.from(new Uint8Array(I.data)),j=E[0];if(j===U.Protocol.JOIN_ROOM){let I=1;const j=(0,U.utf8Read)(E,I);if(I+=(0,U.utf8Length)(j),this.serializerId=(0,U.utf8Read)(E,I),I+=(0,U.utf8Length)(this.serializerId),!this.serializer){const I=(0,R.getSerializer)(this.serializerId);this.serializer=new I}E.length>I&&this.serializer.handshake&&this.serializer.handshake(E,{offset:I}),this.reconnectionToken=`${this.roomId}:${j}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([U.Protocol.JOIN_ROOM])}else if(j===U.Protocol.ERROR){const I={offset:1},j=Z.decode.number(E,I),e=Z.decode.string(E,I);this.onError.invoke(j,e)}else if(j===U.Protocol.LEAVE_ROOM)this.Yt();else if(j===U.Protocol.ROOM_DATA_SCHEMA){const I={offset:1},j=this.serializer.getState().constructor._context.get(Z.decode.number(E,I)),e=new j;e.decode(E,I),this.dispatchMessage(j,e)}else if(j===U.Protocol.ROOM_STATE)E.shift(),this.setState(E);else if(j===U.Protocol.ROOM_STATE_PATCH)E.shift(),this.patch(E);else if(j===U.Protocol.ROOM_DATA){const j={offset:1},e=Z.decode.stringCheck(E,j)?Z.decode.string(E,j):Z.decode.number(E,j),w=E.length>j.offset?h.decode(I.data,j.offset):void 0;this.dispatchMessage(e,w)}else if(j===U.Protocol.ROOM_DATA_BYTES){const I={offset:1},j=Z.decode.stringCheck(E,I)?Z.decode.string(E,I):Z.decode.number(E,I);this.dispatchMessage(j,new Uint8Array(E.slice(I.offset)))}}setState(I){this.serializer.setState(I),this.onStateChange.invoke(this.serializer.getState())}patch(I){this.serializer.patch(I),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(I,E){var j;const e=this.getMessageHandlerKey(I);this.onMessageHandlers.events[e]?this.onMessageHandlers.emit(e,E):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",I,E):null===(j=console.warn)||void 0===j||j.call(console,`colyseus.js: onMessage() not registered for type '${I}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(I){switch(typeof I){case"function":return`$${I._typeid}`;case"string":return I;case"number":return`i${I}`;default:throw new Error("invalid message type.")}}}E.Room=K},11814:(I,E)=>{"use strict";let j;function e(){if(!j)try{j="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(I){}return j||(j={cache:{},setItem:function(I,E){this.cache[I]=E},getItem:function(I){this.cache[I]},removeItem:function(I){delete this.cache[I]}}),j}Object.defineProperty(E,"__esModule",{value:!0}),E.getItem=E.removeItem=E.setItem=void 0,E.setItem=function(I,E){e().setItem(I,E)},E.removeItem=function(I){e().removeItem(I)},E.getItem=function(I,E){const j=e().getItem(I);"undefined"!==typeof Promise&&j instanceof Promise?j.then((I=>E(I))):E(j)}},11780:(I,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createNanoEvents=void 0;E.createNanoEvents=()=>({emit(I){let E=this.events[I]||[];for(var j=arguments.length,e=new Array(j>1?j-1:0),w=1;w<j;w++)e[w-1]=arguments[w];for(let z=0,h=E.length;z<h;z++)E[z](...e)},events:{},on(I,E){var j;return(null===(j=this.events[I])||void 0===j?void 0:j.push(E))||(this.events[I]=[E]),()=>{var j;this.events[I]=null===(j=this.events[I])||void 0===j?void 0:j.filter((I=>E!==I))}}})},11786:(I,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.createSignal=E.EventEmitter=void 0;class j{constructor(){this.handlers=[]}register(I){return this.handlers.push(I),this}invoke(){for(var I=arguments.length,E=new Array(I),j=0;j<I;j++)E[j]=arguments[j];this.handlers.forEach((I=>I.apply(this,E)))}invokeAsync(){for(var I=arguments.length,E=new Array(I),j=0;j<I;j++)E[j]=arguments[j];return Promise.all(this.handlers.map((I=>I.apply(this,E))))}remove(I){const E=this.handlers.indexOf(I);this.handlers[E]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}E.EventEmitter=j,E.createSignal=function(){const I=new j;function E(E){return I.register(E,null===this)}return E.once=E=>{const j=function(){for(var e=arguments.length,w=new Array(e),z=0;z<e;z++)w[z]=arguments[z];E.apply(this,w),I.remove(j)};I.register(j)},E.remove=E=>I.remove(E),E.invoke=function(){return I.invoke(...arguments)},E.invokeAsync=function(){return I.invokeAsync(...arguments)},E.clear=()=>I.clear(),E}},11733:(I,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.ServerError=E.CloseCode=void 0,function(I){I[I.CONSENTED=4e3]="CONSENTED",I[I.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(E.CloseCode||(E.CloseCode={}));class j extends Error{constructor(I,E){super(E),this.name="ServerError",this.code=I}}E.ServerError=j},11718:(I,E,j)=>{"use strict";E.c=void 0,j(11725);var e=j(11728);Object.defineProperty(E,"c",{enumerable:!0,get:function(){return e.Client}});var w=j(11770);var z=j(11735);var h=j(11805);const t=j(11825);const U=j(11834),R=j(11778);(0,R.registerSerializer)("schema",t.SchemaSerializer),(0,R.registerSerializer)("none",U.NoneSerializer)},11725:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=I=>null!==I&&"object"===typeof I&&I.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11742:(I,E)=>{"use strict";function j(I,E){if(this._offset=E,I instanceof ArrayBuffer)this._buffer=I,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(I))throw new Error("Invalid argument");this._buffer=I.buffer,this._view=new DataView(this._buffer,I.byteOffset,I.byteLength)}}Object.defineProperty(E,"__esModule",{value:!0}),E.decode=E.encode=void 0,j.prototype._array=function(I){for(var E=new Array(I),j=0;j<I;j++)E[j]=this._parse();return E},j.prototype._map=function(I){for(var E={},j=0;j<I;j++)E[this._parse()]=this._parse();return E},j.prototype._str=function(I){var E=function(I,E,j){for(var e="",w=0,z=E,h=E+j;z<h;z++){var t=I.getUint8(z);if(0!==(128&t))if(192!==(224&t))if(224!==(240&t)){if(240!==(248&t))throw new Error("Invalid byte "+t.toString(16));(w=(7&t)<<18|(63&I.getUint8(++z))<<12|(63&I.getUint8(++z))<<6|63&I.getUint8(++z))>=65536?(w-=65536,e+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):e+=String.fromCharCode(w)}else e+=String.fromCharCode((15&t)<<12|(63&I.getUint8(++z))<<6|63&I.getUint8(++z));else e+=String.fromCharCode((31&t)<<6|63&I.getUint8(++z));else e+=String.fromCharCode(t)}return e}(this._view,this._offset,I);return this._offset+=I,E},j.prototype._bin=function(I){var E=this._buffer.slice(this._offset,this._offset+I);return this._offset+=I,E},j.prototype._parse=function(){var I,E=this._view.getUint8(this._offset++),j=0,e=0,w=0,z=0;if(E<192)return E<128?E:E<144?this._map(15&E):E<160?this._array(15&E):this._str(31&E);if(E>223)return-1*(255-E+1);switch(E){case 192:return null;case 194:return!1;case 195:return!0;case 196:return j=this._view.getUint8(this._offset),this._offset+=1,this._bin(j);case 197:return j=this._view.getUint16(this._offset),this._offset+=2,this._bin(j);case 198:return j=this._view.getUint32(this._offset),this._offset+=4,this._bin(j);case 199:if(j=this._view.getUint8(this._offset),e=this._view.getInt8(this._offset+1),this._offset+=2,-1===e){var h=this._view.getUint32(this._offset);return w=this._view.getInt32(this._offset+4),z=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*w+z)+h/1e6)}return[e,this._bin(j)];case 200:return j=this._view.getUint16(this._offset),e=this._view.getInt8(this._offset+2),this._offset+=3,[e,this._bin(j)];case 201:return j=this._view.getUint32(this._offset),e=this._view.getInt8(this._offset+4),this._offset+=5,[e,this._bin(j)];case 202:return I=this._view.getFloat32(this._offset),this._offset+=4,I;case 203:return I=this._view.getFloat64(this._offset),this._offset+=8,I;case 204:return I=this._view.getUint8(this._offset),this._offset+=1,I;case 205:return I=this._view.getUint16(this._offset),this._offset+=2,I;case 206:return I=this._view.getUint32(this._offset),this._offset+=4,I;case 207:return w=this._view.getUint32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,w+z;case 208:return I=this._view.getInt8(this._offset),this._offset+=1,I;case 209:return I=this._view.getInt16(this._offset),this._offset+=2,I;case 210:return I=this._view.getInt32(this._offset),this._offset+=4,I;case 211:return w=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,w+z;case 212:return e=this._view.getInt8(this._offset),this._offset+=1,0===e?void(this._offset+=1):[e,this._bin(1)];case 213:return e=this._view.getInt8(this._offset),this._offset+=1,[e,this._bin(2)];case 214:return e=this._view.getInt8(this._offset),this._offset+=1,-1===e?(I=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*I)):[e,this._bin(4)];case 215:return e=this._view.getInt8(this._offset),this._offset+=1,0===e?(w=this._view.getInt32(this._offset)*Math.pow(2,32),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(w+z)):-1===e?(w=this._view.getUint32(this._offset),z=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&w)+z)+(w>>>2)/1e6)):[e,this._bin(8)];case 216:return e=this._view.getInt8(this._offset),this._offset+=1,[e,this._bin(16)];case 217:return j=this._view.getUint8(this._offset),this._offset+=1,this._str(j);case 218:return j=this._view.getUint16(this._offset),this._offset+=2,this._str(j);case 219:return j=this._view.getUint32(this._offset),this._offset+=4,this._str(j);case 220:return j=this._view.getUint16(this._offset),this._offset+=2,this._array(j);case 221:return j=this._view.getUint32(this._offset),this._offset+=4,this._array(j);case 222:return j=this._view.getUint16(this._offset),this._offset+=2,this._map(j);case 223:return j=this._view.getUint32(this._offset),this._offset+=4,this._map(j)}throw new Error("Could not parse")},E.decode=function(I){var E=new j(I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),e=E._parse();if(E._offset!==I.byteLength)throw new Error(I.byteLength-E._offset+" trailing bytes");return e};function e(I,E,j){for(var e=0,w=0,z=j.length;w<z;w++)(e=j.charCodeAt(w))<128?I.setUint8(E++,e):e<2048?(I.setUint8(E++,192|e>>6),I.setUint8(E++,128|63&e)):e<55296||e>=57344?(I.setUint8(E++,224|e>>12),I.setUint8(E++,128|e>>6&63),I.setUint8(E++,128|63&e)):(w++,e=65536+((1023&e)<<10|1023&j.charCodeAt(w)),I.setUint8(E++,240|e>>18),I.setUint8(E++,128|e>>12&63),I.setUint8(E++,128|e>>6&63),I.setUint8(E++,128|63&e))}function w(I,E,j){var e=typeof j,z=0,h=0,t=0,U=0,R=0,P=0;if("string"===e){if(R=function(I){for(var E=0,j=0,e=0,w=I.length;e<w;e++)(E=I.charCodeAt(e))<128?j+=1:E<2048?j+=2:E<55296||E>=57344?j+=3:(e++,j+=4);return j}(j),R<32)I.push(160|R),P=1;else if(R<256)I.push(217,R),P=2;else if(R<65536)I.push(218,R>>8,R),P=3;else{if(!(R<4294967296))throw new Error("String too long");I.push(219,R>>24,R>>16,R>>8,R),P=5}return E.push({_str:j,_length:R,_offset:I.length}),P+R}if("number"===e)return Math.floor(j)===j&&isFinite(j)?j>=0?j<128?(I.push(j),1):j<256?(I.push(204,j),2):j<65536?(I.push(205,j>>8,j),3):j<4294967296?(I.push(206,j>>24,j>>16,j>>8,j),5):(t=j/Math.pow(2,32)|0,U=j>>>0,I.push(207,t>>24,t>>16,t>>8,t,U>>24,U>>16,U>>8,U),9):j>=-32?(I.push(j),1):j>=-128?(I.push(208,j),2):j>=-32768?(I.push(209,j>>8,j),3):j>=-2147483648?(I.push(210,j>>24,j>>16,j>>8,j),5):(t=Math.floor(j/Math.pow(2,32)),U=j>>>0,I.push(211,t>>24,t>>16,t>>8,t,U>>24,U>>16,U>>8,U),9):(I.push(203),E.push({_float:j,_length:8,_offset:I.length}),9);if("object"===e){if(null===j)return I.push(192),1;if(Array.isArray(j)){if((R=j.length)<16)I.push(144|R),P=1;else if(R<65536)I.push(220,R>>8,R),P=3;else{if(!(R<4294967296))throw new Error("Array too large");I.push(221,R>>24,R>>16,R>>8,R),P=5}for(z=0;z<R;z++)P+=w(I,E,j[z]);return P}if(j instanceof Date){var o=j.getTime(),Z=Math.floor(o/1e3),c=1e6*(o-1e3*Z);return Z>=0&&c>=0&&Z<=17179869183?0===c&&Z<=4294967295?(I.push(214,255,Z>>24,Z>>16,Z>>8,Z),6):(t=Z/4294967296,U=4294967295&Z,I.push(215,255,c>>22,c>>14,c>>6,t,U>>24,U>>16,U>>8,U),10):(t=Math.floor(Z/4294967296),U=Z>>>0,I.push(199,12,255,c>>24,c>>16,c>>8,c,t>>24,t>>16,t>>8,t,U>>24,U>>16,U>>8,U),15)}if(j instanceof ArrayBuffer){if((R=j.byteLength)<256)I.push(196,R),P=2;else if(R<65536)I.push(197,R>>8,R),P=3;else{if(!(R<4294967296))throw new Error("Buffer too large");I.push(198,R>>24,R>>16,R>>8,R),P=5}return E.push({_bin:j,_length:R,_offset:I.length}),P+R}if("function"===typeof j.toJSON)return w(I,E,j.toJSON());var K=[],L="",F=Object.keys(j);for(z=0,h=F.length;z<h;z++)void 0!==j[L=F[z]]&&"function"!==typeof j[L]&&K.push(L);if((R=K.length)<16)I.push(128|R),P=1;else if(R<65536)I.push(222,R>>8,R),P=3;else{if(!(R<4294967296))throw new Error("Object too large");I.push(223,R>>24,R>>16,R>>8,R),P=5}for(z=0;z<R;z++)P+=w(I,E,L=K[z]),P+=w(I,E,j[L]);return P}if("boolean"===e)return I.push(j?195:194),1;if("undefined"===e)return I.push(192),1;if("function"===typeof j.toJSON)return w(I,E,j.toJSON());throw new Error("Could not encode")}E.encode=function(I){var E=[],j=[],z=w(E,j,I),h=new ArrayBuffer(z),t=new DataView(h),U=0,R=0,P=-1;j.length>0&&(P=j[0]._offset);for(var o,Z=0,c=0,K=0,L=E.length;K<L;K++)if(t.setUint8(R+K,E[K]),K+1===P){if(Z=(o=j[U])._length,c=R+P,o._bin)for(var F=new Uint8Array(o._bin),C=0;C<Z;C++)t.setUint8(c+C,F[C]);else o._str?e(t,c,o._str):void 0!==o._float&&t.setFloat64(c,o._float);R+=Z,j[++U]&&(P=j[U]._offset)}return h}},11834:(I,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.NoneSerializer=void 0;E.NoneSerializer=class{setState(I){}getState(){return null}patch(I){}teardown(){}handshake(I){}}},11825:(I,E,j)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.SchemaSerializer=void 0;const e=j(11790);E.SchemaSerializer=class{setState(I){return this.state.decode(I)}getState(){return this.state}patch(I){return this.state.decode(I)}teardown(){var I,E;null===(E=null===(I=this.state)||void 0===I?void 0:I.$changes)||void 0===E||E.root.clearRefs()}handshake(I,E){if(this.state){(new e.Reflection).decode(I,E)}else this.state=e.Reflection.decode(I,E)}}},11778:(I,E)=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0}),E.getSerializer=E.registerSerializer=void 0;const j={};E.registerSerializer=function(I,E){j[I]=E},E.getSerializer=function(I){const E=j[I];if(!E)throw new Error("missing serializer: "+I);return E}},11756:function(I,E,j){"use strict";var e=this&&this.__importDefault||function(I){return I&&I.__esModule?I:{default:I}};Object.defineProperty(E,"__esModule",{value:!0}),E.WebSocketTransport=void 0;const w=e(j(11764)),z=globalThis.WebSocket||w.default;E.WebSocketTransport=class{constructor(I){this.events=I}send(I){I instanceof ArrayBuffer?this.ws.send(I):Array.isArray(I)&&this.ws.send(new Uint8Array(I).buffer)}connect(I,E){try{this.ws=new z(I,{headers:E,protocols:this.protocols})}catch(j){this.ws=new z(I,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(I,E){this.ws.close(I,E)}get isOpen(){return this.ws.readyState===z.OPEN}}},11764:I=>{"use strict";I.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12218:I=>{"use strict";I.exports=function(I){for(var E=new Array(I),j=0;j<I;++j)E[j]=j;return E}},12227:I=>{function E(I){return!!I.constructor&&"function"===typeof I.constructor.isBuffer&&I.constructor.isBuffer(I)}I.exports=function(I){return null!=I&&(E(I)||function(I){return"function"===typeof I.readFloatLE&&"function"===typeof I.slice&&E(I.slice(0,0))}(I)||!!I._isBuffer)}},12211:(I,E,j)=>{var e=j(12218),w=j(12227),z="undefined"!==typeof Float64Array;function h(I,E){return I[0]-E[0]}function t(){var I,E=this.stride,j=new Array(E.length);for(I=0;I<j.length;++I)j[I]=[Math.abs(E[I]),I];j.sort(h);var e=new Array(j.length);for(I=0;I<e.length;++I)e[I]=j[I][1];return e}function U(I,E){var j=["View",E,"d",I].join("");E<0&&(j="View_Nil"+I);var w="generic"===I;if(-1===E){var z="function "+j+"(a){this.data=a;};var proto="+j+".prototype;proto.dtype='"+I+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+j+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+j+"(a){return new "+j+"(a);}";return new Function(z)()}if(0===E){z="function "+j+"(a,d) {this.data = a;this.offset = d};var proto="+j+".prototype;proto.dtype='"+I+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+j+"_copy() {return new "+j+"(this.data,this.offset)};proto.pick=function "+j+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+j+"_get(){return "+(w?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+j+"_set(v){return "+(w?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+j+"(a,b,c,d){return new "+j+"(a,d)}";return new Function("TrivialArray",z)(R[I][0])}z=["'use strict'"];var h=e(E),U=h.map((function(I){return"i"+I})),P="this.offset+"+h.map((function(I){return"this.stride["+I+"]*i"+I})).join("+"),o=h.map((function(I){return"b"+I})).join(","),Z=h.map((function(I){return"c"+I})).join(",");z.push("function "+j+"(a,"+o+","+Z+",d){this.data=a","this.shape=["+o+"]","this.stride=["+Z+"]","this.offset=d|0}","var proto="+j+".prototype","proto.dtype='"+I+"'","proto.dimension="+E),z.push("Object.defineProperty(proto,'size',{get:function "+j+"_size(){return "+h.map((function(I){return"this.shape["+I+"]"})).join("*"),"}})"),1===E?z.push("proto.order=[0]"):(z.push("Object.defineProperty(proto,'order',{get:"),E<4?(z.push("function "+j+"_order(){"),2===E?z.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===E&&z.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):z.push("ORDER})")),z.push("proto.set=function "+j+"_set("+U.join(",")+",v){"),w?z.push("return this.data.set("+P+",v)}"):z.push("return this.data["+P+"]=v}"),z.push("proto.get=function "+j+"_get("+U.join(",")+"){"),w?z.push("return this.data.get("+P+")}"):z.push("return this.data["+P+"]}"),z.push("proto.index=function "+j+"_index(",U.join(),"){return "+P+"}"),z.push("proto.hi=function "+j+"_hi("+U.join(",")+"){return new "+j+"(this.data,"+h.map((function(I){return["(typeof i",I,"!=='number'||i",I,"<0)?this.shape[",I,"]:i",I,"|0"].join("")})).join(",")+","+h.map((function(I){return"this.stride["+I+"]"})).join(",")+",this.offset)}");var c=h.map((function(I){return"a"+I+"=this.shape["+I+"]"})),K=h.map((function(I){return"c"+I+"=this.stride["+I+"]"}));z.push("proto.lo=function "+j+"_lo("+U.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+K.join(","));for(var L=0;L<E;++L)z.push("if(typeof i"+L+"==='number'&&i"+L+">=0){d=i"+L+"|0;b+=c"+L+"*d;a"+L+"-=d}");z.push("return new "+j+"(this.data,"+h.map((function(I){return"a"+I})).join(",")+","+h.map((function(I){return"c"+I})).join(",")+",b)}"),z.push("proto.step=function "+j+"_step("+U.join(",")+"){var "+h.map((function(I){return"a"+I+"=this.shape["+I+"]"})).join(",")+","+h.map((function(I){return"b"+I+"=this.stride["+I+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(L=0;L<E;++L)z.push("if(typeof i"+L+"==='number'){d=i"+L+"|0;if(d<0){c+=b"+L+"*(a"+L+"-1);a"+L+"=ceil(-a"+L+"/d)}else{a"+L+"=ceil(a"+L+"/d)}b"+L+"*=d}");z.push("return new "+j+"(this.data,"+h.map((function(I){return"a"+I})).join(",")+","+h.map((function(I){return"b"+I})).join(",")+",c)}");var F=new Array(E),C=new Array(E);for(L=0;L<E;++L)F[L]="a[i"+L+"]",C[L]="b[i"+L+"]";z.push("proto.transpose=function "+j+"_transpose("+U+"){"+U.map((function(I,E){return I+"=("+I+"===undefined?"+E+":"+I+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+j+"(this.data,"+F.join(",")+","+C.join(",")+",this.offset)}"),z.push("proto.pick=function "+j+"_pick("+U+"){var a=[],b=[],c=this.offset");for(L=0;L<E;++L)z.push("if(typeof i"+L+"==='number'&&i"+L+">=0){c=(c+this.stride["+L+"]*i"+L+")|0}else{a.push(this.shape["+L+"]);b.push(this.stride["+L+"])}");return z.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),z.push("return function construct_"+j+"(data,shape,stride,offset){return new "+j+"(data,"+h.map((function(I){return"shape["+I+"]"})).join(",")+","+h.map((function(I){return"stride["+I+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",z.join("\n"))(R[I],t)}var R={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};I.exports=function(I,E,j,e){if(void 0===I)return(0,R.array[0])([]);"number"===typeof I&&(I=[I]),void 0===E&&(E=[I.length]);var h=E.length;if(void 0===j){j=new Array(h);for(var t=h-1,P=1;t>=0;--t)j[t]=P,P*=E[t]}if(void 0===e){e=0;for(t=0;t<h;++t)j[t]<0&&(e-=(E[t]-1)*j[t])}for(var o=function(I){if(w(I))return"buffer";if(z)switch(Object.prototype.toString.call(I)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(I)?"array":"generic"}(I),Z=R[o];Z.length<=h+1;)Z.push(U(o,Z.length-1));return(0,Z[h+1])(I,E,j,e)}},13208:I=>{var E;self,E=()=>(()=>{"use strict";var I={d:(E,j)=>{for(var e in j)I.o(j,e)&&!I.o(E,e)&&Object.defineProperty(E,e,{enumerable:!0,get:j[e]})},o:(I,E)=>Object.prototype.hasOwnProperty.call(I,E)},E={};I.d(E,{default:()=>H});var j,e=function(I,E){var j=E.x-I.x,e=E.y-I.y;return Math.sqrt(j*j+e*e)},w=function(I){return I*(Math.PI/180)},z=new Map,h=function(I){z.has(I)&&clearTimeout(z.get(I)),z.set(I,setTimeout(I,100))},t=function(I,E,j){for(var e,w=E.split(/[ ,]+/g),z=0;z<w.length;z+=1)e=w[z],I.addEventListener?I.addEventListener(e,j,!1):I.attachEvent&&I.attachEvent(e,j)},U=function(I,E,j){for(var e,w=E.split(/[ ,]+/g),z=0;z<w.length;z+=1)e=w[z],I.removeEventListener?I.removeEventListener(e,j):I.detachEvent&&I.detachEvent(e,j)},R=function(I){return I.preventDefault(),I.type.match(/^touch/)?I.changedTouches:I},P=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},o=function(I,E){E.top||E.right||E.bottom||E.left?(I.style.top=E.top,I.style.right=E.right,I.style.bottom=E.bottom,I.style.left=E.left):(I.style.left=E.x+"px",I.style.top=E.y+"px")},Z=function(I,E,j){var e=c(I);for(var w in e)if(e.hasOwnProperty(w))if("string"==typeof E)e[w]=E+" "+j;else{for(var z="",h=0,t=E.length;h<t;h+=1)z+=E[h]+" "+j+", ";e[w]=z.slice(0,-2)}return e},c=function(I){var E={};return E[I]="",["webkit","Moz","o"].forEach((function(j){E[j+I.charAt(0).toUpperCase()+I.slice(1)]=""})),E},K=function(I,E){for(var j in E)E.hasOwnProperty(j)&&(I[j]=E[j]);return I},L=function(I,E){if(I.length)for(var j=0,e=I.length;j<e;j+=1)E(I[j]);else E(I)},F="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,C=window.matchMedia("(any-hover: none)").matches,X=!!("ontouchstart"in window),q=!!window.PointerEvent,x=!!window.MSPointerEvent,u={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},b={start:"mousedown",move:"mousemove",end:"mouseup"},Q={};function G(){}F&&!C?j=u:q?j={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:x?j={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:X?(j=u,Q=b):j=b,G.prototype.on=function(I,E){var j,e=this,w=I.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(var z=0;z<w.length;z+=1)j=w[z],e._handlers_[j]=e._handlers_[j]||[],e._handlers_[j].push(E);return e},G.prototype.off=function(I,E){var j=this;return j._handlers_=j._handlers_||{},void 0===I?j._handlers_={}:void 0===E?j._handlers_[I]=null:j._handlers_[I]&&j._handlers_[I].indexOf(E)>=0&&j._handlers_[I].splice(j._handlers_[I].indexOf(E),1),j},G.prototype.trigger=function(I,E){var j,e=this,w=I.split(/[ ,]+/g);e._handlers_=e._handlers_||{};for(var z=0;z<w.length;z+=1)j=w[z],e._handlers_[j]&&e._handlers_[j].length&&e._handlers_[j].forEach((function(I){I.call(e,{type:j,target:e},E)}))},G.prototype.config=function(I){var E=this;E.options=E.defaults||{},I&&(E.options=function(I,E){var j={};for(var e in I)I.hasOwnProperty(e)&&E.hasOwnProperty(e)?j[e]=E[e]:I.hasOwnProperty(e)&&(j[e]=I[e]);return j}(E.options,I))},G.prototype.bindEvt=function(I,E){var e=this;return e._domHandlers_=e._domHandlers_||{},e._domHandlers_[E]=function(){"function"==typeof e["on"+E]?e["on"+E].apply(e,arguments):console.warn('[WARNING] : Missing "on'+E+'" handler.')},t(I,j[E],e._domHandlers_[E]),Q[E]&&t(I,Q[E],e._domHandlers_[E]),e},G.prototype.unbindEvt=function(I,E){var e=this;return e._domHandlers_=e._domHandlers_||{},U(I,j[E],e._domHandlers_[E]),Q[E]&&U(I,Q[E],e._domHandlers_[E]),delete e._domHandlers_[E],this};const y=G;function d(I,E){return this.identifier=E.identifier,this.position=E.position,this.frontPosition=E.frontPosition,this.collection=I,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(E),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=d.id,d.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}d.prototype=new y,d.constructor=d,d.id=0,d.prototype.buildEl=function(I){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},d.prototype.stylize=function(){if(this.options.dataOnly)return this;var I=this.options.fadeTime+"ms",E=function(){var I=c("borderRadius");for(var E in I)I.hasOwnProperty(E)&&(I[E]="50%");return I}(),j=Z("transition","opacity",I),e={};return e.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},e.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},e.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},K(e.el,j),"circle"===this.options.shape&&K(e.back,E),K(e.front,E),this.applyStyles(e),this},d.prototype.applyStyles=function(I){for(var E in this.ui)if(this.ui.hasOwnProperty(E))for(var j in I[E])this.ui[E].style[j]=I[E][j];return this},d.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},d.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},d.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},d.prototype.show=function(I){var E=this;return E.options.dataOnly||(clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.addToDom(),E.restCallback(),setTimeout((function(){E.ui.el.style.opacity=1}),0),E.showTimeout=setTimeout((function(){E.trigger("shown",E.instance),"function"==typeof I&&I.call(this)}),E.options.fadeTime)),E},d.prototype.hide=function(I){var E=this;if(E.options.dataOnly)return E;if(E.ui.el.style.opacity=E.options.restOpacity,clearTimeout(E.removeTimeout),clearTimeout(E.showTimeout),clearTimeout(E.restTimeout),E.removeTimeout=setTimeout((function(){var j="dynamic"===E.options.mode?"none":"block";E.ui.el.style.display=j,"function"==typeof I&&I.call(E),E.trigger("hidden",E.instance)}),E.options.fadeTime),E.options.restJoystick){var j=E.options.restJoystick,e={};e.x=!0===j||!1!==j.x?0:E.instance.frontPosition.x,e.y=!0===j||!1!==j.y?0:E.instance.frontPosition.y,E.setPosition(I,e)}return E},d.prototype.setPosition=function(I,E){var j=this;j.frontPosition={x:E.x,y:E.y};var e=j.options.fadeTime+"ms",w={};w.front=Z("transition",["transform"],e);var z={front:{}};z.front={transform:"translate("+j.frontPosition.x+"px,"+j.frontPosition.y+"px)"},j.applyStyles(w),j.applyStyles(z),j.restTimeout=setTimeout((function(){"function"==typeof I&&I.call(j),j.restCallback()}),j.options.fadeTime)},d.prototype.restCallback=function(){var I=this,E={};E.front=Z("transition","none",""),I.applyStyles(E),I.trigger("rested",I.instance)},d.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},d.prototype.computeDirection=function(I){var E,j,e,w=I.angle.radian,z=Math.PI/4,h=Math.PI/2;if(w>z&&w<3*z&&!I.lockX?E="up":w>-z&&w<=z&&!I.lockY?E="left":w>3*-z&&w<=-z&&!I.lockX?E="down":I.lockY||(E="right"),I.lockY||(j=w>-h&&w<h?"left":"right"),I.lockX||(e=w>0?"up":"down"),I.force>this.options.threshold){var t,U={};for(t in this.direction)this.direction.hasOwnProperty(t)&&(U[t]=this.direction[t]);var R={};for(t in this.direction={x:j,y:e,angle:E},I.direction=this.direction,U)U[t]===this.direction[t]&&(R[t]=!0);if(R.x&&R.y&&R.angle)return I;R.x&&R.y||this.trigger("plain",I),R.x||this.trigger("plain:"+j,I),R.y||this.trigger("plain:"+e,I),R.angle||this.trigger("dir dir:"+E,I)}else this.resetDirection();return I};const a=d;function l(I,E){var j=this;j.nipples=[],j.idles=[],j.actives=[],j.ids=[],j.pressureIntervals={},j.manager=I,j.id=l.id,l.id+=1,j.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},j.config(E),"static"!==j.options.mode&&"semi"!==j.options.mode||(j.options.multitouch=!1),j.options.multitouch||(j.options.maxNumberOfNipples=1);var e=getComputedStyle(j.options.zone.parentElement);return e&&"flex"===e.display&&(j.parentIsFlex=!0),j.updateBox(),j.prepareNipples(),j.cZ(),j.begin(),j.nipples}l.prototype=new y,l.constructor=l,l.id=0,l.prototype.prepareNipples=function(){var I=this,E=I.nipples;E.on=I.on.bind(I),E.off=I.off.bind(I),E.options=I.options,E.destroy=I.destroy.bind(I),E.ids=I.ids,E.id=I.id,E.processOnMove=I.processOnMove.bind(I),E.processOnEnd=I.processOnEnd.bind(I),E.get=function(I){if(void 0===I)return E[0];for(var j=0,e=E.length;j<e;j+=1)if(E[j].identifier===I)return E[j];return!1}},l.prototype.cZ=function(){var I=this;I.bindEvt(I.options.zone,"start"),I.options.zone.style.touchAction="none",I.options.zone.style.msTouchAction="none"},l.prototype.begin=function(){var I=this,E=I.options;if("static"===E.mode){var j=I.createNipple(E.position,I.manager.getIdentifier());j.add(),I.idles.push(j)}},l.prototype.createNipple=function(I,E){var j=this,e=j.manager.scroll,w={},z=j.options,h=j.parentIsFlex?e.x:e.x+j.box.left,t=j.parentIsFlex?e.y:e.y+j.box.top;if(I.x&&I.y)w={x:I.x-h,y:I.y-t};else if(I.top||I.right||I.bottom||I.left){var U=document.createElement("DIV");U.style.display="hidden",U.style.top=I.top,U.style.right=I.right,U.style.bottom=I.bottom,U.style.left=I.left,U.style.position="absolute",z.zone.appendChild(U);var R=U.getBoundingClientRect();z.zone.removeChild(U),w=I,I={x:R.left+e.x,y:R.top+e.y}}var P=new a(j,{color:z.color,size:z.size,threshold:z.threshold,fadeTime:z.fadeTime,dataOnly:z.dataOnly,restJoystick:z.restJoystick,restOpacity:z.restOpacity,mode:z.mode,identifier:E,position:I,zone:z.zone,frontPosition:{x:0,y:0},shape:z.shape});return z.dataOnly||(o(P.ui.el,w),o(P.ui.front,P.frontPosition)),j.nipples.push(P),j.trigger("added "+P.identifier+":added",P),j.manager.trigger("added "+P.identifier+":added",P),j.bindNipple(P),P},l.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},l.prototype.bindNipple=function(I){var E,j=this,e=function(I,e){E=I.type+" "+e.id+":"+I.type,j.trigger(E,e)};I.on("destroyed",j.onDestroyed.bind(j)),I.on("shown hidden rested dir plain",e),I.on("dir:up dir:right dir:down dir:left",e),I.on("plain:up plain:right plain:down plain:left",e)},l.prototype.pressureFn=function(I,E,j){var e=this,w=0;clearInterval(e.pressureIntervals[j]),e.pressureIntervals[j]=setInterval(function(){var j=I.force||I.pressure||I.webkitForce||0;j!==w&&(E.trigger("pressure",j),e.trigger("pressure "+E.identifier+":pressure",j),w=j)}.bind(e),100)},l.prototype.onstart=function(I){var E=this,j=E.options,e=I;return I=R(I),E.updateBox(),L(I,(function(w){E.actives.length<j.maxNumberOfNipples?E.processOnStart(w):e.type.match(/^touch/)&&(Object.keys(E.manager.ids).forEach((function(j){if(Object.values(e.touches).findIndex((function(I){return I.identifier===j}))<0){var w=[I[0]];w.identifier=j,E.processOnEnd(w)}})),E.actives.length<j.maxNumberOfNipples&&E.processOnStart(w))})),E.manager.bindDocument(),!1},l.prototype.processOnStart=function(I){var E,j=this,w=j.options,z=j.manager.getIdentifier(I),h=I.force||I.pressure||I.webkitForce||0,t={x:I.pageX,y:I.pageY},U=j.getOrCreate(z,t);U.identifier!==z&&j.manager.removeIdentifier(U.identifier),U.identifier=z;var R=function(E){E.trigger("start",E),j.trigger("start "+E.id+":start",E),E.show(),h>0&&j.pressureFn(I,E,E.identifier),j.processOnMove(I)};if((E=j.idles.indexOf(U))>=0&&j.idles.splice(E,1),j.actives.push(U),j.ids.push(U.identifier),"semi"!==w.mode)R(U);else{if(!(e(t,U.position)<=w.catchDistance))return U.destroy(),void j.processOnStart(I);R(U)}return U},l.prototype.getOrCreate=function(I,E){var j,e=this,w=e.options;return/(semi|static)/.test(w.mode)?(j=e.idles[0])?(e.idles.splice(0,1),j):"semi"===w.mode?e.createNipple(E,I):(console.warn("Coudln't find the needed nipple."),!1):j=e.createNipple(E,I)},l.prototype.processOnMove=function(I){var E=this,j=E.options,z=E.manager.getIdentifier(I),h=E.nipples.get(z),t=E.manager.scroll;if(function(I){return isNaN(I.buttons)?0!==I.pressure:0!==I.buttons}(I)){if(!h)return console.error("Found zombie joystick with ID "+z),void E.manager.removeIdentifier(z);if(j.dynamicPage){var U=h.el.getBoundingClientRect();h.position={x:t.x+U.left,y:t.y+U.top}}h.identifier=z;var R=h.options.size/2,P={x:I.pageX,y:I.pageY};j.lockX&&(P.y=h.position.y),j.lockY&&(P.x=h.position.x);var o,Z,c,K,L,F,C,X,q,x,u=e(P,h.position),b=(o=P,c=(Z=h.position).x-o.x,K=Z.y-o.y,function(I){return I*(180/Math.PI)}(Math.atan2(K,c))),Q=w(b),G=u/R,y={distance:u,position:P};if("circle"===h.options.shape?(L=Math.min(u,R),C=h.position,X=L,x={x:0,y:0},q=w(q=b),x.x=C.x-X*Math.cos(q),x.y=C.y-X*Math.sin(q),F=x):(F=function(I,E,j){return{x:Math.min(Math.max(I.x,E.x-j),E.x+j),y:Math.min(Math.max(I.y,E.y-j),E.y+j)}}(P,h.position,R),L=e(F,h.position)),j.follow){if(u>R){var d=P.x-F.x,a=P.y-F.y;h.position.x+=d,h.position.y+=a,h.el.style.top=h.position.y-(E.box.top+t.y)+"px",h.el.style.left=h.position.x-(E.box.left+t.x)+"px",u=e(P,h.position)}}else P=F,u=L;var l=P.x-h.position.x,i=P.y-h.position.y;h.frontPosition={x:l,y:i},j.dataOnly||(h.ui.front.style.transform="translate("+l+"px,"+i+"px)");var r={identifier:h.identifier,position:P,force:G,pressure:I.force||I.pressure||I.webkitForce||0,distance:u,angle:{radian:Q,degree:b},vector:{x:l/R,y:-i/R},raw:y,instance:h,lockX:j.lockX,lockY:j.lockY};(r=h.computeDirection(r)).angle={radian:w(180-b),degree:180-b},h.trigger("move",r),E.trigger("move "+h.id+":move",r)}else this.processOnEnd(I)},l.prototype.processOnEnd=function(I){var E=this,j=E.options,e=E.manager.getIdentifier(I),w=E.nipples.get(e),z=E.manager.removeIdentifier(w.identifier);w&&(j.dataOnly||w.hide((function(){"dynamic"===j.mode&&(w.trigger("removed",w),E.trigger("removed "+w.id+":removed",w),E.manager.trigger("removed "+w.id+":removed",w),w.destroy())})),clearInterval(E.pressureIntervals[w.identifier]),w.resetDirection(),w.trigger("end",w),E.trigger("end "+w.id+":end",w),E.ids.indexOf(w.identifier)>=0&&E.ids.splice(E.ids.indexOf(w.identifier),1),E.actives.indexOf(w)>=0&&E.actives.splice(E.actives.indexOf(w),1),/(semi|static)/.test(j.mode)?E.idles.push(w):E.nipples.indexOf(w)>=0&&E.nipples.splice(E.nipples.indexOf(w),1),E.manager.unbindDocument(),/(semi|static)/.test(j.mode)&&(E.manager.ids[z.id]=z.identifier))},l.prototype.onDestroyed=function(I,E){var j=this;j.nipples.indexOf(E)>=0&&j.nipples.splice(j.nipples.indexOf(E),1),j.actives.indexOf(E)>=0&&j.actives.splice(j.actives.indexOf(E),1),j.idles.indexOf(E)>=0&&j.idles.splice(j.idles.indexOf(E),1),j.ids.indexOf(E.identifier)>=0&&j.ids.splice(j.ids.indexOf(E.identifier),1),j.manager.removeIdentifier(E.identifier),j.manager.unbindDocument()},l.prototype.destroy=function(){var I=this;for(var E in I.unbindEvt(I.options.zone,"start"),I.nipples.forEach((function(I){I.destroy()})),I.pressureIntervals)I.pressureIntervals.hasOwnProperty(E)&&clearInterval(I.pressureIntervals[E]);I.trigger("destroyed",I.nipples),I.manager.unbindDocument(),I.off()};const i=l;function r(I){var E=this;E.ids={},E.index=0,E.collections=[],E.scroll=P(),E.config(I),E.prepareCollections();var j=function(){var I;E.collections.forEach((function(j){j.forEach((function(j){I=j.el.getBoundingClientRect(),j.position={x:E.scroll.x+I.left,y:E.scroll.y+I.top}}))}))};t(window,"resize",(function(){h(j)}));var e=function(){E.scroll=P()};return t(window,"scroll",(function(){h(e)})),E.collections}r.prototype=new y,r.constructor=r,r.prototype.prepareCollections=function(){var I=this;I.collections.create=I.create.bind(I),I.collections.on=I.on.bind(I),I.collections.off=I.off.bind(I),I.collections.destroy=I.destroy.bind(I),I.collections.get=function(E){var j;return I.collections.every((function(I){return!(j=I.get(E))})),j}},r.prototype.create=function(I){return this.createCollection(I)},r.prototype.createCollection=function(I){var E=this,j=new i(E,I);return E.bindCollection(j),E.collections.push(j),j},r.prototype.bindCollection=function(I){var E,j=this,e=function(I,e){E=I.type+" "+e.id+":"+I.type,j.trigger(E,e)};I.on("destroyed",j.onDestroyed.bind(j)),I.on("shown hidden rested dir plain",e),I.on("dir:up dir:right dir:down dir:left",e),I.on("plain:up plain:right plain:down plain:left",e)},r.prototype.bindDocument=function(){var I=this;I.binded||(I.bindEvt(document,"move").bindEvt(document,"end"),I.binded=!0)},r.prototype.unbindDocument=function(I){var E=this;Object.keys(E.ids).length&&!0!==I||(E.unbindEvt(document,"move").unbindEvt(document,"end"),E.binded=!1)},r.prototype.getIdentifier=function(I){var E;return I?void 0===(E=void 0===I.identifier?I.pointerId:I.identifier)&&(E=this.latest||0):E=this.index,void 0===this.ids[E]&&(this.ids[E]=this.index,this.index+=1),this.latest=E,this.ids[E]},r.prototype.removeIdentifier=function(I){var E={};for(var j in this.ids)if(this.ids[j]===I){E.id=j,E.identifier=this.ids[j],delete this.ids[j];break}return E},r.prototype.onmove=function(I){return this.onAny("move",I),!1},r.prototype.onend=function(I){return this.onAny("end",I),!1},r.prototype.oncancel=function(I){return this.onAny("end",I),!1},r.prototype.onAny=function(I,E){var j,e=this,w="processOn"+I.charAt(0).toUpperCase()+I.slice(1);E=R(E);var z=function(I,E,j){j.ids.indexOf(E)>=0&&(j[w](I),I._found_=!0)};return L(E,(function(I){j=e.getIdentifier(I),L(e.collections,z.bind(null,I,j)),I._found_||e.removeIdentifier(j)})),!1},r.prototype.destroy=function(){var I=this;I.unbindDocument(!0),I.ids={},I.index=0,I.collections.forEach((function(I){I.destroy()})),I.off()},r.prototype.onDestroyed=function(I,E){var j=this;if(j.collections.indexOf(E)<0)return!1;j.collections.splice(j.collections.indexOf(E),1)};var n=new r;const H={create:function(I){return n.create(I)},factory:n};return E.default})(),I.exports=E()},12252:(I,E,j)=>{"use strict";const{Deflate:e,deflate:w,deflateRaw:z,gzip:h}=j(12255),{Inflate:t,inflate:U,inflateRaw:R,ungzip:P}=j(12311),o=j(12289);I.exports.Deflate=e,I.exports.deflate=w,I.exports.deflateRaw=z,I.exports.gzip=h,I.exports.Inflate=t,I.exports.inflate=U,I.exports.inflateRaw=R,I.exports.ungzip=P,I.exports.constants=o},12255:(I,E,j)=>{"use strict";const e=j(12260),w=j(12292),z=j(12301),h=j(12280),t=j(12307),U=Object.prototype.toString,{Z_NO_FLUSH:R,Z_SYNC_FLUSH:P,Z_FULL_FLUSH:o,Z_FINISH:Z,Z_OK:c,Z_STREAM_END:K,Z_DEFAULT_COMPRESSION:L,Z_DEFAULT_STRATEGY:F,Z_DEFLATED:C}=j(12289);function X(I){this.options=w.assign({level:L,method:C,WI:16384,windowBits:15,memLevel:8,strategy:F},I||{});let E=this.options;E.raw&&E.windowBits>0?E.windowBits=-E.windowBits:E.gzip&&E.windowBits>0&&E.windowBits<16&&(E.windowBits+=16),this.err=0,this.PE="",this.ended=!1,this.chunks=[],this.strm=new t,this.strm.avail_out=0;let j=e.deflateInit2(this.strm,E.level,E.method,E.windowBits,E.memLevel,E.strategy);if(j!==c)throw new Error(h[j]);if(E.header&&e.deflateSetHeader(this.strm,E.header),E.dictionary){let I;if(I="string"===typeof E.dictionary?z.string2buf(E.dictionary):"[object ArrayBuffer]"===U.call(E.dictionary)?new Uint8Array(E.dictionary):E.dictionary,j=e.deflateSetDictionary(this.strm,I),j!==c)throw new Error(h[j]);this._dict_set=!0}}function q(I,E){const j=new X(E);if(j.push(I,!0),j.err)throw j.PE||h[j.err];return j.result}X.prototype.push=function(I,E){const j=this.strm,w=this.options.WI;let h,t;if(this.ended)return!1;for(t=E===~~E?E:!0===E?Z:R,"string"===typeof I?j.input=z.string2buf(I):"[object ArrayBuffer]"===U.call(I)?j.input=new Uint8Array(I):j.input=I,j.next_in=0,j.avail_in=j.input.length;;)if(0===j.avail_out&&(j.output=new Uint8Array(w),j.next_out=0,j.avail_out=w),(t===P||t===o)&&j.avail_out<=6)this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;else{if(h=e.deflate(j,t),h===K)return j.next_out>0&&this.onData(j.output.subarray(0,j.next_out)),h=e.deflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===c;if(0!==j.avail_out){if(t>0&&j.next_out>0)this.onData(j.output.subarray(0,j.next_out)),j.avail_out=0;else if(0===j.avail_in)break}else this.onData(j.output)}return!0},X.prototype.onData=function(I){this.chunks.push(I)},X.prototype.onEnd=function(I){I===c&&(this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.PE=this.strm.PE},I.exports.Deflate=X,I.exports.deflate=q,I.exports.deflateRaw=function(I,E){return(E=E||{}).raw=!0,q(I,E)},I.exports.gzip=function(I,E){return(E=E||{}).gzip=!0,q(I,E)},I.exports.constants=j(12289)},12311:(I,E,j)=>{"use strict";const e=j(12316),w=j(12292),z=j(12301),h=j(12280),t=j(12307),U=j(12331),R=Object.prototype.toString,{Z_NO_FLUSH:P,Z_FINISH:o,Z_OK:Z,Z_STREAM_END:c,Z_NEED_DICT:K,Z_STREAM_ERROR:L,Z_DATA_ERROR:F,Z_MEM_ERROR:C}=j(12289);function X(I){this.options=w.assign({WI:65536,windowBits:15,to:""},I||{});const E=this.options;E.raw&&E.windowBits>=0&&E.windowBits<16&&(E.windowBits=-E.windowBits,0===E.windowBits&&(E.windowBits=-15)),!(E.windowBits>=0&&E.windowBits<16)||I&&I.windowBits||(E.windowBits+=32),E.windowBits>15&&E.windowBits<48&&0===(15&E.windowBits)&&(E.windowBits|=15),this.err=0,this.PE="",this.ended=!1,this.chunks=[],this.strm=new t,this.strm.avail_out=0;let j=e.inflateInit2(this.strm,E.windowBits);if(j!==Z)throw new Error(h[j]);if(this.header=new U,e.inflateGetHeader(this.strm,this.header),E.dictionary&&("string"===typeof E.dictionary?E.dictionary=z.string2buf(E.dictionary):"[object ArrayBuffer]"===R.call(E.dictionary)&&(E.dictionary=new Uint8Array(E.dictionary)),E.raw&&(j=e.inflateSetDictionary(this.strm,E.dictionary),j!==Z)))throw new Error(h[j])}function q(I,E){const j=new X(E);if(j.push(I),j.err)throw j.PE||h[j.err];return j.result}X.prototype.push=function(I,E){const j=this.strm,w=this.options.WI,h=this.options.dictionary;let t,U,X;if(this.ended)return!1;for(U=E===~~E?E:!0===E?o:P,"[object ArrayBuffer]"===R.call(I)?j.input=new Uint8Array(I):j.input=I,j.next_in=0,j.avail_in=j.input.length;;){for(0===j.avail_out&&(j.output=new Uint8Array(w),j.next_out=0,j.avail_out=w),t=e.inflate(j,U),t===K&&h&&(t=e.inflateSetDictionary(j,h),t===Z?t=e.inflate(j,U):t===F&&(t=K));j.avail_in>0&&t===c&&j.state.wrap>0&&0!==I[j.next_in];)e.inflateReset(j),t=e.inflate(j,U);switch(t){case L:case F:case K:case C:return this.onEnd(t),this.ended=!0,!1}if(X=j.avail_out,j.next_out&&(0===j.avail_out||t===c))if("string"===this.options.to){let I=z.utf8border(j.output,j.next_out),E=j.next_out-I,e=z.buf2string(j.output,I);j.next_out=E,j.avail_out=w-E,E&&j.output.set(j.output.subarray(I,I+E),0),this.onData(e)}else this.onData(j.output.length===j.next_out?j.output:j.output.subarray(0,j.next_out));if(t!==Z||0!==X){if(t===c)return t=e.inflateEnd(this.strm),this.onEnd(t),this.ended=!0,!0;if(0===j.avail_in)break}}return!0},X.prototype.onData=function(I){this.chunks.push(I)},X.prototype.onEnd=function(I){I===Z&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.PE=this.strm.PE},I.exports.Inflate=X,I.exports.inflate=q,I.exports.inflateRaw=function(I,E){return(E=E||{}).raw=!0,q(I,E)},I.exports.ungzip=q,I.exports.constants=j(12289)},12292:I=>{"use strict";const E=(I,E)=>Object.prototype.hasOwnProperty.call(I,E);I.exports.assign=function(I){const j=Array.prototype.slice.call(arguments,1);for(;j.length;){const e=j.shift();if(e){if("object"!==typeof e)throw new TypeError(e+"must be non-object");for(const j in e)E(e,j)&&(I[j]=e[j])}}return I},I.exports.flattenChunks=I=>{let E=0;for(let e=0,w=I.length;e<w;e++)E+=I[e].length;const j=new Uint8Array(E);for(let e=0,w=0,z=I.length;e<z;e++){let E=I[e];j.set(E,w),w+=E.length}return j}},12301:I=>{"use strict";let E=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){E=!1}const j=new Uint8Array(256);for(let w=0;w<256;w++)j[w]=w>=252?6:w>=248?5:w>=240?4:w>=224?3:w>=192?2:1;j[254]=j[254]=1,I.exports.string2buf=I=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(I);let E,j,e,w,z,h=I.length,t=0;for(w=0;w<h;w++)j=I.charCodeAt(w),55296===(64512&j)&&w+1<h&&(e=I.charCodeAt(w+1),56320===(64512&e)&&(j=65536+(j-55296<<10)+(e-56320),w++)),t+=j<128?1:j<2048?2:j<65536?3:4;for(E=new Uint8Array(t),z=0,w=0;z<t;w++)j=I.charCodeAt(w),55296===(64512&j)&&w+1<h&&(e=I.charCodeAt(w+1),56320===(64512&e)&&(j=65536+(j-55296<<10)+(e-56320),w++)),j<128?E[z++]=j:j<2048?(E[z++]=192|j>>>6,E[z++]=128|63&j):j<65536?(E[z++]=224|j>>>12,E[z++]=128|j>>>6&63,E[z++]=128|63&j):(E[z++]=240|j>>>18,E[z++]=128|j>>>12&63,E[z++]=128|j>>>6&63,E[z++]=128|63&j);return E};I.exports.buf2string=(I,e)=>{const w=e||I.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(I.subarray(0,e));let z,h;const t=new Array(2*w);for(h=0,z=0;z<w;){let E=I[z++];if(E<128){t[h++]=E;continue}let e=j[E];if(e>4)t[h++]=65533,z+=e-1;else{for(E&=2===e?31:3===e?15:7;e>1&&z<w;)E=E<<6|63&I[z++],e--;e>1?t[h++]=65533:E<65536?t[h++]=E:(E-=65536,t[h++]=55296|E>>10&1023,t[h++]=56320|1023&E)}}return((I,j)=>{if(j<65534&&I.subarray&&E)return String.fromCharCode.apply(null,I.length===j?I:I.subarray(0,j));let e="";for(let E=0;E<j;E++)e+=String.fromCharCode(I[E]);return e})(t,h)},I.exports.utf8border=(I,E)=>{(E=E||I.length)>I.length&&(E=I.length);let e=E-1;for(;e>=0&&128===(192&I[e]);)e--;return e<0||0===e?E:e+j[I[e]]>E?e:E}},12268:I=>{"use strict";I.exports=(I,E,j,e)=>{let w=65535&I,z=I>>>16&65535,h=0;for(;0!==j;){h=j>2e3?2e3:j,j-=h;do{w=w+E[e++]|0,z=z+w|0}while(--h);w%=65521,z%=65521}return w|z<<16}},12289:I=>{"use strict";I.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12274:I=>{"use strict";const E=new Uint32Array((()=>{let I,E=[];for(var j=0;j<256;j++){I=j;for(var e=0;e<8;e++)I=1&I?3988292384^I>>>1:I>>>1;E[j]=I}return E})());I.exports=(I,j,e,w)=>{const z=E,h=w+e;I^=-1;for(let E=w;E<h;E++)I=I>>>8^z[255&(I^j[E])];return~I}},12260:(I,E,j)=>{"use strict";const{_tr_init:e,_tr_stored_block:w,_tr_flush_block:z,_tr_tally:h,_tr_align:t}=j(12263),U=j(12268),R=j(12274),P=j(12280),{Z_NO_FLUSH:o,Z_PARTIAL_FLUSH:Z,Z_FULL_FLUSH:c,Z_FINISH:K,Z_BLOCK:L,Z_OK:F,Z_STREAM_END:C,Z_STREAM_ERROR:X,Z_DATA_ERROR:q,Z_BUF_ERROR:x,Z_DEFAULT_COMPRESSION:u,Z_FILTERED:b,Z_HUFFMAN_ONLY:Q,Z_RLE:G,Z_FIXED:y,Z_DEFAULT_STRATEGY:d,Z_UNKNOWN:a,Z_DEFLATED:l}=j(12289),i=258,r=262,n=103,H=113,g=666,Y=(I,E)=>(I.PE=P[E],E),A=I=>(I<<1)-(I>4?9:0),T=I=>{let E=I.length;for(;--E>=0;)I[E]=0};let M=(I,E,j)=>(E<<I.hash_shift^j)&I.hash_mask;const W=I=>{const E=I.state;let j=E.pending;j>I.avail_out&&(j=I.avail_out),0!==j&&(I.output.set(E.pending_buf.subarray(E.pending_out,E.pending_out+j),I.next_out),I.next_out+=j,E.pending_out+=j,I.total_out+=j,I.avail_out-=j,E.pending-=j,0===E.pending&&(E.pending_out=0))},O=(I,E)=>{z(I,I.block_start>=0?I.block_start:-1,I.strstart-I.block_start,E),I.block_start=I.strstart,W(I.strm)},s=(I,E)=>{I.pending_buf[I.pending++]=E},v=(I,E)=>{I.pending_buf[I.pending++]=E>>>8&255,I.pending_buf[I.pending++]=255&E},V=(I,E,j,e)=>{let w=I.avail_in;return w>e&&(w=e),0===w?0:(I.avail_in-=w,E.set(I.input.subarray(I.next_in,I.next_in+w),j),1===I.state.wrap?I.adler=U(I.adler,E,w,j):2===I.state.wrap&&(I.adler=R(I.adler,E,w,j)),I.next_in+=w,I.total_in+=w,w)},f=(I,E)=>{let j,e,w=I.max_chain_length,z=I.strstart,h=I.prev_length,t=I.nice_match;const U=I.strstart>I.w_size-r?I.strstart-(I.w_size-r):0,R=I.window,P=I.w_mask,o=I.prev,Z=I.strstart+i;let c=R[z+h-1],K=R[z+h];I.prev_length>=I.good_match&&(w>>=2),t>I.lookahead&&(t=I.lookahead);do{if(j=E,R[j+h]===K&&R[j+h-1]===c&&R[j]===R[z]&&R[++j]===R[z+1]){z+=2,j++;do{}while(R[++z]===R[++j]&&R[++z]===R[++j]&&R[++z]===R[++j]&&R[++z]===R[++j]&&R[++z]===R[++j]&&R[++z]===R[++j]&&R[++z]===R[++j]&&R[++z]===R[++j]&&z<Z);if(e=i-(Z-z),z=Z-i,e>h){if(I.match_start=E,h=e,e>=t)break;c=R[z+h-1],K=R[z+h]}}}while((E=o[E&P])>U&&0!==--w);return h<=I.lookahead?h:I.lookahead},S=I=>{const E=I.w_size;let j,e,w,z,h;do{if(z=I.window_size-I.lookahead-I.strstart,I.strstart>=E+(E-r)){I.window.set(I.window.subarray(E,E+E),0),I.match_start-=E,I.strstart-=E,I.block_start-=E,e=I.hash_size,j=e;do{w=I.head[--j],I.head[j]=w>=E?w-E:0}while(--e);e=E,j=e;do{w=I.prev[--j],I.prev[j]=w>=E?w-E:0}while(--e);z+=E}if(0===I.strm.avail_in)break;if(e=V(I.strm,I.window,I.strstart+I.lookahead,z),I.lookahead+=e,I.lookahead+I.insert>=3)for(h=I.strstart-I.insert,I.ins_h=I.window[h],I.ins_h=M(I,I.ins_h,I.window[h+1]);I.insert&&(I.ins_h=M(I,I.ins_h,I.window[h+3-1]),I.prev[h&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=h,h++,I.insert--,!(I.lookahead+I.insert<3)););}while(I.lookahead<r&&0!==I.strm.avail_in)},B=(I,E)=>{let j,e;for(;;){if(I.lookahead<r){if(S(I),I.lookahead<r&&E===o)return 1;if(0===I.lookahead)break}if(j=0,I.lookahead>=3&&(I.ins_h=M(I,I.ins_h,I.window[I.strstart+3-1]),j=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),0!==j&&I.strstart-j<=I.w_size-r&&(I.match_length=f(I,j)),I.match_length>=3)if(e=h(I,I.strstart-I.match_start,I.match_length-3),I.lookahead-=I.match_length,I.match_length<=I.max_lazy_match&&I.lookahead>=3){I.match_length--;do{I.strstart++,I.ins_h=M(I,I.ins_h,I.window[I.strstart+3-1]),j=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart}while(0!==--I.match_length);I.strstart++}else I.strstart+=I.match_length,I.match_length=0,I.ins_h=I.window[I.strstart],I.ins_h=M(I,I.ins_h,I.window[I.strstart+1]);else e=h(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++;if(e&&(O(I,!1),0===I.strm.avail_out))return 1}return I.insert=I.strstart<2?I.strstart:2,E===K?(O(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(O(I,!1),0===I.strm.avail_out)?1:2},p=(I,E)=>{let j,e,w;for(;;){if(I.lookahead<r){if(S(I),I.lookahead<r&&E===o)return 1;if(0===I.lookahead)break}if(j=0,I.lookahead>=3&&(I.ins_h=M(I,I.ins_h,I.window[I.strstart+3-1]),j=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),I.prev_length=I.match_length,I.prev_match=I.match_start,I.match_length=2,0!==j&&I.prev_length<I.max_lazy_match&&I.strstart-j<=I.w_size-r&&(I.match_length=f(I,j),I.match_length<=5&&(I.strategy===b||3===I.match_length&&I.strstart-I.match_start>4096)&&(I.match_length=2)),I.prev_length>=3&&I.match_length<=I.prev_length){w=I.strstart+I.lookahead-3,e=h(I,I.strstart-1-I.prev_match,I.prev_length-3),I.lookahead-=I.prev_length-1,I.prev_length-=2;do{++I.strstart<=w&&(I.ins_h=M(I,I.ins_h,I.window[I.strstart+3-1]),j=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart)}while(0!==--I.prev_length);if(I.match_available=0,I.match_length=2,I.strstart++,e&&(O(I,!1),0===I.strm.avail_out))return 1}else if(I.match_available){if(e=h(I,0,I.window[I.strstart-1]),e&&O(I,!1),I.strstart++,I.lookahead--,0===I.strm.avail_out)return 1}else I.match_available=1,I.strstart++,I.lookahead--}return I.match_available&&(e=h(I,0,I.window[I.strstart-1]),I.match_available=0),I.insert=I.strstart<2?I.strstart:2,E===K?(O(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(O(I,!1),0===I.strm.avail_out)?1:2};function D(I,E,j,e,w){this.good_length=I,this.max_lazy=E,this.nice_length=j,this.max_chain=e,this.func=w}const k=[new D(0,0,0,0,((I,E)=>{let j=65535;for(j>I.pending_buf_size-5&&(j=I.pending_buf_size-5);;){if(I.lookahead<=1){if(S(I),0===I.lookahead&&E===o)return 1;if(0===I.lookahead)break}I.strstart+=I.lookahead,I.lookahead=0;const e=I.block_start+j;if((0===I.strstart||I.strstart>=e)&&(I.lookahead=I.strstart-e,I.strstart=e,O(I,!1),0===I.strm.avail_out))return 1;if(I.strstart-I.block_start>=I.w_size-r&&(O(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,E===K?(O(I,!0),0===I.strm.avail_out?3:4):(I.strstart>I.block_start&&(O(I,!1),I.strm.avail_out),1)})),new D(4,4,8,4,B),new D(4,5,16,8,B),new D(4,6,32,32,B),new D(4,4,16,16,p),new D(8,16,32,32,p),new D(8,16,128,128,p),new D(8,32,128,256,p),new D(32,128,258,1024,p),new D(32,258,258,4096,p)];function J(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=l,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),T(this.dyn_ltree),T(this.dyn_dtree),T(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),T(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),T(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const N=I=>{if(!I||!I.state)return Y(I,X);I.total_in=I.total_out=0,I.data_type=a;const E=I.state;return E.pending=0,E.pending_out=0,E.wrap<0&&(E.wrap=-E.wrap),E.status=E.wrap?42:H,I.adler=2===E.wrap?0:1,E.last_flush=o,e(E),F},m=I=>{const E=N(I);var j;return E===F&&((j=I.state).window_size=2*j.w_size,T(j.head),j.max_lazy_match=k[j.level].max_lazy,j.good_match=k[j.level].good_length,j.nice_match=k[j.level].nice_length,j.max_chain_length=k[j.level].max_chain,j.strstart=0,j.block_start=0,j.lookahead=0,j.insert=0,j.match_length=j.prev_length=2,j.match_available=0,j.ins_h=0),E},II=(I,E,j,e,w,z)=>{if(!I)return X;let h=1;if(E===u&&(E=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),w<1||w>9||j!==l||e<8||e>15||E<0||E>9||z<0||z>y)return Y(I,X);8===e&&(e=9);const t=new J;return I.state=t,t.strm=I,t.wrap=h,t.gzhead=null,t.w_bits=e,t.w_size=1<<t.w_bits,t.w_mask=t.w_size-1,t.hash_bits=w+7,t.hash_size=1<<t.hash_bits,t.hash_mask=t.hash_size-1,t.hash_shift=~~((t.hash_bits+3-1)/3),t.window=new Uint8Array(2*t.w_size),t.head=new Uint16Array(t.hash_size),t.prev=new Uint16Array(t.w_size),t.lit_bufsize=1<<w+6,t.pending_buf_size=4*t.lit_bufsize,t.pending_buf=new Uint8Array(t.pending_buf_size),t.d_buf=1*t.lit_bufsize,t.l_buf=3*t.lit_bufsize,t.level=E,t.strategy=z,t.method=j,m(I)};I.exports.deflateInit=(I,E)=>II(I,E,l,15,8,d),I.exports.deflateInit2=II,I.exports.deflateReset=m,I.exports.deflateResetKeep=N,I.exports.deflateSetHeader=(I,E)=>I&&I.state?2!==I.state.wrap?X:(I.state.gzhead=E,F):X,I.exports.deflate=(I,E)=>{let j,e;if(!I||!I.state||E>L||E<0)return I?Y(I,X):X;const z=I.state;if(!I.output||!I.input&&0!==I.avail_in||z.status===g&&E!==K)return Y(I,0===I.avail_out?x:X);z.strm=I;const U=z.last_flush;if(z.last_flush=E,42===z.status)if(2===z.wrap)I.adler=0,s(z,31),s(z,139),s(z,8),z.gzhead?(s(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),s(z,255&z.gzhead.time),s(z,z.gzhead.time>>8&255),s(z,z.gzhead.time>>16&255),s(z,z.gzhead.time>>24&255),s(z,9===z.level?2:z.strategy>=Q||z.level<2?4:0),s(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(s(z,255&z.gzhead.extra.length),s(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(I.adler=R(I.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(s(z,0),s(z,0),s(z,0),s(z,0),s(z,0),s(z,9===z.level?2:z.strategy>=Q||z.level<2?4:0),s(z,3),z.status=H);else{let E=l+(z.w_bits-8<<4)<<8,j=-1;j=z.strategy>=Q||z.level<2?0:z.level<6?1:6===z.level?2:3,E|=j<<6,0!==z.strstart&&(E|=32),E+=31-E%31,z.status=H,v(z,E),0!==z.strstart&&(v(z,I.adler>>>16),v(z,65535&I.adler)),I.adler=1}if(69===z.status)if(z.gzhead.extra){for(j=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>j&&(I.adler=R(I.adler,z.pending_buf,z.pending-j,j)),W(I),j=z.pending,z.pending!==z.pending_buf_size));)s(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>j&&(I.adler=R(I.adler,z.pending_buf,z.pending-j,j)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(73===z.status)if(z.gzhead.name){j=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>j&&(I.adler=R(I.adler,z.pending_buf,z.pending-j,j)),W(I),j=z.pending,z.pending===z.pending_buf_size)){e=1;break}e=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,s(z,e)}while(0!==e);z.gzhead.hcrc&&z.pending>j&&(I.adler=R(I.adler,z.pending_buf,z.pending-j,j)),0===e&&(z.gzindex=0,z.status=91)}else z.status=91;if(91===z.status)if(z.gzhead.comment){j=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>j&&(I.adler=R(I.adler,z.pending_buf,z.pending-j,j)),W(I),j=z.pending,z.pending===z.pending_buf_size)){e=1;break}e=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,s(z,e)}while(0!==e);z.gzhead.hcrc&&z.pending>j&&(I.adler=R(I.adler,z.pending_buf,z.pending-j,j)),0===e&&(z.status=n)}else z.status=n;if(z.status===n&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&W(I),z.pending+2<=z.pending_buf_size&&(s(z,255&I.adler),s(z,I.adler>>8&255),I.adler=0,z.status=H)):z.status=H),0!==z.pending){if(W(I),0===I.avail_out)return z.last_flush=-1,F}else if(0===I.avail_in&&A(E)<=A(U)&&E!==K)return Y(I,x);if(z.status===g&&0!==I.avail_in)return Y(I,x);if(0!==I.avail_in||0!==z.lookahead||E!==o&&z.status!==g){let j=z.strategy===Q?((I,E)=>{let j;for(;;){if(0===I.lookahead&&(S(I),0===I.lookahead)){if(E===o)return 1;break}if(I.match_length=0,j=h(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,j&&(O(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,E===K?(O(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(O(I,!1),0===I.strm.avail_out)?1:2})(z,E):z.strategy===G?((I,E)=>{let j,e,w,z;const t=I.window;for(;;){if(I.lookahead<=i){if(S(I),I.lookahead<=i&&E===o)return 1;if(0===I.lookahead)break}if(I.match_length=0,I.lookahead>=3&&I.strstart>0&&(w=I.strstart-1,e=t[w],e===t[++w]&&e===t[++w]&&e===t[++w])){z=I.strstart+i;do{}while(e===t[++w]&&e===t[++w]&&e===t[++w]&&e===t[++w]&&e===t[++w]&&e===t[++w]&&e===t[++w]&&e===t[++w]&&w<z);I.match_length=i-(z-w),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=3?(j=h(I,1,I.match_length-3),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(j=h(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),j&&(O(I,!1),0===I.strm.avail_out))return 1}return I.insert=0,E===K?(O(I,!0),0===I.strm.avail_out?3:4):I.last_lit&&(O(I,!1),0===I.strm.avail_out)?1:2})(z,E):k[z.level].func(z,E);if(3!==j&&4!==j||(z.status=g),1===j||3===j)return 0===I.avail_out&&(z.last_flush=-1),F;if(2===j&&(E===Z?t(z):E!==L&&(w(z,0,0,!1),E===c&&(T(z.head),0===z.lookahead&&(z.strstart=0,z.block_start=0,z.insert=0))),W(I),0===I.avail_out))return z.last_flush=-1,F}return E!==K?F:z.wrap<=0?C:(2===z.wrap?(s(z,255&I.adler),s(z,I.adler>>8&255),s(z,I.adler>>16&255),s(z,I.adler>>24&255),s(z,255&I.total_in),s(z,I.total_in>>8&255),s(z,I.total_in>>16&255),s(z,I.total_in>>24&255)):(v(z,I.adler>>>16),v(z,65535&I.adler)),W(I),z.wrap>0&&(z.wrap=-z.wrap),0!==z.pending?F:C)},I.exports.deflateEnd=I=>{if(!I||!I.state)return X;const E=I.state.status;return 42!==E&&69!==E&&73!==E&&91!==E&&E!==n&&E!==H&&E!==g?Y(I,X):(I.state=null,E===H?Y(I,q):F)},I.exports.deflateSetDictionary=(I,E)=>{let j=E.length;if(!I||!I.state)return X;const e=I.state,w=e.wrap;if(2===w||1===w&&42!==e.status||e.lookahead)return X;if(1===w&&(I.adler=U(I.adler,E,j,0)),e.wrap=0,j>=e.w_size){0===w&&(T(e.head),e.strstart=0,e.block_start=0,e.insert=0);let I=new Uint8Array(e.w_size);I.set(E.subarray(j-e.w_size,j),0),E=I,j=e.w_size}const z=I.avail_in,h=I.next_in,t=I.input;for(I.avail_in=j,I.next_in=0,I.input=E,S(e);e.lookahead>=3;){let I=e.strstart,E=e.lookahead-2;do{e.ins_h=M(e,e.ins_h,e.window[I+3-1]),e.prev[I&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=I,I++}while(--E);e.strstart=I,e.lookahead=2,S(e)}return e.strstart+=e.lookahead,e.block_start=e.strstart,e.insert=e.lookahead,e.lookahead=0,e.match_length=e.prev_length=2,e.match_available=0,I.next_in=h,I.input=t,I.avail_in=z,e.wrap=w,F},I.exports.deflateInfo="pako deflate (from Nodeca project)"},12331:I=>{"use strict";I.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12324:I=>{"use strict";I.exports=function(I,E){let j,e,w,z,h,t,U,R,P,o,Z,c,K,L,F,C,X,q,x,u,b,Q,G,y;const d=I.state;j=I.next_in,G=I.input,e=j+(I.avail_in-5),w=I.next_out,y=I.output,z=w-(E-I.avail_out),h=w+(I.avail_out-257),t=d.dmax,U=d.wsize,R=d.whave,P=d.wnext,o=d.window,Z=d.hold,c=d.bits,K=d.lencode,L=d.distcode,F=(1<<d.lenbits)-1,C=(1<<d.distbits)-1;I:do{c<15&&(Z+=G[j++]<<c,c+=8,Z+=G[j++]<<c,c+=8),X=K[Z&F];E:for(;;){if(q=X>>>24,Z>>>=q,c-=q,q=X>>>16&255,0===q)y[w++]=65535&X;else{if(!(16&q)){if(0===(64&q)){X=K[(65535&X)+(Z&(1<<q)-1)];continue E}if(32&q){d.mode=12;break I}I.PE="invalid literal/length code",d.mode=30;break I}x=65535&X,q&=15,q&&(c<q&&(Z+=G[j++]<<c,c+=8),x+=Z&(1<<q)-1,Z>>>=q,c-=q),c<15&&(Z+=G[j++]<<c,c+=8,Z+=G[j++]<<c,c+=8),X=L[Z&C];j:for(;;){if(q=X>>>24,Z>>>=q,c-=q,q=X>>>16&255,!(16&q)){if(0===(64&q)){X=L[(65535&X)+(Z&(1<<q)-1)];continue j}I.PE="invalid distance code",d.mode=30;break I}if(u=65535&X,q&=15,c<q&&(Z+=G[j++]<<c,c+=8,c<q&&(Z+=G[j++]<<c,c+=8)),u+=Z&(1<<q)-1,u>t){I.PE="invalid distance too far back",d.mode=30;break I}if(Z>>>=q,c-=q,q=w-z,u>q){if(q=u-q,q>R&&d.sane){I.PE="invalid distance too far back",d.mode=30;break I}if(b=0,Q=o,0===P){if(b+=U-q,q<x){x-=q;do{y[w++]=o[b++]}while(--q);b=w-u,Q=y}}else if(P<q){if(b+=U+P-q,q-=P,q<x){x-=q;do{y[w++]=o[b++]}while(--q);if(b=0,P<x){q=P,x-=q;do{y[w++]=o[b++]}while(--q);b=w-u,Q=y}}}else if(b+=P-q,q<x){x-=q;do{y[w++]=o[b++]}while(--q);b=w-u,Q=y}for(;x>2;)y[w++]=Q[b++],y[w++]=Q[b++],y[w++]=Q[b++],x-=3;x&&(y[w++]=Q[b++],x>1&&(y[w++]=Q[b++]))}else{b=w-u;do{y[w++]=y[b++],y[w++]=y[b++],y[w++]=y[b++],x-=3}while(x>2);x&&(y[w++]=y[b++],x>1&&(y[w++]=y[b++]))}break}}break}}while(j<e&&w<h);x=c>>3,j-=x,c-=x<<3,Z&=(1<<c)-1,I.next_in=j,I.next_out=w,I.avail_in=j<e?e-j+5:5-(j-e),I.avail_out=w<h?h-w+257:257-(w-h),d.hold=Z,d.bits=c}},12316:(I,E,j)=>{"use strict";const e=j(12268),w=j(12274),z=j(12324),h=j(12329),{Z_FINISH:t,Z_BLOCK:U,Z_TREES:R,Z_OK:P,Z_STREAM_END:o,Z_NEED_DICT:Z,Z_STREAM_ERROR:c,Z_DATA_ERROR:K,Z_MEM_ERROR:L,Z_BUF_ERROR:F,Z_DEFLATED:C}=j(12289),X=12,q=30,x=I=>(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24);function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const b=I=>{if(!I||!I.state)return c;const E=I.state;return I.total_in=I.total_out=E.total=0,I.PE="",E.wrap&&(I.adler=1&E.wrap),E.mode=1,E.last=0,E.havedict=0,E.dmax=32768,E.head=null,E.hold=0,E.bits=0,E.lencode=E.lendyn=new Int32Array(852),E.distcode=E.distdyn=new Int32Array(592),E.sane=1,E.back=-1,P},Q=I=>{if(!I||!I.state)return c;const E=I.state;return E.wsize=0,E.whave=0,E.wnext=0,b(I)},G=(I,E)=>{let j;if(!I||!I.state)return c;const e=I.state;return E<0?(j=0,E=-E):(j=1+(E>>4),E<48&&(E&=15)),E&&(E<8||E>15)?c:(null!==e.window&&e.wbits!==E&&(e.window=null),e.wrap=j,e.wbits=E,Q(I))},y=(I,E)=>{if(!I)return c;const j=new u;I.state=j,j.window=null;const e=G(I,E);return e!==P&&(I.state=null),e};let d,a,l=!0;const i=I=>{if(l){d=new Int32Array(512),a=new Int32Array(32);let E=0;for(;E<144;)I.lens[E++]=8;for(;E<256;)I.lens[E++]=9;for(;E<280;)I.lens[E++]=7;for(;E<288;)I.lens[E++]=8;for(h(1,I.lens,0,288,d,0,I.work,{bits:9}),E=0;E<32;)I.lens[E++]=5;h(2,I.lens,0,32,a,0,I.work,{bits:5}),l=!1}I.lencode=d,I.lenbits=9,I.distcode=a,I.distbits=5},r=(I,E,j,e)=>{let w;const z=I.state;return null===z.window&&(z.wsize=1<<z.wbits,z.wnext=0,z.whave=0,z.window=new Uint8Array(z.wsize)),e>=z.wsize?(z.window.set(E.subarray(j-z.wsize,j),0),z.wnext=0,z.whave=z.wsize):(w=z.wsize-z.wnext,w>e&&(w=e),z.window.set(E.subarray(j-e,j-e+w),z.wnext),(e-=w)?(z.window.set(E.subarray(j-e,j),0),z.wnext=e,z.whave=z.wsize):(z.wnext+=w,z.wnext===z.wsize&&(z.wnext=0),z.whave<z.wsize&&(z.whave+=w))),0};I.exports.inflateReset=Q,I.exports.inflateReset2=G,I.exports.inflateResetKeep=b,I.exports.inflateInit=I=>y(I,15),I.exports.inflateInit2=y,I.exports.inflate=(I,E)=>{let j,u,b,Q,G,y,d,a,l,n,H,g,Y,A,T,M,W,O,s,v,V,f,S=0;const B=new Uint8Array(4);let p,D;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!I||!I.state||!I.output||!I.input&&0!==I.avail_in)return c;j=I.state,j.mode===X&&(j.mode=13),G=I.next_out,b=I.output,d=I.avail_out,Q=I.next_in,u=I.input,y=I.avail_in,a=j.hold,l=j.bits,n=y,H=d,f=P;I:for(;;)switch(j.mode){case 1:if(0===j.wrap){j.mode=13;break}for(;l<16;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(2&j.wrap&&35615===a){j.check=0,B[0]=255&a,B[1]=a>>>8&255,j.check=w(j.check,B,2,0),a=0,l=0,j.mode=2;break}if(j.flags=0,j.head&&(j.head.done=!1),!(1&j.wrap)||(((255&a)<<8)+(a>>8))%31){I.PE="incorrect header check",j.mode=q;break}if((15&a)!==C){I.PE="unknown compression method",j.mode=q;break}if(a>>>=4,l-=4,V=8+(15&a),0===j.wbits)j.wbits=V;else if(V>j.wbits){I.PE="invalid window size",j.mode=q;break}j.dmax=1<<j.wbits,I.adler=j.check=1,j.mode=512&a?10:X,a=0,l=0;break;case 2:for(;l<16;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(j.flags=a,(255&j.flags)!==C){I.PE="unknown compression method",j.mode=q;break}if(57344&j.flags){I.PE="unknown header flags set",j.mode=q;break}j.head&&(j.head.text=a>>8&1),512&j.flags&&(B[0]=255&a,B[1]=a>>>8&255,j.check=w(j.check,B,2,0)),a=0,l=0,j.mode=3;case 3:for(;l<32;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}j.head&&(j.head.time=a),512&j.flags&&(B[0]=255&a,B[1]=a>>>8&255,B[2]=a>>>16&255,B[3]=a>>>24&255,j.check=w(j.check,B,4,0)),a=0,l=0,j.mode=4;case 4:for(;l<16;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}j.head&&(j.head.xflags=255&a,j.head.os=a>>8),512&j.flags&&(B[0]=255&a,B[1]=a>>>8&255,j.check=w(j.check,B,2,0)),a=0,l=0,j.mode=5;case 5:if(1024&j.flags){for(;l<16;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}j.length=a,j.head&&(j.head.extra_len=a),512&j.flags&&(B[0]=255&a,B[1]=a>>>8&255,j.check=w(j.check,B,2,0)),a=0,l=0}else j.head&&(j.head.extra=null);j.mode=6;case 6:if(1024&j.flags&&(g=j.length,g>y&&(g=y),g&&(j.head&&(V=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Uint8Array(j.head.extra_len)),j.head.extra.set(u.subarray(Q,Q+g),V)),512&j.flags&&(j.check=w(j.check,u,g,Q)),y-=g,Q+=g,j.length-=g),j.length))break I;j.length=0,j.mode=7;case 7:if(2048&j.flags){if(0===y)break I;g=0;do{V=u[Q+g++],j.head&&V&&j.length<65536&&(j.head.name+=String.fromCharCode(V))}while(V&&g<y);if(512&j.flags&&(j.check=w(j.check,u,g,Q)),y-=g,Q+=g,V)break I}else j.head&&(j.head.name=null);j.length=0,j.mode=8;case 8:if(4096&j.flags){if(0===y)break I;g=0;do{V=u[Q+g++],j.head&&V&&j.length<65536&&(j.head.comment+=String.fromCharCode(V))}while(V&&g<y);if(512&j.flags&&(j.check=w(j.check,u,g,Q)),y-=g,Q+=g,V)break I}else j.head&&(j.head.comment=null);j.mode=9;case 9:if(512&j.flags){for(;l<16;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(a!==(65535&j.check)){I.PE="header crc mismatch",j.mode=q;break}a=0,l=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),I.adler=j.check=0,j.mode=X;break;case 10:for(;l<32;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}I.adler=j.check=x(a),a=0,l=0,j.mode=11;case 11:if(0===j.havedict)return I.next_out=G,I.avail_out=d,I.next_in=Q,I.avail_in=y,j.hold=a,j.bits=l,Z;I.adler=j.check=1,j.mode=X;case X:if(E===U||E===R)break I;case 13:if(j.last){a>>>=7&l,l-=7&l,j.mode=27;break}for(;l<3;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}switch(j.last=1&a,a>>>=1,l-=1,3&a){case 0:j.mode=14;break;case 1:if(i(j),j.mode=20,E===R){a>>>=2,l-=2;break I}break;case 2:j.mode=17;break;case 3:I.PE="invalid block type",j.mode=q}a>>>=2,l-=2;break;case 14:for(a>>>=7&l,l-=7&l;l<32;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if((65535&a)!==(a>>>16^65535)){I.PE="invalid stored block lengths",j.mode=q;break}if(j.length=65535&a,a=0,l=0,j.mode=15,E===R)break I;case 15:j.mode=16;case 16:if(g=j.length,g){if(g>y&&(g=y),g>d&&(g=d),0===g)break I;b.set(u.subarray(Q,Q+g),G),y-=g,Q+=g,d-=g,G+=g,j.length-=g;break}j.mode=X;break;case 17:for(;l<14;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(j.nlen=257+(31&a),a>>>=5,l-=5,j.ndist=1+(31&a),a>>>=5,l-=5,j.ncode=4+(15&a),a>>>=4,l-=4,j.nlen>286||j.ndist>30){I.PE="too many length or distance symbols",j.mode=q;break}j.have=0,j.mode=18;case 18:for(;j.have<j.ncode;){for(;l<3;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}j.lens[k[j.have++]]=7&a,a>>>=3,l-=3}for(;j.have<19;)j.lens[k[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,p={bits:j.lenbits},f=h(0,j.lens,0,19,j.lencode,0,j.work,p),j.lenbits=p.bits,f){I.PE="invalid code lengths set",j.mode=q;break}j.have=0,j.mode=19;case 19:for(;j.have<j.nlen+j.ndist;){for(;S=j.lencode[a&(1<<j.lenbits)-1],T=S>>>24,M=S>>>16&255,W=65535&S,!(T<=l);){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(W<16)a>>>=T,l-=T,j.lens[j.have++]=W;else{if(16===W){for(D=T+2;l<D;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(a>>>=T,l-=T,0===j.have){I.PE="invalid bit length repeat",j.mode=q;break}V=j.lens[j.have-1],g=3+(3&a),a>>>=2,l-=2}else if(17===W){for(D=T+3;l<D;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}a>>>=T,l-=T,V=0,g=3+(7&a),a>>>=3,l-=3}else{for(D=T+7;l<D;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}a>>>=T,l-=T,V=0,g=11+(127&a),a>>>=7,l-=7}if(j.have+g>j.nlen+j.ndist){I.PE="invalid bit length repeat",j.mode=q;break}for(;g--;)j.lens[j.have++]=V}}if(j.mode===q)break;if(0===j.lens[256]){I.PE="invalid code -- missing end-of-block",j.mode=q;break}if(j.lenbits=9,p={bits:j.lenbits},f=h(1,j.lens,0,j.nlen,j.lencode,0,j.work,p),j.lenbits=p.bits,f){I.PE="invalid literal/lengths set",j.mode=q;break}if(j.distbits=6,j.distcode=j.distdyn,p={bits:j.distbits},f=h(2,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,p),j.distbits=p.bits,f){I.PE="invalid distances set",j.mode=q;break}if(j.mode=20,E===R)break I;case 20:j.mode=21;case 21:if(y>=6&&d>=258){I.next_out=G,I.avail_out=d,I.next_in=Q,I.avail_in=y,j.hold=a,j.bits=l,z(I,H),G=I.next_out,b=I.output,d=I.avail_out,Q=I.next_in,u=I.input,y=I.avail_in,a=j.hold,l=j.bits,j.mode===X&&(j.back=-1);break}for(j.back=0;S=j.lencode[a&(1<<j.lenbits)-1],T=S>>>24,M=S>>>16&255,W=65535&S,!(T<=l);){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(M&&0===(240&M)){for(O=T,s=M,v=W;S=j.lencode[v+((a&(1<<O+s)-1)>>O)],T=S>>>24,M=S>>>16&255,W=65535&S,!(O+T<=l);){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}a>>>=O,l-=O,j.back+=O}if(a>>>=T,l-=T,j.back+=T,j.length=W,0===M){j.mode=26;break}if(32&M){j.back=-1,j.mode=X;break}if(64&M){I.PE="invalid literal/length code",j.mode=q;break}j.extra=15&M,j.mode=22;case 22:if(j.extra){for(D=j.extra;l<D;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}j.length+=a&(1<<j.extra)-1,a>>>=j.extra,l-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=23;case 23:for(;S=j.distcode[a&(1<<j.distbits)-1],T=S>>>24,M=S>>>16&255,W=65535&S,!(T<=l);){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(0===(240&M)){for(O=T,s=M,v=W;S=j.distcode[v+((a&(1<<O+s)-1)>>O)],T=S>>>24,M=S>>>16&255,W=65535&S,!(O+T<=l);){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}a>>>=O,l-=O,j.back+=O}if(a>>>=T,l-=T,j.back+=T,64&M){I.PE="invalid distance code",j.mode=q;break}j.offset=W,j.extra=15&M,j.mode=24;case 24:if(j.extra){for(D=j.extra;l<D;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}j.offset+=a&(1<<j.extra)-1,a>>>=j.extra,l-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){I.PE="invalid distance too far back",j.mode=q;break}j.mode=25;case 25:if(0===d)break I;if(g=H-d,j.offset>g){if(g=j.offset-g,g>j.whave&&j.sane){I.PE="invalid distance too far back",j.mode=q;break}g>j.wnext?(g-=j.wnext,Y=j.wsize-g):Y=j.wnext-g,g>j.length&&(g=j.length),A=j.window}else A=b,Y=G-j.offset,g=j.length;g>d&&(g=d),d-=g,j.length-=g;do{b[G++]=A[Y++]}while(--g);0===j.length&&(j.mode=21);break;case 26:if(0===d)break I;b[G++]=j.length,d--,j.mode=21;break;case 27:if(j.wrap){for(;l<32;){if(0===y)break I;y--,a|=u[Q++]<<l,l+=8}if(H-=d,I.total_out+=H,j.total+=H,H&&(I.adler=j.check=j.flags?w(j.check,b,H,G-H):e(j.check,b,H,G-H)),H=d,(j.flags?a:x(a))!==j.check){I.PE="incorrect data check",j.mode=q;break}a=0,l=0}j.mode=28;case 28:if(j.wrap&&j.flags){for(;l<32;){if(0===y)break I;y--,a+=u[Q++]<<l,l+=8}if(a!==(4294967295&j.total)){I.PE="incorrect length check",j.mode=q;break}a=0,l=0}j.mode=29;case 29:f=o;break I;case q:f=K;break I;case 31:return L;default:return c}return I.next_out=G,I.avail_out=d,I.next_in=Q,I.avail_in=y,j.hold=a,j.bits=l,(j.wsize||H!==I.avail_out&&j.mode<q&&(j.mode<27||E!==t))&&r(I,I.output,I.next_out,H-I.avail_out)?(j.mode=31,L):(n-=I.avail_in,H-=I.avail_out,I.total_in+=n,I.total_out+=H,j.total+=H,j.wrap&&H&&(I.adler=j.check=j.flags?w(j.check,b,H,I.next_out-H):e(j.check,b,H,I.next_out-H)),I.data_type=j.bits+(j.last?64:0)+(j.mode===X?128:0)+(20===j.mode||15===j.mode?256:0),(0===n&&0===H||E===t)&&f===P&&(f=F),f)},I.exports.inflateEnd=I=>{if(!I||!I.state)return c;let E=I.state;return E.window&&(E.window=null),I.state=null,P},I.exports.inflateGetHeader=(I,E)=>{if(!I||!I.state)return c;const j=I.state;return 0===(2&j.wrap)?c:(j.head=E,E.done=!1,P)},I.exports.inflateSetDictionary=(I,E)=>{const j=E.length;let w,z,h;return I&&I.state?(w=I.state,0!==w.wrap&&11!==w.mode?c:11===w.mode&&(z=1,z=e(z,E,j,0),z!==w.check)?K:(h=r(I,E,j,j),h?(w.mode=31,L):(w.havedict=1,P))):c},I.exports.inflateInfo="pako inflate (from Nodeca project)"},12329:I=>{"use strict";const E=15,j=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),w=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),z=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);I.exports=(I,h,t,U,R,P,o,Z)=>{const c=Z.bits;let K,L,F,C,X,q,x=0,u=0,b=0,Q=0,G=0,y=0,d=0,a=0,l=0,i=0,r=null,n=0;const H=new Uint16Array(16),g=new Uint16Array(16);let Y,A,T,M=null,W=0;for(x=0;x<=E;x++)H[x]=0;for(u=0;u<U;u++)H[h[t+u]]++;for(G=c,Q=E;Q>=1&&0===H[Q];Q--);if(G>Q&&(G=Q),0===Q)return R[P++]=20971520,R[P++]=20971520,Z.bits=1,0;for(b=1;b<Q&&0===H[b];b++);for(G<b&&(G=b),a=1,x=1;x<=E;x++)if(a<<=1,a-=H[x],a<0)return-1;if(a>0&&(0===I||1!==Q))return-1;for(g[1]=0,x=1;x<E;x++)g[x+1]=g[x]+H[x];for(u=0;u<U;u++)0!==h[t+u]&&(o[g[h[t+u]]++]=u);if(0===I?(r=M=o,q=19):1===I?(r=j,n-=257,M=e,W-=257,q=256):(r=w,M=z,q=-1),i=0,u=0,x=b,X=P,y=G,d=0,F=-1,l=1<<G,C=l-1,1===I&&l>852||2===I&&l>592)return 1;for(;;){Y=x-d,o[u]<q?(A=0,T=o[u]):o[u]>q?(A=M[W+o[u]],T=r[n+o[u]]):(A=96,T=0),K=1<<x-d,L=1<<y,b=L;do{L-=K,R[X+(i>>d)+L]=Y<<24|A<<16|T}while(0!==L);for(K=1<<x-1;i&K;)K>>=1;if(0!==K?(i&=K-1,i+=K):i=0,u++,0===--H[x]){if(x===Q)break;x=h[t+o[u]]}if(x>G&&(i&C)!==F){for(0===d&&(d=G),X+=b,y=x-d,a=1<<y;y+d<Q&&(a-=H[y+d],!(a<=0));)y++,a<<=1;if(l+=1<<y,1===I&&l>852||2===I&&l>592)return 1;F=i&C,R[F]=G<<24|y<<16|X-P}}return 0!==i&&(R[X+i]=x-d<<24|64<<16),Z.bits=G,0}},12280:I=>{"use strict";I.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12263:I=>{"use strict";function E(I){let E=I.length;for(;--E>=0;)I[E]=0}const j=256,e=286,w=30,z=15,h=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),t=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),U=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),R=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),P=new Array(576);E(P);const o=new Array(60);E(o);const Z=new Array(512);E(Z);const c=new Array(256);E(c);const K=new Array(29);E(K);const L=new Array(w);function F(I,E,j,e,w){this.static_tree=I,this.extra_bits=E,this.extra_base=j,this.elems=e,this.max_length=w,this.has_stree=I&&I.length}let C,X,q;function x(I,E){this.dyn_tree=I,this.max_code=0,this.stat_desc=E}E(L);const u=I=>I<256?Z[I]:Z[256+(I>>>7)],b=(I,E)=>{I.pending_buf[I.pending++]=255&E,I.pending_buf[I.pending++]=E>>>8&255},Q=(I,E,j)=>{I.bi_valid>16-j?(I.bi_buf|=E<<I.bi_valid&65535,b(I,I.bi_buf),I.bi_buf=E>>16-I.bi_valid,I.bi_valid+=j-16):(I.bi_buf|=E<<I.bi_valid&65535,I.bi_valid+=j)},G=(I,E,j)=>{Q(I,j[2*E],j[2*E+1])},y=(I,E)=>{let j=0;do{j|=1&I,I>>>=1,j<<=1}while(--E>0);return j>>>1},d=(I,E,j)=>{const e=new Array(16);let w,h,t=0;for(w=1;w<=z;w++)e[w]=t=t+j[w-1]<<1;for(h=0;h<=E;h++){let E=I[2*h+1];0!==E&&(I[2*h]=y(e[E]++,E))}},a=I=>{let E;for(E=0;E<e;E++)I.dyn_ltree[2*E]=0;for(E=0;E<w;E++)I.dyn_dtree[2*E]=0;for(E=0;E<19;E++)I.bl_tree[2*E]=0;I.dyn_ltree[512]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0},l=I=>{I.bi_valid>8?b(I,I.bi_buf):I.bi_valid>0&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0},i=(I,E,j,e)=>{const w=2*E,z=2*j;return I[w]<I[z]||I[w]===I[z]&&e[E]<=e[j]},r=(I,E,j)=>{const e=I.heap[j];let w=j<<1;for(;w<=I.heap_len&&(w<I.heap_len&&i(E,I.heap[w+1],I.heap[w],I.depth)&&w++,!i(E,e,I.heap[w],I.depth));)I.heap[j]=I.heap[w],j=w,w<<=1;I.heap[j]=e},n=(I,E,e)=>{let w,z,U,R,P=0;if(0!==I.last_lit)do{w=I.pending_buf[I.d_buf+2*P]<<8|I.pending_buf[I.d_buf+2*P+1],z=I.pending_buf[I.l_buf+P],P++,0===w?G(I,z,E):(U=c[z],G(I,U+j+1,E),R=h[U],0!==R&&(z-=K[U],Q(I,z,R)),w--,U=u(w),G(I,U,e),R=t[U],0!==R&&(w-=L[U],Q(I,w,R)))}while(P<I.last_lit);G(I,256,E)},H=(I,E)=>{const j=E.dyn_tree,e=E.stat_desc.static_tree,w=E.stat_desc.has_stree,h=E.stat_desc.elems;let t,U,R,P=-1;for(I.heap_len=0,I.heap_max=573,t=0;t<h;t++)0!==j[2*t]?(I.heap[++I.heap_len]=P=t,I.depth[t]=0):j[2*t+1]=0;for(;I.heap_len<2;)R=I.heap[++I.heap_len]=P<2?++P:0,j[2*R]=1,I.depth[R]=0,I.opt_len--,w&&(I.static_len-=e[2*R+1]);for(E.max_code=P,t=I.heap_len>>1;t>=1;t--)r(I,j,t);R=h;do{t=I.heap[1],I.heap[1]=I.heap[I.heap_len--],r(I,j,1),U=I.heap[1],I.heap[--I.heap_max]=t,I.heap[--I.heap_max]=U,j[2*R]=j[2*t]+j[2*U],I.depth[R]=(I.depth[t]>=I.depth[U]?I.depth[t]:I.depth[U])+1,j[2*t+1]=j[2*U+1]=R,I.heap[1]=R++,r(I,j,1)}while(I.heap_len>=2);I.heap[--I.heap_max]=I.heap[1],((I,E)=>{const j=E.dyn_tree,e=E.max_code,w=E.stat_desc.static_tree,h=E.stat_desc.has_stree,t=E.stat_desc.extra_bits,U=E.stat_desc.extra_base,R=E.stat_desc.max_length;let P,o,Z,c,K,L,F=0;for(c=0;c<=z;c++)I.bl_count[c]=0;for(j[2*I.heap[I.heap_max]+1]=0,P=I.heap_max+1;P<573;P++)o=I.heap[P],c=j[2*j[2*o+1]+1]+1,c>R&&(c=R,F++),j[2*o+1]=c,o>e||(I.bl_count[c]++,K=0,o>=U&&(K=t[o-U]),L=j[2*o],I.opt_len+=L*(c+K),h&&(I.static_len+=L*(w[2*o+1]+K)));if(0!==F){do{for(c=R-1;0===I.bl_count[c];)c--;I.bl_count[c]--,I.bl_count[c+1]+=2,I.bl_count[R]--,F-=2}while(F>0);for(c=R;0!==c;c--)for(o=I.bl_count[c];0!==o;)Z=I.heap[--P],Z>e||(j[2*Z+1]!==c&&(I.opt_len+=(c-j[2*Z+1])*j[2*Z],j[2*Z+1]=c),o--)}})(I,E),d(j,P,I.bl_count)},g=(I,E,j)=>{let e,w,z=-1,h=E[1],t=0,U=7,R=4;for(0===h&&(U=138,R=3),E[2*(j+1)+1]=65535,e=0;e<=j;e++)w=h,h=E[2*(e+1)+1],++t<U&&w===h||(t<R?I.bl_tree[2*w]+=t:0!==w?(w!==z&&I.bl_tree[2*w]++,I.bl_tree[32]++):t<=10?I.bl_tree[34]++:I.bl_tree[36]++,t=0,z=w,0===h?(U=138,R=3):w===h?(U=6,R=3):(U=7,R=4))},Y=(I,E,j)=>{let e,w,z=-1,h=E[1],t=0,U=7,R=4;for(0===h&&(U=138,R=3),e=0;e<=j;e++)if(w=h,h=E[2*(e+1)+1],!(++t<U&&w===h)){if(t<R)do{G(I,w,I.bl_tree)}while(0!==--t);else 0!==w?(w!==z&&(G(I,w,I.bl_tree),t--),G(I,16,I.bl_tree),Q(I,t-3,2)):t<=10?(G(I,17,I.bl_tree),Q(I,t-3,3)):(G(I,18,I.bl_tree),Q(I,t-11,7));t=0,z=w,0===h?(U=138,R=3):w===h?(U=6,R=3):(U=7,R=4)}};let A=!1;const T=(I,E,j,e)=>{Q(I,0+(e?1:0),3),((I,E,j,e)=>{l(I),e&&(b(I,j),b(I,~j)),I.pending_buf.set(I.window.subarray(E,E+j),I.pending),I.pending+=j})(I,E,j,!0)};I.exports._tr_init=I=>{A||((()=>{let I,E,j,R,x;const u=new Array(16);for(j=0,R=0;R<28;R++)for(K[R]=j,I=0;I<1<<h[R];I++)c[j++]=R;for(c[j-1]=R,x=0,R=0;R<16;R++)for(L[R]=x,I=0;I<1<<t[R];I++)Z[x++]=R;for(x>>=7;R<w;R++)for(L[R]=x<<7,I=0;I<1<<t[R]-7;I++)Z[256+x++]=R;for(E=0;E<=z;E++)u[E]=0;for(I=0;I<=143;)P[2*I+1]=8,I++,u[8]++;for(;I<=255;)P[2*I+1]=9,I++,u[9]++;for(;I<=279;)P[2*I+1]=7,I++,u[7]++;for(;I<=287;)P[2*I+1]=8,I++,u[8]++;for(d(P,287,u),I=0;I<w;I++)o[2*I+1]=5,o[2*I]=y(I,5);C=new F(P,h,257,e,z),X=new F(o,t,0,w,z),q=new F(new Array(0),U,0,19,7)})(),A=!0),I.l_desc=new x(I.dyn_ltree,C),I.d_desc=new x(I.dyn_dtree,X),I.bl_desc=new x(I.bl_tree,q),I.bi_buf=0,I.bi_valid=0,a(I)},I.exports._tr_stored_block=T,I.exports._tr_flush_block=(I,E,e,w)=>{let z,h,t=0;I.level>0?(2===I.strm.data_type&&(I.strm.data_type=(I=>{let E,e=4093624447;for(E=0;E<=31;E++,e>>>=1)if(1&e&&0!==I.dyn_ltree[2*E])return 0;if(0!==I.dyn_ltree[18]||0!==I.dyn_ltree[20]||0!==I.dyn_ltree[26])return 1;for(E=32;E<j;E++)if(0!==I.dyn_ltree[2*E])return 1;return 0})(I)),H(I,I.l_desc),H(I,I.d_desc),t=(I=>{let E;for(g(I,I.dyn_ltree,I.l_desc.max_code),g(I,I.dyn_dtree,I.d_desc.max_code),H(I,I.bl_desc),E=18;E>=3&&0===I.bl_tree[2*R[E]+1];E--);return I.opt_len+=3*(E+1)+5+5+4,E})(I),z=I.opt_len+3+7>>>3,h=I.static_len+3+7>>>3,h<=z&&(z=h)):z=h=e+5,e+4<=z&&-1!==E?T(I,E,e,w):4===I.strategy||h===z?(Q(I,2+(w?1:0),3),n(I,P,o)):(Q(I,4+(w?1:0),3),((I,E,j,e)=>{let w;for(Q(I,E-257,5),Q(I,j-1,5),Q(I,e-4,4),w=0;w<e;w++)Q(I,I.bl_tree[2*R[w]+1],3);Y(I,I.dyn_ltree,E-1),Y(I,I.dyn_dtree,j-1)})(I,I.l_desc.max_code+1,I.d_desc.max_code+1,t+1),n(I,I.dyn_ltree,I.dyn_dtree)),a(I),w&&l(I)},I.exports._tr_tally=(I,E,e)=>(I.pending_buf[I.d_buf+2*I.last_lit]=E>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&E,I.pending_buf[I.l_buf+I.last_lit]=255&e,I.last_lit++,0===E?I.dyn_ltree[2*e]++:(I.matches++,E--,I.dyn_ltree[2*(c[e]+j+1)]++,I.dyn_dtree[2*u(E)]++),I.last_lit===I.lit_bufsize-1),I.exports._tr_align=I=>{Q(I,2,3),G(I,256,P),(I=>{16===I.bi_valid?(b(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):I.bi_valid>=8&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)})(I)}},12307:I=>{"use strict";I.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.PE="",this.state=null,this.data_type=2,this.adler=0}},11911:I=>{function E(I,E,j){for(var e=I.length,w=-1/0,z=1/0,h=0;h<e;h++){var t=(j[0][h]-I[h])/E[h],U=(j[1][h]-I[h])/E[h];if(t>U){var R=t;t=U,U=R}if(U<w||t>z)return 1/0;t>w&&(w=t),U<z&&(z=U)}return w>z?1/0:w}I.exports=function(I,j,e,w){var z=E(j,e,w);if(z===1/0)I=null;else{I=I||[];for(var h=0;h<j.length;h++)I[h]=j[h]+e[h]*z}return I},I.exports.distance=E},13284:(I,E,j)=>{"use strict";j.d(E,{c:()=>h});var e=j(28);const w=e.useLayoutEffect;const z=function(I){var E=(0,e.useRef)(I);return w((function(){E.current=I})),E};var h=function(I){var E=z(I);(0,e.tE)((function(){var I=function(I){var j;if(null!=E.current&&(j=E.current(I)),I.defaultPrevented&&(I.returnValue=""),"string"===typeof j)return I.returnValue=j,j};return window.addEventListener("beforeunload",I),function(){window.removeEventListener("beforeunload",I)}}),[])}},13239:(I,E,j)=>{"use strict";var e=j(13244),w=Array.prototype.concat,z=Array.prototype.slice,h=I.exports=function(I){for(var E=[],j=0,h=I.length;j<h;j++){var t=I[j];e(t)?E=w.call(E,z.call(t)):E.push(t)}return E};h.wrap=function(I){return function(){return I(h(arguments))}}},13244:I=>{I.exports=function(I){return!(!I||"string"===typeof I)&&(I instanceof Array||Array.isArray(I)||I.length>=0&&(I.splice instanceof Function||Object.getOwnPropertyDescriptor(I,I.length-1)&&"String"!==I.constructor.name))}},12194:(I,E,j)=>{var e=j(12203);function w(I){for(var E,j,w=0,z=I.length,h=0;h<I.length;){for(E=I[h],j=0;h<z&&I[h]===E;)++h,++j;w+=e.log2(j)/7|0,w+=e.log2(E>>>0)/7|0,w+=2}return w}E.size=w,E.encode=function(I,E){E||(E=new Uint8Array(w(I)));for(var j,e,z=0,h=E.length,t=0;t<I.length;){for(j=I[t],e=0;t<I.length&&I[t]===j;)++t,++e;for(;z<h&&e>=128;)E[z++]=128+(127&e),e>>>=7;if(z>=h)throw new Error("RLE buffer overflow");for(E[z++]=e,j>>>=0;z<h&&j>=128;)E[z++]=128+(127&j),j>>>=7;if(z>=h)throw new Error("RLE buffer overflow");E[z++]=j}return E},E.decode=function(I,E){for(var j,e,w,z,h=E.length,t=I.length,U=0,R=0;R<t;){for(j=0,e=0;R<t&&I[R]>=128;)j+=(127&I[R++])<<e,e+=7;if(j+=I[R++]<<e,R>=t)throw new Error("RLE buffer underrun");if(U+j>h)throw new Error("Chunk buffer overflow");for(w=0,e=0;R<t&&I[R]>=128;)w+=(127&I[R++])<<e,e+=7;if(R>=t)throw new Error("RLE buffer underrun");for(w+=I[R++]<<e,z=0;z<j;++z)E[U++]=w}return E}},12203:(I,E)=>{"use strict";function j(I){var E=32;return(I&=-I)&&E--,65535&I&&(E-=16),16711935&I&&(E-=8),252645135&I&&(E-=4),858993459&I&&(E-=2),1431655765&I&&(E-=1),E}E.INT_BITS=32,E.INT_MAX=2147483647,E.INT_MIN=-1<<31,E.sign=function(I){return(I>0)-(I<0)},E.abs=function(I){var E=I>>31;return(I^E)-E},E.min=function(I,E){return E^(I^E)&-(I<E)},E.max=function(I,E){return I^(I^E)&-(I<E)},E.isPow2=function(I){return!(I&I-1)&&!!I},E.log2=function(I){var E,j;return E=(I>65535)<<4,E|=j=((I>>>=E)>255)<<3,E|=j=((I>>>=j)>15)<<2,(E|=j=((I>>>=j)>3)<<1)|(I>>>=j)>>1},E.log10=function(I){return I>=1e9?9:I>=1e8?8:I>=1e7?7:I>=1e6?6:I>=1e5?5:I>=1e4?4:I>=1e3?3:I>=100?2:I>=10?1:0},E.popCount=function(I){return 16843009*((I=(858993459&(I-=I>>>1&1431655765))+(I>>>2&858993459))+(I>>>4)&252645135)>>>24},E.countTrailingZeros=j,E.nextPow2=function(I){return I+=0===I,--I,I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)+1},E.prevPow2=function(I){return I|=I>>>1,I|=I>>>2,I|=I>>>4,I|=I>>>8,(I|=I>>>16)-(I>>>1)},E.parity=function(I){return I^=I>>>16,I^=I>>>8,I^=I>>>4,27030>>>(I&=15)&1};var e=new Array(256);!function(I){for(var E=0;E<256;++E){var j=E,e=E,w=7;for(j>>>=1;j;j>>>=1)e<<=1,e|=1&j,--w;I[E]=e<<w&255}}(e),E.reverse=function(I){return e[255&I]<<24|e[I>>>8&255]<<16|e[I>>>16&255]<<8|e[I>>>24&255]},E.interleave2=function(I,E){return(I=1431655765&((I=858993459&((I=252645135&((I=16711935&((I&=65535)|I<<8))|I<<4))|I<<2))|I<<1))|(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E&=65535)|E<<8))|E<<4))|E<<2))|E<<1))<<1},E.deinterleave2=function(I,E){return(I=65535&((I=16711935&((I=252645135&((I=858993459&((I=I>>>E&1431655765)|I>>>1))|I>>>2))|I>>>4))|I>>>16))<<16>>16},E.interleave3=function(I,E,j){return I=1227133513&((I=3272356035&((I=251719695&((I=4278190335&((I&=1023)|I<<16))|I<<8))|I<<4))|I<<2),(I|=(E=1227133513&((E=3272356035&((E=251719695&((E=4278190335&((E&=1023)|E<<16))|E<<8))|E<<4))|E<<2))<<1)|(j=1227133513&((j=3272356035&((j=251719695&((j=4278190335&((j&=1023)|j<<16))|j<<8))|j<<4))|j<<2))<<2},E.deinterleave3=function(I,E){return(I=1023&((I=4278190335&((I=251719695&((I=3272356035&((I=I>>>E&1227133513)|I>>>2))|I>>>4))|I>>>8))|I>>>16))<<22>>22},E.nextCombination=function(I){var E=I|I-1;return E+1|(~E&-~E)-1>>>j(I)+1}},12243:I=>{"use strict";I.exports=function(I,E,j,e){var w=self||window;try{try{var z;try{z=new w.Blob([I])}catch(R){(z=new(w.BlobBuilder||w.WebKitBlobBuilder||w.MozBlobBuilder||w.MSBlobBuilder)).append(I),z=z.getBlob()}var h=w.URL||w.webkitURL,t=h.createObjectURL(z),U=new w[E](t,j);return h.revokeObjectURL(t),U}catch(R){return new w[E]("data:application/javascript,".concat(encodeURIComponent(I)),j)}}catch(R){if(!e)throw Error("Inline worker is not supported");return new w[E](e,j)}}},11897:(I,E,j)=>{"use strict";function e(I,E,j,e,w){var z={};return Object.keys(e).forEach((function(I){z[I]=e[I]})),z.enumerable=!!z.enumerable,z.configurable=!!z.configurable,("value"in z||z.initializer)&&(z.writable=!0),z=j.slice().reverse().reduce((function(j,e){return e(I,E,j)||j}),z),w&&void 0!==z.initializer&&(z.value=z.initializer?z.initializer.call(w):void 0,z.initializer=void 0),void 0===z.initializer&&(Object.defineProperty(I,E,z),z=null),z}j.d(E,{c:()=>e})},11892:(I,E,j)=>{"use strict";function e(I,E,j,e){j&&Object.defineProperty(I,E,{enumerable:j.enumerable,configurable:j.configurable,writable:j.writable,value:j.initializer?j.initializer.call(e):void 0})}j.d(E,{c:()=>e})},13276:(I,E,j)=>{"use strict";j.d(E,{c:()=>h,g:()=>o,j:()=>t,m:()=>z,q:()=>U,u:()=>w,v:()=>R,y:()=>P});var e=j(11337);class w{constructor(){this._easingMode=w.EASINGMODE_EASEIN}setEasingMode(I){const E=Math.min(Math.max(I,0),2);this._easingMode=E}getEasingMode(){return this._easingMode}easeInCore(I){throw new Error("You must implement this method")}ease(I){switch(this._easingMode){case w.EASINGMODE_EASEIN:return this.easeInCore(I);case w.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-I)}return I>=.5?.5*(1-this.easeInCore(2*(1-I)))+.5:.5*this.easeInCore(2*I)}}w.EASINGMODE_EASEIN=0,w.EASINGMODE_EASEOUT=1,w.EASINGMODE_EASEINOUT=2;class z extends w{easeInCore(I){return I=Math.max(0,Math.min(1,I)),1-Math.sqrt(1-I*I)}}class h extends w{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=I}easeInCore(I){const E=Math.max(0,this.amplitude);return Math.pow(I,3)-I*E*Math.sin(3.141592653589793*I)}}class t extends w{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=I,this.bounciness=E}easeInCore(I){const E=Math.max(0,this.bounces);let j=this.bounciness;j<=1&&(j=1.001);const e=Math.pow(j,E),w=1-j,z=(1-e)/w+.5*e,h=I*z,t=Math.log(-h*(1-j)+1)/Math.log(j),U=Math.floor(t),R=U+1,P=(1-Math.pow(j,U))/(w*z),o=.5*(P+(1-Math.pow(j,R))/(w*z)),Z=I-o,c=o-P;return-Math.pow(1/j,E-U)/(c*c)*(Z-c)*(Z+c)}}class U extends w{easeInCore(I){return I*I*I}}class R extends w{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=I,this.springiness=E}easeInCore(I){let E;const j=Math.max(0,this.oscillations),e=Math.max(0,this.springiness);return E=0==e?I:(Math.exp(e*I)-1)/(Math.exp(e)-1),E*Math.sin((6.283185307179586*j+1.5707963267948966)*I)}}class P extends w{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=I}easeInCore(I){return this.exponent<=0?I:(Math.exp(this.exponent*I)-1)/(Math.exp(this.exponent)-1)}}class o extends w{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=I,this.y1=E,this.x2=j,this.y2=e}easeInCore(I){return e.e.Interpolate(I,this.x1,this.y1,this.x2,this.y2)}}},12737:(I,E,j)=>{"use strict";j.d(E,{e:()=>h});var e=j(11117),w=j(11127),z=j(11533);class h extends z.b{get _matrix(){return this._compose(),this.iZ}set _matrix(I){(I.updateFlag!==this.iZ.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.iZ.U(I),this._markAsDirtyAndDecompose())}constructor(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(I,E.GI(),!1),this.name=I,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=E,this.iZ=(null===w||void 0===w?void 0:w.clone())??e.Matrix.Identity(),this._restMatrix=z??this.iZ.clone(),this._bindMatrix=h??this.iZ.clone(),this._index=t,this._absoluteMatrix=new e.Matrix,this._absoluteBindMatrix=new e.Matrix,this._absoluteInverseBindMatrix=new e.Matrix,this._finalMatrix=new e.Matrix,E.bones.push(this),this.setParent(j,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(I){this.setParent(I)}setParent(I){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==I){if(this.parent){const I=this.parent.children.indexOf(this);-1!==I&&this.parent.children.splice(I,1)}this._parentNode=I,this.parent&&this.parent.children.push(this),E&&this._updateAbsoluteBindMatrices(),this.JR()}}getLocalMatrix(){return this._compose(),this.iZ}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(I){this._restMatrix.U(I)}setRestPose(I){this.setRestMatrix(I)}getBindPose(){return this.getBindMatrix()}setBindMatrix(I){this.ve(I)}setBindPose(I){this.setBindMatrix(I)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const I=e.TmpVectors.LE[0],E=e.TmpVectors.Quaternion[0],j=e.TmpVectors.LE[1];this.getRestMatrix().decompose(I,E,j),this._linkedTransformNode.position.U(j),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??e.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.U(E),this._linkedTransformNode.pz.U(I)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(I){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=I,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.jU}set position(I){this._decompose(),this.jU.U(I),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(I){this.setRotation(I)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(I){this.setRotationQuaternion(I)}get pz(){return this.getScale()}set pz(I){this.setScale(I)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=e.LE.Zero(),this._localRotation=e.Quaternion.Zero(),this.jU=e.LE.Zero()),this.iZ.decompose(this._localScaling,this._localRotation,this.jU))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,e.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.jU,this.iZ)):this._needToCompose=!1)}ve(I){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.U(I),E&&this._updateAbsoluteBindMatrices(),j?this._matrix=I:this.JR()}_updateAbsoluteBindMatrices(I){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(I||(I=this._bindMatrix),this.parent?I.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.U(I),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),E)for(let j=0;j<this.children.length;j++)this.children[j]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}JR(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.JR(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.JR(),this._needToDecompose=!0}_updatePosition(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const z=this.getLocalMatrix();if(0==E)w?(z.addAtIndex(12,I.x),z.addAtIndex(13,I.y),z.addAtIndex(14,I.z)):z.setTranslationFromFloats(I.x,I.y,I.z);else{let E=null;j&&(E=j.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const t=h._TmpMats[0],U=h._TmpVecs[0];this.parent?j&&E?(t.U(this.parent.getAbsoluteMatrix()),t.multiplyToRef(E,t)):t.U(this.parent.getAbsoluteMatrix()):e.Matrix.IdentityToRef(t),w&&t.setTranslationFromFloats(0,0,0),t.invert(),e.LE.TransformCoordinatesToRef(I,t,U),w?(z.addAtIndex(12,U.x),z.addAtIndex(13,U.y),z.addAtIndex(14,U.z)):z.setTranslationFromFloats(U.x,U.y,U.z)}this._markAsDirtyAndDecompose()}translate(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,E,j,!0)}setPosition(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this._updatePosition(I,E,j,!1)}setAbsolutePosition(I,E){this.setPosition(I,1,E)}scale(I,E,j){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const z=this.getLocalMatrix(),t=h._TmpMats[0];e.Matrix.ScalingToRef(I,E,j,t),t.multiplyToRef(z,z),t.invert();for(const e of this.children){const w=e.getLocalMatrix();w.multiplyToRef(t,w),w.multiplyAtIndex(12,I),w.multiplyAtIndex(13,E),w.multiplyAtIndex(14,j),e._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),w)for(const e of this.children)e.scale(I,E,j,w)}setScale(I){this._decompose(),this._localScaling.U(I),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(I){this._decompose(),I.U(this._localScaling)}setYawPitchRoll(I,E,j){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4?arguments[4]:void 0;if(0===w){const t=h._TmpQuat;return e.Quaternion.RotationYawPitchRollToRef(I,E,j,t),void this.setRotationQuaternion(t,w,z)}const t=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(t,z))return;const U=h._TmpMats[1];e.Matrix.RotationYawPitchRollToRef(I,E,j,U),t.multiplyToRef(U,U),this._rotateWithMatrix(U,w,z)}rotate(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3?arguments[3]:void 0;const z=h._TmpMats[0];z.setTranslationFromFloats(0,0,0),e.Matrix.RotationAxisToRef(I,E,z),this._rotateWithMatrix(z,j,w)}setAxisAngle(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3?arguments[3]:void 0;if(0===j){const z=h._TmpQuat;return e.Quaternion.RotationAxisToRef(I,E,z),void this.setRotationQuaternion(z,j,w)}const z=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(z,w))return;const t=h._TmpMats[1];e.Matrix.RotationAxisToRef(I,E,t),z.multiplyToRef(t,t),this._rotateWithMatrix(t,j,w)}setRotation(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(I.y,I.x,I.z,E,j)}setRotationQuaternion(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;if(0===E)return this._decompose(),this._localRotation.U(I),void this._markAsDirtyAndCompose();const w=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,j))return;const z=h._TmpMats[1];e.Matrix.FromQuaternionToRef(I,z),w.multiplyToRef(z,z),this._rotateWithMatrix(z,E,j)}setRotationMatrix(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;if(0===E){const w=h._TmpQuat;return e.Quaternion.FromRotationMatrixToRef(I,w),void this.setRotationQuaternion(w,E,j)}const w=h._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,j))return;const z=h._TmpMats[1];z.U(I),w.multiplyToRef(I,z),this._rotateWithMatrix(z,E,j)}_rotateWithMatrix(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;const e=this.getLocalMatrix(),w=e.m[12],z=e.m[13],t=e.m[14],U=this.getParent(),R=h._TmpMats[3],P=h._TmpMats[4];U&&1==E?(j?(R.U(j.getWorldMatrix()),U.getAbsoluteMatrix().multiplyToRef(R,R)):R.U(U.getAbsoluteMatrix()),P.U(R),P.invert(),e.multiplyToRef(R,e),e.multiplyToRef(I,e),e.multiplyToRef(P,e)):1==E&&j?(R.U(j.getWorldMatrix()),P.U(R),P.invert(),e.multiplyToRef(R,e),e.multiplyToRef(I,e),e.multiplyToRef(P,e)):e.multiplyToRef(I,e),e.setTranslationFromFloats(w,z,t),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(I,E){const j=h._TmpMats[2];return I.U(this.getAbsoluteMatrix()),E?(I.multiplyToRef(E.getWorldMatrix(),I),e.Matrix.ScalingToRef(E.pz.x,E.pz.y,E.pz.z,j)):e.Matrix.IdentityToRef(j),I.invert(),!isNaN(I.m[0])&&(j.multiplyAtIndex(0,this._scalingDeterminant),I.multiplyToRef(j,I),!0)}he(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=e.LE.Zero();return this.getPositionToRef(I,E,j),j}getPositionToRef(){let I=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const I=this.getLocalMatrix();E.x=I.m[12],E.y=I.m[13],E.z=I.m[14]}else{let j=null;I&&(j=I.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let e=h._TmpMats[0];I&&j?(e.U(this.getAbsoluteMatrix()),e.multiplyToRef(j,e)):e=this.getAbsoluteMatrix(),E.x=e.m[12],E.y=e.m[13],E.z=e.m[14]}}getAbsolutePosition(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=e.LE.Zero();return this.getPositionToRef(1,I,E),E}getAbsolutePositionToRef(I,E){this.getPositionToRef(1,I,E)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.iZ.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.U(this.iZ);const I=this._skeleton.getPoseMatrix();I&&this._absoluteMatrix.multiplyToRef(I,this._absoluteMatrix)}const I=this.children,E=I.length;for(let j=0;j<E;j++)I[j].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}iU(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=e.LE.Zero();return this.getDirectionToRef(I,E,j),j}getDirectionToRef(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,w=null;E&&(w=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=h._TmpMats[0];z.U(this.getAbsoluteMatrix()),E&&w&&z.multiplyToRef(w,z),e.LE.TransformNormalToRef(I,z,j),j.normalize()}getRotation(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=e.LE.Zero();return this.getRotationToRef(I,E,j),j}getRotationToRef(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0;const e=h._TmpQuat;this.getRotationQuaternionToRef(I,E,e),e.toEulerAnglesToRef(j)}getRotationQuaternion(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=e.Quaternion.Identity();return this.getRotationQuaternionToRef(I,E,j),j}getRotationQuaternionToRef(){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),E.U(this._localRotation);else{const j=h._TmpMats[0],e=this.getAbsoluteMatrix();I?e.multiplyToRef(I.getWorldMatrix(),j):j.U(e),j.multiplyAtIndex(0,this._scalingDeterminant),j.multiplyAtIndex(1,this._scalingDeterminant),j.multiplyAtIndex(2,this._scalingDeterminant),j.decompose(void 0,E,void 0)}}getRotationMatrix(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1?arguments[1]:void 0;const j=e.Matrix.Identity();return this.getRotationMatrixToRef(I,E,j),j}getRotationMatrixToRef(){let I=arguments.length>1?arguments[1]:void 0,E=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(E);else{const j=h._TmpMats[0],e=this.getAbsoluteMatrix();I?e.multiplyToRef(I.getWorldMatrix(),j):j.U(e),j.multiplyAtIndex(0,this._scalingDeterminant),j.multiplyAtIndex(1,this._scalingDeterminant),j.multiplyAtIndex(2,this._scalingDeterminant),j.getRotationMatrixToRef(E)}}getAbsolutePositionFromLocal(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=e.LE.Zero();return this.getAbsolutePositionFromLocalToRef(I,E,j),j}getAbsolutePositionFromLocalToRef(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,w=null;E&&(w=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=h._TmpMats[0];z.U(this.getAbsoluteMatrix()),E&&w&&z.multiplyToRef(w,z),e.LE.TransformCoordinatesToRef(I,z,j)}getLocalPositionFromAbsolute(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=e.LE.Zero();return this.getLocalPositionFromAbsoluteToRef(I,E,j),j}getLocalPositionFromAbsoluteToRef(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2?arguments[2]:void 0,w=null;E&&(w=E.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const z=h._TmpMats[0];z.U(this.getAbsoluteMatrix()),E&&w&&z.multiplyToRef(w,z),z.invert(),e.LE.TransformCoordinatesToRef(I,z,j)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const I=this._skeleton.bones.indexOf(this);if(-1!==I&&this._skeleton.bones.splice(I,1),this._parentNode&&this._parentNode.children){const I=this._parentNode.children,E=I.indexOf(this);-1!==E&&I.splice(E,1)}super.dispose()}}h._TmpVecs=(0,w.d)(2,e.LE.Zero),h._TmpQuat=e.Quaternion.Identity(),h._TmpMats=(0,w.d)(5,e.Matrix.Identity)},13274:(I,E,j)=>{"use strict";j.d(E,{c:()=>H});var e=j(11101),w=j(11106),z=j(10960),h=j(11117),t=j(11136),U=j(11533),R=j(11562),P=j(11393),o=j(10983),Z=j(11120);class c{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(I){this._idleRotationSpeed=I}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(I){this._idleRotationWaitTime=I}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(I){this._idleRotationSpinupTime=I}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(I){this._attachedCamera=I;const E=this._attachedCamera.GI();this._onPrePointerObservableObserver=E.onPrePointerObservable.add((I=>{I.type!==P.d.POINTERDOWN?I.type===P.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const I=o.e.Now;let E=0;null!=this._lastFrameTime&&(E=I-this._lastFrameTime),this._lastFrameTime=I,this._applyUserInteraction();const j=I-this._lastInteractionTime-this._idleRotationWaitTime,e=Math.max(Math.min(j/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*e,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(E/1e3))}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.GI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(I){this._lastInteractionTime=I??o.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<Z.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let I=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(I=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?I:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=o.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var K=j(13276),L=j(11637);class F{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(I){if(this._autoTransitionRange===I)return;this._autoTransitionRange=I;const E=this._attachedCamera;E&&(I?this._onMeshTargetChangedObserver=E.onMeshTargetChangedObservable.add((I=>{if(I&&(I.Be(!0),I.getBoundingInfo)){const E=I.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*E,this.upperRadiusTransitionRange=.05*E}})):this._onMeshTargetChangedObserver&&E.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(I){this._attachedCamera=I,this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(I){return!!this._attachedCamera&&(this._attachedCamera.radius===I&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(I){if(!this._attachedCamera)return;this._radiusBounceTransition||(F.EasingFunction.setEasingMode(F.EasingMode),this._radiusBounceTransition=L.c.CreateAnimation("radius",L.c.ANIMATIONTYPE_FLOAT,60,F.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const E=L.c.TransitionTo("radius",this._attachedCamera.radius+I,this._attachedCamera,this._attachedCamera.GI(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));E&&this._animatables.push(E)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}F.EasingFunction=new K.c(.3),F.EasingMode=K.u.EASINGMODE_EASEOUT;class C{constructor(){this.onTargetFramingAnimationEndObservable=new z.e,this._mode=C.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(I){this._mode=I}get mode(){return this._mode}set radiusScale(I){this._radiusScale=I}get radiusScale(){return this._radiusScale}set positionScale(I){this._positionScale=I}get positionScale(){return this._positionScale}set defaultElevation(I){this._defaultElevation=I}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(I){this._elevationReturnTime=I}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(I){this._elevationReturnWaitTime=I}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(I){this._zoomStopsAnimation=I}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(I){this._framingTime=I}get framingTime(){return this._framingTime}init(){}attach(I){this._attachedCamera=I;const E=this._attachedCamera.GI();C.EasingFunction.setEasingMode(C.EasingMode),this._onPrePointerObservableObserver=E.onPrePointerObservable.add((I=>{I.type!==P.d.POINTERDOWN?I.type===P.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=I.onMeshTargetChangedObservable.add((I=>{I&&I.getBoundingInfo&&this.zoomOnMesh(I,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=I.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const I=this._attachedCamera.GI();this._onPrePointerObservableObserver&&I.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.Be(!0);const e=I.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(e.minimumWorld,e.maximumWorld,E,j)}zoomOnMeshHierarchy(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;I.Be(!0);const e=I.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(e.min,e.max,E,j)}zoomOnMeshesHierarchy(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new h.LE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=new h.LE(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let z=0;z<I.length;z++){const E=I[z].getHierarchyBoundingVectors(!0);h.LE.CheckExtends(E.min,e,w),h.LE.CheckExtends(E.max,e,w)}this.zoomOnBoundingInfo(e,w,E,j)}zoomOnBoundingInfo(I,E){let j,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const z=I.y,t=z+(E.y-z)*this._positionScale,U=E.FE(I).scale(.5);if(!isFinite(t))return!1;if(e)j=new h.LE(0,t,0);else{const E=I.add(U);j=new h.LE(E.x,t,E.z)}this._vectorTransition||(this._vectorTransition=L.c.CreateAnimation("target",L.c.ANIMATIONTYPE_VECTOR3,60,C.EasingFunction)),this._betaIsAnimating=!0;let R=L.c.TransitionTo("target",j,this._attachedCamera,this._attachedCamera.GI(),60,this._vectorTransition,this._framingTime);R&&this._animatables.push(R);let P=0;if(this._mode===C.FitFrustumSidesMode){const j=this._calculateLowerRadiusFromModelBoundingSphere(I,E);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=U.length()+this._attachedCamera.Te),P=j}else this._mode===C.IgnoreBoundsSizeMode&&(P=this._calculateLowerRadiusFromModelBoundingSphere(I,E),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Te));if(this.autoCorrectCameraLimitsAndSensibility){const j=E.FE(I).length();this._attachedCamera.panningSensibility=5e3/j,this._attachedCamera.wheelPrecision=100/P}return this._radiusTransition||(this._radiusTransition=L.c.CreateAnimation("radius",L.c.ANIMATIONTYPE_FLOAT,60,C.EasingFunction)),R=L.c.TransitionTo("radius",P,this._attachedCamera,this._attachedCamera.GI(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),w&&w(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),R&&this._animatables.push(R),!0}_calculateLowerRadiusFromModelBoundingSphere(I,E){const j=this._attachedCamera;if(!j)return 0;let e=j._calculateLowerRadiusFromModelBoundingSphere(I,E,this._radiusScale);return j.lowerRadiusLimit&&this._mode===C.IgnoreBoundsSizeMode&&(e=e<j.lowerRadiusLimit?j.lowerRadiusLimit:e),j.upperRadiusLimit&&(e=e>j.upperRadiusLimit?j.upperRadiusLimit:e),e}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const I=o.e.Now-this._lastInteractionTime,E=.5*Math.PI-this._defaultElevation,j=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>j&&I>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=L.c.CreateAnimation("beta",L.c.ANIMATIONTYPE_FLOAT,60,C.EasingFunction));const I=L.c.TransitionTo("beta",E,this._attachedCamera,this._attachedCamera.GI(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));I&&this._animatables.push(I)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=o.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}C.EasingFunction=new K.y,C.EasingMode=K.u.EASINGMODE_EASEINOUT,C.IgnoreBoundsSizeMode=0,C.FitFrustumSidesMode=1;var X=j(11564),q=j(11598),x=j(12728),u=j(10953);class b{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(I){I=u.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),j=E.getInputElement();let e=0,w=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=z=>{var h,t;const U=z.event,R="touch"===U.pointerType;if(z.type!==P.d.POINTERMOVE&&-1===this.buttons.indexOf(U.button))return;const o=U.target;if(this._altKey=U.altKey,this._ctrlKey=U.ctrlKey,this._metaKey=U.metaKey,this._shiftKey=U.shiftKey,this._buttonsPressed=U.buttons,E.isPointerLock){const I=U.movementX,E=U.movementY;this.onTouch(null,I,E),this._pointA=null,this._pointB=null}else{if(z.type!==P.d.POINTERDOWN&&z.type!==P.d.POINTERDOUBLETAP&&R&&(null===(h=this._pointA)||void 0===h?void 0:h.pointerId)!==U.pointerId&&(null===(t=this._pointB)||void 0===t?void 0:t.pointerId)!==U.pointerId)return;if(z.type!==P.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!R)if(z.type===P.d.POINTERDOUBLETAP)this.onDoubleTap(U.pointerType);else if(z.type!==P.d.POINTERUP||this._currentMousePointerIdDown!==U.pointerId&&!R){if(z.type===P.d.POINTERMOVE)if(I||U.preventDefault(),this._pointA&&null===this._pointB){const I=U.clientX-this._pointA.x,E=U.clientY-this._pointA.y;this._pointA.x=U.clientX,this._pointA.y=U.clientY,this.onTouch(this._pointA,I,E)}else if(this._pointA&&this._pointB){const I=this._pointA.pointerId===U.pointerId?this._pointA:this._pointB;I.x=U.clientX,I.y=U.clientY;const E=this._pointA.x-this._pointB.x,j=this._pointA.y-this._pointB.y,h=E*E+j*j,t={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:U.pointerId,type:z.type};this.onMultiTouch(this._pointA,this._pointB,e,h,w,t),w=t,e=h}}else{try{null===o||void 0===o||o.releasePointerCapture(U.pointerId)}catch(Z){}R||(this._pointB=null),E._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==U.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==U.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==e||w)&&(this.onMultiTouch(this._pointA,this._pointB,e,0,w,null),e=0,w=null),this._currentMousePointerIdDown=-1,this.onButtonUp(U),I||U.preventDefault()}else{try{null===o||void 0===o||o.setPointerCapture(U.pointerId)}catch(Z){}if(null===this._pointA)this._pointA={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType};else{if(null!==this._pointB)return;this._pointB={x:U.clientX,y:U.clientY,pointerId:U.pointerId,type:U.pointerType}}-1!==this._currentMousePointerIdDown||R||(this._currentMousePointerIdDown=U.pointerId),this.onButtonDown(U),I||(U.preventDefault(),j&&j.focus())}}},this._observer=this.camera.GI()._inputManager._addCameraPointerObserver(this._pointerInput,P.d.POINTERDOWN|P.d.POINTERUP|P.d.POINTERMOVE|P.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,e=0,w=null,this.onLostFocus()},this._contextMenuBind=I=>this.onContextMenu(I),j&&j.addEventListener("contextmenu",this._contextMenuBind,!1);const z=this.camera.GI().getEngine().getHostWindow();z&&u.Tools.RegisterTopRootEvents(z,[{name:"blur",handler:this._onLostFocus}])}Oo(){if(this._onLostFocus){const I=this.camera.GI().getEngine().getHostWindow();I&&u.Tools.UnregisterTopRootEvents(I,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.GI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const I=this.camera.GI().getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(I){}onTouch(I,E,j){}onMultiTouch(I,E,j,e,w,z){}onContextMenu(I){I.preventDefault()}onButtonDown(I){}onButtonUp(I){}onLostFocus(){}}(0,e.b)([(0,w.N)()],b.prototype,"buttons",void 0);class Q extends b{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(I,E){if(0!==this.panningSensibility&&I&&E){const j=E.x-I.x,e=E.y-I.y;this.camera.inertialPanningX+=-j/this.panningSensibility,this.camera.inertialPanningY+=e/this.panningSensibility}}_computePinchZoom(I,E){const j=this.camera.radius||Q.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=j*Math.sqrt(I)/Math.sqrt(E):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(E-I)*j*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(E-I)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(I,E,j){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-E/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility):(this.camera.inertialAlphaOffset-=E/this.angularSensibilityX,this.camera.inertialBetaOffset-=j/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(I,E,j,e,w,z){0===j&&null===w||0===e&&null===z||(this.multiTouchPanAndZoom?(this._computePinchZoom(j,e),this._computeMultiTouchPanning(w,z)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(e)-Math.sqrt(j))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(j,e),this._isPinching=!0):this._computeMultiTouchPanning(w,z)):this.multiTouchPanning?this._computeMultiTouchPanning(w,z):this.pinchZoom&&this._computePinchZoom(j,e))}onButtonDown(I){this._isPanClick=I.button===this.camera._panningMouseButton}onButtonUp(I){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}Q.MinimumRadiusForPinch=.001,(0,e.b)([(0,w.N)()],Q.prototype,"buttons",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"angularSensibilityX",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"angularSensibilityY",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"pinchPrecision",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"pinchDeltaPercentage",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"useNaturalPinchZoom",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"pinchZoom",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"panningSensibility",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"multiTouchPanning",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"multiTouchPanAndZoom",void 0),x.b.ArcRotateCameraPointersInput=Q;var G=j(11399);class y{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(I){I=u.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.GI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const j=E.event;if(!j.metaKey)if(E.type===G.d.KEYDOWN){if(this._ctrlPressed=j.ctrlKey,this._altPressed=j.altKey,-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysReset.indexOf(j.keyCode)){-1===this._keys.indexOf(j.keyCode)&&this._keys.push(j.keyCode),j.preventDefault&&(I||j.preventDefault())}}else if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysReset.indexOf(j.keyCode)){const E=this._keys.indexOf(j.keyCode);E>=0&&this._keys.splice(E,1),j.preventDefault&&(I||j.preventDefault())}})))}Oo(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let E=0;E<this._keys.length;E++){const j=this._keys[E];-1!==this.keysLeft.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX-=1/this.panningSensibility:I.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset+=1/this.zoomingSensibility:I.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningX+=1/this.panningSensibility:I.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(j)?this._ctrlPressed&&this.camera._useCtrlForPanning?I.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?I.inertialRadiusOffset-=1/this.zoomingSensibility:I.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(j)&&I.useInputToRestoreState&&I.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,e.b)([(0,w.N)()],y.prototype,"keysUp",void 0),(0,e.b)([(0,w.N)()],y.prototype,"keysDown",void 0),(0,e.b)([(0,w.N)()],y.prototype,"keysLeft",void 0),(0,e.b)([(0,w.N)()],y.prototype,"keysRight",void 0),(0,e.b)([(0,w.N)()],y.prototype,"keysReset",void 0),(0,e.b)([(0,w.N)()],y.prototype,"panningSensibility",void 0),(0,e.b)([(0,w.N)()],y.prototype,"zoomingSensibility",void 0),(0,e.b)([(0,w.N)()],y.prototype,"useAltToZoom",void 0),(0,e.b)([(0,w.N)()],y.prototype,"angularSpeed",void 0),x.b.ArcRotateCameraKeyboardMoveInput=y;var d=j(11167),a=j(11402);class l{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new h.LE(0,0,0),this._globalOffset=new h.LE(0,0,0),this._inertialPanning=h.LE.Zero()}_computeDeltaFromMouseWheelLegacyEvent(I,E){let j=0;const e=.01*I*this.wheelDeltaPercentage*E;return j=I>0?e/(1+this.wheelDeltaPercentage):e*(1+this.wheelDeltaPercentage),j}attachControl(I){I=u.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==P.d.POINTERWHEEL)return;const j=E.event;let e=0;const w=j.deltaMode===a.c.DOM_DELTA_LINE?40:1,z=-j.deltaY*w;if(this.customComputeDeltaFromMouseWheel)e=this.customComputeDeltaFromMouseWheel(z,this,j);else if(this.wheelDeltaPercentage){if(e=this._computeDeltaFromMouseWheelLegacyEvent(z,this.camera.radius),e>0){let I=this.camera.radius,E=this.camera.inertialRadiusOffset+e;for(let j=0;j<20&&!(I<=E)&&!(Math.abs(E*this.camera.inertia)<.001);j++)I-=E,E*=this.camera.inertia;I=(0,t.Clamp)(I,0,Number.MAX_VALUE),e=this._computeDeltaFromMouseWheelLegacyEvent(z,I)}}else e=z/(40*this.wheelPrecision);e&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(e)):this.camera.inertialRadiusOffset+=e),j.preventDefault&&(I||j.preventDefault())},this._observer=this.camera.GI()._inputManager._addCameraPointerObserver(this._wheel,P.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.mz(0)}Oo(){this._observer&&(this.camera.GI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const I=this.camera;0+I.inertialAlphaOffset+I.inertialBetaOffset+I.inertialRadiusOffset&&(this._updateHitPlane(),I.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(I.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const I=this.camera,E=I.target.FE(I.position);this._hitPlane=d.b.FromPositionAndNormal(I.target,E)}_getPosition(){const I=this.camera,E=I.GI(),j=E.createPickingRay(E.pointerX,E.pointerY,h.Matrix.Identity(),I,!1);0===I.targetScreenOffset.x&&0===I.targetScreenOffset.y||(this._viewOffset.set(I.targetScreenOffset.x,I.targetScreenOffset.y,0),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),this._globalOffset=h.LE.TransformNormal(this._viewOffset,I._cameraTransformMatrix),j.origin.addInPlace(this._globalOffset));let e=0;return this._hitPlane&&(e=j.intersectsPlane(this._hitPlane)??0),j.origin.addInPlace(j.direction.scaleInPlace(e))}_zoomToMouse(I){const E=this.camera,j=1-E.inertia;if(E.lowerRadiusLimit){const e=E.lowerRadiusLimit??0;E.radius-(E.inertialRadiusOffset+I)/j<e&&(I=(E.radius-e)*j-E.inertialRadiusOffset)}if(E.upperRadiusLimit){const e=E.upperRadiusLimit??0;E.radius-(E.inertialRadiusOffset+I)/j>e&&(I=(E.radius-e)*j-E.inertialRadiusOffset)}const e=I/j/E.radius,w=this._getPosition(),z=h.TmpVectors.LE[6];w.subtractToRef(E.target,z),z.scaleInPlace(e),z.scaleInPlace(j),this._inertialPanning.addInPlace(z),E.inertialRadiusOffset+=I}_zeroIfClose(I){Math.abs(I.x)<Z.b&&(I.x=0),Math.abs(I.y)<Z.b&&(I.y=0),Math.abs(I.z)<Z.b&&(I.z=0)}}(0,e.b)([(0,w.N)()],l.prototype,"wheelPrecision",void 0),(0,e.b)([(0,w.N)()],l.prototype,"zoomToMouseLocation",void 0),(0,e.b)([(0,w.N)()],l.prototype,"wheelDeltaPercentage",void 0),x.b.ArcRotateCameraMouseWheelInput=l;class i extends x.d{constructor(I){super(I)}addMouseWheel(){return this.add(new l),this}addPointers(){return this.add(new Q),this}addKeyboard(){return this.add(new y),this}}var r=j(11073);function n(I,E){return isNaN(I)?E:I}U.b.AddNodeConstructor("ArcRotateCamera",((I,E)=>()=>new H(I,0,0,1,h.LE.Zero(),E)));class H extends q.c{get target(){return this._target}set target(I){this.setTarget(I)}get targetHost(){return this._targetHost}set targetHost(I){I&&this.setTarget(I)}getTarget(){return this.target}get position(){return this._position}set position(I){this.setPosition(I)}set upVector(I){this._upToYMatrix||(this._yToUpMatrix=new h.Matrix,this._upToYMatrix=new h.Matrix,this._upVector=h.LE.Zero()),I.normalize(),this._upVector.U(I),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){h.Matrix.RotationAlignToRef(h.LE.UpReadOnly,this._upVector,this._yToUpMatrix),h.Matrix.RotationAlignToRef(this._upVector,h.LE.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityX:0}set angularSensibilityX(I){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityX=I)}get angularSensibilityY(){const I=this.inputs.attached.pointers;return I?I.angularSensibilityY:0}set angularSensibilityY(I){const E=this.inputs.attached.pointers;E&&(E.angularSensibilityY=I)}get pinchPrecision(){const I=this.inputs.attached.pointers;return I?I.pinchPrecision:0}set pinchPrecision(I){const E=this.inputs.attached.pointers;E&&(E.pinchPrecision=I)}get pinchDeltaPercentage(){const I=this.inputs.attached.pointers;return I?I.pinchDeltaPercentage:0}set pinchDeltaPercentage(I){const E=this.inputs.attached.pointers;E&&(E.pinchDeltaPercentage=I)}get useNaturalPinchZoom(){const I=this.inputs.attached.pointers;return!!I&&I.useNaturalPinchZoom}set useNaturalPinchZoom(I){const E=this.inputs.attached.pointers;E&&(E.useNaturalPinchZoom=I)}get panningSensibility(){const I=this.inputs.attached.pointers;return I?I.panningSensibility:0}set panningSensibility(I){const E=this.inputs.attached.pointers;E&&(E.panningSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const E=this.inputs.attached.keyboard;E&&(E.keysUp=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const E=this.inputs.attached.keyboard;E&&(E.keysDown=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const E=this.inputs.attached.keyboard;E&&(E.keysRight=I)}get wheelPrecision(){const I=this.inputs.attached.mousewheel;return I?I.wheelPrecision:0}set wheelPrecision(I){const E=this.inputs.attached.mousewheel;E&&(E.wheelPrecision=I)}get zoomToMouseLocation(){const I=this.inputs.attached.mousewheel;return!!I&&I.zoomToMouseLocation}set zoomToMouseLocation(I){const E=this.inputs.attached.mousewheel;E&&(E.zoomToMouseLocation=I)}get wheelDeltaPercentage(){const I=this.inputs.attached.mousewheel;return I?I.wheelDeltaPercentage:0}set wheelDeltaPercentage(I){const E=this.inputs.attached.mousewheel;E&&(E.wheelDeltaPercentage=I)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(I){I!==this.useBouncingBehavior&&(I?(this._bouncingBehavior=new F,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(I){I!==this.useFramingBehavior&&(I?(this._framingBehavior=new C,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(I){I!==this.useAutoRotationBehavior&&(I?(this._autoRotationBehavior=new c,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(I,E,j,e,w,t){var U;let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(I,h.LE.Zero(),t,R),U=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=h.LE.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=h.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new h.Matrix,this.panningAxis=new h.LE(1,1,0),this._transformedDirection=new h.LE,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new z.e,this.checkCollisions=!1,this.collisionRadius=new h.LE(.5,.5,.5),this._previousPosition=h.LE.Zero(),this._collisionVelocity=h.LE.Zero(),this._newPosition=h.LE.Zero(),this._computationVector=h.LE.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new h.LE(NaN,NaN,NaN),this._goalTargetScreenOffset=new h.Vector2(NaN,NaN),this._onCollisionPositionChange=function(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j?(U.setPosition(E),U.tK&&U.tK(j)):U._previousPosition.U(U._position);const e=Math.cos(U.alpha),w=Math.sin(U.alpha),z=Math.cos(U.beta);let h=Math.sin(U.beta);0===h&&(h=1e-4);const t=U._getTargetPosition();U._computationVector.nz(U.radius*e*h,U.radius*z,U.radius*w*h),t.addToRef(U._computationVector,U._newPosition),U._position.U(U._newPosition);let R=U.upVector;U.allowUpsideDown&&U.beta<0&&(R=R.clone(),R=R.negate()),U._computeViewMatrix(U._position,t,R),U._viewMatrix.addAtIndex(12,U.targetScreenOffset.x),U._viewMatrix.addAtIndex(13,U.targetScreenOffset.y),U._collisionTriggered=!1},this._target=h.LE.Zero(),w&&this.setTarget(w),this.alpha=E,this.beta=j,this.radius=e,this.getViewMatrix(),this.inputs=new i(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new h.LE(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=h.Vector2.Zero()}_updateCache(I){I||super._updateCache(),this._cache._target.U(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.U(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const I=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?I.addToRef(this._targetBoundingCenter,this._target):this._target.U(I)}const I=this._getLockedTargetPosition();return I||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>Z.b&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,z=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=z?this._currentInterpolationFactor=z:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=n(I,this._goalAlpha),this._goalBeta=n(E,this._goalBeta),this._goalRadius=n(j,this._goalRadius),this._goalTarget.set(n(e.x,this._goalTarget.x),n(e.y,this._goalTarget.y),n(e.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(n(w.x,this._goalTargetScreenOffset.x),n(w.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,t.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,t.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,t.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,t.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(I,E){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const w=arguments;E=u.Tools.BackCompatCameraNoPreventDefault(w),this._useCtrlForPanning=j,this._panningMouseButton=e,"boolean"===typeof w[0]&&(w.length>1&&(this._useCtrlForPanning=w[1]),w.length>2&&(this._panningMouseButton=w[2])),this.inputs.attachElement(E),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Oo(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let I=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){I=!0;const E=this.invertRotation?-1:1,j=this._calculateHandednessMultiplier();let e=this.inertialAlphaOffset*j;this.beta<0&&(e*=-1),this.alpha+=e*E,this.beta+=this.inertialBetaOffset*E,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<Z.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<Z.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*Z.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){I=!0;const E=new h.LE(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),E.multiplyInPlace(this.panningAxis),h.LE.TransformNormalToRef(E,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const I=this.upVector,E=h.LE.CrossToRef(this._transformedDirection,I,this._transformedDirection);h.LE.CrossToRef(I,E,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);h.LE.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.U(this._transformedDirection)}else{if(this.parent){const I=h.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(I),I.transposeToRef(I),h.LE.TransformCoordinatesToRef(this._transformedDirection,I,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*Z.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*Z.b&&(this.inertialPanningY=0)}if(I)this.stopInterpolation();else if(this._isInterpolating){let I=!1;const E=this._scene.getEngine().getDeltaTime()/1e3,j=1-Math.pow(2,-E/this._currentInterpolationFactor),e=n(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const E=h.TmpVectors.LE[0].set(n(this._goalTarget.x,this._target.x),n(this._goalTarget.y,this._target.y),n(this._goalTarget.z,this._target.z));h.LE.LerpToRef(this.target,E,j,this._target),10*h.LE.Distance(this.target,E)/e<Z.b?(this._goalTarget.set(NaN,NaN,NaN),this.target.U(E),this.setTarget(this.target,!1,!0,!0)):I=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const E=h.Quaternion.RotationAlphaBetaGammaToRef(n(this._goalAlpha,this.alpha),n(this._goalBeta,this.beta),0,h.TmpVectors.Quaternion[0]),e=h.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,h.TmpVectors.Quaternion[1]),w=h.Quaternion.SlerpToRef(e,E,j,h.TmpVectors.Quaternion[2]);w.normalize();const z=w.toAlphaBetaGammaToRef(h.TmpVectors.LE[0]);if(this.alpha=z.x,this.beta=z.y,w.isApprox(E,Z.b/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const I=E.toAlphaBetaGammaToRef(h.TmpVectors.LE[0]);this.alpha=I.x,this.beta=I.y}else I=!0}if(isNaN(this._goalRadius)||(this.radius+=(e-this.radius)*j,Math.abs(e/this.radius-1)<Z.b?(this._goalRadius=NaN,this.radius=e):I=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const E=h.TmpVectors.Vector2[0].set(n(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),n(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));h.Vector2.LerpToRef(this.targetScreenOffset,E,j,this.targetScreenOffset),h.Vector2.Distance(this.targetScreenOffset,E)<Z.b?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.U(E)):I=!0}this._isInterpolating=I}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.LE.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const I=this.alpha;var E,j;this.alpha=function(I){let E=Math.PI/2;return 0===I.x&&0===I.z||(E=Math.acos(I.x/Math.sqrt(Math.pow(I.x,2)+Math.pow(I.z,2)))),I.z<0&&(E=2*Math.PI-E),E}(this._computationVector),this.beta=(E=this._computationVector.y,j=this.radius,Math.acos(E/j));const e=Math.round((I-this.alpha)/(2*Math.PI));this.alpha+=2*e*Math.PI,this._checkLimits()}setPosition(I){this._position.equals(I)||(this._position.U(I),this.rebuildAnglesAndRadius())}setTarget(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e=this.overrideCloneAlphaBetaRadius??e,I.Be)E&&I.getBoundingInfo?this._targetBoundingCenter=I.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,I.Be(),this._targetHost=I,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const E=I,e=this._getTargetPosition();if(e&&!j&&e.equals(E))return;this._targetHost=null,this._target=E,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}e||this.rebuildAnglesAndRadius()}_getViewMatrix(){const I=Math.cos(this.alpha),E=Math.sin(this.alpha),j=Math.cos(this.beta);let e=Math.sin(this.beta);0===e&&(e=1e-4),0===this.radius&&(this.radius=1e-4);const w=this._getTargetPosition();if(this._computationVector.nz(this.radius*I*e,this.radius*j,this.radius*E*e),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||h.LE.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),w.addToRef(this._computationVector,this._newPosition),this.GI().collisionsEnabled&&this.checkCollisions){const I=this.GI().collisionCoordinator;this._collider||(this._collider=I.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,I.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.U(this._newPosition);let I=this.upVector;this.allowUpsideDown&&e<0&&(I=I.negate()),this._computeViewMatrix(this._position,w,I),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.U(w),this._viewMatrix}zoomOn(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I=I||this.GI().meshes;const j=R.d.MinMax(I);let e=this._calculateLowerRadiusFromModelBoundingSphere(j.min,j.max);if(e=Math.max(Math.min(e,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=e*this.zoomOnFactor,this.mode===X.e.ORTHOGRAPHIC_CAMERA){const I=this.GI().getEngine().getAspectRatio(this),E=e*this.zoomOnFactor/2;this.orthoLeft=-E*I,this.orthoRight=E*I,this.orthoBottom=-E,this.orthoTop=E}this.focusOn({min:j.min,max:j.max,distance:e},E)}focusOn(I){let E,j,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===I.min){const e=I||this.GI().meshes;E=R.d.MinMax(e),j=h.LE.Distance(E.min,E.max)}else{E=I,j=I.distance}this._target=R.d.Center(E),e||(this.maxZ=2*j)}createRigCamera(I,E){let j=0;switch(this.cameraRigMode){case X.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.e.RIG_MODE_VR:j=this._cameraRigParams.stereoHalfAngle*(0===E?1:-1);break;case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:j=this._cameraRigParams.stereoHalfAngle*(0===E?-1:1)}const e=new H(I,this.alpha+j,this.beta,this.radius,this._target,this.GI());return e._cameraRigParams={},e.isRigCamera=!0,e.rigParent=this,e.upVector=this.upVector,e.mode=this.mode,e.orthoLeft=this.orthoLeft,e.orthoRight=this.orthoRight,e.orthoBottom=this.orthoBottom,e.orthoTop=this.orthoTop,e}_updateRigCameras(){const I=this._rigCameras[0],E=this._rigCameras[1];switch(I.beta=E.beta=this.beta,this.cameraRigMode){case X.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.e.RIG_MODE_VR:I.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case X.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:I.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,E.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const e=h.LE.Distance(I,E),w=this.GI().getEngine().getAspectRatio(this),z=Math.tan(this.fov/2),t=z*w,U=.5*e*j,R=U*Math.sqrt(1+1/(t*t)),P=U*Math.sqrt(1+1/(z*z));return Math.max(R,P)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,e.b)([(0,w.N)()],H.prototype,"alpha",void 0),(0,e.b)([(0,w.N)()],H.prototype,"beta",void 0),(0,e.b)([(0,w.N)()],H.prototype,"radius",void 0),(0,e.b)([(0,w.N)()],H.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,e.b)([(0,w.K)("target")],H.prototype,"_target",void 0),(0,e.b)([(0,w.A)("targetHost")],H.prototype,"_targetHost",void 0),(0,e.b)([(0,w.N)()],H.prototype,"inertialAlphaOffset",void 0),(0,e.b)([(0,w.N)()],H.prototype,"inertialBetaOffset",void 0),(0,e.b)([(0,w.N)()],H.prototype,"inertialRadiusOffset",void 0),(0,e.b)([(0,w.N)()],H.prototype,"lowerAlphaLimit",void 0),(0,e.b)([(0,w.N)()],H.prototype,"upperAlphaLimit",void 0),(0,e.b)([(0,w.N)()],H.prototype,"lowerBetaLimit",void 0),(0,e.b)([(0,w.N)()],H.prototype,"upperBetaLimit",void 0),(0,e.b)([(0,w.N)()],H.prototype,"lowerRadiusLimit",void 0),(0,e.b)([(0,w.N)()],H.prototype,"upperRadiusLimit",void 0),(0,e.b)([(0,w.N)()],H.prototype,"lowerTargetYLimit",void 0),(0,e.b)([(0,w.N)()],H.prototype,"inertialPanningX",void 0),(0,e.b)([(0,w.N)()],H.prototype,"inertialPanningY",void 0),(0,e.b)([(0,w.N)()],H.prototype,"pinchToPanMaxDistance",void 0),(0,e.b)([(0,w.N)()],H.prototype,"panningDistanceLimit",void 0),(0,e.b)([(0,w.K)()],H.prototype,"panningOriginTarget",void 0),(0,e.b)([(0,w.N)()],H.prototype,"panningInertia",void 0),(0,e.b)([(0,w.N)()],H.prototype,"zoomToMouseLocation",null),(0,e.b)([(0,w.N)()],H.prototype,"zoomOnFactor",void 0),(0,e.b)([(0,w.H)()],H.prototype,"targetScreenOffset",void 0),(0,e.b)([(0,w.N)()],H.prototype,"allowUpsideDown",void 0),(0,e.b)([(0,w.N)()],H.prototype,"useInputToRestoreState",void 0),(0,e.b)([(0,w.N)()],H.prototype,"restoreStateInterpolationFactor",void 0),(0,r.h)("BABYLON.ArcRotateCamera",H)},12728:(I,E,j)=>{"use strict";j.d(E,{b:()=>h,d:()=>t});var e=j(10974),w=j(11149),z=j(11564),h={};class t{constructor(I){this.attachedToElement=!1,this.attached={},this.camera=I,this.checkInputs=()=>{}}add(I){const E=I.getSimpleName();this.attached[E]?e.b.Warn("camera input of type "+E+" already exists on camera"):(this.attached[E]=I,I.camera=this.camera,I.checkInputs&&(this.checkInputs=this._addCheckInputs(I.checkInputs.bind(I))),this.attachedToElement&&I.attachControl(this.noPreventDefault))}remove(I){for(const E in this.attached){const j=this.attached[E];if(j===I)return j.Oo(),j.camera=null,delete this.attached[E],void this.rebuildInputCheck()}}removeByType(I){for(const E in this.attached){const j=this.attached[E];j.getClassName()===I&&(j.Oo(),j.camera=null,delete this.attached[E],this.rebuildInputCheck())}}_addCheckInputs(I){const E=this.checkInputs;return()=>{E(),I()}}attachInput(I){this.attachedToElement&&I.attachControl(this.noPreventDefault)}attachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){I=!z.e.ForceAttachControlToAlwaysPreventDefault&&I,this.attachedToElement=!0,this.noPreventDefault=I;for(const E in this.attached)this.attached[E].attachControl(I)}}detachElement(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const E in this.attached)this.attached[E].Oo(),I&&(this.attached[E].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const I in this.attached){const E=this.attached[I];E.checkInputs&&(this.checkInputs=this._addCheckInputs(E.checkInputs.bind(E)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(I){const E={};for(const j in this.attached){const I=this.attached[j],e=w.e.Serialize(I);E[I.getClassName()]=e}I.inputsmgr=E}parse(I){const E=I.inputsmgr;if(E){this.clear();for(const I in E){const j=h[I];if(j){const e=E[I],z=w.e.Parse((()=>new j),e,null);this.add(z)}}}else for(const j in this.attached){const E=h[this.attached[j].getClassName()];if(E){const e=w.e.Parse((()=>new E),I,null);this.remove(this.attached[j]),this.add(e)}}}}},12720:(I,E,j)=>{"use strict";j.d(E,{e:()=>b});var e=j(11101),w=j(11106),z=j(11117),h=j(11598),t=j(12728),U=j(11399),R=j(10953);class P{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(I){I=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.GI(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((E=>{const j=E.event;if(!j.metaKey)if(E.type===U.d.KEYDOWN){if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysUpward.indexOf(j.keyCode)||-1!==this.keysDownward.indexOf(j.keyCode)||-1!==this.keysRotateLeft.indexOf(j.keyCode)||-1!==this.keysRotateRight.indexOf(j.keyCode)||-1!==this.keysRotateUp.indexOf(j.keyCode)||-1!==this.keysRotateDown.indexOf(j.keyCode)){-1===this._keys.indexOf(j.keyCode)&&this._keys.push(j.keyCode),I||j.preventDefault()}}else if(-1!==this.keysUp.indexOf(j.keyCode)||-1!==this.keysDown.indexOf(j.keyCode)||-1!==this.keysLeft.indexOf(j.keyCode)||-1!==this.keysRight.indexOf(j.keyCode)||-1!==this.keysUpward.indexOf(j.keyCode)||-1!==this.keysDownward.indexOf(j.keyCode)||-1!==this.keysRotateLeft.indexOf(j.keyCode)||-1!==this.keysRotateRight.indexOf(j.keyCode)||-1!==this.keysRotateUp.indexOf(j.keyCode)||-1!==this.keysRotateDown.indexOf(j.keyCode)){const E=this._keys.indexOf(j.keyCode);E>=0&&this._keys.splice(E,1),I||j.preventDefault()}})))}Oo(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const I=this.camera;for(let E=0;E<this._keys.length;E++){const j=this._keys[E],e=I._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(j)?I._localDirection.nz(-e,0,0):-1!==this.keysUp.indexOf(j)?I._localDirection.nz(0,0,e):-1!==this.keysRight.indexOf(j)?I._localDirection.nz(e,0,0):-1!==this.keysDown.indexOf(j)?I._localDirection.nz(0,0,-e):-1!==this.keysUpward.indexOf(j)?I._localDirection.nz(0,e,0):-1!==this.keysDownward.indexOf(j)?I._localDirection.nz(0,-e,0):-1!==this.keysRotateLeft.indexOf(j)?(I._localDirection.nz(0,0,0),I.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(j)?(I._localDirection.nz(0,0,0),I.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(j)?(I._localDirection.nz(0,0,0),I.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(j)&&(I._localDirection.nz(0,0,0),I.cameraRotation.x+=this._getLocalRotation()),I.GI().useRightHandedSystem&&(I._localDirection.z*=-1),I.getViewMatrix().invertToRef(I._cameraTransformMatrix),z.LE.TransformNormalToRef(I._localDirection,I._cameraTransformMatrix,I._transformedDirection),I.cameraDirection.addInPlace(I._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const I=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*I}}(0,e.b)([(0,w.N)()],P.prototype,"keysUp",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysUpward",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysDown",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysDownward",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysLeft",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysRight",void 0),(0,e.b)([(0,w.N)()],P.prototype,"rotationSpeed",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysRotateLeft",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysRotateRight",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysRotateUp",void 0),(0,e.b)([(0,w.N)()],P.prototype,"keysRotateDown",void 0),t.b.FreeCameraKeyboardMoveInput=P;var o=j(10960),Z=j(11393);class c{constructor(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=I,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new o.e,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(I){I=R.Tools.BackCompatCameraNoPreventDefault(arguments);const E=this.camera.getEngine(),j=E.getInputElement();this._pointerInput||(this._pointerInput=e=>{const w=e.event,z="touch"===w.pointerType;if(!this.touchEnabled&&z)return;if(e.type!==Z.d.POINTERMOVE&&-1===this.buttons.indexOf(w.button))return;const h=w.target;if(e.type===Z.d.POINTERDOWN){if(z&&-1!==this._activePointerId||!z&&-1!==this._currentActiveButton)return;this._activePointerId=w.pointerId;try{null===h||void 0===h||h.setPointerCapture(w.pointerId)}catch(t){}-1===this._currentActiveButton&&(this._currentActiveButton=w.button),this._previousPosition={x:w.clientX,y:w.clientY},I||(w.preventDefault(),j&&j.focus()),E.isPointerLock&&this._onMouseMove&&this._onMouseMove(e.event)}else if(e.type===Z.d.POINTERUP){if(z&&this._activePointerId!==w.pointerId||!z&&this._currentActiveButton!==w.button)return;try{null===h||void 0===h||h.releasePointerCapture(w.pointerId)}catch(t){}this._currentActiveButton=-1,this._previousPosition=null,I||w.preventDefault(),this._activePointerId=-1}else if(e.type===Z.d.POINTERMOVE&&(this._activePointerId===w.pointerId||!z))if(E.isPointerLock&&this._onMouseMove)this._onMouseMove(e.event);else if(this._previousPosition){const E=this.camera._calculateHandednessMultiplier(),j=(w.clientX-this._previousPosition.x)*E,e=w.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=j/this.angularSensibility,this.camera.cameraRotation.x+=e/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:j,offsetY:e}),this._previousPosition={x:w.clientX,y:w.clientY},I||w.preventDefault()}}),this._onMouseMove=j=>{if(!E.isPointerLock)return;const e=this.camera._calculateHandednessMultiplier(),w=j.movementX*e;this.camera.cameraRotation.y+=w/this.angularSensibility;const z=j.movementY;this.camera.cameraRotation.x+=z/this.angularSensibility,this._previousPosition=null,I||j.preventDefault()},this._observer=this.camera.GI()._inputManager._addCameraPointerObserver(this._pointerInput,Z.d.POINTERDOWN|Z.d.POINTERUP|Z.d.POINTERMOVE),j&&(this._contextMenuBind=I=>this.onContextMenu(I),j.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(I){I.preventDefault()}Oo(){if(this._observer){if(this.camera.GI()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,e.b)([(0,w.N)()],c.prototype,"buttons",void 0),(0,e.b)([(0,w.N)()],c.prototype,"angularSensibility",void 0),t.b.FreeCameraMouseInput=c;var K,L=j(11402);class F{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new o.e,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(I){I=R.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=E=>{if(E.type!==Z.d.POINTERWHEEL)return;const j=E.event,e=j.deltaMode===L.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*e*j.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*e*j.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*e*j.deltaZ/this._normalize,j.preventDefault&&(I||j.preventDefault())},this._observer=this.camera.GI()._inputManager._addCameraPointerObserver(this._wheel,Z.d.POINTERWHEEL)}Oo(){this._observer&&(this.camera.GI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,e.b)([(0,w.N)()],F.prototype,"wheelPrecisionX",void 0),(0,e.b)([(0,w.N)()],F.prototype,"wheelPrecisionY",void 0),(0,e.b)([(0,w.N)()],F.prototype,"wheelPrecisionZ",void 0),function(I){I[I.MoveRelative=0]="MoveRelative",I[I.RotateRelative=1]="RotateRelative",I[I.MoveScene=2]="MoveScene"}(K||(K={}));class C extends F{constructor(){super(...arguments),this._moveRelative=z.LE.Zero(),this._rotateRelative=z.LE.Zero(),this._moveScene=z.LE.Zero(),this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(I){null===I&&this._wheelXAction!==K.MoveRelative||(this._wheelXAction=K.MoveRelative,this._wheelXActionCoordinate=I)}get wheelXMoveRelative(){return this._wheelXAction!==K.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(I){null===I&&this._wheelYAction!==K.MoveRelative||(this._wheelYAction=K.MoveRelative,this._wheelYActionCoordinate=I)}get wheelYMoveRelative(){return this._wheelYAction!==K.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(I){null===I&&this._wheelZAction!==K.MoveRelative||(this._wheelZAction=K.MoveRelative,this._wheelZActionCoordinate=I)}get wheelZMoveRelative(){return this._wheelZAction!==K.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(I){null===I&&this._wheelXAction!==K.RotateRelative||(this._wheelXAction=K.RotateRelative,this._wheelXActionCoordinate=I)}get wheelXRotateRelative(){return this._wheelXAction!==K.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(I){null===I&&this._wheelYAction!==K.RotateRelative||(this._wheelYAction=K.RotateRelative,this._wheelYActionCoordinate=I)}get wheelYRotateRelative(){return this._wheelYAction!==K.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(I){null===I&&this._wheelZAction!==K.RotateRelative||(this._wheelZAction=K.RotateRelative,this._wheelZActionCoordinate=I)}get wheelZRotateRelative(){return this._wheelZAction!==K.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(I){null===I&&this._wheelXAction!==K.MoveScene||(this._wheelXAction=K.MoveScene,this._wheelXActionCoordinate=I)}get wheelXMoveScene(){return this._wheelXAction!==K.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(I){null===I&&this._wheelYAction!==K.MoveScene||(this._wheelYAction=K.MoveScene,this._wheelYActionCoordinate=I)}get wheelYMoveScene(){return this._wheelYAction!==K.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(I){null===I&&this._wheelZAction!==K.MoveScene||(this._wheelZAction=K.MoveScene,this._wheelZActionCoordinate=I)}get wheelZMoveScene(){return this._wheelZAction!==K.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.mz(0),this._rotateRelative.mz(0),this._moveScene.mz(0),this._updateCamera(),this.camera.GI().useRightHandedSystem&&(this._moveRelative.z*=-1);const I=z.Matrix.Zero();this.camera.getViewMatrix().invertToRef(I);const E=z.LE.Zero();z.LE.TransformNormalToRef(this._moveRelative,I,E),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(E),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(I,E,j){if(0===I)return;if(null===E||null===j)return;let e=null;switch(E){case K.MoveRelative:e=this._moveRelative;break;case K.RotateRelative:e=this._rotateRelative;break;case K.MoveScene:e=this._moveScene}switch(j){case 0:e.set(I,0,0);break;case 1:e.set(0,I,0);break;case 2:e.set(0,0,I)}}}(0,e.b)([(0,w.N)()],C.prototype,"wheelXMoveRelative",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelYMoveRelative",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelZMoveRelative",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelXRotateRelative",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelYRotateRelative",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelZRotateRelative",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelXMoveScene",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelYMoveScene",null),(0,e.b)([(0,w.N)()],C.prototype,"wheelZMoveScene",null),t.b.FreeCameraMouseWheelInput=C;class X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=I,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=R.Tools.IsSafari()}attachControl(I){I=R.Tools.BackCompatCameraNoPreventDefault(arguments);let E=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=j=>{const e=j.event,w="mouse"===e.pointerType||this._isSafari&&"undefined"===typeof e.pointerType;if(this.allowMouse||!w)if(j.type===Z.d.POINTERDOWN){if(I||e.preventDefault(),this._pointerPressed.push(e.pointerId),1!==this._pointerPressed.length)return;E={x:e.clientX,y:e.clientY}}else if(j.type===Z.d.POINTERUP){I||e.preventDefault();const j=this._pointerPressed.indexOf(e.pointerId);if(-1===j)return;if(this._pointerPressed.splice(j,1),0!=j)return;E=null,this._offsetX=null,this._offsetY=null}else if(j.type===Z.d.POINTERMOVE){if(I||e.preventDefault(),!E)return;if(0!=this._pointerPressed.indexOf(e.pointerId))return;this._offsetX=e.clientX-E.x,this._offsetY=-(e.clientY-E.y)}}),this._observer=this.camera.GI()._inputManager._addCameraPointerObserver(this._pointerInput,Z.d.POINTERDOWN|Z.d.POINTERUP|Z.d.POINTERMOVE),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.addEventListener("blur",this._onLostFocus)}}Oo(){if(this._pointerInput){if(this._observer&&(this.camera.GI()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const I=this.camera.getEngine().getInputElement();I&&I.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const I=this.camera,E=I._calculateHandednessMultiplier();I.cameraRotation.y=E*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)I.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const E=I._computeLocalCameraSpeed(),j=new z.LE(0,0,0!==this.touchMoveSensibility?E*this._offsetY/this.touchMoveSensibility:0);z.Matrix.RotationYawPitchRollToRef(I.rotation.y,I.rotation.x,0,I._cameraRotationMatrix),I.cameraDirection.addInPlace(z.LE.TransformCoordinates(j,I._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,e.b)([(0,w.N)()],X.prototype,"touchAngularSensibility",void 0),(0,e.b)([(0,w.N)()],X.prototype,"touchMoveSensibility",void 0),t.b.FreeCameraTouchInput=X;class q extends t.d{constructor(I){super(I),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new P),this}addMouse(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new c(I),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new C,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new X),this}clear(){super.clear(),this._mouseInput=null}}var x=j(11073),u=j(11033);class b extends h.c{get angularSensibility(){const I=this.inputs.attached.mouse;return I?I.angularSensibility:0}set angularSensibility(I){const E=this.inputs.attached.mouse;E&&(E.angularSensibility=I)}get keysUp(){const I=this.inputs.attached.keyboard;return I?I.keysUp:[]}set keysUp(I){const E=this.inputs.attached.keyboard;E&&(E.keysUp=I)}get keysUpward(){const I=this.inputs.attached.keyboard;return I?I.keysUpward:[]}set keysUpward(I){const E=this.inputs.attached.keyboard;E&&(E.keysUpward=I)}get keysDown(){const I=this.inputs.attached.keyboard;return I?I.keysDown:[]}set keysDown(I){const E=this.inputs.attached.keyboard;E&&(E.keysDown=I)}get keysDownward(){const I=this.inputs.attached.keyboard;return I?I.keysDownward:[]}set keysDownward(I){const E=this.inputs.attached.keyboard;E&&(E.keysDownward=I)}get keysLeft(){const I=this.inputs.attached.keyboard;return I?I.keysLeft:[]}set keysLeft(I){const E=this.inputs.attached.keyboard;E&&(E.keysLeft=I)}get keysRight(){const I=this.inputs.attached.keyboard;return I?I.keysRight:[]}set keysRight(I){const E=this.inputs.attached.keyboard;E&&(E.keysRight=I)}get keysRotateLeft(){const I=this.inputs.attached.keyboard;return I?I.keysRotateLeft:[]}set keysRotateLeft(I){const E=this.inputs.attached.keyboard;E&&(E.keysRotateLeft=I)}get keysRotateRight(){const I=this.inputs.attached.keyboard;return I?I.keysRotateRight:[]}set keysRotateRight(I){const E=this.inputs.attached.keyboard;E&&(E.keysRotateRight=I)}get keysRotateUp(){const I=this.inputs.attached.keyboard;return I?I.keysRotateUp:[]}set keysRotateUp(I){const E=this.inputs.attached.keyboard;E&&(E.keysRotateUp=I)}get keysRotateDown(){const I=this.inputs.attached.keyboard;return I?I.keysRotateDown:[]}set keysRotateDown(I){const E=this.inputs.attached.keyboard;E&&(E.keysRotateDown=I)}constructor(I,E,j){var e;super(I,E,j,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),e=this,this.ellipsoid=new z.LE(.5,1,.5),this.ellipsoidOffset=new z.LE(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=z.LE.Zero(),this._diffPosition=z.LE.Zero(),this._newPosition=z.LE.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e._newPosition.U(E),e._newPosition.subtractToRef(e._oldPosition,e._diffPosition),e._diffPosition.length()>u.c.CollisionsEpsilon&&(e.position.addToRef(e._diffPosition,e._deferredPositionUpdate),e._deferOnly?e._deferredUpdated=!0:e.position.U(e._deferredPositionUpdate),e.tK&&j&&e.tK(j))},this.inputs=new q(this),this.inputs.addKeyboard().addMouse()}attachControl(I,E){E=R.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(E)}Oo(){this.inputs.detachElement(),this.cameraDirection=new z.LE(0,0,0),this.cameraRotation=new z.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(I){this._collisionMask=isNaN(I)?-1:I}_collideWithWorld(I){let E;E=this.parent?z.LE.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,E.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const j=this.GI().collisionCoordinator;this._collider||(this._collider=j.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let e=I;this.applyGravity&&(e=I.add(this.GI().gravity)),j.getNewPosition(this._oldPosition,e,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=z.LE.Zero(),this._transformedDirection=z.LE.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(I){this._needMoveForGravity=I}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.GI().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"gh"}}(0,e.b)([(0,w.K)()],b.prototype,"ellipsoid",void 0),(0,e.b)([(0,w.K)()],b.prototype,"ellipsoidOffset",void 0),(0,e.b)([(0,w.N)()],b.prototype,"checkCollisions",void 0),(0,e.b)([(0,w.N)()],b.prototype,"applyGravity",void 0),(0,x.h)("BABYLON.FreeCamera",b)},13329:(I,E,j)=>{"use strict";j.d(E,{c:()=>z});var e=j(11222),w=j(13331);class z{constructor(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=j,this.eo=[],this._maxBlockCapacity=E||64,this._selectionContent=new e.e(1024),this._creationFunc=I}update(I,E,j){w.e._CreateBlocks(I,E,j,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}PP(I){for(let E=0;E<this.bP.length;E++){this.bP[E].addEntry(I)}}RP(I){for(let E=0;E<this.bP.length;E++){this.bP[E].removeEntry(I)}}select(I,E){this._selectionContent.reset();for(let j=0;j<this.bP.length;j++){this.bP[j].select(I,this._selectionContent,E)}return E?this._selectionContent.concat(this.eo):this._selectionContent.concatWithNoDuplicate(this.eo),this._selectionContent}intersects(I,E,j){this._selectionContent.reset();for(let e=0;e<this.bP.length;e++){this.bP[e].intersects(I,E,this._selectionContent,j)}return j?this._selectionContent.concat(this.eo):this._selectionContent.concatWithNoDuplicate(this.eo),this._selectionContent}intersectsRay(I){this._selectionContent.reset();for(let E=0;E<this.bP.length;E++){this.bP[E].intersectsRay(I,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.eo),this._selectionContent}}z.CreationFuncForMeshes=(I,E)=>{const j=I.getBoundingInfo();!I.isBlocked&&j.boundingBox.intersectsMinMax(E.Ro,E.Po)&&E.entries.push(I)},z.CreationFuncForSubMeshes=(I,E)=>{I.getBoundingInfo().boundingBox.intersectsMinMax(E.Ro,E.Po)&&E.entries.push(I)}},13331:(I,E,j)=>{"use strict";j.d(E,{e:()=>z});var e=j(11117),w=j(11455);class z{constructor(I,E,j,e,w,z){this.entries=[],this.oo=new Array,this._capacity=j,this._depth=e,this._maxDepth=w,this._creationFunc=z,this._minPoint=I,this._maxPoint=E,this.oo.push(I.clone()),this.oo.push(E.clone()),this.oo.push(I.clone()),this.oo[2].x=E.x,this.oo.push(I.clone()),this.oo[3].y=E.y,this.oo.push(I.clone()),this.oo[4].z=E.z,this.oo.push(E.clone()),this.oo[5].z=I.z,this.oo.push(E.clone()),this.oo[6].x=I.x,this.oo.push(E.clone()),this.oo[7].y=I.y}get Pj(){return this._capacity}get Ro(){return this._minPoint}get Po(){return this._maxPoint}addEntry(I){if(this.bP)for(let E=0;E<this.bP.length;E++){this.bP[E].addEntry(I)}else this._creationFunc(I,this),this.entries.length>this.Pj&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(I){if(this.bP){for(let E=0;E<this.bP.length;E++){this.bP[E].removeEntry(I)}return}const E=this.entries.indexOf(I);E>-1&&this.entries.splice(E,1)}addEntries(I){for(let E=0;E<I.length;E++){const j=I[E];this.addEntry(j)}}select(I,E,j){if(w.d.IsInFrustum(this.oo,I)){if(this.bP){for(let e=0;e<this.bP.length;e++){this.bP[e].select(I,E,j)}return}j?E.concat(this.entries):E.concatWithNoDuplicate(this.entries)}}intersects(I,E,j,e){if(w.d.IntersectsSphere(this._minPoint,this._maxPoint,I,E)){if(this.bP){for(let w=0;w<this.bP.length;w++){this.bP[w].intersects(I,E,j,e)}return}e?j.concat(this.entries):j.concatWithNoDuplicate(this.entries)}}intersectsRay(I,E){if(I.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.bP){for(let j=0;j<this.bP.length;j++){this.bP[j].intersectsRay(I,E)}return}E.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){z._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(I,E,j,w,h,t,U,R){U.bP=new Array;const P=new e.LE((E.x-I.x)/2,(E.y-I.y)/2,(E.z-I.z)/2);for(let e=0;e<2;e++)for(let E=0;E<2;E++)for(let o=0;o<2;o++){const Z=I.add(P.multiplyByFloats(e,E,o)),c=I.add(P.multiplyByFloats(e+1,E+1,o+1)),K=new z(Z,c,w,h+1,t,R);K.addEntries(j),U.bP.push(K)}}}},13337:(I,E,j)=>{"use strict";j.d(E,{c:()=>P});var e=j(11363),w=j(11117),z=j(11535),h=j(12507),t=j(11389),U=j(13329),R=j(10993);e.c.prototype.createOrUpdateSelectionOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,j=this._getComponent(t.b.NAME_OCTREE);j||(j=new P(this),this.o(j)),this.Eo||(this.Eo=new U.c(U.c.CreationFuncForMeshes,I,E));const e=this.getWorldExtends();return this.Eo.update(e.min,e.max,this.meshes),this.Eo},Object.defineProperty(e.c.prototype,"selectionOctree",{get:function(){return this.Eo},enumerable:!0,configurable:!0}),z.c.prototype.createOrUpdateSubmeshesOctree=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const j=this.GI();let e=j._getComponent(t.b.NAME_OCTREE);e||(e=new P(j),j.o(e)),this._submeshesOctree||(this._submeshesOctree=new U.c(U.c.CreationFuncForSubMeshes,I,E)),this.Be(!0);const w=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(w.minimumWorld,w.maximumWorld,this.ie),this._submeshesOctree};class P{constructor(I){this.name=t.b.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new h.d(w.LE.Zero(),new w.LE(1,1,1)),(I=I||R.d.LastCreatedScene)&&(this.CE=I,this.CE.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.CE.getActiveSubMeshCandidates=I=>this.getActiveSubMeshCandidates(I),this.CE.getCollidingSubMeshCandidates=(I,E)=>this.getCollidingSubMeshCandidates(I,E),this.CE.getIntersectingSubMeshCandidates=(I,E)=>this.getIntersectingSubMeshCandidates(I,E))}register(){this.CE.onMeshRemovedObservable.add((I=>{const E=this.CE.selectionOctree;if(void 0!==E&&null!==E){const j=E.eo.indexOf(I);-1!==j&&E.eo.splice(j,1)}})),this.CE.onMeshImportedObservable.add((I=>{const E=this.CE.selectionOctree;void 0!==E&&null!==E&&E.PP(I)}))}getActiveMeshCandidates(){var I;return(null===(I=this.CE.Eo)||void 0===I?void 0:I.select(this.CE.frustumPlanes))||this.CE._getDefaultMeshCandidates()}getActiveSubMeshCandidates(I){if(I._submeshesOctree&&I.useOctreeForRenderingSelection){return I._submeshesOctree.select(this.CE.frustumPlanes)}return this.CE._getDefaultSubMeshCandidates(I)}getIntersectingSubMeshCandidates(I,E){if(I._submeshesOctree&&I.useOctreeForPicking){h.d.TransformToRef(E,I.getWorldMatrix(),this._tempRay);return I._submeshesOctree.intersectsRay(this._tempRay)}return this.CE._getDefaultSubMeshCandidates(I)}getCollidingSubMeshCandidates(I,E){if(I._submeshesOctree&&I.useOctreeForCollisions){const j=E._velocityWorldLength+Math.max(E._radius.x,E._radius.y,E._radius.z);return I._submeshesOctree.intersects(E._basePointWorld,j)}return this.CE._getDefaultSubMeshCandidates(I)}rebuild(){}dispose(){}}},12507:(I,E,j)=>{"use strict";j.d(E,{d:()=>c});var e=j(11363),w=j(11564),z=j(11120),h=j(11117),t=j(11127),U=j(11443),R=j(11387),P=j(10993),o=j(11409);const Z={internalPickerForMesh:void 0};class c{constructor(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.b;this.origin=I,this.direction=E,this.length=j,this.epsilon=e}clone(){return new c(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const e=c._TmpVector3[0].nz(I.x-j,I.y-j,I.z-j),w=c._TmpVector3[1].nz(E.x+j,E.y+j,E.z+j);let z,h,t,U,R=0,P=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>w.x)return!1}else if(z=1/this.direction.x,h=(e.x-this.origin.x)*z,t=(w.x-this.origin.x)*z,t===-1/0&&(t=1/0),h>t&&(U=h,h=t,t=U),R=Math.max(h,R),P=Math.min(t,P),R>P)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>w.y)return!1}else if(z=1/this.direction.y,h=(e.y-this.origin.y)*z,t=(w.y-this.origin.y)*z,t===-1/0&&(t=1/0),h>t&&(U=h,h=t,t=U),R=Math.max(h,R),P=Math.min(t,P),R>P)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>w.z)return!1}else if(z=1/this.direction.z,h=(e.z-this.origin.z)*z,t=(w.z-this.origin.z)*z,t===-1/0&&(t=1/0),h>t&&(U=h,h=t,t=U),R=Math.max(h,R),P=Math.min(t,P),R>P)return!1;return!0}intersectsBox(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(I.minimum,I.maximum,E)}intersectsSphere(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=I.center.x-this.origin.x,e=I.center.y-this.origin.y,w=I.center.z-this.origin.z,z=j*j+e*e+w*w,h=I.radius+E,t=h*h;if(z<=t)return!0;const U=j*this.direction.x+e*this.direction.y+w*this.direction.z;if(U<0)return!1;return z-U*U<=t}intersectsTriangle(I,E,j){const e=c._TmpVector3[0],w=c._TmpVector3[1],z=c._TmpVector3[2],t=c._TmpVector3[3],R=c._TmpVector3[4];E.subtractToRef(I,e),j.subtractToRef(I,w),h.LE.CrossToRef(this.direction,w,z);const P=h.LE.Dot(e,z);if(0===P)return null;const o=1/P;this.origin.subtractToRef(I,t);const Z=h.LE.Dot(t,z)*o;if(Z<-this.epsilon||Z>1+this.epsilon)return null;h.LE.CrossToRef(t,e,R);const K=h.LE.Dot(this.direction,R)*o;if(K<-this.epsilon||Z+K>1+this.epsilon)return null;const L=h.LE.Dot(w,R)*o;return L>this.length?null:new U.d(1-Z-K,Z,L)}intersectsPlane(I){let E;const j=h.LE.Dot(I.normal,this.direction);if(Math.abs(j)<9.99999997475243e-7)return null;{const e=h.LE.Dot(I.normal,this.origin);return E=(-I.d-e)/j,E<0?E<-9.99999997475243e-7?null:0:E}}intersectsAxis(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(I){case"y":{const I=(this.origin.y-E)/this.direction.y;return I>0?null:new h.LE(this.origin.x+this.direction.x*-I,E,this.origin.z+this.direction.z*-I)}case"x":{const I=(this.origin.x-E)/this.direction.x;return I>0?null:new h.LE(E,this.origin.y+this.direction.y*-I,this.origin.z+this.direction.z*-I)}case"z":{const I=(this.origin.z-E)/this.direction.z;return I>0?null:new h.LE(this.origin.x+this.direction.x*-I,this.origin.y+this.direction.y*-I,E)}default:return null}}intersectsMesh(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const t=h.TmpVectors.Matrix[0];return I.getWorldMatrix().invertToRef(t),this._tmpRay?c.TransformToRef(this,t,this._tmpRay):this._tmpRay=c.Transform(this,t),I.intersects(this._tmpRay,E,j,e,w,z)}intersectsMeshes(I,E,j){j?j.length=0:j=[];for(let e=0;e<I.length;e++){const w=this.intersectsMesh(I[e],E);w.hit&&j.push(w)}return j.sort(this._comparePickingInfo),j}_comparePickingInfo(I,E){return I.distance<E.distance?-1:I.distance>E.distance?1:0}intersectionSegment(I,E,j){const e=this.origin,w=h.TmpVectors.LE[0],z=h.TmpVectors.LE[1],t=h.TmpVectors.LE[2],U=h.TmpVectors.LE[3];E.subtractToRef(I,w),this.direction.scaleToRef(c._Rayl,t),e.addToRef(t,z),I.subtractToRef(e,U);const R=h.LE.Dot(w,w),P=h.LE.Dot(w,t),o=h.LE.Dot(t,t),Z=h.LE.Dot(w,U),K=h.LE.Dot(t,U),L=R*o-P*P;let F,C,X=L,q=L;L<c._Smallnum?(F=0,X=1,C=K,q=o):(F=P*K-o*Z,C=R*K-P*Z,F<0?(F=0,C=K,q=o):F>X&&(F=X,C=K+P,q=o)),C<0?(C=0,-Z<0?F=0:-Z>R?F=X:(F=-Z,X=R)):C>q&&(C=q,-Z+P<0?F=0:-Z+P>R?F=X:(F=-Z+P,X=R));const x=Math.abs(F)<c._Smallnum?0:F/X,u=Math.abs(C)<c._Smallnum?0:C/q,b=h.TmpVectors.LE[4];t.scaleToRef(u,b);const Q=h.TmpVectors.LE[5];w.scaleToRef(x,Q),Q.addInPlace(U);const G=h.TmpVectors.LE[6];Q.subtractToRef(b,G);return u>0&&u<=this.length&&G.lengthSquared()<j*j?Q.length():-1}update(I,E,j,e,w,z,t){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){c._RayDistant||(c._RayDistant=c.Zero()),c._RayDistant.unprojectRayToRef(I,E,j,e,h.Matrix.IdentityReadOnly,z,t);const U=h.TmpVectors.Matrix[0];w.invertToRef(U),c.TransformToRef(c._RayDistant,U,this)}else this.unprojectRayToRef(I,E,j,e,w,z,t);return this}static Zero(){return new c(h.LE.Zero(),h.LE.Zero())}static CreateNew(I,E,j,e,w,z,h){return c.Zero().update(I,E,j,e,w,z,h)}static CreateNewFromTo(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.Matrix.IdentityReadOnly;const e=new c(new h.LE(0,0,0),new h.LE(0,0,0));return c.CreateFromToToRef(I,E,e,j)}static CreateFromToToRef(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.Matrix.IdentityReadOnly;j.origin.U(I);const w=E.subtractToRef(I,j.direction),z=Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z);return j.length=z,j.direction.normalize(),c.TransformToRef(j,e,j)}static Transform(I,E){const j=new c(new h.LE(0,0,0),new h.LE(0,0,0));return c.TransformToRef(I,E,j),j}static TransformToRef(I,E,j){h.LE.TransformCoordinatesToRef(I.origin,E,j.origin),h.LE.TransformNormalToRef(I.direction,E,j.direction),j.length=I.length,j.epsilon=I.epsilon;const e=j.direction,w=e.length();if(0!==w&&1!==w){const I=1/w;e.x*=I,e.y*=I,e.z*=I,j.length*=w}return j}unprojectRayToRef(I,E,j,e,w,z,t){const U=h.TmpVectors.Matrix[0];w.multiplyToRef(z,U),U.multiplyToRef(t,U),U.invert();const R=P.d.LastCreatedEngine,o=h.TmpVectors.LE[0];o.x=I/j*2-1,o.y=-(E/e*2-1),o.z=null!==R&&void 0!==R&&R.useReverseDepthBuffer?1:null!==R&&void 0!==R&&R.isNDCHalfZRange?0:-1;const Z=h.TmpVectors.LE[1].nz(o.x,o.y,1-1e-8),c=h.TmpVectors.LE[2],K=h.TmpVectors.LE[3];h.LE._UnprojectFromInvertedMatrixToRef(o,U,c),h.LE._UnprojectFromInvertedMatrixToRef(Z,U,K),this.origin.U(c),K.subtractToRef(c,this.direction),this.direction.normalize()}}function K(I,E,j,e,w){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=c.Zero();return L(I,E,j,e,h,w,z),h}function L(I,E,j,e,w,z){let t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const R=I.getEngine();if(!z&&!(z=I.activeCamera))return I;const P=z.viewport,o=R.getRenderHeight(),{x:Z,y:c,width:K,height:L}=P.toGlobal(R.getRenderWidth(),o),F=1/R.getHardwareScalingLevel();return E=E*F-Z,j=j*F-(o-c-L),w.update(E,j,K,L,e||h.Matrix.IdentityReadOnly,t?h.Matrix.IdentityReadOnly:z.getViewMatrix(),z.getProjectionMatrix(),U),I}function F(I,E,j,e,w){if(!R.d)return I;const z=I.getEngine();if(!w&&!(w=I.activeCamera))throw new Error("Active camera not set");const t=w.viewport,U=z.getRenderHeight(),{x:P,y:o,width:Z,height:c}=t.toGlobal(z.getRenderWidth(),U),K=h.Matrix.Identity(),L=1/z.getHardwareScalingLevel();return E=E*L-P,j=j*L-(U-o-c),e.update(E,j,Z,c,K,K,w.getProjectionMatrix()),I}function C(I,E,j,e,w,z,h,t){const U=E(e,j.enableDistantPicking),R=j.intersects(U,w,h,z,e,t);return R&&R.hit?!w&&null!=I&&R.distance>=I.distance?null:R:null}function X(I,E,j,e,w,z){let t=null;const U=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),P=I.cameraToUseForPointers||I.activeCamera,o=Z.internalPickerForMesh||C;for(let R=0;R<I.meshes.length;R++){const Z=I.meshes[R];if(j){if(!j(Z,-1))continue}else if(!Z.isEnabled()||!Z.isVisible||!Z.pU)continue;const c=U&&Z.isWorldMatrixCameraDependent(),K=Z.Be(c,P);if(Z.hasThinInstances&&Z.dR){const I=o(t,E,Z,K,!0,!0,z);if(I){if(w)return I;const U=h.TmpVectors.Matrix[1],R=Z.thinInstanceGetWorldMatrices();for(let I=0;I<R.length;I++){if(j&&!j(Z,I))continue;R[I].multiplyToRef(K,U);const h=o(t,E,Z,U,e,w,z,!0);if(h&&(t=h,t.thinInstanceIndex=I,e))return t}}}else{const I=o(t,E,Z,K,e,w,z);if(I&&(t=I,e))return t}}return t||new R.d}function q(I,E,j,e){if(!R.d)return null;const w=[],z=!!(I.activeCameras&&I.activeCameras.length>1&&I.cameraToUseForPointers!==I.activeCamera),t=I.cameraToUseForPointers||I.activeCamera,U=Z.internalPickerForMesh||C;for(let R=0;R<I.meshes.length;R++){const P=I.meshes[R];if(j){if(!j(P,-1))continue}else if(!P.isEnabled()||!P.isVisible||!P.pU)continue;const o=z&&P.isWorldMatrixCameraDependent(),Z=P.Be(o,t);if(P.hasThinInstances&&P.dR){if(U(null,E,P,Z,!0,!0,e)){const I=h.TmpVectors.Matrix[1],z=P.thinInstanceGetWorldMatrices();for(let h=0;h<z.length;h++){if(j&&!j(P,h))continue;z[h].multiplyToRef(Z,I);const t=U(null,E,P,I,!1,!1,e,!0);t&&(t.thinInstanceIndex=h,w.push(t))}}}else{const I=U(null,E,P,Z,!1,!1,e);I&&w.push(I)}}return w}function x(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,e=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0;e||(e=I.getWorldMatrix()),E.length=j,w?E.origin.U(w):E.origin.U(I.position);const z=h.TmpVectors.LE[2];z.set(0,0,I._scene.useRightHandedSystem?-1:1);const t=h.TmpVectors.LE[3];return h.LE.TransformNormalToRef(z,e,t),h.LE.NormalizeToRef(t,E.direction),E}var u,b;c._TmpVector3=(0,t.d)(6,h.LE.Zero),c._RayDistant=c.Zero(),c._Smallnum=1e-8,c._Rayl=1e9,u=e.c,(b=w.e)&&(b.prototype.getForwardRay=function(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,E=arguments.length>1?arguments[1]:void 0,j=arguments.length>2?arguments[2]:void 0;return x(this,new c(h.LE.Zero(),h.LE.Zero(),I),I,E,j)},b.prototype.getForwardRayToRef=function(I){return x(this,I,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),u&&(o.e._IsPickingAvailable=!0,u.prototype.createPickingRay=function(I,E,j,e){return K(this,I,E,j,e,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),e.c.prototype.createPickingRayToRef=function(I,E,j,e,w){return L(this,I,E,j,e,w,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},e.c.prototype.createPickingRayInCameraSpace=function(I,E,j){return function(I,E,j,e){const w=c.Zero();return F(I,E,j,w,e),w}(this,I,E,j)},e.c.prototype.createPickingRayInCameraSpaceToRef=function(I,E,j,e){return F(this,I,E,j,e)},e.c.prototype.pickWithBoundingInfo=function(I,E,j,e,w){return function(I,E,j,e,w,z){if(!R.d)return null;const t=X(I,(e=>(I._tempPickingRay||(I._tempPickingRay=c.Zero()),L(I,E,j,e,I._tempPickingRay,z||null),I._tempPickingRay)),e,w,!0);return t&&(t.ray=K(I,E,j,h.Matrix.Identity(),z||null)),t}(this,I,E,j,e,w)},e.c.prototype.cj=function(I,E,j,e,w,z){return function(I,E,j,e,w,z,t){const U=X(I,((e,w)=>(I._tempPickingRay||(I._tempPickingRay=c.Zero()),L(I,E,j,e,I._tempPickingRay,z||null,!1,w),I._tempPickingRay)),e,w,!1,t);return U&&(U.ray=K(I,E,j,h.Matrix.Identity(),z||null)),U}(this,I,E,j,e,w,z)},e.c.prototype.pickWithRay=function(I,E,j,e){return function(I,E,j,e,w){const z=X(I,(j=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=h.Matrix.Identity()),j.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=c.Zero()),c.TransformToRef(E,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),j,e,!1,w);return z&&(z.ray=E),z}(this,I,E,j,e)},e.c.prototype.multiPick=function(I,E,j,e,w){return function(I,E,j,e,w,z){return q(I,(e=>K(I,E,j,e,w||null)),e,z)}(this,I,E,j,e,w)},e.c.prototype.multiPickWithRay=function(I,E,j){return function(I,E,j,e){return q(I,(j=>(I._pickWithRayInverseMatrix||(I._pickWithRayInverseMatrix=h.Matrix.Identity()),j.invertToRef(I._pickWithRayInverseMatrix),I._cachedRayForTransform||(I._cachedRayForTransform=c.Zero()),c.TransformToRef(E,I._pickWithRayInverseMatrix,I._cachedRayForTransform),I._cachedRayForTransform)),j,e)}(this,I,E,j)}},12786:(I,E,j)=>{"use strict";var e=j(11056),w=j(10974),z=j(11e3),h=j(11080),t=j(11033),U=j(11063);t.c.prototype._partialLoadFile=function(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(I,(I=>{j[E]=I,j._internalCount++,6===j._internalCount&&e(j)}),void 0,void 0,!0,((I,E)=>{w&&I&&w(I.status+" "+I.statusText,E)}))},t.c.prototype._cascadeLoadFiles=function(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const w=[];w._internalCount=0;for(let z=0;z<6;z++)this._partialLoadFile(j[z],z,w,E,e)},t.c.prototype._cascadeLoadImgs=function(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5?arguments[5]:void 0;const h=[];h._internalCount=0;for(let t=0;t<6;t++)this._partialLoadImg(e[t],t,h,I,E,j,w,z)},t.c.prototype._partialLoadImg=function(I,E,j,e,w,t){let U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7?arguments[7]:void 0;const P=(0,h.d)();(0,z.n)(I,(I=>{j[E]=I,j._internalCount++,e&&e.removePendingData(P),6===j._internalCount&&t&&t(w,j)}),((I,E)=>{e&&e.removePendingData(P),U&&U(I,E)}),e?e.offlineProvider:null,R),e&&e.addPendingData(P)},t.c.prototype.createCubeTextureBase=function(I,E,j,z){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6?arguments[6]:void 0,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,L=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,F=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,C=arguments.length>14&&void 0!==arguments[14]&&arguments[14],X=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const q=K||new e.e(this,7);q.isCube=!0,q.url=I,q.generateMipMaps=!z,q._lodGenerationScale=Z,q._lodGenerationOffset=c,q._useSRGBBuffer=!!C&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!z),q!==K&&(q.label=I.substring(0,60)),this._doNotHandleContextLost||(q._extension=P,q._files=j,q._buffer=X);const x=I;this._transformTextureUrl&&!K&&(I=this._transformTextureUrl(I));const u=P??function(I){const E=I.split("?")[0],j=E.lastIndexOf(".");return j>-1?E.substring(j).toLowerCase():""}(I),b=(0,U.b)(u),Q=(I,E)=>{q.dispose(),t?t(I,E):I&&w.b.Warn(I)},G=(e,t)=>{I===x?e&&Q(e.status+" "+e.statusText,t):(w.b.Warn(`Failed to load ${I}, falling back to the ${x}`),this.createCubeTextureBase(x,E,j,!!z,h,Q,R,P,o,Z,c,q,L,F,C,X))};if(b)b.then((e=>{const w=I=>{L&&L(q,I),e.loadCubeData(I,q,o,h,((I,E)=>{Q(I,E)}))};X?w(X):j&&6===j.length?e.supportCascades?this._cascadeLoadFiles(E,(I=>w(I.map((I=>new Uint8Array(I))))),j,Q):Q("Textures type does not support cascades."):this._loadFile(I,(I=>w(new Uint8Array(I))),void 0,void 0,!0,G)}));else{if(!j||0===j.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(E,q,((I,E)=>{F&&F(I,E)}),j,Q)}return this._internalTexturesCache.push(q),q}},13341:(I,E,j)=>{"use strict";j(10974);var e=j(11252);j(11056),j(11202),j(11054),j(11302),j(11264);e.d},12812:(I,E,j)=>{"use strict";j.d(E,{b:()=>w});var e=j(11073);class w{constructor(I){this.value=this._toInt(I)}_toInt(I){return 0|I}add(I){return new w(this.value+I.value)}FE(I){return new w(this.value-I.value)}multiply(I){return new w(Math.imul(this.value,I.value))}divide(I){return new w(this.value/I.value)}getClassName(){return w.ClassName}equals(I){return this.value===I.value}static FromValue(I){return new w(I)}toString(){return this.value.toString()}}w.ClassName="FlowGraphInteger",(0,e.h)("FlowGraphInteger",w)},12821:(I,E,j)=>{"use strict";j.d(E,{d:()=>w,h:()=>z});var e=j(11117);class w{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Xe=I}get m(){return this.Xe}transformVector(I){return this.transformVectorToRef(I,new e.Vector2)}transformVectorToRef(I,E){return E.x=I.x*this.Xe[0]+I.y*this.Xe[1],E.y=I.x*this.Xe[2]+I.y*this.Xe[3],E}re(){return this.toArray()}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<4;E++)I[E]=this.Xe[E];return I}Kj(I){for(let E=0;E<4;E++)this.Xe[E]=I[E];return this}multiplyToRef(I,E){const j=I.Xe,e=this.Xe,w=E.Xe;return w[0]=j[0]*e[0]+j[1]*e[2],w[1]=j[0]*e[1]+j[1]*e[3],w[2]=j[2]*e[0]+j[3]*e[2],w[3]=j[2]*e[1]+j[3]*e[3],E}multiply(I){return this.multiplyToRef(I,new w)}divideToRef(I,E){const j=this.Xe,e=I.Xe,w=E.Xe;return w[0]=j[0]/e[0],w[1]=j[1]/e[1],w[2]=j[2]/e[2],w[3]=j[3]/e[3],E}divide(I){return this.divideToRef(I,new w)}addToRef(I,E){const j=this.Xe,e=I.m,w=E.m;return w[0]=j[0]+e[0],w[1]=j[1]+e[1],w[2]=j[2]+e[2],w[3]=j[3]+e[3],E}add(I){return this.addToRef(I,new w)}subtractToRef(I,E){const j=this.Xe,e=I.m,w=E.m;return w[0]=j[0]-e[0],w[1]=j[1]-e[1],w[2]=j[2]-e[2],w[3]=j[3]-e[3],E}FE(I){return this.subtractToRef(I,new w)}transpose(){const I=this.Xe;return new w([I[0],I[2],I[1],I[3]])}determinant(){const I=this.Xe;return I[0]*I[3]-I[1]*I[2]}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const E=this.Xe,j=1/I;return new w([E[3]*j,-E[1]*j,-E[2]*j,E[0]*j])}equals(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.Xe,e=I.m;return 0===E?j[0]===e[0]&&j[1]===e[1]&&j[2]===e[2]&&j[3]===e[3]:Math.abs(j[0]-e[0])<E&&Math.abs(j[1]-e[1])<E&&Math.abs(j[2]-e[2])<E&&Math.abs(j[3]-e[3])<E}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Xe.join(", ")})`}}class z{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Xe=I}get m(){return this.Xe}transformVector(I){return this.transformVectorToRef(I,new e.LE)}transformVectorToRef(I,E){const j=this.Xe;return E.x=I.x*j[0]+I.y*j[1]+I.z*j[2],E.y=I.x*j[3]+I.y*j[4]+I.z*j[5],E.z=I.x*j[6]+I.y*j[7]+I.z*j[8],E}multiplyToRef(I,E){const j=I.Xe,e=this.Xe,w=E.m;return w[0]=j[0]*e[0]+j[1]*e[3]+j[2]*e[6],w[1]=j[0]*e[1]+j[1]*e[4]+j[2]*e[7],w[2]=j[0]*e[2]+j[1]*e[5]+j[2]*e[8],w[3]=j[3]*e[0]+j[4]*e[3]+j[5]*e[6],w[4]=j[3]*e[1]+j[4]*e[4]+j[5]*e[7],w[5]=j[3]*e[2]+j[4]*e[5]+j[5]*e[8],w[6]=j[6]*e[0]+j[7]*e[3]+j[8]*e[6],w[7]=j[6]*e[1]+j[7]*e[4]+j[8]*e[7],w[8]=j[6]*e[2]+j[7]*e[5]+j[8]*e[8],E}multiply(I){return this.multiplyToRef(I,new z)}divideToRef(I,E){const j=this.Xe,e=I.m,w=E.m;return w[0]=j[0]/e[0],w[1]=j[1]/e[1],w[2]=j[2]/e[2],w[3]=j[3]/e[3],w[4]=j[4]/e[4],w[5]=j[5]/e[5],w[6]=j[6]/e[6],w[7]=j[7]/e[7],w[8]=j[8]/e[8],E}divide(I){return this.divideToRef(I,new z)}addToRef(I,E){const j=this.Xe,e=I.m,w=E.m;return w[0]=j[0]+e[0],w[1]=j[1]+e[1],w[2]=j[2]+e[2],w[3]=j[3]+e[3],w[4]=j[4]+e[4],w[5]=j[5]+e[5],w[6]=j[6]+e[6],w[7]=j[7]+e[7],w[8]=j[8]+e[8],E}add(I){return this.addToRef(I,new z)}subtractToRef(I,E){const j=this.Xe,e=I.m,w=E.m;return w[0]=j[0]-e[0],w[1]=j[1]-e[1],w[2]=j[2]-e[2],w[3]=j[3]-e[3],w[4]=j[4]-e[4],w[5]=j[5]-e[5],w[6]=j[6]-e[6],w[7]=j[7]-e[7],w[8]=j[8]-e[8],E}FE(I){return this.subtractToRef(I,new z)}toArray(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let E=0;E<9;E++)I[E]=this.Xe[E];return I}re(){return this.toArray()}Kj(I){for(let E=0;E<9;E++)this.Xe[E]=I[E];return this}transpose(){const I=this.Xe;return new z([I[0],I[3],I[6],I[1],I[4],I[7],I[2],I[5],I[8]])}determinant(){const I=this.Xe;return I[0]*(I[4]*I[8]-I[5]*I[7])-I[1]*(I[3]*I[8]-I[5]*I[6])+I[2]*(I[3]*I[7]-I[4]*I[6])}inverse(){const I=this.determinant();if(0===I)throw new Error("Matrix is not invertible");const E=this.Xe,j=1/I;return new z([(E[4]*E[8]-E[5]*E[7])*j,(E[2]*E[7]-E[1]*E[8])*j,(E[1]*E[5]-E[2]*E[4])*j,(E[5]*E[6]-E[3]*E[8])*j,(E[0]*E[8]-E[2]*E[6])*j,(E[2]*E[3]-E[0]*E[5])*j,(E[3]*E[7]-E[4]*E[6])*j,(E[1]*E[6]-E[0]*E[7])*j,(E[0]*E[4]-E[1]*E[3])*j])}equals(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const j=this.Xe,e=I.m;return 0===E?j[0]===e[0]&&j[1]===e[1]&&j[2]===e[2]&&j[3]===e[3]&&j[4]===e[4]&&j[5]===e[5]&&j[6]===e[6]&&j[7]===e[7]&&j[8]===e[8]:Math.abs(j[0]-e[0])<E&&Math.abs(j[1]-e[1])<E&&Math.abs(j[2]-e[2])<E&&Math.abs(j[3]-e[3])<E&&Math.abs(j[4]-e[4])<E&&Math.abs(j[5]-e[5])<E&&Math.abs(j[6]-e[6])<E&&Math.abs(j[7]-e[7])<E&&Math.abs(j[8]-e[8])<E}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Xe.join(", ")})`}}},12823:(I,E,j)=>{"use strict";var e;function w(I,E,j,e){switch(E){case"Animation":return e?I.animations.find((I=>I.uniqueId===j))??null:I.animations[j]??null;case"AnimationGroup":return e?I.animationGroups.find((I=>I.uniqueId===j))??null:I.animationGroups[j]??null;case"Mesh":return e?I.meshes.find((I=>I.uniqueId===j))??null:I.meshes[j]??null;case"Material":return e?I.materials.find((I=>I.uniqueId===j))??null:I.materials[j]??null;case"XP":return e?I.cameras.find((I=>I.uniqueId===j))??null:I.cameras[j]??null;case"Light":return e?I.lights.find((I=>I.uniqueId===j))??null:I.lights[j]??null;default:return null}}j.d(E,{e:()=>w}),function(I){I.Animation="Animation",I.AnimationGroup="AnimationGroup",I.Mesh="Mesh",I.Material="Material",I.XP="XP",I.Light="Light"}(e||(e={}))},12852:(I,E,j)=>{"use strict";j.d(E,{c:()=>w});var e=j(12859);class w extends e.b{constructor(I,E){if(super(I),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),E)for(const j of E)this._eventsSignalOutputs[j]=this._registerSignalOutput(j+"Event")}_executeOnTick(I){}_startPendingTasks(I){I._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(I),this._resetAfterCanceled(I)),this._preparePendingTasks(I),I._addPendingBlock(this),this.out._activateSignal(I),I._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(I){I._deleteExecutionVariable(this,"_initialized"),I._removePendingBlock(this)}}},12834:(I,E,j)=>{"use strict";j.d(E,{e:()=>R});var e=j(11080),w=j(11073),z=j(12837),h=j(10960),t=j(12804);class U extends z.b{constructor(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.defaultValue,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(I,E,j),this.richType=e,this._defaultValue=w,this._optional=z,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new h.e}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(I){this._isDisabled!==I&&(this._isDisabled=I,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(I,E){E._getConnectionValue(this)!==I&&(E._setConnectionValue(this,I),this.onValueChangedObservable.notifyObservers(I))}resetToDefaultValue(I){I._setConnectionValue(this,this._defaultValue)}connectTo(I){this._isDisabled||super.connectTo(I)}_getValueOrDefault(I){const E=I._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(E):E}getValue(I){if(1===this.connectionType){I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(I);const E=this._getValueOrDefault(I);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}const E=this.isConnected()?this._connectedPoint[0].getValue(I):this._getValueOrDefault(I);return this._lastValue=E,this.richType.typeTransformer?this.richType.typeTransformer(E):E}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.richType={},this.richType.serialize(I.richType),I.optional=this._optional,(0,t.f)("defaultValue",this._defaultValue,I)}}(0,w.h)("FlowGraphDataConnection",U);class R{constructor(I){var E;this.config=I,this.uniqueId=(0,e.d)(),this.name=(null===(E=this.config)||void 0===E?void 0:E.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(I){}registerDataInput(I,E,j){const e=new U(I,0,this,E,j);return this.dataInputs.push(e),e}registerDataOutput(I,E,j){const e=new U(I,1,this,E,j);return this.dataOutputs.push(e),e}getDataInput(I){return this.dataInputs.find((E=>E.name===I))}getDataOutput(I){return this.dataOutputs.find((E=>E.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.f;if(I.uniqueId=this.uniqueId,I.config={},this.config){const j=this.config,e=Object.keys(j);for(const w of e)E(w,j[w],I.config)}I.dataInputs=[],I.dataOutputs=[],I.className=this.getClassName();for(const j of this.dataInputs){const E={};j.serialize(E),I.dataInputs.push(E)}for(const j of this.dataOutputs){const E={};j.serialize(E),I.dataOutputs.push(E)}}deserialize(I){}_log(I,E,j){var e;null===(e=I.logger)||void 0===e||e.addLogItem({action:E,Lj:j,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},12837:(I,E,j)=>{"use strict";j.d(E,{b:()=>z});var e,w=j(11080);!function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(e||(e={}));class z{constructor(I,E,j){this._ownerBlock=j,this._connectedPoint=[],this.uniqueId=(0,w.d)(),this.connectedPointIds=[],this.name=I,this._connectionType=E}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(I){if(this._connectionType===I._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||I._isSingularConnection()&&I._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(I),I._connectedPoint.push(this)}disconnectFrom(I){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=this._connectedPoint.indexOf(I),e=I._connectedPoint.indexOf(this);-1!==j&&-1!==e&&(E&&this._connectedPoint.splice(j,1),I._connectedPoint.splice(e,1))}disconnectFromAll(){for(const I of this._connectedPoint)this.disconnectFrom(I,!1);this._connectedPoint.length=0}dispose(){for(const I of this._connectedPoint)this.disconnectFrom(I)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I.uniqueId=this.uniqueId,I.name=this.name,I._connectionType=this._connectionType,I.connectedPointIds=[],I.className=this.getClassName();for(const E of this._connectedPoint)I.connectedPointIds.push(E.uniqueId)}getClassName(){return"FGConnection"}deserialize(I){this.uniqueId=I.uniqueId,this.name=I.name,this._connectionType=I._connectionType,this.connectedPointIds=I.connectedPointIds}}},12795:(I,E,j)=>{"use strict";j.d(E,{c:()=>q});var e,w=j(10960),z=j(11101),h=j(11106),t=j(11080),U=j(12804),R=j(12823),P=j(10974);!function(I){I.ExecuteBlock="ExecuteBlock",I.ExecuteEvent="ExecuteEvent",I.TriggerConnection="TriggerConnection",I.ContextVariableSet="ContextVariableSet",I.GlobalVariableSet="GlobalVariableSet",I.GlobalVariableDelete="GlobalVariableDelete",I.GlobalVariableGet="GlobalVariableGet",I.AddConnection="AddConnection",I.GetConnectionValue="GetConnectionValue",I.SetConnectionValue="SetConnectionValue",I.ActivateSignal="ActivateSignal",I.ContextVariableGet="ContextVariableGet"}(e||(e={}));class o{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(I){if(I.time||(I.time=Date.now()),this.log.push(I),this.logToConsole){var E;const j=null===(E=I.Lj)||void 0===E?void 0:E.value;"object"===typeof j&&j.getClassName?P.b.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(j.getClassName())}: ${j.toString()}`):P.b.Log(`[FGLog] ${I.className}:${I.uniqueId.split("-")[0]} ${I.action} - ${JSON.stringify(I.Lj)}`)}}getItemsOfType(I){return this.log.filter((E=>E.action===I))}}class Z{get enableLogging(){return this._enableLogging}set enableLogging(I){this._enableLogging!==I&&(this._enableLogging=I,this._enableLogging?(this.logger=new o,this.logger.logToConsole=!0):this.logger=null)}constructor(I){this.uniqueId=(0,t.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new w.e,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=I,this.assetsContext=I.assetsContext??I.CE}hasVariable(I){return I in this._userVariables}setVariable(I,E){var j;this._userVariables[I]=E,null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",Lj:{name:I,value:E}})}getAsset(I,E){return(0,R.e)(this.assetsContext,I,E)}getVariable(I){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",Lj:{name:I,value:this._userVariables[I]}}),this._userVariables[I]}get userVariables(){return this._userVariables}GI(){return this._configuration.CE}_getUniqueIdPrefixedName(I,E){return`${I.uniqueId}_${E}`}_getGlobalContextVariable(I,E){var j;return null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",Lj:{name:I,defaultValue:E,possibleValue:this._globalContextVariables[I]}}),this._hasGlobalContextVariable(I)?this._globalContextVariables[I]:E}_setGlobalContextVariable(I,E){var j;null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",Lj:{name:I,value:E}}),this._globalContextVariables[I]=E}_deleteGlobalContextVariable(I){var E;null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",Lj:{name:I}}),delete this._globalContextVariables[I]}_hasGlobalContextVariable(I){return I in this._globalContextVariables}_setExecutionVariable(I,E,j){this._executionVariables[this._getUniqueIdPrefixedName(I,E)]=j}_getExecutionVariable(I,E,j){return this._hasExecutionVariable(I,E)?this._executionVariables[this._getUniqueIdPrefixedName(I,E)]:j}_deleteExecutionVariable(I,E){delete this._executionVariables[this._getUniqueIdPrefixedName(I,E)]}_hasExecutionVariable(I,E){return this._getUniqueIdPrefixedName(I,E)in this._executionVariables}_hasConnectionValue(I){return I.uniqueId in this._connectionValues}_setConnectionValue(I,E){var j;this._connectionValues[I.uniqueId]=E,null===(j=this.logger)||void 0===j||j.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",Lj:{connectionPointId:I.uniqueId,value:E}})}_setConnectionValueByKey(I,E){this._connectionValues[I]=E}_getConnectionValue(I){var E;return null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",Lj:{connectionPointId:I.uniqueId,value:this._connectionValues[I.uniqueId]}}),this._connectionValues[I.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(I){this._pendingBlocks.includes(I)||(this._pendingBlocks.push(I),this._pendingBlocks.sort(((I,E)=>I.priority-E.priority)))}_removePendingBlock(I){const E=this._pendingBlocks.indexOf(I);-1!==E&&this._pendingBlocks.splice(E,1)}_clearPendingBlocks(){for(const I of this._pendingBlocks)I._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(I){var E;this.onNodeExecutedObservable.notifyObservers(I),null===(E=this.logger)||void 0===E||E.addLogItem({time:Date.now(),className:I.getClassName(),uniqueId:I.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(I){this._setGlobalContextVariable("timeSinceStart",I.timeSinceStart),this._setGlobalContextVariable("deltaTime",I.deltaTime);for(const j of this._pendingBlocks){var E;null===(E=j._executeOnTick)||void 0===E||E.call(j,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U.f;I.uniqueId=this.uniqueId,I._userVariables={};for(const e in this._userVariables)E(e,this._userVariables[e],I._userVariables);I._connectionValues={};for(const e in this._connectionValues)E(e,this._connectionValues[e],I._connectionValues);var j;this.assetsContext!==this.GI()&&(I._assetsContext={meshes:this.assetsContext.meshes.map((I=>I.id)),materials:this.assetsContext.materials.map((I=>I.id)),textures:this.assetsContext.textures.map((I=>I.name)),animations:this.assetsContext.animations.map((I=>I.name)),lights:this.assetsContext.lights.map((I=>I.id)),cameras:this.assetsContext.cameras.map((I=>I.id)),sZ:null===(j=this.assetsContext.sZ)||void 0===j?void 0:j.map((I=>I.name)),skeletons:this.assetsContext.skeletons.map((I=>I.id)),hZ:this.assetsContext.hZ.map((I=>I.name)),geometries:this.assetsContext.geometries.map((I=>I.id)),multiMaterials:this.assetsContext.multiMaterials.map((I=>I.id)),transformNodes:this.assetsContext.transformNodes.map((I=>I.id))})}getClassName(){return"FlowGraphContext"}}(0,z.b)([(0,h.N)()],Z.prototype,"uniqueId",void 0);var c=j(12829),K=j(11393);class L{constructor(I){this.onEventTriggeredObservable=new w.e,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=I,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Le.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const I=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",Lj:{timeSinceStart:this._startingTime,deltaTime:I}}),this._startingTime+=I})),this._meshPickedObserver=this._scene.onPointerObservable.add((I=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",Lj:I})}),K.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((I=>{const E=I.pointerId,j=I.mesh,e=this._pointerUnderMeshState[E];!e&&j?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Lj:{pointerId:E,mesh:j}}):e&&!j?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Lj:{pointerId:E,mesh:e}}):e&&j&&e!==j&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",Lj:{pointerId:E,mesh:e,over:j}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",Lj:{pointerId:E,mesh:j,out:e}})),this._pointerUnderMeshState[E]=j}),K.d.POINTERMOVE)}dispose(){var I,E,j,e,w;null===(I=this._sceneDisposeObserver)||void 0===I||I.remove(),null===(E=this._sceneReadyObserver)||void 0===E||E.remove(),null===(j=this._sceneOnBeforeRenderObserver)||void 0===j||j.remove(),null===(e=this._meshPickedObserver)||void 0===e||e.remove(),null===(w=this._meshUnderPointerObserver)||void 0===w||w.remove(),this.onEventTriggeredObservable.clear()}}var F,C=j(12843);!function(I){I[I.Stopped=0]="Stopped",I[I.Started=1]="Started"}(F||(F={}));class X{get state(){return this._state}set state(I){this._state=I,this.onStateChangedObservable.notifyObservers(I)}constructor(I){this.onStateChangedObservable=new w.e,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=I.CE,this._sceneEventCoordinator=new L(this._scene),this._coordinator=I.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((I=>{for(const E of this._executionContexts){const j=this._getContextualOrder(I.type,E);for(const e of j)if(!e._executeEvent(E,I.Lj))break}switch(I.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const E of this._executionContexts)E._notifyOnTick(I.Lj);break;case"SceneDispose":this.dispose()}}))}createContext(){const I=new Z({CE:this._scene,coordinator:this._coordinator});return this._executionContexts.push(I),I}getContext(I){return this._executionContexts[I]}addEventBlock(I){if("PointerOver"!==I.type&&"PointerOut"!==I.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==I.type&&this._eventBlocks[I.type].push(I),1===this.state)for(const E of this._executionContexts)I._startPendingTasks(E);else this.onStateChangedObservable.addOnce((E=>{if(1===E)for(const j of this._executionContexts)I._startPendingTasks(j)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((I=>{1===I&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const I of this._executionContexts)for(const E in this._eventBlocks){const j=this._getContextualOrder(E,I);for(const E of j)E._startPendingTasks(I)}}_getContextualOrder(I,E){const j=this._eventBlocks[I].sort(((I,E)=>E.initPriority-I.initPriority));if("MeshPick"===I){const I=[];for(const e of j){const w=e.asset.getValue(E);let z=0;for(;z<j.length;z++){const I=j[z].asset.getValue(E);if(w&&I&&(0,C.k)(w,I))break}I.splice(z,0,e)}return I}return j}dispose(){var I;if(0!==this.state){this.state=0;for(const I of this._executionContexts)I._clearPendingBlocks();this._executionContexts.length=0;for(const I in this._eventBlocks)this._eventBlocks[I].length=0;null===(I=this._eventObserver)||void 0===I||I.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(I){const E=[],j=new Set;for(const e in this._eventBlocks)for(const I of this._eventBlocks[e])E.push(I),j.add(I.uniqueId);for(;E.length>0;){const e=E.pop();I(e);for(const I of e.dataInputs)for(const e of I._connectedPoint)j.has(e._ownerBlock.uniqueId)||(E.push(e._ownerBlock),j.add(e._ownerBlock.uniqueId));if(e instanceof c.e)for(const I of e.signalOutputs)for(const e of I._connectedPoint)j.has(e._ownerBlock.uniqueId)||(E.push(e._ownerBlock),j.add(e._ownerBlock.uniqueId))}}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},E=arguments.length>1?arguments[1]:void 0;I.allBlocks=[],this.visitAllBlocks((E=>{const j={};E.serialize(j),I.allBlocks.push(j)})),I.executionContexts=[];for(const j of this._executionContexts){const e={};j.serialize(e,E),I.executionContexts.push(e)}}}class q{constructor(I){this.config=I,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.CE.Le.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.CE.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const I=this._executeOnNextFrame.slice(0);if(I.length)for(const E of I){this.notifyCustomEvent(E.id,E.data,!1);const I=this._executeOnNextFrame.findIndex((I=>I.uniqueId===E.uniqueId));-1!==I&&this._executeOnNextFrame.splice(I,1)}}));(q.SceneCoordinators.get(this.config.CE)??[]).push(this)}createGraph(){const I=new X({CE:this.config.CE,coordinator:this});return this._flowGraphs.push(I),I}removeGraph(I){const E=this._flowGraphs.indexOf(I);-1!==E&&(I.dispose(),this._flowGraphs.splice(E,1))}start(){for(const I of this._flowGraphs)I.start()}dispose(){var I,E;for(const w of this._flowGraphs)w.dispose();this._flowGraphs.length=0,null===(I=this._disposeObserver)||void 0===I||I.remove(),null===(E=this._onBeforeRenderObserver)||void 0===E||E.remove();const j=q.SceneCoordinators.get(this.config.CE)??[],e=j.indexOf(this);-1!==e&&j.splice(e,1)}serialize(I,E){I._flowGraphs=[];for(const j of this._flowGraphs){const e={};j.serialize(e,E),I._flowGraphs.push(e)}I.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(I){let E=this._customEventsMap.get(I);return E||(E=new w.e,this._customEventsMap.set(I,E)),E}notifyCustomEvent(I,E){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:I,data:E,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(I)){const E=this._eventExecutionCounter.get(I);if(this._eventExecutionCounter.set(I,E+1),E>=q.MaxEventTypeExecutionPerFrame)return void(E===q.MaxEventTypeExecutionPerFrame&&P.b.Warn(`FlowGraphCoordinator: Too many executions of event "${I}".`))}else this._eventExecutionCounter.set(I,1);const j=this._customEventsMap.get(I);j&&j.notifyObservers(E)}}q.MaxEventsPerType=30,q.MaxEventTypeExecutionPerFrame=30,q.SceneCoordinators=new Map},12846:(I,E,j)=>{"use strict";j.d(E,{c:()=>w});var e=j(12852);class w extends e.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(I){I._notifyExecuteNode(this),this.done._activateSignal(I)}}},12829:(I,E,j)=>{"use strict";j.d(E,{e:()=>t});var e=j(12834),w=j(12837),z=j(11073);class h extends w.b{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(I){super.connectTo(I),this._connectedPoint.sort(((I,E)=>E.priority-I.priority))}_activateSignal(I){var E;if(null===(E=I.logger)||void 0===E||E.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,Lj:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)I._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(I,this),I._increaseExecutionId();else for(const j of this._connectedPoint)j._activateSignal(I)}}(0,z.h)("FlowGraphSignalConnection",h);class t extends e.e{constructor(I){super(I),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(I){const E=new h(I,0,this);return this.signalInputs.push(E),E}_registerSignalOutput(I){const E=new h(I,1,this);return this.signalOutputs.push(E),E}_unregisterSignalInput(I){const E=this.signalInputs.findIndex((E=>E.name===I));-1!==E&&(this.signalInputs[E].dispose(),this.signalInputs.splice(E,1))}_unregisterSignalOutput(I){const E=this.signalOutputs.findIndex((E=>E.name===I));-1!==E&&(this.signalOutputs[E].dispose(),this.signalOutputs.splice(E,1))}_reportError(I,E){this.error.Lj="string"===typeof E?new Error(E):E,this.error._activateSignal(I)}getSignalInput(I){return this.signalInputs.find((E=>E.name===I))}getSignalOutput(I){return this.signalOutputs.find((E=>E.name===I))}serialize(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(I),I.signalInputs=[],I.signalOutputs=[];for(const E of this.signalInputs){const j={};E.serialize(j),I.signalInputs.push(j)}for(const E of this.signalOutputs){const j={};E.serialize(j),I.signalOutputs.push(j)}}deserialize(I){for(let E=0;E<I.signalInputs.length;E++){const j=this.getSignalInput(I.signalInputs[E].name);if(!j)throw new Error("Could not find signal input with name "+I.signalInputs[E].name+" in block "+I.className);j.deserialize(I.signalInputs[E])}for(let E=0;E<I.signalOutputs.length;E++){const j=this.getSignalOutput(I.signalOutputs[E].name);if(!j)throw new Error("Could not find signal output with name "+I.signalOutputs[E].name+" in block "+I.className);j.deserialize(I.signalOutputs[E])}}getClassName(){return"FlowGraphExecutionBlock"}}},12859:(I,E,j)=>{"use strict";j.d(E,{b:()=>w});var e=j(12829);class w extends e.e{constructor(I){super(I),this.out=this._registerSignalOutput("out")}}},12819:(I,E,j)=>{"use strict";j.d(E,{B:()=>c,E:()=>K,F:()=>L,H:()=>y,L:()=>d,N:()=>G,P:()=>Q,e:()=>R,g:()=>Z,i:()=>b,j:()=>F,n:()=>C,r:()=>X,t:()=>o,w:()=>u,z:()=>P});var e,w=j(11117),z=j(11165),h=j(12812),t=j(12821);!function(I){I.Any="any",I.String="string",I.Number="number",I.Boolean="boolean",I.Object="object",I.Integer="FlowGraphInteger",I.Vector2="Vector2",I.LE="LE",I.Vector4="Vector4",I.Quaternion="Quaternion",I.Matrix="Matrix",I.Matrix2D="Matrix2D",I.Matrix3D="Matrix3D",I.qE="qE",I.hh="hh"}(e||(e={}));class U{constructor(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=I,this.defaultValue=E,this.animationType=j}serialize(I){I.typeName=this.typeName,I.defaultValue=this.defaultValue}}const R=new U("any",void 0),P=new U("string",""),o=new U("number",0,0),Z=new U("boolean",!1),c=new U("Vector2",w.Vector2.Zero(),5),K=new U("LE",w.LE.Zero(),1),L=new U("Vector4",w.Vector4.Zero()),F=new U("Matrix",w.Matrix.Identity(),3),C=new U("Matrix2D",new t.d),X=new U("Matrix3D",new t.h),q=new U("qE",z.qE.Black(),4),x=new U("hh",new z.hh(0,0,0,0),7),u=new U("Quaternion",w.Quaternion.Identity(),2);u.typeTransformer=I=>{if(I.getClassName){if("Vector4"===I.getClassName())return w.Quaternion.xE(I.re());if("LE"===I.getClassName())return w.Quaternion.FromEulerVector(I);if("Matrix"===I.getClassName())return w.Quaternion.FromRotationMatrix(I)}return I};const b=new U("FlowGraphInteger",new h.b(0),0);function Q(I){const E=I;switch(typeof I){case"string":return P;case"number":return o;case"boolean":return Z;case"object":if(E.getClassName)switch(E.getClassName()){case"Vector2":return c;case"LE":return K;case"Vector4":return L;case"Matrix":return F;case"qE":return q;case"hh":return x;case"Quaternion":return u;case"FlowGraphInteger":return b;case"Matrix2D":return C;case"Matrix3D":return X}return R;default:return R}}function G(I){switch(I){case"string":return P;case"number":return o;case"boolean":return Z;case"Vector2":return c;case"LE":return K;case"Vector4":return L;case"Matrix":return F;case"qE":return q;case"hh":return x;case"Quaternion":return u;case"FlowGraphInteger":return b;case"Matrix2D":return C;case"Matrix3D":return X;default:return R}}function y(I){switch(I){case"number":default:return 0;case"Vector2":return 5;case"LE":return 1;case"Matrix":return 3;case"qE":return 4;case"hh":return 7;case"Quaternion":return 2}}function d(I){switch(I){case 0:return o;case 5:return c;case 1:return K;case 3:return F;case 4:return q;case 7:return x;case 2:return u;default:return R}}},12804:(I,E,j)=>{"use strict";j.d(E,{e:()=>P,f:()=>R,j:()=>o});var e=j(11165),w=j(11117),z=j(12812),h=j(12819),t=j(12821);function U(I){return"Vector2"===I||"LE"===I||"Vector4"===I||"Quaternion"===I||"qE"===I||"hh"===I}function R(I,E,j){var e;const w=(null===E||void 0===E||null===(e=E.getClassName)||void 0===e?void 0:e.call(E))??"";if(U(w)||function(I){return"Matrix"===I||"Matrix2D"===I||"Matrix3D"===I}(w))j[I]={value:E.re(),className:w};else if("FlowGraphInteger"===w)j[I]={value:E.value,className:w};else if(w&&(E.id||E.name))j[I]={id:E.id,name:E.name,className:w};else{if("object"===typeof E)throw new Error(`Could not serialize value ${E}`);j[I]=E}}function P(I,E,j,R){const o=E[I];let Z;const c=(null===o||void 0===o?void 0:o.type)??(null===o||void 0===o?void 0:o.className);if(function(I){return"Mesh"===I||"AbstractMesh"===I||"GroundMesh"===I||"InstanceMesh"===I||"LinesMesh"===I||"GoldbergMesh"===I||"GreasedLineMesh"===I||"TrailMesh"===I}(c)){let I=R.meshes.filter((I=>o.id?I.id===o.id:I.name===o.name));0===I.length&&(I=R.transformNodes.filter((I=>o.id?I.id===o.id:I.name===o.name))),Z=o.uniqueId?I.find((I=>I.uniqueId===o.uniqueId)):I[0]}else if(U(c))Z=function(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===I)return w.Vector2.xE(E);if("LE"===I)return j&&(E[2]*=-1),w.LE.xE(E);if("Vector4"===I)return w.Vector4.xE(E);if("Quaternion"===I)return j&&(E[2]*=-1,E[3]*=-1),w.Quaternion.xE(E);if("qE"===I)return new e.qE(E[0],E[1],E[2]);if("hh"===I)return new e.hh(E[0],E[1],E[2],E[3]);throw new Error(`Unknown vector class name ${I}`)}(c,o.value);else if(function(I){return"AnimationGroup"===I}(c)){const I=R.animationGroups.filter((I=>I.name===o.name));Z=1===I.length?I[0]:I.find((I=>I.uniqueId===o.uniqueId))}else Z="Matrix"===c?w.Matrix.xE(o.value):"Matrix2D"===c?new t.d(o.value):"Matrix3D"===c?new t.h(o.value):"FlowGraphInteger"===c?z.b.FromValue(o.value):"number"===c||"string"===c||"boolean"===c?o.value[0]:o&&void 0!==o.value?o.value:Array.isArray(o)?o.reduce(((I,E)=>E.eventData?(I[E.id]={type:(0,h.N)(E.type)},"undefined"!==typeof E.value&&(I[E.id].value=P("value",E,j,R)),I):I),{}):o;return Z}function o(I){return"FlowGraphJsonPointerParserBlock"===I}},12843:(I,E,j)=>{"use strict";function e(I,E){return!(!I.parent||I.parent!==E&&!e(I.parent,E))}function w(I){if(I.getClassName)return I.getClassName()}function z(I,E){return I===E&&("Vector2"===I||"LE"===I||"Vector4"===I||"Quaternion"===I)}function h(I,E){return I===E&&("Matrix"===I||"Matrix2D"===I||"Matrix3D"===I)}function t(I,E){return"FlowGraphInteger"===I&&"FlowGraphInteger"===E}function U(I,E){const j="number"===typeof I||"number"===typeof(null===I||void 0===I?void 0:I.value);return j&&!E?!isNaN(R(I)):j}function R(I){return"number"===typeof I?I:I.value}j.d(E,{d:()=>t,e:()=>h,h:()=>z,j:()=>w,k:()=>e,n:()=>R,r:()=>U})},12234:(I,E,j)=>{"use strict";j.r(E),j.d(E,{SceneInstrumentation:()=>z});var e=j(10953),w=j(11343);class z{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(I){I!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=I,I?(this._onBeforeActiveMeshesEvaluationObserver=this.CE.onBeforeActiveMeshesEvaluationObservable.add((()=>{e.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.CE.onAfterActiveMeshesEvaluationObservable.add((()=>{e.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.CE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.CE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(I){I!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=I,I?(this._onBeforeRenderTargetsRenderObserver=this.CE.onBeforeRenderTargetsRenderObservable.add((()=>{e.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.CE.onAfterRenderTargetsRenderObservable.add((()=>{e.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.CE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.CE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(I){I!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=I,I?(this._onBeforeParticlesRenderingObserver=this.CE.onBeforeParticlesRenderingObservable.add((()=>{e.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.CE.onAfterParticlesRenderingObservable.add((()=>{e.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.CE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.CE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(I){I!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=I,this.CE.spriteManagers&&(I?(this._onBeforeSpritesRenderingObserver=this.CE.onBeforeSpritesRenderingObservable.add((()=>{e.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.CE.onAfterSpritesRenderingObservable.add((()=>{e.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.CE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.CE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(I){I!==this._capturePhysicsTime&&this.CE.onBeforePhysicsObservable&&(this._capturePhysicsTime=I,I?(this._onBeforePhysicsObserver=this.CE.onBeforePhysicsObservable.add((()=>{e.Tools.StartPerformanceCounter("Mh"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.CE.onAfterPhysicsObservable.add((()=>{e.Tools.EndPerformanceCounter("Mh"),this._physicsTime.endMonitoring()}))):(this.CE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.CE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(I){I!==this._captureAnimationsTime&&(this._captureAnimationsTime=I,I?this._onAfterAnimationsObserver=this.CE.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.CE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(I){this._captureFrameTime=I}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(I){this._captureInterFrameTime=I}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(I){I!==this._captureRenderTime&&(this._captureRenderTime=I,I?(this._onBeforeDrawPhaseObserver=this.CE.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),e.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.CE.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter("Main render")}))):(this.CE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.CE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(I){I!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=I,I?(this._onBeforeCameraRenderObserver=this.CE.onBeforeCameraRenderObservable.add((I=>{this._cameraRenderTime.beginMonitoring(),e.Tools.StartPerformanceCounter(`Rendering camera ${I.name}`)})),this._onAfterCameraRenderObserver=this.CE.onAfterCameraRenderObservable.add((I=>{this._cameraRenderTime.endMonitoring(!1),e.Tools.EndPerformanceCounter(`Rendering camera ${I.name}`)}))):(this.CE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.CE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.CE.getEngine()._drawCalls}constructor(I){this.CE=I,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new w.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new w.e,this._captureFrameTime=!1,this._frameTime=new w.e,this._captureRenderTime=!1,this._renderTime=new w.e,this._captureInterFrameTime=!1,this._interFrameTime=new w.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new w.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new w.e,this._capturePhysicsTime=!1,this._physicsTime=new w.e,this._captureAnimationsTime=!1,this._animationsTime=new w.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new w.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=I.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(e.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.CE.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=I.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(e.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Ze(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Ze(),this._captureParticlesRenderTime&&this._particlesRenderTime.Ze(),this._captureSpritesRenderTime&&this._spritesRenderTime.Ze(),this._captureRenderTime&&this._renderTime.Ze(),this._captureCameraRenderTime&&this._cameraRenderTime.Ze()}))}dispose(){this._disposed||(this.CE.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.CE.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.CE.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.CE.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.CE.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.CE.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.CE.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.CE.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.CE.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.CE.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.CE.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.CE.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.CE.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.CE.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.CE.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.CE.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.CE.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.CE=null,this._disposed=!0)}}},12793:(I,E,j)=>{"use strict";j.d(E,{c:()=>P});var e=j(11101),w=j(11106),z=j(11117),h=j(11533),t=j(11652),U=j(11705),R=j(11073);h.b.AddNodeConstructor("Light_Type_1",((I,E)=>()=>new P(I,z.LE.Zero(),E)));class P extends U.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(I){this._shadowFrustumSize=I,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(I){this._shadowOrthoScale=I,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(I){this._orthoLeft=I}get orthoRight(){return this._orthoRight}set orthoRight(I){this._orthoRight=I}get orthoTop(){return this._orthoTop}set orthoTop(I){this._orthoTop=I}get orthoBottom(){return this._orthoBottom}set orthoBottom(I){this._orthoBottom=I}constructor(I,E,j){super(I,j),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=E.scale(-1),this.direction=E}getClassName(){return"Oh"}getTypeID(){return t.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(I,E,j){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(I):this._setDefaultAutoExtendShadowProjectionMatrix(I,E,j)}_setDefaultFixedFrustumShadowProjectionMatrix(I){const E=this.GI().activeCamera;E&&z.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:E.Te,void 0!==this.shadowMaxZ?this.shadowMaxZ:E.maxZ,I,this.GI().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(I,E,j){const e=this.GI().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const I=z.LE.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let e=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let h=0;h<j.length;h++){const t=j[h];if(!t)continue;const U=t.getBoundingInfo().boundingBox;for(let j=0;j<U.vectorsWorld.length;j++)z.LE.TransformCoordinatesToRef(U.vectorsWorld[j],E,I),I.x<this._orthoLeft&&(this._orthoLeft=I.x),I.y<this._orthoBottom&&(this._orthoBottom=I.y),I.x>this._orthoRight&&(this._orthoRight=I.x),I.y>this._orthoTop&&(this._orthoTop=I.y),this.autoCalcShadowZBounds&&(I.z<e&&(e=I.z),I.z>w&&(w=I.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=e,this._shadowMaxZ=w)}const w=this._orthoRight-this._orthoLeft,h=this._orthoTop-this._orthoBottom,t=void 0!==this.shadowMinZ?this.shadowMinZ:(null===e||void 0===e?void 0:e.Te)||0,U=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===e||void 0===e?void 0:e.maxZ)||1e4,R=this.GI().getEngine().useReverseDepthBuffer;z.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-w*this.shadowOrthoScale,this._orthoRight+w*this.shadowOrthoScale,this._orthoBottom-h*this.shadowOrthoScale,this._orthoTop+h*this.shadowOrthoScale,R?U:t,R?t:U,I,this.GI().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,E){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,E),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,E),this)}transferToNodeMaterialEffect(I,E){return this.computeTransformedInformation()?(I.setFloat3(E,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(I.setFloat3(E,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(I){const E=this._scene.getEngine();return!E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}getDepthMaxZ(I){const E=this._scene.getEngine();return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:1}prepareLightSpecificDefines(I,E){I["DIRLIGHT"+E]=!0}}(0,e.b)([(0,w.N)()],P.prototype,"shadowFrustumSize",null),(0,e.b)([(0,w.N)()],P.prototype,"shadowOrthoScale",null),(0,e.b)([(0,w.N)()],P.prototype,"autoUpdateExtends",void 0),(0,e.b)([(0,w.N)()],P.prototype,"autoCalcShadowZBounds",void 0),(0,e.b)([(0,w.N)("orthoLeft")],P.prototype,"_orthoLeft",void 0),(0,e.b)([(0,w.N)("orthoRight")],P.prototype,"_orthoRight",void 0),(0,e.b)([(0,w.N)("orthoTop")],P.prototype,"_orthoTop",void 0),(0,e.b)([(0,w.N)("orthoBottom")],P.prototype,"_orthoBottom",void 0),(0,R.h)("BABYLON.DirectionalLight",P)},13280:(I,E,j)=>{"use strict";j.d(E,{c:()=>P});var e=j(11101),w=j(11106),z=j(11117),h=j(11165),t=j(11533),U=j(11652),R=j(11073);t.b.AddNodeConstructor("Light_Type_3",((I,E)=>()=>new P(I,z.LE.Zero(),E)));class P extends U.c{constructor(I,E,j){super(I,j),this.groundColor=new h.qE(0,0,0),this.direction=E||z.LE.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Sh"}setDirectionToTarget(I){return this.direction=z.LE.Normalize(I.FE(z.LE.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(I,E){const j=z.LE.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",j.x,j.y,j.z,0,E),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ch),E),this}transferToNodeMaterialEffect(I,E){const j=z.LE.Normalize(this.direction);return I.setFloat3(E,j.x,j.y,j.z),this}Be(){return this._worldMatrix||(this._worldMatrix=z.Matrix.Identity()),this._worldMatrix}getTypeID(){return U.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(I,E){I["HEMILIGHT"+E]=!0}}(0,e.b)([(0,w.l)()],P.prototype,"groundColor",void 0),(0,e.b)([(0,w.K)()],P.prototype,"direction",void 0),(0,R.h)("BABYLON.HemisphericLight",P)},12765:(I,E,j)=>{"use strict";j.d(E,{e:()=>o});var e=j(11101),w=j(11106),z=j(11117),h=j(11533),t=j(11652),U=j(11705),R=j(11097),P=j(11073);h.b.AddNodeConstructor("Light_Type_2",((I,E)=>()=>new o(I,z.LE.Zero(),z.LE.Zero(),0,0,E)));class o extends U.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(I){this._iesProfileTexture!==I&&(this._iesProfileTexture=I,this._iesProfileTexture&&o._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(I){this._angle=I,this._cosHalfAngle=Math.cos(.5*I),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(I){this._innerAngle=I,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(I){this._shadowAngleScale=I,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(I){this._projectionTextureLightNear=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(I){this._projectionTextureLightFar=I,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(I){this._projectionTextureUpDirection=I,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(I){this._projectionTexture!==I&&(this._projectionTexture=I,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(o._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):o._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(I){return void 0!==I.onGeneratedObservable}static _IsTexture(I){return void 0!==I.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(I){this._projectionTextureProjectionLightMatrix=I,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(I,E,j,e,w,h){super(I,h),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=z.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=z.LE.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=z.LE.Zero(),this._projectionTextureViewLightMatrix=z.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=z.Matrix.Zero(),this._projectionTextureScalingMatrix=z.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=E,this.direction=j,this.angle=e,this.exponent=w}getClassName(){return"SpotLight"}getTypeID(){return t.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(I){super._setDirection(I),this._projectionTextureViewLightDirty=!0}_setPosition(I){super._setPosition(I),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(I,E,j){const e=this.GI().activeCamera;if(!e)return;this._shadowAngleScale=this._shadowAngleScale||1;const w=this._shadowAngleScale*this._angle,h=void 0!==this.shadowMinZ?this.shadowMinZ:e.Te,t=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ,U=this.GI().getEngine().useReverseDepthBuffer;z.Matrix.PerspectiveFovLHToRef(w,1,U?t:h,U?h:t,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,U)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),z.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const I=this.projectionTextureLightFar,E=this.projectionTextureLightNear,j=I/(I-E),e=-j*E,w=1/Math.tan(this._angle/2);z.Matrix.FromValuesToRef(w/1,0,0,0,0,w,0,0,0,0,j,1,0,0,e,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof R.d){const I=this._projectionTexture.uScale/2,E=this._projectionTexture.vScale/2;z.Matrix.FromValuesToRef(I,0,0,0,0,E,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(I,E){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),I.setMatrix("textureProjectionMatrix"+E,this._projectionTextureMatrix),I.setTexture("projectionLightTexture"+E,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&I.setTexture("iesLightTexture"+E,this._iesProfileTexture),this}transferToEffect(I,E){let j;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,E),j=z.LE.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,E),j=z.LE.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",j.x,j.y,j.z,this._cosHalfAngle,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,E),this}transferToNodeMaterialEffect(I,E){let j;return j=this.computeTransformedInformation()?z.LE.Normalize(this.transformedDirection):z.LE.Normalize(this.direction),this.GI().useRightHandedSystem?I.setFloat3(E,-j.x,-j.y,-j.z):I.setFloat3(E,j.x,j.y,j.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(I){const E=this._scene.getEngine(),j=void 0!==this.shadowMinZ?this.shadowMinZ:(null===I||void 0===I?void 0:I.Te)??0;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?j:this._scene.getEngine().isNDCHalfZRange?0:j}getDepthMaxZ(I){const E=this._scene.getEngine(),j=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===I||void 0===I?void 0:I.maxZ)??1e4;return E.useReverseDepthBuffer&&E.isNDCHalfZRange?0:j}prepareLightSpecificDefines(I,E){I["SPOTLIGHT"+E]=!0,I["PROJECTEDLIGHTTEXTURE"+E]=!(!this.projectionTexture||!this.projectionTexture.isReady()),I["IESLIGHTTEXTURE"+E]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,e.b)([(0,w.N)()],o.prototype,"angle",null),(0,e.b)([(0,w.N)()],o.prototype,"innerAngle",null),(0,e.b)([(0,w.N)()],o.prototype,"shadowAngleScale",null),(0,e.b)([(0,w.N)()],o.prototype,"exponent",void 0),(0,e.b)([(0,w.N)()],o.prototype,"projectionTextureLightNear",null),(0,e.b)([(0,w.N)()],o.prototype,"projectionTextureLightFar",null),(0,e.b)([(0,w.N)()],o.prototype,"projectionTextureUpDirection",null),(0,e.b)([(0,w.G)("projectedLightTexture")],o.prototype,"_projectionTexture",void 0),(0,P.h)("BABYLON.SpotLight",o)},12495:(I,E,j)=>{"use strict";j.d(E,{c:()=>h,e:()=>z,g:()=>t});const e={},w={};function z(I,E){e[I]=E}function h(I,E){w[I]=E}function t(I){return w[I]?w[I]:null}},12414:(I,E,j)=>{"use strict";j.d(E,{d:()=>Q,g:()=>Y});var e,w=j(10953),z=j(10960),h=j(11363),t=j(10993),U=j(10974),R=j(11580),P=j(11e3),o=j(11007),Z=j(11080),c=j(11033),K=j(10988);!function(I){I[I.Clean=0]="Clean",I[I.Stop=1]="Stop",I[I.Sync=2]="Sync",I[I.NoSync=3]="NoSync"}(e||(e={}));const L=new z.e,F={};let C=!1;function X(){return F[".babylon"]}function q(I,E){const j=F[I];return j||(U.b.Warn("Unable to find a plugin to load "+I+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),E?X():void 0)}function x(I,E,j){let e="Unable to load from "+(I.rawData?"binary data":I.url);return E?e+=`: ${E}`:j&&(e+=`: ${j}`),e}async function u(I,E,j,e,w,z,h,t,U){var R;const o="data:"===(Z=I.url).substring(0,5)?Z.substring(5):null;var Z;if(I.rawData&&!h)throw"When using ArrayBufferView to load data the file extension must be provided.";const C=o||h?"":function(I){const E=I.indexOf("?");-1!==E&&(I=I.substring(0,E));const j=I.lastIndexOf(".");return I.substring(j,I.length).toLowerCase()}(I.url);let x=h?q(h,!0):o?function(I){for(const E in F){const j=F[E].plugin;if(j.canDirectLoad&&j.canDirectLoad(I))return F[E]}return X()}(I.url):q(C,!1);if(!x&&C){if(I.url&&!I.url.startsWith("blob:")){const E=await async function(I,E){const j=E.method||"GET";return await new Promise(((e,w)=>{const z=new K.c;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const I={};if(E.responseHeaders)for(const j of E.responseHeaders)I[j]=z.getResponseHeader(j)||"";e({response:z.response,headerValues:I})}else w(`Unable to fetch data from ${I}. Error code: ${z.status}`)})),z.open(j,I),z.send()}))}(I.url,{method:"HEAD",responseHeaders:["Content-Type"]}),j=E.headerValues?E.headerValues["Content-Type"]:"";j&&(x=function(I){for(const E in F){const j=F[E];if(j.mimeType===I)return j}}(j))}x||(x=X())}if(!x)throw new Error(`No plugin or fallback for ${h??I.url}`);if(!1===(null===U||void 0===U||null===(R=U[x.plugin.name])||void 0===R?void 0:R.enabled))throw new Error(`The '${x.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(I.rawData&&!x.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(I=>{if(x.plugin.createPlugin){const E=x.plugin.createPlugin(U??{});return E instanceof Promise?(E.then(I).catch((I=>{w("Error instantiating plugin.",I)})),null):(I(E),E)}return I(x.plugin),x.plugin})((U=>{var R;if(!U)throw`The loader plugin corresponding to the '${h}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(L.notifyObservers(U),o&&(U.canDirectLoad&&U.canDirectLoad(I.url)||!(0,P.f)(I.url))){if(U.directLoad){const I=U.directLoad(E,o);I instanceof Promise?I.then((I=>{j(U,I)})).catch((I=>{w("Error in directLoad of _loadData: "+I,I)})):j(U,I)}else j(U,o);return}const Z=x.isBinary,K=(I,e)=>{E.Z?w("Scene has been disposed"):j(U,I,e)};let F=null,C=!1;null===(R=U.Le)||void 0===R||R.add((()=>{C=!0,F&&(F.abort(),F=null),z()}));const X=()=>{if(C)return;const j=(I,E)=>{w(null===I||void 0===I?void 0:I.statusText,E)};if(!U.loadFile&&I.rawData)throw"Plugin does not support loading ArrayBufferView.";F=U.loadFile?U.loadFile(E,I.rawData||I.file||I.url,I.rootUrl,K,e,Z,j,t):E._loadFile(I.file||I.url,K,e,!0,Z,j)},q=E.getEngine();let u=q.enableOfflineSupport;if(u){let j=!1;for(const e of E.disableOfflineSupportExceptionRules)if(e.test(I.url)){j=!0;break}u=!j}u&&c.c.OfflineProviderFactory?E.offlineProvider=c.c.OfflineProviderFactory(I.url,X,q.disableManifestCheck):X()}))}function b(I,E){let j,e,z=null,h=null;if(E)if(E.name)j=`file:${E.name}`,e=E.name,z=E;else if(ArrayBuffer.isView(E))j="",e=(0,Z.d)(),h=E;else if(E.startsWith("data:"))j=E,e="";else if(I){const z=E;if("/"===z.substring(0,1))return w.Tools.Error("Wrong sceneFilename parameter"),null;j=I+z,e=z}else j=E,e=w.Tools.GetFilename(E),I=w.Tools.GetFolderPath(E);else j=I,e=w.Tools.GetFilename(I),I=w.Tools.GetFolderPath(I);return{url:j,rootUrl:I,name:e,file:z,rawData:h}}function Q(I){if("string"===typeof I.extensions){const E=I.extensions;F[E.toLowerCase()]={plugin:I,isBinary:!1}}else{const E=I.extensions,j=Object.keys(E);for(const e of j)F[e.toLowerCase()]={plugin:I,isBinary:E[e].isBinary,mimeType:E[e].mimeType}}}async function G(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.d.LastCreatedScene,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",Z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!e)return U.b.Error("No scene available to import mesh to"),null;const c=b(E,j);if(!c)return null;const K={};e.addPendingData(K);const L=()=>{e.removePendingData(K)},F=(I,E)=>{const j=x(c,I,E);h?h(e,j,new o.k(j,o.g.SceneLoaderError,E)):U.b.Error(j),L()},C=z?I=>{try{z(I)}catch(E){F("Error in onProgress callback: "+E,E)}}:void 0,X=(I,E,j,z,h,t,U,R)=>{if(e.importedMeshesFiles.push(c.url),w)try{w(I,E,j,z,h,t,U,R)}catch(P){F("Error in onSuccess callback: "+P,P)}e.removePendingData(K)};return await u(c,e,((E,j,w)=>{if(E.rewriteRootURL&&(c.rootUrl=E.rewriteRootURL(c.rootUrl,w)),E.importMesh){const w=[],z=[],h=[];if(!E.importMesh(I,e,j,c.rootUrl,w,z,h,F))return;e.loadingPluginName=E.name,X(w,z,h,[],[],[],[],[])}else{E.importMeshAsync(I,e,j,c.rootUrl,C,c.name).then((I=>{e.loadingPluginName=E.name,X(I.meshes,I.hZ,I.skeletons,I.animationGroups,I.transformNodes,I.geometries,I.lights,I.spriteManagers)})).catch((I=>{F(I.message,I)}))}}),C,F,L,R,P,Z)}async function y(I,E,j,e,w,z,h,t){return await new Promise(((U,R)=>{try{G(I,E,j,e,((I,E,j,e,w,z,h,t)=>{U({meshes:I,hZ:E,skeletons:j,animationGroups:e,transformNodes:w,geometries:z,lights:h,spriteManagers:t})}),w,((I,E,j)=>{R(j||new Error(E))}),z,h,t).catch(R)}catch(o){R(o)}}))}async function d(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.d.LastCreatedEngine,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};j?await l(I,E,new h.c(j),e,z,U,R,P,o):w.Tools.Error("No engine available")}async function a(I,E,j,e,w,z,h){return await new Promise(((t,U)=>{d(I,E,j,(I=>{t(I)}),e,((I,E,j)=>{U(j||new Error(E))}),w,z,h)}))}async function l(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.d.LastCreatedScene,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,P=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!j)return U.b.Error("No scene available to append to"),null;const c=b(I,E);if(!c)return null;const K={};j.addPendingData(K);const L=()=>{j.removePendingData(K)};R.d.ShowLoadingScreen&&!C&&(C=!0,j.getEngine().displayLoadingUI(),j.executeWhenReady((()=>{j.getEngine().hideLoadingUI(),C=!1})));const F=(I,E)=>{const e=x(c,I,E);z?z(j,e,new o.k(e,o.g.SceneLoaderError,E)):U.b.Error(e),L()},X=w?I=>{try{w(I)}catch(E){F("Error in onProgress callback",E)}}:void 0,q=()=>{if(e)try{e(j)}catch(I){F("Error in onSuccess callback",I)}j.removePendingData(K)};return await u(c,j,((I,E)=>{if(I.load){if(!I.load(j,E,c.rootUrl,F))return;j.loadingPluginName=I.name,q()}else{I.loadAsync(j,E,c.rootUrl,X,c.name).then((()=>{j.loadingPluginName=I.name,q()})).catch((I=>{F(I.message,I)}))}}),X,F,L,h,P,Z)}async function i(I,E,j,e,w,z,h){return await new Promise(((t,U)=>{try{l(I,E,j,(I=>{t(I)}),e,((I,E,j)=>{U(j||new Error(E))}),w,z,h).catch(U)}catch(o){U(o)}}))}async function r(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.d.LastCreatedScene,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!j)return U.b.Error("No scene available to load asset container to"),null;const Z=b(I,E);if(!Z)return null;const c={};j.addPendingData(c);const K=()=>{j.removePendingData(c)},L=(I,E)=>{const e=x(Z,I,E);z?z(j,e,new o.k(e,o.g.SceneLoaderError,E)):U.b.Error(e),K()},F=w?I=>{try{w(I)}catch(E){L("Error in onProgress callback",E)}}:void 0,C=I=>{if(e)try{e(I)}catch(E){L("Error in onSuccess callback",E)}j.removePendingData(c)};return await u(Z,j,((I,E)=>{if(I.loadAssetContainer){const e=I.loadAssetContainer(j,E,Z.rootUrl,L);if(!e)return;e.populateRootNodes(),j.loadingPluginName=I.name,C(e)}else if(I.loadAssetContainerAsync){I.loadAssetContainerAsync(j,E,Z.rootUrl,F,Z.name).then((E=>{E.populateRootNodes(),j.loadingPluginName=I.name,C(E)})).catch((I=>{L(I.message,I)}))}else L("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),F,L,K,h,R,P)}async function n(I,E,j,e,w,z,h){return await new Promise(((t,U)=>{try{r(I,E,j,(I=>{t(I)}),e,((I,E,j)=>{U(j||new Error(E))}),w,z,h).catch(U)}catch(o){U(o)}}))}async function H(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.d.LastCreatedScene,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,P=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Z=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!j)return void U.b.Error("No scene available to load animations to");if(e){for(const e of j.animatables)e.reset();j.stopAllAnimations();const I=j.animationGroups.slice();for(const j of I)j.dispose();const E=j.getNodes();for(const j of E)j.animations&&(j.animations=[])}else switch(w){case 0:const I=j.animationGroups.slice();for(const E of I)E.dispose();break;case 1:for(const E of j.animationGroups)E.stop();break;case 2:for(const E of j.animationGroups)E.reset(),E.restart();break;case 3:break;default:return void U.b.Error("Unknown animation group loading mode value '"+w+"'")}const K=j.animatables.length;await r(I,E,j,(I=>{I.mergeAnimationsTo(j,j.animatables.slice(K),z),I.dispose(),j.onAnimationFileImportedObservable.notifyObservers(j),h&&h(j)}),R,P,o,Z,c)}async function g(I,E,j,e,w,z,h,t,U,R){return await new Promise(((P,Z)=>{try{H(I,E,j,e,w,z,(I=>{P(I)}),h,((I,E,j)=>{Z(j||new Error(E))}),t,U,R).catch(Z)}catch(o){Z(o)}}))}class Y{static get ForceFullSceneLoadingForIncremental(){return R.d.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(I){R.d.ForceFullSceneLoadingForIncremental=I}static get ShowLoadingScreen(){return R.d.ShowLoadingScreen}static set ShowLoadingScreen(I){R.d.ShowLoadingScreen=I}static get loggingLevel(){return R.d.loggingLevel}static set loggingLevel(I){R.d.loggingLevel=I}static get CleanBoneMatrixWeights(){return R.d.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(I){R.d.CleanBoneMatrixWeights=I}static GetDefaultPlugin(){return X()}static GetPluginForExtension(I){var E;return null===(E=q(I,!0))||void 0===E?void 0:E.plugin}static IsPluginForExtensionAvailable(I){return function(I){return!!F[I]}(I)}static RegisterPlugin(I){Q(I)}static ImportMesh(I,E,j,e,w,z,h,U,R){G(I,E,j,e,w,z,h,U,R).catch((I=>null===h||void 0===h?void 0:h(t.d.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportMeshAsync(I,E,j,e,w,z,h){return await y(I,E,j,e,w,z,h)}static Load(I,E,j,e,w,z,h,U){d(I,E,j,e,w,z,h,U).catch((I=>null===z||void 0===z?void 0:z(t.d.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAsync(I,E,j,e,w,z){return await a(I,E,j,e,w,z)}static Append(I,E,j,e,w,z,h,U){l(I,E,j,e,w,z,h,U).catch((I=>null===z||void 0===z?void 0:z(j??t.d.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async AppendAsync(I,E,j,e,w,z){return await i(I,E,j,e,w,z)}static LoadAssetContainer(I,E,j,e,w,z,h,U){r(I,E,j,e,w,z,h,U).catch((I=>null===z||void 0===z?void 0:z(j??t.d.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async LoadAssetContainerAsync(I,E,j,e,w,z){return await n(I,E,j,e,w,z)}static ImportAnimations(I,E,j,e,w,z,h,U,R,P,o){H(I,E,j,e,w,z,h,U,R,P,o).catch((I=>null===R||void 0===R?void 0:R(j??t.d.LastCreatedScene,null===I||void 0===I?void 0:I.message,I)))}static async ImportAnimationsAsync(I,E,j,e,w,z,h,t,U,R,P){return await g(I,E,j,e,w,z,t,R,P)}}Y.NO_LOGGING=0,Y.MINIMAL_LOGGING=1,Y.SUMMARY_LOGGING=2,Y.DETAILED_LOGGING=3,Y.OnPluginActivatedObservable=L},12780:(I,E,j)=>{"use strict";j.d(E,{e:()=>Z});var e=j(11101),w=j(11106),z=j(10953),h=j(11117),t=j(11139),U=j(11097),R=j(11073),P=j(10960),o=j(11149);j(12786);class Z extends t.d{set boundingBoxSize(I){if(this._boundingBoxSize&&this._boundingBoxSize.equals(I))return;this._boundingBoxSize=I;const E=this.GI();E&&E.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(I){this._rotationY=I,this.setReflectionTextureMatrix(h.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(I,E,j){let e="";for(const w of I)e+=w;return new Z(e,E,null,j,I)}static CreateFromPrefilteredData(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=E.useDelayedTextureLoading;E.useDelayedTextureLoading=!1;const z=new Z(I,E,null,!1,null,null,null,void 0,!0,j,e);return E.useDelayedTextureLoading=w,z}constructor(I,E){var j;let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,Z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]&&arguments[10],L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,C=arguments.length>13?arguments[13]:void 0,X=arguments.length>14?arguments[14]:void 0;super(E),this.onLoadObservable=new P.e,this.boundingBoxPosition=h.LE.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new h.Matrix,this._buffer=null,this.name=I,this.url=I,this._noMipmap=w,this.ne=!1,this.isCube=!0,this._textureMatrix=h.Matrix.Identity(),this.coordinatesMode=U.d.CUBIC_MODE;let q=null,x=null;null===e||Array.isArray(e)?(this._noMipmap=w,this._format=o,this._createPolynomials=K,q=e,this._loaderOptions=C,this._useSRGBBuffer=X,this._lodScale=L,this._lodOffset=F):(q=e.extensions??null,this._noMipmap=e.noMipmap??!1,z=e.files??null,x=e.buffer??null,this._format=e.format??5,Z=e.prefiltered??!1,c=e.forcedExtension??null,this._createPolynomials=e.createPolynomials??!1,this._lodScale=e.lodScale??.8,this._lodOffset=e.lodOffset??0,this._loaderOptions=e.loaderOptions,this._useSRGBBuffer=e.useSRGBBuffer,t=e.J??null,R=e.onError??null),(I||z)&&this.updateURL(I,c,t,Z,R,q,null===(j=this.GI())||void 0===j?void 0:j.useDelayedTextureLoading,z,x)}getClassName(){return"CubeTexture"}updateURL(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=I),this.url=I,E&&(this._forcedExtension=E);const R=I.lastIndexOf("."),P=E||(R>-1?I.substring(R).toLowerCase():""),o=0===P.indexOf(".dds"),Z=0===P.indexOf(".env"),c=0===P.indexOf(".basis");if(Z?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=e,e&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),t)this._files=t;else if(c||Z||o||z||(z=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,z){for(let E=0;E<z.length;E++)this._files.push(I+z[E]);this._extensions=z}this._buffer=U,h?(this.delayLoadState=4,this._delayedOnLoad=j,this._delayedOnError=w):this._loadTexture(j,w)}delayLoad(I){4===this.delayLoadState&&(I&&(this._forcedExtension=I),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(I){var E,j;if(I.updateFlag===this._textureMatrix.updateFlag)return;I.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(j=this.GI())||void 0===j||j.markAllMaterialsAsDirty(1,(I=>-1!==I.getActiveTextures().indexOf(this))));if(this._textureMatrix=I,null===(E=this.GI())||void 0===E||!E.useRightHandedSystem)return;const e=h.TmpVectors.LE[0],w=h.TmpVectors.Quaternion[0],z=h.TmpVectors.LE[1];this._textureMatrix.decompose(e,w,z),w.z*=-1,w.w*=-1,h.Matrix.ComposeToRef(e,w,z,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var I;return null!==(I=this.GI())&&void 0!==I&&I.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this.GI(),e=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const w=()=>{var E;(this.onLoadObservable.notifyObservers(this),e)&&(e.dispose(),null===(E=this.GI())||void 0===E||E.markAllMaterialsAsDirty(1));I&&I()},h=(I,j)=>{this._loadingError=!0,this._errorObject={message:I,exception:j},E&&E(I,j),U.d.OnTextureLoadErrorObservable.notifyObservers(this)};var t;this._texture?this._texture.isReady?z.Tools.SetImmediate((()=>w())):this._texture.onLoadedObservable.add((()=>w())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,j,this._lodScale,this._lodOffset,I,h,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,j,this._files,this._noMipmap,I,h,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(t=this._texture)||void 0===t||t.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(I,E,j){const e=o.e.Parse((()=>{let e=!1;return I.prefiltered&&(e=I.prefiltered),new Z(j+(I.url??I.name),E,I.extensions,!1,I.files||null,null,null,void 0,e,I.forcedExtension)}),I,E);if(I.boundingBoxPosition&&(e.boundingBoxPosition=h.LE.xE(I.boundingBoxPosition)),I.boundingBoxSize&&(e.boundingBoxSize=h.LE.xE(I.boundingBoxSize)),I.animations)for(let w=0;w<I.animations.length;w++){const E=I.animations[w],j=(0,R.e)("BABYLON.Animation");j&&e.animations.push(j.Parse(E))}return e}clone(){let I=0;const E=o.e.Clone((()=>{const E=new Z(this.url,this.GI()||this._getEngine(),this._extensions,this._noMipmap,this._files);return I=E.uniqueId,E}),this);return E.uniqueId=I,E}}(0,e.b)([(0,w.N)()],Z.prototype,"url",void 0),(0,e.b)([(0,w.K)()],Z.prototype,"boundingBoxPosition",void 0),(0,e.b)([(0,w.K)()],Z.prototype,"boundingBoxSize",null),(0,e.b)([(0,w.N)("rotationY")],Z.prototype,"rotationY",null),(0,e.b)([(0,w.N)("files")],Z.prototype,"_files",void 0),(0,e.b)([(0,w.N)("forcedExtension")],Z.prototype,"_forcedExtension",void 0),(0,e.b)([(0,w.N)("extensions")],Z.prototype,"_extensions",void 0),(0,e.b)([(0,w.z)("textureMatrix")],Z.prototype,"_textureMatrix",void 0),(0,e.b)([(0,w.z)("textureMatrixRefraction")],Z.prototype,"_textureMatrixRefraction",void 0),U.d._CubeTextureParser=Z.Parse,(0,R.h)("BABYLON.CubeTexture",Z)},13287:(I,E,j)=>{"use strict";j.d(E,{d:()=>U});var e=j(10974),w=j(11097),z=j(11087),h=j(11257),t=j(11056);h.ThinEngine.prototype.createDynamicTexture=function(I,E,j,e){const w=new t.e(this,4);return w.baseWidth=I,w.baseHeight=E,j&&(I=this.needPOTTextures?(0,z.i)(I,this._caps.maxTextureSize):I,E=this.needPOTTextures?(0,z.i)(E,this._caps.maxTextureSize):E),w.width=I,w.height=E,w.isReady=!1,w.generateMipMaps=j,w.samplingMode=e,this.updateTextureSamplingMode(e,w),this._internalTexturesCache.push(w),w},h.ThinEngine.prototype.updateDynamicTexture=function(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!I)return;const h=this._gl,t=h.TEXTURE_2D,U=this._bindTextureDirectly(t,I,!0,z);this._unpackFlipY(void 0===j?I.invertY:j),e&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const R=this._getWebGLTextureType(I.type),P=this._getInternalFormat(w||I.format),o=this._getRGBABufferInternalSizedFormat(I.type,P);h.texImage2D(t,0,o,P,R,E),I.generateMipMaps&&h.generateMipmap(t),U||this._bindTextureDirectly(t,null),e&&h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),w&&(I.format=w),I._dynamicTextureSource=E,I._premulAlpha=e,I.invertY=j||!1,I.isReady=!0};class U extends w.d{constructor(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,t=arguments.length>6?arguments[6]:void 0;const U=!j||j._isScene;super(null,U?j:null===j||void 0===j?void 0:j.CE,U?!e:j,t,z,void 0,void 0,void 0,void 0,h),this.name=I,this.wrapU=w.d.CLAMP_ADDRESSMODE,this.wrapV=w.d.CLAMP_ADDRESSMODE,this._generateMipMaps=e;const R=this._getEngine();if(!R)return;if(E.getContext)this._canvas=E,this._ownCanvas=!1,this._texture=R.createDynamicTexture(this._canvas.width,this._canvas.height,e,z);else{this._canvas=R.createCanvas(1,1),this._ownCanvas=!0;const I=E;I.width||0===I.width?this._texture=R.createDynamicTexture(I.width,I.height,e,z):this._texture=R.createDynamicTexture(E,E,e,z)}const P=this.getSize();this._canvas.width!==P.width&&(this._canvas.width=P.width),this._canvas.height!==P.height&&(this._canvas.height=P.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(I){this._canvas.width=I.width,this._canvas.height=I.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(I.width,I.height,this._generateMipMaps,this.samplingMode)}scale(I){const E=this.getSize();E.width*=I,E.height*=I,this._recreate(E)}scaleTo(I,E){const j=this.getSize();j.width=I,j.height=E,this._recreate(j)}getContext(){return this._context}clear(I){const E=this.getSize();I&&(this._context.fillStyle=I),this._context.clearRect(0,0,E.width,E.height)}update(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===I||I,E,this._format||void 0,void 0,j)}drawText(I,E,j,e,w,z,h){let t=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const U=this.getSize();if(z&&(this._context.fillStyle=z,this._context.fillRect(0,0,U.width,U.height)),this._context.font=e,null===E||void 0===E){const j=this._context.measureText(I);E=(U.width-j.width)/2}if(null===j||void 0===j){const I=parseInt(e.replace(/\D/g,""));j=U.height/2+I/3.65}this._context.fillStyle=w||"",this._context.fillText(I,E,j),t&&this.update(h)}dispose(){var I,E;(super.dispose(),this._ownCanvas)&&(null===(I=this._canvas)||void 0===I||null===(E=I.remove)||void 0===E||E.call(I));this._canvas=null,this._context=null}clone(){const I=this.GI();if(!I)return this;const E=this.getSize(),j=new U(this.name,E,I,this._generateMipMaps);return j.ne=this.ne,j.level=this.level,j.wrapU=this.wrapU,j.wrapV=this.wrapV,j}serialize(){const I=this.GI();I&&!I.isReady()&&e.b.Warn("The scene must be ready before serializing the dynamic texture");const E=super.serialize();return U._IsCanvasElement(this._canvas)&&(E.base64String=this._canvas.toDataURL()),E.invertY=this._invertY,E.samplingMode=this.samplingMode,E}static _IsCanvasElement(I){return void 0!==I.toDataURL}_rebuild(){this.update()}}},12687:(I,E,j)=>{"use strict";j.d(E,{d:()=>w});var e=j(11097);class w extends e.d{get depth(){return this._depth}constructor(I,E,j,w,z,h){let t=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],U=arguments.length>7&&void 0!==arguments[7]&&arguments[7],R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:e.d.TRILINEAR_SAMPLINGMODE,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,o=arguments.length>10?arguments[10]:void 0;super(null,h,!t,U),this.format=z,this._texture=h.getEngine().createRawTexture2DArray(I,E,j,w,z,t,U,R,null,P,o),this._depth=w,this.is2DArray=!0}update(I){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,I,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(I,E,j,e,z){return new w(I,E,j,e,5,z,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12509:(I,E,j)=>{"use strict";j.d(E,{b:()=>t,e:()=>U,h:()=>z,i:()=>h});var e=j(11136),w=j(11117);function z(I,E){return`{X: ${I.x.toFixed(E)} Y: ${I.y.toFixed(E)}}`}function h(I,E){return`{X: ${I._x.toFixed(E)} Y: ${I._y.toFixed(E)} Z: ${I._z.toFixed(E)}}`}function t(I,E){return 2*Math.acos((0,e.Clamp)(w.Quaternion.Dot(I,E)))}function U(I,E){const j=new w.Quaternion;return function(I,E,j){const z=w.LE.Cross(I,E),h=Math.acos((0,e.Clamp)(w.LE.Dot(I,E),-1,1));w.Quaternion.RotationAxisToRef(z,h,j)}(I,E,j),j}},12362:(I,E,j)=>{"use strict";j.d(E,{c:()=>R});var e=j(11117),w=j(11165),z=j(11562),h=j(11542),t=j(11176);j(12364);function U(I){let E=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const j=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],z=[];let U=[];const R=I.width||I.size||1,P=I.height||I.size||1,o=I.depth||I.size||1,Z=I.wrap||!1;let c=void 0===I.topBaseAt?1:I.topBaseAt,K=void 0===I.bottomBaseAt?0:I.bottomBaseAt;c=(c+4)%4,K=(K+4)%4;let L=[2,0,3,1][c],F=[2,0,1,3][K],C=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(Z){E=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],C=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let I=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],j=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const e=[17,18,19,16],w=[22,23,20,21];for(;L>0;)I.unshift(I.pop()),e.unshift(e.pop()),L--;for(;F>0;)j.unshift(j.pop()),w.unshift(w.pop()),F--;I=I.flat(),j=j.flat(),C=C.concat(I).concat(j),E.push(e[0],e[2],e[3],e[0],e[1],e[2]),E.push(w[0],w[2],w[3],w[0],w[1],w[2])}const X=[R/2,P/2,o/2];U=C.reduce(((I,E,j)=>I.concat(E*X[j%3])),[]);const q=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE,x=I.faceUV||new Array(6),u=I.faceColors,b=[];for(let h=0;h<6;h++)void 0===x[h]&&(x[h]=new e.Vector4(0,0,1,1)),u&&void 0===u[h]&&(u[h]=new w.hh(1,1,1,1));for(let e=0;e<6;e++)if(z.push(x[e].z,t.b?1-x[e].w:x[e].w),z.push(x[e].x,t.b?1-x[e].w:x[e].w),z.push(x[e].x,t.b?1-x[e].y:x[e].y),z.push(x[e].z,t.b?1-x[e].y:x[e].y),u)for(let I=0;I<4;I++)b.push(u[e].r,u[e].g,u[e].b,u[e].a);h.b._ComputeSides(q,U,E,j,z,I.frontUVs,I.backUVs);const Q=new h.b;if(Q.indices=E,Q.dI=U,Q.aI=j,Q.iI=z,u){const I=q===h.b.DOUBLESIDE?b.concat(b):b;Q.lI=I}return Q}function R(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new z.d(I,j);E.sideOrientation=z.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return U(E).nI(e,E.updatable),e}h.b.CreateBox=U,z.d.CreateBox=function(I,E){return R(I,{size:E,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12499:(I,E,j)=>{"use strict";j.d(E,{e:()=>t});var e=j(11562),w=j(11542),z=j(11176);function h(I){const E=[],j=[],e=[],h=[],t=I.radius||.5,U=I.tessellation||64,R=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,P=0===I.sideOrientation?0:I.sideOrientation||w.b.DEFAULTSIDE;E.push(0,0,0),h.push(.5,.5);const o=2*Math.PI*R,Z=1===R?o/U:o/(U-1);let c=0;for(let w=0;w<U;w++){const I=Math.cos(c),j=Math.sin(c),e=(I+1)/2,w=(1-j)/2;E.push(t*I,t*j,0),h.push(e,z.b?1-w:w),c+=Z}1===R&&(E.push(E[3],E[4],E[5]),h.push(h[2],z.b?1-h[3]:h[3]));const K=E.length/3;for(let w=1;w<K-1;w++)j.push(w+1,0,w);w.b.ComputeNormals(E,j,e),w.b._ComputeSides(P,E,j,e,h,I.frontUVs,I.backUVs);const L=new w.b;return L.indices=j,L.dI=E,L.aI=e,L.iI=h,L}function t(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new e.d(I,j);E.sideOrientation=e.d._GetDefaultSideOrientation(E.sideOrientation),w._originalBuilderSideOrientation=E.sideOrientation;return h(E).nI(w,E.updatable),w}w.b.CreateDisc=h,e.d.CreateDisc=function(I,E,j){return t(I,{radius:E,tessellation:j,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12364:(I,E,j)=>{"use strict";j.d(E,{h:()=>F,d:()=>X,l:()=>C});var e=j(11117),w=j(11165),z=j(11562),h=j(11542),t=j(11197);z.d._GroundMeshParser=(I,E)=>U.Parse(I,E);class U extends z.d{constructor(I,E){super(I,E),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=I,this._subdivisionsY=I,this.subdivide(I);const j=this;j.createOrUpdateSubmeshesOctree&&j.createOrUpdateSubmeshesOctree(E)}getHeightAtCoordinates(I,E){const j=this.getWorldMatrix(),w=e.TmpVectors.Matrix[5];j.invertToRef(w);const z=e.TmpVectors.LE[8];if(e.LE.TransformCoordinatesFromFloatsToRef(I,0,E,w,z),I=z.x,E=z.z,I<this._minX||I>=this._maxX||E<=this._minZ||E>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(I,E),t=-(h.x*I+h.z*E+h.w)/h.y;return e.LE.TransformCoordinatesFromFloatsToRef(0,t,0,j,z),z.y}getNormalAtCoordinates(I,E){const j=new e.LE(0,1,0);return this.getNormalAtCoordinatesToRef(I,E,j),j}getNormalAtCoordinatesToRef(I,E,j){const w=this.getWorldMatrix(),z=e.TmpVectors.Matrix[5];w.invertToRef(z);const h=e.TmpVectors.LE[8];if(e.LE.TransformCoordinatesFromFloatsToRef(I,0,E,z,h),I=h.x,E=h.z,I<this._minX||I>this._maxX||E<this._minZ||E>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const t=this._getFacetAt(I,E);return e.LE.TransformNormalFromFloatsToRef(t.x,t.y,t.z,w,j),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(I,E){const j=Math.floor((I+this._maxX)*this._subdivisionsX/this._width),e=Math.floor(-(E+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),w=this._heightQuads[e*this._subdivisionsX+j];let z;return z=E<w.slope.x*I+w.slope.y?w.facet1:w.facet2,z}_initHeightQuads(){const I=this._subdivisionsX,E=this._subdivisionsY;this._heightQuads=[];for(let j=0;j<E;j++)for(let E=0;E<I;E++){const w={slope:e.Vector2.Zero(),facet1:new e.Vector4(0,0,0,0),facet2:new e.Vector4(0,0,0,0)};this._heightQuads[j*I+E]=w}return this}_computeHeightQuads(){const I=this.getVerticesData(t.e.PositionKind);if(!I)return this;const E=e.TmpVectors.LE[3],j=e.TmpVectors.LE[2],w=e.TmpVectors.LE[1],z=e.TmpVectors.LE[0],h=e.TmpVectors.LE[4],U=e.TmpVectors.LE[5],R=e.TmpVectors.LE[6],P=e.TmpVectors.LE[7],o=e.TmpVectors.LE[8];let Z=0,c=0,K=0,L=0,F=0,C=0,X=0;const q=this._subdivisionsX,x=this._subdivisionsY;for(let t=0;t<x;t++)for(let x=0;x<q;x++){Z=3*x,c=t*(q+1)*3,K=(t+1)*(q+1)*3,E.x=I[c+Z],E.y=I[c+Z+1],E.z=I[c+Z+2],j.x=I[c+Z+3],j.y=I[c+Z+4],j.z=I[c+Z+5],w.x=I[K+Z],w.y=I[K+Z+1],w.z=I[K+Z+2],z.x=I[K+Z+3],z.y=I[K+Z+4],z.z=I[K+Z+5],L=(z.z-E.z)/(z.x-E.x),F=E.z-L*E.x,j.subtractToRef(E,h),w.subtractToRef(E,U),z.subtractToRef(E,R),e.LE.CrossToRef(R,U,P),e.LE.CrossToRef(h,R,o),P.normalize(),o.normalize(),C=-(P.x*E.x+P.y*E.y+P.z*E.z),X=-(o.x*j.x+o.y*j.y+o.z*j.z);const u=this._heightQuads[t*q+x];u.slope.nz(L,F),u.facet1.nz(P.x,P.y,P.z,C),u.facet2.nz(o.x,o.y,o.z,X)}return this}serialize(I){super.serialize(I),I.subdivisionsX=this._subdivisionsX,I.subdivisionsY=this._subdivisionsY,I.minX=this._minX,I.maxX=this._maxX,I.Te=this._minZ,I.maxZ=this._maxZ,I.width=this._width,I.height=this._height}static Parse(I,E){const j=new U(I.name,E);return j._subdivisionsX=I.subdivisionsX||1,j._subdivisionsY=I.subdivisionsY||1,j._minX=I.minX,j._maxX=I.maxX,j._minZ=I.Te,j._maxZ=I.maxZ,j._width=I.width,j._height=I.height,j}}var R=j(10953),P=j(10993),o=j(11120),Z=j(11176);function c(I){const E=[],j=[],w=[],z=[];let t,U;const R=I.width||I.size||1,P=I.height||I.size||1,o=0|(I.subdivisionsX||I.subdivisions||1),c=0|(I.subdivisionsY||I.subdivisions||1);for(t=0;t<=c;t++)for(U=0;U<=o;U++){const I=new e.LE(U*R/o-R/2,0,(c-t)*P/c-P/2),E=new e.LE(0,1,0);j.push(I.x,I.y,I.z),w.push(E.x,E.y,E.z),z.push(U/o,Z.b?t/c:1-t/c)}for(t=0;t<c;t++)for(U=0;U<o;U++)E.push(U+1+(t+1)*(o+1)),E.push(U+1+t*(o+1)),E.push(U+t*(o+1)),E.push(U+(t+1)*(o+1)),E.push(U+1+(t+1)*(o+1)),E.push(U+t*(o+1));const K=new h.b;return K.indices=E,K.dI=j,K.aI=w,K.iI=z,K}function K(I){const E=void 0!==I.xmin&&null!==I.xmin?I.xmin:-1,j=void 0!==I.zmin&&null!==I.zmin?I.zmin:-1,w=void 0!==I.xmax&&null!==I.xmax?I.xmax:1,z=void 0!==I.zmax&&null!==I.zmax?I.zmax:1,t=I.subdivisions||{w:1,h:1},U=I.precision||{w:1,h:1},R=[],P=[],o=[],Z=[];let c,K,L,F;t.h=t.h<1?1:t.h,t.w=t.w<1?1:t.w,U.w=U.w<1?1:U.w,U.h=U.h<1?1:U.h;const C=(w-E)/t.w,X=(z-j)/t.h;function q(I,E,j,w){const z=P.length/3,h=U.w+1;for(c=0;c<U.h;c++)for(K=0;K<U.w;K++){const I=[z+K+c*h,z+(K+1)+c*h,z+(K+1)+(c+1)*h,z+K+(c+1)*h];R.push(I[1]),R.push(I[2]),R.push(I[3]),R.push(I[0]),R.push(I[1]),R.push(I[3])}const t=e.LE.Zero(),L=new e.LE(0,1,0);for(c=0;c<=U.h;c++)for(t.z=c*(w-E)/U.h+E,K=0;K<=U.w;K++)t.x=K*(j-I)/U.w+I,t.y=0,P.push(t.x,t.y,t.z),o.push(L.x,L.y,L.z),Z.push(K/U.w,c/U.h)}for(L=0;L<t.h;L++)for(F=0;F<t.w;F++)q(E+F*C,j+L*X,E+(F+1)*C,j+(L+1)*X);const x=new h.b;return x.indices=R,x.dI=P,x.aI=o,x.iI=Z,x}function L(I){const E=[],j=[],z=[],t=[];let U,R;const P=I.colorFilter||new w.qE(.3,.59,.11),Z=I.alphaFilter||0;let c=!1;if(I.minHeight>I.maxHeight){c=!0;const E=I.maxHeight;I.maxHeight=I.minHeight,I.minHeight=E}for(U=0;U<=I.subdivisions;U++)for(R=0;R<=I.subdivisions;R++){const E=new e.LE(R*I.width/I.subdivisions-I.width/2,0,(I.subdivisions-U)*I.height/I.subdivisions-I.height/2),w=4*(((E.x+I.width/2)/I.width*(I.bufferWidth-1)|0)+((1-(E.z+I.height/2)/I.height)*(I.bufferHeight-1)|0)*I.bufferWidth);let h=I.buffer[w]/255,K=I.buffer[w+1]/255,L=I.buffer[w+2]/255;const F=I.buffer[w+3]/255;c&&(h=1-h,K=1-K,L=1-L);const C=h*P.r+K*P.g+L*P.b;E.y=F>=Z?I.minHeight+(I.maxHeight-I.minHeight)*C:I.minHeight-o.b,I.heightBuffer&&(I.heightBuffer[U*(I.subdivisions+1)+R]=E.y),j.push(E.x,E.y,E.z),z.push(0,0,0),t.push(R/I.subdivisions,1-U/I.subdivisions)}for(U=0;U<I.subdivisions;U++)for(R=0;R<I.subdivisions;R++){const e=R+1+(U+1)*(I.subdivisions+1),w=R+1+U*(I.subdivisions+1),z=R+U*(I.subdivisions+1),h=R+(U+1)*(I.subdivisions+1),t=j[3*e+1]>=I.minHeight,P=j[3*w+1]>=I.minHeight,o=j[3*z+1]>=I.minHeight;t&&P&&o&&(E.push(e),E.push(w),E.push(z));j[3*h+1]>=I.minHeight&&t&&o&&(E.push(h),E.push(e),E.push(z))}h.b.ComputeNormals(j,E,z);const K=new h.b;return K.indices=E,K.dI=j,K.aI=z,K.iI=t,K}function F(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const j=new U(I,arguments.length>2?arguments[2]:void 0);j._setReady(!1),j._subdivisionsX=E.subdivisionsX||E.subdivisions||1,j._subdivisionsY=E.subdivisionsY||E.subdivisions||1,j._width=E.width||1,j._height=E.height||1,j._maxX=j._width/2,j._maxZ=j._height/2,j._minX=-j._maxX,j._minZ=-j._maxZ;return c(E).nI(j,E.updatable),j._setReady(!0),j}function C(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new z.d(I,j);return K(E).nI(e,E.updatable),e}function X(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const z=j.width||10,h=j.height||10,t=j.subdivisions||1,o=j.minHeight||0,Z=j.maxHeight||1,c=j.colorFilter||new w.qE(.3,.59,.11),K=j.alphaFilter||0,F=j.updatable,C=j.onReady;e=e||P.d.LastCreatedScene;const X=new U(I,e);let q;X._subdivisionsX=t,X._subdivisionsY=t,X._width=z,X._height=h,X._maxX=X._width/2,X._maxZ=X._height/2,X._minX=-X._maxX,X._minZ=-X._maxZ,X._setReady(!1),j.passHeightBufferInCallback&&(q=new Float32Array((t+1)*(t+1)));const x=(I,E,j)=>{L({width:z,height:h,subdivisions:t,minHeight:o,maxHeight:Z,colorFilter:c,buffer:I,bufferWidth:E,bufferHeight:j,alphaFilter:K,heightBuffer:q}).nI(X,F),C&&C(X,q),X._setReady(!0)};if("string"===typeof E){const I=I=>{var E;const j=I.width,w=I.height;if(e.Z)return;const z=null===(E=e)||void 0===E?void 0:E.getEngine().resizeImageBitmap(I,j,w);x(z,j,w)};R.Tools.LoadImage(E,I,j.onError?j.onError:()=>{},e.offlineProvider)}else x(E.data,E.width,E.height);return X}h.b.CreateGround=c,h.b.CreateTiledGround=K,h.b.CreateGroundFromHeightMap=L,z.d.CreateGround=(I,E,j,e,w,z)=>F(I,{width:E,height:j,subdivisions:e,updatable:z},w),z.d.CreateTiledGround=(I,E,j,e,w,z,h,t,U)=>C(I,{xmin:E,zmin:j,xmax:e,zmax:w,subdivisions:z,precision:h,updatable:U},t),z.d.CreateGroundFromHeightMap=(I,E,j,e,w,z,h,t,U,R,P)=>X(I,E,{width:j,height:e,subdivisions:w,minHeight:z,maxHeight:h,updatable:U,onReady:R,alphaFilter:P},t)},12991:(I,E,j)=>{"use strict";j.d(E,{c:()=>c,d:()=>o,e:()=>Z});var e=j(11117),w=j(11562),z=j(11542),h=j(11654),t=j(11197),U=j(10974);function R(I){const E=[],j=[],e=I.lines,w=I.lI,h=[];let t=0;for(let z=0;z<e.length;z++){const I=e[z];for(let e=0;e<I.length;e++){const{x:U,y:R,z:P}=I[e];if(j.push(U,R,P),w){const I=w[z],{r:E,g:j,b:t,a:U}=I[e];h.push(E,j,t,U)}e>0&&(E.push(t-1),E.push(t)),t++}}const U=new z.b;return U.indices=E,U.dI=j,w&&(U.lI=h),U}function P(I){const E=I.dashSize||3,j=I.gapSize||1,w=I.dashNb||200,h=I.points,t=[],U=[],R=e.LE.Zero();let P=0,o=0,Z=0,c=0,K=0,L=0,F=0;for(F=0;F<h.length-1;F++)h[F+1].subtractToRef(h[F],R),P+=R.length();for(Z=P/w,c=E*Z/(E+j),F=0;F<h.length-1;F++){h[F+1].subtractToRef(h[F],R),o=Math.floor(R.length()/Z),R.normalize();for(let I=0;I<o;I++)K=Z*I,t.push(h[F].x+K*R.x,h[F].y+K*R.y,h[F].z+K*R.z),t.push(h[F].x+(K+c)*R.x,h[F].y+(K+c)*R.y,h[F].z+(K+c)*R.z),U.push(L,L+1),L+=2}const C=new z.b;return C.dI=t,C.indices=U,C}function o(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=E.instance,w=E.lines,z=E.lI;if(e){const I=e.getVerticesData(t.e.PositionKind);let E,j;z&&(E=e.getVerticesData(t.e.ColorKind));let h=0,U=0;for(let e=0;e<w.length;e++){const t=w[e];for(let w=0;w<t.length;w++)I[h]=t[w].x,I[h+1]=t[w].y,I[h+2]=t[w].z,z&&E&&(j=z[e],E[U]=j[w].r,E[U+1]=j[w].g,E[U+2]=j[w].b,E[U+3]=j[w].a,U+=4),h+=3}return e.updateVerticesData(t.e.PositionKind,I,!1,!1),z&&E&&e.updateVerticesData(t.e.ColorKind,E,!1,!1),e.refreshBoundingInfo(),e}const U=!!z,P=new h.d(I,j,null,void 0,void 0,U,E.useVertexAlpha,E.material);return R(E).nI(P,E.updatable),P}function Z(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=E.lI?[E.lI]:null;return o(I,{lines:[E.points],updatable:E.updatable,instance:E.instance,lI:e,useVertexAlpha:E.useVertexAlpha,material:E.material},j)}function c(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.points,t=E.instance,R=E.gapSize||1,o=E.dashSize||3;if(t){const I=I=>{const E=e.LE.Zero(),j=I.length/6;let w=0,h=0,U=0,R=0,P=0,o=0,Z=0,c=0;for(Z=0;Z<z.length-1;Z++)z[Z+1].subtractToRef(z[Z],E),w+=E.length();U=w/j;const K=t._creationDataStorage.dashSize;for(R=K*U/(K+t._creationDataStorage.gapSize),Z=0;Z<z.length-1;Z++)for(z[Z+1].subtractToRef(z[Z],E),h=Math.floor(E.length()/U),E.normalize(),c=0;c<h&&o<I.length;)P=U*c,I[o]=z[Z].x+P*E.x,I[o+1]=z[Z].y+P*E.y,I[o+2]=z[Z].z+P*E.z,I[o+3]=z[Z].x+(P+R)*E.x,I[o+4]=z[Z].y+(P+R)*E.y,I[o+5]=z[Z].z+(P+R)*E.z,o+=6,c++;for(;o<I.length;)I[o]=z[Z].x,I[o+1]=z[Z].y,I[o+2]=z[Z].z,o+=3};return(E.dashNb||E.dashSize||E.gapSize||E.useVertexAlpha||E.material)&&U.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),t.updateMeshPositions(I,!1),t}const Z=new h.d(I,j,null,void 0,void 0,void 0,E.useVertexAlpha,E.material);return P(E).nI(Z,E.updatable),Z._creationDataStorage=new w.h,Z._creationDataStorage.dashSize=o,Z._creationDataStorage.gapSize=R,Z}z.b.CreateLineSystem=R,z.b.CreateDashedLines=P,w.d.yR=function(I,E){return Z(I,{points:E,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},w.d.CreateDashedLines=function(I,E,j,e,w){return c(I,{points:E,dashSize:j,gapSize:e,dashNb:w,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12420:(I,E,j)=>{"use strict";j.d(E,{e:()=>t,h:()=>U});var e=j(11562),w=j(11542),z=j(11176);function h(I){const E=[],j=[],e=[],h=[],t=void 0!==I.width?I.width:void 0!==I.size?I.size:1,U=void 0!==I.height?I.height:void 0!==I.size?I.size:1,R=0===I.sideOrientation?0:I.sideOrientation||w.b.DEFAULTSIDE,P=t/2,o=U/2;j.push(-P,-o,0),e.push(0,0,-1),h.push(0,z.b?1:0),j.push(P,-o,0),e.push(0,0,-1),h.push(1,z.b?1:0),j.push(P,o,0),e.push(0,0,-1),h.push(1,z.b?0:1),j.push(-P,o,0),e.push(0,0,-1),h.push(0,z.b?0:1),E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),w.b._ComputeSides(R,j,E,e,h,I.frontUVs,I.backUVs);const Z=new w.b;return Z.indices=E,Z.dI=j,Z.aI=e,Z.iI=h,Z}function t(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new e.d(I,j);E.sideOrientation=e.d._GetDefaultSideOrientation(E.sideOrientation),w._originalBuilderSideOrientation=E.sideOrientation;return h(E).nI(w,E.updatable),E.sourcePlane&&(w.translate(E.sourcePlane.normal,-E.sourcePlane.d),w.setDirection(E.sourcePlane.normal.scale(-1))),w}const U={lR:t};w.b.lR=h,e.d.lR=(I,E,j,e,w)=>t(I,{size:E,width:E,height:E,sideOrientation:w,updatable:e},j)},12489:(I,E,j)=>{"use strict";j.d(E,{e:()=>U});var e=j(11117),w=j(11562),z=j(11542),h=j(11176);function t(I){const E=0|(I.segments||32),j=I.diameterX||I.diameter||1,w=I.diameterY||I.diameter||1,t=I.diameterZ||I.diameter||1,U=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,R=I.slice&&I.slice<=0?1:I.slice||1,P=0===I.sideOrientation?0:I.sideOrientation||z.b.DEFAULTSIDE,o=!!I.dedupTopBottomIndices,Z=new e.LE(j/2,w/2,t/2),c=2+E,K=2*c,L=[],F=[],C=[],X=[];for(let z=0;z<=c;z++){const I=z/c,E=I*Math.PI*R;for(let j=0;j<=K;j++){const w=j/K,z=w*Math.PI*2*U,t=e.Matrix.RotationZ(-E),R=e.Matrix.RotationY(z),P=e.LE.TransformCoordinates(e.LE.Up(),t),o=e.LE.TransformCoordinates(P,R),c=o.multiply(Z),L=o.divide(Z).normalize();F.push(c.x,c.y,c.z),C.push(L.x,L.y,L.z),X.push(w,h.b?1-I:I)}if(z>0){const I=F.length/3;for(let E=I-2*(K+1);E+K+2<I;E++)o?(z>1&&(L.push(E),L.push(E+1),L.push(E+K+1)),(z<c||R<1)&&(L.push(E+K+1),L.push(E+1),L.push(E+K+2))):(L.push(E),L.push(E+1),L.push(E+K+1),L.push(E+K+1),L.push(E+1),L.push(E+K+2))}}z.b._ComputeSides(P,F,L,C,X,I.frontUVs,I.backUVs);const q=new z.b;return q.indices=L,q.dI=F,q.aI=C,q.iI=X,q}function U(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return t(E).nI(e,E.updatable),e}z.b.CreateSphere=t,w.d.CreateSphere=(I,E,j,e,w,z)=>U(I,{segments:E,diameterX:j,diameterY:j,diameterZ:j,sideOrientation:z,updatable:w},e)},13296:(I,E,j)=>{"use strict";j.d(E,{e:()=>t});var e=j(11675),w=j(12788),z=j(11689),h=j(11542);class t{static get Configuration(){return{get decoder(){return w.b.DefaultConfiguration},set decoder(I){w.b.DefaultConfiguration=I}}}static set Configuration(I){w.b.DefaultConfiguration=I.decoder}static get DecoderAvailable(){return(0,e.h)(w.b.DefaultConfiguration)}static get Default(){return t._Default??(t._Default=new t),t._Default}static ResetDefault(I){t._Default&&(I||t._Default.dispose(),t._Default=null)}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.DefaultNumWorkers;const E="number"===typeof I?{...w.b.DefaultConfiguration,numWorkers:I}:{...w.b.DefaultConfiguration,...I};this._decoder=new w.b(E)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(I,E,j){return this._decoder.decodeMeshToMeshDataAsync(I,E,j)}async decodeMeshToGeometryAsync(I,E,j,e){return await this._decoder.decodeMeshToGeometryAsync(I,E,j,e)}async _decodeMeshToGeometryForGltfAsync(I,E,j,e,w,z){return await this._decoder._decodeMeshToGeometryForGltfAsync(I,E,j,e,w,z)}async decodeMeshAsync(I,E){const j=await this._decoder.decodeMeshToMeshDataAsync(I,E),e=new h.b;j.indices&&(e.indices=j.indices);for(const w of j.attributes){const I=z.c.GetFloatData(w.data,w.size,z.c.GetDataType(w.data),w.byteOffset,w.byteStride,w.normalized,j.totalVertices);e.set(I,w.kind)}return e}}t.DefaultNumWorkers=(0,e.f)(),t._Default=null},12788:(I,E,j)=>{"use strict";j.d(E,{b:()=>R});var e=j(11675),w=j(10953),z=j(11573),h=j(11689),t=j(10974),U=j(11686);class R extends e.d{static get DefaultAvailable(){return(0,e.h)(R.DefaultConfiguration)}static get Default(){return R._Default??(R._Default=new R),R._Default}static ResetDefault(I){R._Default&&(I||R._Default.dispose(),R._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(I,E){return{module:await(E||DracoDecoderModule)({wasmBinary:I})}}_getWorkerContent(){return`${U.c}(${U.d})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.DefaultConfiguration)}decodeMeshToMeshDataAsync(I,E,j){const e=I instanceof ArrayBuffer?new Int8Array(I):new Int8Array(I.buffer,I.byteOffset,I.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async I=>await new Promise(((w,z)=>{I.push(((I,h)=>{let U=null;const R=[],P=E=>{I.removeEventListener("error",P),I.removeEventListener("message",o),z(E),h()},o=E=>{const e=E.data;switch(e.id){case"indices":U=e.data;break;case"attribute":R.push({kind:e.kind,data:e.data,size:e.size,byteOffset:e.byteOffset,byteStride:e.byteStride,normalized:(z=e.kind,Z=e.normalized,j&&void 0!==j[z]?(Z!==j[z]&&t.b.Warn(`Normalized flag from Draco data (${Z}) does not match normalized flag from glTF accessor (${j[z]}). Using flag from glTF accessor.`),j[z]):Z)});break;case"decodeMeshDone":I.removeEventListener("error",P),I.removeEventListener("message",o),w({indices:U,attributes:R,totalVertices:e.totalVertices}),h()}var z,Z};I.addEventListener("error",P),I.addEventListener("message",o);const Z=e.slice();I.postMessage({id:"decodeMesh",dataView:Z,attributes:E},[Z.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((I=>{let j=null;const w=[],z=(0,U.c)(I.module,e,E,(I=>{j=I}),((I,E,j,e,z,h)=>{w.push({kind:I,data:E,size:j,byteOffset:e,byteStride:z,normalized:h})}));return{indices:j,attributes:w,totalVertices:z}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(I,E,j,e){const w=await this.decodeMeshToMeshDataAsync(j,e),t=new z.d(I,E);w.indices&&t.setIndices(w.indices);for(const z of w.attributes)t.setVerticesBuffer(new h.c(E.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),w.totalVertices);return t}async _decodeMeshToGeometryForGltfAsync(I,E,j,e,w,t){const U=await this.decodeMeshToMeshDataAsync(j,e,w),R=new z.d(I,E);t&&(R._boundingInfo=t,R.useBoundingInfoFromGeometry=!0),U.indices&&R.setIndices(U.indices);for(const z of U.attributes)R.setVerticesBuffer(new h.c(E.getEngine(),z.data,z.kind,!1,void 0,z.byteStride,void 0,z.byteOffset,z.size,void 0,z.normalized,!0),U.totalVertices);return R}}R.DefaultConfiguration={wasmUrl:`${w.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${w.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${w.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},R._Default=null},12983:(I,E,j)=>{"use strict";j.d(E,{b:()=>tI});var e=j(11117),w=j(11562),z=j(11197),h=j(11542),t=j(11176);function U(I){let E=I.pathArray;const j=I.closeArray||!1,e=I.closePath||!1,w=I.invertUV||!1,U=Math.floor(E[0].length/2);let R=I.offset||U;R=R>U?U:Math.floor(R);const P=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE,o=I.iI,Z=I.lI,c=[],K=[],L=[],F=[],C=[],X=[],q=[],x=[];let u;const b=[],Q=[];let G,y,d;if(E.length<2){const I=[],j=[];for(y=0;y<E[0].length-R;y++)I.push(E[0][y]),j.push(E[0][y+R]);E=[I,j]}let a=0;const l=e?1:0,i=j?1:0;let r,n,H,g,Y,A;for(u=E[0].length,G=0;G<E.length+i;G++){for(q[G]=0,C[G]=[0],r=G===E.length?E[0]:E[G],n=r.length,u=u<n?u:n,d=0;d<n;)c.push(r[d].x,r[d].y,r[d].z),d>0&&(H=r[d].FE(r[d-1]).length(),g=H+q[G],C[G].push(g),q[G]=g),d++;e&&(d--,c.push(r[0].x,r[0].y,r[0].z),H=r[d].FE(r[0]).length(),g=H+q[G],C[G].push(g),q[G]=g),b[G]=n+l,Q[G]=a,a+=n+l}let T,M,W=null,O=null;for(y=0;y<u+l;y++)for(x[y]=0,X[y]=[0],G=0;G<E.length-1+i;G++)Y=E[G],A=G===E.length-1?E[0]:E[G+1],y===u?(W=Y[0],O=A[0]):(W=Y[y],O=A[y]),H=O.FE(W).length(),g=H+x[y],X[y].push(g),x[y]=g;if(o)for(G=0;G<o.length;G++)F.push(o[G].x,t.b?1-o[G].y:o[G].y);else for(G=0;G<E.length+i;G++)for(y=0;y<u+l;y++)T=0!=q[G]?C[G][y]/q[G]:0,M=0!=x[y]?X[y][G]/x[y]:0,w?F.push(M,T):F.push(T,t.b?1-M:M);G=0;let s=0,v=b[G]-1,V=b[G+1]-1,f=v<V?v:V,S=Q[1]-Q[0];const B=b.length-1;for(;s<=f&&G<B;)K.push(s,s+S,s+1),K.push(s+S+1,s+1,s+S),s+=1,s===f&&(G++,S=Q[G+1]-Q[G],v=b[G]-1,V=b[G+1]-1,s=Q[G],f=v<V?v+s:V+s);if(h.b.ComputeNormals(c,K,L),e){let I=0,j=0;for(G=0;G<E.length;G++){I=3*Q[G],j=G+1<E.length?3*(Q[G+1]-1):L.length-3,L[I]=.5*(L[I]+L[j]),L[I+1]=.5*(L[I+1]+L[j+1]),L[I+2]=.5*(L[I+2]+L[j+2]);const e=Math.sqrt(L[I]*L[I]+L[I+1]*L[I+1]+L[I+2]*L[I+2]);L[I]/=e,L[I+1]/=e,L[I+2]/=e,L[j]=L[I],L[j+1]=L[I+1],L[j+2]=L[I+2]}}if(j){let I=3*Q[0],j=3*Q[E.length];for(y=0;y<u+l;y++){L[I]=.5*(L[I]+L[j]),L[I+1]=.5*(L[I+1]+L[j+1]),L[I+2]=.5*(L[I+2]+L[j+2]);const E=Math.sqrt(L[I]*L[I]+L[I+1]*L[I+1]+L[I+2]*L[I+2]);L[I]/=E,L[I+1]/=E,L[I+2]/=E,L[j]=L[I],L[j+1]=L[I+1],L[j+2]=L[I+2],I+=3,j+=3}}h.b._ComputeSides(P,c,K,L,F,I.frontUVs,I.backUVs);let p=null;if(Z){p=new Float32Array(4*Z.length);for(let I=0;I<Z.length;I++)p[4*I]=Z[I].r,p[4*I+1]=Z[I].g,p[4*I+2]=Z[I].b,p[4*I+3]=Z[I].a}const D=new h.b,k=new Float32Array(c),J=new Float32Array(L),N=new Float32Array(F);return D.indices=K,D.dI=k,D.aI=J,D.iI=N,p&&D.set(p,z.e.ColorKind),e&&(D._idx=Q),D}function R(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const R=E.pathArray,P=E.closeArray,o=E.closePath,Z=w.d._GetDefaultSideOrientation(E.sideOrientation),c=E.instance,K=E.updatable;if(c){const I=e.TmpVectors.LE[0].mz(Number.MAX_VALUE),j=e.TmpVectors.LE[1].mz(-Number.MAX_VALUE),U=E=>{let e=R[0].length;const z=c;let h=0;const t=z._originalBuilderSideOrientation===w.d.DOUBLESIDE?2:1;for(let w=1;w<=t;++w)for(let t=0;t<R.length;++t){const w=R[t],U=w.length;e=e<U?e:U;for(let z=0;z<e;++z){const e=w[z];E[h]=e.x,E[h+1]=e.y,E[h+2]=e.z,I.minimizeInPlaceFromFloats(e.x,e.y,e.z),j.maximizeInPlaceFromFloats(e.x,e.y,e.z),h+=3}if(z._creationDataStorage&&z._creationDataStorage.closePath){const I=w[0];E[h]=I.x,E[h+1]=I.y,E[h+2]=I.z,h+=3}}},P=c.getVerticesData(z.e.PositionKind);if(U(P),c.hasBoundingInfo?c.getBoundingInfo().reConstruct(I,j,c._worldMatrix):c.buildBoundingInfo(I,j,c._worldMatrix),c.updateVerticesData(z.e.PositionKind,P,!1,!1),E.lI){const I=c.getVerticesData(z.e.ColorKind);for(let j=0,e=0;j<E.lI.length;j++,e+=4){const w=E.lI[j];I[e]=w.r,I[e+1]=w.g,I[e+2]=w.b,I[e+3]=w.a}c.updateVerticesData(z.e.ColorKind,I,!1,!1)}if(E.iI){const I=c.getVerticesData(z.e.UVKind);for(let j=0;j<E.iI.length;j++)I[2*j]=E.iI[j].x,I[2*j+1]=t.b?1-E.iI[j].y:E.iI[j].y;c.updateVerticesData(z.e.UVKind,I,!1,!1)}if(!c.areNormalsFrozen||c.isFacetDataEnabled){const I=c.me(),E=c.getVerticesData(z.e.NormalKind),j=c.isFacetDataEnabled?c.getFacetDataParameters():null;if(h.b.ComputeNormals(P,I,E,j),c._creationDataStorage&&c._creationDataStorage.closePath){let I=0,j=0;for(let e=0;e<R.length;e++)I=3*c._creationDataStorage.idx[e],j=e+1<R.length?3*(c._creationDataStorage.idx[e+1]-1):E.length-3,E[I]=.5*(E[I]+E[j]),E[I+1]=.5*(E[I+1]+E[j+1]),E[I+2]=.5*(E[I+2]+E[j+2]),E[j]=E[I],E[j+1]=E[I+1],E[j+2]=E[I+2]}c.areNormalsFrozen||c.updateVerticesData(z.e.NormalKind,E,!1,!1)}return c}{const e=new w.d(I,j);e._originalBuilderSideOrientation=Z,e._creationDataStorage=new w.h;const z=U(E);return o&&(e._creationDataStorage.idx=z._idx),e._creationDataStorage.closePath=o,e._creationDataStorage.closeArray=P,z.nI(e,K),e}}h.b.CreateRibbon=U,w.d.CreateRibbon=function(I,E){return R(I,{pathArray:E,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var P=j(12499),o=j(12362),Z=j(11165);function c(I){const E=I.pattern||w.d.NO_FLIP,j=I.tileWidth||I.tileSize||1,e=I.tileHeight||I.tileSize||1,z=I.alignHorizontal||0,t=I.alignVertical||0,U=I.width||I.size||1,R=Math.floor(U/j);let P=U-R*j;const o=I.height||I.size||1,Z=Math.floor(o/e);let c=o-Z*e;const K=j*R/2,L=e*Z/2;let F=0,C=0,X=0,q=0,x=0,u=0;if(P>0||c>0){switch(X=-K,q=-L,x=K,u=L,z){case w.d.CENTER:P/=2,X-=P,x+=P;break;case w.d.LEFT:x+=P,F=-P/2;break;case w.d.RIGHT:X-=P,F=P/2}switch(t){case w.d.CENTER:c/=2,q-=c,u+=c;break;case w.d.BOTTOM:u+=c,C=-c/2;break;case w.d.TOP:q-=c,C=c/2}}const b=[],Q=[],G=[];G[0]=[0,0,1,0,1,1,0,1],G[1]=[0,0,1,0,1,1,0,1],E!==w.d.ROTATE_TILE&&E!==w.d.ROTATE_ROW||(G[1]=[1,1,0,1,0,0,1,0]),E!==w.d.FLIP_TILE&&E!==w.d.FLIP_ROW||(G[1]=[1,0,0,0,0,1,1,1]),E!==w.d.FLIP_N_ROTATE_TILE&&E!==w.d.FLIP_N_ROTATE_ROW||(G[1]=[0,1,1,1,1,0,0,0]);let y=[];const d=[],a=[];let l=0;for(let h=0;h<Z;h++)for(let I=0;I<R;I++)b.push(I*j-K+F,h*e-L+C,0),b.push((I+1)*j-K+F,h*e-L+C,0),b.push((I+1)*j-K+F,(h+1)*e-L+C,0),b.push(I*j-K+F,(h+1)*e-L+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),y=E===w.d.FLIP_TILE||E===w.d.ROTATE_TILE||E===w.d.FLIP_N_ROTATE_TILE?y.concat(G[(I%2+h%2)%2]):E===w.d.FLIP_ROW||E===w.d.ROTATE_ROW||E===w.d.FLIP_N_ROTATE_ROW?y.concat(G[h%2]):y.concat(G[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),l+=4;if(P>0||c>0){const I=c>0&&(t===w.d.CENTER||t===w.d.TOP),h=c>0&&(t===w.d.CENTER||t===w.d.BOTTOM),U=P>0&&(z===w.d.CENTER||z===w.d.RIGHT),o=P>0&&(z===w.d.CENTER||z===w.d.LEFT);let G,i,r,n,H=[];if(I&&U&&(b.push(X+F,q+C,0),b.push(-K+F,q+C,0),b.push(-K+F,q+c+C,0),b.push(X+F,q+c+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,G=1-P/j,i=1-c/e,r=1,n=1,H=[G,i,r,i,r,n,G,n],E===w.d.ROTATE_ROW&&(H=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),E===w.d.FLIP_ROW&&(H=[1-G,i,1-r,i,1-r,n,1-G,n]),E===w.d.FLIP_N_ROTATE_ROW&&(H=[G,1-i,r,1-i,r,1-n,G,1-n]),y=y.concat(H),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I&&o&&(b.push(K+F,q+C,0),b.push(x+F,q+C,0),b.push(x+F,q+c+C,0),b.push(K+F,q+c+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,G=0,i=1-c/e,r=P/j,n=1,H=[G,i,r,i,r,n,G,n],(E===w.d.ROTATE_ROW||E===w.d.ROTATE_TILE&&R%2===0)&&(H=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),(E===w.d.FLIP_ROW||E===w.d.FLIP_TILE&&R%2===0)&&(H=[1-G,i,1-r,i,1-r,n,1-G,n]),(E===w.d.FLIP_N_ROTATE_ROW||E===w.d.FLIP_N_ROTATE_TILE&&R%2===0)&&(H=[G,1-i,r,1-i,r,1-n,G,1-n]),y=y.concat(H),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&U&&(b.push(X+F,L+C,0),b.push(-K+F,L+C,0),b.push(-K+F,u+C,0),b.push(X+F,u+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,G=1-P/j,i=0,r=1,n=c/e,H=[G,i,r,i,r,n,G,n],(E===w.d.ROTATE_ROW&&Z%2===1||E===w.d.ROTATE_TILE&&Z%1===0)&&(H=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),(E===w.d.FLIP_ROW&&Z%2===1||E===w.d.FLIP_TILE&&Z%2===0)&&(H=[1-G,i,1-r,i,1-r,n,1-G,n]),(E===w.d.FLIP_N_ROTATE_ROW&&Z%2===1||E===w.d.FLIP_N_ROTATE_TILE&&Z%2===0)&&(H=[G,1-i,r,1-i,r,1-n,G,1-n]),y=y.concat(H),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),h&&o&&(b.push(K+F,L+C,0),b.push(x+F,L+C,0),b.push(x+F,u+C,0),b.push(K+F,u+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,G=0,i=0,r=P/j,n=c/e,H=[G,i,r,i,r,n,G,n],(E===w.d.ROTATE_ROW&&Z%2===1||E===w.d.ROTATE_TILE&&(Z+R)%2===1)&&(H=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),(E===w.d.FLIP_ROW&&Z%2===1||E===w.d.FLIP_TILE&&(Z+R)%2===1)&&(H=[1-G,i,1-r,i,1-r,n,1-G,n]),(E===w.d.FLIP_N_ROTATE_ROW&&Z%2===1||E===w.d.FLIP_N_ROTATE_TILE&&(Z+R)%2===1)&&(H=[G,1-i,r,1-i,r,1-n,G,1-n]),y=y.concat(H),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),I){const I=[];G=0,i=1-c/e,r=1,n=1,I[0]=[G,i,r,i,r,n,G,n],I[1]=[G,i,r,i,r,n,G,n],E!==w.d.ROTATE_TILE&&E!==w.d.ROTATE_ROW||(I[1]=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),E!==w.d.FLIP_TILE&&E!==w.d.FLIP_ROW||(I[1]=[1-G,i,1-r,i,1-r,n,1-G,n]),E!==w.d.FLIP_N_ROTATE_TILE&&E!==w.d.FLIP_N_ROTATE_ROW||(I[1]=[G,1-i,r,1-i,r,1-n,G,1-n]);for(let e=0;e<R;e++)b.push(e*j-K+F,q+C,0),b.push((e+1)*j-K+F,q+C,0),b.push((e+1)*j-K+F,q+c+C,0),b.push(e*j-K+F,q+c+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,y=E===w.d.FLIP_TILE||E===w.d.ROTATE_TILE||E===w.d.FLIP_N_ROTATE_TILE?y.concat(I[(e+1)%2]):E===w.d.FLIP_ROW||E===w.d.ROTATE_ROW||E===w.d.FLIP_N_ROTATE_ROW?y.concat(I[1]):y.concat(I[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(h){const I=[];G=0,i=0,r=1,n=c/e,I[0]=[G,i,r,i,r,n,G,n],I[1]=[G,i,r,i,r,n,G,n],E!==w.d.ROTATE_TILE&&E!==w.d.ROTATE_ROW||(I[1]=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),E!==w.d.FLIP_TILE&&E!==w.d.FLIP_ROW||(I[1]=[1-G,i,1-r,i,1-r,n,1-G,n]),E!==w.d.FLIP_N_ROTATE_TILE&&E!==w.d.FLIP_N_ROTATE_ROW||(I[1]=[G,1-i,r,1-i,r,1-n,G,1-n]);for(let e=0;e<R;e++)b.push(e*j-K+F,u-c+C,0),b.push((e+1)*j-K+F,u-c+C,0),b.push((e+1)*j-K+F,u+C,0),b.push(e*j-K+F,u+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,y=E===w.d.FLIP_TILE||E===w.d.ROTATE_TILE||E===w.d.FLIP_N_ROTATE_TILE?y.concat(I[(e+Z)%2]):E===w.d.FLIP_ROW||E===w.d.ROTATE_ROW||E===w.d.FLIP_N_ROTATE_ROW?y.concat(I[Z%2]):y.concat(I[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(U){const I=[];G=1-P/j,i=0,r=1,n=1,I[0]=[G,i,r,i,r,n,G,n],I[1]=[G,i,r,i,r,n,G,n],E!==w.d.ROTATE_TILE&&E!==w.d.ROTATE_ROW||(I[1]=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),E!==w.d.FLIP_TILE&&E!==w.d.FLIP_ROW||(I[1]=[1-G,i,1-r,i,1-r,n,1-G,n]),E!==w.d.FLIP_N_ROTATE_TILE&&E!==w.d.FLIP_N_ROTATE_ROW||(I[1]=[G,1-i,r,1-i,r,1-n,G,1-n]);for(let j=0;j<Z;j++)b.push(X+F,j*e-L+C,0),b.push(X+P+F,j*e-L+C,0),b.push(X+P+F,(j+1)*e-L+C,0),b.push(X+F,(j+1)*e-L+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,y=E===w.d.FLIP_TILE||E===w.d.ROTATE_TILE||E===w.d.FLIP_N_ROTATE_TILE?y.concat(I[(j+1)%2]):E===w.d.FLIP_ROW||E===w.d.ROTATE_ROW||E===w.d.FLIP_N_ROTATE_ROW?y.concat(I[j%2]):y.concat(I[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(o){const I=[];G=0,i=0,r=P/e,n=1,I[0]=[G,i,r,i,r,n,G,n],I[1]=[G,i,r,i,r,n,G,n],E!==w.d.ROTATE_TILE&&E!==w.d.ROTATE_ROW||(I[1]=[1-G,1-i,1-r,1-i,1-r,1-n,1-G,1-n]),E!==w.d.FLIP_TILE&&E!==w.d.FLIP_ROW||(I[1]=[1-G,i,1-r,i,1-r,n,1-G,n]),E!==w.d.FLIP_N_ROTATE_TILE&&E!==w.d.FLIP_N_ROTATE_ROW||(I[1]=[G,1-i,r,1-i,r,1-n,G,1-n]);for(let j=0;j<Z;j++)b.push(x-P+F,j*e-L+C,0),b.push(x+F,j*e-L+C,0),b.push(x+F,(j+1)*e-L+C,0),b.push(x-P+F,(j+1)*e-L+C,0),a.push(l,l+1,l+3,l+1,l+2,l+3),l+=4,y=E===w.d.FLIP_TILE||E===w.d.ROTATE_TILE||E===w.d.FLIP_N_ROTATE_TILE?y.concat(I[(j+R)%2]):E===w.d.FLIP_ROW||E===w.d.ROTATE_ROW||E===w.d.FLIP_N_ROTATE_ROW?y.concat(I[j%2]):y.concat(I[0]),d.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Q.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const i=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE;h.b._ComputeSides(i,b,a,Q,y,I.frontUVs,I.backUVs);const r=new h.b;r.indices=a,r.dI=b,r.aI=Q,r.iI=y;const n=i===h.b.DOUBLESIDE?d.concat(d):d;return r.lI=n,r}function K(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return c(E).nI(e,E.updatable),e}function L(I){const E=I.faceUV||new Array(6),j=I.faceColors,z=I.pattern||w.d.NO_FLIP,U=I.width||I.size||1,R=I.height||I.size||1,P=I.depth||I.size||1,o=I.tileWidth||I.tileSize||1,K=I.tileHeight||I.tileSize||1,L=I.alignHorizontal||0,F=I.alignVertical||0,C=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE;for(let w=0;w<6;w++)void 0===E[w]&&(E[w]=new e.Vector4(0,0,1,1)),j&&void 0===j[w]&&(j[w]=new Z.hh(1,1,1,1));const X=U/2,q=R/2,x=P/2,u=[];for(let e=0;e<2;e++)u[e]=c({pattern:z,tileWidth:o,tileHeight:K,width:U,height:R,alignVertical:F,alignHorizontal:L,sideOrientation:C});for(let e=2;e<4;e++)u[e]=c({pattern:z,tileWidth:o,tileHeight:K,width:P,height:R,alignVertical:F,alignHorizontal:L,sideOrientation:C});let b=F;F===w.d.BOTTOM?b=w.d.TOP:F===w.d.TOP&&(b=w.d.BOTTOM);for(let e=4;e<6;e++)u[e]=c({pattern:z,tileWidth:o,tileHeight:K,width:U,height:P,alignVertical:b,alignHorizontal:L,sideOrientation:C});let Q=[],G=[],y=[],d=[];const a=[],l=[],i=[],r=[];let n=0,H=0;for(let w=0;w<6;w++){const I=u[w].dI.length;l[w]=[],i[w]=[];for(let E=0;E<I/3;E++)l[w].push(new e.LE(u[w].dI[3*E],u[w].dI[3*E+1],u[w].dI[3*E+2])),i[w].push(new e.LE(u[w].aI[3*E],u[w].aI[3*E+1],u[w].aI[3*E+2]));n=u[w].iI.length,r[w]=[];for(let j=0;j<n;j+=2)r[w][j]=E[w].x+(E[w].z-E[w].x)*u[w].iI[j],r[w][j+1]=E[w].y+(E[w].w-E[w].y)*u[w].iI[j+1],t.b&&(r[w][j+1]=1-r[w][j+1]);if(y=y.concat(r[w]),d=d.concat(u[w].indices.map((I=>I+H))),H+=l[w].length,j)for(let E=0;E<4;E++)a.push(j[w].r,j[w].g,j[w].b,j[w].a)}const g=new e.LE(0,0,x),Y=e.Matrix.RotationY(Math.PI);Q=l[0].map((I=>e.LE.TransformNormal(I,Y).add(g))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[]),G=i[0].map((I=>e.LE.TransformNormal(I,Y))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[]),Q=Q.concat(l[1].map((I=>I.FE(g))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[])),G=G.concat(i[1].map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[]));const A=new e.LE(X,0,0),T=e.Matrix.RotationY(-Math.PI/2);Q=Q.concat(l[2].map((I=>e.LE.TransformNormal(I,T).add(A))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[])),G=G.concat(i[2].map((I=>e.LE.TransformNormal(I,T))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[]));const M=e.Matrix.RotationY(Math.PI/2);Q=Q.concat(l[3].map((I=>e.LE.TransformNormal(I,M).FE(A))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[])),G=G.concat(i[3].map((I=>e.LE.TransformNormal(I,M))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[]));const W=new e.LE(0,q,0),O=e.Matrix.RotationX(Math.PI/2);Q=Q.concat(l[4].map((I=>e.LE.TransformNormal(I,O).add(W))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[])),G=G.concat(i[4].map((I=>e.LE.TransformNormal(I,O))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[]));const s=e.Matrix.RotationX(-Math.PI/2);Q=Q.concat(l[5].map((I=>e.LE.TransformNormal(I,s).FE(W))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[])),G=G.concat(i[5].map((I=>e.LE.TransformNormal(I,s))).map((I=>[I.x,I.y,I.z])).reduce(((I,E)=>I.concat(E)),[])),h.b._ComputeSides(C,Q,d,G,y);const v=new h.b;if(v.indices=d,v.dI=Q,v.aI=G,v.iI=y,j){const I=C===h.b.DOUBLESIDE?a.concat(a):a;v.lI=I}return v}function F(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return L(E).nI(e,E.updatable),e}h.b.CreateTiledPlane=c;h.b.CreateTiledBox=L;var C=j(12489),X=j(11363),q=j(11319);function x(I){const E=I.height||2;let j=0===I.diameterTop?0:I.diameterTop||I.diameter||1,z=0===I.diameterBottom?0:I.diameterBottom||I.diameter||1;j=j||1e-5,z=z||1e-5;const U=0|(I.tessellation||24),R=0|(I.subdivisions||1),P=!!I.hasRings,o=!!I.enclose,c=0===I.cap?0:I.cap||w.d.CAP_ALL,K=I.arc&&(I.arc<=0||I.arc>1)?1:I.arc||1,L=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE,F=I.faceUV||new Array(3),C=I.faceColors,X=2+(1+(1!==K&&o?2:0))*(P?R:1);let x;for(x=0;x<X;x++)C&&void 0===C[x]&&(C[x]=new Z.hh(1,1,1,1));for(x=0;x<X;x++)F&&void 0===F[x]&&(F[x]=new e.Vector4(0,0,1,1));const u=[],b=[],Q=[],G=[],y=[],d=2*Math.PI*K/U;let a,l,i;const r=(z-j)/2/E,n=e.LE.Zero(),H=e.LE.Zero(),g=e.LE.Zero(),Y=e.LE.Zero(),A=e.LE.Zero(),T=q.d.Y;let M,W,O,s=1,v=1,V=0,f=0;for(M=0;M<=R;M++)for(l=M/R,i=(l*(j-z)+z)/2,s=P&&0!==M&&M!==R?2:1,O=0;O<s;O++){for(P&&(v+=O),o&&(v+=2*O),W=0;W<=U;W++)a=W*d,n.x=Math.cos(-a)*i,n.y=-E/2+l*E,n.z=Math.sin(-a)*i,0===j&&M===R?(H.x=Q[Q.length-3*(U+1)],H.y=Q[Q.length-3*(U+1)+1],H.z=Q[Q.length-3*(U+1)+2]):(H.x=n.x,H.z=n.z,H.y=Math.sqrt(H.x*H.x+H.z*H.z)*r,H.normalize()),0===W&&(g.U(n),Y.U(H)),b.push(n.x,n.y,n.z),Q.push(H.x,H.y,H.z),f=P?V!==v?F[v].y:F[v].w:F[v].y+(F[v].w-F[v].y)*l,G.push(F[v].x+(F[v].z-F[v].x)*W/U,t.b?1-f:f),C&&y.push(C[v].r,C[v].g,C[v].b,C[v].a);1!==K&&o&&(b.push(n.x,n.y,n.z),b.push(0,n.y,0),b.push(0,n.y,0),b.push(g.x,g.y,g.z),e.LE.CrossToRef(T,H,A),A.normalize(),Q.push(A.x,A.y,A.z,A.x,A.y,A.z),e.LE.CrossToRef(Y,T,A),A.normalize(),Q.push(A.x,A.y,A.z,A.x,A.y,A.z),f=P?V!==v?F[v+1].y:F[v+1].w:F[v+1].y+(F[v+1].w-F[v+1].y)*l,G.push(F[v+1].x,t.b?1-f:f),G.push(F[v+1].z,t.b?1-f:f),f=P?V!==v?F[v+2].y:F[v+2].w:F[v+2].y+(F[v+2].w-F[v+2].y)*l,G.push(F[v+2].x,t.b?1-f:f),G.push(F[v+2].z,t.b?1-f:f),C&&(y.push(C[v+1].r,C[v+1].g,C[v+1].b,C[v+1].a),y.push(C[v+1].r,C[v+1].g,C[v+1].b,C[v+1].a),y.push(C[v+2].r,C[v+2].g,C[v+2].b,C[v+2].a),y.push(C[v+2].r,C[v+2].g,C[v+2].b,C[v+2].a))),V!==v&&(V=v)}const S=1!==K&&o?U+4:U;for(M=0,v=0;v<R;v++){let I=0,E=0,j=0,e=0;for(W=0;W<U;W++)I=M*(S+1)+W,E=(M+1)*(S+1)+W,j=M*(S+1)+(W+1),e=(M+1)*(S+1)+(W+1),u.push(I,E,j),u.push(e,j,E);1!==K&&o&&(u.push(I+2,E+2,j+2),u.push(e+2,j+2,E+2),u.push(I+4,E+4,j+4),u.push(e+4,j+4,E+4)),M=P?M+2:M+1}const B=I=>{const w=I?j/2:z/2;if(0===w)return;let h,R,P;const o=I?F[X-1]:F[0];let Z=null;C&&(Z=I?C[X-1]:C[0]);const c=b.length/3,L=I?E/2:-E/2,q=new e.LE(0,L,0);b.push(q.x,q.y,q.z),Q.push(0,I?1:-1,0);const x=o.y+.5*(o.w-o.y);G.push(o.x+.5*(o.z-o.x),t.b?1-x:x),Z&&y.push(Z.r,Z.g,Z.b,Z.a);const d=new e.Vector2(.5,.5);for(P=0;P<=U;P++){h=2*Math.PI*P*K/U;const E=Math.cos(-h),j=Math.sin(-h);R=new e.LE(E*w,L,j*w);const z=new e.Vector2(E*d.x+.5,j*d.y+.5);b.push(R.x,R.y,R.z),Q.push(0,I?1:-1,0);const c=o.y+(o.w-o.y)*z.y;G.push(o.x+(o.z-o.x)*z.x,t.b?1-c:c),Z&&y.push(Z.r,Z.g,Z.b,Z.a)}for(P=0;P<U;P++)I?(u.push(c),u.push(c+(P+2)),u.push(c+(P+1))):(u.push(c),u.push(c+(P+1)),u.push(c+(P+2)))};c!==w.d.CAP_START&&c!==w.d.CAP_ALL||B(!1),c!==w.d.CAP_END&&c!==w.d.CAP_ALL||B(!0),h.b._ComputeSides(L,b,u,Q,G,I.frontUVs,I.backUVs);const p=new h.b;return p.indices=u,p.dI=b,p.aI=Q,p.iI=G,C&&(p.lI=y),p}function u(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return x(E).nI(e,E.updatable),e}function b(I){const E=[],j=[],w=[],z=[],U=I.diameter||1,R=I.thickness||.5,P=0|(I.tessellation||16),o=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE,Z=P+1;for(let h=0;h<=P;h++){const I=h/P,o=h*Math.PI*2/P-Math.PI/2,c=e.Matrix.Translation(U/2,0,0).multiply(e.Matrix.RotationY(o));for(let U=0;U<=P;U++){const o=1-U/P,K=U*Math.PI*2/P+Math.PI,L=Math.cos(K),F=Math.sin(K);let C=new e.LE(L,F,0),X=C.scale(R/2);const q=new e.Vector2(I,o);X=e.LE.TransformCoordinates(X,c),C=e.LE.TransformNormal(C,c),j.push(X.x,X.y,X.z),w.push(C.x,C.y,C.z),z.push(q.x,t.b?1-q.y:q.y);const x=(h+1)%Z,u=(U+1)%Z;E.push(h*Z+U),E.push(h*Z+u),E.push(x*Z+U),E.push(h*Z+u),E.push(x*Z+u),E.push(x*Z+U)}}h.b._ComputeSides(o,j,E,w,z,I.frontUVs,I.backUVs);const c=new h.b;return c.indices=E,c.dI=j,c.aI=w,c.iI=z,c}function Q(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return b(E).nI(e,E.updatable),e}h.b.CreateCylinder=x,w.d.CreateCylinder=(I,E,j,e,z,h,t,U,R)=>{void 0!==t&&t instanceof X.c||(void 0!==t&&(R=U||w.d.DEFAULTSIDE,U=t),t=h,h=1);return u(I,{height:E,diameterTop:j,diameterBottom:e,tessellation:z,subdivisions:h,sideOrientation:R,updatable:U},t)};function G(I){const E=[],j=[],w=[],z=[],U=I.radius||2,R=I.tube||.5,P=I.radialSegments||32,o=I.tubularSegments||32,Z=I.p||2,c=I.q||3,K=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE,L=I=>{const E=Math.cos(I),j=Math.sin(I),w=c/Z*I,z=Math.cos(w),h=U*(2+z)*.5*E,t=U*(2+z)*j*.5,R=U*Math.sin(w)*.5;return new e.LE(h,t,R)};let F,C;for(F=0;F<=P;F++){const I=F%P/P*2*Z*Math.PI,E=L(I),w=L(I+.01),h=w.FE(E);let U=w.add(E);const c=e.LE.Cross(h,U);for(U=e.LE.Cross(c,h),c.normalize(),U.normalize(),C=0;C<o;C++){const I=C%o/o*2*Math.PI,e=-R*Math.cos(I),w=R*Math.sin(I);j.push(E.x+e*U.x+w*c.x),j.push(E.y+e*U.y+w*c.y),j.push(E.z+e*U.z+w*c.z),z.push(F/P),z.push(t.b?1-C/o:C/o)}}for(F=0;F<P;F++)for(C=0;C<o;C++){const I=(C+1)%o,j=F*o+C,e=(F+1)*o+C,w=(F+1)*o+I,z=F*o+I;E.push(z),E.push(e),E.push(j),E.push(z),E.push(w),E.push(e)}h.b.ComputeNormals(j,E,w),h.b._ComputeSides(K,j,E,w,z,I.frontUVs,I.backUVs);const X=new h.b;return X.indices=E,X.dI=j,X.aI=w,X.iI=z,X}function y(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2?arguments[2]:void 0;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return G(E).nI(e,E.updatable),e}h.b.CreateTorus=b,w.d.CreateTorus=(I,E,j,e,w,z,h)=>Q(I,{diameter:E,thickness:j,tessellation:e,sideOrientation:h,updatable:z},w);h.b.CreateTorusKnot=G,w.d.CreateTorusKnot=(I,E,j,e,w,z,h,t,U,R)=>y(I,{radius:E,tube:j,radialSegments:e,tubularSegments:w,p:z,q:h,sideOrientation:R,updatable:U},t);var d=j(12991),a=j(11664),l=j(11337);function i(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=E.path,z=E.shape,h=E.scale||1,t=E.rotation||0,U=0===E.cap?0:E.cap||w.d.NO_CAP,R=E.updatable,P=w.d._GetDefaultSideOrientation(E.sideOrientation),o=E.instance||null,Z=E.invertUV||!1,c=E.closeShape||!1,K=E.closePath||!1,L=E.capFunction||null;return n(I,z,e,h,t,null,null,K,c,U,!1,j,!!R,P,o,Z,E.frontUVs||null,E.backUVs||null,E.firstNormal||null,!!E.adjustFrame,L)}function r(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=E.path,z=E.shape,h=E.scaleFunction||(()=>1),t=E.rotationFunction||(()=>0),U=E.closePath||E.ribbonCloseArray||!1,R=E.closeShape||E.ribbonClosePath||!1,P=0===E.cap?0:E.cap||w.d.NO_CAP,o=E.updatable,Z=E.firstNormal||null,c=E.adjustFrame||!1,K=w.d._GetDefaultSideOrientation(E.sideOrientation),L=E.instance,F=E.invertUV||!1,C=E.capFunction||null;return n(I,z,e,null,null,h,t,U,R,P,!0,j,!!o,K,L||null,F,E.frontUVs||null,E.backUVs||null,Z,c,C||null)}function n(I,E,j,z,h,t,U,P,o,Z,c,K,L,F,C,X,q,x,u,b,Q){const G=(I,E,j,z,h,t,U,R,P,o,Z)=>{const c=j.getTangents(),K=j.getNormals(),L=j.getBinormals(),F=j.getDistances();if(Z)for(let w=0;w<c.length;w++)if(0==c[w].x&&0==c[w].y&&0==c[w].z&&c[w].U(c[w-1]),0==K[w].x&&0==K[w].y&&0==K[w].z&&K[w].U(K[w-1]),0==L[w].x&&0==L[w].y&&0==L[w].z&&L[w].U(L[w-1]),w>0){let I=c[w-1];e.LE.Dot(I,c[w])<0&&c[w].scaleInPlace(-1),I=K[w-1],e.LE.Dot(I,K[w])<0&&K[w].scaleInPlace(-1),I=L[w-1],e.LE.Dot(I,L[w])<0&&L[w].scaleInPlace(-1)}let C=0;const X=o&&R?R:()=>null!==t?t:0,q=o&&U?U:()=>null!==h?h:1;let x=P===w.d.NO_CAP||P===w.d.CAP_END?0:2;const u=e.TmpVectors.Matrix[0];for(let w=0;w<E.length;w++){const j=[],h=X(w,F[w]),t=q(w,F[w]);e.Matrix.RotationAxisToRef(c[w],C,u);for(let z=0;z<I.length;z++){const h=c[w].scale(I[z].z).add(K[w].scale(I[z].x)).add(L[w].scale(I[z].y)),U=e.LE.Zero();e.LE.TransformCoordinatesToRef(h,u,U),U.scaleInPlace(t).addInPlace(E[w]),j[z]=U}z[x]=j,C+=h,x++}const b=Q||(I=>{const E=Array(),j=e.LE.Zero();let w;for(w=0;w<I.length;w++)j.addInPlace(I[w]);for(j.scaleInPlace(1/I.length),w=0;w<I.length;w++)E.push(j);return E});switch(P){case w.d.NO_CAP:break;case w.d.CAP_START:z[0]=b(z[2]),z[1]=z[2];break;case w.d.CAP_END:z[x]=z[x-1],z[x+1]=b(z[x-1]);break;case w.d.CAP_ALL:z[0]=b(z[2]),z[1]=z[2],z[x]=z[x-1],z[x+1]=b(z[x-1])}return z};let y,d;if(C){const I=C._creationDataStorage;return y=u?I.path3D.update(j,u):I.path3D.update(j),d=G(E,j,I.path3D,I.pathArray,z,h,t,U,I.cap,c,b),C=R("",{pathArray:d,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:C},K||void 0)}y=u?new l.k(j,u):new l.k(j);d=G(E,j,y,new Array,z,h,t,U,Z=Z<0||Z>3?0:Z,c,b);const a=R(I,{pathArray:d,closeArray:P,closePath:o,updatable:L,sideOrientation:F,invertUV:X,frontUVs:q||void 0,backUVs:x||void 0},K);return a._creationDataStorage.pathArray=d,a._creationDataStorage.path3D=y,a._creationDataStorage.cap=Z,a}function H(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.arc?E.arc<=0||E.arc>1?1:E.arc:1,h=void 0===E.closed||E.closed,t=E.shape,U=E.radius||1,P=E.tessellation||64,o=E.clip||0,Z=E.updatable,c=w.d._GetDefaultSideOrientation(E.sideOrientation),K=E.cap||w.d.NO_CAP,L=2*Math.PI,F=[],C=E.invertUV||!1;let X=0,q=0;const x=L/P*z;let u,b;for(X=0;X<=P-o;X++){for(b=[],K!=w.d.CAP_START&&K!=w.d.CAP_ALL||(b.push(new e.LE(0,t[0].y,0)),b.push(new e.LE(Math.cos(X*x)*t[0].x*U,t[0].y,Math.sin(X*x)*t[0].x*U))),q=0;q<t.length;q++)u=new e.LE(Math.cos(X*x)*t[q].x*U,t[q].y,Math.sin(X*x)*t[q].x*U),b.push(u);K!=w.d.CAP_END&&K!=w.d.CAP_ALL||(b.push(new e.LE(Math.cos(X*x)*t[t.length-1].x*U,t[t.length-1].y,Math.sin(X*x)*t[t.length-1].x*U)),b.push(new e.LE(0,t[t.length-1].y,0))),F.push(b)}return R(I,{pathArray:F,closeArray:h,sideOrientation:c,updatable:Z,invertUV:C,frontUVs:E.frontUVs,backUVs:E.backUVs},j)}w.d.ExtrudeShape=function(I,E,j,e,z,h){let t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0,P=arguments.length>9?arguments[9]:void 0;return i(I,{shape:E,path:j,scale:e,rotation:z,cap:0===h?0:h||w.d.NO_CAP,sideOrientation:R,instance:P,updatable:U},t)},w.d.ExtrudeShapeCustom=(I,E,j,e,z,h,t,U,R,P,o,Z)=>r(I,{shape:E,path:j,scaleFunction:e,rotationFunction:z,ribbonCloseArray:h,ribbonClosePath:t,cap:0===U?0:U||w.d.NO_CAP,sideOrientation:o,instance:Z,updatable:P},R);w.d.CreateLathe=(I,E,j,e,w,z,h)=>H(I,{shape:E,radius:j,tessellation:e,sideOrientation:h,updatable:z},w);var g=j(12420),Y=j(12364);function A(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.path;let h=E.instance,t=1;void 0!==E.radius?t=E.radius:h&&(t=h._creationDataStorage.radius);const U=E.tessellation||64,P=E.radiusFunction||null;let o=E.cap||w.d.NO_CAP;const Z=E.invertUV||!1,c=E.updatable,K=w.d._GetDefaultSideOrientation(E.sideOrientation);E.arc=E.arc&&(E.arc<=0||E.arc>1)?1:E.arc||1;const L=(I,E,j,z,h,t,U,R)=>{const P=E.getTangents(),o=E.getNormals(),Z=E.getDistances(),c=2*Math.PI/h*R,K=t||(()=>z);let L,F,C,X;const q=e.TmpVectors.Matrix[0];let x=U===w.d.NO_CAP||U===w.d.CAP_END?0:2;for(let w=0;w<I.length;w++){F=K(w,Z[w]),L=Array(),C=o[w];for(let E=0;E<h;E++)e.Matrix.RotationAxisToRef(P[w],c*E,q),X=L[E]?L[E]:e.LE.Zero(),e.LE.TransformCoordinatesToRef(C,q,X),X.scaleInPlace(F).addInPlace(I[w]),L[E]=X;j[x]=L,x++}const u=(E,j)=>{const e=Array();for(let w=0;w<E;w++)e.push(I[j]);return e};switch(U){case w.d.NO_CAP:break;case w.d.CAP_START:j[0]=u(h,0),j[1]=j[2].slice(0);break;case w.d.CAP_END:j[x]=j[x-1].slice(0),j[x+1]=u(h,I.length-1);break;case w.d.CAP_ALL:j[0]=u(h,0),j[1]=j[2].slice(0),j[x]=j[x-1].slice(0),j[x+1]=u(h,I.length-1)}return j};let F,C;if(h){const I=h._creationDataStorage,j=E.arc||I.arc;return F=I.path3D.update(z),C=L(z,F,I.pathArray,t,I.tessellation,P,I.cap,j),h=R("",{pathArray:C,instance:h}),I.path3D=F,I.pathArray=C,I.arc=j,I.radius=t,h}F=new l.k(z);o=o<0||o>3?0:o,C=L(z,F,new Array,t,U,P,o,E.arc);const X=R(I,{pathArray:C,closePath:!0,closeArray:!1,updatable:c,sideOrientation:K,invertUV:Z,frontUVs:E.frontUVs,backUVs:E.backUVs},j);return X._creationDataStorage.pathArray=C,X._creationDataStorage.path3D=F,X._creationDataStorage.tessellation=U,X._creationDataStorage.cap=o,X._creationDataStorage.arc=E.arc,X._creationDataStorage.radius=t,X}function T(I){const E=[];E[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},E[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},E[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},E[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},E[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},E[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},E[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},E[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},E[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},E[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},E[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},E[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},E[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},E[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},E[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const j=I.type&&(I.type<0||I.type>=E.length)?0:I.type||0,w=I.size,z=I.sizeX||w||1,U=I.sizeY||w||1,R=I.sizeZ||w||1,P=I.custom||E[j],o=P.face.length,c=I.faceUV||new Array(o),K=I.faceColors,L=void 0===I.flat||I.flat,F=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE,C=[],X=[],q=[],x=[],u=[];let b=0,Q=0;const G=[];let y,d,a,l,i,r,n=0,H=0;if(L)for(H=0;H<o;H++)K&&void 0===K[H]&&(K[H]=new Z.hh(1,1,1,1)),c&&void 0===c[H]&&(c[H]=new e.Vector4(0,0,1,1));if(L)for(H=0;H<o;H++){const I=P.face[H].length;for(a=2*Math.PI/I,l=.5*Math.tan(a/2),i=.5,n=0;n<I;n++)C.push(P.vertex[P.face[H][n]][0]*z,P.vertex[P.face[H][n]][1]*U,P.vertex[P.face[H][n]][2]*R),G.push(b),b++,y=c[H].x+(c[H].z-c[H].x)*(.5+l),d=c[H].y+(c[H].w-c[H].y)*(i-.5),x.push(y,t.b?1-d:d),r=l*Math.cos(a)-i*Math.sin(a),i=l*Math.sin(a)+i*Math.cos(a),l=r,K&&u.push(K[H].r,K[H].g,K[H].b,K[H].a);for(n=0;n<I-2;n++)X.push(G[0+Q],G[n+2+Q],G[n+1+Q]);Q+=I}else{for(n=0;n<P.vertex.length;n++)C.push(P.vertex[n][0]*z,P.vertex[n][1]*U,P.vertex[n][2]*R),x.push(0,t.b?1:0);for(H=0;H<o;H++)for(n=0;n<P.face[H].length-2;n++)X.push(P.face[H][0],P.face[H][n+2],P.face[H][n+1])}h.b.ComputeNormals(C,X,q),h.b._ComputeSides(F,C,X,q,x,I.frontUVs,I.backUVs);const g=new h.b;return g.dI=C,g.indices=X,g.aI=q,g.iI=x,K&&L&&(g.lI=u),g}function M(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return T(E).nI(e,E.updatable),e}w.d.CreateTube=(I,E,j,e,w,z,h,t,U,R)=>A(I,{path:E,radius:j,tessellation:e,radiusFunction:w,arc:1,cap:z,updatable:t,sideOrientation:U,instance:R},h);function W(I){const E=I.sideOrientation||h.b.DEFAULTSIDE,j=I.radius||1,w=void 0===I.flat||I.flat,z=0|(I.subdivisions||4),U=I.radiusX||j,R=I.radiusY||j,P=I.radiusZ||j,o=(1+Math.sqrt(5))/2,Z=[-1,o,-0,1,o,0,-1,-o,0,1,-o,0,0,-1,-o,0,1,-o,0,-1,o,0,1,o,o,0,1,o,0,-1,-o,0,1,-o,0,-1],c=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],K=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],L=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],F=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],C=[],X=[],q=[],x=[];let u=0;const b=new Array(3),Q=new Array(3);let G;for(G=0;G<3;G++)b[G]=e.LE.Zero(),Q[G]=e.Vector2.Zero();for(let h=0;h<20;h++){for(G=0;G<3;G++){const I=c[3*h+G];b[G].nz(Z[3*K[I]],Z[3*K[I]+1],Z[3*K[I]+2]),b[G].normalize(),Q[G].nz(.134765625*L[2*I]+.05859375+-.0390625*F[h],.2333984375*L[2*I+1]+.025390625+.01953125*F[h])}const I=(I,E,j,h)=>{const o=e.LE.Lerp(b[0],b[2],E/z),Z=e.LE.Lerp(b[1],b[2],E/z),c=z===E?b[2]:e.LE.Lerp(o,Z,I/(z-E));let K;if(c.normalize(),w){const I=e.LE.Lerp(b[0],b[2],h/z),E=e.LE.Lerp(b[1],b[2],h/z);K=e.LE.Lerp(I,E,j/(z-h))}else K=new e.LE(c.x,c.y,c.z);K.x/=U,K.y/=R,K.z/=P,K.normalize();const L=e.Vector2.Lerp(Q[0],Q[2],E/z),F=e.Vector2.Lerp(Q[1],Q[2],E/z),G=z===E?Q[2]:e.Vector2.Lerp(L,F,I/(z-E));X.push(c.x*U,c.y*R,c.z*P),q.push(K.x,K.y,K.z),x.push(G.x,t.b?1-G.y:G.y),C.push(u),u++};for(let E=0;E<z;E++)for(let j=0;j+E<z;j++)I(j,E,j+1/3,E+1/3),I(j+1,E,j+1/3,E+1/3),I(j,E+1,j+1/3,E+1/3),j+E+1<z&&(I(j+1,E,j+2/3,E+2/3),I(j+1,E+1,j+2/3,E+2/3),I(j,E+1,j+2/3,E+2/3))}h.b._ComputeSides(E,X,C,q,x,I.frontUVs,I.backUVs);const y=new h.b;return y.indices=C,y.dI=X,y.aI=q,y.iI=x,y}function O(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const e=new w.d(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),e._originalBuilderSideOrientation=E.sideOrientation;return W(E).nI(e,E.updatable),e}h.b.CreatePolyhedron=T,w.d.CreatePolyhedron=(I,E,j)=>M(I,E,j);h.b.CreateIcoSphere=W,w.d.CreateIcoSphere=(I,E,j)=>O(I,E,j);var s=j(11136);const v=new e.LE(1,0,0),V=new e.LE(-1,0,0),f=new e.LE(0,1,0),S=new e.LE(0,-1,0),B=new e.LE(0,0,1),p=new e.LE(0,0,-1);class D{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.LE.Zero(),E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.LE.Up(),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.Vector2.Zero(),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,U=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=I,this.normal=E,this.uv=j,this.vertexIdx=w,this.vertexIdxForBones=z,this.localPositionOverride=h,this.localNormalOverride=t,this.matrixIndicesOverride=U,this.matrixWeightsOverride=R}clone(){var I,E,j,e;return new D(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(I=this.localPositionOverride)||void 0===I?void 0:I.slice(),null===(E=this.localNormalOverride)||void 0===E?void 0:E.slice(),null===(j=this.matrixIndicesOverride)||void 0===j?void 0:j.slice(),null===(e=this.matrixWeightsOverride)||void 0===e?void 0:e.slice())}}function k(I,E,j){var U,R,P,o,Z;const c=!!E.skeleton,K=!(null===(U=E.morphTargetManager)||void 0===U||!U.numTargets),L=j.localMode||c,F=E.me(),C=c||K?E.Vt(!0,!0):E.getVerticesData(z.e.PositionKind),X=c||K?E.getNormalsData(!0,!0):E.getVerticesData(z.e.NormalKind),q=L?c?E.getVerticesData(z.e.PositionKind):C:null,x=L?c?E.getVerticesData(z.e.NormalKind):X:null,u=E.getVerticesData(z.e.UVKind),b=c?E.getVerticesData(z.e.MatricesIndicesKind):null,Q=c?E.getVerticesData(z.e.MatricesWeightsKind):null,G=c?E.getVerticesData(z.e.MatricesIndicesExtraKind):null,y=c?E.getVerticesData(z.e.MatricesWeightsExtraKind):null,d=j.position||e.LE.Zero();let a=j.normal||e.LE.Up();const l=j.size||e.LE.One(),i=j.angle||0;if(!a){const I=new e.LE(0,0,1),j=E.GI().activeCamera,w=e.LE.TransformCoordinates(I,j.getWorldMatrix());a=j.globalPosition.FE(w)}const r=-Math.atan2(a.z,a.x)-Math.PI/2,n=Math.sqrt(a.x*a.x+a.z*a.z),H=Math.atan2(a.y,n),g=new h.b;g.indices=[],g.dI=[],g.aI=[],g.iI=[],g.matricesIndices=c?[]:null,g.matricesWeights=c?[]:null,g.matricesIndicesExtra=G?[]:null,g.matricesWeightsExtra=y?[]:null;let Y=0;const A=(I,E)=>{const w=new D;if(!F||!C||!X)return w;const z=F[I];if(w.vertexIdx=3*z,w.vertexIdxForBones=4*z,w.position=new e.LE(C[3*z],C[3*z+1],C[3*z+2]),e.LE.TransformCoordinatesToRef(w.position,E,w.position),w.normal=new e.LE(X[3*z],X[3*z+1],X[3*z+2]),e.LE.TransformNormalToRef(w.normal,E,w.normal),j.captureUVS&&u){const I=u[2*z+1];w.uv=new e.Vector2(u[2*z],t.b?1-I:I)}return w},T=[0,0,0,0],M=(I,E)=>{if(0===I.length)return I;const j=.5*Math.abs(e.LE.Dot(l,E)),w=(I,E,j,e)=>{for(let w=0;w<e;++w)if(I[j+w]===E)return j+w;return-1},z=(I,z)=>{const h=e.LE.GetClipFactor(I.position,z.position,E,j);let t=T,U=T;if(b&&Q){const E=I.matrixIndicesOverride?0:I.vertexIdxForBones,j=I.matrixIndicesOverride??b,e=I.matrixWeightsOverride??Q,R=z.matrixIndicesOverride?0:z.vertexIdxForBones,P=z.matrixIndicesOverride??b,o=z.matrixWeightsOverride??Q;t=[0,0,0,0],U=[0,0,0,0];let Z=0;for(let I=0;I<4;++I)if(e[E+I]>0){const z=w(P,j[E+I],R,4);t[Z]=j[E+I],U[Z]=(0,s.Lerp)(e[E+I],z>=0?o[z]:0,h),Z++}for(let I=0;I<4&&Z<4;++I){const e=P[R+I];-1===w(j,e,E,4)&&(t[Z]=e,U[Z]=(0,s.Lerp)(0,o[R+I],h),Z++)}const c=U[0]+U[1]+U[2]+U[3];U[0]/=c,U[1]/=c,U[2]/=c,U[3]/=c}const R=I.localPositionOverride?I.localPositionOverride[0]:(null===q||void 0===q?void 0:q[I.vertexIdx])??0,P=I.localPositionOverride?I.localPositionOverride[1]:(null===q||void 0===q?void 0:q[I.vertexIdx+1])??0,o=I.localPositionOverride?I.localPositionOverride[2]:(null===q||void 0===q?void 0:q[I.vertexIdx+2])??0,Z=z.localPositionOverride?z.localPositionOverride[0]:(null===q||void 0===q?void 0:q[z.vertexIdx])??0,c=z.localPositionOverride?z.localPositionOverride[1]:(null===q||void 0===q?void 0:q[z.vertexIdx+1])??0,K=z.localPositionOverride?z.localPositionOverride[2]:(null===q||void 0===q?void 0:q[z.vertexIdx+2])??0,L=I.localNormalOverride?I.localNormalOverride[0]:(null===x||void 0===x?void 0:x[I.vertexIdx])??0,F=I.localNormalOverride?I.localNormalOverride[1]:(null===x||void 0===x?void 0:x[I.vertexIdx+1])??0,C=I.localNormalOverride?I.localNormalOverride[2]:(null===x||void 0===x?void 0:x[I.vertexIdx+2])??0,X=L+((z.localNormalOverride?z.localNormalOverride[0]:(null===x||void 0===x?void 0:x[z.vertexIdx])??0)-L)*h,u=F+((z.localNormalOverride?z.localNormalOverride[1]:(null===x||void 0===x?void 0:x[z.vertexIdx+1])??0)-F)*h,G=C+((z.localNormalOverride?z.localNormalOverride[2]:(null===x||void 0===x?void 0:x[z.vertexIdx+2])??0)-C)*h,y=Math.sqrt(X*X+u*u+G*G);return new D(e.LE.Lerp(I.position,z.position,h),e.LE.Lerp(I.normal,z.normal,h).normalize(),e.Vector2.Lerp(I.uv,z.uv,h),-1,-1,q?[R+(Z-R)*h,P+(c-P)*h,o+(K-o)*h]:null,x?[X/y,u/y,G/y]:null,t,U)};let h=null;I.length>3&&(h=[]);for(let t=0;t<I.length;t+=3){let w=0,U=null,R=null,P=null,o=null;const Z=e.LE.Dot(I[t].position,E)-j>0,c=e.LE.Dot(I[t+1].position,E)-j>0,K=e.LE.Dot(I[t+2].position,E)-j>0;switch(w=(Z?1:0)+(c?1:0)+(K?1:0),w){case 0:I.length>3?(h.push(I[t]),h.push(I[t+1]),h.push(I[t+2])):h=I;break;case 1:if(h=h??new Array,Z&&(U=I[t+1],R=I[t+2],P=z(I[t],U),o=z(I[t],R)),c){U=I[t],R=I[t+2],P=z(I[t+1],U),o=z(I[t+1],R),h.push(P),h.push(R.clone()),h.push(U.clone()),h.push(R.clone()),h.push(P.clone()),h.push(o);break}K&&(U=I[t],R=I[t+1],P=z(I[t+2],U),o=z(I[t+2],R)),U&&R&&P&&o&&(h.push(U.clone()),h.push(R.clone()),h.push(P),h.push(o),h.push(P.clone()),h.push(R.clone()));break;case 2:h=h??new Array,Z||(U=I[t].clone(),R=z(U,I[t+1]),P=z(U,I[t+2]),h.push(U),h.push(R),h.push(P)),c||(U=I[t+1].clone(),R=z(U,I[t+2]),P=z(U,I[t]),h.push(U),h.push(R),h.push(P)),K||(U=I[t+2].clone(),R=z(U,I[t]),P=z(U,I[t+1]),h.push(U),h.push(R),h.push(P))}}return h},W=E instanceof w.d?E:null,O=null===W||void 0===W?void 0:W._thinInstanceDataStorage.matrixData,k=(null===W||void 0===W?void 0:W.Rh)||1,J=e.TmpVectors.Matrix[0];J.U(e.Matrix.IdentityReadOnly);for(let w=0;w<k;++w){if(null!==W&&void 0!==W&&W.hasThinInstances&&O){const I=16*w;J.setRowFromFloats(0,O[I+0],O[I+1],O[I+2],O[I+3]),J.setRowFromFloats(1,O[I+4],O[I+5],O[I+6],O[I+7]),J.setRowFromFloats(2,O[I+8],O[I+9],O[I+10],O[I+11]),J.setRowFromFloats(3,O[I+12],O[I+13],O[I+14],O[I+15])}const I=e.Matrix.RotationYawPitchRoll(r,H,i).multiply(e.Matrix.Translation(d.x,d.y,d.z)),z=e.Matrix.Invert(I),h=E.getWorldMatrix(),U=J.multiply(h).multiply(z),R=new Array(3);for(let E=0;E<F.length;E+=3){let I=R;if(I[0]=A(E,U),I[1]=A(E+1,U),I[2]=A(E+2,U),!(j.cullBackFaces&&-I[0].normal.z<=0&&-I[1].normal.z<=0&&-I[2].normal.z<=0)&&(I=M(I,v),I&&(I=M(I,V),I&&(I=M(I,f),I&&(I=M(I,S),I&&(I=M(I,B),I&&(I=M(I,p),I)))))))for(let E=0;E<I.length;E++){const e=I[E];if(g.indices.push(Y),L?(e.localPositionOverride?(g.dI[3*Y]=e.localPositionOverride[0],g.dI[3*Y+1]=e.localPositionOverride[1],g.dI[3*Y+2]=e.localPositionOverride[2]):q&&(g.dI[3*Y]=q[e.vertexIdx],g.dI[3*Y+1]=q[e.vertexIdx+1],g.dI[3*Y+2]=q[e.vertexIdx+2]),e.localNormalOverride?(g.aI[3*Y]=e.localNormalOverride[0],g.aI[3*Y+1]=e.localNormalOverride[1],g.aI[3*Y+2]=e.localNormalOverride[2]):x&&(g.aI[3*Y]=x[e.vertexIdx],g.aI[3*Y+1]=x[e.vertexIdx+1],g.aI[3*Y+2]=x[e.vertexIdx+2])):(e.position.toArray(g.dI,3*Y),e.normal.toArray(g.aI,3*Y)),g.matricesIndices&&g.matricesWeights&&(e.matrixIndicesOverride?(g.matricesIndices[4*Y]=e.matrixIndicesOverride[0],g.matricesIndices[4*Y+1]=e.matrixIndicesOverride[1],g.matricesIndices[4*Y+2]=e.matrixIndicesOverride[2],g.matricesIndices[4*Y+3]=e.matrixIndicesOverride[3]):(b&&(g.matricesIndices[4*Y]=b[e.vertexIdxForBones],g.matricesIndices[4*Y+1]=b[e.vertexIdxForBones+1],g.matricesIndices[4*Y+2]=b[e.vertexIdxForBones+2],g.matricesIndices[4*Y+3]=b[e.vertexIdxForBones+3]),G&&g.matricesIndicesExtra&&(g.matricesIndicesExtra[4*Y]=G[e.vertexIdxForBones],g.matricesIndicesExtra[4*Y+1]=G[e.vertexIdxForBones+1],g.matricesIndicesExtra[4*Y+2]=G[e.vertexIdxForBones+2],g.matricesIndicesExtra[4*Y+3]=G[e.vertexIdxForBones+3])),e.matrixWeightsOverride?(g.matricesWeights[4*Y]=e.matrixWeightsOverride[0],g.matricesWeights[4*Y+1]=e.matrixWeightsOverride[1],g.matricesWeights[4*Y+2]=e.matrixWeightsOverride[2],g.matricesWeights[4*Y+3]=e.matrixWeightsOverride[3]):(Q&&(g.matricesWeights[4*Y]=Q[e.vertexIdxForBones],g.matricesWeights[4*Y+1]=Q[e.vertexIdxForBones+1],g.matricesWeights[4*Y+2]=Q[e.vertexIdxForBones+2],g.matricesWeights[4*Y+3]=Q[e.vertexIdxForBones+3]),y&&g.matricesWeightsExtra&&(g.matricesWeightsExtra[4*Y]=y[e.vertexIdxForBones],g.matricesWeightsExtra[4*Y+1]=y[e.vertexIdxForBones+1],g.matricesWeightsExtra[4*Y+2]=y[e.vertexIdxForBones+2],g.matricesWeightsExtra[4*Y+3]=y[e.vertexIdxForBones+3]))),j.captureUVS)e.uv.toArray(g.iI,2*Y);else{g.iI.push(.5+e.position.x/l.x);const I=.5+e.position.y/l.y;g.iI.push(t.b?1-I:I)}Y++}}}0===g.indices.length&&(g.indices=null),0===g.dI.length&&(g.dI=null),0===g.aI.length&&(g.aI=null),0===g.iI.length&&(g.iI=null),0===(null===(R=g.matricesIndices)||void 0===R?void 0:R.length)&&(g.matricesIndices=null),0===(null===(P=g.matricesWeights)||void 0===P?void 0:P.length)&&(g.matricesWeights=null),0===(null===(o=g.matricesIndicesExtra)||void 0===o?void 0:o.length)&&(g.matricesIndicesExtra=null),0===(null===(Z=g.matricesWeightsExtra)||void 0===Z?void 0:Z.length)&&(g.matricesWeightsExtra=null);const N=new w.d(I,E.GI());return g.nI(N),L?(N.skeleton=E.skeleton,N.parent=E):(N.position=d.clone(),N.rotation=new e.LE(H,r,i)),N.Be(!0),N.refreshBoundingInfo(!0,!0),N}function J(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const E=0|Math.max(I.subdivisions?I.subdivisions:2,1),j=0|Math.max(I.tessellation?I.tessellation:16,3),w=Math.max(I.height?I.height:1,0),z=Math.max(I.radius?I.radius:.25,0),U=0|Math.max(I.capSubdivisions?I.capSubdivisions:6,1),R=j,P=E,o=Math.max(I.radiusTop?I.radiusTop:z,0),Z=Math.max(I.radiusBottom?I.radiusBottom:z,0),c=w-(o+Z),K=2*Math.PI,L=Math.max(I.topCapSubdivisions?I.topCapSubdivisions:U,1),F=Math.max(I.bottomCapSubdivisions?I.bottomCapSubdivisions:U,1),C=Math.acos((Z-o)/w);let X=[];const q=[],x=[],u=[];let b=0;const Q=[],G=.5*c,y=.5*Math.PI;let d,a;const l=e.LE.Zero(),i=e.LE.Zero(),r=Math.cos(C),n=Math.sin(C),H=new e.Vector2(o*n,G+o*r).FE(new e.Vector2(Z*n,Z*r-G)).length(),g=o*C+H+Z*(y-C);let Y=0;for(a=0;a<=L;a++){const I=[],E=y-C*(a/L);Y+=o*C/L;const j=Math.cos(E),e=Math.sin(E),w=j*o;for(d=0;d<=R;d++){const E=d/R,z=E*K+0,h=Math.sin(z),U=Math.cos(z);i.x=w*h,i.y=G+e*o,i.z=w*U,q.push(i.x,i.y,i.z),l.set(j*h,e,j*U),x.push(l.x,l.y,l.z),u.push(E,t.b?Y/g:1-Y/g),I.push(b),b++}Q.push(I)}const A=w-o-Z+r*o-r*Z,T=n*(Z-o)/A;for(a=1;a<=P;a++){const I=[];Y+=H/P;const E=n*(a*(Z-o)/P+o);for(d=0;d<=R;d++){const j=d/R,e=j*K+0,w=Math.sin(e),z=Math.cos(e);i.x=E*w,i.y=G+r*o-a*A/P,i.z=E*z,q.push(i.x,i.y,i.z),l.set(w,T,z).normalize(),x.push(l.x,l.y,l.z),u.push(j,t.b?Y/g:1-Y/g),I.push(b),b++}Q.push(I)}for(a=1;a<=F;a++){const I=[],E=y-C-(Math.PI-C)*(a/F);Y+=Z*C/F;const j=Math.cos(E),e=Math.sin(E),w=j*Z;for(d=0;d<=R;d++){const E=d/R,z=E*K+0,h=Math.sin(z),U=Math.cos(z);i.x=w*h,i.y=e*Z-G,i.z=w*U,q.push(i.x,i.y,i.z),l.set(j*h,e,j*U),x.push(l.x,l.y,l.z),u.push(E,t.b?Y/g:1-Y/g),I.push(b),b++}Q.push(I)}for(d=0;d<R;d++)for(a=0;a<L+P+F;a++){const I=Q[a][d],E=Q[a+1][d],j=Q[a+1][d+1],e=Q[a][d+1];X.push(I),X.push(E),X.push(e),X.push(E),X.push(j),X.push(e)}if(X=X.reverse(),I.orientation&&!I.orientation.equals(e.LE.Up())){const E=new e.Matrix;I.orientation.clone().scale(.5*Math.PI).cross(e.LE.Up()).toQuaternion().toRotationMatrix(E);const j=e.LE.Zero();for(let I=0;I<q.length;I+=3)j.set(q[I],q[I+1],q[I+2]),e.LE.TransformCoordinatesToRef(j.clone(),E,j),q[I]=j.x,q[I+1]=j.y,q[I+2]=j.z}const M=new h.b;return M.dI=q,M.aI=x,M.iI=u,M.indices=X,M}function N(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:e.LE.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new w.d(I,j);return J(E).nI(z,E.updatable),z}w.d.CreateDecal=(I,E,j,e,w,z)=>k(I,E,{position:j,normal:e,size:w,angle:z});w.d.CreateCapsule=(I,E,j)=>N(I,E,j),h.b.CreateCapsule=J;var m=j(10974),II=j(11120);class EI{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=I,this.y=E,I!==Math.floor(I)&&(I=Math.floor(I),m.b.Warn("x is not an integer, floor(x) used")),E!==Math.floor(E)&&(E=Math.floor(E),m.b.Warn("y is not an integer, floor(y) used"))}clone(){return new EI(this.x,this.y)}rotate60About(I){const E=this.x;return this.x=I.x+I.y-this.y,this.y=E+this.y-I.x,this}rotateNeg60About(I){const E=this.x;return this.x=E+this.y-I.y,this.y=I.x+I.y-E,this}rotate120(I,E){I!==Math.floor(I)&&(I=Math.floor(I),m.b.Warn("m not an integer only floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),m.b.Warn("n not an integer only floor(n) used"));const j=this.x;return this.x=I-j-this.y,this.y=E+j,this}rotateNeg120(I,E){I!==Math.floor(I)&&(I=Math.floor(I),m.b.Warn("m is not an integer, floor(m) used")),E!==Math.floor(E)&&(E=Math.floor(E),m.b.Warn("n is not an integer,   floor(n) used"));const j=this.x;return this.x=this.y-E,this.y=I+E-j-this.y,this}toCartesianOrigin(I,E){const j=e.LE.Zero();return j.x=I.x+2*this.x*E+this.y*E,j.y=I.y+Math.sqrt(3)*this.y*E,j}static Zero(){return new EI(0,0)}}class jI{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new eI("icosahedron","Regular",[[0,II.f,-1],[-II.f,1,0],[-1,0,-II.f],[1,0,-II.f],[II.f,1,0],[0,II.f,1],[-1,0,II.f],[-II.f,-1,0],[0,-II.f,-1],[II.f,-1,0],[1,0,II.f],[0,-II.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let I=12;const E={},j=this.m,e=this.n;let w,z,h,t,U,R=j,P=1,o=0;0!==e&&(R=(0,s.HighestCommonFactor)(j,e)),P=j/R,o=e/R;const Z=EI.Zero(),c=new EI(j,e),K=new EI(-e,j+e),L=EI.Zero(),F=EI.Zero(),C=EI.Zero();let X,q,x,u,b=[];const Q=[],G=this.vertByDist,y=(j,e,w,z)=>{X=j+"|"+w,q=e+"|"+z,X in E||q in E?X in E&&!(q in E)?E[q]=E[X]:q in E&&!(X in E)&&(E[X]=E[q]):(E[X]=I,E[q]=I,I++),G[w][0]>2?Q[E[X]]=[-G[w][0],G[w][1],E[X]]:Q[E[X]]=[b[G[w][0]],G[w][1],E[X]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let d=0;d<20;d++){if(b=this.IDATA.face[d],h=b[2],t=b[1],U=b[0],x=Z.x+"|"+Z.y,X=d+"|"+x,X in E||(E[X]=h,Q[h]=[b[G[x][0]],G[x][1]]),x=c.x+"|"+c.y,X=d+"|"+x,X in E||(E[X]=t,Q[t]=[b[G[x][0]],G[x][1]]),x=K.x+"|"+K.y,X=d+"|"+x,X in E||(E[X]=U,Q[U]=[b[G[x][0]],G[x][1]]),w=this.IDATA.edgematch[d][0],z=this.IDATA.edgematch[d][1],"B"===z)for(let I=1;I<R;I++)F.x=j-I*(P+o),F.y=e+I*P,C.x=-I*o,C.y=I*(P+o),x=F.x+"|"+F.y,u=C.x+"|"+C.y,y(d,w,x,u);if("O"===z)for(let I=1;I<R;I++)C.x=-I*o,C.y=I*(P+o),L.x=I*P,L.y=I*o,x=C.x+"|"+C.y,u=L.x+"|"+L.y,y(d,w,x,u);if(w=this.IDATA.edgematch[d][2],z=this.IDATA.edgematch[d][3],z&&"A"===z)for(let I=1;I<R;I++)L.x=I*P,L.y=I*o,F.x=j-(R-I)*(P+o),F.y=e+(R-I)*P,x=L.x+"|"+L.y,u=F.x+"|"+F.y,y(d,w,x,u);for(let j=0;j<this.vertices.length;j++)x=this.vertices[j].x+"|"+this.vertices[j].y,X=d+"|"+x,X in E||(E[X]=I++,G[x][0]>2?Q[E[X]]=[-G[x][0],G[x][1],E[X]]:Q[E[X]]=[b[G[x][0]],G[x][1],E[X]])}this.closestTo=Q,this.vecToidx=E}calcCoeffs(){const I=this.m,E=this.n,j=Math.sqrt(3)/3,e=I*I+E*E+I*E;this.coau=(I+E)/e,this.cobu=-E/e,this.coav=-j*(I-E)/e,this.cobv=j*(2*I+E)/e}createInnerFacets(){const I=this.m,E=this.n;for(let j=0;j<E+I+1;j++)for(let I=this.min[j];I<this.max[j]+1;I++)I<this.max[j]&&I<this.max[j+1]+1&&this.innerFacets.push(["|"+I+"|"+j,"|"+I+"|"+(j+1),"|"+(I+1)+"|"+j]),j>0&&I<this.max[j-1]&&I+1<this.max[j]+1&&this.innerFacets.push(["|"+I+"|"+j,"|"+(I+1)+"|"+j,"|"+(I+1)+"|"+(j-1)])}edgeVecsABOB(){const I=this.m,E=this.n,j=new EI(-E,I+E);for(let e=1;e<I+E;e++){const I=new EI(this.min[e],e),E=new EI(this.min[e-1],e-1),w=new EI(this.min[e+1],e+1),z=I.clone(),h=E.clone(),t=w.clone();z.rotate60About(j),h.rotate60About(j),t.rotate60About(j);const U=new EI(this.max[z.y],z.y),R=new EI(this.max[z.y-1],z.y-1),P=new EI(this.max[z.y-1]-1,z.y-1);z.x===U.x&&z.y===U.y||(z.x!==R.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,R,P]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,P,U])):z.y===t.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,E,R]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([I,R,w])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([I,E,R]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([I,R,U])))}}mapABOBtoOBOA(){const I=new EI(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const j=[];for(let e=0;e<3;e++)I.x=this.isoVecsABOB[E][e].x,I.y=this.isoVecsABOB[E][e].y,0===this.vertexTypes[E][e]&&I.rotateNeg120(this.m,this.n),j.push(I.clone());this.isoVecsOBOA.push(j)}}mapABOBtoBAOA(){const I=new EI(0,0);for(let E=0;E<this.isoVecsABOB.length;E++){const j=[];for(let e=0;e<3;e++)I.x=this.isoVecsABOB[E][e].x,I.y=this.isoVecsABOB[E][e].y,1===this.vertexTypes[E][e]&&I.rotate120(this.m,this.n),j.push(I.clone());this.isoVecsBAOA.push(j)}}MapToFace(I,E){const j=this.IDATA.face[I],w=j[2],z=j[1],h=j[0],t=e.LE.xE(this.IDATA.vertex[w]),U=e.LE.xE(this.IDATA.vertex[z]),R=e.LE.xE(this.IDATA.vertex[h]),P=U.FE(t),o=R.FE(t),Z=P.scale(this.coau).add(o.scale(this.cobu)),c=P.scale(this.coav).add(o.scale(this.cobv)),K=[];let L,F=e.TmpVectors.LE[0];for(let e=0;e<this.cartesian.length;e++)F=Z.scale(this.cartesian[e].x).add(c.scale(this.cartesian[e].y)).add(t),K[e]=[F.x,F.y,F.z],L=I+"|"+this.vertices[e].x+"|"+this.vertices[e].y,E.vertex[this.vecToidx[L]]=[F.x,F.y,F.z]}build(I,E){const j=[],e=EI.Zero(),w=new EI(I,E),z=new EI(-E,I+E);j.push(e,w,z);for(let x=E;x<I+1;x++)for(let E=0;E<I+1-x;E++)j.push(new EI(E,x));if(E>0){const e=(0,s.HighestCommonFactor)(I,E),w=I/e,z=E/e;for(let t=1;t<e;t++)j.push(new EI(t*w,t*z)),j.push(new EI(-t*z,t*(w+z))),j.push(new EI(I-t*(w+z),E+t*w));const h=I/E;for(let t=1;t<E;t++)for(let e=0;e<t*h;e++)j.push(new EI(e,t)),j.push(new EI(e,t).rotate120(I,E)),j.push(new EI(e,t).rotateNeg120(I,E))}j.sort(((I,E)=>I.x-E.x)),j.sort(((I,E)=>I.y-E.y));const h=new Array(I+E+1),t=new Array(I+E+1);for(let x=0;x<h.length;x++)h[x]=1/0,t[x]=-1/0;let U=0,R=0;const P=j.length;for(let x=0;x<P;x++)R=j[x].x,U=j[x].y,h[U]=Math.min(R,h[U]),t[U]=Math.max(R,t[U]);const o=(j,e)=>{const w=j.clone();return"A"===e&&w.rotateNeg120(I,E),"B"===e&&w.rotate120(I,E),w.x<0?w.y:w.x+w.y},Z=[],c=[],K=[],L=[],F={},C=[];let X=-1,q=-1;for(let x=0;x<P;x++)Z[x]=j[x].toCartesianOrigin(new EI(0,0),.5),c[x]=o(j[x],"O"),K[x]=o(j[x],"A"),L[x]=o(j[x],"B"),c[x]===K[x]&&K[x]===L[x]?(X=3,q=c[x]):c[x]===K[x]?(X=4,q=c[x]):K[x]===L[x]?(X=5,q=K[x]):L[x]===c[x]&&(X=6,q=c[x]),c[x]<K[x]&&c[x]<L[x]&&(X=2,q=c[x]),K[x]<c[x]&&K[x]<L[x]&&(X=1,q=K[x]),L[x]<K[x]&&L[x]<c[x]&&(X=0,q=L[x]),C.push([X,q,j[x].x,j[x].y]);C.sort(((I,E)=>I[2]-E[2])),C.sort(((I,E)=>I[3]-E[3])),C.sort(((I,E)=>I[1]-E[1])),C.sort(((I,E)=>I[0]-E[0]));for(let x=0;x<C.length;x++)F[C[x][2]+"|"+C[x][3]]=[C[x][0],C[x][1],x];return this.m=I,this.n=E,this.vertices=j,this.vertByDist=F,this.cartesian=Z,this.min=h,this.max=t,this}}class eI{constructor(I,E,j,e){this.name=I,this.category=E,this.vertex=j,this.face=e}}class wI extends eI{innerToData(I,E){for(let j=0;j<E.innerFacets.length;j++)this.face.push(E.innerFacets[j].map((j=>E.vecToidx[I+j])))}mapABOBtoDATA(I,E){const j=E.IDATA.edgematch[I][0];for(let e=0;e<E.isoVecsABOB.length;e++){const w=[];for(let z=0;z<3;z++)0===E.vertexTypes[e][z]?w.push(I+"|"+E.isoVecsABOB[e][z].x+"|"+E.isoVecsABOB[e][z].y):w.push(j+"|"+E.isoVecsABOB[e][z].x+"|"+E.isoVecsABOB[e][z].y);this.face.push([E.vecToidx[w[0]],E.vecToidx[w[1]],E.vecToidx[w[2]]])}}mapOBOAtoDATA(I,E){const j=E.IDATA.edgematch[I][0];for(let e=0;e<E.isoVecsOBOA.length;e++){const w=[];for(let z=0;z<3;z++)1===E.vertexTypes[e][z]?w.push(I+"|"+E.isoVecsOBOA[e][z].x+"|"+E.isoVecsOBOA[e][z].y):w.push(j+"|"+E.isoVecsOBOA[e][z].x+"|"+E.isoVecsOBOA[e][z].y);this.face.push([E.vecToidx[w[0]],E.vecToidx[w[1]],E.vecToidx[w[2]]])}}mapBAOAtoDATA(I,E){const j=E.IDATA.edgematch[I][2];for(let e=0;e<E.isoVecsBAOA.length;e++){const w=[];for(let z=0;z<3;z++)1===E.vertexTypes[e][z]?w.push(I+"|"+E.isoVecsBAOA[e][z].x+"|"+E.isoVecsBAOA[e][z].y):w.push(j+"|"+E.isoVecsBAOA[e][z].x+"|"+E.isoVecsBAOA[e][z].y);this.face.push([E.vecToidx[w[0]],E.vecToidx[w[1]],E.vecToidx[w[2]]])}}orderData(I){const E=[];for(let z=0;z<13;z++)E[z]=[];const j=I.closestTo;for(let z=0;z<j.length;z++)j[z][0]>-1?j[z][1]>0&&E[j[z][0]].push([z,j[z][1]]):E[12].push([z,j[z][0]]);const e=[];for(let z=0;z<12;z++)e[z]=z;let w=12;for(let z=0;z<12;z++){E[z].sort(((I,E)=>I[1]-E[1]));for(let I=0;I<E[z].length;I++)e[E[z][I][0]]=w++}for(let z=0;z<E[12].length;z++)e[E[12][z][0]]=w++;for(let z=0;z<this.vertex.length;z++)this.vertex[z].push(e[z]);this.vertex.sort(((I,E)=>I[3]-E[3]));for(let z=0;z<this.vertex.length;z++)this.vertex[z].pop();for(let z=0;z<this.face.length;z++)for(let I=0;I<this.face[z].length;I++)this.face[z][I]=e[this.face[z][I]];this.sharedNodes=E[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(I,E){const j=[],e=[];let w=E.pop();e.push(w);let z=this.face[w].indexOf(I);z=(z+2)%3;let h=this.face[w][z];j.push(h);let t=0;for(;E.length>0;)w=E[t],this.face[w].indexOf(h)>-1?(z=(this.face[w].indexOf(h)+1)%3,h=this.face[w][z],j.push(h),e.push(w),E.splice(t,1),t=0):t++;return this.adjacentFaces.push(j),e}toGoldbergPolyhedronData(){const I=new eI("GeoDual","Goldberg",[],[]);I.name="GD dual";const E=this.vertex.length,j=new Array(E);for(let U=0;U<E;U++)j[U]=[];for(let U=0;U<this.face.length;U++)for(let I=0;I<3;I++)j[this.face[U][I]].push(U);let e=0,w=0,z=0,h=[],t=[];this.adjacentFaces=[];for(let U=0;U<j.length;U++){I.face[U]=this.setOrder(U,j[U].concat([]));for(const E of j[U]){e=0,w=0,z=0,h=this.face[E];for(let I=0;I<3;I++)t=this.vertex[h[I]],e+=t[0],w+=t[1],z+=t[2];I.vertex[E]=[e/3,w/3,z/3]}}return I}static BuildGeodesicData(I){const E=new wI("Geodesic-m-n","Geodesic",[[0,II.f,-1],[-II.f,1,0],[-1,0,-II.f],[1,0,-II.f],[II.f,1,0],[0,II.f,1],[-1,0,II.f],[-II.f,-1,0],[0,-II.f,-1],[II.f,-1,0],[1,0,II.f],[0,-II.f,1]],[]);I.setIndices(),I.calcCoeffs(),I.createInnerFacets(),I.edgeVecsABOB(),I.mapABOBtoOBOA(),I.mapABOBtoBAOA();for(let j=0;j<I.IDATA.face.length;j++)I.MapToFace(j,E),E.innerToData(j,I),"B"===I.IDATA.edgematch[j][1]&&E.mapABOBtoDATA(j,I),"O"===I.IDATA.edgematch[j][1]&&E.mapOBOAtoDATA(j,I),"A"===I.IDATA.edgematch[j][3]&&E.mapBAOAtoDATA(j,I);E.orderData(I);return E.vertex=E.vertex.map((function(I){const E=I[0],j=I[1],e=I[2],w=Math.sqrt(E*E+j*j+e*e);return I[0]*=1/w,I[1]*=1/w,I[2]*=1/w,I})),E}}w.d._GoldbergMeshParser=(I,E)=>zI.Parse(I,E);class zI extends w.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(I,E){return void 0===E?(I>this.goldbergData.nbUnsharedFaces-1&&(m.b.Warn("Maximum number of unshared faces used"),I=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+I):(I>11&&(m.b.Warn("Last pole used"),I=11),E>this.goldbergData.nbFacesAtPole-1&&(m.b.Warn("Maximum number of faces at a pole used"),E=this.goldbergData.nbFacesAtPole-1),12+I*this.goldbergData.nbFacesAtPole+E)}_changeGoldbergFaceColors(I){for(let j=0;j<I.length;j++){const E=I[j][0],e=I[j][1],w=I[j][2];for(let I=E;I<e+1;I++)this.goldbergData.faceColors[I]=w}const E=[];for(let j=0;j<12;j++)for(let I=0;I<5;I++)E.push(this.goldbergData.faceColors[j].r,this.goldbergData.faceColors[j].g,this.goldbergData.faceColors[j].b,this.goldbergData.faceColors[j].a);for(let j=12;j<this.goldbergData.faceColors.length;j++)for(let I=0;I<6;I++)E.push(this.goldbergData.faceColors[j].r,this.goldbergData.faceColors[j].g,this.goldbergData.faceColors[j].b,this.goldbergData.faceColors[j].a);return E}setGoldbergFaceColors(I){const E=this._changeGoldbergFaceColors(I);this.AI(z.e.ColorKind,E)}updateGoldbergFaceColors(I){const E=this._changeGoldbergFaceColors(I);this.updateVerticesData(z.e.ColorKind,E)}_changeGoldbergFaceUVs(I){const E=this.getVerticesData(z.e.UVKind);for(let j=0;j<I.length;j++){const e=I[j][0],w=I[j][1],z=I[j][2],h=I[j][3],t=I[j][4],U=[],R=[];let P,o;for(let I=0;I<5;I++)P=z.x+h*Math.cos(t+I*Math.PI/2.5),o=z.y+h*Math.sin(t+I*Math.PI/2.5),P<0&&(P=0),P>1&&(P=1),U.push(P,o);for(let I=0;I<6;I++)P=z.x+h*Math.cos(t+I*Math.PI/3),o=z.y+h*Math.sin(t+I*Math.PI/3),P<0&&(P=0),P>1&&(P=1),R.push(P,o);for(let I=e;I<Math.min(12,w+1);I++)for(let j=0;j<5;j++)E[10*I+2*j]=U[2*j],E[10*I+2*j+1]=U[2*j+1];for(let I=Math.max(12,e);I<w+1;I++)for(let j=0;j<6;j++)E[12*I-24+2*j]=R[2*j],E[12*I-23+2*j]=R[2*j+1]}return E}setGoldbergFaceUVs(I){const E=this._changeGoldbergFaceUVs(I);this.AI(z.e.UVKind,E)}updateGoldbergFaceUVs(I){const E=this._changeGoldbergFaceUVs(I);this.updateVerticesData(z.e.UVKind,E)}placeOnGoldbergFaceAt(I,E,j){const w=e.LE.RotationFromAxis(this.goldbergData.faceXaxis[E],this.goldbergData.faceYaxis[E],this.goldbergData.faceZaxis[E]);I.rotation=w,I.position=this.goldbergData.faceCenters[E].add(this.goldbergData.faceXaxis[E].scale(j.x)).add(this.goldbergData.faceYaxis[E].scale(j.y)).add(this.goldbergData.faceZaxis[E].scale(j.z))}serialize(I){super.serialize(I),I.type="GoldbergMesh";const E={};if(E.adjacentFaces=this.goldbergData.adjacentFaces,E.nbSharedFaces=this.goldbergData.nbSharedFaces,E.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,E.nbFaces=this.goldbergData.nbFaces,E.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){E.faceColors=[];for(const I of this.goldbergData.faceColors)E.faceColors.push(I.re())}if(this.goldbergData.faceCenters){E.faceCenters=[];for(const I of this.goldbergData.faceCenters)E.faceCenters.push(I.re())}if(this.goldbergData.faceZaxis){E.faceZaxis=[];for(const I of this.goldbergData.faceZaxis)E.faceZaxis.push(I.re())}if(this.goldbergData.faceYaxis){E.faceYaxis=[];for(const I of this.goldbergData.faceYaxis)E.faceYaxis.push(I.re())}if(this.goldbergData.faceXaxis){E.faceXaxis=[];for(const I of this.goldbergData.faceXaxis)E.faceXaxis.push(I.re())}I.goldbergData=E}static Parse(I,E){const j=I.goldbergData;j.faceColors=j.faceColors.map((I=>Z.hh.xE(I))),j.faceCenters=j.faceCenters.map((I=>e.LE.xE(I))),j.faceZaxis=j.faceZaxis.map((I=>e.LE.xE(I))),j.faceXaxis=j.faceXaxis.map((I=>e.LE.xE(I))),j.faceYaxis=j.faceYaxis.map((I=>e.LE.xE(I)));const w=new zI(I.name,E);return w.goldbergData=j,w}}var hI=j(11656);const tI={CreateBox:o.c,CreateTiledBox:F,CreateSphere:C.e,CreateDisc:P.e,CreateIcoSphere:O,CreateRibbon:R,CreateCylinder:u,CreateTorus:Q,CreateTorusKnot:y,CreateLineSystem:d.d,yR:d.e,CreateDashedLines:d.c,ExtrudeShape:i,ExtrudeShapeCustom:r,CreateLathe:H,CreateTiledPlane:K,lR:g.e,CreateGround:Y.h,CreateTiledGround:Y.l,CreateGroundFromHeightMap:Y.d,CreatePolygon:a.b,ExtrudePolygon:a.f,CreateTube:A,CreatePolyhedron:M,CreateGeodesic:function(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=E.m||1;e!==Math.floor(e)&&(e=Math.floor(e),m.b.Warn("m not an integer only floor(m) used"));let w=E.n||0;if(w!==Math.floor(w)&&(w=Math.floor(w),m.b.Warn("n not an integer only floor(n) used")),w>e){const I=w;w=e,e=I,m.b.Warn("n > m therefore m and n swapped")}const z=new jI;return z.build(e,w),M(I,{custom:wI.BuildGeodesicData(z),size:E.size,sizeX:E.sizeX,sizeY:E.sizeY,sizeZ:E.sizeZ,faceUV:E.faceUV,faceColors:E.faceColors,flat:E.flat,updatable:E.updatable,sideOrientation:E.sideOrientation,frontUVs:E.frontUVs,backUVs:E.backUVs},j)},CreateGoldberg:function(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=E.size,U=E.sizeX||z||1,R=E.sizeY||z||1,P=E.sizeZ||z||1;let o=E.m||1;o!==Math.floor(o)&&(o=Math.floor(o),m.b.Warn("m not an integer only floor(m) used"));let c=E.n||0;if(c!==Math.floor(c)&&(c=Math.floor(c),m.b.Warn("n not an integer only floor(n) used")),c>o){const I=c;c=o,o=I,m.b.Warn("n > m therefore m and n swapped")}const K=new jI;K.build(o,c);const L=wI.BuildGeodesicData(K),F=L.toGoldbergPolyhedronData(),C=new zI(I,j);E.sideOrientation=w.d._GetDefaultSideOrientation(E.sideOrientation),C._originalBuilderSideOrientation=E.sideOrientation;(function(I,E){const j=I.size,w=I.sizeX||j||1,z=I.sizeY||j||1,U=I.sizeZ||j||1,R=0===I.sideOrientation?0:I.sideOrientation||h.b.DEFAULTSIDE,P=[],o=[],Z=[],c=[];let K=1/0,L=-1/0,F=1/0,C=-1/0;for(let e=0;e<E.vertex.length;e++)K=Math.min(K,E.vertex[e][0]*w),L=Math.max(L,E.vertex[e][0]*w),F=Math.min(F,E.vertex[e][1]*z),C=Math.max(C,E.vertex[e][1]*z);let X=0;for(let h=0;h<E.face.length;h++){const I=E.face[h],j=e.LE.xE(E.vertex[I[0]]),R=e.LE.xE(E.vertex[I[2]]),q=e.LE.xE(E.vertex[I[1]]),x=R.FE(j),u=q.FE(j),b=e.LE.Cross(u,x).normalize();for(let e=0;e<I.length;e++){Z.push(b.x,b.y,b.z);const j=E.vertex[I[e]];P.push(j[0]*w,j[1]*z,j[2]*U);const h=(j[1]*z-F)/(C-F);c.push((j[0]*w-K)/(L-K),t.b?1-h:h)}for(let E=0;E<I.length-2;E++)o.push(X,X+E+2,X+E+1);X+=I.length}h.b._ComputeSides(R,P,o,Z,c);const q=new h.b;return q.dI=P,q.indices=o,q.aI=Z,q.iI=c,q})(E,F).nI(C,E.updatable),C.goldbergData.nbSharedFaces=L.sharedNodes,C.goldbergData.nbUnsharedFaces=L.poleNodes,C.goldbergData.adjacentFaces=L.adjacentFaces,C.goldbergData.nbFaces=C.goldbergData.nbSharedFaces+C.goldbergData.nbUnsharedFaces,C.goldbergData.nbFacesAtPole=(C.goldbergData.nbUnsharedFaces-12)/12;for(let w=0;w<L.vertex.length;w++)C.goldbergData.faceCenters.push(e.LE.xE(L.vertex[w])),C.goldbergData.faceCenters[w].x*=U,C.goldbergData.faceCenters[w].y*=R,C.goldbergData.faceCenters[w].z*=P,C.goldbergData.faceColors.push(new Z.hh(1,1,1,1));for(let w=0;w<F.face.length;w++){const I=F.face[w],E=e.LE.xE(F.vertex[I[0]]),j=e.LE.xE(F.vertex[I[2]]),z=e.LE.xE(F.vertex[I[1]]),h=j.FE(E),t=z.FE(E),U=e.LE.Cross(t,h).normalize(),R=e.LE.Cross(t,U).normalize();C.goldbergData.faceXaxis.push(t.normalize()),C.goldbergData.faceYaxis.push(U),C.goldbergData.faceZaxis.push(R)}return C},CreateDecal:k,CreateCapsule:N,CreateText:hI.g}},12431:(I,E,j)=>{"use strict";j.d(E,{b:()=>tE});var e=j(11117),w=j(11491);class z extends w.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var h=j(11165),t=(j(11290),j(11073));class U{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this._targetStopDuration!==I&&(this._targetStopDuration=I)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){this._noiseTexture!==I&&(this._noiseTexture=I,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(I){this._isAnimationSheetEnabled!=I&&(this._isAnimationSheetEnabled=I,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(I){this._useLogarithmicDepth=I&&this.GI().getEngine().getCaps().fragmentDepthSupported}GI(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(I){switch(I){case U.BLENDMODE_MULTIPLYADD:return;case U.BLENDMODE_ADD:I=1;break;case U.BLENDMODE_ONEONE:I=6;break;case U.BLENDMODE_STANDARD:I=2;break;case U.BLENDMODE_MULTIPLY:I=4;break;case U.BLENDMODE_SUBTRACT:I=3}this._engine.setAlphaMode(I)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:e.LE.Zero()}set direction1(I){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=I)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:e.LE.Zero()}set direction2(I){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=I)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:e.LE.Zero()}set minEmitBox(I){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=I)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:e.LE.Zero()}set maxEmitBox(I){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=I)}get billboardMode(){return this._billboardMode}set billboardMode(I){this._billboardMode!==I&&(this._billboardMode=I,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(I){this._isBillboardBased!==I&&(this._isBillboardBased=I,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(I){this._attachImageProcessingConfiguration(I)}_attachImageProcessingConfiguration(I){I!==this._imageProcessingConfiguration&&(!I&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=I)}_reset(){}_removeGradientAndTexture(I,E,j){if(!E)return this;let e=0;for(const w of E){if(w.gradient===I){E.splice(e,1);break}e++}return j&&j.dispose(),this}constructor(I){this.animations=[],this.renderingGroupId=0,this.wE=e.LE.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new e.LE(10,10,10),this.onAnimationEnd=null,this.blendMode=U.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new e.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.bR=new e.LE(0,0,0),this._useLogarithmicDepth=!1,this.gravity=e.LE.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new h.hh(1,1,1,1),this.color2=new h.hh(1,1,1,1),this.colorDead=new h.hh(0,0,0,1),this.textureMask=new h.hh(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new z,this.id=I,this.name=I}createPointEmitter(I,E){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new e.LE(0,1,0),arguments.length>2&&void 0!==arguments[2]||new e.LE(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new e.LE(0,1,0),arguments.length>4&&void 0!==arguments[4]||new e.LE(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new e.LE(0,1,0),arguments.length>3&&void 0!==arguments[3]||new e.LE(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(I,E,j,e){throw new Error("Method not implemented.")}}U.BLENDMODE_ONEONE=0,U.BLENDMODE_STANDARD=1,U.BLENDMODE_ADD=2,U.BLENDMODE_MULTIPLY=3,U.BLENDMODE_MULTIPLYADD=4,U.BLENDMODE_SUBTRACT=-1,(0,t.h)("BABYLON.BaseParticleSystem",U);var R=j(11136),P=j(10978);class o{constructor(){this.direction1=new e.LE(0,1,0),this.direction2=new e.LE(0,1,0),this.minEmitBox=new e.LE(-.5,-.5,-.5),this.maxEmitBox=new e.LE(.5,.5,.5)}startDirectionFunction(I,E,j,w){const z=(0,R.RandomRange)(this.direction1.x,this.direction2.x),h=(0,R.RandomRange)(this.direction1.y,this.direction2.y),t=(0,R.RandomRange)(this.direction1.z,this.direction2.z);if(w)return E.x=z,E.y=h,void(E.z=t);e.LE.TransformNormalFromFloatsToRef(z,h,t,I,E)}startPositionFunction(I,E,j,w){const z=(0,R.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),h=(0,R.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),t=(0,R.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(w)return E.x=z,E.y=h,void(E.z=t);e.LE.TransformCoordinatesFromFloatsToRef(z,h,t,I,E)}clone(){const I=new o;return P.e.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2),I.setVector3("minEmitBox",this.minEmitBox),I.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3),I.addUniform("minEmitBox",3),I.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.re(),I.direction2=this.direction2.re(),I.minEmitBox=this.minEmitBox.re(),I.maxEmitBox=this.maxEmitBox.re(),I}parse(I){e.LE.FromArrayToRef(I.direction1,0,this.direction1),e.LE.FromArrayToRef(I.direction2,0,this.direction2),e.LE.FromArrayToRef(I.minEmitBox,0,this.minEmitBox),e.LE.FromArrayToRef(I.maxEmitBox,0,this.maxEmitBox)}}class Z{get radius(){return this._radius}set radius(I){this._radius=I,this._buildHeight()}get angle(){return this._angle}set angle(I){this._angle=I,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=j,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=E,this.radius=I}startDirectionFunction(I,E,j,w){w?e.TmpVectors.LE[0].U(j.jU).normalize():j.position.subtractToRef(I.getTranslation(),e.TmpVectors.LE[0]).normalize();const z=(0,R.RandomRange)(0,this.directionRandomizer),h=(0,R.RandomRange)(0,this.directionRandomizer),t=(0,R.RandomRange)(0,this.directionRandomizer);E.x=e.TmpVectors.LE[0].x+z,E.y=e.TmpVectors.LE[0].y+h,E.z=e.TmpVectors.LE[0].z+t,E.normalize()}startPositionFunction(I,E,j,w){const z=(0,R.RandomRange)(0,2*Math.PI);let h;this.emitFromSpawnPointOnly?h=1e-4:(h=(0,R.RandomRange)(0,this.heightRange),h=1-h*h);let t=this._radius-(0,R.RandomRange)(0,this._radius*this.radiusRange);t*=h;const U=t*Math.sin(z),P=t*Math.cos(z),o=h*this._height;if(w)return E.x=U,E.y=o,void(E.z=P);e.LE.TransformCoordinatesFromFloatsToRef(U,o,P,I,E)}clone(){const I=new Z(this._radius,this._angle,this.directionRandomizer);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setFloat2("radius",this._radius,this.radiusRange),I.setFloat("coneAngle",this._angle),I.setFloat2("height",this._height,this.heightRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",2),I.addUniform("coneAngle",1),I.addUniform("height",2),I.addUniform("directionRandomizer",1)}getEffectDefines(){let I="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(I+="\n#define CONEEMITTERSPAWNPOINT"),I}getClassName(){return"ConeParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this._radius,I.angle=this._angle,I.directionRandomizer=this.directionRandomizer,I.radiusRange=this.radiusRange,I.heightRange=this.heightRange,I.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,I}parse(I){this.radius=I.radius,this.angle=I.angle,this.directionRandomizer=I.directionRandomizer,this.radiusRange=void 0!==I.radiusRange?I.radiusRange:1,this.heightRange=void 0!==I.radiusRange?I.heightRange:1,this.emitFromSpawnPointOnly=void 0!==I.emitFromSpawnPointOnly&&I.emitFromSpawnPointOnly}}class c extends Z{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0);super(I,E),this.direction1=j,this.direction2=w}startDirectionFunction(I,E){const j=(0,R.RandomRange)(this.direction1.x,this.direction2.x),w=(0,R.RandomRange)(this.direction1.y,this.direction2.y),z=(0,R.RandomRange)(this.direction1.z,this.direction2.z);e.LE.TransformNormalFromFloatsToRef(j,w,z,I,E)}clone(){const I=new c(this.radius,this.angle,this.direction1,this.direction2);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.re(),I.direction2=this.direction2.re(),I}parse(I){super.parse(I),this.direction1.U(I.direction1),this.direction2.U(I.direction2)}}class K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=I,this.height=E,this.radiusRange=j,this.directionRandomizer=w,this._tempVector=e.LE.Zero()}startDirectionFunction(I,E,j,w,z){j.position.subtractToRef(I.getTranslation(),this._tempVector),this._tempVector.normalize(),e.LE.TransformNormalToRef(this._tempVector,z,this._tempVector);const h=(0,R.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let t=Math.atan2(this._tempVector.x,this._tempVector.z);t+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=h,this._tempVector.x=Math.sin(t),this._tempVector.z=Math.cos(t),this._tempVector.normalize(),w?E.U(this._tempVector):e.LE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I,E)}startPositionFunction(I,E,j,w){const z=(0,R.RandomRange)(-this.height/2,this.height/2),h=(0,R.RandomRange)(0,2*Math.PI),t=(0,R.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),U=Math.sqrt(t)*this.radius,P=U*Math.cos(h),o=U*Math.sin(h);w?E.nz(P,z,o):e.LE.TransformCoordinatesFromFloatsToRef(P,z,o,I,E)}clone(){const I=new K(this.radius,this.directionRandomizer);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.height=this.height,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.height=I.height,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class L extends K{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.LE(0,1,0);super(I,E,j),this.direction1=w,this.direction2=z}startDirectionFunction(I,E,j,w){const z=(0,R.RandomRange)(this.direction1.x,this.direction2.x),h=(0,R.RandomRange)(this.direction1.y,this.direction2.y),t=(0,R.RandomRange)(this.direction1.z,this.direction2.z);w?E.nz(z,h,t):e.LE.TransformNormalFromFloatsToRef(z,h,t,I,E)}clone(){const I=new L(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("height",this.height),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("height",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.re(),I.direction2=this.direction2.re(),I}parse(I){super.parse(I),e.LE.FromArrayToRef(I.direction1,0,this.direction1),e.LE.FromArrayToRef(I.direction2,0,this.direction2)}}class F{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=E,this.directionRandomizer=j}startDirectionFunction(I,E,j,w){const z=j.position.FE(I.getTranslation()).normalize(),h=(0,R.RandomRange)(0,this.directionRandomizer),t=(0,R.RandomRange)(0,this.directionRandomizer),U=(0,R.RandomRange)(0,this.directionRandomizer);z.x+=h,z.y+=t,z.z+=U,z.normalize(),w?E.U(z):e.LE.TransformNormalFromFloatsToRef(z.x,z.y,z.z,I,E)}startPositionFunction(I,E,j,w){const z=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),h=(0,R.RandomRange)(0,1),t=(0,R.RandomRange)(0,2*Math.PI),U=Math.acos(2*h-1),P=z*Math.cos(t)*Math.sin(U),o=z*Math.cos(U),Z=z*Math.sin(t)*Math.sin(U);w?E.nz(P,Math.abs(o),Z):e.LE.TransformCoordinatesFromFloatsToRef(P,Math.abs(o),Z,I,E)}clone(){const I=new F(this.radius,this.directionRandomizer);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class C{constructor(){this.direction1=new e.LE(0,1,0),this.direction2=new e.LE(0,1,0)}startDirectionFunction(I,E,j,w){const z=(0,R.RandomRange)(this.direction1.x,this.direction2.x),h=(0,R.RandomRange)(this.direction1.y,this.direction2.y),t=(0,R.RandomRange)(this.direction1.z,this.direction2.z);w?E.nz(z,h,t):e.LE.TransformNormalFromFloatsToRef(z,h,t,I,E)}startPositionFunction(I,E,j,w){w?E.nz(0,0,0):e.LE.TransformCoordinatesFromFloatsToRef(0,0,0,I,E)}clone(){const I=new C;return P.e.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.direction1=this.direction1.re(),I.direction2=this.direction2.re(),I}parse(I){e.LE.FromArrayToRef(I.direction1,0,this.direction1),e.LE.FromArrayToRef(I.direction2,0,this.direction2)}}class X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=I,this.radiusRange=E,this.directionRandomizer=j}startDirectionFunction(I,E,j,w){const z=j.position.FE(I.getTranslation()).normalize(),h=(0,R.RandomRange)(0,this.directionRandomizer),t=(0,R.RandomRange)(0,this.directionRandomizer),U=(0,R.RandomRange)(0,this.directionRandomizer);z.x+=h,z.y+=t,z.z+=U,z.normalize(),w?E.U(z):e.LE.TransformNormalFromFloatsToRef(z.x,z.y,z.z,I,E)}startPositionFunction(I,E,j,w){const z=this.radius-(0,R.RandomRange)(0,this.radius*this.radiusRange),h=(0,R.RandomRange)(0,1),t=(0,R.RandomRange)(0,2*Math.PI),U=Math.acos(2*h-1),P=z*Math.cos(t)*Math.sin(U),o=z*Math.cos(U),Z=z*Math.sin(t)*Math.sin(U);w?E.nz(P,o,Z):e.LE.TransformCoordinatesFromFloatsToRef(P,o,Z,I,E)}clone(){const I=new X(this.radius,this.directionRandomizer);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.radius=this.radius,I.radiusRange=this.radiusRange,I.directionRandomizer=this.directionRandomizer,I}parse(I){this.radius=I.radius,this.radiusRange=I.radiusRange,this.directionRandomizer=I.directionRandomizer}}class q extends X{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.LE(0,1,0),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0);super(I),this.direction1=E,this.direction2=j}startDirectionFunction(I,E){const j=(0,R.RandomRange)(this.direction1.x,this.direction2.x),w=(0,R.RandomRange)(this.direction1.y,this.direction2.y),z=(0,R.RandomRange)(this.direction1.z,this.direction2.z);e.LE.TransformNormalFromFloatsToRef(j,w,z,I,E)}clone(){const I=new q(this.radius,this.direction1,this.direction2);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setFloat("radius",this.radius),I.setFloat("radiusRange",this.radiusRange),I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("radius",1),I.addUniform("radiusRange",1),I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const I=super.serialize();return I.direction1=this.direction1.re(),I.direction2=this.direction2.re(),I}parse(I){super.parse(I),this.direction1.U(I.direction1),this.direction2.U(I.direction2)}}class x{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(I,E,j,w){const z=e.TmpVectors.LE[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,j,z);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,j,z);const I=e.TmpVectors.LE[1];z.subtractToRef(j.position,I),I.scaleToRef(1/j.lifeTime,z)}else z.set(0,0,0);w?E.U(z):e.LE.TransformNormalToRef(z,I,E)}startPositionFunction(I,E,j,w){const z=e.TmpVectors.LE[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,j,z):z.set(0,0,0),w?E.U(z):e.LE.TransformCoordinatesToRef(z,I,E)}clone(){const I=new x;return P.e.DeepCopy(this,I),I}applyToShader(I){}buildUniformLayout(I){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const I={};return I.type=this.getClassName(),I.particlePositionGenerator=this.particlePositionGenerator,I.particleDestinationGenerator=this.particleDestinationGenerator,I}parse(I){I.particlePositionGenerator&&(this.particlePositionGenerator=I.particlePositionGenerator),I.particleDestinationGenerator&&(this.particleDestinationGenerator=I.particleDestinationGenerator)}}var u=j(11197);class b{get mesh(){return this._mesh}set mesh(I){this._mesh!==I&&(this._mesh=I,I?(this._indices=I.me(),this._positions=I.getVerticesData(u.e.PositionKind),this._normals=I.getVerticesData(u.e.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=e.LE.Zero(),this._mesh=null,this.direction1=new e.LE(0,1,0),this.direction2=new e.LE(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=I}startDirectionFunction(I,E,j,w){if(this.useMeshNormalsForDirection&&this._normals)return void e.LE.TransformNormalToRef(this._storedNormal,I,E);const z=(0,R.RandomRange)(this.direction1.x,this.direction2.x),h=(0,R.RandomRange)(this.direction1.y,this.direction2.y),t=(0,R.RandomRange)(this.direction1.z,this.direction2.z);w?E.nz(z,h,t):e.LE.TransformNormalFromFloatsToRef(z,h,t,I,E)}startPositionFunction(I,E,j,w){if(!this._indices||!this._positions)return;const z=3*(Math.random()*(this._indices.length/3)|0),h=Math.random(),t=Math.random()*(1-h),U=1-h-t,R=this._indices[z],P=this._indices[z+1],o=this._indices[z+2],Z=e.TmpVectors.LE[0],c=e.TmpVectors.LE[1],K=e.TmpVectors.LE[2],L=e.TmpVectors.LE[3];e.LE.FromArrayToRef(this._positions,3*R,Z),e.LE.FromArrayToRef(this._positions,3*P,c),e.LE.FromArrayToRef(this._positions,3*o,K),L.x=h*Z.x+t*c.x+U*K.x,L.y=h*Z.y+t*c.y+U*K.y,L.z=h*Z.z+t*c.z+U*K.z,w?E.nz(L.x,L.y,L.z):e.LE.TransformCoordinatesFromFloatsToRef(L.x,L.y,L.z,I,E),this.useMeshNormalsForDirection&&this._normals&&(e.LE.FromArrayToRef(this._normals,3*R,Z),e.LE.FromArrayToRef(this._normals,3*P,c),e.LE.FromArrayToRef(this._normals,3*o,K),this._storedNormal.x=h*Z.x+t*c.x+U*K.x,this._storedNormal.y=h*Z.y+t*c.y+U*K.y,this._storedNormal.z=h*Z.z+t*c.z+U*K.z)}clone(){const I=new b(this.mesh);return P.e.DeepCopy(this,I),I}applyToShader(I){I.setVector3("direction1",this.direction1),I.setVector3("direction2",this.direction2)}buildUniformLayout(I){I.addUniform("direction1",3),I.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var I;const E={};return E.type=this.getClassName(),E.direction1=this.direction1.re(),E.direction2=this.direction2.re(),E.meshId=null===(I=this.mesh)||void 0===I?void 0:I.id,E.useMeshNormalsForDirection=this.useMeshNormalsForDirection,E}parse(I,E){e.LE.FromArrayToRef(I.direction1,0,this.direction1),e.LE.FromArrayToRef(I.direction2,0,this.direction2),I.meshId&&E&&(this.mesh=E.getLastMeshById(I.meshId)),this.useMeshNormalsForDirection=I.useMeshNormalsForDirection}}class Q{_isUbo(I){return void 0!==I.addUniform}constructor(I){this._isUbo(I)?(this.setMatrix3x3=I.updateMatrix3x3.bind(I),this.setMatrix2x2=I.updateMatrix2x2.bind(I),this.setFloat=I.updateFloat.bind(I),this.setFloat2=I.updateFloat2.bind(I),this.setFloat3=I.updateFloat3.bind(I),this.setFloat4=I.updateFloat4.bind(I),this.setFloatArray=I.updateFloatArray.bind(I),this.setArray=I.updateArray.bind(I),this.setIntArray=I.updateIntArray.bind(I),this.setMatrix=I.ve.bind(I),this.setMatrices=I.updateMatrices.bind(I),this.setVector3=I.updateVector3.bind(I),this.setVector4=I.updateVector4.bind(I),this.setColor3=I.updateColor3.bind(I),this.setColor4=I.updateColor4.bind(I),this.setDirectColor4=I.updateDirectColor4.bind(I),this.setInt=I.updateInt.bind(I),this.setInt2=I.updateInt2.bind(I),this.setInt3=I.updateInt3.bind(I),this.setInt4=I.updateInt4.bind(I)):(this.setMatrix3x3=I.setMatrix3x3.bind(I),this.setMatrix2x2=I.setMatrix2x2.bind(I),this.setFloat=I.setFloat.bind(I),this.setFloat2=I.setFloat2.bind(I),this.setFloat3=I.setFloat3.bind(I),this.setFloat4=I.setFloat4.bind(I),this.setFloatArray=I.setFloatArray.bind(I),this.setArray=I.setArray.bind(I),this.setIntArray=I.setIntArray.bind(I),this.setMatrix=I.setMatrix.bind(I),this.setMatrices=I.setMatrices.bind(I),this.setVector3=I.setVector3.bind(I),this.setVector4=I.setVector4.bind(I),this.setColor3=I.setColor3.bind(I),this.setColor4=I.setColor4.bind(I),this.setDirectColor4=I.setDirectColor4.bind(I),this.setInt=I.setInt.bind(I),this.setInt2=I.setInt2.bind(I),this.setInt3=I.setInt3.bind(I),this.setInt4=I.setInt4.bind(I))}}var G=j(11042);const y="gpuUpdateParticlesPixelShader",d="#version 300 es\nvoid main() {discard;}\n";G.e.ShadersStore[y]||(G.e.ShadersStore[y]=d);const a="gpuUpdateParticlesVertexShader",l="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";G.e.ShadersStore[a]||(G.e.ShadersStore[a]=l);(0,t.h)("BABYLON.WebGL2ParticleSystem",class{constructor(I,E){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=I,this._engine=E,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var I;return(null===(I=this._updateEffect)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof x&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=I,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new Q(this._updateEffect)}createVertexBuffers(I,E){this._updateVAO.push(this._createUpdateVAO(I)),this._renderVAO.push(this._engine.recordVertexArrayObject(E,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=E}createParticleBuffer(I){return I}bindDrawBuffers(I,E,j){j?this._engine.bindBuffers(this._renderVertexBuffers,j,E):this._engine.bindVertexArrayObject(this._renderVAO[I],null)}preUpdateParticleBuffer(){const I=this._engine;if(this._engine.enableEffect(this._updateEffect),!I.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(I,E,j){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[I],null);const e=this._engine;e.bindTransformFeedbackBuffer(E.getBuffer()),e.setRasterizerState(!1),e.beginTransformFeedback(!0),e.drawArraysType(3,0,j),e.endTransformFeedback(),e.setRasterizerState(!0),e.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let I=0;I<this._updateVAO.length;I++)this._engine.releaseVertexArrayObject(this._updateVAO[I]);this._updateVAO.length=0;for(let I=0;I<this._renderVAO.length;I++)this._engine.releaseVertexArrayObject(this._renderVAO[I]);this._renderVAO.length=0}_createUpdateVAO(I){const E={};E.position=I.createVertexBuffer("position",0,3);let j=3;E.age=I.createVertexBuffer("age",j,1),j+=1,E.size=I.createVertexBuffer("size",j,3),j+=3,E.life=I.createVertexBuffer("life",j,1),j+=1,E.seed=I.createVertexBuffer("seed",j,4),j+=4,E.direction=I.createVertexBuffer("direction",j,3),j+=3,this._parent.particleEmitterType instanceof x&&(E.initialPosition=I.createVertexBuffer("initialPosition",j,3),j+=3),this._parent._colorGradientsTexture||(E.color=I.createVertexBuffer("color",j,4),j+=4),this._parent._isBillboardBased||(E.initialDirection=I.createVertexBuffer("initialDirection",j,3),j+=3),this._parent.noiseTexture&&(E.noiseCoordinates1=I.createVertexBuffer("noiseCoordinates1",j,3),j+=3,E.noiseCoordinates2=I.createVertexBuffer("noiseCoordinates2",j,3),j+=3),this._parent._angularSpeedGradientsTexture?(E.angle=I.createVertexBuffer("angle",j,1),j+=1):(E.angle=I.createVertexBuffer("angle",j,2),j+=2),this._parent._isAnimationSheetEnabled&&(E.cellIndex=I.createVertexBuffer("cellIndex",j,1),j+=1,this._parent.spriteRandomStartCell&&(E.cellStartOffset=I.createVertexBuffer("cellStartOffset",j,1),j+=1));const e=this._engine.recordVertexArrayObject(E,null,this._updateEffect);return this._engine.bindArrayBuffer(null),e}});class i{constructor(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,e=arguments.length>3?arguments[3]:void 0;this._engine=I,this._label=e,this._engine._storageBuffers.push(this),this._create(E,j)}_create(I,E){this._bufferSize=I,this._creationFlags=E,this._buffer=this._engine.createStorageBuffer(I,E,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(I,E,j){this._buffer&&this._engine.updateStorageBuffer(this._buffer,I,E,j)}async read(I,E,j,e){return await this._engine.readFromStorageBuffer(this._buffer,I,E,j,e)}dispose(){const I=this._engine._storageBuffers,E=I.indexOf(this);-1!==E&&(I[E]=I[I.length-1],I.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var r=j(11101),n=j(11106),H=j(11149),g=j(11097),Y=j(11411),A=j(10974),T=j(11060),M=j(11343);class W{constructor(){this._gpuTimeInFrameId=-1,this.counter=new M.e}_addDuration(I,E){I<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==I?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(E,!1),this._gpuTimeInFrameId=I):this.counter.addCount(E,!1))}}var O=j(11031);class s{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=I,this._engine=E,this.uniqueId=Y.e.UniqueId,E.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new W),this._engine.getCaps().supportComputeShaders?e.bindingsMapping?(this._context=E.createComputeContext(),this._shaderPath=j,this._options={bindingsMapping:{},defines:[],...e}):A.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):A.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(I,E){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const e=this._bindings[I];this._bindings[I]={type:j?0:4,object:E,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!e||e.object!==E||e.type!==this._bindings[I].type)}setStorageTexture(I,E){const j=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==E),this._bindings[I]={type:1,object:E,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setExternalTexture(I,E){const j=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==E),this._bindings[I]={type:6,object:E,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setVideoTexture(I,E){return!!E.externalTexture&&(this.setExternalTexture(I,E.externalTexture),!0)}setUniformBuffer(I,E){const j=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==E),this._bindings[I]={type:s._BufferIsDataBuffer(E)?7:2,object:E,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setStorageBuffer(I,E){const j=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!j||j.object!==E),this._bindings[I]={type:s._BufferIsDataBuffer(E)?7:3,object:E,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}setTextureSampler(I,E){const j=this._bindings[I];this._contextIsDirty||(this._contextIsDirty=!j||!E.compareSampler(j.object)),this._bindings[I]={type:5,object:E,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries}}isReady(){let I=this._effect;for(const w in this._bindings){const I=this._bindings[w],E=I.type,j=I.object;switch(E){case 0:case 4:case 1:if(!j.isReady())return!1;break;case 6:if(!j.isReady())return!1;break}}const E=[],j=this._shaderPath;if(this._options.defines)for(let w=0;w<this._options.defines.length;w++)E.push(this._options.defines[w]);const e=E.join("\n");return this._cachedDefines!==e&&(this._cachedDefines=e,I=this._engine.createComputeEffect(j,{defines:e,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=I),!!I.isReady()}dispatch(I,E,j){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,I,E,j,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const j=s._BufferIsDataBuffer(I)?I:I.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,j,E,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const E in this._bindings){const j=this._bindings[E];if(!this._options.bindingsMapping[E])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+E+"'");switch(j.type){case 0:{const e=this._samplers[E],w=j.object;var I;if(!e||!w._texture||!e.compareSampler(w._texture))this._samplers[E]=(new T.d).setParameters(w.wrapU,w.wrapV,w.wrapR,w.anisotropicFilteringLevel,w._texture.samplingMode,null===(I=w._texture)||void 0===I?void 0:I._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const I=j.object;I.getBuffer()!==j.buffer&&(j.buffer=I.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((w=>{(0,O.c)((()=>this.dispatch(I,E,j)),w,void 0,e)}))}serialize(){const I=H.e.Serialize(this);I.options=this._options,I.shaderPath=this._shaderPath,I.cZ={},I.textures={};for(const E in this._bindings){const j=this._bindings[E],e=j.object;switch(j.type){case 0:case 4:case 1:{const w=e.serialize();w&&(I.textures[E]=w,I.cZ[E]={type:j.type});break}}}return I}static Parse(I,E,j){const e=H.e.Parse((()=>new s(I.name,E.getEngine(),I.shaderPath,I.options)),I,E,j);for(const w in I.textures){const z=I.cZ[w],h=g.d.Parse(I.textures[w],E,j);0===z.type?e.setTexture(w,h):4===z.type?e.setTexture(w,h,!1):e.setStorageTexture(w,h)}return e}static _BufferIsDataBuffer(I){return void 0!==I.underlyingResource}}(0,r.b)([(0,n.N)()],s.prototype,"name",void 0),(0,r.b)([(0,n.N)()],s.prototype,"fastMode",void 0),(0,t.h)("BABYLON.ComputeShader",s);var v=j(11378);const V="gpuUpdateParticlesComputeShader",f="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";G.e.ShadersStoreWGSL[V]||(G.e.ShadersStoreWGSL[V]=f);(0,t.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(I,E){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=I,this._engine=E}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var I;return(null===(I=this._updateComputeShader)||void 0===I?void 0:I.isReady())??!1}createUpdateBuffer(I){var E;const j={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(j.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(j.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(j.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(j.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(j.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(j.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(j.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new s("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:j,defines:I.split("\n")}),null===(E=this._simParamsComputeShader)||void 0===E||E.dispose(),this._simParamsComputeShader=new v.b(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new Q(this._simParamsComputeShader)}createVertexBuffers(I,E){this._renderVertexBuffers.push(E)}createParticleBuffer(I){const E=new i(this._engine,4*I.length,11,"ComputeShaderParticleSystemBuffer");return E.update(I),this._bufferComputeShader.push(E),E.getBuffer()}bindDrawBuffers(I,E,j){this._engine.bindBuffers(this._renderVertexBuffers[I],j,E)}preUpdateParticleBuffer(){}updateParticleBuffer(I,E,j){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[I]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^I]),this._updateComputeShader.dispatch(Math.ceil(j/64))}releaseBuffers(){var I;for(let E=0;E<this._bufferComputeShader.length;++E)this._bufferComputeShader[E].dispose();this._bufferComputeShader.length=0,null===(I=this._simParamsComputeShader)||void 0===I||I.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class S{constructor(I,E,j){this.gradient=I,this.color1=E,this.color2=j}getColorToRef(I){this.color2?h.hh.LerpToRef(this.color1,this.color2,Math.random(),I):I.U(this.color1)}}class B{constructor(I,E){this.gradient=I,this.color=E}}class p{constructor(I,E,j){this.gradient=I,this.factor1=E,this.factor2=j}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class D{static GetCurrentGradient(I,E,j){if(E[0].gradient>I)return void j(E[0],E[0],1);for(let w=0;w<E.length-1;w++){const e=E[w],z=E[w+1];if(I>=e.gradient&&I<=z.gradient){return void j(e,z,(I-e.gradient)/(z.gradient-e.gradient))}}const e=E.length-1;j(E[e],E[e],1)}}var k=j(10960),J=j(11587),N=j(10993);class m{constructor(I){this.particleSystem=I,this.position=e.LE.Zero(),this.direction=e.LE.Zero(),this.color=new h.hh(0,0,0,0),this.colorStep=new h.hh(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new e.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new h.hh(0,0,0,0),this._currentColor2=new h.hh(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=m._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let I=this.age,E=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===E?(E=1,I=this._randomCellOffset):I+=this._randomCellOffset);const j=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let e;e=this._initialSpriteCellLoop?(0,R.Clamp)(I*E%this.lifeTime/this.lifeTime):(0,R.Clamp)(I*E/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+e*j|0}_inheritParticleInfoToSubEmitter(I){if(I.particleSystem.wE.position){const E=I.particleSystem.wE;if(E.position.U(this.position),I.inheritDirection){const I=e.TmpVectors.LE[0];this.direction.normalizeToRef(I),E.setDirection(I,0,Math.PI/2)}}else{I.particleSystem.wE.U(this.position)}this.direction.scaleToRef(I.inheritedVelocityAmount/2,e.TmpVectors.LE[0]),I.particleSystem._inheritedVelocityOffset.U(e.TmpVectors.LE[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const I of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(I)}_reset(){this.age=0,this.id=m._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(I){I.position.U(this.position),this._initialDirection?I._initialDirection?I._initialDirection.U(this._initialDirection):I._initialDirection=this._initialDirection.clone():I._initialDirection=null,I.direction.U(this.direction),this.jU&&(I.jU?I.jU.U(this.jU):I.jU=this.jU.clone()),I.color.U(this.color),I.colorStep.U(this.colorStep),I.lifeTime=this.lifeTime,I.age=this.age,I._randomCellOffset=this._randomCellOffset,I.size=this.size,I.scale.U(this.scale),I.angle=this.angle,I.angularSpeed=this.angularSpeed,I.particleSystem=this.particleSystem,I.cellIndex=this.cellIndex,I.id=this.id,I._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(I._currentColorGradient=this._currentColorGradient,I._currentColor1.U(this._currentColor1),I._currentColor2.U(this._currentColor2)),this._currentSizeGradient&&(I._currentSizeGradient=this._currentSizeGradient,I._currentSize1=this._currentSize1,I._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(I._currentAngularSpeedGradient=this._currentAngularSpeedGradient,I._currentAngularSpeed1=this._currentAngularSpeed1,I._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(I._currentVelocityGradient=this._currentVelocityGradient,I._currentVelocity1=this._currentVelocity1,I._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(I._currentLimitVelocityGradient=this._currentLimitVelocityGradient,I._currentLimitVelocity1=this._currentLimitVelocity1,I._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(I._currentDragGradient=this._currentDragGradient,I._currentDrag1=this._currentDrag1,I._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(I._initialStartSpriteCellId=this._initialStartSpriteCellId,I._initialEndSpriteCellId=this._initialEndSpriteCellId,I._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(I.remapData&&this.remapData?I.remapData.U(this.remapData):I.remapData=new e.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.U(this._randomNoiseCoordinates1),I._randomNoiseCoordinates2.U(this._randomNoiseCoordinates2)):(I._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),I._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}m._Count=0;var II=j(11246),EI=(j(11282),j(11477)),jI=j(11470),eI=j(11374);function wI(I,E){const j=(0,R.RandomRange)(0,1);h.hh.LerpToRef(E.color1,E.color2,j,I.color),E.colorDead.subtractToRef(I.color,E._colorDiff),E._colorDiff.scaleToRef(1/I.lifeTime,I.colorStep)}function zI(I,E){I._currentColorGradient=E._colorGradients[0],I._currentColorGradient.getColorToRef(I.color),I._currentColor1.U(I.color),E._colorGradients.length>1?E._colorGradients[1].getColorToRef(I._currentColor2):I._currentColor2.U(I.color)}function hI(I,E){const j=E._colorGradients;D.GetCurrentGradient(E._ratio,j,((E,j,e)=>{E!==I._currentColorGradient&&(I._currentColor1.U(I._currentColor2),j.getColorToRef(I._currentColor2),I._currentColorGradient=E),h.hh.LerpToRef(I._currentColor1,I._currentColor2,e,I.color)}))}function tI(I,E){I.colorStep.scaleToRef(E._scaledUpdateSpeed,E._scaledColorStep),I.color.addInPlace(E._scaledColorStep),I.color.a<0&&(I.color.a=0)}function UI(I,E){D.GetCurrentGradient(E._ratio,E._angularSpeedGradients,((E,j,e)=>{E!==I._currentAngularSpeedGradient&&(I._currentAngularSpeed1=I._currentAngularSpeed2,I._currentAngularSpeed2=j.getFactor(),I._currentAngularSpeedGradient=E),I.angularSpeed=(0,R.Lerp)(I._currentAngularSpeed1,I._currentAngularSpeed2,e)}))}function RI(I,E){I.angle+=I.angularSpeed*E._scaledUpdateSpeed}function PI(I,E){E.particleEmitterType.startDirectionFunction(E._emitterWorldMatrix,I.direction,I,E.isLocal,E._emitterInverseWorldMatrix)}function oI(I,E){E.startDirectionFunction(E._emitterWorldMatrix,I.direction,I,E.isLocal)}function ZI(I,E){I._currentVelocityGradient=E._velocityGradients[0],I._currentVelocity1=I._currentVelocityGradient.getFactor(),E._velocityGradients.length>1?I._currentVelocity2=E._velocityGradients[1].getFactor():I._currentVelocity2=I._currentVelocity1}function cI(I,E){I._currentLimitVelocityGradient=E._limitVelocityGradients[0],I._currentLimitVelocity1=I._currentLimitVelocityGradient.getFactor(),E._limitVelocityGradients.length>1?I._currentLimitVelocity2=E._limitVelocityGradients[1].getFactor():I._currentLimitVelocity2=I._currentLimitVelocity1}function KI(I,E){D.GetCurrentGradient(E._ratio,E._velocityGradients,((j,e,w)=>{j!==I._currentVelocityGradient&&(I._currentVelocity1=I._currentVelocity2,I._currentVelocity2=e.getFactor(),I._currentVelocityGradient=j),E._directionScale*=(0,R.Lerp)(I._currentVelocity1,I._currentVelocity2,w)}))}function LI(I,E){D.GetCurrentGradient(E._ratio,E._limitVelocityGradients,((j,e,w)=>{j!==I._currentLimitVelocityGradient&&(I._currentLimitVelocity1=I._currentLimitVelocity2,I._currentLimitVelocity2=e.getFactor(),I._currentLimitVelocityGradient=j);const z=(0,R.Lerp)(I._currentLimitVelocity1,I._currentLimitVelocity2,w);I.direction.length()>z&&I.direction.scaleInPlace(E.limitVelocityDamping)}))}function FI(I,E){I.direction.scaleToRef(E._directionScale,E._scaledDirection)}function CI(I,E){E.particleEmitterType.startPositionFunction(E._emitterWorldMatrix,I.position,I,E.isLocal)}function XI(I,E){E.startPositionFunction(E._emitterWorldMatrix,I.position,I,E.isLocal)}function qI(I,E){I.jU?I.jU.U(I.position):I.jU=I.position.clone(),e.LE.TransformCoordinatesToRef(I.jU,E._emitterWorldMatrix,I.position)}function xI(I,E){E.isLocal&&I.jU?(I.jU.addInPlace(E._scaledDirection),e.LE.TransformCoordinatesToRef(I.jU,E._emitterWorldMatrix,I.position)):I.position.addInPlace(E._scaledDirection)}function uI(I,E){I._currentDragGradient=E._dragGradients[0],I._currentDrag1=I._currentDragGradient.getFactor(),E._dragGradients.length>1?I._currentDrag2=E._dragGradients[1].getFactor():I._currentDrag2=I._currentDrag1}function bI(I,E){D.GetCurrentGradient(E._ratio,E._dragGradients,((j,e,w)=>{j!==I._currentDragGradient&&(I._currentDrag1=I._currentDrag2,I._currentDrag2=e.getFactor(),I._currentDragGradient=j);const z=(0,R.Lerp)(I._currentDrag1,I._currentDrag2,w);E._scaledDirection.scaleInPlace(1-z)}))}function QI(I,E){I._randomNoiseCoordinates1?(I._randomNoiseCoordinates1.nz(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2.nz(Math.random(),Math.random(),Math.random())):(I._randomNoiseCoordinates1=new e.LE(Math.random(),Math.random(),Math.random()),I._randomNoiseCoordinates2=new e.LE(Math.random(),Math.random(),Math.random()))}function GI(I,E){const j=E._noiseTextureData,w=E._noiseTextureSize;if(j&&w&&I._randomNoiseCoordinates1){const z=E._fetchR(I._randomNoiseCoordinates1.x,I._randomNoiseCoordinates1.y,w.width,w.height,j),h=E._fetchR(I._randomNoiseCoordinates1.z,I._randomNoiseCoordinates2.x,w.width,w.height,j),t=E._fetchR(I._randomNoiseCoordinates2.y,I._randomNoiseCoordinates2.z,w.width,w.height,j),U=e.TmpVectors.LE[0],R=e.TmpVectors.LE[1];U.nz((2*z-1)*E.noiseStrength.x,(2*h-1)*E.noiseStrength.y,(2*t-1)*E.noiseStrength.z),U.scaleToRef(E._tempScaledUpdateSpeed,R),I.direction.addInPlace(R)}}function yI(I,E){E.gravity.scaleToRef(E._tempScaledUpdateSpeed,E._scaledGravity),I.direction.addInPlace(E._scaledGravity)}function dI(I,E){I.size=(0,R.RandomRange)(E.minSize,E.maxSize),I.scale.nz((0,R.RandomRange)(E.minScaleX,E.maxScaleX),(0,R.RandomRange)(E.minScaleY,E.maxScaleY))}function aI(I,E){I._currentSizeGradient=E._sizeGradients[0],I._currentSize1=I._currentSizeGradient.getFactor(),I.size=I._currentSize1,E._sizeGradients.length>1?I._currentSize2=E._sizeGradients[1].getFactor():I._currentSize2=I._currentSize1,I.scale.nz((0,R.RandomRange)(E.minScaleX,E.maxScaleX),(0,R.RandomRange)(E.minScaleY,E.maxScaleY))}function lI(I,E){const j=E._actualFrame/E.targetStopDuration;D.GetCurrentGradient(j,E._startSizeGradients,((j,e,w)=>{j!==E._currentStartSizeGradient&&(E._currentStartSize1=E._currentStartSize2,E._currentStartSize2=e.getFactor(),E._currentStartSizeGradient=j);const z=(0,R.Lerp)(E._currentStartSize1,E._currentStartSize2,w);I.scale.scaleInPlace(z)}))}function iI(I,E){D.GetCurrentGradient(E._ratio,E._sizeGradients,((E,j,e)=>{E!==I._currentSizeGradient&&(I._currentSize1=I._currentSize2,I._currentSize2=j.getFactor(),I._currentSizeGradient=E),I.size=(0,R.Lerp)(I._currentSize1,I._currentSize2,e)}))}function rI(I,E){I.remapData=new e.Vector4(0,1,0,1)}function nI(I,E){E._colorRemapGradients&&E._colorRemapGradients.length>0&&D.GetCurrentGradient(E._ratio,E._colorRemapGradients,((E,j,e)=>{const w=(0,R.Lerp)(E.factor1,j.factor1,e),z=(0,R.Lerp)(E.factor2,j.factor2,e);I.remapData.x=w,I.remapData.y=z-w})),E._alphaRemapGradients&&E._alphaRemapGradients.length>0&&D.GetCurrentGradient(E._ratio,E._alphaRemapGradients,((E,j,e)=>{const w=(0,R.Lerp)(E.factor1,j.factor1,e),z=(0,R.Lerp)(E.factor2,j.factor2,e);I.remapData.z=w,I.remapData.w=z-w}))}function HI(I,E){const j=(0,R.Clamp)(E._actualFrame/E.targetStopDuration);D.GetCurrentGradient(j,E._lifeTimeGradients,((E,e)=>{const w=E,z=e,h=w.getFactor(),t=z.getFactor(),U=(j-w.gradient)/(z.gradient-w.gradient);I.lifeTime=(0,R.Lerp)(h,t,U)})),E._emitPower=(0,R.RandomRange)(E.minEmitPower,E.maxEmitPower)}function gI(I,E){I.lifeTime=(0,R.RandomRange)(E.minLifeTime,E.maxLifeTime),E._emitPower=(0,R.RandomRange)(E.minEmitPower,E.maxEmitPower)}function YI(I,E){0===E._emitPower?(I._initialDirection?I._initialDirection.U(I.direction):I._initialDirection=I.direction.clone(),I.direction.set(0,0,0)):(I._initialDirection=null,I.direction.scaleInPlace(E._emitPower)),I.direction.addInPlace(E._inheritedVelocityOffset)}function AI(I,E){I.angularSpeed=(0,R.RandomRange)(E.minAngularSpeed,E.maxAngularSpeed),I.angle=(0,R.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function TI(I,E){I._currentAngularSpeedGradient=E._angularSpeedGradients[0],I.angularSpeed=I._currentAngularSpeedGradient.getFactor(),I._currentAngularSpeed1=I.angularSpeed,E._angularSpeedGradients.length>1?I._currentAngularSpeed2=E._angularSpeedGradients[1].getFactor():I._currentAngularSpeed2=I._currentAngularSpeed1,I.angle=(0,R.RandomRange)(E.minInitialRotation,E.maxInitialRotation)}function MI(I,E){I._initialStartSpriteCellId=E.startSpriteCellID,I._initialEndSpriteCellId=E.endSpriteCellID,I._initialSpriteCellLoop=E.spriteCellLoop}function WI(I,E){I.previousItem=E.previousItem,I.nextItem=E,E.previousItem&&(E.previousItem.nextItem=I),E.previousItem=I}function OI(I,E){I.previousItem=E,I.nextItem=E.nextItem,E.nextItem&&(E.nextItem.previousItem=I),E.nextItem=I}function sI(I,E){let j=E;for(;j.nextItem;)j=j.nextItem;I.previousItem=j,I.nextItem=j.nextItem,j.nextItem=I}function vI(I){I.previousItem&&(I.previousItem.nextItem=I.nextItem),I.nextItem&&(I.nextItem.previousItem=I.previousItem)}class VI extends U{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(I){this._startDirectionFunction!==I&&(this._startDirectionFunction=I,this._directionProcessing.process=I?oI:PI)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(I){this._startPositionFunction!==I&&(this._startPositionFunction=I,this._positionCreation.process=I?XI:CI)}set onDispose(I){this._onDisposeObserver&&this.Le.remove(this._onDisposeObserver),this._onDisposeObserver=this.Le.add(I)}get Z(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(I){this._useRampGradients!==I&&(this._useRampGradients=I,this._resetEffect(),I?(this._rampCreation={process:rI,previousItem:null,nextItem:null},OI(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:nI,previousItem:null,nextItem:null},OI(this._remapGradientProcessing,this._gravityProcessing)):(vI(this._rampCreation),vI(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(I){this._isLocal!==I&&(this._isLocal=I,I?(this._isLocalCreation={process:qI,previousItem:null,nextItem:null},OI(this._isLocalCreation,this._positionCreation)):vI(this._isLocalCreation))}get particles(){return this.UZ}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(I){this._animationSheetEnabled!==I&&(this._animationSheetEnabled=I,I?(this._sheetCreation={process:MI,previousItem:null,nextItem:null},OI(this._sheetCreation,this._colorCreation)):vI(this._sheetCreation),this._reset())}getActiveCount(){return this.UZ.length}getClassName(){return"Qh"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var I;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[E])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new II.e(this._engine),this._customWrappers[E].effect=I,this._customWrappers[E].drawContext&&(this._customWrappers[E].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(I){if(this.noiseTexture!==I){if(this._noiseTexture=I,!I)return vI(this._noiseCreation),void vI(this._noiseProcessing);this._noiseCreation={process:QI,previousItem:null,nextItem:null},OI(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:GI,previousItem:null,nextItem:null},OI(this._noiseProcessing,this._positionProcessing)}}constructor(I,E,j){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],t=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,U=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(I),this._emitterInverseWorldMatrix=e.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new e.LE,this.Le=new k.e,this.onStoppedObservable=new k.e,this.onStartedObservable=new k.e,this._noiseTextureSize=null,this._noiseTextureData=null,this.UZ=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new h.hh(0,0,0,0),this._colorDiff=new h.hh(0,0,0,0),this._scaledDirection=e.LE.Zero(),this._scaledGravity=e.LE.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=I=>{},this.recycleParticle=I=>{const E=this.UZ.pop();E!==I&&E.copyTo(I),this._stockParticles.push(E)},this._createParticle=()=>{let I;return 0!==this._stockParticles.length?(I=this._stockParticles.pop(),I._reset()):I=new m(this),this._prepareParticle(I),I},this.paused=!1,this._shadersLoaded=!1,this._capacity=E,this._epsilon=t,j&&"Scene"!==j.getClassName()?(this._engine=j,this.defaultProjectionMatrix=e.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=j||N.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.hZ.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:gI,previousItem:null,nextItem:null},this._positionCreation={process:CI,previousItem:null,nextItem:null},OI(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:PI,previousItem:null,nextItem:null},OI(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:YI,previousItem:null,nextItem:null},OI(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:dI,previousItem:null,nextItem:null},OI(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:AI,previousItem:null,nextItem:null},OI(this._angleCreation,this._sizeCreation),this._colorCreation={process:wI,previousItem:null,nextItem:null},OI(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,U||(this._colorProcessing={process:tI,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:RI,previousItem:null,nextItem:null},OI(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:FI,previousItem:null,nextItem:null},OI(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:xI,previousItem:null,nextItem:null},OI(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:yI,previousItem:null,nextItem:null},OI(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=z,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new II.e(this._engine)},this._customWrappers[0].effect=w,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new o,this.updateFunction=I=>{var E;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(E=this.noiseTexture.getContent())||void 0===E||E.then((I=>{this._noiseTextureData=I})));const j=I===this.UZ;for(let e=0;e<I.length;e++){const E=I[e];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const w=E.age;if(E.age+=this._tempScaledUpdateSpeed,E.age>E.lifeTime){const I=E.age-w,j=E.lifeTime-w;this._tempScaledUpdateSpeed=j*this._tempScaledUpdateSpeed/I,E.age=E.lifeTime}this._ratio=E.age/E.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let z=this._updateQueueStart;for(;z;)z.process(E,this),z=z.nextItem;if(this._isAnimationSheetEnabled&&!U&&E.updateCellIndex(),E._inheritParticleInfoToSubEmitters(),E.age>=E.lifeTime){if(this._emitFromParticle(E),E._attachedSubEmitters){for(const I of E._attachedSubEmitters)I.particleSystem.disposeOnStop=!0,I.particleSystem.stop();E._attachedSubEmitters=null}this.recycleParticle(E),j&&e--}else;}}}serialize(I){throw new Error("Method not implemented.")}clone(I,E){throw new Error("Method not implemented.")}_addFactorGradient(I,E,j,e){const w=new p(E,j,e);I.push(w),I.sort(((I,E)=>I.gradient<E.gradient?-1:I.gradient>E.gradient?1:0))}_removeFactorGradient(I,E){if(!I)return;let j=0;for(const e of I){if(e.gradient===E){I.splice(j,1);break}j++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=HI:this._lifeTimeCreation.process=gI}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:lI,previousItem:null,nextItem:null},OI(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(vI(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(I){this.targetStopDuration!==I&&(this._targetStopDuration=I,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(I,E,j){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,I,E,j),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(I){return this._removeFactorGradient(this._lifeTimeGradients,I),this._syncLifeTimeCreation(),this}addSizeGradient(I,E,j){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=aI,this._sizeGradientProcessing={process:iI,previousItem:null,nextItem:null},WI(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,I,E,j),this}removeSizeGradient(I){var E;return this._removeFactorGradient(this._sizeGradients,I),0===(null===(E=this._sizeGradients)||void 0===E?void 0:E.length)&&(vI(this._sizeGradientProcessing),this._sizeCreation.process=dI),this}addColorRemapGradient(I,E,j){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,I,E,j),this}removeColorRemapGradient(I){return this._removeFactorGradient(this._colorRemapGradients,I),this}addAlphaRemapGradient(I,E,j){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,I,E,j),this}removeAlphaRemapGradient(I){return this._removeFactorGradient(this._alphaRemapGradients,I),this}addAngularSpeedGradient(I,E,j){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=TI,this._angularSpeedGradientProcessing={process:UI,previousItem:null,nextItem:null},WI(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,I,E,j),this}removeAngularSpeedGradient(I){var E;return this._removeFactorGradient(this._angularSpeedGradients,I),0===(null===(E=this._angularSpeedGradients)||void 0===E?void 0:E.length)&&(this._angleCreation.process=AI,vI(this._angularSpeedGradientProcessing)),this}addVelocityGradient(I,E,j){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:ZI,previousItem:null,nextItem:null},OI(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:KI,previousItem:null,nextItem:null},WI(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,I,E,j),this}removeVelocityGradient(I){var E;return this._removeFactorGradient(this._velocityGradients,I),0===(null===(E=this._velocityGradients)||void 0===E?void 0:E.length)&&(vI(this._velocityCreation),vI(this._velocityGradientProcessing)),this}addLimitVelocityGradient(I,E,j){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:cI,previousItem:null,nextItem:null},OI(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:LI,previousItem:null,nextItem:null},OI(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,I,E,j),this}removeLimitVelocityGradient(I){var E;return this._removeFactorGradient(this._limitVelocityGradients,I),0===(null===(E=this._limitVelocityGradients)||void 0===E?void 0:E.length)&&(vI(this._limitVelocityCreation),vI(this._limitVelocityGradientProcessing)),this}addDragGradient(I,E,j){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:uI,previousItem:null,nextItem:null},WI(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:bI,previousItem:null,nextItem:null},WI(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,I,E,j),this}removeDragGradient(I){var E;return this._removeFactorGradient(this._dragGradients,I),0===(null===(E=this._dragGradients)||void 0===E?void 0:E.length)&&(vI(this._dragCreation),vI(this._dragGradientProcessing)),this}addEmitRateGradient(I,E,j){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,I,E,j),this}removeEmitRateGradient(I){return this._removeFactorGradient(this._emitRateGradients,I),this}addStartSizeGradient(I,E,j){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,I,E,j),this._syncStartSizeCreation(),this}removeStartSizeGradient(I){return this._removeFactorGradient(this._startSizeGradients,I),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const I=new Uint8Array(4*this._rawTextureWidth),E=h.TmpColors.qE[0];for(let j=0;j<this._rawTextureWidth;j++){const e=j/this._rawTextureWidth;D.GetCurrentGradient(e,this._rampGradients,((e,w,z)=>{h.qE.LerpToRef(e.color,w.color,z,E),I[4*j]=255*E.r,I[4*j+1]=255*E.g,I[4*j+2]=255*E.b,I[4*j+3]=255}))}this._rampGradientsTexture=J.c.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((I,E)=>I.gradient<E.gradient?-1:I.gradient>E.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(I,E){this._rampGradients||(this._rampGradients=[]);const j=new B(I,E);return this._rampGradients.push(j),this._syncRampGradientTexture(),this}removeRampGradient(I){return this._removeGradientAndTexture(I,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(I,E,j){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=zI,this._colorProcessing.process=hI);const e=new S(I,E,j);return this._colorGradients.push(e),this._colorGradients.sort(((I,E)=>I.gradient<E.gradient?-1:I.gradient>E.gradient?1:0)),this}removeColorGradient(I){if(!this._colorGradients)return this;let E=0;for(const j of this._colorGradients){if(j.gradient===I){this._colorGradients.splice(E,1);break}E++}return 0===this._colorGradients.length&&(this._colorCreation.process=wI,this._colorProcessing.process=tI),this}resetDrawCache(){if(this._drawWrappers){for(const I of this._drawWrappers)if(I)for(const E of I)null===E||void 0===E||E.dispose();this._drawWrappers=[]}}_fetchR(I,E,j,e,w){return w[4*(((I=.5*Math.abs(I)+.5)*j%j|0)+((E=.5*Math.abs(E)+.5)*e%e|0)*j)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const I=this._engine,E=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*E),this._vertexBuffer=new u.c(I,this._vertexData,!0,E);let j=0;const e=this._vertexBuffer.createVertexBuffer(u.e.PositionKind,j,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[u.e.PositionKind]=e,j+=3;const w=this._vertexBuffer.createVertexBuffer(u.e.ColorKind,j,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[u.e.ColorKind]=w,j+=4;const z=this._vertexBuffer.createVertexBuffer("angle",j,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=z,j+=1;const h=this._vertexBuffer.createVertexBuffer("size",j,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=h,j+=2,this._isAnimationSheetEnabled){const I=this._vertexBuffer.createVertexBuffer("cellIndex",j,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=I,j+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const I=this._vertexBuffer.createVertexBuffer("direction",j,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=I,j+=3}if(this._useRampGradients){const I=this._vertexBuffer.createVertexBuffer("remapData",j,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=I,j+=4}let t;if(this._useInstancing){const E=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new u.c(I,E,!1,2),t=this._spriteBuffer.createVertexBuffer("offset",0,2)}else t=this._vertexBuffer.createVertexBuffer("offset",j,2,this._vertexBufferSize,this._useInstancing),j+=2;this._vertexBuffers.offset=t,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const I=[],E=[];let j=0;for(let e=0;e<this._capacity;e++)I.push(j),I.push(j+1),I.push(j+2),I.push(j),I.push(j+2),I.push(j+3),E.push(j,j+1,j+1,j+2,j+2,j+3,j+3,j,j,j+3),j+=4;this._indexBuffer=this._engine.createIndexBuffer(I),this._linesIndexBuffer=this._engine.createIndexBuffer(E)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(I)setTimeout((()=>{this.start(0)}),I);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var E;-1!==(null===(E=this.wE)||void 0===E?void 0:E.getClassName().indexOf("Mesh"))&&this.wE.Be(!0);const I=this.noiseTexture;if(I&&I.onGeneratedObservable)I.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let E=0;E<this.preWarmCycles;E++)this.animate(!0),I.render()}))}));else for(let E=0;E<this.preWarmCycles;E++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(I))}_postStop(I){}reset(){this._stockParticles.length=0,this.UZ.length=0}_appendParticleVertex(I,E,j,w){let z=I*this._vertexBufferSize;if(this._vertexData[z++]=E.position.x+this.bR.x,this._vertexData[z++]=E.position.y+this.bR.y,this._vertexData[z++]=E.position.z+this.bR.z,this._vertexData[z++]=E.color.r,this._vertexData[z++]=E.color.g,this._vertexData[z++]=E.color.b,this._vertexData[z++]=E.color.a,this._vertexData[z++]=E.angle,this._vertexData[z++]=E.scale.x*E.size,this._vertexData[z++]=E.scale.y*E.size,this._isAnimationSheetEnabled&&(this._vertexData[z++]=E.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[z++]=E.direction.x,this._vertexData[z++]=E.direction.y,this._vertexData[z++]=E.direction.z);else if(E._initialDirection){let I=E._initialDirection;this.isLocal&&(e.LE.TransformNormalToRef(I,this._emitterWorldMatrix,e.TmpVectors.LE[0]),I=e.TmpVectors.LE[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[z++]=I.x,this._vertexData[z++]=I.y,this._vertexData[z++]=I.z}else{let I=E.direction;this.isLocal&&(e.LE.TransformNormalToRef(I,this._emitterWorldMatrix,e.TmpVectors.LE[0]),I=e.TmpVectors.LE[0]),0===I.x&&0===I.z&&(I.x=.001),this._vertexData[z++]=I.x,this._vertexData[z++]=I.y,this._vertexData[z++]=I.z}this._useRampGradients&&E.remapData&&(this._vertexData[z++]=E.remapData.x,this._vertexData[z++]=E.remapData.y,this._vertexData[z++]=E.remapData.z,this._vertexData[z++]=E.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===j?j=this._epsilon:1===j&&(j=1-this._epsilon),0===w?w=this._epsilon:1===w&&(w=1-this._epsilon)),this._vertexData[z++]=j,this._vertexData[z++]=w)}_prepareParticle(I){}_createNewOnes(I){let E;for(let j=0;j<I&&this.UZ.length!==this._capacity;j++){E=this._createParticle(),this.UZ.push(E);let I=this._createQueueStart;for(;I;)I.process(E,this),I=I.nextItem;E._inheritParticleInfoToSubEmitters()}}_update(I){if(this._alive=this.UZ.length>0,this.wE.position){const I=this.wE;this._emitterWorldMatrix=I.getWorldMatrix()}else{const I=this.wE;this._emitterWorldMatrix=e.Matrix.Translation(I.x,I.y,I.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.UZ),this._createNewOnes(I)}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=[u.e.PositionKind,u.e.ColorKind,"angle","offset","size"];return I&&e.push("cellIndex"),E||e.push("direction"),j&&e.push("remapData"),e}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,EI.d)(e),I&&e.push("particlesInfos"),E&&e.push("logarithmicDepthConstant"),j&&(e.push("vFogInfos"),e.push("vFogColor")),e}fillDefines(I,E){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,EI.l)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&I.push("#define FOG")),this._isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),E===U.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&I.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case 2:I.push("#define BILLBOARDY");break;case 8:case 9:I.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&I.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:I.push("#define BILLBOARDMODE_ALL")}j&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,E,j){E.push(...VI._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),I.push(...VI._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),j.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,eI.g)(I,this._imageProcessingConfigurationDefines),(0,eI.d)(j,this._imageProcessingConfigurationDefines))}_getWrapper(I){const E=this._getCustomDrawWrapper(I);if(null!==E&&void 0!==E&&E.effect)return E;const j=[];this.fillDefines(j,I);const e=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let w=this._drawWrappers[e];w||(w=this._drawWrappers[e]=[]);let z=w[I];z||(z=new II.e(this._engine),z.drawContext&&(z.drawContext.useInstancing=this._useInstancing),w[I]=z);const h=j.join("\n");if(z.defines!==h){const I=[],E=[],j=[];this.fillUniformsAttributesAndSamplerNames(E,I,j),z.setEffect(this._engine.createEffect("particles",I,E,j,h,void 0,void 0,void 0,void 0,this._shaderLanguage),h)}return z}animate(){var I;let E,j=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!j&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(j?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this.manualEmitCount>-1)E=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let I=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const E=this._actualFrame/this.targetStopDuration;D.GetCurrentGradient(E,this._emitRateGradients,((E,j,e)=>{E!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=j.getFactor(),this._currentEmitRateGradient=E),I=(0,R.Lerp)(this._currentEmitRate1,this._currentEmitRate2,e)}))}E=I*this._scaledUpdateSpeed|0,this._newPartsExcess+=I*this._scaledUpdateSpeed-E}if(this._newPartsExcess>1&&(E+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?E=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(E),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!j){let I=0;for(let E=0;E<this.UZ.length;E++){const j=this.UZ[E];this._appendParticleVertices(I,j),I+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.UZ.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(I,E){this._appendParticleVertex(I++,E,0,0),this._useInstancing||(this._appendParticleVertex(I++,E,1,0),this._appendParticleVertex(I++,E,1,1),this._appendParticleVertex(I++,E,0,1))}rebuild(){var I;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(I=this._spriteBuffer)||void 0===I||I._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!VI.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(j.bind(j,12599)),Promise.resolve().then(j.bind(j,12530))])):await Promise.all([Promise.resolve().then(j.bind(j,12520)),Promise.resolve().then(j.bind(j,12516))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.wE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==U.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(U.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(U.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(I){const E=this._getWrapper(I),j=E.effect,w=this._engine;w.enableEffect(E);const z=this.defaultViewMatrix??this._scene.getViewMatrix();if(j.setTexture("diffuseSampler",this.particleTexture),j.setMatrix("view",z),j.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();j.setFloat3("particlesInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,this.spriteCellWidth/I.width)}if(j.setVector2("translationPivot",this.translationPivot),j.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;j.setVector3("eyePosition",I.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),j.setTexture("rampSampler",this._rampGradientsTexture));const h=j.defines;var t,U,R,P,o,Z;(this._scene&&((0,EI.f)(j,this,this._scene),this.applyFog&&(0,jI.d)(this._scene,void 0,j)),h.indexOf("#define BILLBOARDMODE_ALL")>=0&&(z.invertToRef(e.TmpVectors.Matrix[0]),j.setMatrix("invView",e.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?w.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,j):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,j)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?w.bindBuffers(this._vertexBuffers,null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?this._linesIndexBuffer:this._indexBuffer,j):w.bindBuffers(this._vertexBuffers,null!==(P=this._scene)&&void 0!==P&&P.forceWireframe?this._linesIndexBufferUseInstancing:null,j);(this.useLogarithmicDepth&&this._scene&&(0,jI.g)(h,j,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(j),this._setEngineBasedOnBlendMode(I),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(j),this._useInstancing)?null!==(o=this._scene)&&void 0!==o&&o.forceWireframe?w.drawElementsType(6,0,10,this.UZ.length):w.drawArraysType(7,0,4,this.UZ.length):null!==(Z=this._scene)&&void 0!==Z&&Z.forceWireframe?w.drawElementsType(1,0,10*this.UZ.length):w.drawElementsType(0,0,6*this.UZ.length);return this.UZ.length}render(){if(!this.isReady()||!this.UZ.length)return 0;const I=this._engine;I.setState&&(I.setState(!1),this.forceDepthWrite&&I.setDepthWrite(!0));let E=0;return E=this.blendMode===U.BLENDMODE_MULTIPLYADD?this._render(U.BLENDMODE_MULTIPLY)+this._render(U.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),E}_onDispose(){}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(E,j),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const I=this._scene.hZ.indexOf(this);I>-1&&this._scene.hZ.splice(I,1),this._scene._activeParticleSystems.dispose()}this.Le.notifyObservers(this),this.Le.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}VI.ForceGLSL=!1;var fI,SI=j(10986);!function(I){I[I.ATTACHED=0]="ATTACHED",I[I.END=1]="END"}(fI||(fI={}));class BI{constructor(I){if(this.particleSystem=I,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!I.wE||!I.wE.dispose){const E=(0,t.e)("BABYLON.AbstractMesh");I.wE=new E("SubemitterSystemEmitter",I.GI()),I._disposeEmitterOnDispose=!0}}clone(){let I=this.particleSystem.wE;if(I){if(I instanceof e.LE)I=I.clone();else if(-1!==I.getClassName().indexOf("Mesh")){I=new((0,t.e)("BABYLON.Mesh"))("",I.GI()),I.isVisible=!1}}else I=new e.LE;const E=new BI(this.particleSystem.clone(this.particleSystem.name,I));return E.particleSystem.name+="Clone",E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem._disposeEmitterOnDispose=!0,E.particleSystem.disposeOnStop=!0,E}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return E.type=this.type,E.inheritDirection=this.inheritDirection,E.inheritedVelocityAmount=this.inheritedVelocityAmount,E.particleSystem=this.particleSystem.serialize(I),E}static _ParseParticleSystem(I,E,j){throw(0,SI.b)("ParseParticle")}static Parse(I,E,j){const e=I.particleSystem,w=new BI(BI._ParseParticleSystem(e,E,j,!0));return w.type=I.type,w.inheritDirection=I.inheritDirection,w.inheritedVelocityAmount=I.inheritedVelocityAmount,w.particleSystem._isSubEmitter=!0,w}dispose(){this.particleSystem.dispose()}}var pI=j(11033);function DI(I,E){const j=new C;return j.direction1=I,j.direction2=E,j}function kI(){return new F(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function JI(){return new X(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function NI(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.LE(0,1,0),j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0);return new q(I,E,j)}function mI(){return new K(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function IE(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0),z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.LE(0,1,0);return new L(I,E,j,w,z)}function EE(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new Z(I,E)}function jE(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0);return new c(I,E,j,w)}const eE=e.LE.Zero(),wE=e.LE.Zero(),zE=e.LE.Zero();class hE{constructor(){this.strength=0,this.position=e.LE.Zero()}_processParticle(I,E){this.position.subtractToRef(I.position,eE);const j=eE.lengthSquared()+1;eE.normalize().scaleToRef(this.strength/j,wE),wE.scaleToRef(E._tempScaledUpdateSpeed,zE),I.direction.addInPlace(zE)}serialize(){return{position:this.position.re(),strength:this.strength}}}class tE extends VI{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=I=>{if(!this._subEmitters||0===this._subEmitters.length)return;const E=Math.floor(Math.random()*this._subEmitters.length);for(const j of this._subEmitters[E])if(1===j.type){const E=j.clone();I._inheritParticleInfoToSubEmitter(E),E.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(E.particleSystem),E.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(I,E){const j=DI(I,E);return this.particleEmitterType=j,j}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I,this._flowMapUpdate&&(vI(this._flowMapUpdate),this._flowMapUpdate=null),I&&(this._flowMapUpdate={process:I=>{var E;const j=null===(E=this.GI())||void 0===E?void 0:E.getTransformMatrix();this._flowMap._processParticle(I,this.flowMapStrength*this._tempScaledUpdateSpeed,j)},previousItem:null,nextItem:null},OI(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(I){this._attractors.push(I),1===this._attractors.length&&(this._attractorUpdate={process:I=>{for(const E of this._attractors)E._processParticle(I,this)},previousItem:null,nextItem:null},OI(this._attractorUpdate,this._directionProcessing))}removeAttractor(I){const E=this._attractors.indexOf(I);-1!==E&&this._attractors.splice(E,1),0===this._attractors.length&&vI(this._attractorUpdate)}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(I)}createHemisphericEmitter(){const I=kI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=JI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=NI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.LE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=mI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=IE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.LE(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=jE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,E,j,e){const w=new o;return this.particleEmitterType=w,this.direction1=I,this.direction2=E,this.minEmitBox=j,this.maxEmitBox=e,w}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const I of this.subEmitters)I instanceof tE?this._subEmitters.push([new BI(I)]):I instanceof BI?this._subEmitters.push([I]):I instanceof Array&&this._subEmitters.push(I)}_stopSubEmitters(){if(this.activeSubSystems){for(const I of this.activeSubSystems)I.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const I=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==I&&this._rootParticleSystem.activeSubSystems.splice(I,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(I){I&&this._stopSubEmitters()}_prepareParticle(I){if(this._subEmitters&&this._subEmitters.length>0){const E=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];I._attachedSubEmitters=[];for(const j of E)if(0===j.type){const E=j.clone();I._attachedSubEmitters.push(E),E.particleSystem.start()}}}_onDispose(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),I&&this.particles)for(const j of this.particles)if(j._attachedSubEmitters)for(let I=j._attachedSubEmitters.length-1;I>=0;I-=1)j._attachedSubEmitters[I].dispose();if(E&&this.activeSubSystems)for(let j=this.activeSubSystems.length-1;j>=0;j-=1)this.activeSubSystems[j].dispose();if(this._subEmitters&&this._subEmitters.length){for(let I=0;I<this._subEmitters.length;I++)for(const E of this._subEmitters[I])E.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.wE&&this.wE.dispose&&this.wE.dispose(!0)}static _Parse(I,E,j,w){let z;z=j instanceof pI.c?null:j;const U=(0,t.e)("BABYLON.Texture");if(U&&z&&(I.texture?E.particleTexture=U.Parse(I.texture,z,w):I.textureName&&(E.particleTexture=new U(w+I.textureName,z,!1,void 0===I.invertY||I.invertY),E.particleTexture.name=I.textureName)),I.emitterId||0===I.emitterId||void 0!==I.wE?I.emitterId&&z?E.wE=z.getLastMeshById(I.emitterId):E.wE=e.LE.xE(I.wE):E.wE=e.LE.Zero(),E.isLocal=!!I.isLocal,void 0!==I.renderingGroupId&&(E.renderingGroupId=I.renderingGroupId),void 0!==I.isBillboardBased&&(E.isBillboardBased=I.isBillboardBased),void 0!==I.billboardMode&&(E.billboardMode=I.billboardMode),void 0!==I.useLogarithmicDepth&&(E.useLogarithmicDepth=I.useLogarithmicDepth),I.animations){for(let j=0;j<I.animations.length;j++){const e=I.animations[j],w=(0,t.e)("BABYLON.Animation");w&&E.animations.push(w.Parse(e))}E.beginAnimationOnStart=I.beginAnimationOnStart,E.beginAnimationFrom=I.beginAnimationFrom,E.beginAnimationTo=I.beginAnimationTo,E.beginAnimationLoop=I.beginAnimationLoop}if(I.autoAnimate&&z&&z.beginAnimation(E,I.autoAnimateFrom,I.autoAnimateTo,I.autoAnimateLoop,I.autoAnimateSpeed||1),E.startDelay=0|I.startDelay,E.minAngularSpeed=I.minAngularSpeed,E.maxAngularSpeed=I.maxAngularSpeed,E.minSize=I.minSize,E.maxSize=I.maxSize,I.minScaleX&&(E.minScaleX=I.minScaleX,E.maxScaleX=I.maxScaleX,E.minScaleY=I.minScaleY,E.maxScaleY=I.maxScaleY),void 0!==I.preWarmCycles&&(E.preWarmCycles=I.preWarmCycles,E.preWarmStepOffset=I.preWarmStepOffset),void 0!==I.minInitialRotation&&(E.minInitialRotation=I.minInitialRotation,E.maxInitialRotation=I.maxInitialRotation),E.minLifeTime=I.minLifeTime,E.maxLifeTime=I.maxLifeTime,E.minEmitPower=I.minEmitPower,E.maxEmitPower=I.maxEmitPower,E.emitRate=I.emitRate,E.gravity=e.LE.xE(I.gravity),I.noiseStrength&&(E.noiseStrength=e.LE.xE(I.noiseStrength)),E.color1=h.hh.xE(I.color1),E.color2=h.hh.xE(I.color2),E.colorDead=h.hh.xE(I.colorDead),E.updateSpeed=I.updateSpeed,E.targetStopDuration=I.targetStopDuration,E.blendMode=I.blendMode,I.colorGradients)for(const e of I.colorGradients)E.addColorGradient(e.gradient,h.hh.xE(e.color1),e.color2?h.hh.xE(e.color2):void 0);if(I.rampGradients){for(const j of I.rampGradients)E.addRampGradient(j.gradient,h.qE.xE(j.color));E.useRampGradients=I.useRampGradients}if(I.colorRemapGradients)for(const e of I.colorRemapGradients)E.addColorRemapGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.alphaRemapGradients)for(const e of I.alphaRemapGradients)E.addAlphaRemapGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.sizeGradients)for(const e of I.sizeGradients)E.addSizeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.angularSpeedGradients)for(const e of I.angularSpeedGradients)E.addAngularSpeedGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.velocityGradients)for(const e of I.velocityGradients)E.addVelocityGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.dragGradients)for(const e of I.dragGradients)E.addDragGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.emitRateGradients)for(const e of I.emitRateGradients)E.addEmitRateGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.startSizeGradients)for(const e of I.startSizeGradients)E.addStartSizeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.lifeTimeGradients)for(const e of I.lifeTimeGradients)E.addLifeTimeGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);if(I.limitVelocityGradients){for(const j of I.limitVelocityGradients)E.addLimitVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);E.limitVelocityDamping=I.limitVelocityDamping}if(I.noiseTexture&&z){const j=(0,t.e)("BABYLON.ProceduralTexture");E.noiseTexture=j.Parse(I.noiseTexture,z,w)}let R;if(I.particleEmitterType){switch(I.particleEmitterType.type){case"SphereParticleEmitter":R=new X;break;case"SphereDirectedParticleEmitter":R=new q;break;case"ConeEmitter":case"ConeParticleEmitter":R=new Z;break;case"ConeDirectedParticleEmitter":R=new c;break;case"CylinderParticleEmitter":R=new K;break;case"CylinderDirectedParticleEmitter":R=new L;break;case"HemisphericParticleEmitter":R=new F;break;case"PointParticleEmitter":R=new C;break;case"MeshParticleEmitter":R=new b;break;case"CustomParticleEmitter":R=new x;break;default:R=new o}R.parse(I.particleEmitterType,z)}else R=new o,R.parse(I,z);E.particleEmitterType=R,E.startSpriteCellID=I.startSpriteCellID,E.endSpriteCellID=I.endSpriteCellID,E.spriteCellLoop=I.spriteCellLoop??!0,E.spriteCellWidth=I.spriteCellWidth,E.spriteCellHeight=I.spriteCellHeight,E.spriteCellChangeSpeed=I.spriteCellChangeSpeed,E.spriteRandomStartCell=I.spriteRandomStartCell,E.disposeOnStop=I.disposeOnStop??!1,E.manualEmitCount=I.manualEmitCount??-1}static Parse(I,E,j){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],z=arguments.length>4?arguments[4]:void 0;const t=I.name;let U,R,P=null,o=null;if(E instanceof pI.c?U=E:(R=E,U=R.getEngine()),I.customShader&&U.createEffectForParticles){o=I.customShader;const E=o.shaderOptions.defines.length>0?o.shaderOptions.defines.join("\n"):"";P=U.createEffectForParticles(o.shaderPath.fragmentElement,o.shaderOptions.uniforms,o.shaderOptions.samplers,E)}const Z=new tE(t,z||I.Pj,E,P,I.isAnimationSheetEnabled);if(Z.customShader=o,Z._rootUrl=j,I.id&&(Z.id=I.id),I.subEmitters){Z.subEmitters=[];for(const e of I.subEmitters){const I=[];for(const w of e)I.push(BI.Parse(w,E,j));Z.subEmitters.push(I)}}if(I.attractors)for(const h of I.attractors){const I=new hE;I.position=e.LE.xE(h.position),I.strength=h.strength,Z.addAttractor(I)}return tE._Parse(I,Z,E,j),I.textureMask&&(Z.textureMask=h.hh.xE(I.textureMask)),I.bR&&(Z.bR=e.LE.xE(I.bR)),I.preventAutoStart&&(Z.preventAutoStart=I.preventAutoStart),w||Z.preventAutoStart||Z.start(),Z}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};if(tE._Serialize(E,this,I),E.textureMask=this.textureMask.re(),E.customShader=this.customShader,E.preventAutoStart=this.preventAutoStart,E.bR=this.bR.re(),this.subEmitters){E.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const j of this._subEmitters){const e=[];for(const E of j)e.push(E.serialize(I));E.subEmitters.push(e)}}if(this._attractors&&this._attractors.length){E.attractors=[];for(const I of this._attractors)E.attractors.push(I.serialize())}return E}static _Serialize(I,E,j){if(I.name=E.name,I.id=E.id,I.Pj=E.getCapacity(),I.disposeOnStop=E.disposeOnStop,I.manualEmitCount=E.manualEmitCount,E.wE.position){const j=E.wE;I.emitterId=j.id}else{const j=E.wE;I.wE=j.re()}E.particleEmitterType&&(I.particleEmitterType=E.particleEmitterType.serialize()),E.particleTexture&&(j?I.texture=E.particleTexture.serialize():(I.textureName=E.particleTexture.name,I.invertY=!!E.particleTexture._invertY)),I.isLocal=E.isLocal,H.e.AppendSerializedAnimations(E,I),I.beginAnimationOnStart=E.beginAnimationOnStart,I.beginAnimationFrom=E.beginAnimationFrom,I.beginAnimationTo=E.beginAnimationTo,I.beginAnimationLoop=E.beginAnimationLoop,I.startDelay=E.startDelay,I.renderingGroupId=E.renderingGroupId,I.isBillboardBased=E.isBillboardBased,I.billboardMode=E.billboardMode,I.minAngularSpeed=E.minAngularSpeed,I.maxAngularSpeed=E.maxAngularSpeed,I.minSize=E.minSize,I.maxSize=E.maxSize,I.minScaleX=E.minScaleX,I.maxScaleX=E.maxScaleX,I.minScaleY=E.minScaleY,I.maxScaleY=E.maxScaleY,I.minEmitPower=E.minEmitPower,I.maxEmitPower=E.maxEmitPower,I.minLifeTime=E.minLifeTime,I.maxLifeTime=E.maxLifeTime,I.emitRate=E.emitRate,I.gravity=E.gravity.re(),I.noiseStrength=E.noiseStrength.re(),I.color1=E.color1.re(),I.color2=E.color2.re(),I.colorDead=E.colorDead.re(),I.updateSpeed=E.updateSpeed,I.targetStopDuration=E.targetStopDuration,I.blendMode=E.blendMode,I.preWarmCycles=E.preWarmCycles,I.preWarmStepOffset=E.preWarmStepOffset,I.minInitialRotation=E.minInitialRotation,I.maxInitialRotation=E.maxInitialRotation,I.startSpriteCellID=E.startSpriteCellID,I.spriteCellLoop=E.spriteCellLoop,I.endSpriteCellID=E.endSpriteCellID,I.spriteCellChangeSpeed=E.spriteCellChangeSpeed,I.spriteCellWidth=E.spriteCellWidth,I.spriteCellHeight=E.spriteCellHeight,I.spriteRandomStartCell=E.spriteRandomStartCell,I.isAnimationSheetEnabled=E.isAnimationSheetEnabled,I.useLogarithmicDepth=E.useLogarithmicDepth;const e=E.getColorGradients();if(e){I.colorGradients=[];for(const E of e){const j={gradient:E.gradient,color1:E.color1.re()};E.color2?j.color2=E.color2.re():j.color2=E.color1.re(),I.colorGradients.push(j)}}const w=E.getRampGradients();if(w){I.rampGradients=[];for(const E of w){const j={gradient:E.gradient,color:E.color.re()};I.rampGradients.push(j)}I.useRampGradients=E.useRampGradients}const z=E.getColorRemapGradients();if(z){I.colorRemapGradients=[];for(const E of z){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.colorRemapGradients.push(j)}}const h=E.getAlphaRemapGradients();if(h){I.alphaRemapGradients=[];for(const E of h){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.alphaRemapGradients.push(j)}}const t=E.getSizeGradients();if(t){I.sizeGradients=[];for(const E of t){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.sizeGradients.push(j)}}const U=E.getAngularSpeedGradients();if(U){I.angularSpeedGradients=[];for(const E of U){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.angularSpeedGradients.push(j)}}const R=E.getVelocityGradients();if(R){I.velocityGradients=[];for(const E of R){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.velocityGradients.push(j)}}const P=E.getDragGradients();if(P){I.dragGradients=[];for(const E of P){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.dragGradients.push(j)}}const o=E.getEmitRateGradients();if(o){I.emitRateGradients=[];for(const E of o){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.emitRateGradients.push(j)}}const Z=E.getStartSizeGradients();if(Z){I.startSizeGradients=[];for(const E of Z){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.startSizeGradients.push(j)}}const c=E.getLifeTimeGradients();if(c){I.lifeTimeGradients=[];for(const E of c){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.lifeTimeGradients.push(j)}}const K=E.getLimitVelocityGradients();if(K){I.limitVelocityGradients=[];for(const E of K){const j={gradient:E.gradient,factor1:E.factor1};void 0!==E.factor2?j.factor2=E.factor2:j.factor2=E.factor1,I.limitVelocityGradients.push(j)}I.limitVelocityDamping=E.limitVelocityDamping}E.noiseTexture&&(I.noiseTexture=E.noiseTexture.serialize())}clone(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e={...this._customWrappers};let w=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){w=this.customShader;const I=w.shaderOptions.defines.length>0?w.shaderOptions.defines.join("\n"):"",E=z.createEffectForParticles(w.shaderPath.fragmentElement,w.shaderOptions.uniforms,w.shaderOptions.samplers,I);e[0]?e[0].effect=E:this.setCustomEffect(E,0)}const h=this.serialize(j),t=tE.Parse(h,this._scene||this._engine,this._rootUrl);return t.name=I,t.customShader=w,t._customWrappers=e,void 0===E&&(E=this.wE),this.noiseTexture&&(t.noiseTexture=this.noiseTexture.clone()),t.wE=E,this.preventAutoStart||t.start(),t}}tE.BILLBOARDMODE_Y=2,tE.BILLBOARDMODE_ALL=7,tE.BILLBOARDMODE_STRETCHED=8,tE.BILLBOARDMODE_STRETCHED_LOCAL=9,BI._ParseParticleSystem=tE.Parse;var UE=j(11365),RE=j(11363),PE=j(11252);PE.d.prototype.createTransformFeedback=function(){const I=this._gl.createTransformFeedback();if(!I)throw new Error("Unable to create Transform Feedback");return I},PE.d.prototype.deleteTransformFeedback=function(I){this._gl.deleteTransformFeedback(I)},PE.d.prototype.bindTransformFeedback=function(I){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,I)},PE.d.prototype.beginTransformFeedback=function(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(I?this._gl.POINTS:this._gl.TRIANGLES)},PE.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},PE.d.prototype.setTranformFeedbackVaryings=function(I,E){this._gl.transformFeedbackVaryings(I,E,this._gl.INTERLEAVED_ATTRIBS)},PE.d.prototype.bindTransformFeedbackBuffer=function(I){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I?I.underlyingResource:null)},PE.d.prototype.readTransformFeedbackBuffer=function(I){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,I)};const oE="clipPlaneFragmentDeclaration2",ZE="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";G.e.IncludesShadersStore[oE]||(G.e.IncludesShadersStore[oE]=ZE);j(12434),j(12441),j(12444),j(12447),j(12456),j(12458),j(12460),j(12463);const cE="gpuRenderParticlesPixelShader",KE="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";G.e.ShadersStore[cE]||(G.e.ShadersStore[cE]=KE);const LE="clipPlaneVertexDeclaration2",FE="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";G.e.IncludesShadersStore[LE]||(G.e.IncludesShadersStore[LE]=FE);j(12472),j(12476),j(12482),j(12487);const CE="gpuRenderParticlesVertexShader",XE="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";G.e.ShadersStore[CE]||(G.e.ShadersStore[CE]=XE);class qE extends U{static get IsSupported(){if(!N.d.LastCreatedEngine)return!1;const I=N.d.LastCreatedEngine.getCaps();return I.supportTransformFeedbacks||I.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(I){this._maxActiveParticleCount=Math.min(I,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(I){this.maxActiveParticleCount=I}createPointEmitter(I,E){const j=DI(I,E);return this.particleEmitterType=j,j}createHemisphericEmitter(){const I=kI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createSphereEmitter(){const I=JI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=I,I}createDirectedSphereEmitter(){const I=NI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e.LE(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0));return this.particleEmitterType=I,I}createCylinderEmitter(){const I=mI(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=I,I}createDirectedCylinderEmitter(){const I=IE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new e.LE(0,1,0));return this.particleEmitterType=I,I}createConeEmitter(){const I=EE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=I,I}createDirectedConeEmitter(){const I=jE(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e.LE(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e.LE(0,1,0));return this.particleEmitterType=I,I}createBoxEmitter(I,E,j,e){const w=new o;return this.particleEmitterType=w,this.direction1=I,this.direction2=E,this.minEmitBox=j,this.maxEmitBox=e,w}get flowMap(){return this._flowMap}set flowMap(I){this._flowMap!==I&&(this._flowMap=I)}isReady(){if(!this.wE||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==tE.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(tE.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(tE.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";I?setTimeout((()=>{this.start(0)}),I):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var I;let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(I=this._customWrappers[E])||void 0===I?void 0:I.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[I]??this._customWrappers[0]}setCustomEffect(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[E]=new II.e(this._engine),this._customWrappers[E].effect=I}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new k.e),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(I,E,j){return super._removeGradientAndTexture(I,E,j),this._releaseBuffers(),this}addColorGradient(I,E){this._colorGradients||(this._colorGradients=[]);const j=new S(I,E);return this._colorGradients.push(j),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(I&&this._colorGradients.sort(((I,E)=>I.gradient<E.gradient?-1:I.gradient>E.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(I){return this._removeGradientAndTexture(I,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const E in this._drawWrappers){var I;null===(I=this._drawWrappers[E].drawContext)||void 0===I||I.reset()}}_addFactorGradient(I,E,j){const e=new p(E,j);I.push(e),this._releaseBuffers()}addSizeGradient(I,E){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,I,E),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(I){return this._removeGradientAndTexture(I,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(I,E){if(!I)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&I.sort(((I,E)=>I.gradient<E.gradient?-1:I.gradient>E.gradient?1:0));const j=this;j[E]&&(j[E].dispose(),j[E]=null)}addAngularSpeedGradient(I,E){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,I,E),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(I){return this._removeGradientAndTexture(I,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(I,E){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,I,E),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(I){return this._removeGradientAndTexture(I,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(I,E){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,I,E),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(I){return this._removeGradientAndTexture(I,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(I,E){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,I,E),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(I){return this._removeGradientAndTexture(I,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(I){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(I,E,j){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(I),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Le=new k.e,this.onStoppedObservable=new k.e,this.onStartedObservable=new k.e,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,j&&"Scene"!==j.getClassName()?(this._engine=j,this.defaultProjectionMatrix=e.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=j||N.d.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.hZ.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,t.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,t.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,t.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,t.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new II.e(this._engine)},this._customWrappers[0].effect=w,this._drawWrappers={0:new II.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(E=E??{}).randomTextureSize||delete E.randomTextureSize;const h={Pj:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...E},U=E;isFinite(U)&&(h.Pj=U),this._capacity=h.Pj,this._maxActiveParticleCount=h.Pj,this._currentActiveCount=0,this._isAnimationSheetEnabled=z,this.particleEmitterType=new o;const R=Math.min(this._engine.getCaps().maxTextureSize,h.randomTextureSize);let P=[];for(let e=0;e<R;++e)P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random());this._randomTexture=new J.c(new Float32Array(P),R,1,5,j,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,P=[];for(let e=0;e<R;++e)P.push(Math.random()),P.push(Math.random()),P.push(Math.random()),P.push(Math.random());this._randomTexture2=new J.c(new Float32Array(P),R,1,5,j,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=R}_reset(){this._releaseBuffers()}_createVertexBuffers(I,E,j){const e={};e.position=E.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let w=3;e.age=E.createVertexBuffer("age",w,1,this._attributesStrideSize,!0),w+=1,e.size=E.createVertexBuffer("size",w,3,this._attributesStrideSize,!0),w+=3,e.life=E.createVertexBuffer("life",w,1,this._attributesStrideSize,!0),w+=1,w+=4,this.billboardMode===tE.BILLBOARDMODE_STRETCHED&&(e.direction=E.createVertexBuffer("direction",w,3,this._attributesStrideSize,!0)),w+=3,this._platform.alignDataInBuffer&&(w+=1),this.particleEmitterType instanceof x&&(w+=3,this._platform.alignDataInBuffer&&(w+=1)),this._colorGradientsTexture||(e.color=E.createVertexBuffer("color",w,4,this._attributesStrideSize,!0),w+=4),this._isBillboardBased||(e.initialDirection=E.createVertexBuffer("initialDirection",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1)),this.noiseTexture&&(e.noiseCoordinates1=E.createVertexBuffer("noiseCoordinates1",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1),e.noiseCoordinates2=E.createVertexBuffer("noiseCoordinates2",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1)),e.angle=E.createVertexBuffer("angle",w,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?w++:w+=2,this._isAnimationSheetEnabled&&(e.cellIndex=E.createVertexBuffer("cellIndex",w,1,this._attributesStrideSize,!0),w+=1,this.spriteRandomStartCell&&(e.cellStartOffset=E.createVertexBuffer("cellStartOffset",w,1,this._attributesStrideSize,!0),w+=1)),e.offset=j.createVertexBuffer("offset",0,2),e.uv=j.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(e),this._platform.createVertexBuffers(I,e),this.resetDrawCache()}_initialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!I)return;const E=this._engine,j=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof x&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const w=this.particleEmitterType instanceof x,z=e.TmpVectors.LE[0];let h=0;for(let e=0;e<this._capacity;e++)if(j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),w?(this.particleEmitterType.particleDestinationGenerator(e,null,z),j.push(z.x),j.push(z.y),j.push(z.z)):(j.push(0),j.push(0),j.push(0)),this._platform.alignDataInBuffer&&j.push(0),h+=16,w&&(this.particleEmitterType.particlePositionGenerator(e,null,z),j.push(z.x),j.push(z.y),j.push(z.z),this._platform.alignDataInBuffer&&j.push(0),h+=4),this._colorGradientsTexture||(j.push(0),j.push(0),j.push(0),j.push(0),h+=4),this.isBillboardBased||(j.push(0),j.push(0),j.push(0),this._platform.alignDataInBuffer&&j.push(0),h+=4),this.noiseTexture&&(j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),j.push(Math.random()),j.push(Math.random()),j.push(Math.random()),this._platform.alignDataInBuffer&&j.push(0),h+=8),j.push(0),h+=1,this._angularSpeedGradientsTexture||(j.push(0),h+=1),this._isAnimationSheetEnabled&&(j.push(0),h+=1,this.spriteRandomStartCell&&(j.push(0),h+=1)),this._platform.alignDataInBuffer){let I=3-(h+3&3);for(h+=I;I-- >0;)j.push(0)}const t=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),U=this._platform.createParticleBuffer(j),R=this._platform.createParticleBuffer(j);this._buffer0=new u.c(E,U,!1,this._attributesStrideSize),this._buffer1=new u.c(E,R,!1,this._attributesStrideSize),this._spriteBuffer=new u.c(E,t,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let I=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(I+="\n#define BILLBOARD"),this._colorGradientsTexture&&(I+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(I+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(I+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(I+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(I+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(I+="\n#define DRAGGRADIENTS"),this._flowMap&&(I+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(I+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(I+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(I+="\n#define NOISE"),this.isLocal&&(I+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===I||(this._cachedUpdateDefines=I,this._updateBuffer=this._platform.createUpdateBuffer(I)),this._platform.isUpdateBufferReady()}_getWrapper(I){const E=this._getCustomDrawWrapper(I);if(null!==E&&void 0!==E&&E.effect)return E;const j=[];this.fillDefines(j,I);let e=this._drawWrappers[I];e||(e=new II.e(this._engine),e.drawContext&&(e.drawContext.useInstancing=!0),this._drawWrappers[I]=e);const w=j.join("\n");if(e.defines!==w){const I=[],E=[],j=[];this.fillUniformsAttributesAndSamplerNames(E,I,j),e.setEffect(this._engine.createEffect("gpuRenderParticles",I,E,j,w),w)}return e}static _GetAttributeNamesOrOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const w=[u.e.PositionKind,"age","life","size","angle"];return I||w.push(u.e.ColorKind),E&&w.push("cellIndex"),j||w.push("initialDirection"),e&&w.push("direction"),w.push("offset",u.e.UVKind),w}static _GetEffectCreationOptions(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0],E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=["emitterWM","bR","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,EI.d)(e),I&&e.push("sheetInfos"),E&&e.push("logarithmicDepthConstant"),j&&(e.push("vFogInfos"),e.push("vFogColor")),e}fillDefines(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,EI.l)(this,this._scene,I),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==RE.c.FOGMODE_NONE&&I.push("#define FOG")),E===tE.BLENDMODE_MULTIPLY&&I.push("#define BLENDMULTIPLYMODE"),this.isLocal&&I.push("#define LOCAL"),this.useLogarithmicDepth&&I.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(I.push("#define BILLBOARD"),this.billboardMode){case tE.BILLBOARDMODE_Y:I.push("#define BILLBOARDY");break;case tE.BILLBOARDMODE_STRETCHED:I.push("#define BILLBOARDSTRETCHED");break;case tE.BILLBOARDMODE_ALL:I.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&I.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&I.push("#define ANIMATESHEET"),j&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),I.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(I,E,j){E.push(...qE._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===tE.BILLBOARDMODE_STRETCHED)),I.push(...qE._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),j.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(UE.e.PrepareUniforms(I,this._imageProcessingConfigurationDefines),UE.e.PrepareSamplers(j,this._imageProcessingConfigurationDefines))}animate(){var I;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(E?this.preWarmStepOffset:(null===(I=this._scene)||void 0===I?void 0:I.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(I,E){const j=this[E];if(!I||!I.length||j)return;const e=new Float32Array(this._rawTextureWidth);for(let w=0;w<this._rawTextureWidth;w++){const E=w/this._rawTextureWidth;D.GetCurrentGradient(E,I,((I,E,j)=>{e[w]=(0,R.Lerp)(I.factor1,E.factor1,j)}))}this[E]=J.c.CreateRTexture(e,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[E].name=E.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const I=new Uint8Array(4*this._rawTextureWidth),E=h.TmpColors.hh[0];for(let j=0;j<this._rawTextureWidth;j++){const e=j/this._rawTextureWidth;D.GetCurrentGradient(e,this._colorGradients,((e,w,z)=>{h.hh.LerpToRef(e.color1,w.color1,z,E),I[4*j]=255*E.r,I[4*j+1]=255*E.g,I[4*j+2]=255*E.b,I[4*j+3]=255*E.a}))}this._colorGradientsTexture=J.c.CreateRGBATexture(I,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(I,E){var j,w,z,h;const t=this._getWrapper(I),U=t.effect;this._engine.enableEffect(t);const R=(null===(j=this._scene)||void 0===j?void 0:j.getViewMatrix())||e.Matrix.IdentityReadOnly;if(U.setMatrix("view",R),U.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),U.setTexture("diffuseSampler",this.particleTexture),U.setVector2("translationPivot",this.translationPivot),U.setVector3("bR",this.bR),this.isLocal&&U.setMatrix("emitterWM",E),this._colorGradientsTexture?U.setTexture("colorGradientSampler",this._colorGradientsTexture):U.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const I=this.particleTexture.getBaseSize();U.setFloat3("sheetInfos",this.spriteCellWidth/I.width,this.spriteCellHeight/I.height,I.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const I=this._scene.activeCamera;U.setVector3("eyePosition",I.globalPosition)}const P=U.defines;if(this._scene&&((0,EI.f)(U,this,this._scene),this.applyFog&&(0,jI.d)(this._scene,void 0,U)),P.indexOf("#define BILLBOARDMODE_ALL")>=0){const I=R.clone();I.invert(),U.setMatrix("invView",I)}return this.useLogarithmicDepth&&this._scene&&(0,jI.g)(P,U,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(U),this._setEngineBasedOnBlendMode(I),this._platform.bindDrawBuffers(this._targetIndex,U,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(U),null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(h=this._scene)&&void 0!==h&&h.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(I){if(!this.wE||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!I)if(this.wE.position){I=this.wE.getWorldMatrix()}else{const E=this.wE;I=e.TmpVectors.Matrix[0],e.Matrix.TranslationToRef(E.x,E.y,E.z,I)}const E=this._engine,j=E.getDepthWrite();if(E.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const I=this.GI();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",I.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",I),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const w=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=w,E.setDepthWrite(j)}render(){let I,E=arguments.length>0&&void 0!==arguments[0]&&arguments[0],j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!E&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let I=0;I<this.preWarmCycles;I++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const I=0|this._accumulatedCount;this._accumulatedCount-=I,this._currentActiveCount+=I}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.wE.position){I=this.wE.getWorldMatrix()}else{const E=this.wE;I=e.TmpVectors.Matrix[0],e.Matrix.TranslationToRef(E.x,E.y,E.z,I)}const w=this._engine;this.updateInAnimate||this._update(I);let z=0;return E||j||(w.setState(!1),this.forceDepthWrite&&w.setDepthWrite(!0),z=this.blendMode===tE.BLENDMODE_MULTIPLYADD?this._render(tE.BLENDMODE_MULTIPLY,I)+this._render(tE.BLENDMODE_ADD,I):this._render(this.blendMode,I),this._engine.setAlphaMode(0)),z}rebuild(){const I=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(I,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,I()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const E in this._drawWrappers){this._drawWrappers[E].dispose()}if(this._drawWrappers={},this._scene){const I=this._scene.hZ.indexOf(this);I>-1&&this._scene.hZ.splice(I,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let E=0;E<this._renderVertexBuffers.length;++E){const I=this._renderVertexBuffers[E];for(const E in I)I[E].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),I&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),I&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Le.notifyObservers(this),this.Le.clear()}clone(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e={...this._customWrappers};let w=null;const z=this._engine;if(z.createEffectForParticles&&null!=this.customShader){w=this.customShader;const I=w.shaderOptions.defines.length>0?w.shaderOptions.defines.join("\n"):"";e[0]=z.createEffectForParticles(w.shaderPath.fragmentElement,w.shaderOptions.uniforms,w.shaderOptions.samplers,I,void 0,void 0,void 0,this)}const h=this.serialize(j),t=qE.Parse(h,this._scene||this._engine,this._rootUrl);return t.name=I,t.customShader=w,t._customWrappers=e,void 0===E&&(E=this.wE),this.noiseTexture&&(t.noiseTexture=this.noiseTexture.clone()),t.wE=E,t}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={};return tE._Serialize(E,this,I),E.activeParticleCount=this.activeParticleCount,E.randomTextureSize=this._randomTextureSize,E.customShader=this.customShader,E}static Parse(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0;const z=I.name;let h,t;E instanceof pI.c?h=E:(t=E,h=t.getEngine());const U=new qE(z,{Pj:w||I.Pj,randomTextureSize:I.randomTextureSize},E,null,I.isAnimationSheetEnabled);if(U._rootUrl=j,I.customShader&&h.createEffectForParticles){const E=I.customShader,j=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",e=h.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,j,void 0,void 0,void 0,U);U.setCustomEffect(e,0),U.customShader=E}return I.id&&(U.id=I.id),I.activeParticleCount&&(U.activeParticleCount=I.activeParticleCount),tE._Parse(I,U,E,j),I.preventAutoStart&&(U.preventAutoStart=I.preventAutoStart),e||U.preventAutoStart||U.start(),U}}var xE=j(10953),uE=j(12489),bE=j(11480);class QE{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(I){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const E of this.systems)E.wE=I;this._emitterNode=I}setEmitterAsSphere(I,E,j){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:I,renderingGroupId:E};const e=(0,uE.e)("emitterSphere",{diameter:I.diameter,segments:I.segments},j);e.renderingGroupId=E;const w=new bE.XE("emitterSphereMaterial",j);w.emissiveColor=I.color,e.material=w;for(const z of this.systems)z.wE=e;this._emitterNode=e}start(I){for(const E of this.systems)I&&(E.wE=I),E.start()}dispose(){for(const I of this.systems)I.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const E={systems:[]};for(const j of this.systems)E.systems.push(j.serialize(I));return this._emitterNode&&(E.wE=this._emitterCreationOptions),E}static Parse(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;const w=new QE,z=this.BaseAssetsUrl+"/textures/";E=E||N.d.LastCreatedScene;for(const h of I.systems)w.systems.push(j?qE.Parse(h,E,z,!0,e):tE.Parse(h,E,z,!0,e));if(I.wE){const j=I.wE.options;if("Sphere"===I.wE.kind)w.setEmitterAsSphere({diameter:j.diameter,segments:j.segments,color:h.qE.xE(j.color)},I.wE.renderingGroupId,E)}return w}}QE.BaseAssetsUrl="https://assets.babylonjs.com/particles";var GE=j(10988);class yE{static CreateDefault(I){let E,j=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,e=arguments.length>2?arguments[2]:void 0;E=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new qE("default system",{Pj:j},e):new tE("default system",j,e),E.wE=I;const w=xE.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return E.particleTexture=new g.d(w,E.GI()),E.createConeEmitter(.1,Math.PI/4),E.color1=new h.hh(1,1,1,1),E.color2=new h.hh(1,1,1,1),E.colorDead=new h.hh(1,1,1,0),E.minSize=.1,E.maxSize=.1,E.minEmitPower=2,E.maxEmitPower=2,E.updateSpeed=1/60,E.emitRate=30,E}static CreateAsync(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;E||(E=N.d.LastCreatedScene);const w={};return E.addPendingData(w),new Promise(((z,h)=>{if(j&&!qE.IsSupported)return E.removePendingData(w),h("Particle system with GPU is not supported.");xE.Tools.LoadFile(`${yE.BaseAssetsUrl}/systems/${I}.json`,(I=>{E.removePendingData(w);const h=JSON.parse(I.toString());return z(QE.Parse(h,E,j,e))}),void 0,void 0,void 0,(()=>(E.removePendingData(w),h(`An error occurred with the creation of your particle system. Check if your type '${I}' exists.`))))}))}static ExportSet(I){const E=new QE;for(const j of I)E.systems.push(j);return E}static ParseFromFileAsync(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",z=arguments.length>5?arguments[5]:void 0;return new Promise(((h,t)=>{const U=new GE.c;U.addEventListener("readystatechange",(()=>{if(4==U.readyState)if(200==U.status){const E=JSON.parse(U.responseText);let t;t=e?qE.Parse(E,j,w,!1,z):tE.Parse(E,j,w,!1,z),I&&(t.name=I),h(t)}else t("Unable to load the particle system")})),U.open("GET",E),U.send()}))}static ParseFromSnippetAsync(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",w=arguments.length>4?arguments[4]:void 0;if("_BLANK"===I){const I=this.CreateDefault(null);return I.start(),Promise.resolve(I)}return new Promise(((z,h)=>{const t=new GE.c;t.addEventListener("readystatechange",(()=>{if(4==t.readyState)if(200==t.status){const h=JSON.parse(JSON.parse(t.responseText).jsonPayload),U=JSON.parse(h.particleSystem);let R;R=j?qE.Parse(U,E,e,!1,w):tE.Parse(U,E,e,!1,w),R.snippetId=I,z(R)}else h("Unable to load the snippet "+I)})),t.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),t.send()}))}}yE.BaseAssetsUrl=QE.BaseAssetsUrl,yE.SnippetUrl="https://snippet.babylonjs.com",yE.CreateFromSnippetAsync=yE.ParseFromSnippetAsync;var dE=j(11562),aE=j(11389),lE=j(12495);(0,lE.e)(aE.b.NAME_PARTICLESYSTEM,((I,E,j,e)=>{const w=(0,lE.g)(aE.b.NAME_PARTICLESYSTEM);if(w&&void 0!==I.hZ&&null!==I.hZ)for(let z=0,h=I.hZ.length;z<h;z++){const h=I.hZ[z];j.hZ.push(w(h,E,e))}})),(0,lE.c)(aE.b.NAME_PARTICLESYSTEM,((I,E,j)=>{if(I.activeParticleCount){return qE.Parse(I,E,j)}return tE.Parse(I,E,j)})),pI.c.prototype.createEffectForParticles=function(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",z=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0,t=arguments.length>6?arguments[6]:void 0,U=arguments.length>7?arguments[7]:void 0,R=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,P=arguments.length>9?arguments[9]:void 0,o=[],Z=[];const c=[];return U?U.fillUniformsAttributesAndSamplerNames(Z,o,c):(o=tE._GetAttributeNamesOrOptions(),Z=tE._GetEffectCreationOptions()),-1===w.indexOf(" BILLBOARD")&&(w+="\n#define BILLBOARD\n"),null!==U&&void 0!==U&&U.isAnimationSheetEnabled&&-1===w.indexOf(" ANIMATESHEET")&&(w+="\n#define ANIMATESHEET\n"),-1===e.indexOf("diffuseSampler")&&e.push("diffuseSampler"),this.createEffect({vertex:P??(null===U||void 0===U?void 0:U.vertexShaderName)??"particles",fragmentElement:I},o,Z.concat(E),c.concat(e),w,z,h,t,void 0,R,(async()=>{0===R?await Promise.resolve().then(j.bind(j,12520)):await Promise.resolve().then(j.bind(j,12599))}))},dE.d.prototype.getEmittedParticleSystems=function(){const I=[];for(let E=0;E<this.GI().hZ.length;E++){const j=this.GI().hZ[E];j.wE===this&&I.push(j)}return I},dE.d.prototype.getHierarchyEmittedParticleSystems=function(){const I=[],E=this.getDescendants();E.push(this);for(let j=0;j<this.GI().hZ.length;j++){const e=this.GI().hZ[j],w=e.wE;w.position&&-1!==E.indexOf(w)&&I.push(e)}return I};j(11446),j(11462),j(11535);j(11542),j(12499),j(11319),j(11438),j(11585);j(11316);var iE;j(12507),j(11139);!function(I){I[I.Color=2]="Color",I[I.UV=1]="UV",I[I.Random=0]="Random",I[I.Stated=3]="Stated"}(iE||(iE={}));var rE=j(11348);const nE=new e.LE(0,0,0),HE=new e.LE(0,0,0),gE=new e.LE(0,0,0);class YE{constructor(I,E,j){this.width=I,this.height=E,this.data=j}processFlowable(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;if(!j)return;j instanceof e.Matrix?e.LE.TransformCoordinatesToRef(I.position,j,gE):(gE.x=j.x,gE.y=j.y,gE.z=j.z);const w=.5*gE.x+.5,z=1-(.5*gE.y+.5),h=Math.floor(w*this.width),t=Math.floor(z*this.height);if(h<0||h>=this.width||t<0||t>=this.height)return;const U=4*(t*this.width+h),R=this.data[U]/255*2-1,P=this.data[U+1]/255*2-1,o=this.data[U+2]/255*2-1,Z=this.data[U+3]/255;nE.set(R,P,o),nE.scaleToRef(E*Z,HE),I.direction.addInPlace(HE)}_processParticle(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,j=arguments.length>2?arguments[2]:void 0;this.processFlowable(I,E,j)}static async FromUrlAsync(I){return await new Promise(((E,j)=>{const e=document.createElement("canvas"),w=e.getContext("2d");let z=null;const h=new Image;h.crossOrigin="anonymous",h.src=I,h.onerror=E=>{j(new Error(`Failed to load image: ${I} : ${E}`))},h.onload=()=>{e.width=h.width,e.height=h.height,w.drawImage(h,0,0),z=w.getImageData(0,0,e.width,e.height),E(new YE(e.width,e.height,z.data))}}))}static async ExtractFromTextureAsync(I){return await new Promise(((E,j)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{const j=await this.ExtractFromTextureAsync(I);E(j)}catch(e){j(e)}}));const e=I.getSize();rE.l.GetTextureDataAsync(I,e.width,e.height).then((I=>{E(new YE(e.width,e.height,new Uint8ClampedArray(I)))})).catch(j)}))}}var AE,TE,ME,WE,OE,sE,vE,VE,fE;!function(I){I[I.Int=1]="Int",I[I.Float=2]="Float",I[I.Vector2=4]="Vector2",I[I.LE=8]="LE",I[I.Matrix=16]="Matrix",I[I.Particle=32]="Particle",I[I.Texture=64]="Texture",I[I.hh=128]="hh",I[I.FloatGradient=256]="FloatGradient",I[I.Vector2Gradient=512]="Vector2Gradient",I[I.Vector3Gradient=1024]="Vector3Gradient",I[I.Color4Gradient=2048]="Color4Gradient",I[I.System=4096]="System",I[I.AutoDetect=8192]="AutoDetect",I[I.BasedOnInput=16384]="BasedOnInput",I[I.Undefined=32768]="Undefined",I[I.All=65535]="All"}(AE||(AE={})),function(I){I[I.Compatible=0]="Compatible",I[I.TypeIncompatible=1]="TypeIncompatible",I[I.HierarchyIssue=2]="HierarchyIssue"}(TE||(TE={})),function(I){I[I.Input=0]="Input",I[I.Output=1]="Output"}(ME||(ME={}));class SE{get direction(){return this._direction}get type(){if(this._type===AE.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===AE.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(I){this._type=I}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((I=>I.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(I,E,j){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=AE.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new k.e,this.onDisconnectionObservable=new k.e,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=E,this.name=I,this._direction=j}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(I){var E;return this.isConnected?null!==(E=this._connectedPoint)&&void 0!==E&&E._storedFunction?this._connectedPoint._storedFunction(I):this._connectedPoint._storedValue:this.value}canConnectTo(I){return 0===this.checkCompatibilityState(I)}checkCompatibilityState(I){const E=this._ownerBlock,j=I.ownerBlock;if(this.type!==I.type&&I.innerType!==AE.AutoDetect)return I.acceptedConnectionPointTypes&&-1!==I.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(I.excludedConnectionPointTypes&&-1!==I.excludedConnectionPointTypes.indexOf(this.type))return 1;let e=j,w=E;return 0===this.direction&&(e=E,w=j),e.isAnAncestorOf(w)?2:0}connectTo(I){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(I))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${I.ownerBlock.name}".${I.name}`;return this._endpoints.push(I),I._connectedPoint=this,this.onConnectionObservable.notifyObservers(I),I.onConnectionObservable.notifyObservers(this),this}disconnectFrom(I){const E=this._endpoints.indexOf(I);return-1===E||(this._endpoints.splice(E,1),I._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(I),I.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(I){let E=1;for(;E<AE.All;)I&E||this.excludedConnectionPointTypes.push(E),E<<=1}serialize(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const E={};return E.name=this.name,E.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.re?(E.valueType="BABYLON."+this.value.getClassName(),E.value=this.value.re()):(E.valueType="number",E.value=this.value)),I&&this.connectedPoint&&(E.inputName=this.name,E.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,E.targetConnectionName=this.connectedPoint.name,E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(E.isExposedOnFrame=!0,E.exposedPortPosition=this.exposedPortPosition),E}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class BE{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(I){this._name=I}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(I){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new k.e,this.Le=new k.e,this.onInputChangedObservable=new k.e,this.visibleOnFrame=!1,this._name=I,this.uniqueId=Y.e.UniqueId}_inputRename(I){return I}_outputRename(I){return I}isAnAncestorOf(I){for(const E of this._outputs)if(E.hasEndpoints)for(const j of E.endpoints){if(j.ownerBlock===I)return!0;if(j.ownerBlock.isAnAncestorOf(I))return!0}return!1}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const E of this._outputs)if(E.hasEndpoints)for(const j of E.endpoints)if(j.ownerBlock.isAnAncestorOfType(I))return!0;return!1}getInputByName(I){const E=this._inputs.filter((E=>E.name===I));return E.length?E[0]:null}_linkConnectionTypes(I,E){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[E]._acceptedConnectionPointType=this._inputs[I]:(this._inputs[I]._linkedConnectionSource=this._inputs[E],this._inputs[I]._isMainLinkSource=!0),this._inputs[E]._linkedConnectionSource=this._inputs[I]}registerInput(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0,z=arguments.length>5?arguments[5]:void 0;const h=new SE(I,this,0);return h.type=E,h.isOptional=j,h.defaultValue=e,h.value=e,h.valueMin=w,h.valueMax=z,this._inputs.push(h),this.onInputChangedObservable.notifyObservers(h),this}registerOutput(I,E,j){return(j=j??new SE(I,this,1)).type=E,this._outputs.push(j),this}_build(I){}_customBuildStep(I){}build(I){if(this._buildId===I.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((I=>I.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=I.buildId;for(const E of this._inputs){if(!E.connectedPoint){E.isOptional||I.notConnectedNonOptionalInputs.push(E);continue}const j=E.connectedPoint.ownerBlock;j&&j!==this&&!j.isSystem&&j.build(I)}return this._customBuildStep(I),I.verbose&&A.b.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(I),this.onBuildObservable.notifyObservers(this),!1}serialize(){const I={};I.customType="BABYLON."+this.getClassName(),I.id=this.uniqueId,I.name=this.name,I.visibleOnFrame=this.visibleOnFrame,I.inputs=[],I.outputs=[];for(const E of this.inputs)I.inputs.push(E.serialize());for(const E of this.outputs)I.outputs.push(E.serialize(!1));return I}_deserialize(I){this._name=I.name,this.comments=I.comments,this.visibleOnFrame=!!I.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(I)}_deserializePortDisplayNamesAndExposedOnFrame(I){const E=I.inputs,j=I.outputs;if(E)for(const e of E){const I=this.inputs.find((I=>I.name===e.name));if(!I)return;if(e.displayName&&(I.displayName=e.displayName),e.isExposedOnFrame&&(I.isExposedOnFrame=e.isExposedOnFrame,I.exposedPortPosition=e.exposedPortPosition),void 0!==e.value&&null!==e.value)if("number"===e.valueType)I.value=e.value;else{const E=(0,t.e)(e.valueType);E&&(I.value=E.xE(e.value))}}if(j)for(let e=0;e<j.length;e++){const I=j[e];I.displayName&&(this.outputs[e].displayName=I.displayName),I.isExposedOnFrame&&(this.outputs[e].isExposedOnFrame=I.isExposedOnFrame,this.outputs[e].exposedPortPosition=I.exposedPortPosition)}}clone(){const I=this.serialize(),E=(0,t.e)(I.customType);if(E){const j=new E;return j._deserialize(I),j}return null}dispose(){this.Le.notifyObservers(this),this.Le.clear();for(const I of this.inputs)I.dispose();for(const I of this.outputs)I.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function pE(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",e=arguments.length>3?arguments[3]:void 0;return(w,z)=>{let h=w._propStore;h||(h=[],w._propStore=h),h.push({propertyName:z,displayName:I,type:E,groupName:j,options:e??{},className:w.getClassName()})}}(0,r.b)([(0,n.N)("comment")],BE.prototype,"comments",void 0),function(I){I[I.Boolean=0]="Boolean",I[I.Float=1]="Float",I[I.Int=2]="Int",I[I.Vector2=3]="Vector2",I[I.List=4]="List",I[I.hh=5]="hh",I[I.SamplingMode=6]="SamplingMode",I[I.TextureFormat=7]="TextureFormat",I[I.TextureType=8]="TextureType"}(WE||(WE={})),function(I){I[I.None=0]="None",I[I.Position=1]="Position",I[I.Direction=2]="Direction",I[I.Age=3]="Age",I[I.Lifetime=4]="Lifetime",I[I.Color=5]="Color",I[I.ScaledDirection=6]="ScaledDirection",I[I.Scale=7]="Scale",I[I.AgeGradient=8]="AgeGradient",I[I.Angle=9]="Angle",I[I.SpriteCellIndex=16]="SpriteCellIndex",I[I.SpriteCellStart=17]="SpriteCellStart",I[I.SpriteCellEnd=18]="SpriteCellEnd"}(OE||(OE={})),function(I){I[I.None=0]="None",I[I.Time=1]="Time",I[I.Delta=2]="Delta",I[I.Emitter=3]="Emitter"}(sE||(sE={}));class DE{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let I="";for(const E of this.notConnectedNonOptionalInputs)I+=`input ${E.name} from block ${E.ownerBlock.name}[${E.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(I)throw"Build of Node Particle System Set failed:\n"+I}adapt(I,E){const j=I.getConnectedValue(this)||0;if(I.type===E)return j;switch(E){case AE.Vector2:return new e.Vector2(j,j);case AE.LE:return new e.LE(j,j,j);case AE.hh:return new h.hh(j,j,j,j)}return null}getContextualValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case OE.Position:return this.particleContext.position;case OE.Direction:return this.particleContext.direction;case OE.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case OE.Color:return this.particleContext.color;case OE.Age:return this.particleContext.age;case OE.Lifetime:return this.particleContext.lifeTime;case OE.Angle:return this.particleContext.angle;case OE.Scale:return this.particleContext.scale;case OE.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case OE.SpriteCellEnd:return this.systemContext.endSpriteCellID;case OE.SpriteCellIndex:return this.particleContext.cellIndex;case OE.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.wE.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.wE.absolutePosition:this.systemContext.wE:null}getSystemValue(I){if(!this.particleContext||!this.systemContext)return null;switch(I){case sE.Time:return this.systemContext._actualFrame;case sE.Delta:return this.systemContext._scaledUpdateSpeed;case sE.Emitter:if(this.isEmitterTransformNode){return this.systemContext.wE.absolutePosition}return this.systemContext.wE}return null}}function kE(I,E,j){const e=new DE;e.CE=E;const w=I.createSystem(e);return w.canStart=()=>!0,w.wE=j.clone(),w.disposeOnStop=!0,w.start(),w}class JE extends BE{constructor(I){super(I),this.blendMode=U.BLENDMODE_ONEONE,this.Pj=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",AE.Particle),this.registerInput("texture",AE.Texture),this.registerInput("onStart",AE.System,!0),this.registerInput("onEnd",AE.System,!0),this.registerOutput("system",AE.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(I){I.Pj=this.Pj,I.buildId=this._buildId++,this.build(I);const E=this.particle.getConnectedValue(I);return E.particleTexture=this.texture.getConnectedValue(I),E.emitRate=this.emitRate,E.blendMode=this.blendMode,E.name=this.name,E._nodeGenerated=!0,E._targetStopDuration=this.targetStopDuration,E.startDelay=this.startDelay,this.system._storedValue=this,E.canStart=()=>!this.doNoStart,E.onStartedObservable.add((j=>{const e=this.onStart.getConnectedValue(I);e&&j.onStartedObservable.addOnce((()=>{I.systemContext=E;const j=kE(e,I.CE,I.emitterPosition);this.Le.addOnce((()=>{j.dispose()}))}));const w=this.onEnd.getConnectedValue(I);w&&j.onStoppedObservable.addOnce((()=>{I.systemContext=E;const j=kE(w,I.CE,I.emitterPosition);this.Le.addOnce((()=>{j.dispose()}))}))})),this.Le.addOnce((()=>{E.dispose()})),E}serialize(){const I=super.serialize();return I.Pj=this.Pj,I.emitRate=this.emitRate,I.blendMode=this.blendMode,I.doNoStart=this.doNoStart,I.targetStopDuration=this.targetStopDuration,I.startDelay=this.startDelay,I}_deserialize(I){super._deserialize(I),this.Pj=I.Pj,this.emitRate=I.emitRate,this.doNoStart=!!I.doNoStart,void 0!==I.blendMode&&(this.blendMode=I.blendMode),void 0!==I.targetStopDuration&&(this.targetStopDuration=I.targetStopDuration),void 0!==I.startDelay&&(this.startDelay=I.startDelay)}}(0,r.b)([pE("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:U.BLENDMODE_ONEONE},{label:"Standard",value:U.BLENDMODE_STANDARD},{label:"Add",value:U.BLENDMODE_ADD},{label:"Multiply",value:U.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:U.BLENDMODE_MULTIPLYADD}]})],JE.prototype,"blendMode",void 0),(0,r.b)([pE("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],JE.prototype,"Pj",void 0),(0,r.b)([pE("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JE.prototype,"emitRate",void 0),(0,r.b)([pE("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JE.prototype,"targetStopDuration",void 0),(0,r.b)([pE("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],JE.prototype,"startDelay",void 0),(0,r.b)([pE("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],JE.prototype,"doNoStart",void 0),(0,t.h)("BABYLON.SystemBlock",JE);class NE extends BE{get type(){if(this._type===AE.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=AE.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=AE.Vector2,this._type;case"LE":return this._type=AE.LE,this._type;case"hh":return this._type=AE.hh,this._type;case"Matrix":return this._type=AE.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===OE.None&&this._systemSource!==sE.None}get systemSource(){return this._systemSource}set systemSource(I){if(this._systemSource=I,I!==sE.None){switch(this._contextualSource=OE.None,this._type=AE.Float,I){case sE.Time:case sE.Delta:this._type=AE.Float;break;case sE.Emitter:this._type=AE.LE}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==OE.None}get contextualValue(){return this._contextualSource}set contextualValue(I){if(this._contextualSource=I,I!==OE.None){switch(this._systemSource=sE.None,I){case OE.Scale:this._type=AE.Vector2;break;case OE.Position:case OE.Direction:case OE.ScaledDirection:this._type=AE.LE;break;case OE.Color:this._type=AE.hh;break;case OE.Age:case OE.Lifetime:case OE.Angle:case OE.AgeGradient:this._type=AE.Float;break;case OE.SpriteCellEnd:case OE.SpriteCellStart:case OE.SpriteCellIndex:this._type=AE.Int}this.output&&(this.output.type=this._type)}}constructor(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:AE.AutoDetect;super(I),this._type=AE.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new k.e,this._systemSource=sE.None,this._contextualSource=OE.None,this._type=E,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",E)}get value(){return this._storedValue}set value(I){this.type===AE.Float&&this.min!==this.max&&(I=Math.max(this.min,I),I=Math.min(this.max,I)),this._storedValue=I,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(I){this._valueCallback=I}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case AE.Int:case AE.Float:this.value=0;break;case AE.Vector2:this.value=e.Vector2.Zero();break;case AE.LE:this.value=e.LE.Zero();break;case AE.hh:this.value=new h.hh(1,1,1,1);break;case AE.Matrix:this.value=e.Matrix.Identity()}}_build(I){super._build(I),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=I=>I.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=I=>I.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const I=super.serialize();return I.type=this.type,I.contextualValue=this.contextualValue,I.systemSource=this.systemSource,I.min=this.min,I.max=this.max,I.groupInInspector=this.groupInInspector,I.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.re?(I.valueType="BABYLON."+this._storedValue.getClassName(),I.value=this._storedValue.re()):(I.valueType="number",I.value=this._storedValue)),I}_deserialize(I){if(super._deserialize(I),this._type=I.type,this.contextualValue=I.contextualValue,this.systemSource=I.systemSource||sE.None,this.min=I.min||0,this.max=I.max||0,this.groupInInspector=I.groupInInspector||"",void 0!==I.displayInInspector&&(this.displayInInspector=I.displayInInspector),I.valueType)if("number"===I.valueType)this._storedValue=I.value;else{const E=(0,t.e)(I.valueType);E&&(this._storedValue=E.xE(I.value))}}}(0,t.h)("BABYLON.ParticleInputBlock",NE);class mE extends BE{get url(){return this._url}set url(I){this._url!==I&&(this._cachedData=null,this._url=I,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(I){this._textureDataUrl!==I&&(this._cachedData=null,this._textureDataUrl=I,this._url="",this._sourceTexture=null)}set sourceTexture(I){this._sourceTexture!==I&&(this._cachedData=null,this._sourceTexture=I,this._url="",this._textureDataUrl="")}constructor(I){super(I),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",AE.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const I=this.texture._storedValue;return await new Promise(((E,j)=>{if(!I.isReady())return void I.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),E(this._cachedData)}catch(I){j(I)}}));const e=I.getSize();rE.l.GetTextureDataAsync(I,e.width,e.height).then((j=>{this._cachedData={width:e.width,height:e.height,data:new Uint8ClampedArray(j)},I.dispose(),E(this._cachedData)})).catch(j)}))}_build(I){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new g.d(this._textureDataUrl,I.CE):this.texture._storedValue=new g.d(this._url,I.CE):this.texture._storedValue=null}serialize(){const I=super.serialize();return I.url=this.url,I.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(I.textureDataUrl=this.textureDataUrl),I}_deserialize(I){super._deserialize(I),this.url=I.url,this.serializedCachedData=!!I.serializedCachedData,I.textureDataUrl&&(this.textureDataUrl=I.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,t.h)("BABYLON.ParticleTextureSourceBlock",mE);class Ij extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("position",AE.LE),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(I){const E=this.particle.getConnectedValue(I);if(this.output._storedValue=E,!this.position.isConnected)return;const j={process:j=>{I.particleContext=j,I.systemContext=E,j.position.U(this.position.getConnectedValue(I))},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j}}(0,t.h)("BABYLON.UpdatePositionBlock",Ij),function(I){I[I.Add=0]="Add",I[I.Subtract=1]="Subtract",I[I.Multiply=2]="Multiply",I[I.Divide=3]="Divide",I[I.Max=4]="Max",I[I.Min=5]="Min"}(vE||(vE={}));class Ej extends BE{constructor(I){super(I),this.operation=vE.Add,this.registerInput("left",AE.AutoDetect),this.registerInput("right",AE.AutoDetect),this.registerOutput("output",AE.BasedOnInput),this.output._typeConnectionSource=this.left;const E=[AE.Matrix,AE.Particle,AE.Texture,AE.System,AE.FloatGradient,AE.Color4Gradient,AE.Vector2Gradient,AE.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...E),this.right.excludedConnectionPointTypes.push(...E),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(I){let E;const j=this.left,w=this.right;if(!j.isConnected||!w.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const z=j.type===AE.Float||j.type===AE.Int,t=w.type===AE.Float||w.type===AE.Int,U=z&&t;switch(this.operation){case vE.Add:E=U?I=>j.getConnectedValue(I)+w.getConnectedValue(I):z?I=>I.adapt(j,w.type).add(w.getConnectedValue(I)):I=>j.getConnectedValue(I).add(I.adapt(w,j.type));break;case vE.Subtract:E=U?I=>j.getConnectedValue(I)-w.getConnectedValue(I):z?I=>I.adapt(j,w.type).FE(w.getConnectedValue(I)):I=>j.getConnectedValue(I).FE(I.adapt(w,j.type));break;case vE.Multiply:E=U?I=>j.getConnectedValue(I)*w.getConnectedValue(I):z?I=>I.adapt(j,w.type).multiply(w.getConnectedValue(I)):I=>j.getConnectedValue(I).multiply(I.adapt(w,j.type));break;case vE.Divide:E=U?I=>j.getConnectedValue(I)/w.getConnectedValue(I):z?I=>I.adapt(j,w.type).divide(w.getConnectedValue(I)):I=>j.getConnectedValue(I).divide(I.adapt(w,j.type));break;case vE.Min:if(U)E=I=>Math.min(j.getConnectedValue(I),w.getConnectedValue(I));else{const[I,t]=z?[w,j]:[j,w];switch(I.type){case AE.Vector2:E=E=>e.Vector2.Minimize(I.getConnectedValue(E),E.adapt(t,I.type));break;case AE.LE:E=E=>e.LE.Minimize(I.getConnectedValue(E),E.adapt(t,I.type));break;case AE.hh:E=E=>{const j=I.getConnectedValue(E),{r:e,g:w,b:z,a:U}=E.adapt(t,I.type);return new h.hh(Math.min(j.r,e),Math.min(j.g,w),Math.min(j.b,z),Math.min(j.a,U))}}}break;case vE.Max:if(!U){const[I,t]=z?[w,j]:[j,w];switch(I.type){case AE.Vector2:E=E=>e.Vector2.Maximize(I.getConnectedValue(E),E.adapt(t,I.type));break;case AE.LE:E=E=>e.LE.Maximize(I.getConnectedValue(E),E.adapt(t,I.type));break;case AE.hh:E=E=>{const j=I.getConnectedValue(E),{r:e,g:w,b:z,a:U}=E.adapt(t,I.type);return new h.hh(Math.max(j.r,e),Math.min(j.g,w),Math.min(j.b,z),Math.min(j.a,U))}}break}E=I=>Math.max(j.getConnectedValue(I),w.getConnectedValue(I))}this.output._storedFunction=I=>j.type===AE.Int?0|E(I):E(I)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===AE.Int||this.left.type===AE.Float&&this.right.type!==AE.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[I,E]of[[this.left,this.right],[this.right,this.left]])I.acceptedConnectionPointTypes=[AE.Int,AE.Float],E.isConnected&&(I.acceptedConnectionPointTypes.push(E.type),E.type!==AE.Int&&E.type!==AE.Float||I.acceptedConnectionPointTypes.push(AE.Vector2,AE.LE,AE.hh))}dispose(){super.dispose();for(const I of this._connectionObservers)I.remove();this._connectionObservers.length=0}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,r.b)([pE("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:vE.Add},{label:"Subtract",value:vE.Subtract},{label:"Multiply",value:vE.Multiply},{label:"Divide",value:vE.Divide},{label:"Max",value:vE.Max},{label:"Min",value:vE.Min}]})],Ej.prototype,"operation",void 0),(0,t.h)("BABYLON.ParticleMathBlock",Ej);class jj extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("direction1",AE.LE,!0,new e.LE(0,1,0)),this.registerInput("direction2",AE.LE,!0,new e.LE(0,1,0)),this.registerInput("minEmitBox",AE.LE,!0,new e.LE(-.5,-.5,-.5)),this.registerInput("maxEmitBox",AE.LE,!0,new e.LE(.5,.5,.5)),this.registerOutput("output",AE.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const E=this.particle.getConnectedValue(I);E._directionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.direction1.getConnectedValue(I),z=this.direction2.getConnectedValue(I),h=(0,R.RandomRange)(w.x,z.x),t=(0,R.RandomRange)(w.y,z.y),U=(0,R.RandomRange)(w.z,z.z);I.isEmitterTransformNode?e.LE.TransformNormalFromFloatsToRef(h,t,U,I.emitterWorldMatrix,j.direction):j.direction.nz(h,t,U)},E._positionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.minEmitBox.getConnectedValue(I),z=this.maxEmitBox.getConnectedValue(I),h=(0,R.RandomRange)(w.x,z.x),t=(0,R.RandomRange)(w.y,z.y),U=(0,R.RandomRange)(w.z,z.z);I.isEmitterTransformNode?e.LE.TransformCoordinatesFromFloatsToRef(h,t,U,I.emitterWorldMatrix,j.position):(j.position.nz(h,t,U),j.position.addInPlace(I.emitterPosition))},this.output._storedValue=E}}(0,t.h)("BABYLON.BoxShapeBlock",jj);class ej extends BE{constructor(I){super(I),this.registerInput("emitPower",AE.Float,!0,1),this.registerInput("lifeTime",AE.Float,!0,1),this.registerInput("color",AE.hh,!0,new h.hh(1,1,1,1)),this.registerInput("scale",AE.Vector2,!0,new e.Vector2(1,1)),this.registerInput("angle",AE.Float,!0,0),this.registerOutput("particle",AE.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(I){const E=new tE(this.name,I.Pj,I.CE,null,!1,void 0,!0);E.particleEmitterType=new C,E._lifeTimeCreation.process=(E,j)=>{I.particleContext=E,E.lifeTime=this.lifeTime.getConnectedValue(I),j._emitPower=this.emitPower.getConnectedValue(I)},E._colorCreation.process=E=>{I.particleContext=E,E.color.U(this.color.getConnectedValue(I))},E._sizeCreation.process=E=>{I.particleContext=E,E.size=1,E.scale.U(this.scale.getConnectedValue(I))},E._angleCreation.process=E=>{I.particleContext=E,E.angle=this.angle.getConnectedValue(I)},this.particle._storedValue=E}}(0,t.h)("BABYLON.CreateParticleBlock",ej);class wj{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const I=[];for(const E of this.attachedBlocks)E.isInput&&I.push(E);return I}constructor(I){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new k.e,this.name=I}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(I){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(I)&&this.attachedBlocks.push(I);for(const j of I.inputs){const e=j.connectedPoint;if(e){const j=e.ownerBlock;j!==I&&this._initializeBlock(j,E)}}}async buildAsync(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((j=>{const e=new QE;for(const I of this._systemBlocks)this._initializeBlock(I);for(const w of this.systemBlocks){const j=new DE;j.buildId=this._buildId++,j.CE=I,j.verbose=E;const z=w.createSystem(j);j.emitErrors(),e.systems.push(z)}this.onBuildObservable.notifyObservers(this),j(e)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const I=new JE("Particle system"),E=new Ij("Update position");E.output.connectTo(I.particle);const j=new NE("Position");j.contextualValue=OE.Position;const e=new NE("Scaled direction");e.contextualValue=OE.ScaledDirection;const w=new Ej("Add");w.operation=vE.Add,j.output.connectTo(w.left),e.output.connectTo(w.right),w.output.connectTo(E.position);const z=new ej("Create particle"),h=new jj("Box shape");z.particle.connectTo(h.particle),h.output.connectTo(E.particle);const t=new mE("Texture");t.texture.connectTo(I.texture),t.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(I)}removeBlock(I){const E=this.attachedBlocks.indexOf(I);if(E>-1&&this.attachedBlocks.splice(E,1),I.isSystem){const E=this._systemBlocks.indexOf(I);E>-1&&this._systemBlocks.splice(E,1)}}parseSerializedObject(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];E||this.clear();const j={};for(const e of I.bP){const I=(0,t.e)(e.customType);if(I){const E=new I;E._deserialize(e),j[e.id]=E,this.attachedBlocks.push(E),E.isSystem&&this._systemBlocks.push(E)}}for(const e of this.attachedBlocks)if(e.isTeleportOut){const I=e,E=I._tempEntryPointUniqueId;if(E){const e=j[E];e&&e.attachToEndpoint(I)}}for(let e=0;e<I.bP.length;e++){const w=I.bP[e],z=j[w.id];z&&(z.inputs.length&&w.inputs.some((I=>I.targetConnectionName))&&!E||this._restoreConnections(z,I,j))}if(I.locations||I.editorData&&I.editorData.locations){const e=I.locations||I.editorData.locations;for(const I of e)j[I.yw]&&(I.yw=j[I.yw].uniqueId);E&&this.editorData&&this.editorData.locations&&e.concat(this.editorData.locations),I.locations?this.editorData={locations:e}:(this.editorData=I.editorData,this.editorData.locations=e);const w=[];for(const I in j)w[I]=j[I].uniqueId;this.editorData.map=w}this.comment=I.comment}_restoreConnections(I,E,j){for(const e of I.outputs)for(const w of E.bP){const z=j[w.id];if(z)for(const h of w.inputs)if(j[h.targetBlockId]!==I||h.targetConnectionName!==e.name);else{const I=z.getInputByName(h.inputName);if(!I||I.isConnected)continue;e.connectTo(I,!0),this._restoreConnections(z,E,j)}}}serialize(I){const E=I?{}:H.e.Serialize(this);E.editorData=JSON.parse(JSON.stringify(this.editorData));let j=[];I?j=I:E.customType="BABYLON.NodeParticleSystemSet",E.bP=[];for(const e of j)E.bP.push(e.serialize());if(!I)for(const e of this.attachedBlocks)-1===j.indexOf(e)&&E.bP.push(e.serialize());return E}dispose(){for(const I of this.attachedBlocks)I.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(I){const E=new wj(I);return E.setToDefault(),E}static Parse(I){const E=H.e.Parse((()=>new wj(I.name)),I,null);return E.parseSerializedObject(I),E}static ParseFromSnippetAsync(I,E){return"_BLANK"===I?Promise.resolve(wj.CreateDefault("blank")):new Promise(((j,e)=>{const w=new GE.c;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const h=JSON.parse(JSON.parse(w.responseText).jsonPayload),t=JSON.parse(h.nodeParticle);E||(E=H.e.Parse((()=>new wj(I)),t,null)),E.parseSerializedObject(t),E.snippetId=I;try{j(E)}catch(z){e(z)}}else e("Unable to load the snippet "+I)})),w.open("GET",this.SnippetUrl+"/"+I.replace(/#/g,"/")),w.send()}))}}wj.EditorURL=`${xE.Tools._DefaultCdnUrl}/v${pI.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,wj.SnippetUrl="https://snippet.babylonjs.com",(0,r.b)([(0,n.N)()],wj.prototype,"name",void 0),(0,r.b)([(0,n.N)("comment")],wj.prototype,"comment",void 0),function(I){I[I.None=0]="None",I[I.PerParticle=1]="PerParticle",I[I.PerSystem=2]="PerSystem"}(VE||(VE={}));class zj extends BE{constructor(I){super(I),this._currentLockId=-2,this.lockMode=VE.PerParticle,this.registerInput("min",AE.AutoDetect,!0,0),this.registerInput("max",AE.AutoDetect,!0,1),this.registerOutput("output",AE.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AE.Float|AE.Int|AE.Vector2|AE.LE|AE.hh),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(AE.Float|AE.Int|AE.Vector2|AE.LE|AE.hh),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=AE.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case AE.AutoDetect:case AE.Int:case AE.Float:I=I=>{const E=this.min.getConnectedValue(I)||0,j=this.max.getConnectedValue(I)||1;return E+Math.random()*(j-E)};break;case AE.Vector2:I=I=>{const E=this.min.getConnectedValue(I)||e.Vector2.Zero(),j=this.max.getConnectedValue(I)||e.Vector2.One();return new e.Vector2(E.x+Math.random()*(j.x-E.x),E.y+Math.random()*(j.y-E.y))};break;case AE.LE:I=I=>{const E=this.min.getConnectedValue(I)||e.LE.Zero(),j=this.max.getConnectedValue(I)||e.LE.One();return new e.LE(E.x+Math.random()*(j.x-E.x),E.y+Math.random()*(j.y-E.y),E.z+Math.random()*(j.z-E.z))};break;case AE.hh:I=I=>{const E=this.min.getConnectedValue(I)||new h.hh(0,0,0,0),j=this.max.getConnectedValue(I)||new h.hh(1,1,1,1);return new h.hh(E.x+Math.random()*(j.x-E.x),E.y+Math.random()*(j.y-E.y),E.z+Math.random()*(j.z-E.z),E.w+Math.random()*(j.w-E.w))}}this.output._storedFunction=E=>{var j;let e=0;switch(this.lockMode){case VE.PerParticle:e=(null===(j=E.particleContext)||void 0===j?void 0:j.id)||-1;break;case VE.PerSystem:e=E.buildId||0}return this._currentLockId!==e&&(this.lockMode!==VE.None&&(this._currentLockId=e),this.output._storedValue=I(E)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),this.lockMode=I.lockMode}}(0,r.b)([pE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:VE.None},{label:"Per particle",value:VE.PerParticle},{label:"Per system",value:VE.PerSystem}]})],zj.prototype,"lockMode",void 0),(0,t.h)("BABYLON.ParticleRandomBlock",zj);class hj extends BE{constructor(I){super(I),this._currentLockId=-2,this.lockMode=VE.PerParticle,this.registerInput("min",AE.AutoDetect),this.registerInput("max",AE.AutoDetect),this.registerOutput("output",AE.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const E=[AE.Matrix,AE.Particle,AE.Texture,AE.System,AE.FloatGradient,AE.Color4Gradient,AE.Vector2Gradient,AE.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...E),this.max.excludedConnectionPointTypes.push(...E)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let I=null;switch(this._currentLockId=-2,this.min.type){case AE.Float:case AE.Int:I=I=>{const E=this.min.getConnectedValue(I),j=this.max.getConnectedValue(I);return Math.random()*(j-E)+E};break;case AE.Vector2:I=I=>{const E=this.min.getConnectedValue(I),j=this.max.getConnectedValue(I);return new e.Vector2(Math.random()*(j.x-E.x)+E.x,Math.random()*(j.y-E.y)+E.y)};break;case AE.LE:I=I=>{const E=this.min.getConnectedValue(I),j=this.max.getConnectedValue(I);return new e.LE(Math.random()*(j.x-E.x)+E.x,Math.random()*(j.y-E.y)+E.y,Math.random()*(j.z-E.z)+E.z)};break;case AE.hh:I=I=>{const E=this.min.getConnectedValue(I),j=this.max.getConnectedValue(I);return new h.hh(Math.random()*(j.r-E.r)+E.r,Math.random()*(j.g-E.g)+E.g,Math.random()*(j.b-E.b)+E.b,Math.random()*(j.a-E.a)+E.a)}}this.output._storedFunction=E=>{var j;let e=0;switch(this.lockMode){case VE.PerParticle:e=(null===(j=E.particleContext)||void 0===j?void 0:j.id)||-1;break;case VE.PerSystem:e=E.buildId||0}return this._currentLockId!==e&&(this.lockMode!==VE.None&&(this._currentLockId=e),this.output._storedValue=I(E)),this.output._storedValue}}serialize(){const I=super.serialize();return I.lockMode=this.lockMode,I}_deserialize(I){super._deserialize(I),void 0!==I.lockMode&&(this.lockMode=I.lockMode)}}(0,r.b)([pE("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:VE.None},{label:"Per particle",value:VE.PerParticle},{label:"Per system",value:VE.PerSystem}]})],hj.prototype,"lockMode",void 0),(0,t.h)("BABYLON.RandomRangeBlock",hj);(0,t.h)("BABYLON.ParticleLerpBlock",class extends BE{constructor(I){super(I),this.registerInput("left",AE.AutoDetect),this.registerInput("right",AE.AutoDetect),this.registerInput("gradient",AE.Float,!0,0,0,1),this.registerOutput("output",AE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AE.Float|AE.Int|AE.Vector2|AE.LE|AE.hh)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const I=(I,E,j)=>(1-I)*E+I*j;this.output._storedFunction=E=>{const j=this.left.getConnectedValue(E),w=this.right.getConnectedValue(E),z=this.gradient.getConnectedValue(E);switch(this.left.type){case AE.Int:case AE.Float:return I(z,j,w);case AE.Vector2:return new e.Vector2(I(z,j.x,w.x),I(z,j.y,w.y));case AE.LE:return new e.LE(I(z,j.x,w.x),I(z,j.y,w.y),I(z,j.z,w.z));case AE.hh:return new h.hh(I(z,j.r,w.r),I(z,j.g,w.g),I(z,j.b,w.b),I(z,j.a,w.a))}return 0}}});(0,t.h)("BABYLON.UpdateDirectionBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("direction",AE.LE),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(I){const E=this.particle.getConnectedValue(I);if(this.output._storedValue=E,!this.direction.isConnected)return;const j={process:j=>{I.particleContext=j,I.systemContext=E,j.direction.U(this.direction.getConnectedValue(I))},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j}});(0,t.h)("BABYLON.UpdateColorBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("color",AE.hh),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(I){const E=this.particle.getConnectedValue(I);if(this.output._storedValue=E,!this.color.isConnected)return;const j={process:j=>{I.particleContext=j,I.systemContext=E,j.color.U(this.color.getConnectedValue(I))},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j}});(0,t.h)("BABYLON.UpdateScaleBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("scale",AE.Vector2),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(I){const E=this.particle.getConnectedValue(I);if(this.output._storedValue=E,!this.scale.isConnected)return;const j={process:j=>{I.particleContext=j,I.systemContext=E,j.scale.U(this.scale.getConnectedValue(I))},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j}});(0,t.h)("BABYLON.UpdateAngleBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("angle",AE.Float),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(I){const E=this.particle.getConnectedValue(I);if(this.output._storedValue=E,!this.angle.isConnected)return;const j={process:j=>{I.particleContext=j,I.systemContext=E,j.angle=this.angle.getConnectedValue(I)},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j}});(0,t.h)("BABYLON.BasicPositionUpdateBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(I){const E=this.particle.getConnectedValue(I),j={process:j=>{I.particleContext=j,I.systemContext=E,j.direction.scaleToRef(E._directionScale,E._scaledDirection),j.position.addInPlace(E._scaledDirection)},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j,this.output._storedValue=E}});(0,t.h)("BABYLON.BasicSpriteUpdateBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(I){const E=this.particle.getConnectedValue(I),j={process:j=>{I.particleContext=j,I.systemContext=E,j.updateCellIndex()},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j,this.output._storedValue=E}});(0,t.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("cellIndex",AE.Int),this.registerOutput("output",AE.Particle),this.cellIndex.acceptedConnectionPointTypes=[AE.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(I){const E=this.particle.getConnectedValue(I);if(this.output._storedValue=E,!this.cellIndex.isConnected)return;const j={process:j=>{I.particleContext=j,I.systemContext=E,j.cellIndex=Math.floor(this.cellIndex.getConnectedValue(I))},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j}});class tj extends BE{constructor(I){super(I),this.strength=1,this.registerInput("particle",AE.Particle),this.registerInput("flowMap",AE.Texture),this.registerOutput("output",AE.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(I){var E;const j=this.particle.getConnectedValue(I),e=I.CE;let w;(null===(E=this.flowMap.connectedPoint)||void 0===E?void 0:E.ownerBlock).extractTextureContentAsync().then((I=>{I&&(w=new YE(I.width,I.height,I.data))}));const z={process:I=>{const E=e.getTransformMatrix();w&&w._processParticle(I,this.strength*j._tempScaledUpdateSpeed,E)},previousItem:null,nextItem:null};j._updateQueueStart?sI(z,j._updateQueueStart):j._updateQueueStart=z,this.output._storedValue=j}serialize(){const I=super.serialize();return I.strength=this.strength,I}_deserialize(I){super._deserialize(I),this.strength=I.strength}}(0,r.b)([pE("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],tj.prototype,"strength",void 0),(0,t.h)("BABYLON.UpdateFlowMapBlock",tj);(0,t.h)("BABYLON.SphereShapeBlock",class extends BE{constructor(I){super(I),this.registerInput("input",AE.Particle),this.registerInput("radius",AE.Float,!0,1),this.registerInput("radiusRange",AE.Float,!0,1,0,1),this.registerInput("directionRandomizer",AE.Float,!0,0,0,1),this.registerOutput("output",AE.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(I){const E=this.input.getConnectedValue(I);E._directionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.directionRandomizer.getConnectedValue(I),z=j.position.FE(I.emitterPosition).normalize(),h=(0,R.RandomRange)(0,w),t=(0,R.RandomRange)(0,w),U=(0,R.RandomRange)(0,w);z.x+=h,z.y+=t,z.z+=U,z.normalize(),I.isEmitterTransformNode?e.LE.TransformNormalFromFloatsToRef(h,t,U,I.emitterWorldMatrix,j.direction):j.direction.nz(h,t,U)},E._positionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.radius.getConnectedValue(I),z=this.radiusRange.getConnectedValue(I),h=w-(0,R.RandomRange)(0,w*z),t=(0,R.RandomRange)(0,1),U=(0,R.RandomRange)(0,2*Math.PI),P=Math.acos(2*t-1),o=h*Math.cos(U)*Math.sin(P),Z=h*Math.cos(P),c=h*Math.sin(U)*Math.sin(P);I.isEmitterTransformNode?e.LE.TransformCoordinatesFromFloatsToRef(o,Z,c,I.emitterWorldMatrix,j.position):(j.position.nz(o,Z,c),j.position.addInPlace(I.emitterPosition))},this.output._storedValue=E}});(0,t.h)("BABYLON.PointShapeBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("direction1",AE.LE,!0,new e.LE(0,1,0)),this.registerInput("direction2",AE.LE,!0,new e.LE(0,1,0)),this.registerOutput("output",AE.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const E=this.particle.getConnectedValue(I);E._directionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.direction1.getConnectedValue(I),z=this.direction2.getConnectedValue(I),h=(0,R.RandomRange)(w.x,z.x),t=(0,R.RandomRange)(w.y,z.y),U=(0,R.RandomRange)(w.z,z.z);I.isEmitterTransformNode?e.LE.TransformNormalFromFloatsToRef(h,t,U,I.emitterWorldMatrix,j.direction):j.direction.nz(h,t,U)},E._positionCreation.process=j=>{I.systemContext=E,I.isEmitterTransformNode?e.LE.TransformCoordinatesFromFloatsToRef(0,0,0,I.emitterWorldMatrix,j.position):j.position.U(I.emitterPosition)},this.output._storedValue=E}});(0,t.h)("BABYLON.CustomShapeBlock",class extends BE{constructor(I){super(I),this.registerInput("particle",AE.Particle),this.registerInput("position",AE.LE,!0,new e.LE(0,0,0)),this.registerInput("direction",AE.LE,!0,new e.LE(0,1,0)),this.registerOutput("output",AE.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){const E=this.particle.getConnectedValue(I);E._directionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.direction.getConnectedValue(I);I.isEmitterTransformNode?e.LE.TransformNormalToRef(w,I.emitterWorldMatrix,j.direction):j.direction.U(w)},E._positionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.position.getConnectedValue(I);I.isEmitterTransformNode?e.LE.TransformCoordinatesToRef(w,I.emitterWorldMatrix,j.position):(j.position.U(w),j.position.addInPlace(I.emitterPosition))},this.output._storedValue=E}});(0,t.h)("BABYLON.CylinderShapeBlock",class extends BE{constructor(I){super(I),this._tempVector=e.LE.Zero(),this.registerInput("particle",AE.Particle),this.registerInput("radius",AE.Float,!0,1),this.registerInput("height",AE.Float,!0,1,0),this.registerInput("radiusRange",AE.Float,!0,1,0,1),this.registerInput("directionRandomizer",AE.Float,!0,0,0,1),this.registerOutput("output",AE.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(I){const E=this.particle.getConnectedValue(I);E._directionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.directionRandomizer.getConnectedValue(I);j.position.subtractToRef(I.emitterPosition,this._tempVector),this._tempVector.normalize(),I.isEmitterTransformNode&&e.LE.TransformNormalToRef(this._tempVector,I.emitterInverseWorldMatrix,this._tempVector);const z=(0,R.RandomRange)(-w/2,w/2);let h=Math.atan2(this._tempVector.x,this._tempVector.z);h+=(0,R.RandomRange)(-Math.PI/2,Math.PI/2)*w,this._tempVector.y=z,this._tempVector.x=Math.sin(h),this._tempVector.z=Math.cos(h),this._tempVector.normalize(),I.isEmitterTransformNode?e.LE.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,I.emitterWorldMatrix,j.direction):j.direction.U(this._tempVector)},E._positionCreation.process=j=>{I.particleContext=j,I.systemContext=E;const w=this.height.getConnectedValue(I),z=this.radiusRange.getConnectedValue(I),h=this.radius.getConnectedValue(I),t=(0,R.RandomRange)(-w/2,w/2),U=(0,R.RandomRange)(0,2*Math.PI),P=(0,R.RandomRange)((1-z)*(1-z),1),o=Math.sqrt(P)*h,Z=o*Math.cos(U),c=o*Math.sin(U);I.isEmitterTransformNode?e.LE.TransformCoordinatesFromFloatsToRef(Z,t,c,I.emitterWorldMatrix,j.position):(j.position.nz(Z,t,c),j.position.addInPlace(I.emitterPosition))},this.output._storedValue=E}});class Uj extends BE{constructor(I){super(I),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",AE.Particle),this.registerOutput("output",AE.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const E=this.particle.getConnectedValue(I);E._isAnimationSheetEnabled=!0,E.spriteCellWidth=this.width,E.spriteCellHeight=this.height,E.startSpriteCellID=this.start,E.endSpriteCellID=this.end,E.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=E}serialize(){const I=super.serialize();return I.width=this.width,I.height=this.height,I.start=this.start,I.end=this.end,I.randomStartCell=this.randomStartCell,I}_deserialize(I){super._deserialize(I),this.width=I.width,this.height=I.height,this.start=I.start,this.end=I.end,this.randomStartCell=I.randomStartCell}}(0,r.b)([pE("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Uj.prototype,"start",void 0),(0,r.b)([pE("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Uj.prototype,"end",void 0),(0,r.b)([pE("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Uj.prototype,"width",void 0),(0,r.b)([pE("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Uj.prototype,"height",void 0),(0,r.b)([pE("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Uj.prototype,"loop",void 0),(0,r.b)([pE("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Uj.prototype,"randomStartCell",void 0),(0,t.h)("BABYLON.SetupSpriteSheetBlock",Uj);class Rj extends BE{constructor(I){super(I),this.reference=0,this.registerInput("value",AE.AutoDetect),this.registerOutput("output",AE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case AE.Float:return AE.FloatGradient;case AE.Vector2:return AE.Vector2Gradient;case AE.LE:return AE.Vector3Gradient;case AE.hh:return AE.Color4Gradient}return I},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AE.Float|AE.Vector2|AE.LE|AE.hh)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=I=>null}serialize(){const I=super.serialize();return I.reference=this.reference,I}_deserialize(I){super._deserialize(I),this.reference=I.reference}}(0,r.b)([pE("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],Rj.prototype,"reference",void 0),(0,t.h)("BABYLON.ParticleGradientValueBlock",Rj);(0,t.h)("BABYLON.ParticleGradientBlock",class extends BE{constructor(I){super(I),this._entryCount=1,this.registerInput("gradient",AE.Float,!0,1,0,1),this.registerInput("value0",AE.AutoDetect),this.registerOutput("output",AE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=I=>{switch(I){case AE.FloatGradient:return AE.Float;case AE.Vector2Gradient:return AE.Vector2;case AE.Vector3Gradient:return AE.LE;case AE.Color4Gradient:return AE.hh}return I},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(AE.FloatGradient|AE.Vector2Gradient|AE.Vector3Gradient|AE.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(I){this._inputs[I].onConnectionObservable.add((()=>{this._entryCount>I||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),AE.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const I=[];for(let j=1;j<this._inputs.length;j++){var E;if(this._inputs[j].isConnected)I.push(null===(E=this._inputs[j].connectedPoint)||void 0===E?void 0:E.ownerBlock)}I.sort(((I,E)=>I.reference-E.reference)),this.output._storedFunction=E=>{const j=this.gradient.getConnectedValue(E);if(1===I.length)return I[0].value.getConnectedValue(E);let w=null;for(let z=I.length-1;z>=0;z--){const t=I[z];if(t.reference<=j){const I=t.value.getConnectedValue(E);if(w){const z=w.value.getConnectedValue(E),U=w.reference,P=t.reference,o=Math.max(0,Math.min(1,(j-P)/(U-P)));switch(this.output.type){case AE.Float:return(0,R.Lerp)(I,z,o);case AE.Vector2:return e.Vector2.Lerp(I,z,o);case AE.LE:return e.LE.Lerp(I,z,o);case AE.hh:return h.hh.Lerp(I,z,o)}}return I}w=t}return 0}}});(0,t.h)("BABYLON.ParticleConverterBlock",class extends BE{constructor(I){super(I),this.registerInput("color ",AE.hh,!0),this.registerInput("xyz ",AE.LE,!0),this.registerInput("xy ",AE.Vector2,!0),this.registerInput("zw ",AE.Vector2,!0),this.registerInput("x ",AE.Float,!0),this.registerInput("y ",AE.Float,!0),this.registerInput("z ",AE.Float,!0),this.registerInput("w ",AE.Float,!0),this.registerOutput("color",AE.hh),this.registerOutput("xyz",AE.LE),this.registerOutput("xy",AE.Vector2),this.registerOutput("zw",AE.Vector2),this.registerOutput("x",AE.Float),this.registerOutput("y",AE.Float),this.registerOutput("z",AE.Float),this.registerOutput("w",AE.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(I){return"color "===I?"colorIn":"xyz "===I?"xyzIn":"xy "===I?"xyIn":"zw "===I?"zwIn":"x "===I?"xIn":"y "===I?"yIn":"z "===I?"zIn":"w "===I?"wIn":I}_outputRename(I){switch(I){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return I}}_build(I){super._build(I);const E=this.xIn,j=this.yIn,w=this.zIn,z=this.wIn,t=this.xyIn,U=this.zwIn,R=this.xyzIn,P=this.colorIn,o=this.colorOut,Z=this.xyzOut,c=this.xyOut,K=this.zwOut,L=this.xOut,F=this.yOut,C=this.zOut,X=this.wOut,q=I=>{if(P.isConnected)return P.getConnectedValue(I);let e=0,o=0,Z=0,c=0;if(E.isConnected&&(e=E.getConnectedValue(I)),j.isConnected&&(o=j.getConnectedValue(I)),w.isConnected&&(Z=w.getConnectedValue(I)),z.isConnected&&(c=z.getConnectedValue(I)),t.isConnected){const E=t.getConnectedValue(I);E&&(e=E.x,o=E.y)}if(U.isConnected){const E=U.getConnectedValue(I);E&&(Z=E.x,c=E.y)}if(R.isConnected){const E=R.getConnectedValue(I);E&&(e=E.x,o=E.y,Z=E.z)}return new h.hh(e,o,Z,c)};o._storedFunction=I=>q(I),Z._storedFunction=I=>{const E=q(I);return new e.LE(E.r,E.g,E.b)},c._storedFunction=I=>{const E=q(I);return new e.Vector2(E.r,E.g)},K._storedFunction=I=>{const E=q(I);return new e.Vector2(E.b,E.a)},L._storedFunction=I=>q(I).r,F._storedFunction=I=>q(I).g,C._storedFunction=I=>q(I).b,X._storedFunction=I=>q(I).a}}),function(I){I[I.Cos=0]="Cos",I[I.Sin=1]="Sin",I[I.Abs=2]="Abs",I[I.Exp=3]="Exp",I[I.Exp2=4]="Exp2",I[I.Round=5]="Round",I[I.Floor=6]="Floor",I[I.Ceiling=7]="Ceiling",I[I.Sqrt=8]="Sqrt",I[I.Log=9]="Log",I[I.Tan=10]="Tan",I[I.ArcTan=11]="ArcTan",I[I.ArcCos=12]="ArcCos",I[I.ArcSin=13]="ArcSin",I[I.Sign=14]="Sign",I[I.Negate=15]="Negate",I[I.OneMinus=16]="OneMinus",I[I.Reciprocal=17]="Reciprocal",I[I.ToDegrees=18]="ToDegrees",I[I.ToRadians=19]="ToRadians",I[I.Fract=20]="Fract"}(fE||(fE={}));class Pj extends BE{constructor(I){super(I),this.operation=fE.Cos,this.registerInput("input",AE.AutoDetect),this.registerOutput("output",AE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(AE.Float|AE.Int|AE.Vector2|AE.LE|AE.hh)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);let E=null;switch(this.operation){case fE.Cos:E=I=>Math.cos(I);break;case fE.Sin:E=I=>Math.sin(I);break;case fE.Abs:E=I=>Math.abs(I);break;case fE.Exp:E=I=>Math.exp(I);break;case fE.Exp2:E=I=>Math.pow(2,I);break;case fE.Round:E=I=>Math.round(I);break;case fE.Floor:E=I=>Math.floor(I);break;case fE.Ceiling:E=I=>Math.ceil(I);break;case fE.Sqrt:E=I=>Math.sqrt(I);break;case fE.Log:E=I=>Math.log(I);break;case fE.Tan:E=I=>Math.tan(I);break;case fE.ArcTan:E=I=>Math.atan(I);break;case fE.ArcCos:E=I=>Math.acos(I);break;case fE.ArcSin:E=I=>Math.asin(I);break;case fE.Sign:E=I=>Math.sign(I);break;case fE.Negate:E=I=>-I;break;case fE.OneMinus:E=I=>1-I;break;case fE.Reciprocal:E=I=>1/I;break;case fE.ToRadians:E=I=>I*Math.PI/180;break;case fE.ToDegrees:E=I=>180*I/Math.PI;break;case fE.Fract:E=I=>I>=0?I-Math.floor(I):I-Math.ceil(I)}if(!E)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case AE.Int:case AE.Float:this.output._storedFunction=I=>{const j=this.input.getConnectedValue(I);return E(j)};break;case AE.Vector2:this.output._storedFunction=I=>{const j=this.input.getConnectedValue(I);return new e.Vector2(E(j.x),E(j.y))};break;case AE.LE:this.output._storedFunction=I=>{const j=this.input.getConnectedValue(I);return new e.LE(E(j.x),E(j.y),E(j.z))};break;case AE.hh:this.output._storedFunction=I=>{const j=this.input.getConnectedValue(I);return new h.hh(E(j.r),E(j.g),E(j.b),E(j.a))}}return this}serialize(){const I=super.serialize();return I.operation=this.operation,I}_deserialize(I){super._deserialize(I),this.operation=I.operation}}(0,r.b)([pE("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:fE.Cos},{label:"Sin",value:fE.Sin},{label:"Abs",value:fE.Abs},{label:"Exp",value:fE.Exp},{label:"Exp2",value:fE.Exp2},{label:"Round",value:fE.Round},{label:"Floor",value:fE.Floor},{label:"Ceiling",value:fE.Ceiling},{label:"Sqrt",value:fE.Sqrt},{label:"Log",value:fE.Log},{label:"Tan",value:fE.Tan},{label:"ArcTan",value:fE.ArcTan},{label:"ArcCos",value:fE.ArcCos},{label:"ArcSin",value:fE.ArcSin},{label:"Sign",value:fE.Sign},{label:"Negate",value:fE.Negate},{label:"OneMinus",value:fE.OneMinus},{label:"Reciprocal",value:fE.Reciprocal},{label:"ToDegrees",value:fE.ToDegrees},{label:"ToRadians",value:fE.ToRadians},{label:"Fract",value:fE.Fract}]})],Pj.prototype,"operation",void 0),(0,t.h)("BABYLON.ParticleTrigonometryBlock",Pj);var oj,Zj=j(12509);class cj extends BE{constructor(I){super(I),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",AE.AutoDetect),this.registerOutput("output",AE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(AE.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(AE.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(AE.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(AE.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(AE.System),this._inputs[0].excludedConnectionPointTypes.push(AE.Particle),this._inputs[0].excludedConnectionPointTypes.push(AE.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const E=I=>{const E=this.input.getConnectedValue(I);if(this.log.length>=this.stackSize)return E;if(null===E||void 0===E)return this.log.push(["null",""]),E;switch(this.input.type){case AE.Vector2:this.log.push([(0,Zj.h)(E,4),E.toString()]);break;case AE.LE:this.log.push([(0,Zj.i)(E,4),E.toString()]);break;case AE.hh:this.log.push([`{R: ${E.r.toFixed(4)} G: ${E.g.toFixed(4)} B: ${E.b.toFixed(4)} A: ${E.a.toFixed(4)}}`,E.toString()]);break;default:this.log.push([E.toString(),E.toString()])}return E};this.output.isConnected?this.output._storedFunction=E:this.output._storedValue=E(I)}serialize(){const I=super.serialize();return I.stackSize=this.stackSize,I}_deserialize(I){super._deserialize(I),this.stackSize=I.stackSize}}(0,r.b)([pE("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],cj.prototype,"stackSize",void 0),(0,t.h)("BABYLON.ParticleDebugBlock",cj);(0,t.h)("BABYLON.ParticleElbowBlock",class extends BE{constructor(I){super(I),this.registerInput("input",AE.AutoDetect),this.registerOutput("output",AE.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(I){super._build(I);const E=this._outputs[0],j=this._inputs[0];E._storedFunction=I=>j.getConnectedValue(I)}});(0,t.h)("BABYLON.ParticleTeleportInBlock",class extends BE{get endpoints(){return this._endpoints}constructor(I){super(I),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",AE.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(I){if(this.getClassName()===I)return!0;for(const E of this.endpoints)if(E.isAnAncestorOfType(I))return!0;return!1}isAnAncestorOf(I){for(const E of this.endpoints){if(E===I)return!0;if(E.isAnAncestorOf(I))return!0}return!1}attachToEndpoint(I){I.detach(),this._endpoints.push(I),I._entryPoint=this,I._outputs[0]._typeConnectionSource=this._inputs[0],I._tempEntryPointUniqueId=null,I.name="> "+this.name}detachFromEndpoint(I){const E=this._endpoints.indexOf(I);-1!==E&&(this._endpoints.splice(E,1),I._outputs[0]._typeConnectionSource=null,I._entryPoint=null)}_build(){for(const I of this._endpoints)I.output._storedFunction=I=>this.input.getConnectedValue(I)}});(0,t.h)("BABYLON.ParticleTeleportOutBlock",class extends BE{constructor(I){super(I),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",AE.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(I){this.entryPoint&&this.entryPoint.build(I)}clone(){const I=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(I),I}serialize(){var I;const E=super.serialize();return E.entryPoint=(null===(I=this.entryPoint)||void 0===I?void 0:I.uniqueId)??"",E}_deserialize(I){super._deserialize(I),this._tempEntryPointUniqueId=I.entryPoint}}),function(I){I[I.Equal=0]="Equal",I[I.NotEqual=1]="NotEqual",I[I.LessThan=2]="LessThan",I[I.GreaterThan=3]="GreaterThan",I[I.LessOrEqual=4]="LessOrEqual",I[I.GreaterOrEqual=5]="GreaterOrEqual",I[I.Xor=6]="Xor",I[I.Or=7]="Or",I[I.And=8]="And"}(oj||(oj={}));class Kj extends BE{constructor(I){super(I),this.test=oj.Equal,this.epsilon=0,this.registerInput("left",AE.Float),this.registerInput("right",AE.Float,!0,0),this.registerInput("ifTrue",AE.AutoDetect,!0,1),this.registerInput("ifFalse",AE.AutoDetect,!0,0),this.registerOutput("output",AE.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=AE.Float,this._inputs[0].acceptedConnectionPointTypes.push(AE.Int),this._inputs[1].acceptedConnectionPointTypes.push(AE.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const I=I=>{const E=this.left.getConnectedValue(I),j=this.right.getConnectedValue(I);let e=!1;switch(this.test){case oj.Equal:e=(0,R.WithinEpsilon)(E,j,this.epsilon);break;case oj.NotEqual:e=!(0,R.WithinEpsilon)(E,j,this.epsilon);break;case oj.LessThan:e=E<j+this.epsilon;break;case oj.GreaterThan:e=E>j-this.epsilon;break;case oj.LessOrEqual:e=E<=j+this.epsilon;break;case oj.GreaterOrEqual:e=E>=j-this.epsilon;break;case oj.Xor:e=!!E&&!j||!E&&!!j;break;case oj.Or:e=!!E||!!j;break;case oj.And:e=!!E&&!!j}return e};this.output._storedFunction=E=>I(E)?this.ifTrue.getConnectedValue(E):this.ifFalse.getConnectedValue(E)}serialize(){const I=super.serialize();return I.test=this.test,I.epsilon=this.epsilon,I}_deserialize(I){super._deserialize(I),this.test=I.test,void 0!==I.epsilon&&(this.epsilon=I.epsilon)}}(0,r.b)([pE("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:oj.Equal},{label:"NotEqual",value:oj.NotEqual},{label:"LessThan",value:oj.LessThan},{label:"GreaterThan",value:oj.GreaterThan},{label:"LessOrEqual",value:oj.LessOrEqual},{label:"GreaterOrEqual",value:oj.GreaterOrEqual},{label:"Xor",value:oj.Xor},{label:"Or",value:oj.Or},{label:"And",value:oj.And}]})],Kj.prototype,"test",void 0),(0,r.b)([pE("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Kj.prototype,"epsilon",void 0),(0,t.h)("BABYLON.ParticleConditionBlock",Kj);class Lj extends BE{constructor(I){super(I),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",AE.Particle),this.registerInput("condition",AE.Float,!0,0),this.registerInput("system",AE.System),this.registerOutput("output",AE.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(I){this._triggerCount=0;const E=this.input.getConnectedValue(I),j={process:j=>{if(I.particleContext=j,I.systemContext=E,0!==this.condition.getConnectedValue(I)&&(0===this.limit||this._triggerCount<this.limit)){const e=(new Date).getTime();if(this._previousOne&&e-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=e;const w=this.system.getConnectedValue(I);if(w){const e=kE(w,I.CE,j.position);e.Le.addOnce((()=>{this._triggerCount--})),E.Le.addOnce((()=>{e.dispose()}))}}},previousItem:null,nextItem:null};E._updateQueueStart?sI(j,E._updateQueueStart):E._updateQueueStart=j,this.output._storedValue=E}serialize(){const I=super.serialize();return I.limit=this.limit,I.delay=this.delay,I}_deserialize(I){super._deserialize(I),void 0!==I.limit&&(this.limit=I.limit),void 0!==I.delay&&(this.delay=I.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,r.b)([pE("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Lj.prototype,"limit",void 0),(0,r.b)([pE("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Lj.prototype,"delay",void 0),(0,t.h)("BABYLON.ParticleTriggerBlock",Lj);j(12516),j(12520),j(12530),j(12599)},12577:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12539:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12612:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneVertex",z="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12604:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12591:(I,E,j)=>{"use strict";var e=j(11042);const w="fogFragment",z="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12568:(I,E,j)=>{"use strict";var e=j(11042);const w="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12614:(I,E,j)=>{"use strict";var e=j(11042);const w="fogVertex",z="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12609:(I,E,j)=>{"use strict";var e=j(11042);const w="fogVertexDeclaration",z="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12559:(I,E,j)=>{"use strict";var e=j(11042);const w="helperFunctions",z="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12542:(I,E,j)=>{"use strict";var e=j(11042);const w="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12562:(I,E,j)=>{"use strict";var e=j(11042);const w="imageProcessingFunctions",z="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12550:(I,E,j)=>{"use strict";var e=j(11042);const w="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12582:(I,E,j)=>{"use strict";var e=j(11042);const w="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12616:(I,E,j)=>{"use strict";var e=j(11042);const w="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";e.e.IncludesShadersStoreWGSL[w]||(e.e.IncludesShadersStoreWGSL[w]=z)},12530:(I,E,j)=>{"use strict";j.r(E),j.d(E,{particlesPixelShaderWGSL:()=>h});var e=j(11042);j(12539),j(12542),j(12550),j(12559),j(12562),j(12568),j(12577),j(12582),j(12591);const w="particlesPixelShader",z="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";e.e.ShadersStoreWGSL[w]||(e.e.ShadersStoreWGSL[w]=z);const h={name:w,shader:z}},12599:(I,E,j)=>{"use strict";j.r(E),j.d(E,{particlesVertexShaderWGSL:()=>h});var e=j(11042);j(12604),j(12609),j(12550),j(12612),j(12614),j(12616);const w="particlesVertexShader",z="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";e.e.ShadersStoreWGSL[w]||(e.e.ShadersStoreWGSL[w]=z);const h={name:w,shader:z}},12458:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneFragment",z="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12518:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneFragmentDeclaration",z="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12476:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneVertex",z="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12523:(I,E,j)=>{"use strict";var e=j(11042);const w="clipPlaneVertexDeclaration",z="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12463:(I,E,j)=>{"use strict";var e=j(11042);const w="fogFragment",z="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12456:(I,E,j)=>{"use strict";var e=j(11042);const w="fogFragmentDeclaration",z="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12482:(I,E,j)=>{"use strict";var e=j(11042);const w="fogVertex",z="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12472:(I,E,j)=>{"use strict";var e=j(11042);const w="fogVertexDeclaration",z="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12444:(I,E,j)=>{"use strict";var e=j(11042);const w="helperFunctions",z="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12434:(I,E,j)=>{"use strict";var e=j(11042);const w="imageProcessingDeclaration",z="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12447:(I,E,j)=>{"use strict";var e=j(11042);const w="imageProcessingFunctions",z="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12441:(I,E,j)=>{"use strict";var e=j(11042);const w="logDepthDeclaration",z="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12460:(I,E,j)=>{"use strict";var e=j(11042);const w="logDepthFragment",z="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12487:(I,E,j)=>{"use strict";var e=j(11042);const w="logDepthVertex",z="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";e.e.IncludesShadersStore[w]||(e.e.IncludesShadersStore[w]=z)},12516:(I,E,j)=>{"use strict";j.r(E),j.d(E,{particlesPixelShader:()=>h});var e=j(11042);j(12518),j(12434),j(12441),j(12444),j(12447),j(12456),j(12458),j(12460),j(12463);const w="particlesPixelShader",z="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";e.e.ShadersStore[w]||(e.e.ShadersStore[w]=z);const h={name:w,shader:z}},12520:(I,E,j)=>{"use strict";j.r(E),j.d(E,{particlesVertexShader:()=>h});var e=j(11042);j(12523),j(12472),j(12441),j(12476),j(12482),j(12487);const w="particlesVertexShader",z="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";e.e.ShadersStore[w]||(e.e.ShadersStore[w]=z);const h={name:w,shader:z}},12862:(I,E,j)=>{"use strict";j.r(E),j.d(E,{FlowGraphGLTFDataProvider:()=>z});var e=j(12834),w=j(12819);class z extends e.e{constructor(I){var E,j;super();const e=I.glTF,z=(null===(E=e.animations)||void 0===E?void 0:E.map((I=>I._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",w.e,z);const h=(null===(j=e.nodes)||void 0===j?void 0:j.map((I=>I._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",w.e,h)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12760:(I,E,j)=>{"use strict";j.d(E,{b:()=>F,e:()=>K,f:()=>c,i:()=>L});var e=j(11117),w=j(11595),z=j(11165),h=j(12765);const t=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class U{constructor(I,E){this._gltf=I,this._infoTree=E}convert(I){let E,j=this._gltf,e=this._infoTree;if(!I.startsWith("/"))throw new Error("Path must start with a /");const w=I.split("/");if(w.shift(),w[w.length-1].includes(".length")){const I=w[w.length-1].split(".");w.pop(),w.push(...I)}let z=!1;for(const U of w){const w="length"===U;if(w&&!e.__array__)throw new Error(`Path ${I} is invalid`);if(e.__ignoreObjectTree__&&(z=!0),e.__array__&&!w)e=e.__array__;else if(e=e[U],!e)throw new Error(`Path ${I} is invalid`);if(!z)if(void 0===j){if(!t.find((E=>E.regex.test(I))))throw new Error(`Path ${I} is invalid`)}else if(!w){var h;j=null===(h=j)||void 0===h?void 0:h[U]}(e.__target__||w)&&(E=j)}return{object:E,info:e}}}function R(I,E,j,e){const w=P(I,E);return e?w[j][e]:w[j]}function P(I,E,j){var e,z;return null===(e=I._data)||void 0===e||null===(z=e[(null===j||void 0===j?void 0:j.fillMode)??w.b.MATERIAL_TriangleFillMode])||void 0===z?void 0:z.babylonMaterial}function o(I,E){return{offset:{componentsCount:2,type:"Vector2",get:(j,w,z)=>{const h=R(j,z,I,E);return new e.Vector2(null===h||void 0===h?void 0:h.uOffset,null===h||void 0===h?void 0:h.vOffset)},getTarget:P,set:(j,e,w,z)=>{const h=R(e,z,I,E);h.uOffset=j.x,h.vOffset=j.y},getPropertyName:[()=>`${I}${E?"."+E:""}.uOffset`,()=>`${I}${E?"."+E:""}.vOffset`]},rotation:{type:"number",get:(j,e,w)=>{var z;return null===(z=R(j,w,I,E))||void 0===z?void 0:z.wAng},getTarget:P,set:(j,e,w,z)=>R(e,z,I,E).wAng=j,getPropertyName:[()=>`${I}${E?"."+E:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(j,w,z)=>{const h=R(j,z,I,E);return new e.Vector2(null===h||void 0===h?void 0:h.uScale,null===h||void 0===h?void 0:h.vScale)},getTarget:P,set:(j,e,w,z)=>{const h=R(e,z,I,E);h.uScale=j.x,h.vScale=j.y},getPropertyName:[()=>`${I}${E?"."+E:""}.uScale`,()=>`${I}${E?"."+E:""}.vScale`]}}}const Z={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:I=>{var E,j;return new e.Vector2((null===(E=I._babylonCamera)||void 0===E?void 0:E.orthoLeft)??0,(null===(j=I._babylonCamera)||void 0===j?void 0:j.orthoRight)??0)},set:(I,E)=>{E._babylonCamera&&(E._babylonCamera.orthoLeft=I.x,E._babylonCamera.orthoRight=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:I=>{var E,j;return new e.Vector2((null===(E=I._babylonCamera)||void 0===E?void 0:E.orthoBottom)??0,(null===(j=I._babylonCamera)||void 0===j?void 0:j.orthoTop)??0)},set:(I,E)=>{E._babylonCamera&&(E._babylonCamera.orthoBottom=I.x,E._babylonCamera.orthoTop=I.y)},getTarget:I=>I,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:I=>{var E;return null===(E=I._babylonCamera)||void 0===E?void 0:E.maxZ},set:(I,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var E;return null===(E=I._babylonCamera)||void 0===E?void 0:E.Te},set:(I,E)=>{E._babylonCamera&&(E._babylonCamera.Te=I)},getTarget:I=>I,getPropertyName:[()=>"Te"]}},perspective:{aspectRatio:{type:"number",get:I=>{var E;return null===(E=I._babylonCamera)||void 0===E?void 0:E.getEngine().getAspectRatio(I._babylonCamera)},getTarget:I=>I,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:I=>{var E;return null===(E=I._babylonCamera)||void 0===E?void 0:E.fov},set:(I,E)=>{E._babylonCamera&&(E._babylonCamera.fov=I)},getTarget:I=>I,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:I=>{var E;return null===(E=I._babylonCamera)||void 0===E?void 0:E.maxZ},set:(I,E)=>{E._babylonCamera&&(E._babylonCamera.maxZ=I)},getTarget:I=>I,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:I=>{var E;return null===(E=I._babylonCamera)||void 0===E?void 0:E.Te},set:(I,E)=>{E._babylonCamera&&(E._babylonCamera.Te=I)},getTarget:I=>I,getPropertyName:[()=>"Te"]}}}},nodes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"LE",get:I=>{var E;return null===(E=I._babylonTransformNode)||void 0===E?void 0:E.position},set:(I,E)=>{var j;return null===(j=E._babylonTransformNode)||void 0===j?void 0:j.position.U(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:I=>{var E;return null===(E=I._babylonTransformNode)||void 0===E?void 0:E.rotationQuaternion},set:(I,E)=>{var j,e;return null===(j=E._babylonTransformNode)||void 0===j||null===(e=j.rotationQuaternion)||void 0===e?void 0:e.U(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"LE",get:I=>{var E;return null===(E=I._babylonTransformNode)||void 0===E?void 0:E.pz},set:(I,E)=>{var j;return null===(j=E._babylonTransformNode)||void 0===j?void 0:j.pz.U(I)},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pz"]},weights:{length:{type:"number",get:I=>I._numMorphTargets,getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(I,E)=>{var j,e;return void 0!==E?null===(j=I._primitiveBabylonMeshes)||void 0===j||null===(e=j[0].morphTargetManager)||void 0===e?void 0:e.getTarget(E).influence:void 0},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(I,E)=>[0],getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:I=>{var E,j,w;return e.Matrix.Compose(null===(E=I._babylonTransformNode)||void 0===E?void 0:E.pz,null===(j=I._babylonTransformNode)||void 0===j?void 0:j.rotationQuaternion,null===(w=I._babylonTransformNode)||void 0===w?void 0:w.position)},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:I=>{var E,j,w,z;const h=e.Matrix.Identity();let t=I.parent;for(;t&&t.parent;)t=t.parent;const U=(null===(E=I._babylonTransformNode)||void 0===E?void 0:E.position._isDirty)||(null===(j=I._babylonTransformNode)||void 0===j||null===(w=j.rotationQuaternion)||void 0===w?void 0:w._isDirty)||(null===(z=I._babylonTransformNode)||void 0===z?void 0:z.pz._isDirty);if(t){var R;const E=null===(R=t._babylonTransformNode)||void 0===R?void 0:R.Be(!0).invert();var P,o;if(E)null===(P=I._babylonTransformNode)||void 0===P||null===(o=P.Be(U))||void 0===o||o.multiplyToRef(E,h)}else I._babylonTransformNode&&h.U(I._babylonTransformNode.Be(U));return h},getTarget:I=>I._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:I=>{var E,j;return null===(E=I._babylonTransformNode)||void 0===E||null===(j=E.getChildren((I=>I instanceof h.e),!0)[0])||void 0===j?void 0:j.Ch},getTarget:I=>{var E;return null===(E=I._babylonTransformNode)||void 0===E?void 0:E.getChildren((I=>I instanceof h.e),!0)[0]},set:(I,E)=>{if(E._babylonTransformNode){const j=E._babylonTransformNode.getChildren((I=>I instanceof h.e),!0)[0];j&&(j.Ch=I)}}},color:{type:"qE",get:I=>{var E,j;return null===(E=I._babylonTransformNode)||void 0===E||null===(j=E.getChildren((I=>I instanceof h.e),!0)[0])||void 0===j?void 0:j.xh},getTarget:I=>{var E;return null===(E=I._babylonTransformNode)||void 0===E?void 0:E.getChildren((I=>I instanceof h.e),!0)[0]},set:(I,E)=>{if(E._babylonTransformNode){const j=E._babylonTransformNode.getChildren((I=>I instanceof h.e),!0)[0];j&&(j.xh=I)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"qE",get:(I,E,j)=>P(I,E,j).emissiveColor,set:(I,E,j,e)=>P(E,j,e).emissiveColor.U(I),getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:o("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(I,E,j)=>{var e;return null===(e=R(I,j,"bumpTexture"))||void 0===e?void 0:e.level},set:(I,E,j,e)=>{const w=R(E,e,"bumpTexture");w&&(w.level=I)},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:o("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(I,E,j)=>P(I,E,j).ambientTextureStrength,set:(I,E,j,e)=>{const w=P(E,j,e);w&&(w.ambientTextureStrength=I)},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:o("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"hh",get:(I,E,j)=>{const e=P(I,E,j);return z.hh.FromColor3(e.albedoColor,e.alpha)},set:(I,E,j,e)=>{const w=P(E,j,e);w.albedoColor.set(I.r,I.g,I.b),w.alpha=I.a},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:o("albedoTexture")}},metallicFactor:{type:"number",get:(I,E,j)=>P(I,E,j).metallic,set:(I,E,j,e)=>{const w=P(E,j,e);w&&(w.metallic=I)},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(I,E,j)=>P(I,E,j).roughness,set:(I,E,j,e)=>{const w=P(E,j,e);w&&(w.roughness=I)},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:o("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(I,E,j)=>P(I,E,j).anisotropy.Ch,set:(I,E,j,e)=>{P(E,j,e).anisotropy.Ch=I},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(I,E,j)=>P(I,E,j).anisotropy.angle,set:(I,E,j,e)=>{P(E,j,e).anisotropy.angle=I},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:o("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(I,E,j)=>P(I,E,j).clearCoat.Ch,set:(I,E,j,e)=>{P(E,j,e).clearCoat.Ch=I},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(I,E,j)=>P(I,E,j).clearCoat.roughness,set:(I,E,j,e)=>{P(E,j,e).clearCoat.roughness=I},getTarget:(I,E,j)=>P(I,E,j),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:o("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(I,E,j)=>{var e;return null===(e=P(I,E,j).clearCoat.bumpTexture)||void 0===e?void 0:e.level},getTarget:P,set:(I,E,j,e)=>P(E,j,e).clearCoat.bumpTexture.level=I},extensions:{KHR_texture_transform:o("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:o("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(I,E,j)=>P(I,E,j).subSurface.dispersion,getTarget:P,set:(I,E,j,e)=>P(E,j,e).subSurface.dispersion=I}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(I,E,j)=>P(I,E,j).emissiveIntensity,getTarget:P,set:(I,E,j,e)=>P(E,j,e).emissiveIntensity=I}},KHR_materials_ior:{ior:{type:"number",get:(I,E,j)=>P(I,E,j).indexOfRefraction,getTarget:P,set:(I,E,j,e)=>P(E,j,e).indexOfRefraction=I}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(I,E,j)=>P(I,E,j).iridescence.Ch,getTarget:P,set:(I,E,j,e)=>P(E,j,e).iridescence.Ch=I},iridescenceIor:{type:"number",get:(I,E,j)=>P(I,E,j).iridescence.indexOfRefraction,getTarget:P,set:(I,E,j,e)=>P(E,j,e).iridescence.indexOfRefraction=I},iridescenceTexture:{extensions:{KHR_texture_transform:o("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(I,E,j)=>P(I,E,j).iridescence.maximumThickness,getTarget:P,set:(I,E,j,e)=>P(E,j,e).iridescence.maximumThickness=I},iridescenceThicknessMinimum:{type:"number",get:(I,E,j)=>P(I,E,j).iridescence.minimumThickness,getTarget:P,set:(I,E,j,e)=>P(E,j,e).iridescence.minimumThickness=I},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:o("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"qE",get:(I,E,j)=>P(I,E,j).sheen.color,getTarget:P,set:(I,E,j,e)=>P(E,j,e).sheen.color.U(I)},sheenColorTexture:{extensions:{KHR_texture_transform:o("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(I,E,j)=>P(I,E,j).sheen.Ch,getTarget:P,set:(I,E,j,e)=>P(E,j,e).sheen.Ch=I},sheenRoughnessTexture:{extensions:{KHR_texture_transform:o("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(I,E,j)=>P(I,E,j).metallicF0Factor,getTarget:P,set:(I,E,j,e)=>P(E,j,e).metallicF0Factor=I,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"qE",get:(I,E,j)=>P(I,E,j).metallicReflectanceColor,getTarget:P,set:(I,E,j,e)=>P(E,j,e).metallicReflectanceColor.U(I),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:o("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:o("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(I,E,j)=>P(I,E,j).subSurface.refractionIntensity,getTarget:P,set:(I,E,j,e)=>P(E,j,e).subSurface.refractionIntensity=I,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:o("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(I,E,j)=>P(I,E,j).subSurface.translucencyIntensity,getTarget:P,set:(I,E,j,e)=>P(E,j,e).subSurface.translucencyIntensity=I},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:o("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"qE",get:(I,E,j)=>P(I,E,j).subSurface.translucencyColor,getTarget:P,set:(I,E,j,e)=>{var w;return I&&(null===(w=P(E,j,e).subSurface.translucencyColor)||void 0===w?void 0:w.U(I))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:o("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"qE",get:(I,E,j)=>P(I,E,j).subSurface.tintColor,getTarget:P,set:(I,E,j,e)=>P(E,j,e).subSurface.tintColor.U(I)},attenuationDistance:{type:"number",get:(I,E,j)=>P(I,E,j).subSurface.tintColorAtDistance,getTarget:P,set:(I,E,j,e)=>P(E,j,e).subSurface.tintColorAtDistance=I},thicknessFactor:{type:"number",get:(I,E,j)=>P(I,E,j).subSurface.maximumThickness,getTarget:P,set:(I,E,j,e)=>P(E,j,e).subSurface.maximumThickness=I},thicknessTexture:{extensions:{KHR_texture_transform:o("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,color:{type:"qE",get:I=>{var E;return null===(E=I._babylonLight)||void 0===E?void 0:E.xh},set:(I,E)=>{var j;return null===(j=E._babylonLight)||void 0===j?void 0:j.xh.U(I)},getTarget:I=>I._babylonLight,getPropertyName:[I=>"diffuse"]},Ch:{type:"number",get:I=>{var E;return null===(E=I._babylonLight)||void 0===E?void 0:E.Ch},set:(I,E)=>E._babylonLight?E._babylonLight.Ch=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"intensity"]},range:{type:"number",get:I=>{var E;return null===(E=I._babylonLight)||void 0===E?void 0:E.range},set:(I,E)=>E._babylonLight?E._babylonLight.range=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"range"]},spot:{innerConeAngle:{type:"number",get:I=>{var E;return null===(E=I._babylonLight)||void 0===E?void 0:E.innerAngle},set:(I,E)=>E._babylonLight?E._babylonLight.innerAngle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"innerConeAngle"]},outerConeAngle:{type:"number",get:I=>{var E;return null===(E=I._babylonLight)||void 0===E?void 0:E.angle},set:(I,E)=>E._babylonLight?E._babylonLight.angle=I:void 0,getTarget:I=>I._babylonLight,getPropertyName:[I=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonLight)),getPropertyName:[I=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonTexture)),getPropertyName:[I=>"length"]},__array__:{__target__:!0,Ch:{type:"number",get:I=>{var E;return null===(E=I._babylonTexture)||void 0===E?void 0:E.level},set:(I,E)=>{E._babylonTexture&&(E._babylonTexture.level=I)},getTarget:I=>I._babylonTexture},rotation:{type:"Quaternion",get:I=>{var E;return I._babylonTexture&&e.Quaternion.FromRotationMatrix(null===(E=I._babylonTexture)||void 0===E?void 0:E.getReflectionTextureMatrix())},set:(I,E)=>{var j;E._babylonTexture&&(null!==(j=E._babylonTexture.GI())&&void 0!==j&&j.useRightHandedSystem||(I=e.Quaternion.Inverse(I)),e.Matrix.FromQuaternionToRef(I,E._babylonTexture.getReflectionTextureMatrix()))},getTarget:I=>I._babylonTexture}}}}},animations:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>I._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:I=>I.length,getTarget:I=>I.map((I=>{var E;return null===(E=I.primitives[0]._instanceData)||void 0===E?void 0:E.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function c(I){return new U(I,Z)}function K(I){const E=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let j=Z;for(const e of E)e&&(j=j[e]);if(j&&j.type&&j.get)return j}function L(I,E){const j=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let e=Z;for(const w of j)w&&(e=e[w]);e&&e.type&&e.get&&(e.interpolation=E)}function F(I,E){const j=I.split("/").map((I=>I.replace(/{}/g,"__array__")));let e=Z;for(const w of j)if(w){if(!e[w]){if("?"===w){e.__ignoreObjectTree__=!0;continue}e[w]={},"__array__"===w&&(e[w].__target__=!0)}e=e[w]}Object.assign(e,E)}},12769:(I,E,j)=>{"use strict";j.r(E),j.d(E,{AnimationPropertyInfo:()=>R,TransformNodeAnimationPropertyInfo:()=>P,WeightAnimationPropertyInfo:()=>o,getQuaternion:()=>t,getVector3:()=>h,getWeights:()=>U});var e=j(11637),w=j(11117),z=j(12760);function h(I,E,j,e){return w.LE.xE(E,j).scaleInPlace(e)}function t(I,E,j,e){return w.Quaternion.xE(E,j).scaleInPlace(e)}function U(I,E,j,e){const w=new Array(I._numMorphTargets);for(let z=0;z<w.length;z++)w[z]=E[j++]*e;return w}class R{constructor(I,E,j,e){this.type=I,this.name=E,this.getValue=j,this.getStride=e}_buildAnimation(I,E,j){const w=new e.c(I,this.name,E,this.type);return w.setKeys(j),w}}class P extends R{buildAnimations(I,E,j,e){const w=[];return w.push({babylonAnimatable:I._babylonTransformNode,babylonAnimation:this._buildAnimation(E,j,e)}),w}}class o extends R{buildAnimations(I,E,j,w){const z=[];if(I._numMorphTargets)for(let h=0;h<I._numMorphTargets;h++){const t=new e.c(`${E}_${h}`,this.name,j,this.type);if(t.setKeys(w.map((I=>({frame:I.frame,inTangent:I.inTangent?I.inTangent[h]:void 0,value:I.value[h],outTangent:I.outTangent?I.outTangent[h]:void 0,interpolation:I.interpolation})))),I._primitiveBabylonMeshes)for(const E of I._primitiveBabylonMeshes)if(E.morphTargetManager){const I=E.morphTargetManager.getTarget(h),j=t.clone();I.animations.push(j),z.push({babylonAnimatable:I,babylonAnimation:j})}}return z}}(0,z.i)("/nodes/{}/translation",[new P(e.c.ANIMATIONTYPE_VECTOR3,"position",h,(()=>3))]),(0,z.i)("/nodes/{}/rotation",[new P(e.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",t,(()=>4))]),(0,z.i)("/nodes/{}/scale",[new P(e.c.ANIMATIONTYPE_VECTOR3,"pz",h,(()=>3))]),(0,z.i)("/nodes/{}/weights",[new o(e.c.ANIMATIONTYPE_FLOAT,"influence",U,(I=>I._numMorphTargets))])},12717:(I,E,j)=>{"use strict";class e{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((I,E)=>{this._resolve=I,this._reject=E}))}}var w=j(11117),z=j(11165),h=j(10953),t=j(11564),U=j(12720),R=j(12737),P=j(10960),o=j(11587),Z=j(11637),c=j(11644),K=j(10993),L=j(10974),F=j(10978);class C{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(I){this._useTextureToStoreBoneMatrices=I,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(I){this._animationPropertiesOverride=I}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(I,E,j){this.name=I,this.id=E,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=w.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new P.e,this.bones=[],this._scene=j||K.d.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const e=this._scene.getEngine().getCaps();this._canUseTextureForBones=e.textureFloat&&e.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((I=>!I.getParent()))}getTransformMatrices(I){if(this.needInitialSkinMatrix){if(!I)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return I._bonesTransformMatrices||this.prepare(!0),I._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(I){return this.needInitialSkinMatrix&&I._transformMatrixTexture?I._transformMatrixTexture:this._transformMatrixTexture}GI(){return this._scene}toString(I){let E=`Name: ${this.name}, nBones: ${this.bones.length}`;if(E+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,I){E+=", Ranges: {";let I=!0;for(const j in this._ranges)I&&(E+=", ",I=!1),E+=j;E+="}"}return E}getBoneIndexByName(I){for(let E=0,j=this.bones.length;E<j;E++)if(this.bones[E].name===I)return E;return-1}createAnimationRange(I,E,j){if(!this._ranges[I]){this._ranges[I]=new c.b(I,E,j);for(let e=0,w=this.bones.length;e<w;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].createRange(I,E,j)}}deleteAnimationRange(I){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let j=0,e=this.bones.length;j<e;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].deleteRange(I,E);this._ranges[I]=null}getAnimationRange(I){return this._ranges[I]||null}getAnimationRanges(){const I=[];let E;for(E in this._ranges)I.push(this._ranges[E]);return I}copyAnimationRange(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[E]||!I.getAnimationRange(E))return!1;let e=!0;const w=this._getHighestAnimationFrame()+1,z={},h=I.bones;let t,U;for(U=0,t=h.length;U<t;U++)z[h[U].name]=h[U];this.bones.length!==h.length&&(L.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${h.length}`),e=!1);const R=j&&this.dimensionsAtRest&&I.dimensionsAtRest?this.dimensionsAtRest.divide(I.dimensionsAtRest):null;for(U=0,t=this.bones.length;U<t;U++){const I=this.bones[U].name,h=z[I];h?e=e&&this.bones[U].copyAnimationRange(h,E,w,j,R):(L.b.Warn("copyAnimationRange: not same rig, missing source bone "+I),e=!1)}const P=I.getAnimationRange(E);return P&&(this._ranges[E]=new c.b(E,P.from+w,P.to+w)),e}returnToRest(){for(const I of this.bones)-1!==I._index&&I.returnToRest()}_getHighestAnimationFrame(){let I=0;for(let E=0,j=this.bones.length;E<j;E++)if(this.bones[E].animations[0]){const j=this.bones[E].animations[0].getHighestFrame();I<j&&(I=j)}return I}beginAnimation(I,E,j,e){const w=this.getAnimationRange(I);return w?this._scene.beginAnimation(this,w.from,w.to,E,j,e):null}static MakeAnimationAdditive(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,j=arguments.length>2?arguments[2]:void 0;const e=I.getAnimationRange(j);if(!e)return null;const w=I._scene.getAllAnimatablesByTarget(I);let z=null;for(let t=0;t<w.length;t++){const I=w[t];if(I.fromFrame===(null===e||void 0===e?void 0:e.from)&&I.toFrame===(null===e||void 0===e?void 0:e.to)){z=I;break}}const h=I.getAnimatables();for(let t=0;t<h.length;t++){const I=h[t].animations;if(I)for(let e=0;e<I.length;e++)Z.c.MakeAnimationAdditive(I[e],E,j)}return z&&(z.isAdditive=!0),I}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(I){this._meshesWithPoseMatrix.push(I)}_unregisterMeshWithPoseMatrix(I){const E=this._meshesWithPoseMatrix.indexOf(I);E>-1&&this._meshesWithPoseMatrix.splice(E,1)}_computeTransformMatrices(I,E){this.onBeforeComputeObservable.notifyObservers(this);for(let j=0;j<this.bones.length;j++){const e=this.bones[j];e._childUpdateId++;const w=e.getParent();if(w?e.getLocalMatrix().multiplyToRef(w.getFinalMatrix(),e.getFinalMatrix()):E?e.getLocalMatrix().multiplyToRef(E,e.getFinalMatrix()):e.getFinalMatrix().U(e.getLocalMatrix()),-1!==e._index){const E=null===e._index?j:e._index;e.getAbsoluteInverseBindMatrix().multiplyToArray(e.getFinalMatrix(),I,16*E)}}this._identity.copyToArray(I,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const I=this.GI().getRenderId();if(this._currentRenderId===I)return;this._currentRenderId=I}if(this._numBonesWithLinkedTransformNode>0)for(const I of this.bones)if(I._linkedTransformNode){const E=I._linkedTransformNode;I.position=E.position,E.rotationQuaternion?I.rotationQuaternion=E.rotationQuaternion:I.rotation=E.rotation,I.pz=E.pz}if(this.needInitialSkinMatrix)for(const I of this._meshesWithPoseMatrix){const E=I.getPoseMatrix();let j=this._isDirty;if(I._bonesTransformMatrices&&I._bonesTransformMatrices.length===16*(this.bones.length+1)||(I._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),j=!0),j){if(this._synchronizedWithMesh!==I){this._synchronizedWithMesh=I;for(const I of this.bones)if(!I.getParent()){I.getBindMatrix().multiplyToRef(E,w.TmpVectors.Matrix[1]),I._updateAbsoluteBindMatrices(w.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const E=4*(this.bones.length+1);I._transformMatrixTexture&&I._transformMatrixTexture.getSize().width===E||(I._transformMatrixTexture&&I._transformMatrixTexture.dispose(),I._transformMatrixTexture=o.c.CreateRGBATexture(I._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(I._bonesTransformMatrices,E),this.isUsingTextureForMatrices&&I._transformMatrixTexture&&I._transformMatrixTexture.update(I._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=o.c.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let I=0;I<this.bones.length;I++)this._animatables.push(this.bones[I])}return this._animatables}clone(I,E){const j=new C(I,E||I,this._scene);j.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){const I=this.bones[e];let E=null;const w=I.getParent();if(w){const I=this.bones.indexOf(w);E=j.bones[I]}const z=new R.e(I.name,j,E,I.getBindMatrix().clone(),I.getRestMatrix().clone());z._index=I._index,I._linkedTransformNode&&z.linkTransformNode(I._linkedTransformNode),F.e.DeepCopy(I.animations,z.animations)}if(this._ranges){j._ranges={};for(const I in this._ranges){const E=this._ranges[I];E&&(j._ranges[I]=E.clone())}}return this._isDirty=!0,j.prepare(!0),j}enableBlending(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const E of this.bones)for(const j of E.animations)j.enableBlending=!0,j.blendingSpeed=I}dispose(){if(this._meshesWithPoseMatrix.length=0,this.GI().stopAnimation(this),this.GI().removeSkeleton(this),this._parentContainer){const I=this._parentContainer.skeletons.indexOf(this);I>-1&&this._parentContainer.skeletons.splice(I,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const I={};I.name=this.name,I.id=this.id,this.dimensionsAtRest&&(I.dimensionsAtRest=this.dimensionsAtRest.re()),I.bones=[],I.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let j=0;j<this.bones.length;j++){var E;const e=this.bones[j],w=e.getParent(),z={parentBoneIndex:w?this.bones.indexOf(w):-1,index:e.getIndex(),name:e.name,id:e.id,matrix:e.getBindMatrix().re(),rest:e.getRestMatrix().re(),linkedTransformNodeId:null===(E=e.getTransformNode())||void 0===E?void 0:E.id};I.bones.push(z),e.length&&(z.length=e.length),e.metadata&&(z.metadata=e.metadata),e.animations&&e.animations.length>0&&(z.animation=e.animations[0].serialize()),I.ranges=[];for(const E in this._ranges){const j=this._ranges[E];if(!j)continue;const e={};e.name=E,e.from=j.from,e.to=j.to,I.ranges.push(e)}}return I}static Parse(I,E){const j=new C(I.name,I.id,E);let e;for(I.dimensionsAtRest&&(j.dimensionsAtRest=w.LE.xE(I.dimensionsAtRest)),j.needInitialSkinMatrix=I.needInitialSkinMatrix,e=0;e<I.bones.length;e++){const E=I.bones[e],z=I.bones[e].index;let h=null;E.parentBoneIndex>-1&&(h=j.bones[E.parentBoneIndex]);const t=E.rest?w.Matrix.xE(E.rest):null,U=new R.e(E.name,j,h,w.Matrix.xE(E.matrix),t,null,z);void 0!==E.id&&null!==E.id&&(U.id=E.id),E.length&&(U.length=E.length),E.metadata&&(U.metadata=E.metadata),E.animation&&U.animations.push(Z.c.Parse(E.animation)),void 0!==E.linkedTransformNodeId&&null!==E.linkedTransformNodeId&&(j._hasWaitingData=!0,U._waitingTransformNodeId=E.linkedTransformNodeId)}if(I.ranges)for(e=0;e<I.ranges.length;e++){const E=I.ranges[e];j.createAnimationRange(E.name,E.from,E.to)}return j}computeAbsoluteMatrices(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||I)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(I)}getPoseMatrix(){let I=null;return this._meshesWithPoseMatrix.length>0&&(I=this._meshesWithPoseMatrix[0].getPoseMatrix()),I}sortBones(){const I=[],E=new Array(this.bones.length);for(let j=0;j<this.bones.length;j++)this._sortBones(j,I,E);this.bones=I}_sortBones(I,E,j){if(j[I])return;j[I]=!0;const e=this.bones[I];if(!e)return;void 0===e._index&&(e._index=I);const w=e.getParent();w&&this._sortBones(this.bones.indexOf(w),E,j),E.push(e)}setCurrentPoseAsRest(){for(const I of this.bones)I.setCurrentPoseAsRest()}}var X=j(11436),q=j(11600),x=j(11097),u=j(11530),b=j(11197),Q=j(11573),G=j(11535),y=j(11562),d=j(11648),a=j(11222),l=j(12687);class i{set areUpdatesFrozen(I){I?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new a.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,I||(I=K.d.LastCreatedScene),this._scene=I,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const I=this._scene.getEngine().getCaps();this._canUseTextureForTargets=I.canUseGLVertexID&&I.textureFloat&&I.maxVertexTextureImageUnits>0&&I.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return i.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?i.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(I){this._numMaxInfluencers!==I&&(this._numMaxInfluencers=I,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(I){this._useTextureToStoreTargets!==I&&(this._useTextureToStoreTargets=I,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var I;return i.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(I=this._scene)&&void 0!==I&&I.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(I){return this._activeTargets.data[I]}getTarget(I){return this._targets[I]}getTargetByName(I){for(const E of this._targets)if(E.name===I)return E;return null}addTarget(I){this._targets.push(I),this._targetInfluenceChangedObservers.push(I.onInfluenceChanged.add((I=>{this.areUpdatesFrozen&&I&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(I)}))),this._targetDataLayoutChangedObservers.push(I._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(I){const E=this._targets.indexOf(I);E>=0&&(this._targets.splice(E,1),I.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(E,1)[0]),I._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(E,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(I)}_bind(I){I.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),I.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),I.setTexture("morphTargets",this._targetStoreTexture),I.setInt("morphTargetCount",this.numInfluencers)}clone(){const I=new i(this._scene);for(const E of this._targets)I.addTarget(E.clone());return I.enablePositionMorphing=this.enablePositionMorphing,I.enableNormalMorphing=this.enableNormalMorphing,I.enableTangentMorphing=this.enableTangentMorphing,I.enableUVMorphing=this.enableUVMorphing,I.enableUV2Morphing=this.enableUV2Morphing,I.enableColorMorphing=this.enableColorMorphing,I}serialize(){const I={};I.id=this.uniqueId,I.targets=[];for(const E of this._targets)I.targets.push(E.serialize());return I}_syncActiveTargets(){let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const E=!!this._targetStoreTexture,j=this.isUsingTextureForTargets;(this._mustSynchronize||E!==j)&&(this._mustSynchronize=!1,this.synchronize());let e=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let w=-1;for(const z of this._targets)if(w++,0!==z.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=i.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(z),this._morphTargetTextureIndices[e]=w,this._tempInfluences[e++]=z.influence}this._morphTargetTextureIndices.length!==e&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,e)),this._influences&&this._influences.length===e||(this._influences=new Float32Array(e));for(let z=0;z<e;z++)this._influences[z]=this._tempInfluences[z];if(I&&this._scene)for(const z of this._scene.meshes)z.morphTargetManager===this&&(j?z._markSubMeshesAsAttributesDirty():z._syncGeometryWithMorphTargetManager())}synchronize(){var I;if(!this._scene||this.areUpdatesFrozen)return;const E=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(I=this._targetStoreTexture)||void 0===I||I.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>E.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const j of this._targets){this._supportsPositions=this._supportsPositions&&j.hasPositions,this._supportsNormals=this._supportsNormals&&j.hasNormals,this._supportsTangents=this._supportsTangents&&j.hasTangents,this._supportsUVs=this._supportsUVs&&j.hasUVs,this._supportsUV2s=this._supportsUV2s&&j.hasUV2s,this._supportsColors=this._supportsColors&&j.hasColors;const I=j.vertexCount;if(0===this._vertexCount)this._vertexCount=I;else if(this._vertexCount!==I)return void L.b.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${j.name}": ${I}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const I=E.getCaps().maxTextureSize;this._textureWidth>I&&(this._textureHeight=Math.ceil(this._textureWidth/I),this._textureWidth=I);const j=this._targets.length,e=new Float32Array(j*this._textureWidth*this._textureHeight*4);let w=0;for(let E=0;E<j;E++){const I=this._targets[E],j=I.getPositions(),z=I.getNormals(),h=I.getUVs(),t=I.getTangents(),U=I.getUV2s(),R=I.getColors();w=E*this._textureWidth*this._textureHeight*4;for(let E=0;E<this._vertexCount;E++)this._supportsPositions&&j&&(e[w]=j[3*E],e[w+1]=j[3*E+1],e[w+2]=j[3*E+2],w+=4),this._supportsNormals&&z&&(e[w]=z[3*E],e[w+1]=z[3*E+1],e[w+2]=z[3*E+2],w+=4),this._supportsUVs&&h&&(e[w]=h[2*E],e[w+1]=h[2*E+1],w+=4),this._supportsTangents&&t&&(e[w]=t[3*E],e[w+1]=t[3*E+1],e[w+2]=t[3*E+2],w+=4),this._supportsUV2s&&U&&(e[w]=U[2*E],e[w+1]=U[2*E+1],w+=4),this._supportsColors&&R&&(e[w]=R[4*E],e[w+1]=R[4*E+1],e[w+2]=R[4*E+2],e[w+3]=R[4*E+3],w+=4)}this._targetStoreTexture=l.d.CreateRGBATexture(e,this._textureWidth,this._textureHeight,j,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const j of this._scene.meshes)j.morphTargetManager===this&&j._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const I=this._parentContainer.morphTargetManagers.indexOf(this);I>-1&&this._parentContainer.morphTargetManagers.splice(I,1),this._parentContainer=null}for(const I of this._targets)this._scene.stopAnimation(I)}}static Parse(I,E){const j=new i(E);for(const e of I.targets)j.addTarget(d.c.Parse(e,E));return j}}i.EnableTextureStorage=!0,i.MaxActiveMorphTargetsInVertexAttributeMode=8,i.ConstantTargetCountForTextureMode=0;var r=j(12743),n=j(11e3),H=j(11446);const g=new Map,Y=g;function A(I,E,j){T(I)&&L.b.Warn(`Extension with the name '${I}' already exists`),g.set(I,{isGLTFExtension:E,factory:j})}function T(I){return g.delete(I)}var M=j(12760),W=j(11696),O=j(11210);class s{static Get(I,E,j){if(!E||void 0==j||!E[j])throw new Error(`${I}: Failed to find index (${j})`);return E[j]}static TryGet(I,E){return I&&void 0!=E&&I[E]?I[E]:null}static Assign(I){if(I)for(let E=0;E<I.length;E++)I[E].index=E}}function v(I){if(I.min&&I.max){const E=I.min,j=I.max,e=w.TmpVectors.LE[0].nz(E[0],E[1],E[2]),z=w.TmpVectors.LE[1].nz(j[0],j[1],j[2]);if(I.normalized&&5126!==I.componentType){let E=1;switch(I.componentType){case 5120:E=127;break;case 5121:E=255;break;case 5122:E=32767;break;case 5123:E=65535}const j=1/E;e.scaleInPlace(j),z.scaleInPlace(j)}return new H.b(e,z)}return null}class V{static RegisterExtension(I,E){A(I,!1,E)}static UnregisterExtension(I){return T(I)}get de(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(I){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=I}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((I=>I.dispose&&I.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(I,E,j,e,w,z){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=E,this._assetContainer=j,this._loadData(e);let z=null;if(I){const E={};if(this._gltf.nodes)for(const I of this._gltf.nodes)I.name&&(E[I.name]=I.index);z=(I instanceof Array?I:[I]).map((I=>{const j=E[I];if(void 0===j)throw new Error(`Failed to find node '${I}'`);return j}))}return await this._loadAsync(w,h,z,(()=>({meshes:this._getMeshes(),hZ:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=I,this._loadData(E),await this._loadAsync(j,w,null,(()=>{}))}async _loadAsync(I,E,j,e){return await Promise.resolve().then((async()=>{this._rootUrl=I,this._uniqueRootUrl=!I.startsWith("file:")&&E?I:`${I}${Date.now()}/`,this._fileName=E,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const w=`${r.l[r.l.LOADING]} => ${r.l[r.l.READY]}`,z=`${r.l[r.l.LOADING]} => ${r.l[r.l.COMPLETE]}`;this._parent._startPerformanceCounter(w),this._parent._startPerformanceCounter(z),this._parent._setState(r.l.LOADING),this._extensionsOnLoading();const t=new Array;if(!this.parent.loadOnlyMaterials)if(j)t.push(this.loadSceneAsync("/nodes",{nodes:j,index:-1}));else if(void 0!=this._gltf.CE||this._gltf.scenes&&this._gltf.scenes[0]){const I=s.Get("/scene",this._gltf.scenes,this._gltf.CE||0);t.push(this.loadSceneAsync(`/scenes/${I.index}`,I))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let I=0;I<this._gltf.materials.length;++I){const E=this._gltf.materials[I],j="/materials/"+I,e=X.c.TriangleFillMode;t.push(this._loadMaterialAsync(j,E,null,e,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&t.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&t.push(this._compileShadowGeneratorsAsync());const U=Promise.all(t).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.IU(!0);for(const I of this._babylonScene.materials){const E=I;void 0!==E.maxSimultaneousLights&&(E.maxSimultaneousLights=Math.max(E.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(r.l.READY),this._skipStartAnimationStep||this._startAnimations(),e()}));return await U.then((I=>(this._parent._endPerformanceCounter(w),h.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(z),this._parent._setState(r.l.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(I=>{this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()}))})),I)))})).catch((I=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(I),this._parent.onErrorObservable.clear(),this.dispose()),I}))}_loadData(I){if(this._gltf=I.json,this._setupData(),I.bin){const E=this._gltf.buffers;if(E&&E[0]&&!E[0].uri){const j=E[0];(j.byteLength<I.bin.byteLength-3||j.byteLength>I.bin.byteLength)&&L.b.Warn(`Binary buffer length (${j.byteLength}) from JSON does not match chunk length (${I.bin.byteLength})`),this._bin=I.bin}else L.b.Warn("Unexpected BIN chunk")}}_setupData(){if(s.Assign(this._gltf.accessors),s.Assign(this._gltf.animations),s.Assign(this._gltf.buffers),s.Assign(this._gltf.bufferViews),s.Assign(this._gltf.cameras),s.Assign(this._gltf.images),s.Assign(this._gltf.materials),s.Assign(this._gltf.meshes),s.Assign(this._gltf.nodes),s.Assign(this._gltf.samplers),s.Assign(this._gltf.scenes),s.Assign(this._gltf.skins),s.Assign(this._gltf.textures),this._gltf.nodes){const I={};for(const j of this._gltf.nodes)if(j.children)for(const E of j.children)I[E]=j.index;const E=this._createRootNode();for(const j of this._gltf.nodes){const e=I[j.index];j.parent=void 0===e?E:this._gltf.nodes[e]}}}async _loadExtensionsAsync(){const I=[];if(Y.forEach(((E,j)=>{var e;!1===(null===(e=this.parent.extensionOptions[j])||void 0===e?void 0:e.enabled)?E.isGLTFExtension&&this.isExtensionUsed(j)&&L.b.Warn(`Extension ${j} is used but has been explicitly disabled.`):E.isGLTFExtension&&!this.isExtensionUsed(j)||I.push((async()=>{const I=await E.factory(this);return I.name!==j&&L.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${I.name} !== ${j}`),this._parent.onExtensionLoadedObservable.notifyObservers(I),I})())})),this._extensions.push(...await Promise.all(I)),this._extensions.sort(((I,E)=>(I.order||Number.MAX_VALUE)-(E.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const j of this._gltf.extensionsRequired){if(!this._extensions.some((I=>I.name===j&&I.enabled))){var E;if(!1===(null===(E=this.parent.extensionOptions[j])||void 0===E?void 0:E.enabled))throw new Error(`Required extension ${j} is disabled`);throw new Error(`Required extension ${j} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const I=new y.d("__root__",this._babylonScene);this._rootBabylonMesh=I,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.IU(!1);const E={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case r.j.AUTO:this._babylonScene.useRightHandedSystem||(E.rotation=[0,1,0,0],E.scale=[1,1,-1],V._LoadTransform(E,this._rootBabylonMesh));break;case r.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(I),E}loadSceneAsync(I,E){const j=this._extensionsLoadSceneAsync(I,E);if(j)return j;const e=new Array;if(this.logOpen(`${I} ${E.name||""}`),E.nodes)for(const w of E.nodes){const E=s.Get(`${I}/nodes/${w}`,this._gltf.nodes,w);e.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(I=>{I.parent=this._rootBabylonMesh})))}for(const w of this._postSceneLoadActions)w();return e.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(e).then((()=>{}))}_forEachPrimitive(I,E){if(I._primitiveBabylonMeshes)for(const j of I._primitiveBabylonMeshes)E(j)}_getGeometries(){const I=[],E=this._gltf.nodes;if(E)for(const j of E)this._forEachPrimitive(j,(E=>{const j=E.Je;j&&-1===I.indexOf(j)&&I.push(j)}));return I}_getMeshes(){const I=[];this._rootBabylonMesh instanceof G.c&&I.push(this._rootBabylonMesh);const E=this._gltf.nodes;if(E)for(const j of E)this._forEachPrimitive(j,(E=>{I.push(E)}));return I}_getTransformNodes(){const I=[],E=this._gltf.nodes;if(E)for(const j of E)j._babylonTransformNode&&"Hh"===j._babylonTransformNode.getClassName()&&I.push(j._babylonTransformNode),j._babylonTransformNodeForSkin&&I.push(j._babylonTransformNodeForSkin);return I}_getSkeletons(){const I=[],E=this._gltf.skins;if(E)for(const j of E)j._data&&I.push(j._data.babylonSkeleton);return I}_getAnimationGroups(){const I=[],E=this._gltf.animations;if(E)for(const j of E)j._babylonAnimationGroup&&I.push(j._babylonAnimationGroup);return I}_startAnimations(){switch(this._parent.animationStartMode){case r.f.NONE:break;case r.f.FIRST:{const I=this._getAnimationGroups();0!==I.length&&I[0].start(!0);break}case r.f.ALL:{const I=this._getAnimationGroups();for(const E of I)E.start(!0);break}default:return void L.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadNodeAsync(I,E,j);if(e)return e;if(E._babylonTransformNode)throw new Error(`${I}: Invalid recursive node hierarchy`);const w=new Array;this.logOpen(`${I} ${E.name||""}`);const z=e=>{if(V.AddPointerMetadata(e,I),V._LoadTransform(E,e),void 0!=E.camera){const j=s.Get(`${I}/camera`,this._gltf.cameras,E.camera);w.push(this.loadCameraAsync(`/cameras/${j.index}`,j,(I=>{I.parent=e,this._babylonScene.useRightHandedSystem||(e.pz.x=-1)})))}if(E.children)for(const j of E.children){const E=s.Get(`${I}/children/${j}`,this._gltf.nodes,j);w.push(this.loadNodeAsync(`/nodes/${E.index}`,E,(I=>{I.parent=e})))}j(e)},h=void 0!=E.mesh,t=this._parent.loadSkins&&void 0!=E.skin;if(!h||t){const I=E.name||`node${E.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new u.b(I,this._babylonScene);j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==E.mesh?E._babylonTransformNode=j:E._babylonTransformNodeForSkin=j,z(j)}if(h)if(t){const j=s.Get(`${I}/mesh`,this._gltf.meshes,E.mesh);w.push(this._loadMeshAsync(`/meshes/${j.index}`,E,j,(j=>{const e=E._babylonTransformNodeForSkin;j.metadata=(0,W.b)(e.metadata,j.metadata||{});const z=s.Get(`${I}/skin`,this._gltf.skins,E.skin);w.push(this._loadSkinAsync(`/skins/${z.index}`,E,z,(I=>{this._forEachPrimitive(E,(E=>{E.skeleton=I})),this._postSceneLoadActions.push((()=>{if(void 0!=z.skeleton){const I=s.Get(`/skins/${z.index}/skeleton`,this._gltf.nodes,z.skeleton).parent;E.index===I.index?j.parent=e.parent:j.parent=I._babylonTransformNode}else j.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:e,skinnedNode:j})}))})))})))}else{const j=s.Get(`${I}/mesh`,this._gltf.meshes,E.mesh);w.push(this._loadMeshAsync(`/meshes/${j.index}`,E,j,z))}return this.logClose(),Promise.all(w).then((()=>(this._forEachPrimitive(E,(I=>{const E=I;!E.isAnInstance&&E.Je&&E.Je.useBoundingInfoFromGeometry?I.gI():I.refreshBoundingInfo(!0,!0)})),E._babylonTransformNode)))}_loadMeshAsync(I,E,j,e){const w=j.primitives;if(!w||!w.length)throw new Error(`${I}: Primitives are missing`);void 0==w[0].index&&s.Assign(w);const z=new Array;this.logOpen(`${I} ${j.name||""}`);const h=E.name||`node${E.index}`;if(1===w.length){const e=j.primitives[0];z.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${e.index}`,h,E,j,e,(I=>{E._babylonTransformNode=I,E._primitiveBabylonMeshes=[I]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,E._babylonTransformNode=new u.b(h,this._babylonScene),E._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._primitiveBabylonMeshes=[];for(const e of w)z.push(this._loadMeshPrimitiveAsync(`${I}/primitives/${e.index}`,`${h}_primitive${e.index}`,E,j,e,(I=>{I.parent=E._babylonTransformNode,E._primitiveBabylonMeshes.push(I)})))}return e(E._babylonTransformNode),this.logClose(),Promise.all(z).then((()=>E._babylonTransformNode))}_loadMeshPrimitiveAsync(I,E,j,e,w,z){const h=this._extensionsLoadMeshPrimitiveAsync(I,E,j,e,w,z);if(h)return h;this.logOpen(`${I}`);const t=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==j.skin&&!e.primitives[0].targets;let U,R;if(t&&w._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,U=w._instanceData.babylonSourceMesh.createInstance(E),U._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,R=w._instanceData.promise;else{const z=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new y.d(E,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h.sideOrientation=this._babylonScene.useRightHandedSystem?X.c.CounterClockWiseSideOrientation:X.c.ClockWiseSideOrientation,this._createMorphTargets(I,j,e,w,h),z.push(this._loadVertexDataAsync(I,w,h).then((async E=>await this._loadMorphTargetsAsync(I,w,h,E).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,E.nI(h),E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const P=V._GetDrawMode(I,w.mode);if(void 0==w.material){let I=this._defaultBabylonMaterialData[P];I||(I=this._createDefaultMaterial("__GLTFLoader._default",P),this._parent.onMaterialLoadedObservable.notifyObservers(I),this._defaultBabylonMaterialData[P]=I),h.material=I}else if(!this.parent.skipMaterials){const E=s.Get(`${I}/material`,this._gltf.materials,w.material);z.push(this._loadMaterialAsync(`/materials/${E.index}`,E,h,P,(I=>{h.material=I})))}R=Promise.all(z),t&&(w._instanceData={babylonSourceMesh:h,promise:R}),U=h}return V.AddPointerMetadata(U,I),this._parent.onMeshLoadedObservable.notifyObservers(U),z(U),this.logClose(),R.then((()=>U))}_loadVertexDataAsync(I,E,j){const e=this._extensionsLoadVertexDataAsync(I,E,j);if(e)return e;const w=E.attributes;if(!w)throw new Error(`${I}: Attributes are missing`);const z=new Array,h=new Q.d(j.name,this._babylonScene);if(void 0==E.indices)j.isUnIndexed=!0;else{const j=s.Get(`${I}/indices`,this._gltf.accessors,E.indices);z.push(this._loadIndicesAccessorAsync(`/accessors/${j.index}`,j).then((I=>{h.setIndices(I)})))}const t=(E,e,t)=>{if(void 0==w[E])return;j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(e)&&j._delayInfo.push(e);const U=s.Get(`${I}/attributes/${E}`,this._gltf.accessors,w[E]);z.push(this._loadVertexAccessorAsync(`/accessors/${U.index}`,U,e).then((I=>{if(I.getKind()===b.e.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!j.skeleton){const I=v(U);I&&(h._boundingInfo=I,h.useBoundingInfoFromGeometry=!0)}h.setVerticesBuffer(I,U.count)}))),e==b.e.MatricesIndicesExtraKind&&(j.numBoneInfluencers=8),t&&t(U)};return t("POSITION",b.e.PositionKind),t("NORMAL",b.e.NormalKind),t("TANGENT",b.e.TangentKind),t("TEXCOORD_0",b.e.UVKind),t("TEXCOORD_1",b.e.UV2Kind),t("TEXCOORD_2",b.e.UV3Kind),t("TEXCOORD_3",b.e.UV4Kind),t("TEXCOORD_4",b.e.UV5Kind),t("TEXCOORD_5",b.e.UV6Kind),t("JOINTS_0",b.e.MatricesIndicesKind),t("WEIGHTS_0",b.e.MatricesWeightsKind),t("JOINTS_1",b.e.MatricesIndicesExtraKind),t("WEIGHTS_1",b.e.MatricesWeightsExtraKind),t("COLOR_0",b.e.ColorKind,(I=>{"VEC4"===I.type&&(j.hasVertexAlpha=!0)})),Promise.all(z).then((()=>h))}_createMorphTargets(I,E,j,e,w){if(!e.targets||!this._parent.loadMorphTargets)return;if(void 0==E._numMorphTargets)E._numMorphTargets=e.targets.length;else if(e.targets.length!==E._numMorphTargets)throw new Error(`${I}: Primitives do not have the same number of targets`);const z=j.extras?j.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,w.morphTargetManager=new i(this._babylonScene),w.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.morphTargetManager.areUpdatesFrozen=!0;for(let h=0;h<e.targets.length;h++){const I=E.weights?E.weights[h]:j.weights?j.weights[h]:0,e=z?z[h]:`morphTarget${h}`;w.morphTargetManager.addTarget(new d.c(e,I,w.GI()))}}_loadMorphTargetsAsync(I,E,j,e){if(!E.targets||!this._parent.loadMorphTargets)return Promise.resolve();const w=new Array,z=j.morphTargetManager;for(let h=0;h<z.numTargets;h++){const j=z.getTarget(h);w.push(this._loadMorphTargetVertexDataAsync(`${I}/targets/${h}`,e,E.targets[h],j))}return Promise.all(w).then((()=>{z.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(I,E,j,e){const w=new Array,z=(e,z,h)=>{if(void 0==j[e])return;const t=E.getVertexBuffer(z);if(!t)return;const U=s.Get(`${I}/${e}`,this._gltf.accessors,j[e]);w.push(this._loadFloatAccessorAsync(`/accessors/${U.index}`,U).then((I=>{h(t,I)})))};return z("POSITION",b.e.PositionKind,((I,E)=>{const j=new Float32Array(E.length);I.forEach(E.length,((I,e)=>{j[e]=E[e]+I})),e.setPositions(j)})),z("NORMAL",b.e.NormalKind,((I,E)=>{const j=new Float32Array(E.length);I.forEach(j.length,((I,e)=>{j[e]=E[e]+I})),e.setNormals(j)})),z("TANGENT",b.e.TangentKind,((I,E)=>{const j=new Float32Array(E.length/3*4);let w=0;I.forEach(E.length/3*4,((I,e)=>{(e+1)%4!==0&&(j[w]=E[w]+I,w++)})),e.setTangents(j)})),z("TEXCOORD_0",b.e.UVKind,((I,E)=>{const j=new Float32Array(E.length);I.forEach(E.length,((I,e)=>{j[e]=E[e]+I})),e.setUVs(j)})),z("TEXCOORD_1",b.e.UV2Kind,((I,E)=>{const j=new Float32Array(E.length);I.forEach(E.length,((I,e)=>{j[e]=E[e]+I})),e.setUV2s(j)})),z("COLOR_0",b.e.ColorKind,((E,j)=>{let w=null;const z=E.getSize();if(3===z){w=new Float32Array(j.length/3*4),E.forEach(j.length,((I,E)=>{const e=Math.floor(E/3),z=E%3;w[4*e+z]=j[3*e+z]+I}));for(let I=0;I<j.length/3;++I)w[4*I+3]=1}else{if(4!==z)throw new Error(`${I}: Invalid number of components (${z}) for COLOR_0 attribute`);w=new Float32Array(j.length),E.forEach(j.length,((I,E)=>{w[E]=j[E]+I}))}e.setColors(w)})),await Promise.all(w).then((()=>{}))}static _LoadTransform(I,E){if(void 0!=I.skin)return;let j=w.LE.Zero(),e=w.Quaternion.Identity(),z=w.LE.One();if(I.matrix){w.Matrix.xE(I.matrix).decompose(z,e,j)}else I.translation&&(j=w.LE.xE(I.translation)),I.rotation&&(e=w.Quaternion.xE(I.rotation)),I.scale&&(z=w.LE.xE(I.scale));E.position=j,E.rotationQuaternion=e,E.pz=z}_loadSkinAsync(I,E,j,e){if(!this._parent.loadSkins)return Promise.resolve();const w=this._extensionsLoadSkinAsync(I,E,j);if(w)return w;if(j._data)return e(j._data.babylonSkeleton),j._data.promise;const z=`skeleton${j.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new C(j.name||z,z,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(I,j,h);const t=this._loadSkinInverseBindMatricesDataAsync(I,j).then((I=>{this._updateBoneMatrices(h,I)}));return j._data={babylonSkeleton:h,promise:t},e(h),t}_loadBones(I,E,j){if(void 0==E.skeleton||this._parent.alwaysComputeSkeletonRootNode){const j=this._findSkeletonRootNode(`${I}/joints`,E.joints);if(j)if(void 0===E.skeleton)E.skeleton=j.index;else{const e=(I,E)=>{for(;E.parent;E=E.parent)if(E.parent===I)return!0;return!1},w=s.Get(`${I}/skeleton`,this._gltf.nodes,E.skeleton);w===j||e(w,j)||(L.b.Warn(`${I}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),E.skeleton=j.index)}else L.b.Warn(`${I}: Failed to find common root`)}const e={};for(const w of E.joints){const z=s.Get(`${I}/joints/${w}`,this._gltf.nodes,w);this._loadBone(z,E,j,e)}}_findSkeletonRootNode(I,E){if(0===E.length)return null;const j={};for(const w of E){const E=[];let e=s.Get(`${I}/${w}`,this._gltf.nodes,w);for(;-1!==e.index;)E.unshift(e),e=e.parent;j[w]=E}let e=null;for(let w=0;;++w){let I=j[E[0]];if(w>=I.length)return e;const z=I[w];for(let h=1;h<E.length;++h)if(I=j[E[h]],w>=I.length||z!==I[w])return e;e=z}}_loadBone(I,E,j,e){I._isJoint=!0;let w=e[I.index];if(w)return w;let z=null;I.index!==E.skeleton&&(I.parent&&-1!==I.parent.index?z=this._loadBone(I.parent,E,j,e):void 0!==E.skeleton&&L.b.Warn(`/skins/${E.index}/skeleton: Skeleton node is not a common root`));const h=E.joints.indexOf(I.index);return w=new R.e(I.name||`joint${I.index}`,j,z,this._getNodeMatrix(I),null,null,h),e[I.index]=w,this._postSceneLoadActions.push((()=>{w.linkTransformNode(I._babylonTransformNode)})),w}_loadSkinInverseBindMatricesDataAsync(I,E){if(void 0==E.inverseBindMatrices)return Promise.resolve(null);const j=s.Get(`${I}/inverseBindMatrices`,this._gltf.accessors,E.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${j.index}`,j)}_updateBoneMatrices(I,E){for(const j of I.bones){const I=w.Matrix.Identity(),e=j._index;E&&-1!==e&&(w.Matrix.FromArrayToRef(E,16*e,I),I.invertToRef(I));const z=j.getParent();z&&I.multiplyToRef(z.getAbsoluteInverseBindMatrix(),I),j.ve(I,!1,!1),j._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(I){return I.matrix?w.Matrix.xE(I.matrix):w.Matrix.Compose(I.scale?w.LE.xE(I.scale):w.LE.One(),I.rotation?w.Quaternion.xE(I.rotation):w.Quaternion.Identity(),I.translation?w.LE.xE(I.translation):w.LE.Zero())}loadCameraAsync(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadCameraAsync(I,E,j);if(e)return e;const z=new Array;this.logOpen(`${I} ${E.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new U.e(E.name||`camera${E.index}`,w.LE.Zero(),this._babylonScene,!1);switch(h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonCamera=h,h.setTarget(new w.LE(0,0,-1)),E.type){case"perspective":{const j=E.perspective;if(!j)throw new Error(`${I}: Camera perspective properties are missing`);h.fov=j.yfov,h.Te=j.znear,h.maxZ=j.zfar||0;break}case"orthographic":if(!E.orthographic)throw new Error(`${I}: Camera orthographic properties are missing`);h.mode=t.e.ORTHOGRAPHIC_CAMERA,h.orthoLeft=-E.orthographic.xmag,h.orthoRight=E.orthographic.xmag,h.orthoBottom=-E.orthographic.ymag,h.orthoTop=E.orthographic.ymag,h.Te=E.orthographic.znear,h.maxZ=E.orthographic.zfar;break;default:throw new Error(`${I}: Invalid camera type (${E.type})`)}return V.AddPointerMetadata(h,I),this._parent.onCameraLoadedObservable.notifyObservers(h),j(h),this.logClose(),Promise.all(z).then((()=>h))}_loadAnimationsAsync(){const I=this._gltf.animations;if(!I)return Promise.resolve();const E=new Array;for(let j=0;j<I.length;j++){const e=I[j];E.push(this.loadAnimationAsync(`/animations/${e.index}`,e).then((I=>{0===I.targetedAnimations.length&&I.dispose()})))}return Promise.all(E).then((()=>{}))}loadAnimationAsync(I,E){const e=this._extensionsLoadAnimationAsync(I,E);return e||j.e(78).then(j.bind(j,14289)).then((j=>{let{AnimationGroup:e}=j;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new e(E.name||`animation${E.index}`,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E._babylonAnimationGroup=w;const z=new Array;s.Assign(E.channels),s.Assign(E.samplers);for(const h of E.channels)z.push(this._loadAnimationChannelAsync(`${I}/channels/${h.index}`,I,E,h,((I,E)=>{I.animations=I.animations||[],I.animations.push(E),w.addTargetedAnimation(E,I)})));return Promise.all(z).then((()=>(w.normalize(0),w)))}))}async _loadAnimationChannelAsync(I,E,e,w,z){const h=this._extensionsLoadAnimationChannelAsync(I,E,e,w,z);if(h)return await h;if(void 0==w.target.node)return await Promise.resolve();const t=s.Get(`${I}/target/node`,this._gltf.nodes,w.target.node),U=w.target.path,R="weights"===U;if(R&&!t._numMorphTargets||!R&&!t._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!R&&!t._isJoint)return await Promise.resolve();let P;switch(await Promise.resolve().then(j.bind(j,12769)),U){case"translation":var o;P=null===(o=(0,M.e)("/nodes/{}/translation"))||void 0===o?void 0:o.interpolation;break;case"rotation":var Z;P=null===(Z=(0,M.e)("/nodes/{}/rotation"))||void 0===Z?void 0:Z.interpolation;break;case"scale":var c;P=null===(c=(0,M.e)("/nodes/{}/scale"))||void 0===c?void 0:c.interpolation;break;case"weights":var K;P=null===(K=(0,M.e)("/nodes/{}/weights"))||void 0===K?void 0:K.interpolation;break;default:throw new Error(`${I}/target/path: Invalid value (${w.target.path})`)}if(!P)throw new Error(`${I}/target/path: Could not find interpolation properties for target path (${w.target.path})`);const L={object:t,info:P};return await this._loadAnimationChannelFromTargetInfoAsync(I,E,e,w,L,z)}_loadAnimationChannelFromTargetInfoAsync(I,E,j,e,w,z){const h=this.parent.targetFps,t=1/h,U=s.Get(`${I}/sampler`,j.samplers,e.sampler);return this._loadAnimationSamplerAsync(`${E}/samplers/${e.sampler}`,U).then((I=>{let E=0;const U=w.object,R=w.info;for(const w of R){const R=w.getStride(U),P=I.input,o=I.output,Z=new Array(P.length);let c=0;switch(I.interpolation){case"STEP":for(let I=0;I<P.length;I++){const E=w.getValue(U,o,c,1);c+=R,Z[I]={frame:P[I]*h,value:E,interpolation:1}}break;case"CUBICSPLINE":for(let I=0;I<P.length;I++){const E=w.getValue(U,o,c,t);c+=R;const j=w.getValue(U,o,c,1);c+=R;const e=w.getValue(U,o,c,t);c+=R,Z[I]={frame:P[I]*h,inTangent:E,value:j,outTangent:e}}break;case"LINEAR":for(let I=0;I<P.length;I++){const E=w.getValue(U,o,c,1);c+=R,Z[I]={frame:P[I]*h,value:E}}}if(c>0){const I=`${j.name||`animation${j.index}`}_channel${e.index}_${E}`,t=w.buildAnimations(U,I,h,Z);for(const j of t)E++,z(j.babylonAnimatable,j.babylonAnimation)}}}))}_loadAnimationSamplerAsync(I,E){if(E._data)return E._data;const j=E.interpolation||"LINEAR";switch(j){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${I}/interpolation: Invalid value (${E.interpolation})`)}const e=s.Get(`${I}/input`,this._gltf.accessors,E.input),w=s.Get(`${I}/output`,this._gltf.accessors,E.output);return E._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${e.index}`,e),this._loadFloatAccessorAsync(`/accessors/${w.index}`,w)]).then((I=>{let[E,e]=I;return{input:E,interpolation:j,output:e}})),E._data}loadBufferAsync(I,E,j,e){const w=this._extensionsLoadBufferAsync(I,E,j,e);if(w)return w;if(!E._data)if(E.uri)E._data=this.loadUriAsync(`${I}/uri`,E,E.uri);else{if(!this._bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);E._data=this._bin.readAsync(0,E.byteLength)}return E._data.then((E=>{try{return new Uint8Array(E.buffer,E.byteOffset+j,e)}catch(w){throw new Error(`${I}: ${w.message}`)}}))}loadBufferViewAsync(I,E){const j=this._extensionsLoadBufferViewAsync(I,E);if(j)return j;if(E._data)return E._data;const e=s.Get(`${I}/buffer`,this._gltf.buffers,E.buffer);return E._data=this.loadBufferAsync(`/buffers/${e.index}`,e,E.byteOffset||0,E.byteLength),E._data}_loadAccessorAsync(I,E,j){if(E._data)return E._data;const e=V._GetNumComponents(I,E.type),w=e*b.e.GetTypeByteLength(E.componentType),z=e*E.count;if(void 0==E.bufferView)E._data=Promise.resolve(new j(z));else{const h=s.Get(`${I}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${h.index}`,h).then((t=>{if(5126!==E.componentType||E.normalized||h.byteStride&&h.byteStride!==w){const I=new j(z);return b.e.ForEach(t,E.byteOffset||0,h.byteStride||w,e,E.componentType,I.length,E.normalized||!1,((E,j)=>{I[j]=E})),I}return V._GetTypedArray(I,E.componentType,t,E.byteOffset,z)}))}if(E.sparse){const z=E.sparse;E._data=E._data.then((h=>{const t=h,U=s.Get(`${I}/sparse/indices/bufferView`,this._gltf.bufferViews,z.indices.bufferView),R=s.Get(`${I}/sparse/values/bufferView`,this._gltf.bufferViews,z.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${U.index}`,U),this.loadBufferViewAsync(`/bufferViews/${R.index}`,R)]).then((h=>{let[U,R]=h;const P=V._GetTypedArray(`${I}/sparse/indices`,z.indices.componentType,U,z.indices.byteOffset,z.count),o=e*z.count;let Z;if(5126!==E.componentType||E.normalized){const h=V._GetTypedArray(`${I}/sparse/values`,E.componentType,R,z.values.byteOffset,o);Z=new j(o),b.e.ForEach(h,0,w,e,E.componentType,Z.length,E.normalized||!1,((I,E)=>{Z[E]=I}))}else Z=V._GetTypedArray(`${I}/sparse/values`,E.componentType,R,z.values.byteOffset,o);let c=0;for(let I=0;I<P.length;I++){let E=P[I]*e;for(let I=0;I<e;I++)t[E++]=Z[c++]}return t}))}))}return E._data}_loadFloatAccessorAsync(I,E){return this._loadAccessorAsync(I,E,Float32Array)}_loadIndicesAccessorAsync(I,E){if("SCALAR"!==E.type)throw new Error(`${I}/type: Invalid value ${E.type}`);if(5121!==E.componentType&&5123!==E.componentType&&5125!==E.componentType)throw new Error(`${I}/componentType: Invalid value ${E.componentType}`);if(E._data)return E._data;if(E.sparse){const j=V._GetTypedArrayConstructor(`${I}/componentType`,E.componentType);E._data=this._loadAccessorAsync(I,E,j)}else{const j=s.Get(`${I}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${j.index}`,j).then((j=>V._GetTypedArray(I,E.componentType,j,E.byteOffset,E.count)))}return E._data}_loadVertexBufferViewAsync(I){if(I._babylonBuffer)return I._babylonBuffer;const E=this._babylonScene.getEngine();return I._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${I.index}`,I).then((I=>new b.c(E,I,!1))),I._babylonBuffer}_loadVertexAccessorAsync(I,E,j){var e;if(null!==(e=E._babylonVertexBuffer)&&void 0!==e&&e[j])return E._babylonVertexBuffer[j];E._babylonVertexBuffer||(E._babylonVertexBuffer={});const w=this._babylonScene.getEngine();if(E.sparse||void 0==E.bufferView)E._babylonVertexBuffer[j]=this._loadFloatAccessorAsync(I,E).then((I=>new b.e(w,I,j,!1)));else{const e=s.Get(`${I}/bufferView`,this._gltf.bufferViews,E.bufferView);E._babylonVertexBuffer[j]=this._loadVertexBufferViewAsync(e).then((z=>{const h=V._GetNumComponents(I,E.type);return new b.e(w,z,j,!1,void 0,e.byteStride,void 0,E.byteOffset,h,E.componentType,E.normalized,!0,void 0,!0)}))}return E._babylonVertexBuffer[j]}_loadMaterialMetallicRoughnessPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return E&&(E.baseColorFactor?(j.albedoColor=z.qE.xE(E.baseColorFactor),j.alpha=E.baseColorFactor[3]):j.albedoColor=z.qE.White(),j.metallic=void 0==E.metallicFactor?1:E.metallicFactor,j.roughness=void 0==E.roughnessFactor?1:E.roughnessFactor,E.baseColorTexture&&e.push(this.loadTextureInfoAsync(`${I}/baseColorTexture`,E.baseColorTexture,(I=>{I.name=`${j.name} (Base Color)`,j.albedoTexture=I}))),E.metallicRoughnessTexture&&(E.metallicRoughnessTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${I}/metallicRoughnessTexture`,E.metallicRoughnessTexture,(I=>{I.name=`${j.name} (Metallic Roughness)`,j.metallicTexture=I}))),j.useMetallnessFromMetallicTextureBlue=!0,j.useRoughnessFromMetallicTextureGreen=!0,j.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(e).then((()=>{}))}_loadMaterialAsync(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const z=this._extensionsLoadMaterialAsync(I,E,j,e,w);if(z)return z;E._data=E._data||{};let h=E._data[e];if(!h){this.logOpen(`${I} ${E.name||""}`);const j=this.createMaterial(I,E,e);h={babylonMaterial:j,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(I,E,j)},E._data[e]=h,V.AddPointerMetadata(j,I),this._parent.onMaterialLoadedObservable.notifyObservers(j),this.logClose()}return j&&(h.babylonMeshes.push(j),j.Le.addOnce((()=>{const I=h.babylonMeshes.indexOf(j);-1!==I&&h.babylonMeshes.splice(I,1)}))),w(h.babylonMaterial),h.promise.then((()=>h.babylonMaterial))}_createDefaultMaterial(I,E){this._babylonScene._blockEntityCollection=!!this._assetContainer;const j=new q.d(I,this._babylonScene);return j._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,j.fillMode=E,j.enableSpecularAntiAliasing=!0,j.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,j.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,j.transparencyMode=q.d.PBRMATERIAL_OPAQUE,j.metallic=1,j.roughness=1,j}createMaterial(I,E,j){const e=this._extensionsCreateMaterial(I,E,j);if(e)return e;const w=E.name||`material${E.index}`;return this._createDefaultMaterial(w,j)}loadMaterialPropertiesAsync(I,E,j){const e=this._extensionsLoadMaterialPropertiesAsync(I,E,j);if(e)return e;const w=new Array;return w.push(this.loadMaterialBasePropertiesAsync(I,E,j)),E.pbrMetallicRoughness&&w.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${I}/pbrMetallicRoughness`,E.pbrMetallicRoughness,j)),this.loadMaterialAlphaProperties(I,E,j),Promise.all(w).then((()=>{}))}loadMaterialBasePropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return j.emissiveColor=E.emissiveFactor?z.qE.xE(E.emissiveFactor):new z.qE(0,0,0),E.doubleSided&&(j.tz=!1,j.twoSidedLighting=!0),E.normalTexture&&(E.normalTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${I}/normalTexture`,E.normalTexture,(I=>{I.name=`${j.name} (Normal)`,j.bumpTexture=I}))),j.invertNormalMapX=!this._babylonScene.useRightHandedSystem,j.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=E.normalTexture.scale&&j.bumpTexture&&(j.bumpTexture.level=E.normalTexture.scale),j.forceIrradianceInFragment=!0),E.occlusionTexture&&(E.occlusionTexture.nonColorData=!0,e.push(this.loadTextureInfoAsync(`${I}/occlusionTexture`,E.occlusionTexture,(I=>{I.name=`${j.name} (Occlusion)`,j.ambientTexture=I}))),j.useAmbientInGrayScale=!0,void 0!=E.occlusionTexture.strength&&(j.ambientTextureStrength=E.occlusionTexture.strength)),E.emissiveTexture&&e.push(this.loadTextureInfoAsync(`${I}/emissiveTexture`,E.emissiveTexture,(I=>{I.name=`${j.name} (Emissive)`,j.emissiveTexture=I}))),Promise.all(e).then((()=>{}))}loadMaterialAlphaProperties(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);switch(E.alphaMode||"OPAQUE"){case"OPAQUE":j.transparencyMode=q.d.PBRMATERIAL_OPAQUE,j.alpha=1;break;case"MASK":j.transparencyMode=q.d.PBRMATERIAL_ALPHATEST,j.alphaCutOff=void 0==E.alphaCutoff?.5:E.alphaCutoff,j.albedoTexture&&(j.albedoTexture.ne=!0);break;case"BLEND":j.transparencyMode=q.d.PBRMATERIAL_ALPHABLEND,j.albedoTexture&&(j.albedoTexture.ne=!0,j.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${I}/alphaMode: Invalid value (${E.alphaMode})`)}}loadTextureInfoAsync(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadTextureInfoAsync(I,E,j);if(e)return e;if(this.logOpen(`${I}`),E.texCoord>=6)throw new Error(`${I}/texCoord: Invalid value (${E.texCoord})`);const w=s.Get(`${I}/index`,this._gltf.textures,E.index);w._textureInfo=E;const z=this._loadTextureAsync(`/textures/${E.index}`,w,(e=>{e.coordinatesIndex=E.texCoord||0,V.AddPointerMetadata(e,I),this._parent.onTextureLoadedObservable.notifyObservers(e),j(e)}));return this.logClose(),z}_loadTextureAsync(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const e=this._extensionsLoadTextureAsync(I,E,j);if(e)return e;this.logOpen(`${I} ${E.name||""}`);const w=void 0==E.sampler?V.DefaultSampler:s.Get(`${I}/sampler`,this._gltf.samplers,E.sampler),z=s.Get(`${I}/source`,this._gltf.images,E.source),h=this._createTextureAsync(I,w,z,j,void 0,!E._textureInfo.nonColorData);return this.logClose(),h}_createTextureAsync(I,E,j){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},z=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;const t=this._loadSampler(`/samplers/${E.index}`,E),U=new Array,R=new e;this._babylonScene._blockEntityCollection=!!this._assetContainer;const P={noMipmap:t.noMipMaps,invertY:!1,samplingMode:t.samplingMode,J:()=>{this._disposed||R.resolve()},onError:(E,j)=>{this._disposed||R.reject(new Error(`${I}: ${j&&j.message?j.message:E||"Failed to load texture"}`))},mimeType:j.mimeType??(0,n.e)(j.uri??""),loaderOptions:z,useSRGBBuffer:!!h&&this._parent.useSRGBBuffers},o=new x.d(null,this._babylonScene,P);return o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,U.push(R.promise),U.push(this.loadImageAsync(`/images/${j.index}`,j).then((I=>{const E=j.uri||`${this._fileName}#image${j.index}`,e=`data:${this._uniqueRootUrl}${E}`;o.updateURL(e,I);const w=o.getInternalTexture();w&&(w.label=j.name)}))),o.wrapU=t.wrapU,o.wrapV=t.wrapV,w(o),this._parent.useGltfTextureNames&&(o.name=j.name||j.uri||`image${j.index}`),Promise.all(U).then((()=>o))}_loadSampler(I,E){return E._data||(E._data={noMipMaps:9728===E.minFilter||9729===E.minFilter,samplingMode:V._GetTextureSamplingMode(I,E),wrapU:V._GetTextureWrapMode(`${I}/wrapS`,E.wrapS),wrapV:V._GetTextureWrapMode(`${I}/wrapT`,E.wrapT)}),E._data}loadImageAsync(I,E){if(!E._data){if(this.logOpen(`${I} ${E.name||""}`),E.uri)E._data=this.loadUriAsync(`${I}/uri`,E,E.uri);else{const j=s.Get(`${I}/bufferView`,this._gltf.bufferViews,E.bufferView);E._data=this.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}this.logClose()}return E._data}loadUriAsync(I,E,j){const e=this._extensionsLoadUriAsync(I,E,j);if(e)return e;if(!V._ValidateUri(j))throw new Error(`${I}: '${j}' is invalid`);if((0,n.f)(j)){const E=new Uint8Array((0,n.b)(j));return this.log(`${I}: Decoded ${j.substring(0,64)}... (${E.length} bytes)`),Promise.resolve(E)}return this.log(`${I}: Loading ${j}`),this._parent.preprocessUrlAsync(this._rootUrl+j).then((E=>new Promise(((e,w)=>{this._parent._loadFile(this._babylonScene,E,(E=>{this._disposed||(this.log(`${I}: Loaded ${j} (${E.byteLength} bytes)`),e(new Uint8Array(E)))}),!0,(E=>{w(new n.j(`${I}: Failed to load '${j}'${E?": "+E.status+" "+E.statusText:""}`,E))}))}))))}static AddPointerMetadata(I,E){I.metadata=I.metadata||{};const j=I._internalMetadata=I._internalMetadata||{},e=j.de=j.de||{};(e.pointers=e.pointers||[]).push(E)}static _GetTextureWrapMode(I,E){switch(E=void 0==E?10497:E){case 33071:return x.d.CLAMP_ADDRESSMODE;case 33648:return x.d.MIRROR_ADDRESSMODE;case 10497:return x.d.WRAP_ADDRESSMODE;default:return L.b.Warn(`${I}: Invalid value (${E})`),x.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(I,E){const j=void 0==E.magFilter?9729:E.magFilter,e=void 0==E.minFilter?9987:E.minFilter;if(9729===j)switch(e){case 9728:return x.d.LINEAR_NEAREST;case 9729:return x.d.LINEAR_LINEAR;case 9984:return x.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return x.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return x.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return x.d.LINEAR_LINEAR_MIPLINEAR;default:return L.b.Warn(`${I}/minFilter: Invalid value (${e})`),x.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==j&&L.b.Warn(`${I}/magFilter: Invalid value (${j})`),e){case 9728:return x.d.NEAREST_NEAREST;case 9729:return x.d.NEAREST_LINEAR;case 9984:return x.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return x.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return x.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return x.d.NEAREST_LINEAR_MIPLINEAR;default:return L.b.Warn(`${I}/minFilter: Invalid value (${e})`),x.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(I,E){try{return(0,O.o)(E)}catch(j){throw new Error(`${I}: ${j.message}`)}}static _GetTypedArray(I,E,j,e,w){const z=j.buffer;e=j.byteOffset+(e||0);const h=V._GetTypedArrayConstructor(`${I}/componentType`,E),t=b.e.GetTypeByteLength(E);return e%t!==0?(L.b.Warn(`${I}: Copying buffer as byte offset (${e}) is not a multiple of component type byte length (${t})`),new h(z.slice(e,e+w*t),0)):new h(z,e,w)}static _GetNumComponents(I,E){switch(E){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${I}: Invalid type (${E})`)}static _ValidateUri(I){return h.Tools.IsBase64(I)||-1===I.indexOf("..")}static _GetDrawMode(I,E){switch(void 0==E&&(E=4),E){case 0:return X.c.PointListDrawMode;case 1:return X.c.LineListDrawMode;case 2:return X.c.LineLoopDrawMode;case 3:return X.c.LineStripDrawMode;case 4:return X.c.TriangleFillMode;case 5:return X.c.TriangleStripDrawMode;case 6:return X.c.TriangleFanDrawMode}throw new Error(`${I}: Invalid mesh primitive mode (${E})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const I=new Array;if(this._gltf.materials)for(const E of this._gltf.materials)if(E._data)for(const j in E._data){const e=E._data[j];for(const E of e.babylonMeshes){E.Be(!0);const j=e.babylonMaterial;I.push(j.forceCompilationAsync(E)),I.push(j.forceCompilationAsync(E,{useInstances:!0})),this._parent.useClipPlane&&(I.push(j.forceCompilationAsync(E,{clipPlane:!0})),I.push(j.forceCompilationAsync(E,{clipPlane:!0,useInstances:!0})))}}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const I=new Array,E=this._babylonScene.lights;for(const j of E){const E=j.getShadowGenerator();E&&I.push(E.forceCompilationAsync())}return Promise.all(I).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(I){for(const E of this._extensions)E.enabled&&I(E)}_applyExtensions(I,E,j){for(const e of this._extensions)if(e.enabled){const w=`${e.name}.${E}`,z=I;z._activeLoaderExtensionFunctions=z._activeLoaderExtensionFunctions||{};const h=z._activeLoaderExtensionFunctions;if(!h[w]){h[w]=!0;try{const I=j(e);if(I)return I}finally{delete h[w]}}}return null}_extensionsOnLoading(){this._forEachExtensions((I=>I.onLoading&&I.onLoading()))}_extensionsOnReady(){this._forEachExtensions((I=>I.onReady&&I.onReady()))}_extensionsLoadSceneAsync(I,E){return this._applyExtensions(E,"loadScene",(j=>j.loadSceneAsync&&j.loadSceneAsync(I,E)))}_extensionsLoadNodeAsync(I,E,j){return this._applyExtensions(E,"loadNode",(e=>e.loadNodeAsync&&e.loadNodeAsync(I,E,j)))}_extensionsLoadCameraAsync(I,E,j){return this._applyExtensions(E,"loadCamera",(e=>e.loadCameraAsync&&e.loadCameraAsync(I,E,j)))}_extensionsLoadVertexDataAsync(I,E,j){return this._applyExtensions(E,"loadVertexData",(e=>e._loadVertexDataAsync&&e._loadVertexDataAsync(I,E,j)))}_extensionsLoadMeshPrimitiveAsync(I,E,j,e,w,z){return this._applyExtensions(w,"loadMeshPrimitive",(h=>h._loadMeshPrimitiveAsync&&h._loadMeshPrimitiveAsync(I,E,j,e,w,z)))}_extensionsLoadMaterialAsync(I,E,j,e,w){return this._applyExtensions(E,"loadMaterial",(z=>z._loadMaterialAsync&&z._loadMaterialAsync(I,E,j,e,w)))}_extensionsCreateMaterial(I,E,j){return this._applyExtensions(E,"createMaterial",(e=>e.createMaterial&&e.createMaterial(I,E,j)))}_extensionsLoadMaterialPropertiesAsync(I,E,j){return this._applyExtensions(E,"loadMaterialProperties",(e=>e.loadMaterialPropertiesAsync&&e.loadMaterialPropertiesAsync(I,E,j)))}_extensionsLoadTextureInfoAsync(I,E,j){return this._applyExtensions(E,"loadTextureInfo",(e=>e.loadTextureInfoAsync&&e.loadTextureInfoAsync(I,E,j)))}_extensionsLoadTextureAsync(I,E,j){return this._applyExtensions(E,"loadTexture",(e=>e._loadTextureAsync&&e._loadTextureAsync(I,E,j)))}_extensionsLoadAnimationAsync(I,E){return this._applyExtensions(E,"loadAnimation",(j=>j.loadAnimationAsync&&j.loadAnimationAsync(I,E)))}_extensionsLoadAnimationChannelAsync(I,E,j,e,w){return this._applyExtensions(j,"loadAnimationChannel",(z=>z._loadAnimationChannelAsync&&z._loadAnimationChannelAsync(I,E,j,e,w)))}_extensionsLoadSkinAsync(I,E,j){return this._applyExtensions(j,"loadSkin",(e=>e._loadSkinAsync&&e._loadSkinAsync(I,E,j)))}_extensionsLoadUriAsync(I,E,j){return this._applyExtensions(E,"loadUri",(e=>e._loadUriAsync&&e._loadUriAsync(I,E,j)))}_extensionsLoadBufferViewAsync(I,E){return this._applyExtensions(E,"loadBufferView",(j=>j.loadBufferViewAsync&&j.loadBufferViewAsync(I,E)))}_extensionsLoadBufferAsync(I,E,j,e){return this._applyExtensions(E,"loadBuffer",(w=>w.loadBufferAsync&&w.loadBufferAsync(I,E,j,e)))}static LoadExtensionAsync(I,E,j,e){if(!E.extensions)return null;const w=E.extensions[j];return w?e(`${I}/extensions/${j}`,w):null}static LoadExtraAsync(I,E,j,e){if(!E.extras)return null;const w=E.extras[j];return w?e(`${I}/extras/${j}`,w):null}isExtensionUsed(I){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(I)}logOpen(I){this._parent._logOpen(I)}logClose(){this._parent._logClose()}log(I){this._parent._log(I)}startPerformanceCounter(I){this._parent._startPerformanceCounter(I)}endPerformanceCounter(I){this._parent._endPerformanceCounter(I)}}V.DefaultSampler={index:-1},r.d._CreateGLTF2Loader=I=>new V(I);var f=j(12769),S=j(11307),B=j(11149),p=j(12772),D=j(12780);class k extends D.e{constructor(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,U=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",I),this._texture=I.getEngine().createRawCubeTexture(E,j,e,w,z,h,t,U)}update(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,I,E,j,e,w)}updateRGBDAsync(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,p.k)(this._texture,I,E,j,e).then((()=>{}))}clone(){return B.e.Clone((()=>{const I=this.GI(),E=this._texture,j=new k(I,E._bufferViewArray,E.width,E.format,E.type,E.generateMipMaps,E.invertY,E.samplingMode,E._compression);return 13===E.source&&j.updateRGBDAsync(E._bufferViewArrayArray,E._sphericalPolynomial,E._lodGenerationScale,E._lodGenerationOffset),j}),this)}}const J="EXT_lights_image_based";class N{constructor(I){this.name=J,this._loader=I,this.enabled=this._loader.isExtensionUsed(J)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.de.extensions;if(I&&I[this.name]){const E=I[this.name];this._lights=E.lights}}loadSceneAsync(I,E){return V.LoadExtensionAsync(I,E,this.name,(async(j,e)=>{this._loader._allMaterialsDirtyRequired=!0;const w=new Array;w.push(this._loader.loadSceneAsync(I,E)),this._loader.logOpen(`${j}`);const z=s.Get(`${j}/light`,this._lights,e.te);return w.push(this._loadLightAsync(`/extensions/${this.name}/lights/${e.te}`,z).then((I=>{this._loader.babylonScene.environmentTexture=I}))),this._loader.logClose(),await Promise.all(w).then((()=>{}))}))}_loadLightAsync(I,E){if(!E._loaded){const j=new Array;this._loader.logOpen(`${I}`);const e=new Array(E.specularImages.length);for(let w=0;w<E.specularImages.length;w++){const z=E.specularImages[w];e[w]=new Array(z.length);for(let E=0;E<z.length;E++){const h=`${I}/specularImages/${w}/${E}`;this._loader.logOpen(`${h}`);const t=z[E],U=s.Get(h,this._loader.de.images,t);j.push(this._loader.loadImageAsync(`/images/${t}`,U).then((I=>{e[w][E]=I}))),this._loader.logClose()}}this._loader.logClose(),E._loaded=Promise.all(j).then((async()=>{const j=new k(this._loader.babylonScene,null,E.specularImageSize);if(j.name=E.name||"environment",E._babylonTexture=j,void 0!=E.Ch&&(j.level=E.Ch),E.rotation){let I=w.Quaternion.xE(E.rotation);this._loader.babylonScene.useRightHandedSystem||(I=w.Quaternion.Inverse(I)),w.Matrix.FromQuaternionToRef(I,j.getReflectionTextureMatrix())}if(!E.irradianceCoefficients)throw new Error(`${I}: Irradiance coefficients are missing`);const z=S.b.xE(E.irradianceCoefficients);z.scaleInPlace(E.Ch),z.convertIrradianceToLambertianRadiance();const h=S.d.FromHarmonics(z),t=(e.length-1)/Math.log2(E.specularImageSize);return await j.updateRGBDAsync(e,h,t)}))}return E._loaded.then((()=>E._babylonTexture))}}T(J),A(J,!0,(I=>new N(I)));j(11666);const m="EXT_mesh_gpu_instancing";class II{constructor(I){this.name=m,this._loader=I,this.enabled=this._loader.isExtensionUsed(m)}dispose(){this._loader=null}loadNodeAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(I,e)=>{this._loader._disableInstancedMesh++;const z=this._loader.loadNodeAsync(`/nodes/${E.index}`,E,j);if(this._loader._disableInstancedMesh--,!E._primitiveBabylonMeshes)return await z;const h=new Array;let t=0;const U=E=>{if(void 0==e.attributes[E])return void h.push(Promise.resolve(null));const j=s.Get(`${I}/attributes/${E}`,this._loader.de.accessors,e.attributes[E]);if(h.push(this._loader._loadFloatAccessorAsync(`/accessors/${j.bufferView}`,j)),0===t)t=j.count;else if(t!==j.count)throw new Error(`${I}/attributes: Instance buffer accessors do not have the same count.`)};return U("TRANSLATION"),U("ROTATION"),U("SCALE"),await z.then((async I=>{const[j,e,z]=await Promise.all(h),U=new Float32Array(16*t);w.TmpVectors.LE[0].nz(0,0,0),w.TmpVectors.Quaternion[0].nz(0,0,0,1),w.TmpVectors.LE[1].nz(1,1,1);for(let E=0;E<t;++E)j&&w.LE.FromArrayToRef(j,3*E,w.TmpVectors.LE[0]),e&&w.Quaternion.FromArrayToRef(e,4*E,w.TmpVectors.Quaternion[0]),z&&w.LE.FromArrayToRef(z,3*E,w.TmpVectors.LE[1]),w.Matrix.ComposeToRef(w.TmpVectors.LE[1],w.TmpVectors.Quaternion[0],w.TmpVectors.LE[0],w.TmpVectors.Matrix[0]),w.TmpVectors.Matrix[0].copyToArray(U,16*E);for(const w of E._primitiveBabylonMeshes)w.Go("matrix",U,16,!0);return I}))}))}}T(m),A(m,!0,(I=>new II(I)));let EI=0,jI=null;class eI{static get Default(){return eI._Default||(eI._Default=new eI),eI._Default}constructor(){const I=eI.Configuration.decoder;this._decoderModulePromise=h.Tools.LoadBabylonScriptAsync(I.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(I,E,j,e,w){await this._decoderModulePromise,0===EI&&(MeshoptDecoder.useWorkers(1),EI=1);const z=await MeshoptDecoder.decodeGltfBufferAsync(E,j,I,e,w);return null!==jI&&clearTimeout(jI),jI=setTimeout((()=>{MeshoptDecoder.useWorkers(0),EI=0,jI=null}),1e3),z}}eI.Configuration={decoder:{url:`${h.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},eI._Default=null;const wI="EXT_meshopt_compression";class zI{constructor(I){this.name=wI,this.enabled=I.isExtensionUsed(wI),this._loader=I}dispose(){this._loader=null}loadBufferViewAsync(I,E){return V.LoadExtensionAsync(I,E,this.name,(async(j,e)=>{const w=E;if(w._meshOptData)return await w._meshOptData;const z=s.Get(`${I}/buffer`,this._loader.de.buffers,e.buffer);return w._meshOptData=this._loader.loadBufferAsync(`/buffers/${z.index}`,z,e.byteOffset||0,e.byteLength).then((async I=>await eI.Default.decodeGltfBufferAsync(I,e.count,e.byteStride,e.mode,e.filter))),await w._meshOptData}))}}T(wI),A(wI,!0,(I=>new zI(I)));const hI="EXT_texture_webp";class tI{constructor(I){this.name=hI,this._loader=I,this.enabled=I.isExtensionUsed(hI)}dispose(){this._loader=null}_loadTextureAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=void 0==E.sampler?V.DefaultSampler:s.Get(`${I}/sampler`,this._loader.de.samplers,E.sampler),h=s.Get(`${e}/source`,this._loader.de.images,w.source);return await this._loader._createTextureAsync(I,z,h,(I=>{j(I)}),void 0,!E._textureInfo.nonColorData)}))}}T(hI),A(hI,!0,(I=>new tI(I)));const UI="EXT_texture_avif";class RI{constructor(I){this.name=UI,this._loader=I,this.enabled=I.isExtensionUsed(UI)}dispose(){this._loader=null}_loadTextureAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=void 0==E.sampler?V.DefaultSampler:s.Get(`${I}/sampler`,this._loader.de.samplers,E.sampler),h=s.Get(`${e}/source`,this._loader.de.images,w.source);return await this._loader._createTextureAsync(I,z,h,(I=>{j(I)}),void 0,!E._textureInfo.nonColorData)}))}}T(UI),A(UI,!0,(I=>new RI(I)));var PI=j(12765),oI=j(11652);const ZI="EXT_lights_ies";class cI{constructor(I){this.name=ZI,this._loader=I,this.enabled=this._loader.isExtensionUsed(ZI)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.de.extensions;if(I&&I[this.name]){const E=I[this.name];this._lights=E.lights,s.Assign(this._lights)}}loadNodeAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,h)=>{let t,U;this._loader._allMaterialsDirtyRequired=!0;const R=await this._loader.loadNodeAsync(I,E,(I=>{U=s.Get(e,this._lights,h.te);const E=U.name||I.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,t=new PI.e(E,w.LE.Zero(),w.LE.Backward(),0,1,this._loader.babylonScene),t.angle=Math.PI/2,t.innerAngle=0,t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,U._babylonLight=t,t.falloffType=oI.c.FALLOFF_GLTF,t.xh=h.color?z.qE.xE(h.color):z.qE.White(),t.Ch=h.multiplier||1,t.range=Number.MAX_VALUE,t.parent=I,this._loader._babylonLights.push(t),V.AddPointerMetadata(t,e),j(I)}));let P;if(U.uri)P=await this._loader.loadUriAsync(I,U,U.uri);else{const E=s.Get(`${I}/bufferView`,this._loader.de.bufferViews,U.bufferView);P=await this._loader.loadBufferViewAsync(`/bufferViews/${E.index}`,E)}return t.iesProfileTexture=new x.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,P,!0,void 0,void 0,void 0,void 0,".ies"),R}))}}T(ZI),A(ZI,!0,(I=>new cI(I)));var KI=j(12788);const LI="KHR_draco_mesh_compression";class FI{constructor(I){this.name=LI,this.useNormalizedFlagFromAccessor=!0,this._loader=I,this.enabled=KI.b.DefaultAvailable&&this._loader.isExtensionUsed(LI)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{if(void 0!=E.mode&&4!==E.mode&&5!==E.mode)throw new Error(`${I}: Unsupported mode ${E.mode}`);const z={},h={},t=(I,e)=>{const t=w.attributes[I];if(void 0!=t&&(j._delayInfo=j._delayInfo||[],-1===j._delayInfo.indexOf(e)&&j._delayInfo.push(e),z[e]=t,this.useNormalizedFlagFromAccessor)){const j=s.TryGet(this._loader.de.accessors,E.attributes[I]);j&&(h[e]=j.normalized||!1)}};t("POSITION",b.e.PositionKind),t("NORMAL",b.e.NormalKind),t("TANGENT",b.e.TangentKind),t("TEXCOORD_0",b.e.UVKind),t("TEXCOORD_1",b.e.UV2Kind),t("TEXCOORD_2",b.e.UV3Kind),t("TEXCOORD_3",b.e.UV4Kind),t("TEXCOORD_4",b.e.UV5Kind),t("TEXCOORD_5",b.e.UV6Kind),t("JOINTS_0",b.e.MatricesIndicesKind),t("WEIGHTS_0",b.e.MatricesWeightsKind),t("COLOR_0",b.e.ColorKind);const U=s.Get(e,this._loader.de.bufferViews,w.bufferView);return U._dracoBabylonGeometry||(U._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${U.index}`,U).then((async e=>{const w=this.dracoDecoder||KI.b.Default,t=s.TryGet(this._loader.de.accessors,E.attributes.POSITION),U=this._loader.parent.alwaysComputeBoundingBox||j.skeleton||!t?null:v(t);return await w._decodeMeshToGeometryForGltfAsync(j.name,this._loader.babylonScene,e,z,h,U).catch((E=>{throw new Error(`${I}: ${E.message}`)}))}))),await U._dracoBabylonGeometry}))}}T(LI),A(LI,!0,(I=>new FI(I)));var CI=j(12793),XI=j(11101),qI=j(11106),xI=j(11533),uI=j(11705),bI=j(11073);xI.b.AddNodeConstructor("Light_Type_0",((I,E)=>()=>new QI(I,w.LE.Zero(),E)));class QI extends uI.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(I){this._shadowAngle=I,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(I){const E=this.needCube();if(this._direction=I,this.needCube()!==E&&this._shadowGenerators){const I=this._shadowGenerators.values();for(let E=I.next();!0!==E.done;E=I.next()){E.value.recreateShadowMap()}}}constructor(I,E,j){super(I,j),this._shadowAngle=Math.PI/2,this.position=E}getClassName(){return"PointLight"}getTypeID(){return oI.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(I){if(this.direction)return super.getShadowDirection(I);switch(I){case 0:return new w.LE(1,0,0);case 1:return new w.LE(-1,0,0);case 2:return new w.LE(0,-1,0);case 3:return new w.LE(0,1,0);case 4:return new w.LE(0,0,1);case 5:return new w.LE(0,0,-1)}return w.LE.Zero()}_setDefaultShadowProjectionMatrix(I,E,j){const e=this.GI().activeCamera;if(!e)return;const z=void 0!==this.shadowMinZ?this.shadowMinZ:e.Te,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:e.maxZ,t=this.GI().getEngine().useReverseDepthBuffer;w.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,t?h:z,t?z:h,I,!0,this._scene.getEngine().isNDCHalfZRange,void 0,t)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(I,E){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,E):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,E),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,E),this}transferToNodeMaterialEffect(I,E){return this.computeTransformedInformation()?I.setFloat3(E,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):I.setFloat3(E,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(I,E){I["POINTLIGHT"+E]=!0}}(0,XI.b)([(0,qI.N)()],QI.prototype,"shadowAngle",null),(0,bI.h)("BABYLON.PointLight",QI);const GI="KHR_lights_punctual";class yI{constructor(I){this.name=GI,this._loader=I,this.enabled=this._loader.isExtensionUsed(GI)}dispose(){this._loader=null,delete this._lights}onLoading(){const I=this._loader.de.extensions;if(I&&I[this.name]){const E=I[this.name];this._lights=E.lights,s.Assign(this._lights)}}loadNodeAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,h)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(I,E,(I=>{let E;const t=s.Get(e,this._lights,h.te),U=t.name||I.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,t.type){case"directional":{const I=new CI.c(U,w.LE.Backward(),this._loader.babylonScene);I.position.mz(0),E=I;break}case"point":E=new QI(U,w.LE.Zero(),this._loader.babylonScene);break;case"spot":{const I=new PI.e(U,w.LE.Zero(),w.LE.Backward(),0,1,this._loader.babylonScene);I.angle=2*(t.spot&&t.spot.outerConeAngle||Math.PI/4),I.innerAngle=2*(t.spot&&t.spot.innerConeAngle||0),E=I;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${e}: Invalid light type (${t.type})`)}E._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,t._babylonLight=E,E.falloffType=oI.c.FALLOFF_GLTF,E.xh=t.color?z.qE.xE(t.color):z.qE.White(),E.Ch=void 0==t.Ch?1:t.Ch,E.range=void 0==t.range?Number.MAX_VALUE:t.range,E.parent=I,this._loader._babylonLights.push(E),V.AddPointerMetadata(E,e),j(I)})))))}}T(GI),A(GI,!0,(I=>new yI(I)));const dI="KHR_materials_pbrSpecularGlossiness";class aI{constructor(I){this.name=dI,this.order=200,this._loader=I,this.enabled=this._loader.isExtensionUsed(dI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialBasePropertiesAsync(I,E,j)),z.push(this._loadSpecularGlossinessPropertiesAsync(e,w,j)),this._loader.loadMaterialAlphaProperties(I,E,j),await Promise.all(z).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return j.metallic=null,j.roughness=null,E.diffuseFactor?(j.albedoColor=z.qE.xE(E.diffuseFactor),j.alpha=E.diffuseFactor[3]):j.albedoColor=z.qE.White(),j.reflectivityColor=E.specularFactor?z.qE.xE(E.specularFactor):z.qE.White(),j.microSurface=void 0==E.glossinessFactor?1:E.glossinessFactor,E.diffuseTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTexture`,E.diffuseTexture,(I=>{I.name=`${j.name} (Diffuse)`,j.albedoTexture=I}))),E.specularGlossinessTexture&&(e.push(this._loader.loadTextureInfoAsync(`${I}/specularGlossinessTexture`,E.specularGlossinessTexture,(I=>{I.name=`${j.name} (Specular Glossiness)`,j.reflectivityTexture=I,j.reflectivityTexture.ne=!0}))),j.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(e).then((()=>{}))}}T(dI),A(dI,!0,(I=>new aI(I)));const lI="KHR_materials_unlit";class iI{constructor(I){this.name=lI,this.order=210,this._loader=I,this.enabled=this._loader.isExtensionUsed(lI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async()=>await this._loadUnlitPropertiesAsync(I,E,j)))}_loadUnlitPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;j.unlit=!0;const w=E.pbrMetallicRoughness;return w&&(w.baseColorFactor?(j.albedoColor=z.qE.xE(w.baseColorFactor),j.alpha=w.baseColorFactor[3]):j.albedoColor=z.qE.White(),w.baseColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/baseColorTexture`,w.baseColorTexture,(I=>{I.name=`${j.name} (Base Color)`,j.albedoTexture=I})))),E.doubleSided&&(j.tz=!1,j.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(I,E,j),Promise.all(e).then((()=>{}))}}T(lI),A(lI,!0,(I=>new iI(I)));const rI="KHR_materials_clearcoat";class nI{constructor(I){this.name=rI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(rI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadClearCoatPropertiesAsync(e,w,j)),await Promise.all(z)}))}_loadClearCoatPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return j.clearCoat.isEnabled=!0,j.clearCoat.useRoughnessFromMainTexture=!1,j.clearCoat.remapF0OnInterfaceChange=!1,void 0!=E.clearcoatFactor?j.clearCoat.Ch=E.clearcoatFactor:j.clearCoat.Ch=0,E.clearcoatTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatTexture`,E.clearcoatTexture,(I=>{I.name=`${j.name} (ClearCoat)`,j.clearCoat.texture=I}))),void 0!=E.clearcoatRoughnessFactor?j.clearCoat.roughness=E.clearcoatRoughnessFactor:j.clearCoat.roughness=0,E.clearcoatRoughnessTexture&&(E.clearcoatRoughnessTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatRoughnessTexture`,E.clearcoatRoughnessTexture,(I=>{I.name=`${j.name} (ClearCoat Roughness)`,j.clearCoat.textureRoughness=I})))),E.clearcoatNormalTexture&&(E.clearcoatNormalTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/clearcoatNormalTexture`,E.clearcoatNormalTexture,(I=>{I.name=`${j.name} (ClearCoat Normal)`,j.clearCoat.bumpTexture=I}))),j.invertNormalMapX=!j.GI().useRightHandedSystem,j.invertNormalMapY=j.GI().useRightHandedSystem,void 0!=E.clearcoatNormalTexture.scale&&(j.clearCoat.bumpTexture.level=E.clearcoatNormalTexture.scale)),Promise.all(e).then((()=>{}))}}T(rI),A(rI,!0,(I=>new nI(I)));const HI="KHR_materials_iridescence";class gI{constructor(I){this.name=HI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(HI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadIridescencePropertiesAsync(e,w,j)),await Promise.all(z).then((()=>{}))}))}_loadIridescencePropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return j.iridescence.isEnabled=!0,j.iridescence.Ch=E.iridescenceFactor??0,j.iridescence.indexOfRefraction=E.iridescenceIor??E.iridescenceIOR??1.3,j.iridescence.minimumThickness=E.iridescenceThicknessMinimum??100,j.iridescence.maximumThickness=E.iridescenceThicknessMaximum??400,E.iridescenceTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceTexture`,E.iridescenceTexture,(I=>{I.name=`${j.name} (Iridescence)`,j.iridescence.texture=I}))),E.iridescenceThicknessTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/iridescenceThicknessTexture`,E.iridescenceThicknessTexture,(I=>{I.name=`${j.name} (Iridescence Thickness)`,j.iridescence.thicknessTexture=I}))),Promise.all(e).then((()=>{}))}}T(HI),A(HI,!0,(I=>new gI(I)));const YI="KHR_materials_anisotropy";class AI{constructor(I){this.name=YI,this.order=195,this._loader=I,this.enabled=this._loader.isExtensionUsed(YI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadIridescencePropertiesAsync(e,w,j)),await Promise.all(z)}))}async _loadIridescencePropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;j.anisotropy.isEnabled=!0,j.anisotropy.Ch=E.anisotropyStrength??0,j.anisotropy.angle=E.anisotropyRotation??0,E.anisotropyTexture&&(E.anisotropyTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/anisotropyTexture`,E.anisotropyTexture,(I=>{I.name=`${j.name} (Anisotropy Intensity)`,j.anisotropy.texture=I})))),await Promise.all(e)}}T(YI),A(YI,!0,(I=>new AI(I)));const TI="KHR_materials_emissive_strength";class MI{constructor(I){this.name=TI,this.order=170,this._loader=I,this.enabled=this._loader.isExtensionUsed(TI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>await this._loader.loadMaterialPropertiesAsync(I,E,j).then((()=>{this._loadEmissiveProperties(e,w,j)}))))}_loadEmissiveProperties(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);void 0!==E.emissiveStrength&&(j.emissiveIntensity=E.emissiveStrength)}}T(TI),A(TI,!0,(I=>new MI(I)));const WI="KHR_materials_sheen";class OI{constructor(I){this.name=WI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(WI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadSheenPropertiesAsync(e,w,j)),await Promise.all(z).then((()=>{}))}))}_loadSheenPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return j.sheen.isEnabled=!0,j.sheen.Ch=1,void 0!=E.sheenColorFactor?j.sheen.color=z.qE.xE(E.sheenColorFactor):j.sheen.color=z.qE.Black(),E.sheenColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/sheenColorTexture`,E.sheenColorTexture,(I=>{I.name=`${j.name} (Sheen Color)`,j.sheen.texture=I}))),void 0!==E.sheenRoughnessFactor?j.sheen.roughness=E.sheenRoughnessFactor:j.sheen.roughness=0,E.sheenRoughnessTexture&&(E.sheenRoughnessTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/sheenRoughnessTexture`,E.sheenRoughnessTexture,(I=>{I.name=`${j.name} (Sheen Roughness)`,j.sheen.textureRoughness=I})))),j.sheen.albedoScaling=!0,j.sheen.useRoughnessFromMainTexture=!1,Promise.all(e).then((()=>{}))}}T(WI),A(WI,!0,(I=>new OI(I)));var sI=j(11595);const vI="KHR_materials_specular";class VI{constructor(I){this.name=vI,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(vI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;if(z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadSpecularPropertiesAsync(e,w,j)),w.extensions&&w.extensions.EXT_materials_specular_edge_color&&j instanceof q.d){w.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(j.brdf.dielectricSpecularModel=sI.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,j.brdf.conductorSpecularModel=sI.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(z).then((()=>{}))}))}_loadSpecularPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return void 0!==E.specularFactor&&(j.metallicF0Factor=E.specularFactor),void 0!==E.specularColorFactor&&(j.metallicReflectanceColor=z.qE.xE(E.specularColorFactor)),E.specularTexture&&(E.specularTexture.nonColorData=!0,e.push(this._loader.loadTextureInfoAsync(`${I}/specularTexture`,E.specularTexture,(I=>{I.name=`${j.name} (Specular)`,j.metallicReflectanceTexture=I,j.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),E.specularColorTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/specularColorTexture`,E.specularColorTexture,(I=>{I.name=`${j.name} (Specular Color)`,j.reflectanceTexture=I}))),Promise.all(e).then((()=>{}))}}T(vI),A(vI,!0,(I=>new VI(I)));const fI="KHR_materials_ior";class SI{constructor(I){this.name=fI,this.order=180,this._loader=I,this.enabled=this._loader.isExtensionUsed(fI)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadIorPropertiesAsync(e,w,j)),await Promise.all(z).then((()=>{}))}))}_loadIorPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);return void 0!==E.ior?j.indexOfRefraction=E.ior:j.indexOfRefraction=SI._DEFAULT_IOR,Promise.resolve()}}SI._DEFAULT_IOR=1.5,T(fI),A(fI,!0,(I=>new SI(I)));const BI="KHR_materials_variants";class pI{constructor(I){this.name=BI,this._loader=I,this.enabled=this._loader.isExtensionUsed(BI)}dispose(){this._loader=null}static GetAvailableVariants(I){const E=this._GetExtensionMetadata(I);return E?Object.keys(E.variants):[]}getAvailableVariants(I){return pI.GetAvailableVariants(I)}static SelectVariant(I,E){const j=this._GetExtensionMetadata(I);if(!j)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${BI} extension`);const e=I=>{const E=j.variants[I];if(E)for(const j of E)j.mesh.material=j.material};if(E instanceof Array)for(const w of E)e(w);else e(E);j.lastSelected=E}selectVariant(I,E){pI.SelectVariant(I,E)}static Reset(I){const E=this._GetExtensionMetadata(I);if(!E)throw new Error(`Cannot reset on a glTF mesh that does not have the ${BI} extension`);for(const j of E.original)j.mesh.material=j.material;E.lastSelected=null}reset(I){pI.Reset(I)}static GetLastSelectedVariant(I){const E=this._GetExtensionMetadata(I);if(!E)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${BI} extension`);return E.lastSelected}getLastSelectedVariant(I){return pI.GetLastSelectedVariant(I)}static _GetExtensionMetadata(I){var E,j;return(null===I||void 0===I||null===(E=I._internalMetadata)||void 0===E||null===(j=E.de)||void 0===j?void 0:j[BI])||null}onLoading(){const I=this._loader.de.extensions;if(I&&I[this.name]){const E=I[this.name];this._variants=E.variants}}onReady(){const I=this._loader.rootBabylonMesh;if(I){var E;const j=this._loader.parent.extensionOptions[BI];null!==j&&void 0!==j&&j.defaultVariant&&pI.SelectVariant(I,j.defaultVariant),null===j||void 0===j||null===(E=j.onLoaded)||void 0===E||E.call(j,{get variants(){return pI.GetAvailableVariants(I)},get selectedVariant(){const E=pI.GetLastSelectedVariant(I);return E?Array.isArray(E)?E[0]:E:pI.GetAvailableVariants(I)[0]},set selectedVariant(E){pI.SelectVariant(I,E)}})}}_loadMeshPrimitiveAsync(I,E,j,e,w,z){return V.LoadExtensionAsync(I,w,this.name,(async(h,t)=>{const U=new Array;return U.push(this._loader._loadMeshPrimitiveAsync(I,E,j,e,w,(E=>{if(z(E),E instanceof y.d){const j=V._GetDrawMode(I,w.mode),e=this._loader.rootBabylonMesh,z=e?e._internalMetadata=e._internalMetadata||{}:{},R=z.de=z.de||{},P=R[BI]=R[BI]||{lastSelected:null,original:[],variants:{}};P.original.push({mesh:E,material:E.material});for(let I=0;I<t.mappings.length;++I){const w=t.mappings[I],z=s.Get(`${h}/mappings/${I}/material`,this._loader.de.materials,w.material);U.push(this._loader._loadMaterialAsync(`#/materials/${w.material}`,z,E,j,(I=>{for(let j=0;j<w.variants.length;++j){const z=w.variants[j],h=s.Get(`/extensions/${BI}/variants/${z}`,this._variants,z);P.variants[h.name]=P.variants[h.name]||[],P.variants[h.name].push({mesh:E,material:I}),E.onClonedObservable.add((I=>{const j=I;let w=null,z=j;do{if(z=z.parent,!z)return;w=pI._GetExtensionMetadata(z)}while(null===w);if(e&&w===pI._GetExtensionMetadata(e)){z._internalMetadata={};for(const I in e._internalMetadata)z._internalMetadata[I]=e._internalMetadata[I];z._internalMetadata.de=[];for(const I in e._internalMetadata.de)z._internalMetadata.de[I]=e._internalMetadata.de[I];z._internalMetadata.de[BI]={lastSelected:null,original:[],variants:{}};for(const I of w.original)z._internalMetadata.de[BI].original.push({mesh:I.mesh,material:I.material});for(const I in w.variants)if(Object.prototype.hasOwnProperty.call(w.variants,I)){z._internalMetadata.de[BI].variants[I]=[];for(const E of w.variants[I])z._internalMetadata.de[BI].variants[I].push({mesh:E.mesh,material:E.material})}w=z._internalMetadata.de[BI]}for(const e of w.original)e.mesh===E&&(e.mesh=j);for(const e of w.variants[h.name])e.mesh===E&&(e.mesh=j)}))}})))}}}))),await Promise.all(U).then((I=>{let[E]=I;return E}))}))}}T(BI),A(BI,!0,(I=>new pI(I)));var DI=j(11183);class kI{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:sI.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(I,E){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...kI._GetDefaultOptions(),...I},this._scene=E,this._scene._transmissionHelper=this,this.onErrorObservable=new P.e,this._scene.Le.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(I){if(!Object.keys(I).filter((E=>this._options[E]!==I[E])).length)return;const E={...this._options,...I},j=this._options;this._options=E,E.renderSize===j.renderSize&&E.renderTargetTextureType===j.renderTargetTextureType&&E.generateMipmaps===j.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=E.samples,this._opaqueRenderTarget.lodGenerationScale=E.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=E.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(I){return!!I&&!!(I instanceof q.d&&I.subSurface.isRefractionEnabled)}_addMesh(I){this._materialObservers[I.uniqueId]=I.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),h.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(I.material)?(I.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(I)&&this._transparentMeshesCache.push(I)):-1===this._opaqueMeshesCache.indexOf(I)&&this._opaqueMeshesCache.push(I)}))}_removeMesh(I){I.onMaterialChangedObservable.remove(this._materialObservers[I.uniqueId]),delete this._materialObservers[I.uniqueId];let E=this._transparentMeshesCache.indexOf(I);-1!==E&&this._transparentMeshesCache.splice(E,1),E=this._opaqueMeshesCache.indexOf(I),-1!==E&&this._opaqueMeshesCache.splice(E,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(I){const E=this._transparentMeshesCache.indexOf(I),j=this._opaqueMeshesCache.indexOf(I);this._shouldRenderAsTransmission(I.material)?(I.material instanceof q.d&&(I.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==j?(this._opaqueMeshesCache.splice(j,1),this._transparentMeshesCache.push(I)):-1===E&&this._transparentMeshesCache.push(I)):-1!==E?(this._transparentMeshesCache.splice(E,1),this._opaqueMeshesCache.push(I)):-1===j&&this._opaqueMeshesCache.push(I)}_isRenderTargetValid(){var I;return null!==(null===(I=this._opaqueRenderTarget)||void 0===I?void 0:I.getInternalTexture())}_setupRenderTargets(){var I;let E;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new DI.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(I=this._options.clearColor)||void 0===I?void 0:I.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((I=>{E=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?I.clearColor.U(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(I.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=E}));for(const j of this._transparentMeshesCache)this._shouldRenderAsTransmission(j.material)&&(j.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const JI="KHR_materials_transmission";class NI{constructor(I){this.name=JI,this.order=175,this._loader=I,this.enabled=this._loader.isExtensionUsed(JI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadTransparentPropertiesAsync(e,E,j,w)),await Promise.all(z).then((()=>{}))}))}_loadTransparentPropertiesAsync(I,E,j,e){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const w=j;if(w.subSurface.isRefractionEnabled=!0,w.subSurface.volumeIndexOfRefraction=1,w.subSurface.useAlbedoToTintRefraction=!0,void 0===e.transmissionFactor)return w.subSurface.refractionIntensity=0,w.subSurface.isRefractionEnabled=!1,Promise.resolve();{var z;w.subSurface.refractionIntensity=e.transmissionFactor;const I=w.GI();if(w.subSurface.refractionIntensity&&!I._transmissionHelper)new kI({},w.GI());else if(w.subSurface.refractionIntensity&&(null===(z=I._transmissionHelper)||void 0===z||!z._isRenderTargetValid())){var h;null===(h=I._transmissionHelper)||void 0===h||h._setupRenderTargets()}}return w.subSurface.minimumThickness=0,w.subSurface.maximumThickness=0,e.transmissionTexture?(e.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/transmissionTexture`,e.transmissionTexture,void 0).then((I=>{I.name=`${j.name} (Transmission)`,w.subSurface.refractionIntensityTexture=I,w.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}T(JI),A(JI,!0,(I=>new NI(I)));const mI="KHR_materials_diffuse_transmission";class IE{constructor(I){this.name=mI,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(mI),this.enabled&&(I.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadTranslucentPropertiesAsync(e,E,j,w)),await Promise.all(z).then((()=>{}))}))}_loadTranslucentPropertiesAsync(I,E,j,e){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const w=j;if(w.subSurface.isTranslucencyEnabled=!0,w.subSurface.volumeIndexOfRefraction=1,w.subSurface.minimumThickness=0,w.subSurface.maximumThickness=0,w.subSurface.useAlbedoToTintTranslucency=!1,void 0===e.diffuseTransmissionFactor)return w.subSurface.translucencyIntensity=0,w.subSurface.isTranslucencyEnabled=!1,Promise.resolve();w.subSurface.translucencyIntensity=e.diffuseTransmissionFactor;const h=new Array;return w.subSurface.useGltfStyleTextures=!0,e.diffuseTransmissionTexture&&(e.diffuseTransmissionTexture.nonColorData=!0,h.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionTexture`,e.diffuseTransmissionTexture).then((I=>{I.name=`${j.name} (Diffuse Transmission)`,w.subSurface.translucencyIntensityTexture=I})))),void 0!==e.diffuseTransmissionColorFactor?w.subSurface.translucencyColor=z.qE.xE(e.diffuseTransmissionColorFactor):w.subSurface.translucencyColor=z.qE.White(),e.diffuseTransmissionColorTexture&&h.push(this._loader.loadTextureInfoAsync(`${I}/diffuseTransmissionColorTexture`,e.diffuseTransmissionColorTexture).then((I=>{I.name=`${j.name} (Diffuse Transmission Color)`,w.subSurface.translucencyColorTexture=I}))),Promise.all(h).then((()=>{}))}}T(mI),A(mI,!0,(I=>new IE(I)));const EE="KHR_materials_volume";class jE{constructor(I){this.name=EE,this.order=173,this._loader=I,this.enabled=this._loader.isExtensionUsed(EE),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadVolumePropertiesAsync(e,E,j,w)),await Promise.all(z).then((()=>{}))}))}_loadVolumePropertiesAsync(I,E,j,e){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);if(!j.subSurface.isRefractionEnabled&&!j.subSurface.isTranslucencyEnabled||!e.thicknessFactor)return Promise.resolve();j.subSurface.volumeIndexOfRefraction=j.indexOfRefraction;const w=void 0!==e.attenuationDistance?e.attenuationDistance:Number.MAX_VALUE;return j.subSurface.tintColorAtDistance=w,void 0!==e.attenuationColor&&3==e.attenuationColor.length&&j.subSurface.tintColor.nz(e.attenuationColor[0],e.attenuationColor[1],e.attenuationColor[2]),j.subSurface.minimumThickness=0,j.subSurface.maximumThickness=e.thicknessFactor,j.subSurface.useThicknessAsDepth=!0,e.thicknessTexture?(e.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${I}/thicknessTexture`,e.thicknessTexture).then((I=>{I.name=`${j.name} (Thickness)`,j.subSurface.thicknessTexture=I,j.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}T(EE),A(EE,!0,(I=>new jE(I)));const eE="KHR_materials_dispersion";class wE{constructor(I){this.name=eE,this.order=174,this._loader=I,this.enabled=this._loader.isExtensionUsed(eE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadDispersionPropertiesAsync(e,E,j,w)),await Promise.all(z).then((()=>{}))}))}_loadDispersionPropertiesAsync(I,E,j,e){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);return j.subSurface.isRefractionEnabled&&e.dispersion?(j.subSurface.isDispersionEnabled=!0,j.subSurface.dispersion=e.dispersion,Promise.resolve()):Promise.resolve()}}T(eE),A(eE,!0,(I=>new wE(I)));const zE="EXT_materials_diffuse_roughness";class hE{constructor(I){this.name=zE,this.order=190,this._loader=I,this.enabled=this._loader.isExtensionUsed(zE)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=new Array;return z.push(this._loader.loadMaterialPropertiesAsync(I,E,j)),z.push(this._loadDiffuseRoughnessPropertiesAsync(e,w,j)),await Promise.all(z).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(I,E,j){if(!(j instanceof q.d))throw new Error(`${I}: Material type not supported`);const e=new Array;return j.brdf.baseDiffuseModel=sI.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=E.diffuseRoughnessFactor?j.baseDiffuseRoughness=E.diffuseRoughnessFactor:j.baseDiffuseRoughness=0,E.diffuseRoughnessTexture&&e.push(this._loader.loadTextureInfoAsync(`${I}/diffuseRoughnessTexture`,E.diffuseRoughnessTexture,(I=>{I.name=`${j.name} (Diffuse Roughness)`,j.baseDiffuseRoughnessTexture=I}))),Promise.all(e).then((()=>{}))}}T(zE),A(zE,!0,(I=>new hE(I)));const tE="KHR_mesh_quantization";class UE{constructor(I){this.name=tE,this.enabled=I.isExtensionUsed(tE)}dispose(){}}T(tE),A(tE,!0,(I=>new UE(I)));const RE="KHR_texture_basisu";class PE{constructor(I){this.name=RE,this._loader=I,this.enabled=I.isExtensionUsed(RE)}dispose(){this._loader=null}_loadTextureAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>{const z=void 0==E.sampler?V.DefaultSampler:s.Get(`${I}/sampler`,this._loader.de.samplers,E.sampler),h=s.Get(`${e}/source`,this._loader.de.images,w.source);return await this._loader._createTextureAsync(I,z,h,(I=>{j(I)}),E._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!E._textureInfo.nonColorData)}))}}T(RE),A(RE,!0,(I=>new PE(I)));const oE="KHR_texture_transform";class ZE{constructor(I){this.name=oE,this._loader=I,this.enabled=this._loader.isExtensionUsed(oE)}dispose(){this._loader=null}loadTextureInfoAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(e,w)=>await this._loader.loadTextureInfoAsync(I,E,(I=>{if(!(I instanceof x.d))throw new Error(`${e}: Texture type not supported`);w.offset&&(I.uOffset=w.offset[0],I.vOffset=w.offset[1]),I.uRotationCenter=0,I.vRotationCenter=0,w.rotation&&(I.wAng=-w.rotation),w.scale&&(I.uScale=w.scale[0],I.vScale=w.scale[1]),void 0!=w.texCoord&&(I.coordinatesIndex=w.texCoord),j(I)}))))}}T(oE),A(oE,!0,(I=>new ZE(I)));const cE="KHR_xmp_json_ld";class KE{constructor(I){this.name=cE,this.order=100,this._loader=I,this.enabled=this._loader.isExtensionUsed(cE)}dispose(){this._loader=null}onLoading(){var I,E,j;if(null===this._loader.rootBabylonMesh)return;const e=null===(I=this._loader.de.extensions)||void 0===I?void 0:I.KHR_xmp_json_ld,w=null===(E=this._loader.de.asset)||void 0===E||null===(j=E.extensions)||void 0===j?void 0:j.KHR_xmp_json_ld;if(e&&w){const I=+w.packet;e.packets&&I<e.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=e.packets[I])}}}function LE(I,E,j,e){return z.qE.xE(E,j).scale(e)}function FE(I,E,j,e){return E[j]*e}function CE(I,E,j,e){return-E[j]*e}function XE(I,E,j,e){return E[j+1]*e}function qE(I,E,j,e){return E[j]*e*2}function xE(I){return{scale:[new bE(Z.c.ANIMATIONTYPE_FLOAT,`${I}.uScale`,FE,(()=>2)),new bE(Z.c.ANIMATIONTYPE_FLOAT,`${I}.vScale`,XE,(()=>2))],offset:[new bE(Z.c.ANIMATIONTYPE_FLOAT,`${I}.uOffset`,FE,(()=>2)),new bE(Z.c.ANIMATIONTYPE_FLOAT,`${I}.vOffset`,XE,(()=>2))],rotation:[new bE(Z.c.ANIMATIONTYPE_FLOAT,`${I}.wAng`,CE,(()=>1))]}}T(cE),A(cE,!0,(I=>new KE(I)));class uE extends f.AnimationPropertyInfo{buildAnimations(I,E,j,e){return[{babylonAnimatable:I._babylonCamera,babylonAnimation:this._buildAnimation(E,j,e)}]}}class bE extends f.AnimationPropertyInfo{buildAnimations(I,E,j,e){const w=[];for(const z in I._data)w.push({babylonAnimatable:I._data[z].babylonMaterial,babylonAnimation:this._buildAnimation(E,j,e)});return w}}class QE extends f.AnimationPropertyInfo{buildAnimations(I,E,j,e){return[{babylonAnimatable:I._babylonLight,babylonAnimation:this._buildAnimation(E,j,e)}]}}(0,M.i)("/cameras/{}/orthographic/xmag",[new uE(Z.c.ANIMATIONTYPE_FLOAT,"orthoLeft",CE,(()=>1)),new uE(Z.c.ANIMATIONTYPE_FLOAT,"orthoRight",XE,(()=>1))]),(0,M.i)("/cameras/{}/orthographic/ymag",[new uE(Z.c.ANIMATIONTYPE_FLOAT,"orthoBottom",CE,(()=>1)),new uE(Z.c.ANIMATIONTYPE_FLOAT,"orthoTop",XE,(()=>1))]),(0,M.i)("/cameras/{}/orthographic/zfar",[new uE(Z.c.ANIMATIONTYPE_FLOAT,"maxZ",FE,(()=>1))]),(0,M.i)("/cameras/{}/orthographic/znear",[new uE(Z.c.ANIMATIONTYPE_FLOAT,"Te",FE,(()=>1))]),(0,M.i)("/cameras/{}/perspective/yfov",[new uE(Z.c.ANIMATIONTYPE_FLOAT,"fov",FE,(()=>1))]),(0,M.i)("/cameras/{}/perspective/zfar",[new uE(Z.c.ANIMATIONTYPE_FLOAT,"maxZ",FE,(()=>1))]),(0,M.i)("/cameras/{}/perspective/znear",[new uE(Z.c.ANIMATIONTYPE_FLOAT,"Te",FE,(()=>1))]),(0,M.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new bE(Z.c.ANIMATIONTYPE_COLOR3,"albedoColor",LE,(()=>4)),new bE(Z.c.ANIMATIONTYPE_FLOAT,"alpha",(function(I,E,j,e){return E[j+3]*e}),(()=>4))]),(0,M.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"metallic",FE,(()=>1))]),(0,M.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"roughness",FE,(()=>1))]);const GE=xE("albedoTexture");(0,M.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",GE.scale),(0,M.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",GE.offset),(0,M.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",GE.rotation);const yE=xE("metallicTexture");(0,M.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",yE.scale),(0,M.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",yE.offset),(0,M.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",yE.rotation),(0,M.i)("/materials/{}/emissiveFactor",[new bE(Z.c.ANIMATIONTYPE_COLOR3,"emissiveColor",LE,(()=>3))]);const dE=xE("bumpTexture");(0,M.i)("/materials/{}/normalTexture/scale",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",FE,(()=>1))]),(0,M.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",dE.scale),(0,M.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",dE.offset),(0,M.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",dE.rotation),(0,M.i)("/materials/{}/occlusionTexture/strength",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",FE,(()=>1))]);const aE=xE("ambientTexture");(0,M.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",aE.scale),(0,M.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",aE.offset),(0,M.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",aE.rotation);const lE=xE("emissiveTexture");(0,M.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",lE.scale),(0,M.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",lE.offset),(0,M.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",lE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",FE,(()=>1))]);const iE=xE("anisotropy.texture");(0,M.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",iE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",iE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",iE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",FE,(()=>1))]);const rE=xE("clearCoat.texture");(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",rE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",rE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",rE.rotation);const nE=xE("clearCoat.bumpTexture");(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",nE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",nE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",nE.rotation);const HE=xE("clearCoat.textureRoughness");(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",HE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",HE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",HE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",FE,(()=>1))]);const gE=xE("iridescence.texture");(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",gE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",gE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",gE.rotation);const YE=xE("iridescence.thicknessTexture");(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",YE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",YE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",YE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new bE(Z.c.ANIMATIONTYPE_COLOR3,"sheen.color",LE,(()=>3))]),(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",FE,(()=>1))]);const AE=xE("sheen.texture");(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",AE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",AE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",AE.rotation);const TE=xE("sheen.textureRoughness");(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",TE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",TE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",TE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new bE(Z.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",LE,(()=>3))]);const ME=xE("metallicReflectanceTexture");(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",ME.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",ME.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",ME.rotation);const WE=xE("reflectanceTexture");(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",WE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",WE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",WE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",FE,(()=>1))]);const OE=xE("subSurface.refractionIntensityTexture");(0,M.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",OE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",OE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",OE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new bE(Z.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",LE,(()=>3))]),(0,M.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",FE,(()=>1))]),(0,M.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",FE,(()=>1))]);const sE=xE("subSurface.thicknessTexture");(0,M.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",sE.scale),(0,M.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",sE.offset),(0,M.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",sE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new bE(Z.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",FE,(()=>1))]);const vE=xE("subSurface.translucencyIntensityTexture");(0,M.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",vE.scale),(0,M.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",vE.offset),(0,M.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",vE.rotation),(0,M.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new bE(Z.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",LE,(()=>3))]);const VE=xE("subSurface.translucencyColorTexture");(0,M.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",VE.scale),(0,M.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",VE.offset),(0,M.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",VE.rotation),(0,M.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new QE(Z.c.ANIMATIONTYPE_COLOR3,"diffuse",LE,(()=>3))]),(0,M.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new QE(Z.c.ANIMATIONTYPE_FLOAT,"intensity",FE,(()=>1))]),(0,M.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new QE(Z.c.ANIMATIONTYPE_FLOAT,"range",FE,(()=>1))]),(0,M.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new QE(Z.c.ANIMATIONTYPE_FLOAT,"innerAngle",qE,(()=>1))]),(0,M.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new QE(Z.c.ANIMATIONTYPE_FLOAT,"angle",qE,(()=>1))]),(0,M.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new QE(Z.c.ANIMATIONTYPE_COLOR3,"diffuse",LE,(()=>3))]),(0,M.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new QE(Z.c.ANIMATIONTYPE_FLOAT,"intensity",FE,(()=>1))]);const fE="KHR_animation_pointer";class SE{constructor(I){this.name=fE,this._loader=I,this._pathToObjectConverter=(0,M.f)(this._loader.de)}get enabled(){return this._loader.isExtensionUsed(fE)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(I,E,j,e,w){var z;const h=null===(z=e.target.extensions)||void 0===z?void 0:z.KHR_animation_pointer;if(!h||!this._pathToObjectConverter)return null;"pointer"!==e.target.path&&L.b.Warn(`${I}/target/path: Value (${e.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=e.target.node&&L.b.Warn(`${I}/target/node: Value (${e.target.node}) must not be present when using the ${this.name} extension`);const t=`${I}/extensions/${this.name}`,U=h.pointer;if(!U)throw new Error(`${t}: Pointer is missing`);try{const z=this._pathToObjectConverter.convert(U);if(!z.info.interpolation)throw new Error(`${t}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(I,E,j,e,{object:z.object,info:z.info.interpolation},w)}catch(R){return L.b.Warn(`${t}/pointer: Invalid pointer (${U}) skipped`),null}}}T(fE),A(fE,!0,(I=>new SE(I)));class BE{constructor(I,E,j){this.frame=I,this.action=E,this.onlyOnce=j,this.isDone=!1}_clone(){return new BE(this.frame,this.action,this.onlyOnce)}}var pE=j(10986),DE=j(11033),kE=j(11031);class JE{get loop(){return this._loop}set loop(I){I!==this._loop&&(this._loop=I,this.updateOptions({loop:I}))}get currentTime(){var I;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(I=DE.c.audioEngine)&&void 0!==I&&I.audioContext&&(this.isPlaying||this.isPaused)){const I=this.isPaused?0:DE.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+I}return 0}get spatialSound(){return this._spatialSound}set spatialSound(I){if(I==this._spatialSound)return;const E=this.isPlaying;this.pause(),I?(this._spatialSound=I,this._updateSpatialParameters()):this._disableSpatialSound(),E&&this.play()}constructor(I,E,j){var e;let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new P.e,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=w.LE.Zero(),this._localDirection=new w.LE(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=I,j=j||K.d.LastCreatedScene)if(this._scene=j,JE._SceneComponentInitialization(j),this._readyToPlayCallback=z,this._customAttenuationFunction=(I,E,j,e,w)=>E<j?I*(1-E/j):0,t&&(this.autoplay=t.autoplay||!1,this._loop=t.loop||!1,void 0!==t.volume&&(this._volume=t.volume),this._spatialSound=t.spatialSound??!1,this.maxDistance=t.maxDistance??100,this.useCustomAttenuation=t.useCustomAttenuation??!1,this.rolloffFactor=t.rolloffFactor||1,this.refDistance=t.refDistance||1,this.distanceModel=t.distanceModel||"linear",this._playbackRate=t.playbackRate||1,this._streaming=t.streaming??!1,this._length=t.length,this._offset=t.offset),null!==(e=DE.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&DE.c.audioEngine.audioContext){this._soundGain=DE.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let I=!0;if(E)try{"string"===typeof E?(this._urlType="String",this._url=E):E instanceof ArrayBuffer?this._urlType="ArrayBuffer":E instanceof HTMLMediaElement?this._urlType="MediaElement":E instanceof MediaStream?this._urlType="MediaStream":E instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(E)&&(this._urlType="Array");let j=[],e=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=DE.c.audioEngine.audioContext.createMediaElementSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=DE.c.audioEngine.audioContext.createMediaStreamSource(E),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":E.byteLength>0&&(e=!0,this._soundLoaded(E));break;case"AudioBuffer":this._audioBufferLoaded(E);break;case"String":j.push(E);case"Array":0===j.length&&(j=E);for(let I=0;I<j.length;I++){const E=j[I];if(e=t&&t.skipCodecCheck||-1!==E.indexOf(".mp3",E.length-4)&&DE.c.audioEngine.isMP3supported||-1!==E.indexOf(".ogg",E.length-4)&&DE.c.audioEngine.isOGGsupported||-1!==E.indexOf(".wav",E.length-4)||-1!==E.indexOf(".m4a",E.length-4)||-1!==E.indexOf(".mp4",E.length-4)||-1!==E.indexOf("blob:"),e){this._streaming?(this._htmlAudioElement=new Audio(E),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,h.Tools.SetCorsBehavior(E,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(E,(I=>{this._soundLoaded(I)}),void 0,!0,!0,(I=>{I&&L.b.Error("XHR "+I.status+" error on: "+E+"."),L.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:I=!1}I?e||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):L.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(U){L.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),DE.c.audioEngine&&!DE.c.audioEngine.WarnedWebAudioUnsupported&&(L.b.Error("Web Audio is not supported by your browser."),DE.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var I;null!==(I=DE.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(I){var E;null!==(E=DE.c.audioEngine)&&void 0!==E&&E.audioContext&&(this._audioBuffer=I,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(I){var E;null!==(E=DE.c.audioEngine)&&void 0!==E&&E.audioContext&&DE.c.audioEngine.audioContext.decodeAudioData(I,(I=>{this._audioBufferLoaded(I)}),(I=>{L.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+I)}))}setAudioBuffer(I){var E;null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&(this._audioBuffer=I,this._isReadyToPlay=!0)}updateOptions(I){I&&(this.loop=I.loop??this.loop,this.maxDistance=I.maxDistance??this.maxDistance,this.useCustomAttenuation=I.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=I.rolloffFactor??this.rolloffFactor,this.refDistance=I.refDistance??this.refDistance,this.distanceModel=I.distanceModel??this.distanceModel,this._playbackRate=I.playbackRate??this._playbackRate,this._length=I.length??void 0,this.spatialSound=I.spatialSound??this._spatialSound,this._setOffset(I.offset??void 0),this.setVolume(I.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var I;null!==(I=DE.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&DE.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??DE.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var I;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(I=this._soundPanner)||void 0===I||I.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var I;null!==(I=DE.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(I){var E;null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(I),this._isOutputConnected=!0)}setDirectionalCone(I,E,j){E<I?L.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=I,this._coneOuterAngle=E,this._coneOuterGain=j,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!=this._coneInnerAngle){var E;if(this._coneOuterAngle<I)return void L.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I,null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!=this._coneOuterAngle){var E;if(I<this._coneInnerAngle)return void L.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I,null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(I){var E;I.equals(this._position)||(this._position.U(I),null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(I){var E;this._localDirection=I,null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const I=this._connectedTransformNode.getWorldMatrix(),E=w.LE.TransformNormal(this._localDirection,I);E.normalize(),this._soundPanner.orientationX.value=E.x,this._soundPanner.orientationY.value=E.y,this._soundPanner.orientationZ.value=E.z}updateDistanceFromListener(){var I;if(null!==(I=DE.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const I=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.FE(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,I,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(I){this._customAttenuationFunction=I}play(I,E,j){var e;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(e=DE.c.audioEngine)&&void 0!==e&&e.audioContext)try{var w,z;this._clearTimeoutsAndObservers();let e=I?(null===(w=DE.c.audioEngine)||void 0===w?void 0:w.audioContext.currentTime)+I:null===(z=DE.c.audioEngine)||void 0===z?void 0:z.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=DE.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const I=()=>{var j;if(null!==(j=DE.c.audioEngine)&&void 0!==j&&j.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=E??0;const j=this._htmlAudioElement.play();void 0!==j&&j.catch((()=>{var E,j;(null===(E=DE.c.audioEngine)||void 0===E||E.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(j=DE.c.audioEngine)||void 0===j?void 0:j.onAudioUnlockedObservable.addOnce((()=>{I()})))}))}else{var e;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(e=DE.c.audioEngine)||void 0===e?void 0:e.onAudioUnlockedObservable.addOnce((()=>{I()}))}};I()}}else{var h;const w=()=>{var w;if(null!==(w=DE.c.audioEngine)&&void 0!==w&&w.audioContext){var z;if(j=j||this._length,void 0!==E&&this._setOffset(E),this._soundSource){const I=this._soundSource;I.onended=()=>{I.disconnect()}}if(this._soundSource=null===(z=DE.c.audioEngine)||void 0===z?void 0:z.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var h;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==E&&(this._soundSource.loopStart=E),void 0!==j&&(this._soundSource.loopEnd=(0|E)+j),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},e=I?(null===(h=DE.c.audioEngine)||void 0===h?void 0:h.audioContext.currentTime)+I:DE.c.audioEngine.audioContext.currentTime;const w=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(e,w,this.loop?void 0:j)}}};"suspended"===(null===(h=DE.c.audioEngine)||void 0===h?void 0:h.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var I;"suspended"===(null===(I=DE.c.audioEngine)||void 0===I?void 0:I.audioContext.state)?(DE.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=DE.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{w()})))):w()}),500):w()}this._startTime=e,this.isPlaying=!0,this.isPaused=!1}catch(t){L.b.Error("Error while trying to play audio: "+this.name+", "+t.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(I){var E;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var j;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(j=this._streamingSource)||void 0===j||j.disconnect();this.isPlaying=!1}else if(null!==(E=DE.c.audioEngine)&&void 0!==E&&E.audioContext&&this._soundSource){const E=I?DE.c.audioEngine.audioContext.currentTime+I:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(E)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var I;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var E;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(E=this._streamingSource)||void 0===E||E.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(I=DE.c.audioEngine)&&void 0!==I&&I.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=DE.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(I,E){var j;null!==(j=DE.c.audioEngine)&&void 0!==j&&j.canUseWebAudio&&this._soundGain&&(E&&DE.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(DE.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,DE.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(I,DE.c.audioEngine.audioContext.currentTime+E)):this._soundGain.gain.value=I),this._volume=I}setPlaybackRate(I){this._playbackRate=I,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(I){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=I,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=I=>this._onRegisterAfterWorldMatrixUpdate(I),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(I){var E;if(I.getBoundingInfo){const E=I.getBoundingInfo();this.setPosition(E.boundingSphere.centerWorld)}else this.setPosition(I.absolutePosition);null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const I=()=>{(0,kE.c)((()=>this._isReadyToPlay),(()=>{j._audioBuffer=this.getAudioBuffer(),j._isReadyToPlay=!0,j.autoplay&&j.play(0,this._offset,this._length)}),void 0,300)},E={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},j=new JE(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,E);return this.useCustomAttenuation&&j.setAttenuationFunction(this._customAttenuationFunction),j.setPosition(this._position),j.setPlaybackRate(this._playbackRate),I(),j}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const I={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(I.connectedMeshId=this._connectedTransformNode.id),I.position=this._position.re(),I.refDistance=this.refDistance,I.distanceModel=this.distanceModel,I.isDirectional=this._isDirectional,I.localDirectionToMesh=this._localDirection.re(),I.coneInnerAngle=this._coneInnerAngle,I.coneOuterAngle=this._coneOuterAngle,I.coneOuterGain=this._coneOuterGain),I}static Parse(I,E,j,e){const z=I.name;let h;h=I.url?j+I.url:j+z;const t={autoplay:I.autoplay,loop:I.loop,volume:I.volume,spatialSound:I.spatialSound,maxDistance:I.maxDistance,rolloffFactor:I.rolloffFactor,refDistance:I.refDistance,distanceModel:I.distanceModel,playbackRate:I.playbackRate};let U;if(e){const I=()=>{(0,kE.c)((()=>e._isReadyToPlay),(()=>{U._audioBuffer=e.getAudioBuffer(),U._isReadyToPlay=!0,U.autoplay&&U.play(0,U._offset,U._length)}),void 0,300)};U=new JE(z,new ArrayBuffer(0),E,null,t),I()}else U=new JE(z,h,E,(()=>{E.removePendingData(U)}),t),E.addPendingData(U);if(I.position){const E=w.LE.xE(I.position);U.setPosition(E)}if(I.isDirectional&&(U.setDirectionalCone(I.coneInnerAngle||360,I.coneOuterAngle||360,I.coneOuterGain||0),I.localDirectionToMesh)){const E=w.LE.xE(I.localDirectionToMesh);U.setLocalDirectionToMesh(E)}if(I.connectedMeshId){const j=E.getMeshById(I.connectedMeshId);j&&U.attachToMesh(j)}return I.metadata&&(U.metadata=I.metadata),U}_setOffset(I){this._offset!==I&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=I)}_clearTimeoutsAndObservers(){var I;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(I=DE.c.audioEngine)||void 0===I||I.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}JE._SceneComponentInitialization=I=>{throw(0,pE.b)("AudioSceneComponent")},(0,bI.h)("BABYLON.Sound",JE);class NE{constructor(I,E,j){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],E.length!==j.length)throw new Error("Sounds length does not equal weights length");this.loop=I,this._weights=j;let e=0;for(const z of j)e+=z;const w=e>0?1/e:0;for(let z=0;z<this._weights.length;z++)this._weights[z]*=w;this._sounds=E;for(const z of this._sounds)z.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(I){if(I!==this._coneInnerAngle){if(this._coneOuterAngle<I)return void L.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=I;for(const E of this._sounds)E.directionalConeInnerAngle=I}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(I){if(I!==this._coneOuterAngle){if(I<this._coneInnerAngle)return void L.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=I;for(const E of this._sounds)E.directionalConeOuterAngle=I}}get volume(){return this._volume}set volume(I){if(I!==this._volume)for(const E of this._sounds)E.setVolume(I)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(I){if(!this.isPaused){this.stop();const I=Math.random();let E=0;for(let j=0;j<this._weights.length;j++)if(E+=this._weights[j],I<=E){this._currentIndex=j;break}}const E=this._sounds[this._currentIndex??0];E.isReady()?E.play(0,this.isPaused?void 0:I):E.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class mE{constructor(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(I=I||K.d.LastCreatedScene)&&(this._scene=I,this.soundCollection=[],this._options=E,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var I;null!==(I=DE.c.audioEngine)&&void 0!==I&&I.canUseWebAudio&&DE.c.audioEngine.audioContext&&(this._outputAudioNode=DE.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(DE.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(DE.c.audioEngine&&DE.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(I){var E;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&I.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==I.soundTrackId&&(-1===I.soundTrackId?this._scene.mainSoundTrack.removeSound(I):this._scene.soundTracks&&this._scene.soundTracks[I.soundTrackId].removeSound(I)),this.soundCollection.push(I),I.soundTrackId=this.id}removeSound(I){const E=this.soundCollection.indexOf(I);-1!==E&&this.soundCollection.splice(E,1)}setVolume(I){var E;null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=I)}switchPanningModelToHRTF(){var I;if(null!==(I=DE.c.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var I;if(null!==(I=DE.c.audioEngine)&&void 0!==I&&I.canUseWebAudio)for(let E=0;E<this.soundCollection.length;E++)this.soundCollection[E].switchPanningModelToEqualPower()}connectToAnalyser(I){var E;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=I,null!==(E=DE.c.audioEngine)&&void 0!==E&&E.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,DE.c.audioEngine.masterGain))}}var Ij=j(11389),Ej=j(11363),jj=j(10966);DE.c.AudioEngineFactory=(I,E,j)=>new ej(I,E,j);class ej{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new P.e,this.onAudioLockedObservable=new P.e,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,jj.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const e=document.createElement("audio");this._hostElement=I,this._audioContext=E,this._audioDestination=j;try{e&&e.canPlayType&&(e.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||e.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(w){}try{e&&e.canPlayType&&e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(w){}}lock(){this._triggerSuspendedState()}unlock(){var I,E;if("running"===(null===(I=this._audioContext)||void 0===I?void 0:I.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(E=this._audioContext)||void 0===E||E.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{L.b.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var I;null===(I=this._audioContext)||void 0===I||I.addEventListener("statechange",(()=>{var I;this.unlocked&&"running"!==(null===(I=this._audioContext)||void 0===I?void 0:I.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var I;return null!==(I=this._audioContext)&&void 0!==I&&I.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(I){this.canUseWebAudio=!1,L.b.Error("Web Audio: "+I.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(I){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const I=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",E=document.createElement("style");E.appendChild(document.createTextNode(I)),document.getElementsByTagName("head")[0].appendChild(E),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var I;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(I=this._audioContext)||void 0===I||I.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(I){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=I)}connectToAnalyser(I){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=I,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var wj=j(10983);(0,j(12495).e)(Ij.b.NAME_AUDIO,((I,E,j,e)=>{let w,z=[];if(j.sZ=j.sZ||[],void 0!==I.sZ&&null!==I.sZ)for(let t=0,U=I.sZ.length;t<U;t++){var h;const U=I.sZ[t];null!==(h=DE.c.audioEngine)&&void 0!==h&&h.canUseWebAudio?(U.url||(U.url=U.name),z[U.url]?j.sZ.push(JE.Parse(U,E,e,z[U.url])):(w=JE.Parse(U,E,e),z[U.url]=w,j.sZ.push(w))):j.sZ.push(new JE(U.name,null,E))}z=[]})),Object.defineProperty(Ej.c.prototype,"mainSoundTrack",{get:function(){let I=this._getComponent(Ij.b.NAME_AUDIO);return I||(I=new zj(this),this.o(I)),this._mainSoundTrack||(this._mainSoundTrack=new mE(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),Ej.c.prototype.getSoundByName=function(I){let E;for(E=0;E<this.mainSoundTrack.soundCollection.length;E++)if(this.mainSoundTrack.soundCollection[E].name===I)return this.mainSoundTrack.soundCollection[E];if(this.soundTracks)for(let j=0;j<this.soundTracks.length;j++)for(E=0;E<this.soundTracks[j].soundCollection.length;E++)if(this.soundTracks[j].soundCollection[E].name===I)return this.soundTracks[j].soundCollection[E];return null},Object.defineProperty(Ej.c.prototype,"audioEnabled",{get:function(){let I=this._getComponent(Ij.b.NAME_AUDIO);return I||(I=new zj(this),this.o(I)),I.audioEnabled},set:function(I){let E=this._getComponent(Ij.b.NAME_AUDIO);E||(E=new zj(this),this.o(E)),I?E.enableAudio():E.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(Ej.c.prototype,"headphone",{get:function(){let I=this._getComponent(Ij.b.NAME_AUDIO);return I||(I=new zj(this),this.o(I)),I.headphone},set:function(I){let E=this._getComponent(Ij.b.NAME_AUDIO);E||(E=new zj(this),this.o(E)),I?E.switchAudioModeForHeadphones():E.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(Ej.c.prototype,"audioListenerPositionProvider",{get:function(){let I=this._getComponent(Ij.b.NAME_AUDIO);return I||(I=new zj(this),this.o(I)),I.audioListenerPositionProvider},set:function(I){let E=this._getComponent(Ij.b.NAME_AUDIO);if(E||(E=new zj(this),this.o(E)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");E.audioListenerPositionProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(Ej.c.prototype,"audioListenerRotationProvider",{get:function(){let I=this._getComponent(Ij.b.NAME_AUDIO);return I||(I=new zj(this),this.o(I)),I.audioListenerRotationProvider},set:function(I){let E=this._getComponent(Ij.b.NAME_AUDIO);if(E||(E=new zj(this),this.o(E)),I&&"function"!==typeof I)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");E.audioListenerRotationProvider=I},enumerable:!0,configurable:!0}),Object.defineProperty(Ej.c.prototype,"audioPositioningRefreshRate",{get:function(){let I=this._getComponent(Ij.b.NAME_AUDIO);return I||(I=new zj(this),this.o(I)),I.audioPositioningRefreshRate},set:function(I){let E=this._getComponent(Ij.b.NAME_AUDIO);E||(E=new zj(this),this.o(E)),E.audioPositioningRefreshRate=I},enumerable:!0,configurable:!0});class zj{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(I){this.name=Ij.b.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new w.LE,this._cachedCameraPosition=new w.LE,this._lastCheck=0,this._invertMatrixTemp=new w.Matrix,this._cameraDirectionTemp=new w.LE,(I=I||K.d.LastCreatedScene)&&(this.CE=I,I.soundTracks=[],I.sZ=[])}register(){this.CE._afterRenderStage.registerStep(Ij.b.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(I){if(I.sZ=[],this.CE.soundTracks)for(let E=0;E<this.CE.soundTracks.length;E++){const j=this.CE.soundTracks[E];for(let E=0;E<j.soundCollection.length;E++)I.sZ.push(j.soundCollection[E].serialize())}}addFromContainer(I){if(I.sZ)for(const E of I.sZ)E.play(),E.autoplay=!0,this.CE.mainSoundTrack.addSound(E)}removeFromContainer(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(I.sZ)for(const j of I.sZ)j.stop(),j.autoplay=!1,this.CE.mainSoundTrack.removeSound(j),E&&j.dispose()}dispose(){const I=this.CE;if(I._mainSoundTrack&&I.mainSoundTrack.dispose(),I.soundTracks)for(let E=0;E<I.soundTracks.length;E++)I.soundTracks[E].dispose()}disableAudio(){const I=this.CE;let E;for(this._audioEnabled=!1,DE.c.audioEngine&&DE.c.audioEngine.audioContext&&DE.c.audioEngine.audioContext.suspend(),E=0;E<I.mainSoundTrack.soundCollection.length;E++)I.mainSoundTrack.soundCollection[E].pause();if(I.soundTracks)for(E=0;E<I.soundTracks.length;E++)for(let j=0;j<I.soundTracks[E].soundCollection.length;j++)I.soundTracks[E].soundCollection[j].pause()}enableAudio(){const I=this.CE;let E;for(this._audioEnabled=!0,DE.c.audioEngine&&DE.c.audioEngine.audioContext&&DE.c.audioEngine.audioContext.resume(),E=0;E<I.mainSoundTrack.soundCollection.length;E++)I.mainSoundTrack.soundCollection[E].isPaused&&I.mainSoundTrack.soundCollection[E].play();if(I.soundTracks)for(E=0;E<I.soundTracks.length;E++)for(let j=0;j<I.soundTracks[E].soundCollection.length;j++)I.soundTracks[E].soundCollection[j].isPaused&&I.soundTracks[E].soundCollection[j].play()}switchAudioModeForHeadphones(){const I=this.CE;if(this._headphone=!0,I.mainSoundTrack.switchPanningModelToHRTF(),I.soundTracks)for(let E=0;E<I.soundTracks.length;E++)I.soundTracks[E].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const I=this.CE;if(this._headphone=!1,I.mainSoundTrack.switchPanningModelToEqualPower(),I.soundTracks)for(let E=0;E<I.soundTracks.length;E++)I.soundTracks[E].switchPanningModelToEqualPower()}_afterRender(){const I=wj.e.Now;if(this._lastCheck&&I-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=I;const E=this.CE;if(!this._audioEnabled||!E._mainSoundTrack||!E.soundTracks||0===E._mainSoundTrack.soundCollection.length&&1===E.soundTracks.length)return;const j=DE.c.audioEngine;if(j&&j.audioContext){let I,e=E.activeCamera;if(E.activeCameras&&E.activeCameras.length>0&&(e=E.activeCameras[0]),this.audioListenerPositionProvider){const I=this.audioListenerPositionProvider();j.audioContext.listener.setPosition(I.x||0,I.y||0,I.z||0)}else e?this._cachedCameraPosition.equals(e.globalPosition)||(this._cachedCameraPosition.U(e.globalPosition),j.audioContext.listener.setPosition(e.globalPosition.x,e.globalPosition.y,e.globalPosition.z)):j.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const I=this.audioListenerRotationProvider();j.audioContext.listener.setOrientation(I.x||0,I.y||0,I.z||0,0,1,0)}else e?(e.rigCameras&&e.rigCameras.length>0&&(e=e.rigCameras[0]),e.getViewMatrix().invertToRef(this._invertMatrixTemp),w.LE.TransformNormalToRef(zj._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.U(this._cameraDirectionTemp),j.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):j.audioContext.listener.setOrientation(0,0,0,0,1,0);for(I=0;I<E.mainSoundTrack.soundCollection.length;I++){const j=E.mainSoundTrack.soundCollection[I];j.useCustomAttenuation&&j.updateDistanceFromListener()}if(E.soundTracks)for(I=0;I<E.soundTracks.length;I++)for(let j=0;j<E.soundTracks[I].soundCollection.length;j++){const e=E.soundTracks[I].soundCollection[j];e.useCustomAttenuation&&e.updateDistanceFromListener()}}}}zj._CameraDirection=new w.LE(0,0,-1),JE._SceneComponentInitialization=I=>{let E=I._getComponent(Ij.b.NAME_AUDIO);E||(E=new zj(I),I.o(E))};const hj="MSFT_audio_emitter";class tj{constructor(I){this.name=hj,this._loader=I,this.enabled=this._loader.isExtensionUsed(hj)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const I=this._loader.de.extensions;if(I&&I[this.name]){const E=I[this.name];this._clips=E.clips,this._emitters=E.emitters,s.Assign(this._clips),s.Assign(this._emitters)}}loadSceneAsync(I,E){return V.LoadExtensionAsync(I,E,this.name,(async(j,e)=>{const w=new Array;w.push(this._loader.loadSceneAsync(I,E));for(const I of e.emitters){const E=s.Get(`${j}/emitters`,this._emitters,I);if(void 0!=E.refDistance||void 0!=E.maxDistance||void 0!=E.rolloffFactor||void 0!=E.distanceModel||void 0!=E.innerAngle||void 0!=E.outerAngle)throw new Error(`${j}: Direction or Distance properties are not allowed on emitters attached to a scene`);w.push(this._loadEmitterAsync(`${j}/emitters/${E.index}`,E))}await Promise.all(w)}))}loadNodeAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(I,e)=>{const z=new Array,t=await this._loader.loadNodeAsync(I,E,(E=>{for(const j of e.emitters){const e=s.Get(`${I}/emitters`,this._emitters,j);z.push(this._loadEmitterAsync(`${I}/emitters/${e.index}`,e).then((()=>{for(const I of e._babylonSounds)I.attachToMesh(E),void 0==e.innerAngle&&void 0==e.outerAngle||(I.setLocalDirectionToMesh(w.LE.Forward()),I.setDirectionalCone(2*h.Tools.ToDegrees(void 0==e.innerAngle?Math.PI:e.innerAngle),2*h.Tools.ToDegrees(void 0==e.outerAngle?Math.PI:e.outerAngle),0))})))}j(E)}));return await Promise.all(z),t}))}loadAnimationAsync(I,E){return V.LoadExtensionAsync(I,E,this.name,(async(j,e)=>{const w=await this._loader.loadAnimationAsync(I,E),z=new Array;s.Assign(e.events);for(const h of e.events)z.push(this._loadAnimationEventAsync(`${j}/events/${h.index}`,I,E,h,w));return await Promise.all(z),w}))}_loadClipAsync(I,E){if(E._objectURL)return E._objectURL;let j;if(E.uri)j=this._loader.loadUriAsync(I,E,E.uri);else{const e=s.Get(`${I}/bufferView`,this._loader.de.bufferViews,E.bufferView);j=this._loader.loadBufferViewAsync(`/bufferViews/${e.index}`,e)}return E._objectURL=j.then((I=>URL.createObjectURL(new Blob([I],{type:E.mimeType})))),E._objectURL}_loadEmitterAsync(I,E){if(E._babylonSounds=E._babylonSounds||[],!E._babylonData){const I=new Array,j=E.name||`emitter${E.index}`,e={loop:!1,autoplay:!1,volume:void 0==E.volume?1:E.volume};for(let z=0;z<E.clips.length;z++){const w=`/extensions/${this.name}/clips`,h=s.Get(w,this._clips,E.clips[z].clip);I.push(this._loadClipAsync(`${w}/${E.clips[z].clip}`,h).then((I=>{const w=E._babylonSounds[z]=new JE(j,I,this._loader.babylonScene,null,e);w.refDistance=E.refDistance||1,w.maxDistance=E.maxDistance||256,w.rolloffFactor=E.rolloffFactor||1,w.distanceModel=E.distanceModel||"exponential"})))}const w=Promise.all(I).then((()=>{const I=E.clips.map((I=>I.weight||1)),j=new NE(E.loop||!1,E._babylonSounds,I);E.innerAngle&&(j.directionalConeInnerAngle=2*h.Tools.ToDegrees(E.innerAngle)),E.outerAngle&&(j.directionalConeOuterAngle=2*h.Tools.ToDegrees(E.outerAngle)),E.volume&&(j.volume=E.volume),E._babylonData.sound=j}));E._babylonData={loaded:w}}return E._babylonData.loaded}_getEventAction(I,E,j,e,w){switch(j){case"play":return I=>{const j=(w||0)+(I-e);E.play(j)};case"stop":return()=>{E.stop()};case"pause":return()=>{E.pause()};default:throw new Error(`${I}: Unsupported action ${j}`)}}_loadAnimationEventAsync(I,E,j,e,w){if(0==w.targetedAnimations.length)return Promise.resolve();const z=w.targetedAnimations[0],h=e.wE,t=s.Get(`/extensions/${this.name}/emitters`,this._emitters,h);return this._loadEmitterAsync(I,t).then((()=>{const E=t._babylonData.sound;if(E){const j=new BE(e.time,this._getEventAction(I,E,e.action,e.time,e.startOffset));z.animation.addEvent(j),w.onAnimationGroupEndObservable.add((()=>{E.stop()})),w.onAnimationGroupPauseObservable.add((()=>{E.pause()}))}}))}}T(hj),A(hj,!0,(I=>new tj(I)));const Uj="MSFT_lod";class Rj{constructor(I){var E;this.name=Uj,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new P.e,this.onMaterialLODsLoadedObservable=new P.e,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=I,this.maxLODsToLoad=(null===(E=this._loader.parent.extensionOptions[Uj])||void 0===E?void 0:E.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Uj)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let I=0;I<this._nodePromiseLODs.length;I++){const E=Promise.all(this._nodePromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Node LOD ${I}`),this._loader.log(`Loaded node LOD ${I}`)),this.onNodeLODsLoadedObservable.notifyObservers(I),I!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${I+1}`),this._loadBufferLOD(this._nodeBufferLODs,I+1),this._nodeSignalLODs[I]&&this._nodeSignalLODs[I].resolve())}));this._loader._completePromises.push(E)}for(let I=0;I<this._materialPromiseLODs.length;I++){const E=Promise.all(this._materialPromiseLODs[I]).then((()=>{0!==I&&(this._loader.endPerformanceCounter(`Material LOD ${I}`),this._loader.log(`Loaded material LOD ${I}`)),this.onMaterialLODsLoadedObservable.notifyObservers(I),I!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${I+1}`),this._loadBufferLOD(this._materialBufferLODs,I+1),this._materialSignalLODs[I]&&this._materialSignalLODs[I].resolve())}));this._loader._completePromises.push(E)}}loadSceneAsync(I,E){const j=this._loader.loadSceneAsync(I,E);return this._loadBufferLOD(this._bufferLODs,0),j}loadNodeAsync(I,E,j){return V.LoadExtensionAsync(I,E,this.name,(async(I,w)=>{let z;const h=this._getLODs(I,E,this._loader.de.nodes,w.ids);this._loader.logOpen(`${I}`);for(let E=0;E<h.length;E++){const I=h[E];0!==E&&(this._nodeIndexLOD=E,this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new e);const w=I=>{j(I),I.IU(!1)},t=this._loader.loadNodeAsync(`/nodes/${I.index}`,I,w).then((I=>{if(0!==E){const I=h[E-1];I._babylonTransformNode&&(this._disposeTransformNode(I._babylonTransformNode),delete I._babylonTransformNode)}return I.IU(!0),I}));this._nodePromiseLODs[E]=this._nodePromiseLODs[E]||[],0===E?z=t:(this._nodeIndexLOD=null,this._nodePromiseLODs[E].push(t))}return this._loader.logClose(),await z}))}_loadMaterialAsync(I,E,j,e,w){return this._nodeIndexLOD?null:V.LoadExtensionAsync(I,E,this.name,(async(I,z)=>{let h;const t=this._getLODs(I,E,this._loader.de.materials,z.ids);this._loader.logOpen(`${I}`);for(let E=0;E<t.length;E++){const I=t[E];0!==E&&(this._materialIndexLOD=E);const z=this._loader._loadMaterialAsync(`/materials/${I.index}`,I,j,e,(I=>{0===E&&w(I)})).then((I=>{if(0!==E){w(I);const j=t[E-1]._data;j[e]&&(this._disposeMaterials([j[e].babylonMaterial]),delete j[e])}return I}));this._materialPromiseLODs[E]=this._materialPromiseLODs[E]||[],0===E?h=z:(this._materialIndexLOD=null,this._materialPromiseLODs[E].push(z))}return this._loader.logClose(),await h}))}_loadUriAsync(I,E,j){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const w=this._nodeIndexLOD-1;return this._nodeSignalLODs[w]=this._nodeSignalLODs[w]||new e,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(I,E,j)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const w=this._materialIndexLOD-1;return this._materialSignalLODs[w]=this._materialSignalLODs[w]||new e,this._materialSignalLODs[w].promise.then((async()=>await this._loader.loadUriAsync(I,E,j)))}return null}loadBufferAsync(I,E,j,w){if(this._loader.parent.useRangeRequests&&!E.uri){if(!this._loader.bin)throw new Error(`${I}: Uri is missing or the binary glTF is missing its binary chunk`);const E=async(I,E)=>{const z=j,h=z+w-1;let t=I[E];return t?(t.start=Math.min(t.start,z),t.end=Math.max(t.end,h)):(t={start:z,end:h,loaded:new e},I[E]=t),await t.loaded.promise.then((I=>new Uint8Array(I.buffer,I.byteOffset+j-t.start,w)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?E(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?E(this._materialBufferLODs,this._materialIndexLOD):E(this._bufferLODs,0)}return null}_loadBufferLOD(I,E){const j=I[E];j&&(this._loader.log(`Loading buffer range [${j.start}-${j.end}]`),this._loader.bin.readAsync(j.start,j.end-j.start+1).then((I=>{j.loaded.resolve(I)}),(I=>{j.loaded.reject(I)})))}_getLODs(I,E,j,e){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const w=[];for(let z=e.length-1;z>=0;z--)if(w.push(s.Get(`${I}/ids/${e[z]}`,j,e[z])),w.length===this.maxLODsToLoad)return w;return w.push(E),w}_disposeTransformNode(I){const E=[],j=I.material;j&&E.push(j);for(const w of I.getChildMeshes())w.material&&E.push(w.material);I.dispose();const e=E.filter((I=>this._loader.babylonScene.meshes.every((E=>E.material!=I))));this._disposeMaterials(e)}_disposeMaterials(I){const E={};for(const j of I){for(const I of j.getActiveTextures())E[I.uniqueId]=I;j.dispose()}for(const j in E)for(const I of this._loader.babylonScene.materials)I.hasTexture(E[j])&&delete E[j];for(const j in E)E[j].dispose()}}T(Uj),A(Uj,!0,(I=>new Rj(I)));const Pj="MSFT_minecraftMesh";class oj{constructor(I){this.name=Pj,this._loader=I,this.enabled=this._loader.isExtensionUsed(Pj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtraAsync(I,E,this.name,(async(e,w)=>{if(w){if(!(j instanceof q.d))throw new Error(`${e}: Material type not supported`);const w=this._loader.loadMaterialPropertiesAsync(I,E,j);return j.needAlphaBlending()&&(j.forceDepthWrite=!0,j.separateCullingPass=!0),j.tz=j.forceDepthWrite,j.twoSidedLighting=!0,await w}}))}}T(Pj),A(Pj,!0,(I=>new oj(I)));const Zj="MSFT_sRGBFactors";class cj{constructor(I){this.name=Zj,this._loader=I,this.enabled=this._loader.isExtensionUsed(Zj)}dispose(){this._loader=null}loadMaterialPropertiesAsync(I,E,j){return V.LoadExtraAsync(I,E,this.name,(async(e,w)=>{if(w){if(!(j instanceof q.d))throw new Error(`${e}: Material type not supported`);const w=this._loader.loadMaterialPropertiesAsync(I,E,j),z=j.GI().getEngine().useExactSrgbConversions;return j.albedoTexture||j.albedoColor.toLinearSpaceToRef(j.albedoColor,z),j.reflectivityTexture||j.reflectivityColor.toLinearSpaceToRef(j.reflectivityColor,z),await w}}))}}T(Zj),A(Zj,!0,(I=>new cj(I)));var Kj=j(12795);const Lj={};var Fj=j(12846),Cj=j(12829),Xj=j(12804),qj=j(12819);function xj(I,E){for(const j of I)for(const I of j.dataOutputs)if(I.uniqueId===E)return I;throw new Error("Could not find data out connection with unique id "+E)}function uj(I,E){for(const j of I)if(j instanceof Cj.e)for(const I of j.signalInputs)if(I.uniqueId===E)return I;throw new Error("Could not find signal in connection with unique id "+E)}async function bj(I,E){const e=await Promise.all(I.allBlocks.map((async I=>{const E=function(I){switch(I){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([j.e(78),j.e(79)]).then(j.bind(j,14292))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await j.e(80).then(j.bind(j,14296))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await j.e(81).then(j.bind(j,14302))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await j.e(82).then(j.bind(j,14307))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await j.e(83).then(j.bind(j,14310))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await j.e(84).then(j.bind(j,14319))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await j.e(85).then(j.bind(j,14326))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await j.e(86).then(j.bind(j,14332))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await j.e(87).then(j.bind(j,14334))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await j.e(90).then(j.bind(j,14373))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await j.e(90).then(j.bind(j,14373))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await j.e(90).then(j.bind(j,14373))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await j.e(90).then(j.bind(j,14373))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await j.e(95).then(j.bind(j,14378))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await j.e(96).then(j.bind(j,14386))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await j.e(97).then(j.bind(j,14391))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await j.e(98).then(j.bind(j,14398))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await j.e(99).then(j.bind(j,14406))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await j.e(100).then(j.bind(j,14408))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await j.e(101).then(j.bind(j,14417))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await j.e(102).then(j.bind(j,14419))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await j.e(103).then(j.bind(j,14427))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await j.e(104).then(j.bind(j,14432))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await j.e(105).then(j.bind(j,14438))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await j.e(106).then(j.bind(j,14441))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await j.e(107).then(j.bind(j,14443))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await j.e(108).then(j.bind(j,14450))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await j.e(109).then(j.bind(j,14457))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await j.e(110).then(j.bind(j,14459))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await j.e(111).then(j.bind(j,14461))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await j.e(112).then(j.bind(j,14463))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await j.e(113).then(j.bind(j,14469))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await j.e(92).then(j.bind(j,14473))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await j.e(114).then(j.bind(j,14482))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await j.e(115).then(j.bind(j,14488))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await j.e(116).then(j.bind(j,14493))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await j.e(93).then(j.bind(j,14501))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await j.e(88).then(j.bind(j,14340))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await j.e(94).then(j.bind(j,14508))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await j.e(89).then(j.bind(j,14366))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await j.e(90).then(j.bind(j,14373))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await j.e(90).then(j.bind(j,14373))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await j.e(91).then(j.bind(j,14510))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await j.e(91).then(j.bind(j,14510))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await j.e(91).then(j.bind(j,14510))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await j.e(91).then(j.bind(j,14510))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await j.e(91).then(j.bind(j,14510))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await j.e(91).then(j.bind(j,14510))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await j.e(117).then(j.bind(j,14512))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await j.e(118).then(j.bind(j,14520))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await j.e(119).then(j.bind(j,14522))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await j.e(120).then(j.bind(j,14524))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await j.e(121).then(j.bind(j,14531))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await j.e(122).then(j.bind(j,14538))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await j.e(123).then(j.bind(j,14543))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await j.e(124).then(j.bind(j,14549))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await j.e(125).then(j.bind(j,14551))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await j.e(126).then(j.bind(j,14557))).FlowGraphDataSwitchBlock;default:if(Lj[I])return Lj[I];throw new Error(`Unknown block name ${I}`)}}(I.className);return await E()})));return function(I,E,j){const e=E.coordinator.createGraph(),w=[],z=E.valueParseFunction??Xj.e;for(let h=0;h<I.allBlocks.length;h++){const t=Gj(I.allBlocks[h],{CE:E.coordinator.config.CE,pathConverter:E.pathConverter,assetsContainer:E.coordinator.config.CE,valueParseFunction:z},j[h]);w.push(t),t instanceof Fj.c&&e.addEventBlock(t)}for(const h of w){for(const I of h.dataInputs)for(const E of I.connectedPointIds){const j=xj(w,E);I.connectTo(j)}if(h instanceof Cj.e)for(const I of h.signalOutputs)for(const E of I.connectedPointIds){const j=uj(w,E);I.connectTo(j)}}for(const h of I.executionContexts)Qj(h,{graph:e,valueParseFunction:z},I.rightHanded);return e}(I,E,e)}function Qj(I,E,j){const e=E.graph.createContext();I.enableLogging&&(e.enableLogging=!0),e.treatDataAsRightHanded=j||!1;const w=E.valueParseFunction??Xj.e;e.uniqueId=I.uniqueId;const z=e.GI();if(I._assetsContext){var h,t,U,R,P,o,Z,c,K,L;const E=I._assetsContext,j={meshes:null===(h=E.meshes)||void 0===h?void 0:h.map((I=>z.getMeshById(I))),lights:null===(t=E.lights)||void 0===t?void 0:t.map((I=>z.getLightByName(I))),cameras:null===(U=E.cameras)||void 0===U?void 0:U.map((I=>z.getCameraByName(I))),materials:null===(R=E.materials)||void 0===R?void 0:R.map((I=>z.getMaterialById(I))),textures:null===(P=E.textures)||void 0===P?void 0:P.map((I=>z.getTextureByName(I))),animations:null===(o=E.animations)||void 0===o?void 0:o.map((I=>z.animations.find((E=>E.name===I)))),skeletons:null===(Z=E.skeletons)||void 0===Z?void 0:Z.map((I=>z.getSkeletonByName(I))),hZ:null===(c=E.hZ)||void 0===c?void 0:c.map((I=>z.getParticleSystemById(I))),animationGroups:null===(K=E.animationGroups)||void 0===K?void 0:K.map((I=>z.getAnimationGroupByName(I))),transformNodes:null===(L=E.transformNodes)||void 0===L?void 0:L.map((I=>z.getTransformNodeById(I))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],sZ:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};e.assetsContext=j}for(const F in I._userVariables){const E=w(F,I._userVariables,e.assetsContext,z);e.userVariables[F]=E}for(const F in I._connectionValues){const E=w(F,I._connectionValues,e.assetsContext,z);e._setConnectionValueByKey(F,E)}return e}function Gj(I,E,j){const e={},w=E.valueParseFunction??Xj.e;if(I.config)for(const h in I.config)e[h]=w(h,I.config,E.assetsContainer||E.CE,E.CE);if((0,Xj.j)(I.className)){if(!E.pathConverter)throw new Error("Path converter is required for this block");e.pathConverter=E.pathConverter}const z=new j(e);z.uniqueId=I.uniqueId;for(let h=0;h<I.dataInputs.length;h++){const E=z.getDataInput(I.dataInputs[h].name);if(!E)throw new Error("Could not find data input with name "+I.dataInputs[h].name+" in block "+I.className);E.deserialize(I.dataInputs[h])}for(let h=0;h<I.dataOutputs.length;h++){const E=z.getDataOutput(I.dataOutputs[h].name);if(!E)throw new Error("Could not find data output with name "+I.dataOutputs[h].name+" in block "+I.className);E.deserialize(I.dataOutputs[h])}return z.metadata=I.metadata,z.deserialize&&z.deserialize(I),z}function yj(I){const[E,j]=I.split(":");return dj({op:E,extension:j})}function dj(I){var E;let j=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=I.extension?null===(E=lj[I.extension])||void 0===E?void 0:E[I.op]:ij[I.op];if(!e&&(L.b.Warn(`No mapping found for operation ${I.op} and extension ${I.extension||"KHR_interactivity"}`),j)){const E={},j={flows:{}};if(I.inputValueSockets){E.values={};for(const j in I.inputValueSockets)E.values[j]={name:j}}return I.outputValueSockets&&(j.values={},Object.keys(I.outputValueSockets).forEach((I=>{j.values[I]={name:I}}))),{bP:[],inputs:E,outputs:j}}return e}function aj(I,E,j){lj[E]||(lj[E]={}),lj[E][I]=j}const lj={BABYLON:{"flow/log":{bP:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},ij={"event/onStart":{bP:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{bP:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{bP:["FlowGraphSendCustomEventBlock"],extraProcessor(I,E,j,e,w){if("event/send"!==E.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=I.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const h=e.arrays.events[z],t=w[0];return t.config||(t.config={}),t.config.eventId=h.eventId,t.config.eventData=h.eventData,w}},"event/receive":{bP:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(I,E){var j;if(!I.configuration)return L.b.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const e=I.configuration.event;if(!e)return L.b.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const w=e.value[0];if("number"!==typeof w)return L.b.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(j=E.events)||void 0===j?void 0:j[w])?{valid:!0}:(L.b.Error(`Event with id ${w} not found`),{valid:!1,error:`Event with id ${w} not found`})},extraProcessor(I,E,j,e,w){if("event/receive"!==E.op||!I.configuration||1!==Object.keys(I.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const z=I.configuration.event.value[0];if("number"!==typeof z)throw new Error("Event id should be a number");const h=e.arrays.events[z],t=w[0];return t.config||(t.config={}),t.config.eventId=h.eventId,t.config.eventData=h.eventData,w}},"math/e":rj("FlowGraphEBlock"),"math/pi":rj("FlowGraphPIBlock"),"math/inf":rj("FlowGraphInfBlock"),"math/nan":rj("FlowGraphNaNBlock"),"math/abs":rj("FlowGraphAbsBlock"),"math/sign":rj("FlowGraphSignBlock"),"math/trunc":rj("FlowGraphTruncBlock"),"math/floor":rj("FlowGraphFloorBlock"),"math/ceil":rj("FlowGraphCeilBlock"),"math/round":{bP:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w){var z;return(z=w[0]).config||(z.config={}),w[0].config.roundHalfAwayFromZero=!0,w}},"math/fract":rj("FlowGraphFractBlock"),"math/neg":rj("FlowGraphNegationBlock"),"math/add":rj("FlowGraphAddBlock",["a","b"],!0),"math/sub":rj("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{bP:["FlowGraphMultiplyBlock"],extraProcessor(I,E,j,e,w){var z;(z=w[0]).config||(z.config={}),w[0].config.useMatrixPerComponent=!0,w[0].config.preventIntegerFloatArithmetic=!0;let h=-1;return Object.keys(I.values||{}).find((E=>{var j;return void 0!==(null===(j=I.values)||void 0===j?void 0:j[E].type)&&(h=I.values[E].type,!0)})),-1!==h&&(w[0].config.type=e.arrays.types[h].flowGraphType),w},validation:I=>I.values?nj(I):{valid:!0}},"math/div":rj("FlowGraphDivideBlock",["a","b"],!0),"math/rem":rj("FlowGraphModuloBlock",["a","b"]),"math/min":rj("FlowGraphMinBlock",["a","b"]),"math/max":rj("FlowGraphMaxBlock",["a","b"]),"math/clamp":rj("FlowGraphClampBlock",["a","b","c"]),"math/saturate":rj("FlowGraphSaturateBlock"),"math/mix":rj("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":rj("FlowGraphEqualityBlock",["a","b"]),"math/lt":rj("FlowGraphLessThanBlock",["a","b"]),"math/le":rj("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":rj("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":rj("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":rj("FlowGraphIsNaNBlock"),"math/isinf":rj("FlowGraphIsInfBlock"),"math/select":{bP:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{bP:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":rj("FlowGraphSinBlock"),"math/cos":rj("FlowGraphCosBlock"),"math/tan":rj("FlowGraphTanBlock"),"math/asin":rj("FlowGraphASinBlock"),"math/acos":rj("FlowGraphACosBlock"),"math/atan":rj("FlowGraphATanBlock"),"math/atan2":rj("FlowGraphATan2Block",["a","b"]),"math/sinh":rj("FlowGraphSinhBlock"),"math/cosh":rj("FlowGraphCoshBlock"),"math/tanh":rj("FlowGraphTanhBlock"),"math/asinh":rj("FlowGraphASinhBlock"),"math/acosh":rj("FlowGraphACoshBlock"),"math/atanh":rj("FlowGraphATanhBlock"),"math/exp":rj("FlowGraphExponentialBlock"),"math/log":rj("FlowGraphLogBlock"),"math/log2":rj("FlowGraphLog2Block"),"math/log10":rj("FlowGraphLog10Block"),"math/sqrt":rj("FlowGraphSquareRootBlock"),"math/cbrt":rj("FlowGraphCubeRootBlock"),"math/pow":rj("FlowGraphPowerBlock",["a","b"]),"math/length":rj("FlowGraphLengthBlock"),"math/normalize":rj("FlowGraphNormalizeBlock"),"math/dot":rj("FlowGraphDotBlock",["a","b"]),"math/cross":rj("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":rj("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":rj("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{bP:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{bP:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{bP:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{bP:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{bP:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{bP:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{bP:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":rj("FlowGraphTransposeBlock"),"math/determinant":rj("FlowGraphDeterminantBlock"),"math/inverse":rj("FlowGraphInvertMatrixBlock"),"math/matmul":rj("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{bP:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"pz",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w,z){const h=w[0].dataInputs.find((I=>"rotationQuaternion"===I.name));if(!h)throw new Error("Rotation quaternion input not found");return z._connectionValues[h.uniqueId]&&(z._connectionValues[h.uniqueId].type="Quaternion"),w}},"math/matDecompose":{bP:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"pz"}}}},"math/quatConjugate":rj("FlowGraphConjugateBlock",["a"]),"math/quatMul":{bP:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w){var z;return(z=w[0]).config||(z.config={}),w[0].config.type="Quaternion",w}},"math/quatAngleBetween":rj("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{bP:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":rj("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":rj("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{bP:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w){var z;return(z=w[0]).config||(z.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract2x2":{bP:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{bP:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w){var z;return(z=w[0]).config||(z.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract3x3":{bP:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{bP:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w){var z;return(z=w[0]).config||(z.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract4x4":{bP:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{bP:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w,z){var h,t;(t=w[0]).config||(t.config={});const U=w[0].dataInputs[0];return w[0].config.valueType=(null===(h=z._connectionValues[U.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",w}},"math/and":{bP:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w,z){var h,t,U;(U=w[0]).config||(U.config={});const R=w[0].dataInputs[0],P=w[0].dataInputs[1];return w[0].config.valueType=(null===(h=z._connectionValues[R.uniqueId])||void 0===h?void 0:h.type)??(null===(t=z._connectionValues[P.uniqueId])||void 0===t?void 0:t.type)??"FlowGraphInteger",w}},"math/or":{bP:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w,z){var h,t,U;(U=w[0]).config||(U.config={});const R=w[0].dataInputs[0],P=w[0].dataInputs[1];return w[0].config.valueType=(null===(h=z._connectionValues[R.uniqueId])||void 0===h?void 0:h.type)??(null===(t=z._connectionValues[P.uniqueId])||void 0===t?void 0:t.type)??"FlowGraphInteger",w}},"math/xor":{bP:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(I,E,j,e,w,z){var h,t,U;(U=w[0]).config||(U.config={});const R=w[0].dataInputs[0],P=w[0].dataInputs[1];return w[0].config.valueType=(null===(h=z._connectionValues[R.uniqueId])||void 0===h?void 0:h.type)??(null===(t=z._connectionValues[P.uniqueId])||void 0===t?void 0:t.type)??"FlowGraphInteger",w}},"math/asr":rj("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":rj("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":rj("FlowGraphLeadingZerosBlock"),"math/ctz":rj("FlowGraphTrailingZerosBlock"),"math/popcnt":rj("FlowGraphOneBitsCounterBlock"),"math/rad":rj("FlowGraphDegToRadBlock"),"math/deg":rj("FlowGraphRadToDegBlock"),"type/boolToInt":rj("FlowGraphBooleanToInt"),"type/boolToFloat":rj("FlowGraphBooleanToFloat"),"type/intToBool":rj("FlowGraphIntToBoolean"),"type/intToFloat":rj("FlowGraphIntToFloat"),"type/floatToInt":rj("FlowGraphFloatToInt"),"type/floatToBool":rj("FlowGraphFloatToBoolean"),"flow/sequence":{bP:["FlowGraphSequenceBlock"],extraProcessor(I,E,j,e,w){const z=w[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(I.flows||[]).length,z.signalOutputs.forEach(((I,E)=>{I.name="out_"+E})),w}},"flow/branch":{bP:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{bP:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(I){if(I.configuration&&I.configuration.cases){const E=I.configuration.cases.value;if(!E.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return L.b.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const j=new Set(E);I.configuration.cases.value=Array.from(j)}return{valid:!0}},extraProcessor(I,E,j,e,w){if("flow/switch"!==E.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return w[0].signalOutputs.forEach((I=>{"default"!==I.name&&(I.name="out_"+I.name)})),w}},"flow/while":{bP:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{bP:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(I,E,j,e,w){const z=w[0];return z.config||(z.config={}),z.config.incrementIndexWhenLoopDone=!0,w}},"flow/doN":{bP:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{bP:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(I,E,j,e,w){if("flow/multiGate"!==E.op||!I.flows||0===Object.keys(I.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const z=w[0];return z.config||(z.config={}),z.config.outputSignalCount=Object.keys(I.flows).length,z.signalOutputs.forEach(((I,E)=>{I.name="out_"+E})),w}},"flow/waitAll":{bP:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(I){var E,j;return"number"!==typeof(null===(E=I.configuration)||void 0===E||null===(j=E.inputFlows)||void 0===j?void 0:j.value[0])&&(I.configuration=I.configuration||{inputFlows:{value:[0]}},I.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{bP:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{bP:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{bP:["FlowGraphCancelDelayBlock"]},"variable/get":{bP:["FlowGraphGetVariableBlock"],validation(I){var E,j;return null!==(E=I.configuration)&&void 0!==E&&null!==(j=E.variable)&&void 0!==j&&j.value?{valid:!0}:(L.b.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,E)=>[E.getVariableName(I[0])]}}},"variable/set":{bP:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(I,E)=>[E.getVariableName(I[0])]}}},"variable/setMultiple":{bP:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(I,E)=>[I[0].map((I=>E.getVariableName(I)))]}},extraProcessor:(I,E,j,e,w)=>(w[0].dataInputs.forEach((I=>{I.name=e.getVariableName(+I.name)})),w)},"variable/interpolate":{bP:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(I,E)=>[E.getVariableName(I[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:I=>!0===I[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xj:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xj:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xj:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xj:"FlowGraphPlayAnimationBlock"},out:{name:"out",xj:"FlowGraphPlayAnimationBlock"},done:{name:"done",xj:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(I,E,j,e,w){var z,h,t;const U=w[0],R=null===(z=I.configuration)||void 0===z?void 0:z.variable.value[0];if("number"!==typeof R)throw L.b.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const P=e.arrays.staticVariables[R];"undefined"===typeof U.config.animationType.value&&(e.arrays.staticVariables,U.config.animationType.value=(0,qj.H)(P.type));const o=w[4];return o.config||(o.config={}),(h=o.config).variable||(h.variable={}),o.config.variable.value=e.getVariableName(R),(t=w[3]).config||(t.config={}),w}},"pointer/get":{bP:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",xj:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,E,j,e,w)=>(w.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),w)},"pointer/set":{bP:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",xj:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,E,j,e,w)=>(w.forEach((I=>{"FlowGraphJsonPointerParserBlock"===I.className&&(I.config||(I.config={}),I.config.outputValue=!0)})),w)},"pointer/interpolate":{bP:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",xj:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",xj:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xj:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xj:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xj:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xj:"FlowGraphPlayAnimationBlock"},out:{name:"out",xj:"FlowGraphPlayAnimationBlock"},done:{name:"done",xj:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(I,E,j,e,w)=>(w.forEach((E=>{"FlowGraphJsonPointerParserBlock"===E.className?(E.config||(E.config={}),E.config.outputValue=!0):"FlowGraphInterpolationBlock"===E.className&&(E.config||(E.config={}),Object.keys(I.values||[]).forEach((j=>{var w;const z=null===(w=I.values)||void 0===w?void 0:w[j];if("value"===j&&z){const I=z.type;void 0!==I&&(E.config.animationType=e.arrays.types[I].flowGraphType)}})))})),w)},"animation/start":{bP:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xj:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(I,E)=>[I[0]*E._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(I,E)=>[I[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,E,j,e,w,z,h){const t=w[w.length-1];return t.config||(t.config={}),t.config.glTF=h,w}},"animation/stop":{bP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xj:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,E,j,e,w,z,h){const t=w[w.length-1];return t.config||(t.config={}),t.config.glTF=h,w}},"animation/stopAt":{bP:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",xj:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(I,E)=>[I[0]*E._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(I,E,j,e,w,z,h){const t=w[w.length-1];return t.config||(t.config={}),t.config.glTF=h,w}},"math/switch":{bP:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(I){if(I.configuration&&I.configuration.cases){const E=I.configuration.cases.value;if(!E.every((I=>"number"===typeof I&&/^-?\d+$/.test(I.toString()))))return L.b.Warn("Switch cases should be integers. Using empty array instead."),I.configuration.cases.value=[],{valid:!0};const j=new Set(E);I.configuration.cases.value=Array.from(j)}return{valid:!0}},extraProcessor(I,E,j,e,w){const z=w[0];return z.dataInputs.forEach((I=>{"default"!==I.name&&"case"!==I.name&&(I.name="in_"+I.name)})),z.config||(z.config={}),z.config.treatCasesAsIntegers=!0,w}},"debug/log":{bP:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function rj(I){let E=arguments.length>2?arguments[2]:void 0;return{bP:[I],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((I,E)=>(I[E]={name:E},I)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(I,j,e,w,z){var h;if(E){(h=z[0]).config||(h.config={}),z[0].config.preventIntegerFloatArithmetic=!0;let E=-1;Object.keys(I.values||{}).find((j=>{var e;return void 0!==(null===(e=I.values)||void 0===e?void 0:e[j].type)&&(E=I.values[j].type,!0)})),-1!==E&&(z[0].config.type=w.arrays.types[E].flowGraphType)}return z},validation:I=>E?nj(I):{valid:!0}}}function nj(I){if(I.values){const E=Object.keys(I.values).map((E=>I.values[E].type)).filter((I=>void 0!==I));if(!E.every((I=>I===E[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}ij["math/compose"]=ij["math/matCompose"],ij["math/decompose"]=ij["math/matDecompose"];var Hj=j(11080);const gj={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"LE",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Yj{constructor(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=I,this._gltf=E,this._animationTargetFps=j,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const I of this._interactivityGraph.types)this._types.push(gj[I.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const I of this._interactivityGraph.declarations){const E=dj(I);if(!E)throw L.b.Error(["No mapping found for declaration",I]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:E,fullOperationName:I.extension?I.op+":"+I.extension:I.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const I of this._interactivityGraph.variables){const E=this._parseVariable(I);this._staticVariables.push(E)}}_parseVariable(I,E){const j=this._types[I.type];if(!j)throw L.b.Error(["No type found for variable",I]),new Error("Error parsing variables");if(I.value&&I.value.length!==j.length)throw L.b.Error(["Invalid value length for variable",I,j]),new Error("Error parsing variables");const e=I.value||[];if(!e.length)switch(j.flowGraphType){case"boolean":e.push(!1);break;case"FlowGraphInteger":e.push(0);break;case"number":e.push(NaN);break;case"Vector2":e.push(NaN,NaN);break;case"LE":e.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":e.fill(NaN,0,4);break;case"Matrix":e.fill(NaN,0,16);break;case"Matrix3D":e.fill(NaN,0,9)}return"number"===j.elementType&&"string"===typeof e[0]&&(e[0]=parseFloat(e[0])),{type:j.flowGraphType,value:E?E(e,this):e}}_parseEvents(){if(this._interactivityGraph.events)for(const I of this._interactivityGraph.events){const E={eventId:I.id||"internalEvent_"+this._internalEventsCounter++};I.values&&(E.eventData=Object.keys(I.values).map((E=>{var j;const e=null===(j=I.values)||void 0===j?void 0:j[E];if(!e)throw L.b.Error(["No value found for event key",E]),new Error("Error parsing events");const w=this._types[e.type];if(!w)throw L.b.Error(["No type found for event value",e]),new Error("Error parsing events");const z="undefined"!==typeof e.value?this._parseVariable(e):void 0;return{id:E,type:w.flowGraphType,eventData:!0,value:z}}))),this._events.push(E)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const E of this._interactivityGraph.nodes){if("number"!==typeof E.declaration)throw L.b.Error(["No declaration found for node",E]),new Error("Error parsing nodes");const j=this._mappings[E.declaration];if(!j)throw L.b.Error(["No mapping found for node",E]),new Error("Error parsing nodes");if(j.flowGraphMapping.validation){const e=j.flowGraphMapping.validation(E,this._interactivityGraph,this._gltf);var I;if(!e.valid)throw new Error(`Error validating interactivity node ${null===(I=this._interactivityGraph.declarations)||void 0===I?void 0:I[E.declaration].op} - ${e.error}`)}const e=[];for(const I of j.flowGraphMapping.bP){const w=this._getEmptyBlock(I,j.fullOperationName);this._parseNodeConfiguration(E,w,j.flowGraphMapping,I),e.push(w)}this._nodes.push({bP:e,fullOperationName:j.fullOperationName})}}_getEmptyBlock(I,E){return{uniqueId:(0,Hj.d)(),className:I,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:E,metadata:{}}}_parseNodeConfiguration(I,E,j,e){const w=E.config;if(I.configuration){const E=Object.keys(I.configuration);for(const t of E){var z,h;const E=null===(z=I.configuration)||void 0===z?void 0:z[t];if(!E)throw L.b.Error(["No value found for node configuration",t]),new Error("Error parsing node configuration");const U=null===(h=j.configuration)||void 0===h?void 0:h[t];if(U&&U.xj?U.xj===e:0===j.bP.indexOf(e)){const I=(null===U||void 0===U?void 0:U.name)||t;E&&"undefined"!==typeof E.value||"undefined"===typeof(null===U||void 0===U?void 0:U.defaultValue)?E.value.length>=0?w[I]={value:1===E.value.length?E.value[0]:E.value}:L.b.Warn(["Invalid value for node configuration",E]):w[I]={value:U.defaultValue},U&&U.dataTransformer&&(w[I].value=U.dataTransformer([w[I].value],this)[0])}}}}_parseNodeConnections(I){for(let b=0;b<this._nodes.length;b++){var E;const Q=null===(E=this._interactivityGraph.nodes)||void 0===E?void 0:E[b];if(!Q)throw L.b.Error(["No node found for interactivity node",this._nodes[b]]),new Error("Error parsing node connections");const G=this._nodes[b],y=this._mappings[Q.declaration];if(!y)throw L.b.Error(["No mapping found for node",Q]),new Error("Error parsing node connections");const d=Q.flows||{},a=Object.keys(d).sort();for(const I of a){var j,e,w,z;const E=d[I],R=null===(j=y.flowGraphMapping.outputs)||void 0===j||null===(e=j.flows)||void 0===e?void 0:e[I],P=(null===R||void 0===R?void 0:R.name)||I,o=this._createNewSocketConnection(P,!0);(R&&R.xj&&G.bP.find((I=>I.className===R.xj))||G.bP[0]).signalOutputs.push(o);const Z=E.node,c=this._nodes[Z];if(!c)throw L.b.Error(["No node found for input node id",Z]),new Error("Error parsing node connections");const K=yj(c.fullOperationName);if(!K)throw L.b.Error(["No mapping found for input node",c]),new Error("Error parsing node connections");let F=null===(w=K.inputs)||void 0===w||null===(z=w.flows)||void 0===z?void 0:z[E.socket||"in"],C=!1;if(!F)for(const I in null===(h=K.inputs)||void 0===h?void 0:h.flows){var h,t,U;if(I.startsWith("[")&&I.endsWith("]"))C=!0,F=null===(t=K.inputs)||void 0===t||null===(U=t.flows)||void 0===U?void 0:U[I]}const X=F?C?F.name.replace("$1",E.socket||""):F.name:E.socket||"in",q=F&&F.xj&&c.bP.find((I=>I.className===F.xj))||c.bP[0];let x=q.signalInputs.find((I=>I.name===X));x||(x=this._createNewSocketConnection(X),q.signalInputs.push(x)),x.connectedPointIds.push(o.uniqueId),o.connectedPointIds.push(x.uniqueId)}const l=Q.values||{},i=Object.keys(l);for(const E of i){var R,P;const j=l[E];let e=null===(R=y.flowGraphMapping.inputs)||void 0===R||null===(P=R.values)||void 0===P?void 0:P[E],w=!1;if(!e)for(const I in null===(o=y.flowGraphMapping.inputs)||void 0===o?void 0:o.values){var o,Z,c;if(I.startsWith("[")&&I.endsWith("]"))w=!0,e=null===(Z=y.flowGraphMapping.inputs)||void 0===Z||null===(c=Z.values)||void 0===c?void 0:c[I]}const z=e?w?e.name.replace("$1",E):e.name:E,h=this._createNewSocketConnection(z);if((e&&e.xj&&G.bP.find((I=>I.className===e.xj))||G.bP[0]).dataInputs.push(h),void 0!==j.value){const E=this._parseVariable(j,e&&e.dataTransformer);I._connectionValues[h.uniqueId]=E}else{if("undefined"===typeof j.node)throw L.b.Error(["Invalid value for value connection",j]),new Error("Error parsing node connections");{var K,F,C;const I=j.node,E=j.socket||"value",e=this._nodes[I];if(!e)throw L.b.Error(["No node found for output socket reference",j]),new Error("Error parsing node connections");const w=yj(e.fullOperationName);if(!w)throw L.b.Error(["No mapping found for output socket reference",j]),new Error("Error parsing node connections");let z=null===(K=w.outputs)||void 0===K||null===(F=K.values)||void 0===F?void 0:F[E],t=!1;if(!z)for(const j in null===(X=w.outputs)||void 0===X?void 0:X.values){var X,q,x;if(j.startsWith("[")&&j.endsWith("]"))t=!0,z=null===(q=w.outputs)||void 0===q||null===(x=q.values)||void 0===x?void 0:x[j]}const U=z?t?z.name.replace("$1",E):null===(C=z)||void 0===C?void 0:C.name:E,R=z&&z.xj&&e.bP.find((I=>I.className===z.xj))||e.bP[0];let P=R.dataOutputs.find((I=>I.name===U));P||(P=this._createNewSocketConnection(U,!0),R.dataOutputs.push(P)),h.connectedPointIds.push(P.uniqueId),P.connectedPointIds.push(h.uniqueId)}}}if(y.flowGraphMapping.interBlockConnectors)for(const I of y.flowGraphMapping.interBlockConnectors){const E=I.input,j=I.output,e=I.isVariable;this._connectFlowGraphNodes(E,j,G.bP[I.inputBlockIndex],G.bP[I.outputBlockIndex],e)}if(y.flowGraphMapping.extraProcessor){var u;const E=null===(u=this._interactivityGraph.declarations)||void 0===u?void 0:u[Q.declaration];if(!E)throw L.b.Error(["No declaration found for extra processor",Q]),new Error("Error parsing node connections");G.bP=y.flowGraphMapping.extraProcessor(Q,E,y.flowGraphMapping,this,G.bP,I,this._gltf)}}}_createNewSocketConnection(I,E){return{uniqueId:(0,Hj.d)(),name:I,_connectionType:E?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(I,E,j,e,w){const z=w?j.dataInputs:j.signalInputs,h=w?e.dataOutputs:e.signalOutputs,t=z.find((E=>E.name===I))||this._createNewSocketConnection(I),U=h.find((I=>I.name===E))||this._createNewSocketConnection(E,!0);z.find((E=>E.name===I))||z.push(t),h.find((I=>I.name===E))||h.push(U),t.connectedPointIds.push(U.uniqueId),U.connectedPointIds.push(t.uniqueId)}getVariableName(I){return"staticVariable_"+I}serializeToFlowGraph(){const I={uniqueId:(0,Hj.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(I);for(let E=0;E<this._staticVariables.length;E++){const j=this._staticVariables[E];I._userVariables[this.getVariableName(E)]=j}return{rightHanded:!0,allBlocks:this._nodes.reduce(((I,E)=>I.concat(E.bP)),[]),executionContexts:[I]}}}const Aj="KHR_interactivity";class Tj{constructor(I){this._loader=I,this.name=Aj,this.enabled=this._loader.isExtensionUsed(Aj),this._pathConverter=(0,M.f)(this._loader.de),I._skipStartAnimationStep=!0;const E=I.babylonScene;E&&function(I){(0,M.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!I.activeCamera)return new w.Quaternion(NaN,NaN,NaN,NaN);const E=w.Quaternion.FromRotationMatrix(I.activeCamera.getWorldMatrix()).normalize();return I.useRightHandedSystem||(E.w*=-1,E.x*=-1),E},type:"Quaternion",getTarget:()=>I.activeCamera}),(0,M.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!I.activeCamera)return new w.LE(NaN,NaN,NaN);const E=I.activeCamera.getWorldMatrix().getTranslation();return I.useRightHandedSystem||(E.x*=-1),E},type:"LE",getTarget:()=>I.activeCamera}),(0,M.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:I=>{var E;return(null===(E=I._babylonAnimationGroup)||void 0===E?void 0:E.isPlaying)??!1},type:"boolean",getTarget:I=>I._babylonAnimationGroup}),(0,M.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:I=>{var E;return((null===(E=I._babylonAnimationGroup)||void 0===E?void 0:E.from)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,M.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:I=>{var E;return((null===(E=I._babylonAnimationGroup)||void 0===E?void 0:E.to)??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,M.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:I=>{var E;return((null===(E=I._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup}),(0,M.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:I=>{var E;return((null===(E=I._babylonAnimationGroup)||void 0===E?void 0:E.getCurrentFrame())??0)/60},type:"number",getTarget:I=>I._babylonAnimationGroup})}(E)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var I;if(!this._loader.babylonScene||!this._pathConverter)return;const E=this._loader.babylonScene,j=null===(I=this._loader.de.extensions)||void 0===I?void 0:I.KHR_interactivity;if(!j)return;const e=new Kj.c({CE:E});e.dispatchEventsSynchronously=!1;const w=j.graphs.map((I=>new Yj(I,this._loader.de,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(w.map((async I=>await bj(I,{coordinator:e,pathConverter:this._pathConverter})))),e.start()}}var Mj;Mj=async()=>(await Promise.resolve().then(j.bind(j,12862))).FlowGraphGLTFDataProvider,Lj[`${Aj}/${"FlowGraphGLTFDataProvider"}`]=Mj,T(Aj),A(Aj,!0,(I=>new Tj(I)));const Wj="KHR_node_visibility";(0,M.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:I=>{const E=I._babylonTransformNode;return!E||void 0===E.isVisible||E.isVisible},set:(I,E)=>{var j,e;null===(j=E._primitiveBabylonMeshes)||void 0===j||j.forEach((I=>{I.inheritVisibility=!0})),E._babylonTransformNode&&(E._babylonTransformNode.isVisible=I),null===(e=E._primitiveBabylonMeshes)||void 0===e||e.forEach((E=>{E.isVisible=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class Oj{constructor(I){this.name=Wj,this._loader=I,this.enabled=I.isExtensionUsed(Wj)}async onReady(){var I;null===(I=this._loader.de.nodes)||void 0===I||I.forEach((I=>{var E,j,e,w;(null===(E=I._primitiveBabylonMeshes)||void 0===E||E.forEach((I=>{I.inheritVisibility=!0})),null!==(j=I.extensions)&&void 0!==j&&j.KHR_node_visibility)&&(!1===(null===(e=I.extensions)||void 0===e?void 0:e.KHR_node_visibility.visible)&&(I._babylonTransformNode&&(I._babylonTransformNode.isVisible=!1),null===(w=I._primitiveBabylonMeshes)||void 0===w||w.forEach((I=>{I.isVisible=!1}))))}))}dispose(){this._loader=null}}T(Wj),A(Wj,!0,(I=>new Oj(I)));const sj="KHR_node_selectability";aj("event/onSelect",sj,{bP:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xj:"FlowGraphGetVariableBlock",dataTransformer:I=>["pickedMesh_"+I[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",xj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,E,j,e,w,z,h){var t,U,R,P,o,Z;const c=w[w.length-1];c.config=c.config||{},c.config.glTF=h;const K=null===(t=I.configuration)||void 0===t||null===(U=t.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const L="pickedMesh_"+K;return w[1].config.variable=L,z._userVariables[L]={className:"Mesh",id:null===h||void 0===h||null===(R=h.nodes)||void 0===R||null===(P=R[K]._babylonTransformNode)||void 0===P?void 0:P.id,uniqueId:null===h||void 0===h||null===(o=h.nodes)||void 0===o||null===(Z=o[K]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},w}}),(0,M.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:I=>{const E=I._babylonTransformNode;return!E||void 0===E.pU||E.pU},set:(I,E)=>{var j;null===(j=E._primitiveBabylonMeshes)||void 0===j||j.forEach((E=>{E.pU=I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pU"],type:"boolean"});class vj{constructor(I){this.name=sj,this._loader=I,this.enabled=I.isExtensionUsed(sj)}async onReady(){var I;null===(I=this._loader.de.nodes)||void 0===I||I.forEach((I=>{var E,j,e;null!==(E=I.extensions)&&void 0!==E&&E.KHR_node_selectability&&!1===(null===(j=I.extensions)||void 0===j?void 0:j.KHR_node_selectability.selectable)&&(null===(e=I._babylonTransformNode)||void 0===e||e.getChildMeshes().forEach((I=>{I.pU=!1})))}))}dispose(){this._loader=null}}T(sj),A(sj,!0,(I=>new vj(I)));const Vj="KHR_node_hoverability",fj="targetMeshPointerOver_";aj("event/onHoverIn",Vj,{bP:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xj:"FlowGraphGetVariableBlock",dataTransformer:I=>[fj+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,E,j,e,w,z,h){var t,U,R,P,o,Z;const c=w[w.length-1];c.config=c.config||{},c.config.glTF=h;const K=null===(t=I.configuration)||void 0===t||null===(U=t.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const L=fj+K;return w[1].config.variable=L,z._userVariables[L]={className:"Mesh",id:null===h||void 0===h||null===(R=h.nodes)||void 0===R||null===(P=R[K]._babylonTransformNode)||void 0===P?void 0:P.id,uniqueId:null===h||void 0===h||null===(o=h.nodes)||void 0===o||null===(Z=o[K]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},w}});const Sj="targetMeshPointerOut_";aj("event/onHoverOut",Vj,{bP:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xj:"FlowGraphGetVariableBlock",dataTransformer:I=>[Sj+I[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xj:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(I,E,j,e,w,z,h){var t,U,R,P,o,Z;const c=w[w.length-1];c.config=c.config||{},c.config.glTF=h;const K=null===(t=I.configuration)||void 0===t||null===(U=t.nodeIndex)||void 0===U?void 0:U.value[0];if(void 0===K||"number"!==typeof K)throw new Error("nodeIndex not found in configuration");const L=Sj+K;return w[1].config.variable=L,z._userVariables[L]={className:"Mesh",id:null===h||void 0===h||null===(R=h.nodes)||void 0===R||null===(P=R[K]._babylonTransformNode)||void 0===P?void 0:P.id,uniqueId:null===h||void 0===h||null===(o=h.nodes)||void 0===o||null===(Z=o[K]._babylonTransformNode)||void 0===Z?void 0:Z.uniqueId},w}}),(0,M.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:I=>{const E=I._babylonTransformNode;return!E||void 0===E.pointerOverDisableMeshTesting||E.pointerOverDisableMeshTesting},set:(I,E)=>{var j;null===(j=E._primitiveBabylonMeshes)||void 0===j||j.forEach((E=>{E.pointerOverDisableMeshTesting=!I}))},getTarget:I=>I._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class Bj{constructor(I){this.name=Vj,this._loader=I,this.enabled=I.isExtensionUsed(Vj)}async onReady(){var I;null===(I=this._loader.de.nodes)||void 0===I||I.forEach((I=>{var E,j,e;null!==(E=I.extensions)&&void 0!==E&&E.KHR_node_hoverability&&!1===(null===(j=I.extensions)||void 0===j?void 0:j.KHR_node_hoverability.hoverable)&&(null===(e=I._babylonTransformNode)||void 0===e||e.getChildMeshes().forEach((I=>{I.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}T(Vj),A(Vj,!0,(I=>new Bj(I)));const pj="ExtrasAsMetadata";class Dj{_assignExtras(I,E){if(E.extras&&Object.keys(E.extras).length>0){const j=I.metadata=I.metadata||{};(j.de=j.de||{}).extras=E.extras}}constructor(I){this.name=pj,this.enabled=!0,this._loader=I}dispose(){this._loader=null}loadNodeAsync(I,E,j){return this._loader.loadNodeAsync(I,E,(I=>{this._assignExtras(I,E),j(I)}))}loadCameraAsync(I,E,j){return this._loader.loadCameraAsync(I,E,(I=>{this._assignExtras(I,E),j(I)}))}createMaterial(I,E,j){const e=this._loader.createMaterial(I,E,j);return this._assignExtras(e,E),e}}T(pj),A(pj,!1,(I=>new Dj(I)));j(12862)},12743:(I,E,j)=>{"use strict";j.d(E,{d:()=>n,f:()=>y,j:()=>G,l:()=>d});var e=j(10960),w=j(10953),z=j(12414),h=j(11562),t=j(11530),U=j(11535),R=j(10974),P=j(10993),o=j(11556),Z=j(11652),c=j(11564),K=j(11158);class L{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.hZ=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.sZ=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(I){this._environmentTexture=I}getNodes(){let I=[];I=I.concat(this.meshes),I=I.concat(this.lights),I=I.concat(this.cameras),I=I.concat(this.transformNodes);for(const E of this.skeletons)I=I.concat(E.bones);return I}}class F extends L{}class C{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const I=this.rootNodes;for(const e of I)e.dispose();I.length=0;const E=this.skeletons;for(const e of E)e.dispose();E.length=0;const j=this.animationGroups;for(const e of j)e.dispose();j.length=0}}class X extends L{constructor(I){super(),this._wasAddedToScene=!1,(I=I||P.d.LastCreatedScene)&&(this.CE=I,this.proceduralTextures=[],I.Le.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=I.getEngine().onContextRestoredObservable.add((()=>{for(const I of this.geometries)I._rebuild();for(const I of this.meshes)I._rebuild();for(const I of this.hZ)I.rebuild();for(const I of this.textures)I._rebuild()})))}_topologicalSort(I){const E=new Map;for(const h of I)E.set(h.uniqueId,h);const j={dependsOn:new Map,dependedBy:new Map};for(const h of I){const I=h.uniqueId;j.dependsOn.set(I,new Set),j.dependedBy.set(I,new Set)}for(const h of I){const I=h.uniqueId,e=j.dependsOn.get(I);if(h instanceof o.d){const w=h.sourceMesh;E.has(w.uniqueId)&&(e.add(w.uniqueId),j.dependedBy.get(w.uniqueId).add(I))}const w=j.dependedBy.get(I);for(const z of h.getDescendants()){const e=z.uniqueId;if(E.has(e)){w.add(e);j.dependsOn.get(e).add(I)}}}const e=[],w=[];for(const h of I){const I=h.uniqueId;0===j.dependsOn.get(I).size&&(w.push(h),E.delete(I))}const z=w;for(;z.length>0;){const I=z.shift();e.push(I);const w=j.dependedBy.get(I.uniqueId);for(const e of Array.from(w.values())){const w=j.dependsOn.get(e);w.delete(I.uniqueId),0===w.size&&E.get(e)&&(z.push(E.get(e)),E.delete(e))}}return E.size>0&&(R.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),E.forEach((I=>{R.b.Error(I.name)}))),e}_addNodeAndDescendantsToList(I,E,j,e){if(j&&(!e||e(j))&&!E.has(j.uniqueId)){I.push(j),E.add(j.uniqueId);for(const w of j.getDescendants(!0))this._addNodeAndDescendantsToList(I,E,w,e)}}_isNodeInContainer(I){return I instanceof U.c&&-1!==this.meshes.indexOf(I)||(I instanceof t.b&&-1!==this.transformNodes.indexOf(I)||(I instanceof Z.c&&-1!==this.lights.indexOf(I)||I instanceof c.e&&-1!==this.cameras.indexOf(I)))}_isValidHierarchy(){for(const I of this.meshes)if(I.parent&&!this._isNodeInContainer(I.parent))return R.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.transformNodes)if(I.parent&&!this._isNodeInContainer(I.parent))return R.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.lights)if(I.parent&&!this._isNodeInContainer(I.parent))return R.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;for(const I of this.cameras)if(I.parent&&!this._isNodeInContainer(I.parent))return R.b.Warn(`Node ${I.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(I){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1],j=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const e={},z={},t=new C,U=[],R=[],P={doNotInstantiate:!0,...j},o=[],Z=new Set;for(const w of this.transformNodes)null===w.parent&&this._addNodeAndDescendantsToList(o,Z,w,P.predicate);for(const w of this.meshes)null===w.parent&&this._addNodeAndDescendantsToList(o,Z,w,P.predicate);const c=this._topologicalSort(o),K=(j,w)=>{if(((E,j)=>{if(e[E.uniqueId]=j.uniqueId,z[j.uniqueId]=j,I&&(j.name=I(E.name)),j instanceof h.d){const I=j;if(I.morphTargetManager){const j=E.morphTargetManager;I.morphTargetManager=j.clone();for(let E=0;E<j.numTargets;E++){const w=j.getTarget(E),h=I.morphTargetManager.getTarget(E);e[w.uniqueId]=h.uniqueId,z[h.uniqueId]=h}}}})(j,w),j.parent){const I=e[j.parent.uniqueId],E=z[I];w.parent=E||j.parent}if(w.position&&j.position&&w.position.U(j.position),w.rotationQuaternion&&j.rotationQuaternion&&w.rotationQuaternion.U(j.rotationQuaternion),w.rotation&&j.rotation&&w.rotation.U(j.rotation),w.pz&&j.pz&&w.pz.U(j.pz),w.material){const h=w;if(h.material)if(E){const E=j.material;if(-1===R.indexOf(E)){let j=E.clone(I?I(E.name):"Clone of "+E.name);if(R.push(E),e[E.uniqueId]=j.uniqueId,z[j.uniqueId]=j,"MultiMaterial"===E.getClassName()){const w=E;for(const E of w.th)E&&(j=E.clone(I?I(E.name):"Clone of "+E.name),R.push(E),e[E.uniqueId]=j.uniqueId,z[j.uniqueId]=j);w.th=w.th.map((I=>I&&z[e[I.uniqueId]]))}}"InstancedMesh"!==h.getClassName()&&(h.material=z[e[E.uniqueId]])}else"MultiMaterial"===h.material.getClassName()?-1===this.CE.multiMaterials.indexOf(h.material)&&this.CE.addMultiMaterial(h.material):-1===this.CE.materials.indexOf(h.material)&&this.CE.addMaterial(h.material)}null===w.parent&&t.rootNodes.push(w)};for(const w of c)if("InstancedMesh"===w.getClassName()){const I=w,E=I.sourceMesh,j=e[E.uniqueId];K(I,("number"===typeof j?z[j]:E).createInstance(I.name))}else{let I=!0;"Hh"===w.getClassName()||"Node"===w.getClassName()||w.skeleton||!w.getTotalVertices||0===w.getTotalVertices()?I=!1:P.doNotInstantiate&&(I="function"===typeof P.doNotInstantiate?!P.doNotInstantiate(w):!P.doNotInstantiate);const E=I?w.createInstance(`instance of ${w.name}`):w.clone(`Clone of ${w.name}`,null,!0);if(!E)throw new Error(`Could not clone or instantiate node on Asset Container ${w.name}`);K(w,E)}for(const w of this.skeletons){if(P.predicate&&!P.predicate(w))continue;const E=w.clone(I?I(w.name):"Clone of "+w.name);for(const I of this.meshes)if(I.skeleton===w&&!I.isAnInstance){const j=z[e[I.uniqueId]];if(!j||j.isAnInstance)continue;if(j.skeleton=E,-1!==U.indexOf(E))continue;U.push(E);for(const I of E.bones)I._linkedTransformNode&&(I._linkedTransformNode=z[e[I._linkedTransformNode.uniqueId]])}t.skeletons.push(E)}for(const w of this.animationGroups){if(P.predicate&&!P.predicate(w))continue;const E=w.clone(I?I(w.name):"Clone of "+w.name,(I=>z[e[I.uniqueId]]||I));t.animationGroups.push(E)}return t}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.CE.environmentTexture=this.environmentTexture);for(const I of this.CE._serializableComponents)I.addFromContainer(this);this.CE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const E=[];for(const j of this.cameras)I&&!I(j)||(this.CE.addCamera(j),E.push(j));for(const j of this.lights)I&&!I(j)||(this.CE.addLight(j),E.push(j));for(const j of this.meshes)I&&!I(j)||(this.CE.PP(j),E.push(j));for(const j of this.skeletons)I&&!I(j)||this.CE.addSkeleton(j);for(const j of this.animations)I&&!I(j)||this.CE.addAnimation(j);for(const j of this.animationGroups)I&&!I(j)||this.CE.addAnimationGroup(j);for(const j of this.multiMaterials)I&&!I(j)||this.CE.addMultiMaterial(j);for(const j of this.materials)I&&!I(j)||this.CE.addMaterial(j);for(const j of this.morphTargetManagers)I&&!I(j)||this.CE.addMorphTargetManager(j);for(const j of this.geometries)I&&!I(j)||this.CE.addGeometry(j);for(const j of this.transformNodes)I&&!I(j)||(this.CE.addTransformNode(j),E.push(j));for(const j of this.actionManagers)I&&!I(j)||this.CE.addActionManager(j);for(const j of this.textures)I&&!I(j)||this.CE.addTexture(j);for(const j of this.reflectionProbes)I&&!I(j)||this.CE.addReflectionProbe(j);for(const j of E)j.parent&&-1===this.CE.getNodes().indexOf(j.parent)&&(j.setParent?j.setParent(null):j.parent=null)}removeAllFromScene(){this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.CE.environmentTexture&&(this.CE.environmentTexture=null);for(const I of this.CE._serializableComponents)I.removeFromContainer(this)}removeFromScene(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const E of this.cameras)I&&!I(E)||this.CE.removeCamera(E);for(const E of this.lights)I&&!I(E)||this.CE.removeLight(E);for(const E of this.meshes)I&&!I(E)||this.CE.RP(E,!0);for(const E of this.skeletons)I&&!I(E)||this.CE.removeSkeleton(E);for(const E of this.animations)I&&!I(E)||this.CE.removeAnimation(E);for(const E of this.animationGroups)I&&!I(E)||this.CE.removeAnimationGroup(E);for(const E of this.multiMaterials)I&&!I(E)||this.CE.removeMultiMaterial(E);for(const E of this.materials)I&&!I(E)||this.CE.removeMaterial(E);for(const E of this.morphTargetManagers)I&&!I(E)||this.CE.removeMorphTargetManager(E);for(const E of this.geometries)I&&!I(E)||this.CE.removeGeometry(E);for(const E of this.transformNodes)I&&!I(E)||this.CE.removeTransformNode(E);for(const E of this.actionManagers)I&&!I(E)||this.CE.removeActionManager(E);for(const E of this.textures)I&&!I(E)||this.CE.removeTexture(E);for(const E of this.reflectionProbes)I&&!I(E)||this.CE.removeReflectionProbe(E)}dispose(){const I=this.cameras.slice(0);for(const c of I)c.dispose();this.cameras.length=0;const E=this.lights.slice(0);for(const c of E)c.dispose();this.lights.length=0;const j=this.meshes.slice(0);for(const c of j)c.dispose();this.meshes.length=0;const e=this.skeletons.slice(0);for(const c of e)c.dispose();this.skeletons.length=0;const w=this.animationGroups.slice(0);for(const c of w)c.dispose();this.animationGroups.length=0;const z=this.multiMaterials.slice(0);for(const c of z)c.dispose();this.multiMaterials.length=0;const h=this.materials.slice(0);for(const c of h)c.dispose();this.materials.length=0;const t=this.geometries.slice(0);for(const c of t)c.dispose();this.geometries.length=0;const U=this.transformNodes.slice(0);for(const c of U)c.dispose();this.transformNodes.length=0;const R=this.actionManagers.slice(0);for(const c of R)c.dispose();this.actionManagers.length=0;const P=this.textures.slice(0);for(const c of P)c.dispose();this.textures.length=0;const o=this.reflectionProbes.slice(0);for(const c of o)c.dispose();this.reflectionProbes.length=0;const Z=this.morphTargetManagers.slice(0);for(const c of Z)c.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const c of this.CE._serializableComponents)c.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.CE.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(I,E,j){if(I&&E)for(const e of I){let I=!0;if(j)for(const E of j)if(e===E){I=!1;break}I&&(E.push(e),e._parentContainer=this)}}moveAllFromScene(I){this._wasAddedToScene=!1,void 0===I&&(I=new F);for(const E in this)Object.prototype.hasOwnProperty.call(this,E)&&(this[E]=this[E]||("_environmentTexture"===E?null:[]),this._moveAssets(this.CE[E],this[E],I[E]));this.environmentTexture=this.CE.environmentTexture,this.removeAllFromScene()}createRootMesh(){const I=new h.d("assetContainerRootMesh",this.CE);for(const E of this.meshes)E.parent||I.addChild(E);return this.meshes.unshift(I),I}mergeAnimationsTo(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.d.LastCreatedScene,E=arguments.length>1?arguments[1]:void 0,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!I)return R.b.Error("No scene available to merge animations to"),[];const e=j||(E=>{let j=null;const e=E.animations.length?E.animations[0].targetProperty:"",w=E.name.split(".").join("").split("_primitive")[0];switch(e){case"position":case"rotationQuaternion":j=I.getTransformNodeByName(E.name)||I.getTransformNodeByName(w);break;case"influence":j=I.getMorphTargetByName(E.name)||I.getMorphTargetByName(w);break;default:j=I.getNodeByName(E.name)||I.getNodeByName(w)}return j}),w=this.getNodes();for(const t of w){const I=e(t);if(null!==I){for(const E of t.animations){const j=I.animations.filter((I=>I.targetProperty===E.targetProperty));for(const E of j){const j=I.animations.indexOf(E,0);j>-1&&I.animations.splice(j,1)}}I.animations=I.animations.concat(t.animations)}}const z=[],h=this.animationGroups.slice();for(const t of h){z.push(t.clone(t.name,e));for(const I of t.animatables)I.stop()}for(const t of E){const E=e(t.target);E&&(I.beginAnimation(E,t.fromFrame,t.toFrame,t.loopAnimation,t.speedRatio,t.onAnimationEnd?t.onAnimationEnd:void 0,void 0,!0,void 0,t.onAnimationLoop?t.onAnimationLoop:void 0),I.stopAnimation(t.target))}return z}populateRootNodes(){this.rootNodes.length=0;for(const I of this.meshes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.transformNodes)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.lights)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I);for(const I of this.cameras)I.parent||-1!==this.rootNodes.indexOf(I)||this.rootNodes.push(I)}addAllAssetsToContainer(I){if(!I)return;const E=[],j=new Set;for(E.push(I);E.length>0;){const I=E.pop();if(I instanceof h.d?(I.Je&&-1===this.geometries.indexOf(I.Je)&&this.geometries.push(I.Je),this.meshes.push(I)):I instanceof o.d?this.meshes.push(I):I instanceof t.b?this.transformNodes.push(I):I instanceof Z.c?this.lights.push(I):I instanceof c.e&&this.cameras.push(I),I instanceof U.c){if(I.material&&-1===this.materials.indexOf(I.material)){this.materials.push(I.material);for(const E of I.material.getActiveTextures())-1===this.textures.indexOf(E)&&this.textures.push(E)}I.skeleton&&-1===this.skeletons.indexOf(I.skeleton)&&this.skeletons.push(I.skeleton),I.morphTargetManager&&-1===this.morphTargetManagers.indexOf(I.morphTargetManager)&&this.morphTargetManagers.push(I.morphTargetManager)}for(const e of I.getChildren())j.has(e)||E.push(e);j.add(I)}this.populateRootNodes()}_getByTags(I,E,j){if(void 0===E)return I;const e=[];for(const w in I){const z=I[w];K.c&&K.c.MatchesQuery(z,E)&&(!j||j(z))&&e.push(z)}return e}getMeshesByTags(I,E){return this._getByTags(this.meshes,I,E)}getCamerasByTags(I,E){return this._getByTags(this.cameras,I,E)}getLightsByTags(I,E){return this._getByTags(this.lights,I,E)}getMaterialsByTags(I,E){return this._getByTags(this.materials,I,E).concat(this._getByTags(this.multiMaterials,I,E))}getTransformNodesByTags(I,E){return this._getByTags(this.transformNodes,I,E)}}var q=j(11012);class x{constructor(I){this.byteOffset=0,this.buffer=I}async loadAsync(I){const E=await this.buffer.readAsync(this.byteOffset,I);this._dataView=new DataView(E.buffer,E.byteOffset,E.byteLength),this._dataByteOffset=0}readUint32(){const I=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,I}readUint8Array(I){const E=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,I);return this._dataByteOffset+=I,this.byteOffset+=I,E}readString(I){return(0,q.j)(this.readUint8Array(I))}skipBytes(I){this._dataByteOffset+=I,this.byteOffset+=I}}var u=j(12752);const b="Z2xURg",Q={name:"de",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:I=>-1!==I.indexOf("asset")&&-1!==I.indexOf("version")||I.startsWith("data:base64,"+b)||I.startsWith("data:;base64,"+b)||I.startsWith("data:application/octet-stream;base64,"+b)||I.startsWith("data:model/gltf-binary;base64,"+b)};var G,y,d,a=j(11e3),l=j(11007);function i(I,E,j){try{return Promise.resolve(new Uint8Array(I,E,j))}catch(e){return Promise.reject(e)}}!function(I){I[I.AUTO=0]="AUTO",I[I.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(G||(G={})),function(I){I[I.NONE=0]="NONE",I[I.FIRST=1]="FIRST",I[I.ALL=2]="ALL"}(y||(y={})),function(I){I[I.LOADING=0]="LOADING",I[I.READY=1]="READY",I[I.COMPLETE=2]="COMPLETE"}(d||(d={}));class r{constructor(){this.coordinateSystemMode=G.AUTO,this.animationStartMode=y.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=I=>Promise.resolve(I),this.extensionOptions={}}U(I){I&&(this.onParsed=I.onParsed,this.coordinateSystemMode=I.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=I.animationStartMode??this.animationStartMode,this.loadNodeAnimations=I.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=I.loadSkins??this.loadSkins,this.loadMorphTargets=I.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=I.compileMaterials??this.compileMaterials,this.useClipPlane=I.useClipPlane??this.useClipPlane,this.compileShadowGenerators=I.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=I.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=I.useRangeRequests??this.useRangeRequests,this.createInstances=I.createInstances??this.createInstances,this.alwaysComputeBoundingBox=I.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=I.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=I.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=I.skipMaterials??this.skipMaterials,this.useSRGBBuffers=I.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=I.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=I.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=I.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=I.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=I.customRootNode,this.onMeshLoaded=I.onMeshLoaded,this.onSkinLoaded=I.onSkinLoaded,this.onTextureLoaded=I.onTextureLoaded,this.onMaterialLoaded=I.onMaterialLoaded,this.onCameraLoaded=I.onCameraLoaded,this.extensionOptions=I.extensionOptions??this.extensionOptions)}}class n extends r{constructor(I){super(),this.onParsedObservable=new e.e,this.onMeshLoadedObservable=new e.e,this.onSkinLoadedObservable=new e.e,this.onTextureLoadedObservable=new e.e,this.onMaterialLoadedObservable=new e.e,this.onCameraLoadedObservable=new e.e,this.onCompleteObservable=new e.e,this.onErrorObservable=new e.e,this.Le=new e.e,this.onExtensionLoadedObservable=new e.e,this.validate=!1,this.onValidatedObservable=new e.e,this._loader=null,this._state=null,this._requests=new Array,this.name=Q.name,this.extensions=Q.extensions,this.onLoaderStateChangedObservable=new e.e,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.U(I)}set onParsed(I){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),I&&(this._onParsedObserver=this.onParsedObservable.add(I))}set onMeshLoaded(I){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),I&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(I))}set onSkinLoaded(I){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),I&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((E=>I(E.node,E.skinnedNode))))}set onTextureLoaded(I){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),I&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(I))}set onMaterialLoaded(I){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),I&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(I))}set onCameraLoaded(I){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),I&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(I))}set onComplete(I){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(I)}set onError(I){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(I)}set onDispose(I){this._onDisposeObserver&&this.Le.remove(this._onDisposeObserver),this._onDisposeObserver=this.Le.add(I)}set onExtensionLoaded(I){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(I)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(I){this._loggingEnabled!==I&&(this._loggingEnabled=I,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(I){this._capturePerformanceCounters!==I&&(this._capturePerformanceCounters=I,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(I){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(I)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const I of this._requests)I.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=I=>Promise.resolve(I),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Le.notifyObservers(void 0),this.Le.clear()}loadFile(I,E,j,z,h,t,U,P){if(ArrayBuffer.isView(E))return this._loadBinary(I,E,j,z,U,P),null;this._progressCallback=h;const o=E.name||w.Tools.GetFilename(E);if(t){if(this.useRangeRequests){this.validate&&R.b.Warn("glTF validation is not supported when range requests are enabled");const j={abort:()=>{},onCompleteObservable:new e.e},w={readAsync:(j,e)=>new Promise(((w,z)=>{this._loadFile(I,E,(I=>{w(new Uint8Array(I))}),!0,(I=>{z(I)}),(I=>{I.setRequestHeader("Range",`bytes=${j}-${j+e-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new x(w)).then((I=>{j.onCompleteObservable.notifyObservers(j),z(I)}),U?I=>U(void 0,I):void 0),j}return this._loadFile(I,E,(E=>{this._validate(I,new Uint8Array(E,0,E.byteLength),j,o),this._unpackBinaryAsync(new x({readAsync:(I,j)=>i(E,I,j),byteLength:E.byteLength})).then((I=>{z(I)}),U?I=>U(void 0,I):void 0)}),!0,U)}return this._loadFile(I,E,(E=>{try{this._validate(I,E,j,o),z({json:this._parseJson(E)})}catch{U&&U()}}),!1,U)}_loadBinary(I,E,j,e,w,z){this._validate(I,new Uint8Array(E.buffer,E.byteOffset,E.byteLength),j,z),this._unpackBinaryAsync(new x({readAsync:(I,j)=>function(I,E,j){try{if(E<0||E>=I.byteLength)throw new RangeError("Offset is out of range.");if(E+j>I.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(I.buffer,I.byteOffset+E,j))}catch(e){return Promise.reject(e)}}(E,I,j),byteLength:E.byteLength})).then((I=>{e(I)}),w?I=>w(void 0,I):void 0)}importMeshAsync(I,E,j,e,w,z){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(j),this.onParsedObservable.clear(),this._log(`Loading ${z||""}`),this._loader=this._getLoader(j),this._loader.importMeshAsync(I,E,null,j,e,w,z))))}loadAsync(I,E,j,e,w){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(E),this._loader.loadAsync(I,E,j,e,w))))}loadAssetContainerAsync(I,E,j,e,w){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(E),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(E);const z=new X(I),h=[];this.onMaterialLoadedObservable.add((I=>{h.push(I)}));const t=[];this.onTextureLoadedObservable.add((I=>{t.push(I)}));const U=[];this.onCameraLoadedObservable.add((I=>{U.push(I)}));const R=[];return this.onMeshLoadedObservable.add((I=>{I.morphTargetManager&&R.push(I.morphTargetManager)})),this._loader.importMeshAsync(null,I,z,E,j,e,w).then((I=>(Array.prototype.push.apply(z.geometries,I.geometries),Array.prototype.push.apply(z.meshes,I.meshes),Array.prototype.push.apply(z.hZ,I.hZ),Array.prototype.push.apply(z.skeletons,I.skeletons),Array.prototype.push.apply(z.animationGroups,I.animationGroups),Array.prototype.push.apply(z.materials,h),Array.prototype.push.apply(z.textures,t),Array.prototype.push.apply(z.lights,I.lights),Array.prototype.push.apply(z.transformNodes,I.transformNodes),Array.prototype.push.apply(z.cameras,U),Array.prototype.push.apply(z.morphTargetManagers,R),z)))}))}canDirectLoad(I){return Q.canDirectLoad(I)}directLoad(I,E){if(E.startsWith("base64,"+b)||E.startsWith(";base64,"+b)||E.startsWith("application/octet-stream;base64,"+b)||E.startsWith("model/gltf-binary;base64,"+b)){const j=(0,a.b)(E);return this._validate(I,new Uint8Array(j,0,j.byteLength)),this._unpackBinaryAsync(new x({readAsync:(I,E)=>i(j,I,E),byteLength:j.byteLength}))}return this._validate(I,E),Promise.resolve({json:this._parseJson(E)})}createPlugin(I){return new n(I[Q.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((I,E)=>{this.onCompleteObservable.addOnce((()=>{I()})),this.onErrorObservable.addOnce((I=>{E(I)}))}))}_setState(I){this._state!==I&&(this._state=I,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(d[this._state]))}_loadFile(I,E,j,e,w,z){const h=I._loadFile(E,j,(I=>{this._onProgress(I,h)}),!0,e,w,z);return h.onCompleteObservable.add((()=>{h._lengthComputable=!0,h._total=h._loaded})),this._requests.push(h),h}_onProgress(I,E){if(!this._progressCallback)return;E._lengthComputable=I.lengthComputable,E._loaded=I.loaded,E._total=I.total;let j=!0,e=0,w=0;for(const z of this._requests){if(void 0===z._lengthComputable||void 0===z._loaded||void 0===z._total)return;j=j&&z._lengthComputable,e+=z._loaded,w+=z._total}this._progressCallback({lengthComputable:j,loaded:e,total:j?w:0})}_validate(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),u.d.ValidateAsync(E,j,e,(E=>this.preprocessUrlAsync(j+E).then((E=>I._loadFileAsync(E,void 0,!0,!0).then((I=>new Uint8Array(I,0,I.byteLength))))))).then((I=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(I),this.onValidatedObservable.clear()}),(I=>{this._endPerformanceCounter("Validate JSON"),w.Tools.Warn(`Failed to validate: ${I.message}`),this.onValidatedObservable.clear()})))}_getLoader(I){const E=I.json.asset||{};this._log(`Asset version: ${E.version}`),E.minVersion&&this._log(`Asset minimum version: ${E.minVersion}`),E.generator&&this._log(`Asset generator: ${E.generator}`);const j=n._parseVersion(E.version);if(!j)throw new Error("Invalid version: "+E.version);if(void 0!==E.minVersion){const I=n._parseVersion(E.minVersion);if(!I)throw new Error("Invalid minimum version: "+E.minVersion);if(n._compareVersion(I,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+E.minVersion)}const e={1:n._CreateGLTF1Loader,2:n._CreateGLTF2Loader}[j.major];if(!e)throw new Error("Unsupported version: "+E.version);return e(this)}_parseJson(I){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${I.length}`);const E=JSON.parse(I);return this._endPerformanceCounter("Parse JSON"),E}_unpackBinaryAsync(I){return this._startPerformanceCounter("Unpack Binary"),I.loadAsync(20).then((()=>{const E=I.readUint32();if(1179937895!==E)throw new l.k("Unexpected magic: "+E,l.g.GLTFLoaderUnexpectedMagicError);const j=I.readUint32();this.loggingEnabled&&this._log(`Binary version: ${j}`);const e=I.readUint32();let w;switch(this.useRangeRequests||e===I.buffer.byteLength||R.b.Warn(`Length in header does not match actual data length: ${e} != ${I.buffer.byteLength}`),j){case 1:w=this._unpackBinaryV1Async(I,e);break;case 2:w=this._unpackBinaryV2Async(I,e);break;default:throw new Error("Unsupported version: "+j)}return this._endPerformanceCounter("Unpack Binary"),w}))}_unpackBinaryV1Async(I,E){const j=I.readUint32(),e=I.readUint32();if(0!==e)throw new Error(`Unexpected content format: ${e}`);const w=E-I.byteOffset,z={json:this._parseJson(I.readString(j)),bin:null};if(0!==w){const E=I.byteOffset;z.bin={readAsync:(j,e)=>I.buffer.readAsync(E+j,e),byteLength:w}}return Promise.resolve(z)}_unpackBinaryV2Async(I,E){const j=1313821514,e=5130562,w=I.readUint32();if(I.readUint32()!==j)throw new Error("First chunk format is not JSON");return I.byteOffset+w===E?I.loadAsync(w).then((()=>({json:this._parseJson(I.readString(w)),bin:null}))):I.loadAsync(w+8).then((()=>{const z={json:this._parseJson(I.readString(w)),bin:null},h=()=>{const w=I.readUint32();switch(I.readUint32()){case j:throw new Error("Unexpected JSON chunk");case e:{const E=I.byteOffset;z.bin={readAsync:(j,e)=>I.buffer.readAsync(E+j,e),byteLength:w},I.skipBytes(w);break}default:I.skipBytes(w)}return I.byteOffset!==E?I.loadAsync(8).then(h):Promise.resolve(z)};return h()}))}static _parseVersion(I){if("1.0"===I||"1.0.1"===I)return{major:1,minor:0};const E=(I+"").match(/^(\d+)\.(\d+)/);return E?{major:parseInt(E[1]),minor:parseInt(E[2])}:null}static _compareVersion(I,E){return I.major>E.major?1:I.major<E.major?-1:I.minor>E.minor?1:I.minor<E.minor?-1:0}_logOpen(I){this._log(I),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(I){const E=n._logSpaces.substring(0,2*this._logIndentLevel);R.b.Log(`${E}${I}`)}_logDisabled(I){}_startPerformanceCounterEnabled(I){w.Tools.StartPerformanceCounter(I)}_startPerformanceCounterDisabled(I){}_endPerformanceCounterEnabled(I){w.Tools.EndPerformanceCounter(I)}_endPerformanceCounterDisabled(I){}}n.IncrementalLoading=!0,n.HomogeneousCoordinates=!1,n._logSpaces="                                ",(0,z.d)(new n)},12752:(I,E,j)=>{"use strict";j.d(E,{d:()=>h});var e=j(10953);function w(I,E,j,e){const w={externalResourceFunction:e};return j&&(w.uri="file:"===E?j:E+j),ArrayBuffer.isView(I)?GLTFValidator.validateBytes(I,w):GLTFValidator.validateString(I,w)}function z(){const I=[];onmessage=E=>{const j=E.data;switch(j.id){case"init":importScripts(j.url);break;case"validate":w(j.data,j.rootUrl,j.fileName,(E=>new Promise(((j,e)=>{const w=I.length;I.push({resolve:j,reject:e}),postMessage({id:"getExternalResource",index:w,uri:E})})))).then((I=>{postMessage({id:"validate.resolve",value:I})}),(I=>{postMessage({id:"validate.reject",reason:I})}));break;case"getExternalResource.resolve":I[j.index].resolve(j.value);break;case"getExternalResource.reject":I[j.index].reject(j.reason)}}}class h{static ValidateAsync(I,E,j,h){return"function"===typeof Worker?new Promise(((t,U)=>{const R=`${w}(${z})()`,P=URL.createObjectURL(new Blob([R],{type:"application/javascript"})),o=new Worker(P),Z=I=>{o.removeEventListener("error",Z),o.removeEventListener("message",c),U(I)},c=I=>{const E=I.data;switch(E.id){case"getExternalResource":h(E.uri).then((I=>{o.postMessage({id:"getExternalResource.resolve",index:E.index,value:I},[I.buffer])}),(I=>{o.postMessage({id:"getExternalResource.reject",index:E.index,reason:I})}));break;case"validate.resolve":o.removeEventListener("error",Z),o.removeEventListener("message",c),t(E.value),o.terminate();break;case"validate.reject":o.removeEventListener("error",Z),o.removeEventListener("message",c),U(E.reason),o.terminate()}};if(o.addEventListener("error",Z),o.addEventListener("message",c),o.postMessage({id:"init",url:e.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(I)){const e=I.slice();o.postMessage({id:"validate",data:e,rootUrl:E,fileName:j},[e.buffer])}else o.postMessage({id:"validate",data:I,rootUrl:E,fileName:j})})):(this._LoadScriptPromise||(this._LoadScriptPromise=e.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>w(I,E,j,h))))}}h.Configuration={url:`${e.Tools._DefaultCdnUrl}/gltf_validator.js`}},13292:(I,E,j)=>{"use strict";j.d(E,{e:()=>Q});var e=j(11101),w=j(11106),z=j(11149),h=j(11117),t=j(11491),U=j(11427),R=j(11197),P=j(11363),o=j(11073),Z=j(11042);j(12518),j(12441),j(12456),j(12444),j(12458),j(12460),j(12463);const c="imageProcessingCompatibility",K="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";Z.e.IncludesShadersStore[c]||(Z.e.IncludesShadersStore[c]=K);const L="skyPixelShader",F="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";Z.e.ShadersStore[L]||(Z.e.ShadersStore[L]=F);j(12523),j(12472),j(12476),j(12487),j(12482);const C="skyVertexShader",X="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";Z.e.ShadersStore[C]||(Z.e.ShadersStore[C]=X);var q=j(11422),x=j(11477),u=j(11470);class b extends t.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class Q extends U.e{constructor(I,E){super(I,E),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new h.LE(0,100,0),this.useSunPosition=!1,this.cameraOffset=h.LE.Zero(),this.up=h.LE.Up(),this.dithering=!1,this._cameraPosition=h.LE.Zero(),this._skyOrientation=new h.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(I,E){const j=E._drawWrapper;if(this.isFrozen&&j.effect&&j._wasPreviouslyReady)return!0;E.materialDefines||(E.materialDefines=new b);const e=E.materialDefines,w=this.GI();if(this._isReadyForSubMesh(E))return!0;if((0,u.L)(I,w,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,e),(0,u.C)(I,e,!0,!1),e.IMAGEPROCESSINGPOSTPROCESS!==w.imageProcessingConfiguration.applyByPostProcess&&e.markAsMiscDirty(),e.DITHER!==this.dithering&&e.markAsMiscDirty(),e.isDirty){e.markAsProcessed(),w.resetCachedMaterial();const I=new q.e;e.FOG&&I.addFallback(1,"FOG"),e.IMAGEPROCESSINGPOSTPROCESS=w.imageProcessingConfiguration.applyByPostProcess,e.DITHER=this.dithering;const j=[R.e.PositionKind];e.VERTEXCOLOR&&j.push(R.e.ColorKind);const z="sky",h=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,x.d)(h);const t=e.toString();E.setEffect(w.getEngine().createEffect(z,j,h,[],t,I,this.onCompiled,this.onError),e,this._materialContext)}return!(!E.effect||!E.effect.isReady())&&(e._renderId=w.getRenderId(),j._wasPreviouslyReady=!0,!0)}bindForSubMesh(I,E,j){const e=this.GI(),w=j.materialDefines;if(!w)return;const z=j.effect;if(!z)return;this._activeEffect=z,this.bindOnlyWorldMatrix(I),this._activeEffect.setMatrix("viewProjection",e.getTransformMatrix()),this._mustRebind(e,z,j)&&((0,x.f)(z,this,e),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,u.g)(w,z,e)),e.fogEnabled&&E.applyFog&&e.fogMode!==P.c.FOGMODE_NONE&&this._activeEffect.setMatrix("view",e.getViewMatrix()),(0,u.d)(e,E,this._activeEffect);const t=e.activeCamera;if(t){const I=t.getWorldMatrix();this._cameraPosition.x=I.m[12],this._cameraPosition.y=I.m[13],this._cameraPosition.z=I.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const I=Math.PI*(this.inclination-.5),E=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(E)*Math.cos(I),this.sunPosition.y=this.distance*Math.sin(-I),this.sunPosition.z=this.distance*Math.sin(E)*Math.cos(I),h.Quaternion.FromUnitVectorsToRef(h.LE.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(E,this._activeEffect,j)}getAnimatables(){return[]}dispose(I){super.dispose(I)}clone(I){return z.e.Clone((()=>new Q(I,this.GI())),this)}serialize(){const I=super.serialize();return I.customType="BABYLON.SkyMaterial",I}getClassName(){return"SkyMaterial"}static Parse(I,E,j){return z.e.Parse((()=>new Q(I.name,E)),I,E,j)}}(0,e.b)([(0,w.N)()],Q.prototype,"luminance",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"turbidity",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"rayleigh",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"mieCoefficient",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"mieDirectionalG",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"distance",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"inclination",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"azimuth",void 0),(0,e.b)([(0,w.K)()],Q.prototype,"sunPosition",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"useSunPosition",void 0),(0,e.b)([(0,w.K)()],Q.prototype,"cameraOffset",void 0),(0,e.b)([(0,w.K)()],Q.prototype,"up",void 0),(0,e.b)([(0,w.N)()],Q.prototype,"dithering",void 0),(0,o.h)("BABYLON.SkyMaterial",Q)},11802:(I,E,j)=>{"use strict";function e(I,E){E.headers=I.headers||{},E.statusMessage=I.statusText,E.statusCode=I.status,E.data=I.response}function w(I,E,j){return new Promise((function(w,z){j=j||{};var h,t,U,R=new XMLHttpRequest,P=j.body,o=j.headers||{};for(h in j.timeout&&(R.timeout=j.timeout),R.ontimeout=R.onerror=function(I){I.timeout="timeout"==I.type,z(I)},R.open(I,E.href||E),R.onload=function(){for(U=R.getAllResponseHeaders().trim().split(/[\r\n]+/),e(R,R);t=U.shift();)t=t.split(": "),R.headers[t.shift().toLowerCase()]=t.join(": ");if((t=R.headers["content-type"])&&~t.indexOf("application/json"))try{R.data=JSON.parse(R.data,j.reviver)}catch(I){return e(R,I),z(I)}(R.status>=400?z:w)(R)},typeof FormData<"u"&&P instanceof FormData||P&&"object"==typeof P&&(o["content-type"]="application/json",P=JSON.stringify(P)),R.withCredentials=!!j.withCredentials,o)R.setRequestHeader(h,o[h]);R.send(P)}))}j.r(E),j.d(E,{del:()=>U,get:()=>z,patch:()=>t,post:()=>h,put:()=>R,send:()=>w});var z=w.bind(w,"GET"),h=w.bind(w,"POST"),t=w.bind(w,"PATCH"),U=w.bind(w,"DELETE"),R=w.bind(w,"PUT")},13404:(I,E,j)=>{"use strict";j.d(E,{d:()=>o});const e=.5*(Math.sqrt(3)-1),w=(3-Math.sqrt(3))/6,z=1/3,h=1/6,t=(Math.sqrt(5)-1)/4,U=(5-Math.sqrt(5))/20,R=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),P=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const o=class{constructor(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const E="function"==typeof I?I:function(I){let E=0,j=0,e=0,w=1;const z=function(){let I=4022871197;return function(E){E=E.toString();for(let j=0;j<E.length;j++){I+=E.charCodeAt(j);let e=.02519603282416938*I;I=e>>>0,e-=I,e*=I,I=e>>>0,e-=I,I+=4294967296*e}return 2.3283064365386963e-10*(I>>>0)}}();E=z(" "),j=z(" "),e=z(" "),E-=z(I),E<0&&(E+=1);j-=z(I),j<0&&(j+=1);e-=z(I),e<0&&(e+=1);return function(){const I=2091639*E+2.3283064365386963e-10*w;return E=j,j=e,e=I-(w=0|I)}}(I);this.p=function(I){const E=new Uint8Array(256);for(let j=0;j<256;j++)E[j]=j;for(let j=0;j<255;j++){const e=j+~~(I()*(256-j)),w=E[j];E[j]=E[e],E[e]=w}return E}(E),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let j=0;j<512;j++)this.perm[j]=this.p[255&j],this.permMod12[j]=this.perm[j]%12}noise2D(I,E){const j=this.permMod12,z=this.perm;let h=0,t=0,U=0;const P=(I+E)*e,o=Math.floor(I+P),Z=Math.floor(E+P),c=(o+Z)*w,K=I-(o-c),L=E-(Z-c);let F,C;K>L?(F=1,C=0):(F=0,C=1);const X=K-F+w,q=L-C+w,x=K-1+2*w,u=L-1+2*w,b=255&o,Q=255&Z;let G=.5-K*K-L*L;if(G>=0){const I=3*j[b+z[Q]];G*=G,h=G*G*(R[I]*K+R[I+1]*L)}let y=.5-X*X-q*q;if(y>=0){const I=3*j[b+F+z[Q+C]];y*=y,t=y*y*(R[I]*X+R[I+1]*q)}let d=.5-x*x-u*u;if(d>=0){const I=3*j[b+1+z[Q+1]];d*=d,U=d*d*(R[I]*x+R[I+1]*u)}return 70*(h+t+U)}noise3D(I,E,j){const e=this.permMod12,w=this.perm;let t,U,P,o;const Z=(I+E+j)*z,c=Math.floor(I+Z),K=Math.floor(E+Z),L=Math.floor(j+Z),F=(c+K+L)*h,C=I-(c-F),X=E-(K-F),q=j-(L-F);let x,u,b,Q,G,y;C>=X?X>=q?(x=1,u=0,b=0,Q=1,G=1,y=0):C>=q?(x=1,u=0,b=0,Q=1,G=0,y=1):(x=0,u=0,b=1,Q=1,G=0,y=1):X<q?(x=0,u=0,b=1,Q=0,G=1,y=1):C<q?(x=0,u=1,b=0,Q=0,G=1,y=1):(x=0,u=1,b=0,Q=1,G=1,y=0);const d=C-x+h,a=X-u+h,l=q-b+h,i=C-Q+2*h,r=X-G+2*h,n=q-y+2*h,H=C-1+.5,g=X-1+.5,Y=q-1+.5,A=255&c,T=255&K,M=255&L;let W=.6-C*C-X*X-q*q;if(W<0)t=0;else{const I=3*e[A+w[T+w[M]]];W*=W,t=W*W*(R[I]*C+R[I+1]*X+R[I+2]*q)}let O=.6-d*d-a*a-l*l;if(O<0)U=0;else{const I=3*e[A+x+w[T+u+w[M+b]]];O*=O,U=O*O*(R[I]*d+R[I+1]*a+R[I+2]*l)}let s=.6-i*i-r*r-n*n;if(s<0)P=0;else{const I=3*e[A+Q+w[T+G+w[M+y]]];s*=s,P=s*s*(R[I]*i+R[I+1]*r+R[I+2]*n)}let v=.6-H*H-g*g-Y*Y;if(v<0)o=0;else{const I=3*e[A+1+w[T+1+w[M+1]]];v*=v,o=v*v*(R[I]*H+R[I+1]*g+R[I+2]*Y)}return 32*(t+U+P+o)}noise4D(I,E,j,e){const w=this.perm;let z,h,R,o,Z;const c=(I+E+j+e)*t,K=Math.floor(I+c),L=Math.floor(E+c),F=Math.floor(j+c),C=Math.floor(e+c),X=(K+L+F+C)*U,q=I-(K-X),x=E-(L-X),u=j-(F-X),b=e-(C-X);let Q=0,G=0,y=0,d=0;q>x?Q++:G++,q>u?Q++:y++,q>b?Q++:d++,x>u?G++:y++,x>b?G++:d++,u>b?y++:d++;const a=Q>=3?1:0,l=G>=3?1:0,i=y>=3?1:0,r=d>=3?1:0,n=Q>=2?1:0,H=G>=2?1:0,g=y>=2?1:0,Y=d>=2?1:0,A=Q>=1?1:0,T=G>=1?1:0,M=y>=1?1:0,W=d>=1?1:0,O=q-a+U,s=x-l+U,v=u-i+U,V=b-r+U,f=q-n+2*U,S=x-H+2*U,B=u-g+2*U,p=b-Y+2*U,D=q-A+3*U,k=x-T+3*U,J=u-M+3*U,N=b-W+3*U,m=q-1+4*U,II=x-1+4*U,EI=u-1+4*U,jI=b-1+4*U,eI=255&K,wI=255&L,zI=255&F,hI=255&C;let tI=.6-q*q-x*x-u*u-b*b;if(tI<0)z=0;else{const I=w[eI+w[wI+w[zI+w[hI]]]]%32*4;tI*=tI,z=tI*tI*(P[I]*q+P[I+1]*x+P[I+2]*u+P[I+3]*b)}let UI=.6-O*O-s*s-v*v-V*V;if(UI<0)h=0;else{const I=w[eI+a+w[wI+l+w[zI+i+w[hI+r]]]]%32*4;UI*=UI,h=UI*UI*(P[I]*O+P[I+1]*s+P[I+2]*v+P[I+3]*V)}let RI=.6-f*f-S*S-B*B-p*p;if(RI<0)R=0;else{const I=w[eI+n+w[wI+H+w[zI+g+w[hI+Y]]]]%32*4;RI*=RI,R=RI*RI*(P[I]*f+P[I+1]*S+P[I+2]*B+P[I+3]*p)}let PI=.6-D*D-k*k-J*J-N*N;if(PI<0)o=0;else{const I=w[eI+A+w[wI+T+w[zI+M+w[hI+W]]]]%32*4;PI*=PI,o=PI*PI*(P[I]*D+P[I+1]*k+P[I+2]*J+P[I+3]*N)}let oI=.6-m*m-II*II-EI*EI-jI*jI;if(oI<0)Z=0;else{const I=w[eI+1+w[wI+1+w[zI+1+w[hI+1]]]]%32*4;oI*=oI,Z=oI*oI*(P[I]*m+P[I+1]*II+P[I+2]*EI+P[I+3]*jI)}return 27*(z+h+R+o+Z)}}}}]);