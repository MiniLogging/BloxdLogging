/*! For license information please see 7egshf.32.a312ade6.chunk.js.LICENSE.txt */
(self.h6ljd275xwr=self.h6ljd275xwr||[]).push([[32],{13384:(n,y,H)=>{"use strict";var o=H(13393),G=H(13401),h=H(13406);H.g.__TYPEDARRAY_POOL||(H.g.__TYPEDARRAY_POOL={UINT8:G([32,0]),UINT16:G([32,0]),UINT32:G([32,0]),INT8:G([32,0]),INT16:G([32,0]),INT32:G([32,0]),FLOAT:G([32,0]),DOUBLE:G([32,0]),DATA:G([32,0]),UINT8C:G([32,0]),BUFFER:G([32,0])});var k="undefined"!==typeof Uint8ClampedArray,i=H.g.__TYPEDARRAY_POOL;i.UINT8C||(i.UINT8C=G([32,0])),i.BUFFER||(i.BUFFER=G([32,0]));var B=i.DATA,V=i.BUFFER;function q(n){if(n){var y=n.length||n.byteLength,H=o.log2(y);B[H].push(n)}}function b(n){n=o.nextPow2(n);var y=o.log2(n),H=B[y];return H.length>0?H.pop():new ArrayBuffer(n)}function A(n){return new Uint8Array(b(n),0,n)}function U(n){return new Uint16Array(b(2*n),0,n)}function T(n){return new Uint32Array(b(4*n),0,n)}function W(n){return new Int8Array(b(n),0,n)}function z(n){return new Int16Array(b(2*n),0,n)}function Q(n){return new Int32Array(b(4*n),0,n)}function l(n){return new Float32Array(b(4*n),0,n)}function v(n){return new Float64Array(b(8*n),0,n)}function F(n){return k?new Uint8ClampedArray(b(n),0,n):A(n)}function g(n){return new DataView(b(n),0,n)}y.free=function(n){if(h(n))V[o.log2(n.length)].push(n);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(n)&&(n=n.buffer),!n)return;var y=n.length||n.byteLength,H=0|o.log2(y);B[H].push(n)}},y.freeUint8=y.freeUint16=y.freeUint32=y.freeInt8=y.freeInt16=y.freeInt32=y.freeFloat32=y.freeFloat=y.freeFloat64=y.freeDouble=y.freeUint8Clamped=y.freeDataView=function(n){q(n.buffer)},y.freeArrayBuffer=q,y.freeBuffer=function(n){V[o.log2(n.length)].push(n)},y.malloc=function(n,y){if(void 0===y||"arraybuffer"===y)return b(n);switch(y){case"uint8":return A(n);case"uint16":return U(n);case"uint32":return T(n);case"int8":return W(n);case"int16":return z(n);case"int32":return Q(n);case"float":case"float32":return l(n);case"double":case"float64":return v(n);case"uint8_clamped":return F(n);case"buffer":throw"Buffer not supported";case"data":case"dataview":return g(n);default:return null}return null},y.mallocArrayBuffer=b,y.mallocUint8=A,y.mallocUint16=U,y.mallocUint32=T,y.mallocInt8=W,y.mallocInt16=z,y.mallocInt32=Q,y.mallocFloat32=y.mallocFloat=l,y.mallocFloat64=y.mallocDouble=v,y.mallocUint8Clamped=F,y.mallocDataView=g,y.clearCache=function(){for(var n=0;n<32;++n)i.UINT8[n].length=0,i.UINT16[n].length=0,i.UINT32[n].length=0,i.INT8[n].length=0,i.INT16[n].length=0,i.INT32[n].length=0,i.FLOAT[n].length=0,i.DOUBLE[n].length=0,i.UINT8C[n].length=0,B[n].length=0,V[n].length=0}},13475:(n,y,H)=>{n.exports=G;var o=H(12190);function G(n,y){if(!(this instanceof G))return new G(n,y);var H=o.create();o.add(H,n,y),this.base=o.min(o.create(),n,H),this.mV=o.clone(y),this.max=o.max(o.create(),n,H),this.mag=o.length(this.mV)}var h=G.prototype;h.width=function(){return this.mV[0]},h.height=function(){return this.mV[1]},h.depth=function(){return this.mV[2]},h.x0=function(){return this.base[0]},h.y0=function(){return this.base[1]},h.z0=function(){return this.base[2]},h.x1=function(){return this.max[0]},h.y1=function(){return this.max[1]},h.z1=function(){return this.max[2]},h.translate=function(n){return o.add(this.max,this.max,n),o.add(this.base,this.base,n),this},h.setPosition=function(n){return o.add(this.max,n,this.mV),o.j(this.base,n),this},h.expand=function(n){var y=o.create(),H=o.create();return o.max(y,n.max,this.max),o.min(H,n.base,this.base),o.Qy(y,y,H),new G(H,y)},h.intersects=function(n){return!(n.base[0]>this.max[0])&&(!(n.base[1]>this.max[1])&&(!(n.base[2]>this.max[2])&&(!(n.max[0]<this.base[0])&&(!(n.max[1]<this.base[1])&&!(n.max[2]<this.base[2])))))},h.touches=function(n){var y=this.union(n);return null!==y&&(0==y.width()||0==y.height()||0==y.depth())},h.union=function(n){if(!this.intersects(n))return null;var y=Math.max(n.base[0],this.base[0]),H=Math.max(n.base[1],this.base[1]),o=Math.max(n.base[2],this.base[2]);return new G([y,H,o],[Math.min(n.max[0],this.max[0])-y,Math.min(n.max[1],this.max[1])-H,Math.min(n.max[2],this.max[2])-o])}},13393:(n,y)=>{"use strict";function H(n){var y=32;return(n&=-n)&&y--,65535&n&&(y-=16),16711935&n&&(y-=8),252645135&n&&(y-=4),858993459&n&&(y-=2),1431655765&n&&(y-=1),y}y.INT_BITS=32,y.INT_MAX=2147483647,y.INT_MIN=-1<<31,y.sign=function(n){return(n>0)-(n<0)},y.abs=function(n){var y=n>>31;return(n^y)-y},y.min=function(n,y){return y^(n^y)&-(n<y)},y.max=function(n,y){return n^(n^y)&-(n<y)},y.isPow2=function(n){return!(n&n-1)&&!!n},y.log2=function(n){var y,H;return y=(n>65535)<<4,y|=H=((n>>>=y)>255)<<3,y|=H=((n>>>=H)>15)<<2,(y|=H=((n>>>=H)>3)<<1)|(n>>>=H)>>1},y.log10=function(n){return n>=1e9?9:n>=1e8?8:n>=1e7?7:n>=1e6?6:n>=1e5?5:n>=1e4?4:n>=1e3?3:n>=100?2:n>=10?1:0},y.popCount=function(n){return 16843009*((n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135)>>>24},y.countTrailingZeros=H,y.nextPow2=function(n){return n+=0===n,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,(n|=n>>>16)+1},y.prevPow2=function(n){return n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,(n|=n>>>16)-(n>>>1)},y.parity=function(n){return n^=n>>>16,n^=n>>>8,n^=n>>>4,27030>>>(n&=15)&1};var o=new Array(256);!function(n){for(var y=0;y<256;++y){var H=y,o=y,G=7;for(H>>>=1;H;H>>>=1)o<<=1,o|=1&H,--G;n[y]=o<<G&255}}(o),y.reverse=function(n){return o[255&n]<<24|o[n>>>8&255]<<16|o[n>>>16&255]<<8|o[n>>>24&255]},y.interleave2=function(n,y){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n&=65535)|n<<8))|n<<4))|n<<2))|n<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))<<1},y.deinterleave2=function(n,y){return(n=65535&((n=16711935&((n=252645135&((n=858993459&((n=n>>>y&1431655765)|n>>>1))|n>>>2))|n>>>4))|n>>>16))<<16>>16},y.interleave3=function(n,y,H){return n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2),(n|=(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},y.deinterleave3=function(n,y){return(n=1023&((n=4278190335&((n=251719695&((n=3272356035&((n=n>>>y&1227133513)|n>>>2))|n>>>4))|n>>>8))|n>>>16))<<22>>22},y.nextCombination=function(n){var y=n|n-1;return y+1|(~y&-~y)-1>>>H(n)+1}},13378:(n,y,H)=>{"use strict";n.exports=function(n,y,H){switch(arguments.length){case 1:return o=[],V(G=n,G,q,!0),o;case 2:return"function"===typeof y?V(n,n,y,!0):function(n,y){return o=[],V(n,y,q,!1),o}(n,y);case 3:return V(n,y,H,!1);default:throw new Error("box-intersect: Invalid arguments")}var G};var o,G=H(13384),h=H(13413),k=H(13423);function i(n,y){for(var H=0;H<n;++H)if(!(y[H]<=y[H+n]))return!0;return!1}function B(n,y,H,o){for(var G=0,h=0,k=0,B=n.length;k<B;++k){var V=n[k];if(!i(y,V)){for(var q=0;q<2*y;++q)H[G++]=V[q];o[h++]=k}}return h}function V(n,y,H,o){var i=n.length,V=y.length;if(!(i<=0||V<=0)){var q=n[0].length>>>1;if(!(q<=0)){var b,A=G.mallocDouble(2*q*i),U=G.mallocInt32(i);if((i=B(n,q,A,U))>0){if(1===q&&o)h.init(i),b=h.sweepComplete(q,H,0,i,A,U,0,i,A,U);else{var T=G.mallocDouble(2*q*V),W=G.mallocInt32(V);(V=B(y,q,T,W))>0&&(h.init(i+V),b=1===q?h.sweepBipartite(q,H,0,i,A,U,0,V,T,W):k(q,H,o,i,A,U,V,T,W),G.free(T),G.free(W))}G.free(A),G.free(U)}return b}}}function q(n,y){o.push([n,y])}},13428:(n,y)=>{"use strict";var H="d",o="ax",G="fp",h="es",k="rs",i="re",B="rb",V="bs",q="be",b="bb",A=[H,o,"vv",k,i,B,"ri",V,q,b,"bi"];function U(n){var y="bruteForce"+(n?"Full":"Partial"),o=[],k=A.slice();n||k.splice(3,0,G);var i=["function "+y+"("+k.join()+"){"];function B(y,G){var k=function(n,y,o){var G="bruteForce"+(n?"Red":"Blue")+(y?"Flip":"")+(o?"Full":""),k=["function ",G,"(",A.join(),"){","var ",h,"=2*",H,";"],i="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",B="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(o?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return n?k.push(i,"Q",":",B):k.push(B,"Q",":",i),o?k.push("if(y1<x0||x1<y0)continue;"):y?k.push("if(y0<=x0||x1<y0)continue;"):k.push("if(y0<x0||x1<y0)continue;"),k.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),y?k.push("yi,xi"):k.push("xi,yi"),k.push(");if(rv!==void 0)return rv;}}}"),{name:G,code:k.join("")}}(y,G,n);o.push(k.code),i.push("return "+k.name+"("+A.join()+");")}i.push("if(re-rs>be-bs){"),n?(B(!0,!1),i.push("}else{"),B(!1,!1)):(i.push("if(fp){"),B(!0,!0),i.push("}else{"),B(!0,!1),i.push("}}else{if(fp){"),B(!1,!0),i.push("}else{"),B(!1,!1),i.push("}")),i.push("}}return "+y);var V=o.join("")+i.join("");return new Function(V)()}y.partial=U(!1),y.full=U(!0)},13423:(n,y,H)=>{"use strict";n.exports=function(n,y,H,h,q,X,d,a,O){!function(n,y){var H=8*G.log2(y+1)*(n+1)|0,h=G.nextPow2(F*H);M.length<h&&(o.free(M),M=o.mallocInt32(h));var k=G.nextPow2(g*H);f.length<k&&(o.free(f),f=o.mallocDouble(k))}(n,h+d);var e,w=0,j=2*n;c(w++,0,0,h,0,d,H?16:0,-1/0,1/0),H||c(w++,0,0,d,0,h,1,-1/0,1/0);for(;w>0;){var I=(w-=1)*F,R=M[I],C=M[I+1],S=M[I+2],N=M[I+3],r=M[I+4],K=M[I+5],Y=w*g,D=f[Y],Z=f[Y+1],s=1&K,P=!!(16&K),x=q,t=X,u=a,L=O;if(s&&(x=a,t=O,u=q,L=X),!(2&K&&C>=(S=z(n,R,C,S,x,t,Z)))&&!(4&K&&(C=Q(n,R,C,S,x,t,D))>=S)){var J=S-C,m=r-N;if(P){if(n*J*(J+m)<U){if(void 0!==(e=B.scanComplete(n,R,y,C,S,x,t,N,r,u,L)))return e;continue}}else{if(n*Math.min(J,m)<b){if(void 0!==(e=k(n,R,y,s,C,S,x,t,N,r,u,L)))return e;continue}if(n*J*m<A){if(void 0!==(e=B.scanBipartite(n,R,y,s,C,S,x,t,N,r,u,L)))return e;continue}}var nn=T(n,R,C,S,x,t,D,Z);if(C<nn)if(n*(nn-C)<b){if(void 0!==(e=i(n,R+1,y,C,nn,x,t,N,r,u,L)))return e}else if(R===n-2){if(void 0!==(e=s?B.sweepBipartite(n,y,N,r,u,L,C,nn,x,t):B.sweepBipartite(n,y,C,nn,x,t,N,r,u,L)))return e}else c(w++,R+1,C,nn,N,r,s,-1/0,1/0),c(w++,R+1,N,r,C,nn,1^s,-1/0,1/0);if(nn<S){var yn=V(n,R,N,r,u,L),Hn=u[j*yn+R],on=W(n,R,yn,r,u,L,Hn);if(on<r&&c(w++,R,nn,S,on,r,(4|s)+(P?16:0),Hn,Z),N<yn&&c(w++,R,nn,S,N,yn,(2|s)+(P?16:0),D,Hn),yn+1===on){if(void 0!==(e=P?E(n,R,y,nn,S,x,t,yn,u,L[yn]):p(n,R,y,s,nn,S,x,t,yn,u,L[yn])))return e}else if(yn<on){var Gn;if(P){if(nn<(Gn=l(n,R,nn,S,x,t,Hn))){var hn=W(n,R,nn,Gn,x,t,Hn);if(R===n-2){if(nn<hn&&void 0!==(e=B.sweepComplete(n,y,nn,hn,x,t,yn,on,u,L)))return e;if(hn<Gn&&void 0!==(e=B.sweepBipartite(n,y,hn,Gn,x,t,yn,on,u,L)))return e}else nn<hn&&c(w++,R+1,nn,hn,yn,on,16,-1/0,1/0),hn<Gn&&(c(w++,R+1,hn,Gn,yn,on,0,-1/0,1/0),c(w++,R+1,yn,on,hn,Gn,1,-1/0,1/0))}}else nn<(Gn=s?v(n,R,nn,S,x,t,Hn):l(n,R,nn,S,x,t,Hn))&&(R===n-2?e=s?B.sweepBipartite(n,y,yn,on,u,L,nn,Gn,x,t):B.sweepBipartite(n,y,nn,Gn,x,t,yn,on,u,L):(c(w++,R+1,nn,Gn,yn,on,s,-1/0,1/0),c(w++,R+1,yn,on,nn,Gn,1^s,-1/0,1/0)))}}}}};var o=H(13384),G=H(13393),h=H(13428),k=h.partial,i=h.full,B=H(13413),V=H(13430),q=H(13437),b=128,A=1<<22,U=1<<22,T=q("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),W=q("lo===p0",["p0"]),z=q("lo<p0",["p0"]),Q=q("hi<=p0",["p0"]),l=q("lo<=p0&&p0<=hi",["p0"]),v=q("lo<p0&&p0<=hi",["p0"]),F=6,g=2,M=o.mallocInt32(1024),f=o.mallocDouble(1024);function c(n,y,H,o,G,h,k,i,B){var V=F*n;M[V]=y,M[V+1]=H,M[V+2]=o,M[V+3]=G,M[V+4]=h,M[V+5]=k;var q=g*n;f[q]=i,f[q+1]=B}function p(n,y,H,o,G,h,k,i,B,V,q){var b=2*n,A=B*b,U=V[A+y];n:for(var T=G,W=G*b;T<h;++T,W+=b){var z=k[W+y],Q=k[W+y+n];if(!(U<z||Q<U)&&(!o||U!==z)){for(var l,v=i[T],F=y+1;F<n;++F){z=k[W+F],Q=k[W+F+n];var g=V[A+F],M=V[A+F+n];if(Q<g||M<z)continue n}if(void 0!==(l=o?H(q,v):H(v,q)))return l}}}function E(n,y,H,o,G,h,k,i,B,V){var q=2*n,b=i*q,A=B[b+y];n:for(var U=o,T=o*q;U<G;++U,T+=q){var W=k[U];if(W!==V){var z=h[T+y],Q=h[T+y+n];if(!(A<z||Q<A)){for(var l=y+1;l<n;++l){z=h[T+l],Q=h[T+l+n];var v=B[b+l],F=B[b+l+n];if(Q<v||F<z)continue n}var g=H(W,V);if(void 0!==g)return g}}}}},13430:(n,y,H)=>{"use strict";n.exports=function(n,y,H,k,i,B){if(k<=H+1)return H;var V=H,q=k,b=k+H>>>1,A=2*n,U=b,T=i[A*b+y];for(;V<q;){if(q-V<G){h(n,y,V,q,i,B),T=i[A*b+y];break}var W=q-V,z=Math.random()*W+V|0,Q=i[A*z+y],l=Math.random()*W+V|0,v=i[A*l+y],F=Math.random()*W+V|0,g=i[A*F+y];Q<=v?g>=v?(U=l,T=v):Q>=g?(U=z,T=Q):(U=F,T=g):v>=g?(U=l,T=v):g>=Q?(U=z,T=Q):(U=F,T=g);for(var M=A*(q-1),f=A*U,c=0;c<A;++c,++M,++f){var p=i[M];i[M]=i[f],i[f]=p}var E=B[q-1];B[q-1]=B[U],B[U]=E;for(M=A*(q-1),f=A*(U=o(n,y,V,q-1,i,B,T)),c=0;c<A;++c,++M,++f){p=i[M];i[M]=i[f],i[f]=p}E=B[q-1];if(B[q-1]=B[U],B[U]=E,b<U){for(q=U-1;V<q&&i[A*(q-1)+y]===T;)q-=1;q+=1}else{if(!(U<b))break;for(V=U+1;V<q&&i[A*V+y]===T;)V+=1}}return o(n,y,H,b,i,B,i[A*b+y])};var o=H(13437)("lo<p0",["p0"]),G=8;function h(n,y,H,o,G,h){for(var k=2*n,i=k*(H+1)+y,B=H+1;B<o;++B,i+=k)for(var V=G[i],q=B,b=k*(B-1);q>H&&G[b+y]>V;--q,b-=k){for(var A=b,U=b+k,T=0;T<k;++T,++A,++U){var W=G[A];G[A]=G[U],G[U]=W}var z=h[q];h[q]=h[q-1],h[q-1]=z}}},13437:n=>{"use strict";n.exports=function(n,H){var o="abcdef".split("").concat(H),G=[];n.indexOf("lo")>=0&&G.push("lo=e[k+n]");n.indexOf("hi")>=0&&G.push("hi=e[k+o]");return o.push(y.replace("_",G.join()).replace("$",n)),Function.apply(void 0,o)};var y="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13418:n=>{"use strict";n.exports=function(n,o){o<=4*y?H(0,o-1,n):V(0,o-1,n)};var y=32;function H(n,y,H){for(var o=2*(n+1),G=n+1;G<=y;++G){for(var h=H[o++],k=H[o++],i=G,B=o-2;i-- >n;){var V=H[B-2],q=H[B-1];if(V<h)break;if(V===h&&q<k)break;H[B]=V,H[B+1]=q,B-=2}H[B]=h,H[B+1]=k}}function o(n,y,H){y*=2;var o=H[n*=2],G=H[n+1];H[n]=H[y],H[n+1]=H[y+1],H[y]=o,H[y+1]=G}function G(n,y,H){y*=2,H[n*=2]=H[y],H[n+1]=H[y+1]}function h(n,y,H,o){y*=2,H*=2;var G=o[n*=2],h=o[n+1];o[n]=o[y],o[n+1]=o[y+1],o[y]=o[H],o[y+1]=o[H+1],o[H]=G,o[H+1]=h}function k(n,y,H,o,G){y*=2,G[n*=2]=G[y],G[y]=H,G[n+1]=G[y+1],G[y+1]=o}function i(n,y,H){y*=2;var o=H[n*=2],G=H[y];return!(o<G)&&(o!==G||H[n+1]>H[y+1])}function B(n,y,H,o){var G=o[n*=2];return G<y||G===y&&o[n+1]<H}function V(n,q,b){var A=(q-n+1)/6|0,U=n+A,T=q-A,W=n+q>>1,z=W-A,Q=W+A,l=U,v=z,F=W,g=Q,M=T,f=n+1,c=q-1,p=0;i(l,v,b)&&(p=l,l=v,v=p),i(g,M,b)&&(p=g,g=M,M=p),i(l,F,b)&&(p=l,l=F,F=p),i(v,F,b)&&(p=v,v=F,F=p),i(l,g,b)&&(p=l,l=g,g=p),i(F,g,b)&&(p=F,F=g,g=p),i(v,M,b)&&(p=v,v=M,M=p),i(v,F,b)&&(p=v,v=F,F=p),i(g,M,b)&&(p=g,g=M,M=p);for(var E=b[2*v],X=b[2*v+1],d=b[2*g],a=b[2*g+1],O=2*l,e=2*F,w=2*M,j=2*U,I=2*W,R=2*T,C=0;C<2;++C){var S=b[O+C],N=b[e+C],r=b[w+C];b[j+C]=S,b[I+C]=N,b[R+C]=r}G(z,n,b),G(Q,q,b);for(var K=f;K<=c;++K)if(B(K,E,X,b))K!==f&&o(K,f,b),++f;else if(!B(K,d,a,b))for(;;){if(B(c,d,a,b)){B(c,E,X,b)?(h(K,f,c,b),++f,--c):(o(K,c,b),--c);break}if(--c<K)break}k(n,f-1,E,X,b),k(q,c+1,d,a,b),f-2-n<=y?H(n,f-2,b):V(n,f-2,b),q-(c+2)<=y?H(c+2,q,b):V(c+2,q,b),c-f<=y?H(f,c,b):V(f,c,b)}},13413:(n,y,H)=>{"use strict";n.exports={init:function(n){var y=G.nextPow2(n);B.length<y&&(o.free(B),B=o.mallocInt32(y));V.length<y&&(o.free(V),V=o.mallocInt32(y));q.length<y&&(o.free(q),q=o.mallocInt32(y));b.length<y&&(o.free(b),b=o.mallocInt32(y));A.length<y&&(o.free(A),A=o.mallocInt32(y));U.length<y&&(o.free(U),U=o.mallocInt32(y));var H=8*y;T.length<H&&(o.free(T),T=o.mallocDouble(H))},sweepBipartite:function(n,y,H,o,G,i,A,U,Q,l){for(var v=0,F=2*n,g=n-1,M=F-1,f=H;f<o;++f){var c=i[f],p=F*f;T[v++]=G[p+g],T[v++]=-(c+1),T[v++]=G[p+M],T[v++]=c}for(f=A;f<U;++f){c=l[f]+k;var E=F*f;T[v++]=Q[E+g],T[v++]=-c,T[v++]=Q[E+M],T[v++]=c}var X=v>>>1;h(T,X);var d=0,a=0;for(f=0;f<X;++f){var O=0|T[2*f+1];if(O>=k)W(q,b,a--,O=O-k|0);else if(O>=0)W(B,V,d--,O);else if(O<=-k){O=-O-k|0;for(var e=0;e<d;++e){if(void 0!==(w=y(B[e],O)))return w}z(q,b,a++,O)}else{O=-O-1|0;for(e=0;e<a;++e){var w;if(void 0!==(w=y(O,q[e])))return w}z(B,V,d++,O)}}},sweepComplete:function(n,y,H,o,G,k,i,Q,l,v){for(var F=0,g=2*n,M=n-1,f=g-1,c=H;c<o;++c){var p=k[c]+1<<1,E=g*c;T[F++]=G[E+M],T[F++]=-p,T[F++]=G[E+f],T[F++]=p}for(c=i;c<Q;++c){p=v[c]+1<<1;var X=g*c;T[F++]=l[X+M],T[F++]=1|-p,T[F++]=l[X+f],T[F++]=1|p}var d=F>>>1;h(T,d);var a=0,O=0,e=0;for(c=0;c<d;++c){var w=0|T[2*c+1],j=1&w;if(c<d-1&&w>>1===T[2*c+3]>>1&&(j=2,c+=1),w<0){for(var I=-(w>>1)-1,R=0;R<e;++R){if(void 0!==(C=y(A[R],I)))return C}if(0!==j)for(R=0;R<a;++R){if(void 0!==(C=y(B[R],I)))return C}if(1!==j)for(R=0;R<O;++R){var C;if(void 0!==(C=y(q[R],I)))return C}0===j?z(B,V,a++,I):1===j?z(q,b,O++,I):2===j&&z(A,U,e++,I)}else{I=(w>>1)-1;0===j?W(B,V,a--,I):1===j?W(q,b,O--,I):2===j&&W(A,U,e--,I)}}},scanBipartite:function(n,y,H,o,G,i,q,b,A,U,Q,l){var v=0,F=2*n,g=y,M=y+n,f=1,c=1;o?c=k:f=k;for(var p=G;p<i;++p){var E=p+f,X=F*p;T[v++]=q[X+g],T[v++]=-E,T[v++]=q[X+M],T[v++]=E}for(p=A;p<U;++p){E=p+c;var d=F*p;T[v++]=Q[d+g],T[v++]=-E}var a=v>>>1;h(T,a);var O=0;for(p=0;p<a;++p){var e=0|T[2*p+1];if(e<0){var w=!1;if((E=-e)>=k?(w=!o,E-=k):(w=!!o,E-=1),w)z(B,V,O++,E);else{var j=l[E],I=F*E,R=Q[I+y+1],C=Q[I+y+1+n];n:for(var S=0;S<O;++S){var N=B[S],r=F*N;if(!(C<q[r+y+1]||q[r+y+1+n]<R)){for(var K=y+2;K<n;++K)if(Q[I+K+n]<q[r+K]||q[r+K+n]<Q[I+K])continue n;var Y,D=b[N];if(void 0!==(Y=o?H(j,D):H(D,j)))return Y}}}}else W(B,V,O--,e-f)}},scanComplete:function(n,y,H,o,G,i,V,q,b,A,U){for(var W=0,z=2*n,Q=y,l=y+n,v=o;v<G;++v){var F=v+k,g=z*v;T[W++]=i[g+Q],T[W++]=-F,T[W++]=i[g+l],T[W++]=F}for(v=q;v<b;++v){F=v+1;var M=z*v;T[W++]=A[M+Q],T[W++]=-F}var f=W>>>1;h(T,f);var c=0;for(v=0;v<f;++v){var p=0|T[2*v+1];if(p<0){if((F=-p)>=k)B[c++]=F-k;else{var E=U[F-=1],X=z*F,d=A[X+y+1],a=A[X+y+1+n];n:for(var O=0;O<c;++O){var e=B[O],w=V[e];if(w===E)break;var j=z*e;if(!(a<i[j+y+1]||i[j+y+1+n]<d)){for(var I=y+2;I<n;++I)if(A[X+I+n]<i[j+I]||i[j+I+n]<A[X+I])continue n;var R=H(w,E);if(void 0!==R)return R}}}}else{for(F=p-k,O=c-1;O>=0;--O)if(B[O]===F){for(I=O+1;I<c;++I)B[I-1]=B[I];break}--c}}}};var o=H(13384),G=H(13393),h=H(13418),k=1<<28,i=1024,B=o.mallocInt32(i),V=o.mallocInt32(i),q=o.mallocInt32(i),b=o.mallocInt32(i),A=o.mallocInt32(i),U=o.mallocInt32(i),T=o.mallocDouble(8192);function W(n,y,H,o){var G=y[o],h=n[H-1];n[G]=h,y[h]=G}function z(n,y,H,o){n[H]=o,y[o]=H}},13401:n=>{"use strict";function y(n,H,o){var G=0|n[o];if(G<=0)return[];var h,k=new Array(G);if(o===n.length-1)for(h=0;h<G;++h)k[h]=H;else for(h=0;h<G;++h)k[h]=y(n,H,o+1);return k}n.exports=function(n,H){switch("undefined"===typeof H&&(H=0),typeof n){case"number":if(n>0)return function(n,y){var H,o;for(H=new Array(n),o=0;o<n;++o)H[o]=y;return H}(0|n,H);break;case"object":if("number"===typeof n.length)return y(n,H,0)}return[]}},13352:(n,y,H)=>{n.exports=function(){var n=this;this.components={},this.comps=this.components;var y=this.components,H=1,G={},h=[],k=[],i={timeout:!1,removals:[],multiComps:[]};function B(n,H){var o=y[H],h=G[H],k=h.hash[n];k&&(h.remove(n),o.py&&(o.multi?(k.forEach((y=>{y&&o.py(n,y)})),k.length=0):o.py(n,k)),i.removals.push(h),V())}function V(){i.timeout||(i.timeout=!0,setTimeout(q,1))}function q(){i.timeout=!1,b()}function b(){i.multiComps.length&&function(n){for(var y=0;y<n.length;y++){var{entID:H,data:o}=n[y],G=o.hash[H];if(G){for(var h=0;h<G.length;h++)G[h]||(G.splice(h,1),h--);0===G.length&&(o.remove(H),i.removals.push(o))}}n.length=0}(i.multiComps),i.removals.length&&function(n){for(var y=0;y<n.length;y++){n[y].flush()}n.length=0}(i.removals)}this.HA=G,this._systems=h,this._renderSystems=k,this.Hq=function(y){var o=H++;return Array.isArray(y)&&y.forEach((y=>n.NB(o,y))),o},this.deleteEntity=function(y){return Object.keys(G).forEach((n=>{G[n].hash[y]&&B(y,n)})),n},this.Qq=function(n){if(!n)throw new Error("Missing component definition");var H=n.name;if(!H)throw new Error("Component definition must have a name property.");if("string"!==typeof H)throw new Error("Component name must be a string.");if(""===H)throw new Error("Component name must be a non-empty string.");if(G[H])throw new Error(`Component ${H} already exists.`);var i={};return i.name=H,i.multi=!!n.multi,i.order=isNaN(n.order)?99:n.order,i.stateConstructor=n.stateConstructor||null,i.state=n.state||{},i.Ci=n.Ci||null,i.py=n.py||null,i.system=n.system||null,i.Di=n.Di||null,y[H]=i,G[H]=new o,G[H]._pendingMultiCleanup=!1,G[H]._multiCleanupIDs=i.multi?[]:null,i.system&&(h.push(H),h.sort(((n,H)=>y[n].order-y[H].order))),i.Di&&(k.push(H),k.sort(((n,H)=>y[n].order-y[H].order))),H},this.overwriteComponent=function(n,H){var o=y[n];if(!o)throw new Error(`Unknown component: ${n}`);if(!H)throw new Error("Missing component definition");if(o.name!==H.name)throw new Error("Overwriting component must use the same name property.");var i={};i.name=n,i.multi=!!H.multi,i.order=isNaN(H.order)?99:H.order,i.state=H.state||{},i.Ci=H.Ci||null,i.py=H.py||null,i.system=H.system||null,i.Di=H.Di||null,y[n]=i,G[n]._pendingMultiCleanup=!1,G[n]._multiCleanupIDs=i.multi?[]:null;var B=h.indexOf(n);i.system&&B<0&&h.push(n),!i.system&&B>=0&&h.splice(B,1),h.sort(((n,H)=>y[n].order-y[H].order));var V=k.indexOf(n);i.Di&&V<0&&k.push(n),!i.Di&&V>=0&&k.splice(V,1),k.sort(((n,H)=>y[n].order-y[H].order));var q=i.state;return this.CV(n).forEach((n=>{for(var y in q)y in n||(n[y]=q[y]);i.Ci&&i.Ci(n.Ki,n)})),n},this.deleteComponent=function(H){var o=G[H];if(!o)throw new Error(`Unknown component: ${H}`);o.flush(),o.list.forEach((n=>{n&&B(n.Ki||n[0].Ki,H)}));var i=h.indexOf(H),V=k.indexOf(H);return i>-1&&h.splice(i,1),V>-1&&k.splice(V,1),G[H].dispose(),delete G[H],delete y[H],n},this.NB=function(n,H,o){var h,k=y[H],i=G[H];if(!i)throw new Error(`Unknown component: ${H}.`);if(i.hash[n]&&!k.multi)throw new Error(`Entity ${n} already has component: ${H}.`);if(k.stateConstructor){if(!(h=new k.stateConstructor).hasOwnProperty("Ki"))throw new Error(`Component ${k.name} stateConstructor type does not have property __id`)}else h=Object.assign({},{Ki:n},k.state,o);if(h.Ki=n,k.multi){var B=i.hash[n];B||(B=[],i.add(n,B)),B.push(h)}else i.add(n,h);return k.Ci&&k.Ci(n,h),this},this.uB=function(n,y){var H=G[y];if(!H)throw new Error(`Unknown component: ${y}.`);return!!H.hash[n]},this.DB=function(y,H){if(!G[H])throw new Error(`Unknown component: ${H}.`);return B(y,H),n},this.getState=function(n,y){var H=G[y];if(!H)throw new Error(`Unknown component: ${y}.`);return H.hash[n]},this.CV=function(n){var y=G[n];if(!y)throw new Error(`Unknown component: ${n}.`);return b(),y.list},this.DU=function(n){if(!G[n])throw new Error(`Unknown component: ${n}.`);var y=G[n].hash;return n=>y[n]},this.PU=function(n){if(!G[n])throw new Error(`Unknown component: ${n}.`);var y=G[n].hash;return n=>!!y[n]},this.Ai=function(H){b();for(var o=0;o<h.length;o++){var k=h[o],i=y[k],B=G[k];i.system(H,B.list),b()}return n},this.render=function(H){b();for(var o=0;o<k.length;o++){var h=k[o],i=y[h],B=G[h];i.Di(H,B.list),b()}return n},this.removeMultiComponent=function(H,o,h){var k=y[o],B=G[o];if(!B)throw new Error(`Unknown component: ${o}.`);if(!k.multi)throw new Error("removeMultiComponent called on non-multi component");return function(n,y,H,o){var G=H.hash[n];if(G){var h=G[o];h&&(G[o]=null,y.py&&y.py(n,h),i.multiComps.push({entID:n,data:H}),V())}}(H,k,B,h),n}};var o=H(13355)},13355:n=>{function y(n,y){var H=n._map[y];if(delete n.hash[y],delete n._map[y],H===n.list.length-1)n.list.pop();else{var o=n.list.pop();if(n.list[H]=o,null===o||null===o[0]){var G=n.list.length;for(var h in n._map)if(n._map[h]===G)return void(n._map[h]=H)}else{var k=o.Ki||o[0].Ki;n._map[k]=H}}}n.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(n,y){if("number"===typeof this._map[n]){var H=this._map[n];this.hash[n]=y,this.list[H]=y}else this._map[n]=this.list.length,this.hash[n]=y,this.list.push(y)}remove(n){var y=this._map[n];this.hash[n]=null,this.list[y]=null,this._pendingRemovals.push(n)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var n=0;n<this._pendingRemovals.length;n++){var H=this._pendingRemovals[n];null===this.hash[H]&&y(this,H)}this._pendingRemovals.length=0}}},13309:n=>{"use strict";var y,H="object"===typeof Reflect?Reflect:null,o=function(n,y,H){return Function.prototype.apply.call(n,y,H)};y=H&&"function"===typeof H.ownKeys?H.ownKeys:Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:function(n){return Object.getOwnPropertyNames(n)};var G=Number.isNaN||function(n){return n!==n};function h(){h.init.call(this)}n.exports=h,n.exports.once=function(n,y){return new Promise((function(H,o){function G(H){n.removeListener(y,h),o(H)}function h(){"function"===typeof n.removeListener&&n.removeListener("error",G),H([].slice.call(arguments))}W(n,y,h,{once:!0}),"error"!==y&&function(n,y,H){"function"===typeof n.on&&W(n,"error",y,H)}(n,G,{once:!0})}))},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var k=10;function i(n){if("function"!==typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}function B(n){return void 0===n._maxListeners?h.defaultMaxListeners:n._maxListeners}function V(n,y,H,o){var G,h,k,V;if(i(H),void 0===(h=n._events)?(h=n._events=Object.create(null),n._eventsCount=0):(void 0!==h.newListener&&(n.emit("newListener",y,H.listener?H.listener:H),h=n._events),k=h[y]),void 0===k)k=h[y]=H,++n._eventsCount;else if("function"===typeof k?k=h[y]=o?[H,k]:[k,H]:o?k.unshift(H):k.push(H),(G=B(n))>0&&k.length>G&&!k.warned){k.warned=!0;var q=new Error("Possible EventEmitter memory leak detected. "+k.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");q.name="MaxListenersExceededWarning",q.hy=n,q.type=y,q.count=k.length,V=q,console&&console.warn&&console.warn(V)}return n}function q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function b(n,y,H){var o={fired:!1,wrapFn:void 0,target:n,type:y,listener:H},G=q.bind(o);return G.listener=H,o.wrapFn=G,G}function A(n,y,H){var o=n._events;if(void 0===o)return[];var G=o[y];return void 0===G?[]:"function"===typeof G?H?[G.listener||G]:[G]:H?function(n){for(var y=new Array(n.length),H=0;H<y.length;++H)y[H]=n[H].listener||n[H];return y}(G):T(G,G.length)}function U(n){var y=this._events;if(void 0!==y){var H=y[n];if("function"===typeof H)return 1;if(void 0!==H)return H.length}return 0}function T(n,y){for(var H=new Array(y),o=0;o<y;++o)H[o]=n[o];return H}function W(n,y,H,o){if("function"===typeof n.on)o.once?n.once(y,H):n.on(y,H);else{if("function"!==typeof n.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n);n.addEventListener(y,(function G(h){o.once&&n.removeEventListener(y,G),H(h)}))}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return k},set:function(n){if("number"!==typeof n||n<0||G(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");k=n}}),h.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(n){if("number"!==typeof n||n<0||G(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},h.prototype.getMaxListeners=function(){return B(this)},h.prototype.emit=function(n){for(var y=[],H=1;H<arguments.length;H++)y.push(arguments[H]);var G="error"===n,h=this._events;if(void 0!==h)G=G&&void 0===h.error;else if(!G)return!1;if(G){var k;if(y.length>0&&(k=y[0]),k instanceof Error)throw k;var i=new Error("Unhandled error."+(k?" ("+k.message+")":""));throw i.context=k,i}var B=h[n];if(void 0===B)return!1;if("function"===typeof B)o(B,this,y);else{var V=B.length,q=T(B,V);for(H=0;H<V;++H)o(q[H],this,y)}return!0},h.prototype.addListener=function(n,y){return V(this,n,y,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(n,y){return V(this,n,y,!0)},h.prototype.once=function(n,y){return i(y),this.on(n,b(this,n,y)),this},h.prototype.prependOnceListener=function(n,y){return i(y),this.prependListener(n,b(this,n,y)),this},h.prototype.removeListener=function(n,y){var H,o,G,h,k;if(i(y),void 0===(o=this._events))return this;if(void 0===(H=o[n]))return this;if(H===y||H.listener===y)0===--this._eventsCount?this._events=Object.create(null):(delete o[n],o.removeListener&&this.emit("removeListener",n,H.listener||y));else if("function"!==typeof H){for(G=-1,h=H.length-1;h>=0;h--)if(H[h]===y||H[h].listener===y){k=H[h].listener,G=h;break}if(G<0)return this;0===G?H.shift():function(n,y){for(;y+1<n.length;y++)n[y]=n[y+1];n.pop()}(H,G),1===H.length&&(o[n]=H[0]),void 0!==o.removeListener&&this.emit("removeListener",n,k||y)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.ky=function(n){var y,H,o;if(void 0===(H=this._events))return this;if(void 0===H.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==H[n]&&(0===--this._eventsCount?this._events=Object.create(null):delete H[n]),this;if(0===arguments.length){var G,h=Object.keys(H);for(o=0;o<h.length;++o)"removeListener"!==(G=h[o])&&this.ky(G);return this.ky("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(y=H[n]))this.removeListener(n,y);else if(void 0!==y)for(o=y.length-1;o>=0;o--)this.removeListener(n,y[o]);return this},h.prototype.listeners=function(n){return A(this,n,!0)},h.prototype.rawListeners=function(n){return A(this,n,!1)},h.listenerCount=function(n,y){return"function"===typeof n.listenerCount?n.listenerCount(y):U.call(n,y)},h.prototype.listenerCount=U,h.prototype.eventNames=function(){return this._eventsCount>0?y(this._events):[]}},13612:n=>{"use strict";n.exports=function(n,y,H,o,G,h){var k=+y[0],i=+y[1],B=+y[2],V=+H[0],q=+H[1],b=+H[2],A=Math.sqrt(V*V+q*q+b*b);if(0===A)throw new Error("Can't raycast along a zero vector");return function(n,y,H,o,G,h,k,i,B,V){for(var q=0,b=Math.floor,A=0|b(y),U=0|b(H),T=0|b(o),W=G>0?1:-1,z=h>0?1:-1,Q=k>0?1:-1,l=Math.abs(1/G),v=Math.abs(1/h),F=Math.abs(1/k),g=l<1/0?l*(W>0?A+1-y:y-A):1/0,M=v<1/0?v*(z>0?U+1-H:H-U):1/0,f=F<1/0?F*(Q>0?T+1-o:o-T):1/0,c=-1;q<=i;){var p=n(A,U,T);if(p)return B&&(B[0]=y+q*G,B[1]=H+q*h,B[2]=o+q*k),V&&(V[0]=V[1]=V[2]=0,0===c&&(V[0]=-W),1===c&&(V[1]=-z),2===c&&(V[2]=-Q)),p;g<M?g<f?(A+=W,q=g,g+=l,c=0):(T+=Q,q=f,f+=F,c=2):M<f?(U+=z,q=M,M+=v,c=1):(T+=Q,q=f,f+=F,c=2)}return B&&(B[0]=y+q*G,B[1]=H+q*h,B[2]=o+q*k),V&&(V[0]=V[1]=V[2]=0),0}(n,k,i,B,V/=A,q/=A,b/=A,o="undefined"===typeof o?64:+o,G,h)}},13637:(n,y,H)=>{"use strict";H.d(y,{b:()=>h});var o=H(13309);function G(){this.ZA=!1,this.stopPropagation=!1,this.sA=!1,this.disabled=!1}class h{constructor(n,y){this.version="0.7.0";var H=Object.assign({},new G,y||{});this.element=n||document,this.ZA=!!H.ZA,this.stopPropagation=!!H.stopPropagation,this.sA=!!H.sA,this.disabled=!!H.disabled,this.filterEvents=(n,y)=>!0,this.down=new o.EventEmitter,this.up=new o.EventEmitter,this.state={},this.OV={dx:0,dy:0,jU:0,aV:0,IU:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?i(this):document.addEventListener("DOMContentLoaded",(n=>{i(this)}),{once:!0})}bind(n){for(var y=arguments.length,H=new Array(y>1?y-1:0),o=1;o<y;o++)H[o-1]=arguments[o];H.forEach((y=>{var H=this._keyBindmap[y]||[];H.includes(n)||(H.push(n),this._keyBindmap[y]=H)})),this.state[n]=!!this.state[n],this.pressCount[n]=this.pressCount[n]||0,this.releaseCount[n]=this.releaseCount[n]||0}unbind(n){for(var y in this._keyBindmap){var H=this._keyBindmap[y],o=H.indexOf(n);o>-1&&H.splice(o,1)}}getBindings(){var n={};for(var y in this._keyBindmap){this._keyBindmap[y].forEach((H=>{n[H]=n[H]||[],n[H].push(y)}))}return n}Ai(){k(this.OV),k(this.pressCount),k(this.releaseCount)}}function k(n){for(var y in n)n[y]=0}function i(n){window.addEventListener("keydown",T.bind(null,n,!0),!1),window.addEventListener("keyup",T.bind(null,n,!1),!1);var y={passive:!0};n.element.addEventListener("touchstart",b.bind(void 0,n),{passive:!1}),n.element.addEventListener("touchend",U.bind(void 0,n),y),n.element.addEventListener("mousedown",W.bind(null,n,!0),y),window.document.addEventListener("mouseup",W.bind(null,n,!1),y),n.element.addEventListener("touchmove",z.bind(null,n),y),n.element.addEventListener("mousemove",z.bind(null,n),y),window.PointerEvent,n.element.addEventListener("wheel",Q.bind(null,n),y),n.element.addEventListener("contextmenu",l.bind(null,n),!1),window.addEventListener("blur",v.bind(null,n),!1)}var B=0,V=0,q=null;function b(n,y){y.preventDefault(),A(y)}function A(n){let y=!1;for(let H=0;H<n.touches.length;++H)if(n.touches[H].identifier===q){y=!0;break}if(!y){const y=n.changedTouches[0];B=y.clientX,V=y.clientY,q=y.identifier}}function U(n,y){for(var H=y.changedTouches,o=0;o<H.length;++o)H[o].identifier===q&&(q=null)}function T(n,y,H){F(H.code,y,n,H)}function W(n,y,H){if("pointerId"in H)if(y){if(null!==n._touches.currID)return;n._touches.currID=H.pointerId}else{if(n._touches.currID!==H.pointerId)return;n._touches.currID=null}return F("Mouse"+("button"in H?H.button+1:1),y,n,H),!1}function z(n,y){var H=y.movementX||y.mozMovementX||0,o=y.movementY||y.mozMovementY||0;if(y.touches&&0===(H|o)){var G=function(n){A(n);for(let y=0;y<n.changedTouches.length;++y)if(n.changedTouches[y].identifier==q){const H=n.changedTouches[y],o=[H.clientX-B,H.clientY-V];return B=H.clientX,V=H.clientY,o}return console.error(`Did not find touch id ${q}`),[0,0]}(y);H=G[0],o=G[1]}n.OV.dx+=H,n.OV.dy+=o}function Q(n,y){var H=1;switch(y.deltaMode){case 0:H=1;break;case 1:H=12;break;case 2:H=n.element.clientHeight||window.innerHeight}n.OV.jU+=(y.deltaX||0)*H,n.OV.aV+=(y.deltaY||0)*H,n.OV.IU+=(y.deltaZ||0)*H}function l(n,y){if(!n.sA)return y.preventDefault(),!1}function v(n){for(var y in n._keyStates)n._keyStates[y]&&(/^Mouse\d/.test(y)||F(y,!1,n,{code:y,note:"cuonfkzmcxk",preventDefault:()=>{},stopPropagation:()=>{}}))}function F(n,y,H,o){var G=H._keyBindmap[n];G&&(g(H._keyStates[n],y)&&(H._keyStates[n]=y,G.forEach((n=>{(!H.filterEvents||H.filterEvents(o,n))&&function(n,y,H,o){var G=y?H.pressCount:H.releaseCount;G[n]=(G[n]||0)+1;var h=H._bindPressCount[n]||0;(h+=y?1:-1)<0&&(h=0);H._bindPressCount[n]=h;var k=H.state[n];if(g(k,h)){H.state[n]=h>0;var i=y?H.down:H.up;H.disabled||i.emit(n,o)}}(n,y,H,o)}))),"button"in o||(H.ZA&&!o.defaultPrevented&&o.preventDefault(),H.stopPropagation&&o.stopPropagation()))}function g(n,y){return n?!y:y}},12253:n=>{n.exports=function(n,y,H){return n[0]=y[0]+H[0],n[1]=y[1]+H[1],n[2]=y[2]+H[2],n}},12211:(n,y,H)=>{n.exports=function(n,y){var H=o(n[0],n[1],n[2]),k=o(y[0],y[1],y[2]);G(H,H),G(k,k);var i=h(H,k);return i>1?0:Math.acos(i)};var o=H(12219),G=H(12221),h=H(12225)},12306:n=>{n.exports=function(n,y){return n[0]=Math.ceil(y[0]),n[1]=Math.ceil(y[1]),n[2]=Math.ceil(y[2]),n}},12208:n=>{n.exports=function(n){var y=new Float32Array(3);return y[0]=n[0],y[1]=n[1],y[2]=n[2],y}},12232:n=>{n.exports=function(n,y){return n[0]=y[0],n[1]=y[1],n[2]=y[2],n}},12203:n=>{n.exports=function(){var n=new Float32Array(3);return n[0]=0,n[1]=0,n[2]=0,n}},12394:n=>{n.exports=function(n,y,H){var o=y[0],G=y[1],h=y[2],k=H[0],i=H[1],B=H[2];return n[0]=G*B-h*i,n[1]=h*k-o*B,n[2]=o*i-G*k,n}},12337:(n,y,H)=>{n.exports=H(12331)},12331:n=>{n.exports=function(n,y){var H=y[0]-n[0],o=y[1]-n[1],G=y[2]-n[2];return Math.sqrt(H*H+o*o+G*G)}},12278:(n,y,H)=>{n.exports=H(12274)},12274:n=>{n.exports=function(n,y,H){return n[0]=y[0]/H[0],n[1]=y[1]/H[1],n[2]=y[2]/H[2],n}},12225:n=>{n.exports=function(n,y){return n[0]*y[0]+n[1]*y[1]+n[2]*y[2]}},12199:n=>{n.exports=1e-6},12244:(n,y,H)=>{n.exports=function(n,y){var H=n[0],G=n[1],h=n[2],k=y[0],i=y[1],B=y[2];return Math.abs(H-k)<=o*Math.max(1,Math.abs(H),Math.abs(k))&&Math.abs(G-i)<=o*Math.max(1,Math.abs(G),Math.abs(i))&&Math.abs(h-B)<=o*Math.max(1,Math.abs(h),Math.abs(B))};var o=H(12199)},12248:n=>{n.exports=function(n,y){return n[0]===y[0]&&n[1]===y[1]&&n[2]===y[2]}},12299:n=>{n.exports=function(n,y){return n[0]=Math.floor(y[0]),n[1]=Math.floor(y[1]),n[2]=Math.floor(y[2]),n}},12433:(n,y,H)=>{n.exports=function(n,y,H,G,h,k){var i,B;y||(y=3);H||(H=0);B=G?Math.min(G*y+H,n.length):n.length;for(i=H;i<B;i+=y)o[0]=n[i],o[1]=n[i+1],o[2]=n[i+2],h(o,o,k),n[i]=o[0],n[i+1]=o[1],n[i+2]=o[2];return n};var o=H(12203)()},12219:n=>{n.exports=function(n,y,H){var o=new Float32Array(3);return o[0]=n,o[1]=y,o[2]=H,o}},12190:(n,y,H)=>{n.exports={EPSILON:H(12199),create:H(12203),clone:H(12208),angle:H(12211),oi:H(12219),j:H(12232),set:H(12236),equals:H(12244),exactEquals:H(12248),add:H(12253),Qy:H(12259),sub:H(12261),multiply:H(12265),mul:H(12268),divide:H(12274),div:H(12278),min:H(12287),max:H(12295),floor:H(12299),ceil:H(12306),round:H(12315),scale:H(12323),Gi:H(12328),distance:H(12331),k:H(12337),squaredDistance:H(12345),sqrDist:H(12350),length:H(12357),len:H(12362),squaredLength:H(12369),hi:H(12373),negate:H(12378),inverse:H(12386),normalize:H(12221),dot:H(12225),cross:H(12394),ni:H(12396),random:H(12399),transformMat4:H(12402),transformMat3:H(12408),transformQuat:H(12411),ki:H(12420),ii:H(12422),Bi:H(12426),forEach:H(12433)}},12386:n=>{n.exports=function(n,y){return n[0]=1/y[0],n[1]=1/y[1],n[2]=1/y[2],n}},12362:(n,y,H)=>{n.exports=H(12357)},12357:n=>{n.exports=function(n){var y=n[0],H=n[1],o=n[2];return Math.sqrt(y*y+H*H+o*o)}},12396:n=>{n.exports=function(n,y,H,o){var G=y[0],h=y[1],k=y[2];return n[0]=G+o*(H[0]-G),n[1]=h+o*(H[1]-h),n[2]=k+o*(H[2]-k),n}},12295:n=>{n.exports=function(n,y,H){return n[0]=Math.max(y[0],H[0]),n[1]=Math.max(y[1],H[1]),n[2]=Math.max(y[2],H[2]),n}},12287:n=>{n.exports=function(n,y,H){return n[0]=Math.min(y[0],H[0]),n[1]=Math.min(y[1],H[1]),n[2]=Math.min(y[2],H[2]),n}},12268:(n,y,H)=>{n.exports=H(12265)},12265:n=>{n.exports=function(n,y,H){return n[0]=y[0]*H[0],n[1]=y[1]*H[1],n[2]=y[2]*H[2],n}},12378:n=>{n.exports=function(n,y){return n[0]=-y[0],n[1]=-y[1],n[2]=-y[2],n}},12221:n=>{n.exports=function(n,y){var H=y[0],o=y[1],G=y[2],h=H*H+o*o+G*G;h>0&&(h=1/Math.sqrt(h),n[0]=y[0]*h,n[1]=y[1]*h,n[2]=y[2]*h);return n}},12399:n=>{n.exports=function(n,y){y=y||1;var H=2*Math.random()*Math.PI,o=2*Math.random()-1,G=Math.sqrt(1-o*o)*y;return n[0]=Math.cos(H)*G,n[1]=Math.sin(H)*G,n[2]=o*y,n}},12420:n=>{n.exports=function(n,y,H,o){var G=H[1],h=H[2],k=y[1]-G,i=y[2]-h,B=Math.sin(o),V=Math.cos(o);return n[0]=y[0],n[1]=G+k*V-i*B,n[2]=h+k*B+i*V,n}},12422:n=>{n.exports=function(n,y,H,o){var G=H[0],h=H[2],k=y[0]-G,i=y[2]-h,B=Math.sin(o),V=Math.cos(o);return n[0]=G+i*B+k*V,n[1]=y[1],n[2]=h+i*V-k*B,n}},12426:n=>{n.exports=function(n,y,H,o){var G=H[0],h=H[1],k=y[0]-G,i=y[1]-h,B=Math.sin(o),V=Math.cos(o);return n[0]=G+k*V-i*B,n[1]=h+k*B+i*V,n[2]=y[2],n}},12315:n=>{n.exports=function(n,y){return n[0]=Math.round(y[0]),n[1]=Math.round(y[1]),n[2]=Math.round(y[2]),n}},12323:n=>{n.exports=function(n,y,H){return n[0]=y[0]*H,n[1]=y[1]*H,n[2]=y[2]*H,n}},12328:n=>{n.exports=function(n,y,H,o){return n[0]=y[0]+H[0]*o,n[1]=y[1]+H[1]*o,n[2]=y[2]+H[2]*o,n}},12236:n=>{n.exports=function(n,y,H,o){return n[0]=y,n[1]=H,n[2]=o,n}},12350:(n,y,H)=>{n.exports=H(12345)},12373:(n,y,H)=>{n.exports=H(12369)},12345:n=>{n.exports=function(n,y){var H=y[0]-n[0],o=y[1]-n[1],G=y[2]-n[2];return H*H+o*o+G*G}},12369:n=>{n.exports=function(n){var y=n[0],H=n[1],o=n[2];return y*y+H*H+o*o}},12261:(n,y,H)=>{n.exports=H(12259)},12259:n=>{n.exports=function(n,y,H){return n[0]=y[0]-H[0],n[1]=y[1]-H[1],n[2]=y[2]-H[2],n}},12408:n=>{n.exports=function(n,y,H){var o=y[0],G=y[1],h=y[2];return n[0]=o*H[0]+G*H[3]+h*H[6],n[1]=o*H[1]+G*H[4]+h*H[7],n[2]=o*H[2]+G*H[5]+h*H[8],n}},12402:n=>{n.exports=function(n,y,H){var o=y[0],G=y[1],h=y[2],k=H[3]*o+H[7]*G+H[11]*h+H[15];return k=k||1,n[0]=(H[0]*o+H[4]*G+H[8]*h+H[12])/k,n[1]=(H[1]*o+H[5]*G+H[9]*h+H[13])/k,n[2]=(H[2]*o+H[6]*G+H[10]*h+H[14])/k,n}},12411:n=>{n.exports=function(n,y,H){var o=y[0],G=y[1],h=y[2],k=H[0],i=H[1],B=H[2],V=H[3],q=V*o+i*h-B*G,b=V*G+B*o-k*h,A=V*h+k*G-i*o,U=-k*o-i*G-B*h;return n[0]=q*V+U*-k+b*-B-A*-i,n[1]=b*V+U*-i+A*-k-q*-B,n[2]=A*V+U*-B+q*-i-b*-k,n}},13333:n=>{"use strict";n.exports=function(n){for(var y=new Array(n),H=0;H<n;++H)y[H]=H;return y}},13406:n=>{n.exports=function(n){return null!=n&&null!=n.constructor&&"function"===typeof n.constructor.isBuffer&&n.constructor.isBuffer(n)}},13615:(n,y,H)=>{"use strict";H.d(y,{e:()=>o});class o{constructor(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Sq=!1,this.Nq=!1,this.Rq=30,this.Cq=0,this.xq=!1,this.fullscreen=!1,this.Kq=function(n){},this.Yq=function(){},this.sq=function(){},this.nh=function(){},this.Dq=function(n){},this.onFullscreenChanged=function(n){},V((()=>{!function(n,y){n._nowObject=performance||Date,n._lastTick=0,n._renderAccum=0,n._rt=0,n._frameCB=i.bind(null,n),requestAnimationFrame(n._frameCB),y>0&&(n._intervalCB=k.bind(null,n),n._interval=setInterval(n._intervalCB,Math.max(y,1e3/n.Rq/2)))}(this,y),function(n,y){if(!y)return;var H=!1,o=!1;document.addEventListener("pointerlockchange",(o=>{H=document.pointerLockElement===y,n.Dq(H)})),document.addEventListener("fullscreenchange",(H=>{o=document.fullscreenElement===y,n.onFullscreenChanged(o)})),Object.defineProperty(n,"xq",{get:()=>H,set:n=>{n&&!H?B(y):H&&!n&&function(n){n.exitPointerLock&&n.exitPointerLock()}(document)}}),Object.defineProperty(n,"fullscreen",{get:()=>o,set:n=>{n&&!o?y.requestFullscreen():o&&!n&&document.exitFullscreen()}}),y.addEventListener("click",(G=>{n.Sq&&!H&&B(y),n.Nq&&!o&&y.requestFullscreen()}));var G=()=>n.nh();if(window.ResizeObserver){new ResizeObserver(G).observe(y)}else window.addEventListener("resize",G)}(this,n),this.sq()}))}}var G=3,h=20;function k(n){for(var y=1e3/n.Rq,H=n._nowObject.now()+h,o=0;n._nowObject.now()>=n._lastTick+y&&n._nowObject.now()<H&&++o<=G;)n.Kq(y),n._lastTick+=y;var k=5*(y+5),i=n._nowObject.now();if(i-n._lastTick>k)for(;i>=n._lastTick+y;)n._lastTick+=y}function i(n){requestAnimationFrame(n._frameCB),k(n);var y=n._nowObject.now(),H=y-n._rt;if(n._rt=y,n.Cq>0){n._renderAccum+=H;var o=1e3/n.Cq;if(n._renderAccum<o)return;n._renderAccum=Math.min(n._renderAccum-o,o)}var G=1e3/n.Rq,h=(y-n._lastTick)/G;n.Yq(H,h,G)}function B(n){n.requestPointerLock&&n.requestPointerLock()}var V=n=>{if("loading"===document.readyState){var y=()=>{document.removeEventListener("readystatechange",y),n()};document.addEventListener("readystatechange",y)}else setTimeout(n,1)}},13329:(n,y,H)=>{var o=H(13333),G=H(13340),h="undefined"!==typeof Float64Array;function k(n,y){return n[0]-y[0]}function i(){var n,y=this.stride,H=new Array(y.length);for(n=0;n<H.length;++n)H[n]=[Math.abs(y[n]),n];H.sort(k);var o=new Array(H.length);for(n=0;n<o.length;++n)o[n]=H[n][1];return o}function B(n,y){var H=["View",y,"d",n].join("");y<0&&(H="View_Nil"+n);var G="generic"===n;if(-1===y){var h="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+n+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(h)()}if(0===y){h="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+n+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(G?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(G?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",h)(V[n][0])}h=["'use strict'"];var k=o(y),B=k.map((function(n){return"i"+n})),q="this.offset+"+k.map((function(n){return"this.stride["+n+"]*i"+n})).join("+"),b=k.map((function(n){return"b"+n})).join(","),A=k.map((function(n){return"c"+n})).join(",");h.push("function "+H+"(a,"+b+","+A+",d){this.data=a","this.shape=["+b+"]","this.stride=["+A+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+n+"'","proto.dimension="+y),h.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+k.map((function(n){return"this.shape["+n+"]"})).join("*"),"}})"),1===y?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),y<4?(h.push("function "+H+"_order(){"),2===y?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===y&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):h.push("ORDER})")),h.push("proto.set=function "+H+"_set("+B.join(",")+",v){"),G?h.push("return this.data.set("+q+",v)}"):h.push("return this.data["+q+"]=v}"),h.push("proto.get=function "+H+"_get("+B.join(",")+"){"),G?h.push("return this.data.get("+q+")}"):h.push("return this.data["+q+"]}"),h.push("proto.index=function "+H+"_index(",B.join(),"){return "+q+"}"),h.push("proto.hi=function "+H+"_hi("+B.join(",")+"){return new "+H+"(this.data,"+k.map((function(n){return["(typeof i",n,"!=='number'||i",n,"<0)?this.shape[",n,"]:i",n,"|0"].join("")})).join(",")+","+k.map((function(n){return"this.stride["+n+"]"})).join(",")+",this.offset)}");var U=k.map((function(n){return"a"+n+"=this.shape["+n+"]"})),T=k.map((function(n){return"c"+n+"=this.stride["+n+"]"}));h.push("proto.lo=function "+H+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+T.join(","));for(var W=0;W<y;++W)h.push("if(typeof i"+W+"==='number'&&i"+W+">=0){d=i"+W+"|0;b+=c"+W+"*d;a"+W+"-=d}");h.push("return new "+H+"(this.data,"+k.map((function(n){return"a"+n})).join(",")+","+k.map((function(n){return"c"+n})).join(",")+",b)}"),h.push("proto.step=function "+H+"_step("+B.join(",")+"){var "+k.map((function(n){return"a"+n+"=this.shape["+n+"]"})).join(",")+","+k.map((function(n){return"b"+n+"=this.stride["+n+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(W=0;W<y;++W)h.push("if(typeof i"+W+"==='number'){d=i"+W+"|0;if(d<0){c+=b"+W+"*(a"+W+"-1);a"+W+"=ceil(-a"+W+"/d)}else{a"+W+"=ceil(a"+W+"/d)}b"+W+"*=d}");h.push("return new "+H+"(this.data,"+k.map((function(n){return"a"+n})).join(",")+","+k.map((function(n){return"b"+n})).join(",")+",c)}");var z=new Array(y),Q=new Array(y);for(W=0;W<y;++W)z[W]="a[i"+W+"]",Q[W]="b[i"+W+"]";h.push("proto.transpose=function "+H+"_transpose("+B+"){"+B.map((function(n,y){return n+"=("+n+"===undefined?"+y+":"+n+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+z.join(",")+","+Q.join(",")+",this.offset)}"),h.push("proto.pick=function "+H+"_pick("+B+"){var a=[],b=[],c=this.offset");for(W=0;W<y;++W)h.push("if(typeof i"+W+"==='number'&&i"+W+">=0){c=(c+this.stride["+W+"]*i"+W+")|0}else{a.push(this.shape["+W+"]);b.push(this.stride["+W+"])}");return h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+k.map((function(n){return"shape["+n+"]"})).join(",")+","+k.map((function(n){return"stride["+n+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",h.join("\n"))(V[n],i)}var V={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};n.exports=function(n,y,H,o){if(void 0===n)return(0,V.array[0])([]);"number"===typeof n&&(n=[n]),void 0===y&&(y=[n.length]);var k=y.length;if(void 0===H){H=new Array(k);for(var i=k-1,q=1;i>=0;--i)H[i]=q,q*=y[i]}if(void 0===o){o=0;for(i=0;i<k;++i)H[i]<0&&(o-=(y[i]-1)*H[i])}for(var b=function(n){if(G(n))return"buffer";if(h)switch(Object.prototype.toString.call(n)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(n)?"array":"generic"}(n),A=V[b];A.length<=k+1;)A.push(B(b,A.length-1));return(0,A[k+1])(n,y,H,o)}},13340:n=>{function y(n){return!!n.constructor&&"function"===typeof n.constructor.isBuffer&&n.constructor.isBuffer(n)}n.exports=function(n){return null!=n&&(y(n)||function(n){return"function"===typeof n.readFloatLE&&"function"===typeof n.slice&&y(n.slice(0,0))}(n)||!!n._isBuffer)}},13479:n=>{"use strict";var y=[],H=[],o=[],G=[],h=[],k=[],i=[],B=[],V=[],q=[],b=[],A=[];n.exports=function(n,U,T,W,z,Q){for(var l=i,v=V,F=q,g=A,M=0;M<3;M++)l[M]=+T[M],F[M]=+U.max[M],v[M]=+U.base[M];Q||(Q=1e-10);var f=function(n,i,V,q,A,U){var T=y,W=H,z=o,Q=G,l=h,v=k,F=B,g=Math.floor,M=0,f=0,c=0,p=0,E=0;if(X(),0===c)return 0;for(p=O();f<=c;){if(d(p)&&a())return M;p=O()}for(M+=c,E=0;E<3;E++)q[E]+=V[E],A[E]+=V[E];return M;function X(){if(f=0,0!==(c=Math.sqrt(V[0]*V[0]+V[1]*V[1]+V[2]*V[2])))for(var n=0;n<3;n++){var y=V[n]>=0;Q[n]=y?1:-1;var H=y?A[n]:q[n];T[n]=y?q[n]:A[n],W[n]=e(H,Q[n]),z[n]=w(T[n],Q[n]),F[n]=V[n]/c,l[n]=Math.abs(1/F[n]);var o=y?W[n]+1-H:H-W[n];v[n]=l[n]<1/0?l[n]*o:1/0}}function d(y){for(var H=Q[0],o=0===y?W[0]:z[0],G=W[0]+H,h=Q[1],k=1===y?W[1]:z[1],i=W[1]+h,B=Q[2],V=2===y?W[2]:z[2],q=W[2]+B,b=o;b!=G;b+=H)for(var A=k;A!=i;A+=h)for(var U=V;U!=q;U+=B)if(n(b,A,U))return!0;return!1}function a(){M+=f;var n=Q[p],y=f/c,H=b;for(E=0;E<3;E++){var o=V[E]*y;q[E]+=o,A[E]+=o,H[E]=V[E]-o}if(n>0?A[p]=Math.round(A[p]):q[p]=Math.round(q[p]),i(M,p,n,H))return!0;for(E=0;E<3;E++)V[E]=H[E];return X(),0===c}function O(){var n=v[0]<v[1]?v[0]<v[2]?0:2:v[1]<v[2]?1:2,y=v[n]-f;for(f=v[n],W[n]+=Q[n],v[n]+=l[n],E=0;E<3;E++)T[E]+=y*F[E],z[E]=w(T[E],Q[E]);return n}function e(n,y){return g(n-y*U)}function w(n,y){return g(n+y*U)}}(n,W,l,v,F,Q);if(!z){for(M=0;M<3;M++)g[M]=T[M]>0?F[M]-U.max[M]:v[M]-U.base[M];U.translate(g)}return f}},13640:(n,y,H)=>{"use strict";H.d(y,{b:()=>b});var o=H(13475),G=H(12190);class h{constructor(n,y,H,h,k,i,B){this.RV=new o(n.base,n.mV),this.So=y,this.friction=H,this.restitution=h,this.Pk=k,this.yT=i,this.xk=!!B,this.JV=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.KT=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.bV=G.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=G.create(),this._impulses=G.create(),this._sleepFrameCount=10}loadFromCopy(n){G.j(this.RV.base,n.RV.base),G.j(this.RV.mV,n.RV.mV),G.j(this.RV.max,n.RV.max),this.RV.mag=n.RV.mag,this.So=n.So,this.friction=n.friction,this.restitution=n.restitution,this.Pk=n.Pk,this.yT=n.yT,this.xk=n.xk,this.JV=n.JV,this.fluidDrag=n.fluidDrag,this.KT=n.KT,this.preventFallOffEdge=n.preventFallOffEdge,this.rolledBackLastTick=n.rolledBackLastTick,G.j(this.bV,n.bV),G.j(this.resting,n.resting),this.inFluid=n.inFluid,this._ratioInFluid=n._ratioInFluid,G.j(this._forces,n._forces),G.j(this._impulses,n._impulses),this._sleepFrameCount=n._sleepFrameCount}setPosition(n){k(n),G.Qy(n,n,this.RV.base),this.RV.translate(n),this.TV()}Gh(){return G.clone(this.RV.base)}applyForce(n){k(n),G.add(this._forces,this._forces,n),this.TV()}applyImpulse(n){k(n),G.add(this._impulses,this._impulses,n),this.TV()}TV(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var k=n=>{};var i=H(13475),B=H(12190),V=H(13479);function q(){this.JV=.1,this.fluidDrag=.4,this.mk=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function b(n,y,H){n=Object.assign(new q,n),this.gravity=n.gravity||[0,-10,0],this.JV=n.JV||.1,this.mk=n.mk||2,this.fluidDrag=n.fluidDrag||.4,this.minBounceImpulse=n.minBounceImpulse,this.bodies=[],this.fU=n.fU,this.testSolid=y,this.testFluid=H}b.prototype.BT=function(n,y,H,o,G,k){n=n||new i([0,0,0],[1,1,1]),"undefined"==typeof y&&(y=1),"undefined"==typeof H&&(H=1),"undefined"==typeof o&&(o=0),"undefined"==typeof G&&(G=1);var B=new h(n,y,H,o,G,k);return this.bodies.push(B),B},b.prototype.VT=function(n){var y=this.bodies.indexOf(n);y<0||(this.bodies.splice(y,1),n.RV=n.yT=null)};var A=B.create(),U=B.create(),T=B.create(),W=B.create(),z=B.create(),Q=B.create(),l=B.create(),v=new i([0,0,0],[1,1,1]),F=new h(v,1,1,0,1,(()=>{}),!1);function g(n,y,H){return y=H,y*=1-(1-n.ratioInFluid)**2}b.prototype.Ai=function(n){n/=1e3;var y=S(0,B.squaredLength(this.gravity));this.bodies.forEach((H=>function(n,y,H,o){B.j(z,y.resting),n.fU&&F.loadFromCopy(y);if(y.So<=0)return B.set(y.bV,0,0,0),B.set(y._forces,0,0,0),void B.set(y._impulses,0,0,0);var G=o||0===y.Pk;if(function(n,y,H,o){if(y._sleepFrameCount>0)return!1;if(o)return!0;var G=!1,h=.5*H*H*y.Pk;return B.scale(C,n.gravity,h),V(n.testSolid,y.RV,C,(function(){return G=!0,!0}),!0),G}(n,y,H,G))return;y._sleepFrameCount--,function(n,y){var H=y.RV,o=Math.floor(H.base[0]),G=Math.floor(H.base[2]),h=Math.floor(H.base[1]),k=Math.floor(H.max[1]);if(!n.testFluid(o,h,G))return y.inFluid=!1,void(y.ratioInFluid=0);var i=1,V=h+1;for(;V<=k&&n.testFluid(o,V,G);)i++,V++;var q=(h+i-H.base[1])/H.mV[1];q>1&&(q=1);var b=H.mV[0]*H.mV[1]*H.mV[2]*q,A=f;B.scale(A,n.gravity,-n.mk*b*y.Pk),y.applyForce(A),y.inFluid=!0,y.ratioInFluid=q}(n,y),r(y._forces),r(y._impulses),r(y.bV),r(y.resting),B.scale(A,y._forces,1/y.So),B.Gi(A,A,n.gravity,y.Pk),B.scale(U,y._impulses,1/y.So),B.Gi(U,U,A,H),B.add(y.bV,y.bV,U),y.friction&&(c(n,0,y,U,H),c(n,1,y,U,H),c(n,2,y,U,H));var h=y.fluidDrag>=0?y.fluidDrag:n.fluidDrag,k=y.JV>=0?y.JV:n.JV,i=k,q=k;y.inFluid&&(i=g(y,i,y.fluidDragHoriz>=0?y.fluidDragHoriz:h),q=g(y,q,y.fluidDragVert>=0?y.fluidDragVert:h));i=Math.max(1-i*H/y.So,0),q=Math.max(1-q*H/y.So,0),B.set(M,i,q,i),B.multiply(y.bV,y.bV,M),B.scale(T,y.bV,H),B.set(y._forces,0,0,0),B.set(y._impulses,0,0,0),y.xk&&N(X,y.RV);B.j(Q,T),B.set(l,0,0,0),y.preventFallOffEdge&&function(n,y,H,o){if(!y.resting[1]||H[1]>0)return;var G=j;N(G,y.RV);for(var h=0;h<3;h+=2){B.set(w,0,0,0),w[h]=H[h];var k=!0;(k=(k=(k=(k=k&&!R(n,G.base[0]+w[0]+1e-5,G.base[1],G.base[2]+w[2]+1e-5))&&!R(n,G.max[0]+w[0]-1e-5,G.base[1],G.base[2]+w[2]+1e-5))&&!R(n,G.base[0]+w[0]+1e-5,G.base[1],G.max[2]+w[2]-1e-5))&&!R(n,G.max[0]+w[0]-1e-5,G.base[1],G.max[2]+w[2]-1e-5))?(o[h]=H[h]>0?1:-1,H[h]=0):0===h&&(B.set(I,H[0],0,0),E(n,G,I,o,y.slideOnCollision))}}(n,y,T,l);E(n,y.RV,T,y.resting,y.slideOnCollision),y.xk&&function(n,y,H,o){if(y.resting[1]>=0&&!y.inFluid)return;var G=0!==y.resting[0],h=0!==y.resting[2];if(!G&&!h)return;var k=Math.abs(o[0]/o[2]),i=4;if(!G&&k>i)return;if(!h&&k<1/i)return;B.add(a,H.base,o);var q=n.testSolid;V(q,H,o,(function(n,y,H,o){if(1!==y)return!0;o[y]=0}));var b=H.base[1],A=y.inFluid?1.951:1.001,U=Math.floor(b+A)-b;B.set(O,0,U,0);var T=!1;if(V(q,H,O,(function(n,y,H,o){return T=!0,!0})),T)return;B.Qy(e,a,H.base),e[1]=0,E(n,H,e,d,!0);var W=S(H.base[0],a[0]),z=S(H.base[2],a[2]);if(G&&!W&&(!z||!h))return;if(h&&(!W||!G)&&!z)return;var Q=!0;if(Q=Q&&!R(n,H.base[0]+1e-5,H.base[1],H.base[2]+1e-5),Q=Q&&!R(n,H.max[0]-1e-5,H.base[1],H.base[2]+1e-5),Q=Q&&!R(n,H.base[0]+1e-5,H.base[1],H.max[2]-1e-5),Q=Q&&!R(n,H.max[0]-1e-5,H.base[1],H.max[2]-1e-5),Q)return;N(y.RV,H),y.resting[0]=d[0],y.resting[2]=d[2],y.KT&&y.KT()}(n,y,X,Q);for(var b=0;b<3;++b)y.resting[b]=y.resting[b]||l[b],W[b]=0,y.resting[b]&&(z[b]||(W[b]=-y.bV[b]),y.bV[b]=0);var v=B.length(W);v>.001&&(B.scale(W,W,y.So),y.yT&&y.yT(W),y.restitution>0&&v>n.minBounceImpulse&&(B.scale(W,W,y.restitution),y.applyImpulse(W)));var p=B.squaredLength(y.bV);p>1e-5&&y.TV();n.fU&&n.fU(y)?(y.loadFromCopy(F),y.rolledBackLastTick=!0):y.rolledBackLastTick=!1}(this,H,n,y)))};var M=B.create([0,0,0]);var f=B.create();function c(n,y,H,o,G){var h=H.resting[y],k=o[y];if(!H.alwaysApplyHorizFriction||1!==y){if(0===h)return;if(h*k<=0)return}B.j(p,H.bV),p[y]=0;var i=B.length(p);if(!S(i,0)){var V=Math.abs(H.friction*n.gravity[y]*G),q=i>V?(i-V)/i:0;H.bV[(y+1)%3]*=q,H.bV[(y+2)%3]*=q}}var p=B.create();function E(n,y,H,o,G){return B.set(o,0,0,0),V(n.testSolid,y,H,(function(n,y,H,h){o[y]=H,h[y]=0,G||(h[0]=0,h[1]=0,h[2]=0)}))}var X=new i([],[]),d=B.create(),a=B.create(),O=B.create(),e=B.create();var w=B.create(),j=new i([],[]),I=B.create();function R(n,y,H,o){return n.testSolid(Math.floor(y),Math.floor(H-1),Math.floor(o))}var C=B.create();function S(n,y){return Math.abs(n-y)<1e-5}function N(n,y){for(var H=0;H<3;H++)n.base[H]=y.base[H],n.max[H]=y.max[H],n.mV[H]=y.mV[H]}var r=function(n){}},12066:function(n,y){!function(n){"use strict";var y=function(n,H){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,y){n.__proto__=y}||function(n,y){for(var H in y)Object.prototype.hasOwnProperty.call(y,H)&&(n[H]=y[H])},y(n,H)};function H(n,H){if("function"!==typeof H&&null!==H)throw new TypeError("Class extends value "+String(H)+" is not a constructor or null");function o(){this.constructor=n}y(n,H),n.prototype=null===H?Object.create(H):(o.prototype=H.prototype,new o)}function o(n,y,H,o){var G,h=arguments.length,k=h<3?y:null===o?o=Object.getOwnPropertyDescriptor(y,H):o;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)k=Reflect.decorate(n,y,H,o);else for(var i=n.length-1;i>=0;i--)(G=n[i])&&(k=(h<3?G(k):h>3?G(y,H,k):G(y,H))||k);return h>3&&k&&Object.defineProperty(y,H,k),k}function G(n,y,H){if(H||2===arguments.length)for(var o,G=0,h=y.length;G<h;G++)!o&&G in y||(o||(o=Array.prototype.slice.call(y,0,G)),o[G]=y[G]);return n.concat(o||Array.prototype.slice.call(y))}var h,k=255,i=213;n.OPERATION=void 0,(h=n.OPERATION||(n.OPERATION={}))[h.ADD=128]="ADD",h[h.REPLACE=0]="REPLACE",h[h.DELETE=64]="DELETE",h[h.DELETE_AND_ADD=192]="DELETE_AND_ADD",h[h.TOUCH=1]="TOUCH",h[h.CLEAR=10]="CLEAR";var B=function(){function y(n,y,H){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=n,this.setParent(y,H)}return y.prototype.setParent=function(n,y,H){var o=this;if(this.indexes||(this.indexes=this.ref instanceof wn?this.ref._definition.indexes:{}),this.parent=n,this.parentIndex=H,y)if(this.root=y,this.ref instanceof wn){var G=this.ref._definition;for(var h in G.schema){var k=this.ref[h];if(k&&k.$changes){var i=G.indexes[h];k.$changes.setParent(this.ref,y,i)}}}else"object"===typeof this.ref&&this.ref.forEach((function(n,y){if(n instanceof wn){var H=n.$changes,G=o.ref.$changes.indexes[y];H.setParent(o.ref,o.root,G)}}))},y.prototype.operation=function(n){this.changes.set(--this.currentCustomOperation,n)},y.prototype.change=function(y,H){void 0===H&&(H=n.OPERATION.ADD);var o="number"===typeof y?y:this.indexes[y];this.assertValidIndex(o,y);var G=this.changes.get(o);G&&G.op!==n.OPERATION.DELETE&&G.op!==n.OPERATION.TOUCH||this.changes.set(o,{op:G&&G.op===n.OPERATION.DELETE?n.OPERATION.DELETE_AND_ADD:H,index:o}),this.allChanges.add(o),this.changed=!0,this.touchParents()},y.prototype.touch=function(y){var H="number"===typeof y?y:this.indexes[y];this.assertValidIndex(H,y),this.changes.has(H)||this.changes.set(H,{op:n.OPERATION.TOUCH,index:H}),this.allChanges.add(H),this.touchParents()},y.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},y.prototype.getType=function(n){if(this.ref._definition)return(y=this.ref._definition).schema[y.fieldsByIndex[n]];var y,H=(y=this.parent._definition).schema[y.fieldsByIndex[this.parentIndex]];return Object.values(H)[0]},y.prototype.getChildrenFilter=function(){var n=this.parent._definition.childFilters;return n&&n[this.parentIndex]},y.prototype.getValue=function(n){return this.ref.getByIndex(n)},y.prototype.delete=function(y){var H="number"===typeof y?y:this.indexes[y];if(void 0!==H){var o=this.getValue(H);this.changes.set(H,{op:n.OPERATION.DELETE,index:H}),this.allChanges.delete(H),delete this.caches[H],o&&o.$changes&&(o.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(y," (").concat(H,")"))},y.prototype.discard=function(y,H){var o=this;void 0===y&&(y=!1),void 0===H&&(H=!1),this.ref instanceof wn||this.changes.forEach((function(y){if(y.op===n.OPERATION.DELETE){var H=o.ref.getIndex(y.index);delete o.indexes[H]}})),this.changes.clear(),this.changed=y,H&&this.allChanges.clear(),this.currentCustomOperation=0},y.prototype.discardAll=function(){var n=this;this.changes.forEach((function(y){var H=n.getValue(y.index);H&&H.$changes&&H.$changes.discardAll()})),this.discard()},y.prototype.cache=function(n,y){this.caches[n]=y},y.prototype.clone=function(){return new y(this.ref,this.parent,this.root)},y.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},y.prototype.assertValidIndex=function(n,y){if(void 0===n)throw new Error('ChangeTree: missing index for field "'.concat(y,'"'))},y}();function V(n,y,H,o){return n[y]||(n[y]=[]),n[y].push(H),null===o||void 0===o||o.forEach((function(n,y){return H(n,y)})),function(){return b(n[y],n[y].indexOf(H))}}function q(y){var H=this,o="string"!==typeof this.$changes.getType();this.$items.forEach((function(G,h){y.push({refId:H.$changes.refId,op:n.OPERATION.DELETE,field:h,value:void 0,previousValue:G}),o&&H.$changes.root.removeRef(G.$changes.refId)}))}function b(n,y){if(-1===y||y>=n.length)return!1;for(var H=n.length-1,o=y;o<H;o++)n[o]=n[o+1];return n.length=H,!0}var A=function(n,y){var H=n.toString(),o=y.toString();return H<o?-1:H>o?1:0};function U(n){return n.$proxy=!0,n=new Proxy(n,{get:function(n,y){return"symbol"===typeof y||isNaN(y)?n[y]:n.at(y)},set:function(n,y,H){if("symbol"===typeof y||isNaN(y))n[y]=H;else{var o=Array.from(n.$items.keys()),G=parseInt(o[y]||y);void 0===H||null===H?n.deleteAt(G):n.setAt(G,H)}return!0},deleteProperty:function(n,y){return"number"===typeof y?n.deleteAt(y):delete n[y],!0}})}var T=function(){function y(){for(var n=[],y=0;y<arguments.length;y++)n[y]=arguments[y];this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,n)}return y.prototype.Ci=function(y,H){return void 0===H&&(H=!0),V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,y,H?this.$items:void 0)},y.prototype.py=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,y)},y.is=function(n){return Array.isArray(n)||void 0!==n.array},Object.defineProperty(y.prototype,"length",{get:function(){return this.$items.size},set:function(n){0===n?this.clear():this.splice(n,this.length-n)},enumerable:!1,configurable:!0}),y.prototype.push=function(){for(var n,y=this,H=[],o=0;o<arguments.length;o++)H[o]=arguments[o];return H.forEach((function(H){n=y.$refId++,y.setAt(n,H)})),n},y.prototype.pop=function(){var n=Array.from(this.$indexes.values()).pop();if(void 0!==n){this.$changes.delete(n),this.$indexes.delete(n);var y=this.$items.get(n);return this.$items.delete(n),y}},y.prototype.at=function(n){var y=Array.from(this.$items.keys())[n];return this.$items.get(y)},y.prototype.setAt=function(y,H){var o,G;if(void 0!==H&&null!==H){if(this.$items.get(y)!==H){void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,y);var h=null!==(G=null===(o=this.$changes.indexes[y])||void 0===o?void 0:o.op)&&void 0!==G?G:n.OPERATION.ADD;this.$changes.indexes[y]=y,this.$indexes.set(y,y),this.$items.set(y,H),this.$changes.change(y,h)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},y.prototype.deleteAt=function(n){var y=Array.from(this.$items.keys())[n];return void 0!==y&&this.$deleteAt(y)},y.prototype.$deleteAt=function(n){return this.$changes.delete(n),this.$indexes.delete(n),this.$items.delete(n)},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&q.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.concat=function(){for(var n,H=[],o=0;o<arguments.length;o++)H[o]=arguments[o];return new(y.bind.apply(y,G([void 0],(n=Array.from(this.$items.values())).concat.apply(n,H),!1)))},y.prototype.join=function(n){return Array.from(this.$items.values()).join(n)},y.prototype.reverse=function(){var n=this,y=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(H,o){n.setAt(y[o],H)})),this},y.prototype.shift=function(){var n=Array.from(this.$items.keys()).shift();if(void 0!==n){var y=this.$items.get(n);return this.$deleteAt(n),y}},y.prototype.slice=function(n,H){var o=new y;return o.push.apply(o,Array.from(this.$items.values()).slice(n,H)),o},y.prototype.sort=function(n){var y=this;void 0===n&&(n=A);var H=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(n).forEach((function(n,o){y.setAt(H[o],n)})),this},y.prototype.splice=function(n,y){void 0===y&&(y=this.length-n);for(var H=Array.from(this.$items.keys()),o=[],G=n;G<n+y;G++)o.push(this.$items.get(H[G])),this.$deleteAt(H[G]);return o},y.prototype.unshift=function(){for(var n=this,y=[],H=0;H<arguments.length;H++)y[H]=arguments[H];var o=this.length,G=y.length,h=Array.from(this.$items.values());return y.forEach((function(y,H){n.setAt(H,y)})),h.forEach((function(y,H){n.setAt(G+H,y)})),o+G},y.prototype.indexOf=function(n,y){return Array.from(this.$items.values()).indexOf(n,y)},y.prototype.lastIndexOf=function(n,y){return void 0===y&&(y=this.length-1),Array.from(this.$items.values()).lastIndexOf(n,y)},y.prototype.every=function(n,y){return Array.from(this.$items.values()).every(n,y)},y.prototype.some=function(n,y){return Array.from(this.$items.values()).some(n,y)},y.prototype.forEach=function(n,y){Array.from(this.$items.values()).forEach(n,y)},y.prototype.map=function(n,y){return Array.from(this.$items.values()).map(n,y)},y.prototype.filter=function(n,y){return Array.from(this.$items.values()).filter(n,y)},y.prototype.reduce=function(n,y){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},y.prototype.reduceRight=function(n,y){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},y.prototype.find=function(n,y){return Array.from(this.$items.values()).find(n,y)},y.prototype.findIndex=function(n,y){return Array.from(this.$items.values()).findIndex(n,y)},y.prototype.fill=function(n,y,H){throw new Error("ArraySchema#fill() not implemented")},y.prototype.copyWithin=function(n,y,H){throw new Error("ArraySchema#copyWithin() not implemented")},y.prototype.toString=function(){return this.$items.toString()},y.prototype.toLocaleString=function(){return this.$items.toLocaleString()},y.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(y,Symbol.species,{get:function(){return y},enumerable:!1,configurable:!0}),y.prototype.entries=function(){return this.$items.entries()},y.prototype.keys=function(){return this.$items.keys()},y.prototype.values=function(){return this.$items.values()},y.prototype.includes=function(n,y){return Array.from(this.$items.values()).includes(n,y)},y.prototype.flatMap=function(n,y){throw new Error("ArraySchema#flatMap() is not supported.")},y.prototype.flat=function(n){throw new Error("ArraySchema#flat() is not supported.")},y.prototype.findLast=function(){var n=Array.from(this.$items.values());return n.findLast.apply(n,arguments)},y.prototype.findLastIndex=function(){var n=Array.from(this.$items.values());return n.findLastIndex.apply(n,arguments)},y.prototype.setIndex=function(n,y){this.$indexes.set(n,y)},y.prototype.getIndex=function(n){return this.$indexes.get(n)},y.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},y.prototype.deleteByIndex=function(n){var y=this.$indexes.get(n);this.$items.delete(y),this.$indexes.delete(n)},y.prototype.toArray=function(){return Array.from(this.$items.values())},y.prototype.toJSON=function(){return this.toArray().map((function(n){return"function"===typeof n.toJSON?n.toJSON():n}))},y.prototype.clone=function(n){return n?new(y.bind.apply(y,G([void 0],Array.from(this.$items.values()),!1))):new(y.bind.apply(y,G([void 0],this.map((function(n){return n.$changes?n.clone():n})),!1)))},y}();function W(n){return n.$proxy=!0,n=new Proxy(n,{get:function(n,y){return"symbol"!==typeof y&&"undefined"===typeof n[y]?n.get(y):n[y]},set:function(n,y,H){return"symbol"!==typeof y&&-1===y.indexOf("$")&&"Ci"!==y&&"py"!==y&&"onChange"!==y?n.set(y,H):n[y]=H,!0},deleteProperty:function(n,y){return n.delete(y),!0}})}var z=function(){function y(n){var H=this;if(this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,n)if(n instanceof Map||n instanceof y)n.forEach((function(n,y){return H.set(y,n)}));else for(var o in n)this.set(o,n[o])}return y.prototype.Ci=function(y,H){return void 0===H&&(H=!0),V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,y,H?this.$items:void 0)},y.prototype.py=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,y)},y.is=function(n){return void 0!==n.map},y.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(y.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(y,Symbol.species,{get:function(){return y},enumerable:!1,configurable:!0}),y.prototype.set=function(y,H){if(void 0===H||null===H)throw new Error("MapSchema#set('".concat(y,"', ").concat(H,"): trying to set ").concat(H," value on '").concat(y,"'."));y=y.toString();var o="undefined"!==typeof this.$changes.indexes[y],G=o?this.$changes.indexes[y]:this.$refId++,h=o?n.OPERATION.REPLACE:n.OPERATION.ADD,k=void 0!==H.$changes;if(k&&H.$changes.setParent(this,this.$changes.root,G),o){if(!k&&this.$items.get(y)===H)return;k&&this.$items.get(y)!==H&&(h=n.OPERATION.ADD)}else this.$changes.indexes[y]=G,this.$indexes.set(G,y);return this.$items.set(y,H),this.$changes.change(y,h),this},y.prototype.get=function(n){return this.$items.get(n)},y.prototype.delete=function(n){return this.$changes.delete(n),this.$items.delete(n)},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&q.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.has=function(n){return this.$items.has(n)},y.prototype.forEach=function(n){this.$items.forEach(n)},y.prototype.entries=function(){return this.$items.entries()},y.prototype.keys=function(){return this.$items.keys()},y.prototype.values=function(){return this.$items.values()},Object.defineProperty(y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),y.prototype.setIndex=function(n,y){this.$indexes.set(n,y)},y.prototype.getIndex=function(n){return this.$indexes.get(n)},y.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},y.prototype.deleteByIndex=function(n){var y=this.$indexes.get(n);this.$items.delete(y),this.$indexes.delete(n)},y.prototype.toJSON=function(){var n={};return this.forEach((function(y,H){n[H]="function"===typeof y.toJSON?y.toJSON():y})),n},y.prototype.clone=function(n){var H;return n?H=Object.assign(new y,this):(H=new y,this.forEach((function(n,y){n.$changes?H.set(y,n.clone()):H.set(y,n)}))),H},y}(),Q={};function l(n,y){Q[n]=y}function v(n){return Q[n]}var F=function(){function n(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return n.create=function(y){var H=new n;return H.schema=Object.assign({},y&&y.schema||{}),H.indexes=Object.assign({},y&&y.indexes||{}),H.fieldsByIndex=Object.assign({},y&&y.fieldsByIndex||{}),H.descriptors=Object.assign({},y&&y.descriptors||{}),H.deprecated=Object.assign({},y&&y.deprecated||{}),H},n.prototype.addField=function(n,y){var H=this.getNextFieldIndex();this.fieldsByIndex[H]=n,this.indexes[n]=H,this.schema[n]=Array.isArray(y)?{array:y[0]}:y},n.prototype.hasField=function(n){return void 0!==this.indexes[n]},n.prototype.addFilter=function(n,y){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[n]]=y,this.indexesWithFilters.push(this.indexes[n]),!0},n.prototype.addChildrenFilter=function(n,y){var H=this.indexes[n],o=this.schema[n];if(v(Object.keys(o)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[H]=y,!0;console.warn("@filterChildren: field '".concat(n,"' can't have children. Ignoring filter."))},n.prototype.getChildrenFilter=function(n){return this.childFilters&&this.childFilters[this.indexes[n]]},n.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},n}();function g(n){return n._context&&n._context.useFilters}var M=function(){function n(){this.types={},this.schemas=new Map,this.useFilters=!1}return n.prototype.has=function(n){return this.schemas.has(n)},n.prototype.get=function(n){return this.types[n]},n.prototype.add=function(n,y){void 0===y&&(y=this.schemas.size),n._definition=F.create(n._definition),n._typeid=y,this.types[y]=n,this.schemas.set(n,y)},n.create=function(y){return void 0===y&&(y={}),function(H){return y.context||(y.context=new n),c(H,y)}},n}(),f=new M;function c(n,y){return void 0===y&&(y={}),function(H,o){var h=y.context||f,k=H.constructor;if(k._context=h,!n)throw new Error("".concat(k.name,': @type() reference provided for "').concat(o,"\" is undefined. Make sure you don't have any circular dependencies."));h.has(k)||h.add(k);var i=k._definition;if(i.addField(o,n),i.descriptors[o]){if(i.deprecated[o])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(o,"' definition on '").concat(k.name,"'.\nCheck @type() annotation"))}catch(Q){var B=Q.stack.split("\n")[4].trim();throw new Error("".concat(Q.message," ").concat(B))}}var V=T.is(n),q=!V&&z.is(n);if("string"!==typeof n&&!wn.is(n)){var b=Object.values(n)[0];"string"===typeof b||h.has(b)||h.add(b)}if(y.manual)i.descriptors[o]={enumerable:!0,configurable:!0,writable:!0};else{var A="_".concat(o);i.descriptors[A]={enumerable:!1,configurable:!1,writable:!0},i.descriptors[o]={get:function(){return this[A]},set:function(n){n!==this[A]&&(void 0!==n&&null!==n?(!V||n instanceof T||(n=new(T.bind.apply(T,G([void 0],n,!1)))),!q||n instanceof z||(n=new z(n)),void 0===n.$proxy&&(q?n=W(n):V&&(n=U(n))),this.$changes.change(o),n.$changes&&n.$changes.setParent(this,this.$changes.root,this._definition.indexes[o])):this[A]&&this.$changes.delete(o),this[A]=n)},enumerable:!0,configurable:!0}}}}function p(n){return function(y,H){var o=y.constructor;o._definition.addFilter(H,n)&&(o._context.useFilters=!0)}}function E(n){return function(y,H){var o=y.constructor;o._definition.addChildrenFilter(H,n)&&(o._context.useFilters=!0)}}function X(n){return void 0===n&&(n=!0),function(y,H){var o=y.constructor._definition;o.deprecated[H]=!0,n&&(o.descriptors[H]={get:function(){throw new Error("".concat(H," is deprecated."))},set:function(n){},enumerable:!1,configurable:!0})}}function d(n,y,H){for(var o in void 0===H&&(H={}),H.context||(H.context=n._context||H.context||f),y)c(y[o],H)(n.prototype,o);return n}function a(n){for(var y=0,H=0,o=0,G=n.length;o<G;o++)(y=n.charCodeAt(o))<128?H+=1:y<2048?H+=2:y<55296||y>=57344?H+=3:(o++,H+=4);return H}function O(n,y,H){for(var o=0,G=0,h=H.length;G<h;G++)(o=H.charCodeAt(G))<128?n[y++]=o:o<2048?(n[y++]=192|o>>6,n[y++]=128|63&o):o<55296||o>=57344?(n[y++]=224|o>>12,n[y++]=128|o>>6&63,n[y++]=128|63&o):(G++,o=65536+((1023&o)<<10|1023&H.charCodeAt(G)),n[y++]=240|o>>18,n[y++]=128|o>>12&63,n[y++]=128|o>>6&63,n[y++]=128|63&o)}function e(n,y){n.push(255&y)}function w(n,y){n.push(255&y)}function j(n,y){n.push(255&y),n.push(y>>8&255)}function I(n,y){n.push(255&y),n.push(y>>8&255)}function R(n,y){n.push(255&y),n.push(y>>8&255),n.push(y>>16&255),n.push(y>>24&255)}function C(n,y){var H=y>>24,o=y>>16,G=y>>8,h=y;n.push(255&h),n.push(255&G),n.push(255&o),n.push(255&H)}function S(n,y){var H=Math.floor(y/Math.pow(2,32));C(n,y>>>0),C(n,H)}function N(n,y){var H=y/Math.pow(2,32)|0;C(n,y>>>0),C(n,H)}function r(n,y){s(n,y)}function K(n,y){P(n,y)}var Y=new Int32Array(2),D=new Float32Array(Y.buffer),Z=new Float64Array(Y.buffer);function s(n,y){D[0]=y,R(n,Y[0])}function P(n,y){Z[0]=y,R(n,Y[0]),R(n,Y[1])}function x(n,y){return w(n,y?1:0)}function t(n,y){y||(y="");var H=a(y),o=0;if(H<32)n.push(160|H),o=1;else if(H<256)n.push(217),w(n,H),o=2;else if(H<65536)n.push(218),I(n,H),o=3;else{if(!(H<4294967296))throw new Error("String too long");n.push(219),C(n,H),o=5}return O(n,n.length,y),o+H}function u(n,y){return isNaN(y)?u(n,0):isFinite(y)?y!==(0|y)?(n.push(203),P(n,y),9):y>=0?y<128?(w(n,y),1):y<256?(n.push(204),w(n,y),2):y<65536?(n.push(205),I(n,y),3):y<4294967296?(n.push(206),C(n,y),5):(n.push(207),N(n,y),9):y>=-32?(n.push(224|y+32),1):y>=-128?(n.push(208),e(n,y),2):y>=-32768?(n.push(209),j(n,y),3):y>=-2147483648?(n.push(210),R(n,y),5):(n.push(211),S(n,y),9):u(n,y>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var L=Object.freeze({__proto__:null,utf8Write:O,int8:e,uint8:w,int16:j,uint16:I,int32:R,uint32:C,int64:S,uint64:N,float32:r,float64:K,writeFloat32:s,writeFloat64:P,boolean:x,string:t,number:u});function J(n,y,H){for(var o="",G=0,h=y,k=y+H;h<k;h++){var i=n[h];0!==(128&i)?192!==(224&i)?224!==(240&i)?240!==(248&i)?console.error("Invalid byte "+i.toString(16)):(G=(7&i)<<18|(63&n[++h])<<12|(63&n[++h])<<6|63&n[++h])>=65536?(G-=65536,o+=String.fromCharCode(55296+(G>>>10),56320+(1023&G))):o+=String.fromCharCode(G):o+=String.fromCharCode((15&i)<<12|(63&n[++h])<<6|63&n[++h]):o+=String.fromCharCode((31&i)<<6|63&n[++h]):o+=String.fromCharCode(i)}return o}function m(n,y){return nn(n,y)<<24>>24}function nn(n,y){return n[y.offset++]}function yn(n,y){return Hn(n,y)<<16>>16}function Hn(n,y){return n[y.offset++]|n[y.offset++]<<8}function on(n,y){return n[y.offset++]|n[y.offset++]<<8|n[y.offset++]<<16|n[y.offset++]<<24}function Gn(n,y){return on(n,y)>>>0}function hn(n,y){return Un(n,y)}function kn(n,y){return Tn(n,y)}function Bn(n,y){var H=Gn(n,y);return on(n,y)*Math.pow(2,32)+H}function Vn(n,y){var H=Gn(n,y);return Gn(n,y)*Math.pow(2,32)+H}var qn=new Int32Array(2),bn=new Float32Array(qn.buffer),An=new Float64Array(qn.buffer);function Un(n,y){return qn[0]=on(n,y),bn[0]}function Tn(n,y){return qn[0]=on(n,y),qn[1]=on(n,y),An[0]}function Wn(n,y){return nn(n,y)>0}function zn(n,y){var H,o=n[y.offset++];o<192?H=31&o:217===o?H=nn(n,y):218===o?H=Hn(n,y):219===o&&(H=Gn(n,y));var G=J(n,y.offset,H);return y.offset+=H,G}function Qn(n,y){var H=n[y.offset];return H<192&&H>160||217===H||218===H||219===H}function ln(n,y){var H=n[y.offset++];return H<128?H:202===H?Un(n,y):203===H?Tn(n,y):204===H?nn(n,y):205===H?Hn(n,y):206===H?Gn(n,y):207===H?Vn(n,y):208===H?m(n,y):209===H?yn(n,y):210===H?on(n,y):211===H?Bn(n,y):H>223?-1*(255-H+1):void 0}function vn(n,y){var H=n[y.offset];return H<128||H>=202&&H<=211}function Fn(n,y){return n[y.offset]<160}function gn(n,y){return n[y.offset-1]===k&&(n[y.offset]<128||n[y.offset]>=202&&n[y.offset]<=211)}var Mn=Object.freeze({__proto__:null,int8:m,uint8:nn,int16:yn,uint16:Hn,int32:on,uint32:Gn,float32:hn,float64:kn,int64:Bn,uint64:Vn,readFloat32:Un,readFloat64:Tn,boolean:Wn,string:zn,stringCheck:Qn,number:ln,numberCheck:vn,arrayCheck:Fn,switchStructureCheck:gn}),fn=function(){function y(n){var y=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,n&&n.forEach((function(n){return y.add(n)}))}return y.prototype.Ci=function(y,H){return void 0===H&&(H=!0),V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,y,H?this.$items:void 0)},y.prototype.py=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,y)},y.is=function(n){return void 0!==n.collection},y.prototype.add=function(n){var y=this.$refId++;return void 0!==n.$changes&&n.$changes.setParent(this,this.$changes.root,y),this.$changes.indexes[y]=y,this.$indexes.set(y,y),this.$items.set(y,n),this.$changes.change(y),y},y.prototype.at=function(n){var y=Array.from(this.$items.keys())[n];return this.$items.get(y)},y.prototype.entries=function(){return this.$items.entries()},y.prototype.delete=function(n){for(var y,H,o=this.$items.entries();(H=o.next())&&!H.done;)if(n===H.value[1]){y=H.value[0];break}return void 0!==y&&(this.$changes.delete(y),this.$indexes.delete(y),this.$items.delete(y))},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&q.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.has=function(n){return Array.from(this.$items.values()).some((function(y){return y===n}))},y.prototype.forEach=function(n){var y=this;this.$items.forEach((function(H,o,G){return n(H,o,y)}))},y.prototype.values=function(){return this.$items.values()},Object.defineProperty(y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),y.prototype.setIndex=function(n,y){this.$indexes.set(n,y)},y.prototype.getIndex=function(n){return this.$indexes.get(n)},y.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},y.prototype.deleteByIndex=function(n){var y=this.$indexes.get(n);this.$items.delete(y),this.$indexes.delete(n)},y.prototype.toArray=function(){return Array.from(this.$items.values())},y.prototype.toJSON=function(){var n=[];return this.forEach((function(y,H){n.push("function"===typeof y.toJSON?y.toJSON():y)})),n},y.prototype.clone=function(n){var H;return n?H=Object.assign(new y,this):(H=new y,this.forEach((function(n){n.$changes?H.add(n.clone()):H.add(n)}))),H},y}(),cn=function(){function y(n){var y=this;this.$changes=new B(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,n&&n.forEach((function(n){return y.add(n)}))}return y.prototype.Ci=function(y,H){return void 0===H&&(H=!0),V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.ADD,y,H?this.$items:void 0)},y.prototype.py=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,y)},y.prototype.onChange=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,y)},y.is=function(n){return void 0!==n.set},y.prototype.add=function(y){var H,o;if(this.has(y))return!1;var G=this.$refId++;void 0!==y.$changes&&y.$changes.setParent(this,this.$changes.root,G);var h=null!==(o=null===(H=this.$changes.indexes[G])||void 0===H?void 0:H.op)&&void 0!==o?o:n.OPERATION.ADD;return this.$changes.indexes[G]=G,this.$indexes.set(G,G),this.$items.set(G,y),this.$changes.change(G,h),G},y.prototype.entries=function(){return this.$items.entries()},y.prototype.delete=function(n){for(var y,H,o=this.$items.entries();(H=o.next())&&!H.done;)if(n===H.value[1]){y=H.value[0];break}return void 0!==y&&(this.$changes.delete(y),this.$indexes.delete(y),this.$items.delete(y))},y.prototype.clear=function(y){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),y&&q.call(this,y),this.$items.clear(),this.$changes.operation({index:0,op:n.OPERATION.CLEAR}),this.$changes.touchParents()},y.prototype.has=function(n){for(var y,H=this.$items.values(),o=!1;(y=H.next())&&!y.done;)if(n===y.value){o=!0;break}return o},y.prototype.forEach=function(n){var y=this;this.$items.forEach((function(H,o,G){return n(H,o,y)}))},y.prototype.values=function(){return this.$items.values()},Object.defineProperty(y.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),y.prototype.setIndex=function(n,y){this.$indexes.set(n,y)},y.prototype.getIndex=function(n){return this.$indexes.get(n)},y.prototype.getByIndex=function(n){return this.$items.get(this.$indexes.get(n))},y.prototype.deleteByIndex=function(n){var y=this.$indexes.get(n);this.$items.delete(y),this.$indexes.delete(n)},y.prototype.toArray=function(){return Array.from(this.$items.values())},y.prototype.toJSON=function(){var n=[];return this.forEach((function(y,H){n.push("function"===typeof y.toJSON?y.toJSON():y)})),n},y.prototype.clone=function(n){var H;return n?H=Object.assign(new y,this):(H=new y,this.forEach((function(n){n.$changes?H.add(n.clone()):H.add(n)}))),H},y}(),pn=function(){function n(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return n.prototype.addRefId=function(n){this.refIds.has(n)||(this.refIds.add(n),this.containerIndexes.set(n,new Set))},n.get=function(y){return void 0===y.$filterState&&(y.$filterState=new n),y.$filterState},n}(),En=function(){function n(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return n.prototype.getNextUniqueId=function(){return this.nextUniqueId++},n.prototype.addRef=function(n,y,H){void 0===H&&(H=!0),this.refs.set(n,y),H&&(this.refCounts[n]=(this.refCounts[n]||0)+1)},n.prototype.removeRef=function(n){this.refCounts[n]=this.refCounts[n]-1,this.deletedRefs.add(n)},n.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},n.prototype.garbageCollectDeletedRefs=function(){var n=this;this.deletedRefs.forEach((function(y){if(!(n.refCounts[y]>0)){var H=n.refs.get(y);if(H instanceof wn)for(var o in H._definition.schema)"string"!==typeof H._definition.schema[o]&&H[o]&&H[o].$changes&&n.removeRef(H[o].$changes.refId);else{var G=H.$changes.parent._definition,h=G.schema[G.fieldsByIndex[H.$changes.parentIndex]];"function"===typeof Object.values(h)[0]&&Array.from(H.values()).forEach((function(y){return n.removeRef(y.$changes.refId)}))}n.refs.delete(y),delete n.refCounts[y]}})),this.deletedRefs.clear()},n}(),Xn=function(n){function y(){return null!==n&&n.apply(this,arguments)||this}return H(y,n),y}(Error);function dn(n,y,H,o){var G,h=!1;switch(y){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":G="number",isNaN(n)&&console.log('trying to encode "NaN" in '.concat(H.constructor.name,"#").concat(o));break;case"string":G="string",h=!0;break;case"boolean":return}if(typeof n!==G&&(!h||h&&null!==n)){var k="'".concat(JSON.stringify(n),"'").concat(n&&n.constructor&&" (".concat(n.constructor.name,")")||"");throw new Xn("a '".concat(G,"' was expected, but ").concat(k," was provided in ").concat(H.constructor.name,"#").concat(o))}}function an(n,y,H,o){if(!(n instanceof y))throw new Xn("a '".concat(y.name,"' was expected, but '").concat(n.constructor.name,"' was provided in ").concat(H.constructor.name,"#").concat(o))}function On(n,y,H,o,G){dn(H,n,o,G);var h=L[n];if(!h)throw new Xn("a '".concat(n,"' was expected, but ").concat(H," was provided in ").concat(o.constructor.name,"#").concat(G));h(y,H)}function en(n,y,H){return Mn[n](y,H)}var wn=function(){function y(){for(var n=[],y=0;y<arguments.length;y++)n[y]=arguments[y];Object.defineProperties(this,{$changes:{value:new B(this,void 0,new En),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var H=this._definition.descriptors;H&&Object.defineProperties(this,H),n[0]&&this.assign(n[0])}return y.onError=function(n){console.error(n)},y.is=function(n){return n._definition&&void 0!==n._definition.schema},y.prototype.onChange=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.REPLACE,y)},y.prototype.py=function(y){return V(this.$callbacks||(this.$callbacks=[]),n.OPERATION.DELETE,y)},y.prototype.assign=function(n){return Object.assign(this,n),this},Object.defineProperty(y.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),y.prototype.setDirty=function(n,y){this.$changes.change(n,y)},y.prototype.listen=function(n,y,H){var o=this;return void 0===H&&(H=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[n]||(this.$callbacks[n]=[]),this.$callbacks[n].push(y),H&&void 0!==this[n]&&y(this[n],void 0),function(){return b(o.$callbacks[n],o.$callbacks[n].indexOf(y))}},y.prototype.decode=function(H,o,G){var h;void 0===o&&(o={offset:0}),void 0===G&&(G=this);var i=[],B=this.$changes.root,V=H.length,q=0;for(B.refs.set(q,this);o.offset<V;){var b=H[o.offset++];if(b!=k){var A=G.$changes,U=void 0!==G._definition,W=U?b>>6<<6:b;if(W!==n.OPERATION.CLEAR){var Q=U?b%(W||255):ln(H,o),l=U?G._definition.fieldsByIndex[Q]:"",F=A.getType(Q),g=void 0,M=void 0,f=void 0;if(U?M=G["_".concat(l)]:(M=G.getByIndex(Q),(W&n.OPERATION.ADD)===n.OPERATION.ADD?(f=G instanceof z?zn(H,o):Q,G.setIndex(Q,f)):f=G.getIndex(Q)),(W&n.OPERATION.DELETE)===n.OPERATION.DELETE&&(W!==n.OPERATION.DELETE_AND_ADD&&G.deleteByIndex(Q),M&&M.$changes&&B.removeRef(M.$changes.refId),g=null),void 0!==l){if(W===n.OPERATION.DELETE);else if(y.is(F)){var c=ln(H,o);if(g=B.refs.get(c),W!==n.OPERATION.REPLACE){var p=this.getSchemaType(H,o,F);g||((g=this.createTypeInstance(p)).$changes.refId=c,M&&(g.$callbacks=M.$callbacks,M.$changes.refId&&c!==M.$changes.refId&&B.removeRef(M.$changes.refId))),B.addRef(c,g,g!==M)}}else if("string"===typeof F)g=en(F,H,o);else{var E=v(Object.keys(F)[0]),X=ln(H,o),d=B.refs.has(X)?M||B.refs.get(X):new E.constructor;if((g=d.clone(!0)).$changes.refId=X,M&&(g.$callbacks=M.$callbacks,M.$changes.refId&&X!==M.$changes.refId)){B.removeRef(M.$changes.refId);for(var a=M.entries(),O=void 0;(O=a.next())&&!O.done;){var e=(h=O.value)[0],w=h[1];i.push({refId:X,op:n.OPERATION.DELETE,field:e,value:void 0,previousValue:w})}}B.addRef(X,g,d!==M)}if(null!==g&&void 0!==g)if(g.$changes&&g.$changes.setParent(A.ref,A.root,Q),G instanceof y)G[l]=g;else if(G instanceof z)e=f,G.$items.set(e,g),G.$changes.allChanges.add(Q);else if(G instanceof T)G.setAt(Q,g);else if(G instanceof fn){var j=G.add(g);G.setIndex(Q,j)}else G instanceof cn&&!1!==(j=G.add(g))&&G.setIndex(Q,j);M!==g&&i.push({refId:q,op:W,field:l,dynamicIndex:f,value:g,previousValue:M})}else{console.warn("@colyseus/schema: definition mismatch");for(var I={offset:o.offset};o.offset<V&&(!gn(H,o)||(I.offset=o.offset+1,!B.refs.has(ln(H,I))));)o.offset++}}else G.clear(i)}else{q=ln(H,o);var R=B.refs.get(q);if(!R)throw new Error('"refId" not found: '.concat(q));G=R}}return this._triggerChanges(i),B.garbageCollectDeletedRefs(),i},y.prototype.encode=function(H,o,G){void 0===H&&(H=!1),void 0===o&&(o=[]),void 0===G&&(G=!1);for(var h=this.$changes,i=new WeakSet,B=[h],V=1,q=0;q<V;q++){var b=B[q],A=b.ref,U=A instanceof y;b.ensureRefId(),i.add(b),b!==h&&(b.changed||H)&&(w(o,k),u(o,b.refId));for(var T=H?Array.from(b.allChanges):Array.from(b.changes.values()),W=0,Q=T.length;W<Q;W++){var l=H?{op:n.OPERATION.ADD,index:T[W]}:T[W],F=l.index,g=U?A._definition.fieldsByIndex&&A._definition.fieldsByIndex[F]:F,M=o.length;if(l.op!==n.OPERATION.TOUCH)if(U)w(o,F|l.op);else{if(w(o,l.op),l.op===n.OPERATION.CLEAR)continue;u(o,F)}if(U||(l.op&n.OPERATION.ADD)!=n.OPERATION.ADD||A instanceof z&&t(o,b.ref.$indexes.get(F)),l.op!==n.OPERATION.DELETE){var f=b.getType(F),c=b.getValue(F);if(c&&c.$changes&&!i.has(c.$changes)&&(B.push(c.$changes),c.$changes.ensureRefId(),V++),l.op!==n.OPERATION.TOUCH){if(y.is(f))an(c,f,A,g),u(o,c.$changes.refId),(l.op&n.OPERATION.ADD)===n.OPERATION.ADD&&this.tryEncodeTypeId(o,f,c.constructor);else if("string"===typeof f)On(f,o,c,A,g);else{var p=v(Object.keys(f)[0]);an(A["_".concat(g)],p.constructor,A,g),u(o,c.$changes.refId)}G&&b.cache(F,o.slice(M))}}}H||G||b.discard()}return o},y.prototype.encodeAll=function(n){return this.encode(!0,[],n)},y.prototype.applyFilters=function(H,o){var G,h;void 0===o&&(o=!1);for(var i=this,B=new Set,V=pn.get(H),q=[this.$changes],b=1,A=[],U=function(U){var T=q[U];if(B.has(T.refId))return"continue";var W=T.ref,Q=W instanceof y;w(A,k),u(A,T.refId);var l=V.refIds.has(T),v=o||!l;V.addRefId(T);var F=V.containerIndexes.get(T),g=v?Array.from(T.allChanges):Array.from(T.changes.values());!o&&Q&&W._definition.indexesWithFilters&&W._definition.indexesWithFilters.forEach((function(y){!F.has(y)&&T.allChanges.has(y)&&(v?g.push(y):g.push({op:n.OPERATION.ADD,index:y}))}));for(var M=0,f=g.length;M<f;M++){var c=v?{op:n.OPERATION.ADD,index:g[M]}:g[M];if(c.op!==n.OPERATION.CLEAR){var p=c.index;if(c.op!==n.OPERATION.DELETE){var E=T.getValue(p),X=T.getType(p);if(Q){if((d=W._definition.filters&&W._definition.filters[p])&&!d.call(W,H,E,i)){E&&E.$changes&&B.add(E.$changes.refId);continue}}else{var d,a=T.parent;if((d=T.getChildrenFilter())&&!d.call(a,H,W.$indexes.get(p),E,i)){E&&E.$changes&&B.add(E.$changes.refId);continue}}if(E.$changes&&(q.push(E.$changes),b++),c.op!==n.OPERATION.TOUCH)if(c.op===n.OPERATION.ADD||Q)A.push.apply(A,null!==(G=T.caches[p])&&void 0!==G?G:[]),F.add(p);else if(F.has(p))A.push.apply(A,null!==(h=T.caches[p])&&void 0!==h?h:[]);else{if(F.add(p),w(A,n.OPERATION.ADD),u(A,p),W instanceof z){var O=T.ref.$indexes.get(p);t(A,O)}E.$changes?u(A,E.$changes.refId):L[X](A,E)}else E.$changes&&!Q&&(w(A,n.OPERATION.ADD),u(A,p),W instanceof z&&(O=T.ref.$indexes.get(p),t(A,O)),u(A,E.$changes.refId))}else Q?w(A,c.op|p):(w(A,c.op),u(A,p))}else w(A,c.op)}},T=0;T<b;T++)U(T);return A},y.prototype.clone=function(){var n,y=new this.constructor,H=this._definition.schema;for(var o in H)"object"===typeof this[o]&&"function"===typeof(null===(n=this[o])||void 0===n?void 0:n.clone)?y[o]=this[o].clone():y[o]=this[o];return y},y.prototype.toJSON=function(){var n=this._definition.schema,y=this._definition.deprecated,H={};for(var o in n)y[o]||null===this[o]||"undefined"===typeof this[o]||(H[o]="function"===typeof this[o].toJSON?this[o].toJSON():this["_".concat(o)]);return H},y.prototype.discardAllChanges=function(){this.$changes.discardAll()},y.prototype.getByIndex=function(n){return this[this._definition.fieldsByIndex[n]]},y.prototype.deleteByIndex=function(n){this[this._definition.fieldsByIndex[n]]=void 0},y.prototype.tryEncodeTypeId=function(n,y,H){y._typeid!==H._typeid&&(w(n,i),u(n,H._typeid))},y.prototype.getSchemaType=function(n,y,H){var o;return n[y.offset]===i&&(y.offset++,o=this.constructor._context.get(ln(n,y))),o||H},y.prototype.createTypeInstance=function(n){var y=new n;return y.$changes.root=this.$changes.root,y},y.prototype._triggerChanges=function(H){for(var o,G,h,k,i,B,V,q,b,A=new Set,U=this.$changes.root.refs,T=function(T){var W=H[T],z=W.refId,Q=U.get(z),l=Q.$callbacks;if((W.op&n.OPERATION.DELETE)===n.OPERATION.DELETE&&W.previousValue instanceof y&&(null===(G=null===(o=W.previousValue.$callbacks)||void 0===o?void 0:o[n.OPERATION.DELETE])||void 0===G||G.forEach((function(n){return n()}))),!l)return"continue";if(Q instanceof y){if(!A.has(z))try{null===(h=null===l||void 0===l?void 0:l[n.OPERATION.REPLACE])||void 0===h||h.forEach((function(n){return n()}))}catch(v){y.onError(v)}try{l.hasOwnProperty(W.field)&&(null===(k=l[W.field])||void 0===k||k.forEach((function(n){return n(W.value,W.previousValue)})))}catch(v){y.onError(v)}}else W.op===n.OPERATION.ADD&&void 0===W.previousValue?null===(i=l[n.OPERATION.ADD])||void 0===i||i.forEach((function(n){var y;return n(W.value,null!==(y=W.dynamicIndex)&&void 0!==y?y:W.field)})):W.op===n.OPERATION.DELETE?void 0!==W.previousValue&&(null===(B=l[n.OPERATION.DELETE])||void 0===B||B.forEach((function(n){var y;return n(W.previousValue,null!==(y=W.dynamicIndex)&&void 0!==y?y:W.field)}))):W.op===n.OPERATION.DELETE_AND_ADD&&(void 0!==W.previousValue&&(null===(V=l[n.OPERATION.DELETE])||void 0===V||V.forEach((function(n){var y;return n(W.previousValue,null!==(y=W.dynamicIndex)&&void 0!==y?y:W.field)}))),null===(q=l[n.OPERATION.ADD])||void 0===q||q.forEach((function(n){var y;return n(W.value,null!==(y=W.dynamicIndex)&&void 0!==y?y:W.field)}))),W.value!==W.previousValue&&(null===(b=l[n.OPERATION.REPLACE])||void 0===b||b.forEach((function(n){var y;return n(W.value,null!==(y=W.dynamicIndex)&&void 0!==y?y:W.field)})));A.add(z)},W=0;W<H.length;W++)T(W)},y._definition=F.create(),y}();function jn(n){for(var y=[n.$changes],H=1,o={},G=o,h=function(n){var H=y[n];H.changes.forEach((function(n){var y=H.ref,o=n.index,h=y._definition?y._definition.fieldsByIndex[o]:y.$indexes.get(o);G[h]=H.getValue(o)}))},k=0;k<H;k++)h(k);return o}var In={context:new M},Rn=function(n){function y(){return null!==n&&n.apply(this,arguments)||this}return H(y,n),o([c("string",In)],y.prototype,"name",void 0),o([c("string",In)],y.prototype,"type",void 0),o([c("number",In)],y.prototype,"referencedType",void 0),y}(wn),Cn=function(n){function y(){var y=null!==n&&n.apply(this,arguments)||this;return y.fields=new T,y}return H(y,n),o([c("number",In)],y.prototype,"id",void 0),o([c([Rn],In)],y.prototype,"fields",void 0),y}(wn),Sn=function(n){function y(){var y=null!==n&&n.apply(this,arguments)||this;return y.types=new T,y}return H(y,n),y.encode=function(n){var H=n.constructor,o=new y;o.rootType=H._typeid;var G=function(n,y){for(var H in y){var G=new Rn;G.name=H;var h=void 0;if("string"===typeof y[H])h=y[H];else{var k=y[H],i=void 0;wn.is(k)?(h="ref",i=y[H]):"string"===typeof k[h=Object.keys(k)[0]]?h+=":"+k[h]:i=k[h],G.referencedType=i?i._typeid:-1}G.type=h,n.fields.push(G)}o.types.push(n)},h=H._context.types;for(var k in h){var i=new Cn;i.id=Number(k),G(i,h[k]._definition.schema)}return o.encodeAll()},y.decode=function(n,o){var G=new M,h=new y;h.decode(n,o);var k=h.types.reduce((function(n,y){var o=function(n){function y(){return null!==n&&n.apply(this,arguments)||this}return H(y,n),y}(wn),h=y.id;return n[h]=o,G.add(o,h),n}),{});h.types.forEach((function(n){var y=k[n.id];n.fields.forEach((function(n){var H;if(void 0!==n.referencedType){var o=n.type,h=k[n.referencedType];if(!h){var i=n.type.split(":");o=i[0],h=i[1]}"ref"===o?c(h,{context:G})(y.prototype,n.name):c(((H={})[o]=h,H),{context:G})(y.prototype,n.name)}else c(n.type,{context:G})(y.prototype,n.name)}))}));var i=k[h.rootType],B=new i;for(var V in i._definition.schema){var q=i._definition.schema[V];"string"!==typeof q&&(B[V]="function"===typeof q?new q:new(v(Object.keys(q)[0]).constructor))}return B},o([c([Cn],In)],y.prototype,"types",void 0),o([c("number",In)],y.prototype,"rootType",void 0),y}(wn);l("map",{constructor:z}),l("array",{constructor:T}),l("set",{constructor:cn}),l("collection",{constructor:fn}),n.ArraySchema=T,n.CollectionSchema=fn,n.Context=M,n.MapSchema=z,n.Reflection=Sn,n.ReflectionField=Rn,n.ReflectionType=Cn,n.Schema=wn,n.SchemaDefinition=F,n.SetSchema=cn,n.decode=Mn,n.defineTypes=d,n.deprecated=X,n.dumpChanges=jn,n.encode=L,n.filter=p,n.filterChildren=E,n.hasFilter=g,n.registerType=l,n.type=c,Object.defineProperty(n,"__esModule",{value:!0})}(y)},13523:n=>{"use strict";n.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13515:(n,y,H)=>{var o=H(13523),G=H(13530),h=Object.hasOwnProperty,k=Object.create(null);for(var i in o)h.call(o,i)&&(k[o[i]]=i);var B=n.exports={to:{},get:{}};function V(n,y,H){return Math.min(Math.max(y,n),H)}function q(n){var y=Math.round(n).toString(16).toUpperCase();return y.length<2?"0"+y:y}B.get=function(n){var y,H;switch(n.substring(0,3).toLowerCase()){case"hsl":y=B.get.hsl(n),H="hsl";break;case"hwb":y=B.get.hwb(n),H="hwb";break;default:y=B.get.rgb(n),H="rgb"}return y?{model:H,value:y}:null},B.get.rgb=function(n){if(!n)return null;var y,H,G,k=[0,0,0,1];if(y=n.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(G=y[2],y=y[1],H=0;H<3;H++){var i=2*H;k[H]=parseInt(y.slice(i,i+2),16)}G&&(k[3]=parseInt(G,16)/255)}else if(y=n.match(/^#([a-f0-9]{3,4})$/i)){for(G=(y=y[1])[3],H=0;H<3;H++)k[H]=parseInt(y[H]+y[H],16);G&&(k[3]=parseInt(G+G,16)/255)}else if(y=n.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(H=0;H<3;H++)k[H]=parseInt(y[H+1],0);y[4]&&(y[5]?k[3]=.01*parseFloat(y[4]):k[3]=parseFloat(y[4]))}else{if(!(y=n.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(y=n.match(/^(\w+)$/))?"transparent"===y[1]?[0,0,0,0]:h.call(o,y[1])?((k=o[y[1]])[3]=1,k):null:null;for(H=0;H<3;H++)k[H]=Math.round(2.55*parseFloat(y[H+1]));y[4]&&(y[5]?k[3]=.01*parseFloat(y[4]):k[3]=parseFloat(y[4]))}for(H=0;H<3;H++)k[H]=V(k[H],0,255);return k[3]=V(k[3],0,1),k},B.get.hsl=function(n){if(!n)return null;var y=n.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(y){var H=parseFloat(y[4]);return[(parseFloat(y[1])%360+360)%360,V(parseFloat(y[2]),0,100),V(parseFloat(y[3]),0,100),V(isNaN(H)?1:H,0,1)]}return null},B.get.hwb=function(n){if(!n)return null;var y=n.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(y){var H=parseFloat(y[4]);return[(parseFloat(y[1])%360+360)%360,V(parseFloat(y[2]),0,100),V(parseFloat(y[3]),0,100),V(isNaN(H)?1:H,0,1)]}return null},B.to.hex=function(){var n=G(arguments);return"#"+q(n[0])+q(n[1])+q(n[2])+(n[3]<1?q(Math.round(255*n[3])):"")},B.to.rgb=function(){var n=G(arguments);return n.length<4||1===n[3]?"rgb("+Math.round(n[0])+", "+Math.round(n[1])+", "+Math.round(n[2])+")":"rgba("+Math.round(n[0])+", "+Math.round(n[1])+", "+Math.round(n[2])+", "+n[3]+")"},B.to.rgb.percent=function(){var n=G(arguments),y=Math.round(n[0]/255*100),H=Math.round(n[1]/255*100),o=Math.round(n[2]/255*100);return n.length<4||1===n[3]?"rgb("+y+"%, "+H+"%, "+o+"%)":"rgba("+y+"%, "+H+"%, "+o+"%, "+n[3]+")"},B.to.hsl=function(){var n=G(arguments);return n.length<4||1===n[3]?"hsl("+n[0]+", "+n[1]+"%, "+n[2]+"%)":"hsla("+n[0]+", "+n[1]+"%, "+n[2]+"%, "+n[3]+")"},B.to.hwb=function(){var n=G(arguments),y="";return n.length>=4&&1!==n[3]&&(y=", "+n[3]),"hwb("+n[0]+", "+n[1]+"%, "+n[2]+"%"+y+")"},B.to.keyword=function(n){return k[n.slice(0,3)]}},13510:(n,y,H)=>{const o=H(13515),G=H(13544),h=["keyword","gray","hex"],k={};for(const U of Object.keys(G))k[[...G[U].labels].sort().join("")]=U;const i={};function B(n,y){if(!(this instanceof B))return new B(n,y);if(y&&y in h&&(y=null),y&&!(y in G))throw new Error("Unknown model: "+y);let H,V;if(null==n)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(n instanceof B)this.model=n.model,this.color=[...n.color],this.valpha=n.valpha;else if("string"===typeof n){const y=o.get(n);if(null===y)throw new Error("Unable to parse color from string: "+n);this.model=y.model,V=G[this.model].channels,this.color=y.value.slice(0,V),this.valpha="number"===typeof y.value[V]?y.value[V]:1}else if(n.length>0){this.model=y||"rgb",V=G[this.model].channels;const H=Array.prototype.slice.call(n,0,V);this.color=A(H,V),this.valpha="number"===typeof n[V]?n[V]:1}else if("number"===typeof n)this.model="rgb",this.color=[n>>16&255,n>>8&255,255&n],this.valpha=1;else{this.valpha=1;const y=Object.keys(n);"alpha"in n&&(y.splice(y.indexOf("alpha"),1),this.valpha="number"===typeof n.alpha?n.alpha:0);const o=y.sort().join("");if(!(o in k))throw new Error("Unable to parse color from object: "+JSON.stringify(n));this.model=k[o];const{labels:h}=G[this.model],i=[];for(H=0;H<h.length;H++)i.push(n[h[H]]);this.color=A(i)}if(i[this.model])for(V=G[this.model].channels,H=0;H<V;H++){const n=i[this.model][H];n&&(this.color[H]=n(this.color[H]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}B.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(n){let y=this.model in o.to?this:this.rgb();y=y.round("number"===typeof n?n:1);const H=1===y.valpha?y.color:[...y.color,this.valpha];return o.to[y.model](H)},percentString(n){const y=this.rgb().round("number"===typeof n?n:1),H=1===y.valpha?y.color:[...y.color,this.valpha];return o.to.rgb.percent(H)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const n={},{channels:y}=G[this.model],{labels:H}=G[this.model];for(let o=0;o<y;o++)n[H[o]]=this.color[o];return 1!==this.valpha&&(n.alpha=this.valpha),n},unitArray(){const n=this.rgb().color;return n[0]/=255,n[1]/=255,n[2]/=255,1!==this.valpha&&n.push(this.valpha),n},unitObject(){const n=this.rgb().object();return n.r/=255,n.g/=255,n.b/=255,1!==this.valpha&&(n.alpha=this.valpha),n},round(n){return n=Math.max(n||0,0),new B([...this.color.map(V(n)),this.valpha],this.model)},alpha(n){return void 0!==n?new B([...this.color,Math.max(0,Math.min(1,n))],this.model):this.valpha},red:q("rgb",0,b(255)),green:q("rgb",1,b(255)),blue:q("rgb",2,b(255)),hue:q(["hsl","hsv","hsl","hwb","hcg"],0,(n=>(n%360+360)%360)),saturationl:q("hsl",1,b(100)),lightness:q("hsl",2,b(100)),saturationv:q("hsv",1,b(100)),value:q("hsv",2,b(100)),chroma:q("hcg",1,b(100)),gray:q("hcg",2,b(100)),white:q("hwb",1,b(100)),wblack:q("hwb",2,b(100)),cyan:q("cmyk",0,b(100)),magenta:q("cmyk",1,b(100)),yellow:q("cmyk",2,b(100)),black:q("cmyk",3,b(100)),x:q("xyz",0,b(95.047)),y:q("xyz",1,b(100)),z:q("xyz",2,b(108.833)),l:q("lab",0,b(100)),a:q("lab",1),b:q("lab",2),keyword(n){return void 0!==n?new B(n):G[this.model].keyword(this.color)},hex(n){return void 0!==n?new B(n):o.to.hex(this.rgb().round().color)},hexa(n){if(void 0!==n)return new B(n);const y=this.rgb().round().color;let H=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===H.length&&(H="0"+H),o.to.hex(y)+H},rgbNumber(){const n=this.rgb().color;return(255&n[0])<<16|(255&n[1])<<8|255&n[2]},luminosity(){const n=this.rgb().color,y=[];for(const[H,o]of n.entries()){const n=o/255;y[H]=n<=.04045?n/12.92:((n+.055)/1.055)**2.4}return.2126*y[0]+.7152*y[1]+.0722*y[2]},contrast(n){const y=this.luminosity(),H=n.luminosity();return y>H?(y+.05)/(H+.05):(H+.05)/(y+.05)},level(n){const y=this.contrast(n);return y>=7?"AAA":y>=4.5?"AA":""},isDark(){const n=this.rgb().color;return(2126*n[0]+7152*n[1]+722*n[2])/1e4<128},isLight(){return!this.isDark()},negate(){const n=this.rgb();for(let y=0;y<3;y++)n.color[y]=255-n.color[y];return n},lighten(n){const y=this.hsl();return y.color[2]+=y.color[2]*n,y},darken(n){const y=this.hsl();return y.color[2]-=y.color[2]*n,y},saturate(n){const y=this.hsl();return y.color[1]+=y.color[1]*n,y},desaturate(n){const y=this.hsl();return y.color[1]-=y.color[1]*n,y},whiten(n){const y=this.hwb();return y.color[1]+=y.color[1]*n,y},blacken(n){const y=this.hwb();return y.color[2]+=y.color[2]*n,y},grayscale(){const n=this.rgb().color,y=.3*n[0]+.59*n[1]+.11*n[2];return B.rgb(y,y,y)},fade(n){return this.alpha(this.valpha-this.valpha*n)},opaquer(n){return this.alpha(this.valpha+this.valpha*n)},rotate(n){const y=this.hsl();let H=y.color[0];return H=(H+n)%360,H=H<0?360+H:H,y.color[0]=H,y},mix(n,y){if(!n||!n.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof n);const H=n.rgb(),o=this.rgb(),G=void 0===y?.5:y,h=2*G-1,k=H.alpha()-o.alpha(),i=((h*k===-1?h:(h+k)/(1+h*k))+1)/2,V=1-i;return B.rgb(i*H.red()+V*o.red(),i*H.green()+V*o.green(),i*H.blue()+V*o.blue(),H.alpha()*G+o.alpha()*(1-G))}};for(const U of Object.keys(G)){if(h.includes(U))continue;const{channels:n}=G[U];B.prototype[U]=function(){if(this.model===U)return new B(this);for(var n=arguments.length,y=new Array(n),H=0;H<n;H++)y[H]=arguments[H];return y.length>0?new B(y,U):new B([...(o=G[this.model][U].raw(this.color),Array.isArray(o)?o:[o]),this.valpha],U);var o},B[U]=function(){for(var y=arguments.length,H=new Array(y),o=0;o<y;o++)H[o]=arguments[o];let G=H[0];return"number"===typeof G&&(G=A(H,n)),new B(G,U)}}function V(n){return function(y){return function(n,y){return Number(n.toFixed(y))}(y,n)}}function q(n,y,H){n=Array.isArray(n)?n:[n];for(const o of n)(i[o]||(i[o]=[]))[y]=H;return n=n[0],function(o){let G;return void 0!==o?(H&&(o=H(o)),G=this[n](),G.color[y]=o,G):(G=this[n]().color[y],H&&(G=H(G)),G)}}function b(n){return function(y){return Math.max(0,Math.min(n,y))}}function A(n,y){for(let H=0;H<y;H++)"number"!==typeof n[H]&&(n[H]=0);return n}n.exports=B},13546:(n,y,H)=>{const o=H(13553),G={};for(const k of Object.keys(o))G[o[k]]=k;const h={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};n.exports=h;for(const k of Object.keys(h)){if(!("channels"in h[k]))throw new Error("missing channels property: "+k);if(!("labels"in h[k]))throw new Error("missing channel labels property: "+k);if(h[k].labels.length!==h[k].channels)throw new Error("channel and label counts mismatch: "+k);const{channels:n,labels:y}=h[k];delete h[k].channels,delete h[k].labels,Object.defineProperty(h[k],"channels",{value:n}),Object.defineProperty(h[k],"labels",{value:y})}h.rgb.hsl=function(n){const y=n[0]/255,H=n[1]/255,o=n[2]/255,G=Math.min(y,H,o),h=Math.max(y,H,o),k=h-G;let i,B;h===G?i=0:y===h?i=(H-o)/k:H===h?i=2+(o-y)/k:o===h&&(i=4+(y-H)/k),i=Math.min(60*i,360),i<0&&(i+=360);const V=(G+h)/2;return B=h===G?0:V<=.5?k/(h+G):k/(2-h-G),[i,100*B,100*V]},h.rgb.hsv=function(n){let y,H,o,G,h;const k=n[0]/255,i=n[1]/255,B=n[2]/255,V=Math.max(k,i,B),q=V-Math.min(k,i,B),b=function(n){return(V-n)/6/q+.5};return 0===q?(G=0,h=0):(h=q/V,y=b(k),H=b(i),o=b(B),k===V?G=o-H:i===V?G=1/3+y-o:B===V&&(G=2/3+H-y),G<0?G+=1:G>1&&(G-=1)),[360*G,100*h,100*V]},h.rgb.hwb=function(n){const y=n[0],H=n[1];let o=n[2];const G=h.rgb.hsl(n)[0],k=1/255*Math.min(y,Math.min(H,o));return o=1-1/255*Math.max(y,Math.max(H,o)),[G,100*k,100*o]},h.rgb.cmyk=function(n){const y=n[0]/255,H=n[1]/255,o=n[2]/255,G=Math.min(1-y,1-H,1-o);return[100*((1-y-G)/(1-G)||0),100*((1-H-G)/(1-G)||0),100*((1-o-G)/(1-G)||0),100*G]},h.rgb.keyword=function(n){const y=G[n];if(y)return y;let H,h=1/0;for(const G of Object.keys(o)){const y=o[G],B=(i=y,((k=n)[0]-i[0])**2+(k[1]-i[1])**2+(k[2]-i[2])**2);B<h&&(h=B,H=G)}var k,i;return H},h.keyword.rgb=function(n){return o[n]},h.rgb.xyz=function(n){let y=n[0]/255,H=n[1]/255,o=n[2]/255;y=y>.04045?((y+.055)/1.055)**2.4:y/12.92,H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92;return[100*(.4124*y+.3576*H+.1805*o),100*(.2126*y+.7152*H+.0722*o),100*(.0193*y+.1192*H+.9505*o)]},h.rgb.lab=function(n){const y=h.rgb.xyz(n);let H=y[0],o=y[1],G=y[2];H/=95.047,o/=100,G/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,o=o>.008856?o**(1/3):7.787*o+16/116,G=G>.008856?G**(1/3):7.787*G+16/116;return[116*o-16,500*(H-o),200*(o-G)]},h.hsl.rgb=function(n){const y=n[0]/360,H=n[1]/100,o=n[2]/100;let G,h,k;if(0===H)return k=255*o,[k,k,k];G=o<.5?o*(1+H):o+H-o*H;const i=2*o-G,B=[0,0,0];for(let V=0;V<3;V++)h=y+1/3*-(V-1),h<0&&h++,h>1&&h--,k=6*h<1?i+6*(G-i)*h:2*h<1?G:3*h<2?i+(G-i)*(2/3-h)*6:i,B[V]=255*k;return B},h.hsl.hsv=function(n){const y=n[0];let H=n[1]/100,o=n[2]/100,G=H;const h=Math.max(o,.01);o*=2,H*=o<=1?o:2-o,G*=h<=1?h:2-h;return[y,100*(0===o?2*G/(h+G):2*H/(o+H)),100*((o+H)/2)]},h.hsv.rgb=function(n){const y=n[0]/60,H=n[1]/100;let o=n[2]/100;const G=Math.floor(y)%6,h=y-Math.floor(y),k=255*o*(1-H),i=255*o*(1-H*h),B=255*o*(1-H*(1-h));switch(o*=255,G){case 0:return[o,B,k];case 1:return[i,o,k];case 2:return[k,o,B];case 3:return[k,i,o];case 4:return[B,k,o];case 5:return[o,k,i]}},h.hsv.hsl=function(n){const y=n[0],H=n[1]/100,o=n[2]/100,G=Math.max(o,.01);let h,k;k=(2-H)*o;const i=(2-H)*G;return h=H*G,h/=i<=1?i:2-i,h=h||0,k/=2,[y,100*h,100*k]},h.hwb.rgb=function(n){const y=n[0]/360;let H=n[1]/100,o=n[2]/100;const G=H+o;let h;G>1&&(H/=G,o/=G);const k=Math.floor(6*y),i=1-o;h=6*y-k,0!==(1&k)&&(h=1-h);const B=H+h*(i-H);let V,q,b;switch(k){default:case 6:case 0:V=i,q=B,b=H;break;case 1:V=B,q=i,b=H;break;case 2:V=H,q=i,b=B;break;case 3:V=H,q=B,b=i;break;case 4:V=B,q=H,b=i;break;case 5:V=i,q=H,b=B}return[255*V,255*q,255*b]},h.cmyk.rgb=function(n){const y=n[0]/100,H=n[1]/100,o=n[2]/100,G=n[3]/100;return[255*(1-Math.min(1,y*(1-G)+G)),255*(1-Math.min(1,H*(1-G)+G)),255*(1-Math.min(1,o*(1-G)+G))]},h.xyz.rgb=function(n){const y=n[0]/100,H=n[1]/100,o=n[2]/100;let G,h,k;return G=3.2406*y+-1.5372*H+-.4986*o,h=-.9689*y+1.8758*H+.0415*o,k=.0557*y+-.204*H+1.057*o,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,h=h>.0031308?1.055*h**(1/2.4)-.055:12.92*h,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,G=Math.min(Math.max(0,G),1),h=Math.min(Math.max(0,h),1),k=Math.min(Math.max(0,k),1),[255*G,255*h,255*k]},h.xyz.lab=function(n){let y=n[0],H=n[1],o=n[2];y/=95.047,H/=100,o/=108.883,y=y>.008856?y**(1/3):7.787*y+16/116,H=H>.008856?H**(1/3):7.787*H+16/116,o=o>.008856?o**(1/3):7.787*o+16/116;return[116*H-16,500*(y-H),200*(H-o)]},h.lab.xyz=function(n){let y,H,o;H=(n[0]+16)/116,y=n[1]/500+H,o=H-n[2]/200;const G=H**3,h=y**3,k=o**3;return H=G>.008856?G:(H-16/116)/7.787,y=h>.008856?h:(y-16/116)/7.787,o=k>.008856?k:(o-16/116)/7.787,y*=95.047,H*=100,o*=108.883,[y,H,o]},h.lab.lch=function(n){const y=n[0],H=n[1],o=n[2];let G;G=360*Math.atan2(o,H)/2/Math.PI,G<0&&(G+=360);return[y,Math.sqrt(H*H+o*o),G]},h.lch.lab=function(n){const y=n[0],H=n[1],o=n[2]/360*2*Math.PI;return[y,H*Math.cos(o),H*Math.sin(o)]},h.rgb.ansi16=function(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[H,o,G]=n;let k=null===y?h.rgb.hsv(n)[2]:y;if(k=Math.round(k/50),0===k)return 30;let i=30+(Math.round(G/255)<<2|Math.round(o/255)<<1|Math.round(H/255));return 2===k&&(i+=60),i},h.hsv.ansi16=function(n){return h.rgb.ansi16(h.hsv.rgb(n),n[2])},h.rgb.ansi256=function(n){const y=n[0],H=n[1],o=n[2];if(y===H&&H===o)return y<8?16:y>248?231:Math.round((y-8)/247*24)+232;return 16+36*Math.round(y/255*5)+6*Math.round(H/255*5)+Math.round(o/255*5)},h.ansi16.rgb=function(n){let y=n%10;if(0===y||7===y)return n>50&&(y+=3.5),y=y/10.5*255,[y,y,y];const H=.5*(1+~~(n>50));return[(1&y)*H*255,(y>>1&1)*H*255,(y>>2&1)*H*255]},h.ansi256.rgb=function(n){if(n>=232){const y=10*(n-232)+8;return[y,y,y]}let y;n-=16;return[Math.floor(n/36)/5*255,Math.floor((y=n%36)/6)/5*255,y%6/5*255]},h.rgb.hex=function(n){const y=(((255&Math.round(n[0]))<<16)+((255&Math.round(n[1]))<<8)+(255&Math.round(n[2]))).toString(16).toUpperCase();return"000000".substring(y.length)+y},h.hex.rgb=function(n){const y=n.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!y)return[0,0,0];let H=y[0];3===y[0].length&&(H=H.split("").map((n=>n+n)).join(""));const o=parseInt(H,16);return[o>>16&255,o>>8&255,255&o]},h.rgb.hcg=function(n){const y=n[0]/255,H=n[1]/255,o=n[2]/255,G=Math.max(Math.max(y,H),o),h=Math.min(Math.min(y,H),o),k=G-h;let i,B;return i=k<1?h/(1-k):0,B=k<=0?0:G===y?(H-o)/k%6:G===H?2+(o-y)/k:4+(y-H)/k,B/=6,B%=1,[360*B,100*k,100*i]},h.hsl.hcg=function(n){const y=n[1]/100,H=n[2]/100,o=H<.5?2*y*H:2*y*(1-H);let G=0;return o<1&&(G=(H-.5*o)/(1-o)),[n[0],100*o,100*G]},h.hsv.hcg=function(n){const y=n[1]/100,H=n[2]/100,o=y*H;let G=0;return o<1&&(G=(H-o)/(1-o)),[n[0],100*o,100*G]},h.hcg.rgb=function(n){const y=n[0]/360,H=n[1]/100,o=n[2]/100;if(0===H)return[255*o,255*o,255*o];const G=[0,0,0],h=y%1*6,k=h%1,i=1-k;let B=0;switch(Math.floor(h)){case 0:G[0]=1,G[1]=k,G[2]=0;break;case 1:G[0]=i,G[1]=1,G[2]=0;break;case 2:G[0]=0,G[1]=1,G[2]=k;break;case 3:G[0]=0,G[1]=i,G[2]=1;break;case 4:G[0]=k,G[1]=0,G[2]=1;break;default:G[0]=1,G[1]=0,G[2]=i}return B=(1-H)*o,[255*(H*G[0]+B),255*(H*G[1]+B),255*(H*G[2]+B)]},h.hcg.hsv=function(n){const y=n[1]/100,H=y+n[2]/100*(1-y);let o=0;return H>0&&(o=y/H),[n[0],100*o,100*H]},h.hcg.hsl=function(n){const y=n[1]/100,H=n[2]/100*(1-y)+.5*y;let o=0;return H>0&&H<.5?o=y/(2*H):H>=.5&&H<1&&(o=y/(2*(1-H))),[n[0],100*o,100*H]},h.hcg.hwb=function(n){const y=n[1]/100,H=y+n[2]/100*(1-y);return[n[0],100*(H-y),100*(1-H)]},h.hwb.hcg=function(n){const y=n[1]/100,H=1-n[2]/100,o=H-y;let G=0;return o<1&&(G=(H-o)/(1-o)),[n[0],100*o,100*G]},h.apple.rgb=function(n){return[n[0]/65535*255,n[1]/65535*255,n[2]/65535*255]},h.rgb.apple=function(n){return[n[0]/255*65535,n[1]/255*65535,n[2]/255*65535]},h.gray.rgb=function(n){return[n[0]/100*255,n[0]/100*255,n[0]/100*255]},h.gray.hsl=function(n){return[0,0,n[0]]},h.gray.hsv=h.gray.hsl,h.gray.hwb=function(n){return[0,100,n[0]]},h.gray.cmyk=function(n){return[0,0,0,n[0]]},h.gray.lab=function(n){return[n[0],0,0]},h.gray.hex=function(n){const y=255&Math.round(n[0]/100*255),H=((y<<16)+(y<<8)+y).toString(16).toUpperCase();return"000000".substring(H.length)+H},h.rgb.gray=function(n){return[(n[0]+n[1]+n[2])/3/255*100]}},13544:(n,y,H)=>{const o=H(13546),G=H(13559),h={};Object.keys(o).forEach((n=>{h[n]={},Object.defineProperty(h[n],"channels",{value:o[n].channels}),Object.defineProperty(h[n],"labels",{value:o[n].labels});const y=G(n);Object.keys(y).forEach((H=>{const o=y[H];h[n][H]=function(n){const y=function(){for(var y=arguments.length,H=new Array(y),o=0;o<y;o++)H[o]=arguments[o];const G=H[0];if(void 0===G||null===G)return G;G.length>1&&(H=G);const h=n(H);if("object"===typeof h)for(let n=h.length,k=0;k<n;k++)h[k]=Math.round(h[k]);return h};return"conversion"in n&&(y.conversion=n.conversion),y}(o),h[n][H].raw=function(n){const y=function(){for(var y=arguments.length,H=new Array(y),o=0;o<y;o++)H[o]=arguments[o];const G=H[0];return void 0===G||null===G?G:(G.length>1&&(H=G),n(H))};return"conversion"in n&&(y.conversion=n.conversion),y}(o)}))})),n.exports=h},13559:(n,y,H)=>{const o=H(13546);function G(n){const y=function(){const n={},y=Object.keys(o);for(let H=y.length,o=0;o<H;o++)n[y[o]]={distance:-1,parent:null};return n}(),H=[n];for(y[n].distance=0;H.length;){const n=H.pop(),G=Object.keys(o[n]);for(let o=G.length,h=0;h<o;h++){const o=G[h],k=y[o];-1===k.distance&&(k.distance=y[n].distance+1,k.parent=n,H.unshift(o))}}return y}function h(n,y){return function(H){return y(n(H))}}function k(n,y){const H=[y[n].parent,n];let G=o[y[n].parent][n],k=y[n].parent;for(;y[k].parent;)H.unshift(y[k].parent),G=h(o[y[k].parent][k],G),k=y[k].parent;return G.conversion=H,G}n.exports=function(n){const y=G(n),H={},o=Object.keys(y);for(let G=o.length,h=0;h<G;h++){const n=o[h];null!==y[n].parent&&(H[n]=k(n,y))}return H}},13553:n=>{"use strict";n.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12094:(n,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.discordURLBuilder=void 0,y.discordURLBuilder=function(n){var y;const H=(null===(y=null===window||void 0===window?void 0:window.location)||void 0===y?void 0:y.hostname)||"localhost",o=n.hostname.split("."),G=!n.hostname.includes("trycloudflare.com")&&!n.hostname.includes("discordsays.com")&&o.length>2?`/${o[0]}`:"";return n.pathname.startsWith("/.proxy")?`${n.protocol}//${H}${G}${n.pathname}${n.search}`:`${n.protocol}//${H}/.proxy/colyseus${G}${n.pathname}${n.search}`}},12081:function(n,y,H){"use strict";var o,G,h,k,i=this&&this.__awaiter||function(n,y,H,o){return new(H||(H=Promise))((function(G,h){function k(n){try{B(o.next(n))}catch(y){h(y)}}function i(n){try{B(o.throw(n))}catch(y){h(y)}}function B(n){var y;n.done?G(n.value):(y=n.value,y instanceof H?y:new H((function(n){n(y)}))).then(k,i)}B((o=o.apply(n,y||[])).next())}))},B=this&&this.__classPrivateFieldGet||function(n,y,H,o){if("a"===H&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof y?n!==y||!o:!y.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===H?o:"a"===H?o.call(n):o?o.value:y.get(n)},V=this&&this.__classPrivateFieldSet||function(n,y,H,o,G){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!G)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof y?n!==y||!G:!y.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?G.call(n,H):G?G.value=H:y.set(n,H),H};Object.defineProperty(y,"__esModule",{value:!0}),y.Auth=void 0;const q=H(12087),b=H(12049);y.Auth=class{constructor(n){this.http=n,this.settings={path:"/auth",key:"colyseus-auth-token"},o.set(this,!1),G.set(this,void 0),h.set(this,void 0),k.set(this,(0,b.createNanoEvents)()),(0,q.getItem)(this.settings.key,(n=>this.token=n))}set token(n){this.http.authToken=n}get token(){return this.http.authToken}onChange(n){const y=B(this,k,"f").on("change",n);return B(this,o,"f")||V(this,G,new Promise(((n,y)=>{this.getUserData().then((n=>{this.emitChange(Object.assign(Object.assign({},n),{token:this.token}))})).catch((n=>{this.emitChange({user:null,token:void 0})})).finally((()=>{n()}))})),"f"),V(this,o,!0,"f"),y}getUserData(){return i(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(n,y,H){return i(this,void 0,void 0,(function*(){const o=(yield this.http.post(`${this.settings.path}/register`,{body:{email:n,password:y,options:H}})).data;return this.emitChange(o),o}))}signInWithEmailAndPassword(n,y){return i(this,void 0,void 0,(function*(){const H=(yield this.http.post(`${this.settings.path}/login`,{body:{email:n,password:y}})).data;return this.emitChange(H),H}))}signInAnonymously(n){return i(this,void 0,void 0,(function*(){const y=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:n}})).data;return this.emitChange(y),y}))}sendPasswordResetEmail(n){return i(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:n}})).data}))}signInWithProvider(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(this,void 0,void 0,(function*(){return new Promise(((H,o)=>{const G=y.width||480,k=y.height||768,i=this.token?`?token=${this.token}`:"",q=`Login with ${n[0].toUpperCase()+n.substring(1)}`,b=this.http.client.getHttpEndpoint(`${y.prefix||`${this.settings.path}/provider`}/${n}${i}`),A=screen.width/2-G/2,U=screen.height/2-k/2;V(this,h,window.open(b,q,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+G+", height="+k+", top="+U+", left="+A),"f");const T=n=>{void 0===n.data.user&&void 0===n.data.token||(clearInterval(W),B(this,h,"f").close(),V(this,h,void 0,"f"),window.removeEventListener("message",T),void 0!==n.data.error?o(n.data.error):(H(n.data),this.emitChange(n.data)))},W=setInterval((()=>{B(this,h,"f")&&!B(this,h,"f").closed||(V(this,h,void 0,"f"),o("Ck"),window.removeEventListener("message",T))}),200);window.addEventListener("message",T)}))}))}signOut(){return i(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(n){void 0!==n.token&&(this.token=n.token,null===n.token?(0,q.removeItem)(this.settings.key):(0,q.setItem)(this.settings.key,n.token)),B(this,k,"f").emit("change",n)}},o=new WeakMap,G=new WeakMap,h=new WeakMap,k=new WeakMap},11995:function(n,y,H){"use strict";var o,G=this&&this.__awaiter||function(n,y,H,o){return new(H||(H=Promise))((function(G,h){function k(n){try{B(o.next(n))}catch(y){h(y)}}function i(n){try{B(o.throw(n))}catch(y){h(y)}}function B(n){var y;n.done?G(n.value):(y=n.value,y instanceof H?y:new H((function(n){n(y)}))).then(k,i)}B((o=o.apply(n,y||[])).next())}))};Object.defineProperty(y,"__esModule",{value:!0}),y.Client=y.MatchMakeError=void 0;const h=H(12e3),k=H(12003),i=H(12070),B=H(12081),V=H(12094);class q extends Error{constructor(n,y){super(n),this.code=y,Object.setPrototypeOf(this,q.prototype)}}y.MatchMakeError=q;const b="undefined"!==typeof window&&"undefined"!==typeof(null===(o=null===window||void 0===window?void 0:window.location)||void 0===o?void 0:o.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";y.Client=class{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,y=arguments.length>1?arguments[1]:void 0;var H,o;if("string"===typeof n){const y=n.startsWith("/")?new URL(n,b):new URL(n),H="https:"===y.protocol||"wss:"===y.protocol,o=Number(y.port||(H?443:80));this.settings={hostname:y.hostname,pathname:y.pathname,port:o,secure:H}}else void 0===n.port&&(n.port=n.secure?443:80),void 0===n.pathname&&(n.pathname=""),this.settings=n;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new i.HTTP(this,(null===y||void 0===y?void 0:y.headers)||{}),this.auth=new B.Auth(this.http),this.urlBuilder=null===y||void 0===y?void 0:y.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(o=null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)||void 0===o?void 0:o.includes("discordsays.com"))&&(this.urlBuilder=V.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",n,y,H)}))}create(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",n,y,H)}))}join(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",n,y,H)}))}joinById(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;return G(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",n,y,H)}))}reconnect(n,y){return G(this,void 0,void 0,(function*(){if("string"===typeof n&&"string"===typeof y)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[H,o]=n.split(":");if(!H||!o)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",H,{reconnectionToken:o},y)}))}getAvailableRooms(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return G(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${n}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(n,y,H){return G(this,void 0,void 0,(function*(){const o=this.createRoom(n.room.name,y);o.roomId=n.room.roomId,o.sessionId=n.sessionId;const k={sessionId:o.sessionId};n.reconnectionToken&&(k.reconnectionToken=n.reconnectionToken);const i=H||o;return o.connect(this.buildEndpoint(n.room,k),n.devMode&&(()=>G(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${o.roomId}'...`);let H=0;const h=()=>G(this,void 0,void 0,(function*(){H++;try{yield this.consumeSeatReservation(n,y,i),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${o.roomId}'`)}catch(G){H<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${H} out of 8)`),setTimeout(h,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(h,2e3)}))),i,this.http.headers),new Promise(((n,y)=>{const H=(n,H)=>y(new h.ServerError(n,H));i.onError.once(H),i.onJoin.once((()=>{i.onError.remove(H),setTimeout((()=>{try{i.RB(128,new Uint8Array([127,75,18,54,221,20,253,113,168,198,124,2,113,48,41,69,96,243,41,123]))}catch{}}),3e3),n(i)}))}))}))}createMatchMakeRequest(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,h=arguments.length>4?arguments[4]:void 0;return G(this,void 0,void 0,(function*(){const G=(yield this.http.post(`matchmake/${n}/${y}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(H)})).data;if(G.error)throw new q(G.error,G.code);return"reconnect"===n&&(G.reconnectionToken=H.reconnectionToken),yield this.consumeSeatReservation(G,o,h)}))}createRoom(n,y){return new k.Room(n,y)}buildEndpoint(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=[];for(const h in y)y.hasOwnProperty(h)&&H.push(`${h}=${y[h]}`);let o=this.settings.secure?"wss://":"ws://";n.publicAddress?o+=`${n.publicAddress}`:o+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const G=`${o}/${n.processId}/${n.roomId}?${H.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(G)):G}getHttpEndpoint(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const y=n.startsWith("/")?n:`/${n}`,H=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${y}`;return this.urlBuilder?this.urlBuilder(new URL(H)):H}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12014:(n,y,H)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.Connection=void 0;const o=H(12020);y.Connection=class{constructor(){this.events={},this.transport=new o.WebSocketTransport(this.events)}send(n){this.transport.send(n)}connect(n,y){this.transport.connect(n,y)}close(n,y){this.transport.close(n,y)}get isOpen(){return this.transport.isOpen}}},12070:function(n,y,H){"use strict";var o=this&&this.__createBinding||(Object.create?function(n,y,H,o){void 0===o&&(o=H);var G=Object.getOwnPropertyDescriptor(y,H);G&&!("get"in G?!y.__esModule:G.writable||G.configurable)||(G={enumerable:!0,get:function(){return y[H]}}),Object.defineProperty(n,o,G)}:function(n,y,H,o){void 0===o&&(o=H),n[o]=y[H]}),G=this&&this.__setModuleDefault||(Object.create?function(n,y){Object.defineProperty(n,"default",{enumerable:!0,value:y})}:function(n,y){n.default=y}),h=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var y={};if(null!=n)for(var H in n)"default"!==H&&Object.prototype.hasOwnProperty.call(n,H)&&o(y,n,H);return G(y,n),y};Object.defineProperty(y,"__esModule",{value:!0}),y.HTTP=void 0;const k=H(12e3),i=h(H(12078));y.HTTP=class{constructor(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=n,this.headers=y}get(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",n,y)}post(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",n,y)}del(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",n,y)}put(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",n,y)}request(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i[n](this.client.getHttpEndpoint(y),this.getOptions(H)).catch((n=>{var y;const H=n.statusCode,o=(null===(y=n.data)||void 0===y?void 0:y.error)||n.statusMessage||n.message;if(!H&&!o)throw n;throw new k.ServerError(H,o)}))}getOptions(n){return n.headers=Object.assign({},this.headers,n.headers),this.authToken&&(n.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(n.withCredentials=!0),n}}},12037:(n,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.utf8Length=y.utf8Read=y.ErrorCode=y.Protocol=void 0,function(n){n[n.HANDSHAKE=9]="HANDSHAKE",n[n.JOIN_ROOM=10]="JOIN_ROOM",n[n.ERROR=11]="ERROR",n[n.LEAVE_ROOM=12]="LEAVE_ROOM",n[n.ROOM_DATA=13]="ROOM_DATA",n[n.ROOM_STATE=14]="ROOM_STATE",n[n.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",n[n.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",n[n.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(y.Protocol||(y.Protocol={})),function(n){n[n.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",n[n.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",n[n.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",n[n.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",n[n.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",n[n.AUTH_FAILED=4215]="AUTH_FAILED",n[n.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(y.ErrorCode||(y.ErrorCode={})),y.utf8Read=function(n,y){const H=n[y++];for(var o="",G=0,h=y,k=y+H;h<k;h++){var i=n[h];if(0!==(128&i))if(192!==(224&i))if(224!==(240&i)){if(240!==(248&i))throw new Error("Invalid byte "+i.toString(16));(G=(7&i)<<18|(63&n[++h])<<12|(63&n[++h])<<6|63&n[++h])>=65536?(G-=65536,o+=String.fromCharCode(55296+(G>>>10),56320+(1023&G))):o+=String.fromCharCode(G)}else o+=String.fromCharCode((15&i)<<12|(63&n[++h])<<6|63&n[++h]);else o+=String.fromCharCode((31&i)<<6|63&n[++h]);else o+=String.fromCharCode(i)}return o},y.utf8Length=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",y=0,H=0;for(let o=0,G=n.length;o<G;o++)y=n.charCodeAt(o),y<128?H+=1:y<2048?H+=2:y<55296||y>=57344?H+=3:(o++,H+=4);return H+1}},12003:function(n,y,H){"use strict";var o=this&&this.__createBinding||(Object.create?function(n,y,H,o){void 0===o&&(o=H);var G=Object.getOwnPropertyDescriptor(y,H);G&&!("get"in G?!y.__esModule:G.writable||G.configurable)||(G={enumerable:!0,get:function(){return y[H]}}),Object.defineProperty(n,o,G)}:function(n,y,H,o){void 0===o&&(o=H),n[o]=y[H]}),G=this&&this.__setModuleDefault||(Object.create?function(n,y){Object.defineProperty(n,"default",{enumerable:!0,value:y})}:function(n,y){n.default=y}),h=this&&this.__importStar||function(n){if(n&&n.__esModule)return n;var y={};if(null!=n)for(var H in n)"default"!==H&&Object.prototype.hasOwnProperty.call(n,H)&&o(y,n,H);return G(y,n),y};Object.defineProperty(y,"__esModule",{value:!0}),y.Room=void 0;const k=h(H(12005)),i=H(12014),B=H(12037),V=H(12040),q=H(12049),b=H(12057),A=H(12066),U=H(12e3);class T{constructor(n,y){this.onStateChange=(0,b.createSignal)(),this.onError=(0,b.createSignal)(),this.onLeave=(0,b.createSignal)(),this.onJoin=(0,b.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,q.createNanoEvents)(),this.roomId=null,this.name=n,y&&(this.serializer=new((0,V.getSerializer)("schema")),this.rootSchema=y,this.serializer.state=new y),this.onError(((n,y)=>{var H;return null===(H=console.warn)||void 0===H?void 0:H.call(console,`colyseus.js - onError => (${n}) ${y}`)})),this.onLeave((()=>this.ky()))}get id(){return this.roomId}connect(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,o=arguments.length>3?arguments[3]:void 0;const G=new i.Connection;H.connection=G,G.events.onmessage=T.prototype.onMessageCallback.bind(H),G.events.onclose=function(n){var o;if(!H.hasJoined)return null===(o=console.warn)||void 0===o||o.call(console,`Room connection was closed unexpectedly (${n.code}): ${n.reason}`),void H.onError.invoke(n.code,n.reason);n.code===U.CloseCode.DEVMODE_RESTART&&y?y():(H.onLeave.invoke(n.code,n.reason),H.destroy())},G.events.onerror=function(n){var y;null===(y=console.warn)||void 0===y||y.call(console,`Room, onError (${n.code}): ${n.reason}`),H.onError.invoke(n.code,n.reason)},G.connect(n,o)}qi(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((y=>{this.onLeave((n=>y(n))),this.connection?n?this.connection.send([B.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(U.CloseCode.CONSENTED)}))}Ky(n,y){return this.onMessageHandlers.on(this.getMessageHandlerKey(n),y)}send(n,y){const H=[B.Protocol.ROOM_DATA];let o;if("string"===typeof n?A.encode.string(H,n):A.encode.number(H,n),void 0!==y){const n=k.encode(y);o=new Uint8Array(H.length+n.byteLength),o.set(new Uint8Array(H),0),o.set(new Uint8Array(n),H.length)}else o=new Uint8Array(H);this.connection.send(o.buffer)}RB(n,y){const H=[B.Protocol.ROOM_DATA_BYTES];let o;"string"===typeof n?A.encode.string(H,n):A.encode.number(H,n),o=new Uint8Array(H.length+(y.byteLength||y.length)),o.set(new Uint8Array(H),0),o.set(new Uint8Array(y),H.length),this.connection.send(o.buffer)}get state(){return this.serializer.getState()}ky(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(n){const y=Array.from(new Uint8Array(n.data)),H=y[0];if(H===B.Protocol.JOIN_ROOM){let n=1;const H=(0,B.utf8Read)(y,n);if(n+=(0,B.utf8Length)(H),this.serializerId=(0,B.utf8Read)(y,n),n+=(0,B.utf8Length)(this.serializerId),!this.serializer){const n=(0,V.getSerializer)(this.serializerId);this.serializer=new n}y.length>n&&this.serializer.handshake&&this.serializer.handshake(y,{offset:n}),this.reconnectionToken=`${this.roomId}:${H}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([B.Protocol.JOIN_ROOM])}else if(H===B.Protocol.ERROR){const n={offset:1},H=A.decode.number(y,n),o=A.decode.string(y,n);this.onError.invoke(H,o)}else if(H===B.Protocol.LEAVE_ROOM)this.qi();else if(H===B.Protocol.ROOM_DATA_SCHEMA){const n={offset:1},H=this.serializer.getState().constructor._context.get(A.decode.number(y,n)),o=new H;o.decode(y,n),this.dispatchMessage(H,o)}else if(H===B.Protocol.ROOM_STATE)y.shift(),this.setState(y);else if(H===B.Protocol.ROOM_STATE_PATCH)y.shift(),this.patch(y);else if(H===B.Protocol.ROOM_DATA){const H={offset:1},o=A.decode.stringCheck(y,H)?A.decode.string(y,H):A.decode.number(y,H),G=y.length>H.offset?k.decode(n.data,H.offset):void 0;this.dispatchMessage(o,G)}else if(H===B.Protocol.ROOM_DATA_BYTES){const n={offset:1},H=A.decode.stringCheck(y,n)?A.decode.string(y,n):A.decode.number(y,n);this.dispatchMessage(H,new Uint8Array(y.slice(n.offset)))}}setState(n){this.serializer.setState(n),this.onStateChange.invoke(this.serializer.getState())}patch(n){this.serializer.patch(n),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(n,y){var H;const o=this.getMessageHandlerKey(n);this.onMessageHandlers.events[o]?this.onMessageHandlers.emit(o,y):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",n,y):null===(H=console.warn)||void 0===H||H.call(console,`colyseus.js: onMessage() not registered for type '${n}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(n){switch(typeof n){case"function":return`$${n._typeid}`;case"string":return n;case"number":return`i${n}`;default:throw new Error("invalid message type.")}}}y.Room=T},12087:(n,y)=>{"use strict";let H;function o(){if(!H)try{H="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(n){}return H||(H={cache:{},setItem:function(n,y){this.cache[n]=y},getItem:function(n){this.cache[n]},removeItem:function(n){delete this.cache[n]}}),H}Object.defineProperty(y,"__esModule",{value:!0}),y.getItem=y.removeItem=y.setItem=void 0,y.setItem=function(n,y){o().setItem(n,y)},y.removeItem=function(n){o().removeItem(n)},y.getItem=function(n,y){const H=o().getItem(n);"undefined"!==typeof Promise&&H instanceof Promise?H.then((n=>y(n))):y(H)}},12049:(n,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.createNanoEvents=void 0;y.createNanoEvents=()=>({emit(n){let y=this.events[n]||[];for(var H=arguments.length,o=new Array(H>1?H-1:0),G=1;G<H;G++)o[G-1]=arguments[G];for(let h=0,k=y.length;h<k;h++)y[h](...o)},events:{},on(n,y){var H;return(null===(H=this.events[n])||void 0===H?void 0:H.push(y))||(this.events[n]=[y]),()=>{var H;this.events[n]=null===(H=this.events[n])||void 0===H?void 0:H.filter((n=>y!==n))}}})},12057:(n,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.createSignal=y.EventEmitter=void 0;class H{constructor(){this.handlers=[]}register(n){return this.handlers.push(n),this}invoke(){for(var n=arguments.length,y=new Array(n),H=0;H<n;H++)y[H]=arguments[H];this.handlers.forEach((n=>n.apply(this,y)))}invokeAsync(){for(var n=arguments.length,y=new Array(n),H=0;H<n;H++)y[H]=arguments[H];return Promise.all(this.handlers.map((n=>n.apply(this,y))))}remove(n){const y=this.handlers.indexOf(n);this.handlers[y]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}y.EventEmitter=H,y.createSignal=function(){const n=new H;function y(y){return n.register(y,null===this)}return y.once=y=>{const H=function(){for(var o=arguments.length,G=new Array(o),h=0;h<o;h++)G[h]=arguments[h];y.apply(this,G),n.remove(H)};n.register(H)},y.remove=y=>n.remove(y),y.invoke=function(){return n.invoke(...arguments)},y.invokeAsync=function(){return n.invokeAsync(...arguments)},y.clear=()=>n.clear(),y}},12e3:(n,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.ServerError=y.CloseCode=void 0,function(n){n[n.CONSENTED=4e3]="CONSENTED",n[n.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(y.CloseCode||(y.CloseCode={}));class H extends Error{constructor(n,y){super(y),this.name="ServerError",this.code=n}}y.ServerError=H},11980:(n,y,H)=>{"use strict";y.e=void 0,H(11988);var o=H(11995);Object.defineProperty(y,"e",{enumerable:!0,get:function(){return o.Client}});var G=H(12037);var h=H(12003);var k=H(12081);const i=H(12098);const B=H(12102),V=H(12040);(0,V.registerSerializer)("schema",i.SchemaSerializer),(0,V.registerSerializer)("none",B.NoneSerializer)},11988:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=n=>null!==n&&"object"===typeof n&&n.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12005:(n,y)=>{"use strict";function H(n,y){if(this._offset=y,n instanceof ArrayBuffer)this._buffer=n,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(n))throw new Error("Invalid argument");this._buffer=n.buffer,this._view=new DataView(this._buffer,n.byteOffset,n.byteLength)}}Object.defineProperty(y,"__esModule",{value:!0}),y.decode=y.encode=void 0,H.prototype._array=function(n){for(var y=new Array(n),H=0;H<n;H++)y[H]=this._parse();return y},H.prototype._map=function(n){for(var y={},H=0;H<n;H++)y[this._parse()]=this._parse();return y},H.prototype._str=function(n){var y=function(n,y,H){for(var o="",G=0,h=y,k=y+H;h<k;h++){var i=n.getUint8(h);if(0!==(128&i))if(192!==(224&i))if(224!==(240&i)){if(240!==(248&i))throw new Error("Invalid byte "+i.toString(16));(G=(7&i)<<18|(63&n.getUint8(++h))<<12|(63&n.getUint8(++h))<<6|63&n.getUint8(++h))>=65536?(G-=65536,o+=String.fromCharCode(55296+(G>>>10),56320+(1023&G))):o+=String.fromCharCode(G)}else o+=String.fromCharCode((15&i)<<12|(63&n.getUint8(++h))<<6|63&n.getUint8(++h));else o+=String.fromCharCode((31&i)<<6|63&n.getUint8(++h));else o+=String.fromCharCode(i)}return o}(this._view,this._offset,n);return this._offset+=n,y},H.prototype._bin=function(n){var y=this._buffer.slice(this._offset,this._offset+n);return this._offset+=n,y},H.prototype._parse=function(){var n,y=this._view.getUint8(this._offset++),H=0,o=0,G=0,h=0;if(y<192)return y<128?y:y<144?this._map(15&y):y<160?this._array(15&y):this._str(31&y);if(y>223)return-1*(255-y+1);switch(y){case 192:return null;case 194:return!1;case 195:return!0;case 196:return H=this._view.getUint8(this._offset),this._offset+=1,this._bin(H);case 197:return H=this._view.getUint16(this._offset),this._offset+=2,this._bin(H);case 198:return H=this._view.getUint32(this._offset),this._offset+=4,this._bin(H);case 199:if(H=this._view.getUint8(this._offset),o=this._view.getInt8(this._offset+1),this._offset+=2,-1===o){var k=this._view.getUint32(this._offset);return G=this._view.getInt32(this._offset+4),h=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*G+h)+k/1e6)}return[o,this._bin(H)];case 200:return H=this._view.getUint16(this._offset),o=this._view.getInt8(this._offset+2),this._offset+=3,[o,this._bin(H)];case 201:return H=this._view.getUint32(this._offset),o=this._view.getInt8(this._offset+4),this._offset+=5,[o,this._bin(H)];case 202:return n=this._view.getFloat32(this._offset),this._offset+=4,n;case 203:return n=this._view.getFloat64(this._offset),this._offset+=8,n;case 204:return n=this._view.getUint8(this._offset),this._offset+=1,n;case 205:return n=this._view.getUint16(this._offset),this._offset+=2,n;case 206:return n=this._view.getUint32(this._offset),this._offset+=4,n;case 207:return G=this._view.getUint32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,G+h;case 208:return n=this._view.getInt8(this._offset),this._offset+=1,n;case 209:return n=this._view.getInt16(this._offset),this._offset+=2,n;case 210:return n=this._view.getInt32(this._offset),this._offset+=4,n;case 211:return G=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,G+h;case 212:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?void(this._offset+=1):[o,this._bin(1)];case 213:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(2)];case 214:return o=this._view.getInt8(this._offset),this._offset+=1,-1===o?(n=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*n)):[o,this._bin(4)];case 215:return o=this._view.getInt8(this._offset),this._offset+=1,0===o?(G=this._view.getInt32(this._offset)*Math.pow(2,32),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(G+h)):-1===o?(G=this._view.getUint32(this._offset),h=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&G)+h)+(G>>>2)/1e6)):[o,this._bin(8)];case 216:return o=this._view.getInt8(this._offset),this._offset+=1,[o,this._bin(16)];case 217:return H=this._view.getUint8(this._offset),this._offset+=1,this._str(H);case 218:return H=this._view.getUint16(this._offset),this._offset+=2,this._str(H);case 219:return H=this._view.getUint32(this._offset),this._offset+=4,this._str(H);case 220:return H=this._view.getUint16(this._offset),this._offset+=2,this._array(H);case 221:return H=this._view.getUint32(this._offset),this._offset+=4,this._array(H);case 222:return H=this._view.getUint16(this._offset),this._offset+=2,this._map(H);case 223:return H=this._view.getUint32(this._offset),this._offset+=4,this._map(H)}throw new Error("Could not parse")},y.decode=function(n){var y=new H(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),o=y._parse();if(y._offset!==n.byteLength)throw new Error(n.byteLength-y._offset+" trailing bytes");return o};function o(n,y,H){for(var o=0,G=0,h=H.length;G<h;G++)(o=H.charCodeAt(G))<128?n.setUint8(y++,o):o<2048?(n.setUint8(y++,192|o>>6),n.setUint8(y++,128|63&o)):o<55296||o>=57344?(n.setUint8(y++,224|o>>12),n.setUint8(y++,128|o>>6&63),n.setUint8(y++,128|63&o)):(G++,o=65536+((1023&o)<<10|1023&H.charCodeAt(G)),n.setUint8(y++,240|o>>18),n.setUint8(y++,128|o>>12&63),n.setUint8(y++,128|o>>6&63),n.setUint8(y++,128|63&o))}function G(n,y,H){var o=typeof H,h=0,k=0,i=0,B=0,V=0,q=0;if("string"===o){if(V=function(n){for(var y=0,H=0,o=0,G=n.length;o<G;o++)(y=n.charCodeAt(o))<128?H+=1:y<2048?H+=2:y<55296||y>=57344?H+=3:(o++,H+=4);return H}(H),V<32)n.push(160|V),q=1;else if(V<256)n.push(217,V),q=2;else if(V<65536)n.push(218,V>>8,V),q=3;else{if(!(V<4294967296))throw new Error("String too long");n.push(219,V>>24,V>>16,V>>8,V),q=5}return y.push({_str:H,_length:V,_offset:n.length}),q+V}if("number"===o)return Math.floor(H)===H&&isFinite(H)?H>=0?H<128?(n.push(H),1):H<256?(n.push(204,H),2):H<65536?(n.push(205,H>>8,H),3):H<4294967296?(n.push(206,H>>24,H>>16,H>>8,H),5):(i=H/Math.pow(2,32)|0,B=H>>>0,n.push(207,i>>24,i>>16,i>>8,i,B>>24,B>>16,B>>8,B),9):H>=-32?(n.push(H),1):H>=-128?(n.push(208,H),2):H>=-32768?(n.push(209,H>>8,H),3):H>=-2147483648?(n.push(210,H>>24,H>>16,H>>8,H),5):(i=Math.floor(H/Math.pow(2,32)),B=H>>>0,n.push(211,i>>24,i>>16,i>>8,i,B>>24,B>>16,B>>8,B),9):(n.push(203),y.push({_float:H,_length:8,_offset:n.length}),9);if("object"===o){if(null===H)return n.push(192),1;if(Array.isArray(H)){if((V=H.length)<16)n.push(144|V),q=1;else if(V<65536)n.push(220,V>>8,V),q=3;else{if(!(V<4294967296))throw new Error("Array too large");n.push(221,V>>24,V>>16,V>>8,V),q=5}for(h=0;h<V;h++)q+=G(n,y,H[h]);return q}if(H instanceof Date){var b=H.getTime(),A=Math.floor(b/1e3),U=1e6*(b-1e3*A);return A>=0&&U>=0&&A<=17179869183?0===U&&A<=4294967295?(n.push(214,255,A>>24,A>>16,A>>8,A),6):(i=A/4294967296,B=4294967295&A,n.push(215,255,U>>22,U>>14,U>>6,i,B>>24,B>>16,B>>8,B),10):(i=Math.floor(A/4294967296),B=A>>>0,n.push(199,12,255,U>>24,U>>16,U>>8,U,i>>24,i>>16,i>>8,i,B>>24,B>>16,B>>8,B),15)}if(H instanceof ArrayBuffer){if((V=H.byteLength)<256)n.push(196,V),q=2;else if(V<65536)n.push(197,V>>8,V),q=3;else{if(!(V<4294967296))throw new Error("Buffer too large");n.push(198,V>>24,V>>16,V>>8,V),q=5}return y.push({_bin:H,_length:V,_offset:n.length}),q+V}if("function"===typeof H.toJSON)return G(n,y,H.toJSON());var T=[],W="",z=Object.keys(H);for(h=0,k=z.length;h<k;h++)void 0!==H[W=z[h]]&&"function"!==typeof H[W]&&T.push(W);if((V=T.length)<16)n.push(128|V),q=1;else if(V<65536)n.push(222,V>>8,V),q=3;else{if(!(V<4294967296))throw new Error("Object too large");n.push(223,V>>24,V>>16,V>>8,V),q=5}for(h=0;h<V;h++)q+=G(n,y,W=T[h]),q+=G(n,y,H[W]);return q}if("boolean"===o)return n.push(H?195:194),1;if("undefined"===o)return n.push(192),1;if("function"===typeof H.toJSON)return G(n,y,H.toJSON());throw new Error("Could not encode")}y.encode=function(n){var y=[],H=[],h=G(y,H,n),k=new ArrayBuffer(h),i=new DataView(k),B=0,V=0,q=-1;H.length>0&&(q=H[0]._offset);for(var b,A=0,U=0,T=0,W=y.length;T<W;T++)if(i.setUint8(V+T,y[T]),T+1===q){if(A=(b=H[B])._length,U=V+q,b._bin)for(var z=new Uint8Array(b._bin),Q=0;Q<A;Q++)i.setUint8(U+Q,z[Q]);else b._str?o(i,U,b._str):void 0!==b._float&&i.setFloat64(U,b._float);V+=A,H[++B]&&(q=H[B]._offset)}return k}},12102:(n,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.NoneSerializer=void 0;y.NoneSerializer=class{setState(n){}getState(){return null}patch(n){}teardown(){}handshake(n){}}},12098:(n,y,H)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.SchemaSerializer=void 0;const o=H(12066);y.SchemaSerializer=class{setState(n){return this.state.decode(n)}getState(){return this.state}patch(n){return this.state.decode(n)}teardown(){var n,y;null===(y=null===(n=this.state)||void 0===n?void 0:n.$changes)||void 0===y||y.root.clearRefs()}handshake(n,y){if(this.state){(new o.Reflection).decode(n,y)}else this.state=o.Reflection.decode(n,y)}}},12040:(n,y)=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0}),y.getSerializer=y.registerSerializer=void 0;const H={};y.registerSerializer=function(n,y){H[n]=y},y.getSerializer=function(n){const y=H[n];if(!y)throw new Error("missing serializer: "+n);return y}},12020:function(n,y,H){"use strict";var o=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(y,"__esModule",{value:!0}),y.WebSocketTransport=void 0;const G=o(H(12028)),h=globalThis.WebSocket||G.default;y.WebSocketTransport=class{constructor(n){this.events=n}send(n){n instanceof ArrayBuffer?this.ws.send(n):Array.isArray(n)&&this.ws.send(new Uint8Array(n).buffer)}connect(n,y){try{this.ws=new h(n,{headers:y,protocols:this.protocols})}catch(H){this.ws=new h(n,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(n,y){this.ws.close(n,y)}get isOpen(){return this.ws.readyState===h.OPEN}}},12028:n=>{"use strict";n.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12473:n=>{"use strict";n.exports=function(n){for(var y=new Array(n),H=0;H<n;++H)y[H]=H;return y}},12481:n=>{function y(n){return!!n.constructor&&"function"===typeof n.constructor.isBuffer&&n.constructor.isBuffer(n)}n.exports=function(n){return null!=n&&(y(n)||function(n){return"function"===typeof n.readFloatLE&&"function"===typeof n.slice&&y(n.slice(0,0))}(n)||!!n._isBuffer)}},12466:(n,y,H)=>{var o=H(12473),G=H(12481),h="undefined"!==typeof Float64Array;function k(n,y){return n[0]-y[0]}function i(){var n,y=this.stride,H=new Array(y.length);for(n=0;n<H.length;++n)H[n]=[Math.abs(y[n]),n];H.sort(k);var o=new Array(H.length);for(n=0;n<o.length;++n)o[n]=H[n][1];return o}function B(n,y){var H=["View",y,"d",n].join("");y<0&&(H="View_Nil"+n);var G="generic"===n;if(-1===y){var h="function "+H+"(a){this.data=a;};var proto="+H+".prototype;proto.dtype='"+n+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+H+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+H+"(a){return new "+H+"(a);}";return new Function(h)()}if(0===y){h="function "+H+"(a,d) {this.data = a;this.offset = d};var proto="+H+".prototype;proto.dtype='"+n+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+H+"_copy() {return new "+H+"(this.data,this.offset)};proto.pick=function "+H+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+H+"_get(){return "+(G?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+H+"_set(v){return "+(G?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+H+"(a,b,c,d){return new "+H+"(a,d)}";return new Function("TrivialArray",h)(V[n][0])}h=["'use strict'"];var k=o(y),B=k.map((function(n){return"i"+n})),q="this.offset+"+k.map((function(n){return"this.stride["+n+"]*i"+n})).join("+"),b=k.map((function(n){return"b"+n})).join(","),A=k.map((function(n){return"c"+n})).join(",");h.push("function "+H+"(a,"+b+","+A+",d){this.data=a","this.shape=["+b+"]","this.stride=["+A+"]","this.offset=d|0}","var proto="+H+".prototype","proto.dtype='"+n+"'","proto.dimension="+y),h.push("Object.defineProperty(proto,'size',{get:function "+H+"_size(){return "+k.map((function(n){return"this.shape["+n+"]"})).join("*"),"}})"),1===y?h.push("proto.order=[0]"):(h.push("Object.defineProperty(proto,'order',{get:"),y<4?(h.push("function "+H+"_order(){"),2===y?h.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===y&&h.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):h.push("ORDER})")),h.push("proto.set=function "+H+"_set("+B.join(",")+",v){"),G?h.push("return this.data.set("+q+",v)}"):h.push("return this.data["+q+"]=v}"),h.push("proto.get=function "+H+"_get("+B.join(",")+"){"),G?h.push("return this.data.get("+q+")}"):h.push("return this.data["+q+"]}"),h.push("proto.index=function "+H+"_index(",B.join(),"){return "+q+"}"),h.push("proto.hi=function "+H+"_hi("+B.join(",")+"){return new "+H+"(this.data,"+k.map((function(n){return["(typeof i",n,"!=='number'||i",n,"<0)?this.shape[",n,"]:i",n,"|0"].join("")})).join(",")+","+k.map((function(n){return"this.stride["+n+"]"})).join(",")+",this.offset)}");var U=k.map((function(n){return"a"+n+"=this.shape["+n+"]"})),T=k.map((function(n){return"c"+n+"=this.stride["+n+"]"}));h.push("proto.lo=function "+H+"_lo("+B.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+T.join(","));for(var W=0;W<y;++W)h.push("if(typeof i"+W+"==='number'&&i"+W+">=0){d=i"+W+"|0;b+=c"+W+"*d;a"+W+"-=d}");h.push("return new "+H+"(this.data,"+k.map((function(n){return"a"+n})).join(",")+","+k.map((function(n){return"c"+n})).join(",")+",b)}"),h.push("proto.step=function "+H+"_step("+B.join(",")+"){var "+k.map((function(n){return"a"+n+"=this.shape["+n+"]"})).join(",")+","+k.map((function(n){return"b"+n+"=this.stride["+n+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(W=0;W<y;++W)h.push("if(typeof i"+W+"==='number'){d=i"+W+"|0;if(d<0){c+=b"+W+"*(a"+W+"-1);a"+W+"=ceil(-a"+W+"/d)}else{a"+W+"=ceil(a"+W+"/d)}b"+W+"*=d}");h.push("return new "+H+"(this.data,"+k.map((function(n){return"a"+n})).join(",")+","+k.map((function(n){return"b"+n})).join(",")+",c)}");var z=new Array(y),Q=new Array(y);for(W=0;W<y;++W)z[W]="a[i"+W+"]",Q[W]="b[i"+W+"]";h.push("proto.transpose=function "+H+"_transpose("+B+"){"+B.map((function(n,y){return n+"=("+n+"===undefined?"+y+":"+n+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+H+"(this.data,"+z.join(",")+","+Q.join(",")+",this.offset)}"),h.push("proto.pick=function "+H+"_pick("+B+"){var a=[],b=[],c=this.offset");for(W=0;W<y;++W)h.push("if(typeof i"+W+"==='number'&&i"+W+">=0){c=(c+this.stride["+W+"]*i"+W+")|0}else{a.push(this.shape["+W+"]);b.push(this.stride["+W+"])}");return h.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),h.push("return function construct_"+H+"(data,shape,stride,offset){return new "+H+"(data,"+k.map((function(n){return"shape["+n+"]"})).join(",")+","+k.map((function(n){return"stride["+n+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",h.join("\n"))(V[n],i)}var V={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};n.exports=function(n,y,H,o){if(void 0===n)return(0,V.array[0])([]);"number"===typeof n&&(n=[n]),void 0===y&&(y=[n.length]);var k=y.length;if(void 0===H){H=new Array(k);for(var i=k-1,q=1;i>=0;--i)H[i]=q,q*=y[i]}if(void 0===o){o=0;for(i=0;i<k;++i)H[i]<0&&(o-=(y[i]-1)*H[i])}for(var b=function(n){if(G(n))return"buffer";if(h)switch(Object.prototype.toString.call(n)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(n)?"array":"generic"}(n),A=V[b];A.length<=k+1;)A.push(B(b,A.length-1));return(0,A[k+1])(n,y,H,o)}},13494:n=>{var y;self,y=()=>(()=>{"use strict";var n={d:(y,H)=>{for(var o in H)n.o(H,o)&&!n.o(y,o)&&Object.defineProperty(y,o,{enumerable:!0,get:H[o]})},o:(n,y)=>Object.prototype.hasOwnProperty.call(n,y)},y={};n.d(y,{default:()=>w});var H,o=function(n,y){var H=y.x-n.x,o=y.y-n.y;return Math.sqrt(H*H+o*o)},G=function(n){return n*(Math.PI/180)},h=new Map,k=function(n){h.has(n)&&clearTimeout(h.get(n)),h.set(n,setTimeout(n,100))},i=function(n,y,H){for(var o,G=y.split(/[ ,]+/g),h=0;h<G.length;h+=1)o=G[h],n.addEventListener?n.addEventListener(o,H,!1):n.attachEvent&&n.attachEvent(o,H)},B=function(n,y,H){for(var o,G=y.split(/[ ,]+/g),h=0;h<G.length;h+=1)o=G[h],n.removeEventListener?n.removeEventListener(o,H):n.detachEvent&&n.detachEvent(o,H)},V=function(n){return n.preventDefault(),n.type.match(/^touch/)?n.changedTouches:n},q=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},b=function(n,y){y.top||y.right||y.bottom||y.left?(n.style.top=y.top,n.style.right=y.right,n.style.bottom=y.bottom,n.style.left=y.left):(n.style.left=y.x+"px",n.style.top=y.y+"px")},A=function(n,y,H){var o=U(n);for(var G in o)if(o.hasOwnProperty(G))if("string"==typeof y)o[G]=y+" "+H;else{for(var h="",k=0,i=y.length;k<i;k+=1)h+=y[k]+" "+H+", ";o[G]=h.slice(0,-2)}return o},U=function(n){var y={};return y[n]="",["webkit","Moz","o"].forEach((function(H){y[H+n.charAt(0).toUpperCase()+n.slice(1)]=""})),y},T=function(n,y){for(var H in y)y.hasOwnProperty(H)&&(n[H]=y[H]);return n},W=function(n,y){if(n.length)for(var H=0,o=n.length;H<o;H+=1)y(n[H]);else y(n)},z="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,Q=window.matchMedia("(any-hover: none)").matches,l=!!("ontouchstart"in window),v=!!window.PointerEvent,F=!!window.MSPointerEvent,g={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},M={start:"mousedown",move:"mousemove",end:"mouseup"},f={};function c(){}z&&!Q?H=g:v?H={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:F?H={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:l?(H=g,f=M):H=M,c.prototype.on=function(n,y){var H,o=this,G=n.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var h=0;h<G.length;h+=1)H=G[h],o._handlers_[H]=o._handlers_[H]||[],o._handlers_[H].push(y);return o},c.prototype.off=function(n,y){var H=this;return H._handlers_=H._handlers_||{},void 0===n?H._handlers_={}:void 0===y?H._handlers_[n]=null:H._handlers_[n]&&H._handlers_[n].indexOf(y)>=0&&H._handlers_[n].splice(H._handlers_[n].indexOf(y),1),H},c.prototype.trigger=function(n,y){var H,o=this,G=n.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var h=0;h<G.length;h+=1)H=G[h],o._handlers_[H]&&o._handlers_[H].length&&o._handlers_[H].forEach((function(n){n.call(o,{type:H,target:o},y)}))},c.prototype.config=function(n){var y=this;y.options=y.defaults||{},n&&(y.options=function(n,y){var H={};for(var o in n)n.hasOwnProperty(o)&&y.hasOwnProperty(o)?H[o]=y[o]:n.hasOwnProperty(o)&&(H[o]=n[o]);return H}(y.options,n))},c.prototype.bindEvt=function(n,y){var o=this;return o._domHandlers_=o._domHandlers_||{},o._domHandlers_[y]=function(){"function"==typeof o["on"+y]?o["on"+y].apply(o,arguments):console.warn('[WARNING] : Missing "on'+y+'" handler.')},i(n,H[y],o._domHandlers_[y]),f[y]&&i(n,f[y],o._domHandlers_[y]),o},c.prototype.unbindEvt=function(n,y){var o=this;return o._domHandlers_=o._domHandlers_||{},B(n,H[y],o._domHandlers_[y]),f[y]&&B(n,f[y],o._domHandlers_[y]),delete o._domHandlers_[y],this};const p=c;function E(n,y){return this.identifier=y.identifier,this.position=y.position,this.frontPosition=y.frontPosition,this.collection=n,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(y),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=E.id,E.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}E.prototype=new p,E.constructor=E,E.id=0,E.prototype.buildEl=function(n){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},E.prototype.stylize=function(){if(this.options.dataOnly)return this;var n=this.options.fadeTime+"ms",y=function(){var n=U("borderRadius");for(var y in n)n.hasOwnProperty(y)&&(n[y]="50%");return n}(),H=A("transition","opacity",n),o={};return o.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},o.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},o.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},T(o.el,H),"circle"===this.options.shape&&T(o.back,y),T(o.front,y),this.applyStyles(o),this},E.prototype.applyStyles=function(n){for(var y in this.ui)if(this.ui.hasOwnProperty(y))for(var H in n[y])this.ui[y].style[H]=n[y][H];return this},E.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},E.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},E.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},E.prototype.show=function(n){var y=this;return y.options.dataOnly||(clearTimeout(y.removeTimeout),clearTimeout(y.showTimeout),clearTimeout(y.restTimeout),y.addToDom(),y.restCallback(),setTimeout((function(){y.ui.el.style.opacity=1}),0),y.showTimeout=setTimeout((function(){y.trigger("shown",y.instance),"function"==typeof n&&n.call(this)}),y.options.fadeTime)),y},E.prototype.hide=function(n){var y=this;if(y.options.dataOnly)return y;if(y.ui.el.style.opacity=y.options.restOpacity,clearTimeout(y.removeTimeout),clearTimeout(y.showTimeout),clearTimeout(y.restTimeout),y.removeTimeout=setTimeout((function(){var H="dynamic"===y.options.mode?"none":"block";y.ui.el.style.display=H,"function"==typeof n&&n.call(y),y.trigger("hidden",y.instance)}),y.options.fadeTime),y.options.restJoystick){var H=y.options.restJoystick,o={};o.x=!0===H||!1!==H.x?0:y.instance.frontPosition.x,o.y=!0===H||!1!==H.y?0:y.instance.frontPosition.y,y.setPosition(n,o)}return y},E.prototype.setPosition=function(n,y){var H=this;H.frontPosition={x:y.x,y:y.y};var o=H.options.fadeTime+"ms",G={};G.front=A("transition",["transform"],o);var h={front:{}};h.front={transform:"translate("+H.frontPosition.x+"px,"+H.frontPosition.y+"px)"},H.applyStyles(G),H.applyStyles(h),H.restTimeout=setTimeout((function(){"function"==typeof n&&n.call(H),H.restCallback()}),H.options.fadeTime)},E.prototype.restCallback=function(){var n=this,y={};y.front=A("transition","none",""),n.applyStyles(y),n.trigger("rested",n.instance)},E.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},E.prototype.computeDirection=function(n){var y,H,o,G=n.angle.radian,h=Math.PI/4,k=Math.PI/2;if(G>h&&G<3*h&&!n.lockX?y="up":G>-h&&G<=h&&!n.lockY?y="left":G>3*-h&&G<=-h&&!n.lockX?y="down":n.lockY||(y="right"),n.lockY||(H=G>-k&&G<k?"left":"right"),n.lockX||(o=G>0?"up":"down"),n.force>this.options.threshold){var i,B={};for(i in this.direction)this.direction.hasOwnProperty(i)&&(B[i]=this.direction[i]);var V={};for(i in this.direction={x:H,y:o,angle:y},n.direction=this.direction,B)B[i]===this.direction[i]&&(V[i]=!0);if(V.x&&V.y&&V.angle)return n;V.x&&V.y||this.trigger("plain",n),V.x||this.trigger("plain:"+H,n),V.y||this.trigger("plain:"+o,n),V.angle||this.trigger("dir dir:"+y,n)}else this.resetDirection();return n};const X=E;function d(n,y){var H=this;H.nipples=[],H.idles=[],H.actives=[],H.ids=[],H.pressureIntervals={},H.manager=n,H.id=d.id,d.id+=1,H.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},H.config(y),"static"!==H.options.mode&&"semi"!==H.options.mode||(H.options.multitouch=!1),H.options.multitouch||(H.options.maxNumberOfNipples=1);var o=getComputedStyle(H.options.zone.parentElement);return o&&"flex"===o.display&&(H.parentIsFlex=!0),H.updateBox(),H.prepareNipples(),H.PA(),H.begin(),H.nipples}d.prototype=new p,d.constructor=d,d.id=0,d.prototype.prepareNipples=function(){var n=this,y=n.nipples;y.on=n.on.bind(n),y.off=n.off.bind(n),y.options=n.options,y.destroy=n.destroy.bind(n),y.ids=n.ids,y.id=n.id,y.processOnMove=n.processOnMove.bind(n),y.processOnEnd=n.processOnEnd.bind(n),y.get=function(n){if(void 0===n)return y[0];for(var H=0,o=y.length;H<o;H+=1)if(y[H].identifier===n)return y[H];return!1}},d.prototype.PA=function(){var n=this;n.bindEvt(n.options.zone,"start"),n.options.zone.style.touchAction="none",n.options.zone.style.msTouchAction="none"},d.prototype.begin=function(){var n=this,y=n.options;if("static"===y.mode){var H=n.createNipple(y.position,n.manager.getIdentifier());H.add(),n.idles.push(H)}},d.prototype.createNipple=function(n,y){var H=this,o=H.manager.scroll,G={},h=H.options,k=H.parentIsFlex?o.x:o.x+H.box.left,i=H.parentIsFlex?o.y:o.y+H.box.top;if(n.x&&n.y)G={x:n.x-k,y:n.y-i};else if(n.top||n.right||n.bottom||n.left){var B=document.createElement("DIV");B.style.display="hidden",B.style.top=n.top,B.style.right=n.right,B.style.bottom=n.bottom,B.style.left=n.left,B.style.position="absolute",h.zone.appendChild(B);var V=B.getBoundingClientRect();h.zone.removeChild(B),G=n,n={x:V.left+o.x,y:V.top+o.y}}var q=new X(H,{color:h.color,size:h.size,threshold:h.threshold,fadeTime:h.fadeTime,dataOnly:h.dataOnly,restJoystick:h.restJoystick,restOpacity:h.restOpacity,mode:h.mode,identifier:y,position:n,zone:h.zone,frontPosition:{x:0,y:0},shape:h.shape});return h.dataOnly||(b(q.ui.el,G),b(q.ui.front,q.frontPosition)),H.nipples.push(q),H.trigger("added "+q.identifier+":added",q),H.manager.trigger("added "+q.identifier+":added",q),H.bindNipple(q),q},d.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},d.prototype.bindNipple=function(n){var y,H=this,o=function(n,o){y=n.type+" "+o.id+":"+n.type,H.trigger(y,o)};n.on("destroyed",H.onDestroyed.bind(H)),n.on("shown hidden rested dir plain",o),n.on("dir:up dir:right dir:down dir:left",o),n.on("plain:up plain:right plain:down plain:left",o)},d.prototype.pressureFn=function(n,y,H){var o=this,G=0;clearInterval(o.pressureIntervals[H]),o.pressureIntervals[H]=setInterval(function(){var H=n.force||n.pressure||n.webkitForce||0;H!==G&&(y.trigger("pressure",H),o.trigger("pressure "+y.identifier+":pressure",H),G=H)}.bind(o),100)},d.prototype.onstart=function(n){var y=this,H=y.options,o=n;return n=V(n),y.updateBox(),W(n,(function(G){y.actives.length<H.maxNumberOfNipples?y.processOnStart(G):o.type.match(/^touch/)&&(Object.keys(y.manager.ids).forEach((function(H){if(Object.values(o.touches).findIndex((function(n){return n.identifier===H}))<0){var G=[n[0]];G.identifier=H,y.processOnEnd(G)}})),y.actives.length<H.maxNumberOfNipples&&y.processOnStart(G))})),y.manager.bindDocument(),!1},d.prototype.processOnStart=function(n){var y,H=this,G=H.options,h=H.manager.getIdentifier(n),k=n.force||n.pressure||n.webkitForce||0,i={x:n.pageX,y:n.pageY},B=H.getOrCreate(h,i);B.identifier!==h&&H.manager.removeIdentifier(B.identifier),B.identifier=h;var V=function(y){y.trigger("start",y),H.trigger("start "+y.id+":start",y),y.show(),k>0&&H.pressureFn(n,y,y.identifier),H.processOnMove(n)};if((y=H.idles.indexOf(B))>=0&&H.idles.splice(y,1),H.actives.push(B),H.ids.push(B.identifier),"semi"!==G.mode)V(B);else{if(!(o(i,B.position)<=G.catchDistance))return B.destroy(),void H.processOnStart(n);V(B)}return B},d.prototype.getOrCreate=function(n,y){var H,o=this,G=o.options;return/(semi|static)/.test(G.mode)?(H=o.idles[0])?(o.idles.splice(0,1),H):"semi"===G.mode?o.createNipple(y,n):(console.warn("Coudln't find the needed nipple."),!1):H=o.createNipple(y,n)},d.prototype.processOnMove=function(n){var y=this,H=y.options,h=y.manager.getIdentifier(n),k=y.nipples.get(h),i=y.manager.scroll;if(function(n){return isNaN(n.buttons)?0!==n.pressure:0!==n.buttons}(n)){if(!k)return console.error("Found zombie joystick with ID "+h),void y.manager.removeIdentifier(h);if(H.dynamicPage){var B=k.el.getBoundingClientRect();k.position={x:i.x+B.left,y:i.y+B.top}}k.identifier=h;var V=k.options.size/2,q={x:n.pageX,y:n.pageY};H.lockX&&(q.y=k.position.y),H.lockY&&(q.x=k.position.x);var b,A,U,T,W,z,Q,l,v,F,g=o(q,k.position),M=(b=q,U=(A=k.position).x-b.x,T=A.y-b.y,function(n){return n*(180/Math.PI)}(Math.atan2(T,U))),f=G(M),c=g/V,p={distance:g,position:q};if("circle"===k.options.shape?(W=Math.min(g,V),Q=k.position,l=W,F={x:0,y:0},v=G(v=M),F.x=Q.x-l*Math.cos(v),F.y=Q.y-l*Math.sin(v),z=F):(z=function(n,y,H){return{x:Math.min(Math.max(n.x,y.x-H),y.x+H),y:Math.min(Math.max(n.y,y.y-H),y.y+H)}}(q,k.position,V),W=o(z,k.position)),H.follow){if(g>V){var E=q.x-z.x,X=q.y-z.y;k.position.x+=E,k.position.y+=X,k.el.style.top=k.position.y-(y.box.top+i.y)+"px",k.el.style.left=k.position.x-(y.box.left+i.x)+"px",g=o(q,k.position)}}else q=z,g=W;var d=q.x-k.position.x,a=q.y-k.position.y;k.frontPosition={x:d,y:a},H.dataOnly||(k.ui.front.style.transform="translate("+d+"px,"+a+"px)");var O={identifier:k.identifier,position:q,force:c,pressure:n.force||n.pressure||n.webkitForce||0,distance:g,angle:{radian:f,degree:M},vector:{x:d/V,y:-a/V},raw:p,instance:k,lockX:H.lockX,lockY:H.lockY};(O=k.computeDirection(O)).angle={radian:G(180-M),degree:180-M},k.trigger("move",O),y.trigger("move "+k.id+":move",O)}else this.processOnEnd(n)},d.prototype.processOnEnd=function(n){var y=this,H=y.options,o=y.manager.getIdentifier(n),G=y.nipples.get(o),h=y.manager.removeIdentifier(G.identifier);G&&(H.dataOnly||G.hide((function(){"dynamic"===H.mode&&(G.trigger("removed",G),y.trigger("removed "+G.id+":removed",G),y.manager.trigger("removed "+G.id+":removed",G),G.destroy())})),clearInterval(y.pressureIntervals[G.identifier]),G.resetDirection(),G.trigger("end",G),y.trigger("end "+G.id+":end",G),y.ids.indexOf(G.identifier)>=0&&y.ids.splice(y.ids.indexOf(G.identifier),1),y.actives.indexOf(G)>=0&&y.actives.splice(y.actives.indexOf(G),1),/(semi|static)/.test(H.mode)?y.idles.push(G):y.nipples.indexOf(G)>=0&&y.nipples.splice(y.nipples.indexOf(G),1),y.manager.unbindDocument(),/(semi|static)/.test(H.mode)&&(y.manager.ids[h.id]=h.identifier))},d.prototype.onDestroyed=function(n,y){var H=this;H.nipples.indexOf(y)>=0&&H.nipples.splice(H.nipples.indexOf(y),1),H.actives.indexOf(y)>=0&&H.actives.splice(H.actives.indexOf(y),1),H.idles.indexOf(y)>=0&&H.idles.splice(H.idles.indexOf(y),1),H.ids.indexOf(y.identifier)>=0&&H.ids.splice(H.ids.indexOf(y.identifier),1),H.manager.removeIdentifier(y.identifier),H.manager.unbindDocument()},d.prototype.destroy=function(){var n=this;for(var y in n.unbindEvt(n.options.zone,"start"),n.nipples.forEach((function(n){n.destroy()})),n.pressureIntervals)n.pressureIntervals.hasOwnProperty(y)&&clearInterval(n.pressureIntervals[y]);n.trigger("destroyed",n.nipples),n.manager.unbindDocument(),n.off()};const a=d;function O(n){var y=this;y.ids={},y.index=0,y.collections=[],y.scroll=q(),y.config(n),y.prepareCollections();var H=function(){var n;y.collections.forEach((function(H){H.forEach((function(H){n=H.el.getBoundingClientRect(),H.position={x:y.scroll.x+n.left,y:y.scroll.y+n.top}}))}))};i(window,"resize",(function(){k(H)}));var o=function(){y.scroll=q()};return i(window,"scroll",(function(){k(o)})),y.collections}O.prototype=new p,O.constructor=O,O.prototype.prepareCollections=function(){var n=this;n.collections.create=n.create.bind(n),n.collections.on=n.on.bind(n),n.collections.off=n.off.bind(n),n.collections.destroy=n.destroy.bind(n),n.collections.get=function(y){var H;return n.collections.every((function(n){return!(H=n.get(y))})),H}},O.prototype.create=function(n){return this.createCollection(n)},O.prototype.createCollection=function(n){var y=this,H=new a(y,n);return y.bindCollection(H),y.collections.push(H),H},O.prototype.bindCollection=function(n){var y,H=this,o=function(n,o){y=n.type+" "+o.id+":"+n.type,H.trigger(y,o)};n.on("destroyed",H.onDestroyed.bind(H)),n.on("shown hidden rested dir plain",o),n.on("dir:up dir:right dir:down dir:left",o),n.on("plain:up plain:right plain:down plain:left",o)},O.prototype.bindDocument=function(){var n=this;n.binded||(n.bindEvt(document,"move").bindEvt(document,"end"),n.binded=!0)},O.prototype.unbindDocument=function(n){var y=this;Object.keys(y.ids).length&&!0!==n||(y.unbindEvt(document,"move").unbindEvt(document,"end"),y.binded=!1)},O.prototype.getIdentifier=function(n){var y;return n?void 0===(y=void 0===n.identifier?n.pointerId:n.identifier)&&(y=this.latest||0):y=this.index,void 0===this.ids[y]&&(this.ids[y]=this.index,this.index+=1),this.latest=y,this.ids[y]},O.prototype.removeIdentifier=function(n){var y={};for(var H in this.ids)if(this.ids[H]===n){y.id=H,y.identifier=this.ids[H],delete this.ids[H];break}return y},O.prototype.onmove=function(n){return this.onAny("move",n),!1},O.prototype.onend=function(n){return this.onAny("end",n),!1},O.prototype.oncancel=function(n){return this.onAny("end",n),!1},O.prototype.onAny=function(n,y){var H,o=this,G="processOn"+n.charAt(0).toUpperCase()+n.slice(1);y=V(y);var h=function(n,y,H){H.ids.indexOf(y)>=0&&(H[G](n),n._found_=!0)};return W(y,(function(n){H=o.getIdentifier(n),W(o.collections,h.bind(null,n,H)),n._found_||o.removeIdentifier(H)})),!1},O.prototype.destroy=function(){var n=this;n.unbindDocument(!0),n.ids={},n.index=0,n.collections.forEach((function(n){n.destroy()})),n.off()},O.prototype.onDestroyed=function(n,y){var H=this;if(H.collections.indexOf(y)<0)return!1;H.collections.splice(H.collections.indexOf(y),1)};var e=new O;const w={create:function(n){return e.create(n)},factory:e};return y.default})(),n.exports=y()},12497:(n,y,H)=>{"use strict";const{Deflate:o,deflate:G,deflateRaw:h,gzip:k}=H(12503),{Inflate:i,inflate:B,inflateRaw:V,ungzip:q}=H(12557),b=H(12537);n.exports.Deflate=o,n.exports.deflate=G,n.exports.deflateRaw=h,n.exports.gzip=k,n.exports.Inflate=i,n.exports.inflate=B,n.exports.inflateRaw=V,n.exports.ungzip=q,n.exports.constants=b},12503:(n,y,H)=>{"use strict";const o=H(12508),G=H(12541),h=H(12545),k=H(12533),i=H(12551),B=Object.prototype.toString,{Z_NO_FLUSH:V,Z_SYNC_FLUSH:q,Z_FULL_FLUSH:b,Z_FINISH:A,Z_OK:U,Z_STREAM_END:T,Z_DEFAULT_COMPRESSION:W,Z_DEFAULT_STRATEGY:z,Z_DEFLATED:Q}=H(12537);function l(n){this.options=G.assign({level:W,method:Q,rn:16384,windowBits:15,memLevel:8,strategy:z},n||{});let y=this.options;y.raw&&y.windowBits>0?y.windowBits=-y.windowBits:y.gzip&&y.windowBits>0&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.by="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let H=o.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(H!==U)throw new Error(k[H]);if(y.header&&o.deflateSetHeader(this.strm,y.header),y.dictionary){let n;if(n="string"===typeof y.dictionary?h.string2buf(y.dictionary):"[object ArrayBuffer]"===B.call(y.dictionary)?new Uint8Array(y.dictionary):y.dictionary,H=o.deflateSetDictionary(this.strm,n),H!==U)throw new Error(k[H]);this._dict_set=!0}}function v(n,y){const H=new l(y);if(H.push(n,!0),H.err)throw H.by||k[H.err];return H.result}l.prototype.push=function(n,y){const H=this.strm,G=this.options.rn;let k,i;if(this.ended)return!1;for(i=y===~~y?y:!0===y?A:V,"string"===typeof n?H.input=h.string2buf(n):"[object ArrayBuffer]"===B.call(n)?H.input=new Uint8Array(n):H.input=n,H.next_in=0,H.avail_in=H.input.length;;)if(0===H.avail_out&&(H.output=new Uint8Array(G),H.next_out=0,H.avail_out=G),(i===q||i===b)&&H.avail_out<=6)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else{if(k=o.deflate(H,i),k===T)return H.next_out>0&&this.onData(H.output.subarray(0,H.next_out)),k=o.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===U;if(0!==H.avail_out){if(i>0&&H.next_out>0)this.onData(H.output.subarray(0,H.next_out)),H.avail_out=0;else if(0===H.avail_in)break}else this.onData(H.output)}return!0},l.prototype.onData=function(n){this.chunks.push(n)},l.prototype.onEnd=function(n){n===U&&(this.result=G.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.by=this.strm.by},n.exports.Deflate=l,n.exports.deflate=v,n.exports.deflateRaw=function(n,y){return(y=y||{}).raw=!0,v(n,y)},n.exports.gzip=function(n,y){return(y=y||{}).gzip=!0,v(n,y)},n.exports.constants=H(12537)},12557:(n,y,H)=>{"use strict";const o=H(12565),G=H(12541),h=H(12545),k=H(12533),i=H(12551),B=H(12581),V=Object.prototype.toString,{Z_NO_FLUSH:q,Z_FINISH:b,Z_OK:A,Z_STREAM_END:U,Z_NEED_DICT:T,Z_STREAM_ERROR:W,Z_DATA_ERROR:z,Z_MEM_ERROR:Q}=H(12537);function l(n){this.options=G.assign({rn:65536,windowBits:15,to:""},n||{});const y=this.options;y.raw&&y.windowBits>=0&&y.windowBits<16&&(y.windowBits=-y.windowBits,0===y.windowBits&&(y.windowBits=-15)),!(y.windowBits>=0&&y.windowBits<16)||n&&n.windowBits||(y.windowBits+=32),y.windowBits>15&&y.windowBits<48&&0===(15&y.windowBits)&&(y.windowBits|=15),this.err=0,this.by="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;let H=o.inflateInit2(this.strm,y.windowBits);if(H!==A)throw new Error(k[H]);if(this.header=new B,o.inflateGetHeader(this.strm,this.header),y.dictionary&&("string"===typeof y.dictionary?y.dictionary=h.string2buf(y.dictionary):"[object ArrayBuffer]"===V.call(y.dictionary)&&(y.dictionary=new Uint8Array(y.dictionary)),y.raw&&(H=o.inflateSetDictionary(this.strm,y.dictionary),H!==A)))throw new Error(k[H])}function v(n,y){const H=new l(y);if(H.push(n),H.err)throw H.by||k[H.err];return H.result}l.prototype.push=function(n,y){const H=this.strm,G=this.options.rn,k=this.options.dictionary;let i,B,l;if(this.ended)return!1;for(B=y===~~y?y:!0===y?b:q,"[object ArrayBuffer]"===V.call(n)?H.input=new Uint8Array(n):H.input=n,H.next_in=0,H.avail_in=H.input.length;;){for(0===H.avail_out&&(H.output=new Uint8Array(G),H.next_out=0,H.avail_out=G),i=o.inflate(H,B),i===T&&k&&(i=o.inflateSetDictionary(H,k),i===A?i=o.inflate(H,B):i===z&&(i=T));H.avail_in>0&&i===U&&H.state.wrap>0&&0!==n[H.next_in];)o.inflateReset(H),i=o.inflate(H,B);switch(i){case W:case z:case T:case Q:return this.onEnd(i),this.ended=!0,!1}if(l=H.avail_out,H.next_out&&(0===H.avail_out||i===U))if("string"===this.options.to){let n=h.utf8border(H.output,H.next_out),y=H.next_out-n,o=h.buf2string(H.output,n);H.next_out=y,H.avail_out=G-y,y&&H.output.set(H.output.subarray(n,n+y),0),this.onData(o)}else this.onData(H.output.length===H.next_out?H.output:H.output.subarray(0,H.next_out));if(i!==A||0!==l){if(i===U)return i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===H.avail_in)break}}return!0},l.prototype.onData=function(n){this.chunks.push(n)},l.prototype.onEnd=function(n){n===A&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=G.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.by=this.strm.by},n.exports.Inflate=l,n.exports.inflate=v,n.exports.inflateRaw=function(n,y){return(y=y||{}).raw=!0,v(n,y)},n.exports.ungzip=v,n.exports.constants=H(12537)},12541:n=>{"use strict";const y=(n,y)=>Object.prototype.hasOwnProperty.call(n,y);n.exports.assign=function(n){const H=Array.prototype.slice.call(arguments,1);for(;H.length;){const o=H.shift();if(o){if("object"!==typeof o)throw new TypeError(o+"must be non-object");for(const H in o)y(o,H)&&(n[H]=o[H])}}return n},n.exports.flattenChunks=n=>{let y=0;for(let o=0,G=n.length;o<G;o++)y+=n[o].length;const H=new Uint8Array(y);for(let o=0,G=0,h=n.length;o<h;o++){let y=n[o];H.set(y,G),G+=y.length}return H}},12545:n=>{"use strict";let y=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){y=!1}const H=new Uint8Array(256);for(let G=0;G<256;G++)H[G]=G>=252?6:G>=248?5:G>=240?4:G>=224?3:G>=192?2:1;H[254]=H[254]=1,n.exports.string2buf=n=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(n);let y,H,o,G,h,k=n.length,i=0;for(G=0;G<k;G++)H=n.charCodeAt(G),55296===(64512&H)&&G+1<k&&(o=n.charCodeAt(G+1),56320===(64512&o)&&(H=65536+(H-55296<<10)+(o-56320),G++)),i+=H<128?1:H<2048?2:H<65536?3:4;for(y=new Uint8Array(i),h=0,G=0;h<i;G++)H=n.charCodeAt(G),55296===(64512&H)&&G+1<k&&(o=n.charCodeAt(G+1),56320===(64512&o)&&(H=65536+(H-55296<<10)+(o-56320),G++)),H<128?y[h++]=H:H<2048?(y[h++]=192|H>>>6,y[h++]=128|63&H):H<65536?(y[h++]=224|H>>>12,y[h++]=128|H>>>6&63,y[h++]=128|63&H):(y[h++]=240|H>>>18,y[h++]=128|H>>>12&63,y[h++]=128|H>>>6&63,y[h++]=128|63&H);return y};n.exports.buf2string=(n,o)=>{const G=o||n.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(n.subarray(0,o));let h,k;const i=new Array(2*G);for(k=0,h=0;h<G;){let y=n[h++];if(y<128){i[k++]=y;continue}let o=H[y];if(o>4)i[k++]=65533,h+=o-1;else{for(y&=2===o?31:3===o?15:7;o>1&&h<G;)y=y<<6|63&n[h++],o--;o>1?i[k++]=65533:y<65536?i[k++]=y:(y-=65536,i[k++]=55296|y>>10&1023,i[k++]=56320|1023&y)}}return((n,H)=>{if(H<65534&&n.subarray&&y)return String.fromCharCode.apply(null,n.length===H?n:n.subarray(0,H));let o="";for(let y=0;y<H;y++)o+=String.fromCharCode(n[y]);return o})(i,k)},n.exports.utf8border=(n,y)=>{(y=y||n.length)>n.length&&(y=n.length);let o=y-1;for(;o>=0&&128===(192&n[o]);)o--;return o<0||0===o?y:o+H[n[o]]>y?o:y}},12521:n=>{"use strict";n.exports=(n,y,H,o)=>{let G=65535&n,h=n>>>16&65535,k=0;for(;0!==H;){k=H>2e3?2e3:H,H-=k;do{G=G+y[o++]|0,h=h+G|0}while(--k);G%=65521,h%=65521}return G|h<<16}},12537:n=>{"use strict";n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12524:n=>{"use strict";const y=new Uint32Array((()=>{let n,y=[];for(var H=0;H<256;H++){n=H;for(var o=0;o<8;o++)n=1&n?3988292384^n>>>1:n>>>1;y[H]=n}return y})());n.exports=(n,H,o,G)=>{const h=y,k=G+o;n^=-1;for(let y=G;y<k;y++)n=n>>>8^h[255&(n^H[y])];return~n}},12508:(n,y,H)=>{"use strict";const{_tr_init:o,_tr_stored_block:G,_tr_flush_block:h,_tr_tally:k,_tr_align:i}=H(12515),B=H(12521),V=H(12524),q=H(12533),{Z_NO_FLUSH:b,Z_PARTIAL_FLUSH:A,Z_FULL_FLUSH:U,Z_FINISH:T,Z_BLOCK:W,Z_OK:z,Z_STREAM_END:Q,Z_STREAM_ERROR:l,Z_DATA_ERROR:v,Z_BUF_ERROR:F,Z_DEFAULT_COMPRESSION:g,Z_FILTERED:M,Z_HUFFMAN_ONLY:f,Z_RLE:c,Z_FIXED:p,Z_DEFAULT_STRATEGY:E,Z_UNKNOWN:X,Z_DEFLATED:d}=H(12537),a=258,O=262,e=103,w=113,j=666,I=(n,y)=>(n.by=q[y],y),R=n=>(n<<1)-(n>4?9:0),C=n=>{let y=n.length;for(;--y>=0;)n[y]=0};let S=(n,y,H)=>(y<<n.hash_shift^H)&n.hash_mask;const N=n=>{const y=n.state;let H=y.pending;H>n.avail_out&&(H=n.avail_out),0!==H&&(n.output.set(y.pending_buf.subarray(y.pending_out,y.pending_out+H),n.next_out),n.next_out+=H,y.pending_out+=H,n.total_out+=H,n.avail_out-=H,y.pending-=H,0===y.pending&&(y.pending_out=0))},r=(n,y)=>{h(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,y),n.block_start=n.strstart,N(n.strm)},K=(n,y)=>{n.pending_buf[n.pending++]=y},Y=(n,y)=>{n.pending_buf[n.pending++]=y>>>8&255,n.pending_buf[n.pending++]=255&y},D=(n,y,H,o)=>{let G=n.avail_in;return G>o&&(G=o),0===G?0:(n.avail_in-=G,y.set(n.input.subarray(n.next_in,n.next_in+G),H),1===n.state.wrap?n.adler=B(n.adler,y,G,H):2===n.state.wrap&&(n.adler=V(n.adler,y,G,H)),n.next_in+=G,n.total_in+=G,G)},Z=(n,y)=>{let H,o,G=n.max_chain_length,h=n.strstart,k=n.prev_length,i=n.nice_match;const B=n.strstart>n.w_size-O?n.strstart-(n.w_size-O):0,V=n.window,q=n.w_mask,b=n.prev,A=n.strstart+a;let U=V[h+k-1],T=V[h+k];n.prev_length>=n.good_match&&(G>>=2),i>n.lookahead&&(i=n.lookahead);do{if(H=y,V[H+k]===T&&V[H+k-1]===U&&V[H]===V[h]&&V[++H]===V[h+1]){h+=2,H++;do{}while(V[++h]===V[++H]&&V[++h]===V[++H]&&V[++h]===V[++H]&&V[++h]===V[++H]&&V[++h]===V[++H]&&V[++h]===V[++H]&&V[++h]===V[++H]&&V[++h]===V[++H]&&h<A);if(o=a-(A-h),h=A-a,o>k){if(n.match_start=y,k=o,o>=i)break;U=V[h+k-1],T=V[h+k]}}}while((y=b[y&q])>B&&0!==--G);return k<=n.lookahead?k:n.lookahead},s=n=>{const y=n.w_size;let H,o,G,h,k;do{if(h=n.window_size-n.lookahead-n.strstart,n.strstart>=y+(y-O)){n.window.set(n.window.subarray(y,y+y),0),n.match_start-=y,n.strstart-=y,n.block_start-=y,o=n.hash_size,H=o;do{G=n.head[--H],n.head[H]=G>=y?G-y:0}while(--o);o=y,H=o;do{G=n.prev[--H],n.prev[H]=G>=y?G-y:0}while(--o);h+=y}if(0===n.strm.avail_in)break;if(o=D(n.strm,n.window,n.strstart+n.lookahead,h),n.lookahead+=o,n.lookahead+n.insert>=3)for(k=n.strstart-n.insert,n.ins_h=n.window[k],n.ins_h=S(n,n.ins_h,n.window[k+1]);n.insert&&(n.ins_h=S(n,n.ins_h,n.window[k+3-1]),n.prev[k&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=k,k++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<O&&0!==n.strm.avail_in)},P=(n,y)=>{let H,o;for(;;){if(n.lookahead<O){if(s(n),n.lookahead<O&&y===b)return 1;if(0===n.lookahead)break}if(H=0,n.lookahead>=3&&(n.ins_h=S(n,n.ins_h,n.window[n.strstart+3-1]),H=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),0!==H&&n.strstart-H<=n.w_size-O&&(n.match_length=Z(n,H)),n.match_length>=3)if(o=k(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do{n.strstart++,n.ins_h=S(n,n.ins_h,n.window[n.strstart+3-1]),H=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart}while(0!==--n.match_length);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=S(n,n.ins_h,n.window[n.strstart+1]);else o=k(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(o&&(r(n,!1),0===n.strm.avail_out))return 1}return n.insert=n.strstart<2?n.strstart:2,y===T?(r(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(r(n,!1),0===n.strm.avail_out)?1:2},x=(n,y)=>{let H,o,G;for(;;){if(n.lookahead<O){if(s(n),n.lookahead<O&&y===b)return 1;if(0===n.lookahead)break}if(H=0,n.lookahead>=3&&(n.ins_h=S(n,n.ins_h,n.window[n.strstart+3-1]),H=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,0!==H&&n.prev_length<n.max_lazy_match&&n.strstart-H<=n.w_size-O&&(n.match_length=Z(n,H),n.match_length<=5&&(n.strategy===M||3===n.match_length&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){G=n.strstart+n.lookahead-3,o=k(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do{++n.strstart<=G&&(n.ins_h=S(n,n.ins_h,n.window[n.strstart+3-1]),H=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart)}while(0!==--n.prev_length);if(n.match_available=0,n.match_length=2,n.strstart++,o&&(r(n,!1),0===n.strm.avail_out))return 1}else if(n.match_available){if(o=k(n,0,n.window[n.strstart-1]),o&&r(n,!1),n.strstart++,n.lookahead--,0===n.strm.avail_out)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(o=k(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,y===T?(r(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(r(n,!1),0===n.strm.avail_out)?1:2};function t(n,y,H,o,G){this.good_length=n,this.max_lazy=y,this.nice_length=H,this.max_chain=o,this.func=G}const u=[new t(0,0,0,0,((n,y)=>{let H=65535;for(H>n.pending_buf_size-5&&(H=n.pending_buf_size-5);;){if(n.lookahead<=1){if(s(n),0===n.lookahead&&y===b)return 1;if(0===n.lookahead)break}n.strstart+=n.lookahead,n.lookahead=0;const o=n.block_start+H;if((0===n.strstart||n.strstart>=o)&&(n.lookahead=n.strstart-o,n.strstart=o,r(n,!1),0===n.strm.avail_out))return 1;if(n.strstart-n.block_start>=n.w_size-O&&(r(n,!1),0===n.strm.avail_out))return 1}return n.insert=0,y===T?(r(n,!0),0===n.strm.avail_out?3:4):(n.strstart>n.block_start&&(r(n,!1),n.strm.avail_out),1)})),new t(4,4,8,4,P),new t(4,5,16,8,P),new t(4,6,32,32,P),new t(4,4,16,16,x),new t(8,16,32,32,x),new t(8,16,128,128,x),new t(8,32,128,256,x),new t(32,128,258,1024,x),new t(32,258,258,4096,x)];function L(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=d,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),C(this.dyn_ltree),C(this.dyn_dtree),C(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),C(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),C(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const J=n=>{if(!n||!n.state)return I(n,l);n.total_in=n.total_out=0,n.data_type=X;const y=n.state;return y.pending=0,y.pending_out=0,y.wrap<0&&(y.wrap=-y.wrap),y.status=y.wrap?42:w,n.adler=2===y.wrap?0:1,y.last_flush=b,o(y),z},m=n=>{const y=J(n);var H;return y===z&&((H=n.state).window_size=2*H.w_size,C(H.head),H.max_lazy_match=u[H.level].max_lazy,H.good_match=u[H.level].good_length,H.nice_match=u[H.level].nice_length,H.max_chain_length=u[H.level].max_chain,H.strstart=0,H.block_start=0,H.lookahead=0,H.insert=0,H.match_length=H.prev_length=2,H.match_available=0,H.ins_h=0),y},nn=(n,y,H,o,G,h)=>{if(!n)return l;let k=1;if(y===g&&(y=6),o<0?(k=0,o=-o):o>15&&(k=2,o-=16),G<1||G>9||H!==d||o<8||o>15||y<0||y>9||h<0||h>p)return I(n,l);8===o&&(o=9);const i=new L;return n.state=i,i.strm=n,i.wrap=k,i.gzhead=null,i.w_bits=o,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=G+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+3-1)/3),i.window=new Uint8Array(2*i.w_size),i.head=new Uint16Array(i.hash_size),i.prev=new Uint16Array(i.w_size),i.lit_bufsize=1<<G+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new Uint8Array(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=y,i.strategy=h,i.method=H,m(n)};n.exports.deflateInit=(n,y)=>nn(n,y,d,15,8,E),n.exports.deflateInit2=nn,n.exports.deflateReset=m,n.exports.deflateResetKeep=J,n.exports.deflateSetHeader=(n,y)=>n&&n.state?2!==n.state.wrap?l:(n.state.gzhead=y,z):l,n.exports.deflate=(n,y)=>{let H,o;if(!n||!n.state||y>W||y<0)return n?I(n,l):l;const h=n.state;if(!n.output||!n.input&&0!==n.avail_in||h.status===j&&y!==T)return I(n,0===n.avail_out?F:l);h.strm=n;const B=h.last_flush;if(h.last_flush=y,42===h.status)if(2===h.wrap)n.adler=0,K(h,31),K(h,139),K(h,8),h.gzhead?(K(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),K(h,255&h.gzhead.time),K(h,h.gzhead.time>>8&255),K(h,h.gzhead.time>>16&255),K(h,h.gzhead.time>>24&255),K(h,9===h.level?2:h.strategy>=f||h.level<2?4:0),K(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(K(h,255&h.gzhead.extra.length),K(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(n.adler=V(n.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=69):(K(h,0),K(h,0),K(h,0),K(h,0),K(h,0),K(h,9===h.level?2:h.strategy>=f||h.level<2?4:0),K(h,3),h.status=w);else{let y=d+(h.w_bits-8<<4)<<8,H=-1;H=h.strategy>=f||h.level<2?0:h.level<6?1:6===h.level?2:3,y|=H<<6,0!==h.strstart&&(y|=32),y+=31-y%31,h.status=w,Y(h,y),0!==h.strstart&&(Y(h,n.adler>>>16),Y(h,65535&n.adler)),n.adler=1}if(69===h.status)if(h.gzhead.extra){for(H=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>H&&(n.adler=V(n.adler,h.pending_buf,h.pending-H,H)),N(n),H=h.pending,h.pending!==h.pending_buf_size));)K(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>H&&(n.adler=V(n.adler,h.pending_buf,h.pending-H,H)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=73)}else h.status=73;if(73===h.status)if(h.gzhead.name){H=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>H&&(n.adler=V(n.adler,h.pending_buf,h.pending-H,H)),N(n),H=h.pending,h.pending===h.pending_buf_size)){o=1;break}o=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,K(h,o)}while(0!==o);h.gzhead.hcrc&&h.pending>H&&(n.adler=V(n.adler,h.pending_buf,h.pending-H,H)),0===o&&(h.gzindex=0,h.status=91)}else h.status=91;if(91===h.status)if(h.gzhead.comment){H=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>H&&(n.adler=V(n.adler,h.pending_buf,h.pending-H,H)),N(n),H=h.pending,h.pending===h.pending_buf_size)){o=1;break}o=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,K(h,o)}while(0!==o);h.gzhead.hcrc&&h.pending>H&&(n.adler=V(n.adler,h.pending_buf,h.pending-H,H)),0===o&&(h.status=e)}else h.status=e;if(h.status===e&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&N(n),h.pending+2<=h.pending_buf_size&&(K(h,255&n.adler),K(h,n.adler>>8&255),n.adler=0,h.status=w)):h.status=w),0!==h.pending){if(N(n),0===n.avail_out)return h.last_flush=-1,z}else if(0===n.avail_in&&R(y)<=R(B)&&y!==T)return I(n,F);if(h.status===j&&0!==n.avail_in)return I(n,F);if(0!==n.avail_in||0!==h.lookahead||y!==b&&h.status!==j){let H=h.strategy===f?((n,y)=>{let H;for(;;){if(0===n.lookahead&&(s(n),0===n.lookahead)){if(y===b)return 1;break}if(n.match_length=0,H=k(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++,H&&(r(n,!1),0===n.strm.avail_out))return 1}return n.insert=0,y===T?(r(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(r(n,!1),0===n.strm.avail_out)?1:2})(h,y):h.strategy===c?((n,y)=>{let H,o,G,h;const i=n.window;for(;;){if(n.lookahead<=a){if(s(n),n.lookahead<=a&&y===b)return 1;if(0===n.lookahead)break}if(n.match_length=0,n.lookahead>=3&&n.strstart>0&&(G=n.strstart-1,o=i[G],o===i[++G]&&o===i[++G]&&o===i[++G])){h=n.strstart+a;do{}while(o===i[++G]&&o===i[++G]&&o===i[++G]&&o===i[++G]&&o===i[++G]&&o===i[++G]&&o===i[++G]&&o===i[++G]&&G<h);n.match_length=a-(h-G),n.match_length>n.lookahead&&(n.match_length=n.lookahead)}if(n.match_length>=3?(H=k(n,1,n.match_length-3),n.lookahead-=n.match_length,n.strstart+=n.match_length,n.match_length=0):(H=k(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++),H&&(r(n,!1),0===n.strm.avail_out))return 1}return n.insert=0,y===T?(r(n,!0),0===n.strm.avail_out?3:4):n.last_lit&&(r(n,!1),0===n.strm.avail_out)?1:2})(h,y):u[h.level].func(h,y);if(3!==H&&4!==H||(h.status=j),1===H||3===H)return 0===n.avail_out&&(h.last_flush=-1),z;if(2===H&&(y===A?i(h):y!==W&&(G(h,0,0,!1),y===U&&(C(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),N(n),0===n.avail_out))return h.last_flush=-1,z}return y!==T?z:h.wrap<=0?Q:(2===h.wrap?(K(h,255&n.adler),K(h,n.adler>>8&255),K(h,n.adler>>16&255),K(h,n.adler>>24&255),K(h,255&n.total_in),K(h,n.total_in>>8&255),K(h,n.total_in>>16&255),K(h,n.total_in>>24&255)):(Y(h,n.adler>>>16),Y(h,65535&n.adler)),N(n),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?z:Q)},n.exports.deflateEnd=n=>{if(!n||!n.state)return l;const y=n.state.status;return 42!==y&&69!==y&&73!==y&&91!==y&&y!==e&&y!==w&&y!==j?I(n,l):(n.state=null,y===w?I(n,v):z)},n.exports.deflateSetDictionary=(n,y)=>{let H=y.length;if(!n||!n.state)return l;const o=n.state,G=o.wrap;if(2===G||1===G&&42!==o.status||o.lookahead)return l;if(1===G&&(n.adler=B(n.adler,y,H,0)),o.wrap=0,H>=o.w_size){0===G&&(C(o.head),o.strstart=0,o.block_start=0,o.insert=0);let n=new Uint8Array(o.w_size);n.set(y.subarray(H-o.w_size,H),0),y=n,H=o.w_size}const h=n.avail_in,k=n.next_in,i=n.input;for(n.avail_in=H,n.next_in=0,n.input=y,s(o);o.lookahead>=3;){let n=o.strstart,y=o.lookahead-2;do{o.ins_h=S(o,o.ins_h,o.window[n+3-1]),o.prev[n&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=n,n++}while(--y);o.strstart=n,o.lookahead=2,s(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,n.next_in=k,n.input=i,n.avail_in=h,o.wrap=G,z},n.exports.deflateInfo="pako deflate (from Nodeca project)"},12581:n=>{"use strict";n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12571:n=>{"use strict";n.exports=function(n,y){let H,o,G,h,k,i,B,V,q,b,A,U,T,W,z,Q,l,v,F,g,M,f,c,p;const E=n.state;H=n.next_in,c=n.input,o=H+(n.avail_in-5),G=n.next_out,p=n.output,h=G-(y-n.avail_out),k=G+(n.avail_out-257),i=E.dmax,B=E.wsize,V=E.whave,q=E.wnext,b=E.window,A=E.hold,U=E.bits,T=E.lencode,W=E.distcode,z=(1<<E.lenbits)-1,Q=(1<<E.distbits)-1;n:do{U<15&&(A+=c[H++]<<U,U+=8,A+=c[H++]<<U,U+=8),l=T[A&z];y:for(;;){if(v=l>>>24,A>>>=v,U-=v,v=l>>>16&255,0===v)p[G++]=65535&l;else{if(!(16&v)){if(0===(64&v)){l=T[(65535&l)+(A&(1<<v)-1)];continue y}if(32&v){E.mode=12;break n}n.by="invalid literal/length code",E.mode=30;break n}F=65535&l,v&=15,v&&(U<v&&(A+=c[H++]<<U,U+=8),F+=A&(1<<v)-1,A>>>=v,U-=v),U<15&&(A+=c[H++]<<U,U+=8,A+=c[H++]<<U,U+=8),l=W[A&Q];H:for(;;){if(v=l>>>24,A>>>=v,U-=v,v=l>>>16&255,!(16&v)){if(0===(64&v)){l=W[(65535&l)+(A&(1<<v)-1)];continue H}n.by="invalid distance code",E.mode=30;break n}if(g=65535&l,v&=15,U<v&&(A+=c[H++]<<U,U+=8,U<v&&(A+=c[H++]<<U,U+=8)),g+=A&(1<<v)-1,g>i){n.by="invalid distance too far back",E.mode=30;break n}if(A>>>=v,U-=v,v=G-h,g>v){if(v=g-v,v>V&&E.sane){n.by="invalid distance too far back",E.mode=30;break n}if(M=0,f=b,0===q){if(M+=B-v,v<F){F-=v;do{p[G++]=b[M++]}while(--v);M=G-g,f=p}}else if(q<v){if(M+=B+q-v,v-=q,v<F){F-=v;do{p[G++]=b[M++]}while(--v);if(M=0,q<F){v=q,F-=v;do{p[G++]=b[M++]}while(--v);M=G-g,f=p}}}else if(M+=q-v,v<F){F-=v;do{p[G++]=b[M++]}while(--v);M=G-g,f=p}for(;F>2;)p[G++]=f[M++],p[G++]=f[M++],p[G++]=f[M++],F-=3;F&&(p[G++]=f[M++],F>1&&(p[G++]=f[M++]))}else{M=G-g;do{p[G++]=p[M++],p[G++]=p[M++],p[G++]=p[M++],F-=3}while(F>2);F&&(p[G++]=p[M++],F>1&&(p[G++]=p[M++]))}break}}break}}while(H<o&&G<k);F=U>>3,H-=F,U-=F<<3,A&=(1<<U)-1,n.next_in=H,n.next_out=G,n.avail_in=H<o?o-H+5:5-(H-o),n.avail_out=G<k?k-G+257:257-(G-k),E.hold=A,E.bits=U}},12565:(n,y,H)=>{"use strict";const o=H(12521),G=H(12524),h=H(12571),k=H(12579),{Z_FINISH:i,Z_BLOCK:B,Z_TREES:V,Z_OK:q,Z_STREAM_END:b,Z_NEED_DICT:A,Z_STREAM_ERROR:U,Z_DATA_ERROR:T,Z_MEM_ERROR:W,Z_BUF_ERROR:z,Z_DEFLATED:Q}=H(12537),l=12,v=30,F=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const M=n=>{if(!n||!n.state)return U;const y=n.state;return n.total_in=n.total_out=y.total=0,n.by="",y.wrap&&(n.adler=1&y.wrap),y.mode=1,y.last=0,y.havedict=0,y.dmax=32768,y.head=null,y.hold=0,y.bits=0,y.lencode=y.lendyn=new Int32Array(852),y.distcode=y.distdyn=new Int32Array(592),y.sane=1,y.back=-1,q},f=n=>{if(!n||!n.state)return U;const y=n.state;return y.wsize=0,y.whave=0,y.wnext=0,M(n)},c=(n,y)=>{let H;if(!n||!n.state)return U;const o=n.state;return y<0?(H=0,y=-y):(H=1+(y>>4),y<48&&(y&=15)),y&&(y<8||y>15)?U:(null!==o.window&&o.wbits!==y&&(o.window=null),o.wrap=H,o.wbits=y,f(n))},p=(n,y)=>{if(!n)return U;const H=new g;n.state=H,H.window=null;const o=c(n,y);return o!==q&&(n.state=null),o};let E,X,d=!0;const a=n=>{if(d){E=new Int32Array(512),X=new Int32Array(32);let y=0;for(;y<144;)n.lens[y++]=8;for(;y<256;)n.lens[y++]=9;for(;y<280;)n.lens[y++]=7;for(;y<288;)n.lens[y++]=8;for(k(1,n.lens,0,288,E,0,n.work,{bits:9}),y=0;y<32;)n.lens[y++]=5;k(2,n.lens,0,32,X,0,n.work,{bits:5}),d=!1}n.lencode=E,n.lenbits=9,n.distcode=X,n.distbits=5},O=(n,y,H,o)=>{let G;const h=n.state;return null===h.window&&(h.wsize=1<<h.wbits,h.wnext=0,h.whave=0,h.window=new Uint8Array(h.wsize)),o>=h.wsize?(h.window.set(y.subarray(H-h.wsize,H),0),h.wnext=0,h.whave=h.wsize):(G=h.wsize-h.wnext,G>o&&(G=o),h.window.set(y.subarray(H-o,H-o+G),h.wnext),(o-=G)?(h.window.set(y.subarray(H-o,H),0),h.wnext=o,h.whave=h.wsize):(h.wnext+=G,h.wnext===h.wsize&&(h.wnext=0),h.whave<h.wsize&&(h.whave+=G))),0};n.exports.inflateReset=f,n.exports.inflateReset2=c,n.exports.inflateResetKeep=M,n.exports.inflateInit=n=>p(n,15),n.exports.inflateInit2=p,n.exports.inflate=(n,y)=>{let H,g,M,f,c,p,E,X,d,e,w,j,I,R,C,S,N,r,K,Y,D,Z,s=0;const P=new Uint8Array(4);let x,t;const u=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!n||!n.state||!n.output||!n.input&&0!==n.avail_in)return U;H=n.state,H.mode===l&&(H.mode=13),c=n.next_out,M=n.output,E=n.avail_out,f=n.next_in,g=n.input,p=n.avail_in,X=H.hold,d=H.bits,e=p,w=E,Z=q;n:for(;;)switch(H.mode){case 1:if(0===H.wrap){H.mode=13;break}for(;d<16;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(2&H.wrap&&35615===X){H.check=0,P[0]=255&X,P[1]=X>>>8&255,H.check=G(H.check,P,2,0),X=0,d=0,H.mode=2;break}if(H.flags=0,H.head&&(H.head.done=!1),!(1&H.wrap)||(((255&X)<<8)+(X>>8))%31){n.by="incorrect header check",H.mode=v;break}if((15&X)!==Q){n.by="unknown compression method",H.mode=v;break}if(X>>>=4,d-=4,D=8+(15&X),0===H.wbits)H.wbits=D;else if(D>H.wbits){n.by="invalid window size",H.mode=v;break}H.dmax=1<<H.wbits,n.adler=H.check=1,H.mode=512&X?10:l,X=0,d=0;break;case 2:for(;d<16;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(H.flags=X,(255&H.flags)!==Q){n.by="unknown compression method",H.mode=v;break}if(57344&H.flags){n.by="unknown header flags set",H.mode=v;break}H.head&&(H.head.text=X>>8&1),512&H.flags&&(P[0]=255&X,P[1]=X>>>8&255,H.check=G(H.check,P,2,0)),X=0,d=0,H.mode=3;case 3:for(;d<32;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}H.head&&(H.head.time=X),512&H.flags&&(P[0]=255&X,P[1]=X>>>8&255,P[2]=X>>>16&255,P[3]=X>>>24&255,H.check=G(H.check,P,4,0)),X=0,d=0,H.mode=4;case 4:for(;d<16;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}H.head&&(H.head.xflags=255&X,H.head.os=X>>8),512&H.flags&&(P[0]=255&X,P[1]=X>>>8&255,H.check=G(H.check,P,2,0)),X=0,d=0,H.mode=5;case 5:if(1024&H.flags){for(;d<16;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}H.length=X,H.head&&(H.head.extra_len=X),512&H.flags&&(P[0]=255&X,P[1]=X>>>8&255,H.check=G(H.check,P,2,0)),X=0,d=0}else H.head&&(H.head.extra=null);H.mode=6;case 6:if(1024&H.flags&&(j=H.length,j>p&&(j=p),j&&(H.head&&(D=H.head.extra_len-H.length,H.head.extra||(H.head.extra=new Uint8Array(H.head.extra_len)),H.head.extra.set(g.subarray(f,f+j),D)),512&H.flags&&(H.check=G(H.check,g,j,f)),p-=j,f+=j,H.length-=j),H.length))break n;H.length=0,H.mode=7;case 7:if(2048&H.flags){if(0===p)break n;j=0;do{D=g[f+j++],H.head&&D&&H.length<65536&&(H.head.name+=String.fromCharCode(D))}while(D&&j<p);if(512&H.flags&&(H.check=G(H.check,g,j,f)),p-=j,f+=j,D)break n}else H.head&&(H.head.name=null);H.length=0,H.mode=8;case 8:if(4096&H.flags){if(0===p)break n;j=0;do{D=g[f+j++],H.head&&D&&H.length<65536&&(H.head.comment+=String.fromCharCode(D))}while(D&&j<p);if(512&H.flags&&(H.check=G(H.check,g,j,f)),p-=j,f+=j,D)break n}else H.head&&(H.head.comment=null);H.mode=9;case 9:if(512&H.flags){for(;d<16;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(X!==(65535&H.check)){n.by="header crc mismatch",H.mode=v;break}X=0,d=0}H.head&&(H.head.hcrc=H.flags>>9&1,H.head.done=!0),n.adler=H.check=0,H.mode=l;break;case 10:for(;d<32;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}n.adler=H.check=F(X),X=0,d=0,H.mode=11;case 11:if(0===H.havedict)return n.next_out=c,n.avail_out=E,n.next_in=f,n.avail_in=p,H.hold=X,H.bits=d,A;n.adler=H.check=1,H.mode=l;case l:if(y===B||y===V)break n;case 13:if(H.last){X>>>=7&d,d-=7&d,H.mode=27;break}for(;d<3;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}switch(H.last=1&X,X>>>=1,d-=1,3&X){case 0:H.mode=14;break;case 1:if(a(H),H.mode=20,y===V){X>>>=2,d-=2;break n}break;case 2:H.mode=17;break;case 3:n.by="invalid block type",H.mode=v}X>>>=2,d-=2;break;case 14:for(X>>>=7&d,d-=7&d;d<32;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if((65535&X)!==(X>>>16^65535)){n.by="invalid stored block lengths",H.mode=v;break}if(H.length=65535&X,X=0,d=0,H.mode=15,y===V)break n;case 15:H.mode=16;case 16:if(j=H.length,j){if(j>p&&(j=p),j>E&&(j=E),0===j)break n;M.set(g.subarray(f,f+j),c),p-=j,f+=j,E-=j,c+=j,H.length-=j;break}H.mode=l;break;case 17:for(;d<14;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(H.nlen=257+(31&X),X>>>=5,d-=5,H.ndist=1+(31&X),X>>>=5,d-=5,H.ncode=4+(15&X),X>>>=4,d-=4,H.nlen>286||H.ndist>30){n.by="too many length or distance symbols",H.mode=v;break}H.have=0,H.mode=18;case 18:for(;H.have<H.ncode;){for(;d<3;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}H.lens[u[H.have++]]=7&X,X>>>=3,d-=3}for(;H.have<19;)H.lens[u[H.have++]]=0;if(H.lencode=H.lendyn,H.lenbits=7,x={bits:H.lenbits},Z=k(0,H.lens,0,19,H.lencode,0,H.work,x),H.lenbits=x.bits,Z){n.by="invalid code lengths set",H.mode=v;break}H.have=0,H.mode=19;case 19:for(;H.have<H.nlen+H.ndist;){for(;s=H.lencode[X&(1<<H.lenbits)-1],C=s>>>24,S=s>>>16&255,N=65535&s,!(C<=d);){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(N<16)X>>>=C,d-=C,H.lens[H.have++]=N;else{if(16===N){for(t=C+2;d<t;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(X>>>=C,d-=C,0===H.have){n.by="invalid bit length repeat",H.mode=v;break}D=H.lens[H.have-1],j=3+(3&X),X>>>=2,d-=2}else if(17===N){for(t=C+3;d<t;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}X>>>=C,d-=C,D=0,j=3+(7&X),X>>>=3,d-=3}else{for(t=C+7;d<t;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}X>>>=C,d-=C,D=0,j=11+(127&X),X>>>=7,d-=7}if(H.have+j>H.nlen+H.ndist){n.by="invalid bit length repeat",H.mode=v;break}for(;j--;)H.lens[H.have++]=D}}if(H.mode===v)break;if(0===H.lens[256]){n.by="invalid code -- missing end-of-block",H.mode=v;break}if(H.lenbits=9,x={bits:H.lenbits},Z=k(1,H.lens,0,H.nlen,H.lencode,0,H.work,x),H.lenbits=x.bits,Z){n.by="invalid literal/lengths set",H.mode=v;break}if(H.distbits=6,H.distcode=H.distdyn,x={bits:H.distbits},Z=k(2,H.lens,H.nlen,H.ndist,H.distcode,0,H.work,x),H.distbits=x.bits,Z){n.by="invalid distances set",H.mode=v;break}if(H.mode=20,y===V)break n;case 20:H.mode=21;case 21:if(p>=6&&E>=258){n.next_out=c,n.avail_out=E,n.next_in=f,n.avail_in=p,H.hold=X,H.bits=d,h(n,w),c=n.next_out,M=n.output,E=n.avail_out,f=n.next_in,g=n.input,p=n.avail_in,X=H.hold,d=H.bits,H.mode===l&&(H.back=-1);break}for(H.back=0;s=H.lencode[X&(1<<H.lenbits)-1],C=s>>>24,S=s>>>16&255,N=65535&s,!(C<=d);){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(S&&0===(240&S)){for(r=C,K=S,Y=N;s=H.lencode[Y+((X&(1<<r+K)-1)>>r)],C=s>>>24,S=s>>>16&255,N=65535&s,!(r+C<=d);){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}X>>>=r,d-=r,H.back+=r}if(X>>>=C,d-=C,H.back+=C,H.length=N,0===S){H.mode=26;break}if(32&S){H.back=-1,H.mode=l;break}if(64&S){n.by="invalid literal/length code",H.mode=v;break}H.extra=15&S,H.mode=22;case 22:if(H.extra){for(t=H.extra;d<t;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}H.length+=X&(1<<H.extra)-1,X>>>=H.extra,d-=H.extra,H.back+=H.extra}H.was=H.length,H.mode=23;case 23:for(;s=H.distcode[X&(1<<H.distbits)-1],C=s>>>24,S=s>>>16&255,N=65535&s,!(C<=d);){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(0===(240&S)){for(r=C,K=S,Y=N;s=H.distcode[Y+((X&(1<<r+K)-1)>>r)],C=s>>>24,S=s>>>16&255,N=65535&s,!(r+C<=d);){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}X>>>=r,d-=r,H.back+=r}if(X>>>=C,d-=C,H.back+=C,64&S){n.by="invalid distance code",H.mode=v;break}H.offset=N,H.extra=15&S,H.mode=24;case 24:if(H.extra){for(t=H.extra;d<t;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}H.offset+=X&(1<<H.extra)-1,X>>>=H.extra,d-=H.extra,H.back+=H.extra}if(H.offset>H.dmax){n.by="invalid distance too far back",H.mode=v;break}H.mode=25;case 25:if(0===E)break n;if(j=w-E,H.offset>j){if(j=H.offset-j,j>H.whave&&H.sane){n.by="invalid distance too far back",H.mode=v;break}j>H.wnext?(j-=H.wnext,I=H.wsize-j):I=H.wnext-j,j>H.length&&(j=H.length),R=H.window}else R=M,I=c-H.offset,j=H.length;j>E&&(j=E),E-=j,H.length-=j;do{M[c++]=R[I++]}while(--j);0===H.length&&(H.mode=21);break;case 26:if(0===E)break n;M[c++]=H.length,E--,H.mode=21;break;case 27:if(H.wrap){for(;d<32;){if(0===p)break n;p--,X|=g[f++]<<d,d+=8}if(w-=E,n.total_out+=w,H.total+=w,w&&(n.adler=H.check=H.flags?G(H.check,M,w,c-w):o(H.check,M,w,c-w)),w=E,(H.flags?X:F(X))!==H.check){n.by="incorrect data check",H.mode=v;break}X=0,d=0}H.mode=28;case 28:if(H.wrap&&H.flags){for(;d<32;){if(0===p)break n;p--,X+=g[f++]<<d,d+=8}if(X!==(4294967295&H.total)){n.by="incorrect length check",H.mode=v;break}X=0,d=0}H.mode=29;case 29:Z=b;break n;case v:Z=T;break n;case 31:return W;default:return U}return n.next_out=c,n.avail_out=E,n.next_in=f,n.avail_in=p,H.hold=X,H.bits=d,(H.wsize||w!==n.avail_out&&H.mode<v&&(H.mode<27||y!==i))&&O(n,n.output,n.next_out,w-n.avail_out)?(H.mode=31,W):(e-=n.avail_in,w-=n.avail_out,n.total_in+=e,n.total_out+=w,H.total+=w,H.wrap&&w&&(n.adler=H.check=H.flags?G(H.check,M,w,n.next_out-w):o(H.check,M,w,n.next_out-w)),n.data_type=H.bits+(H.last?64:0)+(H.mode===l?128:0)+(20===H.mode||15===H.mode?256:0),(0===e&&0===w||y===i)&&Z===q&&(Z=z),Z)},n.exports.inflateEnd=n=>{if(!n||!n.state)return U;let y=n.state;return y.window&&(y.window=null),n.state=null,q},n.exports.inflateGetHeader=(n,y)=>{if(!n||!n.state)return U;const H=n.state;return 0===(2&H.wrap)?U:(H.head=y,y.done=!1,q)},n.exports.inflateSetDictionary=(n,y)=>{const H=y.length;let G,h,k;return n&&n.state?(G=n.state,0!==G.wrap&&11!==G.mode?U:11===G.mode&&(h=1,h=o(h,y,H,0),h!==G.check)?T:(k=O(n,y,H,H),k?(G.mode=31,W):(G.havedict=1,q))):U},n.exports.inflateInfo="pako inflate (from Nodeca project)"},12579:n=>{"use strict";const y=15,H=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),o=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),G=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),h=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);n.exports=(n,k,i,B,V,q,b,A)=>{const U=A.bits;let T,W,z,Q,l,v,F=0,g=0,M=0,f=0,c=0,p=0,E=0,X=0,d=0,a=0,O=null,e=0;const w=new Uint16Array(16),j=new Uint16Array(16);let I,R,C,S=null,N=0;for(F=0;F<=y;F++)w[F]=0;for(g=0;g<B;g++)w[k[i+g]]++;for(c=U,f=y;f>=1&&0===w[f];f--);if(c>f&&(c=f),0===f)return V[q++]=20971520,V[q++]=20971520,A.bits=1,0;for(M=1;M<f&&0===w[M];M++);for(c<M&&(c=M),X=1,F=1;F<=y;F++)if(X<<=1,X-=w[F],X<0)return-1;if(X>0&&(0===n||1!==f))return-1;for(j[1]=0,F=1;F<y;F++)j[F+1]=j[F]+w[F];for(g=0;g<B;g++)0!==k[i+g]&&(b[j[k[i+g]]++]=g);if(0===n?(O=S=b,v=19):1===n?(O=H,e-=257,S=o,N-=257,v=256):(O=G,S=h,v=-1),a=0,g=0,F=M,l=q,p=c,E=0,z=-1,d=1<<c,Q=d-1,1===n&&d>852||2===n&&d>592)return 1;for(;;){I=F-E,b[g]<v?(R=0,C=b[g]):b[g]>v?(R=S[N+b[g]],C=O[e+b[g]]):(R=96,C=0),T=1<<F-E,W=1<<p,M=W;do{W-=T,V[l+(a>>E)+W]=I<<24|R<<16|C}while(0!==W);for(T=1<<F-1;a&T;)T>>=1;if(0!==T?(a&=T-1,a+=T):a=0,g++,0===--w[F]){if(F===f)break;F=k[i+b[g]]}if(F>c&&(a&Q)!==z){for(0===E&&(E=c),l+=M,p=F-E,X=1<<p;p+E<f&&(X-=w[p+E],!(X<=0));)p++,X<<=1;if(d+=1<<p,1===n&&d>852||2===n&&d>592)return 1;z=a&Q,V[z]=c<<24|p<<16|l-q}}return 0!==a&&(V[l+a]=F-E<<24|64<<16),A.bits=c,0}},12533:n=>{"use strict";n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12515:n=>{"use strict";function y(n){let y=n.length;for(;--y>=0;)n[y]=0}const H=256,o=286,G=30,h=15,k=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),i=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),B=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),V=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),q=new Array(576);y(q);const b=new Array(60);y(b);const A=new Array(512);y(A);const U=new Array(256);y(U);const T=new Array(29);y(T);const W=new Array(G);function z(n,y,H,o,G){this.static_tree=n,this.extra_bits=y,this.extra_base=H,this.elems=o,this.max_length=G,this.has_stree=n&&n.length}let Q,l,v;function F(n,y){this.dyn_tree=n,this.max_code=0,this.stat_desc=y}y(W);const g=n=>n<256?A[n]:A[256+(n>>>7)],M=(n,y)=>{n.pending_buf[n.pending++]=255&y,n.pending_buf[n.pending++]=y>>>8&255},f=(n,y,H)=>{n.bi_valid>16-H?(n.bi_buf|=y<<n.bi_valid&65535,M(n,n.bi_buf),n.bi_buf=y>>16-n.bi_valid,n.bi_valid+=H-16):(n.bi_buf|=y<<n.bi_valid&65535,n.bi_valid+=H)},c=(n,y,H)=>{f(n,H[2*y],H[2*y+1])},p=(n,y)=>{let H=0;do{H|=1&n,n>>>=1,H<<=1}while(--y>0);return H>>>1},E=(n,y,H)=>{const o=new Array(16);let G,k,i=0;for(G=1;G<=h;G++)o[G]=i=i+H[G-1]<<1;for(k=0;k<=y;k++){let y=n[2*k+1];0!==y&&(n[2*k]=p(o[y]++,y))}},X=n=>{let y;for(y=0;y<o;y++)n.dyn_ltree[2*y]=0;for(y=0;y<G;y++)n.dyn_dtree[2*y]=0;for(y=0;y<19;y++)n.bl_tree[2*y]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.last_lit=n.matches=0},d=n=>{n.bi_valid>8?M(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},a=(n,y,H,o)=>{const G=2*y,h=2*H;return n[G]<n[h]||n[G]===n[h]&&o[y]<=o[H]},O=(n,y,H)=>{const o=n.heap[H];let G=H<<1;for(;G<=n.heap_len&&(G<n.heap_len&&a(y,n.heap[G+1],n.heap[G],n.depth)&&G++,!a(y,o,n.heap[G],n.depth));)n.heap[H]=n.heap[G],H=G,G<<=1;n.heap[H]=o},e=(n,y,o)=>{let G,h,B,V,q=0;if(0!==n.last_lit)do{G=n.pending_buf[n.d_buf+2*q]<<8|n.pending_buf[n.d_buf+2*q+1],h=n.pending_buf[n.l_buf+q],q++,0===G?c(n,h,y):(B=U[h],c(n,B+H+1,y),V=k[B],0!==V&&(h-=T[B],f(n,h,V)),G--,B=g(G),c(n,B,o),V=i[B],0!==V&&(G-=W[B],f(n,G,V)))}while(q<n.last_lit);c(n,256,y)},w=(n,y)=>{const H=y.dyn_tree,o=y.stat_desc.static_tree,G=y.stat_desc.has_stree,k=y.stat_desc.elems;let i,B,V,q=-1;for(n.heap_len=0,n.heap_max=573,i=0;i<k;i++)0!==H[2*i]?(n.heap[++n.heap_len]=q=i,n.depth[i]=0):H[2*i+1]=0;for(;n.heap_len<2;)V=n.heap[++n.heap_len]=q<2?++q:0,H[2*V]=1,n.depth[V]=0,n.opt_len--,G&&(n.static_len-=o[2*V+1]);for(y.max_code=q,i=n.heap_len>>1;i>=1;i--)O(n,H,i);V=k;do{i=n.heap[1],n.heap[1]=n.heap[n.heap_len--],O(n,H,1),B=n.heap[1],n.heap[--n.heap_max]=i,n.heap[--n.heap_max]=B,H[2*V]=H[2*i]+H[2*B],n.depth[V]=(n.depth[i]>=n.depth[B]?n.depth[i]:n.depth[B])+1,H[2*i+1]=H[2*B+1]=V,n.heap[1]=V++,O(n,H,1)}while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((n,y)=>{const H=y.dyn_tree,o=y.max_code,G=y.stat_desc.static_tree,k=y.stat_desc.has_stree,i=y.stat_desc.extra_bits,B=y.stat_desc.extra_base,V=y.stat_desc.max_length;let q,b,A,U,T,W,z=0;for(U=0;U<=h;U++)n.bl_count[U]=0;for(H[2*n.heap[n.heap_max]+1]=0,q=n.heap_max+1;q<573;q++)b=n.heap[q],U=H[2*H[2*b+1]+1]+1,U>V&&(U=V,z++),H[2*b+1]=U,b>o||(n.bl_count[U]++,T=0,b>=B&&(T=i[b-B]),W=H[2*b],n.opt_len+=W*(U+T),k&&(n.static_len+=W*(G[2*b+1]+T)));if(0!==z){do{for(U=V-1;0===n.bl_count[U];)U--;n.bl_count[U]--,n.bl_count[U+1]+=2,n.bl_count[V]--,z-=2}while(z>0);for(U=V;0!==U;U--)for(b=n.bl_count[U];0!==b;)A=n.heap[--q],A>o||(H[2*A+1]!==U&&(n.opt_len+=(U-H[2*A+1])*H[2*A],H[2*A+1]=U),b--)}})(n,y),E(H,q,n.bl_count)},j=(n,y,H)=>{let o,G,h=-1,k=y[1],i=0,B=7,V=4;for(0===k&&(B=138,V=3),y[2*(H+1)+1]=65535,o=0;o<=H;o++)G=k,k=y[2*(o+1)+1],++i<B&&G===k||(i<V?n.bl_tree[2*G]+=i:0!==G?(G!==h&&n.bl_tree[2*G]++,n.bl_tree[32]++):i<=10?n.bl_tree[34]++:n.bl_tree[36]++,i=0,h=G,0===k?(B=138,V=3):G===k?(B=6,V=3):(B=7,V=4))},I=(n,y,H)=>{let o,G,h=-1,k=y[1],i=0,B=7,V=4;for(0===k&&(B=138,V=3),o=0;o<=H;o++)if(G=k,k=y[2*(o+1)+1],!(++i<B&&G===k)){if(i<V)do{c(n,G,n.bl_tree)}while(0!==--i);else 0!==G?(G!==h&&(c(n,G,n.bl_tree),i--),c(n,16,n.bl_tree),f(n,i-3,2)):i<=10?(c(n,17,n.bl_tree),f(n,i-3,3)):(c(n,18,n.bl_tree),f(n,i-11,7));i=0,h=G,0===k?(B=138,V=3):G===k?(B=6,V=3):(B=7,V=4)}};let R=!1;const C=(n,y,H,o)=>{f(n,0+(o?1:0),3),((n,y,H,o)=>{d(n),o&&(M(n,H),M(n,~H)),n.pending_buf.set(n.window.subarray(y,y+H),n.pending),n.pending+=H})(n,y,H,!0)};n.exports._tr_init=n=>{R||((()=>{let n,y,H,V,F;const g=new Array(16);for(H=0,V=0;V<28;V++)for(T[V]=H,n=0;n<1<<k[V];n++)U[H++]=V;for(U[H-1]=V,F=0,V=0;V<16;V++)for(W[V]=F,n=0;n<1<<i[V];n++)A[F++]=V;for(F>>=7;V<G;V++)for(W[V]=F<<7,n=0;n<1<<i[V]-7;n++)A[256+F++]=V;for(y=0;y<=h;y++)g[y]=0;for(n=0;n<=143;)q[2*n+1]=8,n++,g[8]++;for(;n<=255;)q[2*n+1]=9,n++,g[9]++;for(;n<=279;)q[2*n+1]=7,n++,g[7]++;for(;n<=287;)q[2*n+1]=8,n++,g[8]++;for(E(q,287,g),n=0;n<G;n++)b[2*n+1]=5,b[2*n]=p(n,5);Q=new z(q,k,257,o,h),l=new z(b,i,0,G,h),v=new z(new Array(0),B,0,19,7)})(),R=!0),n.l_desc=new F(n.dyn_ltree,Q),n.d_desc=new F(n.dyn_dtree,l),n.bl_desc=new F(n.bl_tree,v),n.bi_buf=0,n.bi_valid=0,X(n)},n.exports._tr_stored_block=C,n.exports._tr_flush_block=(n,y,o,G)=>{let h,k,i=0;n.level>0?(2===n.strm.data_type&&(n.strm.data_type=(n=>{let y,o=4093624447;for(y=0;y<=31;y++,o>>>=1)if(1&o&&0!==n.dyn_ltree[2*y])return 0;if(0!==n.dyn_ltree[18]||0!==n.dyn_ltree[20]||0!==n.dyn_ltree[26])return 1;for(y=32;y<H;y++)if(0!==n.dyn_ltree[2*y])return 1;return 0})(n)),w(n,n.l_desc),w(n,n.d_desc),i=(n=>{let y;for(j(n,n.dyn_ltree,n.l_desc.max_code),j(n,n.dyn_dtree,n.d_desc.max_code),w(n,n.bl_desc),y=18;y>=3&&0===n.bl_tree[2*V[y]+1];y--);return n.opt_len+=3*(y+1)+5+5+4,y})(n),h=n.opt_len+3+7>>>3,k=n.static_len+3+7>>>3,k<=h&&(h=k)):h=k=o+5,o+4<=h&&-1!==y?C(n,y,o,G):4===n.strategy||k===h?(f(n,2+(G?1:0),3),e(n,q,b)):(f(n,4+(G?1:0),3),((n,y,H,o)=>{let G;for(f(n,y-257,5),f(n,H-1,5),f(n,o-4,4),G=0;G<o;G++)f(n,n.bl_tree[2*V[G]+1],3);I(n,n.dyn_ltree,y-1),I(n,n.dyn_dtree,H-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,i+1),e(n,n.dyn_ltree,n.dyn_dtree)),X(n),G&&d(n)},n.exports._tr_tally=(n,y,o)=>(n.pending_buf[n.d_buf+2*n.last_lit]=y>>>8&255,n.pending_buf[n.d_buf+2*n.last_lit+1]=255&y,n.pending_buf[n.l_buf+n.last_lit]=255&o,n.last_lit++,0===y?n.dyn_ltree[2*o]++:(n.matches++,y--,n.dyn_ltree[2*(U[o]+H+1)]++,n.dyn_dtree[2*g(y)]++),n.last_lit===n.lit_bufsize-1),n.exports._tr_align=n=>{f(n,2,3),c(n,256,q),(n=>{16===n.bi_valid?(M(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(n)}},12551:n=>{"use strict";n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.by="",this.state=null,this.data_type=2,this.adler=0}},12186:n=>{function y(n,y,H){for(var o=n.length,G=-1/0,h=1/0,k=0;k<o;k++){var i=(H[0][k]-n[k])/y[k],B=(H[1][k]-n[k])/y[k];if(i>B){var V=i;i=B,B=V}if(B<G||i>h)return 1/0;i>G&&(G=i),B<h&&(h=B)}return G>h?1/0:G}n.exports=function(n,H,o,G){var h=y(H,o,G);if(h===1/0)n=null;else{n=n||[];for(var k=0;k<H.length;k++)n[k]=H[k]+o[k]*h}return n},n.exports.distance=y},13576:(n,y,H)=>{"use strict";H.d(y,{b:()=>k});var o=H(37);const G=o.useLayoutEffect;const h=function(n){var y=(0,o.useRef)(n);return G((function(){y.current=n})),y};var k=function(n){var y=h(n);(0,o.By)((function(){var n=function(n){var H;if(null!=y.current&&(H=y.current(n)),n.defaultPrevented&&(n.returnValue=""),"string"===typeof H)return n.returnValue=H,H};return window.addEventListener("beforeunload",n),function(){window.removeEventListener("beforeunload",n)}}),[])}},13530:(n,y,H)=>{"use strict";var o=H(13536),G=Array.prototype.concat,h=Array.prototype.slice,k=n.exports=function(n){for(var y=[],H=0,k=n.length;H<k;H++){var i=n[H];o(i)?y=G.call(y,h.call(i)):y.push(i)}return y};k.wrap=function(n){return function(){return n(k(arguments))}}},13536:n=>{n.exports=function(n){return!(!n||"string"===typeof n)&&(n instanceof Array||Array.isArray(n)||n.length>=0&&(n.splice instanceof Function||Object.getOwnPropertyDescriptor(n,n.length-1)&&"String"!==n.constructor.name))}},12452:(n,y,H)=>{var o=H(12458);function G(n){for(var y,H,G=0,h=n.length,k=0;k<n.length;){for(y=n[k],H=0;k<h&&n[k]===y;)++k,++H;G+=o.log2(H)/7|0,G+=o.log2(y>>>0)/7|0,G+=2}return G}y.size=G,y.encode=function(n,y){y||(y=new Uint8Array(G(n)));for(var H,o,h=0,k=y.length,i=0;i<n.length;){for(H=n[i],o=0;i<n.length&&n[i]===H;)++i,++o;for(;h<k&&o>=128;)y[h++]=128+(127&o),o>>>=7;if(h>=k)throw new Error("RLE buffer overflow");for(y[h++]=o,H>>>=0;h<k&&H>=128;)y[h++]=128+(127&H),H>>>=7;if(h>=k)throw new Error("RLE buffer overflow");y[h++]=H}return y},y.decode=function(n,y){for(var H,o,G,h,k=y.length,i=n.length,B=0,V=0;V<i;){for(H=0,o=0;V<i&&n[V]>=128;)H+=(127&n[V++])<<o,o+=7;if(H+=n[V++]<<o,V>=i)throw new Error("RLE buffer underrun");if(B+H>k)throw new Error("Chunk buffer overflow");for(G=0,o=0;V<i&&n[V]>=128;)G+=(127&n[V++])<<o,o+=7;if(V>=i)throw new Error("RLE buffer underrun");for(G+=n[V++]<<o,h=0;h<H;++h)y[B++]=G}return y}},12458:(n,y)=>{"use strict";function H(n){var y=32;return(n&=-n)&&y--,65535&n&&(y-=16),16711935&n&&(y-=8),252645135&n&&(y-=4),858993459&n&&(y-=2),1431655765&n&&(y-=1),y}y.INT_BITS=32,y.INT_MAX=2147483647,y.INT_MIN=-1<<31,y.sign=function(n){return(n>0)-(n<0)},y.abs=function(n){var y=n>>31;return(n^y)-y},y.min=function(n,y){return y^(n^y)&-(n<y)},y.max=function(n,y){return n^(n^y)&-(n<y)},y.isPow2=function(n){return!(n&n-1)&&!!n},y.log2=function(n){var y,H;return y=(n>65535)<<4,y|=H=((n>>>=y)>255)<<3,y|=H=((n>>>=H)>15)<<2,(y|=H=((n>>>=H)>3)<<1)|(n>>>=H)>>1},y.log10=function(n){return n>=1e9?9:n>=1e8?8:n>=1e7?7:n>=1e6?6:n>=1e5?5:n>=1e4?4:n>=1e3?3:n>=100?2:n>=10?1:0},y.popCount=function(n){return 16843009*((n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135)>>>24},y.countTrailingZeros=H,y.nextPow2=function(n){return n+=0===n,--n,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,(n|=n>>>16)+1},y.prevPow2=function(n){return n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,(n|=n>>>16)-(n>>>1)},y.parity=function(n){return n^=n>>>16,n^=n>>>8,n^=n>>>4,27030>>>(n&=15)&1};var o=new Array(256);!function(n){for(var y=0;y<256;++y){var H=y,o=y,G=7;for(H>>>=1;H;H>>>=1)o<<=1,o|=1&H,--G;n[y]=o<<G&255}}(o),y.reverse=function(n){return o[255&n]<<24|o[n>>>8&255]<<16|o[n>>>16&255]<<8|o[n>>>24&255]},y.interleave2=function(n,y){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n&=65535)|n<<8))|n<<4))|n<<2))|n<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y&=65535)|y<<8))|y<<4))|y<<2))|y<<1))<<1},y.deinterleave2=function(n,y){return(n=65535&((n=16711935&((n=252645135&((n=858993459&((n=n>>>y&1431655765)|n>>>1))|n>>>2))|n>>>4))|n>>>16))<<16>>16},y.interleave3=function(n,y,H){return n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2),(n|=(y=1227133513&((y=3272356035&((y=251719695&((y=4278190335&((y&=1023)|y<<16))|y<<8))|y<<4))|y<<2))<<1)|(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<2},y.deinterleave3=function(n,y){return(n=1023&((n=4278190335&((n=251719695&((n=3272356035&((n=n>>>y&1227133513)|n>>>2))|n>>>4))|n>>>8))|n>>>16))<<22>>22},y.nextCombination=function(n){var y=n|n-1;return y+1|(~y&-~y)-1>>>H(n)+1}},12493:n=>{"use strict";n.exports=function(n,y,H,o){var G=self||window;try{try{var h;try{h=new G.Blob([n])}catch(V){(h=new(G.BlobBuilder||G.WebKitBlobBuilder||G.MozBlobBuilder||G.MSBlobBuilder)).append(n),h=h.getBlob()}var k=G.URL||G.webkitURL,i=k.createObjectURL(h),B=new G[y](i,H);return k.revokeObjectURL(i),B}catch(V){return new G[y]("data:application/javascript,".concat(encodeURIComponent(n)),H)}}catch(V){if(!o)throw Error("Inline worker is not supported");return new G[y](o,H)}}},12169:(n,y,H)=>{"use strict";function o(n,y,H,o,G){var h={};return Object.keys(o).forEach((function(n){h[n]=o[n]})),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=H.slice().reverse().reduce((function(H,o){return o(n,y,H)||H}),h),G&&void 0!==h.initializer&&(h.value=h.initializer?h.initializer.call(G):void 0,h.initializer=void 0),void 0===h.initializer&&(Object.defineProperty(n,y,h),h=null),h}H.d(y,{b:()=>o})},12160:(n,y,H)=>{"use strict";function o(n,y,H,o){H&&Object.defineProperty(n,y,{enumerable:H.enumerable,configurable:H.configurable,writable:H.writable,value:H.initializer?H.initializer.call(o):void 0})}H.d(y,{d:()=>o})},13569:(n,y,H)=>{"use strict";H.d(y,{c:()=>k,d:()=>b,e:()=>i,i:()=>h,k:()=>B,n:()=>G,p:()=>V,t:()=>q});var o=H(11527);class G{constructor(){this._easingMode=G.EASINGMODE_EASEIN}setEasingMode(n){const y=Math.min(Math.max(n,0),2);this._easingMode=y}getEasingMode(){return this._easingMode}easeInCore(n){throw new Error("You must implement this method")}ease(n){switch(this._easingMode){case G.EASINGMODE_EASEIN:return this.easeInCore(n);case G.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-n)}return n>=.5?.5*(1-this.easeInCore(2*(1-n)))+.5:.5*this.easeInCore(2*n)}}G.EASINGMODE_EASEIN=0,G.EASINGMODE_EASEOUT=1,G.EASINGMODE_EASEINOUT=2;class h extends G{easeInCore(n){return n=Math.max(0,Math.min(1,n)),1-Math.sqrt(1-n*n)}}class k extends G{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=n}easeInCore(n){const y=Math.max(0,this.amplitude);return Math.pow(n,3)-n*y*Math.sin(3.141592653589793*n)}}class i extends G{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=n,this.bounciness=y}easeInCore(n){const y=Math.max(0,this.bounces);let H=this.bounciness;H<=1&&(H=1.001);const o=Math.pow(H,y),G=1-H,h=(1-o)/G+.5*o,k=n*h,i=Math.log(-k*(1-H)+1)/Math.log(H),B=Math.floor(i),V=B+1,q=(1-Math.pow(H,B))/(G*h),b=.5*(q+(1-Math.pow(H,V))/(G*h)),A=n-b,U=b-q;return-Math.pow(1/H,y-B)/(U*U)*(A-U)*(A+U)}}class B extends G{easeInCore(n){return n*n*n}}class V extends G{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=n,this.springiness=y}easeInCore(n){let y;const H=Math.max(0,this.oscillations),o=Math.max(0,this.springiness);return y=0==o?n:(Math.exp(o*n)-1)/(Math.exp(o)-1),y*Math.sin((6.283185307179586*H+1.5707963267948966)*n)}}class q extends G{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=n}easeInCore(n){return this.exponent<=0?n:(Math.exp(this.exponent*n)-1)/(Math.exp(this.exponent)-1)}}class b extends G{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=n,this.y1=y,this.x2=H,this.y2=o}easeInCore(n){return o.d.Interpolate(n,this.x1,this.y1,this.x2,this.y2)}}},13034:(n,y,H)=>{"use strict";H.d(y,{d:()=>k});var o=H(11288),G=H(11300),h=H(11775);class k extends h.c{get _matrix(){return this._compose(),this.BU}set _matrix(n){(n.updateFlag!==this.BU.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.BU.B(n),this._markAsDirtyAndDecompose())}constructor(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(n,y.pn(),!1),this.name=n,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=y,this.BU=(null===G||void 0===G?void 0:G.clone())??o.Matrix.Identity(),this._restMatrix=h??this.BU.clone(),this._bindMatrix=k??this.BU.clone(),this._index=i,this._absoluteMatrix=new o.Matrix,this._absoluteBindMatrix=new o.Matrix,this._absoluteInverseBindMatrix=new o.Matrix,this._finalMatrix=new o.Matrix,y.bones.push(this),this.setParent(H,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(n){this.setParent(n)}setParent(n){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==n){if(this.parent){const n=this.parent.children.indexOf(this);-1!==n&&this.parent.children.splice(n,1)}this._parentNode=n,this.parent&&this.parent.children.push(this),y&&this._updateAbsoluteBindMatrices(),this.ZV()}}getLocalMatrix(){return this._compose(),this.BU}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(n){this._restMatrix.B(n)}setRestPose(n){this.setRestMatrix(n)}getBindPose(){return this.getBindMatrix()}setBindMatrix(n){this.zi(n)}setBindPose(n){this.setBindMatrix(n)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const n=o.TmpVectors.zy[0],y=o.TmpVectors.Quaternion[0],H=o.TmpVectors.zy[1];this.getRestMatrix().decompose(n,y,H),this._linkedTransformNode.position.B(H),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??o.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.B(y),this._linkedTransformNode.fi.B(n)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(n){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=n,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.ui}set position(n){this._decompose(),this.ui.B(n),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(n){this.setRotation(n)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(n){this.setRotationQuaternion(n)}get fi(){return this.getScale()}set fi(n){this.setScale(n)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=o.zy.Zero(),this._localRotation=o.Quaternion.Zero(),this.ui=o.zy.Zero()),this.BU.decompose(this._localScaling,this._localRotation,this.ui))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,o.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.ui,this.BU)):this._needToCompose=!1)}zi(n){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.B(n),y&&this._updateAbsoluteBindMatrices(),H?this._matrix=n:this.ZV()}_updateAbsoluteBindMatrices(n){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(n||(n=this._bindMatrix),this.parent?n.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.B(n),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),y)for(let H=0;H<this.children.length;H++)this.children[H]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}ZV(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.ZV(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.ZV(),this._needToDecompose=!0}_updatePosition(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0,G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const h=this.getLocalMatrix();if(0==y)G?(h.addAtIndex(12,n.x),h.addAtIndex(13,n.y),h.addAtIndex(14,n.z)):h.setTranslationFromFloats(n.x,n.y,n.z);else{let y=null;H&&(y=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const i=k._TmpMats[0],B=k._TmpVecs[0];this.parent?H&&y?(i.B(this.parent.getAbsoluteMatrix()),i.multiplyToRef(y,i)):i.B(this.parent.getAbsoluteMatrix()):o.Matrix.IdentityToRef(i),G&&i.setTranslationFromFloats(0,0,0),i.invert(),o.zy.TransformCoordinatesToRef(n,i,B),G?(h.addAtIndex(12,B.x),h.addAtIndex(13,B.y),h.addAtIndex(14,B.z)):h.setTranslationFromFloats(B.x,B.y,B.z)}this._markAsDirtyAndDecompose()}translate(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(n,y,H,!0)}setPosition(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this._updatePosition(n,y,H,!1)}setAbsolutePosition(n,y){this.setPosition(n,1,y)}scale(n,y,H){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const h=this.getLocalMatrix(),i=k._TmpMats[0];o.Matrix.ScalingToRef(n,y,H,i),i.multiplyToRef(h,h),i.invert();for(const o of this.children){const G=o.getLocalMatrix();G.multiplyToRef(i,G),G.multiplyAtIndex(12,n),G.multiplyAtIndex(13,y),G.multiplyAtIndex(14,H),o._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),G)for(const o of this.children)o.scale(n,y,H,G)}setScale(n){this._decompose(),this._localScaling.B(n),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(n){this._decompose(),n.B(this._localScaling)}setYawPitchRoll(n,y,H){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4?arguments[4]:void 0;if(0===G){const i=k._TmpQuat;return o.Quaternion.RotationYawPitchRollToRef(n,y,H,i),void this.setRotationQuaternion(i,G,h)}const i=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(i,h))return;const B=k._TmpMats[1];o.Matrix.RotationYawPitchRollToRef(n,y,H,B),i.multiplyToRef(B,B),this._rotateWithMatrix(B,G,h)}rotate(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,G=arguments.length>3?arguments[3]:void 0;const h=k._TmpMats[0];h.setTranslationFromFloats(0,0,0),o.Matrix.RotationAxisToRef(n,y,h),this._rotateWithMatrix(h,H,G)}setAxisAngle(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,G=arguments.length>3?arguments[3]:void 0;if(0===H){const h=k._TmpQuat;return o.Quaternion.RotationAxisToRef(n,y,h),void this.setRotationQuaternion(h,H,G)}const h=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,G))return;const i=k._TmpMats[1];o.Matrix.RotationAxisToRef(n,y,i),h.multiplyToRef(i,i),this._rotateWithMatrix(i,H,G)}setRotation(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(n.y,n.x,n.z,y,H)}setRotationQuaternion(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===y)return this._decompose(),this._localRotation.B(n),void this._markAsDirtyAndCompose();const G=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,H))return;const h=k._TmpMats[1];o.Matrix.FromQuaternionToRef(n,h),G.multiplyToRef(h,h),this._rotateWithMatrix(h,y,H)}setRotationMatrix(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;if(0===y){const G=k._TmpQuat;return o.Quaternion.FromRotationMatrixToRef(n,G),void this.setRotationQuaternion(G,y,H)}const G=k._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(G,H))return;const h=k._TmpMats[1];h.B(n),G.multiplyToRef(n,h),this._rotateWithMatrix(h,y,H)}_rotateWithMatrix(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const o=this.getLocalMatrix(),G=o.m[12],h=o.m[13],i=o.m[14],B=this.getParent(),V=k._TmpMats[3],q=k._TmpMats[4];B&&1==y?(H?(V.B(H.getWorldMatrix()),B.getAbsoluteMatrix().multiplyToRef(V,V)):V.B(B.getAbsoluteMatrix()),q.B(V),q.invert(),o.multiplyToRef(V,o),o.multiplyToRef(n,o),o.multiplyToRef(q,o)):1==y&&H?(V.B(H.getWorldMatrix()),q.B(V),q.invert(),o.multiplyToRef(V,o),o.multiplyToRef(n,o),o.multiplyToRef(q,o)):o.multiplyToRef(n,o),o.setTranslationFromFloats(G,h,i),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(n,y){const H=k._TmpMats[2];return n.B(this.getAbsoluteMatrix()),y?(n.multiplyToRef(y.getWorldMatrix(),n),o.Matrix.ScalingToRef(y.fi.x,y.fi.y,y.fi.z,H)):o.Matrix.IdentityToRef(H),n.invert(),!isNaN(n.m[0])&&(H.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyToRef(H,n),!0)}Gh(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=o.zy.Zero();return this.getPositionToRef(n,y,H),H}getPositionToRef(){let n=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const n=this.getLocalMatrix();y.x=n.m[12],y.y=n.m[13],y.z=n.m[14]}else{let H=null;n&&(H=n.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let o=k._TmpMats[0];n&&H?(o.B(this.getAbsoluteMatrix()),o.multiplyToRef(H,o)):o=this.getAbsoluteMatrix(),y.x=o.m[12],y.y=o.m[13],y.z=o.m[14]}}getAbsolutePosition(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const y=o.zy.Zero();return this.getPositionToRef(1,n,y),y}getAbsolutePositionToRef(n,y){this.getPositionToRef(1,n,y)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.BU.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.B(this.BU);const n=this._skeleton.getPoseMatrix();n&&this._absoluteMatrix.multiplyToRef(n,this._absoluteMatrix)}const n=this.children,y=n.length;for(let H=0;H<y;H++)n[H].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}fB(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=o.zy.Zero();return this.getDirectionToRef(n,y,H),H}getDirectionToRef(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,G=null;y&&(G=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=k._TmpMats[0];h.B(this.getAbsoluteMatrix()),y&&G&&h.multiplyToRef(G,h),o.zy.TransformNormalToRef(n,h,H),H.normalize()}getRotation(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=o.zy.Zero();return this.getRotationToRef(n,y,H),H}getRotationToRef(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;const o=k._TmpQuat;this.getRotationQuaternionToRef(n,y,o),o.toEulerAnglesToRef(H)}getRotationQuaternion(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=o.Quaternion.Identity();return this.getRotationQuaternionToRef(n,y,H),H}getRotationQuaternionToRef(){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),y.B(this._localRotation);else{const H=k._TmpMats[0],o=this.getAbsoluteMatrix();n?o.multiplyToRef(n.getWorldMatrix(),H):H.B(o),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.decompose(void 0,y,void 0)}}getRotationMatrix(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1?arguments[1]:void 0;const H=o.Matrix.Identity();return this.getRotationMatrixToRef(n,y,H),H}getRotationMatrixToRef(){let n=arguments.length>1?arguments[1]:void 0,y=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(y);else{const H=k._TmpMats[0],o=this.getAbsoluteMatrix();n?o.multiplyToRef(n.getWorldMatrix(),H):H.B(o),H.multiplyAtIndex(0,this._scalingDeterminant),H.multiplyAtIndex(1,this._scalingDeterminant),H.multiplyAtIndex(2,this._scalingDeterminant),H.getRotationMatrixToRef(y)}}getAbsolutePositionFromLocal(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=o.zy.Zero();return this.getAbsolutePositionFromLocalToRef(n,y,H),H}getAbsolutePositionFromLocalToRef(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,G=null;y&&(G=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=k._TmpMats[0];h.B(this.getAbsoluteMatrix()),y&&G&&h.multiplyToRef(G,h),o.zy.TransformCoordinatesToRef(n,h,H)}getLocalPositionFromAbsolute(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=o.zy.Zero();return this.getLocalPositionFromAbsoluteToRef(n,y,H),H}getLocalPositionFromAbsoluteToRef(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0,G=null;y&&(G=y.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=k._TmpMats[0];h.B(this.getAbsoluteMatrix()),y&&G&&h.multiplyToRef(G,h),h.invert(),o.zy.TransformCoordinatesToRef(n,h,H)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const n=this._skeleton.bones.indexOf(this);if(-1!==n&&this._skeleton.bones.splice(n,1),this._parentNode&&this._parentNode.children){const n=this._parentNode.children,y=n.indexOf(this);-1!==y&&n.splice(y,1)}super.dispose()}}k._TmpVecs=(0,G.c)(2,o.zy.Zero),k._TmpQuat=o.Quaternion.Identity(),k._TmpMats=(0,G.c)(5,o.Matrix.Identity)},13566:(n,y,H)=>{"use strict";H.d(y,{c:()=>w});var o=H(11278),G=H(11280),h=H(11099),k=H(11288),i=H(11303),B=H(11775),V=H(11800),q=H(11601),b=H(11125),A=H(11297);class U{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(n){this._zoomStopsAnimation=n}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(n){this._idleRotationSpeed=n}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(n){this._idleRotationWaitTime=n}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(n){this._idleRotationSpinupTime=n}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(n){this._attachedCamera=n;const y=this._attachedCamera.pn();this._onPrePointerObservableObserver=y.onPrePointerObservable.add((n=>{n.type!==q.b.POINTERDOWN?n.type===q.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=n.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const n=b.d.Now;let y=0;null!=this._lastFrameTime&&(y=n-this._lastFrameTime),this._lastFrameTime=n,this._applyUserInteraction();const H=n-this._lastInteractionTime-this._idleRotationWaitTime,o=Math.max(Math.min(H/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*o,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(y/1e3))}))}detach(){if(!this._attachedCamera)return;const n=this._attachedCamera.pn();this._onPrePointerObservableObserver&&n.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(n){this._lastInteractionTime=n??b.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<A.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let n=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(n=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?n:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=b.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var T=H(13569),W=H(11885);class z{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(n){if(this._autoTransitionRange===n)return;this._autoTransitionRange=n;const y=this._attachedCamera;y&&(n?this._onMeshTargetChangedObserver=y.onMeshTargetChangedObservable.add((n=>{if(n&&(n.Qi(!0),n.getBoundingInfo)){const y=n.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*y,this.upperRadiusTransitionRange=.05*y}})):this._onMeshTargetChangedObserver&&y.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(n){this._attachedCamera=n,this._onAfterCheckInputsObserver=n.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(n){return!!this._attachedCamera&&(this._attachedCamera.radius===n&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(n){if(!this._attachedCamera)return;this._radiusBounceTransition||(z.EasingFunction.setEasingMode(z.EasingMode),this._radiusBounceTransition=W.e.CreateAnimation("radius",W.e.ANIMATIONTYPE_FLOAT,60,z.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const y=W.e.TransitionTo("radius",this._attachedCamera.radius+n,this._attachedCamera,this._attachedCamera.pn(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));y&&this._animatables.push(y)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}z.EasingFunction=new T.c(.3),z.EasingMode=T.n.EASINGMODE_EASEOUT;class Q{constructor(){this.onTargetFramingAnimationEndObservable=new h.c,this._mode=Q.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(n){this._mode=n}get mode(){return this._mode}set radiusScale(n){this._radiusScale=n}get radiusScale(){return this._radiusScale}set positionScale(n){this._positionScale=n}get positionScale(){return this._positionScale}set defaultElevation(n){this._defaultElevation=n}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(n){this._elevationReturnTime=n}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(n){this._elevationReturnWaitTime=n}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(n){this._zoomStopsAnimation=n}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(n){this._framingTime=n}get framingTime(){return this._framingTime}init(){}attach(n){this._attachedCamera=n;const y=this._attachedCamera.pn();Q.EasingFunction.setEasingMode(Q.EasingMode),this._onPrePointerObservableObserver=y.onPrePointerObservable.add((n=>{n.type!==q.b.POINTERDOWN?n.type===q.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=n.onMeshTargetChangedObservable.add((n=>{n&&n.getBoundingInfo&&this.zoomOnMesh(n,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=n.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const n=this._attachedCamera.pn();this._onPrePointerObservableObserver&&n.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n.Qi(!0);const o=n.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(o.minimumWorld,o.maximumWorld,y,H)}zoomOnMeshHierarchy(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n.Qi(!0);const o=n.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(o.min,o.max,y,H)}zoomOnMeshesHierarchy(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new k.zy(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),G=new k.zy(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let h=0;h<n.length;h++){const y=n[h].getHierarchyBoundingVectors(!0);k.zy.CheckExtends(y.min,o,G),k.zy.CheckExtends(y.max,o,G)}this.zoomOnBoundingInfo(o,G,y,H)}zoomOnBoundingInfo(n,y){let H,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const h=n.y,i=h+(y.y-h)*this._positionScale,B=y.Qy(n).scale(.5);if(!isFinite(i))return!1;if(o)H=new k.zy(0,i,0);else{const y=n.add(B);H=new k.zy(y.x,i,y.z)}this._vectorTransition||(this._vectorTransition=W.e.CreateAnimation("target",W.e.ANIMATIONTYPE_VECTOR3,60,Q.EasingFunction)),this._betaIsAnimating=!0;let V=W.e.TransitionTo("target",H,this._attachedCamera,this._attachedCamera.pn(),60,this._vectorTransition,this._framingTime);V&&this._animatables.push(V);let q=0;if(this._mode===Q.FitFrustumSidesMode){const H=this._calculateLowerRadiusFromModelBoundingSphere(n,y);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=B.length()+this._attachedCamera.Wi),q=H}else this._mode===Q.IgnoreBoundsSizeMode&&(q=this._calculateLowerRadiusFromModelBoundingSphere(n,y),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Wi));if(this.autoCorrectCameraLimitsAndSensibility){const H=y.Qy(n).length();this._attachedCamera.panningSensibility=5e3/H,this._attachedCamera.wheelPrecision=100/q}return this._radiusTransition||(this._radiusTransition=W.e.CreateAnimation("radius",W.e.ANIMATIONTYPE_FLOAT,60,Q.EasingFunction)),V=W.e.TransitionTo("radius",q,this._attachedCamera,this._attachedCamera.pn(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),G&&G(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),V&&this._animatables.push(V),!0}_calculateLowerRadiusFromModelBoundingSphere(n,y){const H=this._attachedCamera;if(!H)return 0;let o=H._calculateLowerRadiusFromModelBoundingSphere(n,y,this._radiusScale);return H.lowerRadiusLimit&&this._mode===Q.IgnoreBoundsSizeMode&&(o=o<H.lowerRadiusLimit?H.lowerRadiusLimit:o),H.upperRadiusLimit&&(o=o>H.upperRadiusLimit?H.upperRadiusLimit:o),o}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const n=b.d.Now-this._lastInteractionTime,y=.5*Math.PI-this._defaultElevation,H=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>H&&n>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=W.e.CreateAnimation("beta",W.e.ANIMATIONTYPE_FLOAT,60,Q.EasingFunction));const n=W.e.TransitionTo("beta",y,this._attachedCamera,this._attachedCamera.pn(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));n&&this._animatables.push(n)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=b.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}Q.EasingFunction=new T.t,Q.EasingMode=T.n.EASINGMODE_EASEINOUT,Q.IgnoreBoundsSizeMode=0,Q.FitFrustumSidesMode=1;var l=H(11806),v=H(11844),F=H(13032),g=H(11094);class M{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(n){n=g.Tools.BackCompatCameraNoPreventDefault(arguments);const y=this.camera.getEngine(),H=y.getInputElement();let o=0,G=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=h=>{var k,i;const B=h.event,V="touch"===B.pointerType;if(h.type!==q.b.POINTERMOVE&&-1===this.buttons.indexOf(B.button))return;const b=B.target;if(this._altKey=B.altKey,this._ctrlKey=B.ctrlKey,this._metaKey=B.metaKey,this._shiftKey=B.shiftKey,this._buttonsPressed=B.buttons,y.isPointerLock){const n=B.movementX,y=B.movementY;this.onTouch(null,n,y),this._pointA=null,this._pointB=null}else{if(h.type!==q.b.POINTERDOWN&&h.type!==q.b.POINTERDOUBLETAP&&V&&(null===(k=this._pointA)||void 0===k?void 0:k.pointerId)!==B.pointerId&&(null===(i=this._pointB)||void 0===i?void 0:i.pointerId)!==B.pointerId)return;if(h.type!==q.b.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!V)if(h.type===q.b.POINTERDOUBLETAP)this.onDoubleTap(B.pointerType);else if(h.type!==q.b.POINTERUP||this._currentMousePointerIdDown!==B.pointerId&&!V){if(h.type===q.b.POINTERMOVE)if(n||B.preventDefault(),this._pointA&&null===this._pointB){const n=B.clientX-this._pointA.x,y=B.clientY-this._pointA.y;this._pointA.x=B.clientX,this._pointA.y=B.clientY,this.onTouch(this._pointA,n,y)}else if(this._pointA&&this._pointB){const n=this._pointA.pointerId===B.pointerId?this._pointA:this._pointB;n.x=B.clientX,n.y=B.clientY;const y=this._pointA.x-this._pointB.x,H=this._pointA.y-this._pointB.y,k=y*y+H*H,i={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:B.pointerId,type:h.type};this.onMultiTouch(this._pointA,this._pointB,o,k,G,i),G=i,o=k}}else{try{null===b||void 0===b||b.releasePointerCapture(B.pointerId)}catch(A){}V||(this._pointB=null),y._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==B.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==B.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==o||G)&&(this.onMultiTouch(this._pointA,this._pointB,o,0,G,null),o=0,G=null),this._currentMousePointerIdDown=-1,this.onButtonUp(B),n||B.preventDefault()}else{try{null===b||void 0===b||b.setPointerCapture(B.pointerId)}catch(A){}if(null===this._pointA)this._pointA={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType};else{if(null!==this._pointB)return;this._pointB={x:B.clientX,y:B.clientY,pointerId:B.pointerId,type:B.pointerType}}-1!==this._currentMousePointerIdDown||V||(this._currentMousePointerIdDown=B.pointerId),this.onButtonDown(B),n||(B.preventDefault(),H&&H.focus())}}},this._observer=this.camera.pn()._inputManager._addCameraPointerObserver(this._pointerInput,q.b.POINTERDOWN|q.b.POINTERUP|q.b.POINTERMOVE|q.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,o=0,G=null,this.onLostFocus()},this._contextMenuBind=n=>this.onContextMenu(n),H&&H.addEventListener("contextmenu",this._contextMenuBind,!1);const h=this.camera.pn().getEngine().getHostWindow();h&&g.Tools.RegisterTopRootEvents(h,[{name:"blur",handler:this._onLostFocus}])}vA(){if(this._onLostFocus){const n=this.camera.pn().getEngine().getHostWindow();n&&g.Tools.UnregisterTopRootEvents(n,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.pn()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const n=this.camera.pn().getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(n){}onTouch(n,y,H){}onMultiTouch(n,y,H,o,G,h){}onContextMenu(n){n.preventDefault()}onButtonDown(n){}onButtonUp(n){}onLostFocus(){}}(0,o.e)([(0,G.J)()],M.prototype,"buttons",void 0);class f extends M{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(n,y){if(0!==this.panningSensibility&&n&&y){const H=y.x-n.x,o=y.y-n.y;this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=o/this.panningSensibility}}_computePinchZoom(n,y){const H=this.camera.radius||f.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=H*Math.sqrt(n)/Math.sqrt(y):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(y-n)*H*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(y-n)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(n,y,H){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-y/this.panningSensibility,this.camera.inertialPanningY+=H/this.panningSensibility):(this.camera.inertialAlphaOffset-=y/this.angularSensibilityX,this.camera.inertialBetaOffset-=H/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(n,y,H,o,G,h){0===H&&null===G||0===o&&null===h||(this.multiTouchPanAndZoom?(this._computePinchZoom(H,o),this._computeMultiTouchPanning(G,h)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(o)-Math.sqrt(H))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(H,o),this._isPinching=!0):this._computeMultiTouchPanning(G,h)):this.multiTouchPanning?this._computeMultiTouchPanning(G,h):this.pinchZoom&&this._computePinchZoom(H,o))}onButtonDown(n){this._isPanClick=n.button===this.camera._panningMouseButton}onButtonUp(n){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}f.MinimumRadiusForPinch=.001,(0,o.e)([(0,G.J)()],f.prototype,"buttons",void 0),(0,o.e)([(0,G.J)()],f.prototype,"angularSensibilityX",void 0),(0,o.e)([(0,G.J)()],f.prototype,"angularSensibilityY",void 0),(0,o.e)([(0,G.J)()],f.prototype,"pinchPrecision",void 0),(0,o.e)([(0,G.J)()],f.prototype,"pinchDeltaPercentage",void 0),(0,o.e)([(0,G.J)()],f.prototype,"useNaturalPinchZoom",void 0),(0,o.e)([(0,G.J)()],f.prototype,"pinchZoom",void 0),(0,o.e)([(0,G.J)()],f.prototype,"panningSensibility",void 0),(0,o.e)([(0,G.J)()],f.prototype,"multiTouchPanning",void 0),(0,o.e)([(0,G.J)()],f.prototype,"multiTouchPanAndZoom",void 0),F.e.ArcRotateCameraPointersInput=f;var c=H(11605);class p{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(n){n=g.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.pn(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((y=>{const H=y.event;if(!H.metaKey)if(y.type===c.e.KEYDOWN){if(this._ctrlPressed=H.ctrlKey,this._altPressed=H.altKey,-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),H.preventDefault&&(n||H.preventDefault())}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysReset.indexOf(H.keyCode)){const y=this._keys.indexOf(H.keyCode);y>=0&&this._keys.splice(y,1),H.preventDefault&&(n||H.preventDefault())}})))}vA(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const n=this.camera;for(let y=0;y<this._keys.length;y++){const H=this._keys[y];-1!==this.keysLeft.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningX-=1/this.panningSensibility:n.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?n.inertialRadiusOffset+=1/this.zoomingSensibility:n.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningX+=1/this.panningSensibility:n.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(H)?this._ctrlPressed&&this.camera._useCtrlForPanning?n.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?n.inertialRadiusOffset-=1/this.zoomingSensibility:n.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(H)&&n.useInputToRestoreState&&n.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,o.e)([(0,G.J)()],p.prototype,"keysUp",void 0),(0,o.e)([(0,G.J)()],p.prototype,"keysDown",void 0),(0,o.e)([(0,G.J)()],p.prototype,"keysLeft",void 0),(0,o.e)([(0,G.J)()],p.prototype,"keysRight",void 0),(0,o.e)([(0,G.J)()],p.prototype,"keysReset",void 0),(0,o.e)([(0,G.J)()],p.prototype,"panningSensibility",void 0),(0,o.e)([(0,G.J)()],p.prototype,"zoomingSensibility",void 0),(0,o.e)([(0,G.J)()],p.prototype,"useAltToZoom",void 0),(0,o.e)([(0,G.J)()],p.prototype,"angularSpeed",void 0),F.e.ArcRotateCameraKeyboardMoveInput=p;var E=H(11342),X=H(11614);class d{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new k.zy(0,0,0),this._globalOffset=new k.zy(0,0,0),this._inertialPanning=k.zy.Zero()}_computeDeltaFromMouseWheelLegacyEvent(n,y){let H=0;const o=.01*n*this.wheelDeltaPercentage*y;return H=n>0?o/(1+this.wheelDeltaPercentage):o*(1+this.wheelDeltaPercentage),H}attachControl(n){n=g.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=y=>{if(y.type!==q.b.POINTERWHEEL)return;const H=y.event;let o=0;const G=H.deltaMode===X.c.DOM_DELTA_LINE?40:1,h=-H.deltaY*G;if(this.customComputeDeltaFromMouseWheel)o=this.customComputeDeltaFromMouseWheel(h,this,H);else if(this.wheelDeltaPercentage){if(o=this._computeDeltaFromMouseWheelLegacyEvent(h,this.camera.radius),o>0){let n=this.camera.radius,y=this.camera.inertialRadiusOffset+o;for(let H=0;H<20&&!(n<=y)&&!(Math.abs(y*this.camera.inertia)<.001);H++)n-=y,y*=this.camera.inertia;n=(0,i.Clamp)(n,0,Number.MAX_VALUE),o=this._computeDeltaFromMouseWheelLegacyEvent(h,n)}}else o=h/(40*this.wheelPrecision);o&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(o)):this.camera.inertialRadiusOffset+=o),H.preventDefault&&(n||H.preventDefault())},this._observer=this.camera.pn()._inputManager._addCameraPointerObserver(this._wheel,q.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.ci(0)}vA(){this._observer&&(this.camera.pn()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const n=this.camera;0+n.inertialAlphaOffset+n.inertialBetaOffset+n.inertialRadiusOffset&&(this._updateHitPlane(),n.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(n.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const n=this.camera,y=n.target.Qy(n.position);this._hitPlane=E.b.FromPositionAndNormal(n.target,y)}_getPosition(){const n=this.camera,y=n.pn(),H=y.createPickingRay(y.pointerX,y.pointerY,k.Matrix.Identity(),n,!1);0===n.targetScreenOffset.x&&0===n.targetScreenOffset.y||(this._viewOffset.set(n.targetScreenOffset.x,n.targetScreenOffset.y,0),n.getViewMatrix().invertToRef(n._cameraTransformMatrix),this._globalOffset=k.zy.TransformNormal(this._viewOffset,n._cameraTransformMatrix),H.origin.addInPlace(this._globalOffset));let o=0;return this._hitPlane&&(o=H.intersectsPlane(this._hitPlane)??0),H.origin.addInPlace(H.direction.scaleInPlace(o))}_zoomToMouse(n){const y=this.camera,H=1-y.inertia;if(y.lowerRadiusLimit){const o=y.lowerRadiusLimit??0;y.radius-(y.inertialRadiusOffset+n)/H<o&&(n=(y.radius-o)*H-y.inertialRadiusOffset)}if(y.upperRadiusLimit){const o=y.upperRadiusLimit??0;y.radius-(y.inertialRadiusOffset+n)/H>o&&(n=(y.radius-o)*H-y.inertialRadiusOffset)}const o=n/H/y.radius,G=this._getPosition(),h=k.TmpVectors.zy[6];G.subtractToRef(y.target,h),h.scaleInPlace(o),h.scaleInPlace(H),this._inertialPanning.addInPlace(h),y.inertialRadiusOffset+=n}_zeroIfClose(n){Math.abs(n.x)<A.e&&(n.x=0),Math.abs(n.y)<A.e&&(n.y=0),Math.abs(n.z)<A.e&&(n.z=0)}}(0,o.e)([(0,G.J)()],d.prototype,"wheelPrecision",void 0),(0,o.e)([(0,G.J)()],d.prototype,"zoomToMouseLocation",void 0),(0,o.e)([(0,G.J)()],d.prototype,"wheelDeltaPercentage",void 0),F.e.ArcRotateCameraMouseWheelInput=d;class a extends F.i{constructor(n){super(n)}addMouseWheel(){return this.add(new d),this}addPointers(){return this.add(new f),this}addKeyboard(){return this.add(new p),this}}var O=H(11248);function e(n,y){return isNaN(n)?y:n}B.c.AddNodeConstructor("ArcRotateCamera",((n,y)=>()=>new w(n,0,0,1,k.zy.Zero(),y)));class w extends v.d{get target(){return this._target}set target(n){this.setTarget(n)}get targetHost(){return this._targetHost}set targetHost(n){n&&this.setTarget(n)}getTarget(){return this.target}get position(){return this._position}set position(n){this.setPosition(n)}set upVector(n){this._upToYMatrix||(this._yToUpMatrix=new k.Matrix,this._upToYMatrix=new k.Matrix,this._upVector=k.zy.Zero()),n.normalize(),this._upVector.B(n),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){k.Matrix.RotationAlignToRef(k.zy.UpReadOnly,this._upVector,this._yToUpMatrix),k.Matrix.RotationAlignToRef(this._upVector,k.zy.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const n=this.inputs.attached.pointers;return n?n.angularSensibilityX:0}set angularSensibilityX(n){const y=this.inputs.attached.pointers;y&&(y.angularSensibilityX=n)}get angularSensibilityY(){const n=this.inputs.attached.pointers;return n?n.angularSensibilityY:0}set angularSensibilityY(n){const y=this.inputs.attached.pointers;y&&(y.angularSensibilityY=n)}get pinchPrecision(){const n=this.inputs.attached.pointers;return n?n.pinchPrecision:0}set pinchPrecision(n){const y=this.inputs.attached.pointers;y&&(y.pinchPrecision=n)}get pinchDeltaPercentage(){const n=this.inputs.attached.pointers;return n?n.pinchDeltaPercentage:0}set pinchDeltaPercentage(n){const y=this.inputs.attached.pointers;y&&(y.pinchDeltaPercentage=n)}get useNaturalPinchZoom(){const n=this.inputs.attached.pointers;return!!n&&n.useNaturalPinchZoom}set useNaturalPinchZoom(n){const y=this.inputs.attached.pointers;y&&(y.useNaturalPinchZoom=n)}get panningSensibility(){const n=this.inputs.attached.pointers;return n?n.panningSensibility:0}set panningSensibility(n){const y=this.inputs.attached.pointers;y&&(y.panningSensibility=n)}get keysUp(){const n=this.inputs.attached.keyboard;return n?n.keysUp:[]}set keysUp(n){const y=this.inputs.attached.keyboard;y&&(y.keysUp=n)}get keysDown(){const n=this.inputs.attached.keyboard;return n?n.keysDown:[]}set keysDown(n){const y=this.inputs.attached.keyboard;y&&(y.keysDown=n)}get keysLeft(){const n=this.inputs.attached.keyboard;return n?n.keysLeft:[]}set keysLeft(n){const y=this.inputs.attached.keyboard;y&&(y.keysLeft=n)}get keysRight(){const n=this.inputs.attached.keyboard;return n?n.keysRight:[]}set keysRight(n){const y=this.inputs.attached.keyboard;y&&(y.keysRight=n)}get wheelPrecision(){const n=this.inputs.attached.mousewheel;return n?n.wheelPrecision:0}set wheelPrecision(n){const y=this.inputs.attached.mousewheel;y&&(y.wheelPrecision=n)}get zoomToMouseLocation(){const n=this.inputs.attached.mousewheel;return!!n&&n.zoomToMouseLocation}set zoomToMouseLocation(n){const y=this.inputs.attached.mousewheel;y&&(y.zoomToMouseLocation=n)}get wheelDeltaPercentage(){const n=this.inputs.attached.mousewheel;return n?n.wheelDeltaPercentage:0}set wheelDeltaPercentage(n){const y=this.inputs.attached.mousewheel;y&&(y.wheelDeltaPercentage=n)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(n){n!==this.useBouncingBehavior&&(n?(this._bouncingBehavior=new z,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(n){n!==this.useFramingBehavior&&(n?(this._framingBehavior=new Q,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(n){n!==this.useAutoRotationBehavior&&(n?(this._autoRotationBehavior=new U,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(n,y,H,o,G,i){var B;let V=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(n,k.zy.Zero(),i,V),B=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=k.zy.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=k.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new k.Matrix,this.panningAxis=new k.zy(1,1,0),this._transformedDirection=new k.zy,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new h.c,this.checkCollisions=!1,this.collisionRadius=new k.zy(.5,.5,.5),this._previousPosition=k.zy.Zero(),this._collisionVelocity=k.zy.Zero(),this._newPosition=k.zy.Zero(),this._computationVector=k.zy.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new k.zy(NaN,NaN,NaN),this._goalTargetScreenOffset=new k.Vector2(NaN,NaN),this._onCollisionPositionChange=function(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;H?(B.setPosition(y),B.yT&&B.yT(H)):B._previousPosition.B(B._position);const o=Math.cos(B.alpha),G=Math.sin(B.alpha),h=Math.cos(B.beta);let k=Math.sin(B.beta);0===k&&(k=1e-4);const i=B._getTargetPosition();B._computationVector.Mi(B.radius*o*k,B.radius*h,B.radius*G*k),i.addToRef(B._computationVector,B._newPosition),B._position.B(B._newPosition);let V=B.upVector;B.allowUpsideDown&&B.beta<0&&(V=V.clone(),V=V.negate()),B._computeViewMatrix(B._position,i,V),B._viewMatrix.addAtIndex(12,B.targetScreenOffset.x),B._viewMatrix.addAtIndex(13,B.targetScreenOffset.y),B._collisionTriggered=!1},this._target=k.zy.Zero(),G&&this.setTarget(G),this.alpha=y,this.beta=H,this.radius=o,this.getViewMatrix(),this.inputs=new a(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new k.zy(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=k.Vector2.Zero()}_updateCache(n){n||super._updateCache(),this._cache._target.B(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.B(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const n=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?n.addToRef(this._targetBoundingCenter,this._target):this._target.B(n)}const n=this._getLockedTargetPosition();return n||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>A.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,h=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=h?this._currentInterpolationFactor=h:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=e(n,this._goalAlpha),this._goalBeta=e(y,this._goalBeta),this._goalRadius=e(H,this._goalRadius),this._goalTarget.set(e(o.x,this._goalTarget.x),e(o.y,this._goalTarget.y),e(o.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(e(G.x,this._goalTargetScreenOffset.x),e(G.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,i.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,i.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,i.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,i.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(n,y){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const G=arguments;y=g.Tools.BackCompatCameraNoPreventDefault(G),this._useCtrlForPanning=H,this._panningMouseButton=o,"boolean"===typeof G[0]&&(G.length>1&&(this._useCtrlForPanning=G[1]),G.length>2&&(this._panningMouseButton=G[2])),this.inputs.attachElement(y),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}vA(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let n=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){n=!0;const y=this.invertRotation?-1:1,H=this._calculateHandednessMultiplier();let o=this.inertialAlphaOffset*H;this.beta<0&&(o*=-1),this.alpha+=o*y,this.beta+=this.inertialBetaOffset*y,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<A.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<A.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*A.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){n=!0;const y=new k.zy(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),y.multiplyInPlace(this.panningAxis),k.zy.TransformNormalToRef(y,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const n=this.upVector,y=k.zy.CrossToRef(this._transformedDirection,n,this._transformedDirection);k.zy.CrossToRef(n,y,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);k.zy.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.B(this._transformedDirection)}else{if(this.parent){const n=k.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(n),n.transposeToRef(n),k.zy.TransformCoordinatesToRef(this._transformedDirection,n,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*A.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*A.e&&(this.inertialPanningY=0)}if(n)this.stopInterpolation();else if(this._isInterpolating){let n=!1;const y=this._scene.getEngine().getDeltaTime()/1e3,H=1-Math.pow(2,-y/this._currentInterpolationFactor),o=e(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const y=k.TmpVectors.zy[0].set(e(this._goalTarget.x,this._target.x),e(this._goalTarget.y,this._target.y),e(this._goalTarget.z,this._target.z));k.zy.LerpToRef(this.target,y,H,this._target),10*k.zy.Distance(this.target,y)/o<A.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.B(y),this.setTarget(this.target,!1,!0,!0)):n=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const y=k.Quaternion.RotationAlphaBetaGammaToRef(e(this._goalAlpha,this.alpha),e(this._goalBeta,this.beta),0,k.TmpVectors.Quaternion[0]),o=k.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,k.TmpVectors.Quaternion[1]),G=k.Quaternion.SlerpToRef(o,y,H,k.TmpVectors.Quaternion[2]);G.normalize();const h=G.toAlphaBetaGammaToRef(k.TmpVectors.zy[0]);if(this.alpha=h.x,this.beta=h.y,G.isApprox(y,A.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const n=y.toAlphaBetaGammaToRef(k.TmpVectors.zy[0]);this.alpha=n.x,this.beta=n.y}else n=!0}if(isNaN(this._goalRadius)||(this.radius+=(o-this.radius)*H,Math.abs(o/this.radius-1)<A.e?(this._goalRadius=NaN,this.radius=o):n=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const y=k.TmpVectors.Vector2[0].set(e(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),e(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));k.Vector2.LerpToRef(this.targetScreenOffset,y,H,this.targetScreenOffset),k.Vector2.Distance(this.targetScreenOffset,y)<A.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.B(y)):n=!0}this._isInterpolating=n}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||k.zy.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const n=this.alpha;var y,H;this.alpha=function(n){let y=Math.PI/2;return 0===n.x&&0===n.z||(y=Math.acos(n.x/Math.sqrt(Math.pow(n.x,2)+Math.pow(n.z,2)))),n.z<0&&(y=2*Math.PI-y),y}(this._computationVector),this.beta=(y=this._computationVector.y,H=this.radius,Math.acos(y/H));const o=Math.round((n-this.alpha)/(2*Math.PI));this.alpha+=2*o*Math.PI,this._checkLimits()}setPosition(n){this._position.equals(n)||(this._position.B(n),this.rebuildAnglesAndRadius())}setTarget(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(o=this.overrideCloneAlphaBetaRadius??o,n.Qi)y&&n.getBoundingInfo?this._targetBoundingCenter=n.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,n.Qi(),this._targetHost=n,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const y=n,o=this._getTargetPosition();if(o&&!H&&o.equals(y))return;this._targetHost=null,this._target=y,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}o||this.rebuildAnglesAndRadius()}_getViewMatrix(){const n=Math.cos(this.alpha),y=Math.sin(this.alpha),H=Math.cos(this.beta);let o=Math.sin(this.beta);0===o&&(o=1e-4),0===this.radius&&(this.radius=1e-4);const G=this._getTargetPosition();if(this._computationVector.Mi(this.radius*n*o,this.radius*H,this.radius*y*o),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||k.zy.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),G.addToRef(this._computationVector,this._newPosition),this.pn().collisionsEnabled&&this.checkCollisions){const n=this.pn().collisionCoordinator;this._collider||(this._collider=n.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,n.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.B(this._newPosition);let n=this.upVector;this.allowUpsideDown&&o<0&&(n=n.negate()),this._computeViewMatrix(this._position,G,n),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.B(G),this._viewMatrix}zoomOn(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n=n||this.pn().meshes;const H=V.b.MinMax(n);let o=this._calculateLowerRadiusFromModelBoundingSphere(H.min,H.max);if(o=Math.max(Math.min(o,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=o*this.zoomOnFactor,this.mode===l.d.ORTHOGRAPHIC_CAMERA){const n=this.pn().getEngine().getAspectRatio(this),y=o*this.zoomOnFactor/2;this.orthoLeft=-y*n,this.orthoRight=y*n,this.orthoBottom=-y,this.orthoTop=y}this.focusOn({min:H.min,max:H.max,distance:o},y)}focusOn(n){let y,H,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===n.min){const o=n||this.pn().meshes;y=V.b.MinMax(o),H=k.zy.Distance(y.min,y.max)}else{y=n,H=n.distance}this._target=V.b.Center(y),o||(this.maxZ=2*H)}createRigCamera(n,y){let H=0;switch(this.cameraRigMode){case l.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case l.d.RIG_MODE_VR:H=this._cameraRigParams.stereoHalfAngle*(0===y?1:-1);break;case l.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:H=this._cameraRigParams.stereoHalfAngle*(0===y?-1:1)}const o=new w(n,this.alpha+H,this.beta,this.radius,this._target,this.pn());return o._cameraRigParams={},o.isRigCamera=!0,o.rigParent=this,o.upVector=this.upVector,o.mode=this.mode,o.orthoLeft=this.orthoLeft,o.orthoRight=this.orthoRight,o.orthoBottom=this.orthoBottom,o.orthoTop=this.orthoTop,o}_updateRigCameras(){const n=this._rigCameras[0],y=this._rigCameras[1];switch(n.beta=y.beta=this.beta,this.cameraRigMode){case l.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case l.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case l.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case l.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case l.d.RIG_MODE_VR:n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case l.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const o=k.zy.Distance(n,y),G=this.pn().getEngine().getAspectRatio(this),h=Math.tan(this.fov/2),i=h*G,B=.5*o*H,V=B*Math.sqrt(1+1/(i*i)),q=B*Math.sqrt(1+1/(h*h));return Math.max(V,q)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,o.e)([(0,G.J)()],w.prototype,"alpha",void 0),(0,o.e)([(0,G.J)()],w.prototype,"beta",void 0),(0,o.e)([(0,G.J)()],w.prototype,"radius",void 0),(0,o.e)([(0,G.J)()],w.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,o.e)([(0,G.F)("target")],w.prototype,"_target",void 0),(0,o.e)([(0,G.w)("targetHost")],w.prototype,"_targetHost",void 0),(0,o.e)([(0,G.J)()],w.prototype,"inertialAlphaOffset",void 0),(0,o.e)([(0,G.J)()],w.prototype,"inertialBetaOffset",void 0),(0,o.e)([(0,G.J)()],w.prototype,"inertialRadiusOffset",void 0),(0,o.e)([(0,G.J)()],w.prototype,"lowerAlphaLimit",void 0),(0,o.e)([(0,G.J)()],w.prototype,"upperAlphaLimit",void 0),(0,o.e)([(0,G.J)()],w.prototype,"lowerBetaLimit",void 0),(0,o.e)([(0,G.J)()],w.prototype,"upperBetaLimit",void 0),(0,o.e)([(0,G.J)()],w.prototype,"lowerRadiusLimit",void 0),(0,o.e)([(0,G.J)()],w.prototype,"upperRadiusLimit",void 0),(0,o.e)([(0,G.J)()],w.prototype,"lowerTargetYLimit",void 0),(0,o.e)([(0,G.J)()],w.prototype,"inertialPanningX",void 0),(0,o.e)([(0,G.J)()],w.prototype,"inertialPanningY",void 0),(0,o.e)([(0,G.J)()],w.prototype,"pinchToPanMaxDistance",void 0),(0,o.e)([(0,G.J)()],w.prototype,"panningDistanceLimit",void 0),(0,o.e)([(0,G.F)()],w.prototype,"panningOriginTarget",void 0),(0,o.e)([(0,G.J)()],w.prototype,"panningInertia",void 0),(0,o.e)([(0,G.J)()],w.prototype,"zoomToMouseLocation",null),(0,o.e)([(0,G.J)()],w.prototype,"zoomOnFactor",void 0),(0,o.e)([(0,G.E)()],w.prototype,"targetScreenOffset",void 0),(0,o.e)([(0,G.J)()],w.prototype,"allowUpsideDown",void 0),(0,o.e)([(0,G.J)()],w.prototype,"useInputToRestoreState",void 0),(0,o.e)([(0,G.J)()],w.prototype,"restoreStateInterpolationFactor",void 0),(0,O.h)("BABYLON.ArcRotateCamera",w)},13032:(n,y,H)=>{"use strict";H.d(y,{e:()=>k,i:()=>i});var o=H(11114),G=H(11325),h=H(11806),k={};class i{constructor(n){this.attachedToElement=!1,this.attached={},this.camera=n,this.checkInputs=()=>{}}add(n){const y=n.getSimpleName();this.attached[y]?o.d.Warn("camera input of type "+y+" already exists on camera"):(this.attached[y]=n,n.camera=this.camera,n.checkInputs&&(this.checkInputs=this._addCheckInputs(n.checkInputs.bind(n))),this.attachedToElement&&n.attachControl(this.noPreventDefault))}remove(n){for(const y in this.attached){const H=this.attached[y];if(H===n)return H.vA(),H.camera=null,delete this.attached[y],void this.rebuildInputCheck()}}removeByType(n){for(const y in this.attached){const H=this.attached[y];H.getClassName()===n&&(H.vA(),H.camera=null,delete this.attached[y],this.rebuildInputCheck())}}_addCheckInputs(n){const y=this.checkInputs;return()=>{y(),n()}}attachInput(n){this.attachedToElement&&n.attachControl(this.noPreventDefault)}attachElement(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){n=!h.d.ForceAttachControlToAlwaysPreventDefault&&n,this.attachedToElement=!0,this.noPreventDefault=n;for(const y in this.attached)this.attached[y].attachControl(n)}}detachElement(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const y in this.attached)this.attached[y].vA(),n&&(this.attached[y].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const n in this.attached){const y=this.attached[n];y.checkInputs&&(this.checkInputs=this._addCheckInputs(y.checkInputs.bind(y)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(n){const y={};for(const H in this.attached){const n=this.attached[H],o=G.c.Serialize(n);y[n.getClassName()]=o}n.inputsmgr=y}parse(n){const y=n.inputsmgr;if(y){this.clear();for(const n in y){const H=k[n];if(H){const o=y[n],h=G.c.Parse((()=>new H),o,null);this.add(h)}}}else for(const H in this.attached){const y=k[this.attached[H].getClassName()];if(y){const o=G.c.Parse((()=>new y),n,null);this.remove(this.attached[H]),this.add(o)}}}}},13028:(n,y,H)=>{"use strict";H.d(y,{d:()=>M});var o=H(11278),G=H(11280),h=H(11288),k=H(11844),i=H(13032),B=H(11605),V=H(11094);class q{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(n){n=V.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.pn(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((y=>{const H=y.event;if(!H.metaKey)if(y.type===B.e.KEYDOWN){if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){-1===this._keys.indexOf(H.keyCode)&&this._keys.push(H.keyCode),n||H.preventDefault()}}else if(-1!==this.keysUp.indexOf(H.keyCode)||-1!==this.keysDown.indexOf(H.keyCode)||-1!==this.keysLeft.indexOf(H.keyCode)||-1!==this.keysRight.indexOf(H.keyCode)||-1!==this.keysUpward.indexOf(H.keyCode)||-1!==this.keysDownward.indexOf(H.keyCode)||-1!==this.keysRotateLeft.indexOf(H.keyCode)||-1!==this.keysRotateRight.indexOf(H.keyCode)||-1!==this.keysRotateUp.indexOf(H.keyCode)||-1!==this.keysRotateDown.indexOf(H.keyCode)){const y=this._keys.indexOf(H.keyCode);y>=0&&this._keys.splice(y,1),n||H.preventDefault()}})))}vA(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const n=this.camera;for(let y=0;y<this._keys.length;y++){const H=this._keys[y],o=n._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(H)?n._localDirection.Mi(-o,0,0):-1!==this.keysUp.indexOf(H)?n._localDirection.Mi(0,0,o):-1!==this.keysRight.indexOf(H)?n._localDirection.Mi(o,0,0):-1!==this.keysDown.indexOf(H)?n._localDirection.Mi(0,0,-o):-1!==this.keysUpward.indexOf(H)?n._localDirection.Mi(0,o,0):-1!==this.keysDownward.indexOf(H)?n._localDirection.Mi(0,-o,0):-1!==this.keysRotateLeft.indexOf(H)?(n._localDirection.Mi(0,0,0),n.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(H)?(n._localDirection.Mi(0,0,0),n.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(H)?(n._localDirection.Mi(0,0,0),n.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(H)&&(n._localDirection.Mi(0,0,0),n.cameraRotation.x+=this._getLocalRotation()),n.pn().useRightHandedSystem&&(n._localDirection.z*=-1),n.getViewMatrix().invertToRef(n._cameraTransformMatrix),h.zy.TransformNormalToRef(n._localDirection,n._cameraTransformMatrix,n._transformedDirection),n.cameraDirection.addInPlace(n._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const n=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*n}}(0,o.e)([(0,G.J)()],q.prototype,"keysUp",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysUpward",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysDown",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysDownward",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysLeft",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysRight",void 0),(0,o.e)([(0,G.J)()],q.prototype,"rotationSpeed",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysRotateLeft",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysRotateRight",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysRotateUp",void 0),(0,o.e)([(0,G.J)()],q.prototype,"keysRotateDown",void 0),i.e.FreeCameraKeyboardMoveInput=q;var b=H(11099),A=H(11601);class U{constructor(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=n,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new b.c,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(n){n=V.Tools.BackCompatCameraNoPreventDefault(arguments);const y=this.camera.getEngine(),H=y.getInputElement();this._pointerInput||(this._pointerInput=o=>{const G=o.event,h="touch"===G.pointerType;if(!this.touchEnabled&&h)return;if(o.type!==A.b.POINTERMOVE&&-1===this.buttons.indexOf(G.button))return;const k=G.target;if(o.type===A.b.POINTERDOWN){if(h&&-1!==this._activePointerId||!h&&-1!==this._currentActiveButton)return;this._activePointerId=G.pointerId;try{null===k||void 0===k||k.setPointerCapture(G.pointerId)}catch(i){}-1===this._currentActiveButton&&(this._currentActiveButton=G.button),this._previousPosition={x:G.clientX,y:G.clientY},n||(G.preventDefault(),H&&H.focus()),y.isPointerLock&&this._onMouseMove&&this._onMouseMove(o.event)}else if(o.type===A.b.POINTERUP){if(h&&this._activePointerId!==G.pointerId||!h&&this._currentActiveButton!==G.button)return;try{null===k||void 0===k||k.releasePointerCapture(G.pointerId)}catch(i){}this._currentActiveButton=-1,this._previousPosition=null,n||G.preventDefault(),this._activePointerId=-1}else if(o.type===A.b.POINTERMOVE&&(this._activePointerId===G.pointerId||!h))if(y.isPointerLock&&this._onMouseMove)this._onMouseMove(o.event);else if(this._previousPosition){const y=this.camera._calculateHandednessMultiplier(),H=(G.clientX-this._previousPosition.x)*y,o=G.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=H/this.angularSensibility,this.camera.cameraRotation.x+=o/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:H,offsetY:o}),this._previousPosition={x:G.clientX,y:G.clientY},n||G.preventDefault()}}),this._onMouseMove=H=>{if(!y.isPointerLock)return;const o=this.camera._calculateHandednessMultiplier(),G=H.movementX*o;this.camera.cameraRotation.y+=G/this.angularSensibility;const h=H.movementY;this.camera.cameraRotation.x+=h/this.angularSensibility,this._previousPosition=null,n||H.preventDefault()},this._observer=this.camera.pn()._inputManager._addCameraPointerObserver(this._pointerInput,A.b.POINTERDOWN|A.b.POINTERUP|A.b.POINTERMOVE),H&&(this._contextMenuBind=n=>this.onContextMenu(n),H.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(n){n.preventDefault()}vA(){if(this._observer){if(this.camera.pn()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const n=this.camera.getEngine().getInputElement();n&&n.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,o.e)([(0,G.J)()],U.prototype,"buttons",void 0),(0,o.e)([(0,G.J)()],U.prototype,"angularSensibility",void 0),i.e.FreeCameraMouseInput=U;var T,W=H(11614);class z{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new b.c,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(n){n=V.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=y=>{if(y.type!==A.b.POINTERWHEEL)return;const H=y.event,o=H.deltaMode===W.c.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*o*H.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*o*H.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*o*H.deltaZ/this._normalize,H.preventDefault&&(n||H.preventDefault())},this._observer=this.camera.pn()._inputManager._addCameraPointerObserver(this._wheel,A.b.POINTERWHEEL)}vA(){this._observer&&(this.camera.pn()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,o.e)([(0,G.J)()],z.prototype,"wheelPrecisionX",void 0),(0,o.e)([(0,G.J)()],z.prototype,"wheelPrecisionY",void 0),(0,o.e)([(0,G.J)()],z.prototype,"wheelPrecisionZ",void 0),function(n){n[n.MoveRelative=0]="MoveRelative",n[n.RotateRelative=1]="RotateRelative",n[n.MoveScene=2]="MoveScene"}(T||(T={}));class Q extends z{constructor(){super(...arguments),this._moveRelative=h.zy.Zero(),this._rotateRelative=h.zy.Zero(),this._moveScene=h.zy.Zero(),this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(n){null===n&&this._wheelXAction!==T.MoveRelative||(this._wheelXAction=T.MoveRelative,this._wheelXActionCoordinate=n)}get wheelXMoveRelative(){return this._wheelXAction!==T.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(n){null===n&&this._wheelYAction!==T.MoveRelative||(this._wheelYAction=T.MoveRelative,this._wheelYActionCoordinate=n)}get wheelYMoveRelative(){return this._wheelYAction!==T.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(n){null===n&&this._wheelZAction!==T.MoveRelative||(this._wheelZAction=T.MoveRelative,this._wheelZActionCoordinate=n)}get wheelZMoveRelative(){return this._wheelZAction!==T.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(n){null===n&&this._wheelXAction!==T.RotateRelative||(this._wheelXAction=T.RotateRelative,this._wheelXActionCoordinate=n)}get wheelXRotateRelative(){return this._wheelXAction!==T.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(n){null===n&&this._wheelYAction!==T.RotateRelative||(this._wheelYAction=T.RotateRelative,this._wheelYActionCoordinate=n)}get wheelYRotateRelative(){return this._wheelYAction!==T.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(n){null===n&&this._wheelZAction!==T.RotateRelative||(this._wheelZAction=T.RotateRelative,this._wheelZActionCoordinate=n)}get wheelZRotateRelative(){return this._wheelZAction!==T.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(n){null===n&&this._wheelXAction!==T.MoveScene||(this._wheelXAction=T.MoveScene,this._wheelXActionCoordinate=n)}get wheelXMoveScene(){return this._wheelXAction!==T.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(n){null===n&&this._wheelYAction!==T.MoveScene||(this._wheelYAction=T.MoveScene,this._wheelYActionCoordinate=n)}get wheelYMoveScene(){return this._wheelYAction!==T.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(n){null===n&&this._wheelZAction!==T.MoveScene||(this._wheelZAction=T.MoveScene,this._wheelZActionCoordinate=n)}get wheelZMoveScene(){return this._wheelZAction!==T.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.ci(0),this._rotateRelative.ci(0),this._moveScene.ci(0),this._updateCamera(),this.camera.pn().useRightHandedSystem&&(this._moveRelative.z*=-1);const n=h.Matrix.Zero();this.camera.getViewMatrix().invertToRef(n);const y=h.zy.Zero();h.zy.TransformNormalToRef(this._moveRelative,n,y),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(y),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(n,y,H){if(0===n)return;if(null===y||null===H)return;let o=null;switch(y){case T.MoveRelative:o=this._moveRelative;break;case T.RotateRelative:o=this._rotateRelative;break;case T.MoveScene:o=this._moveScene}switch(H){case 0:o.set(n,0,0);break;case 1:o.set(0,n,0);break;case 2:o.set(0,0,n)}}}(0,o.e)([(0,G.J)()],Q.prototype,"wheelXMoveRelative",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelYMoveRelative",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelZMoveRelative",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelXRotateRelative",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelYRotateRelative",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelZRotateRelative",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelXMoveScene",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelYMoveScene",null),(0,o.e)([(0,G.J)()],Q.prototype,"wheelZMoveScene",null),i.e.FreeCameraMouseWheelInput=Q;class l{constructor(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=n,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=V.Tools.IsSafari()}attachControl(n){n=V.Tools.BackCompatCameraNoPreventDefault(arguments);let y=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=H=>{const o=H.event,G="mouse"===o.pointerType||this._isSafari&&"undefined"===typeof o.pointerType;if(this.allowMouse||!G)if(H.type===A.b.POINTERDOWN){if(n||o.preventDefault(),this._pointerPressed.push(o.pointerId),1!==this._pointerPressed.length)return;y={x:o.clientX,y:o.clientY}}else if(H.type===A.b.POINTERUP){n||o.preventDefault();const H=this._pointerPressed.indexOf(o.pointerId);if(-1===H)return;if(this._pointerPressed.splice(H,1),0!=H)return;y=null,this._offsetX=null,this._offsetY=null}else if(H.type===A.b.POINTERMOVE){if(n||o.preventDefault(),!y)return;if(0!=this._pointerPressed.indexOf(o.pointerId))return;this._offsetX=o.clientX-y.x,this._offsetY=-(o.clientY-y.y)}}),this._observer=this.camera.pn()._inputManager._addCameraPointerObserver(this._pointerInput,A.b.POINTERDOWN|A.b.POINTERUP|A.b.POINTERMOVE),this._onLostFocus){const n=this.camera.getEngine().getInputElement();n&&n.addEventListener("blur",this._onLostFocus)}}vA(){if(this._pointerInput){if(this._observer&&(this.camera.pn()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const n=this.camera.getEngine().getInputElement();n&&n.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const n=this.camera,y=n._calculateHandednessMultiplier();n.cameraRotation.y=y*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)n.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const y=n._computeLocalCameraSpeed(),H=new h.zy(0,0,0!==this.touchMoveSensibility?y*this._offsetY/this.touchMoveSensibility:0);h.Matrix.RotationYawPitchRollToRef(n.rotation.y,n.rotation.x,0,n._cameraRotationMatrix),n.cameraDirection.addInPlace(h.zy.TransformCoordinates(H,n._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,o.e)([(0,G.J)()],l.prototype,"touchAngularSensibility",void 0),(0,o.e)([(0,G.J)()],l.prototype,"touchMoveSensibility",void 0),i.e.FreeCameraTouchInput=l;class v extends i.i{constructor(n){super(n),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new q),this}addMouse(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new U(n),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new Q,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new l),this}clear(){super.clear(),this._mouseInput=null}}var F=H(11248),g=H(11189);class M extends k.d{get angularSensibility(){const n=this.inputs.attached.mouse;return n?n.angularSensibility:0}set angularSensibility(n){const y=this.inputs.attached.mouse;y&&(y.angularSensibility=n)}get keysUp(){const n=this.inputs.attached.keyboard;return n?n.keysUp:[]}set keysUp(n){const y=this.inputs.attached.keyboard;y&&(y.keysUp=n)}get keysUpward(){const n=this.inputs.attached.keyboard;return n?n.keysUpward:[]}set keysUpward(n){const y=this.inputs.attached.keyboard;y&&(y.keysUpward=n)}get keysDown(){const n=this.inputs.attached.keyboard;return n?n.keysDown:[]}set keysDown(n){const y=this.inputs.attached.keyboard;y&&(y.keysDown=n)}get keysDownward(){const n=this.inputs.attached.keyboard;return n?n.keysDownward:[]}set keysDownward(n){const y=this.inputs.attached.keyboard;y&&(y.keysDownward=n)}get keysLeft(){const n=this.inputs.attached.keyboard;return n?n.keysLeft:[]}set keysLeft(n){const y=this.inputs.attached.keyboard;y&&(y.keysLeft=n)}get keysRight(){const n=this.inputs.attached.keyboard;return n?n.keysRight:[]}set keysRight(n){const y=this.inputs.attached.keyboard;y&&(y.keysRight=n)}get keysRotateLeft(){const n=this.inputs.attached.keyboard;return n?n.keysRotateLeft:[]}set keysRotateLeft(n){const y=this.inputs.attached.keyboard;y&&(y.keysRotateLeft=n)}get keysRotateRight(){const n=this.inputs.attached.keyboard;return n?n.keysRotateRight:[]}set keysRotateRight(n){const y=this.inputs.attached.keyboard;y&&(y.keysRotateRight=n)}get keysRotateUp(){const n=this.inputs.attached.keyboard;return n?n.keysRotateUp:[]}set keysRotateUp(n){const y=this.inputs.attached.keyboard;y&&(y.keysRotateUp=n)}get keysRotateDown(){const n=this.inputs.attached.keyboard;return n?n.keysRotateDown:[]}set keysRotateDown(n){const y=this.inputs.attached.keyboard;y&&(y.keysRotateDown=n)}constructor(n,y,H){var o;super(n,y,H,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),o=this,this.ellipsoid=new h.zy(.5,1,.5),this.ellipsoidOffset=new h.zy(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=h.zy.Zero(),this._diffPosition=h.zy.Zero(),this._newPosition=h.zy.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o._newPosition.B(y),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o._diffPosition.length()>g.e.CollisionsEpsilon&&(o.position.addToRef(o._diffPosition,o._deferredPositionUpdate),o._deferOnly?o._deferredUpdated=!0:o.position.B(o._deferredPositionUpdate),o.yT&&H&&o.yT(H))},this.inputs=new v(this),this.inputs.addKeyboard().addMouse()}attachControl(n,y){y=V.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(y)}vA(){this.inputs.detachElement(),this.cameraDirection=new h.zy(0,0,0),this.cameraRotation=new h.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(n){this._collisionMask=isNaN(n)?-1:n}_collideWithWorld(n){let y;y=this.parent?h.zy.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,y.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const H=this.pn().collisionCoordinator;this._collider||(this._collider=H.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let o=n;this.applyGravity&&(o=n.add(this.pn().gravity)),H.getNewPosition(this._oldPosition,o,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=h.zy.Zero(),this._transformedDirection=h.zy.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(n){this._needMoveForGravity=n}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.pn().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Gb"}}(0,o.e)([(0,G.F)()],M.prototype,"ellipsoid",void 0),(0,o.e)([(0,G.F)()],M.prototype,"ellipsoidOffset",void 0),(0,o.e)([(0,G.J)()],M.prototype,"checkCollisions",void 0),(0,o.e)([(0,G.J)()],M.prototype,"applyGravity",void 0),(0,F.h)("BABYLON.FreeCamera",M)},13620:(n,y,H)=>{"use strict";H.d(y,{c:()=>h});var o=H(11390),G=H(13626);class h{constructor(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=H,this.Lq=[],this._maxBlockCapacity=y||64,this._selectionContent=new o.b(1024),this._creationFunc=n}update(n,y,H){G.e._CreateBlocks(n,y,H,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Gq(n){for(let y=0;y<this.zq.length;y++){this.zq[y].addEntry(n)}}oq(n){for(let y=0;y<this.zq.length;y++){this.zq[y].removeEntry(n)}}select(n,y){this._selectionContent.reset();for(let H=0;H<this.zq.length;H++){this.zq[H].select(n,this._selectionContent,y)}return y?this._selectionContent.concat(this.Lq):this._selectionContent.concatWithNoDuplicate(this.Lq),this._selectionContent}intersects(n,y,H){this._selectionContent.reset();for(let o=0;o<this.zq.length;o++){this.zq[o].intersects(n,y,this._selectionContent,H)}return H?this._selectionContent.concat(this.Lq):this._selectionContent.concatWithNoDuplicate(this.Lq),this._selectionContent}intersectsRay(n){this._selectionContent.reset();for(let y=0;y<this.zq.length;y++){this.zq[y].intersectsRay(n,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Lq),this._selectionContent}}h.CreationFuncForMeshes=(n,y)=>{const H=n.getBoundingInfo();!n.isBlocked&&H.boundingBox.intersectsMinMax(y.Tb,y.lb)&&y.entries.push(n)},h.CreationFuncForSubMeshes=(n,y)=>{n.getBoundingInfo().boundingBox.intersectsMinMax(y.Tb,y.lb)&&y.entries.push(n)}},13626:(n,y,H)=>{"use strict";H.d(y,{e:()=>h});var o=H(11288),G=H(11682);class h{constructor(n,y,H,o,G,h){this.entries=[],this.Mb=new Array,this._capacity=H,this._depth=o,this._maxDepth=G,this._creationFunc=h,this._minPoint=n,this._maxPoint=y,this.Mb.push(n.clone()),this.Mb.push(y.clone()),this.Mb.push(n.clone()),this.Mb[2].x=y.x,this.Mb.push(n.clone()),this.Mb[3].y=y.y,this.Mb.push(n.clone()),this.Mb[4].z=y.z,this.Mb.push(y.clone()),this.Mb[5].z=n.z,this.Mb.push(y.clone()),this.Mb[6].x=n.x,this.Mb.push(y.clone()),this.Mb[7].y=n.y}get ji(){return this._capacity}get Tb(){return this._minPoint}get lb(){return this._maxPoint}addEntry(n){if(this.zq)for(let y=0;y<this.zq.length;y++){this.zq[y].addEntry(n)}else this._creationFunc(n,this),this.entries.length>this.ji&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(n){if(this.zq){for(let y=0;y<this.zq.length;y++){this.zq[y].removeEntry(n)}return}const y=this.entries.indexOf(n);y>-1&&this.entries.splice(y,1)}addEntries(n){for(let y=0;y<n.length;y++){const H=n[y];this.addEntry(H)}}select(n,y,H){if(G.b.IsInFrustum(this.Mb,n)){if(this.zq){for(let o=0;o<this.zq.length;o++){this.zq[o].select(n,y,H)}return}H?y.concat(this.entries):y.concatWithNoDuplicate(this.entries)}}intersects(n,y,H,o){if(G.b.IntersectsSphere(this._minPoint,this._maxPoint,n,y)){if(this.zq){for(let G=0;G<this.zq.length;G++){this.zq[G].intersects(n,y,H,o)}return}o?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersectsRay(n,y){if(n.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.zq){for(let H=0;H<this.zq.length;H++){this.zq[H].intersectsRay(n,y)}return}y.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){h._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(n,y,H,G,k,i,B,V){B.zq=new Array;const q=new o.zy((y.x-n.x)/2,(y.y-n.y)/2,(y.z-n.z)/2);for(let o=0;o<2;o++)for(let y=0;y<2;y++)for(let b=0;b<2;b++){const A=n.add(q.multiplyByFloats(o,y,b)),U=n.add(q.multiplyByFloats(o+1,y+1,b+1)),T=new h(A,U,G,k+1,i,V);T.addEntries(H),B.zq.push(T)}}}},13630:(n,y,H)=>{"use strict";H.d(y,{d:()=>q});var o=H(11554),G=H(11288),h=H(11779),k=H(12779),i=H(11596),B=H(13620),V=H(11149);o.e.prototype.createOrUpdateSelectionOctree=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,H=this._getComponent(i.c.NAME_OCTREE);H||(H=new q(this),this.gh(H)),this.tq||(this.tq=new B.c(B.c.CreationFuncForMeshes,n,y));const o=this.getWorldExtends();return this.tq.update(o.min,o.max,this.meshes),this.tq},Object.defineProperty(o.e.prototype,"selectionOctree",{get:function(){return this.tq},enumerable:!0,configurable:!0}),h.d.prototype.createOrUpdateSubmeshesOctree=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const H=this.pn();let o=H._getComponent(i.c.NAME_OCTREE);o||(o=new q(H),H.gh(o)),this._submeshesOctree||(this._submeshesOctree=new B.c(B.c.CreationFuncForSubMeshes,n,y)),this.Qi(!0);const G=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(G.minimumWorld,G.maximumWorld,this.Lh),this._submeshesOctree};class q{constructor(n){this.name=i.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new k.d(G.zy.Zero(),new G.zy(1,1,1)),(n=n||V.c.LastCreatedScene)&&(this.ly=n,this.ly.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.ly.getActiveSubMeshCandidates=n=>this.getActiveSubMeshCandidates(n),this.ly.getCollidingSubMeshCandidates=(n,y)=>this.getCollidingSubMeshCandidates(n,y),this.ly.getIntersectingSubMeshCandidates=(n,y)=>this.getIntersectingSubMeshCandidates(n,y))}register(){this.ly.onMeshRemovedObservable.add((n=>{const y=this.ly.selectionOctree;if(void 0!==y&&null!==y){const H=y.Lq.indexOf(n);-1!==H&&y.Lq.splice(H,1)}})),this.ly.onMeshImportedObservable.add((n=>{const y=this.ly.selectionOctree;void 0!==y&&null!==y&&y.Gq(n)}))}getActiveMeshCandidates(){var n;return(null===(n=this.ly.tq)||void 0===n?void 0:n.select(this.ly.frustumPlanes))||this.ly._getDefaultMeshCandidates()}getActiveSubMeshCandidates(n){if(n._submeshesOctree&&n.useOctreeForRenderingSelection){return n._submeshesOctree.select(this.ly.frustumPlanes)}return this.ly._getDefaultSubMeshCandidates(n)}getIntersectingSubMeshCandidates(n,y){if(n._submeshesOctree&&n.useOctreeForPicking){k.d.TransformToRef(y,n.getWorldMatrix(),this._tempRay);return n._submeshesOctree.intersectsRay(this._tempRay)}return this.ly._getDefaultSubMeshCandidates(n)}getCollidingSubMeshCandidates(n,y){if(n._submeshesOctree&&n.useOctreeForCollisions){const H=y._velocityWorldLength+Math.max(y._radius.x,y._radius.y,y._radius.z);return n._submeshesOctree.intersects(y._basePointWorld,H)}return this.ly._getDefaultSubMeshCandidates(n)}rebuild(){}dispose(){}}},12779:(n,y,H)=>{"use strict";H.d(y,{d:()=>U});var o=H(11554),G=H(11806),h=H(11297),k=H(11288),i=H(11300),B=H(11672),V=H(11589),q=H(11149),b=H(11623);const A={internalPickerForMesh:void 0};class U{constructor(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.e;this.origin=n,this.direction=y,this.length=H,this.epsilon=o}clone(){return new U(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=U._TmpVector3[0].Mi(n.x-H,n.y-H,n.z-H),G=U._TmpVector3[1].Mi(y.x+H,y.y+H,y.z+H);let h,k,i,B,V=0,q=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<o.x||this.origin.x>G.x)return!1}else if(h=1/this.direction.x,k=(o.x-this.origin.x)*h,i=(G.x-this.origin.x)*h,i===-1/0&&(i=1/0),k>i&&(B=k,k=i,i=B),V=Math.max(k,V),q=Math.min(i,q),V>q)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<o.y||this.origin.y>G.y)return!1}else if(h=1/this.direction.y,k=(o.y-this.origin.y)*h,i=(G.y-this.origin.y)*h,i===-1/0&&(i=1/0),k>i&&(B=k,k=i,i=B),V=Math.max(k,V),q=Math.min(i,q),V>q)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<o.z||this.origin.z>G.z)return!1}else if(h=1/this.direction.z,k=(o.z-this.origin.z)*h,i=(G.z-this.origin.z)*h,i===-1/0&&(i=1/0),k>i&&(B=k,k=i,i=B),V=Math.max(k,V),q=Math.min(i,q),V>q)return!1;return!0}intersectsBox(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(n.minimum,n.maximum,y)}intersectsSphere(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=n.center.x-this.origin.x,o=n.center.y-this.origin.y,G=n.center.z-this.origin.z,h=H*H+o*o+G*G,k=n.radius+y,i=k*k;if(h<=i)return!0;const B=H*this.direction.x+o*this.direction.y+G*this.direction.z;if(B<0)return!1;return h-B*B<=i}intersectsTriangle(n,y,H){const o=U._TmpVector3[0],G=U._TmpVector3[1],h=U._TmpVector3[2],i=U._TmpVector3[3],V=U._TmpVector3[4];y.subtractToRef(n,o),H.subtractToRef(n,G),k.zy.CrossToRef(this.direction,G,h);const q=k.zy.Dot(o,h);if(0===q)return null;const b=1/q;this.origin.subtractToRef(n,i);const A=k.zy.Dot(i,h)*b;if(A<-this.epsilon||A>1+this.epsilon)return null;k.zy.CrossToRef(i,o,V);const T=k.zy.Dot(this.direction,V)*b;if(T<-this.epsilon||A+T>1+this.epsilon)return null;const W=k.zy.Dot(G,V)*b;return W>this.length?null:new B.b(1-A-T,A,W)}intersectsPlane(n){let y;const H=k.zy.Dot(n.normal,this.direction);if(Math.abs(H)<9.99999997475243e-7)return null;{const o=k.zy.Dot(n.normal,this.origin);return y=(-n.d-o)/H,y<0?y<-9.99999997475243e-7?null:0:y}}intersectsAxis(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(n){case"y":{const n=(this.origin.y-y)/this.direction.y;return n>0?null:new k.zy(this.origin.x+this.direction.x*-n,y,this.origin.z+this.direction.z*-n)}case"x":{const n=(this.origin.x-y)/this.direction.x;return n>0?null:new k.zy(y,this.origin.y+this.direction.y*-n,this.origin.z+this.direction.z*-n)}case"z":{const n=(this.origin.z-y)/this.direction.z;return n>0?null:new k.zy(this.origin.x+this.direction.x*-n,this.origin.y+this.direction.y*-n,y)}default:return null}}intersectsMesh(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const i=k.TmpVectors.Matrix[0];return n.getWorldMatrix().invertToRef(i),this._tmpRay?U.TransformToRef(this,i,this._tmpRay):this._tmpRay=U.Transform(this,i),n.intersects(this._tmpRay,y,H,o,G,h)}intersectsMeshes(n,y,H){H?H.length=0:H=[];for(let o=0;o<n.length;o++){const G=this.intersectsMesh(n[o],y);G.hit&&H.push(G)}return H.sort(this._comparePickingInfo),H}_comparePickingInfo(n,y){return n.distance<y.distance?-1:n.distance>y.distance?1:0}intersectionSegment(n,y,H){const o=this.origin,G=k.TmpVectors.zy[0],h=k.TmpVectors.zy[1],i=k.TmpVectors.zy[2],B=k.TmpVectors.zy[3];y.subtractToRef(n,G),this.direction.scaleToRef(U._Rayl,i),o.addToRef(i,h),n.subtractToRef(o,B);const V=k.zy.Dot(G,G),q=k.zy.Dot(G,i),b=k.zy.Dot(i,i),A=k.zy.Dot(G,B),T=k.zy.Dot(i,B),W=V*b-q*q;let z,Q,l=W,v=W;W<U._Smallnum?(z=0,l=1,Q=T,v=b):(z=q*T-b*A,Q=V*T-q*A,z<0?(z=0,Q=T,v=b):z>l&&(z=l,Q=T+q,v=b)),Q<0?(Q=0,-A<0?z=0:-A>V?z=l:(z=-A,l=V)):Q>v&&(Q=v,-A+q<0?z=0:-A+q>V?z=l:(z=-A+q,l=V));const F=Math.abs(z)<U._Smallnum?0:z/l,g=Math.abs(Q)<U._Smallnum?0:Q/v,M=k.TmpVectors.zy[4];i.scaleToRef(g,M);const f=k.TmpVectors.zy[5];G.scaleToRef(F,f),f.addInPlace(B);const c=k.TmpVectors.zy[6];f.subtractToRef(M,c);return g>0&&g<=this.length&&c.lengthSquared()<H*H?f.length():-1}update(n,y,H,o,G,h,i){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){U._RayDistant||(U._RayDistant=U.Zero()),U._RayDistant.unprojectRayToRef(n,y,H,o,k.Matrix.IdentityReadOnly,h,i);const B=k.TmpVectors.Matrix[0];G.invertToRef(B),U.TransformToRef(U._RayDistant,B,this)}else this.unprojectRayToRef(n,y,H,o,G,h,i);return this}static Zero(){return new U(k.zy.Zero(),k.zy.Zero())}static CreateNew(n,y,H,o,G,h,k){return U.Zero().update(n,y,H,o,G,h,k)}static CreateNewFromTo(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.Matrix.IdentityReadOnly;const o=new U(new k.zy(0,0,0),new k.zy(0,0,0));return U.CreateFromToToRef(n,y,o,H)}static CreateFromToToRef(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k.Matrix.IdentityReadOnly;H.origin.B(n);const G=y.subtractToRef(n,H.direction),h=Math.sqrt(G.x*G.x+G.y*G.y+G.z*G.z);return H.length=h,H.direction.normalize(),U.TransformToRef(H,o,H)}static Transform(n,y){const H=new U(new k.zy(0,0,0),new k.zy(0,0,0));return U.TransformToRef(n,y,H),H}static TransformToRef(n,y,H){k.zy.TransformCoordinatesToRef(n.origin,y,H.origin),k.zy.TransformNormalToRef(n.direction,y,H.direction),H.length=n.length,H.epsilon=n.epsilon;const o=H.direction,G=o.length();if(0!==G&&1!==G){const n=1/G;o.x*=n,o.y*=n,o.z*=n,H.length*=G}return H}unprojectRayToRef(n,y,H,o,G,h,i){const B=k.TmpVectors.Matrix[0];G.multiplyToRef(h,B),B.multiplyToRef(i,B),B.invert();const V=q.c.LastCreatedEngine,b=k.TmpVectors.zy[0];b.x=n/H*2-1,b.y=-(y/o*2-1),b.z=null!==V&&void 0!==V&&V.useReverseDepthBuffer?1:null!==V&&void 0!==V&&V.isNDCHalfZRange?0:-1;const A=k.TmpVectors.zy[1].Mi(b.x,b.y,1-1e-8),U=k.TmpVectors.zy[2],T=k.TmpVectors.zy[3];k.zy._UnprojectFromInvertedMatrixToRef(b,B,U),k.zy._UnprojectFromInvertedMatrixToRef(A,B,T),this.origin.B(U),T.subtractToRef(U,this.direction),this.direction.normalize()}}function T(n,y,H,o,G){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=U.Zero();return W(n,y,H,o,k,G,h),k}function W(n,y,H,o,G,h){let i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const V=n.getEngine();if(!h&&!(h=n.activeCamera))return n;const q=h.viewport,b=V.getRenderHeight(),{x:A,y:U,width:T,height:W}=q.toGlobal(V.getRenderWidth(),b),z=1/V.getHardwareScalingLevel();return y=y*z-A,H=H*z-(b-U-W),G.update(y,H,T,W,o||k.Matrix.IdentityReadOnly,i?k.Matrix.IdentityReadOnly:h.getViewMatrix(),h.getProjectionMatrix(),B),n}function z(n,y,H,o,G){if(!V.b)return n;const h=n.getEngine();if(!G&&!(G=n.activeCamera))throw new Error("Active camera not set");const i=G.viewport,B=h.getRenderHeight(),{x:q,y:b,width:A,height:U}=i.toGlobal(h.getRenderWidth(),B),T=k.Matrix.Identity(),W=1/h.getHardwareScalingLevel();return y=y*W-q,H=H*W-(B-b-U),o.update(y,H,A,U,T,T,G.getProjectionMatrix()),n}function Q(n,y,H,o,G,h,k,i){const B=y(o,H.enableDistantPicking),V=H.intersects(B,G,k,h,o,i);return V&&V.hit?!G&&null!=n&&V.distance>=n.distance?null:V:null}function l(n,y,H,o,G,h){let i=null;const B=!!(n.activeCameras&&n.activeCameras.length>1&&n.cameraToUseForPointers!==n.activeCamera),q=n.cameraToUseForPointers||n.activeCamera,b=A.internalPickerForMesh||Q;for(let V=0;V<n.meshes.length;V++){const A=n.meshes[V];if(H){if(!H(A,-1))continue}else if(!A.isEnabled()||!A.isVisible||!A.KB)continue;const U=B&&A.isWorldMatrixCameraDependent(),T=A.Qi(U,q);if(A.hasThinInstances&&A.FV){const n=b(i,y,A,T,!0,!0,h);if(n){if(G)return n;const B=k.TmpVectors.Matrix[1],V=A.thinInstanceGetWorldMatrices();for(let n=0;n<V.length;n++){if(H&&!H(A,n))continue;V[n].multiplyToRef(T,B);const k=b(i,y,A,B,o,G,h,!0);if(k&&(i=k,i.thinInstanceIndex=n,o))return i}}}else{const n=b(i,y,A,T,o,G,h);if(n&&(i=n,o))return i}}return i||new V.b}function v(n,y,H,o){if(!V.b)return null;const G=[],h=!!(n.activeCameras&&n.activeCameras.length>1&&n.cameraToUseForPointers!==n.activeCamera),i=n.cameraToUseForPointers||n.activeCamera,B=A.internalPickerForMesh||Q;for(let V=0;V<n.meshes.length;V++){const q=n.meshes[V];if(H){if(!H(q,-1))continue}else if(!q.isEnabled()||!q.isVisible||!q.KB)continue;const b=h&&q.isWorldMatrixCameraDependent(),A=q.Qi(b,i);if(q.hasThinInstances&&q.FV){if(B(null,y,q,A,!0,!0,o)){const n=k.TmpVectors.Matrix[1],h=q.thinInstanceGetWorldMatrices();for(let k=0;k<h.length;k++){if(H&&!H(q,k))continue;h[k].multiplyToRef(A,n);const i=B(null,y,q,n,!1,!1,o,!0);i&&(i.thinInstanceIndex=k,G.push(i))}}}else{const n=B(null,y,q,A,!1,!1,o);n&&G.push(n)}}return G}function F(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,o=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0;o||(o=n.getWorldMatrix()),y.length=H,G?y.origin.B(G):y.origin.B(n.position);const h=k.TmpVectors.zy[2];h.set(0,0,n._scene.useRightHandedSystem?-1:1);const i=k.TmpVectors.zy[3];return k.zy.TransformNormalToRef(h,o,i),k.zy.NormalizeToRef(i,y.direction),y}var g,M;U._TmpVector3=(0,i.c)(6,k.zy.Zero),U._RayDistant=U.Zero(),U._Smallnum=1e-8,U._Rayl=1e9,g=o.e,(M=G.d)&&(M.prototype.getForwardRay=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,y=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;return F(this,new U(k.zy.Zero(),k.zy.Zero(),n),n,y,H)},M.prototype.getForwardRayToRef=function(n){return F(this,n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),g&&(b.e._IsPickingAvailable=!0,g.prototype.createPickingRay=function(n,y,H,o){return T(this,n,y,H,o,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),o.e.prototype.createPickingRayToRef=function(n,y,H,o,G){return W(this,n,y,H,o,G,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},o.e.prototype.createPickingRayInCameraSpace=function(n,y,H){return function(n,y,H,o){const G=U.Zero();return z(n,y,H,G,o),G}(this,n,y,H)},o.e.prototype.createPickingRayInCameraSpaceToRef=function(n,y,H,o){return z(this,n,y,H,o)},o.e.prototype.pickWithBoundingInfo=function(n,y,H,o,G){return function(n,y,H,o,G,h){if(!V.b)return null;const i=l(n,(o=>(n._tempPickingRay||(n._tempPickingRay=U.Zero()),W(n,y,H,o,n._tempPickingRay,h||null),n._tempPickingRay)),o,G,!0);return i&&(i.ray=T(n,y,H,k.Matrix.Identity(),h||null)),i}(this,n,y,H,o,G)},o.e.prototype.lH=function(n,y,H,o,G,h){return function(n,y,H,o,G,h,i){const B=l(n,((o,G)=>(n._tempPickingRay||(n._tempPickingRay=U.Zero()),W(n,y,H,o,n._tempPickingRay,h||null,!1,G),n._tempPickingRay)),o,G,!1,i);return B&&(B.ray=T(n,y,H,k.Matrix.Identity(),h||null)),B}(this,n,y,H,o,G,h)},o.e.prototype.pickWithRay=function(n,y,H,o){return function(n,y,H,o,G){const h=l(n,(H=>(n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=k.Matrix.Identity()),H.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=U.Zero()),U.TransformToRef(y,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform)),H,o,!1,G);return h&&(h.ray=y),h}(this,n,y,H,o)},o.e.prototype.multiPick=function(n,y,H,o,G){return function(n,y,H,o,G,h){return v(n,(o=>T(n,y,H,o,G||null)),o,h)}(this,n,y,H,o,G)},o.e.prototype.multiPickWithRay=function(n,y,H){return function(n,y,H,o){return v(n,(H=>(n._pickWithRayInverseMatrix||(n._pickWithRayInverseMatrix=k.Matrix.Identity()),H.invertToRef(n._pickWithRayInverseMatrix),n._cachedRayForTransform||(n._cachedRayForTransform=U.Zero()),U.TransformToRef(y,n._pickWithRayInverseMatrix,n._cachedRayForTransform),n._cachedRayForTransform)),H,o)}(this,n,y,H)}},13091:(n,y,H)=>{"use strict";var o=H(11230),G=H(11114),h=H(11154),k=H(11253),i=H(11189),B=H(11240);i.e.prototype._partialLoadFile=function(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(n,(n=>{H[y]=n,H._internalCount++,6===H._internalCount&&o(H)}),void 0,void 0,!0,((n,y)=>{G&&n&&G(n.status+" "+n.statusText,y)}))},i.e.prototype._cascadeLoadFiles=function(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const G=[];G._internalCount=0;for(let h=0;h<6;h++)this._partialLoadFile(H[h],h,G,y,o)},i.e.prototype._cascadeLoadImgs=function(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5?arguments[5]:void 0;const k=[];k._internalCount=0;for(let i=0;i<6;i++)this._partialLoadImg(o[i],i,k,n,y,H,G,h)},i.e.prototype._partialLoadImg=function(n,y,H,o,G,i){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7?arguments[7]:void 0;const q=(0,k.b)();(0,h.s)(n,(n=>{H[y]=n,H._internalCount++,o&&o.removePendingData(q),6===H._internalCount&&i&&i(G,H)}),((n,y)=>{o&&o.removePendingData(q),B&&B(n,y)}),o?o.offlineProvider:null,V),o&&o.addPendingData(q)},i.e.prototype.createCubeTextureBase=function(n,y,H,h){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6?arguments[6]:void 0,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]&&arguments[8],A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,T=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,W=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,z=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,Q=arguments.length>14&&void 0!==arguments[14]&&arguments[14],l=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const v=T||new o.b(this,7);v.isCube=!0,v.url=n,v.generateMipMaps=!h,v._lodGenerationScale=A,v._lodGenerationOffset=U,v._useSRGBBuffer=!!Q&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!h),v!==T&&(v.label=n.substring(0,60)),this._doNotHandleContextLost||(v._extension=q,v._files=H,v._buffer=l);const F=n;this._transformTextureUrl&&!T&&(n=this._transformTextureUrl(n));const g=q??function(n){const y=n.split("?")[0],H=y.lastIndexOf(".");return H>-1?y.substring(H).toLowerCase():""}(n),M=(0,B.b)(g),f=(n,y)=>{v.dispose(),i?i(n,y):n&&G.d.Warn(n)},c=(o,i)=>{n===F?o&&f(o.status+" "+o.statusText,i):(G.d.Warn(`Failed to load ${n}, falling back to the ${F}`),this.createCubeTextureBase(F,y,H,!!h,k,f,V,q,b,A,U,v,W,z,Q,l))};if(M)M.then((o=>{const G=n=>{W&&W(v,n),o.loadCubeData(n,v,b,k,((n,y)=>{f(n,y)}))};l?G(l):H&&6===H.length?o.supportCascades?this._cascadeLoadFiles(y,(n=>G(n.map((n=>new Uint8Array(n))))),H,f):f("Textures type does not support cascades."):this._loadFile(n,(n=>G(new Uint8Array(n))),void 0,void 0,!0,c)}));else{if(!H||0===H.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(y,v,((n,y)=>{z&&z(n,y)}),H,f)}return this._internalTexturesCache.push(v),v}},13635:(n,y,H)=>{"use strict";H(11114);var o=H(11440);H(11230),H(11367),H(11223),H(11491),H(11455);o.d},13112:(n,y,H)=>{"use strict";H.d(y,{c:()=>G});var o=H(11248);class G{constructor(n){this.value=this._toInt(n)}_toInt(n){return 0|n}add(n){return new G(this.value+n.value)}Qy(n){return new G(this.value-n.value)}multiply(n){return new G(Math.imul(this.value,n.value))}divide(n){return new G(this.value/n.value)}getClassName(){return G.ClassName}equals(n){return this.value===n.value}static FromValue(n){return new G(n)}toString(){return this.value.toString()}}G.ClassName="FlowGraphInteger",(0,o.h)("FlowGraphInteger",G)},13124:(n,y,H)=>{"use strict";H.d(y,{e:()=>G,i:()=>h});var o=H(11288);class G{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.jh=n}get m(){return this.jh}transformVector(n){return this.transformVectorToRef(n,new o.Vector2)}transformVectorToRef(n,y){return y.x=n.x*this.jh[0]+n.y*this.jh[1],y.y=n.x*this.jh[2]+n.y*this.jh[3],y}Ui(){return this.toArray()}toArray(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let y=0;y<4;y++)n[y]=this.jh[y];return n}vH(n){for(let y=0;y<4;y++)this.jh[y]=n[y];return this}multiplyToRef(n,y){const H=n.jh,o=this.jh,G=y.jh;return G[0]=H[0]*o[0]+H[1]*o[2],G[1]=H[0]*o[1]+H[1]*o[3],G[2]=H[2]*o[0]+H[3]*o[2],G[3]=H[2]*o[1]+H[3]*o[3],y}multiply(n){return this.multiplyToRef(n,new G)}divideToRef(n,y){const H=this.jh,o=n.jh,G=y.jh;return G[0]=H[0]/o[0],G[1]=H[1]/o[1],G[2]=H[2]/o[2],G[3]=H[3]/o[3],y}divide(n){return this.divideToRef(n,new G)}addToRef(n,y){const H=this.jh,o=n.m,G=y.m;return G[0]=H[0]+o[0],G[1]=H[1]+o[1],G[2]=H[2]+o[2],G[3]=H[3]+o[3],y}add(n){return this.addToRef(n,new G)}subtractToRef(n,y){const H=this.jh,o=n.m,G=y.m;return G[0]=H[0]-o[0],G[1]=H[1]-o[1],G[2]=H[2]-o[2],G[3]=H[3]-o[3],y}Qy(n){return this.subtractToRef(n,new G)}transpose(){const n=this.jh;return new G([n[0],n[2],n[1],n[3]])}determinant(){const n=this.jh;return n[0]*n[3]-n[1]*n[2]}inverse(){const n=this.determinant();if(0===n)throw new Error("Matrix is not invertible");const y=this.jh,H=1/n;return new G([y[3]*H,-y[1]*H,-y[2]*H,y[0]*H])}equals(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.jh,o=n.m;return 0===y?H[0]===o[0]&&H[1]===o[1]&&H[2]===o[2]&&H[3]===o[3]:Math.abs(H[0]-o[0])<y&&Math.abs(H[1]-o[1])<y&&Math.abs(H[2]-o[2])<y&&Math.abs(H[3]-o[3])<y}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.jh.join(", ")})`}}class h{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.jh=n}get m(){return this.jh}transformVector(n){return this.transformVectorToRef(n,new o.zy)}transformVectorToRef(n,y){const H=this.jh;return y.x=n.x*H[0]+n.y*H[1]+n.z*H[2],y.y=n.x*H[3]+n.y*H[4]+n.z*H[5],y.z=n.x*H[6]+n.y*H[7]+n.z*H[8],y}multiplyToRef(n,y){const H=n.jh,o=this.jh,G=y.m;return G[0]=H[0]*o[0]+H[1]*o[3]+H[2]*o[6],G[1]=H[0]*o[1]+H[1]*o[4]+H[2]*o[7],G[2]=H[0]*o[2]+H[1]*o[5]+H[2]*o[8],G[3]=H[3]*o[0]+H[4]*o[3]+H[5]*o[6],G[4]=H[3]*o[1]+H[4]*o[4]+H[5]*o[7],G[5]=H[3]*o[2]+H[4]*o[5]+H[5]*o[8],G[6]=H[6]*o[0]+H[7]*o[3]+H[8]*o[6],G[7]=H[6]*o[1]+H[7]*o[4]+H[8]*o[7],G[8]=H[6]*o[2]+H[7]*o[5]+H[8]*o[8],y}multiply(n){return this.multiplyToRef(n,new h)}divideToRef(n,y){const H=this.jh,o=n.m,G=y.m;return G[0]=H[0]/o[0],G[1]=H[1]/o[1],G[2]=H[2]/o[2],G[3]=H[3]/o[3],G[4]=H[4]/o[4],G[5]=H[5]/o[5],G[6]=H[6]/o[6],G[7]=H[7]/o[7],G[8]=H[8]/o[8],y}divide(n){return this.divideToRef(n,new h)}addToRef(n,y){const H=this.jh,o=n.m,G=y.m;return G[0]=H[0]+o[0],G[1]=H[1]+o[1],G[2]=H[2]+o[2],G[3]=H[3]+o[3],G[4]=H[4]+o[4],G[5]=H[5]+o[5],G[6]=H[6]+o[6],G[7]=H[7]+o[7],G[8]=H[8]+o[8],y}add(n){return this.addToRef(n,new h)}subtractToRef(n,y){const H=this.jh,o=n.m,G=y.m;return G[0]=H[0]-o[0],G[1]=H[1]-o[1],G[2]=H[2]-o[2],G[3]=H[3]-o[3],G[4]=H[4]-o[4],G[5]=H[5]-o[5],G[6]=H[6]-o[6],G[7]=H[7]-o[7],G[8]=H[8]-o[8],y}Qy(n){return this.subtractToRef(n,new h)}toArray(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let y=0;y<9;y++)n[y]=this.jh[y];return n}Ui(){return this.toArray()}vH(n){for(let y=0;y<9;y++)this.jh[y]=n[y];return this}transpose(){const n=this.jh;return new h([n[0],n[3],n[6],n[1],n[4],n[7],n[2],n[5],n[8]])}determinant(){const n=this.jh;return n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6])}inverse(){const n=this.determinant();if(0===n)throw new Error("Matrix is not invertible");const y=this.jh,H=1/n;return new h([(y[4]*y[8]-y[5]*y[7])*H,(y[2]*y[7]-y[1]*y[8])*H,(y[1]*y[5]-y[2]*y[4])*H,(y[5]*y[6]-y[3]*y[8])*H,(y[0]*y[8]-y[2]*y[6])*H,(y[2]*y[3]-y[0]*y[5])*H,(y[3]*y[7]-y[4]*y[6])*H,(y[1]*y[6]-y[0]*y[7])*H,(y[0]*y[4]-y[1]*y[3])*H])}equals(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const H=this.jh,o=n.m;return 0===y?H[0]===o[0]&&H[1]===o[1]&&H[2]===o[2]&&H[3]===o[3]&&H[4]===o[4]&&H[5]===o[5]&&H[6]===o[6]&&H[7]===o[7]&&H[8]===o[8]:Math.abs(H[0]-o[0])<y&&Math.abs(H[1]-o[1])<y&&Math.abs(H[2]-o[2])<y&&Math.abs(H[3]-o[3])<y&&Math.abs(H[4]-o[4])<y&&Math.abs(H[5]-o[5])<y&&Math.abs(H[6]-o[6])<y&&Math.abs(H[7]-o[7])<y&&Math.abs(H[8]-o[8])<y}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.jh.join(", ")})`}}},13131:(n,y,H)=>{"use strict";var o;function G(n,y,H,o){switch(y){case"Animation":return o?n.animations.find((n=>n.uniqueId===H))??null:n.animations[H]??null;case"AnimationGroup":return o?n.animationGroups.find((n=>n.uniqueId===H))??null:n.animationGroups[H]??null;case"Mesh":return o?n.meshes.find((n=>n.uniqueId===H))??null:n.meshes[H]??null;case"Material":return o?n.materials.find((n=>n.uniqueId===H))??null:n.materials[H]??null;case"Aq":return o?n.cameras.find((n=>n.uniqueId===H))??null:n.cameras[H]??null;case"Light":return o?n.lights.find((n=>n.uniqueId===H))??null:n.lights[H]??null;default:return null}}H.d(y,{d:()=>G}),function(n){n.Animation="Animation",n.AnimationGroup="AnimationGroup",n.Mesh="Mesh",n.Material="Material",n.Aq="Aq",n.Light="Light"}(o||(o={}))},13160:(n,y,H)=>{"use strict";H.d(y,{d:()=>G});var o=H(13162);class G extends o.b{constructor(n,y){if(super(n),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),y)for(const H of y)this._eventsSignalOutputs[H]=this._registerSignalOutput(H+"Event")}_executeOnTick(n){}_startPendingTasks(n){n._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(n),this._resetAfterCanceled(n)),this._preparePendingTasks(n),n._addPendingBlock(this),this.out._activateSignal(n),n._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(n){n._deleteExecutionVariable(this,"_initialized"),n._removePendingBlock(this)}}},13146:(n,y,H)=>{"use strict";H.d(y,{c:()=>V});var o=H(11253),G=H(11248),h=H(13150),k=H(11099),i=H(13108);class B extends h.e{constructor(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.defaultValue,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(n,y,H),this.richType=o,this._defaultValue=G,this._optional=h,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new k.c}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(n){this._isDisabled!==n&&(this._isDisabled=n,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(n,y){y._getConnectionValue(this)!==n&&(y._setConnectionValue(this,n),this.onValueChangedObservable.notifyObservers(n))}resetToDefaultValue(n){n._setConnectionValue(this,this._defaultValue)}connectTo(n){this._isDisabled||super.connectTo(n)}_getValueOrDefault(n){const y=n._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(y):y}getValue(n){if(1===this.connectionType){n._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(n);const y=this._getValueOrDefault(n);return this._lastValue=y,this.richType.typeTransformer?this.richType.typeTransformer(y):y}const y=this.isConnected()?this._connectedPoint[0].getValue(n):this._getValueOrDefault(n);return this._lastValue=y,this.richType.typeTransformer?this.richType.typeTransformer(y):y}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(n),n.richType={},this.richType.serialize(n.richType),n.optional=this._optional,(0,i.e)("defaultValue",this._defaultValue,n)}}(0,G.h)("FlowGraphDataConnection",B);class V{constructor(n){var y;this.config=n,this.uniqueId=(0,o.b)(),this.name=(null===(y=this.config)||void 0===y?void 0:y.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(n){}registerDataInput(n,y,H){const o=new B(n,0,this,y,H);return this.dataInputs.push(o),o}registerDataOutput(n,y,H){const o=new B(n,1,this,y,H);return this.dataOutputs.push(o),o}getDataInput(n){return this.dataInputs.find((y=>y.name===n))}getDataOutput(n){return this.dataOutputs.find((y=>y.name===n))}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.e;if(n.uniqueId=this.uniqueId,n.config={},this.config){const H=this.config,o=Object.keys(H);for(const G of o)y(G,H[G],n.config)}n.dataInputs=[],n.dataOutputs=[],n.className=this.getClassName();for(const H of this.dataInputs){const y={};H.serialize(y),n.dataInputs.push(y)}for(const H of this.dataOutputs){const y={};H.serialize(y),n.dataOutputs.push(y)}}deserialize(n){}_log(n,y,H){var o;null===(o=n.logger)||void 0===o||o.addLogItem({action:y,FH:H,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13150:(n,y,H)=>{"use strict";H.d(y,{e:()=>h});var o,G=H(11253);!function(n){n[n.Input=0]="Input",n[n.Output=1]="Output"}(o||(o={}));class h{constructor(n,y,H){this._ownerBlock=H,this._connectedPoint=[],this.uniqueId=(0,G.b)(),this.connectedPointIds=[],this.name=n,this._connectionType=y}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(n){if(this._connectionType===n._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||n._isSingularConnection()&&n._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(n),n._connectedPoint.push(this)}disconnectFrom(n){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const H=this._connectedPoint.indexOf(n),o=n._connectedPoint.indexOf(this);-1!==H&&-1!==o&&(y&&this._connectedPoint.splice(H,1),n._connectedPoint.splice(o,1))}disconnectFromAll(){for(const n of this._connectedPoint)this.disconnectFrom(n,!1);this._connectedPoint.length=0}dispose(){for(const n of this._connectedPoint)this.disconnectFrom(n)}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.uniqueId=this.uniqueId,n.name=this.name,n._connectionType=this._connectionType,n.connectedPointIds=[],n.className=this.getClassName();for(const y of this._connectedPoint)n.connectedPointIds.push(y.uniqueId)}getClassName(){return"FGConnection"}deserialize(n){this.uniqueId=n.uniqueId,this.name=n.name,this._connectionType=n._connectionType,this.connectedPointIds=n.connectedPointIds}}},13105:(n,y,H)=>{"use strict";H.d(y,{d:()=>v});var o,G=H(11099),h=H(11278),k=H(11280),i=H(11253),B=H(13108),V=H(13131),q=H(11114);!function(n){n.ExecuteBlock="ExecuteBlock",n.ExecuteEvent="ExecuteEvent",n.TriggerConnection="TriggerConnection",n.ContextVariableSet="ContextVariableSet",n.GlobalVariableSet="GlobalVariableSet",n.GlobalVariableDelete="GlobalVariableDelete",n.GlobalVariableGet="GlobalVariableGet",n.AddConnection="AddConnection",n.GetConnectionValue="GetConnectionValue",n.SetConnectionValue="SetConnectionValue",n.ActivateSignal="ActivateSignal",n.ContextVariableGet="ContextVariableGet"}(o||(o={}));class b{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(n){if(n.time||(n.time=Date.now()),this.log.push(n),this.logToConsole){var y;const H=null===(y=n.FH)||void 0===y?void 0:y.value;"object"===typeof H&&H.getClassName?q.d.Log(`[FGLog] ${n.className}:${n.uniqueId.split("-")[0]} ${n.action} - ${JSON.stringify(H.getClassName())}: ${H.toString()}`):q.d.Log(`[FGLog] ${n.className}:${n.uniqueId.split("-")[0]} ${n.action} - ${JSON.stringify(n.FH)}`)}}getItemsOfType(n){return this.log.filter((y=>y.action===n))}}class A{get enableLogging(){return this._enableLogging}set enableLogging(n){this._enableLogging!==n&&(this._enableLogging=n,this._enableLogging?(this.logger=new b,this.logger.logToConsole=!0):this.logger=null)}constructor(n){this.uniqueId=(0,i.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new G.c,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=n,this.assetsContext=n.assetsContext??n.ly}hasVariable(n){return n in this._userVariables}setVariable(n,y){var H;this._userVariables[n]=y,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",FH:{name:n,value:y}})}getAsset(n,y){return(0,V.d)(this.assetsContext,n,y)}getVariable(n){var y;return null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",FH:{name:n,value:this._userVariables[n]}}),this._userVariables[n]}get userVariables(){return this._userVariables}pn(){return this._configuration.ly}_getUniqueIdPrefixedName(n,y){return`${n.uniqueId}_${y}`}_getGlobalContextVariable(n,y){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",FH:{name:n,defaultValue:y,possibleValue:this._globalContextVariables[n]}}),this._hasGlobalContextVariable(n)?this._globalContextVariables[n]:y}_setGlobalContextVariable(n,y){var H;null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",FH:{name:n,value:y}}),this._globalContextVariables[n]=y}_deleteGlobalContextVariable(n){var y;null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",FH:{name:n}}),delete this._globalContextVariables[n]}_hasGlobalContextVariable(n){return n in this._globalContextVariables}_setExecutionVariable(n,y,H){this._executionVariables[this._getUniqueIdPrefixedName(n,y)]=H}_getExecutionVariable(n,y,H){return this._hasExecutionVariable(n,y)?this._executionVariables[this._getUniqueIdPrefixedName(n,y)]:H}_deleteExecutionVariable(n,y){delete this._executionVariables[this._getUniqueIdPrefixedName(n,y)]}_hasExecutionVariable(n,y){return this._getUniqueIdPrefixedName(n,y)in this._executionVariables}_hasConnectionValue(n){return n.uniqueId in this._connectionValues}_setConnectionValue(n,y){var H;this._connectionValues[n.uniqueId]=y,null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",FH:{connectionPointId:n.uniqueId,value:y}})}_setConnectionValueByKey(n,y){this._connectionValues[n]=y}_getConnectionValue(n){var y;return null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",FH:{connectionPointId:n.uniqueId,value:this._connectionValues[n.uniqueId]}}),this._connectionValues[n.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(n){this._pendingBlocks.includes(n)||(this._pendingBlocks.push(n),this._pendingBlocks.sort(((n,y)=>n.priority-y.priority)))}_removePendingBlock(n){const y=this._pendingBlocks.indexOf(n);-1!==y&&this._pendingBlocks.splice(y,1)}_clearPendingBlocks(){for(const n of this._pendingBlocks)n._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(n){var y;this.onNodeExecutedObservable.notifyObservers(n),null===(y=this.logger)||void 0===y||y.addLogItem({time:Date.now(),className:n.getClassName(),uniqueId:n.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(n){this._setGlobalContextVariable("timeSinceStart",n.timeSinceStart),this._setGlobalContextVariable("deltaTime",n.deltaTime);for(const H of this._pendingBlocks){var y;null===(y=H._executeOnTick)||void 0===y||y.call(H,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B.e;n.uniqueId=this.uniqueId,n._userVariables={};for(const o in this._userVariables)y(o,this._userVariables[o],n._userVariables);n._connectionValues={};for(const o in this._connectionValues)y(o,this._connectionValues[o],n._connectionValues);var H;this.assetsContext!==this.pn()&&(n._assetsContext={meshes:this.assetsContext.meshes.map((n=>n.id)),materials:this.assetsContext.materials.map((n=>n.id)),textures:this.assetsContext.textures.map((n=>n.name)),animations:this.assetsContext.animations.map((n=>n.name)),lights:this.assetsContext.lights.map((n=>n.id)),cameras:this.assetsContext.cameras.map((n=>n.id)),vU:null===(H=this.assetsContext.vU)||void 0===H?void 0:H.map((n=>n.name)),skeletons:this.assetsContext.skeletons.map((n=>n.id)),NA:this.assetsContext.NA.map((n=>n.name)),geometries:this.assetsContext.geometries.map((n=>n.id)),multiMaterials:this.assetsContext.multiMaterials.map((n=>n.id)),transformNodes:this.assetsContext.transformNodes.map((n=>n.id))})}getClassName(){return"FlowGraphContext"}}(0,h.e)([(0,k.J)()],A.prototype,"uniqueId",void 0);var U=H(13137),T=H(11601);class W{constructor(n){this.onEventTriggeredObservable=new G.c,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=n,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.ah.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const n=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",FH:{timeSinceStart:this._startingTime,deltaTime:n}}),this._startingTime+=n})),this._meshPickedObserver=this._scene.onPointerObservable.add((n=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",FH:n})}),T.b.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((n=>{const y=n.pointerId,H=n.mesh,o=this._pointerUnderMeshState[y];!o&&H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",FH:{pointerId:y,mesh:H}}):o&&!H?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",FH:{pointerId:y,mesh:o}}):o&&H&&o!==H&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",FH:{pointerId:y,mesh:o,over:H}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",FH:{pointerId:y,mesh:H,out:o}})),this._pointerUnderMeshState[y]=H}),T.b.POINTERMOVE)}dispose(){var n,y,H,o,G;null===(n=this._sceneDisposeObserver)||void 0===n||n.remove(),null===(y=this._sceneReadyObserver)||void 0===y||y.remove(),null===(H=this._sceneOnBeforeRenderObserver)||void 0===H||H.remove(),null===(o=this._meshPickedObserver)||void 0===o||o.remove(),null===(G=this._meshUnderPointerObserver)||void 0===G||G.remove(),this.onEventTriggeredObservable.clear()}}var z,Q=H(13152);!function(n){n[n.Stopped=0]="Stopped",n[n.Started=1]="Started"}(z||(z={}));class l{get state(){return this._state}set state(n){this._state=n,this.onStateChangedObservable.notifyObservers(n)}constructor(n){this.onStateChangedObservable=new G.c,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=n.ly,this._sceneEventCoordinator=new W(this._scene),this._coordinator=n.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((n=>{for(const y of this._executionContexts){const H=this._getContextualOrder(n.type,y);for(const o of H)if(!o._executeEvent(y,n.FH))break}switch(n.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const y of this._executionContexts)y._notifyOnTick(n.FH);break;case"SceneDispose":this.dispose()}}))}createContext(){const n=new A({ly:this._scene,coordinator:this._coordinator});return this._executionContexts.push(n),n}getContext(n){return this._executionContexts[n]}addEventBlock(n){if("PointerOver"!==n.type&&"PointerOut"!==n.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==n.type&&this._eventBlocks[n.type].push(n),1===this.state)for(const y of this._executionContexts)n._startPendingTasks(y);else this.onStateChangedObservable.addOnce((y=>{if(1===y)for(const H of this._executionContexts)n._startPendingTasks(H)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((n=>{1===n&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const n of this._executionContexts)for(const y in this._eventBlocks){const H=this._getContextualOrder(y,n);for(const y of H)y._startPendingTasks(n)}}_getContextualOrder(n,y){const H=this._eventBlocks[n].sort(((n,y)=>y.initPriority-n.initPriority));if("MeshPick"===n){const n=[];for(const o of H){const G=o.asset.getValue(y);let h=0;for(;h<H.length;h++){const n=H[h].asset.getValue(y);if(G&&n&&(0,Q.o)(G,n))break}n.splice(h,0,o)}return n}return H}dispose(){var n;if(0!==this.state){this.state=0;for(const n of this._executionContexts)n._clearPendingBlocks();this._executionContexts.length=0;for(const n in this._eventBlocks)this._eventBlocks[n].length=0;null===(n=this._eventObserver)||void 0===n||n.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(n){const y=[],H=new Set;for(const o in this._eventBlocks)for(const n of this._eventBlocks[o])y.push(n),H.add(n.uniqueId);for(;y.length>0;){const o=y.pop();n(o);for(const n of o.dataInputs)for(const o of n._connectedPoint)H.has(o._ownerBlock.uniqueId)||(y.push(o._ownerBlock),H.add(o._ownerBlock.uniqueId));if(o instanceof U.c)for(const n of o.signalOutputs)for(const o of n._connectedPoint)H.has(o._ownerBlock.uniqueId)||(y.push(o._ownerBlock),H.add(o._ownerBlock.uniqueId))}}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},y=arguments.length>1?arguments[1]:void 0;n.allBlocks=[],this.visitAllBlocks((y=>{const H={};y.serialize(H),n.allBlocks.push(H)})),n.executionContexts=[];for(const H of this._executionContexts){const o={};H.serialize(o,y),n.executionContexts.push(o)}}}class v{constructor(n){this.config=n,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.ly.ah.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.ly.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const n=this._executeOnNextFrame.slice(0);if(n.length)for(const y of n){this.notifyCustomEvent(y.id,y.data,!1);const n=this._executeOnNextFrame.findIndex((n=>n.uniqueId===y.uniqueId));-1!==n&&this._executeOnNextFrame.splice(n,1)}}));(v.SceneCoordinators.get(this.config.ly)??[]).push(this)}createGraph(){const n=new l({ly:this.config.ly,coordinator:this});return this._flowGraphs.push(n),n}removeGraph(n){const y=this._flowGraphs.indexOf(n);-1!==y&&(n.dispose(),this._flowGraphs.splice(y,1))}start(){for(const n of this._flowGraphs)n.start()}dispose(){var n,y;for(const G of this._flowGraphs)G.dispose();this._flowGraphs.length=0,null===(n=this._disposeObserver)||void 0===n||n.remove(),null===(y=this._onBeforeRenderObserver)||void 0===y||y.remove();const H=v.SceneCoordinators.get(this.config.ly)??[],o=H.indexOf(this);-1!==o&&H.splice(o,1)}serialize(n,y){n._flowGraphs=[];for(const H of this._flowGraphs){const o={};H.serialize(o,y),n._flowGraphs.push(o)}n.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(n){let y=this._customEventsMap.get(n);return y||(y=new G.c,this._customEventsMap.set(n,y)),y}notifyCustomEvent(n,y){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:n,data:y,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(n)){const y=this._eventExecutionCounter.get(n);if(this._eventExecutionCounter.set(n,y+1),y>=v.MaxEventTypeExecutionPerFrame)return void(y===v.MaxEventTypeExecutionPerFrame&&q.d.Warn(`FlowGraphCoordinator: Too many executions of event "${n}".`))}else this._eventExecutionCounter.set(n,1);const H=this._customEventsMap.get(n);H&&H.notifyObservers(y)}}v.MaxEventsPerType=30,v.MaxEventTypeExecutionPerFrame=30,v.SceneCoordinators=new Map},13157:(n,y,H)=>{"use strict";H.d(y,{b:()=>G});var o=H(13160);class G extends o.d{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(n){n._notifyExecuteNode(this),this.done._activateSignal(n)}}},13137:(n,y,H)=>{"use strict";H.d(y,{c:()=>i});var o=H(13146),G=H(13150),h=H(11248);class k extends G.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(n){super.connectTo(n),this._connectedPoint.sort(((n,y)=>y.priority-n.priority))}_activateSignal(n){var y;if(null===(y=n.logger)||void 0===y||y.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,FH:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)n._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(n,this),n._increaseExecutionId();else for(const H of this._connectedPoint)H._activateSignal(n)}}(0,h.h)("FlowGraphSignalConnection",k);class i extends o.c{constructor(n){super(n),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(n){const y=new k(n,0,this);return this.signalInputs.push(y),y}_registerSignalOutput(n){const y=new k(n,1,this);return this.signalOutputs.push(y),y}_unregisterSignalInput(n){const y=this.signalInputs.findIndex((y=>y.name===n));-1!==y&&(this.signalInputs[y].dispose(),this.signalInputs.splice(y,1))}_unregisterSignalOutput(n){const y=this.signalOutputs.findIndex((y=>y.name===n));-1!==y&&(this.signalOutputs[y].dispose(),this.signalOutputs.splice(y,1))}_reportError(n,y){this.error.FH="string"===typeof y?new Error(y):y,this.error._activateSignal(n)}getSignalInput(n){return this.signalInputs.find((y=>y.name===n))}getSignalOutput(n){return this.signalOutputs.find((y=>y.name===n))}serialize(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(n),n.signalInputs=[],n.signalOutputs=[];for(const y of this.signalInputs){const H={};y.serialize(H),n.signalInputs.push(H)}for(const y of this.signalOutputs){const H={};y.serialize(H),n.signalOutputs.push(H)}}deserialize(n){for(let y=0;y<n.signalInputs.length;y++){const H=this.getSignalInput(n.signalInputs[y].name);if(!H)throw new Error("Could not find signal input with name "+n.signalInputs[y].name+" in block "+n.className);H.deserialize(n.signalInputs[y])}for(let y=0;y<n.signalOutputs.length;y++){const H=this.getSignalOutput(n.signalOutputs[y].name);if(!H)throw new Error("Could not find signal output with name "+n.signalOutputs[y].name+" in block "+n.className);H.deserialize(n.signalOutputs[y])}}getClassName(){return"FlowGraphExecutionBlock"}}},13162:(n,y,H)=>{"use strict";H.d(y,{b:()=>G});var o=H(13137);class G extends o.c{constructor(n){super(n),this.out=this._registerSignalOutput("out")}}},13117:(n,y,H)=>{"use strict";H.d(y,{A:()=>p,B:()=>E,D:()=>c,G:()=>f,c:()=>V,e:()=>A,f:()=>M,i:()=>z,k:()=>Q,o:()=>l,p:()=>b,s:()=>g,v:()=>q,w:()=>U,x:()=>T,y:()=>W});var o,G=H(11288),h=H(11335),k=H(13112),i=H(13124);!function(n){n.Any="any",n.String="string",n.Number="number",n.Boolean="boolean",n.Object="object",n.Integer="FlowGraphInteger",n.Vector2="Vector2",n.zy="zy",n.Vector4="Vector4",n.Quaternion="Quaternion",n.Matrix="Matrix",n.Matrix2D="Matrix2D",n.Matrix3D="Matrix3D",n.Fy="Fy",n.pi="pi"}(o||(o={}));class B{constructor(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=n,this.defaultValue=y,this.animationType=H}serialize(n){n.typeName=this.typeName,n.defaultValue=this.defaultValue}}const V=new B("any",void 0),q=new B("string",""),b=new B("number",0,0),A=new B("boolean",!1),U=new B("Vector2",G.Vector2.Zero(),5),T=new B("zy",G.zy.Zero(),1),W=new B("Vector4",G.Vector4.Zero()),z=new B("Matrix",G.Matrix.Identity(),3),Q=new B("Matrix2D",new i.e),l=new B("Matrix3D",new i.i),v=new B("Fy",h.Fy.Black(),4),F=new B("pi",new h.pi(0,0,0,0),7),g=new B("Quaternion",G.Quaternion.Identity(),2);g.typeTransformer=n=>{if(n.getClassName){if("Vector4"===n.getClassName())return G.Quaternion.gy(n.Ui());if("zy"===n.getClassName())return G.Quaternion.FromEulerVector(n);if("Matrix"===n.getClassName())return G.Quaternion.FromRotationMatrix(n)}return n};const M=new B("FlowGraphInteger",new k.c(0),0);function f(n){const y=n;switch(typeof n){case"string":return q;case"number":return b;case"boolean":return A;case"object":if(y.getClassName)switch(y.getClassName()){case"Vector2":return U;case"zy":return T;case"Vector4":return W;case"Matrix":return z;case"Fy":return v;case"pi":return F;case"Quaternion":return g;case"FlowGraphInteger":return M;case"Matrix2D":return Q;case"Matrix3D":return l}return V;default:return V}}function c(n){switch(n){case"string":return q;case"number":return b;case"boolean":return A;case"Vector2":return U;case"zy":return T;case"Vector4":return W;case"Matrix":return z;case"Fy":return v;case"pi":return F;case"Quaternion":return g;case"FlowGraphInteger":return M;case"Matrix2D":return Q;case"Matrix3D":return l;default:return V}}function p(n){switch(n){case"number":default:return 0;case"Vector2":return 5;case"zy":return 1;case"Matrix":return 3;case"Fy":return 4;case"pi":return 7;case"Quaternion":return 2}}function E(n){switch(n){case 0:return b;case 5:return U;case 1:return T;case 3:return z;case 4:return v;case 7:return F;case 2:return g;default:return V}}},13108:(n,y,H)=>{"use strict";H.d(y,{c:()=>q,e:()=>V,g:()=>b});var o=H(11335),G=H(11288),h=H(13112),k=H(13117),i=H(13124);function B(n){return"Vector2"===n||"zy"===n||"Vector4"===n||"Quaternion"===n||"Fy"===n||"pi"===n}function V(n,y,H){var o;const G=(null===y||void 0===y||null===(o=y.getClassName)||void 0===o?void 0:o.call(y))??"";if(B(G)||function(n){return"Matrix"===n||"Matrix2D"===n||"Matrix3D"===n}(G))H[n]={value:y.Ui(),className:G};else if("FlowGraphInteger"===G)H[n]={value:y.value,className:G};else if(G&&(y.id||y.name))H[n]={id:y.id,name:y.name,className:G};else{if("object"===typeof y)throw new Error(`Could not serialize value ${y}`);H[n]=y}}function q(n,y,H,V){const b=y[n];let A;const U=(null===b||void 0===b?void 0:b.type)??(null===b||void 0===b?void 0:b.className);if(function(n){return"Mesh"===n||"AbstractMesh"===n||"GroundMesh"===n||"InstanceMesh"===n||"LinesMesh"===n||"GoldbergMesh"===n||"GreasedLineMesh"===n||"TrailMesh"===n}(U)){let n=V.meshes.filter((n=>b.id?n.id===b.id:n.name===b.name));0===n.length&&(n=V.transformNodes.filter((n=>b.id?n.id===b.id:n.name===b.name))),A=b.uniqueId?n.find((n=>n.uniqueId===b.uniqueId)):n[0]}else if(B(U))A=function(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===n)return G.Vector2.gy(y);if("zy"===n)return H&&(y[2]*=-1),G.zy.gy(y);if("Vector4"===n)return G.Vector4.gy(y);if("Quaternion"===n)return H&&(y[2]*=-1,y[3]*=-1),G.Quaternion.gy(y);if("Fy"===n)return new o.Fy(y[0],y[1],y[2]);if("pi"===n)return new o.pi(y[0],y[1],y[2],y[3]);throw new Error(`Unknown vector class name ${n}`)}(U,b.value);else if(function(n){return"AnimationGroup"===n}(U)){const n=V.animationGroups.filter((n=>n.name===b.name));A=1===n.length?n[0]:n.find((n=>n.uniqueId===b.uniqueId))}else A="Matrix"===U?G.Matrix.gy(b.value):"Matrix2D"===U?new i.e(b.value):"Matrix3D"===U?new i.i(b.value):"FlowGraphInteger"===U?h.c.FromValue(b.value):"number"===U||"string"===U||"boolean"===U?b.value[0]:b&&void 0!==b.value?b.value:Array.isArray(b)?b.reduce(((n,y)=>y.eventData?(n[y.id]={type:(0,k.D)(y.type)},"undefined"!==typeof y.value&&(n[y.id].value=q("value",y,H,V)),n):n),{}):b;return A}function b(n){return"FlowGraphJsonPointerParserBlock"===n}},13152:(n,y,H)=>{"use strict";function o(n,y){return!(!n.parent||n.parent!==y&&!o(n.parent,y))}function G(n){if(n.getClassName)return n.getClassName()}function h(n,y){return n===y&&("Vector2"===n||"zy"===n||"Vector4"===n||"Quaternion"===n)}function k(n,y){return n===y&&("Matrix"===n||"Matrix2D"===n||"Matrix3D"===n)}function i(n,y){return"FlowGraphInteger"===n&&"FlowGraphInteger"===y}function B(n,y){const H="number"===typeof n||"number"===typeof(null===n||void 0===n?void 0:n.value);return H&&!y?!isNaN(V(n)):H}function V(n){return"number"===typeof n?n:n.value}H.d(y,{d:()=>i,e:()=>k,h:()=>h,l:()=>G,o:()=>o,s:()=>V,t:()=>B})},12484:(n,y,H)=>{"use strict";H.r(y),H.d(y,{SceneInstrumentation:()=>h});var o=H(11094),G=H(11534);class h{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(n){n!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=n,n?(this._onBeforeActiveMeshesEvaluationObserver=this.ly.onBeforeActiveMeshesEvaluationObservable.add((()=>{o.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.ly.onAfterActiveMeshesEvaluationObservable.add((()=>{o.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.ly.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ly.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(n){n!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=n,n?(this._onBeforeRenderTargetsRenderObserver=this.ly.onBeforeRenderTargetsRenderObservable.add((()=>{o.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.ly.onAfterRenderTargetsRenderObservable.add((()=>{o.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.ly.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ly.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(n){n!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=n,n?(this._onBeforeParticlesRenderingObserver=this.ly.onBeforeParticlesRenderingObservable.add((()=>{o.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.ly.onAfterParticlesRenderingObservable.add((()=>{o.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.ly.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ly.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(n){n!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=n,this.ly.spriteManagers&&(n?(this._onBeforeSpritesRenderingObserver=this.ly.onBeforeSpritesRenderingObservable.add((()=>{o.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.ly.onAfterSpritesRenderingObservable.add((()=>{o.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.ly.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.ly.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(n){n!==this._capturePhysicsTime&&this.ly.onBeforePhysicsObservable&&(this._capturePhysicsTime=n,n?(this._onBeforePhysicsObserver=this.ly.onBeforePhysicsObservable.add((()=>{o.Tools.StartPerformanceCounter("hb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.ly.onAfterPhysicsObservable.add((()=>{o.Tools.EndPerformanceCounter("hb"),this._physicsTime.endMonitoring()}))):(this.ly.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.ly.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(n){n!==this._captureAnimationsTime&&(this._captureAnimationsTime=n,n?this._onAfterAnimationsObserver=this.ly.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.ly.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(n){this._captureFrameTime=n}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(n){this._captureInterFrameTime=n}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(n){n!==this._captureRenderTime&&(this._captureRenderTime=n,n?(this._onBeforeDrawPhaseObserver=this.ly.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),o.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.ly.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),o.Tools.EndPerformanceCounter("Main render")}))):(this.ly.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ly.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(n){n!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=n,n?(this._onBeforeCameraRenderObserver=this.ly.onBeforeCameraRenderObservable.add((n=>{this._cameraRenderTime.beginMonitoring(),o.Tools.StartPerformanceCounter(`Rendering camera ${n.name}`)})),this._onAfterCameraRenderObserver=this.ly.onAfterCameraRenderObservable.add((n=>{this._cameraRenderTime.endMonitoring(!1),o.Tools.EndPerformanceCounter(`Rendering camera ${n.name}`)}))):(this.ly.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ly.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.ly.getEngine()._drawCalls}constructor(n){this.ly=n,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new G.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new G.e,this._captureFrameTime=!1,this._frameTime=new G.e,this._captureRenderTime=!1,this._renderTime=new G.e,this._captureInterFrameTime=!1,this._interFrameTime=new G.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new G.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new G.e,this._capturePhysicsTime=!1,this._physicsTime=new G.e,this._captureAnimationsTime=!1,this._animationsTime=new G.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new G.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=n.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(o.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.ly.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=n.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(o.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Eh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Eh(),this._captureParticlesRenderTime&&this._particlesRenderTime.Eh(),this._captureSpritesRenderTime&&this._spritesRenderTime.Eh(),this._captureRenderTime&&this._renderTime.Eh(),this._captureCameraRenderTime&&this._cameraRenderTime.Eh()}))}dispose(){this._disposed||(this.ly.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.ly.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.ly.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.ly.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.ly.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.ly.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.ly.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.ly.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.ly.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.ly.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.ly.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.ly.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.ly.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.ly.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.ly.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.ly.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.ly.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.ly=null,this._disposed=!0)}}},13102:(n,y,H)=>{"use strict";H.d(y,{c:()=>q});var o=H(11278),G=H(11280),h=H(11288),k=H(11775),i=H(11907),B=H(11972),V=H(11248);k.c.AddNodeConstructor("Light_Type_1",((n,y)=>()=>new q(n,h.zy.Zero(),y)));class q extends B.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(n){this._shadowFrustumSize=n,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(n){this._shadowOrthoScale=n,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(n){this._orthoLeft=n}get orthoRight(){return this._orthoRight}set orthoRight(n){this._orthoRight=n}get orthoTop(){return this._orthoTop}set orthoTop(n){this._orthoTop=n}get orthoBottom(){return this._orthoBottom}set orthoBottom(n){this._orthoBottom=n}constructor(n,y,H){super(n,H),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=y.scale(-1),this.direction=y}getClassName(){return"ib"}getTypeID(){return i.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(n,y,H){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(n):this._setDefaultAutoExtendShadowProjectionMatrix(n,y,H)}_setDefaultFixedFrustumShadowProjectionMatrix(n){const y=this.pn().activeCamera;y&&h.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:y.Wi,void 0!==this.shadowMaxZ?this.shadowMaxZ:y.maxZ,n,this.pn().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(n,y,H){const o=this.pn().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const n=h.zy.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let o=Number.MAX_VALUE,G=-Number.MAX_VALUE;for(let k=0;k<H.length;k++){const i=H[k];if(!i)continue;const B=i.getBoundingInfo().boundingBox;for(let H=0;H<B.vectorsWorld.length;H++)h.zy.TransformCoordinatesToRef(B.vectorsWorld[H],y,n),n.x<this._orthoLeft&&(this._orthoLeft=n.x),n.y<this._orthoBottom&&(this._orthoBottom=n.y),n.x>this._orthoRight&&(this._orthoRight=n.x),n.y>this._orthoTop&&(this._orthoTop=n.y),this.autoCalcShadowZBounds&&(n.z<o&&(o=n.z),n.z>G&&(G=n.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=o,this._shadowMaxZ=G)}const G=this._orthoRight-this._orthoLeft,k=this._orthoTop-this._orthoBottom,i=void 0!==this.shadowMinZ?this.shadowMinZ:(null===o||void 0===o?void 0:o.Wi)||0,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===o||void 0===o?void 0:o.maxZ)||1e4,V=this.pn().getEngine().useReverseDepthBuffer;h.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-G*this.shadowOrthoScale,this._orthoRight+G*this.shadowOrthoScale,this._orthoBottom-k*this.shadowOrthoScale,this._orthoTop+k*this.shadowOrthoScale,V?B:i,V?i:B,n,this.pn().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(n,y){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,y),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,y),this)}transferToNodeMaterialEffect(n,y){return this.computeTransformedInformation()?(n.setFloat3(y,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(n.setFloat3(y,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(n){const y=this._scene.getEngine();return!y.useReverseDepthBuffer&&y.isNDCHalfZRange?0:1}getDepthMaxZ(n){const y=this._scene.getEngine();return y.useReverseDepthBuffer&&y.isNDCHalfZRange?0:1}prepareLightSpecificDefines(n,y){n["DIRLIGHT"+y]=!0}}(0,o.e)([(0,G.J)()],q.prototype,"shadowFrustumSize",null),(0,o.e)([(0,G.J)()],q.prototype,"shadowOrthoScale",null),(0,o.e)([(0,G.J)()],q.prototype,"autoUpdateExtends",void 0),(0,o.e)([(0,G.J)()],q.prototype,"autoCalcShadowZBounds",void 0),(0,o.e)([(0,G.J)("orthoLeft")],q.prototype,"_orthoLeft",void 0),(0,o.e)([(0,G.J)("orthoRight")],q.prototype,"_orthoRight",void 0),(0,o.e)([(0,G.J)("orthoTop")],q.prototype,"_orthoTop",void 0),(0,o.e)([(0,G.J)("orthoBottom")],q.prototype,"_orthoBottom",void 0),(0,V.h)("BABYLON.DirectionalLight",q)},13573:(n,y,H)=>{"use strict";H.d(y,{d:()=>q});var o=H(11278),G=H(11280),h=H(11288),k=H(11335),i=H(11775),B=H(11907),V=H(11248);i.c.AddNodeConstructor("Light_Type_3",((n,y)=>()=>new q(n,h.zy.Zero(),y)));class q extends B.e{constructor(n,y,H){super(n,H),this.groundColor=new k.Fy(0,0,0),this.direction=y||h.zy.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Bb"}setDirectionToTarget(n){return this.direction=h.zy.Normalize(n.Qy(h.zy.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(n,y){const H=h.zy.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",H.x,H.y,H.z,0,y),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.di),y),this}transferToNodeMaterialEffect(n,y){const H=h.zy.Normalize(this.direction);return n.setFloat3(y,H.x,H.y,H.z),this}Qi(){return this._worldMatrix||(this._worldMatrix=h.Matrix.Identity()),this._worldMatrix}getTypeID(){return B.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(n,y){n["HEMILIGHT"+y]=!0}}(0,o.e)([(0,G.i)()],q.prototype,"groundColor",void 0),(0,o.e)([(0,G.F)()],q.prototype,"direction",void 0),(0,V.h)("BABYLON.HemisphericLight",q)},13065:(n,y,H)=>{"use strict";H.d(y,{b:()=>b});var o=H(11278),G=H(11280),h=H(11288),k=H(11775),i=H(11907),B=H(11972),V=H(11269),q=H(11248);k.c.AddNodeConstructor("Light_Type_2",((n,y)=>()=>new b(n,h.zy.Zero(),h.zy.Zero(),0,0,y)));class b extends B.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(n){this._iesProfileTexture!==n&&(this._iesProfileTexture=n,this._iesProfileTexture&&b._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(n){this._angle=n,this._cosHalfAngle=Math.cos(.5*n),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(n){this._innerAngle=n,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(n){this._shadowAngleScale=n,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(n){this._projectionTextureLightNear=n,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(n){this._projectionTextureLightFar=n,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(n){this._projectionTextureUpDirection=n,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(n){this._projectionTexture!==n&&(this._projectionTexture=n,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(b._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):b._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(n){return void 0!==n.onGeneratedObservable}static _IsTexture(n){return void 0!==n.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(n){this._projectionTextureProjectionLightMatrix=n,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(n,y,H,o,G,k){super(n,k),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=h.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=h.zy.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=h.zy.Zero(),this._projectionTextureViewLightMatrix=h.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=h.Matrix.Zero(),this._projectionTextureScalingMatrix=h.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=y,this.direction=H,this.angle=o,this.exponent=G}getClassName(){return"SpotLight"}getTypeID(){return i.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(n){super._setDirection(n),this._projectionTextureViewLightDirty=!0}_setPosition(n){super._setPosition(n),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(n,y,H){const o=this.pn().activeCamera;if(!o)return;this._shadowAngleScale=this._shadowAngleScale||1;const G=this._shadowAngleScale*this._angle,k=void 0!==this.shadowMinZ?this.shadowMinZ:o.Wi,i=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,B=this.pn().getEngine().useReverseDepthBuffer;h.Matrix.PerspectiveFovLHToRef(G,1,B?i:k,B?k:i,n,!0,this._scene.getEngine().isNDCHalfZRange,void 0,B)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),h.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const n=this.projectionTextureLightFar,y=this.projectionTextureLightNear,H=n/(n-y),o=-H*y,G=1/Math.tan(this._angle/2);h.Matrix.FromValuesToRef(G/1,0,0,0,0,G,0,0,0,0,H,1,0,0,o,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof V.b){const n=this._projectionTexture.uScale/2,y=this._projectionTexture.vScale/2;h.Matrix.FromValuesToRef(n,0,0,0,0,y,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(n,y){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),n.setMatrix("textureProjectionMatrix"+y,this._projectionTextureMatrix),n.setTexture("projectionLightTexture"+y,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&n.setTexture("iesLightTexture"+y,this._iesProfileTexture),this}transferToEffect(n,y){let H;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,y),H=h.zy.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,y),H=h.zy.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",H.x,H.y,H.z,this._cosHalfAngle,y),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,y),this}transferToNodeMaterialEffect(n,y){let H;return H=this.computeTransformedInformation()?h.zy.Normalize(this.transformedDirection):h.zy.Normalize(this.direction),this.pn().useRightHandedSystem?n.setFloat3(y,-H.x,-H.y,-H.z):n.setFloat3(y,H.x,H.y,H.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(n){const y=this._scene.getEngine(),H=void 0!==this.shadowMinZ?this.shadowMinZ:(null===n||void 0===n?void 0:n.Wi)??0;return y.useReverseDepthBuffer&&y.isNDCHalfZRange?H:this._scene.getEngine().isNDCHalfZRange?0:H}getDepthMaxZ(n){const y=this._scene.getEngine(),H=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===n||void 0===n?void 0:n.maxZ)??1e4;return y.useReverseDepthBuffer&&y.isNDCHalfZRange?0:H}prepareLightSpecificDefines(n,y){n["SPOTLIGHT"+y]=!0,n["PROJECTEDLIGHTTEXTURE"+y]=!(!this.projectionTexture||!this.projectionTexture.isReady()),n["IESLIGHTTEXTURE"+y]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,o.e)([(0,G.J)()],b.prototype,"angle",null),(0,o.e)([(0,G.J)()],b.prototype,"innerAngle",null),(0,o.e)([(0,G.J)()],b.prototype,"shadowAngleScale",null),(0,o.e)([(0,G.J)()],b.prototype,"exponent",void 0),(0,o.e)([(0,G.J)()],b.prototype,"projectionTextureLightNear",null),(0,o.e)([(0,G.J)()],b.prototype,"projectionTextureLightFar",null),(0,o.e)([(0,G.J)()],b.prototype,"projectionTextureUpDirection",null),(0,o.e)([(0,G.A)("projectedLightTexture")],b.prototype,"_projectionTexture",void 0),(0,q.h)("BABYLON.SpotLight",b)},12766:(n,y,H)=>{"use strict";H.d(y,{b:()=>k,c:()=>h,d:()=>i});const o={},G={};function h(n,y){o[n]=y}function k(n,y){G[n]=y}function i(n){return G[n]?G[n]:null}},12661:(n,y,H)=>{"use strict";H.d(y,{e:()=>f,i:()=>I});var o,G=H(11094),h=H(11099),k=H(11554),i=H(11149),B=H(11114),V=H(11818),q=H(11154),b=H(11161),A=H(11253),U=H(11189),T=H(11140);!function(n){n[n.Clean=0]="Clean",n[n.Stop=1]="Stop",n[n.Sync=2]="Sync",n[n.NoSync=3]="NoSync"}(o||(o={}));const W=new h.c,z={};let Q=!1;function l(){return z[".babylon"]}function v(n,y){const H=z[n];return H||(B.d.Warn("Unable to find a plugin to load "+n+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),y?l():void 0)}function F(n,y,H){let o="Unable to load from "+(n.rawData?"binary data":n.url);return y?o+=`: ${y}`:H&&(o+=`: ${H}`),o}async function g(n,y,H,o,G,h,k,i,B){var V;const b="data:"===(A=n.url).substring(0,5)?A.substring(5):null;var A;if(n.rawData&&!k)throw"When using ArrayBufferView to load data the file extension must be provided.";const Q=b||k?"":function(n){const y=n.indexOf("?");-1!==y&&(n=n.substring(0,y));const H=n.lastIndexOf(".");return n.substring(H,n.length).toLowerCase()}(n.url);let F=k?v(k,!0):b?function(n){for(const y in z){const H=z[y].plugin;if(H.canDirectLoad&&H.canDirectLoad(n))return z[y]}return l()}(n.url):v(Q,!1);if(!F&&Q){if(n.url&&!n.url.startsWith("blob:")){const y=await async function(n,y){const H=y.method||"GET";return await new Promise(((o,G)=>{const h=new T.b;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const n={};if(y.responseHeaders)for(const H of y.responseHeaders)n[H]=h.getResponseHeader(H)||"";o({response:h.response,headerValues:n})}else G(`Unable to fetch data from ${n}. Error code: ${h.status}`)})),h.open(H,n),h.send()}))}(n.url,{method:"HEAD",responseHeaders:["Content-Type"]}),H=y.headerValues?y.headerValues["Content-Type"]:"";H&&(F=function(n){for(const y in z){const H=z[y];if(H.mimeType===n)return H}}(H))}F||(F=l())}if(!F)throw new Error(`No plugin or fallback for ${k??n.url}`);if(!1===(null===B||void 0===B||null===(V=B[F.plugin.name])||void 0===V?void 0:V.enabled))throw new Error(`The '${F.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(n.rawData&&!F.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(n=>{if(F.plugin.createPlugin){const y=F.plugin.createPlugin(B??{});return y instanceof Promise?(y.then(n).catch((n=>{G("Error instantiating plugin.",n)})),null):(n(y),y)}return n(F.plugin),F.plugin})((B=>{var V;if(!B)throw`The loader plugin corresponding to the '${k}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(W.notifyObservers(B),b&&(B.canDirectLoad&&B.canDirectLoad(n.url)||!(0,q.k)(n.url))){if(B.directLoad){const n=B.directLoad(y,b);n instanceof Promise?n.then((n=>{H(B,n)})).catch((n=>{G("Error in directLoad of _loadData: "+n,n)})):H(B,n)}else H(B,b);return}const A=F.isBinary,T=(n,o)=>{y.A?G("Scene has been disposed"):H(B,n,o)};let z=null,Q=!1;null===(V=B.ah)||void 0===V||V.add((()=>{Q=!0,z&&(z.abort(),z=null),h()}));const l=()=>{if(Q)return;const H=(n,y)=>{G(null===n||void 0===n?void 0:n.statusText,y)};if(!B.loadFile&&n.rawData)throw"Plugin does not support loading ArrayBufferView.";z=B.loadFile?B.loadFile(y,n.rawData||n.file||n.url,n.rootUrl,T,o,A,H,i):y._loadFile(n.file||n.url,T,o,!0,A,H)},v=y.getEngine();let g=v.enableOfflineSupport;if(g){let H=!1;for(const o of y.disableOfflineSupportExceptionRules)if(o.test(n.url)){H=!0;break}g=!H}g&&U.e.OfflineProviderFactory?y.offlineProvider=U.e.OfflineProviderFactory(n.url,l,v.disableManifestCheck):l()}))}function M(n,y){let H,o,h=null,k=null;if(y)if(y.name)H=`file:${y.name}`,o=y.name,h=y;else if(ArrayBuffer.isView(y))H="",o=(0,A.b)(),k=y;else if(y.startsWith("data:"))H=y,o="";else if(n){const h=y;if("/"===h.substring(0,1))return G.Tools.Error("Wrong sceneFilename parameter"),null;H=n+h,o=h}else H=y,o=G.Tools.GetFilename(y),n=G.Tools.GetFolderPath(y);else H=n,o=G.Tools.GetFilename(n),n=G.Tools.GetFolderPath(n);return{url:H,rootUrl:n,name:o,file:h,rawData:k}}function f(n){if("string"===typeof n.extensions){const y=n.extensions;z[y.toLowerCase()]={plugin:n,isBinary:!1}}else{const y=n.extensions,H=Object.keys(y);for(const o of H)z[o.toLowerCase()]={plugin:n,isBinary:y[o].isBinary,mimeType:y[o].mimeType}}}async function c(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i.c.LastCreatedScene,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!o)return B.d.Error("No scene available to import mesh to"),null;const U=M(y,H);if(!U)return null;const T={};o.addPendingData(T);const W=()=>{o.removePendingData(T)},z=(n,y)=>{const H=F(U,n,y);k?k(o,H,new b.h(H,b.e.SceneLoaderError,y)):B.d.Error(H),W()},Q=h?n=>{try{h(n)}catch(y){z("Error in onProgress callback: "+y,y)}}:void 0,l=(n,y,H,h,k,i,B,V)=>{if(o.importedMeshesFiles.push(U.url),G)try{G(n,y,H,h,k,i,B,V)}catch(q){z("Error in onSuccess callback: "+q,q)}o.removePendingData(T)};return await g(U,o,((y,H,G)=>{if(y.rewriteRootURL&&(U.rootUrl=y.rewriteRootURL(U.rootUrl,G)),y.importMesh){const G=[],h=[],k=[];if(!y.importMesh(n,o,H,U.rootUrl,G,h,k,z))return;o.loadingPluginName=y.name,l(G,h,k,[],[],[],[],[])}else{y.importMeshAsync(n,o,H,U.rootUrl,Q,U.name).then((n=>{o.loadingPluginName=y.name,l(n.meshes,n.NA,n.skeletons,n.animationGroups,n.transformNodes,n.geometries,n.lights,n.spriteManagers)})).catch((n=>{z(n.message,n)}))}}),Q,z,W,V,q,A)}async function p(n,y,H,o,G,h,k,i){return await new Promise(((B,V)=>{try{c(n,y,H,o,((n,y,H,o,G,h,k,i)=>{B({meshes:n,NA:y,skeletons:H,animationGroups:o,transformNodes:G,geometries:h,lights:k,spriteManagers:i})}),G,((n,y,H)=>{V(H||new Error(y))}),h,k,i).catch(V)}catch(b){V(b)}}))}async function E(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedEngine,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};H?await d(n,y,new k.e(H),o,h,B,V,q,b):G.Tools.Error("No engine available")}async function X(n,y,H,o,G,h,k){return await new Promise(((i,B)=>{E(n,y,H,(n=>{i(n)}),o,((n,y,H)=>{B(H||new Error(y))}),G,h,k)}))}async function d(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return B.d.Error("No scene available to append to"),null;const U=M(n,y);if(!U)return null;const T={};H.addPendingData(T);const W=()=>{H.removePendingData(T)};V.e.ShowLoadingScreen&&!Q&&(Q=!0,H.getEngine().displayLoadingUI(),H.executeWhenReady((()=>{H.getEngine().hideLoadingUI(),Q=!1})));const z=(n,y)=>{const o=F(U,n,y);h?h(H,o,new b.h(o,b.e.SceneLoaderError,y)):B.d.Error(o),W()},l=G?n=>{try{G(n)}catch(y){z("Error in onProgress callback",y)}}:void 0,v=()=>{if(o)try{o(H)}catch(n){z("Error in onSuccess callback",n)}H.removePendingData(T)};return await g(U,H,((n,y)=>{if(n.load){if(!n.load(H,y,U.rootUrl,z))return;H.loadingPluginName=n.name,v()}else{n.loadAsync(H,y,U.rootUrl,l,U.name).then((()=>{H.loadingPluginName=n.name,v()})).catch((n=>{z(n.message,n)}))}}),l,z,W,k,q,A)}async function a(n,y,H,o,G,h,k){return await new Promise(((i,B)=>{try{d(n,y,H,(n=>{i(n)}),o,((n,y,H)=>{B(H||new Error(y))}),G,h,k).catch(B)}catch(b){B(b)}}))}async function O(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedScene,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!H)return B.d.Error("No scene available to load asset container to"),null;const A=M(n,y);if(!A)return null;const U={};H.addPendingData(U);const T=()=>{H.removePendingData(U)},W=(n,y)=>{const o=F(A,n,y);h?h(H,o,new b.h(o,b.e.SceneLoaderError,y)):B.d.Error(o),T()},z=G?n=>{try{G(n)}catch(y){W("Error in onProgress callback",y)}}:void 0,Q=n=>{if(o)try{o(n)}catch(y){W("Error in onSuccess callback",y)}H.removePendingData(U)};return await g(A,H,((n,y)=>{if(n.loadAssetContainer){const o=n.loadAssetContainer(H,y,A.rootUrl,W);if(!o)return;o.populateRootNodes(),H.loadingPluginName=n.name,Q(o)}else if(n.loadAssetContainerAsync){n.loadAssetContainerAsync(H,y,A.rootUrl,z,A.name).then((y=>{y.populateRootNodes(),H.loadingPluginName=n.name,Q(y)})).catch((n=>{W(n.message,n)}))}else W("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),z,W,T,k,V,q)}async function e(n,y,H,o,G,h,k){return await new Promise(((i,B)=>{try{O(n,y,H,(n=>{i(n)}),o,((n,y,H)=>{B(H||new Error(y))}),G,h,k).catch(B)}catch(b){B(b)}}))}async function w(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.c.LastCreatedScene,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,A=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!H)return void B.d.Error("No scene available to load animations to");if(o){for(const o of H.animatables)o.reset();H.stopAllAnimations();const n=H.animationGroups.slice();for(const H of n)H.dispose();const y=H.getNodes();for(const H of y)H.animations&&(H.animations=[])}else switch(G){case 0:const n=H.animationGroups.slice();for(const y of n)y.dispose();break;case 1:for(const y of H.animationGroups)y.stop();break;case 2:for(const y of H.animationGroups)y.reset(),y.restart();break;case 3:break;default:return void B.d.Error("Unknown animation group loading mode value '"+G+"'")}const T=H.animatables.length;await O(n,y,H,(n=>{n.mergeAnimationsTo(H,H.animatables.slice(T),h),n.dispose(),H.onAnimationFileImportedObservable.notifyObservers(H),k&&k(H)}),V,q,b,A,U)}async function j(n,y,H,o,G,h,k,i,B,V){return await new Promise(((q,A)=>{try{w(n,y,H,o,G,h,(n=>{q(n)}),k,((n,y,H)=>{A(H||new Error(y))}),i,B,V).catch(A)}catch(b){A(b)}}))}class I{static get ForceFullSceneLoadingForIncremental(){return V.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(n){V.e.ForceFullSceneLoadingForIncremental=n}static get ShowLoadingScreen(){return V.e.ShowLoadingScreen}static set ShowLoadingScreen(n){V.e.ShowLoadingScreen=n}static get loggingLevel(){return V.e.loggingLevel}static set loggingLevel(n){V.e.loggingLevel=n}static get CleanBoneMatrixWeights(){return V.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(n){V.e.CleanBoneMatrixWeights=n}static GetDefaultPlugin(){return l()}static GetPluginForExtension(n){var y;return null===(y=v(n,!0))||void 0===y?void 0:y.plugin}static IsPluginForExtensionAvailable(n){return function(n){return!!z[n]}(n)}static RegisterPlugin(n){f(n)}static ImportMesh(n,y,H,o,G,h,k,B,V){c(n,y,H,o,G,h,k,B,V).catch((n=>null===k||void 0===k?void 0:k(i.c.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async ImportMeshAsync(n,y,H,o,G,h,k){return await p(n,y,H,o,G,h,k)}static Load(n,y,H,o,G,h,k,B){E(n,y,H,o,G,h,k,B).catch((n=>null===h||void 0===h?void 0:h(i.c.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async LoadAsync(n,y,H,o,G,h){return await X(n,y,H,o,G,h)}static Append(n,y,H,o,G,h,k,B){d(n,y,H,o,G,h,k,B).catch((n=>null===h||void 0===h?void 0:h(H??i.c.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async AppendAsync(n,y,H,o,G,h){return await a(n,y,H,o,G,h)}static LoadAssetContainer(n,y,H,o,G,h,k,B){O(n,y,H,o,G,h,k,B).catch((n=>null===h||void 0===h?void 0:h(H??i.c.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async LoadAssetContainerAsync(n,y,H,o,G,h){return await e(n,y,H,o,G,h)}static ImportAnimations(n,y,H,o,G,h,k,B,V,q,b){w(n,y,H,o,G,h,k,B,V,q,b).catch((n=>null===V||void 0===V?void 0:V(H??i.c.LastCreatedScene,null===n||void 0===n?void 0:n.message,n)))}static async ImportAnimationsAsync(n,y,H,o,G,h,k,i,B,V,q){return await j(n,y,H,o,G,h,i,V,q)}}I.NO_LOGGING=0,I.MINIMAL_LOGGING=1,I.SUMMARY_LOGGING=2,I.DETAILED_LOGGING=3,I.OnPluginActivatedObservable=W},13086:(n,y,H)=>{"use strict";H.d(y,{b:()=>A});var o=H(11278),G=H(11280),h=H(11094),k=H(11288),i=H(11309),B=H(11269),V=H(11248),q=H(11099),b=H(11325);H(13091);class A extends i.d{set boundingBoxSize(n){if(this._boundingBoxSize&&this._boundingBoxSize.equals(n))return;this._boundingBoxSize=n;const y=this.pn();y&&y.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(n){this._rotationY=n,this.setReflectionTextureMatrix(k.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(n,y,H){let o="";for(const G of n)o+=G;return new A(o,y,null,H,n)}static CreateFromPrefilteredData(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const G=y.useDelayedTextureLoading;y.useDelayedTextureLoading=!1;const h=new A(n,y,null,!1,null,null,null,void 0,!0,H,o);return y.useDelayedTextureLoading=G,h}constructor(n,y){var H;let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8],U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,T=arguments.length>10&&void 0!==arguments[10]&&arguments[10],W=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,Q=arguments.length>13?arguments[13]:void 0,l=arguments.length>14?arguments[14]:void 0;super(y),this.onLoadObservable=new q.c,this.boundingBoxPosition=k.zy.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new k.Matrix,this._buffer=null,this.name=n,this.url=n,this._noMipmap=G,this.Ti=!1,this.isCube=!0,this._textureMatrix=k.Matrix.Identity(),this.coordinatesMode=B.b.CUBIC_MODE;let v=null,F=null;null===o||Array.isArray(o)?(this._noMipmap=G,this._format=b,this._createPolynomials=T,v=o,this._loaderOptions=Q,this._useSRGBBuffer=l,this._lodScale=W,this._lodOffset=z):(v=o.extensions??null,this._noMipmap=o.noMipmap??!1,h=o.files??null,F=o.buffer??null,this._format=o.format??5,A=o.prefiltered??!1,U=o.forcedExtension??null,this._createPolynomials=o.createPolynomials??!1,this._lodScale=o.lodScale??.8,this._lodOffset=o.lodOffset??0,this._loaderOptions=o.loaderOptions,this._useSRGBBuffer=o.useSRGBBuffer,i=o.L??null,V=o.onError??null),(n||h)&&this.updateURL(n,U,i,A,V,v,null===(H=this.pn())||void 0===H?void 0:H.useDelayedTextureLoading,h,F)}getClassName(){return"CubeTexture"}updateURL(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=n),this.url=n,y&&(this._forcedExtension=y);const V=n.lastIndexOf("."),q=y||(V>-1?n.substring(V).toLowerCase():""),b=0===q.indexOf(".dds"),A=0===q.indexOf(".env"),U=0===q.indexOf(".basis");if(A?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=o,o&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),i)this._files=i;else if(U||A||b||h||(h=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,h){for(let y=0;y<h.length;y++)this._files.push(n+h[y]);this._extensions=h}this._buffer=B,k?(this.delayLoadState=4,this._delayedOnLoad=H,this._delayedOnError=G):this._loadTexture(H,G)}delayLoad(n){4===this.delayLoadState&&(n&&(this._forcedExtension=n),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(n){var y,H;if(n.updateFlag===this._textureMatrix.updateFlag)return;n.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(H=this.pn())||void 0===H||H.markAllMaterialsAsDirty(1,(n=>-1!==n.getActiveTextures().indexOf(this))));if(this._textureMatrix=n,null===(y=this.pn())||void 0===y||!y.useRightHandedSystem)return;const o=k.TmpVectors.zy[0],G=k.TmpVectors.Quaternion[0],h=k.TmpVectors.zy[1];this._textureMatrix.decompose(o,G,h),G.z*=-1,G.w*=-1,k.Matrix.ComposeToRef(o,G,h,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var n;return null!==(n=this.pn())&&void 0!==n&&n.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this.pn(),o=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const G=()=>{var y;(this.onLoadObservable.notifyObservers(this),o)&&(o.dispose(),null===(y=this.pn())||void 0===y||y.markAllMaterialsAsDirty(1));n&&n()},k=(n,H)=>{this._loadingError=!0,this._errorObject={message:n,exception:H},y&&y(n,H),B.b.OnTextureLoadErrorObservable.notifyObservers(this)};var i;this._texture?this._texture.isReady?h.Tools.SetImmediate((()=>G())):this._texture.onLoadedObservable.add((()=>G())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,H,this._lodScale,this._lodOffset,n,k,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,H,this._files,this._noMipmap,n,k,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(i=this._texture)||void 0===i||i.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(n,y,H){const o=b.c.Parse((()=>{let o=!1;return n.prefiltered&&(o=n.prefiltered),new A(H+(n.url??n.name),y,n.extensions,!1,n.files||null,null,null,void 0,o,n.forcedExtension)}),n,y);if(n.boundingBoxPosition&&(o.boundingBoxPosition=k.zy.gy(n.boundingBoxPosition)),n.boundingBoxSize&&(o.boundingBoxSize=k.zy.gy(n.boundingBoxSize)),n.animations)for(let G=0;G<n.animations.length;G++){const y=n.animations[G],H=(0,V.e)("BABYLON.Animation");H&&o.animations.push(H.Parse(y))}return o}clone(){let n=0;const y=b.c.Clone((()=>{const y=new A(this.url,this.pn()||this._getEngine(),this._extensions,this._noMipmap,this._files);return n=y.uniqueId,y}),this);return y.uniqueId=n,y}}(0,o.e)([(0,G.J)()],A.prototype,"url",void 0),(0,o.e)([(0,G.F)()],A.prototype,"boundingBoxPosition",void 0),(0,o.e)([(0,G.F)()],A.prototype,"boundingBoxSize",null),(0,o.e)([(0,G.J)("rotationY")],A.prototype,"rotationY",null),(0,o.e)([(0,G.J)("files")],A.prototype,"_files",void 0),(0,o.e)([(0,G.J)("forcedExtension")],A.prototype,"_forcedExtension",void 0),(0,o.e)([(0,G.J)("extensions")],A.prototype,"_extensions",void 0),(0,o.e)([(0,G.t)("textureMatrix")],A.prototype,"_textureMatrix",void 0),(0,o.e)([(0,G.t)("textureMatrixRefraction")],A.prototype,"_textureMatrixRefraction",void 0),B.b._CubeTextureParser=A.Parse,(0,V.h)("BABYLON.CubeTexture",A)},13584:(n,y,H)=>{"use strict";H.d(y,{d:()=>B});var o=H(11114),G=H(11269),h=H(11256),k=H(11446),i=H(11230);k.ThinEngine.prototype.createDynamicTexture=function(n,y,H,o){const G=new i.b(this,4);return G.baseWidth=n,G.baseHeight=y,H&&(n=this.needPOTTextures?(0,h.d)(n,this._caps.maxTextureSize):n,y=this.needPOTTextures?(0,h.d)(y,this._caps.maxTextureSize):y),G.width=n,G.height=y,G.isReady=!1,G.generateMipMaps=H,G.samplingMode=o,this.updateTextureSamplingMode(o,G),this._internalTexturesCache.push(G),G},k.ThinEngine.prototype.updateDynamicTexture=function(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!n)return;const k=this._gl,i=k.TEXTURE_2D,B=this._bindTextureDirectly(i,n,!0,h);this._unpackFlipY(void 0===H?n.invertY:H),o&&k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const V=this._getWebGLTextureType(n.type),q=this._getInternalFormat(G||n.format),b=this._getRGBABufferInternalSizedFormat(n.type,q);k.texImage2D(i,0,b,q,V,y),n.generateMipMaps&&k.generateMipmap(i),B||this._bindTextureDirectly(i,null),o&&k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),G&&(n.format=G),n._dynamicTextureSource=y,n._premulAlpha=o,n.invertY=H||!1,n.isReady=!0};class B extends G.b{constructor(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,i=arguments.length>6?arguments[6]:void 0;const B=!H||H._isScene;super(null,B?H:null===H||void 0===H?void 0:H.ly,B?!o:H,i,h,void 0,void 0,void 0,void 0,k),this.name=n,this.wrapU=G.b.CLAMP_ADDRESSMODE,this.wrapV=G.b.CLAMP_ADDRESSMODE,this._generateMipMaps=o;const V=this._getEngine();if(!V)return;if(y.getContext)this._canvas=y,this._ownCanvas=!1,this._texture=V.createDynamicTexture(this._canvas.width,this._canvas.height,o,h);else{this._canvas=V.createCanvas(1,1),this._ownCanvas=!0;const n=y;n.width||0===n.width?this._texture=V.createDynamicTexture(n.width,n.height,o,h):this._texture=V.createDynamicTexture(y,y,o,h)}const q=this.getSize();this._canvas.width!==q.width&&(this._canvas.width=q.width),this._canvas.height!==q.height&&(this._canvas.height=q.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(n){this._canvas.width=n.width,this._canvas.height=n.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(n.width,n.height,this._generateMipMaps,this.samplingMode)}scale(n){const y=this.getSize();y.width*=n,y.height*=n,this._recreate(y)}scaleTo(n,y){const H=this.getSize();H.width=n,H.height=y,this._recreate(H)}getContext(){return this._context}clear(n){const y=this.getSize();n&&(this._context.fillStyle=n),this._context.clearRect(0,0,y.width,y.height)}update(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===n||n,y,this._format||void 0,void 0,H)}drawText(n,y,H,o,G,h,k){let i=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const B=this.getSize();if(h&&(this._context.fillStyle=h,this._context.fillRect(0,0,B.width,B.height)),this._context.font=o,null===y||void 0===y){const H=this._context.measureText(n);y=(B.width-H.width)/2}if(null===H||void 0===H){const n=parseInt(o.replace(/\D/g,""));H=B.height/2+n/3.65}this._context.fillStyle=G||"",this._context.fillText(n,y,H),i&&this.update(k)}dispose(){var n,y;(super.dispose(),this._ownCanvas)&&(null===(n=this._canvas)||void 0===n||null===(y=n.remove)||void 0===y||y.call(n));this._canvas=null,this._context=null}clone(){const n=this.pn();if(!n)return this;const y=this.getSize(),H=new B(this.name,y,n,this._generateMipMaps);return H.Ti=this.Ti,H.level=this.level,H.wrapU=this.wrapU,H.wrapV=this.wrapV,H}serialize(){const n=this.pn();n&&!n.isReady()&&o.d.Warn("The scene must be ready before serializing the dynamic texture");const y=super.serialize();return B._IsCanvasElement(this._canvas)&&(y.base64String=this._canvas.toDataURL()),y.invertY=this._invertY,y.samplingMode=this.samplingMode,y}static _IsCanvasElement(n){return void 0!==n.toDataURL}_rebuild(){this.update()}}},12982:(n,y,H)=>{"use strict";H.d(y,{d:()=>G});var o=H(11269);class G extends o.b{get depth(){return this._depth}constructor(n,y,H,G,h,k){let i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],B=arguments.length>7&&void 0!==arguments[7]&&arguments[7],V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:o.b.TRILINEAR_SAMPLINGMODE,q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,b=arguments.length>10?arguments[10]:void 0;super(null,k,!i,B),this.format=h,this._texture=k.getEngine().createRawTexture2DArray(n,y,H,G,h,i,B,V,null,q,b),this._depth=G,this.is2DArray=!0}update(n){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,n,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(n,y,H,o,h){return new G(n,y,H,o,5,h,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12786:(n,y,H)=>{"use strict";H.d(y,{e:()=>i,f:()=>B,j:()=>h,l:()=>k});var o=H(11303),G=H(11288);function h(n,y){return`{X: ${n.x.toFixed(y)} Y: ${n.y.toFixed(y)}}`}function k(n,y){return`{X: ${n._x.toFixed(y)} Y: ${n._y.toFixed(y)} Z: ${n._z.toFixed(y)}}`}function i(n,y){return 2*Math.acos((0,o.Clamp)(G.Quaternion.Dot(n,y)))}function B(n,y){const H=new G.Quaternion;return function(n,y,H){const h=G.zy.Cross(n,y),k=Math.acos((0,o.Clamp)(G.zy.Dot(n,y),-1,1));G.Quaternion.RotationAxisToRef(h,k,H)}(n,y,H),H}},12612:(n,y,H)=>{"use strict";H.d(y,{b:()=>V});var o=H(11288),G=H(11335),h=H(11800),k=H(11786),i=H(11347);H(12618);function B(n){let y=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const H=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],h=[];let B=[];const V=n.width||n.size||1,q=n.height||n.size||1,b=n.depth||n.size||1,A=n.wrap||!1;let U=void 0===n.topBaseAt?1:n.topBaseAt,T=void 0===n.bottomBaseAt?0:n.bottomBaseAt;U=(U+4)%4,T=(T+4)%4;let W=[2,0,3,1][U],z=[2,0,1,3][T],Q=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(A){y=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],Q=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let n=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],H=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const o=[17,18,19,16],G=[22,23,20,21];for(;W>0;)n.unshift(n.pop()),o.unshift(o.pop()),W--;for(;z>0;)H.unshift(H.pop()),G.unshift(G.pop()),z--;n=n.flat(),H=H.flat(),Q=Q.concat(n).concat(H),y.push(o[0],o[2],o[3],o[0],o[1],o[2]),y.push(G[0],G[2],G[3],G[0],G[1],G[2])}const l=[V/2,q/2,b/2];B=Q.reduce(((n,y,H)=>n.concat(y*l[H%3])),[]);const v=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE,F=n.faceUV||new Array(6),g=n.faceColors,M=[];for(let k=0;k<6;k++)void 0===F[k]&&(F[k]=new o.Vector4(0,0,1,1)),g&&void 0===g[k]&&(g[k]=new G.pi(1,1,1,1));for(let o=0;o<6;o++)if(h.push(F[o].z,i.e?1-F[o].w:F[o].w),h.push(F[o].x,i.e?1-F[o].w:F[o].w),h.push(F[o].x,i.e?1-F[o].y:F[o].y),h.push(F[o].z,i.e?1-F[o].y:F[o].y),g)for(let n=0;n<4;n++)M.push(g[o].r,g[o].g,g[o].b,g[o].a);k.c._ComputeSides(v,B,y,H,h,n.frontUVs,n.backUVs);const f=new k.c;if(f.indices=y,f.Xn=B,f.dn=H,f.On=h,g){const n=v===k.c.DOUBLESIDE?M.concat(M):M;f.an=n}return f}function V(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new h.b(n,H);y.sideOrientation=h.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return B(y).wn(o,y.updatable),o}k.c.CreateBox=B,h.b.CreateBox=function(n,y){return V(n,{size:y,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12770:(n,y,H)=>{"use strict";H.d(y,{e:()=>i});var o=H(11800),G=H(11786),h=H(11347);function k(n){const y=[],H=[],o=[],k=[],i=n.radius||.5,B=n.tessellation||64,V=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,q=0===n.sideOrientation?0:n.sideOrientation||G.c.DEFAULTSIDE;y.push(0,0,0),k.push(.5,.5);const b=2*Math.PI*V,A=1===V?b/B:b/(B-1);let U=0;for(let G=0;G<B;G++){const n=Math.cos(U),H=Math.sin(U),o=(n+1)/2,G=(1-H)/2;y.push(i*n,i*H,0),k.push(o,h.e?1-G:G),U+=A}1===V&&(y.push(y[3],y[4],y[5]),k.push(k[2],h.e?1-k[3]:k[3]));const T=y.length/3;for(let G=1;G<T-1;G++)H.push(G+1,0,G);G.c.ComputeNormals(y,H,o),G.c._ComputeSides(q,y,H,o,k,n.frontUVs,n.backUVs);const W=new G.c;return W.indices=H,W.Xn=y,W.dn=o,W.On=k,W}function i(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new o.b(n,H);y.sideOrientation=o.b._GetDefaultSideOrientation(y.sideOrientation),G._originalBuilderSideOrientation=y.sideOrientation;return k(y).wn(G,y.updatable),G}G.c.CreateDisc=k,o.b.CreateDisc=function(n,y,H){return i(n,{radius:y,tessellation:H,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12618:(n,y,H)=>{"use strict";H.d(y,{g:()=>z,c:()=>l,i:()=>Q});var o=H(11288),G=H(11335),h=H(11800),k=H(11786),i=H(11360);h.b._GroundMeshParser=(n,y)=>B.Parse(n,y);class B extends h.b{constructor(n,y){super(n,y),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=n,this._subdivisionsY=n,this.subdivide(n);const H=this;H.createOrUpdateSubmeshesOctree&&H.createOrUpdateSubmeshesOctree(y)}getHeightAtCoordinates(n,y){const H=this.getWorldMatrix(),G=o.TmpVectors.Matrix[5];H.invertToRef(G);const h=o.TmpVectors.zy[8];if(o.zy.TransformCoordinatesFromFloatsToRef(n,0,y,G,h),n=h.x,y=h.z,n<this._minX||n>=this._maxX||y<=this._minZ||y>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const k=this._getFacetAt(n,y),i=-(k.x*n+k.z*y+k.w)/k.y;return o.zy.TransformCoordinatesFromFloatsToRef(0,i,0,H,h),h.y}getNormalAtCoordinates(n,y){const H=new o.zy(0,1,0);return this.getNormalAtCoordinatesToRef(n,y,H),H}getNormalAtCoordinatesToRef(n,y,H){const G=this.getWorldMatrix(),h=o.TmpVectors.Matrix[5];G.invertToRef(h);const k=o.TmpVectors.zy[8];if(o.zy.TransformCoordinatesFromFloatsToRef(n,0,y,h,k),n=k.x,y=k.z,n<this._minX||n>this._maxX||y<this._minZ||y>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const i=this._getFacetAt(n,y);return o.zy.TransformNormalFromFloatsToRef(i.x,i.y,i.z,G,H),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(n,y){const H=Math.floor((n+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(y+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),G=this._heightQuads[o*this._subdivisionsX+H];let h;return h=y<G.slope.x*n+G.slope.y?G.facet1:G.facet2,h}_initHeightQuads(){const n=this._subdivisionsX,y=this._subdivisionsY;this._heightQuads=[];for(let H=0;H<y;H++)for(let y=0;y<n;y++){const G={slope:o.Vector2.Zero(),facet1:new o.Vector4(0,0,0,0),facet2:new o.Vector4(0,0,0,0)};this._heightQuads[H*n+y]=G}return this}_computeHeightQuads(){const n=this.getVerticesData(i.g.PositionKind);if(!n)return this;const y=o.TmpVectors.zy[3],H=o.TmpVectors.zy[2],G=o.TmpVectors.zy[1],h=o.TmpVectors.zy[0],k=o.TmpVectors.zy[4],B=o.TmpVectors.zy[5],V=o.TmpVectors.zy[6],q=o.TmpVectors.zy[7],b=o.TmpVectors.zy[8];let A=0,U=0,T=0,W=0,z=0,Q=0,l=0;const v=this._subdivisionsX,F=this._subdivisionsY;for(let i=0;i<F;i++)for(let F=0;F<v;F++){A=3*F,U=i*(v+1)*3,T=(i+1)*(v+1)*3,y.x=n[U+A],y.y=n[U+A+1],y.z=n[U+A+2],H.x=n[U+A+3],H.y=n[U+A+4],H.z=n[U+A+5],G.x=n[T+A],G.y=n[T+A+1],G.z=n[T+A+2],h.x=n[T+A+3],h.y=n[T+A+4],h.z=n[T+A+5],W=(h.z-y.z)/(h.x-y.x),z=y.z-W*y.x,H.subtractToRef(y,k),G.subtractToRef(y,B),h.subtractToRef(y,V),o.zy.CrossToRef(V,B,q),o.zy.CrossToRef(k,V,b),q.normalize(),b.normalize(),Q=-(q.x*y.x+q.y*y.y+q.z*y.z),l=-(b.x*H.x+b.y*H.y+b.z*H.z);const g=this._heightQuads[i*v+F];g.slope.Mi(W,z),g.facet1.Mi(q.x,q.y,q.z,Q),g.facet2.Mi(b.x,b.y,b.z,l)}return this}serialize(n){super.serialize(n),n.subdivisionsX=this._subdivisionsX,n.subdivisionsY=this._subdivisionsY,n.minX=this._minX,n.maxX=this._maxX,n.Wi=this._minZ,n.maxZ=this._maxZ,n.width=this._width,n.height=this._height}static Parse(n,y){const H=new B(n.name,y);return H._subdivisionsX=n.subdivisionsX||1,H._subdivisionsY=n.subdivisionsY||1,H._minX=n.minX,H._maxX=n.maxX,H._minZ=n.Wi,H._maxZ=n.maxZ,H._width=n.width,H._height=n.height,H}}var V=H(11094),q=H(11149),b=H(11297),A=H(11347);function U(n){const y=[],H=[],G=[],h=[];let i,B;const V=n.width||n.size||1,q=n.height||n.size||1,b=0|(n.subdivisionsX||n.subdivisions||1),U=0|(n.subdivisionsY||n.subdivisions||1);for(i=0;i<=U;i++)for(B=0;B<=b;B++){const n=new o.zy(B*V/b-V/2,0,(U-i)*q/U-q/2),y=new o.zy(0,1,0);H.push(n.x,n.y,n.z),G.push(y.x,y.y,y.z),h.push(B/b,A.e?i/U:1-i/U)}for(i=0;i<U;i++)for(B=0;B<b;B++)y.push(B+1+(i+1)*(b+1)),y.push(B+1+i*(b+1)),y.push(B+i*(b+1)),y.push(B+(i+1)*(b+1)),y.push(B+1+(i+1)*(b+1)),y.push(B+i*(b+1));const T=new k.c;return T.indices=y,T.Xn=H,T.dn=G,T.On=h,T}function T(n){const y=void 0!==n.xmin&&null!==n.xmin?n.xmin:-1,H=void 0!==n.zmin&&null!==n.zmin?n.zmin:-1,G=void 0!==n.xmax&&null!==n.xmax?n.xmax:1,h=void 0!==n.zmax&&null!==n.zmax?n.zmax:1,i=n.subdivisions||{w:1,h:1},B=n.precision||{w:1,h:1},V=[],q=[],b=[],A=[];let U,T,W,z;i.h=i.h<1?1:i.h,i.w=i.w<1?1:i.w,B.w=B.w<1?1:B.w,B.h=B.h<1?1:B.h;const Q=(G-y)/i.w,l=(h-H)/i.h;function v(n,y,H,G){const h=q.length/3,k=B.w+1;for(U=0;U<B.h;U++)for(T=0;T<B.w;T++){const n=[h+T+U*k,h+(T+1)+U*k,h+(T+1)+(U+1)*k,h+T+(U+1)*k];V.push(n[1]),V.push(n[2]),V.push(n[3]),V.push(n[0]),V.push(n[1]),V.push(n[3])}const i=o.zy.Zero(),W=new o.zy(0,1,0);for(U=0;U<=B.h;U++)for(i.z=U*(G-y)/B.h+y,T=0;T<=B.w;T++)i.x=T*(H-n)/B.w+n,i.y=0,q.push(i.x,i.y,i.z),b.push(W.x,W.y,W.z),A.push(T/B.w,U/B.h)}for(W=0;W<i.h;W++)for(z=0;z<i.w;z++)v(y+z*Q,H+W*l,y+(z+1)*Q,H+(W+1)*l);const F=new k.c;return F.indices=V,F.Xn=q,F.dn=b,F.On=A,F}function W(n){const y=[],H=[],h=[],i=[];let B,V;const q=n.colorFilter||new G.Fy(.3,.59,.11),A=n.alphaFilter||0;let U=!1;if(n.minHeight>n.maxHeight){U=!0;const y=n.maxHeight;n.maxHeight=n.minHeight,n.minHeight=y}for(B=0;B<=n.subdivisions;B++)for(V=0;V<=n.subdivisions;V++){const y=new o.zy(V*n.width/n.subdivisions-n.width/2,0,(n.subdivisions-B)*n.height/n.subdivisions-n.height/2),G=4*(((y.x+n.width/2)/n.width*(n.bufferWidth-1)|0)+((1-(y.z+n.height/2)/n.height)*(n.bufferHeight-1)|0)*n.bufferWidth);let k=n.buffer[G]/255,T=n.buffer[G+1]/255,W=n.buffer[G+2]/255;const z=n.buffer[G+3]/255;U&&(k=1-k,T=1-T,W=1-W);const Q=k*q.r+T*q.g+W*q.b;y.y=z>=A?n.minHeight+(n.maxHeight-n.minHeight)*Q:n.minHeight-b.e,n.heightBuffer&&(n.heightBuffer[B*(n.subdivisions+1)+V]=y.y),H.push(y.x,y.y,y.z),h.push(0,0,0),i.push(V/n.subdivisions,1-B/n.subdivisions)}for(B=0;B<n.subdivisions;B++)for(V=0;V<n.subdivisions;V++){const o=V+1+(B+1)*(n.subdivisions+1),G=V+1+B*(n.subdivisions+1),h=V+B*(n.subdivisions+1),k=V+(B+1)*(n.subdivisions+1),i=H[3*o+1]>=n.minHeight,q=H[3*G+1]>=n.minHeight,b=H[3*h+1]>=n.minHeight;i&&q&&b&&(y.push(o),y.push(G),y.push(h));H[3*k+1]>=n.minHeight&&i&&b&&(y.push(k),y.push(o),y.push(h))}k.c.ComputeNormals(H,y,h);const T=new k.c;return T.indices=y,T.Xn=H,T.dn=h,T.On=i,T}function z(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const H=new B(n,arguments.length>2?arguments[2]:void 0);H._setReady(!1),H._subdivisionsX=y.subdivisionsX||y.subdivisions||1,H._subdivisionsY=y.subdivisionsY||y.subdivisions||1,H._width=y.width||1,H._height=y.height||1,H._maxX=H._width/2,H._maxZ=H._height/2,H._minX=-H._maxX,H._minZ=-H._maxZ;return U(y).wn(H,y.updatable),H._setReady(!0),H}function Q(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new h.b(n,H);return T(y).wn(o,y.updatable),o}function l(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const h=H.width||10,k=H.height||10,i=H.subdivisions||1,b=H.minHeight||0,A=H.maxHeight||1,U=H.colorFilter||new G.Fy(.3,.59,.11),T=H.alphaFilter||0,z=H.updatable,Q=H.onReady;o=o||q.c.LastCreatedScene;const l=new B(n,o);let v;l._subdivisionsX=i,l._subdivisionsY=i,l._width=h,l._height=k,l._maxX=l._width/2,l._maxZ=l._height/2,l._minX=-l._maxX,l._minZ=-l._maxZ,l._setReady(!1),H.passHeightBufferInCallback&&(v=new Float32Array((i+1)*(i+1)));const F=(n,y,H)=>{W({width:h,height:k,subdivisions:i,minHeight:b,maxHeight:A,colorFilter:U,buffer:n,bufferWidth:y,bufferHeight:H,alphaFilter:T,heightBuffer:v}).wn(l,z),Q&&Q(l,v),l._setReady(!0)};if("string"===typeof y){const n=n=>{var y;const H=n.width,G=n.height;if(o.A)return;const h=null===(y=o)||void 0===y?void 0:y.getEngine().resizeImageBitmap(n,H,G);F(h,H,G)};V.Tools.LoadImage(y,n,H.onError?H.onError:()=>{},o.offlineProvider)}else F(y.data,y.width,y.height);return l}k.c.CreateGround=U,k.c.CreateTiledGround=T,k.c.CreateGroundFromHeightMap=W,h.b.CreateGround=(n,y,H,o,G,h)=>z(n,{width:y,height:H,subdivisions:o,updatable:h},G),h.b.CreateTiledGround=(n,y,H,o,G,h,k,i,B)=>Q(n,{xmin:y,zmin:H,xmax:o,zmax:G,subdivisions:h,precision:k,updatable:B},i),h.b.CreateGroundFromHeightMap=(n,y,H,o,G,h,k,i,B,V,q)=>l(n,y,{width:H,height:o,subdivisions:G,minHeight:h,maxHeight:k,updatable:B,onReady:V,alphaFilter:q},i)},13284:(n,y,H)=>{"use strict";H.d(y,{c:()=>U,d:()=>b,h:()=>A});var o=H(11288),G=H(11800),h=H(11786),k=H(11915),i=H(11360),B=H(11114);function V(n){const y=[],H=[],o=n.lines,G=n.an,k=[];let i=0;for(let h=0;h<o.length;h++){const n=o[h];for(let o=0;o<n.length;o++){const{x:B,y:V,z:q}=n[o];if(H.push(B,V,q),G){const n=G[h],{r:y,g:H,b:i,a:B}=n[o];k.push(y,H,i,B)}o>0&&(y.push(i-1),y.push(i)),i++}}const B=new h.c;return B.indices=y,B.Xn=H,G&&(B.an=k),B}function q(n){const y=n.dashSize||3,H=n.gapSize||1,G=n.dashNb||200,k=n.points,i=[],B=[],V=o.zy.Zero();let q=0,b=0,A=0,U=0,T=0,W=0,z=0;for(z=0;z<k.length-1;z++)k[z+1].subtractToRef(k[z],V),q+=V.length();for(A=q/G,U=y*A/(y+H),z=0;z<k.length-1;z++){k[z+1].subtractToRef(k[z],V),b=Math.floor(V.length()/A),V.normalize();for(let n=0;n<b;n++)T=A*n,i.push(k[z].x+T*V.x,k[z].y+T*V.y,k[z].z+T*V.z),i.push(k[z].x+(T+U)*V.x,k[z].y+(T+U)*V.y,k[z].z+(T+U)*V.z),B.push(W,W+1),W+=2}const Q=new h.c;return Q.Xn=i,Q.indices=B,Q}function b(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=y.instance,G=y.lines,h=y.an;if(o){const n=o.getVerticesData(i.g.PositionKind);let y,H;h&&(y=o.getVerticesData(i.g.ColorKind));let k=0,B=0;for(let o=0;o<G.length;o++){const i=G[o];for(let G=0;G<i.length;G++)n[k]=i[G].x,n[k+1]=i[G].y,n[k+2]=i[G].z,h&&y&&(H=h[o],y[B]=H[G].r,y[B+1]=H[G].g,y[B+2]=H[G].b,y[B+3]=H[G].a,B+=4),k+=3}return o.updateVerticesData(i.g.PositionKind,n,!1,!1),h&&y&&o.updateVerticesData(i.g.ColorKind,y,!1,!1),o.refreshBoundingInfo(),o}const B=!!h,q=new k.e(n,H,null,void 0,void 0,B,y.useVertexAlpha,y.material);return V(y).wn(q,y.updatable),q}function A(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=y.an?[y.an]:null;return b(n,{lines:[y.points],updatable:y.updatable,instance:y.instance,an:o,useVertexAlpha:y.useVertexAlpha,material:y.material},H)}function U(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=y.points,i=y.instance,V=y.gapSize||1,b=y.dashSize||3;if(i){const n=n=>{const y=o.zy.Zero(),H=n.length/6;let G=0,k=0,B=0,V=0,q=0,b=0,A=0,U=0;for(A=0;A<h.length-1;A++)h[A+1].subtractToRef(h[A],y),G+=y.length();B=G/H;const T=i._creationDataStorage.dashSize;for(V=T*B/(T+i._creationDataStorage.gapSize),A=0;A<h.length-1;A++)for(h[A+1].subtractToRef(h[A],y),k=Math.floor(y.length()/B),y.normalize(),U=0;U<k&&b<n.length;)q=B*U,n[b]=h[A].x+q*y.x,n[b+1]=h[A].y+q*y.y,n[b+2]=h[A].z+q*y.z,n[b+3]=h[A].x+(q+V)*y.x,n[b+4]=h[A].y+(q+V)*y.y,n[b+5]=h[A].z+(q+V)*y.z,b+=6,U++;for(;b<n.length;)n[b]=h[A].x,n[b+1]=h[A].y,n[b+2]=h[A].z,b+=3};return(y.dashNb||y.dashSize||y.gapSize||y.useVertexAlpha||y.material)&&B.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),i.updateMeshPositions(n,!1),i}const A=new k.e(n,H,null,void 0,void 0,void 0,y.useVertexAlpha,y.material);return q(y).wn(A,y.updatable),A._creationDataStorage=new G.c,A._creationDataStorage.dashSize=b,A._creationDataStorage.gapSize=V,A}h.c.CreateLineSystem=V,h.c.CreateDashedLines=q,G.b.vV=function(n,y){return A(n,{points:y,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},G.b.CreateDashedLines=function(n,y,H,o,G){return U(n,{points:y,dashSize:H,gapSize:o,dashNb:G,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12665:(n,y,H)=>{"use strict";H.d(y,{b:()=>i,d:()=>B});var o=H(11800),G=H(11786),h=H(11347);function k(n){const y=[],H=[],o=[],k=[],i=void 0!==n.width?n.width:void 0!==n.size?n.size:1,B=void 0!==n.height?n.height:void 0!==n.size?n.size:1,V=0===n.sideOrientation?0:n.sideOrientation||G.c.DEFAULTSIDE,q=i/2,b=B/2;H.push(-q,-b,0),o.push(0,0,-1),k.push(0,h.e?1:0),H.push(q,-b,0),o.push(0,0,-1),k.push(1,h.e?1:0),H.push(q,b,0),o.push(0,0,-1),k.push(1,h.e?0:1),H.push(-q,b,0),o.push(0,0,-1),k.push(0,h.e?0:1),y.push(0),y.push(1),y.push(2),y.push(0),y.push(2),y.push(3),G.c._ComputeSides(V,H,y,o,k,n.frontUVs,n.backUVs);const A=new G.c;return A.indices=y,A.Xn=H,A.dn=o,A.On=k,A}function i(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const G=new o.b(n,H);y.sideOrientation=o.b._GetDefaultSideOrientation(y.sideOrientation),G._originalBuilderSideOrientation=y.sideOrientation;return k(y).wn(G,y.updatable),y.sourcePlane&&(G.translate(y.sourcePlane.normal,-y.sourcePlane.d),G.setDirection(y.sourcePlane.normal.scale(-1))),G}const B={MV:i};G.c.MV=k,o.b.MV=(n,y,H,o,G)=>i(n,{size:y,width:y,height:y,sideOrientation:G,updatable:o},H)},12763:(n,y,H)=>{"use strict";H.d(y,{d:()=>B});var o=H(11288),G=H(11800),h=H(11786),k=H(11347);function i(n){const y=0|(n.segments||32),H=n.diameterX||n.diameter||1,G=n.diameterY||n.diameter||1,i=n.diameterZ||n.diameter||1,B=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,V=n.slice&&n.slice<=0?1:n.slice||1,q=0===n.sideOrientation?0:n.sideOrientation||h.c.DEFAULTSIDE,b=!!n.dedupTopBottomIndices,A=new o.zy(H/2,G/2,i/2),U=2+y,T=2*U,W=[],z=[],Q=[],l=[];for(let h=0;h<=U;h++){const n=h/U,y=n*Math.PI*V;for(let H=0;H<=T;H++){const G=H/T,h=G*Math.PI*2*B,i=o.Matrix.RotationZ(-y),V=o.Matrix.RotationY(h),q=o.zy.TransformCoordinates(o.zy.Up(),i),b=o.zy.TransformCoordinates(q,V),U=b.multiply(A),W=b.divide(A).normalize();z.push(U.x,U.y,U.z),Q.push(W.x,W.y,W.z),l.push(G,k.e?1-n:n)}if(h>0){const n=z.length/3;for(let y=n-2*(T+1);y+T+2<n;y++)b?(h>1&&(W.push(y),W.push(y+1),W.push(y+T+1)),(h<U||V<1)&&(W.push(y+T+1),W.push(y+1),W.push(y+T+2))):(W.push(y),W.push(y+1),W.push(y+T+1),W.push(y+T+1),W.push(y+1),W.push(y+T+2))}}h.c._ComputeSides(q,z,W,Q,l,n.frontUVs,n.backUVs);const v=new h.c;return v.indices=W,v.Xn=z,v.dn=Q,v.On=l,v}function B(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return i(y).wn(o,y.updatable),o}h.c.CreateSphere=i,G.b.CreateSphere=(n,y,H,o,G,h)=>B(n,{segments:y,diameterX:H,diameterY:H,diameterZ:H,sideOrientation:h,updatable:G},o)},13595:(n,y,H)=>{"use strict";H.d(y,{e:()=>i});var o=H(11941),G=H(13099),h=H(11959),k=H(11786);class i{static get Configuration(){return{get decoder(){return G.e.DefaultConfiguration},set decoder(n){G.e.DefaultConfiguration=n}}}static set Configuration(n){G.e.DefaultConfiguration=n.decoder}static get DecoderAvailable(){return(0,o.i)(G.e.DefaultConfiguration)}static get Default(){return i._Default??(i._Default=new i),i._Default}static ResetDefault(n){i._Default&&(n||i._Default.dispose(),i._Default=null)}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DefaultNumWorkers;const y="number"===typeof n?{...G.e.DefaultConfiguration,numWorkers:n}:{...G.e.DefaultConfiguration,...n};this._decoder=new G.e(y)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(n,y,H){return this._decoder.decodeMeshToMeshDataAsync(n,y,H)}async decodeMeshToGeometryAsync(n,y,H,o){return await this._decoder.decodeMeshToGeometryAsync(n,y,H,o)}async _decodeMeshToGeometryForGltfAsync(n,y,H,o,G,h){return await this._decoder._decodeMeshToGeometryForGltfAsync(n,y,H,o,G,h)}async decodeMeshAsync(n,y){const H=await this._decoder.decodeMeshToMeshDataAsync(n,y),o=new k.c;H.indices&&(o.indices=H.indices);for(const G of H.attributes){const n=h.b.GetFloatData(G.data,G.size,h.b.GetDataType(G.data),G.byteOffset,G.byteStride,G.normalized,H.totalVertices);o.set(n,G.kind)}return o}}i.DefaultNumWorkers=(0,o.f)(),i._Default=null},13099:(n,y,H)=>{"use strict";H.d(y,{e:()=>V});var o=H(11941),G=H(11094),h=H(11810),k=H(11959),i=H(11114),B=H(11953);class V extends o.e{static get DefaultAvailable(){return(0,o.i)(V.DefaultConfiguration)}static get Default(){return V._Default??(V._Default=new V),V._Default}static ResetDefault(n){V._Default&&(n||V._Default.dispose(),V._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(n,y){return{module:await(y||DracoDecoderModule)({wasmBinary:n})}}_getWorkerContent(){return`${B.d}(${B.g})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.DefaultConfiguration)}decodeMeshToMeshDataAsync(n,y,H){const o=n instanceof ArrayBuffer?new Int8Array(n):new Int8Array(n.buffer,n.byteOffset,n.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async n=>await new Promise(((G,h)=>{n.push(((n,k)=>{let B=null;const V=[],q=y=>{n.removeEventListener("error",q),n.removeEventListener("message",b),h(y),k()},b=y=>{const o=y.data;switch(o.id){case"indices":B=o.data;break;case"attribute":V.push({kind:o.kind,data:o.data,size:o.size,byteOffset:o.byteOffset,byteStride:o.byteStride,normalized:(h=o.kind,A=o.normalized,H&&void 0!==H[h]?(A!==H[h]&&i.d.Warn(`Normalized flag from Draco data (${A}) does not match normalized flag from glTF accessor (${H[h]}). Using flag from glTF accessor.`),H[h]):A)});break;case"decodeMeshDone":n.removeEventListener("error",q),n.removeEventListener("message",b),G({indices:B,attributes:V,totalVertices:o.totalVertices}),k()}var h,A};n.addEventListener("error",q),n.addEventListener("message",b);const A=o.slice();n.postMessage({id:"decodeMesh",dataView:A,attributes:y},[A.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((n=>{let H=null;const G=[],h=(0,B.d)(n.module,o,y,(n=>{H=n}),((n,y,H,o,h,k)=>{G.push({kind:n,data:y,size:H,byteOffset:o,byteStride:h,normalized:k})}));return{indices:H,attributes:G,totalVertices:h}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(n,y,H,o){const G=await this.decodeMeshToMeshDataAsync(H,o),i=new h.d(n,y);G.indices&&i.setIndices(G.indices);for(const h of G.attributes)i.setVerticesBuffer(new k.b(y.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),G.totalVertices);return i}async _decodeMeshToGeometryForGltfAsync(n,y,H,o,G,i){const B=await this.decodeMeshToMeshDataAsync(H,o,G),V=new h.d(n,y);i&&(V._boundingInfo=i,V.useBoundingInfoFromGeometry=!0),B.indices&&V.setIndices(B.indices);for(const h of B.attributes)V.setVerticesBuffer(new k.b(y.getEngine(),h.data,h.kind,!1,void 0,h.byteStride,void 0,h.byteOffset,h.size,void 0,h.normalized,!0),B.totalVertices);return V}}V.DefaultConfiguration={wasmUrl:`${G.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${G.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${G.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},V._Default=null},13277:(n,y,H)=>{"use strict";H.d(y,{e:()=>Bn});var o=H(11288),G=H(11800),h=H(11360),k=H(11786),i=H(11347);function B(n){let y=n.pathArray;const H=n.closeArray||!1,o=n.closePath||!1,G=n.invertUV||!1,B=Math.floor(y[0].length/2);let V=n.offset||B;V=V>B?B:Math.floor(V);const q=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE,b=n.On,A=n.an,U=[],T=[],W=[],z=[],Q=[],l=[],v=[],F=[];let g;const M=[],f=[];let c,p,E;if(y.length<2){const n=[],H=[];for(p=0;p<y[0].length-V;p++)n.push(y[0][p]),H.push(y[0][p+V]);y=[n,H]}let X=0;const d=o?1:0,a=H?1:0;let O,e,w,j,I,R;for(g=y[0].length,c=0;c<y.length+a;c++){for(v[c]=0,Q[c]=[0],O=c===y.length?y[0]:y[c],e=O.length,g=g<e?g:e,E=0;E<e;)U.push(O[E].x,O[E].y,O[E].z),E>0&&(w=O[E].Qy(O[E-1]).length(),j=w+v[c],Q[c].push(j),v[c]=j),E++;o&&(E--,U.push(O[0].x,O[0].y,O[0].z),w=O[E].Qy(O[0]).length(),j=w+v[c],Q[c].push(j),v[c]=j),M[c]=e+d,f[c]=X,X+=e+d}let C,S,N=null,r=null;for(p=0;p<g+d;p++)for(F[p]=0,l[p]=[0],c=0;c<y.length-1+a;c++)I=y[c],R=c===y.length-1?y[0]:y[c+1],p===g?(N=I[0],r=R[0]):(N=I[p],r=R[p]),w=r.Qy(N).length(),j=w+F[p],l[p].push(j),F[p]=j;if(b)for(c=0;c<b.length;c++)z.push(b[c].x,i.e?1-b[c].y:b[c].y);else for(c=0;c<y.length+a;c++)for(p=0;p<g+d;p++)C=0!=v[c]?Q[c][p]/v[c]:0,S=0!=F[p]?l[p][c]/F[p]:0,G?z.push(S,C):z.push(C,i.e?1-S:S);c=0;let K=0,Y=M[c]-1,D=M[c+1]-1,Z=Y<D?Y:D,s=f[1]-f[0];const P=M.length-1;for(;K<=Z&&c<P;)T.push(K,K+s,K+1),T.push(K+s+1,K+1,K+s),K+=1,K===Z&&(c++,s=f[c+1]-f[c],Y=M[c]-1,D=M[c+1]-1,K=f[c],Z=Y<D?Y+K:D+K);if(k.c.ComputeNormals(U,T,W),o){let n=0,H=0;for(c=0;c<y.length;c++){n=3*f[c],H=c+1<y.length?3*(f[c+1]-1):W.length-3,W[n]=.5*(W[n]+W[H]),W[n+1]=.5*(W[n+1]+W[H+1]),W[n+2]=.5*(W[n+2]+W[H+2]);const o=Math.sqrt(W[n]*W[n]+W[n+1]*W[n+1]+W[n+2]*W[n+2]);W[n]/=o,W[n+1]/=o,W[n+2]/=o,W[H]=W[n],W[H+1]=W[n+1],W[H+2]=W[n+2]}}if(H){let n=3*f[0],H=3*f[y.length];for(p=0;p<g+d;p++){W[n]=.5*(W[n]+W[H]),W[n+1]=.5*(W[n+1]+W[H+1]),W[n+2]=.5*(W[n+2]+W[H+2]);const y=Math.sqrt(W[n]*W[n]+W[n+1]*W[n+1]+W[n+2]*W[n+2]);W[n]/=y,W[n+1]/=y,W[n+2]/=y,W[H]=W[n],W[H+1]=W[n+1],W[H+2]=W[n+2],n+=3,H+=3}}k.c._ComputeSides(q,U,T,W,z,n.frontUVs,n.backUVs);let x=null;if(A){x=new Float32Array(4*A.length);for(let n=0;n<A.length;n++)x[4*n]=A[n].r,x[4*n+1]=A[n].g,x[4*n+2]=A[n].b,x[4*n+3]=A[n].a}const t=new k.c,u=new Float32Array(U),L=new Float32Array(W),J=new Float32Array(z);return t.indices=T,t.Xn=u,t.dn=L,t.On=J,x&&t.set(x,h.g.ColorKind),o&&(t._idx=f),t}function V(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=y.pathArray,q=y.closeArray,b=y.closePath,A=G.b._GetDefaultSideOrientation(y.sideOrientation),U=y.instance,T=y.updatable;if(U){const n=o.TmpVectors.zy[0].ci(Number.MAX_VALUE),H=o.TmpVectors.zy[1].ci(-Number.MAX_VALUE),B=y=>{let o=V[0].length;const h=U;let k=0;const i=h._originalBuilderSideOrientation===G.b.DOUBLESIDE?2:1;for(let G=1;G<=i;++G)for(let i=0;i<V.length;++i){const G=V[i],B=G.length;o=o<B?o:B;for(let h=0;h<o;++h){const o=G[h];y[k]=o.x,y[k+1]=o.y,y[k+2]=o.z,n.minimizeInPlaceFromFloats(o.x,o.y,o.z),H.maximizeInPlaceFromFloats(o.x,o.y,o.z),k+=3}if(h._creationDataStorage&&h._creationDataStorage.closePath){const n=G[0];y[k]=n.x,y[k+1]=n.y,y[k+2]=n.z,k+=3}}},q=U.getVerticesData(h.g.PositionKind);if(B(q),U.hasBoundingInfo?U.getBoundingInfo().reConstruct(n,H,U._worldMatrix):U.buildBoundingInfo(n,H,U._worldMatrix),U.updateVerticesData(h.g.PositionKind,q,!1,!1),y.an){const n=U.getVerticesData(h.g.ColorKind);for(let H=0,o=0;H<y.an.length;H++,o+=4){const G=y.an[H];n[o]=G.r,n[o+1]=G.g,n[o+2]=G.b,n[o+3]=G.a}U.updateVerticesData(h.g.ColorKind,n,!1,!1)}if(y.On){const n=U.getVerticesData(h.g.UVKind);for(let H=0;H<y.On.length;H++)n[2*H]=y.On[H].x,n[2*H+1]=i.e?1-y.On[H].y:y.On[H].y;U.updateVerticesData(h.g.UVKind,n,!1,!1)}if(!U.areNormalsFrozen||U.isFacetDataEnabled){const n=U.Fi(),y=U.getVerticesData(h.g.NormalKind),H=U.isFacetDataEnabled?U.getFacetDataParameters():null;if(k.c.ComputeNormals(q,n,y,H),U._creationDataStorage&&U._creationDataStorage.closePath){let n=0,H=0;for(let o=0;o<V.length;o++)n=3*U._creationDataStorage.idx[o],H=o+1<V.length?3*(U._creationDataStorage.idx[o+1]-1):y.length-3,y[n]=.5*(y[n]+y[H]),y[n+1]=.5*(y[n+1]+y[H+1]),y[n+2]=.5*(y[n+2]+y[H+2]),y[H]=y[n],y[H+1]=y[n+1],y[H+2]=y[n+2]}U.areNormalsFrozen||U.updateVerticesData(h.g.NormalKind,y,!1,!1)}return U}{const o=new G.b(n,H);o._originalBuilderSideOrientation=A,o._creationDataStorage=new G.c;const h=B(y);return b&&(o._creationDataStorage.idx=h._idx),o._creationDataStorage.closePath=b,o._creationDataStorage.closeArray=q,h.wn(o,T),o}}k.c.CreateRibbon=B,G.b.CreateRibbon=function(n,y){return V(n,{pathArray:y,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var q=H(12770),b=H(12612),A=H(11335);function U(n){const y=n.pattern||G.b.NO_FLIP,H=n.tileWidth||n.tileSize||1,o=n.tileHeight||n.tileSize||1,h=n.alignHorizontal||0,i=n.alignVertical||0,B=n.width||n.size||1,V=Math.floor(B/H);let q=B-V*H;const b=n.height||n.size||1,A=Math.floor(b/o);let U=b-A*o;const T=H*V/2,W=o*A/2;let z=0,Q=0,l=0,v=0,F=0,g=0;if(q>0||U>0){switch(l=-T,v=-W,F=T,g=W,h){case G.b.CENTER:q/=2,l-=q,F+=q;break;case G.b.LEFT:F+=q,z=-q/2;break;case G.b.RIGHT:l-=q,z=q/2}switch(i){case G.b.CENTER:U/=2,v-=U,g+=U;break;case G.b.BOTTOM:g+=U,Q=-U/2;break;case G.b.TOP:v-=U,Q=U/2}}const M=[],f=[],c=[];c[0]=[0,0,1,0,1,1,0,1],c[1]=[0,0,1,0,1,1,0,1],y!==G.b.ROTATE_TILE&&y!==G.b.ROTATE_ROW||(c[1]=[1,1,0,1,0,0,1,0]),y!==G.b.FLIP_TILE&&y!==G.b.FLIP_ROW||(c[1]=[1,0,0,0,0,1,1,1]),y!==G.b.FLIP_N_ROTATE_TILE&&y!==G.b.FLIP_N_ROTATE_ROW||(c[1]=[0,1,1,1,1,0,0,0]);let p=[];const E=[],X=[];let d=0;for(let k=0;k<A;k++)for(let n=0;n<V;n++)M.push(n*H-T+z,k*o-W+Q,0),M.push((n+1)*H-T+z,k*o-W+Q,0),M.push((n+1)*H-T+z,(k+1)*o-W+Q,0),M.push(n*H-T+z,(k+1)*o-W+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),p=y===G.b.FLIP_TILE||y===G.b.ROTATE_TILE||y===G.b.FLIP_N_ROTATE_TILE?p.concat(c[(n%2+k%2)%2]):y===G.b.FLIP_ROW||y===G.b.ROTATE_ROW||y===G.b.FLIP_N_ROTATE_ROW?p.concat(c[k%2]):p.concat(c[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),d+=4;if(q>0||U>0){const n=U>0&&(i===G.b.CENTER||i===G.b.TOP),k=U>0&&(i===G.b.CENTER||i===G.b.BOTTOM),B=q>0&&(h===G.b.CENTER||h===G.b.RIGHT),b=q>0&&(h===G.b.CENTER||h===G.b.LEFT);let c,a,O,e,w=[];if(n&&B&&(M.push(l+z,v+Q,0),M.push(-T+z,v+Q,0),M.push(-T+z,v+U+Q,0),M.push(l+z,v+U+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,c=1-q/H,a=1-U/o,O=1,e=1,w=[c,a,O,a,O,e,c,e],y===G.b.ROTATE_ROW&&(w=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),y===G.b.FLIP_ROW&&(w=[1-c,a,1-O,a,1-O,e,1-c,e]),y===G.b.FLIP_N_ROTATE_ROW&&(w=[c,1-a,O,1-a,O,1-e,c,1-e]),p=p.concat(w),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n&&b&&(M.push(T+z,v+Q,0),M.push(F+z,v+Q,0),M.push(F+z,v+U+Q,0),M.push(T+z,v+U+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,c=0,a=1-U/o,O=q/H,e=1,w=[c,a,O,a,O,e,c,e],(y===G.b.ROTATE_ROW||y===G.b.ROTATE_TILE&&V%2===0)&&(w=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),(y===G.b.FLIP_ROW||y===G.b.FLIP_TILE&&V%2===0)&&(w=[1-c,a,1-O,a,1-O,e,1-c,e]),(y===G.b.FLIP_N_ROTATE_ROW||y===G.b.FLIP_N_ROTATE_TILE&&V%2===0)&&(w=[c,1-a,O,1-a,O,1-e,c,1-e]),p=p.concat(w),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&B&&(M.push(l+z,W+Q,0),M.push(-T+z,W+Q,0),M.push(-T+z,g+Q,0),M.push(l+z,g+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,c=1-q/H,a=0,O=1,e=U/o,w=[c,a,O,a,O,e,c,e],(y===G.b.ROTATE_ROW&&A%2===1||y===G.b.ROTATE_TILE&&A%1===0)&&(w=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),(y===G.b.FLIP_ROW&&A%2===1||y===G.b.FLIP_TILE&&A%2===0)&&(w=[1-c,a,1-O,a,1-O,e,1-c,e]),(y===G.b.FLIP_N_ROTATE_ROW&&A%2===1||y===G.b.FLIP_N_ROTATE_TILE&&A%2===0)&&(w=[c,1-a,O,1-a,O,1-e,c,1-e]),p=p.concat(w),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),k&&b&&(M.push(T+z,W+Q,0),M.push(F+z,W+Q,0),M.push(F+z,g+Q,0),M.push(T+z,g+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,c=0,a=0,O=q/H,e=U/o,w=[c,a,O,a,O,e,c,e],(y===G.b.ROTATE_ROW&&A%2===1||y===G.b.ROTATE_TILE&&(A+V)%2===1)&&(w=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),(y===G.b.FLIP_ROW&&A%2===1||y===G.b.FLIP_TILE&&(A+V)%2===1)&&(w=[1-c,a,1-O,a,1-O,e,1-c,e]),(y===G.b.FLIP_N_ROTATE_ROW&&A%2===1||y===G.b.FLIP_N_ROTATE_TILE&&(A+V)%2===1)&&(w=[c,1-a,O,1-a,O,1-e,c,1-e]),p=p.concat(w),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),n){const n=[];c=0,a=1-U/o,O=1,e=1,n[0]=[c,a,O,a,O,e,c,e],n[1]=[c,a,O,a,O,e,c,e],y!==G.b.ROTATE_TILE&&y!==G.b.ROTATE_ROW||(n[1]=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),y!==G.b.FLIP_TILE&&y!==G.b.FLIP_ROW||(n[1]=[1-c,a,1-O,a,1-O,e,1-c,e]),y!==G.b.FLIP_N_ROTATE_TILE&&y!==G.b.FLIP_N_ROTATE_ROW||(n[1]=[c,1-a,O,1-a,O,1-e,c,1-e]);for(let o=0;o<V;o++)M.push(o*H-T+z,v+Q,0),M.push((o+1)*H-T+z,v+Q,0),M.push((o+1)*H-T+z,v+U+Q,0),M.push(o*H-T+z,v+U+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,p=y===G.b.FLIP_TILE||y===G.b.ROTATE_TILE||y===G.b.FLIP_N_ROTATE_TILE?p.concat(n[(o+1)%2]):y===G.b.FLIP_ROW||y===G.b.ROTATE_ROW||y===G.b.FLIP_N_ROTATE_ROW?p.concat(n[1]):p.concat(n[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(k){const n=[];c=0,a=0,O=1,e=U/o,n[0]=[c,a,O,a,O,e,c,e],n[1]=[c,a,O,a,O,e,c,e],y!==G.b.ROTATE_TILE&&y!==G.b.ROTATE_ROW||(n[1]=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),y!==G.b.FLIP_TILE&&y!==G.b.FLIP_ROW||(n[1]=[1-c,a,1-O,a,1-O,e,1-c,e]),y!==G.b.FLIP_N_ROTATE_TILE&&y!==G.b.FLIP_N_ROTATE_ROW||(n[1]=[c,1-a,O,1-a,O,1-e,c,1-e]);for(let o=0;o<V;o++)M.push(o*H-T+z,g-U+Q,0),M.push((o+1)*H-T+z,g-U+Q,0),M.push((o+1)*H-T+z,g+Q,0),M.push(o*H-T+z,g+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,p=y===G.b.FLIP_TILE||y===G.b.ROTATE_TILE||y===G.b.FLIP_N_ROTATE_TILE?p.concat(n[(o+A)%2]):y===G.b.FLIP_ROW||y===G.b.ROTATE_ROW||y===G.b.FLIP_N_ROTATE_ROW?p.concat(n[A%2]):p.concat(n[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const n=[];c=1-q/H,a=0,O=1,e=1,n[0]=[c,a,O,a,O,e,c,e],n[1]=[c,a,O,a,O,e,c,e],y!==G.b.ROTATE_TILE&&y!==G.b.ROTATE_ROW||(n[1]=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),y!==G.b.FLIP_TILE&&y!==G.b.FLIP_ROW||(n[1]=[1-c,a,1-O,a,1-O,e,1-c,e]),y!==G.b.FLIP_N_ROTATE_TILE&&y!==G.b.FLIP_N_ROTATE_ROW||(n[1]=[c,1-a,O,1-a,O,1-e,c,1-e]);for(let H=0;H<A;H++)M.push(l+z,H*o-W+Q,0),M.push(l+q+z,H*o-W+Q,0),M.push(l+q+z,(H+1)*o-W+Q,0),M.push(l+z,(H+1)*o-W+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,p=y===G.b.FLIP_TILE||y===G.b.ROTATE_TILE||y===G.b.FLIP_N_ROTATE_TILE?p.concat(n[(H+1)%2]):y===G.b.FLIP_ROW||y===G.b.ROTATE_ROW||y===G.b.FLIP_N_ROTATE_ROW?p.concat(n[H%2]):p.concat(n[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(b){const n=[];c=0,a=0,O=q/o,e=1,n[0]=[c,a,O,a,O,e,c,e],n[1]=[c,a,O,a,O,e,c,e],y!==G.b.ROTATE_TILE&&y!==G.b.ROTATE_ROW||(n[1]=[1-c,1-a,1-O,1-a,1-O,1-e,1-c,1-e]),y!==G.b.FLIP_TILE&&y!==G.b.FLIP_ROW||(n[1]=[1-c,a,1-O,a,1-O,e,1-c,e]),y!==G.b.FLIP_N_ROTATE_TILE&&y!==G.b.FLIP_N_ROTATE_ROW||(n[1]=[c,1-a,O,1-a,O,1-e,c,1-e]);for(let H=0;H<A;H++)M.push(F-q+z,H*o-W+Q,0),M.push(F+z,H*o-W+Q,0),M.push(F+z,(H+1)*o-W+Q,0),M.push(F-q+z,(H+1)*o-W+Q,0),X.push(d,d+1,d+3,d+1,d+2,d+3),d+=4,p=y===G.b.FLIP_TILE||y===G.b.ROTATE_TILE||y===G.b.FLIP_N_ROTATE_TILE?p.concat(n[(H+V)%2]):y===G.b.FLIP_ROW||y===G.b.ROTATE_ROW||y===G.b.FLIP_N_ROTATE_ROW?p.concat(n[H%2]):p.concat(n[0]),E.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),f.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const a=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE;k.c._ComputeSides(a,M,X,f,p,n.frontUVs,n.backUVs);const O=new k.c;O.indices=X,O.Xn=M,O.dn=f,O.On=p;const e=a===k.c.DOUBLESIDE?E.concat(E):E;return O.an=e,O}function T(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return U(y).wn(o,y.updatable),o}function W(n){const y=n.faceUV||new Array(6),H=n.faceColors,h=n.pattern||G.b.NO_FLIP,B=n.width||n.size||1,V=n.height||n.size||1,q=n.depth||n.size||1,b=n.tileWidth||n.tileSize||1,T=n.tileHeight||n.tileSize||1,W=n.alignHorizontal||0,z=n.alignVertical||0,Q=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE;for(let G=0;G<6;G++)void 0===y[G]&&(y[G]=new o.Vector4(0,0,1,1)),H&&void 0===H[G]&&(H[G]=new A.pi(1,1,1,1));const l=B/2,v=V/2,F=q/2,g=[];for(let o=0;o<2;o++)g[o]=U({pattern:h,tileWidth:b,tileHeight:T,width:B,height:V,alignVertical:z,alignHorizontal:W,sideOrientation:Q});for(let o=2;o<4;o++)g[o]=U({pattern:h,tileWidth:b,tileHeight:T,width:q,height:V,alignVertical:z,alignHorizontal:W,sideOrientation:Q});let M=z;z===G.b.BOTTOM?M=G.b.TOP:z===G.b.TOP&&(M=G.b.BOTTOM);for(let o=4;o<6;o++)g[o]=U({pattern:h,tileWidth:b,tileHeight:T,width:B,height:q,alignVertical:M,alignHorizontal:W,sideOrientation:Q});let f=[],c=[],p=[],E=[];const X=[],d=[],a=[],O=[];let e=0,w=0;for(let G=0;G<6;G++){const n=g[G].Xn.length;d[G]=[],a[G]=[];for(let y=0;y<n/3;y++)d[G].push(new o.zy(g[G].Xn[3*y],g[G].Xn[3*y+1],g[G].Xn[3*y+2])),a[G].push(new o.zy(g[G].dn[3*y],g[G].dn[3*y+1],g[G].dn[3*y+2]));e=g[G].On.length,O[G]=[];for(let H=0;H<e;H+=2)O[G][H]=y[G].x+(y[G].z-y[G].x)*g[G].On[H],O[G][H+1]=y[G].y+(y[G].w-y[G].y)*g[G].On[H+1],i.e&&(O[G][H+1]=1-O[G][H+1]);if(p=p.concat(O[G]),E=E.concat(g[G].indices.map((n=>n+w))),w+=d[G].length,H)for(let y=0;y<4;y++)X.push(H[G].r,H[G].g,H[G].b,H[G].a)}const j=new o.zy(0,0,F),I=o.Matrix.RotationY(Math.PI);f=d[0].map((n=>o.zy.TransformNormal(n,I).add(j))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[]),c=a[0].map((n=>o.zy.TransformNormal(n,I))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[]),f=f.concat(d[1].map((n=>n.Qy(j))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[])),c=c.concat(a[1].map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[]));const R=new o.zy(l,0,0),C=o.Matrix.RotationY(-Math.PI/2);f=f.concat(d[2].map((n=>o.zy.TransformNormal(n,C).add(R))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[])),c=c.concat(a[2].map((n=>o.zy.TransformNormal(n,C))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[]));const S=o.Matrix.RotationY(Math.PI/2);f=f.concat(d[3].map((n=>o.zy.TransformNormal(n,S).Qy(R))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[])),c=c.concat(a[3].map((n=>o.zy.TransformNormal(n,S))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[]));const N=new o.zy(0,v,0),r=o.Matrix.RotationX(Math.PI/2);f=f.concat(d[4].map((n=>o.zy.TransformNormal(n,r).add(N))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[])),c=c.concat(a[4].map((n=>o.zy.TransformNormal(n,r))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[]));const K=o.Matrix.RotationX(-Math.PI/2);f=f.concat(d[5].map((n=>o.zy.TransformNormal(n,K).Qy(N))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[])),c=c.concat(a[5].map((n=>o.zy.TransformNormal(n,K))).map((n=>[n.x,n.y,n.z])).reduce(((n,y)=>n.concat(y)),[])),k.c._ComputeSides(Q,f,E,c,p);const Y=new k.c;if(Y.indices=E,Y.Xn=f,Y.dn=c,Y.On=p,H){const n=Q===k.c.DOUBLESIDE?X.concat(X):X;Y.an=n}return Y}function z(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return W(y).wn(o,y.updatable),o}k.c.CreateTiledPlane=U;k.c.CreateTiledBox=W;var Q=H(12763),l=H(11554),v=H(11515);function F(n){const y=n.height||2;let H=0===n.diameterTop?0:n.diameterTop||n.diameter||1,h=0===n.diameterBottom?0:n.diameterBottom||n.diameter||1;H=H||1e-5,h=h||1e-5;const B=0|(n.tessellation||24),V=0|(n.subdivisions||1),q=!!n.hasRings,b=!!n.enclose,U=0===n.cap?0:n.cap||G.b.CAP_ALL,T=n.arc&&(n.arc<=0||n.arc>1)?1:n.arc||1,W=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE,z=n.faceUV||new Array(3),Q=n.faceColors,l=2+(1+(1!==T&&b?2:0))*(q?V:1);let F;for(F=0;F<l;F++)Q&&void 0===Q[F]&&(Q[F]=new A.pi(1,1,1,1));for(F=0;F<l;F++)z&&void 0===z[F]&&(z[F]=new o.Vector4(0,0,1,1));const g=[],M=[],f=[],c=[],p=[],E=2*Math.PI*T/B;let X,d,a;const O=(h-H)/2/y,e=o.zy.Zero(),w=o.zy.Zero(),j=o.zy.Zero(),I=o.zy.Zero(),R=o.zy.Zero(),C=v.e.Y;let S,N,r,K=1,Y=1,D=0,Z=0;for(S=0;S<=V;S++)for(d=S/V,a=(d*(H-h)+h)/2,K=q&&0!==S&&S!==V?2:1,r=0;r<K;r++){for(q&&(Y+=r),b&&(Y+=2*r),N=0;N<=B;N++)X=N*E,e.x=Math.cos(-X)*a,e.y=-y/2+d*y,e.z=Math.sin(-X)*a,0===H&&S===V?(w.x=f[f.length-3*(B+1)],w.y=f[f.length-3*(B+1)+1],w.z=f[f.length-3*(B+1)+2]):(w.x=e.x,w.z=e.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*O,w.normalize()),0===N&&(j.B(e),I.B(w)),M.push(e.x,e.y,e.z),f.push(w.x,w.y,w.z),Z=q?D!==Y?z[Y].y:z[Y].w:z[Y].y+(z[Y].w-z[Y].y)*d,c.push(z[Y].x+(z[Y].z-z[Y].x)*N/B,i.e?1-Z:Z),Q&&p.push(Q[Y].r,Q[Y].g,Q[Y].b,Q[Y].a);1!==T&&b&&(M.push(e.x,e.y,e.z),M.push(0,e.y,0),M.push(0,e.y,0),M.push(j.x,j.y,j.z),o.zy.CrossToRef(C,w,R),R.normalize(),f.push(R.x,R.y,R.z,R.x,R.y,R.z),o.zy.CrossToRef(I,C,R),R.normalize(),f.push(R.x,R.y,R.z,R.x,R.y,R.z),Z=q?D!==Y?z[Y+1].y:z[Y+1].w:z[Y+1].y+(z[Y+1].w-z[Y+1].y)*d,c.push(z[Y+1].x,i.e?1-Z:Z),c.push(z[Y+1].z,i.e?1-Z:Z),Z=q?D!==Y?z[Y+2].y:z[Y+2].w:z[Y+2].y+(z[Y+2].w-z[Y+2].y)*d,c.push(z[Y+2].x,i.e?1-Z:Z),c.push(z[Y+2].z,i.e?1-Z:Z),Q&&(p.push(Q[Y+1].r,Q[Y+1].g,Q[Y+1].b,Q[Y+1].a),p.push(Q[Y+1].r,Q[Y+1].g,Q[Y+1].b,Q[Y+1].a),p.push(Q[Y+2].r,Q[Y+2].g,Q[Y+2].b,Q[Y+2].a),p.push(Q[Y+2].r,Q[Y+2].g,Q[Y+2].b,Q[Y+2].a))),D!==Y&&(D=Y)}const s=1!==T&&b?B+4:B;for(S=0,Y=0;Y<V;Y++){let n=0,y=0,H=0,o=0;for(N=0;N<B;N++)n=S*(s+1)+N,y=(S+1)*(s+1)+N,H=S*(s+1)+(N+1),o=(S+1)*(s+1)+(N+1),g.push(n,y,H),g.push(o,H,y);1!==T&&b&&(g.push(n+2,y+2,H+2),g.push(o+2,H+2,y+2),g.push(n+4,y+4,H+4),g.push(o+4,H+4,y+4)),S=q?S+2:S+1}const P=n=>{const G=n?H/2:h/2;if(0===G)return;let k,V,q;const b=n?z[l-1]:z[0];let A=null;Q&&(A=n?Q[l-1]:Q[0]);const U=M.length/3,W=n?y/2:-y/2,v=new o.zy(0,W,0);M.push(v.x,v.y,v.z),f.push(0,n?1:-1,0);const F=b.y+.5*(b.w-b.y);c.push(b.x+.5*(b.z-b.x),i.e?1-F:F),A&&p.push(A.r,A.g,A.b,A.a);const E=new o.Vector2(.5,.5);for(q=0;q<=B;q++){k=2*Math.PI*q*T/B;const y=Math.cos(-k),H=Math.sin(-k);V=new o.zy(y*G,W,H*G);const h=new o.Vector2(y*E.x+.5,H*E.y+.5);M.push(V.x,V.y,V.z),f.push(0,n?1:-1,0);const U=b.y+(b.w-b.y)*h.y;c.push(b.x+(b.z-b.x)*h.x,i.e?1-U:U),A&&p.push(A.r,A.g,A.b,A.a)}for(q=0;q<B;q++)n?(g.push(U),g.push(U+(q+2)),g.push(U+(q+1))):(g.push(U),g.push(U+(q+1)),g.push(U+(q+2)))};U!==G.b.CAP_START&&U!==G.b.CAP_ALL||P(!1),U!==G.b.CAP_END&&U!==G.b.CAP_ALL||P(!0),k.c._ComputeSides(W,M,g,f,c,n.frontUVs,n.backUVs);const x=new k.c;return x.indices=g,x.Xn=M,x.dn=f,x.On=c,Q&&(x.an=p),x}function g(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return F(y).wn(o,y.updatable),o}function M(n){const y=[],H=[],G=[],h=[],B=n.diameter||1,V=n.thickness||.5,q=0|(n.tessellation||16),b=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE,A=q+1;for(let k=0;k<=q;k++){const n=k/q,b=k*Math.PI*2/q-Math.PI/2,U=o.Matrix.Translation(B/2,0,0).multiply(o.Matrix.RotationY(b));for(let B=0;B<=q;B++){const b=1-B/q,T=B*Math.PI*2/q+Math.PI,W=Math.cos(T),z=Math.sin(T);let Q=new o.zy(W,z,0),l=Q.scale(V/2);const v=new o.Vector2(n,b);l=o.zy.TransformCoordinates(l,U),Q=o.zy.TransformNormal(Q,U),H.push(l.x,l.y,l.z),G.push(Q.x,Q.y,Q.z),h.push(v.x,i.e?1-v.y:v.y);const F=(k+1)%A,g=(B+1)%A;y.push(k*A+B),y.push(k*A+g),y.push(F*A+B),y.push(k*A+g),y.push(F*A+g),y.push(F*A+B)}}k.c._ComputeSides(b,H,y,G,h,n.frontUVs,n.backUVs);const U=new k.c;return U.indices=y,U.Xn=H,U.dn=G,U.On=h,U}function f(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return M(y).wn(o,y.updatable),o}k.c.CreateCylinder=F,G.b.CreateCylinder=(n,y,H,o,h,k,i,B,V)=>{void 0!==i&&i instanceof l.e||(void 0!==i&&(V=B||G.b.DEFAULTSIDE,B=i),i=k,k=1);return g(n,{height:y,diameterTop:H,diameterBottom:o,tessellation:h,subdivisions:k,sideOrientation:V,updatable:B},i)};function c(n){const y=[],H=[],G=[],h=[],B=n.radius||2,V=n.tube||.5,q=n.radialSegments||32,b=n.tubularSegments||32,A=n.p||2,U=n.q||3,T=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE,W=n=>{const y=Math.cos(n),H=Math.sin(n),G=U/A*n,h=Math.cos(G),k=B*(2+h)*.5*y,i=B*(2+h)*H*.5,V=B*Math.sin(G)*.5;return new o.zy(k,i,V)};let z,Q;for(z=0;z<=q;z++){const n=z%q/q*2*A*Math.PI,y=W(n),G=W(n+.01),k=G.Qy(y);let B=G.add(y);const U=o.zy.Cross(k,B);for(B=o.zy.Cross(U,k),U.normalize(),B.normalize(),Q=0;Q<b;Q++){const n=Q%b/b*2*Math.PI,o=-V*Math.cos(n),G=V*Math.sin(n);H.push(y.x+o*B.x+G*U.x),H.push(y.y+o*B.y+G*U.y),H.push(y.z+o*B.z+G*U.z),h.push(z/q),h.push(i.e?1-Q/b:Q/b)}}for(z=0;z<q;z++)for(Q=0;Q<b;Q++){const n=(Q+1)%b,H=z*b+Q,o=(z+1)*b+Q,G=(z+1)*b+n,h=z*b+n;y.push(h),y.push(o),y.push(H),y.push(h),y.push(G),y.push(o)}k.c.ComputeNormals(H,y,G),k.c._ComputeSides(T,H,y,G,h,n.frontUVs,n.backUVs);const l=new k.c;return l.indices=y,l.Xn=H,l.dn=G,l.On=h,l}function p(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2?arguments[2]:void 0;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return c(y).wn(o,y.updatable),o}k.c.CreateTorus=M,G.b.CreateTorus=(n,y,H,o,G,h,k)=>f(n,{diameter:y,thickness:H,tessellation:o,sideOrientation:k,updatable:h},G);k.c.CreateTorusKnot=c,G.b.CreateTorusKnot=(n,y,H,o,G,h,k,i,B,V)=>p(n,{radius:y,tube:H,radialSegments:o,tubularSegments:G,p:h,q:k,sideOrientation:V,updatable:B},i);var E=H(13284),X=H(11930),d=H(11527);function a(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=y.path,h=y.shape,k=y.scale||1,i=y.rotation||0,B=0===y.cap?0:y.cap||G.b.NO_CAP,V=y.updatable,q=G.b._GetDefaultSideOrientation(y.sideOrientation),b=y.instance||null,A=y.invertUV||!1,U=y.closeShape||!1,T=y.closePath||!1,W=y.capFunction||null;return e(n,h,o,k,i,null,null,T,U,B,!1,H,!!V,q,b,A,y.frontUVs||null,y.backUVs||null,y.firstNormal||null,!!y.adjustFrame,W)}function O(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=y.path,h=y.shape,k=y.scaleFunction||(()=>1),i=y.rotationFunction||(()=>0),B=y.closePath||y.ribbonCloseArray||!1,V=y.closeShape||y.ribbonClosePath||!1,q=0===y.cap?0:y.cap||G.b.NO_CAP,b=y.updatable,A=y.firstNormal||null,U=y.adjustFrame||!1,T=G.b._GetDefaultSideOrientation(y.sideOrientation),W=y.instance,z=y.invertUV||!1,Q=y.capFunction||null;return e(n,h,o,null,null,k,i,B,V,q,!0,H,!!b,T,W||null,z,y.frontUVs||null,y.backUVs||null,A,U,Q||null)}function e(n,y,H,h,k,i,B,q,b,A,U,T,W,z,Q,l,v,F,g,M,f){const c=(n,y,H,h,k,i,B,V,q,b,A)=>{const U=H.getTangents(),T=H.getNormals(),W=H.getBinormals(),z=H.getDistances();if(A)for(let G=0;G<U.length;G++)if(0==U[G].x&&0==U[G].y&&0==U[G].z&&U[G].B(U[G-1]),0==T[G].x&&0==T[G].y&&0==T[G].z&&T[G].B(T[G-1]),0==W[G].x&&0==W[G].y&&0==W[G].z&&W[G].B(W[G-1]),G>0){let n=U[G-1];o.zy.Dot(n,U[G])<0&&U[G].scaleInPlace(-1),n=T[G-1],o.zy.Dot(n,T[G])<0&&T[G].scaleInPlace(-1),n=W[G-1],o.zy.Dot(n,W[G])<0&&W[G].scaleInPlace(-1)}let Q=0;const l=b&&V?V:()=>null!==i?i:0,v=b&&B?B:()=>null!==k?k:1;let F=q===G.b.NO_CAP||q===G.b.CAP_END?0:2;const g=o.TmpVectors.Matrix[0];for(let G=0;G<y.length;G++){const H=[],k=l(G,z[G]),i=v(G,z[G]);o.Matrix.RotationAxisToRef(U[G],Q,g);for(let h=0;h<n.length;h++){const k=U[G].scale(n[h].z).add(T[G].scale(n[h].x)).add(W[G].scale(n[h].y)),B=o.zy.Zero();o.zy.TransformCoordinatesToRef(k,g,B),B.scaleInPlace(i).addInPlace(y[G]),H[h]=B}h[F]=H,Q+=k,F++}const M=f||(n=>{const y=Array(),H=o.zy.Zero();let G;for(G=0;G<n.length;G++)H.addInPlace(n[G]);for(H.scaleInPlace(1/n.length),G=0;G<n.length;G++)y.push(H);return y});switch(q){case G.b.NO_CAP:break;case G.b.CAP_START:h[0]=M(h[2]),h[1]=h[2];break;case G.b.CAP_END:h[F]=h[F-1],h[F+1]=M(h[F-1]);break;case G.b.CAP_ALL:h[0]=M(h[2]),h[1]=h[2],h[F]=h[F-1],h[F+1]=M(h[F-1])}return h};let p,E;if(Q){const n=Q._creationDataStorage;return p=g?n.path3D.update(H,g):n.path3D.update(H),E=c(y,H,n.path3D,n.pathArray,h,k,i,B,n.cap,U,M),Q=V("",{pathArray:E,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:Q},T||void 0)}p=g?new d.i(H,g):new d.i(H);E=c(y,H,p,new Array,h,k,i,B,A=A<0||A>3?0:A,U,M);const X=V(n,{pathArray:E,closeArray:q,closePath:b,updatable:W,sideOrientation:z,invertUV:l,frontUVs:v||void 0,backUVs:F||void 0},T);return X._creationDataStorage.pathArray=E,X._creationDataStorage.path3D=p,X._creationDataStorage.cap=A,X}function w(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=y.arc?y.arc<=0||y.arc>1?1:y.arc:1,k=void 0===y.closed||y.closed,i=y.shape,B=y.radius||1,q=y.tessellation||64,b=y.clip||0,A=y.updatable,U=G.b._GetDefaultSideOrientation(y.sideOrientation),T=y.cap||G.b.NO_CAP,W=2*Math.PI,z=[],Q=y.invertUV||!1;let l=0,v=0;const F=W/q*h;let g,M;for(l=0;l<=q-b;l++){for(M=[],T!=G.b.CAP_START&&T!=G.b.CAP_ALL||(M.push(new o.zy(0,i[0].y,0)),M.push(new o.zy(Math.cos(l*F)*i[0].x*B,i[0].y,Math.sin(l*F)*i[0].x*B))),v=0;v<i.length;v++)g=new o.zy(Math.cos(l*F)*i[v].x*B,i[v].y,Math.sin(l*F)*i[v].x*B),M.push(g);T!=G.b.CAP_END&&T!=G.b.CAP_ALL||(M.push(new o.zy(Math.cos(l*F)*i[i.length-1].x*B,i[i.length-1].y,Math.sin(l*F)*i[i.length-1].x*B)),M.push(new o.zy(0,i[i.length-1].y,0))),z.push(M)}return V(n,{pathArray:z,closeArray:k,sideOrientation:U,updatable:A,invertUV:Q,frontUVs:y.frontUVs,backUVs:y.backUVs},H)}G.b.ExtrudeShape=function(n,y,H,o,h,k){let i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7?arguments[7]:void 0,V=arguments.length>8?arguments[8]:void 0,q=arguments.length>9?arguments[9]:void 0;return a(n,{shape:y,path:H,scale:o,rotation:h,cap:0===k?0:k||G.b.NO_CAP,sideOrientation:V,instance:q,updatable:B},i)},G.b.ExtrudeShapeCustom=(n,y,H,o,h,k,i,B,V,q,b,A)=>O(n,{shape:y,path:H,scaleFunction:o,rotationFunction:h,ribbonCloseArray:k,ribbonClosePath:i,cap:0===B?0:B||G.b.NO_CAP,sideOrientation:b,instance:A,updatable:q},V);G.b.CreateLathe=(n,y,H,o,G,h,k)=>w(n,{shape:y,radius:H,tessellation:o,sideOrientation:k,updatable:h},G);var j=H(12665),I=H(12618);function R(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=y.path;let k=y.instance,i=1;void 0!==y.radius?i=y.radius:k&&(i=k._creationDataStorage.radius);const B=y.tessellation||64,q=y.radiusFunction||null;let b=y.cap||G.b.NO_CAP;const A=y.invertUV||!1,U=y.updatable,T=G.b._GetDefaultSideOrientation(y.sideOrientation);y.arc=y.arc&&(y.arc<=0||y.arc>1)?1:y.arc||1;const W=(n,y,H,h,k,i,B,V)=>{const q=y.getTangents(),b=y.getNormals(),A=y.getDistances(),U=2*Math.PI/k*V,T=i||(()=>h);let W,z,Q,l;const v=o.TmpVectors.Matrix[0];let F=B===G.b.NO_CAP||B===G.b.CAP_END?0:2;for(let G=0;G<n.length;G++){z=T(G,A[G]),W=Array(),Q=b[G];for(let y=0;y<k;y++)o.Matrix.RotationAxisToRef(q[G],U*y,v),l=W[y]?W[y]:o.zy.Zero(),o.zy.TransformCoordinatesToRef(Q,v,l),l.scaleInPlace(z).addInPlace(n[G]),W[y]=l;H[F]=W,F++}const g=(y,H)=>{const o=Array();for(let G=0;G<y;G++)o.push(n[H]);return o};switch(B){case G.b.NO_CAP:break;case G.b.CAP_START:H[0]=g(k,0),H[1]=H[2].slice(0);break;case G.b.CAP_END:H[F]=H[F-1].slice(0),H[F+1]=g(k,n.length-1);break;case G.b.CAP_ALL:H[0]=g(k,0),H[1]=H[2].slice(0),H[F]=H[F-1].slice(0),H[F+1]=g(k,n.length-1)}return H};let z,Q;if(k){const n=k._creationDataStorage,H=y.arc||n.arc;return z=n.path3D.update(h),Q=W(h,z,n.pathArray,i,n.tessellation,q,n.cap,H),k=V("",{pathArray:Q,instance:k}),n.path3D=z,n.pathArray=Q,n.arc=H,n.radius=i,k}z=new d.i(h);b=b<0||b>3?0:b,Q=W(h,z,new Array,i,B,q,b,y.arc);const l=V(n,{pathArray:Q,closePath:!0,closeArray:!1,updatable:U,sideOrientation:T,invertUV:A,frontUVs:y.frontUVs,backUVs:y.backUVs},H);return l._creationDataStorage.pathArray=Q,l._creationDataStorage.path3D=z,l._creationDataStorage.tessellation=B,l._creationDataStorage.cap=b,l._creationDataStorage.arc=y.arc,l._creationDataStorage.radius=i,l}function C(n){const y=[];y[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},y[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},y[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},y[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},y[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},y[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},y[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},y[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},y[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},y[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},y[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},y[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},y[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},y[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},y[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const H=n.type&&(n.type<0||n.type>=y.length)?0:n.type||0,G=n.size,h=n.sizeX||G||1,B=n.sizeY||G||1,V=n.sizeZ||G||1,q=n.custom||y[H],b=q.face.length,U=n.faceUV||new Array(b),T=n.faceColors,W=void 0===n.flat||n.flat,z=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE,Q=[],l=[],v=[],F=[],g=[];let M=0,f=0;const c=[];let p,E,X,d,a,O,e=0,w=0;if(W)for(w=0;w<b;w++)T&&void 0===T[w]&&(T[w]=new A.pi(1,1,1,1)),U&&void 0===U[w]&&(U[w]=new o.Vector4(0,0,1,1));if(W)for(w=0;w<b;w++){const n=q.face[w].length;for(X=2*Math.PI/n,d=.5*Math.tan(X/2),a=.5,e=0;e<n;e++)Q.push(q.vertex[q.face[w][e]][0]*h,q.vertex[q.face[w][e]][1]*B,q.vertex[q.face[w][e]][2]*V),c.push(M),M++,p=U[w].x+(U[w].z-U[w].x)*(.5+d),E=U[w].y+(U[w].w-U[w].y)*(a-.5),F.push(p,i.e?1-E:E),O=d*Math.cos(X)-a*Math.sin(X),a=d*Math.sin(X)+a*Math.cos(X),d=O,T&&g.push(T[w].r,T[w].g,T[w].b,T[w].a);for(e=0;e<n-2;e++)l.push(c[0+f],c[e+2+f],c[e+1+f]);f+=n}else{for(e=0;e<q.vertex.length;e++)Q.push(q.vertex[e][0]*h,q.vertex[e][1]*B,q.vertex[e][2]*V),F.push(0,i.e?1:0);for(w=0;w<b;w++)for(e=0;e<q.face[w].length-2;e++)l.push(q.face[w][0],q.face[w][e+2],q.face[w][e+1])}k.c.ComputeNormals(Q,l,v),k.c._ComputeSides(z,Q,l,v,F,n.frontUVs,n.backUVs);const j=new k.c;return j.Xn=Q,j.indices=l,j.dn=v,j.On=F,T&&W&&(j.an=g),j}function S(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return C(y).wn(o,y.updatable),o}G.b.CreateTube=(n,y,H,o,G,h,k,i,B,V)=>R(n,{path:y,radius:H,tessellation:o,radiusFunction:G,arc:1,cap:h,updatable:i,sideOrientation:B,instance:V},k);function N(n){const y=n.sideOrientation||k.c.DEFAULTSIDE,H=n.radius||1,G=void 0===n.flat||n.flat,h=0|(n.subdivisions||4),B=n.radiusX||H,V=n.radiusY||H,q=n.radiusZ||H,b=(1+Math.sqrt(5))/2,A=[-1,b,-0,1,b,0,-1,-b,0,1,-b,0,0,-1,-b,0,1,-b,0,-1,b,0,1,b,b,0,1,b,0,-1,-b,0,1,-b,0,-1],U=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],T=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],W=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],z=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],Q=[],l=[],v=[],F=[];let g=0;const M=new Array(3),f=new Array(3);let c;for(c=0;c<3;c++)M[c]=o.zy.Zero(),f[c]=o.Vector2.Zero();for(let k=0;k<20;k++){for(c=0;c<3;c++){const n=U[3*k+c];M[c].Mi(A[3*T[n]],A[3*T[n]+1],A[3*T[n]+2]),M[c].normalize(),f[c].Mi(.134765625*W[2*n]+.05859375+-.0390625*z[k],.2333984375*W[2*n+1]+.025390625+.01953125*z[k])}const n=(n,y,H,k)=>{const b=o.zy.Lerp(M[0],M[2],y/h),A=o.zy.Lerp(M[1],M[2],y/h),U=h===y?M[2]:o.zy.Lerp(b,A,n/(h-y));let T;if(U.normalize(),G){const n=o.zy.Lerp(M[0],M[2],k/h),y=o.zy.Lerp(M[1],M[2],k/h);T=o.zy.Lerp(n,y,H/(h-k))}else T=new o.zy(U.x,U.y,U.z);T.x/=B,T.y/=V,T.z/=q,T.normalize();const W=o.Vector2.Lerp(f[0],f[2],y/h),z=o.Vector2.Lerp(f[1],f[2],y/h),c=h===y?f[2]:o.Vector2.Lerp(W,z,n/(h-y));l.push(U.x*B,U.y*V,U.z*q),v.push(T.x,T.y,T.z),F.push(c.x,i.e?1-c.y:c.y),Q.push(g),g++};for(let y=0;y<h;y++)for(let H=0;H+y<h;H++)n(H,y,H+1/3,y+1/3),n(H+1,y,H+1/3,y+1/3),n(H,y+1,H+1/3,y+1/3),H+y+1<h&&(n(H+1,y,H+2/3,y+2/3),n(H+1,y+1,H+2/3,y+2/3),n(H,y+1,H+2/3,y+2/3))}k.c._ComputeSides(y,l,Q,v,F,n.frontUVs,n.backUVs);const p=new k.c;return p.indices=Q,p.Xn=l,p.dn=v,p.On=F,p}function r(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=new G.b(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),o._originalBuilderSideOrientation=y.sideOrientation;return N(y).wn(o,y.updatable),o}k.c.CreatePolyhedron=C,G.b.CreatePolyhedron=(n,y,H)=>S(n,y,H);k.c.CreateIcoSphere=N,G.b.CreateIcoSphere=(n,y,H)=>r(n,y,H);var K=H(11303);const Y=new o.zy(1,0,0),D=new o.zy(-1,0,0),Z=new o.zy(0,1,0),s=new o.zy(0,-1,0),P=new o.zy(0,0,1),x=new o.zy(0,0,-1);class t{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.zy.Zero(),y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.zy.Up(),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Vector2.Zero(),G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=n,this.normal=y,this.uv=H,this.vertexIdx=G,this.vertexIdxForBones=h,this.localPositionOverride=k,this.localNormalOverride=i,this.matrixIndicesOverride=B,this.matrixWeightsOverride=V}clone(){var n,y,H,o;return new t(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(n=this.localPositionOverride)||void 0===n?void 0:n.slice(),null===(y=this.localNormalOverride)||void 0===y?void 0:y.slice(),null===(H=this.matrixIndicesOverride)||void 0===H?void 0:H.slice(),null===(o=this.matrixWeightsOverride)||void 0===o?void 0:o.slice())}}function u(n,y,H){var B,V,q,b,A;const U=!!y.skeleton,T=!(null===(B=y.morphTargetManager)||void 0===B||!B.numTargets),W=H.localMode||U,z=y.Fi(),Q=U||T?y.Ni(!0,!0):y.getVerticesData(h.g.PositionKind),l=U||T?y.getNormalsData(!0,!0):y.getVerticesData(h.g.NormalKind),v=W?U?y.getVerticesData(h.g.PositionKind):Q:null,F=W?U?y.getVerticesData(h.g.NormalKind):l:null,g=y.getVerticesData(h.g.UVKind),M=U?y.getVerticesData(h.g.MatricesIndicesKind):null,f=U?y.getVerticesData(h.g.MatricesWeightsKind):null,c=U?y.getVerticesData(h.g.MatricesIndicesExtraKind):null,p=U?y.getVerticesData(h.g.MatricesWeightsExtraKind):null,E=H.position||o.zy.Zero();let X=H.normal||o.zy.Up();const d=H.size||o.zy.One(),a=H.angle||0;if(!X){const n=new o.zy(0,0,1),H=y.pn().activeCamera,G=o.zy.TransformCoordinates(n,H.getWorldMatrix());X=H.globalPosition.Qy(G)}const O=-Math.atan2(X.z,X.x)-Math.PI/2,e=Math.sqrt(X.x*X.x+X.z*X.z),w=Math.atan2(X.y,e),j=new k.c;j.indices=[],j.Xn=[],j.dn=[],j.On=[],j.matricesIndices=U?[]:null,j.matricesWeights=U?[]:null,j.matricesIndicesExtra=c?[]:null,j.matricesWeightsExtra=p?[]:null;let I=0;const R=(n,y)=>{const G=new t;if(!z||!Q||!l)return G;const h=z[n];if(G.vertexIdx=3*h,G.vertexIdxForBones=4*h,G.position=new o.zy(Q[3*h],Q[3*h+1],Q[3*h+2]),o.zy.TransformCoordinatesToRef(G.position,y,G.position),G.normal=new o.zy(l[3*h],l[3*h+1],l[3*h+2]),o.zy.TransformNormalToRef(G.normal,y,G.normal),H.captureUVS&&g){const n=g[2*h+1];G.uv=new o.Vector2(g[2*h],i.e?1-n:n)}return G},C=[0,0,0,0],S=(n,y)=>{if(0===n.length)return n;const H=.5*Math.abs(o.zy.Dot(d,y)),G=(n,y,H,o)=>{for(let G=0;G<o;++G)if(n[H+G]===y)return H+G;return-1},h=(n,h)=>{const k=o.zy.GetClipFactor(n.position,h.position,y,H);let i=C,B=C;if(M&&f){const y=n.matrixIndicesOverride?0:n.vertexIdxForBones,H=n.matrixIndicesOverride??M,o=n.matrixWeightsOverride??f,V=h.matrixIndicesOverride?0:h.vertexIdxForBones,q=h.matrixIndicesOverride??M,b=h.matrixWeightsOverride??f;i=[0,0,0,0],B=[0,0,0,0];let A=0;for(let n=0;n<4;++n)if(o[y+n]>0){const h=G(q,H[y+n],V,4);i[A]=H[y+n],B[A]=(0,K.Lerp)(o[y+n],h>=0?b[h]:0,k),A++}for(let n=0;n<4&&A<4;++n){const o=q[V+n];-1===G(H,o,y,4)&&(i[A]=o,B[A]=(0,K.Lerp)(0,b[V+n],k),A++)}const U=B[0]+B[1]+B[2]+B[3];B[0]/=U,B[1]/=U,B[2]/=U,B[3]/=U}const V=n.localPositionOverride?n.localPositionOverride[0]:(null===v||void 0===v?void 0:v[n.vertexIdx])??0,q=n.localPositionOverride?n.localPositionOverride[1]:(null===v||void 0===v?void 0:v[n.vertexIdx+1])??0,b=n.localPositionOverride?n.localPositionOverride[2]:(null===v||void 0===v?void 0:v[n.vertexIdx+2])??0,A=h.localPositionOverride?h.localPositionOverride[0]:(null===v||void 0===v?void 0:v[h.vertexIdx])??0,U=h.localPositionOverride?h.localPositionOverride[1]:(null===v||void 0===v?void 0:v[h.vertexIdx+1])??0,T=h.localPositionOverride?h.localPositionOverride[2]:(null===v||void 0===v?void 0:v[h.vertexIdx+2])??0,W=n.localNormalOverride?n.localNormalOverride[0]:(null===F||void 0===F?void 0:F[n.vertexIdx])??0,z=n.localNormalOverride?n.localNormalOverride[1]:(null===F||void 0===F?void 0:F[n.vertexIdx+1])??0,Q=n.localNormalOverride?n.localNormalOverride[2]:(null===F||void 0===F?void 0:F[n.vertexIdx+2])??0,l=W+((h.localNormalOverride?h.localNormalOverride[0]:(null===F||void 0===F?void 0:F[h.vertexIdx])??0)-W)*k,g=z+((h.localNormalOverride?h.localNormalOverride[1]:(null===F||void 0===F?void 0:F[h.vertexIdx+1])??0)-z)*k,c=Q+((h.localNormalOverride?h.localNormalOverride[2]:(null===F||void 0===F?void 0:F[h.vertexIdx+2])??0)-Q)*k,p=Math.sqrt(l*l+g*g+c*c);return new t(o.zy.Lerp(n.position,h.position,k),o.zy.Lerp(n.normal,h.normal,k).normalize(),o.Vector2.Lerp(n.uv,h.uv,k),-1,-1,v?[V+(A-V)*k,q+(U-q)*k,b+(T-b)*k]:null,F?[l/p,g/p,c/p]:null,i,B)};let k=null;n.length>3&&(k=[]);for(let i=0;i<n.length;i+=3){let G=0,B=null,V=null,q=null,b=null;const A=o.zy.Dot(n[i].position,y)-H>0,U=o.zy.Dot(n[i+1].position,y)-H>0,T=o.zy.Dot(n[i+2].position,y)-H>0;switch(G=(A?1:0)+(U?1:0)+(T?1:0),G){case 0:n.length>3?(k.push(n[i]),k.push(n[i+1]),k.push(n[i+2])):k=n;break;case 1:if(k=k??new Array,A&&(B=n[i+1],V=n[i+2],q=h(n[i],B),b=h(n[i],V)),U){B=n[i],V=n[i+2],q=h(n[i+1],B),b=h(n[i+1],V),k.push(q),k.push(V.clone()),k.push(B.clone()),k.push(V.clone()),k.push(q.clone()),k.push(b);break}T&&(B=n[i],V=n[i+1],q=h(n[i+2],B),b=h(n[i+2],V)),B&&V&&q&&b&&(k.push(B.clone()),k.push(V.clone()),k.push(q),k.push(b),k.push(q.clone()),k.push(V.clone()));break;case 2:k=k??new Array,A||(B=n[i].clone(),V=h(B,n[i+1]),q=h(B,n[i+2]),k.push(B),k.push(V),k.push(q)),U||(B=n[i+1].clone(),V=h(B,n[i+2]),q=h(B,n[i]),k.push(B),k.push(V),k.push(q)),T||(B=n[i+2].clone(),V=h(B,n[i]),q=h(B,n[i+1]),k.push(B),k.push(V),k.push(q))}}return k},N=y instanceof G.b?y:null,r=null===N||void 0===N?void 0:N._thinInstanceDataStorage.matrixData,u=(null===N||void 0===N?void 0:N.Xi)||1,L=o.TmpVectors.Matrix[0];L.B(o.Matrix.IdentityReadOnly);for(let G=0;G<u;++G){if(null!==N&&void 0!==N&&N.hasThinInstances&&r){const n=16*G;L.setRowFromFloats(0,r[n+0],r[n+1],r[n+2],r[n+3]),L.setRowFromFloats(1,r[n+4],r[n+5],r[n+6],r[n+7]),L.setRowFromFloats(2,r[n+8],r[n+9],r[n+10],r[n+11]),L.setRowFromFloats(3,r[n+12],r[n+13],r[n+14],r[n+15])}const n=o.Matrix.RotationYawPitchRoll(O,w,a).multiply(o.Matrix.Translation(E.x,E.y,E.z)),h=o.Matrix.Invert(n),k=y.getWorldMatrix(),B=L.multiply(k).multiply(h),V=new Array(3);for(let y=0;y<z.length;y+=3){let n=V;if(n[0]=R(y,B),n[1]=R(y+1,B),n[2]=R(y+2,B),!(H.cullBackFaces&&-n[0].normal.z<=0&&-n[1].normal.z<=0&&-n[2].normal.z<=0)&&(n=S(n,Y),n&&(n=S(n,D),n&&(n=S(n,Z),n&&(n=S(n,s),n&&(n=S(n,P),n&&(n=S(n,x),n)))))))for(let y=0;y<n.length;y++){const o=n[y];if(j.indices.push(I),W?(o.localPositionOverride?(j.Xn[3*I]=o.localPositionOverride[0],j.Xn[3*I+1]=o.localPositionOverride[1],j.Xn[3*I+2]=o.localPositionOverride[2]):v&&(j.Xn[3*I]=v[o.vertexIdx],j.Xn[3*I+1]=v[o.vertexIdx+1],j.Xn[3*I+2]=v[o.vertexIdx+2]),o.localNormalOverride?(j.dn[3*I]=o.localNormalOverride[0],j.dn[3*I+1]=o.localNormalOverride[1],j.dn[3*I+2]=o.localNormalOverride[2]):F&&(j.dn[3*I]=F[o.vertexIdx],j.dn[3*I+1]=F[o.vertexIdx+1],j.dn[3*I+2]=F[o.vertexIdx+2])):(o.position.toArray(j.Xn,3*I),o.normal.toArray(j.dn,3*I)),j.matricesIndices&&j.matricesWeights&&(o.matrixIndicesOverride?(j.matricesIndices[4*I]=o.matrixIndicesOverride[0],j.matricesIndices[4*I+1]=o.matrixIndicesOverride[1],j.matricesIndices[4*I+2]=o.matrixIndicesOverride[2],j.matricesIndices[4*I+3]=o.matrixIndicesOverride[3]):(M&&(j.matricesIndices[4*I]=M[o.vertexIdxForBones],j.matricesIndices[4*I+1]=M[o.vertexIdxForBones+1],j.matricesIndices[4*I+2]=M[o.vertexIdxForBones+2],j.matricesIndices[4*I+3]=M[o.vertexIdxForBones+3]),c&&j.matricesIndicesExtra&&(j.matricesIndicesExtra[4*I]=c[o.vertexIdxForBones],j.matricesIndicesExtra[4*I+1]=c[o.vertexIdxForBones+1],j.matricesIndicesExtra[4*I+2]=c[o.vertexIdxForBones+2],j.matricesIndicesExtra[4*I+3]=c[o.vertexIdxForBones+3])),o.matrixWeightsOverride?(j.matricesWeights[4*I]=o.matrixWeightsOverride[0],j.matricesWeights[4*I+1]=o.matrixWeightsOverride[1],j.matricesWeights[4*I+2]=o.matrixWeightsOverride[2],j.matricesWeights[4*I+3]=o.matrixWeightsOverride[3]):(f&&(j.matricesWeights[4*I]=f[o.vertexIdxForBones],j.matricesWeights[4*I+1]=f[o.vertexIdxForBones+1],j.matricesWeights[4*I+2]=f[o.vertexIdxForBones+2],j.matricesWeights[4*I+3]=f[o.vertexIdxForBones+3]),p&&j.matricesWeightsExtra&&(j.matricesWeightsExtra[4*I]=p[o.vertexIdxForBones],j.matricesWeightsExtra[4*I+1]=p[o.vertexIdxForBones+1],j.matricesWeightsExtra[4*I+2]=p[o.vertexIdxForBones+2],j.matricesWeightsExtra[4*I+3]=p[o.vertexIdxForBones+3]))),H.captureUVS)o.uv.toArray(j.On,2*I);else{j.On.push(.5+o.position.x/d.x);const n=.5+o.position.y/d.y;j.On.push(i.e?1-n:n)}I++}}}0===j.indices.length&&(j.indices=null),0===j.Xn.length&&(j.Xn=null),0===j.dn.length&&(j.dn=null),0===j.On.length&&(j.On=null),0===(null===(V=j.matricesIndices)||void 0===V?void 0:V.length)&&(j.matricesIndices=null),0===(null===(q=j.matricesWeights)||void 0===q?void 0:q.length)&&(j.matricesWeights=null),0===(null===(b=j.matricesIndicesExtra)||void 0===b?void 0:b.length)&&(j.matricesIndicesExtra=null),0===(null===(A=j.matricesWeightsExtra)||void 0===A?void 0:A.length)&&(j.matricesWeightsExtra=null);const J=new G.b(n,y.pn());return j.wn(J),W?(J.skeleton=y.skeleton,J.parent=y):(J.position=E.clone(),J.rotation=new o.zy(w,O,a)),J.Qi(!0),J.refreshBoundingInfo(!0,!0),J}function L(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const y=0|Math.max(n.subdivisions?n.subdivisions:2,1),H=0|Math.max(n.tessellation?n.tessellation:16,3),G=Math.max(n.height?n.height:1,0),h=Math.max(n.radius?n.radius:.25,0),B=0|Math.max(n.capSubdivisions?n.capSubdivisions:6,1),V=H,q=y,b=Math.max(n.radiusTop?n.radiusTop:h,0),A=Math.max(n.radiusBottom?n.radiusBottom:h,0),U=G-(b+A),T=2*Math.PI,W=Math.max(n.topCapSubdivisions?n.topCapSubdivisions:B,1),z=Math.max(n.bottomCapSubdivisions?n.bottomCapSubdivisions:B,1),Q=Math.acos((A-b)/G);let l=[];const v=[],F=[],g=[];let M=0;const f=[],c=.5*U,p=.5*Math.PI;let E,X;const d=o.zy.Zero(),a=o.zy.Zero(),O=Math.cos(Q),e=Math.sin(Q),w=new o.Vector2(b*e,c+b*O).Qy(new o.Vector2(A*e,A*O-c)).length(),j=b*Q+w+A*(p-Q);let I=0;for(X=0;X<=W;X++){const n=[],y=p-Q*(X/W);I+=b*Q/W;const H=Math.cos(y),o=Math.sin(y),G=H*b;for(E=0;E<=V;E++){const y=E/V,h=y*T+0,k=Math.sin(h),B=Math.cos(h);a.x=G*k,a.y=c+o*b,a.z=G*B,v.push(a.x,a.y,a.z),d.set(H*k,o,H*B),F.push(d.x,d.y,d.z),g.push(y,i.e?I/j:1-I/j),n.push(M),M++}f.push(n)}const R=G-b-A+O*b-O*A,C=e*(A-b)/R;for(X=1;X<=q;X++){const n=[];I+=w/q;const y=e*(X*(A-b)/q+b);for(E=0;E<=V;E++){const H=E/V,o=H*T+0,G=Math.sin(o),h=Math.cos(o);a.x=y*G,a.y=c+O*b-X*R/q,a.z=y*h,v.push(a.x,a.y,a.z),d.set(G,C,h).normalize(),F.push(d.x,d.y,d.z),g.push(H,i.e?I/j:1-I/j),n.push(M),M++}f.push(n)}for(X=1;X<=z;X++){const n=[],y=p-Q-(Math.PI-Q)*(X/z);I+=A*Q/z;const H=Math.cos(y),o=Math.sin(y),G=H*A;for(E=0;E<=V;E++){const y=E/V,h=y*T+0,k=Math.sin(h),B=Math.cos(h);a.x=G*k,a.y=o*A-c,a.z=G*B,v.push(a.x,a.y,a.z),d.set(H*k,o,H*B),F.push(d.x,d.y,d.z),g.push(y,i.e?I/j:1-I/j),n.push(M),M++}f.push(n)}for(E=0;E<V;E++)for(X=0;X<W+q+z;X++){const n=f[X][E],y=f[X+1][E],H=f[X+1][E+1],o=f[X][E+1];l.push(n),l.push(y),l.push(o),l.push(y),l.push(H),l.push(o)}if(l=l.reverse(),n.orientation&&!n.orientation.equals(o.zy.Up())){const y=new o.Matrix;n.orientation.clone().scale(.5*Math.PI).cross(o.zy.Up()).toQuaternion().toRotationMatrix(y);const H=o.zy.Zero();for(let n=0;n<v.length;n+=3)H.set(v[n],v[n+1],v[n+2]),o.zy.TransformCoordinatesToRef(H.clone(),y,H),v[n]=H.x,v[n+1]=H.y,v[n+2]=H.z}const S=new k.c;return S.Xn=v,S.dn=F,S.On=g,S.indices=l,S}function J(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:o.zy.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=new G.b(n,H);return L(y).wn(h,y.updatable),h}G.b.CreateDecal=(n,y,H,o,G,h)=>u(n,y,{position:H,normal:o,size:G,angle:h});G.b.CreateCapsule=(n,y,H)=>J(n,y,H),k.c.CreateCapsule=L;var m=H(11114),nn=H(11297);class yn{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=n,this.y=y,n!==Math.floor(n)&&(n=Math.floor(n),m.d.Warn("x is not an integer, floor(x) used")),y!==Math.floor(y)&&(y=Math.floor(y),m.d.Warn("y is not an integer, floor(y) used"))}clone(){return new yn(this.x,this.y)}rotate60About(n){const y=this.x;return this.x=n.x+n.y-this.y,this.y=y+this.y-n.x,this}rotateNeg60About(n){const y=this.x;return this.x=y+this.y-n.y,this.y=n.x+n.y-y,this}rotate120(n,y){n!==Math.floor(n)&&(n=Math.floor(n),m.d.Warn("m not an integer only floor(m) used")),y!==Math.floor(y)&&(y=Math.floor(y),m.d.Warn("n not an integer only floor(n) used"));const H=this.x;return this.x=n-H-this.y,this.y=y+H,this}rotateNeg120(n,y){n!==Math.floor(n)&&(n=Math.floor(n),m.d.Warn("m is not an integer, floor(m) used")),y!==Math.floor(y)&&(y=Math.floor(y),m.d.Warn("n is not an integer,   floor(n) used"));const H=this.x;return this.x=this.y-y,this.y=n+y-H-this.y,this}toCartesianOrigin(n,y){const H=o.zy.Zero();return H.x=n.x+2*this.x*y+this.y*y,H.y=n.y+Math.sqrt(3)*this.y*y,H}static Zero(){return new yn(0,0)}}class Hn{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new on("icosahedron","Regular",[[0,nn.i,-1],[-nn.i,1,0],[-1,0,-nn.i],[1,0,-nn.i],[nn.i,1,0],[0,nn.i,1],[-1,0,nn.i],[-nn.i,-1,0],[0,-nn.i,-1],[nn.i,-1,0],[1,0,nn.i],[0,-nn.i,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let n=12;const y={},H=this.m,o=this.n;let G,h,k,i,B,V=H,q=1,b=0;0!==o&&(V=(0,K.HighestCommonFactor)(H,o)),q=H/V,b=o/V;const A=yn.Zero(),U=new yn(H,o),T=new yn(-o,H+o),W=yn.Zero(),z=yn.Zero(),Q=yn.Zero();let l,v,F,g,M=[];const f=[],c=this.vertByDist,p=(H,o,G,h)=>{l=H+"|"+G,v=o+"|"+h,l in y||v in y?l in y&&!(v in y)?y[v]=y[l]:v in y&&!(l in y)&&(y[l]=y[v]):(y[l]=n,y[v]=n,n++),c[G][0]>2?f[y[l]]=[-c[G][0],c[G][1],y[l]]:f[y[l]]=[M[c[G][0]],c[G][1],y[l]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let E=0;E<20;E++){if(M=this.IDATA.face[E],k=M[2],i=M[1],B=M[0],F=A.x+"|"+A.y,l=E+"|"+F,l in y||(y[l]=k,f[k]=[M[c[F][0]],c[F][1]]),F=U.x+"|"+U.y,l=E+"|"+F,l in y||(y[l]=i,f[i]=[M[c[F][0]],c[F][1]]),F=T.x+"|"+T.y,l=E+"|"+F,l in y||(y[l]=B,f[B]=[M[c[F][0]],c[F][1]]),G=this.IDATA.edgematch[E][0],h=this.IDATA.edgematch[E][1],"B"===h)for(let n=1;n<V;n++)z.x=H-n*(q+b),z.y=o+n*q,Q.x=-n*b,Q.y=n*(q+b),F=z.x+"|"+z.y,g=Q.x+"|"+Q.y,p(E,G,F,g);if("O"===h)for(let n=1;n<V;n++)Q.x=-n*b,Q.y=n*(q+b),W.x=n*q,W.y=n*b,F=Q.x+"|"+Q.y,g=W.x+"|"+W.y,p(E,G,F,g);if(G=this.IDATA.edgematch[E][2],h=this.IDATA.edgematch[E][3],h&&"A"===h)for(let n=1;n<V;n++)W.x=n*q,W.y=n*b,z.x=H-(V-n)*(q+b),z.y=o+(V-n)*q,F=W.x+"|"+W.y,g=z.x+"|"+z.y,p(E,G,F,g);for(let H=0;H<this.vertices.length;H++)F=this.vertices[H].x+"|"+this.vertices[H].y,l=E+"|"+F,l in y||(y[l]=n++,c[F][0]>2?f[y[l]]=[-c[F][0],c[F][1],y[l]]:f[y[l]]=[M[c[F][0]],c[F][1],y[l]])}this.closestTo=f,this.vecToidx=y}calcCoeffs(){const n=this.m,y=this.n,H=Math.sqrt(3)/3,o=n*n+y*y+n*y;this.coau=(n+y)/o,this.cobu=-y/o,this.coav=-H*(n-y)/o,this.cobv=H*(2*n+y)/o}createInnerFacets(){const n=this.m,y=this.n;for(let H=0;H<y+n+1;H++)for(let n=this.min[H];n<this.max[H]+1;n++)n<this.max[H]&&n<this.max[H+1]+1&&this.innerFacets.push(["|"+n+"|"+H,"|"+n+"|"+(H+1),"|"+(n+1)+"|"+H]),H>0&&n<this.max[H-1]&&n+1<this.max[H]+1&&this.innerFacets.push(["|"+n+"|"+H,"|"+(n+1)+"|"+H,"|"+(n+1)+"|"+(H-1)])}edgeVecsABOB(){const n=this.m,y=this.n,H=new yn(-y,n+y);for(let o=1;o<n+y;o++){const n=new yn(this.min[o],o),y=new yn(this.min[o-1],o-1),G=new yn(this.min[o+1],o+1),h=n.clone(),k=y.clone(),i=G.clone();h.rotate60About(H),k.rotate60About(H),i.rotate60About(H);const B=new yn(this.max[h.y],h.y),V=new yn(this.max[h.y-1],h.y-1),q=new yn(this.max[h.y-1]-1,h.y-1);h.x===B.x&&h.y===B.y||(h.x!==V.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,V,q]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,q,B])):h.y===i.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([n,y,V]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([n,V,G])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([n,y,V]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([n,V,B])))}}mapABOBtoOBOA(){const n=new yn(0,0);for(let y=0;y<this.isoVecsABOB.length;y++){const H=[];for(let o=0;o<3;o++)n.x=this.isoVecsABOB[y][o].x,n.y=this.isoVecsABOB[y][o].y,0===this.vertexTypes[y][o]&&n.rotateNeg120(this.m,this.n),H.push(n.clone());this.isoVecsOBOA.push(H)}}mapABOBtoBAOA(){const n=new yn(0,0);for(let y=0;y<this.isoVecsABOB.length;y++){const H=[];for(let o=0;o<3;o++)n.x=this.isoVecsABOB[y][o].x,n.y=this.isoVecsABOB[y][o].y,1===this.vertexTypes[y][o]&&n.rotate120(this.m,this.n),H.push(n.clone());this.isoVecsBAOA.push(H)}}MapToFace(n,y){const H=this.IDATA.face[n],G=H[2],h=H[1],k=H[0],i=o.zy.gy(this.IDATA.vertex[G]),B=o.zy.gy(this.IDATA.vertex[h]),V=o.zy.gy(this.IDATA.vertex[k]),q=B.Qy(i),b=V.Qy(i),A=q.scale(this.coau).add(b.scale(this.cobu)),U=q.scale(this.coav).add(b.scale(this.cobv)),T=[];let W,z=o.TmpVectors.zy[0];for(let o=0;o<this.cartesian.length;o++)z=A.scale(this.cartesian[o].x).add(U.scale(this.cartesian[o].y)).add(i),T[o]=[z.x,z.y,z.z],W=n+"|"+this.vertices[o].x+"|"+this.vertices[o].y,y.vertex[this.vecToidx[W]]=[z.x,z.y,z.z]}build(n,y){const H=[],o=yn.Zero(),G=new yn(n,y),h=new yn(-y,n+y);H.push(o,G,h);for(let F=y;F<n+1;F++)for(let y=0;y<n+1-F;y++)H.push(new yn(y,F));if(y>0){const o=(0,K.HighestCommonFactor)(n,y),G=n/o,h=y/o;for(let i=1;i<o;i++)H.push(new yn(i*G,i*h)),H.push(new yn(-i*h,i*(G+h))),H.push(new yn(n-i*(G+h),y+i*G));const k=n/y;for(let i=1;i<y;i++)for(let o=0;o<i*k;o++)H.push(new yn(o,i)),H.push(new yn(o,i).rotate120(n,y)),H.push(new yn(o,i).rotateNeg120(n,y))}H.sort(((n,y)=>n.x-y.x)),H.sort(((n,y)=>n.y-y.y));const k=new Array(n+y+1),i=new Array(n+y+1);for(let F=0;F<k.length;F++)k[F]=1/0,i[F]=-1/0;let B=0,V=0;const q=H.length;for(let F=0;F<q;F++)V=H[F].x,B=H[F].y,k[B]=Math.min(V,k[B]),i[B]=Math.max(V,i[B]);const b=(H,o)=>{const G=H.clone();return"A"===o&&G.rotateNeg120(n,y),"B"===o&&G.rotate120(n,y),G.x<0?G.y:G.x+G.y},A=[],U=[],T=[],W=[],z={},Q=[];let l=-1,v=-1;for(let F=0;F<q;F++)A[F]=H[F].toCartesianOrigin(new yn(0,0),.5),U[F]=b(H[F],"O"),T[F]=b(H[F],"A"),W[F]=b(H[F],"B"),U[F]===T[F]&&T[F]===W[F]?(l=3,v=U[F]):U[F]===T[F]?(l=4,v=U[F]):T[F]===W[F]?(l=5,v=T[F]):W[F]===U[F]&&(l=6,v=U[F]),U[F]<T[F]&&U[F]<W[F]&&(l=2,v=U[F]),T[F]<U[F]&&T[F]<W[F]&&(l=1,v=T[F]),W[F]<T[F]&&W[F]<U[F]&&(l=0,v=W[F]),Q.push([l,v,H[F].x,H[F].y]);Q.sort(((n,y)=>n[2]-y[2])),Q.sort(((n,y)=>n[3]-y[3])),Q.sort(((n,y)=>n[1]-y[1])),Q.sort(((n,y)=>n[0]-y[0]));for(let F=0;F<Q.length;F++)z[Q[F][2]+"|"+Q[F][3]]=[Q[F][0],Q[F][1],F];return this.m=n,this.n=y,this.vertices=H,this.vertByDist=z,this.cartesian=A,this.min=k,this.max=i,this}}class on{constructor(n,y,H,o){this.name=n,this.category=y,this.vertex=H,this.face=o}}class Gn extends on{innerToData(n,y){for(let H=0;H<y.innerFacets.length;H++)this.face.push(y.innerFacets[H].map((H=>y.vecToidx[n+H])))}mapABOBtoDATA(n,y){const H=y.IDATA.edgematch[n][0];for(let o=0;o<y.isoVecsABOB.length;o++){const G=[];for(let h=0;h<3;h++)0===y.vertexTypes[o][h]?G.push(n+"|"+y.isoVecsABOB[o][h].x+"|"+y.isoVecsABOB[o][h].y):G.push(H+"|"+y.isoVecsABOB[o][h].x+"|"+y.isoVecsABOB[o][h].y);this.face.push([y.vecToidx[G[0]],y.vecToidx[G[1]],y.vecToidx[G[2]]])}}mapOBOAtoDATA(n,y){const H=y.IDATA.edgematch[n][0];for(let o=0;o<y.isoVecsOBOA.length;o++){const G=[];for(let h=0;h<3;h++)1===y.vertexTypes[o][h]?G.push(n+"|"+y.isoVecsOBOA[o][h].x+"|"+y.isoVecsOBOA[o][h].y):G.push(H+"|"+y.isoVecsOBOA[o][h].x+"|"+y.isoVecsOBOA[o][h].y);this.face.push([y.vecToidx[G[0]],y.vecToidx[G[1]],y.vecToidx[G[2]]])}}mapBAOAtoDATA(n,y){const H=y.IDATA.edgematch[n][2];for(let o=0;o<y.isoVecsBAOA.length;o++){const G=[];for(let h=0;h<3;h++)1===y.vertexTypes[o][h]?G.push(n+"|"+y.isoVecsBAOA[o][h].x+"|"+y.isoVecsBAOA[o][h].y):G.push(H+"|"+y.isoVecsBAOA[o][h].x+"|"+y.isoVecsBAOA[o][h].y);this.face.push([y.vecToidx[G[0]],y.vecToidx[G[1]],y.vecToidx[G[2]]])}}orderData(n){const y=[];for(let h=0;h<13;h++)y[h]=[];const H=n.closestTo;for(let h=0;h<H.length;h++)H[h][0]>-1?H[h][1]>0&&y[H[h][0]].push([h,H[h][1]]):y[12].push([h,H[h][0]]);const o=[];for(let h=0;h<12;h++)o[h]=h;let G=12;for(let h=0;h<12;h++){y[h].sort(((n,y)=>n[1]-y[1]));for(let n=0;n<y[h].length;n++)o[y[h][n][0]]=G++}for(let h=0;h<y[12].length;h++)o[y[12][h][0]]=G++;for(let h=0;h<this.vertex.length;h++)this.vertex[h].push(o[h]);this.vertex.sort(((n,y)=>n[3]-y[3]));for(let h=0;h<this.vertex.length;h++)this.vertex[h].pop();for(let h=0;h<this.face.length;h++)for(let n=0;n<this.face[h].length;n++)this.face[h][n]=o[this.face[h][n]];this.sharedNodes=y[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(n,y){const H=[],o=[];let G=y.pop();o.push(G);let h=this.face[G].indexOf(n);h=(h+2)%3;let k=this.face[G][h];H.push(k);let i=0;for(;y.length>0;)G=y[i],this.face[G].indexOf(k)>-1?(h=(this.face[G].indexOf(k)+1)%3,k=this.face[G][h],H.push(k),o.push(G),y.splice(i,1),i=0):i++;return this.adjacentFaces.push(H),o}toGoldbergPolyhedronData(){const n=new on("GeoDual","Goldberg",[],[]);n.name="GD dual";const y=this.vertex.length,H=new Array(y);for(let B=0;B<y;B++)H[B]=[];for(let B=0;B<this.face.length;B++)for(let n=0;n<3;n++)H[this.face[B][n]].push(B);let o=0,G=0,h=0,k=[],i=[];this.adjacentFaces=[];for(let B=0;B<H.length;B++){n.face[B]=this.setOrder(B,H[B].concat([]));for(const y of H[B]){o=0,G=0,h=0,k=this.face[y];for(let n=0;n<3;n++)i=this.vertex[k[n]],o+=i[0],G+=i[1],h+=i[2];n.vertex[y]=[o/3,G/3,h/3]}}return n}static BuildGeodesicData(n){const y=new Gn("Geodesic-m-n","Geodesic",[[0,nn.i,-1],[-nn.i,1,0],[-1,0,-nn.i],[1,0,-nn.i],[nn.i,1,0],[0,nn.i,1],[-1,0,nn.i],[-nn.i,-1,0],[0,-nn.i,-1],[nn.i,-1,0],[1,0,nn.i],[0,-nn.i,1]],[]);n.setIndices(),n.calcCoeffs(),n.createInnerFacets(),n.edgeVecsABOB(),n.mapABOBtoOBOA(),n.mapABOBtoBAOA();for(let H=0;H<n.IDATA.face.length;H++)n.MapToFace(H,y),y.innerToData(H,n),"B"===n.IDATA.edgematch[H][1]&&y.mapABOBtoDATA(H,n),"O"===n.IDATA.edgematch[H][1]&&y.mapOBOAtoDATA(H,n),"A"===n.IDATA.edgematch[H][3]&&y.mapBAOAtoDATA(H,n);y.orderData(n);return y.vertex=y.vertex.map((function(n){const y=n[0],H=n[1],o=n[2],G=Math.sqrt(y*y+H*H+o*o);return n[0]*=1/G,n[1]*=1/G,n[2]*=1/G,n})),y}}G.b._GoldbergMeshParser=(n,y)=>hn.Parse(n,y);class hn extends G.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(n,y){return void 0===y?(n>this.goldbergData.nbUnsharedFaces-1&&(m.d.Warn("Maximum number of unshared faces used"),n=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+n):(n>11&&(m.d.Warn("Last pole used"),n=11),y>this.goldbergData.nbFacesAtPole-1&&(m.d.Warn("Maximum number of faces at a pole used"),y=this.goldbergData.nbFacesAtPole-1),12+n*this.goldbergData.nbFacesAtPole+y)}_changeGoldbergFaceColors(n){for(let H=0;H<n.length;H++){const y=n[H][0],o=n[H][1],G=n[H][2];for(let n=y;n<o+1;n++)this.goldbergData.faceColors[n]=G}const y=[];for(let H=0;H<12;H++)for(let n=0;n<5;n++)y.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);for(let H=12;H<this.goldbergData.faceColors.length;H++)for(let n=0;n<6;n++)y.push(this.goldbergData.faceColors[H].r,this.goldbergData.faceColors[H].g,this.goldbergData.faceColors[H].b,this.goldbergData.faceColors[H].a);return y}setGoldbergFaceColors(n){const y=this._changeGoldbergFaceColors(n);this.Cn(h.g.ColorKind,y)}updateGoldbergFaceColors(n){const y=this._changeGoldbergFaceColors(n);this.updateVerticesData(h.g.ColorKind,y)}_changeGoldbergFaceUVs(n){const y=this.getVerticesData(h.g.UVKind);for(let H=0;H<n.length;H++){const o=n[H][0],G=n[H][1],h=n[H][2],k=n[H][3],i=n[H][4],B=[],V=[];let q,b;for(let n=0;n<5;n++)q=h.x+k*Math.cos(i+n*Math.PI/2.5),b=h.y+k*Math.sin(i+n*Math.PI/2.5),q<0&&(q=0),q>1&&(q=1),B.push(q,b);for(let n=0;n<6;n++)q=h.x+k*Math.cos(i+n*Math.PI/3),b=h.y+k*Math.sin(i+n*Math.PI/3),q<0&&(q=0),q>1&&(q=1),V.push(q,b);for(let n=o;n<Math.min(12,G+1);n++)for(let H=0;H<5;H++)y[10*n+2*H]=B[2*H],y[10*n+2*H+1]=B[2*H+1];for(let n=Math.max(12,o);n<G+1;n++)for(let H=0;H<6;H++)y[12*n-24+2*H]=V[2*H],y[12*n-23+2*H]=V[2*H+1]}return y}setGoldbergFaceUVs(n){const y=this._changeGoldbergFaceUVs(n);this.Cn(h.g.UVKind,y)}updateGoldbergFaceUVs(n){const y=this._changeGoldbergFaceUVs(n);this.updateVerticesData(h.g.UVKind,y)}placeOnGoldbergFaceAt(n,y,H){const G=o.zy.RotationFromAxis(this.goldbergData.faceXaxis[y],this.goldbergData.faceYaxis[y],this.goldbergData.faceZaxis[y]);n.rotation=G,n.position=this.goldbergData.faceCenters[y].add(this.goldbergData.faceXaxis[y].scale(H.x)).add(this.goldbergData.faceYaxis[y].scale(H.y)).add(this.goldbergData.faceZaxis[y].scale(H.z))}serialize(n){super.serialize(n),n.type="GoldbergMesh";const y={};if(y.adjacentFaces=this.goldbergData.adjacentFaces,y.nbSharedFaces=this.goldbergData.nbSharedFaces,y.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,y.nbFaces=this.goldbergData.nbFaces,y.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){y.faceColors=[];for(const n of this.goldbergData.faceColors)y.faceColors.push(n.Ui())}if(this.goldbergData.faceCenters){y.faceCenters=[];for(const n of this.goldbergData.faceCenters)y.faceCenters.push(n.Ui())}if(this.goldbergData.faceZaxis){y.faceZaxis=[];for(const n of this.goldbergData.faceZaxis)y.faceZaxis.push(n.Ui())}if(this.goldbergData.faceYaxis){y.faceYaxis=[];for(const n of this.goldbergData.faceYaxis)y.faceYaxis.push(n.Ui())}if(this.goldbergData.faceXaxis){y.faceXaxis=[];for(const n of this.goldbergData.faceXaxis)y.faceXaxis.push(n.Ui())}n.goldbergData=y}static Parse(n,y){const H=n.goldbergData;H.faceColors=H.faceColors.map((n=>A.pi.gy(n))),H.faceCenters=H.faceCenters.map((n=>o.zy.gy(n))),H.faceZaxis=H.faceZaxis.map((n=>o.zy.gy(n))),H.faceXaxis=H.faceXaxis.map((n=>o.zy.gy(n))),H.faceYaxis=H.faceYaxis.map((n=>o.zy.gy(n)));const G=new hn(n.name,y);return G.goldbergData=H,G}}var kn=H(11923);const Bn={CreateBox:b.b,CreateTiledBox:z,CreateSphere:Q.d,CreateDisc:q.e,CreateIcoSphere:r,CreateRibbon:V,CreateCylinder:g,CreateTorus:f,CreateTorusKnot:p,CreateLineSystem:E.d,vV:E.h,CreateDashedLines:E.c,ExtrudeShape:a,ExtrudeShapeCustom:O,CreateLathe:w,CreateTiledPlane:T,MV:j.b,CreateGround:I.g,CreateTiledGround:I.i,CreateGroundFromHeightMap:I.c,CreatePolygon:X.d,ExtrudePolygon:X.g,CreateTube:R,CreatePolyhedron:S,CreateGeodesic:function(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=y.m||1;o!==Math.floor(o)&&(o=Math.floor(o),m.d.Warn("m not an integer only floor(m) used"));let G=y.n||0;if(G!==Math.floor(G)&&(G=Math.floor(G),m.d.Warn("n not an integer only floor(n) used")),G>o){const n=G;G=o,o=n,m.d.Warn("n > m therefore m and n swapped")}const h=new Hn;return h.build(o,G),S(n,{custom:Gn.BuildGeodesicData(h),size:y.size,sizeX:y.sizeX,sizeY:y.sizeY,sizeZ:y.sizeZ,faceUV:y.faceUV,faceColors:y.faceColors,flat:y.flat,updatable:y.updatable,sideOrientation:y.sideOrientation,frontUVs:y.frontUVs,backUVs:y.backUVs},H)},CreateGoldberg:function(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const h=y.size,B=y.sizeX||h||1,V=y.sizeY||h||1,q=y.sizeZ||h||1;let b=y.m||1;b!==Math.floor(b)&&(b=Math.floor(b),m.d.Warn("m not an integer only floor(m) used"));let U=y.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),m.d.Warn("n not an integer only floor(n) used")),U>b){const n=U;U=b,b=n,m.d.Warn("n > m therefore m and n swapped")}const T=new Hn;T.build(b,U);const W=Gn.BuildGeodesicData(T),z=W.toGoldbergPolyhedronData(),Q=new hn(n,H);y.sideOrientation=G.b._GetDefaultSideOrientation(y.sideOrientation),Q._originalBuilderSideOrientation=y.sideOrientation;(function(n,y){const H=n.size,G=n.sizeX||H||1,h=n.sizeY||H||1,B=n.sizeZ||H||1,V=0===n.sideOrientation?0:n.sideOrientation||k.c.DEFAULTSIDE,q=[],b=[],A=[],U=[];let T=1/0,W=-1/0,z=1/0,Q=-1/0;for(let o=0;o<y.vertex.length;o++)T=Math.min(T,y.vertex[o][0]*G),W=Math.max(W,y.vertex[o][0]*G),z=Math.min(z,y.vertex[o][1]*h),Q=Math.max(Q,y.vertex[o][1]*h);let l=0;for(let k=0;k<y.face.length;k++){const n=y.face[k],H=o.zy.gy(y.vertex[n[0]]),V=o.zy.gy(y.vertex[n[2]]),v=o.zy.gy(y.vertex[n[1]]),F=V.Qy(H),g=v.Qy(H),M=o.zy.Cross(g,F).normalize();for(let o=0;o<n.length;o++){A.push(M.x,M.y,M.z);const H=y.vertex[n[o]];q.push(H[0]*G,H[1]*h,H[2]*B);const k=(H[1]*h-z)/(Q-z);U.push((H[0]*G-T)/(W-T),i.e?1-k:k)}for(let y=0;y<n.length-2;y++)b.push(l,l+y+2,l+y+1);l+=n.length}k.c._ComputeSides(V,q,b,A,U);const v=new k.c;return v.Xn=q,v.indices=b,v.dn=A,v.On=U,v})(y,z).wn(Q,y.updatable),Q.goldbergData.nbSharedFaces=W.sharedNodes,Q.goldbergData.nbUnsharedFaces=W.poleNodes,Q.goldbergData.adjacentFaces=W.adjacentFaces,Q.goldbergData.nbFaces=Q.goldbergData.nbSharedFaces+Q.goldbergData.nbUnsharedFaces,Q.goldbergData.nbFacesAtPole=(Q.goldbergData.nbUnsharedFaces-12)/12;for(let G=0;G<W.vertex.length;G++)Q.goldbergData.faceCenters.push(o.zy.gy(W.vertex[G])),Q.goldbergData.faceCenters[G].x*=B,Q.goldbergData.faceCenters[G].y*=V,Q.goldbergData.faceCenters[G].z*=q,Q.goldbergData.faceColors.push(new A.pi(1,1,1,1));for(let G=0;G<z.face.length;G++){const n=z.face[G],y=o.zy.gy(z.vertex[n[0]]),H=o.zy.gy(z.vertex[n[2]]),h=o.zy.gy(z.vertex[n[1]]),k=H.Qy(y),i=h.Qy(y),B=o.zy.Cross(i,k).normalize(),V=o.zy.Cross(i,B).normalize();Q.goldbergData.faceXaxis.push(i.normalize()),Q.goldbergData.faceYaxis.push(B),Q.goldbergData.faceZaxis.push(V)}return Q},CreateDecal:u,CreateCapsule:J,CreateText:kn.f}},12686:(n,y,H)=>{"use strict";H.d(y,{b:()=>By});var o=H(11288),G=H(11732);class h extends G.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var k=H(11335),i=(H(11482),H(11248));class B{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(n){this._targetStopDuration!==n&&(this._targetStopDuration=n)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(n){this._noiseTexture!==n&&(this._noiseTexture=n,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(n){this._animationSheetEnabled!==n&&(this._animationSheetEnabled=n)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(n){this._isAnimationSheetEnabled!=n&&(this._isAnimationSheetEnabled=n,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(n){this._useLogarithmicDepth=n&&this.pn().getEngine().getCaps().fragmentDepthSupported}pn(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(n){switch(n){case B.BLENDMODE_MULTIPLYADD:return;case B.BLENDMODE_ADD:n=1;break;case B.BLENDMODE_ONEONE:n=6;break;case B.BLENDMODE_STANDARD:n=2;break;case B.BLENDMODE_MULTIPLY:n=4;break;case B.BLENDMODE_SUBTRACT:n=3}this._engine.setAlphaMode(n)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:o.zy.Zero()}set direction1(n){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=n)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:o.zy.Zero()}set direction2(n){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=n)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:o.zy.Zero()}set minEmitBox(n){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=n)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:o.zy.Zero()}set maxEmitBox(n){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=n)}get billboardMode(){return this._billboardMode}set billboardMode(n){this._billboardMode!==n&&(this._billboardMode=n,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(n){this._isBillboardBased!==n&&(this._isBillboardBased=n,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(n){this._attachImageProcessingConfiguration(n)}_attachImageProcessingConfiguration(n){n!==this._imageProcessingConfiguration&&(!n&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=n)}_reset(){}_removeGradientAndTexture(n,y,H){if(!y)return this;let o=0;for(const G of y){if(G.gradient===n){y.splice(o,1);break}o++}return H&&H.dispose(),this}constructor(n){this.animations=[],this.renderingGroupId=0,this.hy=o.zy.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new o.zy(10,10,10),this.onAnimationEnd=null,this.blendMode=B.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new o.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.zV=new o.zy(0,0,0),this._useLogarithmicDepth=!1,this.gravity=o.zy.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new k.pi(1,1,1,1),this.color2=new k.pi(1,1,1,1),this.colorDead=new k.pi(0,0,0,1),this.textureMask=new k.pi(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new h,this.id=n,this.name=n}createPointEmitter(n,y){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new o.zy(0,1,0),arguments.length>2&&void 0!==arguments[2]||new o.zy(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new o.zy(0,1,0),arguments.length>4&&void 0!==arguments[4]||new o.zy(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new o.zy(0,1,0),arguments.length>3&&void 0!==arguments[3]||new o.zy(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(n,y,H,o){throw new Error("Method not implemented.")}}B.BLENDMODE_ONEONE=0,B.BLENDMODE_STANDARD=1,B.BLENDMODE_ADD=2,B.BLENDMODE_MULTIPLY=3,B.BLENDMODE_MULTIPLYADD=4,B.BLENDMODE_SUBTRACT=-1,(0,i.h)("BABYLON.BaseParticleSystem",B);var V=H(11303),q=H(11118);class b{constructor(){this.direction1=new o.zy(0,1,0),this.direction2=new o.zy(0,1,0),this.minEmitBox=new o.zy(-.5,-.5,-.5),this.maxEmitBox=new o.zy(.5,.5,.5)}startDirectionFunction(n,y,H,G){const h=(0,V.RandomRange)(this.direction1.x,this.direction2.x),k=(0,V.RandomRange)(this.direction1.y,this.direction2.y),i=(0,V.RandomRange)(this.direction1.z,this.direction2.z);if(G)return y.x=h,y.y=k,void(y.z=i);o.zy.TransformNormalFromFloatsToRef(h,k,i,n,y)}startPositionFunction(n,y,H,G){const h=(0,V.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),k=(0,V.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),i=(0,V.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(G)return y.x=h,y.y=k,void(y.z=i);o.zy.TransformCoordinatesFromFloatsToRef(h,k,i,n,y)}clone(){const n=new b;return q.c.DeepCopy(this,n),n}applyToShader(n){n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2),n.setVector3("minEmitBox",this.minEmitBox),n.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(n){n.addUniform("direction1",3),n.addUniform("direction2",3),n.addUniform("minEmitBox",3),n.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.direction1=this.direction1.Ui(),n.direction2=this.direction2.Ui(),n.minEmitBox=this.minEmitBox.Ui(),n.maxEmitBox=this.maxEmitBox.Ui(),n}parse(n){o.zy.FromArrayToRef(n.direction1,0,this.direction1),o.zy.FromArrayToRef(n.direction2,0,this.direction2),o.zy.FromArrayToRef(n.minEmitBox,0,this.minEmitBox),o.zy.FromArrayToRef(n.maxEmitBox,0,this.maxEmitBox)}}class A{get radius(){return this._radius}set radius(n){this._radius=n,this._buildHeight()}get angle(){return this._angle}set angle(n){this._angle=n,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=H,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=y,this.radius=n}startDirectionFunction(n,y,H,G){G?o.TmpVectors.zy[0].B(H.ui).normalize():H.position.subtractToRef(n.getTranslation(),o.TmpVectors.zy[0]).normalize();const h=(0,V.RandomRange)(0,this.directionRandomizer),k=(0,V.RandomRange)(0,this.directionRandomizer),i=(0,V.RandomRange)(0,this.directionRandomizer);y.x=o.TmpVectors.zy[0].x+h,y.y=o.TmpVectors.zy[0].y+k,y.z=o.TmpVectors.zy[0].z+i,y.normalize()}startPositionFunction(n,y,H,G){const h=(0,V.RandomRange)(0,2*Math.PI);let k;this.emitFromSpawnPointOnly?k=1e-4:(k=(0,V.RandomRange)(0,this.heightRange),k=1-k*k);let i=this._radius-(0,V.RandomRange)(0,this._radius*this.radiusRange);i*=k;const B=i*Math.sin(h),q=i*Math.cos(h),b=k*this._height;if(G)return y.x=B,y.y=b,void(y.z=q);o.zy.TransformCoordinatesFromFloatsToRef(B,b,q,n,y)}clone(){const n=new A(this._radius,this._angle,this.directionRandomizer);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat2("radius",this._radius,this.radiusRange),n.setFloat("coneAngle",this._angle),n.setFloat2("height",this._height,this.heightRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",2),n.addUniform("coneAngle",1),n.addUniform("height",2),n.addUniform("directionRandomizer",1)}getEffectDefines(){let n="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(n+="\n#define CONEEMITTERSPAWNPOINT"),n}getClassName(){return"ConeParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this._radius,n.angle=this._angle,n.directionRandomizer=this.directionRandomizer,n.radiusRange=this.radiusRange,n.heightRange=this.heightRange,n.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,n}parse(n){this.radius=n.radius,this.angle=n.angle,this.directionRandomizer=n.directionRandomizer,this.radiusRange=void 0!==n.radiusRange?n.radiusRange:1,this.heightRange=void 0!==n.radiusRange?n.heightRange:1,this.emitFromSpawnPointOnly=void 0!==n.emitFromSpawnPointOnly&&n.emitFromSpawnPointOnly}}class U extends A{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0),G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0);super(n,y),this.direction1=H,this.direction2=G}startDirectionFunction(n,y){const H=(0,V.RandomRange)(this.direction1.x,this.direction2.x),G=(0,V.RandomRange)(this.direction1.y,this.direction2.y),h=(0,V.RandomRange)(this.direction1.z,this.direction2.z);o.zy.TransformNormalFromFloatsToRef(H,G,h,n,y)}clone(){const n=new U(this.radius,this.angle,this.direction1,this.direction2);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const n=super.serialize();return n.direction1=this.direction1.Ui(),n.direction2=this.direction2.Ui(),n}parse(n){super.parse(n),this.direction1.B(n.direction1),this.direction2.B(n.direction2)}}class T{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=n,this.height=y,this.radiusRange=H,this.directionRandomizer=G,this._tempVector=o.zy.Zero()}startDirectionFunction(n,y,H,G,h){H.position.subtractToRef(n.getTranslation(),this._tempVector),this._tempVector.normalize(),o.zy.TransformNormalToRef(this._tempVector,h,this._tempVector);const k=(0,V.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let i=Math.atan2(this._tempVector.x,this._tempVector.z);i+=(0,V.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=k,this._tempVector.x=Math.sin(i),this._tempVector.z=Math.cos(i),this._tempVector.normalize(),G?y.B(this._tempVector):o.zy.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,n,y)}startPositionFunction(n,y,H,G){const h=(0,V.RandomRange)(-this.height/2,this.height/2),k=(0,V.RandomRange)(0,2*Math.PI),i=(0,V.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),B=Math.sqrt(i)*this.radius,q=B*Math.cos(k),b=B*Math.sin(k);G?y.Mi(q,h,b):o.zy.TransformCoordinatesFromFloatsToRef(q,h,b,n,y)}clone(){const n=new T(this.radius,this.directionRandomizer);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("height",this.height),n.setFloat("radiusRange",this.radiusRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("height",1),n.addUniform("radiusRange",1),n.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this.radius,n.height=this.height,n.radiusRange=this.radiusRange,n.directionRandomizer=this.directionRandomizer,n}parse(n){this.radius=n.radius,this.height=n.height,this.radiusRange=n.radiusRange,this.directionRandomizer=n.directionRandomizer}}class W extends T{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.zy(0,1,0);super(n,y,H),this.direction1=G,this.direction2=h}startDirectionFunction(n,y,H,G){const h=(0,V.RandomRange)(this.direction1.x,this.direction2.x),k=(0,V.RandomRange)(this.direction1.y,this.direction2.y),i=(0,V.RandomRange)(this.direction1.z,this.direction2.z);G?y.Mi(h,k,i):o.zy.TransformNormalFromFloatsToRef(h,k,i,n,y)}clone(){const n=new W(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("height",this.height),n.setFloat("radiusRange",this.radiusRange),n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("height",1),n.addUniform("radiusRange",1),n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const n=super.serialize();return n.direction1=this.direction1.Ui(),n.direction2=this.direction2.Ui(),n}parse(n){super.parse(n),o.zy.FromArrayToRef(n.direction1,0,this.direction1),o.zy.FromArrayToRef(n.direction2,0,this.direction2)}}class z{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=n,this.radiusRange=y,this.directionRandomizer=H}startDirectionFunction(n,y,H,G){const h=H.position.Qy(n.getTranslation()).normalize(),k=(0,V.RandomRange)(0,this.directionRandomizer),i=(0,V.RandomRange)(0,this.directionRandomizer),B=(0,V.RandomRange)(0,this.directionRandomizer);h.x+=k,h.y+=i,h.z+=B,h.normalize(),G?y.B(h):o.zy.TransformNormalFromFloatsToRef(h.x,h.y,h.z,n,y)}startPositionFunction(n,y,H,G){const h=this.radius-(0,V.RandomRange)(0,this.radius*this.radiusRange),k=(0,V.RandomRange)(0,1),i=(0,V.RandomRange)(0,2*Math.PI),B=Math.acos(2*k-1),q=h*Math.cos(i)*Math.sin(B),b=h*Math.cos(B),A=h*Math.sin(i)*Math.sin(B);G?y.Mi(q,Math.abs(b),A):o.zy.TransformCoordinatesFromFloatsToRef(q,Math.abs(b),A,n,y)}clone(){const n=new z(this.radius,this.directionRandomizer);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this.radius,n.radiusRange=this.radiusRange,n.directionRandomizer=this.directionRandomizer,n}parse(n){this.radius=n.radius,this.radiusRange=n.radiusRange,this.directionRandomizer=n.directionRandomizer}}class Q{constructor(){this.direction1=new o.zy(0,1,0),this.direction2=new o.zy(0,1,0)}startDirectionFunction(n,y,H,G){const h=(0,V.RandomRange)(this.direction1.x,this.direction2.x),k=(0,V.RandomRange)(this.direction1.y,this.direction2.y),i=(0,V.RandomRange)(this.direction1.z,this.direction2.z);G?y.Mi(h,k,i):o.zy.TransformNormalFromFloatsToRef(h,k,i,n,y)}startPositionFunction(n,y,H,G){G?y.Mi(0,0,0):o.zy.TransformCoordinatesFromFloatsToRef(0,0,0,n,y)}clone(){const n=new Q;return q.c.DeepCopy(this,n),n}applyToShader(n){n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.direction1=this.direction1.Ui(),n.direction2=this.direction2.Ui(),n}parse(n){o.zy.FromArrayToRef(n.direction1,0,this.direction1),o.zy.FromArrayToRef(n.direction2,0,this.direction2)}}class l{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=n,this.radiusRange=y,this.directionRandomizer=H}startDirectionFunction(n,y,H,G){const h=H.position.Qy(n.getTranslation()).normalize(),k=(0,V.RandomRange)(0,this.directionRandomizer),i=(0,V.RandomRange)(0,this.directionRandomizer),B=(0,V.RandomRange)(0,this.directionRandomizer);h.x+=k,h.y+=i,h.z+=B,h.normalize(),G?y.B(h):o.zy.TransformNormalFromFloatsToRef(h.x,h.y,h.z,n,y)}startPositionFunction(n,y,H,G){const h=this.radius-(0,V.RandomRange)(0,this.radius*this.radiusRange),k=(0,V.RandomRange)(0,1),i=(0,V.RandomRange)(0,2*Math.PI),B=Math.acos(2*k-1),q=h*Math.cos(i)*Math.sin(B),b=h*Math.cos(B),A=h*Math.sin(i)*Math.sin(B);G?y.Mi(q,b,A):o.zy.TransformCoordinatesFromFloatsToRef(q,b,A,n,y)}clone(){const n=new l(this.radius,this.directionRandomizer);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.radius=this.radius,n.radiusRange=this.radiusRange,n.directionRandomizer=this.directionRandomizer,n}parse(n){this.radius=n.radius,this.radiusRange=n.radiusRange,this.directionRandomizer=n.directionRandomizer}}class v extends l{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.zy(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0);super(n),this.direction1=y,this.direction2=H}startDirectionFunction(n,y){const H=(0,V.RandomRange)(this.direction1.x,this.direction2.x),G=(0,V.RandomRange)(this.direction1.y,this.direction2.y),h=(0,V.RandomRange)(this.direction1.z,this.direction2.z);o.zy.TransformNormalFromFloatsToRef(H,G,h,n,y)}clone(){const n=new v(this.radius,this.direction1,this.direction2);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setFloat("radius",this.radius),n.setFloat("radiusRange",this.radiusRange),n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("radius",1),n.addUniform("radiusRange",1),n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const n=super.serialize();return n.direction1=this.direction1.Ui(),n.direction2=this.direction2.Ui(),n}parse(n){super.parse(n),this.direction1.B(n.direction1),this.direction2.B(n.direction2)}}class F{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(n,y,H,G){const h=o.TmpVectors.zy[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,H,h);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,H,h);const n=o.TmpVectors.zy[1];h.subtractToRef(H.position,n),n.scaleToRef(1/H.lifeTime,h)}else h.set(0,0,0);G?y.B(h):o.zy.TransformNormalToRef(h,n,y)}startPositionFunction(n,y,H,G){const h=o.TmpVectors.zy[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,H,h):h.set(0,0,0),G?y.B(h):o.zy.TransformCoordinatesToRef(h,n,y)}clone(){const n=new F;return q.c.DeepCopy(this,n),n}applyToShader(n){}buildUniformLayout(n){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const n={};return n.type=this.getClassName(),n.particlePositionGenerator=this.particlePositionGenerator,n.particleDestinationGenerator=this.particleDestinationGenerator,n}parse(n){n.particlePositionGenerator&&(this.particlePositionGenerator=n.particlePositionGenerator),n.particleDestinationGenerator&&(this.particleDestinationGenerator=n.particleDestinationGenerator)}}var g=H(11360);class M{get mesh(){return this._mesh}set mesh(n){this._mesh!==n&&(this._mesh=n,n?(this._indices=n.Fi(),this._positions=n.getVerticesData(g.g.PositionKind),this._normals=n.getVerticesData(g.g.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=o.zy.Zero(),this._mesh=null,this.direction1=new o.zy(0,1,0),this.direction2=new o.zy(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=n}startDirectionFunction(n,y,H,G){if(this.useMeshNormalsForDirection&&this._normals)return void o.zy.TransformNormalToRef(this._storedNormal,n,y);const h=(0,V.RandomRange)(this.direction1.x,this.direction2.x),k=(0,V.RandomRange)(this.direction1.y,this.direction2.y),i=(0,V.RandomRange)(this.direction1.z,this.direction2.z);G?y.Mi(h,k,i):o.zy.TransformNormalFromFloatsToRef(h,k,i,n,y)}startPositionFunction(n,y,H,G){if(!this._indices||!this._positions)return;const h=3*(Math.random()*(this._indices.length/3)|0),k=Math.random(),i=Math.random()*(1-k),B=1-k-i,V=this._indices[h],q=this._indices[h+1],b=this._indices[h+2],A=o.TmpVectors.zy[0],U=o.TmpVectors.zy[1],T=o.TmpVectors.zy[2],W=o.TmpVectors.zy[3];o.zy.FromArrayToRef(this._positions,3*V,A),o.zy.FromArrayToRef(this._positions,3*q,U),o.zy.FromArrayToRef(this._positions,3*b,T),W.x=k*A.x+i*U.x+B*T.x,W.y=k*A.y+i*U.y+B*T.y,W.z=k*A.z+i*U.z+B*T.z,G?y.Mi(W.x,W.y,W.z):o.zy.TransformCoordinatesFromFloatsToRef(W.x,W.y,W.z,n,y),this.useMeshNormalsForDirection&&this._normals&&(o.zy.FromArrayToRef(this._normals,3*V,A),o.zy.FromArrayToRef(this._normals,3*q,U),o.zy.FromArrayToRef(this._normals,3*b,T),this._storedNormal.x=k*A.x+i*U.x+B*T.x,this._storedNormal.y=k*A.y+i*U.y+B*T.y,this._storedNormal.z=k*A.z+i*U.z+B*T.z)}clone(){const n=new M(this.mesh);return q.c.DeepCopy(this,n),n}applyToShader(n){n.setVector3("direction1",this.direction1),n.setVector3("direction2",this.direction2)}buildUniformLayout(n){n.addUniform("direction1",3),n.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var n;const y={};return y.type=this.getClassName(),y.direction1=this.direction1.Ui(),y.direction2=this.direction2.Ui(),y.meshId=null===(n=this.mesh)||void 0===n?void 0:n.id,y.useMeshNormalsForDirection=this.useMeshNormalsForDirection,y}parse(n,y){o.zy.FromArrayToRef(n.direction1,0,this.direction1),o.zy.FromArrayToRef(n.direction2,0,this.direction2),n.meshId&&y&&(this.mesh=y.getLastMeshById(n.meshId)),this.useMeshNormalsForDirection=n.useMeshNormalsForDirection}}class f{_isUbo(n){return void 0!==n.addUniform}constructor(n){this._isUbo(n)?(this.setMatrix3x3=n.updateMatrix3x3.bind(n),this.setMatrix2x2=n.updateMatrix2x2.bind(n),this.setFloat=n.updateFloat.bind(n),this.setFloat2=n.updateFloat2.bind(n),this.setFloat3=n.updateFloat3.bind(n),this.setFloat4=n.updateFloat4.bind(n),this.setFloatArray=n.updateFloatArray.bind(n),this.setArray=n.updateArray.bind(n),this.setIntArray=n.updateIntArray.bind(n),this.setMatrix=n.zi.bind(n),this.setMatrices=n.updateMatrices.bind(n),this.setVector3=n.updateVector3.bind(n),this.setVector4=n.updateVector4.bind(n),this.setColor3=n.updateColor3.bind(n),this.setColor4=n.updateColor4.bind(n),this.setDirectColor4=n.updateDirectColor4.bind(n),this.setInt=n.updateInt.bind(n),this.setInt2=n.updateInt2.bind(n),this.setInt3=n.updateInt3.bind(n),this.setInt4=n.updateInt4.bind(n)):(this.setMatrix3x3=n.setMatrix3x3.bind(n),this.setMatrix2x2=n.setMatrix2x2.bind(n),this.setFloat=n.setFloat.bind(n),this.setFloat2=n.setFloat2.bind(n),this.setFloat3=n.setFloat3.bind(n),this.setFloat4=n.setFloat4.bind(n),this.setFloatArray=n.setFloatArray.bind(n),this.setArray=n.setArray.bind(n),this.setIntArray=n.setIntArray.bind(n),this.setMatrix=n.setMatrix.bind(n),this.setMatrices=n.setMatrices.bind(n),this.setVector3=n.setVector3.bind(n),this.setVector4=n.setVector4.bind(n),this.setColor3=n.setColor3.bind(n),this.setColor4=n.setColor4.bind(n),this.setDirectColor4=n.setDirectColor4.bind(n),this.setInt=n.setInt.bind(n),this.setInt2=n.setInt2.bind(n),this.setInt3=n.setInt3.bind(n),this.setInt4=n.setInt4.bind(n))}}var c=H(11202);const p="gpuUpdateParticlesPixelShader",E="#version 300 es\nvoid main() {discard;}\n";c.e.ShadersStore[p]||(c.e.ShadersStore[p]=E);const X="gpuUpdateParticlesVertexShader",d="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";c.e.ShadersStore[X]||(c.e.ShadersStore[X]=d);(0,i.h)("BABYLON.WebGL2ParticleSystem",class{constructor(n,y){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=n,this._engine=y,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var n;return(null===(n=this._updateEffect)||void 0===n?void 0:n.isReady())??!1}createUpdateBuffer(n){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof F&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=n,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new f(this._updateEffect)}createVertexBuffers(n,y){this._updateVAO.push(this._createUpdateVAO(n)),this._renderVAO.push(this._engine.recordVertexArrayObject(y,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=y}createParticleBuffer(n){return n}bindDrawBuffers(n,y,H){H?this._engine.bindBuffers(this._renderVertexBuffers,H,y):this._engine.bindVertexArrayObject(this._renderVAO[n],null)}preUpdateParticleBuffer(){const n=this._engine;if(this._engine.enableEffect(this._updateEffect),!n.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(n,y,H){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[n],null);const o=this._engine;o.bindTransformFeedbackBuffer(y.getBuffer()),o.setRasterizerState(!1),o.beginTransformFeedback(!0),o.drawArraysType(3,0,H),o.endTransformFeedback(),o.setRasterizerState(!0),o.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let n=0;n<this._updateVAO.length;n++)this._engine.releaseVertexArrayObject(this._updateVAO[n]);this._updateVAO.length=0;for(let n=0;n<this._renderVAO.length;n++)this._engine.releaseVertexArrayObject(this._renderVAO[n]);this._renderVAO.length=0}_createUpdateVAO(n){const y={};y.position=n.createVertexBuffer("position",0,3);let H=3;y.age=n.createVertexBuffer("age",H,1),H+=1,y.size=n.createVertexBuffer("size",H,3),H+=3,y.life=n.createVertexBuffer("life",H,1),H+=1,y.seed=n.createVertexBuffer("seed",H,4),H+=4,y.direction=n.createVertexBuffer("direction",H,3),H+=3,this._parent.particleEmitterType instanceof F&&(y.initialPosition=n.createVertexBuffer("initialPosition",H,3),H+=3),this._parent._colorGradientsTexture||(y.color=n.createVertexBuffer("color",H,4),H+=4),this._parent._isBillboardBased||(y.initialDirection=n.createVertexBuffer("initialDirection",H,3),H+=3),this._parent.noiseTexture&&(y.noiseCoordinates1=n.createVertexBuffer("noiseCoordinates1",H,3),H+=3,y.noiseCoordinates2=n.createVertexBuffer("noiseCoordinates2",H,3),H+=3),this._parent._angularSpeedGradientsTexture?(y.angle=n.createVertexBuffer("angle",H,1),H+=1):(y.angle=n.createVertexBuffer("angle",H,2),H+=2),this._parent._isAnimationSheetEnabled&&(y.cellIndex=n.createVertexBuffer("cellIndex",H,1),H+=1,this._parent.spriteRandomStartCell&&(y.cellStartOffset=n.createVertexBuffer("cellStartOffset",H,1),H+=1));const o=this._engine.recordVertexArrayObject(y,null,this._updateEffect);return this._engine.bindArrayBuffer(null),o}});class a{constructor(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=arguments.length>3?arguments[3]:void 0;this._engine=n,this._label=o,this._engine._storageBuffers.push(this),this._create(y,H)}_create(n,y){this._bufferSize=n,this._creationFlags=y,this._buffer=this._engine.createStorageBuffer(n,y,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(n,y,H){this._buffer&&this._engine.updateStorageBuffer(this._buffer,n,y,H)}async read(n,y,H,o){return await this._engine.readFromStorageBuffer(this._buffer,n,y,H,o)}dispose(){const n=this._engine._storageBuffers,y=n.indexOf(this);-1!==y&&(n[y]=n[n.length-1],n.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var O=H(11278),e=H(11280),w=H(11325),j=H(11269),I=H(11631),R=H(11114),C=H(11232),S=H(11534);class N{constructor(){this._gpuTimeInFrameId=-1,this.counter=new S.e}_addDuration(n,y){n<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==n?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(y,!1),this._gpuTimeInFrameId=n):this.counter.addCount(y,!1))}}var r=H(11185);class K{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=n,this._engine=y,this.uniqueId=I.e.UniqueId,y.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new N),this._engine.getCaps().supportComputeShaders?o.bindingsMapping?(this._context=y.createComputeContext(),this._shaderPath=H,this._options={bindingsMapping:{},defines:[],...o}):R.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):R.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(n,y){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const o=this._bindings[n];this._bindings[n]={type:H?0:4,object:y,indexInGroupEntries:null===o||void 0===o?void 0:o.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!o||o.object!==y||o.type!==this._bindings[n].type)}setStorageTexture(n,y){const H=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==y),this._bindings[n]={type:1,object:y,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setExternalTexture(n,y){const H=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==y),this._bindings[n]={type:6,object:y,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setVideoTexture(n,y){return!!y.externalTexture&&(this.setExternalTexture(n,y.externalTexture),!0)}setUniformBuffer(n,y){const H=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==y),this._bindings[n]={type:K._BufferIsDataBuffer(y)?7:2,object:y,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setStorageBuffer(n,y){const H=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!H||H.object!==y),this._bindings[n]={type:K._BufferIsDataBuffer(y)?7:3,object:y,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}setTextureSampler(n,y){const H=this._bindings[n];this._contextIsDirty||(this._contextIsDirty=!H||!y.compareSampler(H.object)),this._bindings[n]={type:5,object:y,indexInGroupEntries:null===H||void 0===H?void 0:H.indexInGroupEntries}}isReady(){let n=this._effect;for(const G in this._bindings){const n=this._bindings[G],y=n.type,H=n.object;switch(y){case 0:case 4:case 1:if(!H.isReady())return!1;break;case 6:if(!H.isReady())return!1;break}}const y=[],H=this._shaderPath;if(this._options.defines)for(let G=0;G<this._options.defines.length;G++)y.push(this._options.defines[G]);const o=y.join("\n");return this._cachedDefines!==o&&(this._cachedDefines=o,n=this._engine.createComputeEffect(H,{defines:o,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=n),!!n.isReady()}dispatch(n,y,H){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,n,y,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const H=K._BufferIsDataBuffer(n)?n:n.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,H,y,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const y in this._bindings){const H=this._bindings[y];if(!this._options.bindingsMapping[y])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+y+"'");switch(H.type){case 0:{const o=this._samplers[y],G=H.object;var n;if(!o||!G._texture||!o.compareSampler(G._texture))this._samplers[y]=(new C.b).setParameters(G.wrapU,G.wrapV,G.wrapR,G.anisotropicFilteringLevel,G._texture.samplingMode,null===(n=G._texture)||void 0===n?void 0:n._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const n=H.object;n.getBuffer()!==H.buffer&&(H.buffer=n.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((G=>{(0,r.e)((()=>this.dispatch(n,y,H)),G,void 0,o)}))}serialize(){const n=w.c.Serialize(this);n.options=this._options,n.shaderPath=this._shaderPath,n.PA={},n.textures={};for(const y in this._bindings){const H=this._bindings[y],o=H.object;switch(H.type){case 0:case 4:case 1:{const G=o.serialize();G&&(n.textures[y]=G,n.PA[y]={type:H.type});break}}}return n}static Parse(n,y,H){const o=w.c.Parse((()=>new K(n.name,y.getEngine(),n.shaderPath,n.options)),n,y,H);for(const G in n.textures){const h=n.PA[G],k=j.b.Parse(n.textures[G],y,H);0===h.type?o.setTexture(G,k):4===h.type?o.setTexture(G,k,!1):o.setStorageTexture(G,k)}return o}static _BufferIsDataBuffer(n){return void 0!==n.underlyingResource}}(0,O.e)([(0,e.J)()],K.prototype,"name",void 0),(0,O.e)([(0,e.J)()],K.prototype,"fastMode",void 0),(0,i.h)("BABYLON.ComputeShader",K);var Y=H(11582);const D="gpuUpdateParticlesComputeShader",Z="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";c.e.ShadersStoreWGSL[D]||(c.e.ShadersStoreWGSL[D]=Z);(0,i.h)("BABYLON.ComputeShaderParticleSystem",class{constructor(n,y){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=n,this._engine=y}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var n;return(null===(n=this._updateComputeShader)||void 0===n?void 0:n.isReady())??!1}createUpdateBuffer(n){var y;const H={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(H.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(H.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(H.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(H.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(H.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(H.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(H.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new K("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:H,defines:n.split("\n")}),null===(y=this._simParamsComputeShader)||void 0===y||y.dispose(),this._simParamsComputeShader=new Y.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new f(this._simParamsComputeShader)}createVertexBuffers(n,y){this._renderVertexBuffers.push(y)}createParticleBuffer(n){const y=new a(this._engine,4*n.length,11,"ComputeShaderParticleSystemBuffer");return y.update(n),this._bufferComputeShader.push(y),y.getBuffer()}bindDrawBuffers(n,y,H){this._engine.bindBuffers(this._renderVertexBuffers[n],H,y)}preUpdateParticleBuffer(){}updateParticleBuffer(n,y,H){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[n]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^n]),this._updateComputeShader.dispatch(Math.ceil(H/64))}releaseBuffers(){var n;for(let y=0;y<this._bufferComputeShader.length;++y)this._bufferComputeShader[y].dispose();this._bufferComputeShader.length=0,null===(n=this._simParamsComputeShader)||void 0===n||n.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class s{constructor(n,y,H){this.gradient=n,this.color1=y,this.color2=H}getColorToRef(n){this.color2?k.pi.LerpToRef(this.color1,this.color2,Math.random(),n):n.B(this.color1)}}class P{constructor(n,y){this.gradient=n,this.color=y}}class x{constructor(n,y,H){this.gradient=n,this.factor1=y,this.factor2=H}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class t{static GetCurrentGradient(n,y,H){if(y[0].gradient>n)return void H(y[0],y[0],1);for(let G=0;G<y.length-1;G++){const o=y[G],h=y[G+1];if(n>=o.gradient&&n<=h.gradient){return void H(o,h,(n-o.gradient)/(h.gradient-o.gradient))}}const o=y.length-1;H(y[o],y[o],1)}}var u=H(11099),L=H(11831),J=H(11149);class m{constructor(n){this.particleSystem=n,this.position=o.zy.Zero(),this.direction=o.zy.Zero(),this.color=new k.pi(0,0,0,0),this.colorStep=new k.pi(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new o.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new k.pi(0,0,0,0),this._currentColor2=new k.pi(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=m._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let n=this.age,y=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===y?(y=1,n=this._randomCellOffset):n+=this._randomCellOffset);const H=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let o;o=this._initialSpriteCellLoop?(0,V.Clamp)(n*y%this.lifeTime/this.lifeTime):(0,V.Clamp)(n*y/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+o*H|0}_inheritParticleInfoToSubEmitter(n){if(n.particleSystem.hy.position){const y=n.particleSystem.hy;if(y.position.B(this.position),n.inheritDirection){const n=o.TmpVectors.zy[0];this.direction.normalizeToRef(n),y.setDirection(n,0,Math.PI/2)}}else{n.particleSystem.hy.B(this.position)}this.direction.scaleToRef(n.inheritedVelocityAmount/2,o.TmpVectors.zy[0]),n.particleSystem._inheritedVelocityOffset.B(o.TmpVectors.zy[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const n of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(n)}_reset(){this.age=0,this.id=m._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(n){n.position.B(this.position),this._initialDirection?n._initialDirection?n._initialDirection.B(this._initialDirection):n._initialDirection=this._initialDirection.clone():n._initialDirection=null,n.direction.B(this.direction),this.ui&&(n.ui?n.ui.B(this.ui):n.ui=this.ui.clone()),n.color.B(this.color),n.colorStep.B(this.colorStep),n.lifeTime=this.lifeTime,n.age=this.age,n._randomCellOffset=this._randomCellOffset,n.size=this.size,n.scale.B(this.scale),n.angle=this.angle,n.angularSpeed=this.angularSpeed,n.particleSystem=this.particleSystem,n.cellIndex=this.cellIndex,n.id=this.id,n._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(n._currentColorGradient=this._currentColorGradient,n._currentColor1.B(this._currentColor1),n._currentColor2.B(this._currentColor2)),this._currentSizeGradient&&(n._currentSizeGradient=this._currentSizeGradient,n._currentSize1=this._currentSize1,n._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(n._currentAngularSpeedGradient=this._currentAngularSpeedGradient,n._currentAngularSpeed1=this._currentAngularSpeed1,n._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(n._currentVelocityGradient=this._currentVelocityGradient,n._currentVelocity1=this._currentVelocity1,n._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(n._currentLimitVelocityGradient=this._currentLimitVelocityGradient,n._currentLimitVelocity1=this._currentLimitVelocity1,n._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(n._currentDragGradient=this._currentDragGradient,n._currentDrag1=this._currentDrag1,n._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(n._initialStartSpriteCellId=this._initialStartSpriteCellId,n._initialEndSpriteCellId=this._initialEndSpriteCellId,n._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(n.remapData&&this.remapData?n.remapData.B(this.remapData):n.remapData=new o.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(n._randomNoiseCoordinates1?(n._randomNoiseCoordinates1.B(this._randomNoiseCoordinates1),n._randomNoiseCoordinates2.B(this._randomNoiseCoordinates2)):(n._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),n._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}m._Count=0;var nn=H(11425),yn=(H(11477),H(11710)),Hn=H(11705),on=H(11578);function Gn(n,y){const H=(0,V.RandomRange)(0,1);k.pi.LerpToRef(y.color1,y.color2,H,n.color),y.colorDead.subtractToRef(n.color,y._colorDiff),y._colorDiff.scaleToRef(1/n.lifeTime,n.colorStep)}function hn(n,y){n._currentColorGradient=y._colorGradients[0],n._currentColorGradient.getColorToRef(n.color),n._currentColor1.B(n.color),y._colorGradients.length>1?y._colorGradients[1].getColorToRef(n._currentColor2):n._currentColor2.B(n.color)}function kn(n,y){const H=y._colorGradients;t.GetCurrentGradient(y._ratio,H,((y,H,o)=>{y!==n._currentColorGradient&&(n._currentColor1.B(n._currentColor2),H.getColorToRef(n._currentColor2),n._currentColorGradient=y),k.pi.LerpToRef(n._currentColor1,n._currentColor2,o,n.color)}))}function Bn(n,y){n.colorStep.scaleToRef(y._scaledUpdateSpeed,y._scaledColorStep),n.color.addInPlace(y._scaledColorStep),n.color.a<0&&(n.color.a=0)}function Vn(n,y){t.GetCurrentGradient(y._ratio,y._angularSpeedGradients,((y,H,o)=>{y!==n._currentAngularSpeedGradient&&(n._currentAngularSpeed1=n._currentAngularSpeed2,n._currentAngularSpeed2=H.getFactor(),n._currentAngularSpeedGradient=y),n.angularSpeed=(0,V.Lerp)(n._currentAngularSpeed1,n._currentAngularSpeed2,o)}))}function qn(n,y){n.angle+=n.angularSpeed*y._scaledUpdateSpeed}function bn(n,y){y.particleEmitterType.startDirectionFunction(y._emitterWorldMatrix,n.direction,n,y.isLocal,y._emitterInverseWorldMatrix)}function An(n,y){y.startDirectionFunction(y._emitterWorldMatrix,n.direction,n,y.isLocal)}function Un(n,y){n._currentVelocityGradient=y._velocityGradients[0],n._currentVelocity1=n._currentVelocityGradient.getFactor(),y._velocityGradients.length>1?n._currentVelocity2=y._velocityGradients[1].getFactor():n._currentVelocity2=n._currentVelocity1}function Tn(n,y){n._currentLimitVelocityGradient=y._limitVelocityGradients[0],n._currentLimitVelocity1=n._currentLimitVelocityGradient.getFactor(),y._limitVelocityGradients.length>1?n._currentLimitVelocity2=y._limitVelocityGradients[1].getFactor():n._currentLimitVelocity2=n._currentLimitVelocity1}function Wn(n,y){t.GetCurrentGradient(y._ratio,y._velocityGradients,((H,o,G)=>{H!==n._currentVelocityGradient&&(n._currentVelocity1=n._currentVelocity2,n._currentVelocity2=o.getFactor(),n._currentVelocityGradient=H),y._directionScale*=(0,V.Lerp)(n._currentVelocity1,n._currentVelocity2,G)}))}function zn(n,y){t.GetCurrentGradient(y._ratio,y._limitVelocityGradients,((H,o,G)=>{H!==n._currentLimitVelocityGradient&&(n._currentLimitVelocity1=n._currentLimitVelocity2,n._currentLimitVelocity2=o.getFactor(),n._currentLimitVelocityGradient=H);const h=(0,V.Lerp)(n._currentLimitVelocity1,n._currentLimitVelocity2,G);n.direction.length()>h&&n.direction.scaleInPlace(y.limitVelocityDamping)}))}function Qn(n,y){n.direction.scaleToRef(y._directionScale,y._scaledDirection)}function ln(n,y){y.particleEmitterType.startPositionFunction(y._emitterWorldMatrix,n.position,n,y.isLocal)}function vn(n,y){y.startPositionFunction(y._emitterWorldMatrix,n.position,n,y.isLocal)}function Fn(n,y){n.ui?n.ui.B(n.position):n.ui=n.position.clone(),o.zy.TransformCoordinatesToRef(n.ui,y._emitterWorldMatrix,n.position)}function gn(n,y){y.isLocal&&n.ui?(n.ui.addInPlace(y._scaledDirection),o.zy.TransformCoordinatesToRef(n.ui,y._emitterWorldMatrix,n.position)):n.position.addInPlace(y._scaledDirection)}function Mn(n,y){n._currentDragGradient=y._dragGradients[0],n._currentDrag1=n._currentDragGradient.getFactor(),y._dragGradients.length>1?n._currentDrag2=y._dragGradients[1].getFactor():n._currentDrag2=n._currentDrag1}function fn(n,y){t.GetCurrentGradient(y._ratio,y._dragGradients,((H,o,G)=>{H!==n._currentDragGradient&&(n._currentDrag1=n._currentDrag2,n._currentDrag2=o.getFactor(),n._currentDragGradient=H);const h=(0,V.Lerp)(n._currentDrag1,n._currentDrag2,G);y._scaledDirection.scaleInPlace(1-h)}))}function cn(n,y){n._randomNoiseCoordinates1?(n._randomNoiseCoordinates1.Mi(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2.Mi(Math.random(),Math.random(),Math.random())):(n._randomNoiseCoordinates1=new o.zy(Math.random(),Math.random(),Math.random()),n._randomNoiseCoordinates2=new o.zy(Math.random(),Math.random(),Math.random()))}function pn(n,y){const H=y._noiseTextureData,G=y._noiseTextureSize;if(H&&G&&n._randomNoiseCoordinates1){const h=y._fetchR(n._randomNoiseCoordinates1.x,n._randomNoiseCoordinates1.y,G.width,G.height,H),k=y._fetchR(n._randomNoiseCoordinates1.z,n._randomNoiseCoordinates2.x,G.width,G.height,H),i=y._fetchR(n._randomNoiseCoordinates2.y,n._randomNoiseCoordinates2.z,G.width,G.height,H),B=o.TmpVectors.zy[0],V=o.TmpVectors.zy[1];B.Mi((2*h-1)*y.noiseStrength.x,(2*k-1)*y.noiseStrength.y,(2*i-1)*y.noiseStrength.z),B.scaleToRef(y._tempScaledUpdateSpeed,V),n.direction.addInPlace(V)}}function En(n,y){y.gravity.scaleToRef(y._tempScaledUpdateSpeed,y._scaledGravity),n.direction.addInPlace(y._scaledGravity)}function Xn(n,y){n.size=(0,V.RandomRange)(y.minSize,y.maxSize),n.scale.Mi((0,V.RandomRange)(y.minScaleX,y.maxScaleX),(0,V.RandomRange)(y.minScaleY,y.maxScaleY))}function dn(n,y){n._currentSizeGradient=y._sizeGradients[0],n._currentSize1=n._currentSizeGradient.getFactor(),n.size=n._currentSize1,y._sizeGradients.length>1?n._currentSize2=y._sizeGradients[1].getFactor():n._currentSize2=n._currentSize1,n.scale.Mi((0,V.RandomRange)(y.minScaleX,y.maxScaleX),(0,V.RandomRange)(y.minScaleY,y.maxScaleY))}function an(n,y){const H=y._actualFrame/y.targetStopDuration;t.GetCurrentGradient(H,y._startSizeGradients,((H,o,G)=>{H!==y._currentStartSizeGradient&&(y._currentStartSize1=y._currentStartSize2,y._currentStartSize2=o.getFactor(),y._currentStartSizeGradient=H);const h=(0,V.Lerp)(y._currentStartSize1,y._currentStartSize2,G);n.scale.scaleInPlace(h)}))}function On(n,y){t.GetCurrentGradient(y._ratio,y._sizeGradients,((y,H,o)=>{y!==n._currentSizeGradient&&(n._currentSize1=n._currentSize2,n._currentSize2=H.getFactor(),n._currentSizeGradient=y),n.size=(0,V.Lerp)(n._currentSize1,n._currentSize2,o)}))}function en(n,y){n.remapData=new o.Vector4(0,1,0,1)}function wn(n,y){y._colorRemapGradients&&y._colorRemapGradients.length>0&&t.GetCurrentGradient(y._ratio,y._colorRemapGradients,((y,H,o)=>{const G=(0,V.Lerp)(y.factor1,H.factor1,o),h=(0,V.Lerp)(y.factor2,H.factor2,o);n.remapData.x=G,n.remapData.y=h-G})),y._alphaRemapGradients&&y._alphaRemapGradients.length>0&&t.GetCurrentGradient(y._ratio,y._alphaRemapGradients,((y,H,o)=>{const G=(0,V.Lerp)(y.factor1,H.factor1,o),h=(0,V.Lerp)(y.factor2,H.factor2,o);n.remapData.z=G,n.remapData.w=h-G}))}function jn(n,y){const H=(0,V.Clamp)(y._actualFrame/y.targetStopDuration);t.GetCurrentGradient(H,y._lifeTimeGradients,((y,o)=>{const G=y,h=o,k=G.getFactor(),i=h.getFactor(),B=(H-G.gradient)/(h.gradient-G.gradient);n.lifeTime=(0,V.Lerp)(k,i,B)})),y._emitPower=(0,V.RandomRange)(y.minEmitPower,y.maxEmitPower)}function In(n,y){n.lifeTime=(0,V.RandomRange)(y.minLifeTime,y.maxLifeTime),y._emitPower=(0,V.RandomRange)(y.minEmitPower,y.maxEmitPower)}function Rn(n,y){0===y._emitPower?(n._initialDirection?n._initialDirection.B(n.direction):n._initialDirection=n.direction.clone(),n.direction.set(0,0,0)):(n._initialDirection=null,n.direction.scaleInPlace(y._emitPower)),n.direction.addInPlace(y._inheritedVelocityOffset)}function Cn(n,y){n.angularSpeed=(0,V.RandomRange)(y.minAngularSpeed,y.maxAngularSpeed),n.angle=(0,V.RandomRange)(y.minInitialRotation,y.maxInitialRotation)}function Sn(n,y){n._currentAngularSpeedGradient=y._angularSpeedGradients[0],n.angularSpeed=n._currentAngularSpeedGradient.getFactor(),n._currentAngularSpeed1=n.angularSpeed,y._angularSpeedGradients.length>1?n._currentAngularSpeed2=y._angularSpeedGradients[1].getFactor():n._currentAngularSpeed2=n._currentAngularSpeed1,n.angle=(0,V.RandomRange)(y.minInitialRotation,y.maxInitialRotation)}function Nn(n,y){n._initialStartSpriteCellId=y.startSpriteCellID,n._initialEndSpriteCellId=y.endSpriteCellID,n._initialSpriteCellLoop=y.spriteCellLoop}function rn(n,y){n.previousItem=y.previousItem,n.nextItem=y,y.previousItem&&(y.previousItem.nextItem=n),y.previousItem=n}function Kn(n,y){n.previousItem=y,n.nextItem=y.nextItem,y.nextItem&&(y.nextItem.previousItem=n),y.nextItem=n}function Yn(n,y){let H=y;for(;H.nextItem;)H=H.nextItem;n.previousItem=H,n.nextItem=H.nextItem,H.nextItem=n}function Dn(n){n.previousItem&&(n.previousItem.nextItem=n.nextItem),n.nextItem&&(n.nextItem.previousItem=n.previousItem)}class Zn extends B{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(n){this._startDirectionFunction!==n&&(this._startDirectionFunction=n,this._directionProcessing.process=n?An:bn)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(n){this._startPositionFunction!==n&&(this._startPositionFunction=n,this._positionCreation.process=n?vn:ln)}set onDispose(n){this._onDisposeObserver&&this.ah.remove(this._onDisposeObserver),this._onDisposeObserver=this.ah.add(n)}get A(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(n){this._useRampGradients!==n&&(this._useRampGradients=n,this._resetEffect(),n?(this._rampCreation={process:en,previousItem:null,nextItem:null},Kn(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:wn,previousItem:null,nextItem:null},Kn(this._remapGradientProcessing,this._gravityProcessing)):(Dn(this._rampCreation),Dn(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(n){this._isLocal!==n&&(this._isLocal=n,n?(this._isLocalCreation={process:Fn,previousItem:null,nextItem:null},Kn(this._isLocalCreation,this._positionCreation)):Dn(this._isLocalCreation))}get particles(){return this.KA}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(n){this._animationSheetEnabled!==n&&(this._animationSheetEnabled=n,n?(this._sheetCreation={process:Nn,previousItem:null,nextItem:null},Kn(this._sheetCreation,this._colorCreation)):Dn(this._sheetCreation),this._reset())}getActiveCount(){return this.KA.length}getClassName(){return"nb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var n;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(n=this._customWrappers[y])||void 0===n?void 0:n.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[n]??this._customWrappers[0]}setCustomEffect(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[y]=new nn.b(this._engine),this._customWrappers[y].effect=n,this._customWrappers[y].drawContext&&(this._customWrappers[y].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new u.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(n){if(this.noiseTexture!==n){if(this._noiseTexture=n,!n)return Dn(this._noiseCreation),void Dn(this._noiseProcessing);this._noiseCreation={process:cn,previousItem:null,nextItem:null},Kn(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:pn,previousItem:null,nextItem:null},Kn(this._noiseProcessing,this._positionProcessing)}}constructor(n,y,H){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(n),this._emitterInverseWorldMatrix=o.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new o.zy,this.ah=new u.c,this.onStoppedObservable=new u.c,this.onStartedObservable=new u.c,this._noiseTextureSize=null,this._noiseTextureData=null,this.KA=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new k.pi(0,0,0,0),this._colorDiff=new k.pi(0,0,0,0),this._scaledDirection=o.zy.Zero(),this._scaledGravity=o.zy.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=n=>{},this.recycleParticle=n=>{const y=this.KA.pop();y!==n&&y.copyTo(n),this._stockParticles.push(y)},this._createParticle=()=>{let n;return 0!==this._stockParticles.length?(n=this._stockParticles.pop(),n._reset()):n=new m(this),this._prepareParticle(n),n},this.paused=!1,this._shadersLoaded=!1,this._capacity=y,this._epsilon=i,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=o.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||J.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.NA.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:In,previousItem:null,nextItem:null},this._positionCreation={process:ln,previousItem:null,nextItem:null},Kn(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:bn,previousItem:null,nextItem:null},Kn(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Rn,previousItem:null,nextItem:null},Kn(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Xn,previousItem:null,nextItem:null},Kn(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:Cn,previousItem:null,nextItem:null},Kn(this._angleCreation,this._sizeCreation),this._colorCreation={process:Gn,previousItem:null,nextItem:null},Kn(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,B||(this._colorProcessing={process:Bn,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:qn,previousItem:null,nextItem:null},Kn(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:Qn,previousItem:null,nextItem:null},Kn(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:gn,previousItem:null,nextItem:null},Kn(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:En,previousItem:null,nextItem:null},Kn(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=h,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new nn.b(this._engine)},this._customWrappers[0].effect=G,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new b,this.updateFunction=n=>{var y;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(y=this.noiseTexture.getContent())||void 0===y||y.then((n=>{this._noiseTextureData=n})));const H=n===this.KA;for(let o=0;o<n.length;o++){const y=n[o];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const G=y.age;if(y.age+=this._tempScaledUpdateSpeed,y.age>y.lifeTime){const n=y.age-G,H=y.lifeTime-G;this._tempScaledUpdateSpeed=H*this._tempScaledUpdateSpeed/n,y.age=y.lifeTime}this._ratio=y.age/y.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let h=this._updateQueueStart;for(;h;)h.process(y,this),h=h.nextItem;if(this._isAnimationSheetEnabled&&!B&&y.updateCellIndex(),y._inheritParticleInfoToSubEmitters(),y.age>=y.lifeTime){if(this._emitFromParticle(y),y._attachedSubEmitters){for(const n of y._attachedSubEmitters)n.particleSystem.disposeOnStop=!0,n.particleSystem.stop();y._attachedSubEmitters=null}this.recycleParticle(y),H&&o--}else;}}}serialize(n){throw new Error("Method not implemented.")}clone(n,y){throw new Error("Method not implemented.")}_addFactorGradient(n,y,H,o){const G=new x(y,H,o);n.push(G),n.sort(((n,y)=>n.gradient<y.gradient?-1:n.gradient>y.gradient?1:0))}_removeFactorGradient(n,y){if(!n)return;let H=0;for(const o of n){if(o.gradient===y){n.splice(H,1);break}H++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=jn:this._lifeTimeCreation.process=In}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:an,previousItem:null,nextItem:null},Kn(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Dn(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(n){this.targetStopDuration!==n&&(this._targetStopDuration=n,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(n,y,H){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,n,y,H),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(n){return this._removeFactorGradient(this._lifeTimeGradients,n),this._syncLifeTimeCreation(),this}addSizeGradient(n,y,H){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=dn,this._sizeGradientProcessing={process:On,previousItem:null,nextItem:null},rn(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,n,y,H),this}removeSizeGradient(n){var y;return this._removeFactorGradient(this._sizeGradients,n),0===(null===(y=this._sizeGradients)||void 0===y?void 0:y.length)&&(Dn(this._sizeGradientProcessing),this._sizeCreation.process=Xn),this}addColorRemapGradient(n,y,H){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,n,y,H),this}removeColorRemapGradient(n){return this._removeFactorGradient(this._colorRemapGradients,n),this}addAlphaRemapGradient(n,y,H){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,n,y,H),this}removeAlphaRemapGradient(n){return this._removeFactorGradient(this._alphaRemapGradients,n),this}addAngularSpeedGradient(n,y,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=Sn,this._angularSpeedGradientProcessing={process:Vn,previousItem:null,nextItem:null},rn(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,n,y,H),this}removeAngularSpeedGradient(n){var y;return this._removeFactorGradient(this._angularSpeedGradients,n),0===(null===(y=this._angularSpeedGradients)||void 0===y?void 0:y.length)&&(this._angleCreation.process=Cn,Dn(this._angularSpeedGradientProcessing)),this}addVelocityGradient(n,y,H){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Un,previousItem:null,nextItem:null},Kn(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:Wn,previousItem:null,nextItem:null},rn(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,n,y,H),this}removeVelocityGradient(n){var y;return this._removeFactorGradient(this._velocityGradients,n),0===(null===(y=this._velocityGradients)||void 0===y?void 0:y.length)&&(Dn(this._velocityCreation),Dn(this._velocityGradientProcessing)),this}addLimitVelocityGradient(n,y,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Tn,previousItem:null,nextItem:null},Kn(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:zn,previousItem:null,nextItem:null},Kn(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,n,y,H),this}removeLimitVelocityGradient(n){var y;return this._removeFactorGradient(this._limitVelocityGradients,n),0===(null===(y=this._limitVelocityGradients)||void 0===y?void 0:y.length)&&(Dn(this._limitVelocityCreation),Dn(this._limitVelocityGradientProcessing)),this}addDragGradient(n,y,H){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Mn,previousItem:null,nextItem:null},rn(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:fn,previousItem:null,nextItem:null},rn(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,n,y,H),this}removeDragGradient(n){var y;return this._removeFactorGradient(this._dragGradients,n),0===(null===(y=this._dragGradients)||void 0===y?void 0:y.length)&&(Dn(this._dragCreation),Dn(this._dragGradientProcessing)),this}addEmitRateGradient(n,y,H){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,n,y,H),this}removeEmitRateGradient(n){return this._removeFactorGradient(this._emitRateGradients,n),this}addStartSizeGradient(n,y,H){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,n,y,H),this._syncStartSizeCreation(),this}removeStartSizeGradient(n){return this._removeFactorGradient(this._startSizeGradients,n),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const n=new Uint8Array(4*this._rawTextureWidth),y=k.TmpColors.Fy[0];for(let H=0;H<this._rawTextureWidth;H++){const o=H/this._rawTextureWidth;t.GetCurrentGradient(o,this._rampGradients,((o,G,h)=>{k.Fy.LerpToRef(o.color,G.color,h,y),n[4*H]=255*y.r,n[4*H+1]=255*y.g,n[4*H+2]=255*y.b,n[4*H+3]=255}))}this._rampGradientsTexture=L.b.CreateRGBATexture(n,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((n,y)=>n.gradient<y.gradient?-1:n.gradient>y.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(n,y){this._rampGradients||(this._rampGradients=[]);const H=new P(n,y);return this._rampGradients.push(H),this._syncRampGradientTexture(),this}removeRampGradient(n){return this._removeGradientAndTexture(n,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(n,y,H){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=hn,this._colorProcessing.process=kn);const o=new s(n,y,H);return this._colorGradients.push(o),this._colorGradients.sort(((n,y)=>n.gradient<y.gradient?-1:n.gradient>y.gradient?1:0)),this}removeColorGradient(n){if(!this._colorGradients)return this;let y=0;for(const H of this._colorGradients){if(H.gradient===n){this._colorGradients.splice(y,1);break}y++}return 0===this._colorGradients.length&&(this._colorCreation.process=Gn,this._colorProcessing.process=Bn),this}resetDrawCache(){if(this._drawWrappers){for(const n of this._drawWrappers)if(n)for(const y of n)null===y||void 0===y||y.dispose();this._drawWrappers=[]}}_fetchR(n,y,H,o,G){return G[4*(((n=.5*Math.abs(n)+.5)*H%H|0)+((y=.5*Math.abs(y)+.5)*o%o|0)*H)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const n=this._engine,y=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*y),this._vertexBuffer=new g.d(n,this._vertexData,!0,y);let H=0;const o=this._vertexBuffer.createVertexBuffer(g.g.PositionKind,H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[g.g.PositionKind]=o,H+=3;const G=this._vertexBuffer.createVertexBuffer(g.g.ColorKind,H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[g.g.ColorKind]=G,H+=4;const h=this._vertexBuffer.createVertexBuffer("angle",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=h,H+=1;const k=this._vertexBuffer.createVertexBuffer("size",H,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=k,H+=2,this._isAnimationSheetEnabled){const n=this._vertexBuffer.createVertexBuffer("cellIndex",H,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=n,H+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const n=this._vertexBuffer.createVertexBuffer("direction",H,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=n,H+=3}if(this._useRampGradients){const n=this._vertexBuffer.createVertexBuffer("remapData",H,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=n,H+=4}let i;if(this._useInstancing){const y=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new g.d(n,y,!1,2),i=this._spriteBuffer.createVertexBuffer("offset",0,2)}else i=this._vertexBuffer.createVertexBuffer("offset",H,2,this._vertexBufferSize,this._useInstancing),H+=2;this._vertexBuffers.offset=i,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const n=[],y=[];let H=0;for(let o=0;o<this._capacity;o++)n.push(H),n.push(H+1),n.push(H+2),n.push(H),n.push(H+2),n.push(H+3),y.push(H,H+1,H+1,H+2,H+2,H+3,H+3,H,H,H+3),H+=4;this._indexBuffer=this._engine.createIndexBuffer(n),this._linesIndexBuffer=this._engine.createIndexBuffer(y)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(n)setTimeout((()=>{this.start(0)}),n);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var y;-1!==(null===(y=this.hy)||void 0===y?void 0:y.getClassName().indexOf("Mesh"))&&this.hy.Qi(!0);const n=this.noiseTexture;if(n&&n.onGeneratedObservable)n.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let y=0;y<this.preWarmCycles;y++)this.animate(!0),n.render()}))}));else for(let y=0;y<this.preWarmCycles;y++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(n))}_postStop(n){}reset(){this._stockParticles.length=0,this.KA.length=0}_appendParticleVertex(n,y,H,G){let h=n*this._vertexBufferSize;if(this._vertexData[h++]=y.position.x+this.zV.x,this._vertexData[h++]=y.position.y+this.zV.y,this._vertexData[h++]=y.position.z+this.zV.z,this._vertexData[h++]=y.color.r,this._vertexData[h++]=y.color.g,this._vertexData[h++]=y.color.b,this._vertexData[h++]=y.color.a,this._vertexData[h++]=y.angle,this._vertexData[h++]=y.scale.x*y.size,this._vertexData[h++]=y.scale.y*y.size,this._isAnimationSheetEnabled&&(this._vertexData[h++]=y.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[h++]=y.direction.x,this._vertexData[h++]=y.direction.y,this._vertexData[h++]=y.direction.z);else if(y._initialDirection){let n=y._initialDirection;this.isLocal&&(o.zy.TransformNormalToRef(n,this._emitterWorldMatrix,o.TmpVectors.zy[0]),n=o.TmpVectors.zy[0]),0===n.x&&0===n.z&&(n.x=.001),this._vertexData[h++]=n.x,this._vertexData[h++]=n.y,this._vertexData[h++]=n.z}else{let n=y.direction;this.isLocal&&(o.zy.TransformNormalToRef(n,this._emitterWorldMatrix,o.TmpVectors.zy[0]),n=o.TmpVectors.zy[0]),0===n.x&&0===n.z&&(n.x=.001),this._vertexData[h++]=n.x,this._vertexData[h++]=n.y,this._vertexData[h++]=n.z}this._useRampGradients&&y.remapData&&(this._vertexData[h++]=y.remapData.x,this._vertexData[h++]=y.remapData.y,this._vertexData[h++]=y.remapData.z,this._vertexData[h++]=y.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===H?H=this._epsilon:1===H&&(H=1-this._epsilon),0===G?G=this._epsilon:1===G&&(G=1-this._epsilon)),this._vertexData[h++]=H,this._vertexData[h++]=G)}_prepareParticle(n){}_createNewOnes(n){let y;for(let H=0;H<n&&this.KA.length!==this._capacity;H++){y=this._createParticle(),this.KA.push(y);let n=this._createQueueStart;for(;n;)n.process(y,this),n=n.nextItem;y._inheritParticleInfoToSubEmitters()}}_update(n){if(this._alive=this.KA.length>0,this.hy.position){const n=this.hy;this._emitterWorldMatrix=n.getWorldMatrix()}else{const n=this.hy;this._emitterWorldMatrix=o.Matrix.Translation(n.x,n.y,n.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.KA),this._createNewOnes(n)}static _GetAttributeNamesOrOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=[g.g.PositionKind,g.g.ColorKind,"angle","offset","size"];return n&&o.push("cellIndex"),y||o.push("direction"),H&&o.push("remapData"),o}static _GetEffectCreationOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,yn.d)(o),n&&o.push("particlesInfos"),y&&o.push("logarithmicDepthConstant"),H&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(n,y){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,yn.o)(this,this._scene,n),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&n.push("#define FOG")),this._isAnimationSheetEnabled&&n.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH"),y===B.BLENDMODE_MULTIPLY&&n.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&n.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(n.push("#define BILLBOARD"),this.billboardMode){case 2:n.push("#define BILLBOARDY");break;case 8:case 9:n.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&n.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:n.push("#define BILLBOARDMODE_ALL")}H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),n.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(n,y,H){y.push(...Zn._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),n.push(...Zn._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,on.e)(n,this._imageProcessingConfigurationDefines),(0,on.d)(H,this._imageProcessingConfigurationDefines))}_getWrapper(n){const y=this._getCustomDrawWrapper(n);if(null!==y&&void 0!==y&&y.effect)return y;const H=[];this.fillDefines(H,n);const o=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let G=this._drawWrappers[o];G||(G=this._drawWrappers[o]=[]);let h=G[n];h||(h=new nn.b(this._engine),h.drawContext&&(h.drawContext.useInstancing=this._useInstancing),G[n]=h);const k=H.join("\n");if(h.defines!==k){const n=[],y=[],H=[];this.fillUniformsAttributesAndSamplerNames(y,n,H),h.setEffect(this._engine.createEffect("particles",n,y,H,k,void 0,void 0,void 0,void 0,this._shaderLanguage),k)}return h}animate(){var n;let y,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!H&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(H?this.preWarmStepOffset:(null===(n=this._scene)||void 0===n?void 0:n.getAnimationRatio())||1),this.manualEmitCount>-1)y=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let n=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const y=this._actualFrame/this.targetStopDuration;t.GetCurrentGradient(y,this._emitRateGradients,((y,H,o)=>{y!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=H.getFactor(),this._currentEmitRateGradient=y),n=(0,V.Lerp)(this._currentEmitRate1,this._currentEmitRate2,o)}))}y=n*this._scaledUpdateSpeed|0,this._newPartsExcess+=n*this._scaledUpdateSpeed-y}if(this._newPartsExcess>1&&(y+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?y=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(y),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!H){let n=0;for(let y=0;y<this.KA.length;y++){const H=this.KA[y];this._appendParticleVertices(n,H),n+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.KA.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(n,y){this._appendParticleVertex(n++,y,0,0),this._useInstancing||(this._appendParticleVertex(n++,y,1,0),this._appendParticleVertex(n++,y,1,1),this._appendParticleVertex(n++,y,0,1))}rebuild(){var n;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(n=this._spriteBuffer)||void 0===n||n._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Zn.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(H.bind(H,12875)),Promise.resolve().then(H.bind(H,12824))])):await Promise.all([Promise.resolve().then(H.bind(H,12810)),Promise.resolve().then(H.bind(H,12792))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.hy||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==B.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(B.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(B.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(n){const y=this._getWrapper(n),H=y.effect,G=this._engine;G.enableEffect(y);const h=this.defaultViewMatrix??this._scene.getViewMatrix();if(H.setTexture("diffuseSampler",this.particleTexture),H.setMatrix("view",h),H.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const n=this.particleTexture.getBaseSize();H.setFloat3("particlesInfos",this.spriteCellWidth/n.width,this.spriteCellHeight/n.height,this.spriteCellWidth/n.width)}if(H.setVector2("translationPivot",this.translationPivot),H.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const n=this._scene.activeCamera;H.setVector3("eyePosition",n.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),H.setTexture("rampSampler",this._rampGradientsTexture));const k=H.defines;var i,B,V,q,b,A;(this._scene&&((0,yn.h)(H,this,this._scene),this.applyFog&&(0,Hn.g)(this._scene,void 0,H)),k.indexOf("#define BILLBOARDMODE_ALL")>=0&&(h.invertToRef(o.TmpVectors.Matrix[0]),H.setMatrix("invView",o.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?G.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,H):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,H)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(B=this._scene)&&void 0!==B&&B.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?G.bindBuffers(this._vertexBuffers,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBuffer:this._indexBuffer,H):G.bindBuffers(this._vertexBuffers,null!==(q=this._scene)&&void 0!==q&&q.forceWireframe?this._linesIndexBufferUseInstancing:null,H);(this.useLogarithmicDepth&&this._scene&&(0,Hn.m)(k,H,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(H),this._setEngineBasedOnBlendMode(n),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(H),this._useInstancing)?null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?G.drawElementsType(6,0,10,this.KA.length):G.drawArraysType(7,0,4,this.KA.length):null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?G.drawElementsType(1,0,10*this.KA.length):G.drawElementsType(0,0,6*this.KA.length);return this.KA.length}render(){if(!this.isReady()||!this.KA.length)return 0;const n=this._engine;n.setState&&(n.setState(!1),this.forceDepthWrite&&n.setDepthWrite(!0));let y=0;return y=this.blendMode===B.BLENDMODE_MULTIPLYADD?this._render(B.BLENDMODE_MULTIPLY)+this._render(B.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),y}_onDispose(){}dispose(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),n&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),n&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(y,H),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const n=this._scene.NA.indexOf(this);n>-1&&this._scene.NA.splice(n,1),this._scene._activeParticleSystems.dispose()}this.ah.notifyObservers(this),this.ah.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Zn.ForceGLSL=!1;var sn,Pn=H(11134);!function(n){n[n.ATTACHED=0]="ATTACHED",n[n.END=1]="END"}(sn||(sn={}));class xn{constructor(n){if(this.particleSystem=n,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!n.hy||!n.hy.dispose){const y=(0,i.e)("BABYLON.AbstractMesh");n.hy=new y("SubemitterSystemEmitter",n.pn()),n._disposeEmitterOnDispose=!0}}clone(){let n=this.particleSystem.hy;if(n){if(n instanceof o.zy)n=n.clone();else if(-1!==n.getClassName().indexOf("Mesh")){n=new((0,i.e)("BABYLON.Mesh"))("",n.pn()),n.isVisible=!1}}else n=new o.zy;const y=new xn(this.particleSystem.clone(this.particleSystem.name,n));return y.particleSystem.name+="Clone",y.type=this.type,y.inheritDirection=this.inheritDirection,y.inheritedVelocityAmount=this.inheritedVelocityAmount,y.particleSystem._disposeEmitterOnDispose=!0,y.particleSystem.disposeOnStop=!0,y}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={};return y.type=this.type,y.inheritDirection=this.inheritDirection,y.inheritedVelocityAmount=this.inheritedVelocityAmount,y.particleSystem=this.particleSystem.serialize(n),y}static _ParseParticleSystem(n,y,H){throw(0,Pn.c)("ParseParticle")}static Parse(n,y,H){const o=n.particleSystem,G=new xn(xn._ParseParticleSystem(o,y,H,!0));return G.type=n.type,G.inheritDirection=n.inheritDirection,G.inheritedVelocityAmount=n.inheritedVelocityAmount,G.particleSystem._isSubEmitter=!0,G}dispose(){this.particleSystem.dispose()}}var tn=H(11189);function un(n,y){const H=new Q;return H.direction1=n,H.direction2=y,H}function Ln(){return new z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Jn(){return new l(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function mn(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.zy(0,1,0),H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0);return new v(n,y,H)}function ny(){return new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function yy(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0),h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.zy(0,1,0);return new W(n,y,H,G,h)}function Hy(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new A(n,y)}function oy(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0),G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0);return new U(n,y,H,G)}const Gy=o.zy.Zero(),hy=o.zy.Zero(),ky=o.zy.Zero();class iy{constructor(){this.strength=0,this.position=o.zy.Zero()}_processParticle(n,y){this.position.subtractToRef(n.position,Gy);const H=Gy.lengthSquared()+1;Gy.normalize().scaleToRef(this.strength/H,hy),hy.scaleToRef(y._tempScaledUpdateSpeed,ky),n.direction.addInPlace(ky)}serialize(){return{position:this.position.Ui(),strength:this.strength}}}class By extends Zn{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=n=>{if(!this._subEmitters||0===this._subEmitters.length)return;const y=Math.floor(Math.random()*this._subEmitters.length);for(const H of this._subEmitters[y])if(1===H.type){const y=H.clone();n._inheritParticleInfoToSubEmitter(y),y.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(y.particleSystem),y.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(n,y){const H=un(n,y);return this.particleEmitterType=H,H}get flowMap(){return this._flowMap}set flowMap(n){this._flowMap!==n&&(this._flowMap=n,this._flowMapUpdate&&(Dn(this._flowMapUpdate),this._flowMapUpdate=null),n&&(this._flowMapUpdate={process:n=>{var y;const H=null===(y=this.pn())||void 0===y?void 0:y.getTransformMatrix();this._flowMap._processParticle(n,this.flowMapStrength*this._tempScaledUpdateSpeed,H)},previousItem:null,nextItem:null},Kn(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(n){this._attractors.push(n),1===this._attractors.length&&(this._attractorUpdate={process:n=>{for(const y of this._attractors)y._processParticle(n,this)},previousItem:null,nextItem:null},Kn(this._attractorUpdate,this._directionProcessing))}removeAttractor(n){const y=this._attractors.indexOf(n);-1!==y&&this._attractors.splice(y,1),0===this._attractors.length&&Dn(this._attractorUpdate)}start(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(n)}createHemisphericEmitter(){const n=Ln(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createSphereEmitter(){const n=Jn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createDirectedSphereEmitter(){const n=mn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.zy(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0));return this.particleEmitterType=n,n}createCylinderEmitter(){const n=ny(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=n,n}createDirectedCylinderEmitter(){const n=yy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.zy(0,1,0));return this.particleEmitterType=n,n}createConeEmitter(){const n=Hy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=n,n}createDirectedConeEmitter(){const n=oy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0));return this.particleEmitterType=n,n}createBoxEmitter(n,y,H,o){const G=new b;return this.particleEmitterType=G,this.direction1=n,this.direction2=y,this.minEmitBox=H,this.maxEmitBox=o,G}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const n of this.subEmitters)n instanceof By?this._subEmitters.push([new xn(n)]):n instanceof xn?this._subEmitters.push([n]):n instanceof Array&&this._subEmitters.push(n)}_stopSubEmitters(){if(this.activeSubSystems){for(const n of this.activeSubSystems)n.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const n=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==n&&this._rootParticleSystem.activeSubSystems.splice(n,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(n){n&&this._stopSubEmitters()}_prepareParticle(n){if(this._subEmitters&&this._subEmitters.length>0){const y=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];n._attachedSubEmitters=[];for(const H of y)if(0===H.type){const y=H.clone();n._attachedSubEmitters.push(y),y.particleSystem.start()}}}_onDispose(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),n&&this.particles)for(const H of this.particles)if(H._attachedSubEmitters)for(let n=H._attachedSubEmitters.length-1;n>=0;n-=1)H._attachedSubEmitters[n].dispose();if(y&&this.activeSubSystems)for(let H=this.activeSubSystems.length-1;H>=0;H-=1)this.activeSubSystems[H].dispose();if(this._subEmitters&&this._subEmitters.length){for(let n=0;n<this._subEmitters.length;n++)for(const y of this._subEmitters[n])y.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.hy&&this.hy.dispose&&this.hy.dispose(!0)}static _Parse(n,y,H,G){let h;h=H instanceof tn.e?null:H;const B=(0,i.e)("BABYLON.Texture");if(B&&h&&(n.texture?y.particleTexture=B.Parse(n.texture,h,G):n.textureName&&(y.particleTexture=new B(G+n.textureName,h,!1,void 0===n.invertY||n.invertY),y.particleTexture.name=n.textureName)),n.emitterId||0===n.emitterId||void 0!==n.hy?n.emitterId&&h?y.hy=h.getLastMeshById(n.emitterId):y.hy=o.zy.gy(n.hy):y.hy=o.zy.Zero(),y.isLocal=!!n.isLocal,void 0!==n.renderingGroupId&&(y.renderingGroupId=n.renderingGroupId),void 0!==n.isBillboardBased&&(y.isBillboardBased=n.isBillboardBased),void 0!==n.billboardMode&&(y.billboardMode=n.billboardMode),void 0!==n.useLogarithmicDepth&&(y.useLogarithmicDepth=n.useLogarithmicDepth),n.animations){for(let H=0;H<n.animations.length;H++){const o=n.animations[H],G=(0,i.e)("BABYLON.Animation");G&&y.animations.push(G.Parse(o))}y.beginAnimationOnStart=n.beginAnimationOnStart,y.beginAnimationFrom=n.beginAnimationFrom,y.beginAnimationTo=n.beginAnimationTo,y.beginAnimationLoop=n.beginAnimationLoop}if(n.autoAnimate&&h&&h.beginAnimation(y,n.autoAnimateFrom,n.autoAnimateTo,n.autoAnimateLoop,n.autoAnimateSpeed||1),y.startDelay=0|n.startDelay,y.minAngularSpeed=n.minAngularSpeed,y.maxAngularSpeed=n.maxAngularSpeed,y.minSize=n.minSize,y.maxSize=n.maxSize,n.minScaleX&&(y.minScaleX=n.minScaleX,y.maxScaleX=n.maxScaleX,y.minScaleY=n.minScaleY,y.maxScaleY=n.maxScaleY),void 0!==n.preWarmCycles&&(y.preWarmCycles=n.preWarmCycles,y.preWarmStepOffset=n.preWarmStepOffset),void 0!==n.minInitialRotation&&(y.minInitialRotation=n.minInitialRotation,y.maxInitialRotation=n.maxInitialRotation),y.minLifeTime=n.minLifeTime,y.maxLifeTime=n.maxLifeTime,y.minEmitPower=n.minEmitPower,y.maxEmitPower=n.maxEmitPower,y.emitRate=n.emitRate,y.gravity=o.zy.gy(n.gravity),n.noiseStrength&&(y.noiseStrength=o.zy.gy(n.noiseStrength)),y.color1=k.pi.gy(n.color1),y.color2=k.pi.gy(n.color2),y.colorDead=k.pi.gy(n.colorDead),y.updateSpeed=n.updateSpeed,y.targetStopDuration=n.targetStopDuration,y.blendMode=n.blendMode,n.colorGradients)for(const o of n.colorGradients)y.addColorGradient(o.gradient,k.pi.gy(o.color1),o.color2?k.pi.gy(o.color2):void 0);if(n.rampGradients){for(const H of n.rampGradients)y.addRampGradient(H.gradient,k.Fy.gy(H.color));y.useRampGradients=n.useRampGradients}if(n.colorRemapGradients)for(const o of n.colorRemapGradients)y.addColorRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.alphaRemapGradients)for(const o of n.alphaRemapGradients)y.addAlphaRemapGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.sizeGradients)for(const o of n.sizeGradients)y.addSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.angularSpeedGradients)for(const o of n.angularSpeedGradients)y.addAngularSpeedGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.velocityGradients)for(const o of n.velocityGradients)y.addVelocityGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.dragGradients)for(const o of n.dragGradients)y.addDragGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.emitRateGradients)for(const o of n.emitRateGradients)y.addEmitRateGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.startSizeGradients)for(const o of n.startSizeGradients)y.addStartSizeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.lifeTimeGradients)for(const o of n.lifeTimeGradients)y.addLifeTimeGradient(o.gradient,void 0!==o.factor1?o.factor1:o.factor,o.factor2);if(n.limitVelocityGradients){for(const H of n.limitVelocityGradients)y.addLimitVelocityGradient(H.gradient,void 0!==H.factor1?H.factor1:H.factor,H.factor2);y.limitVelocityDamping=n.limitVelocityDamping}if(n.noiseTexture&&h){const H=(0,i.e)("BABYLON.ProceduralTexture");y.noiseTexture=H.Parse(n.noiseTexture,h,G)}let V;if(n.particleEmitterType){switch(n.particleEmitterType.type){case"SphereParticleEmitter":V=new l;break;case"SphereDirectedParticleEmitter":V=new v;break;case"ConeEmitter":case"ConeParticleEmitter":V=new A;break;case"ConeDirectedParticleEmitter":V=new U;break;case"CylinderParticleEmitter":V=new T;break;case"CylinderDirectedParticleEmitter":V=new W;break;case"HemisphericParticleEmitter":V=new z;break;case"PointParticleEmitter":V=new Q;break;case"MeshParticleEmitter":V=new M;break;case"CustomParticleEmitter":V=new F;break;default:V=new b}V.parse(n.particleEmitterType,h)}else V=new b,V.parse(n,h);y.particleEmitterType=V,y.startSpriteCellID=n.startSpriteCellID,y.endSpriteCellID=n.endSpriteCellID,y.spriteCellLoop=n.spriteCellLoop??!0,y.spriteCellWidth=n.spriteCellWidth,y.spriteCellHeight=n.spriteCellHeight,y.spriteCellChangeSpeed=n.spriteCellChangeSpeed,y.spriteRandomStartCell=n.spriteRandomStartCell,y.disposeOnStop=n.disposeOnStop??!1,y.manualEmitCount=n.manualEmitCount??-1}static Parse(n,y,H){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0;const i=n.name;let B,V,q=null,b=null;if(y instanceof tn.e?B=y:(V=y,B=V.getEngine()),n.customShader&&B.createEffectForParticles){b=n.customShader;const y=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"";q=B.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,y)}const A=new By(i,h||n.ji,y,q,n.isAnimationSheetEnabled);if(A.customShader=b,A._rootUrl=H,n.id&&(A.id=n.id),n.subEmitters){A.subEmitters=[];for(const o of n.subEmitters){const n=[];for(const G of o)n.push(xn.Parse(G,y,H));A.subEmitters.push(n)}}if(n.attractors)for(const k of n.attractors){const n=new iy;n.position=o.zy.gy(k.position),n.strength=k.strength,A.addAttractor(n)}return By._Parse(n,A,y,H),n.textureMask&&(A.textureMask=k.pi.gy(n.textureMask)),n.zV&&(A.zV=o.zy.gy(n.zV)),n.preventAutoStart&&(A.preventAutoStart=n.preventAutoStart),G||A.preventAutoStart||A.start(),A}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={};if(By._Serialize(y,this,n),y.textureMask=this.textureMask.Ui(),y.customShader=this.customShader,y.preventAutoStart=this.preventAutoStart,y.zV=this.zV.Ui(),this.subEmitters){y.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const H of this._subEmitters){const o=[];for(const y of H)o.push(y.serialize(n));y.subEmitters.push(o)}}if(this._attractors&&this._attractors.length){y.attractors=[];for(const n of this._attractors)y.attractors.push(n.serialize())}return y}static _Serialize(n,y,H){if(n.name=y.name,n.id=y.id,n.ji=y.getCapacity(),n.disposeOnStop=y.disposeOnStop,n.manualEmitCount=y.manualEmitCount,y.hy.position){const H=y.hy;n.emitterId=H.id}else{const H=y.hy;n.hy=H.Ui()}y.particleEmitterType&&(n.particleEmitterType=y.particleEmitterType.serialize()),y.particleTexture&&(H?n.texture=y.particleTexture.serialize():(n.textureName=y.particleTexture.name,n.invertY=!!y.particleTexture._invertY)),n.isLocal=y.isLocal,w.c.AppendSerializedAnimations(y,n),n.beginAnimationOnStart=y.beginAnimationOnStart,n.beginAnimationFrom=y.beginAnimationFrom,n.beginAnimationTo=y.beginAnimationTo,n.beginAnimationLoop=y.beginAnimationLoop,n.startDelay=y.startDelay,n.renderingGroupId=y.renderingGroupId,n.isBillboardBased=y.isBillboardBased,n.billboardMode=y.billboardMode,n.minAngularSpeed=y.minAngularSpeed,n.maxAngularSpeed=y.maxAngularSpeed,n.minSize=y.minSize,n.maxSize=y.maxSize,n.minScaleX=y.minScaleX,n.maxScaleX=y.maxScaleX,n.minScaleY=y.minScaleY,n.maxScaleY=y.maxScaleY,n.minEmitPower=y.minEmitPower,n.maxEmitPower=y.maxEmitPower,n.minLifeTime=y.minLifeTime,n.maxLifeTime=y.maxLifeTime,n.emitRate=y.emitRate,n.gravity=y.gravity.Ui(),n.noiseStrength=y.noiseStrength.Ui(),n.color1=y.color1.Ui(),n.color2=y.color2.Ui(),n.colorDead=y.colorDead.Ui(),n.updateSpeed=y.updateSpeed,n.targetStopDuration=y.targetStopDuration,n.blendMode=y.blendMode,n.preWarmCycles=y.preWarmCycles,n.preWarmStepOffset=y.preWarmStepOffset,n.minInitialRotation=y.minInitialRotation,n.maxInitialRotation=y.maxInitialRotation,n.startSpriteCellID=y.startSpriteCellID,n.spriteCellLoop=y.spriteCellLoop,n.endSpriteCellID=y.endSpriteCellID,n.spriteCellChangeSpeed=y.spriteCellChangeSpeed,n.spriteCellWidth=y.spriteCellWidth,n.spriteCellHeight=y.spriteCellHeight,n.spriteRandomStartCell=y.spriteRandomStartCell,n.isAnimationSheetEnabled=y.isAnimationSheetEnabled,n.useLogarithmicDepth=y.useLogarithmicDepth;const o=y.getColorGradients();if(o){n.colorGradients=[];for(const y of o){const H={gradient:y.gradient,color1:y.color1.Ui()};y.color2?H.color2=y.color2.Ui():H.color2=y.color1.Ui(),n.colorGradients.push(H)}}const G=y.getRampGradients();if(G){n.rampGradients=[];for(const y of G){const H={gradient:y.gradient,color:y.color.Ui()};n.rampGradients.push(H)}n.useRampGradients=y.useRampGradients}const h=y.getColorRemapGradients();if(h){n.colorRemapGradients=[];for(const y of h){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.colorRemapGradients.push(H)}}const k=y.getAlphaRemapGradients();if(k){n.alphaRemapGradients=[];for(const y of k){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.alphaRemapGradients.push(H)}}const i=y.getSizeGradients();if(i){n.sizeGradients=[];for(const y of i){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.sizeGradients.push(H)}}const B=y.getAngularSpeedGradients();if(B){n.angularSpeedGradients=[];for(const y of B){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.angularSpeedGradients.push(H)}}const V=y.getVelocityGradients();if(V){n.velocityGradients=[];for(const y of V){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.velocityGradients.push(H)}}const q=y.getDragGradients();if(q){n.dragGradients=[];for(const y of q){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.dragGradients.push(H)}}const b=y.getEmitRateGradients();if(b){n.emitRateGradients=[];for(const y of b){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.emitRateGradients.push(H)}}const A=y.getStartSizeGradients();if(A){n.startSizeGradients=[];for(const y of A){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.startSizeGradients.push(H)}}const U=y.getLifeTimeGradients();if(U){n.lifeTimeGradients=[];for(const y of U){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.lifeTimeGradients.push(H)}}const T=y.getLimitVelocityGradients();if(T){n.limitVelocityGradients=[];for(const y of T){const H={gradient:y.gradient,factor1:y.factor1};void 0!==y.factor2?H.factor2=y.factor2:H.factor2=y.factor1,n.limitVelocityGradients.push(H)}n.limitVelocityDamping=y.limitVelocityDamping}y.noiseTexture&&(n.noiseTexture=y.noiseTexture.serialize())}clone(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let G=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){G=this.customShader;const n=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"",y=h.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,n);o[0]?o[0].effect=y:this.setCustomEffect(y,0)}const k=this.serialize(H),i=By.Parse(k,this._scene||this._engine,this._rootUrl);return i.name=n,i.customShader=G,i._customWrappers=o,void 0===y&&(y=this.hy),this.noiseTexture&&(i.noiseTexture=this.noiseTexture.clone()),i.hy=y,this.preventAutoStart||i.start(),i}}By.BILLBOARDMODE_Y=2,By.BILLBOARDMODE_ALL=7,By.BILLBOARDMODE_STRETCHED=8,By.BILLBOARDMODE_STRETCHED_LOCAL=9,xn._ParseParticleSystem=By.Parse;var Vy=H(11562),qy=H(11554),by=H(11440);by.d.prototype.createTransformFeedback=function(){const n=this._gl.createTransformFeedback();if(!n)throw new Error("Unable to create Transform Feedback");return n},by.d.prototype.deleteTransformFeedback=function(n){this._gl.deleteTransformFeedback(n)},by.d.prototype.bindTransformFeedback=function(n){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,n)},by.d.prototype.beginTransformFeedback=function(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(n?this._gl.POINTS:this._gl.TRIANGLES)},by.d.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},by.d.prototype.setTranformFeedbackVaryings=function(n,y){this._gl.transformFeedbackVaryings(n,y,this._gl.INTERLEAVED_ATTRIBS)},by.d.prototype.bindTransformFeedbackBuffer=function(n){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,n?n.underlyingResource:null)},by.d.prototype.readTransformFeedbackBuffer=function(n){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,n)};const Ay="clipPlaneFragmentDeclaration2",Uy="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";c.e.IncludesShadersStore[Ay]||(c.e.IncludesShadersStore[Ay]=Uy);H(12693),H(12698),H(12706),H(12713),H(12720),H(12726),H(12730),H(12738);const Ty="gpuRenderParticlesPixelShader",Wy="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";c.e.ShadersStore[Ty]||(c.e.ShadersStore[Ty]=Wy);const zy="clipPlaneVertexDeclaration2",Qy="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";c.e.IncludesShadersStore[zy]||(c.e.IncludesShadersStore[zy]=Qy);H(12740),H(12748),H(12755),H(12758);const ly="gpuRenderParticlesVertexShader",vy="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";c.e.ShadersStore[ly]||(c.e.ShadersStore[ly]=vy);class Fy extends B{static get IsSupported(){if(!J.c.LastCreatedEngine)return!1;const n=J.c.LastCreatedEngine.getCaps();return n.supportTransformFeedbacks||n.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(n){this._maxActiveParticleCount=Math.min(n,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(n){this.maxActiveParticleCount=n}createPointEmitter(n,y){const H=un(n,y);return this.particleEmitterType=H,H}createHemisphericEmitter(){const n=Ln(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createSphereEmitter(){const n=Jn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=n,n}createDirectedSphereEmitter(){const n=mn(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new o.zy(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0));return this.particleEmitterType=n,n}createCylinderEmitter(){const n=ny(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=n,n}createDirectedCylinderEmitter(){const n=yy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new o.zy(0,1,0));return this.particleEmitterType=n,n}createConeEmitter(){const n=Hy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=n,n}createDirectedConeEmitter(){const n=oy(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.zy(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new o.zy(0,1,0));return this.particleEmitterType=n,n}createBoxEmitter(n,y,H,o){const G=new b;return this.particleEmitterType=G,this.direction1=n,this.direction2=y,this.minEmitBox=H,this.maxEmitBox=o,G}get flowMap(){return this._flowMap}set flowMap(n){this._flowMap!==n&&(this._flowMap=n)}isReady(){if(!this.hy||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==By.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(By.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(By.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";n?setTimeout((()=>{this.start(0)}),n):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var n;let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(n=this._customWrappers[y])||void 0===n?void 0:n.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[n]??this._customWrappers[0]}setCustomEffect(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[y]=new nn.b(this._engine),this._customWrappers[y].effect=n}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new u.c),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(n,y,H){return super._removeGradientAndTexture(n,y,H),this._releaseBuffers(),this}addColorGradient(n,y){this._colorGradients||(this._colorGradients=[]);const H=new s(n,y);return this._colorGradients.push(H),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(n&&this._colorGradients.sort(((n,y)=>n.gradient<y.gradient?-1:n.gradient>y.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(n){return this._removeGradientAndTexture(n,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const y in this._drawWrappers){var n;null===(n=this._drawWrappers[y].drawContext)||void 0===n||n.reset()}}_addFactorGradient(n,y,H){const o=new x(y,H);n.push(o),this._releaseBuffers()}addSizeGradient(n,y){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,n,y),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(n){return this._removeGradientAndTexture(n,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(n,y){if(!n)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&n.sort(((n,y)=>n.gradient<y.gradient?-1:n.gradient>y.gradient?1:0));const H=this;H[y]&&(H[y].dispose(),H[y]=null)}addAngularSpeedGradient(n,y){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,n,y),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(n){return this._removeGradientAndTexture(n,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(n,y){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,n,y),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(n){return this._removeGradientAndTexture(n,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(n,y){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,n,y),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(n){return this._removeGradientAndTexture(n,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(n,y){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,n,y),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(n){return this._removeGradientAndTexture(n,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(n){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(n,y,H){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(n),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.ah=new u.c,this.onStoppedObservable=new u.c,this.onStartedObservable=new u.c,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,H&&"Scene"!==H.getClassName()?(this._engine=H,this.defaultProjectionMatrix=o.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=H||J.c.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.NA.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,i.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,i.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,i.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,i.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new nn.b(this._engine)},this._customWrappers[0].effect=G,this._drawWrappers={0:new nn.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(y=y??{}).randomTextureSize||delete y.randomTextureSize;const k={ji:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...y},B=y;isFinite(B)&&(k.ji=B),this._capacity=k.ji,this._maxActiveParticleCount=k.ji,this._currentActiveCount=0,this._isAnimationSheetEnabled=h,this.particleEmitterType=new b;const V=Math.min(this._engine.getCaps().maxTextureSize,k.randomTextureSize);let q=[];for(let o=0;o<V;++o)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());this._randomTexture=new L.b(new Float32Array(q),V,1,5,H,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,q=[];for(let o=0;o<V;++o)q.push(Math.random()),q.push(Math.random()),q.push(Math.random()),q.push(Math.random());this._randomTexture2=new L.b(new Float32Array(q),V,1,5,H,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=V}_reset(){this._releaseBuffers()}_createVertexBuffers(n,y,H){const o={};o.position=y.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let G=3;o.age=y.createVertexBuffer("age",G,1,this._attributesStrideSize,!0),G+=1,o.size=y.createVertexBuffer("size",G,3,this._attributesStrideSize,!0),G+=3,o.life=y.createVertexBuffer("life",G,1,this._attributesStrideSize,!0),G+=1,G+=4,this.billboardMode===By.BILLBOARDMODE_STRETCHED&&(o.direction=y.createVertexBuffer("direction",G,3,this._attributesStrideSize,!0)),G+=3,this._platform.alignDataInBuffer&&(G+=1),this.particleEmitterType instanceof F&&(G+=3,this._platform.alignDataInBuffer&&(G+=1)),this._colorGradientsTexture||(o.color=y.createVertexBuffer("color",G,4,this._attributesStrideSize,!0),G+=4),this._isBillboardBased||(o.initialDirection=y.createVertexBuffer("initialDirection",G,3,this._attributesStrideSize,!0),G+=3,this._platform.alignDataInBuffer&&(G+=1)),this.noiseTexture&&(o.noiseCoordinates1=y.createVertexBuffer("noiseCoordinates1",G,3,this._attributesStrideSize,!0),G+=3,this._platform.alignDataInBuffer&&(G+=1),o.noiseCoordinates2=y.createVertexBuffer("noiseCoordinates2",G,3,this._attributesStrideSize,!0),G+=3,this._platform.alignDataInBuffer&&(G+=1)),o.angle=y.createVertexBuffer("angle",G,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?G++:G+=2,this._isAnimationSheetEnabled&&(o.cellIndex=y.createVertexBuffer("cellIndex",G,1,this._attributesStrideSize,!0),G+=1,this.spriteRandomStartCell&&(o.cellStartOffset=y.createVertexBuffer("cellStartOffset",G,1,this._attributesStrideSize,!0),G+=1)),o.offset=H.createVertexBuffer("offset",0,2),o.uv=H.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(o),this._platform.createVertexBuffers(n,o),this.resetDrawCache()}_initialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!n)return;const y=this._engine,H=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof F&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const G=this.particleEmitterType instanceof F,h=o.TmpVectors.zy[0];let k=0;for(let o=0;o<this._capacity;o++)if(H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),G?(this.particleEmitterType.particleDestinationGenerator(o,null,h),H.push(h.x),H.push(h.y),H.push(h.z)):(H.push(0),H.push(0),H.push(0)),this._platform.alignDataInBuffer&&H.push(0),k+=16,G&&(this.particleEmitterType.particlePositionGenerator(o,null,h),H.push(h.x),H.push(h.y),H.push(h.z),this._platform.alignDataInBuffer&&H.push(0),k+=4),this._colorGradientsTexture||(H.push(0),H.push(0),H.push(0),H.push(0),k+=4),this.isBillboardBased||(H.push(0),H.push(0),H.push(0),this._platform.alignDataInBuffer&&H.push(0),k+=4),this.noiseTexture&&(H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),H.push(Math.random()),H.push(Math.random()),H.push(Math.random()),this._platform.alignDataInBuffer&&H.push(0),k+=8),H.push(0),k+=1,this._angularSpeedGradientsTexture||(H.push(0),k+=1),this._isAnimationSheetEnabled&&(H.push(0),k+=1,this.spriteRandomStartCell&&(H.push(0),k+=1)),this._platform.alignDataInBuffer){let n=3-(k+3&3);for(k+=n;n-- >0;)H.push(0)}const i=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),B=this._platform.createParticleBuffer(H),V=this._platform.createParticleBuffer(H);this._buffer0=new g.d(y,B,!1,this._attributesStrideSize),this._buffer1=new g.d(y,V,!1,this._attributesStrideSize),this._spriteBuffer=new g.d(y,i,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let n=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(n+="\n#define BILLBOARD"),this._colorGradientsTexture&&(n+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(n+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(n+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(n+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(n+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(n+="\n#define DRAGGRADIENTS"),this._flowMap&&(n+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(n+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(n+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(n+="\n#define NOISE"),this.isLocal&&(n+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===n||(this._cachedUpdateDefines=n,this._updateBuffer=this._platform.createUpdateBuffer(n)),this._platform.isUpdateBufferReady()}_getWrapper(n){const y=this._getCustomDrawWrapper(n);if(null!==y&&void 0!==y&&y.effect)return y;const H=[];this.fillDefines(H,n);let o=this._drawWrappers[n];o||(o=new nn.b(this._engine),o.drawContext&&(o.drawContext.useInstancing=!0),this._drawWrappers[n]=o);const G=H.join("\n");if(o.defines!==G){const n=[],y=[],H=[];this.fillUniformsAttributesAndSamplerNames(y,n,H),o.setEffect(this._engine.createEffect("gpuRenderParticles",n,y,H,G),G)}return o}static _GetAttributeNamesOrOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const G=[g.g.PositionKind,"age","life","size","angle"];return n||G.push(g.g.ColorKind),y&&G.push("cellIndex"),H||G.push("initialDirection"),o&&G.push("direction"),G.push("offset",g.g.UVKind),G}static _GetEffectCreationOptions(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=["emitterWM","zV","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,yn.d)(o),n&&o.push("sheetInfos"),y&&o.push("logarithmicDepthConstant"),H&&(o.push("vFogInfos"),o.push("vFogColor")),o}fillDefines(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,yn.o)(this,this._scene,n),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==qy.e.FOGMODE_NONE&&n.push("#define FOG")),y===By.BLENDMODE_MULTIPLY&&n.push("#define BLENDMULTIPLYMODE"),this.isLocal&&n.push("#define LOCAL"),this.useLogarithmicDepth&&n.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(n.push("#define BILLBOARD"),this.billboardMode){case By.BILLBOARDMODE_Y:n.push("#define BILLBOARDY");break;case By.BILLBOARDMODE_STRETCHED:n.push("#define BILLBOARDSTRETCHED");break;case By.BILLBOARDMODE_ALL:n.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&n.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&n.push("#define ANIMATESHEET"),H&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),n.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(n,y,H){y.push(...Fy._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===By.BILLBOARDMODE_STRETCHED)),n.push(...Fy._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),H.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Vy.e.PrepareUniforms(n,this._imageProcessingConfigurationDefines),Vy.e.PrepareSamplers(H,this._imageProcessingConfigurationDefines))}animate(){var n;let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(y?this.preWarmStepOffset:(null===(n=this._scene)||void 0===n?void 0:n.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(n,y){const H=this[y];if(!n||!n.length||H)return;const o=new Float32Array(this._rawTextureWidth);for(let G=0;G<this._rawTextureWidth;G++){const y=G/this._rawTextureWidth;t.GetCurrentGradient(y,n,((n,y,H)=>{o[G]=(0,V.Lerp)(n.factor1,y.factor1,H)}))}this[y]=L.b.CreateRTexture(o,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[y].name=y.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const n=new Uint8Array(4*this._rawTextureWidth),y=k.TmpColors.pi[0];for(let H=0;H<this._rawTextureWidth;H++){const o=H/this._rawTextureWidth;t.GetCurrentGradient(o,this._colorGradients,((o,G,h)=>{k.pi.LerpToRef(o.color1,G.color1,h,y),n[4*H]=255*y.r,n[4*H+1]=255*y.g,n[4*H+2]=255*y.b,n[4*H+3]=255*y.a}))}this._colorGradientsTexture=L.b.CreateRGBATexture(n,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(n,y){var H,G,h,k;const i=this._getWrapper(n),B=i.effect;this._engine.enableEffect(i);const V=(null===(H=this._scene)||void 0===H?void 0:H.getViewMatrix())||o.Matrix.IdentityReadOnly;if(B.setMatrix("view",V),B.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),B.setTexture("diffuseSampler",this.particleTexture),B.setVector2("translationPivot",this.translationPivot),B.setVector3("zV",this.zV),this.isLocal&&B.setMatrix("emitterWM",y),this._colorGradientsTexture?B.setTexture("colorGradientSampler",this._colorGradientsTexture):B.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const n=this.particleTexture.getBaseSize();B.setFloat3("sheetInfos",this.spriteCellWidth/n.width,this.spriteCellHeight/n.height,n.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const n=this._scene.activeCamera;B.setVector3("eyePosition",n.globalPosition)}const q=B.defines;if(this._scene&&((0,yn.h)(B,this,this._scene),this.applyFog&&(0,Hn.g)(this._scene,void 0,B)),q.indexOf("#define BILLBOARDMODE_ALL")>=0){const n=V.clone();n.invert(),B.setMatrix("invView",n)}return this.useLogarithmicDepth&&this._scene&&(0,Hn.m)(q,B,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(B),this._setEngineBasedOnBlendMode(n),this._platform.bindDrawBuffers(this._targetIndex,B,null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(B),null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(k=this._scene)&&void 0!==k&&k.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(n){if(!this.hy||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!n)if(this.hy.position){n=this.hy.getWorldMatrix()}else{const y=this.hy;n=o.TmpVectors.Matrix[0],o.Matrix.TranslationToRef(y.x,y.y,y.z,n)}const y=this._engine,H=y.getDepthWrite();if(y.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const n=this.pn();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",n.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",n),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const G=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=G,y.setDepthWrite(H)}render(){let n,y=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!y&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let n=0;n<this.preWarmCycles;n++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const n=0|this._accumulatedCount;this._accumulatedCount-=n,this._currentActiveCount+=n}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.hy.position){n=this.hy.getWorldMatrix()}else{const y=this.hy;n=o.TmpVectors.Matrix[0],o.Matrix.TranslationToRef(y.x,y.y,y.z,n)}const G=this._engine;this.updateInAnimate||this._update(n);let h=0;return y||H||(G.setState(!1),this.forceDepthWrite&&G.setDepthWrite(!0),h=this.blendMode===By.BLENDMODE_MULTIPLYADD?this._render(By.BLENDMODE_MULTIPLY,n)+this._render(By.BLENDMODE_ADD,n):this._render(this.blendMode,n),this._engine.setAlphaMode(0)),h}rebuild(){const n=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(n,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,n()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const y in this._drawWrappers){this._drawWrappers[y].dispose()}if(this._drawWrappers={},this._scene){const n=this._scene.NA.indexOf(this);n>-1&&this._scene.NA.splice(n,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let y=0;y<this._renderVertexBuffers.length;++y){const n=this._renderVertexBuffers[y];for(const y in n)n[y].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),n&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),n&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.ah.notifyObservers(this),this.ah.clear()}clone(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o={...this._customWrappers};let G=null;const h=this._engine;if(h.createEffectForParticles&&null!=this.customShader){G=this.customShader;const n=G.shaderOptions.defines.length>0?G.shaderOptions.defines.join("\n"):"";o[0]=h.createEffectForParticles(G.shaderPath.fragmentElement,G.shaderOptions.uniforms,G.shaderOptions.samplers,n,void 0,void 0,void 0,this)}const k=this.serialize(H),i=Fy.Parse(k,this._scene||this._engine,this._rootUrl);return i.name=n,i.customShader=G,i._customWrappers=o,void 0===y&&(y=this.hy),this.noiseTexture&&(i.noiseTexture=this.noiseTexture.clone()),i.hy=y,i}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={};return By._Serialize(y,this,n),y.activeParticleCount=this.activeParticleCount,y.randomTextureSize=this._randomTextureSize,y.customShader=this.customShader,y}static Parse(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4?arguments[4]:void 0;const h=n.name;let k,i;y instanceof tn.e?k=y:(i=y,k=i.getEngine());const B=new Fy(h,{ji:G||n.ji,randomTextureSize:n.randomTextureSize},y,null,n.isAnimationSheetEnabled);if(B._rootUrl=H,n.customShader&&k.createEffectForParticles){const y=n.customShader,H=y.shaderOptions.defines.length>0?y.shaderOptions.defines.join("\n"):"",o=k.createEffectForParticles(y.shaderPath.fragmentElement,y.shaderOptions.uniforms,y.shaderOptions.samplers,H,void 0,void 0,void 0,B);B.setCustomEffect(o,0),B.customShader=y}return n.id&&(B.id=n.id),n.activeParticleCount&&(B.activeParticleCount=n.activeParticleCount),By._Parse(n,B,y,H),n.preventAutoStart&&(B.preventAutoStart=n.preventAutoStart),o||B.preventAutoStart||B.start(),B}}var gy=H(11094),My=H(12763),fy=H(11714);class cy{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(n){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const y of this.systems)y.hy=n;this._emitterNode=n}setEmitterAsSphere(n,y,H){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:n,renderingGroupId:y};const o=(0,My.d)("emitterSphere",{diameter:n.diameter,segments:n.segments},H);o.renderingGroupId=y;const G=new fy.vy("emitterSphereMaterial",H);G.emissiveColor=n.color,o.material=G;for(const h of this.systems)h.hy=o;this._emitterNode=o}start(n){for(const y of this.systems)n&&(y.hy=n),y.start()}dispose(){for(const n of this.systems)n.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const y={systems:[]};for(const H of this.systems)y.systems.push(H.serialize(n));return this._emitterNode&&(y.hy=this._emitterCreationOptions),y}static Parse(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;const G=new cy,h=this.BaseAssetsUrl+"/textures/";y=y||J.c.LastCreatedScene;for(const k of n.systems)G.systems.push(H?Fy.Parse(k,y,h,!0,o):By.Parse(k,y,h,!0,o));if(n.hy){const H=n.hy.options;if("Sphere"===n.hy.kind)G.setEmitterAsSphere({diameter:H.diameter,segments:H.segments,color:k.Fy.gy(H.color)},n.hy.renderingGroupId,y)}return G}}cy.BaseAssetsUrl="https://assets.babylonjs.com/particles";var py=H(11140);class Ey{static CreateDefault(n){let y,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,o=arguments.length>2?arguments[2]:void 0;y=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Fy("default system",{ji:H},o):new By("default system",H,o),y.hy=n;const G=gy.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return y.particleTexture=new j.b(G,y.pn()),y.createConeEmitter(.1,Math.PI/4),y.color1=new k.pi(1,1,1,1),y.color2=new k.pi(1,1,1,1),y.colorDead=new k.pi(1,1,1,0),y.minSize=.1,y.maxSize=.1,y.minEmitPower=2,y.maxEmitPower=2,y.updateSpeed=1/60,y.emitRate=30,y}static CreateAsync(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;y||(y=J.c.LastCreatedScene);const G={};return y.addPendingData(G),new Promise(((h,k)=>{if(H&&!Fy.IsSupported)return y.removePendingData(G),k("Particle system with GPU is not supported.");gy.Tools.LoadFile(`${Ey.BaseAssetsUrl}/systems/${n}.json`,(n=>{y.removePendingData(G);const k=JSON.parse(n.toString());return h(cy.Parse(k,y,H,o))}),void 0,void 0,void 0,(()=>(y.removePendingData(G),k(`An error occurred with the creation of your particle system. Check if your type '${n}' exists.`))))}))}static ExportSet(n){const y=new cy;for(const H of n)y.systems.push(H);return y}static ParseFromFileAsync(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",h=arguments.length>5?arguments[5]:void 0;return new Promise(((k,i)=>{const B=new py.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const y=JSON.parse(B.responseText);let i;i=o?Fy.Parse(y,H,G,!1,h):By.Parse(y,H,G,!1,h),n&&(i.name=n),k(i)}else i("Unable to load the particle system")})),B.open("GET",y),B.send()}))}static ParseFromSnippetAsync(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",G=arguments.length>4?arguments[4]:void 0;if("_BLANK"===n){const n=this.CreateDefault(null);return n.start(),Promise.resolve(n)}return new Promise(((h,k)=>{const i=new py.b;i.addEventListener("readystatechange",(()=>{if(4==i.readyState)if(200==i.status){const k=JSON.parse(JSON.parse(i.responseText).jsonPayload),B=JSON.parse(k.particleSystem);let V;V=H?Fy.Parse(B,y,o,!1,G):By.Parse(B,y,o,!1,G),V.snippetId=n,h(V)}else k("Unable to load the snippet "+n)})),i.open("GET",this.SnippetUrl+"/"+n.replace(/#/g,"/")),i.send()}))}}Ey.BaseAssetsUrl=cy.BaseAssetsUrl,Ey.SnippetUrl="https://snippet.babylonjs.com",Ey.CreateFromSnippetAsync=Ey.ParseFromSnippetAsync;var Xy=H(11800),dy=H(11596),ay=H(12766);(0,ay.c)(dy.c.NAME_PARTICLESYSTEM,((n,y,H,o)=>{const G=(0,ay.d)(dy.c.NAME_PARTICLESYSTEM);if(G&&void 0!==n.NA&&null!==n.NA)for(let h=0,k=n.NA.length;h<k;h++){const k=n.NA[h];H.NA.push(G(k,y,o))}})),(0,ay.b)(dy.c.NAME_PARTICLESYSTEM,((n,y,H)=>{if(n.activeParticleCount){return Fy.Parse(n,y,H)}return By.Parse(n,y,H)})),tn.e.prototype.createEffectForParticles=function(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",h=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,B=arguments.length>7?arguments[7]:void 0,V=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,q=arguments.length>9?arguments[9]:void 0,b=[],A=[];const U=[];return B?B.fillUniformsAttributesAndSamplerNames(A,b,U):(b=By._GetAttributeNamesOrOptions(),A=By._GetEffectCreationOptions()),-1===G.indexOf(" BILLBOARD")&&(G+="\n#define BILLBOARD\n"),null!==B&&void 0!==B&&B.isAnimationSheetEnabled&&-1===G.indexOf(" ANIMATESHEET")&&(G+="\n#define ANIMATESHEET\n"),-1===o.indexOf("diffuseSampler")&&o.push("diffuseSampler"),this.createEffect({vertex:q??(null===B||void 0===B?void 0:B.vertexShaderName)??"particles",fragmentElement:n},b,A.concat(y),U.concat(o),G,h,k,i,void 0,V,(async()=>{0===V?await Promise.resolve().then(H.bind(H,12810)):await Promise.resolve().then(H.bind(H,12875))}))},Xy.b.prototype.getEmittedParticleSystems=function(){const n=[];for(let y=0;y<this.pn().NA.length;y++){const H=this.pn().NA[y];H.hy===this&&n.push(H)}return n},Xy.b.prototype.getHierarchyEmittedParticleSystems=function(){const n=[],y=this.getDescendants();y.push(this);for(let H=0;H<this.pn().NA.length;H++){const o=this.pn().NA[H],G=o.hy;G.position&&-1!==y.indexOf(G)&&n.push(o)}return n};H(11680),H(11691),H(11779);H(11786),H(12770),H(11515),H(11667),H(11827);H(11507);var Oy;H(12779),H(11309);!function(n){n[n.Color=2]="Color",n[n.UV=1]="UV",n[n.Random=0]="Random",n[n.Stated=3]="Stated"}(Oy||(Oy={}));var ey=H(11547);const wy=new o.zy(0,0,0),jy=new o.zy(0,0,0),Iy=new o.zy(0,0,0);class Ry{constructor(n,y,H){this.width=n,this.height=y,this.data=H}processFlowable(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;if(!H)return;H instanceof o.Matrix?o.zy.TransformCoordinatesToRef(n.position,H,Iy):(Iy.x=H.x,Iy.y=H.y,Iy.z=H.z);const G=.5*Iy.x+.5,h=1-(.5*Iy.y+.5),k=Math.floor(G*this.width),i=Math.floor(h*this.height);if(k<0||k>=this.width||i<0||i>=this.height)return;const B=4*(i*this.width+k),V=this.data[B]/255*2-1,q=this.data[B+1]/255*2-1,b=this.data[B+2]/255*2-1,A=this.data[B+3]/255;wy.set(V,q,b),wy.scaleToRef(y*A,jy),n.direction.addInPlace(jy)}_processParticle(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,H=arguments.length>2?arguments[2]:void 0;this.processFlowable(n,y,H)}static async FromUrlAsync(n){return await new Promise(((y,H)=>{const o=document.createElement("canvas"),G=o.getContext("2d");let h=null;const k=new Image;k.crossOrigin="anonymous",k.src=n,k.onerror=y=>{H(new Error(`Failed to load image: ${n} : ${y}`))},k.onload=()=>{o.width=k.width,o.height=k.height,G.drawImage(k,0,0),h=G.getImageData(0,0,o.width,o.height),y(new Ry(o.width,o.height,h.data))}}))}static async ExtractFromTextureAsync(n){return await new Promise(((y,H)=>{if(!n.isReady())return void n.onLoadObservable.addOnce((async()=>{try{const H=await this.ExtractFromTextureAsync(n);y(H)}catch(o){H(o)}}));const o=n.getSize();ey.h.GetTextureDataAsync(n,o.width,o.height).then((n=>{y(new Ry(o.width,o.height,new Uint8ClampedArray(n)))})).catch(H)}))}}var Cy,Sy,Ny,ry,Ky,Yy,Dy,Zy,sy;!function(n){n[n.Int=1]="Int",n[n.Float=2]="Float",n[n.Vector2=4]="Vector2",n[n.zy=8]="zy",n[n.Matrix=16]="Matrix",n[n.Particle=32]="Particle",n[n.Texture=64]="Texture",n[n.pi=128]="pi",n[n.FloatGradient=256]="FloatGradient",n[n.Vector2Gradient=512]="Vector2Gradient",n[n.Vector3Gradient=1024]="Vector3Gradient",n[n.Color4Gradient=2048]="Color4Gradient",n[n.System=4096]="System",n[n.AutoDetect=8192]="AutoDetect",n[n.BasedOnInput=16384]="BasedOnInput",n[n.Undefined=32768]="Undefined",n[n.All=65535]="All"}(Cy||(Cy={})),function(n){n[n.Compatible=0]="Compatible",n[n.TypeIncompatible=1]="TypeIncompatible",n[n.HierarchyIssue=2]="HierarchyIssue"}(Sy||(Sy={})),function(n){n[n.Input=0]="Input",n[n.Output=1]="Output"}(Ny||(Ny={}));class Py{get direction(){return this._direction}get type(){if(this._type===Cy.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Cy.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(n){this._type=n}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((n=>n.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(n,y,H){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Cy.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new u.c,this.onDisconnectionObservable=new u.c,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=y,this.name=n,this._direction=H}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(n){var y;return this.isConnected?null!==(y=this._connectedPoint)&&void 0!==y&&y._storedFunction?this._connectedPoint._storedFunction(n):this._connectedPoint._storedValue:this.value}canConnectTo(n){return 0===this.checkCompatibilityState(n)}checkCompatibilityState(n){const y=this._ownerBlock,H=n.ownerBlock;if(this.type!==n.type&&n.innerType!==Cy.AutoDetect)return n.acceptedConnectionPointTypes&&-1!==n.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(n.excludedConnectionPointTypes&&-1!==n.excludedConnectionPointTypes.indexOf(this.type))return 1;let o=H,G=y;return 0===this.direction&&(o=y,G=H),o.isAnAncestorOf(G)?2:0}connectTo(n){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(n))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${n.ownerBlock.name}".${n.name}`;return this._endpoints.push(n),n._connectedPoint=this,this.onConnectionObservable.notifyObservers(n),n.onConnectionObservable.notifyObservers(this),this}disconnectFrom(n){const y=this._endpoints.indexOf(n);return-1===y||(this._endpoints.splice(y,1),n._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(n),n.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(n){let y=1;for(;y<Cy.All;)n&y||this.excludedConnectionPointTypes.push(y),y<<=1}serialize(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const y={};return y.name=this.name,y.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.Ui?(y.valueType="BABYLON."+this.value.getClassName(),y.value=this.value.Ui()):(y.valueType="number",y.value=this.value)),n&&this.connectedPoint&&(y.inputName=this.name,y.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,y.targetConnectionName=this.connectedPoint.name,y.isExposedOnFrame=!0,y.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(y.isExposedOnFrame=!0,y.exposedPortPosition=this.exposedPortPosition),y}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class xy{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(n){this._name=n}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(n){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new u.c,this.ah=new u.c,this.onInputChangedObservable=new u.c,this.visibleOnFrame=!1,this._name=n,this.uniqueId=I.e.UniqueId}_inputRename(n){return n}_outputRename(n){return n}isAnAncestorOf(n){for(const y of this._outputs)if(y.hasEndpoints)for(const H of y.endpoints){if(H.ownerBlock===n)return!0;if(H.ownerBlock.isAnAncestorOf(n))return!0}return!1}isAnAncestorOfType(n){if(this.getClassName()===n)return!0;for(const y of this._outputs)if(y.hasEndpoints)for(const H of y.endpoints)if(H.ownerBlock.isAnAncestorOfType(n))return!0;return!1}getInputByName(n){const y=this._inputs.filter((y=>y.name===n));return y.length?y[0]:null}_linkConnectionTypes(n,y){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[y]._acceptedConnectionPointType=this._inputs[n]:(this._inputs[n]._linkedConnectionSource=this._inputs[y],this._inputs[n]._isMainLinkSource=!0),this._inputs[y]._linkedConnectionSource=this._inputs[n]}registerInput(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0,G=arguments.length>4?arguments[4]:void 0,h=arguments.length>5?arguments[5]:void 0;const k=new Py(n,this,0);return k.type=y,k.isOptional=H,k.defaultValue=o,k.value=o,k.valueMin=G,k.valueMax=h,this._inputs.push(k),this.onInputChangedObservable.notifyObservers(k),this}registerOutput(n,y,H){return(H=H??new Py(n,this,1)).type=y,this._outputs.push(H),this}_build(n){}_customBuildStep(n){}build(n){if(this._buildId===n.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((n=>n.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=n.buildId;for(const y of this._inputs){if(!y.connectedPoint){y.isOptional||n.notConnectedNonOptionalInputs.push(y);continue}const H=y.connectedPoint.ownerBlock;H&&H!==this&&!H.isSystem&&H.build(n)}return this._customBuildStep(n),n.verbose&&R.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(n),this.onBuildObservable.notifyObservers(this),!1}serialize(){const n={};n.customType="BABYLON."+this.getClassName(),n.id=this.uniqueId,n.name=this.name,n.visibleOnFrame=this.visibleOnFrame,n.inputs=[],n.outputs=[];for(const y of this.inputs)n.inputs.push(y.serialize());for(const y of this.outputs)n.outputs.push(y.serialize(!1));return n}_deserialize(n){this._name=n.name,this.comments=n.comments,this.visibleOnFrame=!!n.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(n)}_deserializePortDisplayNamesAndExposedOnFrame(n){const y=n.inputs,H=n.outputs;if(y)for(const o of y){const n=this.inputs.find((n=>n.name===o.name));if(!n)return;if(o.displayName&&(n.displayName=o.displayName),o.isExposedOnFrame&&(n.isExposedOnFrame=o.isExposedOnFrame,n.exposedPortPosition=o.exposedPortPosition),void 0!==o.value&&null!==o.value)if("number"===o.valueType)n.value=o.value;else{const y=(0,i.e)(o.valueType);y&&(n.value=y.gy(o.value))}}if(H)for(let o=0;o<H.length;o++){const n=H[o];n.displayName&&(this.outputs[o].displayName=n.displayName),n.isExposedOnFrame&&(this.outputs[o].isExposedOnFrame=n.isExposedOnFrame,this.outputs[o].exposedPortPosition=n.exposedPortPosition)}}clone(){const n=this.serialize(),y=(0,i.e)(n.customType);if(y){const H=new y;return H._deserialize(n),H}return null}dispose(){this.ah.notifyObservers(this),this.ah.clear();for(const n of this.inputs)n.dispose();for(const n of this.outputs)n.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function ty(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",o=arguments.length>3?arguments[3]:void 0;return(G,h)=>{let k=G._propStore;k||(k=[],G._propStore=k),k.push({propertyName:h,displayName:n,type:y,groupName:H,options:o??{},className:G.getClassName()})}}(0,O.e)([(0,e.J)("comment")],xy.prototype,"comments",void 0),function(n){n[n.Boolean=0]="Boolean",n[n.Float=1]="Float",n[n.Int=2]="Int",n[n.Vector2=3]="Vector2",n[n.List=4]="List",n[n.pi=5]="pi",n[n.SamplingMode=6]="SamplingMode",n[n.TextureFormat=7]="TextureFormat",n[n.TextureType=8]="TextureType"}(ry||(ry={})),function(n){n[n.None=0]="None",n[n.Position=1]="Position",n[n.Direction=2]="Direction",n[n.Age=3]="Age",n[n.Lifetime=4]="Lifetime",n[n.Color=5]="Color",n[n.ScaledDirection=6]="ScaledDirection",n[n.Scale=7]="Scale",n[n.AgeGradient=8]="AgeGradient",n[n.Angle=9]="Angle",n[n.SpriteCellIndex=16]="SpriteCellIndex",n[n.SpriteCellStart=17]="SpriteCellStart",n[n.SpriteCellEnd=18]="SpriteCellEnd"}(Ky||(Ky={})),function(n){n[n.None=0]="None",n[n.Time=1]="Time",n[n.Delta=2]="Delta",n[n.Emitter=3]="Emitter"}(Yy||(Yy={}));class uy{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let n="";for(const y of this.notConnectedNonOptionalInputs)n+=`input ${y.name} from block ${y.ownerBlock.name}[${y.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(n)throw"Build of Node Particle System Set failed:\n"+n}adapt(n,y){const H=n.getConnectedValue(this)||0;if(n.type===y)return H;switch(y){case Cy.Vector2:return new o.Vector2(H,H);case Cy.zy:return new o.zy(H,H,H);case Cy.pi:return new k.pi(H,H,H,H)}return null}getContextualValue(n){if(!this.particleContext||!this.systemContext)return null;switch(n){case Ky.Position:return this.particleContext.position;case Ky.Direction:return this.particleContext.direction;case Ky.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Ky.Color:return this.particleContext.color;case Ky.Age:return this.particleContext.age;case Ky.Lifetime:return this.particleContext.lifeTime;case Ky.Angle:return this.particleContext.angle;case Ky.Scale:return this.particleContext.scale;case Ky.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Ky.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Ky.SpriteCellIndex:return this.particleContext.cellIndex;case Ky.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.hy.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.hy.absolutePosition:this.systemContext.hy:null}getSystemValue(n){if(!this.particleContext||!this.systemContext)return null;switch(n){case Yy.Time:return this.systemContext._actualFrame;case Yy.Delta:return this.systemContext._scaledUpdateSpeed;case Yy.Emitter:if(this.isEmitterTransformNode){return this.systemContext.hy.absolutePosition}return this.systemContext.hy}return null}}function Ly(n,y,H){const o=new uy;o.ly=y;const G=n.createSystem(o);return G.canStart=()=>!0,G.hy=H.clone(),G.disposeOnStop=!0,G.start(),G}class Jy extends xy{constructor(n){super(n),this.blendMode=B.BLENDMODE_ONEONE,this.ji=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Cy.Particle),this.registerInput("texture",Cy.Texture),this.registerInput("onStart",Cy.System,!0),this.registerInput("onEnd",Cy.System,!0),this.registerOutput("system",Cy.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(n){n.ji=this.ji,n.buildId=this._buildId++,this.build(n);const y=this.particle.getConnectedValue(n);return y.particleTexture=this.texture.getConnectedValue(n),y.emitRate=this.emitRate,y.blendMode=this.blendMode,y.name=this.name,y._nodeGenerated=!0,y._targetStopDuration=this.targetStopDuration,y.startDelay=this.startDelay,this.system._storedValue=this,y.canStart=()=>!this.doNoStart,y.onStartedObservable.add((H=>{const o=this.onStart.getConnectedValue(n);o&&H.onStartedObservable.addOnce((()=>{n.systemContext=y;const H=Ly(o,n.ly,n.emitterPosition);this.ah.addOnce((()=>{H.dispose()}))}));const G=this.onEnd.getConnectedValue(n);G&&H.onStoppedObservable.addOnce((()=>{n.systemContext=y;const H=Ly(G,n.ly,n.emitterPosition);this.ah.addOnce((()=>{H.dispose()}))}))})),this.ah.addOnce((()=>{y.dispose()})),y}serialize(){const n=super.serialize();return n.ji=this.ji,n.emitRate=this.emitRate,n.blendMode=this.blendMode,n.doNoStart=this.doNoStart,n.targetStopDuration=this.targetStopDuration,n.startDelay=this.startDelay,n}_deserialize(n){super._deserialize(n),this.ji=n.ji,this.emitRate=n.emitRate,this.doNoStart=!!n.doNoStart,void 0!==n.blendMode&&(this.blendMode=n.blendMode),void 0!==n.targetStopDuration&&(this.targetStopDuration=n.targetStopDuration),void 0!==n.startDelay&&(this.startDelay=n.startDelay)}}(0,O.e)([ty("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:B.BLENDMODE_ONEONE},{label:"Standard",value:B.BLENDMODE_STANDARD},{label:"Add",value:B.BLENDMODE_ADD},{label:"Multiply",value:B.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:B.BLENDMODE_MULTIPLYADD}]})],Jy.prototype,"blendMode",void 0),(0,O.e)([ty("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Jy.prototype,"ji",void 0),(0,O.e)([ty("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Jy.prototype,"emitRate",void 0),(0,O.e)([ty("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Jy.prototype,"targetStopDuration",void 0),(0,O.e)([ty("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Jy.prototype,"startDelay",void 0),(0,O.e)([ty("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Jy.prototype,"doNoStart",void 0),(0,i.h)("BABYLON.SystemBlock",Jy);class my extends xy{get type(){if(this._type===Cy.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Cy.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Cy.Vector2,this._type;case"zy":return this._type=Cy.zy,this._type;case"pi":return this._type=Cy.pi,this._type;case"Matrix":return this._type=Cy.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Ky.None&&this._systemSource!==Yy.None}get systemSource(){return this._systemSource}set systemSource(n){if(this._systemSource=n,n!==Yy.None){switch(this._contextualSource=Ky.None,this._type=Cy.Float,n){case Yy.Time:case Yy.Delta:this._type=Cy.Float;break;case Yy.Emitter:this._type=Cy.zy}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Ky.None}get contextualValue(){return this._contextualSource}set contextualValue(n){if(this._contextualSource=n,n!==Ky.None){switch(this._systemSource=Yy.None,n){case Ky.Scale:this._type=Cy.Vector2;break;case Ky.Position:case Ky.Direction:case Ky.ScaledDirection:this._type=Cy.zy;break;case Ky.Color:this._type=Cy.pi;break;case Ky.Age:case Ky.Lifetime:case Ky.Angle:case Ky.AgeGradient:this._type=Cy.Float;break;case Ky.SpriteCellEnd:case Ky.SpriteCellStart:case Ky.SpriteCellIndex:this._type=Cy.Int}this.output&&(this.output.type=this._type)}}constructor(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Cy.AutoDetect;super(n),this._type=Cy.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new u.c,this._systemSource=Yy.None,this._contextualSource=Ky.None,this._type=y,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",y)}get value(){return this._storedValue}set value(n){this.type===Cy.Float&&this.min!==this.max&&(n=Math.max(this.min,n),n=Math.min(this.max,n)),this._storedValue=n,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(n){this._valueCallback=n}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Cy.Int:case Cy.Float:this.value=0;break;case Cy.Vector2:this.value=o.Vector2.Zero();break;case Cy.zy:this.value=o.zy.Zero();break;case Cy.pi:this.value=new k.pi(1,1,1,1);break;case Cy.Matrix:this.value=o.Matrix.Identity()}}_build(n){super._build(n),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=n=>n.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=n=>n.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const n=super.serialize();return n.type=this.type,n.contextualValue=this.contextualValue,n.systemSource=this.systemSource,n.min=this.min,n.max=this.max,n.groupInInspector=this.groupInInspector,n.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.Ui?(n.valueType="BABYLON."+this._storedValue.getClassName(),n.value=this._storedValue.Ui()):(n.valueType="number",n.value=this._storedValue)),n}_deserialize(n){if(super._deserialize(n),this._type=n.type,this.contextualValue=n.contextualValue,this.systemSource=n.systemSource||Yy.None,this.min=n.min||0,this.max=n.max||0,this.groupInInspector=n.groupInInspector||"",void 0!==n.displayInInspector&&(this.displayInInspector=n.displayInInspector),n.valueType)if("number"===n.valueType)this._storedValue=n.value;else{const y=(0,i.e)(n.valueType);y&&(this._storedValue=y.gy(n.value))}}}(0,i.h)("BABYLON.ParticleInputBlock",my);class nH extends xy{get url(){return this._url}set url(n){this._url!==n&&(this._cachedData=null,this._url=n,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(n){this._textureDataUrl!==n&&(this._cachedData=null,this._textureDataUrl=n,this._url="",this._sourceTexture=null)}set sourceTexture(n){this._sourceTexture!==n&&(this._cachedData=null,this._sourceTexture=n,this._url="",this._textureDataUrl="")}constructor(n){super(n),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Cy.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const n=this.texture._storedValue;return await new Promise(((y,H)=>{if(!n.isReady())return void n.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),y(this._cachedData)}catch(n){H(n)}}));const o=n.getSize();ey.h.GetTextureDataAsync(n,o.width,o.height).then((H=>{this._cachedData={width:o.width,height:o.height,data:new Uint8ClampedArray(H)},n.dispose(),y(this._cachedData)})).catch(H)}))}_build(n){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new j.b(this._textureDataUrl,n.ly):this.texture._storedValue=new j.b(this._url,n.ly):this.texture._storedValue=null}serialize(){const n=super.serialize();return n.url=this.url,n.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(n.textureDataUrl=this.textureDataUrl),n}_deserialize(n){super._deserialize(n),this.url=n.url,this.serializedCachedData=!!n.serializedCachedData,n.textureDataUrl&&(this.textureDataUrl=n.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,i.h)("BABYLON.ParticleTextureSourceBlock",nH);class yH extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("position",Cy.zy),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(n){const y=this.particle.getConnectedValue(n);if(this.output._storedValue=y,!this.position.isConnected)return;const H={process:H=>{n.particleContext=H,n.systemContext=y,H.position.B(this.position.getConnectedValue(n))},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H}}(0,i.h)("BABYLON.UpdatePositionBlock",yH),function(n){n[n.Add=0]="Add",n[n.Subtract=1]="Subtract",n[n.Multiply=2]="Multiply",n[n.Divide=3]="Divide",n[n.Max=4]="Max",n[n.Min=5]="Min"}(Dy||(Dy={}));class HH extends xy{constructor(n){super(n),this.operation=Dy.Add,this.registerInput("left",Cy.AutoDetect),this.registerInput("right",Cy.AutoDetect),this.registerOutput("output",Cy.BasedOnInput),this.output._typeConnectionSource=this.left;const y=[Cy.Matrix,Cy.Particle,Cy.Texture,Cy.System,Cy.FloatGradient,Cy.Color4Gradient,Cy.Vector2Gradient,Cy.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...y),this.right.excludedConnectionPointTypes.push(...y),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(n){let y;const H=this.left,G=this.right;if(!H.isConnected||!G.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const h=H.type===Cy.Float||H.type===Cy.Int,i=G.type===Cy.Float||G.type===Cy.Int,B=h&&i;switch(this.operation){case Dy.Add:y=B?n=>H.getConnectedValue(n)+G.getConnectedValue(n):h?n=>n.adapt(H,G.type).add(G.getConnectedValue(n)):n=>H.getConnectedValue(n).add(n.adapt(G,H.type));break;case Dy.Subtract:y=B?n=>H.getConnectedValue(n)-G.getConnectedValue(n):h?n=>n.adapt(H,G.type).Qy(G.getConnectedValue(n)):n=>H.getConnectedValue(n).Qy(n.adapt(G,H.type));break;case Dy.Multiply:y=B?n=>H.getConnectedValue(n)*G.getConnectedValue(n):h?n=>n.adapt(H,G.type).multiply(G.getConnectedValue(n)):n=>H.getConnectedValue(n).multiply(n.adapt(G,H.type));break;case Dy.Divide:y=B?n=>H.getConnectedValue(n)/G.getConnectedValue(n):h?n=>n.adapt(H,G.type).divide(G.getConnectedValue(n)):n=>H.getConnectedValue(n).divide(n.adapt(G,H.type));break;case Dy.Min:if(B)y=n=>Math.min(H.getConnectedValue(n),G.getConnectedValue(n));else{const[n,i]=h?[G,H]:[H,G];switch(n.type){case Cy.Vector2:y=y=>o.Vector2.Minimize(n.getConnectedValue(y),y.adapt(i,n.type));break;case Cy.zy:y=y=>o.zy.Minimize(n.getConnectedValue(y),y.adapt(i,n.type));break;case Cy.pi:y=y=>{const H=n.getConnectedValue(y),{r:o,g:G,b:h,a:B}=y.adapt(i,n.type);return new k.pi(Math.min(H.r,o),Math.min(H.g,G),Math.min(H.b,h),Math.min(H.a,B))}}}break;case Dy.Max:if(!B){const[n,i]=h?[G,H]:[H,G];switch(n.type){case Cy.Vector2:y=y=>o.Vector2.Maximize(n.getConnectedValue(y),y.adapt(i,n.type));break;case Cy.zy:y=y=>o.zy.Maximize(n.getConnectedValue(y),y.adapt(i,n.type));break;case Cy.pi:y=y=>{const H=n.getConnectedValue(y),{r:o,g:G,b:h,a:B}=y.adapt(i,n.type);return new k.pi(Math.max(H.r,o),Math.min(H.g,G),Math.min(H.b,h),Math.min(H.a,B))}}break}y=n=>Math.max(H.getConnectedValue(n),G.getConnectedValue(n))}this.output._storedFunction=n=>H.type===Cy.Int?0|y(n):y(n)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Cy.Int||this.left.type===Cy.Float&&this.right.type!==Cy.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[n,y]of[[this.left,this.right],[this.right,this.left]])n.acceptedConnectionPointTypes=[Cy.Int,Cy.Float],y.isConnected&&(n.acceptedConnectionPointTypes.push(y.type),y.type!==Cy.Int&&y.type!==Cy.Float||n.acceptedConnectionPointTypes.push(Cy.Vector2,Cy.zy,Cy.pi))}dispose(){super.dispose();for(const n of this._connectionObservers)n.remove();this._connectionObservers.length=0}serialize(){const n=super.serialize();return n.operation=this.operation,n}_deserialize(n){super._deserialize(n),this.operation=n.operation}}(0,O.e)([ty("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Dy.Add},{label:"Subtract",value:Dy.Subtract},{label:"Multiply",value:Dy.Multiply},{label:"Divide",value:Dy.Divide},{label:"Max",value:Dy.Max},{label:"Min",value:Dy.Min}]})],HH.prototype,"operation",void 0),(0,i.h)("BABYLON.ParticleMathBlock",HH);class oH extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("direction1",Cy.zy,!0,new o.zy(0,1,0)),this.registerInput("direction2",Cy.zy,!0,new o.zy(0,1,0)),this.registerInput("minEmitBox",Cy.zy,!0,new o.zy(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Cy.zy,!0,new o.zy(.5,.5,.5)),this.registerOutput("output",Cy.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(n){const y=this.particle.getConnectedValue(n);y._directionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.direction1.getConnectedValue(n),h=this.direction2.getConnectedValue(n),k=(0,V.RandomRange)(G.x,h.x),i=(0,V.RandomRange)(G.y,h.y),B=(0,V.RandomRange)(G.z,h.z);n.isEmitterTransformNode?o.zy.TransformNormalFromFloatsToRef(k,i,B,n.emitterWorldMatrix,H.direction):H.direction.Mi(k,i,B)},y._positionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.minEmitBox.getConnectedValue(n),h=this.maxEmitBox.getConnectedValue(n),k=(0,V.RandomRange)(G.x,h.x),i=(0,V.RandomRange)(G.y,h.y),B=(0,V.RandomRange)(G.z,h.z);n.isEmitterTransformNode?o.zy.TransformCoordinatesFromFloatsToRef(k,i,B,n.emitterWorldMatrix,H.position):(H.position.Mi(k,i,B),H.position.addInPlace(n.emitterPosition))},this.output._storedValue=y}}(0,i.h)("BABYLON.BoxShapeBlock",oH);class GH extends xy{constructor(n){super(n),this.registerInput("emitPower",Cy.Float,!0,1),this.registerInput("lifeTime",Cy.Float,!0,1),this.registerInput("color",Cy.pi,!0,new k.pi(1,1,1,1)),this.registerInput("scale",Cy.Vector2,!0,new o.Vector2(1,1)),this.registerInput("angle",Cy.Float,!0,0),this.registerOutput("particle",Cy.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(n){const y=new By(this.name,n.ji,n.ly,null,!1,void 0,!0);y.particleEmitterType=new Q,y._lifeTimeCreation.process=(y,H)=>{n.particleContext=y,y.lifeTime=this.lifeTime.getConnectedValue(n),H._emitPower=this.emitPower.getConnectedValue(n)},y._colorCreation.process=y=>{n.particleContext=y,y.color.B(this.color.getConnectedValue(n))},y._sizeCreation.process=y=>{n.particleContext=y,y.size=1,y.scale.B(this.scale.getConnectedValue(n))},y._angleCreation.process=y=>{n.particleContext=y,y.angle=this.angle.getConnectedValue(n)},this.particle._storedValue=y}}(0,i.h)("BABYLON.CreateParticleBlock",GH);class hH{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const n=[];for(const y of this.attachedBlocks)y.isInput&&n.push(y);return n}constructor(n){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new u.c,this.name=n}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(n){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(n)&&this.attachedBlocks.push(n);for(const H of n.inputs){const o=H.connectedPoint;if(o){const H=o.ownerBlock;H!==n&&this._initializeBlock(H,y)}}}async buildAsync(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((H=>{const o=new cy;for(const n of this._systemBlocks)this._initializeBlock(n);for(const G of this.systemBlocks){const H=new uy;H.buildId=this._buildId++,H.ly=n,H.verbose=y;const h=G.createSystem(H);H.emitErrors(),o.systems.push(h)}this.onBuildObservable.notifyObservers(this),H(o)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const n=new Jy("Particle system"),y=new yH("Update position");y.output.connectTo(n.particle);const H=new my("Position");H.contextualValue=Ky.Position;const o=new my("Scaled direction");o.contextualValue=Ky.ScaledDirection;const G=new HH("Add");G.operation=Dy.Add,H.output.connectTo(G.left),o.output.connectTo(G.right),G.output.connectTo(y.position);const h=new GH("Create particle"),k=new oH("Box shape");h.particle.connectTo(k.particle),k.output.connectTo(y.particle);const i=new nH("Texture");i.texture.connectTo(n.texture),i.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(n)}removeBlock(n){const y=this.attachedBlocks.indexOf(n);if(y>-1&&this.attachedBlocks.splice(y,1),n.isSystem){const y=this._systemBlocks.indexOf(n);y>-1&&this._systemBlocks.splice(y,1)}}parseSerializedObject(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y||this.clear();const H={};for(const o of n.zq){const n=(0,i.e)(o.customType);if(n){const y=new n;y._deserialize(o),H[o.id]=y,this.attachedBlocks.push(y),y.isSystem&&this._systemBlocks.push(y)}}for(const o of this.attachedBlocks)if(o.isTeleportOut){const n=o,y=n._tempEntryPointUniqueId;if(y){const o=H[y];o&&o.attachToEndpoint(n)}}for(let o=0;o<n.zq.length;o++){const G=n.zq[o],h=H[G.id];h&&(h.inputs.length&&G.inputs.some((n=>n.targetConnectionName))&&!y||this._restoreConnections(h,n,H))}if(n.locations||n.editorData&&n.editorData.locations){const o=n.locations||n.editorData.locations;for(const n of o)H[n.yG]&&(n.yG=H[n.yG].uniqueId);y&&this.editorData&&this.editorData.locations&&o.concat(this.editorData.locations),n.locations?this.editorData={locations:o}:(this.editorData=n.editorData,this.editorData.locations=o);const G=[];for(const n in H)G[n]=H[n].uniqueId;this.editorData.map=G}this.comment=n.comment}_restoreConnections(n,y,H){for(const o of n.outputs)for(const G of y.zq){const h=H[G.id];if(h)for(const k of G.inputs)if(H[k.targetBlockId]!==n||k.targetConnectionName!==o.name);else{const n=h.getInputByName(k.inputName);if(!n||n.isConnected)continue;o.connectTo(n,!0),this._restoreConnections(h,y,H)}}}serialize(n){const y=n?{}:w.c.Serialize(this);y.editorData=JSON.parse(JSON.stringify(this.editorData));let H=[];n?H=n:y.customType="BABYLON.NodeParticleSystemSet",y.zq=[];for(const o of H)y.zq.push(o.serialize());if(!n)for(const o of this.attachedBlocks)-1===H.indexOf(o)&&y.zq.push(o.serialize());return y}dispose(){for(const n of this.attachedBlocks)n.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(n){const y=new hH(n);return y.setToDefault(),y}static Parse(n){const y=w.c.Parse((()=>new hH(n.name)),n,null);return y.parseSerializedObject(n),y}static ParseFromSnippetAsync(n,y){return"_BLANK"===n?Promise.resolve(hH.CreateDefault("blank")):new Promise(((H,o)=>{const G=new py.b;G.addEventListener("readystatechange",(()=>{if(4==G.readyState)if(200==G.status){const k=JSON.parse(JSON.parse(G.responseText).jsonPayload),i=JSON.parse(k.nodeParticle);y||(y=w.c.Parse((()=>new hH(n)),i,null)),y.parseSerializedObject(i),y.snippetId=n;try{H(y)}catch(h){o(h)}}else o("Unable to load the snippet "+n)})),G.open("GET",this.SnippetUrl+"/"+n.replace(/#/g,"/")),G.send()}))}}hH.EditorURL=`${gy.Tools._DefaultCdnUrl}/v${tn.e.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,hH.SnippetUrl="https://snippet.babylonjs.com",(0,O.e)([(0,e.J)()],hH.prototype,"name",void 0),(0,O.e)([(0,e.J)("comment")],hH.prototype,"comment",void 0),function(n){n[n.None=0]="None",n[n.PerParticle=1]="PerParticle",n[n.PerSystem=2]="PerSystem"}(Zy||(Zy={}));class kH extends xy{constructor(n){super(n),this._currentLockId=-2,this.lockMode=Zy.PerParticle,this.registerInput("min",Cy.AutoDetect,!0,0),this.registerInput("max",Cy.AutoDetect,!0,1),this.registerOutput("output",Cy.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Cy.Float|Cy.Int|Cy.Vector2|Cy.zy|Cy.pi),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Cy.Float|Cy.Int|Cy.Vector2|Cy.zy|Cy.pi),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Cy.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let n=null;switch(this._currentLockId=-2,this.min.type){case Cy.AutoDetect:case Cy.Int:case Cy.Float:n=n=>{const y=this.min.getConnectedValue(n)||0,H=this.max.getConnectedValue(n)||1;return y+Math.random()*(H-y)};break;case Cy.Vector2:n=n=>{const y=this.min.getConnectedValue(n)||o.Vector2.Zero(),H=this.max.getConnectedValue(n)||o.Vector2.One();return new o.Vector2(y.x+Math.random()*(H.x-y.x),y.y+Math.random()*(H.y-y.y))};break;case Cy.zy:n=n=>{const y=this.min.getConnectedValue(n)||o.zy.Zero(),H=this.max.getConnectedValue(n)||o.zy.One();return new o.zy(y.x+Math.random()*(H.x-y.x),y.y+Math.random()*(H.y-y.y),y.z+Math.random()*(H.z-y.z))};break;case Cy.pi:n=n=>{const y=this.min.getConnectedValue(n)||new k.pi(0,0,0,0),H=this.max.getConnectedValue(n)||new k.pi(1,1,1,1);return new k.pi(y.x+Math.random()*(H.x-y.x),y.y+Math.random()*(H.y-y.y),y.z+Math.random()*(H.z-y.z),y.w+Math.random()*(H.w-y.w))}}this.output._storedFunction=y=>{var H;let o=0;switch(this.lockMode){case Zy.PerParticle:o=(null===(H=y.particleContext)||void 0===H?void 0:H.id)||-1;break;case Zy.PerSystem:o=y.buildId||0}return this._currentLockId!==o&&(this.lockMode!==Zy.None&&(this._currentLockId=o),this.output._storedValue=n(y)),this.output._storedValue}}serialize(){const n=super.serialize();return n.lockMode=this.lockMode,n}_deserialize(n){super._deserialize(n),this.lockMode=n.lockMode}}(0,O.e)([ty("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Zy.None},{label:"Per particle",value:Zy.PerParticle},{label:"Per system",value:Zy.PerSystem}]})],kH.prototype,"lockMode",void 0),(0,i.h)("BABYLON.ParticleRandomBlock",kH);class iH extends xy{constructor(n){super(n),this._currentLockId=-2,this.lockMode=Zy.PerParticle,this.registerInput("min",Cy.AutoDetect),this.registerInput("max",Cy.AutoDetect),this.registerOutput("output",Cy.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const y=[Cy.Matrix,Cy.Particle,Cy.Texture,Cy.System,Cy.FloatGradient,Cy.Color4Gradient,Cy.Vector2Gradient,Cy.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...y),this.max.excludedConnectionPointTypes.push(...y)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let n=null;switch(this._currentLockId=-2,this.min.type){case Cy.Float:case Cy.Int:n=n=>{const y=this.min.getConnectedValue(n),H=this.max.getConnectedValue(n);return Math.random()*(H-y)+y};break;case Cy.Vector2:n=n=>{const y=this.min.getConnectedValue(n),H=this.max.getConnectedValue(n);return new o.Vector2(Math.random()*(H.x-y.x)+y.x,Math.random()*(H.y-y.y)+y.y)};break;case Cy.zy:n=n=>{const y=this.min.getConnectedValue(n),H=this.max.getConnectedValue(n);return new o.zy(Math.random()*(H.x-y.x)+y.x,Math.random()*(H.y-y.y)+y.y,Math.random()*(H.z-y.z)+y.z)};break;case Cy.pi:n=n=>{const y=this.min.getConnectedValue(n),H=this.max.getConnectedValue(n);return new k.pi(Math.random()*(H.r-y.r)+y.r,Math.random()*(H.g-y.g)+y.g,Math.random()*(H.b-y.b)+y.b,Math.random()*(H.a-y.a)+y.a)}}this.output._storedFunction=y=>{var H;let o=0;switch(this.lockMode){case Zy.PerParticle:o=(null===(H=y.particleContext)||void 0===H?void 0:H.id)||-1;break;case Zy.PerSystem:o=y.buildId||0}return this._currentLockId!==o&&(this.lockMode!==Zy.None&&(this._currentLockId=o),this.output._storedValue=n(y)),this.output._storedValue}}serialize(){const n=super.serialize();return n.lockMode=this.lockMode,n}_deserialize(n){super._deserialize(n),void 0!==n.lockMode&&(this.lockMode=n.lockMode)}}(0,O.e)([ty("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Zy.None},{label:"Per particle",value:Zy.PerParticle},{label:"Per system",value:Zy.PerSystem}]})],iH.prototype,"lockMode",void 0),(0,i.h)("BABYLON.RandomRangeBlock",iH);(0,i.h)("BABYLON.ParticleLerpBlock",class extends xy{constructor(n){super(n),this.registerInput("left",Cy.AutoDetect),this.registerInput("right",Cy.AutoDetect),this.registerInput("gradient",Cy.Float,!0,0,0,1),this.registerOutput("output",Cy.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Cy.Float|Cy.Int|Cy.Vector2|Cy.zy|Cy.pi)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const n=(n,y,H)=>(1-n)*y+n*H;this.output._storedFunction=y=>{const H=this.left.getConnectedValue(y),G=this.right.getConnectedValue(y),h=this.gradient.getConnectedValue(y);switch(this.left.type){case Cy.Int:case Cy.Float:return n(h,H,G);case Cy.Vector2:return new o.Vector2(n(h,H.x,G.x),n(h,H.y,G.y));case Cy.zy:return new o.zy(n(h,H.x,G.x),n(h,H.y,G.y),n(h,H.z,G.z));case Cy.pi:return new k.pi(n(h,H.r,G.r),n(h,H.g,G.g),n(h,H.b,G.b),n(h,H.a,G.a))}return 0}}});(0,i.h)("BABYLON.UpdateDirectionBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("direction",Cy.zy),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(n){const y=this.particle.getConnectedValue(n);if(this.output._storedValue=y,!this.direction.isConnected)return;const H={process:H=>{n.particleContext=H,n.systemContext=y,H.direction.B(this.direction.getConnectedValue(n))},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H}});(0,i.h)("BABYLON.UpdateColorBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("color",Cy.pi),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(n){const y=this.particle.getConnectedValue(n);if(this.output._storedValue=y,!this.color.isConnected)return;const H={process:H=>{n.particleContext=H,n.systemContext=y,H.color.B(this.color.getConnectedValue(n))},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H}});(0,i.h)("BABYLON.UpdateScaleBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("scale",Cy.Vector2),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(n){const y=this.particle.getConnectedValue(n);if(this.output._storedValue=y,!this.scale.isConnected)return;const H={process:H=>{n.particleContext=H,n.systemContext=y,H.scale.B(this.scale.getConnectedValue(n))},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H}});(0,i.h)("BABYLON.UpdateAngleBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("angle",Cy.Float),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(n){const y=this.particle.getConnectedValue(n);if(this.output._storedValue=y,!this.angle.isConnected)return;const H={process:H=>{n.particleContext=H,n.systemContext=y,H.angle=this.angle.getConnectedValue(n)},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H}});(0,i.h)("BABYLON.BasicPositionUpdateBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(n){const y=this.particle.getConnectedValue(n),H={process:H=>{n.particleContext=H,n.systemContext=y,H.direction.scaleToRef(y._directionScale,y._scaledDirection),H.position.addInPlace(y._scaledDirection)},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H,this.output._storedValue=y}});(0,i.h)("BABYLON.BasicSpriteUpdateBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(n){const y=this.particle.getConnectedValue(n),H={process:H=>{n.particleContext=H,n.systemContext=y,H.updateCellIndex()},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H,this.output._storedValue=y}});(0,i.h)("BABYLON.UpdateSpriteCellIndexBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("cellIndex",Cy.Int),this.registerOutput("output",Cy.Particle),this.cellIndex.acceptedConnectionPointTypes=[Cy.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(n){const y=this.particle.getConnectedValue(n);if(this.output._storedValue=y,!this.cellIndex.isConnected)return;const H={process:H=>{n.particleContext=H,n.systemContext=y,H.cellIndex=Math.floor(this.cellIndex.getConnectedValue(n))},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H}});class BH extends xy{constructor(n){super(n),this.strength=1,this.registerInput("particle",Cy.Particle),this.registerInput("flowMap",Cy.Texture),this.registerOutput("output",Cy.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(n){var y;const H=this.particle.getConnectedValue(n),o=n.ly;let G;(null===(y=this.flowMap.connectedPoint)||void 0===y?void 0:y.ownerBlock).extractTextureContentAsync().then((n=>{n&&(G=new Ry(n.width,n.height,n.data))}));const h={process:n=>{const y=o.getTransformMatrix();G&&G._processParticle(n,this.strength*H._tempScaledUpdateSpeed,y)},previousItem:null,nextItem:null};H._updateQueueStart?Yn(h,H._updateQueueStart):H._updateQueueStart=h,this.output._storedValue=H}serialize(){const n=super.serialize();return n.strength=this.strength,n}_deserialize(n){super._deserialize(n),this.strength=n.strength}}(0,O.e)([ty("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],BH.prototype,"strength",void 0),(0,i.h)("BABYLON.UpdateFlowMapBlock",BH);(0,i.h)("BABYLON.SphereShapeBlock",class extends xy{constructor(n){super(n),this.registerInput("input",Cy.Particle),this.registerInput("radius",Cy.Float,!0,1),this.registerInput("radiusRange",Cy.Float,!0,1,0,1),this.registerInput("directionRandomizer",Cy.Float,!0,0,0,1),this.registerOutput("output",Cy.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(n){const y=this.input.getConnectedValue(n);y._directionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.directionRandomizer.getConnectedValue(n),h=H.position.Qy(n.emitterPosition).normalize(),k=(0,V.RandomRange)(0,G),i=(0,V.RandomRange)(0,G),B=(0,V.RandomRange)(0,G);h.x+=k,h.y+=i,h.z+=B,h.normalize(),n.isEmitterTransformNode?o.zy.TransformNormalFromFloatsToRef(k,i,B,n.emitterWorldMatrix,H.direction):H.direction.Mi(k,i,B)},y._positionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.radius.getConnectedValue(n),h=this.radiusRange.getConnectedValue(n),k=G-(0,V.RandomRange)(0,G*h),i=(0,V.RandomRange)(0,1),B=(0,V.RandomRange)(0,2*Math.PI),q=Math.acos(2*i-1),b=k*Math.cos(B)*Math.sin(q),A=k*Math.cos(q),U=k*Math.sin(B)*Math.sin(q);n.isEmitterTransformNode?o.zy.TransformCoordinatesFromFloatsToRef(b,A,U,n.emitterWorldMatrix,H.position):(H.position.Mi(b,A,U),H.position.addInPlace(n.emitterPosition))},this.output._storedValue=y}});(0,i.h)("BABYLON.PointShapeBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("direction1",Cy.zy,!0,new o.zy(0,1,0)),this.registerInput("direction2",Cy.zy,!0,new o.zy(0,1,0)),this.registerOutput("output",Cy.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(n){const y=this.particle.getConnectedValue(n);y._directionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.direction1.getConnectedValue(n),h=this.direction2.getConnectedValue(n),k=(0,V.RandomRange)(G.x,h.x),i=(0,V.RandomRange)(G.y,h.y),B=(0,V.RandomRange)(G.z,h.z);n.isEmitterTransformNode?o.zy.TransformNormalFromFloatsToRef(k,i,B,n.emitterWorldMatrix,H.direction):H.direction.Mi(k,i,B)},y._positionCreation.process=H=>{n.systemContext=y,n.isEmitterTransformNode?o.zy.TransformCoordinatesFromFloatsToRef(0,0,0,n.emitterWorldMatrix,H.position):H.position.B(n.emitterPosition)},this.output._storedValue=y}});(0,i.h)("BABYLON.CustomShapeBlock",class extends xy{constructor(n){super(n),this.registerInput("particle",Cy.Particle),this.registerInput("position",Cy.zy,!0,new o.zy(0,0,0)),this.registerInput("direction",Cy.zy,!0,new o.zy(0,1,0)),this.registerOutput("output",Cy.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(n){const y=this.particle.getConnectedValue(n);y._directionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.direction.getConnectedValue(n);n.isEmitterTransformNode?o.zy.TransformNormalToRef(G,n.emitterWorldMatrix,H.direction):H.direction.B(G)},y._positionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.position.getConnectedValue(n);n.isEmitterTransformNode?o.zy.TransformCoordinatesToRef(G,n.emitterWorldMatrix,H.position):(H.position.B(G),H.position.addInPlace(n.emitterPosition))},this.output._storedValue=y}});(0,i.h)("BABYLON.CylinderShapeBlock",class extends xy{constructor(n){super(n),this._tempVector=o.zy.Zero(),this.registerInput("particle",Cy.Particle),this.registerInput("radius",Cy.Float,!0,1),this.registerInput("height",Cy.Float,!0,1,0),this.registerInput("radiusRange",Cy.Float,!0,1,0,1),this.registerInput("directionRandomizer",Cy.Float,!0,0,0,1),this.registerOutput("output",Cy.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(n){const y=this.particle.getConnectedValue(n);y._directionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.directionRandomizer.getConnectedValue(n);H.position.subtractToRef(n.emitterPosition,this._tempVector),this._tempVector.normalize(),n.isEmitterTransformNode&&o.zy.TransformNormalToRef(this._tempVector,n.emitterInverseWorldMatrix,this._tempVector);const h=(0,V.RandomRange)(-G/2,G/2);let k=Math.atan2(this._tempVector.x,this._tempVector.z);k+=(0,V.RandomRange)(-Math.PI/2,Math.PI/2)*G,this._tempVector.y=h,this._tempVector.x=Math.sin(k),this._tempVector.z=Math.cos(k),this._tempVector.normalize(),n.isEmitterTransformNode?o.zy.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,n.emitterWorldMatrix,H.direction):H.direction.B(this._tempVector)},y._positionCreation.process=H=>{n.particleContext=H,n.systemContext=y;const G=this.height.getConnectedValue(n),h=this.radiusRange.getConnectedValue(n),k=this.radius.getConnectedValue(n),i=(0,V.RandomRange)(-G/2,G/2),B=(0,V.RandomRange)(0,2*Math.PI),q=(0,V.RandomRange)((1-h)*(1-h),1),b=Math.sqrt(q)*k,A=b*Math.cos(B),U=b*Math.sin(B);n.isEmitterTransformNode?o.zy.TransformCoordinatesFromFloatsToRef(A,i,U,n.emitterWorldMatrix,H.position):(H.position.Mi(A,i,U),H.position.addInPlace(n.emitterPosition))},this.output._storedValue=y}});class VH extends xy{constructor(n){super(n),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Cy.Particle),this.registerOutput("output",Cy.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){super._build(n);const y=this.particle.getConnectedValue(n);y._isAnimationSheetEnabled=!0,y.spriteCellWidth=this.width,y.spriteCellHeight=this.height,y.startSpriteCellID=this.start,y.endSpriteCellID=this.end,y.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=y}serialize(){const n=super.serialize();return n.width=this.width,n.height=this.height,n.start=this.start,n.end=this.end,n.randomStartCell=this.randomStartCell,n}_deserialize(n){super._deserialize(n),this.width=n.width,this.height=n.height,this.start=n.start,this.end=n.end,this.randomStartCell=n.randomStartCell}}(0,O.e)([ty("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VH.prototype,"start",void 0),(0,O.e)([ty("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VH.prototype,"end",void 0),(0,O.e)([ty("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VH.prototype,"width",void 0),(0,O.e)([ty("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],VH.prototype,"height",void 0),(0,O.e)([ty("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],VH.prototype,"loop",void 0),(0,O.e)([ty("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],VH.prototype,"randomStartCell",void 0),(0,i.h)("BABYLON.SetupSpriteSheetBlock",VH);class qH extends xy{constructor(n){super(n),this.reference=0,this.registerInput("value",Cy.AutoDetect),this.registerOutput("output",Cy.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=n=>{switch(n){case Cy.Float:return Cy.FloatGradient;case Cy.Vector2:return Cy.Vector2Gradient;case Cy.zy:return Cy.Vector3Gradient;case Cy.pi:return Cy.Color4Gradient}return n},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Cy.Float|Cy.Vector2|Cy.zy|Cy.pi)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=n=>null}serialize(){const n=super.serialize();return n.reference=this.reference,n}_deserialize(n){super._deserialize(n),this.reference=n.reference}}(0,O.e)([ty("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],qH.prototype,"reference",void 0),(0,i.h)("BABYLON.ParticleGradientValueBlock",qH);(0,i.h)("BABYLON.ParticleGradientBlock",class extends xy{constructor(n){super(n),this._entryCount=1,this.registerInput("gradient",Cy.Float,!0,1,0,1),this.registerInput("value0",Cy.AutoDetect),this.registerOutput("output",Cy.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=n=>{switch(n){case Cy.FloatGradient:return Cy.Float;case Cy.Vector2Gradient:return Cy.Vector2;case Cy.Vector3Gradient:return Cy.zy;case Cy.Color4Gradient:return Cy.pi}return n},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Cy.FloatGradient|Cy.Vector2Gradient|Cy.Vector3Gradient|Cy.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(n){this._inputs[n].onConnectionObservable.add((()=>{this._entryCount>n||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Cy.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const n=[];for(let H=1;H<this._inputs.length;H++){var y;if(this._inputs[H].isConnected)n.push(null===(y=this._inputs[H].connectedPoint)||void 0===y?void 0:y.ownerBlock)}n.sort(((n,y)=>n.reference-y.reference)),this.output._storedFunction=y=>{const H=this.gradient.getConnectedValue(y);if(1===n.length)return n[0].value.getConnectedValue(y);let G=null;for(let h=n.length-1;h>=0;h--){const i=n[h];if(i.reference<=H){const n=i.value.getConnectedValue(y);if(G){const h=G.value.getConnectedValue(y),B=G.reference,q=i.reference,b=Math.max(0,Math.min(1,(H-q)/(B-q)));switch(this.output.type){case Cy.Float:return(0,V.Lerp)(n,h,b);case Cy.Vector2:return o.Vector2.Lerp(n,h,b);case Cy.zy:return o.zy.Lerp(n,h,b);case Cy.pi:return k.pi.Lerp(n,h,b)}}return n}G=i}return 0}}});(0,i.h)("BABYLON.ParticleConverterBlock",class extends xy{constructor(n){super(n),this.registerInput("color ",Cy.pi,!0),this.registerInput("xyz ",Cy.zy,!0),this.registerInput("xy ",Cy.Vector2,!0),this.registerInput("zw ",Cy.Vector2,!0),this.registerInput("x ",Cy.Float,!0),this.registerInput("y ",Cy.Float,!0),this.registerInput("z ",Cy.Float,!0),this.registerInput("w ",Cy.Float,!0),this.registerOutput("color",Cy.pi),this.registerOutput("xyz",Cy.zy),this.registerOutput("xy",Cy.Vector2),this.registerOutput("zw",Cy.Vector2),this.registerOutput("x",Cy.Float),this.registerOutput("y",Cy.Float),this.registerOutput("z",Cy.Float),this.registerOutput("w",Cy.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(n){return"color "===n?"colorIn":"xyz "===n?"xyzIn":"xy "===n?"xyIn":"zw "===n?"zwIn":"x "===n?"xIn":"y "===n?"yIn":"z "===n?"zIn":"w "===n?"wIn":n}_outputRename(n){switch(n){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return n}}_build(n){super._build(n);const y=this.xIn,H=this.yIn,G=this.zIn,h=this.wIn,i=this.xyIn,B=this.zwIn,V=this.xyzIn,q=this.colorIn,b=this.colorOut,A=this.xyzOut,U=this.xyOut,T=this.zwOut,W=this.xOut,z=this.yOut,Q=this.zOut,l=this.wOut,v=n=>{if(q.isConnected)return q.getConnectedValue(n);let o=0,b=0,A=0,U=0;if(y.isConnected&&(o=y.getConnectedValue(n)),H.isConnected&&(b=H.getConnectedValue(n)),G.isConnected&&(A=G.getConnectedValue(n)),h.isConnected&&(U=h.getConnectedValue(n)),i.isConnected){const y=i.getConnectedValue(n);y&&(o=y.x,b=y.y)}if(B.isConnected){const y=B.getConnectedValue(n);y&&(A=y.x,U=y.y)}if(V.isConnected){const y=V.getConnectedValue(n);y&&(o=y.x,b=y.y,A=y.z)}return new k.pi(o,b,A,U)};b._storedFunction=n=>v(n),A._storedFunction=n=>{const y=v(n);return new o.zy(y.r,y.g,y.b)},U._storedFunction=n=>{const y=v(n);return new o.Vector2(y.r,y.g)},T._storedFunction=n=>{const y=v(n);return new o.Vector2(y.b,y.a)},W._storedFunction=n=>v(n).r,z._storedFunction=n=>v(n).g,Q._storedFunction=n=>v(n).b,l._storedFunction=n=>v(n).a}}),function(n){n[n.Cos=0]="Cos",n[n.Sin=1]="Sin",n[n.Abs=2]="Abs",n[n.Exp=3]="Exp",n[n.Exp2=4]="Exp2",n[n.Round=5]="Round",n[n.Floor=6]="Floor",n[n.Ceiling=7]="Ceiling",n[n.Sqrt=8]="Sqrt",n[n.Log=9]="Log",n[n.Tan=10]="Tan",n[n.ArcTan=11]="ArcTan",n[n.ArcCos=12]="ArcCos",n[n.ArcSin=13]="ArcSin",n[n.Sign=14]="Sign",n[n.Negate=15]="Negate",n[n.OneMinus=16]="OneMinus",n[n.Reciprocal=17]="Reciprocal",n[n.ToDegrees=18]="ToDegrees",n[n.ToRadians=19]="ToRadians",n[n.Fract=20]="Fract"}(sy||(sy={}));class bH extends xy{constructor(n){super(n),this.operation=sy.Cos,this.registerInput("input",Cy.AutoDetect),this.registerOutput("output",Cy.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Cy.Float|Cy.Int|Cy.Vector2|Cy.zy|Cy.pi)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){super._build(n);let y=null;switch(this.operation){case sy.Cos:y=n=>Math.cos(n);break;case sy.Sin:y=n=>Math.sin(n);break;case sy.Abs:y=n=>Math.abs(n);break;case sy.Exp:y=n=>Math.exp(n);break;case sy.Exp2:y=n=>Math.pow(2,n);break;case sy.Round:y=n=>Math.round(n);break;case sy.Floor:y=n=>Math.floor(n);break;case sy.Ceiling:y=n=>Math.ceil(n);break;case sy.Sqrt:y=n=>Math.sqrt(n);break;case sy.Log:y=n=>Math.log(n);break;case sy.Tan:y=n=>Math.tan(n);break;case sy.ArcTan:y=n=>Math.atan(n);break;case sy.ArcCos:y=n=>Math.acos(n);break;case sy.ArcSin:y=n=>Math.asin(n);break;case sy.Sign:y=n=>Math.sign(n);break;case sy.Negate:y=n=>-n;break;case sy.OneMinus:y=n=>1-n;break;case sy.Reciprocal:y=n=>1/n;break;case sy.ToRadians:y=n=>n*Math.PI/180;break;case sy.ToDegrees:y=n=>180*n/Math.PI;break;case sy.Fract:y=n=>n>=0?n-Math.floor(n):n-Math.ceil(n)}if(!y)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Cy.Int:case Cy.Float:this.output._storedFunction=n=>{const H=this.input.getConnectedValue(n);return y(H)};break;case Cy.Vector2:this.output._storedFunction=n=>{const H=this.input.getConnectedValue(n);return new o.Vector2(y(H.x),y(H.y))};break;case Cy.zy:this.output._storedFunction=n=>{const H=this.input.getConnectedValue(n);return new o.zy(y(H.x),y(H.y),y(H.z))};break;case Cy.pi:this.output._storedFunction=n=>{const H=this.input.getConnectedValue(n);return new k.pi(y(H.r),y(H.g),y(H.b),y(H.a))}}return this}serialize(){const n=super.serialize();return n.operation=this.operation,n}_deserialize(n){super._deserialize(n),this.operation=n.operation}}(0,O.e)([ty("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:sy.Cos},{label:"Sin",value:sy.Sin},{label:"Abs",value:sy.Abs},{label:"Exp",value:sy.Exp},{label:"Exp2",value:sy.Exp2},{label:"Round",value:sy.Round},{label:"Floor",value:sy.Floor},{label:"Ceiling",value:sy.Ceiling},{label:"Sqrt",value:sy.Sqrt},{label:"Log",value:sy.Log},{label:"Tan",value:sy.Tan},{label:"ArcTan",value:sy.ArcTan},{label:"ArcCos",value:sy.ArcCos},{label:"ArcSin",value:sy.ArcSin},{label:"Sign",value:sy.Sign},{label:"Negate",value:sy.Negate},{label:"OneMinus",value:sy.OneMinus},{label:"Reciprocal",value:sy.Reciprocal},{label:"ToDegrees",value:sy.ToDegrees},{label:"ToRadians",value:sy.ToRadians},{label:"Fract",value:sy.Fract}]})],bH.prototype,"operation",void 0),(0,i.h)("BABYLON.ParticleTrigonometryBlock",bH);var AH,UH=H(12786);class TH extends xy{constructor(n){super(n),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Cy.AutoDetect),this.registerOutput("output",Cy.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Cy.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Cy.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Cy.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Cy.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Cy.System),this._inputs[0].excludedConnectionPointTypes.push(Cy.Particle),this._inputs[0].excludedConnectionPointTypes.push(Cy.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const y=n=>{const y=this.input.getConnectedValue(n);if(this.log.length>=this.stackSize)return y;if(null===y||void 0===y)return this.log.push(["null",""]),y;switch(this.input.type){case Cy.Vector2:this.log.push([(0,UH.j)(y,4),y.toString()]);break;case Cy.zy:this.log.push([(0,UH.l)(y,4),y.toString()]);break;case Cy.pi:this.log.push([`{R: ${y.r.toFixed(4)} G: ${y.g.toFixed(4)} B: ${y.b.toFixed(4)} A: ${y.a.toFixed(4)}}`,y.toString()]);break;default:this.log.push([y.toString(),y.toString()])}return y};this.output.isConnected?this.output._storedFunction=y:this.output._storedValue=y(n)}serialize(){const n=super.serialize();return n.stackSize=this.stackSize,n}_deserialize(n){super._deserialize(n),this.stackSize=n.stackSize}}(0,O.e)([ty("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],TH.prototype,"stackSize",void 0),(0,i.h)("BABYLON.ParticleDebugBlock",TH);(0,i.h)("BABYLON.ParticleElbowBlock",class extends xy{constructor(n){super(n),this.registerInput("input",Cy.AutoDetect),this.registerOutput("output",Cy.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(n){super._build(n);const y=this._outputs[0],H=this._inputs[0];y._storedFunction=n=>H.getConnectedValue(n)}});(0,i.h)("BABYLON.ParticleTeleportInBlock",class extends xy{get endpoints(){return this._endpoints}constructor(n){super(n),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Cy.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(n){if(this.getClassName()===n)return!0;for(const y of this.endpoints)if(y.isAnAncestorOfType(n))return!0;return!1}isAnAncestorOf(n){for(const y of this.endpoints){if(y===n)return!0;if(y.isAnAncestorOf(n))return!0}return!1}attachToEndpoint(n){n.detach(),this._endpoints.push(n),n._entryPoint=this,n._outputs[0]._typeConnectionSource=this._inputs[0],n._tempEntryPointUniqueId=null,n.name="> "+this.name}detachFromEndpoint(n){const y=this._endpoints.indexOf(n);-1!==y&&(this._endpoints.splice(y,1),n._outputs[0]._typeConnectionSource=null,n._entryPoint=null)}_build(){for(const n of this._endpoints)n.output._storedFunction=n=>this.input.getConnectedValue(n)}});(0,i.h)("BABYLON.ParticleTeleportOutBlock",class extends xy{constructor(n){super(n),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Cy.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(n){this.entryPoint&&this.entryPoint.build(n)}clone(){const n=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(n),n}serialize(){var n;const y=super.serialize();return y.entryPoint=(null===(n=this.entryPoint)||void 0===n?void 0:n.uniqueId)??"",y}_deserialize(n){super._deserialize(n),this._tempEntryPointUniqueId=n.entryPoint}}),function(n){n[n.Equal=0]="Equal",n[n.NotEqual=1]="NotEqual",n[n.LessThan=2]="LessThan",n[n.GreaterThan=3]="GreaterThan",n[n.LessOrEqual=4]="LessOrEqual",n[n.GreaterOrEqual=5]="GreaterOrEqual",n[n.Xor=6]="Xor",n[n.Or=7]="Or",n[n.And=8]="And"}(AH||(AH={}));class WH extends xy{constructor(n){super(n),this.test=AH.Equal,this.epsilon=0,this.registerInput("left",Cy.Float),this.registerInput("right",Cy.Float,!0,0),this.registerInput("ifTrue",Cy.AutoDetect,!0,1),this.registerInput("ifFalse",Cy.AutoDetect,!0,0),this.registerOutput("output",Cy.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Cy.Float,this._inputs[0].acceptedConnectionPointTypes.push(Cy.Int),this._inputs[1].acceptedConnectionPointTypes.push(Cy.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const n=n=>{const y=this.left.getConnectedValue(n),H=this.right.getConnectedValue(n);let o=!1;switch(this.test){case AH.Equal:o=(0,V.WithinEpsilon)(y,H,this.epsilon);break;case AH.NotEqual:o=!(0,V.WithinEpsilon)(y,H,this.epsilon);break;case AH.LessThan:o=y<H+this.epsilon;break;case AH.GreaterThan:o=y>H-this.epsilon;break;case AH.LessOrEqual:o=y<=H+this.epsilon;break;case AH.GreaterOrEqual:o=y>=H-this.epsilon;break;case AH.Xor:o=!!y&&!H||!y&&!!H;break;case AH.Or:o=!!y||!!H;break;case AH.And:o=!!y&&!!H}return o};this.output._storedFunction=y=>n(y)?this.ifTrue.getConnectedValue(y):this.ifFalse.getConnectedValue(y)}serialize(){const n=super.serialize();return n.test=this.test,n.epsilon=this.epsilon,n}_deserialize(n){super._deserialize(n),this.test=n.test,void 0!==n.epsilon&&(this.epsilon=n.epsilon)}}(0,O.e)([ty("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:AH.Equal},{label:"NotEqual",value:AH.NotEqual},{label:"LessThan",value:AH.LessThan},{label:"GreaterThan",value:AH.GreaterThan},{label:"LessOrEqual",value:AH.LessOrEqual},{label:"GreaterOrEqual",value:AH.GreaterOrEqual},{label:"Xor",value:AH.Xor},{label:"Or",value:AH.Or},{label:"And",value:AH.And}]})],WH.prototype,"test",void 0),(0,O.e)([ty("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WH.prototype,"epsilon",void 0),(0,i.h)("BABYLON.ParticleConditionBlock",WH);class zH extends xy{constructor(n){super(n),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Cy.Particle),this.registerInput("condition",Cy.Float,!0,0),this.registerInput("system",Cy.System),this.registerOutput("output",Cy.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(n){this._triggerCount=0;const y=this.input.getConnectedValue(n),H={process:H=>{if(n.particleContext=H,n.systemContext=y,0!==this.condition.getConnectedValue(n)&&(0===this.limit||this._triggerCount<this.limit)){const o=(new Date).getTime();if(this._previousOne&&o-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=o;const G=this.system.getConnectedValue(n);if(G){const o=Ly(G,n.ly,H.position);o.ah.addOnce((()=>{this._triggerCount--})),y.ah.addOnce((()=>{o.dispose()}))}}},previousItem:null,nextItem:null};y._updateQueueStart?Yn(H,y._updateQueueStart):y._updateQueueStart=H,this.output._storedValue=y}serialize(){const n=super.serialize();return n.limit=this.limit,n.delay=this.delay,n}_deserialize(n){super._deserialize(n),void 0!==n.limit&&(this.limit=n.limit),void 0!==n.delay&&(this.delay=n.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,O.e)([ty("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zH.prototype,"limit",void 0),(0,O.e)([ty("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],zH.prototype,"delay",void 0),(0,i.h)("BABYLON.ParticleTriggerBlock",zH);H(12792),H(12810),H(12824),H(12875)},12859:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneFragment",h="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12830:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneFragmentDeclaration",h="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12883:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneVertex",h="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12877:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneVertexDeclaration",h="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12870:(n,y,H)=>{"use strict";var o=H(11202);const G="fogFragment",h="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12850:(n,y,H)=>{"use strict";var o=H(11202);const G="fogFragmentDeclaration",h="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12888:(n,y,H)=>{"use strict";var o=H(11202);const G="fogVertex",h="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12880:(n,y,H)=>{"use strict";var o=H(11202);const G="fogVertexDeclaration",h="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12842:(n,y,H)=>{"use strict";var o=H(11202);const G="helperFunctions",h="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12833:(n,y,H)=>{"use strict";var o=H(11202);const G="imageProcessingDeclaration",h="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12847:(n,y,H)=>{"use strict";var o=H(11202);const G="imageProcessingFunctions",h="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12839:(n,y,H)=>{"use strict";var o=H(11202);const G="logDepthDeclaration",h="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12863:(n,y,H)=>{"use strict";var o=H(11202);const G="logDepthFragment",h="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12895:(n,y,H)=>{"use strict";var o=H(11202);const G="logDepthVertex",h="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";o.e.IncludesShadersStoreWGSL[G]||(o.e.IncludesShadersStoreWGSL[G]=h)},12824:(n,y,H)=>{"use strict";H.r(y),H.d(y,{particlesPixelShaderWGSL:()=>k});var o=H(11202);H(12830),H(12833),H(12839),H(12842),H(12847),H(12850),H(12859),H(12863),H(12870);const G="particlesPixelShader",h="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.e.ShadersStoreWGSL[G]||(o.e.ShadersStoreWGSL[G]=h);const k={name:G,shader:h}},12875:(n,y,H)=>{"use strict";H.r(y),H.d(y,{particlesVertexShaderWGSL:()=>k});var o=H(11202);H(12877),H(12880),H(12839),H(12883),H(12888),H(12895);const G="particlesVertexShader",h="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.e.ShadersStoreWGSL[G]||(o.e.ShadersStoreWGSL[G]=h);const k={name:G,shader:h}},12726:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneFragment",h="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12801:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneFragmentDeclaration",h="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12748:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneVertex",h="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12815:(n,y,H)=>{"use strict";var o=H(11202);const G="clipPlaneVertexDeclaration",h="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12738:(n,y,H)=>{"use strict";var o=H(11202);const G="fogFragment",h="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12720:(n,y,H)=>{"use strict";var o=H(11202);const G="fogFragmentDeclaration",h="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12755:(n,y,H)=>{"use strict";var o=H(11202);const G="fogVertex",h="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12740:(n,y,H)=>{"use strict";var o=H(11202);const G="fogVertexDeclaration",h="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12706:(n,y,H)=>{"use strict";var o=H(11202);const G="helperFunctions",h="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12693:(n,y,H)=>{"use strict";var o=H(11202);const G="imageProcessingDeclaration",h="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12713:(n,y,H)=>{"use strict";var o=H(11202);const G="imageProcessingFunctions",h="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12698:(n,y,H)=>{"use strict";var o=H(11202);const G="logDepthDeclaration",h="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12730:(n,y,H)=>{"use strict";var o=H(11202);const G="logDepthFragment",h="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12758:(n,y,H)=>{"use strict";var o=H(11202);const G="logDepthVertex",h="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";o.e.IncludesShadersStore[G]||(o.e.IncludesShadersStore[G]=h)},12792:(n,y,H)=>{"use strict";H.r(y),H.d(y,{particlesPixelShader:()=>k});var o=H(11202);H(12801),H(12693),H(12698),H(12706),H(12713),H(12720),H(12726),H(12730),H(12738);const G="particlesPixelShader",h="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";o.e.ShadersStore[G]||(o.e.ShadersStore[G]=h);const k={name:G,shader:h}},12810:(n,y,H)=>{"use strict";H.r(y),H.d(y,{particlesVertexShader:()=>k});var o=H(11202);H(12815),H(12740),H(12698),H(12748),H(12755),H(12758);const G="particlesVertexShader",h="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";o.e.ShadersStore[G]||(o.e.ShadersStore[G]=h);const k={name:G,shader:h}},13169:(n,y,H)=>{"use strict";H.r(y),H.d(y,{FlowGraphGLTFDataProvider:()=>h});var o=H(13146),G=H(13117);class h extends o.c{constructor(n){var y,H;super();const o=n.glTF,h=(null===(y=o.animations)||void 0===y?void 0:y.map((n=>n._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",G.c,h);const k=(null===(H=o.nodes)||void 0===H?void 0:H.map((n=>n._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",G.c,k)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13059:(n,y,H)=>{"use strict";H.d(y,{b:()=>z,d:()=>T,g:()=>U,i:()=>W});var o=H(11288),G=H(11839),h=H(11335),k=H(13065);const i=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class B{constructor(n,y){this._gltf=n,this._infoTree=y}convert(n){let y,H=this._gltf,o=this._infoTree;if(!n.startsWith("/"))throw new Error("Path must start with a /");const G=n.split("/");if(G.shift(),G[G.length-1].includes(".length")){const n=G[G.length-1].split(".");G.pop(),G.push(...n)}let h=!1;for(const B of G){const G="length"===B;if(G&&!o.__array__)throw new Error(`Path ${n} is invalid`);if(o.__ignoreObjectTree__&&(h=!0),o.__array__&&!G)o=o.__array__;else if(o=o[B],!o)throw new Error(`Path ${n} is invalid`);if(!h)if(void 0===H){if(!i.find((y=>y.regex.test(n))))throw new Error(`Path ${n} is invalid`)}else if(!G){var k;H=null===(k=H)||void 0===k?void 0:k[B]}(o.__target__||G)&&(y=H)}return{object:y,info:o}}}function V(n,y,H,o){const G=q(n,y);return o?G[H][o]:G[H]}function q(n,y,H){var o,h;return null===(o=n._data)||void 0===o||null===(h=o[(null===H||void 0===H?void 0:H.fillMode)??G.b.MATERIAL_TriangleFillMode])||void 0===h?void 0:h.babylonMaterial}function b(n,y){return{offset:{componentsCount:2,type:"Vector2",get:(H,G,h)=>{const k=V(H,h,n,y);return new o.Vector2(null===k||void 0===k?void 0:k.uOffset,null===k||void 0===k?void 0:k.vOffset)},getTarget:q,set:(H,o,G,h)=>{const k=V(o,h,n,y);k.uOffset=H.x,k.vOffset=H.y},getPropertyName:[()=>`${n}${y?"."+y:""}.uOffset`,()=>`${n}${y?"."+y:""}.vOffset`]},rotation:{type:"number",get:(H,o,G)=>{var h;return null===(h=V(H,G,n,y))||void 0===h?void 0:h.wAng},getTarget:q,set:(H,o,G,h)=>V(o,h,n,y).wAng=H,getPropertyName:[()=>`${n}${y?"."+y:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(H,G,h)=>{const k=V(H,h,n,y);return new o.Vector2(null===k||void 0===k?void 0:k.uScale,null===k||void 0===k?void 0:k.vScale)},getTarget:q,set:(H,o,G,h)=>{const k=V(o,h,n,y);k.uScale=H.x,k.vScale=H.y},getPropertyName:[()=>`${n}${y?"."+y:""}.uScale`,()=>`${n}${y?"."+y:""}.vScale`]}}}const A={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:n=>{var y,H;return new o.Vector2((null===(y=n._babylonCamera)||void 0===y?void 0:y.orthoLeft)??0,(null===(H=n._babylonCamera)||void 0===H?void 0:H.orthoRight)??0)},set:(n,y)=>{y._babylonCamera&&(y._babylonCamera.orthoLeft=n.x,y._babylonCamera.orthoRight=n.y)},getTarget:n=>n,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:n=>{var y,H;return new o.Vector2((null===(y=n._babylonCamera)||void 0===y?void 0:y.orthoBottom)??0,(null===(H=n._babylonCamera)||void 0===H?void 0:H.orthoTop)??0)},set:(n,y)=>{y._babylonCamera&&(y._babylonCamera.orthoBottom=n.x,y._babylonCamera.orthoTop=n.y)},getTarget:n=>n,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:n=>{var y;return null===(y=n._babylonCamera)||void 0===y?void 0:y.maxZ},set:(n,y)=>{y._babylonCamera&&(y._babylonCamera.maxZ=n)},getTarget:n=>n,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:n=>{var y;return null===(y=n._babylonCamera)||void 0===y?void 0:y.Wi},set:(n,y)=>{y._babylonCamera&&(y._babylonCamera.Wi=n)},getTarget:n=>n,getPropertyName:[()=>"Wi"]}},perspective:{aspectRatio:{type:"number",get:n=>{var y;return null===(y=n._babylonCamera)||void 0===y?void 0:y.getEngine().getAspectRatio(n._babylonCamera)},getTarget:n=>n,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:n=>{var y;return null===(y=n._babylonCamera)||void 0===y?void 0:y.fov},set:(n,y)=>{y._babylonCamera&&(y._babylonCamera.fov=n)},getTarget:n=>n,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:n=>{var y;return null===(y=n._babylonCamera)||void 0===y?void 0:y.maxZ},set:(n,y)=>{y._babylonCamera&&(y._babylonCamera.maxZ=n)},getTarget:n=>n,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:n=>{var y;return null===(y=n._babylonCamera)||void 0===y?void 0:y.Wi},set:(n,y)=>{y._babylonCamera&&(y._babylonCamera.Wi=n)},getTarget:n=>n,getPropertyName:[()=>"Wi"]}}}},nodes:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"zy",get:n=>{var y;return null===(y=n._babylonTransformNode)||void 0===y?void 0:y.position},set:(n,y)=>{var H;return null===(H=y._babylonTransformNode)||void 0===H?void 0:H.position.B(n)},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:n=>{var y;return null===(y=n._babylonTransformNode)||void 0===y?void 0:y.rotationQuaternion},set:(n,y)=>{var H,o;return null===(H=y._babylonTransformNode)||void 0===H||null===(o=H.rotationQuaternion)||void 0===o?void 0:o.B(n)},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"zy",get:n=>{var y;return null===(y=n._babylonTransformNode)||void 0===y?void 0:y.fi},set:(n,y)=>{var H;return null===(H=y._babylonTransformNode)||void 0===H?void 0:H.fi.B(n)},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"fi"]},weights:{length:{type:"number",get:n=>n._numMorphTargets,getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(n,y)=>{var H,o;return void 0!==y?null===(H=n._primitiveBabylonMeshes)||void 0===H||null===(o=H[0].morphTargetManager)||void 0===o?void 0:o.getTarget(y).influence:void 0},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(n,y)=>[0],getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:n=>{var y,H,G;return o.Matrix.Compose(null===(y=n._babylonTransformNode)||void 0===y?void 0:y.fi,null===(H=n._babylonTransformNode)||void 0===H?void 0:H.rotationQuaternion,null===(G=n._babylonTransformNode)||void 0===G?void 0:G.position)},getTarget:n=>n._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:n=>{var y,H,G,h;const k=o.Matrix.Identity();let i=n.parent;for(;i&&i.parent;)i=i.parent;const B=(null===(y=n._babylonTransformNode)||void 0===y?void 0:y.position._isDirty)||(null===(H=n._babylonTransformNode)||void 0===H||null===(G=H.rotationQuaternion)||void 0===G?void 0:G._isDirty)||(null===(h=n._babylonTransformNode)||void 0===h?void 0:h.fi._isDirty);if(i){var V;const y=null===(V=i._babylonTransformNode)||void 0===V?void 0:V.Qi(!0).invert();var q,b;if(y)null===(q=n._babylonTransformNode)||void 0===q||null===(b=q.Qi(B))||void 0===b||b.multiplyToRef(y,k)}else n._babylonTransformNode&&k.B(n._babylonTransformNode.Qi(B));return k},getTarget:n=>n._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:n=>{var y,H;return null===(y=n._babylonTransformNode)||void 0===y||null===(H=y.getChildren((n=>n instanceof k.b),!0)[0])||void 0===H?void 0:H.di},getTarget:n=>{var y;return null===(y=n._babylonTransformNode)||void 0===y?void 0:y.getChildren((n=>n instanceof k.b),!0)[0]},set:(n,y)=>{if(y._babylonTransformNode){const H=y._babylonTransformNode.getChildren((n=>n instanceof k.b),!0)[0];H&&(H.di=n)}}},color:{type:"Fy",get:n=>{var y,H;return null===(y=n._babylonTransformNode)||void 0===y||null===(H=y.getChildren((n=>n instanceof k.b),!0)[0])||void 0===H?void 0:H.ai},getTarget:n=>{var y;return null===(y=n._babylonTransformNode)||void 0===y?void 0:y.getChildren((n=>n instanceof k.b),!0)[0]},set:(n,y)=>{if(y._babylonTransformNode){const H=y._babylonTransformNode.getChildren((n=>n instanceof k.b),!0)[0];H&&(H.ai=n)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Fy",get:(n,y,H)=>q(n,y,H).emissiveColor,set:(n,y,H,o)=>q(y,H,o).emissiveColor.B(n),getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:b("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(n,y,H)=>{var o;return null===(o=V(n,H,"bumpTexture"))||void 0===o?void 0:o.level},set:(n,y,H,o)=>{const G=V(y,o,"bumpTexture");G&&(G.level=n)},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:b("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(n,y,H)=>q(n,y,H).ambientTextureStrength,set:(n,y,H,o)=>{const G=q(y,H,o);G&&(G.ambientTextureStrength=n)},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:b("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"pi",get:(n,y,H)=>{const o=q(n,y,H);return h.pi.FromColor3(o.albedoColor,o.alpha)},set:(n,y,H,o)=>{const G=q(y,H,o);G.albedoColor.set(n.r,n.g,n.b),G.alpha=n.a},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:b("albedoTexture")}},metallicFactor:{type:"number",get:(n,y,H)=>q(n,y,H).metallic,set:(n,y,H,o)=>{const G=q(y,H,o);G&&(G.metallic=n)},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(n,y,H)=>q(n,y,H).roughness,set:(n,y,H,o)=>{const G=q(y,H,o);G&&(G.roughness=n)},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:b("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(n,y,H)=>q(n,y,H).anisotropy.di,set:(n,y,H,o)=>{q(y,H,o).anisotropy.di=n},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(n,y,H)=>q(n,y,H).anisotropy.angle,set:(n,y,H,o)=>{q(y,H,o).anisotropy.angle=n},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:b("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(n,y,H)=>q(n,y,H).clearCoat.di,set:(n,y,H,o)=>{q(y,H,o).clearCoat.di=n},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(n,y,H)=>q(n,y,H).clearCoat.roughness,set:(n,y,H,o)=>{q(y,H,o).clearCoat.roughness=n},getTarget:(n,y,H)=>q(n,y,H),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:b("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(n,y,H)=>{var o;return null===(o=q(n,y,H).clearCoat.bumpTexture)||void 0===o?void 0:o.level},getTarget:q,set:(n,y,H,o)=>q(y,H,o).clearCoat.bumpTexture.level=n},extensions:{KHR_texture_transform:b("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:b("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(n,y,H)=>q(n,y,H).subSurface.dispersion,getTarget:q,set:(n,y,H,o)=>q(y,H,o).subSurface.dispersion=n}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(n,y,H)=>q(n,y,H).emissiveIntensity,getTarget:q,set:(n,y,H,o)=>q(y,H,o).emissiveIntensity=n}},KHR_materials_ior:{ior:{type:"number",get:(n,y,H)=>q(n,y,H).indexOfRefraction,getTarget:q,set:(n,y,H,o)=>q(y,H,o).indexOfRefraction=n}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(n,y,H)=>q(n,y,H).iridescence.di,getTarget:q,set:(n,y,H,o)=>q(y,H,o).iridescence.di=n},iridescenceIor:{type:"number",get:(n,y,H)=>q(n,y,H).iridescence.indexOfRefraction,getTarget:q,set:(n,y,H,o)=>q(y,H,o).iridescence.indexOfRefraction=n},iridescenceTexture:{extensions:{KHR_texture_transform:b("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(n,y,H)=>q(n,y,H).iridescence.maximumThickness,getTarget:q,set:(n,y,H,o)=>q(y,H,o).iridescence.maximumThickness=n},iridescenceThicknessMinimum:{type:"number",get:(n,y,H)=>q(n,y,H).iridescence.minimumThickness,getTarget:q,set:(n,y,H,o)=>q(y,H,o).iridescence.minimumThickness=n},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:b("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Fy",get:(n,y,H)=>q(n,y,H).sheen.color,getTarget:q,set:(n,y,H,o)=>q(y,H,o).sheen.color.B(n)},sheenColorTexture:{extensions:{KHR_texture_transform:b("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(n,y,H)=>q(n,y,H).sheen.di,getTarget:q,set:(n,y,H,o)=>q(y,H,o).sheen.di=n},sheenRoughnessTexture:{extensions:{KHR_texture_transform:b("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(n,y,H)=>q(n,y,H).metallicF0Factor,getTarget:q,set:(n,y,H,o)=>q(y,H,o).metallicF0Factor=n,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Fy",get:(n,y,H)=>q(n,y,H).metallicReflectanceColor,getTarget:q,set:(n,y,H,o)=>q(y,H,o).metallicReflectanceColor.B(n),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:b("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:b("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(n,y,H)=>q(n,y,H).subSurface.refractionIntensity,getTarget:q,set:(n,y,H,o)=>q(y,H,o).subSurface.refractionIntensity=n,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:b("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(n,y,H)=>q(n,y,H).subSurface.translucencyIntensity,getTarget:q,set:(n,y,H,o)=>q(y,H,o).subSurface.translucencyIntensity=n},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:b("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Fy",get:(n,y,H)=>q(n,y,H).subSurface.translucencyColor,getTarget:q,set:(n,y,H,o)=>{var G;return n&&(null===(G=q(y,H,o).subSurface.translucencyColor)||void 0===G?void 0:G.B(n))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:b("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Fy",get:(n,y,H)=>q(n,y,H).subSurface.tintColor,getTarget:q,set:(n,y,H,o)=>q(y,H,o).subSurface.tintColor.B(n)},attenuationDistance:{type:"number",get:(n,y,H)=>q(n,y,H).subSurface.tintColorAtDistance,getTarget:q,set:(n,y,H,o)=>q(y,H,o).subSurface.tintColorAtDistance=n},thicknessFactor:{type:"number",get:(n,y,H)=>q(n,y,H).subSurface.maximumThickness,getTarget:q,set:(n,y,H,o)=>q(y,H,o).subSurface.maximumThickness=n},thicknessTexture:{extensions:{KHR_texture_transform:b("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonLight)),getPropertyName:[n=>"length"]},__array__:{__target__:!0,color:{type:"Fy",get:n=>{var y;return null===(y=n._babylonLight)||void 0===y?void 0:y.ai},set:(n,y)=>{var H;return null===(H=y._babylonLight)||void 0===H?void 0:H.ai.B(n)},getTarget:n=>n._babylonLight,getPropertyName:[n=>"diffuse"]},di:{type:"number",get:n=>{var y;return null===(y=n._babylonLight)||void 0===y?void 0:y.di},set:(n,y)=>y._babylonLight?y._babylonLight.di=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"intensity"]},range:{type:"number",get:n=>{var y;return null===(y=n._babylonLight)||void 0===y?void 0:y.range},set:(n,y)=>y._babylonLight?y._babylonLight.range=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"range"]},spot:{innerConeAngle:{type:"number",get:n=>{var y;return null===(y=n._babylonLight)||void 0===y?void 0:y.innerAngle},set:(n,y)=>y._babylonLight?y._babylonLight.innerAngle=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"innerConeAngle"]},outerConeAngle:{type:"number",get:n=>{var y;return null===(y=n._babylonLight)||void 0===y?void 0:y.angle},set:(n,y)=>y._babylonLight?y._babylonLight.angle=n:void 0,getTarget:n=>n._babylonLight,getPropertyName:[n=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonLight)),getPropertyName:[n=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonTexture)),getPropertyName:[n=>"length"]},__array__:{__target__:!0,di:{type:"number",get:n=>{var y;return null===(y=n._babylonTexture)||void 0===y?void 0:y.level},set:(n,y)=>{y._babylonTexture&&(y._babylonTexture.level=n)},getTarget:n=>n._babylonTexture},rotation:{type:"Quaternion",get:n=>{var y;return n._babylonTexture&&o.Quaternion.FromRotationMatrix(null===(y=n._babylonTexture)||void 0===y?void 0:y.getReflectionTextureMatrix())},set:(n,y)=>{var H;y._babylonTexture&&(null!==(H=y._babylonTexture.pn())&&void 0!==H&&H.useRightHandedSystem||(n=o.Quaternion.Inverse(n)),o.Matrix.FromQuaternionToRef(n,y._babylonTexture.getReflectionTextureMatrix()))},getTarget:n=>n._babylonTexture}}}}},animations:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>n._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:n=>n.length,getTarget:n=>n.map((n=>{var y;return null===(y=n.primitives[0]._instanceData)||void 0===y?void 0:y.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function U(n){return new B(n,A)}function T(n){const y=n.split("/").map((n=>n.replace(/{}/g,"__array__")));let H=A;for(const o of y)o&&(H=H[o]);if(H&&H.type&&H.get)return H}function W(n,y){const H=n.split("/").map((n=>n.replace(/{}/g,"__array__")));let o=A;for(const G of H)G&&(o=o[G]);o&&o.type&&o.get&&(o.interpolation=y)}function z(n,y){const H=n.split("/").map((n=>n.replace(/{}/g,"__array__")));let o=A;for(const G of H)if(G){if(!o[G]){if("?"===G){o.__ignoreObjectTree__=!0;continue}o[G]={},"__array__"===G&&(o[G].__target__=!0)}o=o[G]}Object.assign(o,y)}},13069:(n,y,H)=>{"use strict";H.r(y),H.d(y,{AnimationPropertyInfo:()=>V,TransformNodeAnimationPropertyInfo:()=>q,WeightAnimationPropertyInfo:()=>b,getQuaternion:()=>i,getVector3:()=>k,getWeights:()=>B});var o=H(11885),G=H(11288),h=H(13059);function k(n,y,H,o){return G.zy.gy(y,H).scaleInPlace(o)}function i(n,y,H,o){return G.Quaternion.gy(y,H).scaleInPlace(o)}function B(n,y,H,o){const G=new Array(n._numMorphTargets);for(let h=0;h<G.length;h++)G[h]=y[H++]*o;return G}class V{constructor(n,y,H,o){this.type=n,this.name=y,this.getValue=H,this.getStride=o}_buildAnimation(n,y,H){const G=new o.e(n,this.name,y,this.type);return G.setKeys(H),G}}class q extends V{buildAnimations(n,y,H,o){const G=[];return G.push({babylonAnimatable:n._babylonTransformNode,babylonAnimation:this._buildAnimation(y,H,o)}),G}}class b extends V{buildAnimations(n,y,H,G){const h=[];if(n._numMorphTargets)for(let k=0;k<n._numMorphTargets;k++){const i=new o.e(`${y}_${k}`,this.name,H,this.type);if(i.setKeys(G.map((n=>({frame:n.frame,inTangent:n.inTangent?n.inTangent[k]:void 0,value:n.value[k],outTangent:n.outTangent?n.outTangent[k]:void 0,interpolation:n.interpolation})))),n._primitiveBabylonMeshes)for(const y of n._primitiveBabylonMeshes)if(y.morphTargetManager){const n=y.morphTargetManager.getTarget(k),H=i.clone();n.animations.push(H),h.push({babylonAnimatable:n,babylonAnimation:H})}}return h}}(0,h.i)("/nodes/{}/translation",[new q(o.e.ANIMATIONTYPE_VECTOR3,"position",k,(()=>3))]),(0,h.i)("/nodes/{}/rotation",[new q(o.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",i,(()=>4))]),(0,h.i)("/nodes/{}/scale",[new q(o.e.ANIMATIONTYPE_VECTOR3,"fi",k,(()=>3))]),(0,h.i)("/nodes/{}/weights",[new b(o.e.ANIMATIONTYPE_FLOAT,"influence",B,(n=>n._numMorphTargets))])},13019:(n,y,H)=>{"use strict";class o{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((n,y)=>{this._resolve=n,this._reject=y}))}}var G=H(11288),h=H(11335),k=H(11094),i=H(11806),B=H(13028),V=H(13034),q=H(11099),b=H(11831),A=H(11885),U=H(11892),T=H(11149),W=H(11114),z=H(11118);class Q{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(n){this._useTextureToStoreBoneMatrices=n,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(n){this._animationPropertiesOverride=n}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(n,y,H){this.name=n,this.id=y,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=G.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new q.c,this.bones=[],this._scene=H||T.c.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const o=this._scene.getEngine().getCaps();this._canUseTextureForBones=o.textureFloat&&o.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((n=>!n.getParent()))}getTransformMatrices(n){if(this.needInitialSkinMatrix){if(!n)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return n._bonesTransformMatrices||this.prepare(!0),n._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(n){return this.needInitialSkinMatrix&&n._transformMatrixTexture?n._transformMatrixTexture:this._transformMatrixTexture}pn(){return this._scene}toString(n){let y=`Name: ${this.name}, nBones: ${this.bones.length}`;if(y+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,n){y+=", Ranges: {";let n=!0;for(const H in this._ranges)n&&(y+=", ",n=!1),y+=H;y+="}"}return y}getBoneIndexByName(n){for(let y=0,H=this.bones.length;y<H;y++)if(this.bones[y].name===n)return y;return-1}createAnimationRange(n,y,H){if(!this._ranges[n]){this._ranges[n]=new U.c(n,y,H);for(let o=0,G=this.bones.length;o<G;o++)this.bones[o].animations[0]&&this.bones[o].animations[0].createRange(n,y,H)}}deleteAnimationRange(n){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let H=0,o=this.bones.length;H<o;H++)this.bones[H].animations[0]&&this.bones[H].animations[0].deleteRange(n,y);this._ranges[n]=null}getAnimationRange(n){return this._ranges[n]||null}getAnimationRanges(){const n=[];let y;for(y in this._ranges)n.push(this._ranges[y]);return n}copyAnimationRange(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[y]||!n.getAnimationRange(y))return!1;let o=!0;const G=this._getHighestAnimationFrame()+1,h={},k=n.bones;let i,B;for(B=0,i=k.length;B<i;B++)h[k[B].name]=k[B];this.bones.length!==k.length&&(W.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${k.length}`),o=!1);const V=H&&this.dimensionsAtRest&&n.dimensionsAtRest?this.dimensionsAtRest.divide(n.dimensionsAtRest):null;for(B=0,i=this.bones.length;B<i;B++){const n=this.bones[B].name,k=h[n];k?o=o&&this.bones[B].copyAnimationRange(k,y,G,H,V):(W.d.Warn("copyAnimationRange: not same rig, missing source bone "+n),o=!1)}const q=n.getAnimationRange(y);return q&&(this._ranges[y]=new U.c(y,q.from+G,q.to+G)),o}returnToRest(){for(const n of this.bones)-1!==n._index&&n.returnToRest()}_getHighestAnimationFrame(){let n=0;for(let y=0,H=this.bones.length;y<H;y++)if(this.bones[y].animations[0]){const H=this.bones[y].animations[0].getHighestFrame();n<H&&(n=H)}return n}beginAnimation(n,y,H,o){const G=this.getAnimationRange(n);return G?this._scene.beginAnimation(this,G.from,G.to,y,H,o):null}static MakeAnimationAdditive(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,H=arguments.length>2?arguments[2]:void 0;const o=n.getAnimationRange(H);if(!o)return null;const G=n._scene.getAllAnimatablesByTarget(n);let h=null;for(let i=0;i<G.length;i++){const n=G[i];if(n.fromFrame===(null===o||void 0===o?void 0:o.from)&&n.toFrame===(null===o||void 0===o?void 0:o.to)){h=n;break}}const k=n.getAnimatables();for(let i=0;i<k.length;i++){const n=k[i].animations;if(n)for(let o=0;o<n.length;o++)A.e.MakeAnimationAdditive(n[o],y,H)}return h&&(h.isAdditive=!0),n}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(n){this._meshesWithPoseMatrix.push(n)}_unregisterMeshWithPoseMatrix(n){const y=this._meshesWithPoseMatrix.indexOf(n);y>-1&&this._meshesWithPoseMatrix.splice(y,1)}_computeTransformMatrices(n,y){this.onBeforeComputeObservable.notifyObservers(this);for(let H=0;H<this.bones.length;H++){const o=this.bones[H];o._childUpdateId++;const G=o.getParent();if(G?o.getLocalMatrix().multiplyToRef(G.getFinalMatrix(),o.getFinalMatrix()):y?o.getLocalMatrix().multiplyToRef(y,o.getFinalMatrix()):o.getFinalMatrix().B(o.getLocalMatrix()),-1!==o._index){const y=null===o._index?H:o._index;o.getAbsoluteInverseBindMatrix().multiplyToArray(o.getFinalMatrix(),n,16*y)}}this._identity.copyToArray(n,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const n=this.pn().getRenderId();if(this._currentRenderId===n)return;this._currentRenderId=n}if(this._numBonesWithLinkedTransformNode>0)for(const n of this.bones)if(n._linkedTransformNode){const y=n._linkedTransformNode;n.position=y.position,y.rotationQuaternion?n.rotationQuaternion=y.rotationQuaternion:n.rotation=y.rotation,n.fi=y.fi}if(this.needInitialSkinMatrix)for(const n of this._meshesWithPoseMatrix){const y=n.getPoseMatrix();let H=this._isDirty;if(n._bonesTransformMatrices&&n._bonesTransformMatrices.length===16*(this.bones.length+1)||(n._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),H=!0),H){if(this._synchronizedWithMesh!==n){this._synchronizedWithMesh=n;for(const n of this.bones)if(!n.getParent()){n.getBindMatrix().multiplyToRef(y,G.TmpVectors.Matrix[1]),n._updateAbsoluteBindMatrices(G.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const y=4*(this.bones.length+1);n._transformMatrixTexture&&n._transformMatrixTexture.getSize().width===y||(n._transformMatrixTexture&&n._transformMatrixTexture.dispose(),n._transformMatrixTexture=b.b.CreateRGBATexture(n._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(n._bonesTransformMatrices,y),this.isUsingTextureForMatrices&&n._transformMatrixTexture&&n._transformMatrixTexture.update(n._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=b.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let n=0;n<this.bones.length;n++)this._animatables.push(this.bones[n])}return this._animatables}clone(n,y){const H=new Q(n,y||n,this._scene);H.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let o=0;o<this.bones.length;o++){const n=this.bones[o];let y=null;const G=n.getParent();if(G){const n=this.bones.indexOf(G);y=H.bones[n]}const h=new V.d(n.name,H,y,n.getBindMatrix().clone(),n.getRestMatrix().clone());h._index=n._index,n._linkedTransformNode&&h.linkTransformNode(n._linkedTransformNode),z.c.DeepCopy(n.animations,h.animations)}if(this._ranges){H._ranges={};for(const n in this._ranges){const y=this._ranges[n];y&&(H._ranges[n]=y.clone())}}return this._isDirty=!0,H.prepare(!0),H}enableBlending(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const y of this.bones)for(const H of y.animations)H.enableBlending=!0,H.blendingSpeed=n}dispose(){if(this._meshesWithPoseMatrix.length=0,this.pn().stopAnimation(this),this.pn().removeSkeleton(this),this._parentContainer){const n=this._parentContainer.skeletons.indexOf(this);n>-1&&this._parentContainer.skeletons.splice(n,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const n={};n.name=this.name,n.id=this.id,this.dimensionsAtRest&&(n.dimensionsAtRest=this.dimensionsAtRest.Ui()),n.bones=[],n.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let H=0;H<this.bones.length;H++){var y;const o=this.bones[H],G=o.getParent(),h={parentBoneIndex:G?this.bones.indexOf(G):-1,index:o.getIndex(),name:o.name,id:o.id,matrix:o.getBindMatrix().Ui(),rest:o.getRestMatrix().Ui(),linkedTransformNodeId:null===(y=o.getTransformNode())||void 0===y?void 0:y.id};n.bones.push(h),o.length&&(h.length=o.length),o.metadata&&(h.metadata=o.metadata),o.animations&&o.animations.length>0&&(h.animation=o.animations[0].serialize()),n.ranges=[];for(const y in this._ranges){const H=this._ranges[y];if(!H)continue;const o={};o.name=y,o.from=H.from,o.to=H.to,n.ranges.push(o)}}return n}static Parse(n,y){const H=new Q(n.name,n.id,y);let o;for(n.dimensionsAtRest&&(H.dimensionsAtRest=G.zy.gy(n.dimensionsAtRest)),H.needInitialSkinMatrix=n.needInitialSkinMatrix,o=0;o<n.bones.length;o++){const y=n.bones[o],h=n.bones[o].index;let k=null;y.parentBoneIndex>-1&&(k=H.bones[y.parentBoneIndex]);const i=y.rest?G.Matrix.gy(y.rest):null,B=new V.d(y.name,H,k,G.Matrix.gy(y.matrix),i,null,h);void 0!==y.id&&null!==y.id&&(B.id=y.id),y.length&&(B.length=y.length),y.metadata&&(B.metadata=y.metadata),y.animation&&B.animations.push(A.e.Parse(y.animation)),void 0!==y.linkedTransformNodeId&&null!==y.linkedTransformNodeId&&(H._hasWaitingData=!0,B._waitingTransformNodeId=y.linkedTransformNodeId)}if(n.ranges)for(o=0;o<n.ranges.length;o++){const y=n.ranges[o];H.createAnimationRange(y.name,y.from,y.to)}return H}computeAbsoluteMatrices(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||n)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(n)}getPoseMatrix(){let n=null;return this._meshesWithPoseMatrix.length>0&&(n=this._meshesWithPoseMatrix[0].getPoseMatrix()),n}sortBones(){const n=[],y=new Array(this.bones.length);for(let H=0;H<this.bones.length;H++)this._sortBones(H,n,y);this.bones=n}_sortBones(n,y,H){if(H[n])return;H[n]=!0;const o=this.bones[n];if(!o)return;void 0===o._index&&(o._index=n);const G=o.getParent();G&&this._sortBones(this.bones.indexOf(G),y,H),y.push(o)}setCurrentPoseAsRest(){for(const n of this.bones)n.setCurrentPoseAsRest()}}var l=H(11658),v=H(11846),F=H(11269),g=H(11766),M=H(11360),f=H(11810),c=H(11779),p=H(11800),E=H(11901),X=H(11390),d=H(12982);class a{set areUpdatesFrozen(n){n?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new X.f(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,n||(n=T.c.LastCreatedScene),this._scene=n,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const n=this._scene.getEngine().getCaps();this._canUseTextureForTargets=n.canUseGLVertexID&&n.textureFloat&&n.maxVertexTextureImageUnits>0&&n.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return a.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?a.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(n){this._numMaxInfluencers!==n&&(this._numMaxInfluencers=n,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(n){this._useTextureToStoreTargets!==n&&(this._useTextureToStoreTargets=n,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var n;return a.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(n=this._scene)&&void 0!==n&&n.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(n){return this._activeTargets.data[n]}getTarget(n){return this._targets[n]}getTargetByName(n){for(const y of this._targets)if(y.name===n)return y;return null}addTarget(n){this._targets.push(n),this._targetInfluenceChangedObservers.push(n.onInfluenceChanged.add((n=>{this.areUpdatesFrozen&&n&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(n)}))),this._targetDataLayoutChangedObservers.push(n._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(n){const y=this._targets.indexOf(n);y>=0&&(this._targets.splice(y,1),n.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(y,1)[0]),n._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(y,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(n)}_bind(n){n.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),n.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),n.setTexture("morphTargets",this._targetStoreTexture),n.setInt("morphTargetCount",this.numInfluencers)}clone(){const n=new a(this._scene);for(const y of this._targets)n.addTarget(y.clone());return n.enablePositionMorphing=this.enablePositionMorphing,n.enableNormalMorphing=this.enableNormalMorphing,n.enableTangentMorphing=this.enableTangentMorphing,n.enableUVMorphing=this.enableUVMorphing,n.enableUV2Morphing=this.enableUV2Morphing,n.enableColorMorphing=this.enableColorMorphing,n}serialize(){const n={};n.id=this.uniqueId,n.targets=[];for(const y of this._targets)n.targets.push(y.serialize());return n}_syncActiveTargets(){let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const y=!!this._targetStoreTexture,H=this.isUsingTextureForTargets;(this._mustSynchronize||y!==H)&&(this._mustSynchronize=!1,this.synchronize());let o=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let G=-1;for(const h of this._targets)if(G++,0!==h.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=a.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(h),this._morphTargetTextureIndices[o]=G,this._tempInfluences[o++]=h.influence}this._morphTargetTextureIndices.length!==o&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,o)),this._influences&&this._influences.length===o||(this._influences=new Float32Array(o));for(let h=0;h<o;h++)this._influences[h]=this._tempInfluences[h];if(n&&this._scene)for(const h of this._scene.meshes)h.morphTargetManager===this&&(H?h._markSubMeshesAsAttributesDirty():h._syncGeometryWithMorphTargetManager())}synchronize(){var n;if(!this._scene||this.areUpdatesFrozen)return;const y=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(n=this._targetStoreTexture)||void 0===n||n.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>y.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const H of this._targets){this._supportsPositions=this._supportsPositions&&H.hasPositions,this._supportsNormals=this._supportsNormals&&H.hasNormals,this._supportsTangents=this._supportsTangents&&H.hasTangents,this._supportsUVs=this._supportsUVs&&H.hasUVs,this._supportsUV2s=this._supportsUV2s&&H.hasUV2s,this._supportsColors=this._supportsColors&&H.hasColors;const n=H.vertexCount;if(0===this._vertexCount)this._vertexCount=n;else if(this._vertexCount!==n)return void W.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${H.name}": ${n}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const n=y.getCaps().maxTextureSize;this._textureWidth>n&&(this._textureHeight=Math.ceil(this._textureWidth/n),this._textureWidth=n);const H=this._targets.length,o=new Float32Array(H*this._textureWidth*this._textureHeight*4);let G=0;for(let y=0;y<H;y++){const n=this._targets[y],H=n.getPositions(),h=n.getNormals(),k=n.getUVs(),i=n.getTangents(),B=n.getUV2s(),V=n.getColors();G=y*this._textureWidth*this._textureHeight*4;for(let y=0;y<this._vertexCount;y++)this._supportsPositions&&H&&(o[G]=H[3*y],o[G+1]=H[3*y+1],o[G+2]=H[3*y+2],G+=4),this._supportsNormals&&h&&(o[G]=h[3*y],o[G+1]=h[3*y+1],o[G+2]=h[3*y+2],G+=4),this._supportsUVs&&k&&(o[G]=k[2*y],o[G+1]=k[2*y+1],G+=4),this._supportsTangents&&i&&(o[G]=i[3*y],o[G+1]=i[3*y+1],o[G+2]=i[3*y+2],G+=4),this._supportsUV2s&&B&&(o[G]=B[2*y],o[G+1]=B[2*y+1],G+=4),this._supportsColors&&V&&(o[G]=V[4*y],o[G+1]=V[4*y+1],o[G+2]=V[4*y+2],o[G+3]=V[4*y+3],G+=4)}this._targetStoreTexture=d.d.CreateRGBATexture(o,this._textureWidth,this._textureHeight,H,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const H of this._scene.meshes)H.morphTargetManager===this&&H._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const n=this._parentContainer.morphTargetManagers.indexOf(this);n>-1&&this._parentContainer.morphTargetManagers.splice(n,1),this._parentContainer=null}for(const n of this._targets)this._scene.stopAnimation(n)}}static Parse(n,y){const H=new a(y);for(const o of n.targets)H.addTarget(E.c.Parse(o,y));return H}}a.EnableTextureStorage=!0,a.MaxActiveMorphTargetsInVertexAttributeMode=8,a.ConstantTargetCountForTextureMode=0;var O=H(13043),e=H(11154),w=H(11680);const j=new Map,I=j;function R(n,y,H){C(n)&&W.d.Warn(`Extension with the name '${n}' already exists`),j.set(n,{isGLTFExtension:y,factory:H})}function C(n){return j.delete(n)}var S=H(13059),N=H(11967),r=H(11375);class K{static Get(n,y,H){if(!y||void 0==H||!y[H])throw new Error(`${n}: Failed to find index (${H})`);return y[H]}static TryGet(n,y){return n&&void 0!=y&&n[y]?n[y]:null}static Assign(n){if(n)for(let y=0;y<n.length;y++)n[y].index=y}}function Y(n){if(n.min&&n.max){const y=n.min,H=n.max,o=G.TmpVectors.zy[0].Mi(y[0],y[1],y[2]),h=G.TmpVectors.zy[1].Mi(H[0],H[1],H[2]);if(n.normalized&&5126!==n.componentType){let y=1;switch(n.componentType){case 5120:y=127;break;case 5121:y=255;break;case 5122:y=32767;break;case 5123:y=65535}const H=1/y;o.scaleInPlace(H),h.scaleInPlace(H)}return new w.c(o,h)}return null}class D{static RegisterExtension(n,y){R(n,!1,y)}static UnregisterExtension(n){return C(n)}get rh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(n){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=n}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((n=>n.dispose&&n.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(n,y,H,o,G,h){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=y,this._assetContainer=H,this._loadData(o);let h=null;if(n){const y={};if(this._gltf.nodes)for(const n of this._gltf.nodes)n.name&&(y[n.name]=n.index);h=(n instanceof Array?n:[n]).map((n=>{const H=y[n];if(void 0===H)throw new Error(`Failed to find node '${n}'`);return H}))}return await this._loadAsync(G,k,h,(()=>({meshes:this._getMeshes(),NA:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=n,this._loadData(y),await this._loadAsync(H,G,null,(()=>{}))}async _loadAsync(n,y,H,o){return await Promise.resolve().then((async()=>{this._rootUrl=n,this._uniqueRootUrl=!n.startsWith("file:")&&y?n:`${n}${Date.now()}/`,this._fileName=y,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const G=`${O.h[O.h.LOADING]} => ${O.h[O.h.READY]}`,h=`${O.h[O.h.LOADING]} => ${O.h[O.h.COMPLETE]}`;this._parent._startPerformanceCounter(G),this._parent._startPerformanceCounter(h),this._parent._setState(O.h.LOADING),this._extensionsOnLoading();const i=new Array;if(!this.parent.loadOnlyMaterials)if(H)i.push(this.loadSceneAsync("/nodes",{nodes:H,index:-1}));else if(void 0!=this._gltf.ly||this._gltf.scenes&&this._gltf.scenes[0]){const n=K.Get("/scene",this._gltf.scenes,this._gltf.ly||0);i.push(this.loadSceneAsync(`/scenes/${n.index}`,n))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let n=0;n<this._gltf.materials.length;++n){const y=this._gltf.materials[n],H="/materials/"+n,o=l.e.TriangleFillMode;i.push(this._loadMaterialAsync(H,y,null,o,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&i.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&i.push(this._compileShadowGeneratorsAsync());const B=Promise.all(i).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.xi(!0);for(const n of this._babylonScene.materials){const y=n;void 0!==y.maxSimultaneousLights&&(y.maxSimultaneousLights=Math.max(y.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(O.h.READY),this._skipStartAnimationStep||this._startAnimations(),o()}));return await B.then((n=>(this._parent._endPerformanceCounter(G),k.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(h),this._parent._setState(O.h.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(n=>{this._parent.onErrorObservable.notifyObservers(n),this._parent.onErrorObservable.clear(),this.dispose()}))})),n)))})).catch((n=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(n),this._parent.onErrorObservable.clear(),this.dispose()),n}))}_loadData(n){if(this._gltf=n.json,this._setupData(),n.bin){const y=this._gltf.buffers;if(y&&y[0]&&!y[0].uri){const H=y[0];(H.byteLength<n.bin.byteLength-3||H.byteLength>n.bin.byteLength)&&W.d.Warn(`Binary buffer length (${H.byteLength}) from JSON does not match chunk length (${n.bin.byteLength})`),this._bin=n.bin}else W.d.Warn("Unexpected BIN chunk")}}_setupData(){if(K.Assign(this._gltf.accessors),K.Assign(this._gltf.animations),K.Assign(this._gltf.buffers),K.Assign(this._gltf.bufferViews),K.Assign(this._gltf.cameras),K.Assign(this._gltf.images),K.Assign(this._gltf.materials),K.Assign(this._gltf.meshes),K.Assign(this._gltf.nodes),K.Assign(this._gltf.samplers),K.Assign(this._gltf.scenes),K.Assign(this._gltf.skins),K.Assign(this._gltf.textures),this._gltf.nodes){const n={};for(const H of this._gltf.nodes)if(H.children)for(const y of H.children)n[y]=H.index;const y=this._createRootNode();for(const H of this._gltf.nodes){const o=n[H.index];H.parent=void 0===o?y:this._gltf.nodes[o]}}}async _loadExtensionsAsync(){const n=[];if(I.forEach(((y,H)=>{var o;!1===(null===(o=this.parent.extensionOptions[H])||void 0===o?void 0:o.enabled)?y.isGLTFExtension&&this.isExtensionUsed(H)&&W.d.Warn(`Extension ${H} is used but has been explicitly disabled.`):y.isGLTFExtension&&!this.isExtensionUsed(H)||n.push((async()=>{const n=await y.factory(this);return n.name!==H&&W.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${n.name} !== ${H}`),this._parent.onExtensionLoadedObservable.notifyObservers(n),n})())})),this._extensions.push(...await Promise.all(n)),this._extensions.sort(((n,y)=>(n.order||Number.MAX_VALUE)-(y.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const H of this._gltf.extensionsRequired){if(!this._extensions.some((n=>n.name===H&&n.enabled))){var y;if(!1===(null===(y=this.parent.extensionOptions[H])||void 0===y?void 0:y.enabled))throw new Error(`Required extension ${H} is disabled`);throw new Error(`Required extension ${H} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const n=new p.b("__root__",this._babylonScene);this._rootBabylonMesh=n,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.xi(!1);const y={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case O.d.AUTO:this._babylonScene.useRightHandedSystem||(y.rotation=[0,1,0,0],y.scale=[1,1,-1],D._LoadTransform(y,this._rootBabylonMesh));break;case O.d.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(n),y}loadSceneAsync(n,y){const H=this._extensionsLoadSceneAsync(n,y);if(H)return H;const o=new Array;if(this.logOpen(`${n} ${y.name||""}`),y.nodes)for(const G of y.nodes){const y=K.Get(`${n}/nodes/${G}`,this._gltf.nodes,G);o.push(this.loadNodeAsync(`/nodes/${y.index}`,y,(n=>{n.parent=this._rootBabylonMesh})))}for(const G of this._postSceneLoadActions)G();return o.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(o).then((()=>{}))}_forEachPrimitive(n,y){if(n._primitiveBabylonMeshes)for(const H of n._primitiveBabylonMeshes)y(H)}_getGeometries(){const n=[],y=this._gltf.nodes;if(y)for(const H of y)this._forEachPrimitive(H,(y=>{const H=y.li;H&&-1===n.indexOf(H)&&n.push(H)}));return n}_getMeshes(){const n=[];this._rootBabylonMesh instanceof c.d&&n.push(this._rootBabylonMesh);const y=this._gltf.nodes;if(y)for(const H of y)this._forEachPrimitive(H,(y=>{n.push(y)}));return n}_getTransformNodes(){const n=[],y=this._gltf.nodes;if(y)for(const H of y)H._babylonTransformNode&&"ob"===H._babylonTransformNode.getClassName()&&n.push(H._babylonTransformNode),H._babylonTransformNodeForSkin&&n.push(H._babylonTransformNodeForSkin);return n}_getSkeletons(){const n=[],y=this._gltf.skins;if(y)for(const H of y)H._data&&n.push(H._data.babylonSkeleton);return n}_getAnimationGroups(){const n=[],y=this._gltf.animations;if(y)for(const H of y)H._babylonAnimationGroup&&n.push(H._babylonAnimationGroup);return n}_startAnimations(){switch(this._parent.animationStartMode){case O.c.NONE:break;case O.c.FIRST:{const n=this._getAnimationGroups();0!==n.length&&n[0].start(!0);break}case O.c.ALL:{const n=this._getAnimationGroups();for(const y of n)y.start(!0);break}default:return void W.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadNodeAsync(n,y,H);if(o)return o;if(y._babylonTransformNode)throw new Error(`${n}: Invalid recursive node hierarchy`);const G=new Array;this.logOpen(`${n} ${y.name||""}`);const h=o=>{if(D.AddPointerMetadata(o,n),D._LoadTransform(y,o),void 0!=y.camera){const H=K.Get(`${n}/camera`,this._gltf.cameras,y.camera);G.push(this.loadCameraAsync(`/cameras/${H.index}`,H,(n=>{n.parent=o,this._babylonScene.useRightHandedSystem||(o.fi.x=-1)})))}if(y.children)for(const H of y.children){const y=K.Get(`${n}/children/${H}`,this._gltf.nodes,H);G.push(this.loadNodeAsync(`/nodes/${y.index}`,y,(n=>{n.parent=o})))}H(o)},k=void 0!=y.mesh,i=this._parent.loadSkins&&void 0!=y.skin;if(!k||i){const n=y.name||`node${y.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new g.c(n,this._babylonScene);H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==y.mesh?y._babylonTransformNode=H:y._babylonTransformNodeForSkin=H,h(H)}if(k)if(i){const H=K.Get(`${n}/mesh`,this._gltf.meshes,y.mesh);G.push(this._loadMeshAsync(`/meshes/${H.index}`,y,H,(H=>{const o=y._babylonTransformNodeForSkin;H.metadata=(0,N.c)(o.metadata,H.metadata||{});const h=K.Get(`${n}/skin`,this._gltf.skins,y.skin);G.push(this._loadSkinAsync(`/skins/${h.index}`,y,h,(n=>{this._forEachPrimitive(y,(y=>{y.skeleton=n})),this._postSceneLoadActions.push((()=>{if(void 0!=h.skeleton){const n=K.Get(`/skins/${h.index}/skeleton`,this._gltf.nodes,h.skeleton).parent;y.index===n.index?H.parent=o.parent:H.parent=n._babylonTransformNode}else H.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:o,skinnedNode:H})}))})))})))}else{const H=K.Get(`${n}/mesh`,this._gltf.meshes,y.mesh);G.push(this._loadMeshAsync(`/meshes/${H.index}`,y,H,h))}return this.logClose(),Promise.all(G).then((()=>(this._forEachPrimitive(y,(n=>{const y=n;!y.isAnInstance&&y.li&&y.li.useBoundingInfoFromGeometry?n.In():n.refreshBoundingInfo(!0,!0)})),y._babylonTransformNode)))}_loadMeshAsync(n,y,H,o){const G=H.primitives;if(!G||!G.length)throw new Error(`${n}: Primitives are missing`);void 0==G[0].index&&K.Assign(G);const h=new Array;this.logOpen(`${n} ${H.name||""}`);const k=y.name||`node${y.index}`;if(1===G.length){const o=H.primitives[0];h.push(this._loadMeshPrimitiveAsync(`${n}/primitives/${o.index}`,k,y,H,o,(n=>{y._babylonTransformNode=n,y._primitiveBabylonMeshes=[n]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,y._babylonTransformNode=new g.c(k,this._babylonScene),y._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y._primitiveBabylonMeshes=[];for(const o of G)h.push(this._loadMeshPrimitiveAsync(`${n}/primitives/${o.index}`,`${k}_primitive${o.index}`,y,H,o,(n=>{n.parent=y._babylonTransformNode,y._primitiveBabylonMeshes.push(n)})))}return o(y._babylonTransformNode),this.logClose(),Promise.all(h).then((()=>y._babylonTransformNode))}_loadMeshPrimitiveAsync(n,y,H,o,G,h){const k=this._extensionsLoadMeshPrimitiveAsync(n,y,H,o,G,h);if(k)return k;this.logOpen(`${n}`);const i=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==H.skin&&!o.primitives[0].targets;let B,V;if(i&&G._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,B=G._instanceData.babylonSourceMesh.createInstance(y),B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V=G._instanceData.promise;else{const h=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new p.b(y,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.sideOrientation=this._babylonScene.useRightHandedSystem?l.e.CounterClockWiseSideOrientation:l.e.ClockWiseSideOrientation,this._createMorphTargets(n,H,o,G,k),h.push(this._loadVertexDataAsync(n,G,k).then((async y=>await this._loadMorphTargetsAsync(n,G,k,y).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,y.wn(k),y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const q=D._GetDrawMode(n,G.mode);if(void 0==G.material){let n=this._defaultBabylonMaterialData[q];n||(n=this._createDefaultMaterial("__GLTFLoader._default",q),this._parent.onMaterialLoadedObservable.notifyObservers(n),this._defaultBabylonMaterialData[q]=n),k.material=n}else if(!this.parent.skipMaterials){const y=K.Get(`${n}/material`,this._gltf.materials,G.material);h.push(this._loadMaterialAsync(`/materials/${y.index}`,y,k,q,(n=>{k.material=n})))}V=Promise.all(h),i&&(G._instanceData={babylonSourceMesh:k,promise:V}),B=k}return D.AddPointerMetadata(B,n),this._parent.onMeshLoadedObservable.notifyObservers(B),h(B),this.logClose(),V.then((()=>B))}_loadVertexDataAsync(n,y,H){const o=this._extensionsLoadVertexDataAsync(n,y,H);if(o)return o;const G=y.attributes;if(!G)throw new Error(`${n}: Attributes are missing`);const h=new Array,k=new f.d(H.name,this._babylonScene);if(void 0==y.indices)H.isUnIndexed=!0;else{const H=K.Get(`${n}/indices`,this._gltf.accessors,y.indices);h.push(this._loadIndicesAccessorAsync(`/accessors/${H.index}`,H).then((n=>{k.setIndices(n)})))}const i=(y,o,i)=>{if(void 0==G[y])return;H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(o)&&H._delayInfo.push(o);const B=K.Get(`${n}/attributes/${y}`,this._gltf.accessors,G[y]);h.push(this._loadVertexAccessorAsync(`/accessors/${B.index}`,B,o).then((n=>{if(n.getKind()===M.g.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!H.skeleton){const n=Y(B);n&&(k._boundingInfo=n,k.useBoundingInfoFromGeometry=!0)}k.setVerticesBuffer(n,B.count)}))),o==M.g.MatricesIndicesExtraKind&&(H.numBoneInfluencers=8),i&&i(B)};return i("POSITION",M.g.PositionKind),i("NORMAL",M.g.NormalKind),i("TANGENT",M.g.TangentKind),i("TEXCOORD_0",M.g.UVKind),i("TEXCOORD_1",M.g.UV2Kind),i("TEXCOORD_2",M.g.UV3Kind),i("TEXCOORD_3",M.g.UV4Kind),i("TEXCOORD_4",M.g.UV5Kind),i("TEXCOORD_5",M.g.UV6Kind),i("JOINTS_0",M.g.MatricesIndicesKind),i("WEIGHTS_0",M.g.MatricesWeightsKind),i("JOINTS_1",M.g.MatricesIndicesExtraKind),i("WEIGHTS_1",M.g.MatricesWeightsExtraKind),i("COLOR_0",M.g.ColorKind,(n=>{"VEC4"===n.type&&(H.hasVertexAlpha=!0)})),Promise.all(h).then((()=>k))}_createMorphTargets(n,y,H,o,G){if(!o.targets||!this._parent.loadMorphTargets)return;if(void 0==y._numMorphTargets)y._numMorphTargets=o.targets.length;else if(o.targets.length!==y._numMorphTargets)throw new Error(`${n}: Primitives do not have the same number of targets`);const h=H.extras?H.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,G.morphTargetManager=new a(this._babylonScene),G.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.morphTargetManager.areUpdatesFrozen=!0;for(let k=0;k<o.targets.length;k++){const n=y.weights?y.weights[k]:H.weights?H.weights[k]:0,o=h?h[k]:`morphTarget${k}`;G.morphTargetManager.addTarget(new E.c(o,n,G.pn()))}}_loadMorphTargetsAsync(n,y,H,o){if(!y.targets||!this._parent.loadMorphTargets)return Promise.resolve();const G=new Array,h=H.morphTargetManager;for(let k=0;k<h.numTargets;k++){const H=h.getTarget(k);G.push(this._loadMorphTargetVertexDataAsync(`${n}/targets/${k}`,o,y.targets[k],H))}return Promise.all(G).then((()=>{h.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(n,y,H,o){const G=new Array,h=(o,h,k)=>{if(void 0==H[o])return;const i=y.getVertexBuffer(h);if(!i)return;const B=K.Get(`${n}/${o}`,this._gltf.accessors,H[o]);G.push(this._loadFloatAccessorAsync(`/accessors/${B.index}`,B).then((n=>{k(i,n)})))};return h("POSITION",M.g.PositionKind,((n,y)=>{const H=new Float32Array(y.length);n.forEach(y.length,((n,o)=>{H[o]=y[o]+n})),o.setPositions(H)})),h("NORMAL",M.g.NormalKind,((n,y)=>{const H=new Float32Array(y.length);n.forEach(H.length,((n,o)=>{H[o]=y[o]+n})),o.setNormals(H)})),h("TANGENT",M.g.TangentKind,((n,y)=>{const H=new Float32Array(y.length/3*4);let G=0;n.forEach(y.length/3*4,((n,o)=>{(o+1)%4!==0&&(H[G]=y[G]+n,G++)})),o.setTangents(H)})),h("TEXCOORD_0",M.g.UVKind,((n,y)=>{const H=new Float32Array(y.length);n.forEach(y.length,((n,o)=>{H[o]=y[o]+n})),o.setUVs(H)})),h("TEXCOORD_1",M.g.UV2Kind,((n,y)=>{const H=new Float32Array(y.length);n.forEach(y.length,((n,o)=>{H[o]=y[o]+n})),o.setUV2s(H)})),h("COLOR_0",M.g.ColorKind,((y,H)=>{let G=null;const h=y.getSize();if(3===h){G=new Float32Array(H.length/3*4),y.forEach(H.length,((n,y)=>{const o=Math.floor(y/3),h=y%3;G[4*o+h]=H[3*o+h]+n}));for(let n=0;n<H.length/3;++n)G[4*n+3]=1}else{if(4!==h)throw new Error(`${n}: Invalid number of components (${h}) for COLOR_0 attribute`);G=new Float32Array(H.length),y.forEach(H.length,((n,y)=>{G[y]=H[y]+n}))}o.setColors(G)})),await Promise.all(G).then((()=>{}))}static _LoadTransform(n,y){if(void 0!=n.skin)return;let H=G.zy.Zero(),o=G.Quaternion.Identity(),h=G.zy.One();if(n.matrix){G.Matrix.gy(n.matrix).decompose(h,o,H)}else n.translation&&(H=G.zy.gy(n.translation)),n.rotation&&(o=G.Quaternion.gy(n.rotation)),n.scale&&(h=G.zy.gy(n.scale));y.position=H,y.rotationQuaternion=o,y.fi=h}_loadSkinAsync(n,y,H,o){if(!this._parent.loadSkins)return Promise.resolve();const G=this._extensionsLoadSkinAsync(n,y,H);if(G)return G;if(H._data)return o(H._data.babylonSkeleton),H._data.promise;const h=`skeleton${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new Q(H.name||h,h,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(n,H,k);const i=this._loadSkinInverseBindMatricesDataAsync(n,H).then((n=>{this._updateBoneMatrices(k,n)}));return H._data={babylonSkeleton:k,promise:i},o(k),i}_loadBones(n,y,H){if(void 0==y.skeleton||this._parent.alwaysComputeSkeletonRootNode){const H=this._findSkeletonRootNode(`${n}/joints`,y.joints);if(H)if(void 0===y.skeleton)y.skeleton=H.index;else{const o=(n,y)=>{for(;y.parent;y=y.parent)if(y.parent===n)return!0;return!1},G=K.Get(`${n}/skeleton`,this._gltf.nodes,y.skeleton);G===H||o(G,H)||(W.d.Warn(`${n}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),y.skeleton=H.index)}else W.d.Warn(`${n}: Failed to find common root`)}const o={};for(const G of y.joints){const h=K.Get(`${n}/joints/${G}`,this._gltf.nodes,G);this._loadBone(h,y,H,o)}}_findSkeletonRootNode(n,y){if(0===y.length)return null;const H={};for(const G of y){const y=[];let o=K.Get(`${n}/${G}`,this._gltf.nodes,G);for(;-1!==o.index;)y.unshift(o),o=o.parent;H[G]=y}let o=null;for(let G=0;;++G){let n=H[y[0]];if(G>=n.length)return o;const h=n[G];for(let k=1;k<y.length;++k)if(n=H[y[k]],G>=n.length||h!==n[G])return o;o=h}}_loadBone(n,y,H,o){n._isJoint=!0;let G=o[n.index];if(G)return G;let h=null;n.index!==y.skeleton&&(n.parent&&-1!==n.parent.index?h=this._loadBone(n.parent,y,H,o):void 0!==y.skeleton&&W.d.Warn(`/skins/${y.index}/skeleton: Skeleton node is not a common root`));const k=y.joints.indexOf(n.index);return G=new V.d(n.name||`joint${n.index}`,H,h,this._getNodeMatrix(n),null,null,k),o[n.index]=G,this._postSceneLoadActions.push((()=>{G.linkTransformNode(n._babylonTransformNode)})),G}_loadSkinInverseBindMatricesDataAsync(n,y){if(void 0==y.inverseBindMatrices)return Promise.resolve(null);const H=K.Get(`${n}/inverseBindMatrices`,this._gltf.accessors,y.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${H.index}`,H)}_updateBoneMatrices(n,y){for(const H of n.bones){const n=G.Matrix.Identity(),o=H._index;y&&-1!==o&&(G.Matrix.FromArrayToRef(y,16*o,n),n.invertToRef(n));const h=H.getParent();h&&n.multiplyToRef(h.getAbsoluteInverseBindMatrix(),n),H.zi(n,!1,!1),H._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(n){return n.matrix?G.Matrix.gy(n.matrix):G.Matrix.Compose(n.scale?G.zy.gy(n.scale):G.zy.One(),n.rotation?G.Quaternion.gy(n.rotation):G.Quaternion.Identity(),n.translation?G.zy.gy(n.translation):G.zy.Zero())}loadCameraAsync(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadCameraAsync(n,y,H);if(o)return o;const h=new Array;this.logOpen(`${n} ${y.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new B.d(y.name||`camera${y.index}`,G.zy.Zero(),this._babylonScene,!1);switch(k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y._babylonCamera=k,k.setTarget(new G.zy(0,0,-1)),y.type){case"perspective":{const H=y.perspective;if(!H)throw new Error(`${n}: Camera perspective properties are missing`);k.fov=H.yfov,k.Wi=H.znear,k.maxZ=H.zfar||0;break}case"orthographic":if(!y.orthographic)throw new Error(`${n}: Camera orthographic properties are missing`);k.mode=i.d.ORTHOGRAPHIC_CAMERA,k.orthoLeft=-y.orthographic.xmag,k.orthoRight=y.orthographic.xmag,k.orthoBottom=-y.orthographic.ymag,k.orthoTop=y.orthographic.ymag,k.Wi=y.orthographic.znear,k.maxZ=y.orthographic.zfar;break;default:throw new Error(`${n}: Invalid camera type (${y.type})`)}return D.AddPointerMetadata(k,n),this._parent.onCameraLoadedObservable.notifyObservers(k),H(k),this.logClose(),Promise.all(h).then((()=>k))}_loadAnimationsAsync(){const n=this._gltf.animations;if(!n)return Promise.resolve();const y=new Array;for(let H=0;H<n.length;H++){const o=n[H];y.push(this.loadAnimationAsync(`/animations/${o.index}`,o).then((n=>{0===n.targetedAnimations.length&&n.dispose()})))}return Promise.all(y).then((()=>{}))}loadAnimationAsync(n,y){const o=this._extensionsLoadAnimationAsync(n,y);return o||H.e(78).then(H.bind(H,14546)).then((H=>{let{AnimationGroup:o}=H;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new o(y.name||`animation${y.index}`,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y._babylonAnimationGroup=G;const h=new Array;K.Assign(y.channels),K.Assign(y.samplers);for(const k of y.channels)h.push(this._loadAnimationChannelAsync(`${n}/channels/${k.index}`,n,y,k,((n,y)=>{n.animations=n.animations||[],n.animations.push(y),G.addTargetedAnimation(y,n)})));return Promise.all(h).then((()=>(G.normalize(0),G)))}))}async _loadAnimationChannelAsync(n,y,o,G,h){const k=this._extensionsLoadAnimationChannelAsync(n,y,o,G,h);if(k)return await k;if(void 0==G.target.node)return await Promise.resolve();const i=K.Get(`${n}/target/node`,this._gltf.nodes,G.target.node),B=G.target.path,V="weights"===B;if(V&&!i._numMorphTargets||!V&&!i._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!V&&!i._isJoint)return await Promise.resolve();let q;switch(await Promise.resolve().then(H.bind(H,13069)),B){case"translation":var b;q=null===(b=(0,S.d)("/nodes/{}/translation"))||void 0===b?void 0:b.interpolation;break;case"rotation":var A;q=null===(A=(0,S.d)("/nodes/{}/rotation"))||void 0===A?void 0:A.interpolation;break;case"scale":var U;q=null===(U=(0,S.d)("/nodes/{}/scale"))||void 0===U?void 0:U.interpolation;break;case"weights":var T;q=null===(T=(0,S.d)("/nodes/{}/weights"))||void 0===T?void 0:T.interpolation;break;default:throw new Error(`${n}/target/path: Invalid value (${G.target.path})`)}if(!q)throw new Error(`${n}/target/path: Could not find interpolation properties for target path (${G.target.path})`);const W={object:i,info:q};return await this._loadAnimationChannelFromTargetInfoAsync(n,y,o,G,W,h)}_loadAnimationChannelFromTargetInfoAsync(n,y,H,o,G,h){const k=this.parent.targetFps,i=1/k,B=K.Get(`${n}/sampler`,H.samplers,o.sampler);return this._loadAnimationSamplerAsync(`${y}/samplers/${o.sampler}`,B).then((n=>{let y=0;const B=G.object,V=G.info;for(const G of V){const V=G.getStride(B),q=n.input,b=n.output,A=new Array(q.length);let U=0;switch(n.interpolation){case"STEP":for(let n=0;n<q.length;n++){const y=G.getValue(B,b,U,1);U+=V,A[n]={frame:q[n]*k,value:y,interpolation:1}}break;case"CUBICSPLINE":for(let n=0;n<q.length;n++){const y=G.getValue(B,b,U,i);U+=V;const H=G.getValue(B,b,U,1);U+=V;const o=G.getValue(B,b,U,i);U+=V,A[n]={frame:q[n]*k,inTangent:y,value:H,outTangent:o}}break;case"LINEAR":for(let n=0;n<q.length;n++){const y=G.getValue(B,b,U,1);U+=V,A[n]={frame:q[n]*k,value:y}}}if(U>0){const n=`${H.name||`animation${H.index}`}_channel${o.index}_${y}`,i=G.buildAnimations(B,n,k,A);for(const H of i)y++,h(H.babylonAnimatable,H.babylonAnimation)}}}))}_loadAnimationSamplerAsync(n,y){if(y._data)return y._data;const H=y.interpolation||"LINEAR";switch(H){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${n}/interpolation: Invalid value (${y.interpolation})`)}const o=K.Get(`${n}/input`,this._gltf.accessors,y.input),G=K.Get(`${n}/output`,this._gltf.accessors,y.output);return y._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${o.index}`,o),this._loadFloatAccessorAsync(`/accessors/${G.index}`,G)]).then((n=>{let[y,o]=n;return{input:y,interpolation:H,output:o}})),y._data}loadBufferAsync(n,y,H,o){const G=this._extensionsLoadBufferAsync(n,y,H,o);if(G)return G;if(!y._data)if(y.uri)y._data=this.loadUriAsync(`${n}/uri`,y,y.uri);else{if(!this._bin)throw new Error(`${n}: Uri is missing or the binary glTF is missing its binary chunk`);y._data=this._bin.readAsync(0,y.byteLength)}return y._data.then((y=>{try{return new Uint8Array(y.buffer,y.byteOffset+H,o)}catch(G){throw new Error(`${n}: ${G.message}`)}}))}loadBufferViewAsync(n,y){const H=this._extensionsLoadBufferViewAsync(n,y);if(H)return H;if(y._data)return y._data;const o=K.Get(`${n}/buffer`,this._gltf.buffers,y.buffer);return y._data=this.loadBufferAsync(`/buffers/${o.index}`,o,y.byteOffset||0,y.byteLength),y._data}_loadAccessorAsync(n,y,H){if(y._data)return y._data;const o=D._GetNumComponents(n,y.type),G=o*M.g.GetTypeByteLength(y.componentType),h=o*y.count;if(void 0==y.bufferView)y._data=Promise.resolve(new H(h));else{const k=K.Get(`${n}/bufferView`,this._gltf.bufferViews,y.bufferView);y._data=this.loadBufferViewAsync(`/bufferViews/${k.index}`,k).then((i=>{if(5126!==y.componentType||y.normalized||k.byteStride&&k.byteStride!==G){const n=new H(h);return M.g.ForEach(i,y.byteOffset||0,k.byteStride||G,o,y.componentType,n.length,y.normalized||!1,((y,H)=>{n[H]=y})),n}return D._GetTypedArray(n,y.componentType,i,y.byteOffset,h)}))}if(y.sparse){const h=y.sparse;y._data=y._data.then((k=>{const i=k,B=K.Get(`${n}/sparse/indices/bufferView`,this._gltf.bufferViews,h.indices.bufferView),V=K.Get(`${n}/sparse/values/bufferView`,this._gltf.bufferViews,h.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${B.index}`,B),this.loadBufferViewAsync(`/bufferViews/${V.index}`,V)]).then((k=>{let[B,V]=k;const q=D._GetTypedArray(`${n}/sparse/indices`,h.indices.componentType,B,h.indices.byteOffset,h.count),b=o*h.count;let A;if(5126!==y.componentType||y.normalized){const k=D._GetTypedArray(`${n}/sparse/values`,y.componentType,V,h.values.byteOffset,b);A=new H(b),M.g.ForEach(k,0,G,o,y.componentType,A.length,y.normalized||!1,((n,y)=>{A[y]=n}))}else A=D._GetTypedArray(`${n}/sparse/values`,y.componentType,V,h.values.byteOffset,b);let U=0;for(let n=0;n<q.length;n++){let y=q[n]*o;for(let n=0;n<o;n++)i[y++]=A[U++]}return i}))}))}return y._data}_loadFloatAccessorAsync(n,y){return this._loadAccessorAsync(n,y,Float32Array)}_loadIndicesAccessorAsync(n,y){if("SCALAR"!==y.type)throw new Error(`${n}/type: Invalid value ${y.type}`);if(5121!==y.componentType&&5123!==y.componentType&&5125!==y.componentType)throw new Error(`${n}/componentType: Invalid value ${y.componentType}`);if(y._data)return y._data;if(y.sparse){const H=D._GetTypedArrayConstructor(`${n}/componentType`,y.componentType);y._data=this._loadAccessorAsync(n,y,H)}else{const H=K.Get(`${n}/bufferView`,this._gltf.bufferViews,y.bufferView);y._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H).then((H=>D._GetTypedArray(n,y.componentType,H,y.byteOffset,y.count)))}return y._data}_loadVertexBufferViewAsync(n){if(n._babylonBuffer)return n._babylonBuffer;const y=this._babylonScene.getEngine();return n._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${n.index}`,n).then((n=>new M.d(y,n,!1))),n._babylonBuffer}_loadVertexAccessorAsync(n,y,H){var o;if(null!==(o=y._babylonVertexBuffer)&&void 0!==o&&o[H])return y._babylonVertexBuffer[H];y._babylonVertexBuffer||(y._babylonVertexBuffer={});const G=this._babylonScene.getEngine();if(y.sparse||void 0==y.bufferView)y._babylonVertexBuffer[H]=this._loadFloatAccessorAsync(n,y).then((n=>new M.g(G,n,H,!1)));else{const o=K.Get(`${n}/bufferView`,this._gltf.bufferViews,y.bufferView);y._babylonVertexBuffer[H]=this._loadVertexBufferViewAsync(o).then((h=>{const k=D._GetNumComponents(n,y.type);return new M.g(G,h,H,!1,void 0,o.byteStride,void 0,y.byteOffset,k,y.componentType,y.normalized,!0,void 0,!0)}))}return y._babylonVertexBuffer[H]}_loadMaterialMetallicRoughnessPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return y&&(y.baseColorFactor?(H.albedoColor=h.Fy.gy(y.baseColorFactor),H.alpha=y.baseColorFactor[3]):H.albedoColor=h.Fy.White(),H.metallic=void 0==y.metallicFactor?1:y.metallicFactor,H.roughness=void 0==y.roughnessFactor?1:y.roughnessFactor,y.baseColorTexture&&o.push(this.loadTextureInfoAsync(`${n}/baseColorTexture`,y.baseColorTexture,(n=>{n.name=`${H.name} (Base Color)`,H.albedoTexture=n}))),y.metallicRoughnessTexture&&(y.metallicRoughnessTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${n}/metallicRoughnessTexture`,y.metallicRoughnessTexture,(n=>{n.name=`${H.name} (Metallic Roughness)`,H.metallicTexture=n}))),H.useMetallnessFromMetallicTextureBlue=!0,H.useRoughnessFromMetallicTextureGreen=!0,H.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(o).then((()=>{}))}_loadMaterialAsync(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const h=this._extensionsLoadMaterialAsync(n,y,H,o,G);if(h)return h;y._data=y._data||{};let k=y._data[o];if(!k){this.logOpen(`${n} ${y.name||""}`);const H=this.createMaterial(n,y,o);k={babylonMaterial:H,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(n,y,H)},y._data[o]=k,D.AddPointerMetadata(H,n),this._parent.onMaterialLoadedObservable.notifyObservers(H),this.logClose()}return H&&(k.babylonMeshes.push(H),H.ah.addOnce((()=>{const n=k.babylonMeshes.indexOf(H);-1!==n&&k.babylonMeshes.splice(n,1)}))),G(k.babylonMaterial),k.promise.then((()=>k.babylonMaterial))}_createDefaultMaterial(n,y){this._babylonScene._blockEntityCollection=!!this._assetContainer;const H=new v.e(n,this._babylonScene);return H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H.fillMode=y,H.enableSpecularAntiAliasing=!0,H.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,H.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,H.transparencyMode=v.e.PBRMATERIAL_OPAQUE,H.metallic=1,H.roughness=1,H}createMaterial(n,y,H){const o=this._extensionsCreateMaterial(n,y,H);if(o)return o;const G=y.name||`material${y.index}`;return this._createDefaultMaterial(G,H)}loadMaterialPropertiesAsync(n,y,H){const o=this._extensionsLoadMaterialPropertiesAsync(n,y,H);if(o)return o;const G=new Array;return G.push(this.loadMaterialBasePropertiesAsync(n,y,H)),y.pbrMetallicRoughness&&G.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${n}/pbrMetallicRoughness`,y.pbrMetallicRoughness,H)),this.loadMaterialAlphaProperties(n,y,H),Promise.all(G).then((()=>{}))}loadMaterialBasePropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return H.emissiveColor=y.emissiveFactor?h.Fy.gy(y.emissiveFactor):new h.Fy(0,0,0),y.doubleSided&&(H.gi=!1,H.twoSidedLighting=!0),y.normalTexture&&(y.normalTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${n}/normalTexture`,y.normalTexture,(n=>{n.name=`${H.name} (Normal)`,H.bumpTexture=n}))),H.invertNormalMapX=!this._babylonScene.useRightHandedSystem,H.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=y.normalTexture.scale&&H.bumpTexture&&(H.bumpTexture.level=y.normalTexture.scale),H.forceIrradianceInFragment=!0),y.occlusionTexture&&(y.occlusionTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync(`${n}/occlusionTexture`,y.occlusionTexture,(n=>{n.name=`${H.name} (Occlusion)`,H.ambientTexture=n}))),H.useAmbientInGrayScale=!0,void 0!=y.occlusionTexture.strength&&(H.ambientTextureStrength=y.occlusionTexture.strength)),y.emissiveTexture&&o.push(this.loadTextureInfoAsync(`${n}/emissiveTexture`,y.emissiveTexture,(n=>{n.name=`${H.name} (Emissive)`,H.emissiveTexture=n}))),Promise.all(o).then((()=>{}))}loadMaterialAlphaProperties(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);switch(y.alphaMode||"OPAQUE"){case"OPAQUE":H.transparencyMode=v.e.PBRMATERIAL_OPAQUE,H.alpha=1;break;case"MASK":H.transparencyMode=v.e.PBRMATERIAL_ALPHATEST,H.alphaCutOff=void 0==y.alphaCutoff?.5:y.alphaCutoff,H.albedoTexture&&(H.albedoTexture.Ti=!0);break;case"BLEND":H.transparencyMode=v.e.PBRMATERIAL_ALPHABLEND,H.albedoTexture&&(H.albedoTexture.Ti=!0,H.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${n}/alphaMode: Invalid value (${y.alphaMode})`)}}loadTextureInfoAsync(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureInfoAsync(n,y,H);if(o)return o;if(this.logOpen(`${n}`),y.texCoord>=6)throw new Error(`${n}/texCoord: Invalid value (${y.texCoord})`);const G=K.Get(`${n}/index`,this._gltf.textures,y.index);G._textureInfo=y;const h=this._loadTextureAsync(`/textures/${y.index}`,G,(o=>{o.coordinatesIndex=y.texCoord||0,D.AddPointerMetadata(o,n),this._parent.onTextureLoadedObservable.notifyObservers(o),H(o)}));return this.logClose(),h}_loadTextureAsync(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const o=this._extensionsLoadTextureAsync(n,y,H);if(o)return o;this.logOpen(`${n} ${y.name||""}`);const G=void 0==y.sampler?D.DefaultSampler:K.Get(`${n}/sampler`,this._gltf.samplers,y.sampler),h=K.Get(`${n}/source`,this._gltf.images,y.source),k=this._createTextureAsync(n,G,h,H,void 0,!y._textureInfo.nonColorData);return this.logClose(),k}_createTextureAsync(n,y,H){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},h=arguments.length>4?arguments[4]:void 0,k=arguments.length>5?arguments[5]:void 0;const i=this._loadSampler(`/samplers/${y.index}`,y),B=new Array,V=new o;this._babylonScene._blockEntityCollection=!!this._assetContainer;const q={noMipmap:i.noMipMaps,invertY:!1,samplingMode:i.samplingMode,L:()=>{this._disposed||V.resolve()},onError:(y,H)=>{this._disposed||V.reject(new Error(`${n}: ${H&&H.message?H.message:y||"Failed to load texture"}`))},mimeType:H.mimeType??(0,e.i)(H.uri??""),loaderOptions:h,useSRGBBuffer:!!k&&this._parent.useSRGBBuffers},b=new F.b(null,this._babylonScene,q);return b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.push(V.promise),B.push(this.loadImageAsync(`/images/${H.index}`,H).then((n=>{const y=H.uri||`${this._fileName}#image${H.index}`,o=`data:${this._uniqueRootUrl}${y}`;b.updateURL(o,n);const G=b.getInternalTexture();G&&(G.label=H.name)}))),b.wrapU=i.wrapU,b.wrapV=i.wrapV,G(b),this._parent.useGltfTextureNames&&(b.name=H.name||H.uri||`image${H.index}`),Promise.all(B).then((()=>b))}_loadSampler(n,y){return y._data||(y._data={noMipMaps:9728===y.minFilter||9729===y.minFilter,samplingMode:D._GetTextureSamplingMode(n,y),wrapU:D._GetTextureWrapMode(`${n}/wrapS`,y.wrapS),wrapV:D._GetTextureWrapMode(`${n}/wrapT`,y.wrapT)}),y._data}loadImageAsync(n,y){if(!y._data){if(this.logOpen(`${n} ${y.name||""}`),y.uri)y._data=this.loadUriAsync(`${n}/uri`,y,y.uri);else{const H=K.Get(`${n}/bufferView`,this._gltf.bufferViews,y.bufferView);y._data=this.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}this.logClose()}return y._data}loadUriAsync(n,y,H){const o=this._extensionsLoadUriAsync(n,y,H);if(o)return o;if(!D._ValidateUri(H))throw new Error(`${n}: '${H}' is invalid`);if((0,e.k)(H)){const y=new Uint8Array((0,e.c)(H));return this.log(`${n}: Decoded ${H.substring(0,64)}... (${y.length} bytes)`),Promise.resolve(y)}return this.log(`${n}: Loading ${H}`),this._parent.preprocessUrlAsync(this._rootUrl+H).then((y=>new Promise(((o,G)=>{this._parent._loadFile(this._babylonScene,y,(y=>{this._disposed||(this.log(`${n}: Loaded ${H} (${y.byteLength} bytes)`),o(new Uint8Array(y)))}),!0,(y=>{G(new e.l(`${n}: Failed to load '${H}'${y?": "+y.status+" "+y.statusText:""}`,y))}))}))))}static AddPointerMetadata(n,y){n.metadata=n.metadata||{};const H=n._internalMetadata=n._internalMetadata||{},o=H.rh=H.rh||{};(o.pointers=o.pointers||[]).push(y)}static _GetTextureWrapMode(n,y){switch(y=void 0==y?10497:y){case 33071:return F.b.CLAMP_ADDRESSMODE;case 33648:return F.b.MIRROR_ADDRESSMODE;case 10497:return F.b.WRAP_ADDRESSMODE;default:return W.d.Warn(`${n}: Invalid value (${y})`),F.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(n,y){const H=void 0==y.magFilter?9729:y.magFilter,o=void 0==y.minFilter?9987:y.minFilter;if(9729===H)switch(o){case 9728:return F.b.LINEAR_NEAREST;case 9729:return F.b.LINEAR_LINEAR;case 9984:return F.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return F.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return F.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return F.b.LINEAR_LINEAR_MIPLINEAR;default:return W.d.Warn(`${n}/minFilter: Invalid value (${o})`),F.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==H&&W.d.Warn(`${n}/magFilter: Invalid value (${H})`),o){case 9728:return F.b.NEAREST_NEAREST;case 9729:return F.b.NEAREST_LINEAR;case 9984:return F.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return F.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return F.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return F.b.NEAREST_LINEAR_MIPLINEAR;default:return W.d.Warn(`${n}/minFilter: Invalid value (${o})`),F.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(n,y){try{return(0,r.r)(y)}catch(H){throw new Error(`${n}: ${H.message}`)}}static _GetTypedArray(n,y,H,o,G){const h=H.buffer;o=H.byteOffset+(o||0);const k=D._GetTypedArrayConstructor(`${n}/componentType`,y),i=M.g.GetTypeByteLength(y);return o%i!==0?(W.d.Warn(`${n}: Copying buffer as byte offset (${o}) is not a multiple of component type byte length (${i})`),new k(h.slice(o,o+G*i),0)):new k(h,o,G)}static _GetNumComponents(n,y){switch(y){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${n}: Invalid type (${y})`)}static _ValidateUri(n){return k.Tools.IsBase64(n)||-1===n.indexOf("..")}static _GetDrawMode(n,y){switch(void 0==y&&(y=4),y){case 0:return l.e.PointListDrawMode;case 1:return l.e.LineListDrawMode;case 2:return l.e.LineLoopDrawMode;case 3:return l.e.LineStripDrawMode;case 4:return l.e.TriangleFillMode;case 5:return l.e.TriangleStripDrawMode;case 6:return l.e.TriangleFanDrawMode}throw new Error(`${n}: Invalid mesh primitive mode (${y})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const n=new Array;if(this._gltf.materials)for(const y of this._gltf.materials)if(y._data)for(const H in y._data){const o=y._data[H];for(const y of o.babylonMeshes){y.Qi(!0);const H=o.babylonMaterial;n.push(H.forceCompilationAsync(y)),n.push(H.forceCompilationAsync(y,{useInstances:!0})),this._parent.useClipPlane&&(n.push(H.forceCompilationAsync(y,{clipPlane:!0})),n.push(H.forceCompilationAsync(y,{clipPlane:!0,useInstances:!0})))}}return Promise.all(n).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const n=new Array,y=this._babylonScene.lights;for(const H of y){const y=H.getShadowGenerator();y&&n.push(y.forceCompilationAsync())}return Promise.all(n).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(n){for(const y of this._extensions)y.enabled&&n(y)}_applyExtensions(n,y,H){for(const o of this._extensions)if(o.enabled){const G=`${o.name}.${y}`,h=n;h._activeLoaderExtensionFunctions=h._activeLoaderExtensionFunctions||{};const k=h._activeLoaderExtensionFunctions;if(!k[G]){k[G]=!0;try{const n=H(o);if(n)return n}finally{delete k[G]}}}return null}_extensionsOnLoading(){this._forEachExtensions((n=>n.onLoading&&n.onLoading()))}_extensionsOnReady(){this._forEachExtensions((n=>n.onReady&&n.onReady()))}_extensionsLoadSceneAsync(n,y){return this._applyExtensions(y,"loadScene",(H=>H.loadSceneAsync&&H.loadSceneAsync(n,y)))}_extensionsLoadNodeAsync(n,y,H){return this._applyExtensions(y,"loadNode",(o=>o.loadNodeAsync&&o.loadNodeAsync(n,y,H)))}_extensionsLoadCameraAsync(n,y,H){return this._applyExtensions(y,"loadCamera",(o=>o.loadCameraAsync&&o.loadCameraAsync(n,y,H)))}_extensionsLoadVertexDataAsync(n,y,H){return this._applyExtensions(y,"loadVertexData",(o=>o._loadVertexDataAsync&&o._loadVertexDataAsync(n,y,H)))}_extensionsLoadMeshPrimitiveAsync(n,y,H,o,G,h){return this._applyExtensions(G,"loadMeshPrimitive",(k=>k._loadMeshPrimitiveAsync&&k._loadMeshPrimitiveAsync(n,y,H,o,G,h)))}_extensionsLoadMaterialAsync(n,y,H,o,G){return this._applyExtensions(y,"loadMaterial",(h=>h._loadMaterialAsync&&h._loadMaterialAsync(n,y,H,o,G)))}_extensionsCreateMaterial(n,y,H){return this._applyExtensions(y,"createMaterial",(o=>o.createMaterial&&o.createMaterial(n,y,H)))}_extensionsLoadMaterialPropertiesAsync(n,y,H){return this._applyExtensions(y,"loadMaterialProperties",(o=>o.loadMaterialPropertiesAsync&&o.loadMaterialPropertiesAsync(n,y,H)))}_extensionsLoadTextureInfoAsync(n,y,H){return this._applyExtensions(y,"loadTextureInfo",(o=>o.loadTextureInfoAsync&&o.loadTextureInfoAsync(n,y,H)))}_extensionsLoadTextureAsync(n,y,H){return this._applyExtensions(y,"loadTexture",(o=>o._loadTextureAsync&&o._loadTextureAsync(n,y,H)))}_extensionsLoadAnimationAsync(n,y){return this._applyExtensions(y,"loadAnimation",(H=>H.loadAnimationAsync&&H.loadAnimationAsync(n,y)))}_extensionsLoadAnimationChannelAsync(n,y,H,o,G){return this._applyExtensions(H,"loadAnimationChannel",(h=>h._loadAnimationChannelAsync&&h._loadAnimationChannelAsync(n,y,H,o,G)))}_extensionsLoadSkinAsync(n,y,H){return this._applyExtensions(H,"loadSkin",(o=>o._loadSkinAsync&&o._loadSkinAsync(n,y,H)))}_extensionsLoadUriAsync(n,y,H){return this._applyExtensions(y,"loadUri",(o=>o._loadUriAsync&&o._loadUriAsync(n,y,H)))}_extensionsLoadBufferViewAsync(n,y){return this._applyExtensions(y,"loadBufferView",(H=>H.loadBufferViewAsync&&H.loadBufferViewAsync(n,y)))}_extensionsLoadBufferAsync(n,y,H,o){return this._applyExtensions(y,"loadBuffer",(G=>G.loadBufferAsync&&G.loadBufferAsync(n,y,H,o)))}static LoadExtensionAsync(n,y,H,o){if(!y.extensions)return null;const G=y.extensions[H];return G?o(`${n}/extensions/${H}`,G):null}static LoadExtraAsync(n,y,H,o){if(!y.extras)return null;const G=y.extras[H];return G?o(`${n}/extras/${H}`,G):null}isExtensionUsed(n){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(n)}logOpen(n){this._parent._logOpen(n)}logClose(){this._parent._logClose()}log(n){this._parent._log(n)}startPerformanceCounter(n){this._parent._startPerformanceCounter(n)}endPerformanceCounter(n){this._parent._endPerformanceCounter(n)}}D.DefaultSampler={index:-1},O.b._CreateGLTF2Loader=n=>new D(n);var Z=H(13069),s=H(11500),P=H(11325),x=H(13078),t=H(13086);class u extends t.b{constructor(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,B=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",n),this._texture=n.getEngine().createRawCubeTexture(y,H,o,G,h,k,i,B)}update(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,n,y,H,o,G)}updateRGBDAsync(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,x.i)(this._texture,n,y,H,o).then((()=>{}))}clone(){return P.c.Clone((()=>{const n=this.pn(),y=this._texture,H=new u(n,y._bufferViewArray,y.width,y.format,y.type,y.generateMipMaps,y.invertY,y.samplingMode,y._compression);return 13===y.source&&H.updateRGBDAsync(y._bufferViewArrayArray,y._sphericalPolynomial,y._lodGenerationScale,y._lodGenerationOffset),H}),this)}}const L="EXT_lights_image_based";class J{constructor(n){this.name=L,this._loader=n,this.enabled=this._loader.isExtensionUsed(L)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.rh.extensions;if(n&&n[this.name]){const y=n[this.name];this._lights=y.lights}}loadSceneAsync(n,y){return D.LoadExtensionAsync(n,y,this.name,(async(H,o)=>{this._loader._allMaterialsDirtyRequired=!0;const G=new Array;G.push(this._loader.loadSceneAsync(n,y)),this._loader.logOpen(`${H}`);const h=K.Get(`${H}/light`,this._lights,o.zh);return G.push(this._loadLightAsync(`/extensions/${this.name}/lights/${o.zh}`,h).then((n=>{this._loader.babylonScene.environmentTexture=n}))),this._loader.logClose(),await Promise.all(G).then((()=>{}))}))}_loadLightAsync(n,y){if(!y._loaded){const H=new Array;this._loader.logOpen(`${n}`);const o=new Array(y.specularImages.length);for(let G=0;G<y.specularImages.length;G++){const h=y.specularImages[G];o[G]=new Array(h.length);for(let y=0;y<h.length;y++){const k=`${n}/specularImages/${G}/${y}`;this._loader.logOpen(`${k}`);const i=h[y],B=K.Get(k,this._loader.rh.images,i);H.push(this._loader.loadImageAsync(`/images/${i}`,B).then((n=>{o[G][y]=n}))),this._loader.logClose()}}this._loader.logClose(),y._loaded=Promise.all(H).then((async()=>{const H=new u(this._loader.babylonScene,null,y.specularImageSize);if(H.name=y.name||"environment",y._babylonTexture=H,void 0!=y.di&&(H.level=y.di),y.rotation){let n=G.Quaternion.gy(y.rotation);this._loader.babylonScene.useRightHandedSystem||(n=G.Quaternion.Inverse(n)),G.Matrix.FromQuaternionToRef(n,H.getReflectionTextureMatrix())}if(!y.irradianceCoefficients)throw new Error(`${n}: Irradiance coefficients are missing`);const h=s.b.gy(y.irradianceCoefficients);h.scaleInPlace(y.di),h.convertIrradianceToLambertianRadiance();const k=s.f.FromHarmonics(h),i=(o.length-1)/Math.log2(y.specularImageSize);return await H.updateRGBDAsync(o,k,i)}))}return y._loaded.then((()=>y._babylonTexture))}}C(L),R(L,!0,(n=>new J(n)));H(11938);const m="EXT_mesh_gpu_instancing";class nn{constructor(n){this.name=m,this._loader=n,this.enabled=this._loader.isExtensionUsed(m)}dispose(){this._loader=null}loadNodeAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(n,o)=>{this._loader._disableInstancedMesh++;const h=this._loader.loadNodeAsync(`/nodes/${y.index}`,y,H);if(this._loader._disableInstancedMesh--,!y._primitiveBabylonMeshes)return await h;const k=new Array;let i=0;const B=y=>{if(void 0==o.attributes[y])return void k.push(Promise.resolve(null));const H=K.Get(`${n}/attributes/${y}`,this._loader.rh.accessors,o.attributes[y]);if(k.push(this._loader._loadFloatAccessorAsync(`/accessors/${H.bufferView}`,H)),0===i)i=H.count;else if(i!==H.count)throw new Error(`${n}/attributes: Instance buffer accessors do not have the same count.`)};return B("TRANSLATION"),B("ROTATION"),B("SCALE"),await h.then((async n=>{const[H,o,h]=await Promise.all(k),B=new Float32Array(16*i);G.TmpVectors.zy[0].Mi(0,0,0),G.TmpVectors.Quaternion[0].Mi(0,0,0,1),G.TmpVectors.zy[1].Mi(1,1,1);for(let y=0;y<i;++y)H&&G.zy.FromArrayToRef(H,3*y,G.TmpVectors.zy[0]),o&&G.Quaternion.FromArrayToRef(o,4*y,G.TmpVectors.Quaternion[0]),h&&G.zy.FromArrayToRef(h,3*y,G.TmpVectors.zy[1]),G.Matrix.ComposeToRef(G.TmpVectors.zy[1],G.TmpVectors.Quaternion[0],G.TmpVectors.zy[0],G.TmpVectors.Matrix[0]),G.TmpVectors.Matrix[0].copyToArray(B,16*y);for(const G of y._primitiveBabylonMeshes)G.kA("matrix",B,16,!0);return n}))}))}}C(m),R(m,!0,(n=>new nn(n)));let yn=0,Hn=null;class on{static get Default(){return on._Default||(on._Default=new on),on._Default}constructor(){const n=on.Configuration.decoder;this._decoderModulePromise=k.Tools.LoadBabylonScriptAsync(n.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(n,y,H,o,G){await this._decoderModulePromise,0===yn&&(MeshoptDecoder.useWorkers(1),yn=1);const h=await MeshoptDecoder.decodeGltfBufferAsync(y,H,n,o,G);return null!==Hn&&clearTimeout(Hn),Hn=setTimeout((()=>{MeshoptDecoder.useWorkers(0),yn=0,Hn=null}),1e3),h}}on.Configuration={decoder:{url:`${k.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},on._Default=null;const Gn="EXT_meshopt_compression";class hn{constructor(n){this.name=Gn,this.enabled=n.isExtensionUsed(Gn),this._loader=n}dispose(){this._loader=null}loadBufferViewAsync(n,y){return D.LoadExtensionAsync(n,y,this.name,(async(H,o)=>{const G=y;if(G._meshOptData)return await G._meshOptData;const h=K.Get(`${n}/buffer`,this._loader.rh.buffers,o.buffer);return G._meshOptData=this._loader.loadBufferAsync(`/buffers/${h.index}`,h,o.byteOffset||0,o.byteLength).then((async n=>await on.Default.decodeGltfBufferAsync(n,o.count,o.byteStride,o.mode,o.filter))),await G._meshOptData}))}}C(Gn),R(Gn,!0,(n=>new hn(n)));const kn="EXT_texture_webp";class Bn{constructor(n){this.name=kn,this._loader=n,this.enabled=n.isExtensionUsed(kn)}dispose(){this._loader=null}_loadTextureAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=void 0==y.sampler?D.DefaultSampler:K.Get(`${n}/sampler`,this._loader.rh.samplers,y.sampler),k=K.Get(`${o}/source`,this._loader.rh.images,G.source);return await this._loader._createTextureAsync(n,h,k,(n=>{H(n)}),void 0,!y._textureInfo.nonColorData)}))}}C(kn),R(kn,!0,(n=>new Bn(n)));const Vn="EXT_texture_avif";class qn{constructor(n){this.name=Vn,this._loader=n,this.enabled=n.isExtensionUsed(Vn)}dispose(){this._loader=null}_loadTextureAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=void 0==y.sampler?D.DefaultSampler:K.Get(`${n}/sampler`,this._loader.rh.samplers,y.sampler),k=K.Get(`${o}/source`,this._loader.rh.images,G.source);return await this._loader._createTextureAsync(n,h,k,(n=>{H(n)}),void 0,!y._textureInfo.nonColorData)}))}}C(Vn),R(Vn,!0,(n=>new qn(n)));var bn=H(13065),An=H(11907);const Un="EXT_lights_ies";class Tn{constructor(n){this.name=Un,this._loader=n,this.enabled=this._loader.isExtensionUsed(Un)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.rh.extensions;if(n&&n[this.name]){const y=n[this.name];this._lights=y.lights,K.Assign(this._lights)}}loadNodeAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,k)=>{let i,B;this._loader._allMaterialsDirtyRequired=!0;const V=await this._loader.loadNodeAsync(n,y,(n=>{B=K.Get(o,this._lights,k.zh);const y=B.name||n.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,i=new bn.b(y,G.zy.Zero(),G.zy.Backward(),0,1,this._loader.babylonScene),i.angle=Math.PI/2,i.innerAngle=0,i._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,B._babylonLight=i,i.falloffType=An.e.FALLOFF_GLTF,i.ai=k.color?h.Fy.gy(k.color):h.Fy.White(),i.di=k.multiplier||1,i.range=Number.MAX_VALUE,i.parent=n,this._loader._babylonLights.push(i),D.AddPointerMetadata(i,o),H(n)}));let q;if(B.uri)q=await this._loader.loadUriAsync(n,B,B.uri);else{const y=K.Get(`${n}/bufferView`,this._loader.rh.bufferViews,B.bufferView);q=await this._loader.loadBufferViewAsync(`/bufferViews/${y.index}`,y)}return i.iesProfileTexture=new F.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,q,!0,void 0,void 0,void 0,void 0,".ies"),V}))}}C(Un),R(Un,!0,(n=>new Tn(n)));var Wn=H(13099);const zn="KHR_draco_mesh_compression";class Qn{constructor(n){this.name=zn,this.useNormalizedFlagFromAccessor=!0,this._loader=n,this.enabled=Wn.e.DefaultAvailable&&this._loader.isExtensionUsed(zn)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{if(void 0!=y.mode&&4!==y.mode&&5!==y.mode)throw new Error(`${n}: Unsupported mode ${y.mode}`);const h={},k={},i=(n,o)=>{const i=G.attributes[n];if(void 0!=i&&(H._delayInfo=H._delayInfo||[],-1===H._delayInfo.indexOf(o)&&H._delayInfo.push(o),h[o]=i,this.useNormalizedFlagFromAccessor)){const H=K.TryGet(this._loader.rh.accessors,y.attributes[n]);H&&(k[o]=H.normalized||!1)}};i("POSITION",M.g.PositionKind),i("NORMAL",M.g.NormalKind),i("TANGENT",M.g.TangentKind),i("TEXCOORD_0",M.g.UVKind),i("TEXCOORD_1",M.g.UV2Kind),i("TEXCOORD_2",M.g.UV3Kind),i("TEXCOORD_3",M.g.UV4Kind),i("TEXCOORD_4",M.g.UV5Kind),i("TEXCOORD_5",M.g.UV6Kind),i("JOINTS_0",M.g.MatricesIndicesKind),i("WEIGHTS_0",M.g.MatricesWeightsKind),i("COLOR_0",M.g.ColorKind);const B=K.Get(o,this._loader.rh.bufferViews,G.bufferView);return B._dracoBabylonGeometry||(B._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((async o=>{const G=this.dracoDecoder||Wn.e.Default,i=K.TryGet(this._loader.rh.accessors,y.attributes.POSITION),B=this._loader.parent.alwaysComputeBoundingBox||H.skeleton||!i?null:Y(i);return await G._decodeMeshToGeometryForGltfAsync(H.name,this._loader.babylonScene,o,h,k,B).catch((y=>{throw new Error(`${n}: ${y.message}`)}))}))),await B._dracoBabylonGeometry}))}}C(zn),R(zn,!0,(n=>new Qn(n)));var ln=H(13102),vn=H(11278),Fn=H(11280),gn=H(11775),Mn=H(11972),fn=H(11248);gn.c.AddNodeConstructor("Light_Type_0",((n,y)=>()=>new cn(n,G.zy.Zero(),y)));class cn extends Mn.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(n){this._shadowAngle=n,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(n){const y=this.needCube();if(this._direction=n,this.needCube()!==y&&this._shadowGenerators){const n=this._shadowGenerators.values();for(let y=n.next();!0!==y.done;y=n.next()){y.value.recreateShadowMap()}}}constructor(n,y,H){super(n,H),this._shadowAngle=Math.PI/2,this.position=y}getClassName(){return"PointLight"}getTypeID(){return An.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(n){if(this.direction)return super.getShadowDirection(n);switch(n){case 0:return new G.zy(1,0,0);case 1:return new G.zy(-1,0,0);case 2:return new G.zy(0,-1,0);case 3:return new G.zy(0,1,0);case 4:return new G.zy(0,0,1);case 5:return new G.zy(0,0,-1)}return G.zy.Zero()}_setDefaultShadowProjectionMatrix(n,y,H){const o=this.pn().activeCamera;if(!o)return;const h=void 0!==this.shadowMinZ?this.shadowMinZ:o.Wi,k=void 0!==this.shadowMaxZ?this.shadowMaxZ:o.maxZ,i=this.pn().getEngine().useReverseDepthBuffer;G.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,i?k:h,i?h:k,n,!0,this._scene.getEngine().isNDCHalfZRange,void 0,i)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(n,y){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,y):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,y),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,y),this}transferToNodeMaterialEffect(n,y){return this.computeTransformedInformation()?n.setFloat3(y,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):n.setFloat3(y,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(n,y){n["POINTLIGHT"+y]=!0}}(0,vn.e)([(0,Fn.J)()],cn.prototype,"shadowAngle",null),(0,fn.h)("BABYLON.PointLight",cn);const pn="KHR_lights_punctual";class En{constructor(n){this.name=pn,this._loader=n,this.enabled=this._loader.isExtensionUsed(pn)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.rh.extensions;if(n&&n[this.name]){const y=n[this.name];this._lights=y.lights,K.Assign(this._lights)}}loadNodeAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,k)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(n,y,(n=>{let y;const i=K.Get(o,this._lights,k.zh),B=i.name||n.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,i.type){case"directional":{const n=new ln.c(B,G.zy.Backward(),this._loader.babylonScene);n.position.ci(0),y=n;break}case"point":y=new cn(B,G.zy.Zero(),this._loader.babylonScene);break;case"spot":{const n=new bn.b(B,G.zy.Zero(),G.zy.Backward(),0,1,this._loader.babylonScene);n.angle=2*(i.spot&&i.spot.outerConeAngle||Math.PI/4),n.innerAngle=2*(i.spot&&i.spot.innerConeAngle||0),y=n;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${o}: Invalid light type (${i.type})`)}y._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,i._babylonLight=y,y.falloffType=An.e.FALLOFF_GLTF,y.ai=i.color?h.Fy.gy(i.color):h.Fy.White(),y.di=void 0==i.di?1:i.di,y.range=void 0==i.range?Number.MAX_VALUE:i.range,y.parent=n,this._loader._babylonLights.push(y),D.AddPointerMetadata(y,o),H(n)})))))}}C(pn),R(pn,!0,(n=>new En(n)));const Xn="KHR_materials_pbrSpecularGlossiness";class dn{constructor(n){this.name=Xn,this.order=200,this._loader=n,this.enabled=this._loader.isExtensionUsed(Xn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialBasePropertiesAsync(n,y,H)),h.push(this._loadSpecularGlossinessPropertiesAsync(o,G,H)),this._loader.loadMaterialAlphaProperties(n,y,H),await Promise.all(h).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return H.metallic=null,H.roughness=null,y.diffuseFactor?(H.albedoColor=h.Fy.gy(y.diffuseFactor),H.alpha=y.diffuseFactor[3]):H.albedoColor=h.Fy.White(),H.reflectivityColor=y.specularFactor?h.Fy.gy(y.specularFactor):h.Fy.White(),H.microSurface=void 0==y.glossinessFactor?1:y.glossinessFactor,y.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/diffuseTexture`,y.diffuseTexture,(n=>{n.name=`${H.name} (Diffuse)`,H.albedoTexture=n}))),y.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync(`${n}/specularGlossinessTexture`,y.specularGlossinessTexture,(n=>{n.name=`${H.name} (Specular Glossiness)`,H.reflectivityTexture=n,H.reflectivityTexture.Ti=!0}))),H.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then((()=>{}))}}C(Xn),R(Xn,!0,(n=>new dn(n)));const an="KHR_materials_unlit";class On{constructor(n){this.name=an,this.order=210,this._loader=n,this.enabled=this._loader.isExtensionUsed(an)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async()=>await this._loadUnlitPropertiesAsync(n,y,H)))}_loadUnlitPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;H.unlit=!0;const G=y.pbrMetallicRoughness;return G&&(G.baseColorFactor?(H.albedoColor=h.Fy.gy(G.baseColorFactor),H.alpha=G.baseColorFactor[3]):H.albedoColor=h.Fy.White(),G.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/baseColorTexture`,G.baseColorTexture,(n=>{n.name=`${H.name} (Base Color)`,H.albedoTexture=n})))),y.doubleSided&&(H.gi=!1,H.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(n,y,H),Promise.all(o).then((()=>{}))}}C(an),R(an,!0,(n=>new On(n)));const en="KHR_materials_clearcoat";class wn{constructor(n){this.name=en,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(en)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadClearCoatPropertiesAsync(o,G,H)),await Promise.all(h)}))}_loadClearCoatPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return H.clearCoat.isEnabled=!0,H.clearCoat.useRoughnessFromMainTexture=!1,H.clearCoat.remapF0OnInterfaceChange=!1,void 0!=y.clearcoatFactor?H.clearCoat.di=y.clearcoatFactor:H.clearCoat.di=0,y.clearcoatTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/clearcoatTexture`,y.clearcoatTexture,(n=>{n.name=`${H.name} (ClearCoat)`,H.clearCoat.texture=n}))),void 0!=y.clearcoatRoughnessFactor?H.clearCoat.roughness=y.clearcoatRoughnessFactor:H.clearCoat.roughness=0,y.clearcoatRoughnessTexture&&(y.clearcoatRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${n}/clearcoatRoughnessTexture`,y.clearcoatRoughnessTexture,(n=>{n.name=`${H.name} (ClearCoat Roughness)`,H.clearCoat.textureRoughness=n})))),y.clearcoatNormalTexture&&(y.clearcoatNormalTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${n}/clearcoatNormalTexture`,y.clearcoatNormalTexture,(n=>{n.name=`${H.name} (ClearCoat Normal)`,H.clearCoat.bumpTexture=n}))),H.invertNormalMapX=!H.pn().useRightHandedSystem,H.invertNormalMapY=H.pn().useRightHandedSystem,void 0!=y.clearcoatNormalTexture.scale&&(H.clearCoat.bumpTexture.level=y.clearcoatNormalTexture.scale)),Promise.all(o).then((()=>{}))}}C(en),R(en,!0,(n=>new wn(n)));const jn="KHR_materials_iridescence";class In{constructor(n){this.name=jn,this.order=195,this._loader=n,this.enabled=this._loader.isExtensionUsed(jn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadIridescencePropertiesAsync(o,G,H)),await Promise.all(h).then((()=>{}))}))}_loadIridescencePropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return H.iridescence.isEnabled=!0,H.iridescence.di=y.iridescenceFactor??0,H.iridescence.indexOfRefraction=y.iridescenceIor??y.iridescenceIOR??1.3,H.iridescence.minimumThickness=y.iridescenceThicknessMinimum??100,H.iridescence.maximumThickness=y.iridescenceThicknessMaximum??400,y.iridescenceTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/iridescenceTexture`,y.iridescenceTexture,(n=>{n.name=`${H.name} (Iridescence)`,H.iridescence.texture=n}))),y.iridescenceThicknessTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/iridescenceThicknessTexture`,y.iridescenceThicknessTexture,(n=>{n.name=`${H.name} (Iridescence Thickness)`,H.iridescence.thicknessTexture=n}))),Promise.all(o).then((()=>{}))}}C(jn),R(jn,!0,(n=>new In(n)));const Rn="KHR_materials_anisotropy";class Cn{constructor(n){this.name=Rn,this.order=195,this._loader=n,this.enabled=this._loader.isExtensionUsed(Rn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadIridescencePropertiesAsync(o,G,H)),await Promise.all(h)}))}async _loadIridescencePropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;H.anisotropy.isEnabled=!0,H.anisotropy.di=y.anisotropyStrength??0,H.anisotropy.angle=y.anisotropyRotation??0,y.anisotropyTexture&&(y.anisotropyTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${n}/anisotropyTexture`,y.anisotropyTexture,(n=>{n.name=`${H.name} (Anisotropy Intensity)`,H.anisotropy.texture=n})))),await Promise.all(o)}}C(Rn),R(Rn,!0,(n=>new Cn(n)));const Sn="KHR_materials_emissive_strength";class Nn{constructor(n){this.name=Sn,this.order=170,this._loader=n,this.enabled=this._loader.isExtensionUsed(Sn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>await this._loader.loadMaterialPropertiesAsync(n,y,H).then((()=>{this._loadEmissiveProperties(o,G,H)}))))}_loadEmissiveProperties(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);void 0!==y.emissiveStrength&&(H.emissiveIntensity=y.emissiveStrength)}}C(Sn),R(Sn,!0,(n=>new Nn(n)));const rn="KHR_materials_sheen";class Kn{constructor(n){this.name=rn,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(rn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadSheenPropertiesAsync(o,G,H)),await Promise.all(h).then((()=>{}))}))}_loadSheenPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return H.sheen.isEnabled=!0,H.sheen.di=1,void 0!=y.sheenColorFactor?H.sheen.color=h.Fy.gy(y.sheenColorFactor):H.sheen.color=h.Fy.Black(),y.sheenColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/sheenColorTexture`,y.sheenColorTexture,(n=>{n.name=`${H.name} (Sheen Color)`,H.sheen.texture=n}))),void 0!==y.sheenRoughnessFactor?H.sheen.roughness=y.sheenRoughnessFactor:H.sheen.roughness=0,y.sheenRoughnessTexture&&(y.sheenRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${n}/sheenRoughnessTexture`,y.sheenRoughnessTexture,(n=>{n.name=`${H.name} (Sheen Roughness)`,H.sheen.textureRoughness=n})))),H.sheen.albedoScaling=!0,H.sheen.useRoughnessFromMainTexture=!1,Promise.all(o).then((()=>{}))}}C(rn),R(rn,!0,(n=>new Kn(n)));var Yn=H(11839);const Dn="KHR_materials_specular";class Zn{constructor(n){this.name=Dn,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(Dn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;if(h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadSpecularPropertiesAsync(o,G,H)),G.extensions&&G.extensions.EXT_materials_specular_edge_color&&H instanceof v.e){G.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(H.brdf.dielectricSpecularModel=Yn.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,H.brdf.conductorSpecularModel=Yn.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(h).then((()=>{}))}))}_loadSpecularPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return void 0!==y.specularFactor&&(H.metallicF0Factor=y.specularFactor),void 0!==y.specularColorFactor&&(H.metallicReflectanceColor=h.Fy.gy(y.specularColorFactor)),y.specularTexture&&(y.specularTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync(`${n}/specularTexture`,y.specularTexture,(n=>{n.name=`${H.name} (Specular)`,H.metallicReflectanceTexture=n,H.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),y.specularColorTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/specularColorTexture`,y.specularColorTexture,(n=>{n.name=`${H.name} (Specular Color)`,H.reflectanceTexture=n}))),Promise.all(o).then((()=>{}))}}C(Dn),R(Dn,!0,(n=>new Zn(n)));const sn="KHR_materials_ior";class Pn{constructor(n){this.name=sn,this.order=180,this._loader=n,this.enabled=this._loader.isExtensionUsed(sn)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadIorPropertiesAsync(o,G,H)),await Promise.all(h).then((()=>{}))}))}_loadIorPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);return void 0!==y.ior?H.indexOfRefraction=y.ior:H.indexOfRefraction=Pn._DEFAULT_IOR,Promise.resolve()}}Pn._DEFAULT_IOR=1.5,C(sn),R(sn,!0,(n=>new Pn(n)));const xn="KHR_materials_variants";class tn{constructor(n){this.name=xn,this._loader=n,this.enabled=this._loader.isExtensionUsed(xn)}dispose(){this._loader=null}static GetAvailableVariants(n){const y=this._GetExtensionMetadata(n);return y?Object.keys(y.variants):[]}getAvailableVariants(n){return tn.GetAvailableVariants(n)}static SelectVariant(n,y){const H=this._GetExtensionMetadata(n);if(!H)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${xn} extension`);const o=n=>{const y=H.variants[n];if(y)for(const H of y)H.mesh.material=H.material};if(y instanceof Array)for(const G of y)o(G);else o(y);H.lastSelected=y}selectVariant(n,y){tn.SelectVariant(n,y)}static Reset(n){const y=this._GetExtensionMetadata(n);if(!y)throw new Error(`Cannot reset on a glTF mesh that does not have the ${xn} extension`);for(const H of y.original)H.mesh.material=H.material;y.lastSelected=null}reset(n){tn.Reset(n)}static GetLastSelectedVariant(n){const y=this._GetExtensionMetadata(n);if(!y)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${xn} extension`);return y.lastSelected}getLastSelectedVariant(n){return tn.GetLastSelectedVariant(n)}static _GetExtensionMetadata(n){var y,H;return(null===n||void 0===n||null===(y=n._internalMetadata)||void 0===y||null===(H=y.rh)||void 0===H?void 0:H[xn])||null}onLoading(){const n=this._loader.rh.extensions;if(n&&n[this.name]){const y=n[this.name];this._variants=y.variants}}onReady(){const n=this._loader.rootBabylonMesh;if(n){var y;const H=this._loader.parent.extensionOptions[xn];null!==H&&void 0!==H&&H.defaultVariant&&tn.SelectVariant(n,H.defaultVariant),null===H||void 0===H||null===(y=H.onLoaded)||void 0===y||y.call(H,{get variants(){return tn.GetAvailableVariants(n)},get selectedVariant(){const y=tn.GetLastSelectedVariant(n);return y?Array.isArray(y)?y[0]:y:tn.GetAvailableVariants(n)[0]},set selectedVariant(y){tn.SelectVariant(n,y)}})}}_loadMeshPrimitiveAsync(n,y,H,o,G,h){return D.LoadExtensionAsync(n,G,this.name,(async(k,i)=>{const B=new Array;return B.push(this._loader._loadMeshPrimitiveAsync(n,y,H,o,G,(y=>{if(h(y),y instanceof p.b){const H=D._GetDrawMode(n,G.mode),o=this._loader.rootBabylonMesh,h=o?o._internalMetadata=o._internalMetadata||{}:{},V=h.rh=h.rh||{},q=V[xn]=V[xn]||{lastSelected:null,original:[],variants:{}};q.original.push({mesh:y,material:y.material});for(let n=0;n<i.mappings.length;++n){const G=i.mappings[n],h=K.Get(`${k}/mappings/${n}/material`,this._loader.rh.materials,G.material);B.push(this._loader._loadMaterialAsync(`#/materials/${G.material}`,h,y,H,(n=>{for(let H=0;H<G.variants.length;++H){const h=G.variants[H],k=K.Get(`/extensions/${xn}/variants/${h}`,this._variants,h);q.variants[k.name]=q.variants[k.name]||[],q.variants[k.name].push({mesh:y,material:n}),y.onClonedObservable.add((n=>{const H=n;let G=null,h=H;do{if(h=h.parent,!h)return;G=tn._GetExtensionMetadata(h)}while(null===G);if(o&&G===tn._GetExtensionMetadata(o)){h._internalMetadata={};for(const n in o._internalMetadata)h._internalMetadata[n]=o._internalMetadata[n];h._internalMetadata.rh=[];for(const n in o._internalMetadata.rh)h._internalMetadata.rh[n]=o._internalMetadata.rh[n];h._internalMetadata.rh[xn]={lastSelected:null,original:[],variants:{}};for(const n of G.original)h._internalMetadata.rh[xn].original.push({mesh:n.mesh,material:n.material});for(const n in G.variants)if(Object.prototype.hasOwnProperty.call(G.variants,n)){h._internalMetadata.rh[xn].variants[n]=[];for(const y of G.variants[n])h._internalMetadata.rh[xn].variants[n].push({mesh:y.mesh,material:y.material})}G=h._internalMetadata.rh[xn]}for(const o of G.original)o.mesh===y&&(o.mesh=H);for(const o of G.variants[k.name])o.mesh===y&&(o.mesh=H)}))}})))}}}))),await Promise.all(B).then((n=>{let[y]=n;return y}))}))}}C(xn),R(xn,!0,(n=>new tn(n)));var un=H(11349);class Ln{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Yn.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(n,y){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Ln._GetDefaultOptions(),...n},this._scene=y,this._scene._transmissionHelper=this,this.onErrorObservable=new q.c,this._scene.ah.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(n){if(!Object.keys(n).filter((y=>this._options[y]!==n[y])).length)return;const y={...this._options,...n},H=this._options;this._options=y,y.renderSize===H.renderSize&&y.renderTargetTextureType===H.renderTargetTextureType&&y.generateMipmaps===H.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=y.samples,this._opaqueRenderTarget.lodGenerationScale=y.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=y.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(n){return!!n&&!!(n instanceof v.e&&n.subSurface.isRefractionEnabled)}_addMesh(n){this._materialObservers[n.uniqueId]=n.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),k.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(n.material)?(n.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(n)&&this._transparentMeshesCache.push(n)):-1===this._opaqueMeshesCache.indexOf(n)&&this._opaqueMeshesCache.push(n)}))}_removeMesh(n){n.onMaterialChangedObservable.remove(this._materialObservers[n.uniqueId]),delete this._materialObservers[n.uniqueId];let y=this._transparentMeshesCache.indexOf(n);-1!==y&&this._transparentMeshesCache.splice(y,1),y=this._opaqueMeshesCache.indexOf(n),-1!==y&&this._opaqueMeshesCache.splice(y,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(n){const y=this._transparentMeshesCache.indexOf(n),H=this._opaqueMeshesCache.indexOf(n);this._shouldRenderAsTransmission(n.material)?(n.material instanceof v.e&&(n.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==H?(this._opaqueMeshesCache.splice(H,1),this._transparentMeshesCache.push(n)):-1===y&&this._transparentMeshesCache.push(n)):-1!==y?(this._transparentMeshesCache.splice(y,1),this._opaqueMeshesCache.push(n)):-1===H&&this._opaqueMeshesCache.push(n)}_isRenderTargetValid(){var n;return null!==(null===(n=this._opaqueRenderTarget)||void 0===n?void 0:n.getInternalTexture())}_setupRenderTargets(){var n;let y;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new un.e("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(n=this._options.clearColor)||void 0===n?void 0:n.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((n=>{y=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?n.clearColor.B(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(n.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=y}));for(const H of this._transparentMeshesCache)this._shouldRenderAsTransmission(H.material)&&(H.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Jn="KHR_materials_transmission";class mn{constructor(n){this.name=Jn,this.order=175,this._loader=n,this.enabled=this._loader.isExtensionUsed(Jn),this.enabled&&(n.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadTransparentPropertiesAsync(o,y,H,G)),await Promise.all(h).then((()=>{}))}))}_loadTransparentPropertiesAsync(n,y,H,o){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const G=H;if(G.subSurface.isRefractionEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.useAlbedoToTintRefraction=!0,void 0===o.transmissionFactor)return G.subSurface.refractionIntensity=0,G.subSurface.isRefractionEnabled=!1,Promise.resolve();{var h;G.subSurface.refractionIntensity=o.transmissionFactor;const n=G.pn();if(G.subSurface.refractionIntensity&&!n._transmissionHelper)new Ln({},G.pn());else if(G.subSurface.refractionIntensity&&(null===(h=n._transmissionHelper)||void 0===h||!h._isRenderTargetValid())){var k;null===(k=n._transmissionHelper)||void 0===k||k._setupRenderTargets()}}return G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=0,o.transmissionTexture?(o.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${n}/transmissionTexture`,o.transmissionTexture,void 0).then((n=>{n.name=`${H.name} (Transmission)`,G.subSurface.refractionIntensityTexture=n,G.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}C(Jn),R(Jn,!0,(n=>new mn(n)));const ny="KHR_materials_diffuse_transmission";class yy{constructor(n){this.name=ny,this.order=174,this._loader=n,this.enabled=this._loader.isExtensionUsed(ny),this.enabled&&(n.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadTranslucentPropertiesAsync(o,y,H,G)),await Promise.all(h).then((()=>{}))}))}_loadTranslucentPropertiesAsync(n,y,H,o){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const G=H;if(G.subSurface.isTranslucencyEnabled=!0,G.subSurface.volumeIndexOfRefraction=1,G.subSurface.minimumThickness=0,G.subSurface.maximumThickness=0,G.subSurface.useAlbedoToTintTranslucency=!1,void 0===o.diffuseTransmissionFactor)return G.subSurface.translucencyIntensity=0,G.subSurface.isTranslucencyEnabled=!1,Promise.resolve();G.subSurface.translucencyIntensity=o.diffuseTransmissionFactor;const k=new Array;return G.subSurface.useGltfStyleTextures=!0,o.diffuseTransmissionTexture&&(o.diffuseTransmissionTexture.nonColorData=!0,k.push(this._loader.loadTextureInfoAsync(`${n}/diffuseTransmissionTexture`,o.diffuseTransmissionTexture).then((n=>{n.name=`${H.name} (Diffuse Transmission)`,G.subSurface.translucencyIntensityTexture=n})))),void 0!==o.diffuseTransmissionColorFactor?G.subSurface.translucencyColor=h.Fy.gy(o.diffuseTransmissionColorFactor):G.subSurface.translucencyColor=h.Fy.White(),o.diffuseTransmissionColorTexture&&k.push(this._loader.loadTextureInfoAsync(`${n}/diffuseTransmissionColorTexture`,o.diffuseTransmissionColorTexture).then((n=>{n.name=`${H.name} (Diffuse Transmission Color)`,G.subSurface.translucencyColorTexture=n}))),Promise.all(k).then((()=>{}))}}C(ny),R(ny,!0,(n=>new yy(n)));const Hy="KHR_materials_volume";class oy{constructor(n){this.name=Hy,this.order=173,this._loader=n,this.enabled=this._loader.isExtensionUsed(Hy),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadVolumePropertiesAsync(o,y,H,G)),await Promise.all(h).then((()=>{}))}))}_loadVolumePropertiesAsync(n,y,H,o){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);if(!H.subSurface.isRefractionEnabled&&!H.subSurface.isTranslucencyEnabled||!o.thicknessFactor)return Promise.resolve();H.subSurface.volumeIndexOfRefraction=H.indexOfRefraction;const G=void 0!==o.attenuationDistance?o.attenuationDistance:Number.MAX_VALUE;return H.subSurface.tintColorAtDistance=G,void 0!==o.attenuationColor&&3==o.attenuationColor.length&&H.subSurface.tintColor.Mi(o.attenuationColor[0],o.attenuationColor[1],o.attenuationColor[2]),H.subSurface.minimumThickness=0,H.subSurface.maximumThickness=o.thicknessFactor,H.subSurface.useThicknessAsDepth=!0,o.thicknessTexture?(o.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${n}/thicknessTexture`,o.thicknessTexture).then((n=>{n.name=`${H.name} (Thickness)`,H.subSurface.thicknessTexture=n,H.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}C(Hy),R(Hy,!0,(n=>new oy(n)));const Gy="KHR_materials_dispersion";class hy{constructor(n){this.name=Gy,this.order=174,this._loader=n,this.enabled=this._loader.isExtensionUsed(Gy)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadDispersionPropertiesAsync(o,y,H,G)),await Promise.all(h).then((()=>{}))}))}_loadDispersionPropertiesAsync(n,y,H,o){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);return H.subSurface.isRefractionEnabled&&o.dispersion?(H.subSurface.isDispersionEnabled=!0,H.subSurface.dispersion=o.dispersion,Promise.resolve()):Promise.resolve()}}C(Gy),R(Gy,!0,(n=>new hy(n)));const ky="EXT_materials_diffuse_roughness";class iy{constructor(n){this.name=ky,this.order=190,this._loader=n,this.enabled=this._loader.isExtensionUsed(ky)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=new Array;return h.push(this._loader.loadMaterialPropertiesAsync(n,y,H)),h.push(this._loadDiffuseRoughnessPropertiesAsync(o,G,H)),await Promise.all(h).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(n,y,H){if(!(H instanceof v.e))throw new Error(`${n}: Material type not supported`);const o=new Array;return H.brdf.baseDiffuseModel=Yn.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=y.diffuseRoughnessFactor?H.baseDiffuseRoughness=y.diffuseRoughnessFactor:H.baseDiffuseRoughness=0,y.diffuseRoughnessTexture&&o.push(this._loader.loadTextureInfoAsync(`${n}/diffuseRoughnessTexture`,y.diffuseRoughnessTexture,(n=>{n.name=`${H.name} (Diffuse Roughness)`,H.baseDiffuseRoughnessTexture=n}))),Promise.all(o).then((()=>{}))}}C(ky),R(ky,!0,(n=>new iy(n)));const By="KHR_mesh_quantization";class Vy{constructor(n){this.name=By,this.enabled=n.isExtensionUsed(By)}dispose(){}}C(By),R(By,!0,(n=>new Vy(n)));const qy="KHR_texture_basisu";class by{constructor(n){this.name=qy,this._loader=n,this.enabled=n.isExtensionUsed(qy)}dispose(){this._loader=null}_loadTextureAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>{const h=void 0==y.sampler?D.DefaultSampler:K.Get(`${n}/sampler`,this._loader.rh.samplers,y.sampler),k=K.Get(`${o}/source`,this._loader.rh.images,G.source);return await this._loader._createTextureAsync(n,h,k,(n=>{H(n)}),y._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!y._textureInfo.nonColorData)}))}}C(qy),R(qy,!0,(n=>new by(n)));const Ay="KHR_texture_transform";class Uy{constructor(n){this.name=Ay,this._loader=n,this.enabled=this._loader.isExtensionUsed(Ay)}dispose(){this._loader=null}loadTextureInfoAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(o,G)=>await this._loader.loadTextureInfoAsync(n,y,(n=>{if(!(n instanceof F.b))throw new Error(`${o}: Texture type not supported`);G.offset&&(n.uOffset=G.offset[0],n.vOffset=G.offset[1]),n.uRotationCenter=0,n.vRotationCenter=0,G.rotation&&(n.wAng=-G.rotation),G.scale&&(n.uScale=G.scale[0],n.vScale=G.scale[1]),void 0!=G.texCoord&&(n.coordinatesIndex=G.texCoord),H(n)}))))}}C(Ay),R(Ay,!0,(n=>new Uy(n)));const Ty="KHR_xmp_json_ld";class Wy{constructor(n){this.name=Ty,this.order=100,this._loader=n,this.enabled=this._loader.isExtensionUsed(Ty)}dispose(){this._loader=null}onLoading(){var n,y,H;if(null===this._loader.rootBabylonMesh)return;const o=null===(n=this._loader.rh.extensions)||void 0===n?void 0:n.KHR_xmp_json_ld,G=null===(y=this._loader.rh.asset)||void 0===y||null===(H=y.extensions)||void 0===H?void 0:H.KHR_xmp_json_ld;if(o&&G){const n=+G.packet;o.packets&&n<o.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=o.packets[n])}}}function zy(n,y,H,o){return h.Fy.gy(y,H).scale(o)}function Qy(n,y,H,o){return y[H]*o}function ly(n,y,H,o){return-y[H]*o}function vy(n,y,H,o){return y[H+1]*o}function Fy(n,y,H,o){return y[H]*o*2}function gy(n){return{scale:[new fy(A.e.ANIMATIONTYPE_FLOAT,`${n}.uScale`,Qy,(()=>2)),new fy(A.e.ANIMATIONTYPE_FLOAT,`${n}.vScale`,vy,(()=>2))],offset:[new fy(A.e.ANIMATIONTYPE_FLOAT,`${n}.uOffset`,Qy,(()=>2)),new fy(A.e.ANIMATIONTYPE_FLOAT,`${n}.vOffset`,vy,(()=>2))],rotation:[new fy(A.e.ANIMATIONTYPE_FLOAT,`${n}.wAng`,ly,(()=>1))]}}C(Ty),R(Ty,!0,(n=>new Wy(n)));class My extends Z.AnimationPropertyInfo{buildAnimations(n,y,H,o){return[{babylonAnimatable:n._babylonCamera,babylonAnimation:this._buildAnimation(y,H,o)}]}}class fy extends Z.AnimationPropertyInfo{buildAnimations(n,y,H,o){const G=[];for(const h in n._data)G.push({babylonAnimatable:n._data[h].babylonMaterial,babylonAnimation:this._buildAnimation(y,H,o)});return G}}class cy extends Z.AnimationPropertyInfo{buildAnimations(n,y,H,o){return[{babylonAnimatable:n._babylonLight,babylonAnimation:this._buildAnimation(y,H,o)}]}}(0,S.i)("/cameras/{}/orthographic/xmag",[new My(A.e.ANIMATIONTYPE_FLOAT,"orthoLeft",ly,(()=>1)),new My(A.e.ANIMATIONTYPE_FLOAT,"orthoRight",vy,(()=>1))]),(0,S.i)("/cameras/{}/orthographic/ymag",[new My(A.e.ANIMATIONTYPE_FLOAT,"orthoBottom",ly,(()=>1)),new My(A.e.ANIMATIONTYPE_FLOAT,"orthoTop",vy,(()=>1))]),(0,S.i)("/cameras/{}/orthographic/zfar",[new My(A.e.ANIMATIONTYPE_FLOAT,"maxZ",Qy,(()=>1))]),(0,S.i)("/cameras/{}/orthographic/znear",[new My(A.e.ANIMATIONTYPE_FLOAT,"Wi",Qy,(()=>1))]),(0,S.i)("/cameras/{}/perspective/yfov",[new My(A.e.ANIMATIONTYPE_FLOAT,"fov",Qy,(()=>1))]),(0,S.i)("/cameras/{}/perspective/zfar",[new My(A.e.ANIMATIONTYPE_FLOAT,"maxZ",Qy,(()=>1))]),(0,S.i)("/cameras/{}/perspective/znear",[new My(A.e.ANIMATIONTYPE_FLOAT,"Wi",Qy,(()=>1))]),(0,S.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new fy(A.e.ANIMATIONTYPE_COLOR3,"albedoColor",zy,(()=>4)),new fy(A.e.ANIMATIONTYPE_FLOAT,"alpha",(function(n,y,H,o){return y[H+3]*o}),(()=>4))]),(0,S.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"metallic",Qy,(()=>1))]),(0,S.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"roughness",Qy,(()=>1))]);const py=gy("albedoTexture");(0,S.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",py.scale),(0,S.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",py.offset),(0,S.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",py.rotation);const Ey=gy("metallicTexture");(0,S.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",Ey.scale),(0,S.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",Ey.offset),(0,S.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",Ey.rotation),(0,S.i)("/materials/{}/emissiveFactor",[new fy(A.e.ANIMATIONTYPE_COLOR3,"emissiveColor",zy,(()=>3))]);const Xy=gy("bumpTexture");(0,S.i)("/materials/{}/normalTexture/scale",[new fy(A.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",Qy,(()=>1))]),(0,S.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Xy.scale),(0,S.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Xy.offset),(0,S.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Xy.rotation),(0,S.i)("/materials/{}/occlusionTexture/strength",[new fy(A.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",Qy,(()=>1))]);const dy=gy("ambientTexture");(0,S.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",dy.scale),(0,S.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",dy.offset),(0,S.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",dy.rotation);const ay=gy("emissiveTexture");(0,S.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",ay.scale),(0,S.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",ay.offset),(0,S.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",ay.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new fy(A.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new fy(A.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",Qy,(()=>1))]);const Oy=gy("anisotropy.texture");(0,S.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Oy.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Oy.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Oy.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",Qy,(()=>1))]);const ey=gy("clearCoat.texture");(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",ey.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",ey.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",ey.rotation);const wy=gy("clearCoat.bumpTexture");(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new fy(A.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",wy.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",wy.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",wy.rotation);const jy=gy("clearCoat.textureRoughness");(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",jy.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",jy.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",jy.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new fy(A.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new fy(A.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new fy(A.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new fy(A.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",Qy,(()=>1))]);const Iy=gy("iridescence.texture");(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Iy.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Iy.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Iy.rotation);const Ry=gy("iridescence.thicknessTexture");(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ry.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ry.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ry.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new fy(A.e.ANIMATIONTYPE_COLOR3,"sheen.color",zy,(()=>3))]),(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",Qy,(()=>1))]);const Cy=gy("sheen.texture");(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Cy.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Cy.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Cy.rotation);const Sy=gy("sheen.textureRoughness");(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",Sy.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",Sy.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",Sy.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new fy(A.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",zy,(()=>3))]);const Ny=gy("metallicReflectanceTexture");(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Ny.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Ny.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Ny.rotation);const ry=gy("reflectanceTexture");(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",ry.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",ry.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",ry.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",Qy,(()=>1))]);const Ky=gy("subSurface.refractionIntensityTexture");(0,S.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Ky.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Ky.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Ky.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new fy(A.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",zy,(()=>3))]),(0,S.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new fy(A.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",Qy,(()=>1))]),(0,S.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",Qy,(()=>1))]);const Yy=gy("subSurface.thicknessTexture");(0,S.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Yy.scale),(0,S.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Yy.offset),(0,S.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Yy.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new fy(A.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",Qy,(()=>1))]);const Dy=gy("subSurface.translucencyIntensityTexture");(0,S.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Dy.scale),(0,S.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Dy.offset),(0,S.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Dy.rotation),(0,S.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new fy(A.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",zy,(()=>3))]);const Zy=gy("subSurface.translucencyColorTexture");(0,S.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Zy.scale),(0,S.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Zy.offset),(0,S.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Zy.rotation),(0,S.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new cy(A.e.ANIMATIONTYPE_COLOR3,"diffuse",zy,(()=>3))]),(0,S.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new cy(A.e.ANIMATIONTYPE_FLOAT,"intensity",Qy,(()=>1))]),(0,S.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new cy(A.e.ANIMATIONTYPE_FLOAT,"range",Qy,(()=>1))]),(0,S.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new cy(A.e.ANIMATIONTYPE_FLOAT,"innerAngle",Fy,(()=>1))]),(0,S.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new cy(A.e.ANIMATIONTYPE_FLOAT,"angle",Fy,(()=>1))]),(0,S.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new cy(A.e.ANIMATIONTYPE_COLOR3,"diffuse",zy,(()=>3))]),(0,S.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new cy(A.e.ANIMATIONTYPE_FLOAT,"intensity",Qy,(()=>1))]);const sy="KHR_animation_pointer";class Py{constructor(n){this.name=sy,this._loader=n,this._pathToObjectConverter=(0,S.g)(this._loader.rh)}get enabled(){return this._loader.isExtensionUsed(sy)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(n,y,H,o,G){var h;const k=null===(h=o.target.extensions)||void 0===h?void 0:h.KHR_animation_pointer;if(!k||!this._pathToObjectConverter)return null;"pointer"!==o.target.path&&W.d.Warn(`${n}/target/path: Value (${o.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=o.target.node&&W.d.Warn(`${n}/target/node: Value (${o.target.node}) must not be present when using the ${this.name} extension`);const i=`${n}/extensions/${this.name}`,B=k.pointer;if(!B)throw new Error(`${i}: Pointer is missing`);try{const h=this._pathToObjectConverter.convert(B);if(!h.info.interpolation)throw new Error(`${i}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(n,y,H,o,{object:h.object,info:h.info.interpolation},G)}catch(V){return W.d.Warn(`${i}/pointer: Invalid pointer (${B}) skipped`),null}}}C(sy),R(sy,!0,(n=>new Py(n)));class xy{constructor(n,y,H){this.frame=n,this.action=y,this.onlyOnce=H,this.isDone=!1}_clone(){return new xy(this.frame,this.action,this.onlyOnce)}}var ty=H(11134),uy=H(11189),Ly=H(11185);class Jy{get loop(){return this._loop}set loop(n){n!==this._loop&&(this._loop=n,this.updateOptions({loop:n}))}get currentTime(){var n;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(n=uy.e.audioEngine)&&void 0!==n&&n.audioContext&&(this.isPlaying||this.isPaused)){const n=this.isPaused?0:uy.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+n}return 0}get spatialSound(){return this._spatialSound}set spatialSound(n){if(n==this._spatialSound)return;const y=this.isPlaying;this.pause(),n?(this._spatialSound=n,this._updateSpatialParameters()):this._disableSpatialSound(),y&&this.play()}constructor(n,y,H){var o;let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new q.c,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=G.zy.Zero(),this._localDirection=new G.zy(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=n,H=H||T.c.LastCreatedScene)if(this._scene=H,Jy._SceneComponentInitialization(H),this._readyToPlayCallback=h,this._customAttenuationFunction=(n,y,H,o,G)=>y<H?n*(1-y/H):0,i&&(this.autoplay=i.autoplay||!1,this._loop=i.loop||!1,void 0!==i.volume&&(this._volume=i.volume),this._spatialSound=i.spatialSound??!1,this.maxDistance=i.maxDistance??100,this.useCustomAttenuation=i.useCustomAttenuation??!1,this.rolloffFactor=i.rolloffFactor||1,this.refDistance=i.refDistance||1,this.distanceModel=i.distanceModel||"linear",this._playbackRate=i.playbackRate||1,this._streaming=i.streaming??!1,this._length=i.length,this._offset=i.offset),null!==(o=uy.e.audioEngine)&&void 0!==o&&o.canUseWebAudio&&uy.e.audioEngine.audioContext){this._soundGain=uy.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let n=!0;if(y)try{"string"===typeof y?(this._urlType="String",this._url=y):y instanceof ArrayBuffer?this._urlType="ArrayBuffer":y instanceof HTMLMediaElement?this._urlType="MediaElement":y instanceof MediaStream?this._urlType="MediaStream":y instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(y)&&(this._urlType="Array");let H=[],o=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=uy.e.audioEngine.audioContext.createMediaElementSource(y),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=uy.e.audioEngine.audioContext.createMediaStreamSource(y),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":y.byteLength>0&&(o=!0,this._soundLoaded(y));break;case"AudioBuffer":this._audioBufferLoaded(y);break;case"String":H.push(y);case"Array":0===H.length&&(H=y);for(let n=0;n<H.length;n++){const y=H[n];if(o=i&&i.skipCodecCheck||-1!==y.indexOf(".mp3",y.length-4)&&uy.e.audioEngine.isMP3supported||-1!==y.indexOf(".ogg",y.length-4)&&uy.e.audioEngine.isOGGsupported||-1!==y.indexOf(".wav",y.length-4)||-1!==y.indexOf(".m4a",y.length-4)||-1!==y.indexOf(".mp4",y.length-4)||-1!==y.indexOf("blob:"),o){this._streaming?(this._htmlAudioElement=new Audio(y),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,k.Tools.SetCorsBehavior(y,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(y,(n=>{this._soundLoaded(n)}),void 0,!0,!0,(n=>{n&&W.d.Error("XHR "+n.status+" error on: "+y+"."),W.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:n=!1}n?o||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):W.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(B){W.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),uy.e.audioEngine&&!uy.e.audioEngine.WarnedWebAudioUnsupported&&(W.d.Error("Web Audio is not supported by your browser."),uy.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var n;null!==(n=uy.e.audioEngine)&&void 0!==n&&n.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(n){var y;null!==(y=uy.e.audioEngine)&&void 0!==y&&y.audioContext&&(this._audioBuffer=n,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(n){var y;null!==(y=uy.e.audioEngine)&&void 0!==y&&y.audioContext&&uy.e.audioEngine.audioContext.decodeAudioData(n,(n=>{this._audioBufferLoaded(n)}),(n=>{W.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+n)}))}setAudioBuffer(n){var y;null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&(this._audioBuffer=n,this._isReadyToPlay=!0)}updateOptions(n){n&&(this.loop=n.loop??this.loop,this.maxDistance=n.maxDistance??this.maxDistance,this.useCustomAttenuation=n.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=n.rolloffFactor??this.rolloffFactor,this.refDistance=n.refDistance??this.refDistance,this.distanceModel=n.distanceModel??this.distanceModel,this._playbackRate=n.playbackRate??this._playbackRate,this._length=n.length??void 0,this.spatialSound=n.spatialSound??this._spatialSound,this._setOffset(n.offset??void 0),this.setVolume(n.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var n;null!==(n=uy.e.audioEngine)&&void 0!==n&&n.canUseWebAudio&&uy.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??uy.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var n;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(n=this._soundPanner)||void 0===n||n.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var n;null!==(n=uy.e.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(n){var y;null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(n),this._isOutputConnected=!0)}setDirectionalCone(n,y,H){y<n?W.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=n,this._coneOuterAngle=y,this._coneOuterGain=H,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(n){if(n!=this._coneInnerAngle){var y;if(this._coneOuterAngle<n)return void W.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=n,null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(n){if(n!=this._coneOuterAngle){var y;if(n<this._coneInnerAngle)return void W.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=n,null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(n){var y;n.equals(this._position)||(this._position.B(n),null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(n){var y;this._localDirection=n,null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const n=this._connectedTransformNode.getWorldMatrix(),y=G.zy.TransformNormal(this._localDirection,n);y.normalize(),this._soundPanner.orientationX.value=y.x,this._soundPanner.orientationY.value=y.y,this._soundPanner.orientationZ.value=y.z}updateDistanceFromListener(){var n;if(null!==(n=uy.e.audioEngine)&&void 0!==n&&n.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const n=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Qy(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,n,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(n){this._customAttenuationFunction=n}play(n,y,H){var o;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(o=uy.e.audioEngine)&&void 0!==o&&o.audioContext)try{var G,h;this._clearTimeoutsAndObservers();let o=n?(null===(G=uy.e.audioEngine)||void 0===G?void 0:G.audioContext.currentTime)+n:null===(h=uy.e.audioEngine)||void 0===h?void 0:h.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=uy.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const n=()=>{var H;if(null!==(H=uy.e.audioEngine)&&void 0!==H&&H.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=y??0;const H=this._htmlAudioElement.play();void 0!==H&&H.catch((()=>{var y,H;(null===(y=uy.e.audioEngine)||void 0===y||y.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(H=uy.e.audioEngine)||void 0===H?void 0:H.onAudioUnlockedObservable.addOnce((()=>{n()})))}))}else{var o;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(o=uy.e.audioEngine)||void 0===o?void 0:o.onAudioUnlockedObservable.addOnce((()=>{n()}))}};n()}}else{var k;const G=()=>{var G;if(null!==(G=uy.e.audioEngine)&&void 0!==G&&G.audioContext){var h;if(H=H||this._length,void 0!==y&&this._setOffset(y),this._soundSource){const n=this._soundSource;n.onended=()=>{n.disconnect()}}if(this._soundSource=null===(h=uy.e.audioEngine)||void 0===h?void 0:h.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var k;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==y&&(this._soundSource.loopStart=y),void 0!==H&&(this._soundSource.loopEnd=(0|y)+H),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},o=n?(null===(k=uy.e.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+n:uy.e.audioEngine.audioContext.currentTime;const G=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(o,G,this.loop?void 0:H)}}};"suspended"===(null===(k=uy.e.audioEngine)||void 0===k?void 0:k.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var n;"suspended"===(null===(n=uy.e.audioEngine)||void 0===n?void 0:n.audioContext.state)?(uy.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=uy.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{G()})))):G()}),500):G()}this._startTime=o,this.isPlaying=!0,this.isPaused=!1}catch(i){W.d.Error("Error while trying to play audio: "+this.name+", "+i.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(n){var y;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1}else if(null!==(y=uy.e.audioEngine)&&void 0!==y&&y.audioContext&&this._soundSource){const y=n?uy.e.audioEngine.audioContext.currentTime+n:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(y)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var n;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var y;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(y=this._streamingSource)||void 0===y||y.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(n=uy.e.audioEngine)&&void 0!==n&&n.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=uy.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(n,y){var H;null!==(H=uy.e.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._soundGain&&(y&&uy.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(uy.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,uy.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(n,uy.e.audioEngine.audioContext.currentTime+y)):this._soundGain.gain.value=n),this._volume=n}setPlaybackRate(n){this._playbackRate=n,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(n){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=n,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=n=>this._onRegisterAfterWorldMatrixUpdate(n),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(n){var y;if(n.getBoundingInfo){const y=n.getBoundingInfo();this.setPosition(y.boundingSphere.centerWorld)}else this.setPosition(n.absolutePosition);null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const n=()=>{(0,Ly.e)((()=>this._isReadyToPlay),(()=>{H._audioBuffer=this.getAudioBuffer(),H._isReadyToPlay=!0,H.autoplay&&H.play(0,this._offset,this._length)}),void 0,300)},y={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},H=new Jy(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,y);return this.useCustomAttenuation&&H.setAttenuationFunction(this._customAttenuationFunction),H.setPosition(this._position),H.setPlaybackRate(this._playbackRate),n(),H}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const n={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(n.connectedMeshId=this._connectedTransformNode.id),n.position=this._position.Ui(),n.refDistance=this.refDistance,n.distanceModel=this.distanceModel,n.isDirectional=this._isDirectional,n.localDirectionToMesh=this._localDirection.Ui(),n.coneInnerAngle=this._coneInnerAngle,n.coneOuterAngle=this._coneOuterAngle,n.coneOuterGain=this._coneOuterGain),n}static Parse(n,y,H,o){const h=n.name;let k;k=n.url?H+n.url:H+h;const i={autoplay:n.autoplay,loop:n.loop,volume:n.volume,spatialSound:n.spatialSound,maxDistance:n.maxDistance,rolloffFactor:n.rolloffFactor,refDistance:n.refDistance,distanceModel:n.distanceModel,playbackRate:n.playbackRate};let B;if(o){const n=()=>{(0,Ly.e)((()=>o._isReadyToPlay),(()=>{B._audioBuffer=o.getAudioBuffer(),B._isReadyToPlay=!0,B.autoplay&&B.play(0,B._offset,B._length)}),void 0,300)};B=new Jy(h,new ArrayBuffer(0),y,null,i),n()}else B=new Jy(h,k,y,(()=>{y.removePendingData(B)}),i),y.addPendingData(B);if(n.position){const y=G.zy.gy(n.position);B.setPosition(y)}if(n.isDirectional&&(B.setDirectionalCone(n.coneInnerAngle||360,n.coneOuterAngle||360,n.coneOuterGain||0),n.localDirectionToMesh)){const y=G.zy.gy(n.localDirectionToMesh);B.setLocalDirectionToMesh(y)}if(n.connectedMeshId){const H=y.getMeshById(n.connectedMeshId);H&&B.attachToMesh(H)}return n.metadata&&(B.metadata=n.metadata),B}_setOffset(n){this._offset!==n&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=n)}_clearTimeoutsAndObservers(){var n;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(n=uy.e.audioEngine)||void 0===n||n.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Jy._SceneComponentInitialization=n=>{throw(0,ty.c)("AudioSceneComponent")},(0,fn.h)("BABYLON.Sound",Jy);class my{constructor(n,y,H){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],y.length!==H.length)throw new Error("Sounds length does not equal weights length");this.loop=n,this._weights=H;let o=0;for(const h of H)o+=h;const G=o>0?1/o:0;for(let h=0;h<this._weights.length;h++)this._weights[h]*=G;this._sounds=y;for(const h of this._sounds)h.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(n){if(n!==this._coneInnerAngle){if(this._coneOuterAngle<n)return void W.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=n;for(const y of this._sounds)y.directionalConeInnerAngle=n}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(n){if(n!==this._coneOuterAngle){if(n<this._coneInnerAngle)return void W.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=n;for(const y of this._sounds)y.directionalConeOuterAngle=n}}get volume(){return this._volume}set volume(n){if(n!==this._volume)for(const y of this._sounds)y.setVolume(n)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(n){if(!this.isPaused){this.stop();const n=Math.random();let y=0;for(let H=0;H<this._weights.length;H++)if(y+=this._weights[H],n<=y){this._currentIndex=H;break}}const y=this._sounds[this._currentIndex??0];y.isReady()?y.play(0,this.isPaused?void 0:n):y.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class nH{constructor(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(n=n||T.c.LastCreatedScene)&&(this._scene=n,this.soundCollection=[],this._options=y,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var n;null!==(n=uy.e.audioEngine)&&void 0!==n&&n.canUseWebAudio&&uy.e.audioEngine.audioContext&&(this._outputAudioNode=uy.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(uy.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(uy.e.audioEngine&&uy.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(n){var y;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&n.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==n.soundTrackId&&(-1===n.soundTrackId?this._scene.mainSoundTrack.removeSound(n):this._scene.soundTracks&&this._scene.soundTracks[n.soundTrackId].removeSound(n)),this.soundCollection.push(n),n.soundTrackId=this.id}removeSound(n){const y=this.soundCollection.indexOf(n);-1!==y&&this.soundCollection.splice(y,1)}setVolume(n){var y;null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=n)}switchPanningModelToHRTF(){var n;if(null!==(n=uy.e.audioEngine)&&void 0!==n&&n.canUseWebAudio)for(let y=0;y<this.soundCollection.length;y++)this.soundCollection[y].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var n;if(null!==(n=uy.e.audioEngine)&&void 0!==n&&n.canUseWebAudio)for(let y=0;y<this.soundCollection.length;y++)this.soundCollection[y].switchPanningModelToEqualPower()}connectToAnalyser(n){var y;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=n,null!==(y=uy.e.audioEngine)&&void 0!==y&&y.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,uy.e.audioEngine.masterGain))}}var yH=H(11596),HH=H(11554),oH=H(11107);uy.e.AudioEngineFactory=(n,y,H)=>new GH(n,y,H);class GH{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new q.c,this.onAudioLockedObservable=new q.c,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,oH.p)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const o=document.createElement("audio");this._hostElement=n,this._audioContext=y,this._audioDestination=H;try{o&&o.canPlayType&&(o.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||o.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(G){}try{o&&o.canPlayType&&o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(G){}}lock(){this._triggerSuspendedState()}unlock(){var n,y;if("running"===(null===(n=this._audioContext)||void 0===n?void 0:n.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(y=this._audioContext)||void 0===y||y.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{W.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var n;null===(n=this._audioContext)||void 0===n||n.addEventListener("statechange",(()=>{var n;this.unlocked&&"running"!==(null===(n=this._audioContext)||void 0===n?void 0:n.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var n;return null!==(n=this._audioContext)&&void 0!==n&&n.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(n){this.canUseWebAudio=!1,W.d.Error("Web Audio: "+n.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(n){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const n=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",y=document.createElement("style");y.appendChild(document.createTextNode(n)),document.getElementsByTagName("head")[0].appendChild(y),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var n;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(n=this._audioContext)||void 0===n||n.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(n){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=n)}connectToAnalyser(n){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=n,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var hH=H(11125);(0,H(12766).c)(yH.c.NAME_AUDIO,((n,y,H,o)=>{let G,h=[];if(H.vU=H.vU||[],void 0!==n.vU&&null!==n.vU)for(let i=0,B=n.vU.length;i<B;i++){var k;const B=n.vU[i];null!==(k=uy.e.audioEngine)&&void 0!==k&&k.canUseWebAudio?(B.url||(B.url=B.name),h[B.url]?H.vU.push(Jy.Parse(B,y,o,h[B.url])):(G=Jy.Parse(B,y,o),h[B.url]=G,H.vU.push(G))):H.vU.push(new Jy(B.name,null,y))}h=[]})),Object.defineProperty(HH.e.prototype,"mainSoundTrack",{get:function(){let n=this._getComponent(yH.c.NAME_AUDIO);return n||(n=new kH(this),this.gh(n)),this._mainSoundTrack||(this._mainSoundTrack=new nH(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),HH.e.prototype.getSoundByName=function(n){let y;for(y=0;y<this.mainSoundTrack.soundCollection.length;y++)if(this.mainSoundTrack.soundCollection[y].name===n)return this.mainSoundTrack.soundCollection[y];if(this.soundTracks)for(let H=0;H<this.soundTracks.length;H++)for(y=0;y<this.soundTracks[H].soundCollection.length;y++)if(this.soundTracks[H].soundCollection[y].name===n)return this.soundTracks[H].soundCollection[y];return null},Object.defineProperty(HH.e.prototype,"audioEnabled",{get:function(){let n=this._getComponent(yH.c.NAME_AUDIO);return n||(n=new kH(this),this.gh(n)),n.audioEnabled},set:function(n){let y=this._getComponent(yH.c.NAME_AUDIO);y||(y=new kH(this),this.gh(y)),n?y.enableAudio():y.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"headphone",{get:function(){let n=this._getComponent(yH.c.NAME_AUDIO);return n||(n=new kH(this),this.gh(n)),n.headphone},set:function(n){let y=this._getComponent(yH.c.NAME_AUDIO);y||(y=new kH(this),this.gh(y)),n?y.switchAudioModeForHeadphones():y.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"audioListenerPositionProvider",{get:function(){let n=this._getComponent(yH.c.NAME_AUDIO);return n||(n=new kH(this),this.gh(n)),n.audioListenerPositionProvider},set:function(n){let y=this._getComponent(yH.c.NAME_AUDIO);if(y||(y=new kH(this),this.gh(y)),n&&"function"!==typeof n)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");y.audioListenerPositionProvider=n},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"audioListenerRotationProvider",{get:function(){let n=this._getComponent(yH.c.NAME_AUDIO);return n||(n=new kH(this),this.gh(n)),n.audioListenerRotationProvider},set:function(n){let y=this._getComponent(yH.c.NAME_AUDIO);if(y||(y=new kH(this),this.gh(y)),n&&"function"!==typeof n)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");y.audioListenerRotationProvider=n},enumerable:!0,configurable:!0}),Object.defineProperty(HH.e.prototype,"audioPositioningRefreshRate",{get:function(){let n=this._getComponent(yH.c.NAME_AUDIO);return n||(n=new kH(this),this.gh(n)),n.audioPositioningRefreshRate},set:function(n){let y=this._getComponent(yH.c.NAME_AUDIO);y||(y=new kH(this),this.gh(y)),y.audioPositioningRefreshRate=n},enumerable:!0,configurable:!0});class kH{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(n){this.name=yH.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new G.zy,this._cachedCameraPosition=new G.zy,this._lastCheck=0,this._invertMatrixTemp=new G.Matrix,this._cameraDirectionTemp=new G.zy,(n=n||T.c.LastCreatedScene)&&(this.ly=n,n.soundTracks=[],n.vU=[])}register(){this.ly._afterRenderStage.registerStep(yH.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(n){if(n.vU=[],this.ly.soundTracks)for(let y=0;y<this.ly.soundTracks.length;y++){const H=this.ly.soundTracks[y];for(let y=0;y<H.soundCollection.length;y++)n.vU.push(H.soundCollection[y].serialize())}}addFromContainer(n){if(n.vU)for(const y of n.vU)y.play(),y.autoplay=!0,this.ly.mainSoundTrack.addSound(y)}removeFromContainer(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n.vU)for(const H of n.vU)H.stop(),H.autoplay=!1,this.ly.mainSoundTrack.removeSound(H),y&&H.dispose()}dispose(){const n=this.ly;if(n._mainSoundTrack&&n.mainSoundTrack.dispose(),n.soundTracks)for(let y=0;y<n.soundTracks.length;y++)n.soundTracks[y].dispose()}disableAudio(){const n=this.ly;let y;for(this._audioEnabled=!1,uy.e.audioEngine&&uy.e.audioEngine.audioContext&&uy.e.audioEngine.audioContext.suspend(),y=0;y<n.mainSoundTrack.soundCollection.length;y++)n.mainSoundTrack.soundCollection[y].pause();if(n.soundTracks)for(y=0;y<n.soundTracks.length;y++)for(let H=0;H<n.soundTracks[y].soundCollection.length;H++)n.soundTracks[y].soundCollection[H].pause()}enableAudio(){const n=this.ly;let y;for(this._audioEnabled=!0,uy.e.audioEngine&&uy.e.audioEngine.audioContext&&uy.e.audioEngine.audioContext.resume(),y=0;y<n.mainSoundTrack.soundCollection.length;y++)n.mainSoundTrack.soundCollection[y].isPaused&&n.mainSoundTrack.soundCollection[y].play();if(n.soundTracks)for(y=0;y<n.soundTracks.length;y++)for(let H=0;H<n.soundTracks[y].soundCollection.length;H++)n.soundTracks[y].soundCollection[H].isPaused&&n.soundTracks[y].soundCollection[H].play()}switchAudioModeForHeadphones(){const n=this.ly;if(this._headphone=!0,n.mainSoundTrack.switchPanningModelToHRTF(),n.soundTracks)for(let y=0;y<n.soundTracks.length;y++)n.soundTracks[y].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const n=this.ly;if(this._headphone=!1,n.mainSoundTrack.switchPanningModelToEqualPower(),n.soundTracks)for(let y=0;y<n.soundTracks.length;y++)n.soundTracks[y].switchPanningModelToEqualPower()}_afterRender(){const n=hH.d.Now;if(this._lastCheck&&n-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=n;const y=this.ly;if(!this._audioEnabled||!y._mainSoundTrack||!y.soundTracks||0===y._mainSoundTrack.soundCollection.length&&1===y.soundTracks.length)return;const H=uy.e.audioEngine;if(H&&H.audioContext){let n,o=y.activeCamera;if(y.activeCameras&&y.activeCameras.length>0&&(o=y.activeCameras[0]),this.audioListenerPositionProvider){const n=this.audioListenerPositionProvider();H.audioContext.listener.setPosition(n.x||0,n.y||0,n.z||0)}else o?this._cachedCameraPosition.equals(o.globalPosition)||(this._cachedCameraPosition.B(o.globalPosition),H.audioContext.listener.setPosition(o.globalPosition.x,o.globalPosition.y,o.globalPosition.z)):H.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const n=this.audioListenerRotationProvider();H.audioContext.listener.setOrientation(n.x||0,n.y||0,n.z||0,0,1,0)}else o?(o.rigCameras&&o.rigCameras.length>0&&(o=o.rigCameras[0]),o.getViewMatrix().invertToRef(this._invertMatrixTemp),G.zy.TransformNormalToRef(kH._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.B(this._cameraDirectionTemp),H.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):H.audioContext.listener.setOrientation(0,0,0,0,1,0);for(n=0;n<y.mainSoundTrack.soundCollection.length;n++){const H=y.mainSoundTrack.soundCollection[n];H.useCustomAttenuation&&H.updateDistanceFromListener()}if(y.soundTracks)for(n=0;n<y.soundTracks.length;n++)for(let H=0;H<y.soundTracks[n].soundCollection.length;H++){const o=y.soundTracks[n].soundCollection[H];o.useCustomAttenuation&&o.updateDistanceFromListener()}}}}kH._CameraDirection=new G.zy(0,0,-1),Jy._SceneComponentInitialization=n=>{let y=n._getComponent(yH.c.NAME_AUDIO);y||(y=new kH(n),n.gh(y))};const iH="MSFT_audio_emitter";class BH{constructor(n){this.name=iH,this._loader=n,this.enabled=this._loader.isExtensionUsed(iH)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const n=this._loader.rh.extensions;if(n&&n[this.name]){const y=n[this.name];this._clips=y.clips,this._emitters=y.emitters,K.Assign(this._clips),K.Assign(this._emitters)}}loadSceneAsync(n,y){return D.LoadExtensionAsync(n,y,this.name,(async(H,o)=>{const G=new Array;G.push(this._loader.loadSceneAsync(n,y));for(const n of o.emitters){const y=K.Get(`${H}/emitters`,this._emitters,n);if(void 0!=y.refDistance||void 0!=y.maxDistance||void 0!=y.rolloffFactor||void 0!=y.distanceModel||void 0!=y.innerAngle||void 0!=y.outerAngle)throw new Error(`${H}: Direction or Distance properties are not allowed on emitters attached to a scene`);G.push(this._loadEmitterAsync(`${H}/emitters/${y.index}`,y))}await Promise.all(G)}))}loadNodeAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(n,o)=>{const h=new Array,i=await this._loader.loadNodeAsync(n,y,(y=>{for(const H of o.emitters){const o=K.Get(`${n}/emitters`,this._emitters,H);h.push(this._loadEmitterAsync(`${n}/emitters/${o.index}`,o).then((()=>{for(const n of o._babylonSounds)n.attachToMesh(y),void 0==o.innerAngle&&void 0==o.outerAngle||(n.setLocalDirectionToMesh(G.zy.Forward()),n.setDirectionalCone(2*k.Tools.ToDegrees(void 0==o.innerAngle?Math.PI:o.innerAngle),2*k.Tools.ToDegrees(void 0==o.outerAngle?Math.PI:o.outerAngle),0))})))}H(y)}));return await Promise.all(h),i}))}loadAnimationAsync(n,y){return D.LoadExtensionAsync(n,y,this.name,(async(H,o)=>{const G=await this._loader.loadAnimationAsync(n,y),h=new Array;K.Assign(o.events);for(const k of o.events)h.push(this._loadAnimationEventAsync(`${H}/events/${k.index}`,n,y,k,G));return await Promise.all(h),G}))}_loadClipAsync(n,y){if(y._objectURL)return y._objectURL;let H;if(y.uri)H=this._loader.loadUriAsync(n,y,y.uri);else{const o=K.Get(`${n}/bufferView`,this._loader.rh.bufferViews,y.bufferView);H=this._loader.loadBufferViewAsync(`/bufferViews/${o.index}`,o)}return y._objectURL=H.then((n=>URL.createObjectURL(new Blob([n],{type:y.mimeType})))),y._objectURL}_loadEmitterAsync(n,y){if(y._babylonSounds=y._babylonSounds||[],!y._babylonData){const n=new Array,H=y.name||`emitter${y.index}`,o={loop:!1,autoplay:!1,volume:void 0==y.volume?1:y.volume};for(let h=0;h<y.clips.length;h++){const G=`/extensions/${this.name}/clips`,k=K.Get(G,this._clips,y.clips[h].clip);n.push(this._loadClipAsync(`${G}/${y.clips[h].clip}`,k).then((n=>{const G=y._babylonSounds[h]=new Jy(H,n,this._loader.babylonScene,null,o);G.refDistance=y.refDistance||1,G.maxDistance=y.maxDistance||256,G.rolloffFactor=y.rolloffFactor||1,G.distanceModel=y.distanceModel||"exponential"})))}const G=Promise.all(n).then((()=>{const n=y.clips.map((n=>n.weight||1)),H=new my(y.loop||!1,y._babylonSounds,n);y.innerAngle&&(H.directionalConeInnerAngle=2*k.Tools.ToDegrees(y.innerAngle)),y.outerAngle&&(H.directionalConeOuterAngle=2*k.Tools.ToDegrees(y.outerAngle)),y.volume&&(H.volume=y.volume),y._babylonData.sound=H}));y._babylonData={loaded:G}}return y._babylonData.loaded}_getEventAction(n,y,H,o,G){switch(H){case"play":return n=>{const H=(G||0)+(n-o);y.play(H)};case"stop":return()=>{y.stop()};case"pause":return()=>{y.pause()};default:throw new Error(`${n}: Unsupported action ${H}`)}}_loadAnimationEventAsync(n,y,H,o,G){if(0==G.targetedAnimations.length)return Promise.resolve();const h=G.targetedAnimations[0],k=o.hy,i=K.Get(`/extensions/${this.name}/emitters`,this._emitters,k);return this._loadEmitterAsync(n,i).then((()=>{const y=i._babylonData.sound;if(y){const H=new xy(o.time,this._getEventAction(n,y,o.action,o.time,o.startOffset));h.animation.addEvent(H),G.onAnimationGroupEndObservable.add((()=>{y.stop()})),G.onAnimationGroupPauseObservable.add((()=>{y.pause()}))}}))}}C(iH),R(iH,!0,(n=>new BH(n)));const VH="MSFT_lod";class qH{constructor(n){var y;this.name=VH,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new q.c,this.onMaterialLODsLoadedObservable=new q.c,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=n,this.maxLODsToLoad=(null===(y=this._loader.parent.extensionOptions[VH])||void 0===y?void 0:y.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(VH)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let n=0;n<this._nodePromiseLODs.length;n++){const y=Promise.all(this._nodePromiseLODs[n]).then((()=>{0!==n&&(this._loader.endPerformanceCounter(`Node LOD ${n}`),this._loader.log(`Loaded node LOD ${n}`)),this.onNodeLODsLoadedObservable.notifyObservers(n),n!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${n+1}`),this._loadBufferLOD(this._nodeBufferLODs,n+1),this._nodeSignalLODs[n]&&this._nodeSignalLODs[n].resolve())}));this._loader._completePromises.push(y)}for(let n=0;n<this._materialPromiseLODs.length;n++){const y=Promise.all(this._materialPromiseLODs[n]).then((()=>{0!==n&&(this._loader.endPerformanceCounter(`Material LOD ${n}`),this._loader.log(`Loaded material LOD ${n}`)),this.onMaterialLODsLoadedObservable.notifyObservers(n),n!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${n+1}`),this._loadBufferLOD(this._materialBufferLODs,n+1),this._materialSignalLODs[n]&&this._materialSignalLODs[n].resolve())}));this._loader._completePromises.push(y)}}loadSceneAsync(n,y){const H=this._loader.loadSceneAsync(n,y);return this._loadBufferLOD(this._bufferLODs,0),H}loadNodeAsync(n,y,H){return D.LoadExtensionAsync(n,y,this.name,(async(n,G)=>{let h;const k=this._getLODs(n,y,this._loader.rh.nodes,G.ids);this._loader.logOpen(`${n}`);for(let y=0;y<k.length;y++){const n=k[y];0!==y&&(this._nodeIndexLOD=y,this._nodeSignalLODs[y]=this._nodeSignalLODs[y]||new o);const G=n=>{H(n),n.xi(!1)},i=this._loader.loadNodeAsync(`/nodes/${n.index}`,n,G).then((n=>{if(0!==y){const n=k[y-1];n._babylonTransformNode&&(this._disposeTransformNode(n._babylonTransformNode),delete n._babylonTransformNode)}return n.xi(!0),n}));this._nodePromiseLODs[y]=this._nodePromiseLODs[y]||[],0===y?h=i:(this._nodeIndexLOD=null,this._nodePromiseLODs[y].push(i))}return this._loader.logClose(),await h}))}_loadMaterialAsync(n,y,H,o,G){return this._nodeIndexLOD?null:D.LoadExtensionAsync(n,y,this.name,(async(n,h)=>{let k;const i=this._getLODs(n,y,this._loader.rh.materials,h.ids);this._loader.logOpen(`${n}`);for(let y=0;y<i.length;y++){const n=i[y];0!==y&&(this._materialIndexLOD=y);const h=this._loader._loadMaterialAsync(`/materials/${n.index}`,n,H,o,(n=>{0===y&&G(n)})).then((n=>{if(0!==y){G(n);const H=i[y-1]._data;H[o]&&(this._disposeMaterials([H[o].babylonMaterial]),delete H[o])}return n}));this._materialPromiseLODs[y]=this._materialPromiseLODs[y]||[],0===y?k=h:(this._materialIndexLOD=null,this._materialPromiseLODs[y].push(h))}return this._loader.logClose(),await k}))}_loadUriAsync(n,y,H){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const G=this._nodeIndexLOD-1;return this._nodeSignalLODs[G]=this._nodeSignalLODs[G]||new o,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(n,y,H)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const G=this._materialIndexLOD-1;return this._materialSignalLODs[G]=this._materialSignalLODs[G]||new o,this._materialSignalLODs[G].promise.then((async()=>await this._loader.loadUriAsync(n,y,H)))}return null}loadBufferAsync(n,y,H,G){if(this._loader.parent.useRangeRequests&&!y.uri){if(!this._loader.bin)throw new Error(`${n}: Uri is missing or the binary glTF is missing its binary chunk`);const y=async(n,y)=>{const h=H,k=h+G-1;let i=n[y];return i?(i.start=Math.min(i.start,h),i.end=Math.max(i.end,k)):(i={start:h,end:k,loaded:new o},n[y]=i),await i.loaded.promise.then((n=>new Uint8Array(n.buffer,n.byteOffset+H-i.start,G)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?y(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?y(this._materialBufferLODs,this._materialIndexLOD):y(this._bufferLODs,0)}return null}_loadBufferLOD(n,y){const H=n[y];H&&(this._loader.log(`Loading buffer range [${H.start}-${H.end}]`),this._loader.bin.readAsync(H.start,H.end-H.start+1).then((n=>{H.loaded.resolve(n)}),(n=>{H.loaded.reject(n)})))}_getLODs(n,y,H,o){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const G=[];for(let h=o.length-1;h>=0;h--)if(G.push(K.Get(`${n}/ids/${o[h]}`,H,o[h])),G.length===this.maxLODsToLoad)return G;return G.push(y),G}_disposeTransformNode(n){const y=[],H=n.material;H&&y.push(H);for(const G of n.getChildMeshes())G.material&&y.push(G.material);n.dispose();const o=y.filter((n=>this._loader.babylonScene.meshes.every((y=>y.material!=n))));this._disposeMaterials(o)}_disposeMaterials(n){const y={};for(const H of n){for(const n of H.getActiveTextures())y[n.uniqueId]=n;H.dispose()}for(const H in y)for(const n of this._loader.babylonScene.materials)n.hasTexture(y[H])&&delete y[H];for(const H in y)y[H].dispose()}}C(VH),R(VH,!0,(n=>new qH(n)));const bH="MSFT_minecraftMesh";class AH{constructor(n){this.name=bH,this._loader=n,this.enabled=this._loader.isExtensionUsed(bH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtraAsync(n,y,this.name,(async(o,G)=>{if(G){if(!(H instanceof v.e))throw new Error(`${o}: Material type not supported`);const G=this._loader.loadMaterialPropertiesAsync(n,y,H);return H.needAlphaBlending()&&(H.forceDepthWrite=!0,H.separateCullingPass=!0),H.gi=H.forceDepthWrite,H.twoSidedLighting=!0,await G}}))}}C(bH),R(bH,!0,(n=>new AH(n)));const UH="MSFT_sRGBFactors";class TH{constructor(n){this.name=UH,this._loader=n,this.enabled=this._loader.isExtensionUsed(UH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(n,y,H){return D.LoadExtraAsync(n,y,this.name,(async(o,G)=>{if(G){if(!(H instanceof v.e))throw new Error(`${o}: Material type not supported`);const G=this._loader.loadMaterialPropertiesAsync(n,y,H),h=H.pn().getEngine().useExactSrgbConversions;return H.albedoTexture||H.albedoColor.toLinearSpaceToRef(H.albedoColor,h),H.reflectivityTexture||H.reflectivityColor.toLinearSpaceToRef(H.reflectivityColor,h),await G}}))}}C(UH),R(UH,!0,(n=>new TH(n)));var WH=H(13105);const zH={};var QH=H(13157),lH=H(13137),vH=H(13108),FH=H(13117);function gH(n,y){for(const H of n)for(const n of H.dataOutputs)if(n.uniqueId===y)return n;throw new Error("Could not find data out connection with unique id "+y)}function MH(n,y){for(const H of n)if(H instanceof lH.c)for(const n of H.signalInputs)if(n.uniqueId===y)return n;throw new Error("Could not find signal in connection with unique id "+y)}async function fH(n,y){const o=await Promise.all(n.allBlocks.map((async n=>{const y=function(n){switch(n){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([H.e(78),H.e(79)]).then(H.bind(H,14548))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await H.e(80).then(H.bind(H,14550))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await H.e(81).then(H.bind(H,14555))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await H.e(82).then(H.bind(H,14559))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await H.e(83).then(H.bind(H,14565))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await H.e(84).then(H.bind(H,14567))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await H.e(85).then(H.bind(H,14571))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await H.e(86).then(H.bind(H,14575))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await H.e(87).then(H.bind(H,14578))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await H.e(90).then(H.bind(H,14610))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await H.e(90).then(H.bind(H,14610))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await H.e(90).then(H.bind(H,14610))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await H.e(90).then(H.bind(H,14610))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await H.e(95).then(H.bind(H,14615))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await H.e(96).then(H.bind(H,14617))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await H.e(97).then(H.bind(H,14620))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await H.e(98).then(H.bind(H,14628))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await H.e(99).then(H.bind(H,14637))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await H.e(100).then(H.bind(H,14645))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await H.e(101).then(H.bind(H,14652))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await H.e(102).then(H.bind(H,14659))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await H.e(103).then(H.bind(H,14666))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await H.e(104).then(H.bind(H,14671))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await H.e(105).then(H.bind(H,14673))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await H.e(106).then(H.bind(H,14677))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await H.e(107).then(H.bind(H,14680))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await H.e(108).then(H.bind(H,14683))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await H.e(109).then(H.bind(H,14691))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await H.e(110).then(H.bind(H,14694))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await H.e(111).then(H.bind(H,14696))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await H.e(112).then(H.bind(H,14698))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await H.e(113).then(H.bind(H,14704))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await H.e(92).then(H.bind(H,14710))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await H.e(114).then(H.bind(H,14712))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await H.e(115).then(H.bind(H,14719))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await H.e(116).then(H.bind(H,14726))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await H.e(93).then(H.bind(H,14732))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await H.e(88).then(H.bind(H,14581))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await H.e(94).then(H.bind(H,14735))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await H.e(89).then(H.bind(H,14602))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await H.e(90).then(H.bind(H,14610))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await H.e(90).then(H.bind(H,14610))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await H.e(91).then(H.bind(H,14741))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await H.e(91).then(H.bind(H,14741))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await H.e(91).then(H.bind(H,14741))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await H.e(91).then(H.bind(H,14741))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await H.e(91).then(H.bind(H,14741))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await H.e(91).then(H.bind(H,14741))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await H.e(117).then(H.bind(H,14750))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await H.e(118).then(H.bind(H,14757))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await H.e(119).then(H.bind(H,14763))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await H.e(120).then(H.bind(H,14767))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await H.e(121).then(H.bind(H,14769))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await H.e(122).then(H.bind(H,14776))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await H.e(123).then(H.bind(H,14779))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await H.e(124).then(H.bind(H,14787))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await H.e(125).then(H.bind(H,14792))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await H.e(126).then(H.bind(H,14798))).FlowGraphDataSwitchBlock;default:if(zH[n])return zH[n];throw new Error(`Unknown block name ${n}`)}}(n.className);return await y()})));return function(n,y,H){const o=y.coordinator.createGraph(),G=[],h=y.valueParseFunction??vH.c;for(let k=0;k<n.allBlocks.length;k++){const i=pH(n.allBlocks[k],{ly:y.coordinator.config.ly,pathConverter:y.pathConverter,assetsContainer:y.coordinator.config.ly,valueParseFunction:h},H[k]);G.push(i),i instanceof QH.b&&o.addEventBlock(i)}for(const k of G){for(const n of k.dataInputs)for(const y of n.connectedPointIds){const H=gH(G,y);n.connectTo(H)}if(k instanceof lH.c)for(const n of k.signalOutputs)for(const y of n.connectedPointIds){const H=MH(G,y);n.connectTo(H)}}for(const k of n.executionContexts)cH(k,{graph:o,valueParseFunction:h},n.rightHanded);return o}(n,y,o)}function cH(n,y,H){const o=y.graph.createContext();n.enableLogging&&(o.enableLogging=!0),o.treatDataAsRightHanded=H||!1;const G=y.valueParseFunction??vH.c;o.uniqueId=n.uniqueId;const h=o.pn();if(n._assetsContext){var k,i,B,V,q,b,A,U,T,W;const y=n._assetsContext,H={meshes:null===(k=y.meshes)||void 0===k?void 0:k.map((n=>h.getMeshById(n))),lights:null===(i=y.lights)||void 0===i?void 0:i.map((n=>h.getLightByName(n))),cameras:null===(B=y.cameras)||void 0===B?void 0:B.map((n=>h.getCameraByName(n))),materials:null===(V=y.materials)||void 0===V?void 0:V.map((n=>h.getMaterialById(n))),textures:null===(q=y.textures)||void 0===q?void 0:q.map((n=>h.getTextureByName(n))),animations:null===(b=y.animations)||void 0===b?void 0:b.map((n=>h.animations.find((y=>y.name===n)))),skeletons:null===(A=y.skeletons)||void 0===A?void 0:A.map((n=>h.getSkeletonByName(n))),NA:null===(U=y.NA)||void 0===U?void 0:U.map((n=>h.getParticleSystemById(n))),animationGroups:null===(T=y.animationGroups)||void 0===T?void 0:T.map((n=>h.getAnimationGroupByName(n))),transformNodes:null===(W=y.transformNodes)||void 0===W?void 0:W.map((n=>h.getTransformNodeById(n))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],vU:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};o.assetsContext=H}for(const z in n._userVariables){const y=G(z,n._userVariables,o.assetsContext,h);o.userVariables[z]=y}for(const z in n._connectionValues){const y=G(z,n._connectionValues,o.assetsContext,h);o._setConnectionValueByKey(z,y)}return o}function pH(n,y,H){const o={},G=y.valueParseFunction??vH.c;if(n.config)for(const k in n.config)o[k]=G(k,n.config,y.assetsContainer||y.ly,y.ly);if((0,vH.g)(n.className)){if(!y.pathConverter)throw new Error("Path converter is required for this block");o.pathConverter=y.pathConverter}const h=new H(o);h.uniqueId=n.uniqueId;for(let k=0;k<n.dataInputs.length;k++){const y=h.getDataInput(n.dataInputs[k].name);if(!y)throw new Error("Could not find data input with name "+n.dataInputs[k].name+" in block "+n.className);y.deserialize(n.dataInputs[k])}for(let k=0;k<n.dataOutputs.length;k++){const y=h.getDataOutput(n.dataOutputs[k].name);if(!y)throw new Error("Could not find data output with name "+n.dataOutputs[k].name+" in block "+n.className);y.deserialize(n.dataOutputs[k])}return h.metadata=n.metadata,h.deserialize&&h.deserialize(n),h}function EH(n){const[y,H]=n.split(":");return XH({op:y,extension:H})}function XH(n){var y;let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const o=n.extension?null===(y=aH[n.extension])||void 0===y?void 0:y[n.op]:OH[n.op];if(!o&&(W.d.Warn(`No mapping found for operation ${n.op} and extension ${n.extension||"KHR_interactivity"}`),H)){const y={},H={flows:{}};if(n.inputValueSockets){y.values={};for(const H in n.inputValueSockets)y.values[H]={name:H}}return n.outputValueSockets&&(H.values={},Object.keys(n.outputValueSockets).forEach((n=>{H.values[n]={name:n}}))),{zq:[],inputs:y,outputs:H}}return o}function dH(n,y,H){aH[y]||(aH[y]={}),aH[y][n]=H}const aH={BABYLON:{"flow/log":{zq:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},OH={"event/onStart":{zq:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{zq:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{zq:["FlowGraphSendCustomEventBlock"],extraProcessor(n,y,H,o,G){if("event/send"!==y.op||!n.configuration||1!==Object.keys(n.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const h=n.configuration.event.value[0];if("number"!==typeof h)throw new Error("Event id should be a number");const k=o.arrays.events[h],i=G[0];return i.config||(i.config={}),i.config.eventId=k.eventId,i.config.eventData=k.eventData,G}},"event/receive":{zq:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(n,y){var H;if(!n.configuration)return W.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const o=n.configuration.event;if(!o)return W.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const G=o.value[0];if("number"!==typeof G)return W.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(H=y.events)||void 0===H?void 0:H[G])?{valid:!0}:(W.d.Error(`Event with id ${G} not found`),{valid:!1,error:`Event with id ${G} not found`})},extraProcessor(n,y,H,o,G){if("event/receive"!==y.op||!n.configuration||1!==Object.keys(n.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const h=n.configuration.event.value[0];if("number"!==typeof h)throw new Error("Event id should be a number");const k=o.arrays.events[h],i=G[0];return i.config||(i.config={}),i.config.eventId=k.eventId,i.config.eventData=k.eventData,G}},"math/e":eH("FlowGraphEBlock"),"math/pi":eH("FlowGraphPIBlock"),"math/inf":eH("FlowGraphInfBlock"),"math/nan":eH("FlowGraphNaNBlock"),"math/abs":eH("FlowGraphAbsBlock"),"math/sign":eH("FlowGraphSignBlock"),"math/trunc":eH("FlowGraphTruncBlock"),"math/floor":eH("FlowGraphFloorBlock"),"math/ceil":eH("FlowGraphCeilBlock"),"math/round":{zq:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G){var h;return(h=G[0]).config||(h.config={}),G[0].config.roundHalfAwayFromZero=!0,G}},"math/fract":eH("FlowGraphFractBlock"),"math/neg":eH("FlowGraphNegationBlock"),"math/add":eH("FlowGraphAddBlock",["a","b"],!0),"math/sub":eH("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{zq:["FlowGraphMultiplyBlock"],extraProcessor(n,y,H,o,G){var h;(h=G[0]).config||(h.config={}),G[0].config.useMatrixPerComponent=!0,G[0].config.preventIntegerFloatArithmetic=!0;let k=-1;return Object.keys(n.values||{}).find((y=>{var H;return void 0!==(null===(H=n.values)||void 0===H?void 0:H[y].type)&&(k=n.values[y].type,!0)})),-1!==k&&(G[0].config.type=o.arrays.types[k].flowGraphType),G},validation:n=>n.values?wH(n):{valid:!0}},"math/div":eH("FlowGraphDivideBlock",["a","b"],!0),"math/rem":eH("FlowGraphModuloBlock",["a","b"]),"math/min":eH("FlowGraphMinBlock",["a","b"]),"math/max":eH("FlowGraphMaxBlock",["a","b"]),"math/clamp":eH("FlowGraphClampBlock",["a","b","c"]),"math/saturate":eH("FlowGraphSaturateBlock"),"math/mix":eH("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":eH("FlowGraphEqualityBlock",["a","b"]),"math/lt":eH("FlowGraphLessThanBlock",["a","b"]),"math/le":eH("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":eH("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":eH("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":eH("FlowGraphIsNaNBlock"),"math/isinf":eH("FlowGraphIsInfBlock"),"math/select":{zq:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{zq:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":eH("FlowGraphSinBlock"),"math/cos":eH("FlowGraphCosBlock"),"math/tan":eH("FlowGraphTanBlock"),"math/asin":eH("FlowGraphASinBlock"),"math/acos":eH("FlowGraphACosBlock"),"math/atan":eH("FlowGraphATanBlock"),"math/atan2":eH("FlowGraphATan2Block",["a","b"]),"math/sinh":eH("FlowGraphSinhBlock"),"math/cosh":eH("FlowGraphCoshBlock"),"math/tanh":eH("FlowGraphTanhBlock"),"math/asinh":eH("FlowGraphASinhBlock"),"math/acosh":eH("FlowGraphACoshBlock"),"math/atanh":eH("FlowGraphATanhBlock"),"math/exp":eH("FlowGraphExponentialBlock"),"math/log":eH("FlowGraphLogBlock"),"math/log2":eH("FlowGraphLog2Block"),"math/log10":eH("FlowGraphLog10Block"),"math/sqrt":eH("FlowGraphSquareRootBlock"),"math/cbrt":eH("FlowGraphCubeRootBlock"),"math/pow":eH("FlowGraphPowerBlock",["a","b"]),"math/length":eH("FlowGraphLengthBlock"),"math/normalize":eH("FlowGraphNormalizeBlock"),"math/dot":eH("FlowGraphDotBlock",["a","b"]),"math/cross":eH("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":eH("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":eH("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{zq:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{zq:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{zq:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{zq:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{zq:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{zq:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{zq:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":eH("FlowGraphTransposeBlock"),"math/determinant":eH("FlowGraphDeterminantBlock"),"math/inverse":eH("FlowGraphInvertMatrixBlock"),"math/matmul":eH("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{zq:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"fi",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G,h){const k=G[0].dataInputs.find((n=>"rotationQuaternion"===n.name));if(!k)throw new Error("Rotation quaternion input not found");return h._connectionValues[k.uniqueId]&&(h._connectionValues[k.uniqueId].type="Quaternion"),G}},"math/matDecompose":{zq:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"fi"}}}},"math/quatConjugate":eH("FlowGraphConjugateBlock",["a"]),"math/quatMul":{zq:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G){var h;return(h=G[0]).config||(h.config={}),G[0].config.type="Quaternion",G}},"math/quatAngleBetween":eH("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{zq:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":eH("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":eH("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{zq:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G){var h;return(h=G[0]).config||(h.config={}),G[0].config.inputIsColumnMajor=!0,G}},"math/extract2x2":{zq:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{zq:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G){var h;return(h=G[0]).config||(h.config={}),G[0].config.inputIsColumnMajor=!0,G}},"math/extract3x3":{zq:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{zq:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G){var h;return(h=G[0]).config||(h.config={}),G[0].config.inputIsColumnMajor=!0,G}},"math/extract4x4":{zq:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{zq:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G,h){var k,i;(i=G[0]).config||(i.config={});const B=G[0].dataInputs[0];return G[0].config.valueType=(null===(k=h._connectionValues[B.uniqueId])||void 0===k?void 0:k.type)??"FlowGraphInteger",G}},"math/and":{zq:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G,h){var k,i,B;(B=G[0]).config||(B.config={});const V=G[0].dataInputs[0],q=G[0].dataInputs[1];return G[0].config.valueType=(null===(k=h._connectionValues[V.uniqueId])||void 0===k?void 0:k.type)??(null===(i=h._connectionValues[q.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",G}},"math/or":{zq:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G,h){var k,i,B;(B=G[0]).config||(B.config={});const V=G[0].dataInputs[0],q=G[0].dataInputs[1];return G[0].config.valueType=(null===(k=h._connectionValues[V.uniqueId])||void 0===k?void 0:k.type)??(null===(i=h._connectionValues[q.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",G}},"math/xor":{zq:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(n,y,H,o,G,h){var k,i,B;(B=G[0]).config||(B.config={});const V=G[0].dataInputs[0],q=G[0].dataInputs[1];return G[0].config.valueType=(null===(k=h._connectionValues[V.uniqueId])||void 0===k?void 0:k.type)??(null===(i=h._connectionValues[q.uniqueId])||void 0===i?void 0:i.type)??"FlowGraphInteger",G}},"math/asr":eH("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":eH("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":eH("FlowGraphLeadingZerosBlock"),"math/ctz":eH("FlowGraphTrailingZerosBlock"),"math/popcnt":eH("FlowGraphOneBitsCounterBlock"),"math/rad":eH("FlowGraphDegToRadBlock"),"math/deg":eH("FlowGraphRadToDegBlock"),"type/boolToInt":eH("FlowGraphBooleanToInt"),"type/boolToFloat":eH("FlowGraphBooleanToFloat"),"type/intToBool":eH("FlowGraphIntToBoolean"),"type/intToFloat":eH("FlowGraphIntToFloat"),"type/floatToInt":eH("FlowGraphFloatToInt"),"type/floatToBool":eH("FlowGraphFloatToBoolean"),"flow/sequence":{zq:["FlowGraphSequenceBlock"],extraProcessor(n,y,H,o,G){const h=G[0];return h.config||(h.config={}),h.config.outputSignalCount=Object.keys(n.flows||[]).length,h.signalOutputs.forEach(((n,y)=>{n.name="out_"+y})),G}},"flow/branch":{zq:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{zq:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(n){if(n.configuration&&n.configuration.cases){const y=n.configuration.cases.value;if(!y.every((n=>"number"===typeof n&&/^-?\d+$/.test(n.toString()))))return W.d.Warn("Switch cases should be integers. Using empty array instead."),n.configuration.cases.value=[],{valid:!0};const H=new Set(y);n.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(n,y,H,o,G){if("flow/switch"!==y.op||!n.flows||0===Object.keys(n.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return G[0].signalOutputs.forEach((n=>{"default"!==n.name&&(n.name="out_"+n.name)})),G}},"flow/while":{zq:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{zq:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(n,y,H,o,G){const h=G[0];return h.config||(h.config={}),h.config.incrementIndexWhenLoopDone=!0,G}},"flow/doN":{zq:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{zq:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(n,y,H,o,G){if("flow/multiGate"!==y.op||!n.flows||0===Object.keys(n.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const h=G[0];return h.config||(h.config={}),h.config.outputSignalCount=Object.keys(n.flows).length,h.signalOutputs.forEach(((n,y)=>{n.name="out_"+y})),G}},"flow/waitAll":{zq:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(n){var y,H;return"number"!==typeof(null===(y=n.configuration)||void 0===y||null===(H=y.inputFlows)||void 0===H?void 0:H.value[0])&&(n.configuration=n.configuration||{inputFlows:{value:[0]}},n.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{zq:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{zq:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{zq:["FlowGraphCancelDelayBlock"]},"variable/get":{zq:["FlowGraphGetVariableBlock"],validation(n){var y,H;return null!==(y=n.configuration)&&void 0!==y&&null!==(H=y.variable)&&void 0!==H&&H.value?{valid:!0}:(W.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(n,y)=>[y.getVariableName(n[0])]}}},"variable/set":{zq:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(n,y)=>[y.getVariableName(n[0])]}}},"variable/setMultiple":{zq:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(n,y)=>[n[0].map((n=>y.getVariableName(n)))]}},extraProcessor:(n,y,H,o,G)=>(G[0].dataInputs.forEach((n=>{n.name=o.getVariableName(+n.name)})),G)},"variable/interpolate":{zq:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(n,y)=>[y.getVariableName(n[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:n=>!0===n[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dH:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dH:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dH:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dH:"FlowGraphPlayAnimationBlock"},out:{name:"out",dH:"FlowGraphPlayAnimationBlock"},done:{name:"done",dH:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(n,y,H,o,G){var h,k,i;const B=G[0],V=null===(h=n.configuration)||void 0===h?void 0:h.variable.value[0];if("number"!==typeof V)throw W.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const q=o.arrays.staticVariables[V];"undefined"===typeof B.config.animationType.value&&(o.arrays.staticVariables,B.config.animationType.value=(0,FH.A)(q.type));const b=G[4];return b.config||(b.config={}),(k=b.config).variable||(k.variable={}),b.config.variable.value=o.getVariableName(V),(i=G[3]).config||(i.config={}),G}},"pointer/get":{zq:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",dH:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(n,y,H,o,G)=>(G.forEach((n=>{"FlowGraphJsonPointerParserBlock"===n.className&&(n.config||(n.config={}),n.config.outputValue=!0)})),G)},"pointer/set":{zq:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",dH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",dH:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(n,y,H,o,G)=>(G.forEach((n=>{"FlowGraphJsonPointerParserBlock"===n.className&&(n.config||(n.config={}),n.config.outputValue=!0)})),G)},"pointer/interpolate":{zq:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",dH:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",dH:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",dH:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",dH:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",dH:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",dH:"FlowGraphPlayAnimationBlock"},out:{name:"out",dH:"FlowGraphPlayAnimationBlock"},done:{name:"done",dH:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(n,y,H,o,G)=>(G.forEach((y=>{"FlowGraphJsonPointerParserBlock"===y.className?(y.config||(y.config={}),y.config.outputValue=!0):"FlowGraphInterpolationBlock"===y.className&&(y.config||(y.config={}),Object.keys(n.values||[]).forEach((H=>{var G;const h=null===(G=n.values)||void 0===G?void 0:G[H];if("value"===H&&h){const n=h.type;void 0!==n&&(y.config.animationType=o.arrays.types[n].flowGraphType)}})))})),G)},"animation/start":{zq:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dH:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(n,y)=>[n[0]*y._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(n,y)=>[n[0]*y._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(n,y,H,o,G,h,k){const i=G[G.length-1];return i.config||(i.config={}),i.config.glTF=k,G}},"animation/stop":{zq:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",dH:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(n,y,H,o,G,h,k){const i=G[G.length-1];return i.config||(i.config={}),i.config.glTF=k,G}},"animation/stopAt":{zq:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",dH:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(n,y)=>[n[0]*y._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(n,y,H,o,G,h,k){const i=G[G.length-1];return i.config||(i.config={}),i.config.glTF=k,G}},"math/switch":{zq:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(n){if(n.configuration&&n.configuration.cases){const y=n.configuration.cases.value;if(!y.every((n=>"number"===typeof n&&/^-?\d+$/.test(n.toString()))))return W.d.Warn("Switch cases should be integers. Using empty array instead."),n.configuration.cases.value=[],{valid:!0};const H=new Set(y);n.configuration.cases.value=Array.from(H)}return{valid:!0}},extraProcessor(n,y,H,o,G){const h=G[0];return h.dataInputs.forEach((n=>{"default"!==n.name&&"case"!==n.name&&(n.name="in_"+n.name)})),h.config||(h.config={}),h.config.treatCasesAsIntegers=!0,G}},"debug/log":{zq:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function eH(n){let y=arguments.length>2?arguments[2]:void 0;return{zq:[n],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((n,y)=>(n[y]={name:y},n)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(n,H,o,G,h){var k;if(y){(k=h[0]).config||(k.config={}),h[0].config.preventIntegerFloatArithmetic=!0;let y=-1;Object.keys(n.values||{}).find((H=>{var o;return void 0!==(null===(o=n.values)||void 0===o?void 0:o[H].type)&&(y=n.values[H].type,!0)})),-1!==y&&(h[0].config.type=G.arrays.types[y].flowGraphType)}return h},validation:n=>y?wH(n):{valid:!0}}}function wH(n){if(n.values){const y=Object.keys(n.values).map((y=>n.values[y].type)).filter((n=>void 0!==n));if(!y.every((n=>n===y[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}OH["math/compose"]=OH["math/matCompose"],OH["math/decompose"]=OH["math/matDecompose"];var jH=H(11253);const IH={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"zy",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class RH{constructor(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=n,this._gltf=y,this._animationTargetFps=H,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const n of this._interactivityGraph.types)this._types.push(IH[n.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const n of this._interactivityGraph.declarations){const y=XH(n);if(!y)throw W.d.Error(["No mapping found for declaration",n]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:y,fullOperationName:n.extension?n.op+":"+n.extension:n.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const n of this._interactivityGraph.variables){const y=this._parseVariable(n);this._staticVariables.push(y)}}_parseVariable(n,y){const H=this._types[n.type];if(!H)throw W.d.Error(["No type found for variable",n]),new Error("Error parsing variables");if(n.value&&n.value.length!==H.length)throw W.d.Error(["Invalid value length for variable",n,H]),new Error("Error parsing variables");const o=n.value||[];if(!o.length)switch(H.flowGraphType){case"boolean":o.push(!1);break;case"FlowGraphInteger":o.push(0);break;case"number":o.push(NaN);break;case"Vector2":o.push(NaN,NaN);break;case"zy":o.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":o.fill(NaN,0,4);break;case"Matrix":o.fill(NaN,0,16);break;case"Matrix3D":o.fill(NaN,0,9)}return"number"===H.elementType&&"string"===typeof o[0]&&(o[0]=parseFloat(o[0])),{type:H.flowGraphType,value:y?y(o,this):o}}_parseEvents(){if(this._interactivityGraph.events)for(const n of this._interactivityGraph.events){const y={eventId:n.id||"internalEvent_"+this._internalEventsCounter++};n.values&&(y.eventData=Object.keys(n.values).map((y=>{var H;const o=null===(H=n.values)||void 0===H?void 0:H[y];if(!o)throw W.d.Error(["No value found for event key",y]),new Error("Error parsing events");const G=this._types[o.type];if(!G)throw W.d.Error(["No type found for event value",o]),new Error("Error parsing events");const h="undefined"!==typeof o.value?this._parseVariable(o):void 0;return{id:y,type:G.flowGraphType,eventData:!0,value:h}}))),this._events.push(y)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const y of this._interactivityGraph.nodes){if("number"!==typeof y.declaration)throw W.d.Error(["No declaration found for node",y]),new Error("Error parsing nodes");const H=this._mappings[y.declaration];if(!H)throw W.d.Error(["No mapping found for node",y]),new Error("Error parsing nodes");if(H.flowGraphMapping.validation){const o=H.flowGraphMapping.validation(y,this._interactivityGraph,this._gltf);var n;if(!o.valid)throw new Error(`Error validating interactivity node ${null===(n=this._interactivityGraph.declarations)||void 0===n?void 0:n[y.declaration].op} - ${o.error}`)}const o=[];for(const n of H.flowGraphMapping.zq){const G=this._getEmptyBlock(n,H.fullOperationName);this._parseNodeConfiguration(y,G,H.flowGraphMapping,n),o.push(G)}this._nodes.push({zq:o,fullOperationName:H.fullOperationName})}}_getEmptyBlock(n,y){return{uniqueId:(0,jH.b)(),className:n,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:y,metadata:{}}}_parseNodeConfiguration(n,y,H,o){const G=y.config;if(n.configuration){const y=Object.keys(n.configuration);for(const i of y){var h,k;const y=null===(h=n.configuration)||void 0===h?void 0:h[i];if(!y)throw W.d.Error(["No value found for node configuration",i]),new Error("Error parsing node configuration");const B=null===(k=H.configuration)||void 0===k?void 0:k[i];if(B&&B.dH?B.dH===o:0===H.zq.indexOf(o)){const n=(null===B||void 0===B?void 0:B.name)||i;y&&"undefined"!==typeof y.value||"undefined"===typeof(null===B||void 0===B?void 0:B.defaultValue)?y.value.length>=0?G[n]={value:1===y.value.length?y.value[0]:y.value}:W.d.Warn(["Invalid value for node configuration",y]):G[n]={value:B.defaultValue},B&&B.dataTransformer&&(G[n].value=B.dataTransformer([G[n].value],this)[0])}}}}_parseNodeConnections(n){for(let M=0;M<this._nodes.length;M++){var y;const f=null===(y=this._interactivityGraph.nodes)||void 0===y?void 0:y[M];if(!f)throw W.d.Error(["No node found for interactivity node",this._nodes[M]]),new Error("Error parsing node connections");const c=this._nodes[M],p=this._mappings[f.declaration];if(!p)throw W.d.Error(["No mapping found for node",f]),new Error("Error parsing node connections");const E=f.flows||{},X=Object.keys(E).sort();for(const n of X){var H,o,G,h;const y=E[n],V=null===(H=p.flowGraphMapping.outputs)||void 0===H||null===(o=H.flows)||void 0===o?void 0:o[n],q=(null===V||void 0===V?void 0:V.name)||n,b=this._createNewSocketConnection(q,!0);(V&&V.dH&&c.zq.find((n=>n.className===V.dH))||c.zq[0]).signalOutputs.push(b);const A=y.node,U=this._nodes[A];if(!U)throw W.d.Error(["No node found for input node id",A]),new Error("Error parsing node connections");const T=EH(U.fullOperationName);if(!T)throw W.d.Error(["No mapping found for input node",U]),new Error("Error parsing node connections");let z=null===(G=T.inputs)||void 0===G||null===(h=G.flows)||void 0===h?void 0:h[y.socket||"in"],Q=!1;if(!z)for(const n in null===(k=T.inputs)||void 0===k?void 0:k.flows){var k,i,B;if(n.startsWith("[")&&n.endsWith("]"))Q=!0,z=null===(i=T.inputs)||void 0===i||null===(B=i.flows)||void 0===B?void 0:B[n]}const l=z?Q?z.name.replace("$1",y.socket||""):z.name:y.socket||"in",v=z&&z.dH&&U.zq.find((n=>n.className===z.dH))||U.zq[0];let F=v.signalInputs.find((n=>n.name===l));F||(F=this._createNewSocketConnection(l),v.signalInputs.push(F)),F.connectedPointIds.push(b.uniqueId),b.connectedPointIds.push(F.uniqueId)}const d=f.values||{},a=Object.keys(d);for(const y of a){var V,q;const H=d[y];let o=null===(V=p.flowGraphMapping.inputs)||void 0===V||null===(q=V.values)||void 0===q?void 0:q[y],G=!1;if(!o)for(const n in null===(b=p.flowGraphMapping.inputs)||void 0===b?void 0:b.values){var b,A,U;if(n.startsWith("[")&&n.endsWith("]"))G=!0,o=null===(A=p.flowGraphMapping.inputs)||void 0===A||null===(U=A.values)||void 0===U?void 0:U[n]}const h=o?G?o.name.replace("$1",y):o.name:y,k=this._createNewSocketConnection(h);if((o&&o.dH&&c.zq.find((n=>n.className===o.dH))||c.zq[0]).dataInputs.push(k),void 0!==H.value){const y=this._parseVariable(H,o&&o.dataTransformer);n._connectionValues[k.uniqueId]=y}else{if("undefined"===typeof H.node)throw W.d.Error(["Invalid value for value connection",H]),new Error("Error parsing node connections");{var T,z,Q;const n=H.node,y=H.socket||"value",o=this._nodes[n];if(!o)throw W.d.Error(["No node found for output socket reference",H]),new Error("Error parsing node connections");const G=EH(o.fullOperationName);if(!G)throw W.d.Error(["No mapping found for output socket reference",H]),new Error("Error parsing node connections");let h=null===(T=G.outputs)||void 0===T||null===(z=T.values)||void 0===z?void 0:z[y],i=!1;if(!h)for(const H in null===(l=G.outputs)||void 0===l?void 0:l.values){var l,v,F;if(H.startsWith("[")&&H.endsWith("]"))i=!0,h=null===(v=G.outputs)||void 0===v||null===(F=v.values)||void 0===F?void 0:F[H]}const B=h?i?h.name.replace("$1",y):null===(Q=h)||void 0===Q?void 0:Q.name:y,V=h&&h.dH&&o.zq.find((n=>n.className===h.dH))||o.zq[0];let q=V.dataOutputs.find((n=>n.name===B));q||(q=this._createNewSocketConnection(B,!0),V.dataOutputs.push(q)),k.connectedPointIds.push(q.uniqueId),q.connectedPointIds.push(k.uniqueId)}}}if(p.flowGraphMapping.interBlockConnectors)for(const n of p.flowGraphMapping.interBlockConnectors){const y=n.input,H=n.output,o=n.isVariable;this._connectFlowGraphNodes(y,H,c.zq[n.inputBlockIndex],c.zq[n.outputBlockIndex],o)}if(p.flowGraphMapping.extraProcessor){var g;const y=null===(g=this._interactivityGraph.declarations)||void 0===g?void 0:g[f.declaration];if(!y)throw W.d.Error(["No declaration found for extra processor",f]),new Error("Error parsing node connections");c.zq=p.flowGraphMapping.extraProcessor(f,y,p.flowGraphMapping,this,c.zq,n,this._gltf)}}}_createNewSocketConnection(n,y){return{uniqueId:(0,jH.b)(),name:n,_connectionType:y?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(n,y,H,o,G){const h=G?H.dataInputs:H.signalInputs,k=G?o.dataOutputs:o.signalOutputs,i=h.find((y=>y.name===n))||this._createNewSocketConnection(n),B=k.find((n=>n.name===y))||this._createNewSocketConnection(y,!0);h.find((y=>y.name===n))||h.push(i),k.find((n=>n.name===y))||k.push(B),i.connectedPointIds.push(B.uniqueId),B.connectedPointIds.push(i.uniqueId)}getVariableName(n){return"staticVariable_"+n}serializeToFlowGraph(){const n={uniqueId:(0,jH.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(n);for(let y=0;y<this._staticVariables.length;y++){const H=this._staticVariables[y];n._userVariables[this.getVariableName(y)]=H}return{rightHanded:!0,allBlocks:this._nodes.reduce(((n,y)=>n.concat(y.zq)),[]),executionContexts:[n]}}}const CH="KHR_interactivity";class SH{constructor(n){this._loader=n,this.name=CH,this.enabled=this._loader.isExtensionUsed(CH),this._pathConverter=(0,S.g)(this._loader.rh),n._skipStartAnimationStep=!0;const y=n.babylonScene;y&&function(n){(0,S.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!n.activeCamera)return new G.Quaternion(NaN,NaN,NaN,NaN);const y=G.Quaternion.FromRotationMatrix(n.activeCamera.getWorldMatrix()).normalize();return n.useRightHandedSystem||(y.w*=-1,y.x*=-1),y},type:"Quaternion",getTarget:()=>n.activeCamera}),(0,S.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!n.activeCamera)return new G.zy(NaN,NaN,NaN);const y=n.activeCamera.getWorldMatrix().getTranslation();return n.useRightHandedSystem||(y.x*=-1),y},type:"zy",getTarget:()=>n.activeCamera}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:n=>{var y;return(null===(y=n._babylonAnimationGroup)||void 0===y?void 0:y.isPlaying)??!1},type:"boolean",getTarget:n=>n._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:n=>{var y;return((null===(y=n._babylonAnimationGroup)||void 0===y?void 0:y.from)??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:n=>{var y;return((null===(y=n._babylonAnimationGroup)||void 0===y?void 0:y.to)??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:n=>{var y;return((null===(y=n._babylonAnimationGroup)||void 0===y?void 0:y.getCurrentFrame())??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup}),(0,S.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:n=>{var y;return((null===(y=n._babylonAnimationGroup)||void 0===y?void 0:y.getCurrentFrame())??0)/60},type:"number",getTarget:n=>n._babylonAnimationGroup})}(y)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var n;if(!this._loader.babylonScene||!this._pathConverter)return;const y=this._loader.babylonScene,H=null===(n=this._loader.rh.extensions)||void 0===n?void 0:n.KHR_interactivity;if(!H)return;const o=new WH.d({ly:y});o.dispatchEventsSynchronously=!1;const G=H.graphs.map((n=>new RH(n,this._loader.rh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(G.map((async n=>await fH(n,{coordinator:o,pathConverter:this._pathConverter})))),o.start()}}var NH;NH=async()=>(await Promise.resolve().then(H.bind(H,13169))).FlowGraphGLTFDataProvider,zH[`${CH}/${"FlowGraphGLTFDataProvider"}`]=NH,C(CH),R(CH,!0,(n=>new SH(n)));const rH="KHR_node_visibility";(0,S.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:n=>{const y=n._babylonTransformNode;return!y||void 0===y.isVisible||y.isVisible},set:(n,y)=>{var H,o;null===(H=y._primitiveBabylonMeshes)||void 0===H||H.forEach((n=>{n.inheritVisibility=!0})),y._babylonTransformNode&&(y._babylonTransformNode.isVisible=n),null===(o=y._primitiveBabylonMeshes)||void 0===o||o.forEach((y=>{y.isVisible=n}))},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class KH{constructor(n){this.name=rH,this._loader=n,this.enabled=n.isExtensionUsed(rH)}async onReady(){var n;null===(n=this._loader.rh.nodes)||void 0===n||n.forEach((n=>{var y,H,o,G;(null===(y=n._primitiveBabylonMeshes)||void 0===y||y.forEach((n=>{n.inheritVisibility=!0})),null!==(H=n.extensions)&&void 0!==H&&H.KHR_node_visibility)&&(!1===(null===(o=n.extensions)||void 0===o?void 0:o.KHR_node_visibility.visible)&&(n._babylonTransformNode&&(n._babylonTransformNode.isVisible=!1),null===(G=n._primitiveBabylonMeshes)||void 0===G||G.forEach((n=>{n.isVisible=!1}))))}))}dispose(){this._loader=null}}C(rH),R(rH,!0,(n=>new KH(n)));const YH="KHR_node_selectability";dH("event/onSelect",YH,{zq:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dH:"FlowGraphGetVariableBlock",dataTransformer:n=>["pickedMesh_"+n[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",dH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(n,y,H,o,G,h,k){var i,B,V,q,b,A;const U=G[G.length-1];U.config=U.config||{},U.config.glTF=k;const T=null===(i=n.configuration)||void 0===i||null===(B=i.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const W="pickedMesh_"+T;return G[1].config.variable=W,h._userVariables[W]={className:"Mesh",id:null===k||void 0===k||null===(V=k.nodes)||void 0===V||null===(q=V[T]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===k||void 0===k||null===(b=k.nodes)||void 0===b||null===(A=b[T]._babylonTransformNode)||void 0===A?void 0:A.uniqueId},G}}),(0,S.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:n=>{const y=n._babylonTransformNode;return!y||void 0===y.KB||y.KB},set:(n,y)=>{var H;null===(H=y._primitiveBabylonMeshes)||void 0===H||H.forEach((y=>{y.KB=n}))},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"KB"],type:"boolean"});class DH{constructor(n){this.name=YH,this._loader=n,this.enabled=n.isExtensionUsed(YH)}async onReady(){var n;null===(n=this._loader.rh.nodes)||void 0===n||n.forEach((n=>{var y,H,o;null!==(y=n.extensions)&&void 0!==y&&y.KHR_node_selectability&&!1===(null===(H=n.extensions)||void 0===H?void 0:H.KHR_node_selectability.selectable)&&(null===(o=n._babylonTransformNode)||void 0===o||o.getChildMeshes().forEach((n=>{n.KB=!1})))}))}dispose(){this._loader=null}}C(YH),R(YH,!0,(n=>new DH(n)));const ZH="KHR_node_hoverability",sH="targetMeshPointerOver_";dH("event/onHoverIn",ZH,{zq:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dH:"FlowGraphGetVariableBlock",dataTransformer:n=>[sH+n[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(n,y,H,o,G,h,k){var i,B,V,q,b,A;const U=G[G.length-1];U.config=U.config||{},U.config.glTF=k;const T=null===(i=n.configuration)||void 0===i||null===(B=i.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const W=sH+T;return G[1].config.variable=W,h._userVariables[W]={className:"Mesh",id:null===k||void 0===k||null===(V=k.nodes)||void 0===V||null===(q=V[T]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===k||void 0===k||null===(b=k.nodes)||void 0===b||null===(A=b[T]._babylonTransformNode)||void 0===A?void 0:A.uniqueId},G}});const PH="targetMeshPointerOut_";dH("event/onHoverOut",ZH,{zq:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",dH:"FlowGraphGetVariableBlock",dataTransformer:n=>[PH+n[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",dH:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(n,y,H,o,G,h,k){var i,B,V,q,b,A;const U=G[G.length-1];U.config=U.config||{},U.config.glTF=k;const T=null===(i=n.configuration)||void 0===i||null===(B=i.nodeIndex)||void 0===B?void 0:B.value[0];if(void 0===T||"number"!==typeof T)throw new Error("nodeIndex not found in configuration");const W=PH+T;return G[1].config.variable=W,h._userVariables[W]={className:"Mesh",id:null===k||void 0===k||null===(V=k.nodes)||void 0===V||null===(q=V[T]._babylonTransformNode)||void 0===q?void 0:q.id,uniqueId:null===k||void 0===k||null===(b=k.nodes)||void 0===b||null===(A=b[T]._babylonTransformNode)||void 0===A?void 0:A.uniqueId},G}}),(0,S.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:n=>{const y=n._babylonTransformNode;return!y||void 0===y.pointerOverDisableMeshTesting||y.pointerOverDisableMeshTesting},set:(n,y)=>{var H;null===(H=y._primitiveBabylonMeshes)||void 0===H||H.forEach((y=>{y.pointerOverDisableMeshTesting=!n}))},getTarget:n=>n._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class xH{constructor(n){this.name=ZH,this._loader=n,this.enabled=n.isExtensionUsed(ZH)}async onReady(){var n;null===(n=this._loader.rh.nodes)||void 0===n||n.forEach((n=>{var y,H,o;null!==(y=n.extensions)&&void 0!==y&&y.KHR_node_hoverability&&!1===(null===(H=n.extensions)||void 0===H?void 0:H.KHR_node_hoverability.hoverable)&&(null===(o=n._babylonTransformNode)||void 0===o||o.getChildMeshes().forEach((n=>{n.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}C(ZH),R(ZH,!0,(n=>new xH(n)));const tH="ExtrasAsMetadata";class uH{_assignExtras(n,y){if(y.extras&&Object.keys(y.extras).length>0){const H=n.metadata=n.metadata||{};(H.rh=H.rh||{}).extras=y.extras}}constructor(n){this.name=tH,this.enabled=!0,this._loader=n}dispose(){this._loader=null}loadNodeAsync(n,y,H){return this._loader.loadNodeAsync(n,y,(n=>{this._assignExtras(n,y),H(n)}))}loadCameraAsync(n,y,H){return this._loader.loadCameraAsync(n,y,(n=>{this._assignExtras(n,y),H(n)}))}createMaterial(n,y,H){const o=this._loader.createMaterial(n,y,H);return this._assignExtras(o,y),o}}C(tH),R(tH,!1,(n=>new uH(n)));H(13169)},13043:(n,y,H)=>{"use strict";H.d(y,{b:()=>e,c:()=>p,d:()=>c,h:()=>E});var o=H(11099),G=H(11094),h=H(12661),k=H(11800),i=H(11766),B=H(11779),V=H(11114),q=H(11149),b=H(11798),A=H(11907),U=H(11806),T=H(11328);class W{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.NA=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.vU=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(n){this._environmentTexture=n}getNodes(){let n=[];n=n.concat(this.meshes),n=n.concat(this.lights),n=n.concat(this.cameras),n=n.concat(this.transformNodes);for(const y of this.skeletons)n=n.concat(y.bones);return n}}class z extends W{}class Q{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const n=this.rootNodes;for(const o of n)o.dispose();n.length=0;const y=this.skeletons;for(const o of y)o.dispose();y.length=0;const H=this.animationGroups;for(const o of H)o.dispose();H.length=0}}class l extends W{constructor(n){super(),this._wasAddedToScene=!1,(n=n||q.c.LastCreatedScene)&&(this.ly=n,this.proceduralTextures=[],n.ah.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=n.getEngine().onContextRestoredObservable.add((()=>{for(const n of this.geometries)n._rebuild();for(const n of this.meshes)n._rebuild();for(const n of this.NA)n.rebuild();for(const n of this.textures)n._rebuild()})))}_topologicalSort(n){const y=new Map;for(const k of n)y.set(k.uniqueId,k);const H={dependsOn:new Map,dependedBy:new Map};for(const k of n){const n=k.uniqueId;H.dependsOn.set(n,new Set),H.dependedBy.set(n,new Set)}for(const k of n){const n=k.uniqueId,o=H.dependsOn.get(n);if(k instanceof b.d){const G=k.sourceMesh;y.has(G.uniqueId)&&(o.add(G.uniqueId),H.dependedBy.get(G.uniqueId).add(n))}const G=H.dependedBy.get(n);for(const h of k.getDescendants()){const o=h.uniqueId;if(y.has(o)){G.add(o);H.dependsOn.get(o).add(n)}}}const o=[],G=[];for(const k of n){const n=k.uniqueId;0===H.dependsOn.get(n).size&&(G.push(k),y.delete(n))}const h=G;for(;h.length>0;){const n=h.shift();o.push(n);const G=H.dependedBy.get(n.uniqueId);for(const o of Array.from(G.values())){const G=H.dependsOn.get(o);G.delete(n.uniqueId),0===G.size&&y.get(o)&&(h.push(y.get(o)),y.delete(o))}}return y.size>0&&(V.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),y.forEach((n=>{V.d.Error(n.name)}))),o}_addNodeAndDescendantsToList(n,y,H,o){if(H&&(!o||o(H))&&!y.has(H.uniqueId)){n.push(H),y.add(H.uniqueId);for(const G of H.getDescendants(!0))this._addNodeAndDescendantsToList(n,y,G,o)}}_isNodeInContainer(n){return n instanceof B.d&&-1!==this.meshes.indexOf(n)||(n instanceof i.c&&-1!==this.transformNodes.indexOf(n)||(n instanceof A.e&&-1!==this.lights.indexOf(n)||n instanceof U.d&&-1!==this.cameras.indexOf(n)))}_isValidHierarchy(){for(const n of this.meshes)if(n.parent&&!this._isNodeInContainer(n.parent))return V.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;for(const n of this.transformNodes)if(n.parent&&!this._isNodeInContainer(n.parent))return V.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;for(const n of this.lights)if(n.parent&&!this._isNodeInContainer(n.parent))return V.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;for(const n of this.cameras)if(n.parent&&!this._isNodeInContainer(n.parent))return V.d.Warn(`Node ${n.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(n){let y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],H=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||G.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const o={},h={},i=new Q,B=[],V=[],q={doNotInstantiate:!0,...H},b=[],A=new Set;for(const G of this.transformNodes)null===G.parent&&this._addNodeAndDescendantsToList(b,A,G,q.predicate);for(const G of this.meshes)null===G.parent&&this._addNodeAndDescendantsToList(b,A,G,q.predicate);const U=this._topologicalSort(b),T=(H,G)=>{if(((y,H)=>{if(o[y.uniqueId]=H.uniqueId,h[H.uniqueId]=H,n&&(H.name=n(y.name)),H instanceof k.b){const n=H;if(n.morphTargetManager){const H=y.morphTargetManager;n.morphTargetManager=H.clone();for(let y=0;y<H.numTargets;y++){const G=H.getTarget(y),k=n.morphTargetManager.getTarget(y);o[G.uniqueId]=k.uniqueId,h[k.uniqueId]=k}}}})(H,G),H.parent){const n=o[H.parent.uniqueId],y=h[n];G.parent=y||H.parent}if(G.position&&H.position&&G.position.B(H.position),G.rotationQuaternion&&H.rotationQuaternion&&G.rotationQuaternion.B(H.rotationQuaternion),G.rotation&&H.rotation&&G.rotation.B(H.rotation),G.fi&&H.fi&&G.fi.B(H.fi),G.material){const k=G;if(k.material)if(y){const y=H.material;if(-1===V.indexOf(y)){let H=y.clone(n?n(y.name):"Clone of "+y.name);if(V.push(y),o[y.uniqueId]=H.uniqueId,h[H.uniqueId]=H,"MultiMaterial"===y.getClassName()){const G=y;for(const y of G.Ei)y&&(H=y.clone(n?n(y.name):"Clone of "+y.name),V.push(y),o[y.uniqueId]=H.uniqueId,h[H.uniqueId]=H);G.Ei=G.Ei.map((n=>n&&h[o[n.uniqueId]]))}}"InstancedMesh"!==k.getClassName()&&(k.material=h[o[y.uniqueId]])}else"MultiMaterial"===k.material.getClassName()?-1===this.ly.multiMaterials.indexOf(k.material)&&this.ly.addMultiMaterial(k.material):-1===this.ly.materials.indexOf(k.material)&&this.ly.addMaterial(k.material)}null===G.parent&&i.rootNodes.push(G)};for(const G of U)if("InstancedMesh"===G.getClassName()){const n=G,y=n.sourceMesh,H=o[y.uniqueId];T(n,("number"===typeof H?h[H]:y).createInstance(n.name))}else{let n=!0;"ob"===G.getClassName()||"Node"===G.getClassName()||G.skeleton||!G.getTotalVertices||0===G.getTotalVertices()?n=!1:q.doNotInstantiate&&(n="function"===typeof q.doNotInstantiate?!q.doNotInstantiate(G):!q.doNotInstantiate);const y=n?G.createInstance(`instance of ${G.name}`):G.clone(`Clone of ${G.name}`,null,!0);if(!y)throw new Error(`Could not clone or instantiate node on Asset Container ${G.name}`);T(G,y)}for(const G of this.skeletons){if(q.predicate&&!q.predicate(G))continue;const y=G.clone(n?n(G.name):"Clone of "+G.name);for(const n of this.meshes)if(n.skeleton===G&&!n.isAnInstance){const H=h[o[n.uniqueId]];if(!H||H.isAnInstance)continue;if(H.skeleton=y,-1!==B.indexOf(y))continue;B.push(y);for(const n of y.bones)n._linkedTransformNode&&(n._linkedTransformNode=h[o[n._linkedTransformNode.uniqueId]])}i.skeletons.push(y)}for(const G of this.animationGroups){if(q.predicate&&!q.predicate(G))continue;const y=G.clone(n?n(G.name):"Clone of "+G.name,(n=>h[o[n.uniqueId]]||n));i.animationGroups.push(y)}return i}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||G.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.ly.environmentTexture=this.environmentTexture);for(const n of this.ly._serializableComponents)n.addFromContainer(this);this.ly.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const y=[];for(const H of this.cameras)n&&!n(H)||(this.ly.addCamera(H),y.push(H));for(const H of this.lights)n&&!n(H)||(this.ly.addLight(H),y.push(H));for(const H of this.meshes)n&&!n(H)||(this.ly.Gq(H),y.push(H));for(const H of this.skeletons)n&&!n(H)||this.ly.addSkeleton(H);for(const H of this.animations)n&&!n(H)||this.ly.addAnimation(H);for(const H of this.animationGroups)n&&!n(H)||this.ly.addAnimationGroup(H);for(const H of this.multiMaterials)n&&!n(H)||this.ly.addMultiMaterial(H);for(const H of this.materials)n&&!n(H)||this.ly.addMaterial(H);for(const H of this.morphTargetManagers)n&&!n(H)||this.ly.addMorphTargetManager(H);for(const H of this.geometries)n&&!n(H)||this.ly.addGeometry(H);for(const H of this.transformNodes)n&&!n(H)||(this.ly.addTransformNode(H),y.push(H));for(const H of this.actionManagers)n&&!n(H)||this.ly.addActionManager(H);for(const H of this.textures)n&&!n(H)||this.ly.addTexture(H);for(const H of this.reflectionProbes)n&&!n(H)||this.ly.addReflectionProbe(H);for(const H of y)H.parent&&-1===this.ly.getNodes().indexOf(H.parent)&&(H.setParent?H.setParent(null):H.parent=null)}removeAllFromScene(){this._isValidHierarchy()||G.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.ly.environmentTexture&&(this.ly.environmentTexture=null);for(const n of this.ly._serializableComponents)n.removeFromContainer(this)}removeFromScene(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const y of this.cameras)n&&!n(y)||this.ly.removeCamera(y);for(const y of this.lights)n&&!n(y)||this.ly.removeLight(y);for(const y of this.meshes)n&&!n(y)||this.ly.oq(y,!0);for(const y of this.skeletons)n&&!n(y)||this.ly.removeSkeleton(y);for(const y of this.animations)n&&!n(y)||this.ly.removeAnimation(y);for(const y of this.animationGroups)n&&!n(y)||this.ly.removeAnimationGroup(y);for(const y of this.multiMaterials)n&&!n(y)||this.ly.removeMultiMaterial(y);for(const y of this.materials)n&&!n(y)||this.ly.removeMaterial(y);for(const y of this.morphTargetManagers)n&&!n(y)||this.ly.removeMorphTargetManager(y);for(const y of this.geometries)n&&!n(y)||this.ly.removeGeometry(y);for(const y of this.transformNodes)n&&!n(y)||this.ly.removeTransformNode(y);for(const y of this.actionManagers)n&&!n(y)||this.ly.removeActionManager(y);for(const y of this.textures)n&&!n(y)||this.ly.removeTexture(y);for(const y of this.reflectionProbes)n&&!n(y)||this.ly.removeReflectionProbe(y)}dispose(){const n=this.cameras.slice(0);for(const U of n)U.dispose();this.cameras.length=0;const y=this.lights.slice(0);for(const U of y)U.dispose();this.lights.length=0;const H=this.meshes.slice(0);for(const U of H)U.dispose();this.meshes.length=0;const o=this.skeletons.slice(0);for(const U of o)U.dispose();this.skeletons.length=0;const G=this.animationGroups.slice(0);for(const U of G)U.dispose();this.animationGroups.length=0;const h=this.multiMaterials.slice(0);for(const U of h)U.dispose();this.multiMaterials.length=0;const k=this.materials.slice(0);for(const U of k)U.dispose();this.materials.length=0;const i=this.geometries.slice(0);for(const U of i)U.dispose();this.geometries.length=0;const B=this.transformNodes.slice(0);for(const U of B)U.dispose();this.transformNodes.length=0;const V=this.actionManagers.slice(0);for(const U of V)U.dispose();this.actionManagers.length=0;const q=this.textures.slice(0);for(const U of q)U.dispose();this.textures.length=0;const b=this.reflectionProbes.slice(0);for(const U of b)U.dispose();this.reflectionProbes.length=0;const A=this.morphTargetManagers.slice(0);for(const U of A)U.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const U of this.ly._serializableComponents)U.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.ly.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(n,y,H){if(n&&y)for(const o of n){let n=!0;if(H)for(const y of H)if(o===y){n=!1;break}n&&(y.push(o),o._parentContainer=this)}}moveAllFromScene(n){this._wasAddedToScene=!1,void 0===n&&(n=new z);for(const y in this)Object.prototype.hasOwnProperty.call(this,y)&&(this[y]=this[y]||("_environmentTexture"===y?null:[]),this._moveAssets(this.ly[y],this[y],n[y]));this.environmentTexture=this.ly.environmentTexture,this.removeAllFromScene()}createRootMesh(){const n=new k.b("assetContainerRootMesh",this.ly);for(const y of this.meshes)y.parent||n.addChild(y);return this.meshes.unshift(n),n}mergeAnimationsTo(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.c.LastCreatedScene,y=arguments.length>1?arguments[1]:void 0,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!n)return V.d.Error("No scene available to merge animations to"),[];const o=H||(y=>{let H=null;const o=y.animations.length?y.animations[0].targetProperty:"",G=y.name.split(".").join("").split("_primitive")[0];switch(o){case"position":case"rotationQuaternion":H=n.getTransformNodeByName(y.name)||n.getTransformNodeByName(G);break;case"influence":H=n.getMorphTargetByName(y.name)||n.getMorphTargetByName(G);break;default:H=n.getNodeByName(y.name)||n.getNodeByName(G)}return H}),G=this.getNodes();for(const i of G){const n=o(i);if(null!==n){for(const y of i.animations){const H=n.animations.filter((n=>n.targetProperty===y.targetProperty));for(const y of H){const H=n.animations.indexOf(y,0);H>-1&&n.animations.splice(H,1)}}n.animations=n.animations.concat(i.animations)}}const h=[],k=this.animationGroups.slice();for(const i of k){h.push(i.clone(i.name,o));for(const n of i.animatables)n.stop()}for(const i of y){const y=o(i.target);y&&(n.beginAnimation(y,i.fromFrame,i.toFrame,i.loopAnimation,i.speedRatio,i.onAnimationEnd?i.onAnimationEnd:void 0,void 0,!0,void 0,i.onAnimationLoop?i.onAnimationLoop:void 0),n.stopAnimation(i.target))}return h}populateRootNodes(){this.rootNodes.length=0;for(const n of this.meshes)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n);for(const n of this.transformNodes)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n);for(const n of this.lights)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n);for(const n of this.cameras)n.parent||-1!==this.rootNodes.indexOf(n)||this.rootNodes.push(n)}addAllAssetsToContainer(n){if(!n)return;const y=[],H=new Set;for(y.push(n);y.length>0;){const n=y.pop();if(n instanceof k.b?(n.li&&-1===this.geometries.indexOf(n.li)&&this.geometries.push(n.li),this.meshes.push(n)):n instanceof b.d?this.meshes.push(n):n instanceof i.c?this.transformNodes.push(n):n instanceof A.e?this.lights.push(n):n instanceof U.d&&this.cameras.push(n),n instanceof B.d){if(n.material&&-1===this.materials.indexOf(n.material)){this.materials.push(n.material);for(const y of n.material.getActiveTextures())-1===this.textures.indexOf(y)&&this.textures.push(y)}n.skeleton&&-1===this.skeletons.indexOf(n.skeleton)&&this.skeletons.push(n.skeleton),n.morphTargetManager&&-1===this.morphTargetManagers.indexOf(n.morphTargetManager)&&this.morphTargetManagers.push(n.morphTargetManager)}for(const o of n.getChildren())H.has(o)||y.push(o);H.add(n)}this.populateRootNodes()}_getByTags(n,y,H){if(void 0===y)return n;const o=[];for(const G in n){const h=n[G];T.d&&T.d.MatchesQuery(h,y)&&(!H||H(h))&&o.push(h)}return o}getMeshesByTags(n,y){return this._getByTags(this.meshes,n,y)}getCamerasByTags(n,y){return this._getByTags(this.cameras,n,y)}getLightsByTags(n,y){return this._getByTags(this.lights,n,y)}getMaterialsByTags(n,y){return this._getByTags(this.materials,n,y).concat(this._getByTags(this.multiMaterials,n,y))}getTransformNodesByTags(n,y){return this._getByTags(this.transformNodes,n,y)}}var v=H(11167);class F{constructor(n){this.byteOffset=0,this.buffer=n}async loadAsync(n){const y=await this.buffer.readAsync(this.byteOffset,n);this._dataView=new DataView(y.buffer,y.byteOffset,y.byteLength),this._dataByteOffset=0}readUint32(){const n=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,n}readUint8Array(n){const y=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,n);return this._dataByteOffset+=n,this.byteOffset+=n,y}readString(n){return(0,v.m)(this.readUint8Array(n))}skipBytes(n){this._dataByteOffset+=n,this.byteOffset+=n}}var g=H(13050);const M="Z2xURg",f={name:"rh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:n=>-1!==n.indexOf("asset")&&-1!==n.indexOf("version")||n.startsWith("data:base64,"+M)||n.startsWith("data:;base64,"+M)||n.startsWith("data:application/octet-stream;base64,"+M)||n.startsWith("data:model/gltf-binary;base64,"+M)};var c,p,E,X=H(11154),d=H(11161);function a(n,y,H){try{return Promise.resolve(new Uint8Array(n,y,H))}catch(o){return Promise.reject(o)}}!function(n){n[n.AUTO=0]="AUTO",n[n.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(c||(c={})),function(n){n[n.NONE=0]="NONE",n[n.FIRST=1]="FIRST",n[n.ALL=2]="ALL"}(p||(p={})),function(n){n[n.LOADING=0]="LOADING",n[n.READY=1]="READY",n[n.COMPLETE=2]="COMPLETE"}(E||(E={}));class O{constructor(){this.coordinateSystemMode=c.AUTO,this.animationStartMode=p.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=n=>Promise.resolve(n),this.extensionOptions={}}B(n){n&&(this.onParsed=n.onParsed,this.coordinateSystemMode=n.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=n.animationStartMode??this.animationStartMode,this.loadNodeAnimations=n.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=n.loadSkins??this.loadSkins,this.loadMorphTargets=n.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=n.compileMaterials??this.compileMaterials,this.useClipPlane=n.useClipPlane??this.useClipPlane,this.compileShadowGenerators=n.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=n.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=n.useRangeRequests??this.useRangeRequests,this.createInstances=n.createInstances??this.createInstances,this.alwaysComputeBoundingBox=n.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=n.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=n.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=n.skipMaterials??this.skipMaterials,this.useSRGBBuffers=n.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=n.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=n.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=n.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=n.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=n.customRootNode,this.onMeshLoaded=n.onMeshLoaded,this.onSkinLoaded=n.onSkinLoaded,this.onTextureLoaded=n.onTextureLoaded,this.onMaterialLoaded=n.onMaterialLoaded,this.onCameraLoaded=n.onCameraLoaded,this.extensionOptions=n.extensionOptions??this.extensionOptions)}}class e extends O{constructor(n){super(),this.onParsedObservable=new o.c,this.onMeshLoadedObservable=new o.c,this.onSkinLoadedObservable=new o.c,this.onTextureLoadedObservable=new o.c,this.onMaterialLoadedObservable=new o.c,this.onCameraLoadedObservable=new o.c,this.onCompleteObservable=new o.c,this.onErrorObservable=new o.c,this.ah=new o.c,this.onExtensionLoadedObservable=new o.c,this.validate=!1,this.onValidatedObservable=new o.c,this._loader=null,this._state=null,this._requests=new Array,this.name=f.name,this.extensions=f.extensions,this.onLoaderStateChangedObservable=new o.c,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.B(n)}set onParsed(n){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),n&&(this._onParsedObserver=this.onParsedObservable.add(n))}set onMeshLoaded(n){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),n&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(n))}set onSkinLoaded(n){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),n&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((y=>n(y.node,y.skinnedNode))))}set onTextureLoaded(n){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),n&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(n))}set onMaterialLoaded(n){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),n&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(n))}set onCameraLoaded(n){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),n&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(n))}set onComplete(n){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(n)}set onError(n){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(n)}set onDispose(n){this._onDisposeObserver&&this.ah.remove(this._onDisposeObserver),this._onDisposeObserver=this.ah.add(n)}set onExtensionLoaded(n){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(n)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(n){this._loggingEnabled!==n&&(this._loggingEnabled=n,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(n){this._capturePerformanceCounters!==n&&(this._capturePerformanceCounters=n,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(n){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(n)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const n of this._requests)n.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=n=>Promise.resolve(n),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.ah.notifyObservers(void 0),this.ah.clear()}loadFile(n,y,H,h,k,i,B,q){if(ArrayBuffer.isView(y))return this._loadBinary(n,y,H,h,B,q),null;this._progressCallback=k;const b=y.name||G.Tools.GetFilename(y);if(i){if(this.useRangeRequests){this.validate&&V.d.Warn("glTF validation is not supported when range requests are enabled");const H={abort:()=>{},onCompleteObservable:new o.c},G={readAsync:(H,o)=>new Promise(((G,h)=>{this._loadFile(n,y,(n=>{G(new Uint8Array(n))}),!0,(n=>{h(n)}),(n=>{n.setRequestHeader("Range",`bytes=${H}-${H+o-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new F(G)).then((n=>{H.onCompleteObservable.notifyObservers(H),h(n)}),B?n=>B(void 0,n):void 0),H}return this._loadFile(n,y,(y=>{this._validate(n,new Uint8Array(y,0,y.byteLength),H,b),this._unpackBinaryAsync(new F({readAsync:(n,H)=>a(y,n,H),byteLength:y.byteLength})).then((n=>{h(n)}),B?n=>B(void 0,n):void 0)}),!0,B)}return this._loadFile(n,y,(y=>{try{this._validate(n,y,H,b),h({json:this._parseJson(y)})}catch{B&&B()}}),!1,B)}_loadBinary(n,y,H,o,G,h){this._validate(n,new Uint8Array(y.buffer,y.byteOffset,y.byteLength),H,h),this._unpackBinaryAsync(new F({readAsync:(n,H)=>function(n,y,H){try{if(y<0||y>=n.byteLength)throw new RangeError("Offset is out of range.");if(y+H>n.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(n.buffer,n.byteOffset+y,H))}catch(o){return Promise.reject(o)}}(y,n,H),byteLength:y.byteLength})).then((n=>{o(n)}),G?n=>G(void 0,n):void 0)}importMeshAsync(n,y,H,o,G,h){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${h||""}`),this._loader=this._getLoader(H),this._loader.importMeshAsync(n,y,null,H,o,G,h))))}loadAsync(n,y,H,o,G){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(y),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(y),this._loader.loadAsync(n,y,H,o,G))))}loadAssetContainerAsync(n,y,H,o,G){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(y),this.onParsedObservable.clear(),this._log(`Loading ${G||""}`),this._loader=this._getLoader(y);const h=new l(n),k=[];this.onMaterialLoadedObservable.add((n=>{k.push(n)}));const i=[];this.onTextureLoadedObservable.add((n=>{i.push(n)}));const B=[];this.onCameraLoadedObservable.add((n=>{B.push(n)}));const V=[];return this.onMeshLoadedObservable.add((n=>{n.morphTargetManager&&V.push(n.morphTargetManager)})),this._loader.importMeshAsync(null,n,h,y,H,o,G).then((n=>(Array.prototype.push.apply(h.geometries,n.geometries),Array.prototype.push.apply(h.meshes,n.meshes),Array.prototype.push.apply(h.NA,n.NA),Array.prototype.push.apply(h.skeletons,n.skeletons),Array.prototype.push.apply(h.animationGroups,n.animationGroups),Array.prototype.push.apply(h.materials,k),Array.prototype.push.apply(h.textures,i),Array.prototype.push.apply(h.lights,n.lights),Array.prototype.push.apply(h.transformNodes,n.transformNodes),Array.prototype.push.apply(h.cameras,B),Array.prototype.push.apply(h.morphTargetManagers,V),h)))}))}canDirectLoad(n){return f.canDirectLoad(n)}directLoad(n,y){if(y.startsWith("base64,"+M)||y.startsWith(";base64,"+M)||y.startsWith("application/octet-stream;base64,"+M)||y.startsWith("model/gltf-binary;base64,"+M)){const H=(0,X.c)(y);return this._validate(n,new Uint8Array(H,0,H.byteLength)),this._unpackBinaryAsync(new F({readAsync:(n,y)=>a(H,n,y),byteLength:H.byteLength}))}return this._validate(n,y),Promise.resolve({json:this._parseJson(y)})}createPlugin(n){return new e(n[f.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((n,y)=>{this.onCompleteObservable.addOnce((()=>{n()})),this.onErrorObservable.addOnce((n=>{y(n)}))}))}_setState(n){this._state!==n&&(this._state=n,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(E[this._state]))}_loadFile(n,y,H,o,G,h){const k=n._loadFile(y,H,(n=>{this._onProgress(n,k)}),!0,o,G,h);return k.onCompleteObservable.add((()=>{k._lengthComputable=!0,k._total=k._loaded})),this._requests.push(k),k}_onProgress(n,y){if(!this._progressCallback)return;y._lengthComputable=n.lengthComputable,y._loaded=n.loaded,y._total=n.total;let H=!0,o=0,G=0;for(const h of this._requests){if(void 0===h._lengthComputable||void 0===h._loaded||void 0===h._total)return;H=H&&h._lengthComputable,o+=h._loaded,G+=h._total}this._progressCallback({lengthComputable:H,loaded:o,total:H?G:0})}_validate(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),g.b.ValidateAsync(y,H,o,(y=>this.preprocessUrlAsync(H+y).then((y=>n._loadFileAsync(y,void 0,!0,!0).then((n=>new Uint8Array(n,0,n.byteLength))))))).then((n=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(n),this.onValidatedObservable.clear()}),(n=>{this._endPerformanceCounter("Validate JSON"),G.Tools.Warn(`Failed to validate: ${n.message}`),this.onValidatedObservable.clear()})))}_getLoader(n){const y=n.json.asset||{};this._log(`Asset version: ${y.version}`),y.minVersion&&this._log(`Asset minimum version: ${y.minVersion}`),y.generator&&this._log(`Asset generator: ${y.generator}`);const H=e._parseVersion(y.version);if(!H)throw new Error("Invalid version: "+y.version);if(void 0!==y.minVersion){const n=e._parseVersion(y.minVersion);if(!n)throw new Error("Invalid minimum version: "+y.minVersion);if(e._compareVersion(n,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+y.minVersion)}const o={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[H.major];if(!o)throw new Error("Unsupported version: "+y.version);return o(this)}_parseJson(n){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${n.length}`);const y=JSON.parse(n);return this._endPerformanceCounter("Parse JSON"),y}_unpackBinaryAsync(n){return this._startPerformanceCounter("Unpack Binary"),n.loadAsync(20).then((()=>{const y=n.readUint32();if(1179937895!==y)throw new d.h("Unexpected magic: "+y,d.e.GLTFLoaderUnexpectedMagicError);const H=n.readUint32();this.loggingEnabled&&this._log(`Binary version: ${H}`);const o=n.readUint32();let G;switch(this.useRangeRequests||o===n.buffer.byteLength||V.d.Warn(`Length in header does not match actual data length: ${o} != ${n.buffer.byteLength}`),H){case 1:G=this._unpackBinaryV1Async(n,o);break;case 2:G=this._unpackBinaryV2Async(n,o);break;default:throw new Error("Unsupported version: "+H)}return this._endPerformanceCounter("Unpack Binary"),G}))}_unpackBinaryV1Async(n,y){const H=n.readUint32(),o=n.readUint32();if(0!==o)throw new Error(`Unexpected content format: ${o}`);const G=y-n.byteOffset,h={json:this._parseJson(n.readString(H)),bin:null};if(0!==G){const y=n.byteOffset;h.bin={readAsync:(H,o)=>n.buffer.readAsync(y+H,o),byteLength:G}}return Promise.resolve(h)}_unpackBinaryV2Async(n,y){const H=1313821514,o=5130562,G=n.readUint32();if(n.readUint32()!==H)throw new Error("First chunk format is not JSON");return n.byteOffset+G===y?n.loadAsync(G).then((()=>({json:this._parseJson(n.readString(G)),bin:null}))):n.loadAsync(G+8).then((()=>{const h={json:this._parseJson(n.readString(G)),bin:null},k=()=>{const G=n.readUint32();switch(n.readUint32()){case H:throw new Error("Unexpected JSON chunk");case o:{const y=n.byteOffset;h.bin={readAsync:(H,o)=>n.buffer.readAsync(y+H,o),byteLength:G},n.skipBytes(G);break}default:n.skipBytes(G)}return n.byteOffset!==y?n.loadAsync(8).then(k):Promise.resolve(h)};return k()}))}static _parseVersion(n){if("1.0"===n||"1.0.1"===n)return{major:1,minor:0};const y=(n+"").match(/^(\d+)\.(\d+)/);return y?{major:parseInt(y[1]),minor:parseInt(y[2])}:null}static _compareVersion(n,y){return n.major>y.major?1:n.major<y.major?-1:n.minor>y.minor?1:n.minor<y.minor?-1:0}_logOpen(n){this._log(n),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(n){const y=e._logSpaces.substring(0,2*this._logIndentLevel);V.d.Log(`${y}${n}`)}_logDisabled(n){}_startPerformanceCounterEnabled(n){G.Tools.StartPerformanceCounter(n)}_startPerformanceCounterDisabled(n){}_endPerformanceCounterEnabled(n){G.Tools.EndPerformanceCounter(n)}_endPerformanceCounterDisabled(n){}}e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._logSpaces="                                ",(0,h.e)(new e)},13050:(n,y,H)=>{"use strict";H.d(y,{b:()=>k});var o=H(11094);function G(n,y,H,o){const G={externalResourceFunction:o};return H&&(G.uri="file:"===y?H:y+H),ArrayBuffer.isView(n)?GLTFValidator.validateBytes(n,G):GLTFValidator.validateString(n,G)}function h(){const n=[];onmessage=y=>{const H=y.data;switch(H.id){case"init":importScripts(H.url);break;case"validate":G(H.data,H.rootUrl,H.fileName,(y=>new Promise(((H,o)=>{const G=n.length;n.push({resolve:H,reject:o}),postMessage({id:"getExternalResource",index:G,uri:y})})))).then((n=>{postMessage({id:"validate.resolve",value:n})}),(n=>{postMessage({id:"validate.reject",reason:n})}));break;case"getExternalResource.resolve":n[H.index].resolve(H.value);break;case"getExternalResource.reject":n[H.index].reject(H.reason)}}}class k{static ValidateAsync(n,y,H,k){return"function"===typeof Worker?new Promise(((i,B)=>{const V=`${G}(${h})()`,q=URL.createObjectURL(new Blob([V],{type:"application/javascript"})),b=new Worker(q),A=n=>{b.removeEventListener("error",A),b.removeEventListener("message",U),B(n)},U=n=>{const y=n.data;switch(y.id){case"getExternalResource":k(y.uri).then((n=>{b.postMessage({id:"getExternalResource.resolve",index:y.index,value:n},[n.buffer])}),(n=>{b.postMessage({id:"getExternalResource.reject",index:y.index,reason:n})}));break;case"validate.resolve":b.removeEventListener("error",A),b.removeEventListener("message",U),i(y.value),b.terminate();break;case"validate.reject":b.removeEventListener("error",A),b.removeEventListener("message",U),B(y.reason),b.terminate()}};if(b.addEventListener("error",A),b.addEventListener("message",U),b.postMessage({id:"init",url:o.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(n)){const o=n.slice();b.postMessage({id:"validate",data:o,rootUrl:y,fileName:H},[o.buffer])}else b.postMessage({id:"validate",data:n,rootUrl:y,fileName:H})})):(this._LoadScriptPromise||(this._LoadScriptPromise=o.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>G(n,y,H,k))))}}k.Configuration={url:`${o.Tools._DefaultCdnUrl}/gltf_validator.js`}},13591:(n,y,H)=>{"use strict";H.d(y,{b:()=>f});var o=H(11278),G=H(11280),h=H(11325),k=H(11288),i=H(11732),B=H(11649),V=H(11360),q=H(11554),b=H(11248),A=H(11202);H(12801),H(12698),H(12720),H(12706),H(12726),H(12730),H(12738);const U="imageProcessingCompatibility",T="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";A.e.IncludesShadersStore[U]||(A.e.IncludesShadersStore[U]=T);const W="skyPixelShader",z="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";A.e.ShadersStore[W]||(A.e.ShadersStore[W]=z);H(12815),H(12740),H(12748),H(12758),H(12755);const Q="skyVertexShader",l="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";A.e.ShadersStore[Q]||(A.e.ShadersStore[Q]=l);var v=H(11642),F=H(11710),g=H(11705);class M extends i.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class f extends B.d{constructor(n,y){super(n,y),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new k.zy(0,100,0),this.useSunPosition=!1,this.cameraOffset=k.zy.Zero(),this.up=k.zy.Up(),this.dithering=!1,this._cameraPosition=k.zy.Zero(),this._skyOrientation=new k.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(n,y){const H=y._drawWrapper;if(this.isFrozen&&H.effect&&H._wasPreviouslyReady)return!0;y.materialDefines||(y.materialDefines=new M);const o=y.materialDefines,G=this.pn();if(this._isReadyForSubMesh(y))return!0;if((0,g.V)(n,G,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,o),(0,g.K)(n,o,!0,!1),o.IMAGEPROCESSINGPOSTPROCESS!==G.imageProcessingConfiguration.applyByPostProcess&&o.markAsMiscDirty(),o.DITHER!==this.dithering&&o.markAsMiscDirty(),o.isDirty){o.markAsProcessed(),G.resetCachedMaterial();const n=new v.b;o.FOG&&n.addFallback(1,"FOG"),o.IMAGEPROCESSINGPOSTPROCESS=G.imageProcessingConfiguration.applyByPostProcess,o.DITHER=this.dithering;const H=[V.g.PositionKind];o.VERTEXCOLOR&&H.push(V.g.ColorKind);const h="sky",k=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,F.d)(k);const i=o.toString();y.setEffect(G.getEngine().createEffect(h,H,k,[],i,n,this.onCompiled,this.onError),o,this._materialContext)}return!(!y.effect||!y.effect.isReady())&&(o._renderId=G.getRenderId(),H._wasPreviouslyReady=!0,!0)}bindForSubMesh(n,y,H){const o=this.pn(),G=H.materialDefines;if(!G)return;const h=H.effect;if(!h)return;this._activeEffect=h,this.bindOnlyWorldMatrix(n),this._activeEffect.setMatrix("viewProjection",o.getTransformMatrix()),this._mustRebind(o,h,H)&&((0,F.h)(h,this,o),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,g.m)(G,h,o)),o.fogEnabled&&y.applyFog&&o.fogMode!==q.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",o.getViewMatrix()),(0,g.g)(o,y,this._activeEffect);const i=o.activeCamera;if(i){const n=i.getWorldMatrix();this._cameraPosition.x=n.m[12],this._cameraPosition.y=n.m[13],this._cameraPosition.z=n.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const n=Math.PI*(this.inclination-.5),y=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(y)*Math.cos(n),this.sunPosition.y=this.distance*Math.sin(-n),this.sunPosition.z=this.distance*Math.sin(y)*Math.cos(n),k.Quaternion.FromUnitVectorsToRef(k.zy.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(y,this._activeEffect,H)}getAnimatables(){return[]}dispose(n){super.dispose(n)}clone(n){return h.c.Clone((()=>new f(n,this.pn())),this)}serialize(){const n=super.serialize();return n.customType="BABYLON.SkyMaterial",n}getClassName(){return"SkyMaterial"}static Parse(n,y,H){return h.c.Parse((()=>new f(n.name,y)),n,y,H)}}(0,o.e)([(0,G.J)()],f.prototype,"luminance",void 0),(0,o.e)([(0,G.J)()],f.prototype,"turbidity",void 0),(0,o.e)([(0,G.J)()],f.prototype,"rayleigh",void 0),(0,o.e)([(0,G.J)()],f.prototype,"mieCoefficient",void 0),(0,o.e)([(0,G.J)()],f.prototype,"mieDirectionalG",void 0),(0,o.e)([(0,G.J)()],f.prototype,"distance",void 0),(0,o.e)([(0,G.J)()],f.prototype,"inclination",void 0),(0,o.e)([(0,G.J)()],f.prototype,"azimuth",void 0),(0,o.e)([(0,G.F)()],f.prototype,"sunPosition",void 0),(0,o.e)([(0,G.J)()],f.prototype,"useSunPosition",void 0),(0,o.e)([(0,G.F)()],f.prototype,"cameraOffset",void 0),(0,o.e)([(0,G.F)()],f.prototype,"up",void 0),(0,o.e)([(0,G.J)()],f.prototype,"dithering",void 0),(0,b.h)("BABYLON.SkyMaterial",f)},12078:(n,y,H)=>{"use strict";function o(n,y){y.headers=n.headers||{},y.statusMessage=n.statusText,y.statusCode=n.status,y.data=n.response}function G(n,y,H){return new Promise((function(G,h){H=H||{};var k,i,B,V=new XMLHttpRequest,q=H.body,b=H.headers||{};for(k in H.timeout&&(V.timeout=H.timeout),V.ontimeout=V.onerror=function(n){n.timeout="timeout"==n.type,h(n)},V.open(n,y.href||y),V.onload=function(){for(B=V.getAllResponseHeaders().trim().split(/[\r\n]+/),o(V,V);i=B.shift();)i=i.split(": "),V.headers[i.shift().toLowerCase()]=i.join(": ");if((i=V.headers["content-type"])&&~i.indexOf("application/json"))try{V.data=JSON.parse(V.data,H.reviver)}catch(n){return o(V,n),h(n)}(V.status>=400?h:G)(V)},typeof FormData<"u"&&q instanceof FormData||q&&"object"==typeof q&&(b["content-type"]="application/json",q=JSON.stringify(q)),V.withCredentials=!!H.withCredentials,b)V.setRequestHeader(k,b[k]);V.send(q)}))}H.r(y),H.d(y,{del:()=>B,get:()=>h,patch:()=>i,post:()=>k,put:()=>V,send:()=>G});var h=G.bind(G,"GET"),k=G.bind(G,"POST"),i=G.bind(G,"PATCH"),B=G.bind(G,"DELETE"),V=G.bind(G,"PUT")},13701:(n,y,H)=>{"use strict";H.d(y,{b:()=>b});const o=.5*(Math.sqrt(3)-1),G=(3-Math.sqrt(3))/6,h=1/3,k=1/6,i=(Math.sqrt(5)-1)/4,B=(5-Math.sqrt(5))/20,V=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),q=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const b=class{constructor(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const y="function"==typeof n?n:function(n){let y=0,H=0,o=0,G=1;const h=function(){let n=4022871197;return function(y){y=y.toString();for(let H=0;H<y.length;H++){n+=y.charCodeAt(H);let o=.02519603282416938*n;n=o>>>0,o-=n,o*=n,n=o>>>0,o-=n,n+=4294967296*o}return 2.3283064365386963e-10*(n>>>0)}}();y=h(" "),H=h(" "),o=h(" "),y-=h(n),y<0&&(y+=1);H-=h(n),H<0&&(H+=1);o-=h(n),o<0&&(o+=1);return function(){const n=2091639*y+2.3283064365386963e-10*G;return y=H,H=o,o=n-(G=0|n)}}(n);this.p=function(n){const y=new Uint8Array(256);for(let H=0;H<256;H++)y[H]=H;for(let H=0;H<255;H++){const o=H+~~(n()*(256-H)),G=y[H];y[H]=y[o],y[o]=G}return y}(y),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let H=0;H<512;H++)this.perm[H]=this.p[255&H],this.permMod12[H]=this.perm[H]%12}noise2D(n,y){const H=this.permMod12,h=this.perm;let k=0,i=0,B=0;const q=(n+y)*o,b=Math.floor(n+q),A=Math.floor(y+q),U=(b+A)*G,T=n-(b-U),W=y-(A-U);let z,Q;T>W?(z=1,Q=0):(z=0,Q=1);const l=T-z+G,v=W-Q+G,F=T-1+2*G,g=W-1+2*G,M=255&b,f=255&A;let c=.5-T*T-W*W;if(c>=0){const n=3*H[M+h[f]];c*=c,k=c*c*(V[n]*T+V[n+1]*W)}let p=.5-l*l-v*v;if(p>=0){const n=3*H[M+z+h[f+Q]];p*=p,i=p*p*(V[n]*l+V[n+1]*v)}let E=.5-F*F-g*g;if(E>=0){const n=3*H[M+1+h[f+1]];E*=E,B=E*E*(V[n]*F+V[n+1]*g)}return 70*(k+i+B)}noise3D(n,y,H){const o=this.permMod12,G=this.perm;let i,B,q,b;const A=(n+y+H)*h,U=Math.floor(n+A),T=Math.floor(y+A),W=Math.floor(H+A),z=(U+T+W)*k,Q=n-(U-z),l=y-(T-z),v=H-(W-z);let F,g,M,f,c,p;Q>=l?l>=v?(F=1,g=0,M=0,f=1,c=1,p=0):Q>=v?(F=1,g=0,M=0,f=1,c=0,p=1):(F=0,g=0,M=1,f=1,c=0,p=1):l<v?(F=0,g=0,M=1,f=0,c=1,p=1):Q<v?(F=0,g=1,M=0,f=0,c=1,p=1):(F=0,g=1,M=0,f=1,c=1,p=0);const E=Q-F+k,X=l-g+k,d=v-M+k,a=Q-f+2*k,O=l-c+2*k,e=v-p+2*k,w=Q-1+.5,j=l-1+.5,I=v-1+.5,R=255&U,C=255&T,S=255&W;let N=.6-Q*Q-l*l-v*v;if(N<0)i=0;else{const n=3*o[R+G[C+G[S]]];N*=N,i=N*N*(V[n]*Q+V[n+1]*l+V[n+2]*v)}let r=.6-E*E-X*X-d*d;if(r<0)B=0;else{const n=3*o[R+F+G[C+g+G[S+M]]];r*=r,B=r*r*(V[n]*E+V[n+1]*X+V[n+2]*d)}let K=.6-a*a-O*O-e*e;if(K<0)q=0;else{const n=3*o[R+f+G[C+c+G[S+p]]];K*=K,q=K*K*(V[n]*a+V[n+1]*O+V[n+2]*e)}let Y=.6-w*w-j*j-I*I;if(Y<0)b=0;else{const n=3*o[R+1+G[C+1+G[S+1]]];Y*=Y,b=Y*Y*(V[n]*w+V[n+1]*j+V[n+2]*I)}return 32*(i+B+q+b)}noise4D(n,y,H,o){const G=this.perm;let h,k,V,b,A;const U=(n+y+H+o)*i,T=Math.floor(n+U),W=Math.floor(y+U),z=Math.floor(H+U),Q=Math.floor(o+U),l=(T+W+z+Q)*B,v=n-(T-l),F=y-(W-l),g=H-(z-l),M=o-(Q-l);let f=0,c=0,p=0,E=0;v>F?f++:c++,v>g?f++:p++,v>M?f++:E++,F>g?c++:p++,F>M?c++:E++,g>M?p++:E++;const X=f>=3?1:0,d=c>=3?1:0,a=p>=3?1:0,O=E>=3?1:0,e=f>=2?1:0,w=c>=2?1:0,j=p>=2?1:0,I=E>=2?1:0,R=f>=1?1:0,C=c>=1?1:0,S=p>=1?1:0,N=E>=1?1:0,r=v-X+B,K=F-d+B,Y=g-a+B,D=M-O+B,Z=v-e+2*B,s=F-w+2*B,P=g-j+2*B,x=M-I+2*B,t=v-R+3*B,u=F-C+3*B,L=g-S+3*B,J=M-N+3*B,m=v-1+4*B,nn=F-1+4*B,yn=g-1+4*B,Hn=M-1+4*B,on=255&T,Gn=255&W,hn=255&z,kn=255&Q;let Bn=.6-v*v-F*F-g*g-M*M;if(Bn<0)h=0;else{const n=G[on+G[Gn+G[hn+G[kn]]]]%32*4;Bn*=Bn,h=Bn*Bn*(q[n]*v+q[n+1]*F+q[n+2]*g+q[n+3]*M)}let Vn=.6-r*r-K*K-Y*Y-D*D;if(Vn<0)k=0;else{const n=G[on+X+G[Gn+d+G[hn+a+G[kn+O]]]]%32*4;Vn*=Vn,k=Vn*Vn*(q[n]*r+q[n+1]*K+q[n+2]*Y+q[n+3]*D)}let qn=.6-Z*Z-s*s-P*P-x*x;if(qn<0)V=0;else{const n=G[on+e+G[Gn+w+G[hn+j+G[kn+I]]]]%32*4;qn*=qn,V=qn*qn*(q[n]*Z+q[n+1]*s+q[n+2]*P+q[n+3]*x)}let bn=.6-t*t-u*u-L*L-J*J;if(bn<0)b=0;else{const n=G[on+R+G[Gn+C+G[hn+S+G[kn+N]]]]%32*4;bn*=bn,b=bn*bn*(q[n]*t+q[n+1]*u+q[n+2]*L+q[n+3]*J)}let An=.6-m*m-nn*nn-yn*yn-Hn*Hn;if(An<0)A=0;else{const n=G[on+1+G[Gn+1+G[hn+1+G[kn+1]]]]%32*4;An*=An,A=An*An*(q[n]*m+q[n+1]*nn+q[n+2]*yn+q[n+3]*Hn)}return 27*(h+k+V+b+A)}}}}]);