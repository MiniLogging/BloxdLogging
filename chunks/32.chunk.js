/*! For license information please see zomqja.32.3590b313.chunk.js.LICENSE.txt */
(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[32],{14180:(i,x,e)=>{"use strict";var j=e(14184),E=e(14189),a=e(14191);e.g.__TYPEDARRAY_POOL||(e.g.__TYPEDARRAY_POOL={UINT8:E([32,0]),UINT16:E([32,0]),UINT32:E([32,0]),INT8:E([32,0]),INT16:E([32,0]),INT32:E([32,0]),FLOAT:E([32,0]),DOUBLE:E([32,0]),DATA:E([32,0]),UINT8C:E([32,0]),BUFFER:E([32,0])});var Y="undefined"!==typeof Uint8ClampedArray,J=e.g.__TYPEDARRAY_POOL;J.UINT8C||(J.UINT8C=E([32,0])),J.BUFFER||(J.BUFFER=E([32,0]));var u=J.DATA,b=J.BUFFER;function g(i){if(i){var x=i.length||i.byteLength,e=j.log2(x);u[e].push(i)}}function A(i){i=j.nextPow2(i);var x=j.log2(i),e=u[x];return e.length>0?e.pop():new ArrayBuffer(i)}function K(i){return new Uint8Array(A(i),0,i)}function L(i){return new Uint16Array(A(2*i),0,i)}function o(i){return new Uint32Array(A(4*i),0,i)}function M(i){return new Int8Array(A(i),0,i)}function z(i){return new Int16Array(A(2*i),0,i)}function T(i){return new Int32Array(A(4*i),0,i)}function Q(i){return new Float32Array(A(4*i),0,i)}function t(i){return new Float64Array(A(8*i),0,i)}function V(i){return Y?new Uint8ClampedArray(A(i),0,i):K(i)}function S(i){return new DataView(A(i),0,i)}x.free=function(i){if(a(i))b[j.log2(i.length)].push(i);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(i)&&(i=i.buffer),!i)return;var x=i.length||i.byteLength,e=0|j.log2(x);u[e].push(i)}},x.freeUint8=x.freeUint16=x.freeUint32=x.freeInt8=x.freeInt16=x.freeInt32=x.freeFloat32=x.freeFloat=x.freeFloat64=x.freeDouble=x.freeUint8Clamped=x.freeDataView=function(i){g(i.buffer)},x.freeArrayBuffer=g,x.freeBuffer=function(i){b[j.log2(i.length)].push(i)},x.malloc=function(i,x){if(void 0===x||"arraybuffer"===x)return A(i);switch(x){case"uint8":return K(i);case"uint16":return L(i);case"uint32":return o(i);case"int8":return M(i);case"int16":return z(i);case"int32":return T(i);case"float":case"float32":return Q(i);case"double":case"float64":return t(i);case"uint8_clamped":return V(i);case"buffer":throw"Buffer not supported";case"data":case"dataview":return S(i);default:return null}return null},x.mallocArrayBuffer=A,x.mallocUint8=K,x.mallocUint16=L,x.mallocUint32=o,x.mallocInt8=M,x.mallocInt16=z,x.mallocInt32=T,x.mallocFloat32=x.mallocFloat=Q,x.mallocFloat64=x.mallocDouble=t,x.mallocUint8Clamped=V,x.mallocDataView=S,x.clearCache=function(){for(var i=0;i<32;++i)J.UINT8[i].length=0,J.UINT16[i].length=0,J.UINT32[i].length=0,J.INT8[i].length=0,J.INT16[i].length=0,J.INT32[i].length=0,J.FLOAT[i].length=0,J.DOUBLE[i].length=0,J.UINT8C[i].length=0,u[i].length=0,b[i].length=0}},14262:(i,x,e)=>{i.exports=E;var j=e(13036);function E(i,x){if(!(this instanceof E))return new E(i,x);var e=j.create();j.add(e,i,x),this.base=j.min(j.create(),i,e),this.xA=j.clone(x),this.max=j.max(j.create(),i,e),this.mag=j.length(this.xA)}var a=E.prototype;a.width=function(){return this.xA[0]},a.height=function(){return this.xA[1]},a.depth=function(){return this.xA[2]},a.x0=function(){return this.base[0]},a.y0=function(){return this.base[1]},a.z0=function(){return this.base[2]},a.x1=function(){return this.max[0]},a.y1=function(){return this.max[1]},a.z1=function(){return this.max[2]},a.translate=function(i){return j.add(this.max,this.max,i),j.add(this.base,this.base,i),this},a.setPosition=function(i){return j.add(this.max,i,this.xA),j.k(this.base,i),this},a.expand=function(i){var x=j.create(),e=j.create();return j.max(x,i.max,this.max),j.min(e,i.base,this.base),j.Cx(x,x,e),new E(e,x)},a.intersects=function(i){return!(i.base[0]>this.max[0])&&(!(i.base[1]>this.max[1])&&(!(i.base[2]>this.max[2])&&(!(i.max[0]<this.base[0])&&(!(i.max[1]<this.base[1])&&!(i.max[2]<this.base[2])))))},a.touches=function(i){var x=this.union(i);return null!==x&&(0==x.width()||0==x.height()||0==x.depth())},a.union=function(i){if(!this.intersects(i))return null;var x=Math.max(i.base[0],this.base[0]),e=Math.max(i.base[1],this.base[1]),j=Math.max(i.base[2],this.base[2]);return new E([x,e,j],[Math.min(i.max[0],this.max[0])-x,Math.min(i.max[1],this.max[1])-e,Math.min(i.max[2],this.max[2])-j])}},14184:(i,x)=>{"use strict";function e(i){var x=32;return(i&=-i)&&x--,65535&i&&(x-=16),16711935&i&&(x-=8),252645135&i&&(x-=4),858993459&i&&(x-=2),1431655765&i&&(x-=1),x}x.INT_BITS=32,x.INT_MAX=2147483647,x.INT_MIN=-1<<31,x.sign=function(i){return(i>0)-(i<0)},x.abs=function(i){var x=i>>31;return(i^x)-x},x.min=function(i,x){return x^(i^x)&-(i<x)},x.max=function(i,x){return i^(i^x)&-(i<x)},x.isPow2=function(i){return!(i&i-1)&&!!i},x.log2=function(i){var x,e;return x=(i>65535)<<4,x|=e=((i>>>=x)>255)<<3,x|=e=((i>>>=e)>15)<<2,(x|=e=((i>>>=e)>3)<<1)|(i>>>=e)>>1},x.log10=function(i){return i>=1e9?9:i>=1e8?8:i>=1e7?7:i>=1e6?6:i>=1e5?5:i>=1e4?4:i>=1e3?3:i>=100?2:i>=10?1:0},x.popCount=function(i){return 16843009*((i=(858993459&(i-=i>>>1&1431655765))+(i>>>2&858993459))+(i>>>4)&252645135)>>>24},x.countTrailingZeros=e,x.nextPow2=function(i){return i+=0===i,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,(i|=i>>>16)+1},x.prevPow2=function(i){return i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,(i|=i>>>16)-(i>>>1)},x.parity=function(i){return i^=i>>>16,i^=i>>>8,i^=i>>>4,27030>>>(i&=15)&1};var j=new Array(256);!function(i){for(var x=0;x<256;++x){var e=x,j=x,E=7;for(e>>>=1;e;e>>>=1)j<<=1,j|=1&e,--E;i[x]=j<<E&255}}(j),x.reverse=function(i){return j[255&i]<<24|j[i>>>8&255]<<16|j[i>>>16&255]<<8|j[i>>>24&255]},x.interleave2=function(i,x){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))|(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))<<1},x.deinterleave2=function(i,x){return(i=65535&((i=16711935&((i=252645135&((i=858993459&((i=i>>>x&1431655765)|i>>>1))|i>>>2))|i>>>4))|i>>>16))<<16>>16},x.interleave3=function(i,x,e){return i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2),(i|=(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<1)|(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<2},x.deinterleave3=function(i,x){return(i=1023&((i=4278190335&((i=251719695&((i=3272356035&((i=i>>>x&1227133513)|i>>>2))|i>>>4))|i>>>8))|i>>>16))<<22>>22},x.nextCombination=function(i){var x=i|i-1;return x+1|(~x&-~x)-1>>>e(i)+1}},14178:(i,x,e)=>{"use strict";i.exports=function(i,x,e){switch(arguments.length){case 1:return j=[],b(E=i,E,g,!0),j;case 2:return"function"===typeof x?b(i,i,x,!0):function(i,x){return j=[],b(i,x,g,!1),j}(i,x);case 3:return b(i,x,e,!1);default:throw new Error("box-intersect: Invalid arguments")}var E};var j,E=e(14180),a=e(14193),Y=e(14203);function J(i,x){for(var e=0;e<i;++e)if(!(x[e]<=x[e+i]))return!0;return!1}function u(i,x,e,j){for(var E=0,a=0,Y=0,u=i.length;Y<u;++Y){var b=i[Y];if(!J(x,b)){for(var g=0;g<2*x;++g)e[E++]=b[g];j[a++]=Y}}return a}function b(i,x,e,j){var J=i.length,b=x.length;if(!(J<=0||b<=0)){var g=i[0].length>>>1;if(!(g<=0)){var A,K=E.mallocDouble(2*g*J),L=E.mallocInt32(J);if((J=u(i,g,K,L))>0){if(1===g&&j)a.init(J),A=a.sweepComplete(g,e,0,J,K,L,0,J,K,L);else{var o=E.mallocDouble(2*g*b),M=E.mallocInt32(b);(b=u(x,g,o,M))>0&&(a.init(J+b),A=1===g?a.sweepBipartite(g,e,0,J,K,L,0,b,o,M):Y(g,e,j,J,K,L,b,o,M),E.free(o),E.free(M))}E.free(K),E.free(L)}return A}}}function g(i,x){j.push([i,x])}},14211:(i,x)=>{"use strict";var e="d",j="ax",E="fp",a="es",Y="rs",J="re",u="rb",b="bs",g="be",A="bb",K=[e,j,"vv",Y,J,u,"ri",b,g,A,"bi"];function L(i){var x="bruteForce"+(i?"Full":"Partial"),j=[],Y=K.slice();i||Y.splice(3,0,E);var J=["function "+x+"("+Y.join()+"){"];function u(x,E){var Y=function(i,x,j){var E="bruteForce"+(i?"Red":"Blue")+(x?"Flip":"")+(j?"Full":""),Y=["function ",E,"(",K.join(),"){","var ",a,"=2*",e,";"],J="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",u="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(j?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return i?Y.push(J,"Q",":",u):Y.push(u,"Q",":",J),j?Y.push("if(y1<x0||x1<y0)continue;"):x?Y.push("if(y0<=x0||x1<y0)continue;"):Y.push("if(y0<x0||x1<y0)continue;"),Y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),x?Y.push("yi,xi"):Y.push("xi,yi"),Y.push(");if(rv!==void 0)return rv;}}}"),{name:E,code:Y.join("")}}(x,E,i);j.push(Y.code),J.push("return "+Y.name+"("+K.join()+");")}J.push("if(re-rs>be-bs){"),i?(u(!0,!1),J.push("}else{"),u(!1,!1)):(J.push("if(fp){"),u(!0,!0),J.push("}else{"),u(!0,!1),J.push("}}else{if(fp){"),u(!1,!0),J.push("}else{"),u(!1,!1),J.push("}")),J.push("}}return "+x);var b=j.join("")+J.join("");return new Function(b)()}x.partial=L(!1),x.full=L(!0)},14203:(i,x,e)=>{"use strict";i.exports=function(i,x,e,a,g,B,k,N,mi){!function(i,x){var e=8*E.log2(x+1)*(i+1)|0,a=E.nextPow2(V*e);f.length<a&&(j.free(f),f=j.mallocInt32(a));var Y=E.nextPow2(S*e);w.length<Y&&(j.free(w),w=j.mallocDouble(Y))}(i,a+k);var X,C=0,n=2*i;O(C++,0,0,a,0,k,e?16:0,-1/0,1/0),e||O(C++,0,0,k,0,a,1,-1/0,1/0);for(;C>0;){var I=(C-=1)*V,d=f[I],p=f[I+1],H=f[I+2],U=f[I+3],D=f[I+4],h=f[I+5],F=C*S,R=w[F],y=w[F+1],r=1&h,c=!!(16&h),P=g,q=B,W=N,G=mi;if(r&&(P=N,q=mi,W=g,G=B),!(2&h&&p>=(H=z(i,d,p,H,P,q,y)))&&!(4&h&&(p=T(i,d,p,H,P,q,R))>=H)){var v=H-p,s=D-U;if(c){if(i*v*(v+s)<L){if(void 0!==(X=u.scanComplete(i,d,x,p,H,P,q,U,D,W,G)))return X;continue}}else{if(i*Math.min(v,s)<A){if(void 0!==(X=Y(i,d,x,r,p,H,P,q,U,D,W,G)))return X;continue}if(i*v*s<K){if(void 0!==(X=u.scanBipartite(i,d,x,r,p,H,P,q,U,D,W,G)))return X;continue}}var ii=o(i,d,p,H,P,q,R,y);if(p<ii)if(i*(ii-p)<A){if(void 0!==(X=J(i,d+1,x,p,ii,P,q,U,D,W,G)))return X}else if(d===i-2){if(void 0!==(X=r?u.sweepBipartite(i,x,U,D,W,G,p,ii,P,q):u.sweepBipartite(i,x,p,ii,P,q,U,D,W,G)))return X}else O(C++,d+1,p,ii,U,D,r,-1/0,1/0),O(C++,d+1,U,D,p,ii,1^r,-1/0,1/0);if(ii<H){var xi=b(i,d,U,D,W,G),ei=W[n*xi+d],ji=M(i,d,xi,D,W,G,ei);if(ji<D&&O(C++,d,ii,H,ji,D,(4|r)+(c?16:0),ei,y),U<xi&&O(C++,d,ii,H,U,xi,(2|r)+(c?16:0),R,ei),xi+1===ji){if(void 0!==(X=c?Z(i,d,x,ii,H,P,q,xi,W,G[xi]):l(i,d,x,r,ii,H,P,q,xi,W,G[xi])))return X}else if(xi<ji){var Ei;if(c){if(ii<(Ei=Q(i,d,ii,H,P,q,ei))){var ai=M(i,d,ii,Ei,P,q,ei);if(d===i-2){if(ii<ai&&void 0!==(X=u.sweepComplete(i,x,ii,ai,P,q,xi,ji,W,G)))return X;if(ai<Ei&&void 0!==(X=u.sweepBipartite(i,x,ai,Ei,P,q,xi,ji,W,G)))return X}else ii<ai&&O(C++,d+1,ii,ai,xi,ji,16,-1/0,1/0),ai<Ei&&(O(C++,d+1,ai,Ei,xi,ji,0,-1/0,1/0),O(C++,d+1,xi,ji,ai,Ei,1,-1/0,1/0))}}else ii<(Ei=r?t(i,d,ii,H,P,q,ei):Q(i,d,ii,H,P,q,ei))&&(d===i-2?X=r?u.sweepBipartite(i,x,xi,ji,W,G,ii,Ei,P,q):u.sweepBipartite(i,x,ii,Ei,P,q,xi,ji,W,G):(O(C++,d+1,ii,Ei,xi,ji,r,-1/0,1/0),O(C++,d+1,xi,ji,ii,Ei,1^r,-1/0,1/0)))}}}}};var j=e(14180),E=e(14184),a=e(14211),Y=a.partial,J=a.full,u=e(14193),b=e(14219),g=e(14224),A=128,K=1<<22,L=1<<22,o=g("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),M=g("lo===p0",["p0"]),z=g("lo<p0",["p0"]),T=g("hi<=p0",["p0"]),Q=g("lo<=p0&&p0<=hi",["p0"]),t=g("lo<p0&&p0<=hi",["p0"]),V=6,S=2,f=j.mallocInt32(1024),w=j.mallocDouble(1024);function O(i,x,e,j,E,a,Y,J,u){var b=V*i;f[b]=x,f[b+1]=e,f[b+2]=j,f[b+3]=E,f[b+4]=a,f[b+5]=Y;var g=S*i;w[g]=J,w[g+1]=u}function l(i,x,e,j,E,a,Y,J,u,b,g){var A=2*i,K=u*A,L=b[K+x];i:for(var o=E,M=E*A;o<a;++o,M+=A){var z=Y[M+x],T=Y[M+x+i];if(!(L<z||T<L)&&(!j||L!==z)){for(var Q,t=J[o],V=x+1;V<i;++V){z=Y[M+V],T=Y[M+V+i];var S=b[K+V],f=b[K+V+i];if(T<S||f<z)continue i}if(void 0!==(Q=j?e(g,t):e(t,g)))return Q}}}function Z(i,x,e,j,E,a,Y,J,u,b){var g=2*i,A=J*g,K=u[A+x];i:for(var L=j,o=j*g;L<E;++L,o+=g){var M=Y[L];if(M!==b){var z=a[o+x],T=a[o+x+i];if(!(K<z||T<K)){for(var Q=x+1;Q<i;++Q){z=a[o+Q],T=a[o+Q+i];var t=u[A+Q],V=u[A+Q+i];if(T<t||V<z)continue i}var S=e(M,b);if(void 0!==S)return S}}}}},14219:(i,x,e)=>{"use strict";i.exports=function(i,x,e,Y,J,u){if(Y<=e+1)return e;var b=e,g=Y,A=Y+e>>>1,K=2*i,L=A,o=J[K*A+x];for(;b<g;){if(g-b<E){a(i,x,b,g,J,u),o=J[K*A+x];break}var M=g-b,z=Math.random()*M+b|0,T=J[K*z+x],Q=Math.random()*M+b|0,t=J[K*Q+x],V=Math.random()*M+b|0,S=J[K*V+x];T<=t?S>=t?(L=Q,o=t):T>=S?(L=z,o=T):(L=V,o=S):t>=S?(L=Q,o=t):S>=T?(L=z,o=T):(L=V,o=S);for(var f=K*(g-1),w=K*L,O=0;O<K;++O,++f,++w){var l=J[f];J[f]=J[w],J[w]=l}var Z=u[g-1];u[g-1]=u[L],u[L]=Z;for(f=K*(g-1),w=K*(L=j(i,x,b,g-1,J,u,o)),O=0;O<K;++O,++f,++w){l=J[f];J[f]=J[w],J[w]=l}Z=u[g-1];if(u[g-1]=u[L],u[L]=Z,A<L){for(g=L-1;b<g&&J[K*(g-1)+x]===o;)g-=1;g+=1}else{if(!(L<A))break;for(b=L+1;b<g&&J[K*b+x]===o;)b+=1}}return j(i,x,e,A,J,u,J[K*A+x])};var j=e(14224)("lo<p0",["p0"]),E=8;function a(i,x,e,j,E,a){for(var Y=2*i,J=Y*(e+1)+x,u=e+1;u<j;++u,J+=Y)for(var b=E[J],g=u,A=Y*(u-1);g>e&&E[A+x]>b;--g,A-=Y){for(var K=A,L=A+Y,o=0;o<Y;++o,++K,++L){var M=E[K];E[K]=E[L],E[L]=M}var z=a[g];a[g]=a[g-1],a[g-1]=z}}},14224:i=>{"use strict";i.exports=function(i,e){var j="abcdef".split("").concat(e),E=[];i.indexOf("lo")>=0&&E.push("lo=e[k+n]");i.indexOf("hi")>=0&&E.push("hi=e[k+o]");return j.push(x.replace("_",E.join()).replace("$",i)),Function.apply(void 0,j)};var x="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14195:i=>{"use strict";i.exports=function(i,j){j<=4*x?e(0,j-1,i):b(0,j-1,i)};var x=32;function e(i,x,e){for(var j=2*(i+1),E=i+1;E<=x;++E){for(var a=e[j++],Y=e[j++],J=E,u=j-2;J-- >i;){var b=e[u-2],g=e[u-1];if(b<a)break;if(b===a&&g<Y)break;e[u]=b,e[u+1]=g,u-=2}e[u]=a,e[u+1]=Y}}function j(i,x,e){x*=2;var j=e[i*=2],E=e[i+1];e[i]=e[x],e[i+1]=e[x+1],e[x]=j,e[x+1]=E}function E(i,x,e){x*=2,e[i*=2]=e[x],e[i+1]=e[x+1]}function a(i,x,e,j){x*=2,e*=2;var E=j[i*=2],a=j[i+1];j[i]=j[x],j[i+1]=j[x+1],j[x]=j[e],j[x+1]=j[e+1],j[e]=E,j[e+1]=a}function Y(i,x,e,j,E){x*=2,E[i*=2]=E[x],E[x]=e,E[i+1]=E[x+1],E[x+1]=j}function J(i,x,e){x*=2;var j=e[i*=2],E=e[x];return!(j<E)&&(j!==E||e[i+1]>e[x+1])}function u(i,x,e,j){var E=j[i*=2];return E<x||E===x&&j[i+1]<e}function b(i,g,A){var K=(g-i+1)/6|0,L=i+K,o=g-K,M=i+g>>1,z=M-K,T=M+K,Q=L,t=z,V=M,S=T,f=o,w=i+1,O=g-1,l=0;J(Q,t,A)&&(l=Q,Q=t,t=l),J(S,f,A)&&(l=S,S=f,f=l),J(Q,V,A)&&(l=Q,Q=V,V=l),J(t,V,A)&&(l=t,t=V,V=l),J(Q,S,A)&&(l=Q,Q=S,S=l),J(V,S,A)&&(l=V,V=S,S=l),J(t,f,A)&&(l=t,t=f,f=l),J(t,V,A)&&(l=t,t=V,V=l),J(S,f,A)&&(l=S,S=f,f=l);for(var Z=A[2*t],B=A[2*t+1],k=A[2*S],N=A[2*S+1],mi=2*Q,X=2*V,C=2*f,n=2*L,I=2*M,d=2*o,p=0;p<2;++p){var H=A[mi+p],U=A[X+p],D=A[C+p];A[n+p]=H,A[I+p]=U,A[d+p]=D}E(z,i,A),E(T,g,A);for(var h=w;h<=O;++h)if(u(h,Z,B,A))h!==w&&j(h,w,A),++w;else if(!u(h,k,N,A))for(;;){if(u(O,k,N,A)){u(O,Z,B,A)?(a(h,w,O,A),++w,--O):(j(h,O,A),--O);break}if(--O<h)break}Y(i,w-1,Z,B,A),Y(g,O+1,k,N,A),w-2-i<=x?e(i,w-2,A):b(i,w-2,A),g-(O+2)<=x?e(O+2,g,A):b(O+2,g,A),O-w<=x?e(w,O,A):b(w,O,A)}},14193:(i,x,e)=>{"use strict";i.exports={init:function(i){var x=E.nextPow2(i);u.length<x&&(j.free(u),u=j.mallocInt32(x));b.length<x&&(j.free(b),b=j.mallocInt32(x));g.length<x&&(j.free(g),g=j.mallocInt32(x));A.length<x&&(j.free(A),A=j.mallocInt32(x));K.length<x&&(j.free(K),K=j.mallocInt32(x));L.length<x&&(j.free(L),L=j.mallocInt32(x));var e=8*x;o.length<e&&(j.free(o),o=j.mallocDouble(e))},sweepBipartite:function(i,x,e,j,E,J,K,L,T,Q){for(var t=0,V=2*i,S=i-1,f=V-1,w=e;w<j;++w){var O=J[w],l=V*w;o[t++]=E[l+S],o[t++]=-(O+1),o[t++]=E[l+f],o[t++]=O}for(w=K;w<L;++w){O=Q[w]+Y;var Z=V*w;o[t++]=T[Z+S],o[t++]=-O,o[t++]=T[Z+f],o[t++]=O}var B=t>>>1;a(o,B);var k=0,N=0;for(w=0;w<B;++w){var mi=0|o[2*w+1];if(mi>=Y)M(g,A,N--,mi=mi-Y|0);else if(mi>=0)M(u,b,k--,mi);else if(mi<=-Y){mi=-mi-Y|0;for(var X=0;X<k;++X){if(void 0!==(C=x(u[X],mi)))return C}z(g,A,N++,mi)}else{mi=-mi-1|0;for(X=0;X<N;++X){var C;if(void 0!==(C=x(mi,g[X])))return C}z(u,b,k++,mi)}}},sweepComplete:function(i,x,e,j,E,Y,J,T,Q,t){for(var V=0,S=2*i,f=i-1,w=S-1,O=e;O<j;++O){var l=Y[O]+1<<1,Z=S*O;o[V++]=E[Z+f],o[V++]=-l,o[V++]=E[Z+w],o[V++]=l}for(O=J;O<T;++O){l=t[O]+1<<1;var B=S*O;o[V++]=Q[B+f],o[V++]=1|-l,o[V++]=Q[B+w],o[V++]=1|l}var k=V>>>1;a(o,k);var N=0,mi=0,X=0;for(O=0;O<k;++O){var C=0|o[2*O+1],n=1&C;if(O<k-1&&C>>1===o[2*O+3]>>1&&(n=2,O+=1),C<0){for(var I=-(C>>1)-1,d=0;d<X;++d){if(void 0!==(p=x(K[d],I)))return p}if(0!==n)for(d=0;d<N;++d){if(void 0!==(p=x(u[d],I)))return p}if(1!==n)for(d=0;d<mi;++d){var p;if(void 0!==(p=x(g[d],I)))return p}0===n?z(u,b,N++,I):1===n?z(g,A,mi++,I):2===n&&z(K,L,X++,I)}else{I=(C>>1)-1;0===n?M(u,b,N--,I):1===n?M(g,A,mi--,I):2===n&&M(K,L,X--,I)}}},scanBipartite:function(i,x,e,j,E,J,g,A,K,L,T,Q){var t=0,V=2*i,S=x,f=x+i,w=1,O=1;j?O=Y:w=Y;for(var l=E;l<J;++l){var Z=l+w,B=V*l;o[t++]=g[B+S],o[t++]=-Z,o[t++]=g[B+f],o[t++]=Z}for(l=K;l<L;++l){Z=l+O;var k=V*l;o[t++]=T[k+S],o[t++]=-Z}var N=t>>>1;a(o,N);var mi=0;for(l=0;l<N;++l){var X=0|o[2*l+1];if(X<0){var C=!1;if((Z=-X)>=Y?(C=!j,Z-=Y):(C=!!j,Z-=1),C)z(u,b,mi++,Z);else{var n=Q[Z],I=V*Z,d=T[I+x+1],p=T[I+x+1+i];i:for(var H=0;H<mi;++H){var U=u[H],D=V*U;if(!(p<g[D+x+1]||g[D+x+1+i]<d)){for(var h=x+2;h<i;++h)if(T[I+h+i]<g[D+h]||g[D+h+i]<T[I+h])continue i;var F,R=A[U];if(void 0!==(F=j?e(n,R):e(R,n)))return F}}}}else M(u,b,mi--,X-w)}},scanComplete:function(i,x,e,j,E,J,b,g,A,K,L){for(var M=0,z=2*i,T=x,Q=x+i,t=j;t<E;++t){var V=t+Y,S=z*t;o[M++]=J[S+T],o[M++]=-V,o[M++]=J[S+Q],o[M++]=V}for(t=g;t<A;++t){V=t+1;var f=z*t;o[M++]=K[f+T],o[M++]=-V}var w=M>>>1;a(o,w);var O=0;for(t=0;t<w;++t){var l=0|o[2*t+1];if(l<0){if((V=-l)>=Y)u[O++]=V-Y;else{var Z=L[V-=1],B=z*V,k=K[B+x+1],N=K[B+x+1+i];i:for(var mi=0;mi<O;++mi){var X=u[mi],C=b[X];if(C===Z)break;var n=z*X;if(!(N<J[n+x+1]||J[n+x+1+i]<k)){for(var I=x+2;I<i;++I)if(K[B+I+i]<J[n+I]||J[n+I+i]<K[B+I])continue i;var d=e(C,Z);if(void 0!==d)return d}}}}else{for(V=l-Y,mi=O-1;mi>=0;--mi)if(u[mi]===V){for(I=mi+1;I<O;++I)u[I-1]=u[I];break}--O}}}};var j=e(14180),E=e(14184),a=e(14195),Y=1<<28,J=1024,u=j.mallocInt32(J),b=j.mallocInt32(J),g=j.mallocInt32(J),A=j.mallocInt32(J),K=j.mallocInt32(J),L=j.mallocInt32(J),o=j.mallocDouble(8192);function M(i,x,e,j){var E=x[j],a=i[e-1];i[E]=a,x[a]=E}function z(i,x,e,j){i[e]=j,x[j]=e}},14189:i=>{"use strict";function x(i,e,j){var E=0|i[j];if(E<=0)return[];var a,Y=new Array(E);if(j===i.length-1)for(a=0;a<E;++a)Y[a]=e;else for(a=0;a<E;++a)Y[a]=x(i,e,j+1);return Y}i.exports=function(i,e){switch("undefined"===typeof e&&(e=0),typeof i){case"number":if(i>0)return function(i,x){var e,j;for(e=new Array(i),j=0;j<i;++j)e[j]=x;return e}(0|i,e);break;case"object":if("number"===typeof i.length)return x(i,e,0)}return[]}},14145:(i,x,e)=>{i.exports=function(){var i=this;this.components={},this.comps=this.components;var x=this.components,e=1,E={},a=[],Y=[],J={timeout:!1,removals:[],multiComps:[]};function u(i,e){var j=x[e],a=E[e],Y=a.hash[i];Y&&(a.remove(i),j.me&&(j.multi?(Y.forEach((x=>{x&&j.me(i,x)})),Y.length=0):j.me(i,Y)),J.removals.push(a),b())}function b(){J.timeout||(J.timeout=!0,setTimeout(g,1))}function g(){J.timeout=!1,A()}function A(){J.multiComps.length&&function(i){for(var x=0;x<i.length;x++){var{entID:e,data:j}=i[x],E=j.hash[e];if(E){for(var a=0;a<E.length;a++)E[a]||(E.splice(a,1),a--);0===E.length&&(j.remove(e),J.removals.push(j))}}i.length=0}(J.multiComps),J.removals.length&&function(i){for(var x=0;x<i.length;x++){i[x].flush()}i.length=0}(J.removals)}this.MK=E,this._systems=a,this._renderSystems=Y,this.EA=function(x){var j=e++;return Array.isArray(x)&&x.forEach((x=>i.Uu(j,x))),j},this.deleteEntity=function(x){return Object.keys(E).forEach((i=>{E[i].hash[x]&&u(x,i)})),i},this.tA=function(i){if(!i)throw new Error("Missing component definition");var e=i.name;if(!e)throw new Error("Component definition must have a name property.");if("string"!==typeof e)throw new Error("Component name must be a string.");if(""===e)throw new Error("Component name must be a non-empty string.");if(E[e])throw new Error(`Component ${e} already exists.`);var J={};return J.name=e,J.multi=!!i.multi,J.order=isNaN(i.order)?99:i.order,J.stateConstructor=i.stateConstructor||null,J.state=i.state||{},J.dJ=i.dJ||null,J.me=i.me||null,J.system=i.system||null,J.FJ=i.FJ||null,x[e]=J,E[e]=new j,E[e]._pendingMultiCleanup=!1,E[e]._multiCleanupIDs=J.multi?[]:null,J.system&&(a.push(e),a.sort(((i,e)=>x[i].order-x[e].order))),J.FJ&&(Y.push(e),Y.sort(((i,e)=>x[i].order-x[e].order))),e},this.overwriteComponent=function(i,e){var j=x[i];if(!j)throw new Error(`Unknown component: ${i}`);if(!e)throw new Error("Missing component definition");if(j.name!==e.name)throw new Error("Overwriting component must use the same name property.");var J={};J.name=i,J.multi=!!e.multi,J.order=isNaN(e.order)?99:e.order,J.state=e.state||{},J.dJ=e.dJ||null,J.me=e.me||null,J.system=e.system||null,J.FJ=e.FJ||null,x[i]=J,E[i]._pendingMultiCleanup=!1,E[i]._multiCleanupIDs=J.multi?[]:null;var u=a.indexOf(i);J.system&&u<0&&a.push(i),!J.system&&u>=0&&a.splice(u,1),a.sort(((i,e)=>x[i].order-x[e].order));var b=Y.indexOf(i);J.FJ&&b<0&&Y.push(i),!J.FJ&&b>=0&&Y.splice(b,1),Y.sort(((i,e)=>x[i].order-x[e].order));var g=J.state;return this.Ig(i).forEach((i=>{for(var x in g)x in i||(i[x]=g[x]);J.dJ&&J.dJ(i.DJ,i)})),i},this.deleteComponent=function(e){var j=E[e];if(!j)throw new Error(`Unknown component: ${e}`);j.flush(),j.list.forEach((i=>{i&&u(i.DJ||i[0].DJ,e)}));var J=a.indexOf(e),b=Y.indexOf(e);return J>-1&&a.splice(J,1),b>-1&&Y.splice(b,1),E[e].dispose(),delete E[e],delete x[e],i},this.Uu=function(i,e,j){var a,Y=x[e],J=E[e];if(!J)throw new Error(`Unknown component: ${e}.`);if(J.hash[i]&&!Y.multi)throw new Error(`Entity ${i} already has component: ${e}.`);if(Y.stateConstructor){if(!(a=new Y.stateConstructor).hasOwnProperty("DJ"))throw new Error(`Component ${Y.name} stateConstructor type does not have property __id`)}else a=Object.assign({},{DJ:i},Y.state,j);if(a.DJ=i,Y.multi){var u=J.hash[i];u||(u=[],J.add(i,u)),u.push(a)}else J.add(i,a);return Y.dJ&&Y.dJ(i,a),this},this.Wu=function(i,x){var e=E[x];if(!e)throw new Error(`Unknown component: ${x}.`);return!!e.hash[i]},this.Ru=function(x,e){if(!E[e])throw new Error(`Unknown component: ${e}.`);return u(x,e),i},this.getState=function(i,x){var e=E[x];if(!e)throw new Error(`Unknown component: ${x}.`);return e.hash[i]},this.Ig=function(i){var x=E[i];if(!x)throw new Error(`Unknown component: ${i}.`);return A(),x.list},this.Eo=function(i){if(!E[i])throw new Error(`Unknown component: ${i}.`);var x=E[i].hash;return i=>x[i]},this.Jo=function(i){if(!E[i])throw new Error(`Unknown component: ${i}.`);var x=E[i].hash;return i=>!!x[i]},this.SJ=function(e){A();for(var j=0;j<a.length;j++){var Y=a[j],J=x[Y],u=E[Y];J.system(e,u.list),A()}return i},this.render=function(e){A();for(var j=0;j<Y.length;j++){var a=Y[j],J=x[a],u=E[a];J.FJ(e,u.list),A()}return i},this.removeMultiComponent=function(e,j,a){var Y=x[j],u=E[j];if(!u)throw new Error(`Unknown component: ${j}.`);if(!Y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(i,x,e,j){var E=e.hash[i];if(E){var a=E[j];a&&(E[j]=null,x.me&&x.me(i,a),J.multiComps.push({entID:i,data:e}),b())}}(e,Y,u,a),i}};var j=e(14151)},14151:i=>{function x(i,x){var e=i._map[x];if(delete i.hash[x],delete i._map[x],e===i.list.length-1)i.list.pop();else{var j=i.list.pop();if(i.list[e]=j,null===j||null===j[0]){var E=i.list.length;for(var a in i._map)if(i._map[a]===E)return void(i._map[a]=e)}else{var Y=j.DJ||j[0].DJ;i._map[Y]=e}}}i.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(i,x){if("number"===typeof this._map[i]){var e=this._map[i];this.hash[i]=x,this.list[e]=x}else this._map[i]=this.list.length,this.hash[i]=x,this.list.push(x)}remove(i){var x=this._map[i];this.hash[i]=null,this.list[x]=null,this._pendingRemovals.push(i)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var i=0;i<this._pendingRemovals.length;i++){var e=this._pendingRemovals[i];null===this.hash[e]&&x(this,e)}this._pendingRemovals.length=0}}},14107:i=>{"use strict";var x,e="object"===typeof Reflect?Reflect:null,j=function(i,x,e){return Function.prototype.apply.call(i,x,e)};x=e&&"function"===typeof e.ownKeys?e.ownKeys:Object.getOwnPropertySymbols?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:function(i){return Object.getOwnPropertyNames(i)};var E=Number.isNaN||function(i){return i!==i};function a(){a.init.call(this)}i.exports=a,i.exports.once=function(i,x){return new Promise((function(e,j){function E(e){i.removeListener(x,a),j(e)}function a(){"function"===typeof i.removeListener&&i.removeListener("error",E),e([].slice.call(arguments))}M(i,x,a,{once:!0}),"error"!==x&&function(i,x,e){"function"===typeof i.on&&M(i,"error",x,e)}(i,E,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var Y=10;function J(i){if("function"!==typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}function u(i){return void 0===i._maxListeners?a.defaultMaxListeners:i._maxListeners}function b(i,x,e,j){var E,a,Y,b;if(J(e),void 0===(a=i._events)?(a=i._events=Object.create(null),i._eventsCount=0):(void 0!==a.newListener&&(i.emit("newListener",x,e.listener?e.listener:e),a=i._events),Y=a[x]),void 0===Y)Y=a[x]=e,++i._eventsCount;else if("function"===typeof Y?Y=a[x]=j?[e,Y]:[Y,e]:j?Y.unshift(e):Y.push(e),(E=u(i))>0&&Y.length>E&&!Y.warned){Y.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+Y.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.Yx=i,g.type=x,g.count=Y.length,b=g,console&&console.warn&&console.warn(b)}return i}function g(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function A(i,x,e){var j={fired:!1,wrapFn:void 0,target:i,type:x,listener:e},E=g.bind(j);return E.listener=e,j.wrapFn=E,E}function K(i,x,e){var j=i._events;if(void 0===j)return[];var E=j[x];return void 0===E?[]:"function"===typeof E?e?[E.listener||E]:[E]:e?function(i){for(var x=new Array(i.length),e=0;e<x.length;++e)x[e]=i[e].listener||i[e];return x}(E):o(E,E.length)}function L(i){var x=this._events;if(void 0!==x){var e=x[i];if("function"===typeof e)return 1;if(void 0!==e)return e.length}return 0}function o(i,x){for(var e=new Array(x),j=0;j<x;++j)e[j]=i[j];return e}function M(i,x,e,j){if("function"===typeof i.on)j.once?i.once(x,e):i.on(x,e);else{if("function"!==typeof i.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i);i.addEventListener(x,(function E(a){j.once&&i.removeEventListener(x,E),e(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return Y},set:function(i){if("number"!==typeof i||i<0||E(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");Y=i}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(i){if("number"!==typeof i||i<0||E(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(i){for(var x=[],e=1;e<arguments.length;e++)x.push(arguments[e]);var E="error"===i,a=this._events;if(void 0!==a)E=E&&void 0===a.error;else if(!E)return!1;if(E){var Y;if(x.length>0&&(Y=x[0]),Y instanceof Error)throw Y;var J=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw J.context=Y,J}var u=a[i];if(void 0===u)return!1;if("function"===typeof u)j(u,this,x);else{var b=u.length,g=o(u,b);for(e=0;e<b;++e)j(g[e],this,x)}return!0},a.prototype.addListener=function(i,x){return b(this,i,x,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(i,x){return b(this,i,x,!0)},a.prototype.once=function(i,x){return J(x),this.on(i,A(this,i,x)),this},a.prototype.prependOnceListener=function(i,x){return J(x),this.prependListener(i,A(this,i,x)),this},a.prototype.removeListener=function(i,x){var e,j,E,a,Y;if(J(x),void 0===(j=this._events))return this;if(void 0===(e=j[i]))return this;if(e===x||e.listener===x)0===--this._eventsCount?this._events=Object.create(null):(delete j[i],j.removeListener&&this.emit("removeListener",i,e.listener||x));else if("function"!==typeof e){for(E=-1,a=e.length-1;a>=0;a--)if(e[a]===x||e[a].listener===x){Y=e[a].listener,E=a;break}if(E<0)return this;0===E?e.shift():function(i,x){for(;x+1<i.length;x++)i[x]=i[x+1];i.pop()}(e,E),1===e.length&&(j[i]=e[0]),void 0!==j.removeListener&&this.emit("removeListener",i,Y||x)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.Jx=function(i){var x,e,j;if(void 0===(e=this._events))return this;if(void 0===e.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==e[i]&&(0===--this._eventsCount?this._events=Object.create(null):delete e[i]),this;if(0===arguments.length){var E,a=Object.keys(e);for(j=0;j<a.length;++j)"removeListener"!==(E=a[j])&&this.Jx(E);return this.Jx("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(x=e[i]))this.removeListener(i,x);else if(void 0!==x)for(j=x.length-1;j>=0;j--)this.removeListener(i,x[j]);return this},a.prototype.listeners=function(i){return K(this,i,!0)},a.prototype.rawListeners=function(i){return K(this,i,!1)},a.listenerCount=function(i,x){return"function"===typeof i.listenerCount?i.listenerCount(x):L.call(i,x)},a.prototype.listenerCount=L,a.prototype.eventNames=function(){return this._eventsCount>0?x(this._events):[]}},14400:i=>{"use strict";i.exports=function(i,x,e,j,E,a){var Y=+x[0],J=+x[1],u=+x[2],b=+e[0],g=+e[1],A=+e[2],K=Math.sqrt(b*b+g*g+A*A);if(0===K)throw new Error("Can't raycast along a zero vector");return function(i,x,e,j,E,a,Y,J,u,b){for(var g=0,A=Math.floor,K=0|A(x),L=0|A(e),o=0|A(j),M=E>0?1:-1,z=a>0?1:-1,T=Y>0?1:-1,Q=Math.abs(1/E),t=Math.abs(1/a),V=Math.abs(1/Y),S=Q<1/0?Q*(M>0?K+1-x:x-K):1/0,f=t<1/0?t*(z>0?L+1-e:e-L):1/0,w=V<1/0?V*(T>0?o+1-j:j-o):1/0,O=-1;g<=J;){var l=i(K,L,o);if(l)return u&&(u[0]=x+g*E,u[1]=e+g*a,u[2]=j+g*Y),b&&(b[0]=b[1]=b[2]=0,0===O&&(b[0]=-M),1===O&&(b[1]=-z),2===O&&(b[2]=-T)),l;S<f?S<w?(K+=M,g=S,S+=Q,O=0):(o+=T,g=w,w+=V,O=2):f<w?(L+=z,g=f,f+=t,O=1):(o+=T,g=w,w+=V,O=2)}return u&&(u[0]=x+g*E,u[1]=e+g*a,u[2]=j+g*Y),b&&(b[0]=b[1]=b[2]=0),0}(i,Y,J,u,b/=K,g/=K,A/=K,j="undefined"===typeof j?64:+j,E,a)}},14425:(i,x,e)=>{"use strict";e.d(x,{e:()=>a});var j=e(14107);function E(){this.aL=!1,this.stopPropagation=!1,this.YL=!1,this.disabled=!1,this.maxPointerMovement=100}class a{constructor(i,x){this.version="0.7.0";var e=Object.assign({},new E,x||{});this.element=i||document,this.aL=!!e.aL,this.stopPropagation=!!e.stopPropagation,this.YL=!!e.YL,this.disabled=!!e.disabled,this.filterEvents=(i,x)=>!0,this.down=new j.EventEmitter,this.up=new j.EventEmitter,this.state={},this.Zg={dx:0,dy:0,qL:0,lg:0,WL:0},this.maxPointerMovement=e.maxPointerMovement||0,this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?J(this):document.addEventListener("DOMContentLoaded",(i=>{J(this)}),{once:!0})}bind(i){for(var x=arguments.length,e=new Array(x>1?x-1:0),j=1;j<x;j++)e[j-1]=arguments[j];e.forEach((x=>{var e=this._keyBindmap[x]||[];e.includes(i)||(e.push(i),this._keyBindmap[x]=e)})),this.state[i]=!!this.state[i],this.pressCount[i]=this.pressCount[i]||0,this.releaseCount[i]=this.releaseCount[i]||0}unbind(i){for(var x in this._keyBindmap){var e=this._keyBindmap[x],j=e.indexOf(i);j>-1&&e.splice(j,1)}}getBindings(){var i={};for(var x in this._keyBindmap){this._keyBindmap[x].forEach((e=>{i[e]=i[e]||[],i[e].push(x)}))}return i}SJ(){Y(this.Zg),Y(this.pressCount),Y(this.releaseCount)}}function Y(i){for(var x in i)i[x]=0}function J(i){window.addEventListener("keydown",o.bind(null,i,!0),!1),window.addEventListener("keyup",o.bind(null,i,!1),!1);var x={passive:!0};i.element.addEventListener("touchstart",A.bind(void 0,i),{passive:!1}),i.element.addEventListener("touchend",L.bind(void 0,i),x),i.element.addEventListener("mousedown",M.bind(null,i,!0),x),window.document.addEventListener("mouseup",M.bind(null,i,!1),x),i.element.addEventListener("touchmove",z.bind(null,i),x),i.element.addEventListener("mousemove",z.bind(null,i),x),window.PointerEvent,i.element.addEventListener("wheel",t.bind(null,i),x),i.element.addEventListener("contextmenu",V.bind(null,i),!1),window.addEventListener("blur",S.bind(null,i),!1)}var u=0,b=0,g=null;function A(i,x){x.preventDefault(),K(x)}function K(i){let x=!1;for(let e=0;e<i.touches.length;++e)if(i.touches[e].identifier===g){x=!0;break}if(!x){const x=i.changedTouches[0];u=x.clientX,b=x.clientY,g=x.identifier}}function L(i,x){for(var e=x.changedTouches,j=0;j<e.length;++j)e[j].identifier===g&&(g=null)}function o(i,x,e){f(e.code,x,i,e)}function M(i,x,e){if("pointerId"in e)if(x){if(null!==i._touches.currID)return;i._touches.currID=e.pointerId}else{if(i._touches.currID!==e.pointerId)return;i._touches.currID=null}return f("Mouse"+("button"in e?e.button+1:1),x,i,e),!1}function z(i,x){var e=x.movementX||x.mozMovementX||0,j=x.movementY||x.mozMovementY||0;if(x.touches&&0===(e|j)){var E=function(i){K(i);for(let x=0;x<i.changedTouches.length;++x)if(i.changedTouches[x].identifier==g){const e=i.changedTouches[x],j=[e.clientX-u,e.clientY-b];return u=e.clientX,b=e.clientY,j}return console.error(`Did not find touch id ${g}`),[0,0]}(x);e=E[0],j=E[1]}if(i.maxPointerMovement>0){var a=Math.abs(e)>i.maxPointerMovement&&Math.abs(e/T)>4,Y=Math.abs(j)>i.maxPointerMovement&&Math.abs(j/Q)>4;a||Y?(T=(T+(e=0))/2,Q=(Q+(j=0))/2):(i.Zg.dx+=e,i.Zg.dy+=j,T=e||1,Q=j||1)}}var T=0,Q=0;function t(i,x){var e=1;switch(x.deltaMode){case 0:e=1;break;case 1:e=12;break;case 2:e=i.element.clientHeight||window.innerHeight}i.Zg.qL+=(x.deltaX||0)*e,i.Zg.lg+=(x.deltaY||0)*e,i.Zg.WL+=(x.deltaZ||0)*e}function V(i,x){if(!i.YL)return x.preventDefault(),!1}function S(i){for(var x in i._keyStates)i._keyStates[x]&&(/^Mouse\d/.test(x)||f(x,!1,i,{code:x,note:"fctrzmjwvh",preventDefault:()=>{},stopPropagation:()=>{}}))}function f(i,x,e,j){var E=e._keyBindmap[i];E&&(w(e._keyStates[i],x)&&(e._keyStates[i]=x,E.forEach((i=>{(!e.filterEvents||e.filterEvents(j,i))&&function(i,x,e,j){var E=x?e.pressCount:e.releaseCount;E[i]=(E[i]||0)+1;var a=e._bindPressCount[i]||0;(a+=x?1:-1)<0&&(a=0);e._bindPressCount[i]=a;var Y=e.state[i];if(w(Y,a)){e.state[i]=a>0;var J=x?e.down:e.up;e.disabled||J.emit(i,j)}}(i,x,e,j)}))),"button"in j||(e.aL&&!j.defaultPrevented&&j.preventDefault(),e.stopPropagation&&j.stopPropagation()))}function w(i,x){return i?!x:x}},13087:i=>{i.exports=function(i,x,e){return i[0]=x[0]+e[0],i[1]=x[1]+e[1],i[2]=x[2]+e[2],i}},13059:(i,x,e)=>{i.exports=function(i,x){var e=j(i[0],i[1],i[2]),Y=j(x[0],x[1],x[2]);E(e,e),E(Y,Y);var J=a(e,Y);return J>1?0:Math.acos(J)};var j=e(13062),E=e(13069),a=e(13071)},13133:i=>{i.exports=function(i,x){return i[0]=Math.ceil(x[0]),i[1]=Math.ceil(x[1]),i[2]=Math.ceil(x[2]),i}},13050:i=>{i.exports=function(i){var x=new Float32Array(3);return x[0]=i[0],x[1]=i[1],x[2]=i[2],x}},13074:i=>{i.exports=function(i,x){return i[0]=x[0],i[1]=x[1],i[2]=x[2],i}},13047:i=>{i.exports=function(){var i=new Float32Array(3);return i[0]=0,i[1]=0,i[2]=0,i}},13210:i=>{i.exports=function(i,x,e){var j=x[0],E=x[1],a=x[2],Y=e[0],J=e[1],u=e[2];return i[0]=E*u-a*J,i[1]=a*Y-j*u,i[2]=j*J-E*Y,i}},13159:(i,x,e)=>{i.exports=e(13156)},13156:i=>{i.exports=function(i,x){var e=x[0]-i[0],j=x[1]-i[1],E=x[2]-i[2];return Math.sqrt(e*e+j*j+E*E)}},13113:(i,x,e)=>{i.exports=e(13105)},13105:i=>{i.exports=function(i,x,e){return i[0]=x[0]/e[0],i[1]=x[1]/e[1],i[2]=x[2]/e[2],i}},13071:i=>{i.exports=function(i,x){return i[0]*x[0]+i[1]*x[1]+i[2]*x[2]}},13040:i=>{i.exports=1e-6},13080:(i,x,e)=>{i.exports=function(i,x){var e=i[0],E=i[1],a=i[2],Y=x[0],J=x[1],u=x[2];return Math.abs(e-Y)<=j*Math.max(1,Math.abs(e),Math.abs(Y))&&Math.abs(E-J)<=j*Math.max(1,Math.abs(E),Math.abs(J))&&Math.abs(a-u)<=j*Math.max(1,Math.abs(a),Math.abs(u))};var j=e(13040)},13084:i=>{i.exports=function(i,x){return i[0]===x[0]&&i[1]===x[1]&&i[2]===x[2]}},13130:i=>{i.exports=function(i,x){return i[0]=Math.floor(x[0]),i[1]=Math.floor(x[1]),i[2]=Math.floor(x[2]),i}},13264:(i,x,e)=>{i.exports=function(i,x,e,E,a,Y){var J,u;x||(x=3);e||(e=0);u=E?Math.min(E*x+e,i.length):i.length;for(J=e;J<u;J+=x)j[0]=i[J],j[1]=i[J+1],j[2]=i[J+2],a(j,j,Y),i[J]=j[0],i[J+1]=j[1],i[J+2]=j[2];return i};var j=e(13047)()},13062:i=>{i.exports=function(i,x,e){var j=new Float32Array(3);return j[0]=i,j[1]=x,j[2]=e,j}},13036:(i,x,e)=>{i.exports={EPSILON:e(13040),create:e(13047),clone:e(13050),angle:e(13059),Xx:e(13062),k:e(13074),set:e(13078),equals:e(13080),exactEquals:e(13084),add:e(13087),Cx:e(13089),sub:e(13092),multiply:e(13094),mul:e(13103),divide:e(13105),div:e(13113),min:e(13122),max:e(13125),floor:e(13130),ceil:e(13133),round:e(13137),scale:e(13144),Ix:e(13147),distance:e(13156),i:e(13159),squaredDistance:e(13166),sqrDist:e(13171),length:e(13178),len:e(13185),squaredLength:e(13188),Hx:e(13197),negate:e(13201),inverse:e(13203),normalize:e(13069),dot:e(13071),cross:e(13210),Ux:e(13217),random:e(13226),transformMat4:e(13233),transformMat3:e(13235),transformQuat:e(13243),Dx:e(13245),hx:e(13251),Fx:e(13255),forEach:e(13264)}},13203:i=>{i.exports=function(i,x){return i[0]=1/x[0],i[1]=1/x[1],i[2]=1/x[2],i}},13185:(i,x,e)=>{i.exports=e(13178)},13178:i=>{i.exports=function(i){var x=i[0],e=i[1],j=i[2];return Math.sqrt(x*x+e*e+j*j)}},13217:i=>{i.exports=function(i,x,e,j){var E=x[0],a=x[1],Y=x[2];return i[0]=E+j*(e[0]-E),i[1]=a+j*(e[1]-a),i[2]=Y+j*(e[2]-Y),i}},13125:i=>{i.exports=function(i,x,e){return i[0]=Math.max(x[0],e[0]),i[1]=Math.max(x[1],e[1]),i[2]=Math.max(x[2],e[2]),i}},13122:i=>{i.exports=function(i,x,e){return i[0]=Math.min(x[0],e[0]),i[1]=Math.min(x[1],e[1]),i[2]=Math.min(x[2],e[2]),i}},13103:(i,x,e)=>{i.exports=e(13094)},13094:i=>{i.exports=function(i,x,e){return i[0]=x[0]*e[0],i[1]=x[1]*e[1],i[2]=x[2]*e[2],i}},13201:i=>{i.exports=function(i,x){return i[0]=-x[0],i[1]=-x[1],i[2]=-x[2],i}},13069:i=>{i.exports=function(i,x){var e=x[0],j=x[1],E=x[2],a=e*e+j*j+E*E;a>0&&(a=1/Math.sqrt(a),i[0]=x[0]*a,i[1]=x[1]*a,i[2]=x[2]*a);return i}},13226:i=>{i.exports=function(i,x){x=x||1;var e=2*Math.random()*Math.PI,j=2*Math.random()-1,E=Math.sqrt(1-j*j)*x;return i[0]=Math.cos(e)*E,i[1]=Math.sin(e)*E,i[2]=j*x,i}},13245:i=>{i.exports=function(i,x,e,j){var E=e[1],a=e[2],Y=x[1]-E,J=x[2]-a,u=Math.sin(j),b=Math.cos(j);return i[0]=x[0],i[1]=E+Y*b-J*u,i[2]=a+Y*u+J*b,i}},13251:i=>{i.exports=function(i,x,e,j){var E=e[0],a=e[2],Y=x[0]-E,J=x[2]-a,u=Math.sin(j),b=Math.cos(j);return i[0]=E+J*u+Y*b,i[1]=x[1],i[2]=a+J*b-Y*u,i}},13255:i=>{i.exports=function(i,x,e,j){var E=e[0],a=e[1],Y=x[0]-E,J=x[1]-a,u=Math.sin(j),b=Math.cos(j);return i[0]=E+Y*b-J*u,i[1]=a+Y*u+J*b,i[2]=x[2],i}},13137:i=>{i.exports=function(i,x){return i[0]=Math.round(x[0]),i[1]=Math.round(x[1]),i[2]=Math.round(x[2]),i}},13144:i=>{i.exports=function(i,x,e){return i[0]=x[0]*e,i[1]=x[1]*e,i[2]=x[2]*e,i}},13147:i=>{i.exports=function(i,x,e,j){return i[0]=x[0]+e[0]*j,i[1]=x[1]+e[1]*j,i[2]=x[2]+e[2]*j,i}},13078:i=>{i.exports=function(i,x,e,j){return i[0]=x,i[1]=e,i[2]=j,i}},13171:(i,x,e)=>{i.exports=e(13166)},13197:(i,x,e)=>{i.exports=e(13188)},13166:i=>{i.exports=function(i,x){var e=x[0]-i[0],j=x[1]-i[1],E=x[2]-i[2];return e*e+j*j+E*E}},13188:i=>{i.exports=function(i){var x=i[0],e=i[1],j=i[2];return x*x+e*e+j*j}},13092:(i,x,e)=>{i.exports=e(13089)},13089:i=>{i.exports=function(i,x,e){return i[0]=x[0]-e[0],i[1]=x[1]-e[1],i[2]=x[2]-e[2],i}},13235:i=>{i.exports=function(i,x,e){var j=x[0],E=x[1],a=x[2];return i[0]=j*e[0]+E*e[3]+a*e[6],i[1]=j*e[1]+E*e[4]+a*e[7],i[2]=j*e[2]+E*e[5]+a*e[8],i}},13233:i=>{i.exports=function(i,x,e){var j=x[0],E=x[1],a=x[2],Y=e[3]*j+e[7]*E+e[11]*a+e[15];return Y=Y||1,i[0]=(e[0]*j+e[4]*E+e[8]*a+e[12])/Y,i[1]=(e[1]*j+e[5]*E+e[9]*a+e[13])/Y,i[2]=(e[2]*j+e[6]*E+e[10]*a+e[14])/Y,i}},13243:i=>{i.exports=function(i,x,e){var j=x[0],E=x[1],a=x[2],Y=e[0],J=e[1],u=e[2],b=e[3],g=b*j+J*a-u*E,A=b*E+u*j-Y*a,K=b*a+Y*E-J*j,L=-Y*j-J*E-u*a;return i[0]=g*b+L*-Y+A*-u-K*-J,i[1]=A*b+L*-J+K*-Y-g*-u,i[2]=K*b+L*-u+g*-J-A*-Y,i}},14135:i=>{"use strict";i.exports=function(i){for(var x=new Array(i),e=0;e<i;++e)x[e]=e;return x}},14191:i=>{i.exports=function(i){return null!=i&&null!=i.constructor&&"function"===typeof i.constructor.isBuffer&&i.constructor.isBuffer(i)}},14402:(i,x,e)=>{"use strict";e.d(x,{b:()=>j});class j{constructor(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.DA=!1,this.hA=!1,this.HA=30,this.UA=0,this.WA=!1,this.fullscreen=!1,this.RA=function(i){},this.yA=function(){},this.PA=function(){},this.nx=function(){},this.rA=function(i){},this.onFullscreenChanged=function(i){},b((()=>{!function(i,x){i._nowObject=performance||Date,i._lastTick=0,i._renderAccum=0,i._rt=0,i._frameCB=J.bind(null,i),requestAnimationFrame(i._frameCB),x>0&&(i._intervalCB=Y.bind(null,i),i._interval=setInterval(i._intervalCB,Math.max(x,1e3/i.HA/2)))}(this,x),function(i,x){if(!x)return;var e=!1,j=!1;document.addEventListener("pointerlockchange",(j=>{e=document.pointerLockElement===x,i.rA(e)})),document.addEventListener("fullscreenchange",(e=>{j=document.fullscreenElement===x,i.onFullscreenChanged(j)})),Object.defineProperty(i,"WA",{get:()=>e,set:i=>{i&&!e?u(x):e&&!i&&function(i){i.exitPointerLock&&i.exitPointerLock()}(document)}}),Object.defineProperty(i,"fullscreen",{get:()=>j,set:i=>{i&&!j?x.requestFullscreen():j&&!i&&document.exitFullscreen()}}),x.addEventListener("click",(E=>{i.DA&&!e&&u(x),i.hA&&!j&&x.requestFullscreen()}));var E=()=>i.nx();if(window.ResizeObserver){new ResizeObserver(E).observe(x)}else window.addEventListener("resize",E)}(this,i),this.PA()}))}}var E=3,a=20;function Y(i){for(var x=1e3/i.HA,e=i._nowObject.now()+a,j=0;i._nowObject.now()>=i._lastTick+x&&i._nowObject.now()<e&&++j<=E;)i.RA(x),i._lastTick+=x;var Y=5*(x+5),J=i._nowObject.now();if(J-i._lastTick>Y)for(;J>=i._lastTick+x;)i._lastTick+=x}function J(i){requestAnimationFrame(i._frameCB),Y(i);var x=i._nowObject.now(),e=x-i._rt;if(i._rt=x,i.UA>0){i._renderAccum+=e;var j=1e3/i.UA;if(i._renderAccum<j)return;i._renderAccum=Math.min(i._renderAccum-j,j)}var E=1e3/i.HA,a=(x-i._lastTick)/E;i.yA(e,a,E)}function u(i){i.requestPointerLock&&i.requestPointerLock()}var b=i=>{if("loading"===document.readyState){var x=()=>{document.removeEventListener("readystatechange",x),i()};document.addEventListener("readystatechange",x)}else setTimeout(i,1)}},14130:(i,x,e)=>{var j=e(14135),E=e(14137),a="undefined"!==typeof Float64Array;function Y(i,x){return i[0]-x[0]}function J(){var i,x=this.stride,e=new Array(x.length);for(i=0;i<e.length;++i)e[i]=[Math.abs(x[i]),i];e.sort(Y);var j=new Array(e.length);for(i=0;i<j.length;++i)j[i]=e[i][1];return j}function u(i,x){var e=["View",x,"d",i].join("");x<0&&(e="View_Nil"+i);var E="generic"===i;if(-1===x){var a="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+i+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}";return new Function(a)()}if(0===x){a="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+i+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}";return new Function("TrivialArray",a)(b[i][0])}a=["'use strict'"];var Y=j(x),u=Y.map((function(i){return"i"+i})),g="this.offset+"+Y.map((function(i){return"this.stride["+i+"]*i"+i})).join("+"),A=Y.map((function(i){return"b"+i})).join(","),K=Y.map((function(i){return"c"+i})).join(",");a.push("function "+e+"(a,"+A+","+K+",d){this.data=a","this.shape=["+A+"]","this.stride=["+K+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+i+"'","proto.dimension="+x),a.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+Y.map((function(i){return"this.shape["+i+"]"})).join("*"),"}})"),1===x?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),x<4?(a.push("function "+e+"_order(){"),2===x?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===x&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+e+"_set("+u.join(",")+",v){"),E?a.push("return this.data.set("+g+",v)}"):a.push("return this.data["+g+"]=v}"),a.push("proto.get=function "+e+"_get("+u.join(",")+"){"),E?a.push("return this.data.get("+g+")}"):a.push("return this.data["+g+"]}"),a.push("proto.index=function "+e+"_index(",u.join(),"){return "+g+"}"),a.push("proto.hi=function "+e+"_hi("+u.join(",")+"){return new "+e+"(this.data,"+Y.map((function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")})).join(",")+","+Y.map((function(i){return"this.stride["+i+"]"})).join(",")+",this.offset)}");var L=Y.map((function(i){return"a"+i+"=this.shape["+i+"]"})),o=Y.map((function(i){return"c"+i+"=this.stride["+i+"]"}));a.push("proto.lo=function "+e+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+L.join(",")+","+o.join(","));for(var M=0;M<x;++M)a.push("if(typeof i"+M+"==='number'&&i"+M+">=0){d=i"+M+"|0;b+=c"+M+"*d;a"+M+"-=d}");a.push("return new "+e+"(this.data,"+Y.map((function(i){return"a"+i})).join(",")+","+Y.map((function(i){return"c"+i})).join(",")+",b)}"),a.push("proto.step=function "+e+"_step("+u.join(",")+"){var "+Y.map((function(i){return"a"+i+"=this.shape["+i+"]"})).join(",")+","+Y.map((function(i){return"b"+i+"=this.stride["+i+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(M=0;M<x;++M)a.push("if(typeof i"+M+"==='number'){d=i"+M+"|0;if(d<0){c+=b"+M+"*(a"+M+"-1);a"+M+"=ceil(-a"+M+"/d)}else{a"+M+"=ceil(a"+M+"/d)}b"+M+"*=d}");a.push("return new "+e+"(this.data,"+Y.map((function(i){return"a"+i})).join(",")+","+Y.map((function(i){return"b"+i})).join(",")+",c)}");var z=new Array(x),T=new Array(x);for(M=0;M<x;++M)z[M]="a[i"+M+"]",T[M]="b[i"+M+"]";a.push("proto.transpose=function "+e+"_transpose("+u+"){"+u.map((function(i,x){return i+"=("+i+"===undefined?"+x+":"+i+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+z.join(",")+","+T.join(",")+",this.offset)}"),a.push("proto.pick=function "+e+"_pick("+u+"){var a=[],b=[],c=this.offset");for(M=0;M<x;++M)a.push("if(typeof i"+M+"==='number'&&i"+M+">=0){c=(c+this.stride["+M+"]*i"+M+")|0}else{a.push(this.shape["+M+"]);b.push(this.stride["+M+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+Y.map((function(i){return"shape["+i+"]"})).join(",")+","+Y.map((function(i){return"stride["+i+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(b[i],J)}var b={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};i.exports=function(i,x,e,j){if(void 0===i)return(0,b.array[0])([]);"number"===typeof i&&(i=[i]),void 0===x&&(x=[i.length]);var Y=x.length;if(void 0===e){e=new Array(Y);for(var J=Y-1,g=1;J>=0;--J)e[J]=g,g*=x[J]}if(void 0===j){j=0;for(J=0;J<Y;++J)e[J]<0&&(j-=(x[J]-1)*e[J])}for(var A=function(i){if(E(i))return"buffer";if(a)switch(Object.prototype.toString.call(i)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(i)?"array":"generic"}(i),K=b[A];K.length<=Y+1;)K.push(u(A,K.length-1));return(0,K[Y+1])(i,x,e,j)}},14137:i=>{function x(i){return!!i.constructor&&"function"===typeof i.constructor.isBuffer&&i.constructor.isBuffer(i)}i.exports=function(i){return null!=i&&(x(i)||function(i){return"function"===typeof i.readFloatLE&&"function"===typeof i.slice&&x(i.slice(0,0))}(i)||!!i._isBuffer)}},14271:i=>{"use strict";var x=[],e=[],j=[],E=[],a=[],Y=[],J=[],u=[],b=[],g=[],A=[],K=[];i.exports=function(i,L,o,M,z,T){for(var Q=J,t=b,V=g,S=K,f=0;f<3;f++)Q[f]=+o[f],V[f]=+L.max[f],t[f]=+L.base[f];T||(T=1e-10);var w=function(i,J,b,g,K,L){var o=x,M=e,z=j,T=E,Q=a,t=Y,V=u,S=Math.floor,f=0,w=0,O=0,l=0,Z=0;if(B(),0===O)return 0;for(l=mi();w<=O;){if(k(l)&&N())return f;l=mi()}for(f+=O,Z=0;Z<3;Z++)g[Z]+=b[Z],K[Z]+=b[Z];return f;function B(){if(w=0,0!==(O=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])))for(var i=0;i<3;i++){var x=b[i]>=0;T[i]=x?1:-1;var e=x?K[i]:g[i];o[i]=x?g[i]:K[i],M[i]=X(e,T[i]),z[i]=C(o[i],T[i]),V[i]=b[i]/O,Q[i]=Math.abs(1/V[i]);var j=x?M[i]+1-e:e-M[i];t[i]=Q[i]<1/0?Q[i]*j:1/0}}function k(x){for(var e=T[0],j=0===x?M[0]:z[0],E=M[0]+e,a=T[1],Y=1===x?M[1]:z[1],J=M[1]+a,u=T[2],b=2===x?M[2]:z[2],g=M[2]+u,A=j;A!=E;A+=e)for(var K=Y;K!=J;K+=a)for(var L=b;L!=g;L+=u)if(i(A,K,L))return!0;return!1}function N(){f+=w;var i=T[l],x=w/O,e=A;for(Z=0;Z<3;Z++){var j=b[Z]*x;g[Z]+=j,K[Z]+=j,e[Z]=b[Z]-j}if(i>0?K[l]=Math.round(K[l]):g[l]=Math.round(g[l]),J(f,l,i,e))return!0;for(Z=0;Z<3;Z++)b[Z]=e[Z];return B(),0===O}function mi(){var i=t[0]<t[1]?t[0]<t[2]?0:2:t[1]<t[2]?1:2,x=t[i]-w;for(w=t[i],M[i]+=T[i],t[i]+=Q[i],Z=0;Z<3;Z++)o[Z]+=x*V[Z],z[Z]=C(o[Z],T[Z]);return i}function X(i,x){return S(i-x*L)}function C(i,x){return S(i+x*L)}}(i,M,Q,t,V,T);if(!z){for(f=0;f<3;f++)S[f]=o[f]>0?V[f]-L.max[f]:t[f]-L.base[f];L.translate(S)}return w}},14428:(i,x,e)=>{"use strict";e.d(x,{b:()=>A});var j=e(14262),E=e(13036);class a{constructor(i,x,e,a,Y,J,u){this.Cg=new j(i.base,i.xA),this.Vx=x,this.friction=e,this.restitution=a,this.Sx=Y,this.zo=J,this.wx=!!u,this.iA=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.aM=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Gb=E.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=E.create(),this._impulses=E.create(),this._sleepFrameCount=10}loadFromCopy(i){E.k(this.Cg.base,i.Cg.base),E.k(this.Cg.xA,i.Cg.xA),E.k(this.Cg.max,i.Cg.max),this.Cg.mag=i.Cg.mag,this.Vx=i.Vx,this.friction=i.friction,this.restitution=i.restitution,this.Sx=i.Sx,this.zo=i.zo,this.wx=i.wx,this.iA=i.iA,this.fluidDrag=i.fluidDrag,this.aM=i.aM,this.preventFallOffEdge=i.preventFallOffEdge,this.rolledBackLastTick=i.rolledBackLastTick,E.k(this.Gb,i.Gb),E.k(this.resting,i.resting),this.inFluid=i.inFluid,this._ratioInFluid=i._ratioInFluid,E.k(this._forces,i._forces),E.k(this._impulses,i._impulses),this._sleepFrameCount=i._sleepFrameCount}setPosition(i){Y(i),E.Cx(i,i,this.Cg.base),this.Cg.translate(i),this.Eg()}ie(){return E.clone(this.Cg.base)}applyForce(i){Y(i),E.add(this._forces,this._forces,i),this.Eg()}applyImpulse(i){Y(i),E.add(this._impulses,this._impulses,i),this.Eg()}Eg(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var Y=i=>{};var J=e(14262),u=e(13036),b=e(14271);function g(){this.iA=.1,this.fluidDrag=.4,this.kx=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function A(i,x,e){i=Object.assign(new g,i),this.gravity=i.gravity||[0,-10,0],this.iA=i.iA||.1,this.kx=i.kx||2,this.fluidDrag=i.fluidDrag||.4,this.minBounceImpulse=i.minBounceImpulse,this.bodies=[],this.HL=i.HL,this.testSolid=x,this.testFluid=e}A.prototype.Oo=function(i,x,e,j,E,Y){i=i||new J([0,0,0],[1,1,1]),"undefined"==typeof x&&(x=1),"undefined"==typeof e&&(e=1),"undefined"==typeof j&&(j=0),"undefined"==typeof E&&(E=1);var u=new a(i,x,e,j,E,Y);return this.bodies.push(u),u},A.prototype.Zo=function(i){var x=this.bodies.indexOf(i);x<0||(this.bodies.splice(x,1),i.Cg=i.zo=null)};var K=u.create(),L=u.create(),o=u.create(),M=u.create(),z=u.create(),T=u.create(),Q=u.create(),t=new J([0,0,0],[1,1,1]),V=new a(t,1,1,0,1,(()=>{}),!1);function S(i,x,e){return x=e,x*=1-(1-i.ratioInFluid)**2}A.prototype.SJ=function(i){i/=1e3;var x=H(0,u.squaredLength(this.gravity));this.bodies.forEach((e=>function(i,x,e,j){u.k(z,x.resting),i.HL&&V.loadFromCopy(x);if(x.Vx<=0)return u.set(x.Gb,0,0,0),u.set(x._forces,0,0,0),void u.set(x._impulses,0,0,0);var E=j||0===x.Sx;if(function(i,x,e,j){if(x._sleepFrameCount>0)return!1;if(j)return!0;var E=!1,a=.5*e*e*x.Sx;return u.scale(p,i.gravity,a),b(i.testSolid,x.Cg,p,(function(){return E=!0,!0}),!0),E}(i,x,e,E))return;x._sleepFrameCount--,function(i,x){var e=x.Cg,j=Math.floor(e.base[0]),E=Math.floor(e.base[2]),a=Math.floor(e.base[1]),Y=Math.floor(e.max[1]);if(!i.testFluid(j,a,E))return x.inFluid=!1,void(x.ratioInFluid=0);var J=1,b=a+1;for(;b<=Y&&i.testFluid(j,b,E);)J++,b++;var g=(a+J-e.base[1])/e.xA[1];g>1&&(g=1);var A=e.xA[0]*e.xA[1]*e.xA[2]*g,K=w;u.scale(K,i.gravity,-i.kx*A*x.Sx),x.applyForce(K),x.inFluid=!0,x.ratioInFluid=g}(i,x),D(x._forces),D(x._impulses),D(x.Gb),D(x.resting),u.scale(K,x._forces,1/x.Vx),u.Ix(K,K,i.gravity,x.Sx),u.scale(L,x._impulses,1/x.Vx),u.Ix(L,L,K,e),u.add(x.Gb,x.Gb,L),x.friction&&(O(i,0,x,L,e),O(i,1,x,L,e),O(i,2,x,L,e));var a=x.fluidDrag>=0?x.fluidDrag:i.fluidDrag,Y=x.iA>=0?x.iA:i.iA,J=Y,g=Y;x.inFluid&&(J=S(x,J,x.fluidDragHoriz>=0?x.fluidDragHoriz:a),g=S(x,g,x.fluidDragVert>=0?x.fluidDragVert:a));J=Math.max(1-J*e/x.Vx,0),g=Math.max(1-g*e/x.Vx,0),u.set(f,J,g,J),u.multiply(x.Gb,x.Gb,f),u.scale(o,x.Gb,e),u.set(x._forces,0,0,0),u.set(x._impulses,0,0,0),x.wx&&U(B,x.Cg);u.k(T,o),u.set(Q,0,0,0),x.preventFallOffEdge&&function(i,x,e,j){if(!x.resting[1]||e[1]>0)return;var E=n;U(E,x.Cg);for(var a=0;a<3;a+=2){u.set(C,0,0,0),C[a]=e[a];var Y=!0;(Y=(Y=(Y=(Y=Y&&!d(i,E.base[0]+C[0]+1e-5,E.base[1],E.base[2]+C[2]+1e-5))&&!d(i,E.max[0]+C[0]-1e-5,E.base[1],E.base[2]+C[2]+1e-5))&&!d(i,E.base[0]+C[0]+1e-5,E.base[1],E.max[2]+C[2]-1e-5))&&!d(i,E.max[0]+C[0]-1e-5,E.base[1],E.max[2]+C[2]-1e-5))?(j[a]=e[a]>0?1:-1,e[a]=0):0===a&&(u.set(I,e[0],0,0),Z(i,E,I,j,x.slideOnCollision))}}(i,x,o,Q);Z(i,x.Cg,o,x.resting,x.slideOnCollision),x.wx&&function(i,x,e,j){if(x.resting[1]>=0&&!x.inFluid)return;var E=0!==x.resting[0],a=0!==x.resting[2];if(!E&&!a)return;var Y=Math.abs(j[0]/j[2]),J=4;if(!E&&Y>J)return;if(!a&&Y<1/J)return;u.add(N,e.base,j);var g=i.testSolid;b(g,e,j,(function(i,x,e,j){if(1!==x)return!0;j[x]=0}));var A=e.base[1],K=x.inFluid?1.951:1.001,L=Math.floor(A+K)-A;u.set(mi,0,L,0);var o=!1;if(b(g,e,mi,(function(i,x,e,j){return o=!0,!0})),o)return;u.Cx(X,N,e.base),X[1]=0,Z(i,e,X,k,!0);var M=H(e.base[0],N[0]),z=H(e.base[2],N[2]);if(E&&!M&&(!z||!a))return;if(a&&(!M||!E)&&!z)return;var T=!0;if(T=T&&!d(i,e.base[0]+1e-5,e.base[1],e.base[2]+1e-5),T=T&&!d(i,e.max[0]-1e-5,e.base[1],e.base[2]+1e-5),T=T&&!d(i,e.base[0]+1e-5,e.base[1],e.max[2]-1e-5),T=T&&!d(i,e.max[0]-1e-5,e.base[1],e.max[2]-1e-5),T)return;U(x.Cg,e),x.resting[0]=k[0],x.resting[2]=k[2],x.aM&&x.aM()}(i,x,B,T);for(var A=0;A<3;++A)x.resting[A]=x.resting[A]||Q[A],M[A]=0,x.resting[A]&&(z[A]||(M[A]=-x.Gb[A]),x.Gb[A]=0);var t=u.length(M);t>.001&&(u.scale(M,M,x.Vx),x.zo&&x.zo(M),x.restitution>0&&t>i.minBounceImpulse&&(u.scale(M,M,x.restitution),x.applyImpulse(M)));var l=u.squaredLength(x.Gb);l>1e-5&&x.Eg();i.HL&&i.HL(x)?(x.loadFromCopy(V),x.rolledBackLastTick=!0):x.rolledBackLastTick=!1}(this,e,i,x)))};var f=u.create([0,0,0]);var w=u.create();function O(i,x,e,j,E){var a=e.resting[x],Y=j[x];if(!e.alwaysApplyHorizFriction||1!==x){if(0===a)return;if(a*Y<=0)return}u.k(l,e.Gb),l[x]=0;var J=u.length(l);if(!H(J,0)){var b=Math.abs(e.friction*i.gravity[x]*E),g=J>b?(J-b)/J:0;e.Gb[(x+1)%3]*=g,e.Gb[(x+2)%3]*=g}}var l=u.create();function Z(i,x,e,j,E){return u.set(j,0,0,0),b(i.testSolid,x,e,(function(i,x,e,a){j[x]=e,a[x]=0,E||(a[0]=0,a[1]=0,a[2]=0)}))}var B=new J([],[]),k=u.create(),N=u.create(),mi=u.create(),X=u.create();var C=u.create(),n=new J([],[]),I=u.create();function d(i,x,e,j){return i.testSolid(Math.floor(x),Math.floor(e-1),Math.floor(j))}var p=u.create();function H(i,x){return Math.abs(i-x)<1e-5}function U(i,x){for(var e=0;e<3;e++)i.base[e]=x.base[e],i.max[e]=x.max[e],i.xA[e]=x.xA[e]}var D=function(i){}},12902:function(i,x){!function(i){"use strict";var x=function(i,e){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,x){i.__proto__=x}||function(i,x){for(var e in x)Object.prototype.hasOwnProperty.call(x,e)&&(i[e]=x[e])},x(i,e)};function e(i,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function j(){this.constructor=i}x(i,e),i.prototype=null===e?Object.create(e):(j.prototype=e.prototype,new j)}function j(i,x,e,j){var E,a=arguments.length,Y=a<3?x:null===j?j=Object.getOwnPropertyDescriptor(x,e):j;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)Y=Reflect.decorate(i,x,e,j);else for(var J=i.length-1;J>=0;J--)(E=i[J])&&(Y=(a<3?E(Y):a>3?E(x,e,Y):E(x,e))||Y);return a>3&&Y&&Object.defineProperty(x,e,Y),Y}function E(i,x,e){if(e||2===arguments.length)for(var j,E=0,a=x.length;E<a;E++)!j&&E in x||(j||(j=Array.prototype.slice.call(x,0,E)),j[E]=x[E]);return i.concat(j||Array.prototype.slice.call(x))}var a,Y=255,J=213;i.OPERATION=void 0,(a=i.OPERATION||(i.OPERATION={}))[a.ADD=128]="ADD",a[a.REPLACE=0]="REPLACE",a[a.DELETE=64]="DELETE",a[a.DELETE_AND_ADD=192]="DELETE_AND_ADD",a[a.TOUCH=1]="TOUCH",a[a.CLEAR=10]="CLEAR";var u=function(){function x(i,x,e){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=i,this.setParent(x,e)}return x.prototype.setParent=function(i,x,e){var j=this;if(this.indexes||(this.indexes=this.ref instanceof Xi?this.ref._definition.indexes:{}),this.parent=i,this.parentIndex=e,x)if(this.root=x,this.ref instanceof Xi){var E=this.ref._definition;for(var a in E.schema){var Y=this.ref[a];if(Y&&Y.$changes){var J=E.indexes[a];Y.$changes.setParent(this.ref,x,J)}}}else"object"===typeof this.ref&&this.ref.forEach((function(i,x){if(i instanceof Xi){var e=i.$changes,E=j.ref.$changes.indexes[x];e.setParent(j.ref,j.root,E)}}))},x.prototype.operation=function(i){this.changes.set(--this.currentCustomOperation,i)},x.prototype.change=function(x,e){void 0===e&&(e=i.OPERATION.ADD);var j="number"===typeof x?x:this.indexes[x];this.assertValidIndex(j,x);var E=this.changes.get(j);E&&E.op!==i.OPERATION.DELETE&&E.op!==i.OPERATION.TOUCH||this.changes.set(j,{op:E&&E.op===i.OPERATION.DELETE?i.OPERATION.DELETE_AND_ADD:e,index:j}),this.allChanges.add(j),this.changed=!0,this.touchParents()},x.prototype.touch=function(x){var e="number"===typeof x?x:this.indexes[x];this.assertValidIndex(e,x),this.changes.has(e)||this.changes.set(e,{op:i.OPERATION.TOUCH,index:e}),this.allChanges.add(e),this.touchParents()},x.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},x.prototype.getType=function(i){if(this.ref._definition)return(x=this.ref._definition).schema[x.fieldsByIndex[i]];var x,e=(x=this.parent._definition).schema[x.fieldsByIndex[this.parentIndex]];return Object.values(e)[0]},x.prototype.getChildrenFilter=function(){var i=this.parent._definition.childFilters;return i&&i[this.parentIndex]},x.prototype.getValue=function(i){return this.ref.getByIndex(i)},x.prototype.delete=function(x){var e="number"===typeof x?x:this.indexes[x];if(void 0!==e){var j=this.getValue(e);this.changes.set(e,{op:i.OPERATION.DELETE,index:e}),this.allChanges.delete(e),delete this.caches[e],j&&j.$changes&&(j.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(x," (").concat(e,")"))},x.prototype.discard=function(x,e){var j=this;void 0===x&&(x=!1),void 0===e&&(e=!1),this.ref instanceof Xi||this.changes.forEach((function(x){if(x.op===i.OPERATION.DELETE){var e=j.ref.getIndex(x.index);delete j.indexes[e]}})),this.changes.clear(),this.changed=x,e&&this.allChanges.clear(),this.currentCustomOperation=0},x.prototype.discardAll=function(){var i=this;this.changes.forEach((function(x){var e=i.getValue(x.index);e&&e.$changes&&e.$changes.discardAll()})),this.discard()},x.prototype.cache=function(i,x){this.caches[i]=x},x.prototype.clone=function(){return new x(this.ref,this.parent,this.root)},x.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},x.prototype.assertValidIndex=function(i,x){if(void 0===i)throw new Error('ChangeTree: missing index for field "'.concat(x,'"'))},x}();function b(i,x,e,j){return i[x]||(i[x]=[]),i[x].push(e),null===j||void 0===j||j.forEach((function(i,x){return e(i,x)})),function(){return A(i[x],i[x].indexOf(e))}}function g(x){var e=this,j="string"!==typeof this.$changes.getType();this.$items.forEach((function(E,a){x.push({refId:e.$changes.refId,op:i.OPERATION.DELETE,field:a,value:void 0,previousValue:E}),j&&e.$changes.root.removeRef(E.$changes.refId)}))}function A(i,x){if(-1===x||x>=i.length)return!1;for(var e=i.length-1,j=x;j<e;j++)i[j]=i[j+1];return i.length=e,!0}var K=function(i,x){var e=i.toString(),j=x.toString();return e<j?-1:e>j?1:0};function L(i){return i.$proxy=!0,i=new Proxy(i,{get:function(i,x){return"symbol"===typeof x||isNaN(x)?i[x]:i.at(x)},set:function(i,x,e){if("symbol"===typeof x||isNaN(x))i[x]=e;else{var j=Array.from(i.$items.keys()),E=parseInt(j[x]||x);void 0===e||null===e?i.deleteAt(E):i.setAt(E,e)}return!0},deleteProperty:function(i,x){return"number"===typeof x?i.deleteAt(x):delete i[x],!0}})}var o=function(){function x(){for(var i=[],x=0;x<arguments.length;x++)i[x]=arguments[x];this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,i)}return x.prototype.dJ=function(x,e){return void 0===e&&(e=!0),b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,x,e?this.$items:void 0)},x.prototype.me=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,x)},x.is=function(i){return Array.isArray(i)||void 0!==i.array},Object.defineProperty(x.prototype,"length",{get:function(){return this.$items.size},set:function(i){0===i?this.clear():this.splice(i,this.length-i)},enumerable:!1,configurable:!0}),x.prototype.push=function(){for(var i,x=this,e=[],j=0;j<arguments.length;j++)e[j]=arguments[j];return e.forEach((function(e){i=x.$refId++,x.setAt(i,e)})),i},x.prototype.pop=function(){var i=Array.from(this.$indexes.values()).pop();if(void 0!==i){this.$changes.delete(i),this.$indexes.delete(i);var x=this.$items.get(i);return this.$items.delete(i),x}},x.prototype.at=function(i){var x=Array.from(this.$items.keys())[i];return this.$items.get(x)},x.prototype.setAt=function(x,e){var j,E;if(void 0!==e&&null!==e){if(this.$items.get(x)!==e){void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,x);var a=null!==(E=null===(j=this.$changes.indexes[x])||void 0===j?void 0:j.op)&&void 0!==E?E:i.OPERATION.ADD;this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,e),this.$changes.change(x,a)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},x.prototype.deleteAt=function(i){var x=Array.from(this.$items.keys())[i];return void 0!==x&&this.$deleteAt(x)},x.prototype.$deleteAt=function(i){return this.$changes.delete(i),this.$indexes.delete(i),this.$items.delete(i)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&g.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.concat=function(){for(var i,e=[],j=0;j<arguments.length;j++)e[j]=arguments[j];return new(x.bind.apply(x,E([void 0],(i=Array.from(this.$items.values())).concat.apply(i,e),!1)))},x.prototype.join=function(i){return Array.from(this.$items.values()).join(i)},x.prototype.reverse=function(){var i=this,x=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(e,j){i.setAt(x[j],e)})),this},x.prototype.shift=function(){var i=Array.from(this.$items.keys()).shift();if(void 0!==i){var x=this.$items.get(i);return this.$deleteAt(i),x}},x.prototype.slice=function(i,e){var j=new x;return j.push.apply(j,Array.from(this.$items.values()).slice(i,e)),j},x.prototype.sort=function(i){var x=this;void 0===i&&(i=K);var e=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(i).forEach((function(i,j){x.setAt(e[j],i)})),this},x.prototype.splice=function(i,x){void 0===x&&(x=this.length-i);for(var e=Array.from(this.$items.keys()),j=[],E=i;E<i+x;E++)j.push(this.$items.get(e[E])),this.$deleteAt(e[E]);return j},x.prototype.unshift=function(){for(var i=this,x=[],e=0;e<arguments.length;e++)x[e]=arguments[e];var j=this.length,E=x.length,a=Array.from(this.$items.values());return x.forEach((function(x,e){i.setAt(e,x)})),a.forEach((function(x,e){i.setAt(E+e,x)})),j+E},x.prototype.indexOf=function(i,x){return Array.from(this.$items.values()).indexOf(i,x)},x.prototype.lastIndexOf=function(i,x){return void 0===x&&(x=this.length-1),Array.from(this.$items.values()).lastIndexOf(i,x)},x.prototype.every=function(i,x){return Array.from(this.$items.values()).every(i,x)},x.prototype.some=function(i,x){return Array.from(this.$items.values()).some(i,x)},x.prototype.forEach=function(i,x){Array.from(this.$items.values()).forEach(i,x)},x.prototype.map=function(i,x){return Array.from(this.$items.values()).map(i,x)},x.prototype.filter=function(i,x){return Array.from(this.$items.values()).filter(i,x)},x.prototype.reduce=function(i,x){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},x.prototype.reduceRight=function(i,x){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},x.prototype.find=function(i,x){return Array.from(this.$items.values()).find(i,x)},x.prototype.findIndex=function(i,x){return Array.from(this.$items.values()).findIndex(i,x)},x.prototype.fill=function(i,x,e){throw new Error("ArraySchema#fill() not implemented")},x.prototype.copyWithin=function(i,x,e){throw new Error("ArraySchema#copyWithin() not implemented")},x.prototype.toString=function(){return this.$items.toString()},x.prototype.toLocaleString=function(){return this.$items.toLocaleString()},x.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},x.prototype.includes=function(i,x){return Array.from(this.$items.values()).includes(i,x)},x.prototype.flatMap=function(i,x){throw new Error("ArraySchema#flatMap() is not supported.")},x.prototype.flat=function(i){throw new Error("ArraySchema#flat() is not supported.")},x.prototype.findLast=function(){var i=Array.from(this.$items.values());return i.findLast.apply(i,arguments)},x.prototype.findLastIndex=function(){var i=Array.from(this.$items.values());return i.findLastIndex.apply(i,arguments)},x.prototype.setIndex=function(i,x){this.$indexes.set(i,x)},x.prototype.getIndex=function(i){return this.$indexes.get(i)},x.prototype.getByIndex=function(i){return this.$items.get(this.$indexes.get(i))},x.prototype.deleteByIndex=function(i){var x=this.$indexes.get(i);this.$items.delete(x),this.$indexes.delete(i)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){return this.toArray().map((function(i){return"function"===typeof i.toJSON?i.toJSON():i}))},x.prototype.clone=function(i){return i?new(x.bind.apply(x,E([void 0],Array.from(this.$items.values()),!1))):new(x.bind.apply(x,E([void 0],this.map((function(i){return i.$changes?i.clone():i})),!1)))},x}();function M(i){return i.$proxy=!0,i=new Proxy(i,{get:function(i,x){return"symbol"!==typeof x&&"undefined"===typeof i[x]?i.get(x):i[x]},set:function(i,x,e){return"symbol"!==typeof x&&-1===x.indexOf("$")&&"dJ"!==x&&"me"!==x&&"onChange"!==x?i.set(x,e):i[x]=e,!0},deleteProperty:function(i,x){return i.delete(x),!0}})}var z=function(){function x(i){var e=this;if(this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,i)if(i instanceof Map||i instanceof x)i.forEach((function(i,x){return e.set(x,i)}));else for(var j in i)this.set(j,i[j])}return x.prototype.dJ=function(x,e){return void 0===e&&(e=!0),b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,x,e?this.$items:void 0)},x.prototype.me=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,x)},x.is=function(i){return void 0!==i.map},x.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(x.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(x,Symbol.species,{get:function(){return x},enumerable:!1,configurable:!0}),x.prototype.set=function(x,e){if(void 0===e||null===e)throw new Error("MapSchema#set('".concat(x,"', ").concat(e,"): trying to set ").concat(e," value on '").concat(x,"'."));x=x.toString();var j="undefined"!==typeof this.$changes.indexes[x],E=j?this.$changes.indexes[x]:this.$refId++,a=j?i.OPERATION.REPLACE:i.OPERATION.ADD,Y=void 0!==e.$changes;if(Y&&e.$changes.setParent(this,this.$changes.root,E),j){if(!Y&&this.$items.get(x)===e)return;Y&&this.$items.get(x)!==e&&(a=i.OPERATION.ADD)}else this.$changes.indexes[x]=E,this.$indexes.set(E,x);return this.$items.set(x,e),this.$changes.change(x,a),this},x.prototype.get=function(i){return this.$items.get(i)},x.prototype.delete=function(i){return this.$changes.delete(i),this.$items.delete(i)},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&g.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(i){return this.$items.has(i)},x.prototype.forEach=function(i){this.$items.forEach(i)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.keys=function(){return this.$items.keys()},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(i,x){this.$indexes.set(i,x)},x.prototype.getIndex=function(i){return this.$indexes.get(i)},x.prototype.getByIndex=function(i){return this.$items.get(this.$indexes.get(i))},x.prototype.deleteByIndex=function(i){var x=this.$indexes.get(i);this.$items.delete(x),this.$indexes.delete(i)},x.prototype.toJSON=function(){var i={};return this.forEach((function(x,e){i[e]="function"===typeof x.toJSON?x.toJSON():x})),i},x.prototype.clone=function(i){var e;return i?e=Object.assign(new x,this):(e=new x,this.forEach((function(i,x){i.$changes?e.set(x,i.clone()):e.set(x,i)}))),e},x}(),T={};function Q(i,x){T[i]=x}function t(i){return T[i]}var V=function(){function i(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return i.create=function(x){var e=new i;return e.schema=Object.assign({},x&&x.schema||{}),e.indexes=Object.assign({},x&&x.indexes||{}),e.fieldsByIndex=Object.assign({},x&&x.fieldsByIndex||{}),e.descriptors=Object.assign({},x&&x.descriptors||{}),e.deprecated=Object.assign({},x&&x.deprecated||{}),e},i.prototype.addField=function(i,x){var e=this.getNextFieldIndex();this.fieldsByIndex[e]=i,this.indexes[i]=e,this.schema[i]=Array.isArray(x)?{array:x[0]}:x},i.prototype.hasField=function(i){return void 0!==this.indexes[i]},i.prototype.addFilter=function(i,x){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[i]]=x,this.indexesWithFilters.push(this.indexes[i]),!0},i.prototype.addChildrenFilter=function(i,x){var e=this.indexes[i],j=this.schema[i];if(t(Object.keys(j)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[e]=x,!0;console.warn("@filterChildren: field '".concat(i,"' can't have children. Ignoring filter."))},i.prototype.getChildrenFilter=function(i){return this.childFilters&&this.childFilters[this.indexes[i]]},i.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},i}();function S(i){return i._context&&i._context.useFilters}var f=function(){function i(){this.types={},this.schemas=new Map,this.useFilters=!1}return i.prototype.has=function(i){return this.schemas.has(i)},i.prototype.get=function(i){return this.types[i]},i.prototype.add=function(i,x){void 0===x&&(x=this.schemas.size),i._definition=V.create(i._definition),i._typeid=x,this.types[x]=i,this.schemas.set(i,x)},i.create=function(x){return void 0===x&&(x={}),function(e){return x.context||(x.context=new i),O(e,x)}},i}(),w=new f;function O(i,x){return void 0===x&&(x={}),function(e,j){var a=x.context||w,Y=e.constructor;if(Y._context=a,!i)throw new Error("".concat(Y.name,': @type() reference provided for "').concat(j,"\" is undefined. Make sure you don't have any circular dependencies."));a.has(Y)||a.add(Y);var J=Y._definition;if(J.addField(j,i),J.descriptors[j]){if(J.deprecated[j])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(j,"' definition on '").concat(Y.name,"'.\nCheck @type() annotation"))}catch(T){var u=T.stack.split("\n")[4].trim();throw new Error("".concat(T.message," ").concat(u))}}var b=o.is(i),g=!b&&z.is(i);if("string"!==typeof i&&!Xi.is(i)){var A=Object.values(i)[0];"string"===typeof A||a.has(A)||a.add(A)}if(x.manual)J.descriptors[j]={enumerable:!0,configurable:!0,writable:!0};else{var K="_".concat(j);J.descriptors[K]={enumerable:!1,configurable:!1,writable:!0},J.descriptors[j]={get:function(){return this[K]},set:function(i){i!==this[K]&&(void 0!==i&&null!==i?(!b||i instanceof o||(i=new(o.bind.apply(o,E([void 0],i,!1)))),!g||i instanceof z||(i=new z(i)),void 0===i.$proxy&&(g?i=M(i):b&&(i=L(i))),this.$changes.change(j),i.$changes&&i.$changes.setParent(this,this.$changes.root,this._definition.indexes[j])):this[K]&&this.$changes.delete(j),this[K]=i)},enumerable:!0,configurable:!0}}}}function l(i){return function(x,e){var j=x.constructor;j._definition.addFilter(e,i)&&(j._context.useFilters=!0)}}function Z(i){return function(x,e){var j=x.constructor;j._definition.addChildrenFilter(e,i)&&(j._context.useFilters=!0)}}function B(i){return void 0===i&&(i=!0),function(x,e){var j=x.constructor._definition;j.deprecated[e]=!0,i&&(j.descriptors[e]={get:function(){throw new Error("".concat(e," is deprecated."))},set:function(i){},enumerable:!1,configurable:!0})}}function k(i,x,e){for(var j in void 0===e&&(e={}),e.context||(e.context=i._context||e.context||w),x)O(x[j],e)(i.prototype,j);return i}function N(i){for(var x=0,e=0,j=0,E=i.length;j<E;j++)(x=i.charCodeAt(j))<128?e+=1:x<2048?e+=2:x<55296||x>=57344?e+=3:(j++,e+=4);return e}function mi(i,x,e){for(var j=0,E=0,a=e.length;E<a;E++)(j=e.charCodeAt(E))<128?i[x++]=j:j<2048?(i[x++]=192|j>>6,i[x++]=128|63&j):j<55296||j>=57344?(i[x++]=224|j>>12,i[x++]=128|j>>6&63,i[x++]=128|63&j):(E++,j=65536+((1023&j)<<10|1023&e.charCodeAt(E)),i[x++]=240|j>>18,i[x++]=128|j>>12&63,i[x++]=128|j>>6&63,i[x++]=128|63&j)}function X(i,x){i.push(255&x)}function C(i,x){i.push(255&x)}function n(i,x){i.push(255&x),i.push(x>>8&255)}function I(i,x){i.push(255&x),i.push(x>>8&255)}function d(i,x){i.push(255&x),i.push(x>>8&255),i.push(x>>16&255),i.push(x>>24&255)}function p(i,x){var e=x>>24,j=x>>16,E=x>>8,a=x;i.push(255&a),i.push(255&E),i.push(255&j),i.push(255&e)}function H(i,x){var e=Math.floor(x/Math.pow(2,32));p(i,x>>>0),p(i,e)}function U(i,x){var e=x/Math.pow(2,32)|0;p(i,x>>>0),p(i,e)}function D(i,x){r(i,x)}function h(i,x){c(i,x)}var F=new Int32Array(2),R=new Float32Array(F.buffer),y=new Float64Array(F.buffer);function r(i,x){R[0]=x,d(i,F[0])}function c(i,x){y[0]=x,d(i,F[0]),d(i,F[1])}function P(i,x){return C(i,x?1:0)}function q(i,x){x||(x="");var e=N(x),j=0;if(e<32)i.push(160|e),j=1;else if(e<256)i.push(217),C(i,e),j=2;else if(e<65536)i.push(218),I(i,e),j=3;else{if(!(e<4294967296))throw new Error("String too long");i.push(219),p(i,e),j=5}return mi(i,i.length,x),j+e}function W(i,x){return isNaN(x)?W(i,0):isFinite(x)?x!==(0|x)?(i.push(203),c(i,x),9):x>=0?x<128?(C(i,x),1):x<256?(i.push(204),C(i,x),2):x<65536?(i.push(205),I(i,x),3):x<4294967296?(i.push(206),p(i,x),5):(i.push(207),U(i,x),9):x>=-32?(i.push(224|x+32),1):x>=-128?(i.push(208),X(i,x),2):x>=-32768?(i.push(209),n(i,x),3):x>=-2147483648?(i.push(210),d(i,x),5):(i.push(211),H(i,x),9):W(i,x>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var G=Object.freeze({__proto__:null,utf8Write:mi,int8:X,uint8:C,int16:n,uint16:I,int32:d,uint32:p,int64:H,uint64:U,float32:D,float64:h,writeFloat32:r,writeFloat64:c,boolean:P,string:q,number:W});function v(i,x,e){for(var j="",E=0,a=x,Y=x+e;a<Y;a++){var J=i[a];0!==(128&J)?192!==(224&J)?224!==(240&J)?240!==(248&J)?console.error("Invalid byte "+J.toString(16)):(E=(7&J)<<18|(63&i[++a])<<12|(63&i[++a])<<6|63&i[++a])>=65536?(E-=65536,j+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):j+=String.fromCharCode(E):j+=String.fromCharCode((15&J)<<12|(63&i[++a])<<6|63&i[++a]):j+=String.fromCharCode((31&J)<<6|63&i[++a]):j+=String.fromCharCode(J)}return j}function s(i,x){return ii(i,x)<<24>>24}function ii(i,x){return i[x.offset++]}function xi(i,x){return ei(i,x)<<16>>16}function ei(i,x){return i[x.offset++]|i[x.offset++]<<8}function ji(i,x){return i[x.offset++]|i[x.offset++]<<8|i[x.offset++]<<16|i[x.offset++]<<24}function Ei(i,x){return ji(i,x)>>>0}function ai(i,x){return Ki(i,x)}function Yi(i,x){return Li(i,x)}function Ji(i,x){var e=Ei(i,x);return ji(i,x)*Math.pow(2,32)+e}function ui(i,x){var e=Ei(i,x);return Ei(i,x)*Math.pow(2,32)+e}var bi=new Int32Array(2),gi=new Float32Array(bi.buffer),Ai=new Float64Array(bi.buffer);function Ki(i,x){return bi[0]=ji(i,x),gi[0]}function Li(i,x){return bi[0]=ji(i,x),bi[1]=ji(i,x),Ai[0]}function oi(i,x){return ii(i,x)>0}function Mi(i,x){var e,j=i[x.offset++];j<192?e=31&j:217===j?e=ii(i,x):218===j?e=ei(i,x):219===j&&(e=Ei(i,x));var E=v(i,x.offset,e);return x.offset+=e,E}function zi(i,x){var e=i[x.offset];return e<192&&e>160||217===e||218===e||219===e}function Ti(i,x){var e=i[x.offset++];return e<128?e:202===e?Ki(i,x):203===e?Li(i,x):204===e?ii(i,x):205===e?ei(i,x):206===e?Ei(i,x):207===e?ui(i,x):208===e?s(i,x):209===e?xi(i,x):210===e?ji(i,x):211===e?Ji(i,x):e>223?-1*(255-e+1):void 0}function Qi(i,x){var e=i[x.offset];return e<128||e>=202&&e<=211}function ti(i,x){return i[x.offset]<160}function Vi(i,x){return i[x.offset-1]===Y&&(i[x.offset]<128||i[x.offset]>=202&&i[x.offset]<=211)}var Si=Object.freeze({__proto__:null,int8:s,uint8:ii,int16:xi,uint16:ei,int32:ji,uint32:Ei,float32:ai,float64:Yi,int64:Ji,uint64:ui,readFloat32:Ki,readFloat64:Li,boolean:oi,string:Mi,stringCheck:zi,number:Ti,numberCheck:Qi,arrayCheck:ti,switchStructureCheck:Vi}),fi=function(){function x(i){var x=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,i&&i.forEach((function(i){return x.add(i)}))}return x.prototype.dJ=function(x,e){return void 0===e&&(e=!0),b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,x,e?this.$items:void 0)},x.prototype.me=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,x)},x.is=function(i){return void 0!==i.collection},x.prototype.add=function(i){var x=this.$refId++;return void 0!==i.$changes&&i.$changes.setParent(this,this.$changes.root,x),this.$changes.indexes[x]=x,this.$indexes.set(x,x),this.$items.set(x,i),this.$changes.change(x),x},x.prototype.at=function(i){var x=Array.from(this.$items.keys())[i];return this.$items.get(x)},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(i){for(var x,e,j=this.$items.entries();(e=j.next())&&!e.done;)if(i===e.value[1]){x=e.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&g.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(i){return Array.from(this.$items.values()).some((function(x){return x===i}))},x.prototype.forEach=function(i){var x=this;this.$items.forEach((function(e,j,E){return i(e,j,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(i,x){this.$indexes.set(i,x)},x.prototype.getIndex=function(i){return this.$indexes.get(i)},x.prototype.getByIndex=function(i){return this.$items.get(this.$indexes.get(i))},x.prototype.deleteByIndex=function(i){var x=this.$indexes.get(i);this.$items.delete(x),this.$indexes.delete(i)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var i=[];return this.forEach((function(x,e){i.push("function"===typeof x.toJSON?x.toJSON():x)})),i},x.prototype.clone=function(i){var e;return i?e=Object.assign(new x,this):(e=new x,this.forEach((function(i){i.$changes?e.add(i.clone()):e.add(i)}))),e},x}(),wi=function(){function x(i){var x=this;this.$changes=new u(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,i&&i.forEach((function(i){return x.add(i)}))}return x.prototype.dJ=function(x,e){return void 0===e&&(e=!0),b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.ADD,x,e?this.$items:void 0)},x.prototype.me=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,x)},x.prototype.onChange=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,x)},x.is=function(i){return void 0!==i.set},x.prototype.add=function(x){var e,j;if(this.has(x))return!1;var E=this.$refId++;void 0!==x.$changes&&x.$changes.setParent(this,this.$changes.root,E);var a=null!==(j=null===(e=this.$changes.indexes[E])||void 0===e?void 0:e.op)&&void 0!==j?j:i.OPERATION.ADD;return this.$changes.indexes[E]=E,this.$indexes.set(E,E),this.$items.set(E,x),this.$changes.change(E,a),E},x.prototype.entries=function(){return this.$items.entries()},x.prototype.delete=function(i){for(var x,e,j=this.$items.entries();(e=j.next())&&!e.done;)if(i===e.value[1]){x=e.value[0];break}return void 0!==x&&(this.$changes.delete(x),this.$indexes.delete(x),this.$items.delete(x))},x.prototype.clear=function(x){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),x&&g.call(this,x),this.$items.clear(),this.$changes.operation({index:0,op:i.OPERATION.CLEAR}),this.$changes.touchParents()},x.prototype.has=function(i){for(var x,e=this.$items.values(),j=!1;(x=e.next())&&!x.done;)if(i===x.value){j=!0;break}return j},x.prototype.forEach=function(i){var x=this;this.$items.forEach((function(e,j,E){return i(e,j,x)}))},x.prototype.values=function(){return this.$items.values()},Object.defineProperty(x.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),x.prototype.setIndex=function(i,x){this.$indexes.set(i,x)},x.prototype.getIndex=function(i){return this.$indexes.get(i)},x.prototype.getByIndex=function(i){return this.$items.get(this.$indexes.get(i))},x.prototype.deleteByIndex=function(i){var x=this.$indexes.get(i);this.$items.delete(x),this.$indexes.delete(i)},x.prototype.toArray=function(){return Array.from(this.$items.values())},x.prototype.toJSON=function(){var i=[];return this.forEach((function(x,e){i.push("function"===typeof x.toJSON?x.toJSON():x)})),i},x.prototype.clone=function(i){var e;return i?e=Object.assign(new x,this):(e=new x,this.forEach((function(i){i.$changes?e.add(i.clone()):e.add(i)}))),e},x}(),Oi=function(){function i(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return i.prototype.addRefId=function(i){this.refIds.has(i)||(this.refIds.add(i),this.containerIndexes.set(i,new Set))},i.get=function(x){return void 0===x.$filterState&&(x.$filterState=new i),x.$filterState},i}(),li=function(){function i(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return i.prototype.getNextUniqueId=function(){return this.nextUniqueId++},i.prototype.addRef=function(i,x,e){void 0===e&&(e=!0),this.refs.set(i,x),e&&(this.refCounts[i]=(this.refCounts[i]||0)+1)},i.prototype.removeRef=function(i){this.refCounts[i]=this.refCounts[i]-1,this.deletedRefs.add(i)},i.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},i.prototype.garbageCollectDeletedRefs=function(){var i=this;this.deletedRefs.forEach((function(x){if(!(i.refCounts[x]>0)){var e=i.refs.get(x);if(e instanceof Xi)for(var j in e._definition.schema)"string"!==typeof e._definition.schema[j]&&e[j]&&e[j].$changes&&i.removeRef(e[j].$changes.refId);else{var E=e.$changes.parent._definition,a=E.schema[E.fieldsByIndex[e.$changes.parentIndex]];"function"===typeof Object.values(a)[0]&&Array.from(e.values()).forEach((function(x){return i.removeRef(x.$changes.refId)}))}i.refs.delete(x),delete i.refCounts[x]}})),this.deletedRefs.clear()},i}(),Zi=function(i){function x(){return null!==i&&i.apply(this,arguments)||this}return e(x,i),x}(Error);function Bi(i,x,e,j){var E,a=!1;switch(x){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":E="number",isNaN(i)&&console.log('trying to encode "NaN" in '.concat(e.constructor.name,"#").concat(j));break;case"string":E="string",a=!0;break;case"boolean":return}if(typeof i!==E&&(!a||a&&null!==i)){var Y="'".concat(JSON.stringify(i),"'").concat(i&&i.constructor&&" (".concat(i.constructor.name,")")||"");throw new Zi("a '".concat(E,"' was expected, but ").concat(Y," was provided in ").concat(e.constructor.name,"#").concat(j))}}function ki(i,x,e,j){if(!(i instanceof x))throw new Zi("a '".concat(x.name,"' was expected, but '").concat(i.constructor.name,"' was provided in ").concat(e.constructor.name,"#").concat(j))}function Ni(i,x,e,j,E){Bi(e,i,j,E);var a=G[i];if(!a)throw new Zi("a '".concat(i,"' was expected, but ").concat(e," was provided in ").concat(j.constructor.name,"#").concat(E));a(x,e)}function mx(i,x,e){return Si[i](x,e)}var Xi=function(){function x(){for(var i=[],x=0;x<arguments.length;x++)i[x]=arguments[x];Object.defineProperties(this,{$changes:{value:new u(this,void 0,new li),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var e=this._definition.descriptors;e&&Object.defineProperties(this,e),i[0]&&this.assign(i[0])}return x.onError=function(i){console.error(i)},x.is=function(i){return i._definition&&void 0!==i._definition.schema},x.prototype.onChange=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.REPLACE,x)},x.prototype.me=function(x){return b(this.$callbacks||(this.$callbacks=[]),i.OPERATION.DELETE,x)},x.prototype.assign=function(i){return Object.assign(this,i),this},Object.defineProperty(x.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),x.prototype.setDirty=function(i,x){this.$changes.change(i,x)},x.prototype.listen=function(i,x,e){var j=this;return void 0===e&&(e=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[i]||(this.$callbacks[i]=[]),this.$callbacks[i].push(x),e&&void 0!==this[i]&&x(this[i],void 0),function(){return A(j.$callbacks[i],j.$callbacks[i].indexOf(x))}},x.prototype.decode=function(e,j,E){var a;void 0===j&&(j={offset:0}),void 0===E&&(E=this);var J=[],u=this.$changes.root,b=e.length,g=0;for(u.refs.set(g,this);j.offset<b;){var A=e[j.offset++];if(A!=Y){var K=E.$changes,L=void 0!==E._definition,M=L?A>>6<<6:A;if(M!==i.OPERATION.CLEAR){var T=L?A%(M||255):Ti(e,j),Q=L?E._definition.fieldsByIndex[T]:"",V=K.getType(T),S=void 0,f=void 0,w=void 0;if(L?f=E["_".concat(Q)]:(f=E.getByIndex(T),(M&i.OPERATION.ADD)===i.OPERATION.ADD?(w=E instanceof z?Mi(e,j):T,E.setIndex(T,w)):w=E.getIndex(T)),(M&i.OPERATION.DELETE)===i.OPERATION.DELETE&&(M!==i.OPERATION.DELETE_AND_ADD&&E.deleteByIndex(T),f&&f.$changes&&u.removeRef(f.$changes.refId),S=null),void 0!==Q){if(M===i.OPERATION.DELETE);else if(x.is(V)){var O=Ti(e,j);if(S=u.refs.get(O),M!==i.OPERATION.REPLACE){var l=this.getSchemaType(e,j,V);S||((S=this.createTypeInstance(l)).$changes.refId=O,f&&(S.$callbacks=f.$callbacks,f.$changes.refId&&O!==f.$changes.refId&&u.removeRef(f.$changes.refId))),u.addRef(O,S,S!==f)}}else if("string"===typeof V)S=mx(V,e,j);else{var Z=t(Object.keys(V)[0]),B=Ti(e,j),k=u.refs.has(B)?f||u.refs.get(B):new Z.constructor;if((S=k.clone(!0)).$changes.refId=B,f&&(S.$callbacks=f.$callbacks,f.$changes.refId&&B!==f.$changes.refId)){u.removeRef(f.$changes.refId);for(var N=f.entries(),mi=void 0;(mi=N.next())&&!mi.done;){var X=(a=mi.value)[0],C=a[1];J.push({refId:B,op:i.OPERATION.DELETE,field:X,value:void 0,previousValue:C})}}u.addRef(B,S,k!==f)}if(null!==S&&void 0!==S)if(S.$changes&&S.$changes.setParent(K.ref,K.root,T),E instanceof x)E[Q]=S;else if(E instanceof z)X=w,E.$items.set(X,S),E.$changes.allChanges.add(T);else if(E instanceof o)E.setAt(T,S);else if(E instanceof fi){var n=E.add(S);E.setIndex(T,n)}else E instanceof wi&&!1!==(n=E.add(S))&&E.setIndex(T,n);f!==S&&J.push({refId:g,op:M,field:Q,dynamicIndex:w,value:S,previousValue:f})}else{console.warn("@colyseus/schema: definition mismatch");for(var I={offset:j.offset};j.offset<b&&(!Vi(e,j)||(I.offset=j.offset+1,!u.refs.has(Ti(e,I))));)j.offset++}}else E.clear(J)}else{g=Ti(e,j);var d=u.refs.get(g);if(!d)throw new Error('"refId" not found: '.concat(g));E=d}}return this._triggerChanges(J),u.garbageCollectDeletedRefs(),J},x.prototype.encode=function(e,j,E){void 0===e&&(e=!1),void 0===j&&(j=[]),void 0===E&&(E=!1);for(var a=this.$changes,J=new WeakSet,u=[a],b=1,g=0;g<b;g++){var A=u[g],K=A.ref,L=K instanceof x;A.ensureRefId(),J.add(A),A!==a&&(A.changed||e)&&(C(j,Y),W(j,A.refId));for(var o=e?Array.from(A.allChanges):Array.from(A.changes.values()),M=0,T=o.length;M<T;M++){var Q=e?{op:i.OPERATION.ADD,index:o[M]}:o[M],V=Q.index,S=L?K._definition.fieldsByIndex&&K._definition.fieldsByIndex[V]:V,f=j.length;if(Q.op!==i.OPERATION.TOUCH)if(L)C(j,V|Q.op);else{if(C(j,Q.op),Q.op===i.OPERATION.CLEAR)continue;W(j,V)}if(L||(Q.op&i.OPERATION.ADD)!=i.OPERATION.ADD||K instanceof z&&q(j,A.ref.$indexes.get(V)),Q.op!==i.OPERATION.DELETE){var w=A.getType(V),O=A.getValue(V);if(O&&O.$changes&&!J.has(O.$changes)&&(u.push(O.$changes),O.$changes.ensureRefId(),b++),Q.op!==i.OPERATION.TOUCH){if(x.is(w))ki(O,w,K,S),W(j,O.$changes.refId),(Q.op&i.OPERATION.ADD)===i.OPERATION.ADD&&this.tryEncodeTypeId(j,w,O.constructor);else if("string"===typeof w)Ni(w,j,O,K,S);else{var l=t(Object.keys(w)[0]);ki(K["_".concat(S)],l.constructor,K,S),W(j,O.$changes.refId)}E&&A.cache(V,j.slice(f))}}}e||E||A.discard()}return j},x.prototype.encodeAll=function(i){return this.encode(!0,[],i)},x.prototype.applyFilters=function(e,j){var E,a;void 0===j&&(j=!1);for(var J=this,u=new Set,b=Oi.get(e),g=[this.$changes],A=1,K=[],L=function(L){var o=g[L];if(u.has(o.refId))return"continue";var M=o.ref,T=M instanceof x;C(K,Y),W(K,o.refId);var Q=b.refIds.has(o),t=j||!Q;b.addRefId(o);var V=b.containerIndexes.get(o),S=t?Array.from(o.allChanges):Array.from(o.changes.values());!j&&T&&M._definition.indexesWithFilters&&M._definition.indexesWithFilters.forEach((function(x){!V.has(x)&&o.allChanges.has(x)&&(t?S.push(x):S.push({op:i.OPERATION.ADD,index:x}))}));for(var f=0,w=S.length;f<w;f++){var O=t?{op:i.OPERATION.ADD,index:S[f]}:S[f];if(O.op!==i.OPERATION.CLEAR){var l=O.index;if(O.op!==i.OPERATION.DELETE){var Z=o.getValue(l),B=o.getType(l);if(T){if((k=M._definition.filters&&M._definition.filters[l])&&!k.call(M,e,Z,J)){Z&&Z.$changes&&u.add(Z.$changes.refId);continue}}else{var k,N=o.parent;if((k=o.getChildrenFilter())&&!k.call(N,e,M.$indexes.get(l),Z,J)){Z&&Z.$changes&&u.add(Z.$changes.refId);continue}}if(Z.$changes&&(g.push(Z.$changes),A++),O.op!==i.OPERATION.TOUCH)if(O.op===i.OPERATION.ADD||T)K.push.apply(K,null!==(E=o.caches[l])&&void 0!==E?E:[]),V.add(l);else if(V.has(l))K.push.apply(K,null!==(a=o.caches[l])&&void 0!==a?a:[]);else{if(V.add(l),C(K,i.OPERATION.ADD),W(K,l),M instanceof z){var mi=o.ref.$indexes.get(l);q(K,mi)}Z.$changes?W(K,Z.$changes.refId):G[B](K,Z)}else Z.$changes&&!T&&(C(K,i.OPERATION.ADD),W(K,l),M instanceof z&&(mi=o.ref.$indexes.get(l),q(K,mi)),W(K,Z.$changes.refId))}else T?C(K,O.op|l):(C(K,O.op),W(K,l))}else C(K,O.op)}},o=0;o<A;o++)L(o);return K},x.prototype.clone=function(){var i,x=new this.constructor,e=this._definition.schema;for(var j in e)"object"===typeof this[j]&&"function"===typeof(null===(i=this[j])||void 0===i?void 0:i.clone)?x[j]=this[j].clone():x[j]=this[j];return x},x.prototype.toJSON=function(){var i=this._definition.schema,x=this._definition.deprecated,e={};for(var j in i)x[j]||null===this[j]||"undefined"===typeof this[j]||(e[j]="function"===typeof this[j].toJSON?this[j].toJSON():this["_".concat(j)]);return e},x.prototype.discardAllChanges=function(){this.$changes.discardAll()},x.prototype.getByIndex=function(i){return this[this._definition.fieldsByIndex[i]]},x.prototype.deleteByIndex=function(i){this[this._definition.fieldsByIndex[i]]=void 0},x.prototype.tryEncodeTypeId=function(i,x,e){x._typeid!==e._typeid&&(C(i,J),W(i,e._typeid))},x.prototype.getSchemaType=function(i,x,e){var j;return i[x.offset]===J&&(x.offset++,j=this.constructor._context.get(Ti(i,x))),j||e},x.prototype.createTypeInstance=function(i){var x=new i;return x.$changes.root=this.$changes.root,x},x.prototype._triggerChanges=function(e){for(var j,E,a,Y,J,u,b,g,A,K=new Set,L=this.$changes.root.refs,o=function(o){var M=e[o],z=M.refId,T=L.get(z),Q=T.$callbacks;if((M.op&i.OPERATION.DELETE)===i.OPERATION.DELETE&&M.previousValue instanceof x&&(null===(E=null===(j=M.previousValue.$callbacks)||void 0===j?void 0:j[i.OPERATION.DELETE])||void 0===E||E.forEach((function(i){return i()}))),!Q)return"continue";if(T instanceof x){if(!K.has(z))try{null===(a=null===Q||void 0===Q?void 0:Q[i.OPERATION.REPLACE])||void 0===a||a.forEach((function(i){return i()}))}catch(t){x.onError(t)}try{Q.hasOwnProperty(M.field)&&(null===(Y=Q[M.field])||void 0===Y||Y.forEach((function(i){return i(M.value,M.previousValue)})))}catch(t){x.onError(t)}}else M.op===i.OPERATION.ADD&&void 0===M.previousValue?null===(J=Q[i.OPERATION.ADD])||void 0===J||J.forEach((function(i){var x;return i(M.value,null!==(x=M.dynamicIndex)&&void 0!==x?x:M.field)})):M.op===i.OPERATION.DELETE?void 0!==M.previousValue&&(null===(u=Q[i.OPERATION.DELETE])||void 0===u||u.forEach((function(i){var x;return i(M.previousValue,null!==(x=M.dynamicIndex)&&void 0!==x?x:M.field)}))):M.op===i.OPERATION.DELETE_AND_ADD&&(void 0!==M.previousValue&&(null===(b=Q[i.OPERATION.DELETE])||void 0===b||b.forEach((function(i){var x;return i(M.previousValue,null!==(x=M.dynamicIndex)&&void 0!==x?x:M.field)}))),null===(g=Q[i.OPERATION.ADD])||void 0===g||g.forEach((function(i){var x;return i(M.value,null!==(x=M.dynamicIndex)&&void 0!==x?x:M.field)}))),M.value!==M.previousValue&&(null===(A=Q[i.OPERATION.REPLACE])||void 0===A||A.forEach((function(i){var x;return i(M.value,null!==(x=M.dynamicIndex)&&void 0!==x?x:M.field)})));K.add(z)},M=0;M<e.length;M++)o(M)},x._definition=V.create(),x}();function Ci(i){for(var x=[i.$changes],e=1,j={},E=j,a=function(i){var e=x[i];e.changes.forEach((function(i){var x=e.ref,j=i.index,a=x._definition?x._definition.fieldsByIndex[j]:x.$indexes.get(j);E[a]=e.getValue(j)}))},Y=0;Y<e;Y++)a(Y);return j}var ni={context:new f},Ii=function(i){function x(){return null!==i&&i.apply(this,arguments)||this}return e(x,i),j([O("string",ni)],x.prototype,"name",void 0),j([O("string",ni)],x.prototype,"type",void 0),j([O("number",ni)],x.prototype,"referencedType",void 0),x}(Xi),di=function(i){function x(){var x=null!==i&&i.apply(this,arguments)||this;return x.fields=new o,x}return e(x,i),j([O("number",ni)],x.prototype,"id",void 0),j([O([Ii],ni)],x.prototype,"fields",void 0),x}(Xi),pi=function(i){function x(){var x=null!==i&&i.apply(this,arguments)||this;return x.types=new o,x}return e(x,i),x.encode=function(i){var e=i.constructor,j=new x;j.rootType=e._typeid;var E=function(i,x){for(var e in x){var E=new Ii;E.name=e;var a=void 0;if("string"===typeof x[e])a=x[e];else{var Y=x[e],J=void 0;Xi.is(Y)?(a="ref",J=x[e]):"string"===typeof Y[a=Object.keys(Y)[0]]?a+=":"+Y[a]:J=Y[a],E.referencedType=J?J._typeid:-1}E.type=a,i.fields.push(E)}j.types.push(i)},a=e._context.types;for(var Y in a){var J=new di;J.id=Number(Y),E(J,a[Y]._definition.schema)}return j.encodeAll()},x.decode=function(i,j){var E=new f,a=new x;a.decode(i,j);var Y=a.types.reduce((function(i,x){var j=function(i){function x(){return null!==i&&i.apply(this,arguments)||this}return e(x,i),x}(Xi),a=x.id;return i[a]=j,E.add(j,a),i}),{});a.types.forEach((function(i){var x=Y[i.id];i.fields.forEach((function(i){var e;if(void 0!==i.referencedType){var j=i.type,a=Y[i.referencedType];if(!a){var J=i.type.split(":");j=J[0],a=J[1]}"ref"===j?O(a,{context:E})(x.prototype,i.name):O(((e={})[j]=a,e),{context:E})(x.prototype,i.name)}else O(i.type,{context:E})(x.prototype,i.name)}))}));var J=Y[a.rootType],u=new J;for(var b in J._definition.schema){var g=J._definition.schema[b];"string"!==typeof g&&(u[b]="function"===typeof g?new g:new(t(Object.keys(g)[0]).constructor))}return u},j([O([di],ni)],x.prototype,"types",void 0),j([O("number",ni)],x.prototype,"rootType",void 0),x}(Xi);Q("map",{constructor:z}),Q("array",{constructor:o}),Q("set",{constructor:wi}),Q("collection",{constructor:fi}),i.ArraySchema=o,i.CollectionSchema=fi,i.Context=f,i.MapSchema=z,i.Reflection=pi,i.ReflectionField=Ii,i.ReflectionType=di,i.Schema=Xi,i.SchemaDefinition=V,i.SetSchema=wi,i.decode=Si,i.defineTypes=k,i.deprecated=B,i.dumpChanges=Ci,i.encode=G,i.filter=l,i.filterChildren=Z,i.hasFilter=S,i.registerType=Q,i.type=O,Object.defineProperty(i,"__esModule",{value:!0})}(x)},14310:i=>{"use strict";i.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},14305:(i,x,e)=>{var j=e(14310),E=e(14317),a=Object.hasOwnProperty,Y=Object.create(null);for(var J in j)a.call(j,J)&&(Y[j[J]]=J);var u=i.exports={to:{},get:{}};function b(i,x,e){return Math.min(Math.max(x,i),e)}function g(i){var x=Math.round(i).toString(16).toUpperCase();return x.length<2?"0"+x:x}u.get=function(i){var x,e;switch(i.substring(0,3).toLowerCase()){case"hsl":x=u.get.hsl(i),e="hsl";break;case"hwb":x=u.get.hwb(i),e="hwb";break;default:x=u.get.rgb(i),e="rgb"}return x?{model:e,value:x}:null},u.get.rgb=function(i){if(!i)return null;var x,e,E,Y=[0,0,0,1];if(x=i.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(E=x[2],x=x[1],e=0;e<3;e++){var J=2*e;Y[e]=parseInt(x.slice(J,J+2),16)}E&&(Y[3]=parseInt(E,16)/255)}else if(x=i.match(/^#([a-f0-9]{3,4})$/i)){for(E=(x=x[1])[3],e=0;e<3;e++)Y[e]=parseInt(x[e]+x[e],16);E&&(Y[3]=parseInt(E+E,16)/255)}else if(x=i.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(e=0;e<3;e++)Y[e]=parseInt(x[e+1],0);x[4]&&(x[5]?Y[3]=.01*parseFloat(x[4]):Y[3]=parseFloat(x[4]))}else{if(!(x=i.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(x=i.match(/^(\w+)$/))?"transparent"===x[1]?[0,0,0,0]:a.call(j,x[1])?((Y=j[x[1]])[3]=1,Y):null:null;for(e=0;e<3;e++)Y[e]=Math.round(2.55*parseFloat(x[e+1]));x[4]&&(x[5]?Y[3]=.01*parseFloat(x[4]):Y[3]=parseFloat(x[4]))}for(e=0;e<3;e++)Y[e]=b(Y[e],0,255);return Y[3]=b(Y[3],0,1),Y},u.get.hsl=function(i){if(!i)return null;var x=i.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var e=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,b(parseFloat(x[2]),0,100),b(parseFloat(x[3]),0,100),b(isNaN(e)?1:e,0,1)]}return null},u.get.hwb=function(i){if(!i)return null;var x=i.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(x){var e=parseFloat(x[4]);return[(parseFloat(x[1])%360+360)%360,b(parseFloat(x[2]),0,100),b(parseFloat(x[3]),0,100),b(isNaN(e)?1:e,0,1)]}return null},u.to.hex=function(){var i=E(arguments);return"#"+g(i[0])+g(i[1])+g(i[2])+(i[3]<1?g(Math.round(255*i[3])):"")},u.to.rgb=function(){var i=E(arguments);return i.length<4||1===i[3]?"rgb("+Math.round(i[0])+", "+Math.round(i[1])+", "+Math.round(i[2])+")":"rgba("+Math.round(i[0])+", "+Math.round(i[1])+", "+Math.round(i[2])+", "+i[3]+")"},u.to.rgb.percent=function(){var i=E(arguments),x=Math.round(i[0]/255*100),e=Math.round(i[1]/255*100),j=Math.round(i[2]/255*100);return i.length<4||1===i[3]?"rgb("+x+"%, "+e+"%, "+j+"%)":"rgba("+x+"%, "+e+"%, "+j+"%, "+i[3]+")"},u.to.hsl=function(){var i=E(arguments);return i.length<4||1===i[3]?"hsl("+i[0]+", "+i[1]+"%, "+i[2]+"%)":"hsla("+i[0]+", "+i[1]+"%, "+i[2]+"%, "+i[3]+")"},u.to.hwb=function(){var i=E(arguments),x="";return i.length>=4&&1!==i[3]&&(x=", "+i[3]),"hwb("+i[0]+", "+i[1]+"%, "+i[2]+"%"+x+")"},u.to.keyword=function(i){return Y[i.slice(0,3)]}},14296:(i,x,e)=>{const j=e(14305),E=e(14323),a=["keyword","gray","hex"],Y={};for(const L of Object.keys(E))Y[[...E[L].labels].sort().join("")]=L;const J={};function u(i,x){if(!(this instanceof u))return new u(i,x);if(x&&x in a&&(x=null),x&&!(x in E))throw new Error("Unknown model: "+x);let e,b;if(null==i)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(i instanceof u)this.model=i.model,this.color=[...i.color],this.valpha=i.valpha;else if("string"===typeof i){const x=j.get(i);if(null===x)throw new Error("Unable to parse color from string: "+i);this.model=x.model,b=E[this.model].channels,this.color=x.value.slice(0,b),this.valpha="number"===typeof x.value[b]?x.value[b]:1}else if(i.length>0){this.model=x||"rgb",b=E[this.model].channels;const e=Array.prototype.slice.call(i,0,b);this.color=K(e,b),this.valpha="number"===typeof i[b]?i[b]:1}else if("number"===typeof i)this.model="rgb",this.color=[i>>16&255,i>>8&255,255&i],this.valpha=1;else{this.valpha=1;const x=Object.keys(i);"alpha"in i&&(x.splice(x.indexOf("alpha"),1),this.valpha="number"===typeof i.alpha?i.alpha:0);const j=x.sort().join("");if(!(j in Y))throw new Error("Unable to parse color from object: "+JSON.stringify(i));this.model=Y[j];const{labels:a}=E[this.model],J=[];for(e=0;e<a.length;e++)J.push(i[a[e]]);this.color=K(J)}if(J[this.model])for(b=E[this.model].channels,e=0;e<b;e++){const i=J[this.model][e];i&&(this.color[e]=i(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}u.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(i){let x=this.model in j.to?this:this.rgb();x=x.round("number"===typeof i?i:1);const e=1===x.valpha?x.color:[...x.color,this.valpha];return j.to[x.model](e)},percentString(i){const x=this.rgb().round("number"===typeof i?i:1),e=1===x.valpha?x.color:[...x.color,this.valpha];return j.to.rgb.percent(e)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const i={},{channels:x}=E[this.model],{labels:e}=E[this.model];for(let j=0;j<x;j++)i[e[j]]=this.color[j];return 1!==this.valpha&&(i.alpha=this.valpha),i},unitArray(){const i=this.rgb().color;return i[0]/=255,i[1]/=255,i[2]/=255,1!==this.valpha&&i.push(this.valpha),i},unitObject(){const i=this.rgb().object();return i.r/=255,i.g/=255,i.b/=255,1!==this.valpha&&(i.alpha=this.valpha),i},round(i){return i=Math.max(i||0,0),new u([...this.color.map(b(i)),this.valpha],this.model)},alpha(i){return void 0!==i?new u([...this.color,Math.max(0,Math.min(1,i))],this.model):this.valpha},red:g("rgb",0,A(255)),green:g("rgb",1,A(255)),blue:g("rgb",2,A(255)),hue:g(["hsl","hsv","hsl","hwb","hcg"],0,(i=>(i%360+360)%360)),saturationl:g("hsl",1,A(100)),lightness:g("hsl",2,A(100)),saturationv:g("hsv",1,A(100)),value:g("hsv",2,A(100)),chroma:g("hcg",1,A(100)),gray:g("hcg",2,A(100)),white:g("hwb",1,A(100)),wblack:g("hwb",2,A(100)),cyan:g("cmyk",0,A(100)),magenta:g("cmyk",1,A(100)),yellow:g("cmyk",2,A(100)),black:g("cmyk",3,A(100)),x:g("xyz",0,A(95.047)),y:g("xyz",1,A(100)),z:g("xyz",2,A(108.833)),l:g("lab",0,A(100)),a:g("lab",1),b:g("lab",2),keyword(i){return void 0!==i?new u(i):E[this.model].keyword(this.color)},hex(i){return void 0!==i?new u(i):j.to.hex(this.rgb().round().color)},hexa(i){if(void 0!==i)return new u(i);const x=this.rgb().round().color;let e=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===e.length&&(e="0"+e),j.to.hex(x)+e},rgbNumber(){const i=this.rgb().color;return(255&i[0])<<16|(255&i[1])<<8|255&i[2]},luminosity(){const i=this.rgb().color,x=[];for(const[e,j]of i.entries()){const i=j/255;x[e]=i<=.04045?i/12.92:((i+.055)/1.055)**2.4}return.2126*x[0]+.7152*x[1]+.0722*x[2]},contrast(i){const x=this.luminosity(),e=i.luminosity();return x>e?(x+.05)/(e+.05):(e+.05)/(x+.05)},level(i){const x=this.contrast(i);return x>=7?"AAA":x>=4.5?"AA":""},isDark(){const i=this.rgb().color;return(2126*i[0]+7152*i[1]+722*i[2])/1e4<128},isLight(){return!this.isDark()},negate(){const i=this.rgb();for(let x=0;x<3;x++)i.color[x]=255-i.color[x];return i},lighten(i){const x=this.hsl();return x.color[2]+=x.color[2]*i,x},darken(i){const x=this.hsl();return x.color[2]-=x.color[2]*i,x},saturate(i){const x=this.hsl();return x.color[1]+=x.color[1]*i,x},desaturate(i){const x=this.hsl();return x.color[1]-=x.color[1]*i,x},whiten(i){const x=this.hwb();return x.color[1]+=x.color[1]*i,x},blacken(i){const x=this.hwb();return x.color[2]+=x.color[2]*i,x},grayscale(){const i=this.rgb().color,x=.3*i[0]+.59*i[1]+.11*i[2];return u.rgb(x,x,x)},fade(i){return this.alpha(this.valpha-this.valpha*i)},opaquer(i){return this.alpha(this.valpha+this.valpha*i)},rotate(i){const x=this.hsl();let e=x.color[0];return e=(e+i)%360,e=e<0?360+e:e,x.color[0]=e,x},mix(i,x){if(!i||!i.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof i);const e=i.rgb(),j=this.rgb(),E=void 0===x?.5:x,a=2*E-1,Y=e.alpha()-j.alpha(),J=((a*Y===-1?a:(a+Y)/(1+a*Y))+1)/2,b=1-J;return u.rgb(J*e.red()+b*j.red(),J*e.green()+b*j.green(),J*e.blue()+b*j.blue(),e.alpha()*E+j.alpha()*(1-E))}};for(const L of Object.keys(E)){if(a.includes(L))continue;const{channels:i}=E[L];u.prototype[L]=function(){if(this.model===L)return new u(this);for(var i=arguments.length,x=new Array(i),e=0;e<i;e++)x[e]=arguments[e];return x.length>0?new u(x,L):new u([...(j=E[this.model][L].raw(this.color),Array.isArray(j)?j:[j]),this.valpha],L);var j},u[L]=function(){for(var x=arguments.length,e=new Array(x),j=0;j<x;j++)e[j]=arguments[j];let E=e[0];return"number"===typeof E&&(E=K(e,i)),new u(E,L)}}function b(i){return function(x){return function(i,x){return Number(i.toFixed(x))}(x,i)}}function g(i,x,e){i=Array.isArray(i)?i:[i];for(const j of i)(J[j]||(J[j]=[]))[x]=e;return i=i[0],function(j){let E;return void 0!==j?(e&&(j=e(j)),E=this[i](),E.color[x]=j,E):(E=this[i]().color[x],e&&(E=e(E)),E)}}function A(i){return function(x){return Math.max(0,Math.min(i,x))}}function K(i,x){for(let e=0;e<x;e++)"number"!==typeof i[e]&&(i[e]=0);return i}i.exports=u},14325:(i,x,e)=>{const j=e(14329),E={};for(const Y of Object.keys(j))E[j[Y]]=Y;const a={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};i.exports=a;for(const Y of Object.keys(a)){if(!("channels"in a[Y]))throw new Error("missing channels property: "+Y);if(!("labels"in a[Y]))throw new Error("missing channel labels property: "+Y);if(a[Y].labels.length!==a[Y].channels)throw new Error("channel and label counts mismatch: "+Y);const{channels:i,labels:x}=a[Y];delete a[Y].channels,delete a[Y].labels,Object.defineProperty(a[Y],"channels",{value:i}),Object.defineProperty(a[Y],"labels",{value:x})}a.rgb.hsl=function(i){const x=i[0]/255,e=i[1]/255,j=i[2]/255,E=Math.min(x,e,j),a=Math.max(x,e,j),Y=a-E;let J,u;a===E?J=0:x===a?J=(e-j)/Y:e===a?J=2+(j-x)/Y:j===a&&(J=4+(x-e)/Y),J=Math.min(60*J,360),J<0&&(J+=360);const b=(E+a)/2;return u=a===E?0:b<=.5?Y/(a+E):Y/(2-a-E),[J,100*u,100*b]},a.rgb.hsv=function(i){let x,e,j,E,a;const Y=i[0]/255,J=i[1]/255,u=i[2]/255,b=Math.max(Y,J,u),g=b-Math.min(Y,J,u),A=function(i){return(b-i)/6/g+.5};return 0===g?(E=0,a=0):(a=g/b,x=A(Y),e=A(J),j=A(u),Y===b?E=j-e:J===b?E=1/3+x-j:u===b&&(E=2/3+e-x),E<0?E+=1:E>1&&(E-=1)),[360*E,100*a,100*b]},a.rgb.hwb=function(i){const x=i[0],e=i[1];let j=i[2];const E=a.rgb.hsl(i)[0],Y=1/255*Math.min(x,Math.min(e,j));return j=1-1/255*Math.max(x,Math.max(e,j)),[E,100*Y,100*j]},a.rgb.cmyk=function(i){const x=i[0]/255,e=i[1]/255,j=i[2]/255,E=Math.min(1-x,1-e,1-j);return[100*((1-x-E)/(1-E)||0),100*((1-e-E)/(1-E)||0),100*((1-j-E)/(1-E)||0),100*E]},a.rgb.keyword=function(i){const x=E[i];if(x)return x;let e,a=1/0;for(const E of Object.keys(j)){const x=j[E],u=(J=x,((Y=i)[0]-J[0])**2+(Y[1]-J[1])**2+(Y[2]-J[2])**2);u<a&&(a=u,e=E)}var Y,J;return e},a.keyword.rgb=function(i){return j[i]},a.rgb.xyz=function(i){let x=i[0]/255,e=i[1]/255,j=i[2]/255;x=x>.04045?((x+.055)/1.055)**2.4:x/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,j=j>.04045?((j+.055)/1.055)**2.4:j/12.92;return[100*(.4124*x+.3576*e+.1805*j),100*(.2126*x+.7152*e+.0722*j),100*(.0193*x+.1192*e+.9505*j)]},a.rgb.lab=function(i){const x=a.rgb.xyz(i);let e=x[0],j=x[1],E=x[2];e/=95.047,j/=100,E/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,j=j>.008856?j**(1/3):7.787*j+16/116,E=E>.008856?E**(1/3):7.787*E+16/116;return[116*j-16,500*(e-j),200*(j-E)]},a.hsl.rgb=function(i){const x=i[0]/360,e=i[1]/100,j=i[2]/100;let E,a,Y;if(0===e)return Y=255*j,[Y,Y,Y];E=j<.5?j*(1+e):j+e-j*e;const J=2*j-E,u=[0,0,0];for(let b=0;b<3;b++)a=x+1/3*-(b-1),a<0&&a++,a>1&&a--,Y=6*a<1?J+6*(E-J)*a:2*a<1?E:3*a<2?J+(E-J)*(2/3-a)*6:J,u[b]=255*Y;return u},a.hsl.hsv=function(i){const x=i[0];let e=i[1]/100,j=i[2]/100,E=e;const a=Math.max(j,.01);j*=2,e*=j<=1?j:2-j,E*=a<=1?a:2-a;return[x,100*(0===j?2*E/(a+E):2*e/(j+e)),100*((j+e)/2)]},a.hsv.rgb=function(i){const x=i[0]/60,e=i[1]/100;let j=i[2]/100;const E=Math.floor(x)%6,a=x-Math.floor(x),Y=255*j*(1-e),J=255*j*(1-e*a),u=255*j*(1-e*(1-a));switch(j*=255,E){case 0:return[j,u,Y];case 1:return[J,j,Y];case 2:return[Y,j,u];case 3:return[Y,J,j];case 4:return[u,Y,j];case 5:return[j,Y,J]}},a.hsv.hsl=function(i){const x=i[0],e=i[1]/100,j=i[2]/100,E=Math.max(j,.01);let a,Y;Y=(2-e)*j;const J=(2-e)*E;return a=e*E,a/=J<=1?J:2-J,a=a||0,Y/=2,[x,100*a,100*Y]},a.hwb.rgb=function(i){const x=i[0]/360;let e=i[1]/100,j=i[2]/100;const E=e+j;let a;E>1&&(e/=E,j/=E);const Y=Math.floor(6*x),J=1-j;a=6*x-Y,0!==(1&Y)&&(a=1-a);const u=e+a*(J-e);let b,g,A;switch(Y){default:case 6:case 0:b=J,g=u,A=e;break;case 1:b=u,g=J,A=e;break;case 2:b=e,g=J,A=u;break;case 3:b=e,g=u,A=J;break;case 4:b=u,g=e,A=J;break;case 5:b=J,g=e,A=u}return[255*b,255*g,255*A]},a.cmyk.rgb=function(i){const x=i[0]/100,e=i[1]/100,j=i[2]/100,E=i[3]/100;return[255*(1-Math.min(1,x*(1-E)+E)),255*(1-Math.min(1,e*(1-E)+E)),255*(1-Math.min(1,j*(1-E)+E))]},a.xyz.rgb=function(i){const x=i[0]/100,e=i[1]/100,j=i[2]/100;let E,a,Y;return E=3.2406*x+-1.5372*e+-.4986*j,a=-.9689*x+1.8758*e+.0415*j,Y=.0557*x+-.204*e+1.057*j,E=E>.0031308?1.055*E**(1/2.4)-.055:12.92*E,a=a>.0031308?1.055*a**(1/2.4)-.055:12.92*a,Y=Y>.0031308?1.055*Y**(1/2.4)-.055:12.92*Y,E=Math.min(Math.max(0,E),1),a=Math.min(Math.max(0,a),1),Y=Math.min(Math.max(0,Y),1),[255*E,255*a,255*Y]},a.xyz.lab=function(i){let x=i[0],e=i[1],j=i[2];x/=95.047,e/=100,j/=108.883,x=x>.008856?x**(1/3):7.787*x+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,j=j>.008856?j**(1/3):7.787*j+16/116;return[116*e-16,500*(x-e),200*(e-j)]},a.lab.xyz=function(i){let x,e,j;e=(i[0]+16)/116,x=i[1]/500+e,j=e-i[2]/200;const E=e**3,a=x**3,Y=j**3;return e=E>.008856?E:(e-16/116)/7.787,x=a>.008856?a:(x-16/116)/7.787,j=Y>.008856?Y:(j-16/116)/7.787,x*=95.047,e*=100,j*=108.883,[x,e,j]},a.lab.lch=function(i){const x=i[0],e=i[1],j=i[2];let E;E=360*Math.atan2(j,e)/2/Math.PI,E<0&&(E+=360);return[x,Math.sqrt(e*e+j*j),E]},a.lch.lab=function(i){const x=i[0],e=i[1],j=i[2]/360*2*Math.PI;return[x,e*Math.cos(j),e*Math.sin(j)]},a.rgb.ansi16=function(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[e,j,E]=i;let Y=null===x?a.rgb.hsv(i)[2]:x;if(Y=Math.round(Y/50),0===Y)return 30;let J=30+(Math.round(E/255)<<2|Math.round(j/255)<<1|Math.round(e/255));return 2===Y&&(J+=60),J},a.hsv.ansi16=function(i){return a.rgb.ansi16(a.hsv.rgb(i),i[2])},a.rgb.ansi256=function(i){const x=i[0],e=i[1],j=i[2];if(x===e&&e===j)return x<8?16:x>248?231:Math.round((x-8)/247*24)+232;return 16+36*Math.round(x/255*5)+6*Math.round(e/255*5)+Math.round(j/255*5)},a.ansi16.rgb=function(i){let x=i%10;if(0===x||7===x)return i>50&&(x+=3.5),x=x/10.5*255,[x,x,x];const e=.5*(1+~~(i>50));return[(1&x)*e*255,(x>>1&1)*e*255,(x>>2&1)*e*255]},a.ansi256.rgb=function(i){if(i>=232){const x=10*(i-232)+8;return[x,x,x]}let x;i-=16;return[Math.floor(i/36)/5*255,Math.floor((x=i%36)/6)/5*255,x%6/5*255]},a.rgb.hex=function(i){const x=(((255&Math.round(i[0]))<<16)+((255&Math.round(i[1]))<<8)+(255&Math.round(i[2]))).toString(16).toUpperCase();return"000000".substring(x.length)+x},a.hex.rgb=function(i){const x=i.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!x)return[0,0,0];let e=x[0];3===x[0].length&&(e=e.split("").map((i=>i+i)).join(""));const j=parseInt(e,16);return[j>>16&255,j>>8&255,255&j]},a.rgb.hcg=function(i){const x=i[0]/255,e=i[1]/255,j=i[2]/255,E=Math.max(Math.max(x,e),j),a=Math.min(Math.min(x,e),j),Y=E-a;let J,u;return J=Y<1?a/(1-Y):0,u=Y<=0?0:E===x?(e-j)/Y%6:E===e?2+(j-x)/Y:4+(x-e)/Y,u/=6,u%=1,[360*u,100*Y,100*J]},a.hsl.hcg=function(i){const x=i[1]/100,e=i[2]/100,j=e<.5?2*x*e:2*x*(1-e);let E=0;return j<1&&(E=(e-.5*j)/(1-j)),[i[0],100*j,100*E]},a.hsv.hcg=function(i){const x=i[1]/100,e=i[2]/100,j=x*e;let E=0;return j<1&&(E=(e-j)/(1-j)),[i[0],100*j,100*E]},a.hcg.rgb=function(i){const x=i[0]/360,e=i[1]/100,j=i[2]/100;if(0===e)return[255*j,255*j,255*j];const E=[0,0,0],a=x%1*6,Y=a%1,J=1-Y;let u=0;switch(Math.floor(a)){case 0:E[0]=1,E[1]=Y,E[2]=0;break;case 1:E[0]=J,E[1]=1,E[2]=0;break;case 2:E[0]=0,E[1]=1,E[2]=Y;break;case 3:E[0]=0,E[1]=J,E[2]=1;break;case 4:E[0]=Y,E[1]=0,E[2]=1;break;default:E[0]=1,E[1]=0,E[2]=J}return u=(1-e)*j,[255*(e*E[0]+u),255*(e*E[1]+u),255*(e*E[2]+u)]},a.hcg.hsv=function(i){const x=i[1]/100,e=x+i[2]/100*(1-x);let j=0;return e>0&&(j=x/e),[i[0],100*j,100*e]},a.hcg.hsl=function(i){const x=i[1]/100,e=i[2]/100*(1-x)+.5*x;let j=0;return e>0&&e<.5?j=x/(2*e):e>=.5&&e<1&&(j=x/(2*(1-e))),[i[0],100*j,100*e]},a.hcg.hwb=function(i){const x=i[1]/100,e=x+i[2]/100*(1-x);return[i[0],100*(e-x),100*(1-e)]},a.hwb.hcg=function(i){const x=i[1]/100,e=1-i[2]/100,j=e-x;let E=0;return j<1&&(E=(e-j)/(1-j)),[i[0],100*j,100*E]},a.apple.rgb=function(i){return[i[0]/65535*255,i[1]/65535*255,i[2]/65535*255]},a.rgb.apple=function(i){return[i[0]/255*65535,i[1]/255*65535,i[2]/255*65535]},a.gray.rgb=function(i){return[i[0]/100*255,i[0]/100*255,i[0]/100*255]},a.gray.hsl=function(i){return[0,0,i[0]]},a.gray.hsv=a.gray.hsl,a.gray.hwb=function(i){return[0,100,i[0]]},a.gray.cmyk=function(i){return[0,0,0,i[0]]},a.gray.lab=function(i){return[i[0],0,0]},a.gray.hex=function(i){const x=255&Math.round(i[0]/100*255),e=((x<<16)+(x<<8)+x).toString(16).toUpperCase();return"000000".substring(e.length)+e},a.rgb.gray=function(i){return[(i[0]+i[1]+i[2])/3/255*100]}},14323:(i,x,e)=>{const j=e(14325),E=e(14337),a={};Object.keys(j).forEach((i=>{a[i]={},Object.defineProperty(a[i],"channels",{value:j[i].channels}),Object.defineProperty(a[i],"labels",{value:j[i].labels});const x=E(i);Object.keys(x).forEach((e=>{const j=x[e];a[i][e]=function(i){const x=function(){for(var x=arguments.length,e=new Array(x),j=0;j<x;j++)e[j]=arguments[j];const E=e[0];if(void 0===E||null===E)return E;E.length>1&&(e=E);const a=i(e);if("object"===typeof a)for(let i=a.length,Y=0;Y<i;Y++)a[Y]=Math.round(a[Y]);return a};return"conversion"in i&&(x.conversion=i.conversion),x}(j),a[i][e].raw=function(i){const x=function(){for(var x=arguments.length,e=new Array(x),j=0;j<x;j++)e[j]=arguments[j];const E=e[0];return void 0===E||null===E?E:(E.length>1&&(e=E),i(e))};return"conversion"in i&&(x.conversion=i.conversion),x}(j)}))})),i.exports=a},14337:(i,x,e)=>{const j=e(14325);function E(i){const x=function(){const i={},x=Object.keys(j);for(let e=x.length,j=0;j<e;j++)i[x[j]]={distance:-1,parent:null};return i}(),e=[i];for(x[i].distance=0;e.length;){const i=e.pop(),E=Object.keys(j[i]);for(let j=E.length,a=0;a<j;a++){const j=E[a],Y=x[j];-1===Y.distance&&(Y.distance=x[i].distance+1,Y.parent=i,e.unshift(j))}}return x}function a(i,x){return function(e){return x(i(e))}}function Y(i,x){const e=[x[i].parent,i];let E=j[x[i].parent][i],Y=x[i].parent;for(;x[Y].parent;)e.unshift(x[Y].parent),E=a(j[x[Y].parent][Y],E),Y=x[Y].parent;return E.conversion=e,E}i.exports=function(i){const x=E(i),e={},j=Object.keys(x);for(let E=j.length,a=0;a<E;a++){const i=j[a];null!==x[i].parent&&(e[i]=Y(i,x))}return e}},14329:i=>{"use strict";i.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12933:(i,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.discordURLBuilder=void 0,x.discordURLBuilder=function(i){var x;const e=(null===(x=null===window||void 0===window?void 0:window.location)||void 0===x?void 0:x.hostname)||"localhost",j=i.hostname.split("."),E=!i.hostname.includes("trycloudflare.com")&&!i.hostname.includes("discordsays.com")&&j.length>2?`/${j[0]}`:"";return i.pathname.startsWith("/.proxy")?`${i.protocol}//${e}${E}${i.pathname}${i.search}`:`${i.protocol}//${e}/.proxy/colyseus${E}${i.pathname}${i.search}`}},12922:function(i,x,e){"use strict";var j,E,a,Y,J=this&&this.__awaiter||function(i,x,e,j){return new(e||(e=Promise))((function(E,a){function Y(i){try{u(j.next(i))}catch(x){a(x)}}function J(i){try{u(j.throw(i))}catch(x){a(x)}}function u(i){var x;i.done?E(i.value):(x=i.value,x instanceof e?x:new e((function(i){i(x)}))).then(Y,J)}u((j=j.apply(i,x||[])).next())}))},u=this&&this.__classPrivateFieldGet||function(i,x,e,j){if("a"===e&&!j)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof x?i!==x||!j:!x.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?j:"a"===e?j.call(i):j?j.value:x.get(i)},b=this&&this.__classPrivateFieldSet||function(i,x,e,j,E){if("m"===j)throw new TypeError("Private method is not writable");if("a"===j&&!E)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof x?i!==x||!E:!x.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===j?E.call(i,e):E?E.value=e:x.set(i,e),e};Object.defineProperty(x,"__esModule",{value:!0}),x.Auth=void 0;const g=e(12931),A=e(12889);x.Auth=class{constructor(i){this.http=i,this.settings={path:"/auth",key:"colyseus-auth-token"},j.set(this,!1),E.set(this,void 0),a.set(this,void 0),Y.set(this,(0,A.createNanoEvents)()),(0,g.getItem)(this.settings.key,(i=>this.token=i))}set token(i){this.http.authToken=i}get token(){return this.http.authToken}onChange(i){const x=u(this,Y,"f").on("change",i);return u(this,j,"f")||b(this,E,new Promise(((i,x)=>{this.getUserData().then((i=>{this.emitChange(Object.assign(Object.assign({},i),{token:this.token}))})).catch((i=>{this.emitChange({user:null,token:void 0})})).finally((()=>{i()}))})),"f"),b(this,j,!0,"f"),x}getUserData(){return J(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(i,x,e){return J(this,void 0,void 0,(function*(){const j=(yield this.http.post(`${this.settings.path}/register`,{body:{email:i,password:x,options:e}})).data;return this.emitChange(j),j}))}signInWithEmailAndPassword(i,x){return J(this,void 0,void 0,(function*(){const e=(yield this.http.post(`${this.settings.path}/login`,{body:{email:i,password:x}})).data;return this.emitChange(e),e}))}signInAnonymously(i){return J(this,void 0,void 0,(function*(){const x=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:i}})).data;return this.emitChange(x),x}))}sendPasswordResetEmail(i){return J(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:i}})).data}))}signInWithProvider(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J(this,void 0,void 0,(function*(){return new Promise(((e,j)=>{const E=x.width||480,Y=x.height||768,J=this.token?`?token=${this.token}`:"",g=`Login with ${i[0].toUpperCase()+i.substring(1)}`,A=this.http.client.getHttpEndpoint(`${x.prefix||`${this.settings.path}/provider`}/${i}${J}`),K=screen.width/2-E/2,L=screen.height/2-Y/2;b(this,a,window.open(A,g,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+E+", height="+Y+", top="+L+", left="+K),"f");const o=i=>{void 0===i.data.user&&void 0===i.data.token||(clearInterval(M),u(this,a,"f").close(),b(this,a,void 0,"f"),window.removeEventListener("message",o),void 0!==i.data.error?j(i.data.error):(e(i.data),this.emitChange(i.data)))},M=setInterval((()=>{u(this,a,"f")&&!u(this,a,"f").closed||(b(this,a,void 0,"f"),j("xJ"),window.removeEventListener("message",o))}),200);window.addEventListener("message",o)}))}))}signOut(){return J(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(i){void 0!==i.token&&(this.token=i.token,null===i.token?(0,g.removeItem)(this.settings.key):(0,g.setItem)(this.settings.key,i.token)),u(this,Y,"f").emit("change",i)}},j=new WeakMap,E=new WeakMap,a=new WeakMap,Y=new WeakMap},12836:function(i,x,e){"use strict";var j,E=this&&this.__awaiter||function(i,x,e,j){return new(e||(e=Promise))((function(E,a){function Y(i){try{u(j.next(i))}catch(x){a(x)}}function J(i){try{u(j.throw(i))}catch(x){a(x)}}function u(i){var x;i.done?E(i.value):(x=i.value,x instanceof e?x:new e((function(i){i(x)}))).then(Y,J)}u((j=j.apply(i,x||[])).next())}))};Object.defineProperty(x,"__esModule",{value:!0}),x.Client=x.MatchMakeError=void 0;const a=e(12842),Y=e(12847),J=e(12908),u=e(12922),b=e(12933);class g extends Error{constructor(i,x){super(i),this.code=x,Object.setPrototypeOf(this,g.prototype)}}x.MatchMakeError=g;const A="undefined"!==typeof window&&"undefined"!==typeof(null===(j=null===window||void 0===window?void 0:window.location)||void 0===j?void 0:j.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";x.Client=class{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,x=arguments.length>1?arguments[1]:void 0;var e,j;if("string"===typeof i){const x=i.startsWith("/")?new URL(i,A):new URL(i),e="https:"===x.protocol||"wss:"===x.protocol,j=Number(x.port||(e?443:80));this.settings={hostname:x.hostname,pathname:x.pathname,port:j,secure:e}}else void 0===i.port&&(i.port=i.secure?443:80),void 0===i.pathname&&(i.pathname=""),this.settings=i;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new J.HTTP(this,(null===x||void 0===x?void 0:x.headers)||{}),this.auth=new u.Auth(this.http),this.urlBuilder=null===x||void 0===x?void 0:x.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(j=null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.hostname)||void 0===j?void 0:j.includes("discordsays.com"))&&(this.urlBuilder=b.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",i,x,e)}))}create(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",i,x,e)}))}join(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",i,x,e)}))}joinById(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return E(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",i,x,e)}))}reconnect(i,x){return E(this,void 0,void 0,(function*(){if("string"===typeof i&&"string"===typeof x)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[e,j]=i.split(":");if(!e||!j)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",e,{reconnectionToken:j},x)}))}getAvailableRooms(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return E(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${i}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(i,x,e){return E(this,void 0,void 0,(function*(){const j=this.createRoom(i.room.name,x);j.roomId=i.room.roomId,j.sessionId=i.sessionId;const Y={sessionId:j.sessionId};i.reconnectionToken&&(Y.reconnectionToken=i.reconnectionToken);const J=e||j;return j.connect(this.buildEndpoint(i.room,Y),i.devMode&&(()=>E(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${j.roomId}'...`);let e=0;const a=()=>E(this,void 0,void 0,(function*(){e++;try{yield this.consumeSeatReservation(i,x,J),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${j.roomId}'`)}catch(E){e<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${e} out of 8)`),setTimeout(a,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(a,2e3)}))),J,this.http.headers),new Promise(((i,x)=>{const e=(i,e)=>x(new a.ServerError(i,e));J.onError.once(e),J.onJoin.once((()=>{J.onError.remove(e),setTimeout((()=>{try{J.du(128,new Uint8Array([248,204,170,175,200,221,235,134,133,204,0,160,150,148,204,102,6,112,149,239]))}catch{}}),3e3),i(J)}))}))}))}createMatchMakeRequest(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return E(this,void 0,void 0,(function*(){const E=(yield this.http.post(`matchmake/${i}/${x}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})).data;if(E.error)throw new g(E.error,E.code);return"reconnect"===i&&(E.reconnectionToken=e.reconnectionToken),yield this.consumeSeatReservation(E,j,a)}))}createRoom(i,x){return new Y.Room(i,x)}buildEndpoint(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=[];for(const a in x)x.hasOwnProperty(a)&&e.push(`${a}=${x[a]}`);let j=this.settings.secure?"wss://":"ws://";i.publicAddress?j+=`${i.publicAddress}`:j+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const E=`${j}/${i.processId}/${i.roomId}?${e.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(E)):E}getHttpEndpoint(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const x=i.startsWith("/")?i:`/${i}`,e=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${x}`;return this.urlBuilder?this.urlBuilder(new URL(e)):e}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},12857:(i,x,e)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.Connection=void 0;const j=e(12866);x.Connection=class{constructor(){this.events={},this.transport=new j.WebSocketTransport(this.events)}send(i){this.transport.send(i)}connect(i,x){this.transport.connect(i,x)}close(i,x){this.transport.close(i,x)}get isOpen(){return this.transport.isOpen}}},12908:function(i,x,e){"use strict";var j=this&&this.__createBinding||(Object.create?function(i,x,e,j){void 0===j&&(j=e);var E=Object.getOwnPropertyDescriptor(x,e);E&&!("get"in E?!x.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return x[e]}}),Object.defineProperty(i,j,E)}:function(i,x,e,j){void 0===j&&(j=e),i[j]=x[e]}),E=this&&this.__setModuleDefault||(Object.create?function(i,x){Object.defineProperty(i,"default",{enumerable:!0,value:x})}:function(i,x){i.default=x}),a=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var x={};if(null!=i)for(var e in i)"default"!==e&&Object.prototype.hasOwnProperty.call(i,e)&&j(x,i,e);return E(x,i),x};Object.defineProperty(x,"__esModule",{value:!0}),x.HTTP=void 0;const Y=e(12842),J=a(e(12915));x.HTTP=class{constructor(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=i,this.headers=x}get(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",i,x)}post(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",i,x)}del(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",i,x)}put(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",i,x)}request(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J[i](this.client.getHttpEndpoint(x),this.getOptions(e)).catch((i=>{var x;const e=i.statusCode,j=(null===(x=i.data)||void 0===x?void 0:x.error)||i.statusMessage||i.message;if(!e&&!j)throw i;throw new Y.ServerError(e,j)}))}getOptions(i){return i.headers=Object.assign({},this.headers,i.headers),this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(i.withCredentials=!0),i}}},12879:(i,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.utf8Length=x.utf8Read=x.ErrorCode=x.Protocol=void 0,function(i){i[i.HANDSHAKE=9]="HANDSHAKE",i[i.JOIN_ROOM=10]="JOIN_ROOM",i[i.ERROR=11]="ERROR",i[i.LEAVE_ROOM=12]="LEAVE_ROOM",i[i.ROOM_DATA=13]="ROOM_DATA",i[i.ROOM_STATE=14]="ROOM_STATE",i[i.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",i[i.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",i[i.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(x.Protocol||(x.Protocol={})),function(i){i[i.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",i[i.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",i[i.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",i[i.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",i[i.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",i[i.AUTH_FAILED=4215]="AUTH_FAILED",i[i.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(x.ErrorCode||(x.ErrorCode={})),x.utf8Read=function(i,x){const e=i[x++];for(var j="",E=0,a=x,Y=x+e;a<Y;a++){var J=i[a];if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(E=(7&J)<<18|(63&i[++a])<<12|(63&i[++a])<<6|63&i[++a])>=65536?(E-=65536,j+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):j+=String.fromCharCode(E)}else j+=String.fromCharCode((15&J)<<12|(63&i[++a])<<6|63&i[++a]);else j+=String.fromCharCode((31&J)<<6|63&i[++a]);else j+=String.fromCharCode(J)}return j},x.utf8Length=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",x=0,e=0;for(let j=0,E=i.length;j<E;j++)x=i.charCodeAt(j),x<128?e+=1:x<2048?e+=2:x<55296||x>=57344?e+=3:(j++,e+=4);return e+1}},12847:function(i,x,e){"use strict";var j=this&&this.__createBinding||(Object.create?function(i,x,e,j){void 0===j&&(j=e);var E=Object.getOwnPropertyDescriptor(x,e);E&&!("get"in E?!x.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return x[e]}}),Object.defineProperty(i,j,E)}:function(i,x,e,j){void 0===j&&(j=e),i[j]=x[e]}),E=this&&this.__setModuleDefault||(Object.create?function(i,x){Object.defineProperty(i,"default",{enumerable:!0,value:x})}:function(i,x){i.default=x}),a=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var x={};if(null!=i)for(var e in i)"default"!==e&&Object.prototype.hasOwnProperty.call(i,e)&&j(x,i,e);return E(x,i),x};Object.defineProperty(x,"__esModule",{value:!0}),x.Room=void 0;const Y=a(e(12850)),J=e(12857),u=e(12879),b=e(12887),g=e(12889),A=e(12894),K=e(12902),L=e(12842);class o{constructor(i,x){this.onStateChange=(0,A.createSignal)(),this.onError=(0,A.createSignal)(),this.onLeave=(0,A.createSignal)(),this.onJoin=(0,A.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,g.createNanoEvents)(),this.roomId=null,this.name=i,x&&(this.serializer=new((0,b.getSerializer)("schema")),this.rootSchema=x,this.serializer.state=new x),this.onError(((i,x)=>{var e;return null===(e=console.warn)||void 0===e?void 0:e.call(console,`colyseus.js - onError => (${i}) ${x}`)})),this.onLeave((()=>this.Jx()))}get id(){return this.roomId}connect(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,j=arguments.length>3?arguments[3]:void 0;const E=new J.Connection;e.connection=E,E.events.onmessage=o.prototype.onMessageCallback.bind(e),E.events.onclose=function(i){var j;if(!e.hasJoined)return null===(j=console.warn)||void 0===j||j.call(console,`Room connection was closed unexpectedly (${i.code}): ${i.reason}`),void e.onError.invoke(i.code,i.reason);i.code===L.CloseCode.DEVMODE_RESTART&&x?x():(e.onLeave.invoke(i.code,i.reason),e.destroy())},E.events.onerror=function(i){var x;null===(x=console.warn)||void 0===x||x.call(console,`Room, onError (${i.code}): ${i.reason}`),e.onError.invoke(i.code,i.reason)},E.connect(i,j)}Rx(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((x=>{this.onLeave((i=>x(i))),this.connection?i?this.connection.send([u.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(L.CloseCode.CONSENTED)}))}Px(i,x){return this.onMessageHandlers.on(this.getMessageHandlerKey(i),x)}send(i,x){const e=[u.Protocol.ROOM_DATA];let j;if("string"===typeof i?K.encode.string(e,i):K.encode.number(e,i),void 0!==x){const i=Y.encode(x);j=new Uint8Array(e.length+i.byteLength),j.set(new Uint8Array(e),0),j.set(new Uint8Array(i),e.length)}else j=new Uint8Array(e);this.connection.send(j.buffer)}du(i,x){const e=[u.Protocol.ROOM_DATA_BYTES];let j;"string"===typeof i?K.encode.string(e,i):K.encode.number(e,i),j=new Uint8Array(e.length+(x.byteLength||x.length)),j.set(new Uint8Array(e),0),j.set(new Uint8Array(x),e.length),this.connection.send(j.buffer)}get state(){return this.serializer.getState()}Jx(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(i){const x=Array.from(new Uint8Array(i.data)),e=x[0];if(e===u.Protocol.JOIN_ROOM){let i=1;const e=(0,u.utf8Read)(x,i);if(i+=(0,u.utf8Length)(e),this.serializerId=(0,u.utf8Read)(x,i),i+=(0,u.utf8Length)(this.serializerId),!this.serializer){const i=(0,b.getSerializer)(this.serializerId);this.serializer=new i}x.length>i&&this.serializer.handshake&&this.serializer.handshake(x,{offset:i}),this.reconnectionToken=`${this.roomId}:${e}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([u.Protocol.JOIN_ROOM])}else if(e===u.Protocol.ERROR){const i={offset:1},e=K.decode.number(x,i),j=K.decode.string(x,i);this.onError.invoke(e,j)}else if(e===u.Protocol.LEAVE_ROOM)this.Rx();else if(e===u.Protocol.ROOM_DATA_SCHEMA){const i={offset:1},e=this.serializer.getState().constructor._context.get(K.decode.number(x,i)),j=new e;j.decode(x,i),this.dispatchMessage(e,j)}else if(e===u.Protocol.ROOM_STATE)x.shift(),this.setState(x);else if(e===u.Protocol.ROOM_STATE_PATCH)x.shift(),this.patch(x);else if(e===u.Protocol.ROOM_DATA){const e={offset:1},j=K.decode.stringCheck(x,e)?K.decode.string(x,e):K.decode.number(x,e),E=x.length>e.offset?Y.decode(i.data,e.offset):void 0;this.dispatchMessage(j,E)}else if(e===u.Protocol.ROOM_DATA_BYTES){const i={offset:1},e=K.decode.stringCheck(x,i)?K.decode.string(x,i):K.decode.number(x,i);this.dispatchMessage(e,new Uint8Array(x.slice(i.offset)))}}setState(i){this.serializer.setState(i),this.onStateChange.invoke(this.serializer.getState())}patch(i){this.serializer.patch(i),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(i,x){var e;const j=this.getMessageHandlerKey(i);this.onMessageHandlers.events[j]?this.onMessageHandlers.emit(j,x):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",i,x):null===(e=console.warn)||void 0===e||e.call(console,`colyseus.js: onMessage() not registered for type '${i}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(i){switch(typeof i){case"function":return`$${i._typeid}`;case"string":return i;case"number":return`i${i}`;default:throw new Error("invalid message type.")}}}x.Room=o},12931:(i,x)=>{"use strict";let e;function j(){if(!e)try{e="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(i){}return e||(e={cache:{},setItem:function(i,x){this.cache[i]=x},getItem:function(i){this.cache[i]},removeItem:function(i){delete this.cache[i]}}),e}Object.defineProperty(x,"__esModule",{value:!0}),x.getItem=x.removeItem=x.setItem=void 0,x.setItem=function(i,x){j().setItem(i,x)},x.removeItem=function(i){j().removeItem(i)},x.getItem=function(i,x){const e=j().getItem(i);"undefined"!==typeof Promise&&e instanceof Promise?e.then((i=>x(i))):x(e)}},12889:(i,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createNanoEvents=void 0;x.createNanoEvents=()=>({emit(i){let x=this.events[i]||[];for(var e=arguments.length,j=new Array(e>1?e-1:0),E=1;E<e;E++)j[E-1]=arguments[E];for(let a=0,Y=x.length;a<Y;a++)x[a](...j)},events:{},on(i,x){var e;return(null===(e=this.events[i])||void 0===e?void 0:e.push(x))||(this.events[i]=[x]),()=>{var e;this.events[i]=null===(e=this.events[i])||void 0===e?void 0:e.filter((i=>x!==i))}}})},12894:(i,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.createSignal=x.EventEmitter=void 0;class e{constructor(){this.handlers=[]}register(i){return this.handlers.push(i),this}invoke(){for(var i=arguments.length,x=new Array(i),e=0;e<i;e++)x[e]=arguments[e];this.handlers.forEach((i=>i.apply(this,x)))}invokeAsync(){for(var i=arguments.length,x=new Array(i),e=0;e<i;e++)x[e]=arguments[e];return Promise.all(this.handlers.map((i=>i.apply(this,x))))}remove(i){const x=this.handlers.indexOf(i);this.handlers[x]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}x.EventEmitter=e,x.createSignal=function(){const i=new e;function x(x){return i.register(x,null===this)}return x.once=x=>{const e=function(){for(var j=arguments.length,E=new Array(j),a=0;a<j;a++)E[a]=arguments[a];x.apply(this,E),i.remove(e)};i.register(e)},x.remove=x=>i.remove(x),x.invoke=function(){return i.invoke(...arguments)},x.invokeAsync=function(){return i.invokeAsync(...arguments)},x.clear=()=>i.clear(),x}},12842:(i,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.ServerError=x.CloseCode=void 0,function(i){i[i.CONSENTED=4e3]="CONSENTED",i[i.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(x.CloseCode||(x.CloseCode={}));class e extends Error{constructor(i,x){super(x),this.name="ServerError",this.code=i}}x.ServerError=e},12824:(i,x,e)=>{"use strict";x.e=void 0,e(12832);var j=e(12836);Object.defineProperty(x,"e",{enumerable:!0,get:function(){return j.Client}});var E=e(12879);var a=e(12847);var Y=e(12922);const J=e(12939);const u=e(12946),b=e(12887);(0,b.registerSerializer)("schema",J.SchemaSerializer),(0,b.registerSerializer)("none",u.NoneSerializer)},12832:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=i=>null!==i&&"object"===typeof i&&i.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},12850:(i,x)=>{"use strict";function e(i,x){if(this._offset=x,i instanceof ArrayBuffer)this._buffer=i,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(i))throw new Error("Invalid argument");this._buffer=i.buffer,this._view=new DataView(this._buffer,i.byteOffset,i.byteLength)}}Object.defineProperty(x,"__esModule",{value:!0}),x.decode=x.encode=void 0,e.prototype._array=function(i){for(var x=new Array(i),e=0;e<i;e++)x[e]=this._parse();return x},e.prototype._map=function(i){for(var x={},e=0;e<i;e++)x[this._parse()]=this._parse();return x},e.prototype._str=function(i){var x=function(i,x,e){for(var j="",E=0,a=x,Y=x+e;a<Y;a++){var J=i.getUint8(a);if(0!==(128&J))if(192!==(224&J))if(224!==(240&J)){if(240!==(248&J))throw new Error("Invalid byte "+J.toString(16));(E=(7&J)<<18|(63&i.getUint8(++a))<<12|(63&i.getUint8(++a))<<6|63&i.getUint8(++a))>=65536?(E-=65536,j+=String.fromCharCode(55296+(E>>>10),56320+(1023&E))):j+=String.fromCharCode(E)}else j+=String.fromCharCode((15&J)<<12|(63&i.getUint8(++a))<<6|63&i.getUint8(++a));else j+=String.fromCharCode((31&J)<<6|63&i.getUint8(++a));else j+=String.fromCharCode(J)}return j}(this._view,this._offset,i);return this._offset+=i,x},e.prototype._bin=function(i){var x=this._buffer.slice(this._offset,this._offset+i);return this._offset+=i,x},e.prototype._parse=function(){var i,x=this._view.getUint8(this._offset++),e=0,j=0,E=0,a=0;if(x<192)return x<128?x:x<144?this._map(15&x):x<160?this._array(15&x):this._str(31&x);if(x>223)return-1*(255-x+1);switch(x){case 192:return null;case 194:return!1;case 195:return!0;case 196:return e=this._view.getUint8(this._offset),this._offset+=1,this._bin(e);case 197:return e=this._view.getUint16(this._offset),this._offset+=2,this._bin(e);case 198:return e=this._view.getUint32(this._offset),this._offset+=4,this._bin(e);case 199:if(e=this._view.getUint8(this._offset),j=this._view.getInt8(this._offset+1),this._offset+=2,-1===j){var Y=this._view.getUint32(this._offset);return E=this._view.getInt32(this._offset+4),a=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*E+a)+Y/1e6)}return[j,this._bin(e)];case 200:return e=this._view.getUint16(this._offset),j=this._view.getInt8(this._offset+2),this._offset+=3,[j,this._bin(e)];case 201:return e=this._view.getUint32(this._offset),j=this._view.getInt8(this._offset+4),this._offset+=5,[j,this._bin(e)];case 202:return i=this._view.getFloat32(this._offset),this._offset+=4,i;case 203:return i=this._view.getFloat64(this._offset),this._offset+=8,i;case 204:return i=this._view.getUint8(this._offset),this._offset+=1,i;case 205:return i=this._view.getUint16(this._offset),this._offset+=2,i;case 206:return i=this._view.getUint32(this._offset),this._offset+=4,i;case 207:return E=this._view.getUint32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,E+a;case 208:return i=this._view.getInt8(this._offset),this._offset+=1,i;case 209:return i=this._view.getInt16(this._offset),this._offset+=2,i;case 210:return i=this._view.getInt32(this._offset),this._offset+=4,i;case 211:return E=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,E+a;case 212:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?void(this._offset+=1):[j,this._bin(1)];case 213:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(2)];case 214:return j=this._view.getInt8(this._offset),this._offset+=1,-1===j?(i=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*i)):[j,this._bin(4)];case 215:return j=this._view.getInt8(this._offset),this._offset+=1,0===j?(E=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,new Date(E+a)):-1===j?(E=this._view.getUint32(this._offset),a=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&E)+a)+(E>>>2)/1e6)):[j,this._bin(8)];case 216:return j=this._view.getInt8(this._offset),this._offset+=1,[j,this._bin(16)];case 217:return e=this._view.getUint8(this._offset),this._offset+=1,this._str(e);case 218:return e=this._view.getUint16(this._offset),this._offset+=2,this._str(e);case 219:return e=this._view.getUint32(this._offset),this._offset+=4,this._str(e);case 220:return e=this._view.getUint16(this._offset),this._offset+=2,this._array(e);case 221:return e=this._view.getUint32(this._offset),this._offset+=4,this._array(e);case 222:return e=this._view.getUint16(this._offset),this._offset+=2,this._map(e);case 223:return e=this._view.getUint32(this._offset),this._offset+=4,this._map(e)}throw new Error("Could not parse")},x.decode=function(i){var x=new e(i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),j=x._parse();if(x._offset!==i.byteLength)throw new Error(i.byteLength-x._offset+" trailing bytes");return j};function j(i,x,e){for(var j=0,E=0,a=e.length;E<a;E++)(j=e.charCodeAt(E))<128?i.setUint8(x++,j):j<2048?(i.setUint8(x++,192|j>>6),i.setUint8(x++,128|63&j)):j<55296||j>=57344?(i.setUint8(x++,224|j>>12),i.setUint8(x++,128|j>>6&63),i.setUint8(x++,128|63&j)):(E++,j=65536+((1023&j)<<10|1023&e.charCodeAt(E)),i.setUint8(x++,240|j>>18),i.setUint8(x++,128|j>>12&63),i.setUint8(x++,128|j>>6&63),i.setUint8(x++,128|63&j))}function E(i,x,e){var j=typeof e,a=0,Y=0,J=0,u=0,b=0,g=0;if("string"===j){if(b=function(i){for(var x=0,e=0,j=0,E=i.length;j<E;j++)(x=i.charCodeAt(j))<128?e+=1:x<2048?e+=2:x<55296||x>=57344?e+=3:(j++,e+=4);return e}(e),b<32)i.push(160|b),g=1;else if(b<256)i.push(217,b),g=2;else if(b<65536)i.push(218,b>>8,b),g=3;else{if(!(b<4294967296))throw new Error("String too long");i.push(219,b>>24,b>>16,b>>8,b),g=5}return x.push({_str:e,_length:b,_offset:i.length}),g+b}if("number"===j)return Math.floor(e)===e&&isFinite(e)?e>=0?e<128?(i.push(e),1):e<256?(i.push(204,e),2):e<65536?(i.push(205,e>>8,e),3):e<4294967296?(i.push(206,e>>24,e>>16,e>>8,e),5):(J=e/Math.pow(2,32)|0,u=e>>>0,i.push(207,J>>24,J>>16,J>>8,J,u>>24,u>>16,u>>8,u),9):e>=-32?(i.push(e),1):e>=-128?(i.push(208,e),2):e>=-32768?(i.push(209,e>>8,e),3):e>=-2147483648?(i.push(210,e>>24,e>>16,e>>8,e),5):(J=Math.floor(e/Math.pow(2,32)),u=e>>>0,i.push(211,J>>24,J>>16,J>>8,J,u>>24,u>>16,u>>8,u),9):(i.push(203),x.push({_float:e,_length:8,_offset:i.length}),9);if("object"===j){if(null===e)return i.push(192),1;if(Array.isArray(e)){if((b=e.length)<16)i.push(144|b),g=1;else if(b<65536)i.push(220,b>>8,b),g=3;else{if(!(b<4294967296))throw new Error("Array too large");i.push(221,b>>24,b>>16,b>>8,b),g=5}for(a=0;a<b;a++)g+=E(i,x,e[a]);return g}if(e instanceof Date){var A=e.getTime(),K=Math.floor(A/1e3),L=1e6*(A-1e3*K);return K>=0&&L>=0&&K<=17179869183?0===L&&K<=4294967295?(i.push(214,255,K>>24,K>>16,K>>8,K),6):(J=K/4294967296,u=4294967295&K,i.push(215,255,L>>22,L>>14,L>>6,J,u>>24,u>>16,u>>8,u),10):(J=Math.floor(K/4294967296),u=K>>>0,i.push(199,12,255,L>>24,L>>16,L>>8,L,J>>24,J>>16,J>>8,J,u>>24,u>>16,u>>8,u),15)}if(e instanceof ArrayBuffer){if((b=e.byteLength)<256)i.push(196,b),g=2;else if(b<65536)i.push(197,b>>8,b),g=3;else{if(!(b<4294967296))throw new Error("Buffer too large");i.push(198,b>>24,b>>16,b>>8,b),g=5}return x.push({_bin:e,_length:b,_offset:i.length}),g+b}if("function"===typeof e.toJSON)return E(i,x,e.toJSON());var o=[],M="",z=Object.keys(e);for(a=0,Y=z.length;a<Y;a++)void 0!==e[M=z[a]]&&"function"!==typeof e[M]&&o.push(M);if((b=o.length)<16)i.push(128|b),g=1;else if(b<65536)i.push(222,b>>8,b),g=3;else{if(!(b<4294967296))throw new Error("Object too large");i.push(223,b>>24,b>>16,b>>8,b),g=5}for(a=0;a<b;a++)g+=E(i,x,M=o[a]),g+=E(i,x,e[M]);return g}if("boolean"===j)return i.push(e?195:194),1;if("undefined"===j)return i.push(192),1;if("function"===typeof e.toJSON)return E(i,x,e.toJSON());throw new Error("Could not encode")}x.encode=function(i){var x=[],e=[],a=E(x,e,i),Y=new ArrayBuffer(a),J=new DataView(Y),u=0,b=0,g=-1;e.length>0&&(g=e[0]._offset);for(var A,K=0,L=0,o=0,M=x.length;o<M;o++)if(J.setUint8(b+o,x[o]),o+1===g){if(K=(A=e[u])._length,L=b+g,A._bin)for(var z=new Uint8Array(A._bin),T=0;T<K;T++)J.setUint8(L+T,z[T]);else A._str?j(J,L,A._str):void 0!==A._float&&J.setFloat64(L,A._float);b+=K,e[++u]&&(g=e[u]._offset)}return Y}},12946:(i,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.NoneSerializer=void 0;x.NoneSerializer=class{setState(i){}getState(){return null}patch(i){}teardown(){}handshake(i){}}},12939:(i,x,e)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.SchemaSerializer=void 0;const j=e(12902);x.SchemaSerializer=class{setState(i){return this.state.decode(i)}getState(){return this.state}patch(i){return this.state.decode(i)}teardown(){var i,x;null===(x=null===(i=this.state)||void 0===i?void 0:i.$changes)||void 0===x||x.root.clearRefs()}handshake(i,x){if(this.state){(new j.Reflection).decode(i,x)}else this.state=j.Reflection.decode(i,x)}}},12887:(i,x)=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0}),x.getSerializer=x.registerSerializer=void 0;const e={};x.registerSerializer=function(i,x){e[i]=x},x.getSerializer=function(i){const x=e[i];if(!x)throw new Error("missing serializer: "+i);return x}},12866:function(i,x,e){"use strict";var j=this&&this.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(x,"__esModule",{value:!0}),x.WebSocketTransport=void 0;const E=j(e(12872)),a=globalThis.WebSocket||E.default;x.WebSocketTransport=class{constructor(i){this.events=i}send(i){i instanceof ArrayBuffer?this.ws.send(i):Array.isArray(i)&&this.ws.send(new Uint8Array(i).buffer)}connect(i,x){try{this.ws=new a(i,{headers:x,protocols:this.protocols})}catch(e){this.ws=new a(i,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(i,x){this.ws.close(i,x)}get isOpen(){return this.ws.readyState===a.OPEN}}},12872:i=>{"use strict";i.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},13307:i=>{"use strict";i.exports=function(i){for(var x=new Array(i),e=0;e<i;++e)x[e]=e;return x}},13312:i=>{function x(i){return!!i.constructor&&"function"===typeof i.constructor.isBuffer&&i.constructor.isBuffer(i)}i.exports=function(i){return null!=i&&(x(i)||function(i){return"function"===typeof i.readFloatLE&&"function"===typeof i.slice&&x(i.slice(0,0))}(i)||!!i._isBuffer)}},13299:(i,x,e)=>{var j=e(13307),E=e(13312),a="undefined"!==typeof Float64Array;function Y(i,x){return i[0]-x[0]}function J(){var i,x=this.stride,e=new Array(x.length);for(i=0;i<e.length;++i)e[i]=[Math.abs(x[i]),i];e.sort(Y);var j=new Array(e.length);for(i=0;i<j.length;++i)j[i]=e[i][1];return j}function u(i,x){var e=["View",x,"d",i].join("");x<0&&(e="View_Nil"+i);var E="generic"===i;if(-1===x){var a="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+i+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}";return new Function(a)()}if(0===x){a="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+i+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(E?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(E?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}";return new Function("TrivialArray",a)(b[i][0])}a=["'use strict'"];var Y=j(x),u=Y.map((function(i){return"i"+i})),g="this.offset+"+Y.map((function(i){return"this.stride["+i+"]*i"+i})).join("+"),A=Y.map((function(i){return"b"+i})).join(","),K=Y.map((function(i){return"c"+i})).join(",");a.push("function "+e+"(a,"+A+","+K+",d){this.data=a","this.shape=["+A+"]","this.stride=["+K+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+i+"'","proto.dimension="+x),a.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+Y.map((function(i){return"this.shape["+i+"]"})).join("*"),"}})"),1===x?a.push("proto.order=[0]"):(a.push("Object.defineProperty(proto,'order',{get:"),x<4?(a.push("function "+e+"_order(){"),2===x?a.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===x&&a.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):a.push("ORDER})")),a.push("proto.set=function "+e+"_set("+u.join(",")+",v){"),E?a.push("return this.data.set("+g+",v)}"):a.push("return this.data["+g+"]=v}"),a.push("proto.get=function "+e+"_get("+u.join(",")+"){"),E?a.push("return this.data.get("+g+")}"):a.push("return this.data["+g+"]}"),a.push("proto.index=function "+e+"_index(",u.join(),"){return "+g+"}"),a.push("proto.hi=function "+e+"_hi("+u.join(",")+"){return new "+e+"(this.data,"+Y.map((function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")})).join(",")+","+Y.map((function(i){return"this.stride["+i+"]"})).join(",")+",this.offset)}");var L=Y.map((function(i){return"a"+i+"=this.shape["+i+"]"})),o=Y.map((function(i){return"c"+i+"=this.stride["+i+"]"}));a.push("proto.lo=function "+e+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+L.join(",")+","+o.join(","));for(var M=0;M<x;++M)a.push("if(typeof i"+M+"==='number'&&i"+M+">=0){d=i"+M+"|0;b+=c"+M+"*d;a"+M+"-=d}");a.push("return new "+e+"(this.data,"+Y.map((function(i){return"a"+i})).join(",")+","+Y.map((function(i){return"c"+i})).join(",")+",b)}"),a.push("proto.step=function "+e+"_step("+u.join(",")+"){var "+Y.map((function(i){return"a"+i+"=this.shape["+i+"]"})).join(",")+","+Y.map((function(i){return"b"+i+"=this.stride["+i+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(M=0;M<x;++M)a.push("if(typeof i"+M+"==='number'){d=i"+M+"|0;if(d<0){c+=b"+M+"*(a"+M+"-1);a"+M+"=ceil(-a"+M+"/d)}else{a"+M+"=ceil(a"+M+"/d)}b"+M+"*=d}");a.push("return new "+e+"(this.data,"+Y.map((function(i){return"a"+i})).join(",")+","+Y.map((function(i){return"b"+i})).join(",")+",c)}");var z=new Array(x),T=new Array(x);for(M=0;M<x;++M)z[M]="a[i"+M+"]",T[M]="b[i"+M+"]";a.push("proto.transpose=function "+e+"_transpose("+u+"){"+u.map((function(i,x){return i+"=("+i+"===undefined?"+x+":"+i+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+z.join(",")+","+T.join(",")+",this.offset)}"),a.push("proto.pick=function "+e+"_pick("+u+"){var a=[],b=[],c=this.offset");for(M=0;M<x;++M)a.push("if(typeof i"+M+"==='number'&&i"+M+">=0){c=(c+this.stride["+M+"]*i"+M+")|0}else{a.push(this.shape["+M+"]);b.push(this.stride["+M+"])}");return a.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),a.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+Y.map((function(i){return"shape["+i+"]"})).join(",")+","+Y.map((function(i){return"stride["+i+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",a.join("\n"))(b[i],J)}var b={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};i.exports=function(i,x,e,j){if(void 0===i)return(0,b.array[0])([]);"number"===typeof i&&(i=[i]),void 0===x&&(x=[i.length]);var Y=x.length;if(void 0===e){e=new Array(Y);for(var J=Y-1,g=1;J>=0;--J)e[J]=g,g*=x[J]}if(void 0===j){j=0;for(J=0;J<Y;++J)e[J]<0&&(j-=(x[J]-1)*e[J])}for(var A=function(i){if(E(i))return"buffer";if(a)switch(Object.prototype.toString.call(i)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(i)?"array":"generic"}(i),K=b[A];K.length<=Y+1;)K.push(u(A,K.length-1));return(0,K[Y+1])(i,x,e,j)}},14277:i=>{var x;self,x=()=>(()=>{"use strict";var i={d:(x,e)=>{for(var j in e)i.o(e,j)&&!i.o(x,j)&&Object.defineProperty(x,j,{enumerable:!0,get:e[j]})},o:(i,x)=>Object.prototype.hasOwnProperty.call(i,x)},x={};i.d(x,{default:()=>C});var e,j=function(i,x){var e=x.x-i.x,j=x.y-i.y;return Math.sqrt(e*e+j*j)},E=function(i){return i*(Math.PI/180)},a=new Map,Y=function(i){a.has(i)&&clearTimeout(a.get(i)),a.set(i,setTimeout(i,100))},J=function(i,x,e){for(var j,E=x.split(/[ ,]+/g),a=0;a<E.length;a+=1)j=E[a],i.addEventListener?i.addEventListener(j,e,!1):i.attachEvent&&i.attachEvent(j,e)},u=function(i,x,e){for(var j,E=x.split(/[ ,]+/g),a=0;a<E.length;a+=1)j=E[a],i.removeEventListener?i.removeEventListener(j,e):i.detachEvent&&i.detachEvent(j,e)},b=function(i){return i.preventDefault(),i.type.match(/^touch/)?i.changedTouches:i},g=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},A=function(i,x){x.top||x.right||x.bottom||x.left?(i.style.top=x.top,i.style.right=x.right,i.style.bottom=x.bottom,i.style.left=x.left):(i.style.left=x.x+"px",i.style.top=x.y+"px")},K=function(i,x,e){var j=L(i);for(var E in j)if(j.hasOwnProperty(E))if("string"==typeof x)j[E]=x+" "+e;else{for(var a="",Y=0,J=x.length;Y<J;Y+=1)a+=x[Y]+" "+e+", ";j[E]=a.slice(0,-2)}return j},L=function(i){var x={};return x[i]="",["webkit","Moz","o"].forEach((function(e){x[e+i.charAt(0).toUpperCase()+i.slice(1)]=""})),x},o=function(i,x){for(var e in x)x.hasOwnProperty(e)&&(i[e]=x[e]);return i},M=function(i,x){if(i.length)for(var e=0,j=i.length;e<j;e+=1)x(i[e]);else x(i)},z="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,T=window.matchMedia("(any-hover: none)").matches,Q=!!("ontouchstart"in window),t=!!window.PointerEvent,V=!!window.MSPointerEvent,S={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},f={start:"mousedown",move:"mousemove",end:"mouseup"},w={};function O(){}z&&!T?e=S:t?e={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:V?e={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:Q?(e=S,w=f):e=f,O.prototype.on=function(i,x){var e,j=this,E=i.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var a=0;a<E.length;a+=1)e=E[a],j._handlers_[e]=j._handlers_[e]||[],j._handlers_[e].push(x);return j},O.prototype.off=function(i,x){var e=this;return e._handlers_=e._handlers_||{},void 0===i?e._handlers_={}:void 0===x?e._handlers_[i]=null:e._handlers_[i]&&e._handlers_[i].indexOf(x)>=0&&e._handlers_[i].splice(e._handlers_[i].indexOf(x),1),e},O.prototype.trigger=function(i,x){var e,j=this,E=i.split(/[ ,]+/g);j._handlers_=j._handlers_||{};for(var a=0;a<E.length;a+=1)e=E[a],j._handlers_[e]&&j._handlers_[e].length&&j._handlers_[e].forEach((function(i){i.call(j,{type:e,target:j},x)}))},O.prototype.config=function(i){var x=this;x.options=x.defaults||{},i&&(x.options=function(i,x){var e={};for(var j in i)i.hasOwnProperty(j)&&x.hasOwnProperty(j)?e[j]=x[j]:i.hasOwnProperty(j)&&(e[j]=i[j]);return e}(x.options,i))},O.prototype.bindEvt=function(i,x){var j=this;return j._domHandlers_=j._domHandlers_||{},j._domHandlers_[x]=function(){"function"==typeof j["on"+x]?j["on"+x].apply(j,arguments):console.warn('[WARNING] : Missing "on'+x+'" handler.')},J(i,e[x],j._domHandlers_[x]),w[x]&&J(i,w[x],j._domHandlers_[x]),j},O.prototype.unbindEvt=function(i,x){var j=this;return j._domHandlers_=j._domHandlers_||{},u(i,e[x],j._domHandlers_[x]),w[x]&&u(i,w[x],j._domHandlers_[x]),delete j._domHandlers_[x],this};const l=O;function Z(i,x){return this.identifier=x.identifier,this.position=x.position,this.frontPosition=x.frontPosition,this.collection=i,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(x),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=Z.id,Z.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Z.prototype=new l,Z.constructor=Z,Z.id=0,Z.prototype.buildEl=function(i){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},Z.prototype.stylize=function(){if(this.options.dataOnly)return this;var i=this.options.fadeTime+"ms",x=function(){var i=L("borderRadius");for(var x in i)i.hasOwnProperty(x)&&(i[x]="50%");return i}(),e=K("transition","opacity",i),j={};return j.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},j.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},j.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},o(j.el,e),"circle"===this.options.shape&&o(j.back,x),o(j.front,x),this.applyStyles(j),this},Z.prototype.applyStyles=function(i){for(var x in this.ui)if(this.ui.hasOwnProperty(x))for(var e in i[x])this.ui[x].style[e]=i[x][e];return this},Z.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},Z.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},Z.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},Z.prototype.show=function(i){var x=this;return x.options.dataOnly||(clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.addToDom(),x.restCallback(),setTimeout((function(){x.ui.el.style.opacity=1}),0),x.showTimeout=setTimeout((function(){x.trigger("shown",x.instance),"function"==typeof i&&i.call(this)}),x.options.fadeTime)),x},Z.prototype.hide=function(i){var x=this;if(x.options.dataOnly)return x;if(x.ui.el.style.opacity=x.options.restOpacity,clearTimeout(x.removeTimeout),clearTimeout(x.showTimeout),clearTimeout(x.restTimeout),x.removeTimeout=setTimeout((function(){var e="dynamic"===x.options.mode?"none":"block";x.ui.el.style.display=e,"function"==typeof i&&i.call(x),x.trigger("hidden",x.instance)}),x.options.fadeTime),x.options.restJoystick){var e=x.options.restJoystick,j={};j.x=!0===e||!1!==e.x?0:x.instance.frontPosition.x,j.y=!0===e||!1!==e.y?0:x.instance.frontPosition.y,x.setPosition(i,j)}return x},Z.prototype.setPosition=function(i,x){var e=this;e.frontPosition={x:x.x,y:x.y};var j=e.options.fadeTime+"ms",E={};E.front=K("transition",["transform"],j);var a={front:{}};a.front={transform:"translate("+e.frontPosition.x+"px,"+e.frontPosition.y+"px)"},e.applyStyles(E),e.applyStyles(a),e.restTimeout=setTimeout((function(){"function"==typeof i&&i.call(e),e.restCallback()}),e.options.fadeTime)},Z.prototype.restCallback=function(){var i=this,x={};x.front=K("transition","none",""),i.applyStyles(x),i.trigger("rested",i.instance)},Z.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},Z.prototype.computeDirection=function(i){var x,e,j,E=i.angle.radian,a=Math.PI/4,Y=Math.PI/2;if(E>a&&E<3*a&&!i.lockX?x="up":E>-a&&E<=a&&!i.lockY?x="left":E>3*-a&&E<=-a&&!i.lockX?x="down":i.lockY||(x="right"),i.lockY||(e=E>-Y&&E<Y?"left":"right"),i.lockX||(j=E>0?"up":"down"),i.force>this.options.threshold){var J,u={};for(J in this.direction)this.direction.hasOwnProperty(J)&&(u[J]=this.direction[J]);var b={};for(J in this.direction={x:e,y:j,angle:x},i.direction=this.direction,u)u[J]===this.direction[J]&&(b[J]=!0);if(b.x&&b.y&&b.angle)return i;b.x&&b.y||this.trigger("plain",i),b.x||this.trigger("plain:"+e,i),b.y||this.trigger("plain:"+j,i),b.angle||this.trigger("dir dir:"+x,i)}else this.resetDirection();return i};const B=Z;function k(i,x){var e=this;e.nipples=[],e.idles=[],e.actives=[],e.ids=[],e.pressureIntervals={},e.manager=i,e.id=k.id,k.id+=1,e.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},e.config(x),"static"!==e.options.mode&&"semi"!==e.options.mode||(e.options.multitouch=!1),e.options.multitouch||(e.options.maxNumberOfNipples=1);var j=getComputedStyle(e.options.zone.parentElement);return j&&"flex"===j.display&&(e.parentIsFlex=!0),e.updateBox(),e.prepareNipples(),e.JL(),e.begin(),e.nipples}k.prototype=new l,k.constructor=k,k.id=0,k.prototype.prepareNipples=function(){var i=this,x=i.nipples;x.on=i.on.bind(i),x.off=i.off.bind(i),x.options=i.options,x.destroy=i.destroy.bind(i),x.ids=i.ids,x.id=i.id,x.processOnMove=i.processOnMove.bind(i),x.processOnEnd=i.processOnEnd.bind(i),x.get=function(i){if(void 0===i)return x[0];for(var e=0,j=x.length;e<j;e+=1)if(x[e].identifier===i)return x[e];return!1}},k.prototype.JL=function(){var i=this;i.bindEvt(i.options.zone,"start"),i.options.zone.style.touchAction="none",i.options.zone.style.msTouchAction="none"},k.prototype.begin=function(){var i=this,x=i.options;if("static"===x.mode){var e=i.createNipple(x.position,i.manager.getIdentifier());e.add(),i.idles.push(e)}},k.prototype.createNipple=function(i,x){var e=this,j=e.manager.scroll,E={},a=e.options,Y=e.parentIsFlex?j.x:j.x+e.box.left,J=e.parentIsFlex?j.y:j.y+e.box.top;if(i.x&&i.y)E={x:i.x-Y,y:i.y-J};else if(i.top||i.right||i.bottom||i.left){var u=document.createElement("DIV");u.style.display="hidden",u.style.top=i.top,u.style.right=i.right,u.style.bottom=i.bottom,u.style.left=i.left,u.style.position="absolute",a.zone.appendChild(u);var b=u.getBoundingClientRect();a.zone.removeChild(u),E=i,i={x:b.left+j.x,y:b.top+j.y}}var g=new B(e,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:x,position:i,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(A(g.ui.el,E),A(g.ui.front,g.frontPosition)),e.nipples.push(g),e.trigger("added "+g.identifier+":added",g),e.manager.trigger("added "+g.identifier+":added",g),e.bindNipple(g),g},k.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},k.prototype.bindNipple=function(i){var x,e=this,j=function(i,j){x=i.type+" "+j.id+":"+i.type,e.trigger(x,j)};i.on("destroyed",e.onDestroyed.bind(e)),i.on("shown hidden rested dir plain",j),i.on("dir:up dir:right dir:down dir:left",j),i.on("plain:up plain:right plain:down plain:left",j)},k.prototype.pressureFn=function(i,x,e){var j=this,E=0;clearInterval(j.pressureIntervals[e]),j.pressureIntervals[e]=setInterval(function(){var e=i.force||i.pressure||i.webkitForce||0;e!==E&&(x.trigger("pressure",e),j.trigger("pressure "+x.identifier+":pressure",e),E=e)}.bind(j),100)},k.prototype.onstart=function(i){var x=this,e=x.options,j=i;return i=b(i),x.updateBox(),M(i,(function(E){x.actives.length<e.maxNumberOfNipples?x.processOnStart(E):j.type.match(/^touch/)&&(Object.keys(x.manager.ids).forEach((function(e){if(Object.values(j.touches).findIndex((function(i){return i.identifier===e}))<0){var E=[i[0]];E.identifier=e,x.processOnEnd(E)}})),x.actives.length<e.maxNumberOfNipples&&x.processOnStart(E))})),x.manager.bindDocument(),!1},k.prototype.processOnStart=function(i){var x,e=this,E=e.options,a=e.manager.getIdentifier(i),Y=i.force||i.pressure||i.webkitForce||0,J={x:i.pageX,y:i.pageY},u=e.getOrCreate(a,J);u.identifier!==a&&e.manager.removeIdentifier(u.identifier),u.identifier=a;var b=function(x){x.trigger("start",x),e.trigger("start "+x.id+":start",x),x.show(),Y>0&&e.pressureFn(i,x,x.identifier),e.processOnMove(i)};if((x=e.idles.indexOf(u))>=0&&e.idles.splice(x,1),e.actives.push(u),e.ids.push(u.identifier),"semi"!==E.mode)b(u);else{if(!(j(J,u.position)<=E.catchDistance))return u.destroy(),void e.processOnStart(i);b(u)}return u},k.prototype.getOrCreate=function(i,x){var e,j=this,E=j.options;return/(semi|static)/.test(E.mode)?(e=j.idles[0])?(j.idles.splice(0,1),e):"semi"===E.mode?j.createNipple(x,i):(console.warn("Coudln't find the needed nipple."),!1):e=j.createNipple(x,i)},k.prototype.processOnMove=function(i){var x=this,e=x.options,a=x.manager.getIdentifier(i),Y=x.nipples.get(a),J=x.manager.scroll;if(function(i){return isNaN(i.buttons)?0!==i.pressure:0!==i.buttons}(i)){if(!Y)return console.error("Found zombie joystick with ID "+a),void x.manager.removeIdentifier(a);if(e.dynamicPage){var u=Y.el.getBoundingClientRect();Y.position={x:J.x+u.left,y:J.y+u.top}}Y.identifier=a;var b=Y.options.size/2,g={x:i.pageX,y:i.pageY};e.lockX&&(g.y=Y.position.y),e.lockY&&(g.x=Y.position.x);var A,K,L,o,M,z,T,Q,t,V,S=j(g,Y.position),f=(A=g,L=(K=Y.position).x-A.x,o=K.y-A.y,function(i){return i*(180/Math.PI)}(Math.atan2(o,L))),w=E(f),O=S/b,l={distance:S,position:g};if("circle"===Y.options.shape?(M=Math.min(S,b),T=Y.position,Q=M,V={x:0,y:0},t=E(t=f),V.x=T.x-Q*Math.cos(t),V.y=T.y-Q*Math.sin(t),z=V):(z=function(i,x,e){return{x:Math.min(Math.max(i.x,x.x-e),x.x+e),y:Math.min(Math.max(i.y,x.y-e),x.y+e)}}(g,Y.position,b),M=j(z,Y.position)),e.follow){if(S>b){var Z=g.x-z.x,B=g.y-z.y;Y.position.x+=Z,Y.position.y+=B,Y.el.style.top=Y.position.y-(x.box.top+J.y)+"px",Y.el.style.left=Y.position.x-(x.box.left+J.x)+"px",S=j(g,Y.position)}}else g=z,S=M;var k=g.x-Y.position.x,N=g.y-Y.position.y;Y.frontPosition={x:k,y:N},e.dataOnly||(Y.ui.front.style.transform="translate("+k+"px,"+N+"px)");var mi={identifier:Y.identifier,position:g,force:O,pressure:i.force||i.pressure||i.webkitForce||0,distance:S,angle:{radian:w,degree:f},vector:{x:k/b,y:-N/b},raw:l,instance:Y,lockX:e.lockX,lockY:e.lockY};(mi=Y.computeDirection(mi)).angle={radian:E(180-f),degree:180-f},Y.trigger("move",mi),x.trigger("move "+Y.id+":move",mi)}else this.processOnEnd(i)},k.prototype.processOnEnd=function(i){var x=this,e=x.options,j=x.manager.getIdentifier(i),E=x.nipples.get(j),a=x.manager.removeIdentifier(E.identifier);E&&(e.dataOnly||E.hide((function(){"dynamic"===e.mode&&(E.trigger("removed",E),x.trigger("removed "+E.id+":removed",E),x.manager.trigger("removed "+E.id+":removed",E),E.destroy())})),clearInterval(x.pressureIntervals[E.identifier]),E.resetDirection(),E.trigger("end",E),x.trigger("end "+E.id+":end",E),x.ids.indexOf(E.identifier)>=0&&x.ids.splice(x.ids.indexOf(E.identifier),1),x.actives.indexOf(E)>=0&&x.actives.splice(x.actives.indexOf(E),1),/(semi|static)/.test(e.mode)?x.idles.push(E):x.nipples.indexOf(E)>=0&&x.nipples.splice(x.nipples.indexOf(E),1),x.manager.unbindDocument(),/(semi|static)/.test(e.mode)&&(x.manager.ids[a.id]=a.identifier))},k.prototype.onDestroyed=function(i,x){var e=this;e.nipples.indexOf(x)>=0&&e.nipples.splice(e.nipples.indexOf(x),1),e.actives.indexOf(x)>=0&&e.actives.splice(e.actives.indexOf(x),1),e.idles.indexOf(x)>=0&&e.idles.splice(e.idles.indexOf(x),1),e.ids.indexOf(x.identifier)>=0&&e.ids.splice(e.ids.indexOf(x.identifier),1),e.manager.removeIdentifier(x.identifier),e.manager.unbindDocument()},k.prototype.destroy=function(){var i=this;for(var x in i.unbindEvt(i.options.zone,"start"),i.nipples.forEach((function(i){i.destroy()})),i.pressureIntervals)i.pressureIntervals.hasOwnProperty(x)&&clearInterval(i.pressureIntervals[x]);i.trigger("destroyed",i.nipples),i.manager.unbindDocument(),i.off()};const N=k;function mi(i){var x=this;x.ids={},x.index=0,x.collections=[],x.scroll=g(),x.config(i),x.prepareCollections();var e=function(){var i;x.collections.forEach((function(e){e.forEach((function(e){i=e.el.getBoundingClientRect(),e.position={x:x.scroll.x+i.left,y:x.scroll.y+i.top}}))}))};J(window,"resize",(function(){Y(e)}));var j=function(){x.scroll=g()};return J(window,"scroll",(function(){Y(j)})),x.collections}mi.prototype=new l,mi.constructor=mi,mi.prototype.prepareCollections=function(){var i=this;i.collections.create=i.create.bind(i),i.collections.on=i.on.bind(i),i.collections.off=i.off.bind(i),i.collections.destroy=i.destroy.bind(i),i.collections.get=function(x){var e;return i.collections.every((function(i){return!(e=i.get(x))})),e}},mi.prototype.create=function(i){return this.createCollection(i)},mi.prototype.createCollection=function(i){var x=this,e=new N(x,i);return x.bindCollection(e),x.collections.push(e),e},mi.prototype.bindCollection=function(i){var x,e=this,j=function(i,j){x=i.type+" "+j.id+":"+i.type,e.trigger(x,j)};i.on("destroyed",e.onDestroyed.bind(e)),i.on("shown hidden rested dir plain",j),i.on("dir:up dir:right dir:down dir:left",j),i.on("plain:up plain:right plain:down plain:left",j)},mi.prototype.bindDocument=function(){var i=this;i.binded||(i.bindEvt(document,"move").bindEvt(document,"end"),i.binded=!0)},mi.prototype.unbindDocument=function(i){var x=this;Object.keys(x.ids).length&&!0!==i||(x.unbindEvt(document,"move").unbindEvt(document,"end"),x.binded=!1)},mi.prototype.getIdentifier=function(i){var x;return i?void 0===(x=void 0===i.identifier?i.pointerId:i.identifier)&&(x=this.latest||0):x=this.index,void 0===this.ids[x]&&(this.ids[x]=this.index,this.index+=1),this.latest=x,this.ids[x]},mi.prototype.removeIdentifier=function(i){var x={};for(var e in this.ids)if(this.ids[e]===i){x.id=e,x.identifier=this.ids[e],delete this.ids[e];break}return x},mi.prototype.onmove=function(i){return this.onAny("move",i),!1},mi.prototype.onend=function(i){return this.onAny("end",i),!1},mi.prototype.oncancel=function(i){return this.onAny("end",i),!1},mi.prototype.onAny=function(i,x){var e,j=this,E="processOn"+i.charAt(0).toUpperCase()+i.slice(1);x=b(x);var a=function(i,x,e){e.ids.indexOf(x)>=0&&(e[E](i),i._found_=!0)};return M(x,(function(i){e=j.getIdentifier(i),M(j.collections,a.bind(null,i,e)),i._found_||j.removeIdentifier(e)})),!1},mi.prototype.destroy=function(){var i=this;i.unbindDocument(!0),i.ids={},i.index=0,i.collections.forEach((function(i){i.destroy()})),i.off()},mi.prototype.onDestroyed=function(i,x){var e=this;if(e.collections.indexOf(x)<0)return!1;e.collections.splice(e.collections.indexOf(x),1)};var X=new mi;const C={create:function(i){return X.create(i)},factory:X};return x.default})(),i.exports=x()},13333:(i,x,e)=>{"use strict";const{Deflate:j,deflate:E,deflateRaw:a,gzip:Y}=e(13340),{Inflate:J,inflate:u,inflateRaw:b,ungzip:g}=e(13394),A=e(13374);i.exports.Deflate=j,i.exports.deflate=E,i.exports.deflateRaw=a,i.exports.gzip=Y,i.exports.Inflate=J,i.exports.inflate=u,i.exports.inflateRaw=b,i.exports.ungzip=g,i.exports.constants=A},13340:(i,x,e)=>{"use strict";const j=e(13348),E=e(13377),a=e(13382),Y=e(13369),J=e(13391),u=Object.prototype.toString,{Z_NO_FLUSH:b,Z_SYNC_FLUSH:g,Z_FULL_FLUSH:A,Z_FINISH:K,Z_OK:L,Z_STREAM_END:o,Z_DEFAULT_COMPRESSION:M,Z_DEFAULT_STRATEGY:z,Z_DEFLATED:T}=e(13374);function Q(i){this.options=E.assign({level:M,method:T,Hi:16384,windowBits:15,memLevel:8,strategy:z},i||{});let x=this.options;x.raw&&x.windowBits>0?x.windowBits=-x.windowBits:x.gzip&&x.windowBits>0&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.ij="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let e=j.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(e!==L)throw new Error(Y[e]);if(x.header&&j.deflateSetHeader(this.strm,x.header),x.dictionary){let i;if(i="string"===typeof x.dictionary?a.string2buf(x.dictionary):"[object ArrayBuffer]"===u.call(x.dictionary)?new Uint8Array(x.dictionary):x.dictionary,e=j.deflateSetDictionary(this.strm,i),e!==L)throw new Error(Y[e]);this._dict_set=!0}}function t(i,x){const e=new Q(x);if(e.push(i,!0),e.err)throw e.ij||Y[e.err];return e.result}Q.prototype.push=function(i,x){const e=this.strm,E=this.options.Hi;let Y,J;if(this.ended)return!1;for(J=x===~~x?x:!0===x?K:b,"string"===typeof i?e.input=a.string2buf(i):"[object ArrayBuffer]"===u.call(i)?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;)if(0===e.avail_out&&(e.output=new Uint8Array(E),e.next_out=0,e.avail_out=E),(J===g||J===A)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(Y=j.deflate(e,J),Y===o)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),Y=j.deflateEnd(this.strm),this.onEnd(Y),this.ended=!0,Y===L;if(0!==e.avail_out){if(J>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(0===e.avail_in)break}else this.onData(e.output)}return!0},Q.prototype.onData=function(i){this.chunks.push(i)},Q.prototype.onEnd=function(i){i===L&&(this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.ij=this.strm.ij},i.exports.Deflate=Q,i.exports.deflate=t,i.exports.deflateRaw=function(i,x){return(x=x||{}).raw=!0,t(i,x)},i.exports.gzip=function(i,x){return(x=x||{}).gzip=!0,t(i,x)},i.exports.constants=e(13374)},13394:(i,x,e)=>{"use strict";const j=e(13403),E=e(13377),a=e(13382),Y=e(13369),J=e(13391),u=e(13422),b=Object.prototype.toString,{Z_NO_FLUSH:g,Z_FINISH:A,Z_OK:K,Z_STREAM_END:L,Z_NEED_DICT:o,Z_STREAM_ERROR:M,Z_DATA_ERROR:z,Z_MEM_ERROR:T}=e(13374);function Q(i){this.options=E.assign({Hi:65536,windowBits:15,to:""},i||{});const x=this.options;x.raw&&x.windowBits>=0&&x.windowBits<16&&(x.windowBits=-x.windowBits,0===x.windowBits&&(x.windowBits=-15)),!(x.windowBits>=0&&x.windowBits<16)||i&&i.windowBits||(x.windowBits+=32),x.windowBits>15&&x.windowBits<48&&0===(15&x.windowBits)&&(x.windowBits|=15),this.err=0,this.ij="",this.ended=!1,this.chunks=[],this.strm=new J,this.strm.avail_out=0;let e=j.inflateInit2(this.strm,x.windowBits);if(e!==K)throw new Error(Y[e]);if(this.header=new u,j.inflateGetHeader(this.strm,this.header),x.dictionary&&("string"===typeof x.dictionary?x.dictionary=a.string2buf(x.dictionary):"[object ArrayBuffer]"===b.call(x.dictionary)&&(x.dictionary=new Uint8Array(x.dictionary)),x.raw&&(e=j.inflateSetDictionary(this.strm,x.dictionary),e!==K)))throw new Error(Y[e])}function t(i,x){const e=new Q(x);if(e.push(i),e.err)throw e.ij||Y[e.err];return e.result}Q.prototype.push=function(i,x){const e=this.strm,E=this.options.Hi,Y=this.options.dictionary;let J,u,Q;if(this.ended)return!1;for(u=x===~~x?x:!0===x?A:g,"[object ArrayBuffer]"===b.call(i)?e.input=new Uint8Array(i):e.input=i,e.next_in=0,e.avail_in=e.input.length;;){for(0===e.avail_out&&(e.output=new Uint8Array(E),e.next_out=0,e.avail_out=E),J=j.inflate(e,u),J===o&&Y&&(J=j.inflateSetDictionary(e,Y),J===K?J=j.inflate(e,u):J===z&&(J=o));e.avail_in>0&&J===L&&e.state.wrap>0&&0!==i[e.next_in];)j.inflateReset(e),J=j.inflate(e,u);switch(J){case M:case z:case o:case T:return this.onEnd(J),this.ended=!0,!1}if(Q=e.avail_out,e.next_out&&(0===e.avail_out||J===L))if("string"===this.options.to){let i=a.utf8border(e.output,e.next_out),x=e.next_out-i,j=a.buf2string(e.output,i);e.next_out=x,e.avail_out=E-x,x&&e.output.set(e.output.subarray(i,i+x),0),this.onData(j)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(J!==K||0!==Q){if(J===L)return J=j.inflateEnd(this.strm),this.onEnd(J),this.ended=!0,!0;if(0===e.avail_in)break}}return!0},Q.prototype.onData=function(i){this.chunks.push(i)},Q.prototype.onEnd=function(i){i===K&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=E.flattenChunks(this.chunks)),this.chunks=[],this.err=i,this.ij=this.strm.ij},i.exports.Inflate=Q,i.exports.inflate=t,i.exports.inflateRaw=function(i,x){return(x=x||{}).raw=!0,t(i,x)},i.exports.ungzip=t,i.exports.constants=e(13374)},13377:i=>{"use strict";const x=(i,x)=>Object.prototype.hasOwnProperty.call(i,x);i.exports.assign=function(i){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const j=e.shift();if(j){if("object"!==typeof j)throw new TypeError(j+"must be non-object");for(const e in j)x(j,e)&&(i[e]=j[e])}}return i},i.exports.flattenChunks=i=>{let x=0;for(let j=0,E=i.length;j<E;j++)x+=i[j].length;const e=new Uint8Array(x);for(let j=0,E=0,a=i.length;j<a;j++){let x=i[j];e.set(x,E),E+=x.length}return e}},13382:i=>{"use strict";let x=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(j){x=!1}const e=new Uint8Array(256);for(let E=0;E<256;E++)e[E]=E>=252?6:E>=248?5:E>=240?4:E>=224?3:E>=192?2:1;e[254]=e[254]=1,i.exports.string2buf=i=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(i);let x,e,j,E,a,Y=i.length,J=0;for(E=0;E<Y;E++)e=i.charCodeAt(E),55296===(64512&e)&&E+1<Y&&(j=i.charCodeAt(E+1),56320===(64512&j)&&(e=65536+(e-55296<<10)+(j-56320),E++)),J+=e<128?1:e<2048?2:e<65536?3:4;for(x=new Uint8Array(J),a=0,E=0;a<J;E++)e=i.charCodeAt(E),55296===(64512&e)&&E+1<Y&&(j=i.charCodeAt(E+1),56320===(64512&j)&&(e=65536+(e-55296<<10)+(j-56320),E++)),e<128?x[a++]=e:e<2048?(x[a++]=192|e>>>6,x[a++]=128|63&e):e<65536?(x[a++]=224|e>>>12,x[a++]=128|e>>>6&63,x[a++]=128|63&e):(x[a++]=240|e>>>18,x[a++]=128|e>>>12&63,x[a++]=128|e>>>6&63,x[a++]=128|63&e);return x};i.exports.buf2string=(i,j)=>{const E=j||i.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(i.subarray(0,j));let a,Y;const J=new Array(2*E);for(Y=0,a=0;a<E;){let x=i[a++];if(x<128){J[Y++]=x;continue}let j=e[x];if(j>4)J[Y++]=65533,a+=j-1;else{for(x&=2===j?31:3===j?15:7;j>1&&a<E;)x=x<<6|63&i[a++],j--;j>1?J[Y++]=65533:x<65536?J[Y++]=x:(x-=65536,J[Y++]=55296|x>>10&1023,J[Y++]=56320|1023&x)}}return((i,e)=>{if(e<65534&&i.subarray&&x)return String.fromCharCode.apply(null,i.length===e?i:i.subarray(0,e));let j="";for(let x=0;x<e;x++)j+=String.fromCharCode(i[x]);return j})(J,Y)},i.exports.utf8border=(i,x)=>{(x=x||i.length)>i.length&&(x=i.length);let j=x-1;for(;j>=0&&128===(192&i[j]);)j--;return j<0||0===j?x:j+e[i[j]]>x?j:x}},13360:i=>{"use strict";i.exports=(i,x,e,j)=>{let E=65535&i,a=i>>>16&65535,Y=0;for(;0!==e;){Y=e>2e3?2e3:e,e-=Y;do{E=E+x[j++]|0,a=a+E|0}while(--Y);E%=65521,a%=65521}return E|a<<16}},13374:i=>{"use strict";i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13366:i=>{"use strict";const x=new Uint32Array((()=>{let i,x=[];for(var e=0;e<256;e++){i=e;for(var j=0;j<8;j++)i=1&i?3988292384^i>>>1:i>>>1;x[e]=i}return x})());i.exports=(i,e,j,E)=>{const a=x,Y=E+j;i^=-1;for(let x=E;x<Y;x++)i=i>>>8^a[255&(i^e[x])];return~i}},13348:(i,x,e)=>{"use strict";const{_tr_init:j,_tr_stored_block:E,_tr_flush_block:a,_tr_tally:Y,_tr_align:J}=e(13356),u=e(13360),b=e(13366),g=e(13369),{Z_NO_FLUSH:A,Z_PARTIAL_FLUSH:K,Z_FULL_FLUSH:L,Z_FINISH:o,Z_BLOCK:M,Z_OK:z,Z_STREAM_END:T,Z_STREAM_ERROR:Q,Z_DATA_ERROR:t,Z_BUF_ERROR:V,Z_DEFAULT_COMPRESSION:S,Z_FILTERED:f,Z_HUFFMAN_ONLY:w,Z_RLE:O,Z_FIXED:l,Z_DEFAULT_STRATEGY:Z,Z_UNKNOWN:B,Z_DEFLATED:k}=e(13374),N=258,mi=262,X=103,C=113,n=666,I=(i,x)=>(i.ij=g[x],x),d=i=>(i<<1)-(i>4?9:0),p=i=>{let x=i.length;for(;--x>=0;)i[x]=0};let H=(i,x,e)=>(x<<i.hash_shift^e)&i.hash_mask;const U=i=>{const x=i.state;let e=x.pending;e>i.avail_out&&(e=i.avail_out),0!==e&&(i.output.set(x.pending_buf.subarray(x.pending_out,x.pending_out+e),i.next_out),i.next_out+=e,x.pending_out+=e,i.total_out+=e,i.avail_out-=e,x.pending-=e,0===x.pending&&(x.pending_out=0))},D=(i,x)=>{a(i,i.block_start>=0?i.block_start:-1,i.strstart-i.block_start,x),i.block_start=i.strstart,U(i.strm)},h=(i,x)=>{i.pending_buf[i.pending++]=x},F=(i,x)=>{i.pending_buf[i.pending++]=x>>>8&255,i.pending_buf[i.pending++]=255&x},R=(i,x,e,j)=>{let E=i.avail_in;return E>j&&(E=j),0===E?0:(i.avail_in-=E,x.set(i.input.subarray(i.next_in,i.next_in+E),e),1===i.state.wrap?i.adler=u(i.adler,x,E,e):2===i.state.wrap&&(i.adler=b(i.adler,x,E,e)),i.next_in+=E,i.total_in+=E,E)},y=(i,x)=>{let e,j,E=i.max_chain_length,a=i.strstart,Y=i.prev_length,J=i.nice_match;const u=i.strstart>i.w_size-mi?i.strstart-(i.w_size-mi):0,b=i.window,g=i.w_mask,A=i.prev,K=i.strstart+N;let L=b[a+Y-1],o=b[a+Y];i.prev_length>=i.good_match&&(E>>=2),J>i.lookahead&&(J=i.lookahead);do{if(e=x,b[e+Y]===o&&b[e+Y-1]===L&&b[e]===b[a]&&b[++e]===b[a+1]){a+=2,e++;do{}while(b[++a]===b[++e]&&b[++a]===b[++e]&&b[++a]===b[++e]&&b[++a]===b[++e]&&b[++a]===b[++e]&&b[++a]===b[++e]&&b[++a]===b[++e]&&b[++a]===b[++e]&&a<K);if(j=N-(K-a),a=K-N,j>Y){if(i.match_start=x,Y=j,j>=J)break;L=b[a+Y-1],o=b[a+Y]}}}while((x=A[x&g])>u&&0!==--E);return Y<=i.lookahead?Y:i.lookahead},r=i=>{const x=i.w_size;let e,j,E,a,Y;do{if(a=i.window_size-i.lookahead-i.strstart,i.strstart>=x+(x-mi)){i.window.set(i.window.subarray(x,x+x),0),i.match_start-=x,i.strstart-=x,i.block_start-=x,j=i.hash_size,e=j;do{E=i.head[--e],i.head[e]=E>=x?E-x:0}while(--j);j=x,e=j;do{E=i.prev[--e],i.prev[e]=E>=x?E-x:0}while(--j);a+=x}if(0===i.strm.avail_in)break;if(j=R(i.strm,i.window,i.strstart+i.lookahead,a),i.lookahead+=j,i.lookahead+i.insert>=3)for(Y=i.strstart-i.insert,i.ins_h=i.window[Y],i.ins_h=H(i,i.ins_h,i.window[Y+1]);i.insert&&(i.ins_h=H(i,i.ins_h,i.window[Y+3-1]),i.prev[Y&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=Y,Y++,i.insert--,!(i.lookahead+i.insert<3)););}while(i.lookahead<mi&&0!==i.strm.avail_in)},c=(i,x)=>{let e,j;for(;;){if(i.lookahead<mi){if(r(i),i.lookahead<mi&&x===A)return 1;if(0===i.lookahead)break}if(e=0,i.lookahead>=3&&(i.ins_h=H(i,i.ins_h,i.window[i.strstart+3-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),0!==e&&i.strstart-e<=i.w_size-mi&&(i.match_length=y(i,e)),i.match_length>=3)if(j=Y(i,i.strstart-i.match_start,i.match_length-3),i.lookahead-=i.match_length,i.match_length<=i.max_lazy_match&&i.lookahead>=3){i.match_length--;do{i.strstart++,i.ins_h=H(i,i.ins_h,i.window[i.strstart+3-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart}while(0!==--i.match_length);i.strstart++}else i.strstart+=i.match_length,i.match_length=0,i.ins_h=i.window[i.strstart],i.ins_h=H(i,i.ins_h,i.window[i.strstart+1]);else j=Y(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++;if(j&&(D(i,!1),0===i.strm.avail_out))return 1}return i.insert=i.strstart<2?i.strstart:2,x===o?(D(i,!0),0===i.strm.avail_out?3:4):i.last_lit&&(D(i,!1),0===i.strm.avail_out)?1:2},P=(i,x)=>{let e,j,E;for(;;){if(i.lookahead<mi){if(r(i),i.lookahead<mi&&x===A)return 1;if(0===i.lookahead)break}if(e=0,i.lookahead>=3&&(i.ins_h=H(i,i.ins_h,i.window[i.strstart+3-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart),i.prev_length=i.match_length,i.prev_match=i.match_start,i.match_length=2,0!==e&&i.prev_length<i.max_lazy_match&&i.strstart-e<=i.w_size-mi&&(i.match_length=y(i,e),i.match_length<=5&&(i.strategy===f||3===i.match_length&&i.strstart-i.match_start>4096)&&(i.match_length=2)),i.prev_length>=3&&i.match_length<=i.prev_length){E=i.strstart+i.lookahead-3,j=Y(i,i.strstart-1-i.prev_match,i.prev_length-3),i.lookahead-=i.prev_length-1,i.prev_length-=2;do{++i.strstart<=E&&(i.ins_h=H(i,i.ins_h,i.window[i.strstart+3-1]),e=i.prev[i.strstart&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=i.strstart)}while(0!==--i.prev_length);if(i.match_available=0,i.match_length=2,i.strstart++,j&&(D(i,!1),0===i.strm.avail_out))return 1}else if(i.match_available){if(j=Y(i,0,i.window[i.strstart-1]),j&&D(i,!1),i.strstart++,i.lookahead--,0===i.strm.avail_out)return 1}else i.match_available=1,i.strstart++,i.lookahead--}return i.match_available&&(j=Y(i,0,i.window[i.strstart-1]),i.match_available=0),i.insert=i.strstart<2?i.strstart:2,x===o?(D(i,!0),0===i.strm.avail_out?3:4):i.last_lit&&(D(i,!1),0===i.strm.avail_out)?1:2};function q(i,x,e,j,E){this.good_length=i,this.max_lazy=x,this.nice_length=e,this.max_chain=j,this.func=E}const W=[new q(0,0,0,0,((i,x)=>{let e=65535;for(e>i.pending_buf_size-5&&(e=i.pending_buf_size-5);;){if(i.lookahead<=1){if(r(i),0===i.lookahead&&x===A)return 1;if(0===i.lookahead)break}i.strstart+=i.lookahead,i.lookahead=0;const j=i.block_start+e;if((0===i.strstart||i.strstart>=j)&&(i.lookahead=i.strstart-j,i.strstart=j,D(i,!1),0===i.strm.avail_out))return 1;if(i.strstart-i.block_start>=i.w_size-mi&&(D(i,!1),0===i.strm.avail_out))return 1}return i.insert=0,x===o?(D(i,!0),0===i.strm.avail_out?3:4):(i.strstart>i.block_start&&(D(i,!1),i.strm.avail_out),1)})),new q(4,4,8,4,c),new q(4,5,16,8,c),new q(4,6,32,32,c),new q(4,4,16,16,P),new q(8,16,32,32,P),new q(8,16,128,128,P),new q(8,32,128,256,P),new q(32,128,258,1024,P),new q(32,258,258,4096,P)];function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),p(this.dyn_ltree),p(this.dyn_dtree),p(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),p(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),p(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const v=i=>{if(!i||!i.state)return I(i,Q);i.total_in=i.total_out=0,i.data_type=B;const x=i.state;return x.pending=0,x.pending_out=0,x.wrap<0&&(x.wrap=-x.wrap),x.status=x.wrap?42:C,i.adler=2===x.wrap?0:1,x.last_flush=A,j(x),z},s=i=>{const x=v(i);var e;return x===z&&((e=i.state).window_size=2*e.w_size,p(e.head),e.max_lazy_match=W[e.level].max_lazy,e.good_match=W[e.level].good_length,e.nice_match=W[e.level].nice_length,e.max_chain_length=W[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),x},ii=(i,x,e,j,E,a)=>{if(!i)return Q;let Y=1;if(x===S&&(x=6),j<0?(Y=0,j=-j):j>15&&(Y=2,j-=16),E<1||E>9||e!==k||j<8||j>15||x<0||x>9||a<0||a>l)return I(i,Q);8===j&&(j=9);const J=new G;return i.state=J,J.strm=i,J.wrap=Y,J.gzhead=null,J.w_bits=j,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=E+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+3-1)/3),J.window=new Uint8Array(2*J.w_size),J.head=new Uint16Array(J.hash_size),J.prev=new Uint16Array(J.w_size),J.lit_bufsize=1<<E+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new Uint8Array(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=x,J.strategy=a,J.method=e,s(i)};i.exports.deflateInit=(i,x)=>ii(i,x,k,15,8,Z),i.exports.deflateInit2=ii,i.exports.deflateReset=s,i.exports.deflateResetKeep=v,i.exports.deflateSetHeader=(i,x)=>i&&i.state?2!==i.state.wrap?Q:(i.state.gzhead=x,z):Q,i.exports.deflate=(i,x)=>{let e,j;if(!i||!i.state||x>M||x<0)return i?I(i,Q):Q;const a=i.state;if(!i.output||!i.input&&0!==i.avail_in||a.status===n&&x!==o)return I(i,0===i.avail_out?V:Q);a.strm=i;const u=a.last_flush;if(a.last_flush=x,42===a.status)if(2===a.wrap)i.adler=0,h(a,31),h(a,139),h(a,8),a.gzhead?(h(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),h(a,255&a.gzhead.time),h(a,a.gzhead.time>>8&255),h(a,a.gzhead.time>>16&255),h(a,a.gzhead.time>>24&255),h(a,9===a.level?2:a.strategy>=w||a.level<2?4:0),h(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(h(a,255&a.gzhead.extra.length),h(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(i.adler=b(i.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(h(a,0),h(a,0),h(a,0),h(a,0),h(a,0),h(a,9===a.level?2:a.strategy>=w||a.level<2?4:0),h(a,3),a.status=C);else{let x=k+(a.w_bits-8<<4)<<8,e=-1;e=a.strategy>=w||a.level<2?0:a.level<6?1:6===a.level?2:3,x|=e<<6,0!==a.strstart&&(x|=32),x+=31-x%31,a.status=C,F(a,x),0!==a.strstart&&(F(a,i.adler>>>16),F(a,65535&i.adler)),i.adler=1}if(69===a.status)if(a.gzhead.extra){for(e=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>e&&(i.adler=b(i.adler,a.pending_buf,a.pending-e,e)),U(i),e=a.pending,a.pending!==a.pending_buf_size));)h(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>e&&(i.adler=b(i.adler,a.pending_buf,a.pending-e,e)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){e=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>e&&(i.adler=b(i.adler,a.pending_buf,a.pending-e,e)),U(i),e=a.pending,a.pending===a.pending_buf_size)){j=1;break}j=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,h(a,j)}while(0!==j);a.gzhead.hcrc&&a.pending>e&&(i.adler=b(i.adler,a.pending_buf,a.pending-e,e)),0===j&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){e=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>e&&(i.adler=b(i.adler,a.pending_buf,a.pending-e,e)),U(i),e=a.pending,a.pending===a.pending_buf_size)){j=1;break}j=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,h(a,j)}while(0!==j);a.gzhead.hcrc&&a.pending>e&&(i.adler=b(i.adler,a.pending_buf,a.pending-e,e)),0===j&&(a.status=X)}else a.status=X;if(a.status===X&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&U(i),a.pending+2<=a.pending_buf_size&&(h(a,255&i.adler),h(a,i.adler>>8&255),i.adler=0,a.status=C)):a.status=C),0!==a.pending){if(U(i),0===i.avail_out)return a.last_flush=-1,z}else if(0===i.avail_in&&d(x)<=d(u)&&x!==o)return I(i,V);if(a.status===n&&0!==i.avail_in)return I(i,V);if(0!==i.avail_in||0!==a.lookahead||x!==A&&a.status!==n){let e=a.strategy===w?((i,x)=>{let e;for(;;){if(0===i.lookahead&&(r(i),0===i.lookahead)){if(x===A)return 1;break}if(i.match_length=0,e=Y(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++,e&&(D(i,!1),0===i.strm.avail_out))return 1}return i.insert=0,x===o?(D(i,!0),0===i.strm.avail_out?3:4):i.last_lit&&(D(i,!1),0===i.strm.avail_out)?1:2})(a,x):a.strategy===O?((i,x)=>{let e,j,E,a;const J=i.window;for(;;){if(i.lookahead<=N){if(r(i),i.lookahead<=N&&x===A)return 1;if(0===i.lookahead)break}if(i.match_length=0,i.lookahead>=3&&i.strstart>0&&(E=i.strstart-1,j=J[E],j===J[++E]&&j===J[++E]&&j===J[++E])){a=i.strstart+N;do{}while(j===J[++E]&&j===J[++E]&&j===J[++E]&&j===J[++E]&&j===J[++E]&&j===J[++E]&&j===J[++E]&&j===J[++E]&&E<a);i.match_length=N-(a-E),i.match_length>i.lookahead&&(i.match_length=i.lookahead)}if(i.match_length>=3?(e=Y(i,1,i.match_length-3),i.lookahead-=i.match_length,i.strstart+=i.match_length,i.match_length=0):(e=Y(i,0,i.window[i.strstart]),i.lookahead--,i.strstart++),e&&(D(i,!1),0===i.strm.avail_out))return 1}return i.insert=0,x===o?(D(i,!0),0===i.strm.avail_out?3:4):i.last_lit&&(D(i,!1),0===i.strm.avail_out)?1:2})(a,x):W[a.level].func(a,x);if(3!==e&&4!==e||(a.status=n),1===e||3===e)return 0===i.avail_out&&(a.last_flush=-1),z;if(2===e&&(x===K?J(a):x!==M&&(E(a,0,0,!1),x===L&&(p(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),U(i),0===i.avail_out))return a.last_flush=-1,z}return x!==o?z:a.wrap<=0?T:(2===a.wrap?(h(a,255&i.adler),h(a,i.adler>>8&255),h(a,i.adler>>16&255),h(a,i.adler>>24&255),h(a,255&i.total_in),h(a,i.total_in>>8&255),h(a,i.total_in>>16&255),h(a,i.total_in>>24&255)):(F(a,i.adler>>>16),F(a,65535&i.adler)),U(i),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?z:T)},i.exports.deflateEnd=i=>{if(!i||!i.state)return Q;const x=i.state.status;return 42!==x&&69!==x&&73!==x&&91!==x&&x!==X&&x!==C&&x!==n?I(i,Q):(i.state=null,x===C?I(i,t):z)},i.exports.deflateSetDictionary=(i,x)=>{let e=x.length;if(!i||!i.state)return Q;const j=i.state,E=j.wrap;if(2===E||1===E&&42!==j.status||j.lookahead)return Q;if(1===E&&(i.adler=u(i.adler,x,e,0)),j.wrap=0,e>=j.w_size){0===E&&(p(j.head),j.strstart=0,j.block_start=0,j.insert=0);let i=new Uint8Array(j.w_size);i.set(x.subarray(e-j.w_size,e),0),x=i,e=j.w_size}const a=i.avail_in,Y=i.next_in,J=i.input;for(i.avail_in=e,i.next_in=0,i.input=x,r(j);j.lookahead>=3;){let i=j.strstart,x=j.lookahead-2;do{j.ins_h=H(j,j.ins_h,j.window[i+3-1]),j.prev[i&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=i,i++}while(--x);j.strstart=i,j.lookahead=2,r(j)}return j.strstart+=j.lookahead,j.block_start=j.strstart,j.insert=j.lookahead,j.lookahead=0,j.match_length=j.prev_length=2,j.match_available=0,i.next_in=Y,i.input=J,i.avail_in=a,j.wrap=E,z},i.exports.deflateInfo="pako deflate (from Nodeca project)"},13422:i=>{"use strict";i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},13406:i=>{"use strict";i.exports=function(i,x){let e,j,E,a,Y,J,u,b,g,A,K,L,o,M,z,T,Q,t,V,S,f,w,O,l;const Z=i.state;e=i.next_in,O=i.input,j=e+(i.avail_in-5),E=i.next_out,l=i.output,a=E-(x-i.avail_out),Y=E+(i.avail_out-257),J=Z.dmax,u=Z.wsize,b=Z.whave,g=Z.wnext,A=Z.window,K=Z.hold,L=Z.bits,o=Z.lencode,M=Z.distcode,z=(1<<Z.lenbits)-1,T=(1<<Z.distbits)-1;i:do{L<15&&(K+=O[e++]<<L,L+=8,K+=O[e++]<<L,L+=8),Q=o[K&z];x:for(;;){if(t=Q>>>24,K>>>=t,L-=t,t=Q>>>16&255,0===t)l[E++]=65535&Q;else{if(!(16&t)){if(0===(64&t)){Q=o[(65535&Q)+(K&(1<<t)-1)];continue x}if(32&t){Z.mode=12;break i}i.ij="invalid literal/length code",Z.mode=30;break i}V=65535&Q,t&=15,t&&(L<t&&(K+=O[e++]<<L,L+=8),V+=K&(1<<t)-1,K>>>=t,L-=t),L<15&&(K+=O[e++]<<L,L+=8,K+=O[e++]<<L,L+=8),Q=M[K&T];e:for(;;){if(t=Q>>>24,K>>>=t,L-=t,t=Q>>>16&255,!(16&t)){if(0===(64&t)){Q=M[(65535&Q)+(K&(1<<t)-1)];continue e}i.ij="invalid distance code",Z.mode=30;break i}if(S=65535&Q,t&=15,L<t&&(K+=O[e++]<<L,L+=8,L<t&&(K+=O[e++]<<L,L+=8)),S+=K&(1<<t)-1,S>J){i.ij="invalid distance too far back",Z.mode=30;break i}if(K>>>=t,L-=t,t=E-a,S>t){if(t=S-t,t>b&&Z.sane){i.ij="invalid distance too far back",Z.mode=30;break i}if(f=0,w=A,0===g){if(f+=u-t,t<V){V-=t;do{l[E++]=A[f++]}while(--t);f=E-S,w=l}}else if(g<t){if(f+=u+g-t,t-=g,t<V){V-=t;do{l[E++]=A[f++]}while(--t);if(f=0,g<V){t=g,V-=t;do{l[E++]=A[f++]}while(--t);f=E-S,w=l}}}else if(f+=g-t,t<V){V-=t;do{l[E++]=A[f++]}while(--t);f=E-S,w=l}for(;V>2;)l[E++]=w[f++],l[E++]=w[f++],l[E++]=w[f++],V-=3;V&&(l[E++]=w[f++],V>1&&(l[E++]=w[f++]))}else{f=E-S;do{l[E++]=l[f++],l[E++]=l[f++],l[E++]=l[f++],V-=3}while(V>2);V&&(l[E++]=l[f++],V>1&&(l[E++]=l[f++]))}break}}break}}while(e<j&&E<Y);V=L>>3,e-=V,L-=V<<3,K&=(1<<L)-1,i.next_in=e,i.next_out=E,i.avail_in=e<j?j-e+5:5-(e-j),i.avail_out=E<Y?Y-E+257:257-(E-Y),Z.hold=K,Z.bits=L}},13403:(i,x,e)=>{"use strict";const j=e(13360),E=e(13366),a=e(13406),Y=e(13413),{Z_FINISH:J,Z_BLOCK:u,Z_TREES:b,Z_OK:g,Z_STREAM_END:A,Z_NEED_DICT:K,Z_STREAM_ERROR:L,Z_DATA_ERROR:o,Z_MEM_ERROR:M,Z_BUF_ERROR:z,Z_DEFLATED:T}=e(13374),Q=12,t=30,V=i=>(i>>>24&255)+(i>>>8&65280)+((65280&i)<<8)+((255&i)<<24);function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const f=i=>{if(!i||!i.state)return L;const x=i.state;return i.total_in=i.total_out=x.total=0,i.ij="",x.wrap&&(i.adler=1&x.wrap),x.mode=1,x.last=0,x.havedict=0,x.dmax=32768,x.head=null,x.hold=0,x.bits=0,x.lencode=x.lendyn=new Int32Array(852),x.distcode=x.distdyn=new Int32Array(592),x.sane=1,x.back=-1,g},w=i=>{if(!i||!i.state)return L;const x=i.state;return x.wsize=0,x.whave=0,x.wnext=0,f(i)},O=(i,x)=>{let e;if(!i||!i.state)return L;const j=i.state;return x<0?(e=0,x=-x):(e=1+(x>>4),x<48&&(x&=15)),x&&(x<8||x>15)?L:(null!==j.window&&j.wbits!==x&&(j.window=null),j.wrap=e,j.wbits=x,w(i))},l=(i,x)=>{if(!i)return L;const e=new S;i.state=e,e.window=null;const j=O(i,x);return j!==g&&(i.state=null),j};let Z,B,k=!0;const N=i=>{if(k){Z=new Int32Array(512),B=new Int32Array(32);let x=0;for(;x<144;)i.lens[x++]=8;for(;x<256;)i.lens[x++]=9;for(;x<280;)i.lens[x++]=7;for(;x<288;)i.lens[x++]=8;for(Y(1,i.lens,0,288,Z,0,i.work,{bits:9}),x=0;x<32;)i.lens[x++]=5;Y(2,i.lens,0,32,B,0,i.work,{bits:5}),k=!1}i.lencode=Z,i.lenbits=9,i.distcode=B,i.distbits=5},mi=(i,x,e,j)=>{let E;const a=i.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),j>=a.wsize?(a.window.set(x.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(E=a.wsize-a.wnext,E>j&&(E=j),a.window.set(x.subarray(e-j,e-j+E),a.wnext),(j-=E)?(a.window.set(x.subarray(e-j,e),0),a.wnext=j,a.whave=a.wsize):(a.wnext+=E,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=E))),0};i.exports.inflateReset=w,i.exports.inflateReset2=O,i.exports.inflateResetKeep=f,i.exports.inflateInit=i=>l(i,15),i.exports.inflateInit2=l,i.exports.inflate=(i,x)=>{let e,S,f,w,O,l,Z,B,k,X,C,n,I,d,p,H,U,D,h,F,R,y,r=0;const c=new Uint8Array(4);let P,q;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!i||!i.state||!i.output||!i.input&&0!==i.avail_in)return L;e=i.state,e.mode===Q&&(e.mode=13),O=i.next_out,f=i.output,Z=i.avail_out,w=i.next_in,S=i.input,l=i.avail_in,B=e.hold,k=e.bits,X=l,C=Z,y=g;i:for(;;)switch(e.mode){case 1:if(0===e.wrap){e.mode=13;break}for(;k<16;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(2&e.wrap&&35615===B){e.check=0,c[0]=255&B,c[1]=B>>>8&255,e.check=E(e.check,c,2,0),B=0,k=0,e.mode=2;break}if(e.flags=0,e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&B)<<8)+(B>>8))%31){i.ij="incorrect header check",e.mode=t;break}if((15&B)!==T){i.ij="unknown compression method",e.mode=t;break}if(B>>>=4,k-=4,R=8+(15&B),0===e.wbits)e.wbits=R;else if(R>e.wbits){i.ij="invalid window size",e.mode=t;break}e.dmax=1<<e.wbits,i.adler=e.check=1,e.mode=512&B?10:Q,B=0,k=0;break;case 2:for(;k<16;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(e.flags=B,(255&e.flags)!==T){i.ij="unknown compression method",e.mode=t;break}if(57344&e.flags){i.ij="unknown header flags set",e.mode=t;break}e.head&&(e.head.text=B>>8&1),512&e.flags&&(c[0]=255&B,c[1]=B>>>8&255,e.check=E(e.check,c,2,0)),B=0,k=0,e.mode=3;case 3:for(;k<32;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}e.head&&(e.head.time=B),512&e.flags&&(c[0]=255&B,c[1]=B>>>8&255,c[2]=B>>>16&255,c[3]=B>>>24&255,e.check=E(e.check,c,4,0)),B=0,k=0,e.mode=4;case 4:for(;k<16;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}e.head&&(e.head.xflags=255&B,e.head.os=B>>8),512&e.flags&&(c[0]=255&B,c[1]=B>>>8&255,e.check=E(e.check,c,2,0)),B=0,k=0,e.mode=5;case 5:if(1024&e.flags){for(;k<16;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}e.length=B,e.head&&(e.head.extra_len=B),512&e.flags&&(c[0]=255&B,c[1]=B>>>8&255,e.check=E(e.check,c,2,0)),B=0,k=0}else e.head&&(e.head.extra=null);e.mode=6;case 6:if(1024&e.flags&&(n=e.length,n>l&&(n=l),n&&(e.head&&(R=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(S.subarray(w,w+n),R)),512&e.flags&&(e.check=E(e.check,S,n,w)),l-=n,w+=n,e.length-=n),e.length))break i;e.length=0,e.mode=7;case 7:if(2048&e.flags){if(0===l)break i;n=0;do{R=S[w+n++],e.head&&R&&e.length<65536&&(e.head.name+=String.fromCharCode(R))}while(R&&n<l);if(512&e.flags&&(e.check=E(e.check,S,n,w)),l-=n,w+=n,R)break i}else e.head&&(e.head.name=null);e.length=0,e.mode=8;case 8:if(4096&e.flags){if(0===l)break i;n=0;do{R=S[w+n++],e.head&&R&&e.length<65536&&(e.head.comment+=String.fromCharCode(R))}while(R&&n<l);if(512&e.flags&&(e.check=E(e.check,S,n,w)),l-=n,w+=n,R)break i}else e.head&&(e.head.comment=null);e.mode=9;case 9:if(512&e.flags){for(;k<16;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(B!==(65535&e.check)){i.ij="header crc mismatch",e.mode=t;break}B=0,k=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),i.adler=e.check=0,e.mode=Q;break;case 10:for(;k<32;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}i.adler=e.check=V(B),B=0,k=0,e.mode=11;case 11:if(0===e.havedict)return i.next_out=O,i.avail_out=Z,i.next_in=w,i.avail_in=l,e.hold=B,e.bits=k,K;i.adler=e.check=1,e.mode=Q;case Q:if(x===u||x===b)break i;case 13:if(e.last){B>>>=7&k,k-=7&k,e.mode=27;break}for(;k<3;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}switch(e.last=1&B,B>>>=1,k-=1,3&B){case 0:e.mode=14;break;case 1:if(N(e),e.mode=20,x===b){B>>>=2,k-=2;break i}break;case 2:e.mode=17;break;case 3:i.ij="invalid block type",e.mode=t}B>>>=2,k-=2;break;case 14:for(B>>>=7&k,k-=7&k;k<32;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if((65535&B)!==(B>>>16^65535)){i.ij="invalid stored block lengths",e.mode=t;break}if(e.length=65535&B,B=0,k=0,e.mode=15,x===b)break i;case 15:e.mode=16;case 16:if(n=e.length,n){if(n>l&&(n=l),n>Z&&(n=Z),0===n)break i;f.set(S.subarray(w,w+n),O),l-=n,w+=n,Z-=n,O+=n,e.length-=n;break}e.mode=Q;break;case 17:for(;k<14;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(e.nlen=257+(31&B),B>>>=5,k-=5,e.ndist=1+(31&B),B>>>=5,k-=5,e.ncode=4+(15&B),B>>>=4,k-=4,e.nlen>286||e.ndist>30){i.ij="too many length or distance symbols",e.mode=t;break}e.have=0,e.mode=18;case 18:for(;e.have<e.ncode;){for(;k<3;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}e.lens[W[e.have++]]=7&B,B>>>=3,k-=3}for(;e.have<19;)e.lens[W[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,P={bits:e.lenbits},y=Y(0,e.lens,0,19,e.lencode,0,e.work,P),e.lenbits=P.bits,y){i.ij="invalid code lengths set",e.mode=t;break}e.have=0,e.mode=19;case 19:for(;e.have<e.nlen+e.ndist;){for(;r=e.lencode[B&(1<<e.lenbits)-1],p=r>>>24,H=r>>>16&255,U=65535&r,!(p<=k);){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(U<16)B>>>=p,k-=p,e.lens[e.have++]=U;else{if(16===U){for(q=p+2;k<q;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(B>>>=p,k-=p,0===e.have){i.ij="invalid bit length repeat",e.mode=t;break}R=e.lens[e.have-1],n=3+(3&B),B>>>=2,k-=2}else if(17===U){for(q=p+3;k<q;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}B>>>=p,k-=p,R=0,n=3+(7&B),B>>>=3,k-=3}else{for(q=p+7;k<q;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}B>>>=p,k-=p,R=0,n=11+(127&B),B>>>=7,k-=7}if(e.have+n>e.nlen+e.ndist){i.ij="invalid bit length repeat",e.mode=t;break}for(;n--;)e.lens[e.have++]=R}}if(e.mode===t)break;if(0===e.lens[256]){i.ij="invalid code -- missing end-of-block",e.mode=t;break}if(e.lenbits=9,P={bits:e.lenbits},y=Y(1,e.lens,0,e.nlen,e.lencode,0,e.work,P),e.lenbits=P.bits,y){i.ij="invalid literal/lengths set",e.mode=t;break}if(e.distbits=6,e.distcode=e.distdyn,P={bits:e.distbits},y=Y(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,P),e.distbits=P.bits,y){i.ij="invalid distances set",e.mode=t;break}if(e.mode=20,x===b)break i;case 20:e.mode=21;case 21:if(l>=6&&Z>=258){i.next_out=O,i.avail_out=Z,i.next_in=w,i.avail_in=l,e.hold=B,e.bits=k,a(i,C),O=i.next_out,f=i.output,Z=i.avail_out,w=i.next_in,S=i.input,l=i.avail_in,B=e.hold,k=e.bits,e.mode===Q&&(e.back=-1);break}for(e.back=0;r=e.lencode[B&(1<<e.lenbits)-1],p=r>>>24,H=r>>>16&255,U=65535&r,!(p<=k);){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(H&&0===(240&H)){for(D=p,h=H,F=U;r=e.lencode[F+((B&(1<<D+h)-1)>>D)],p=r>>>24,H=r>>>16&255,U=65535&r,!(D+p<=k);){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}B>>>=D,k-=D,e.back+=D}if(B>>>=p,k-=p,e.back+=p,e.length=U,0===H){e.mode=26;break}if(32&H){e.back=-1,e.mode=Q;break}if(64&H){i.ij="invalid literal/length code",e.mode=t;break}e.extra=15&H,e.mode=22;case 22:if(e.extra){for(q=e.extra;k<q;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}e.length+=B&(1<<e.extra)-1,B>>>=e.extra,k-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=23;case 23:for(;r=e.distcode[B&(1<<e.distbits)-1],p=r>>>24,H=r>>>16&255,U=65535&r,!(p<=k);){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(0===(240&H)){for(D=p,h=H,F=U;r=e.distcode[F+((B&(1<<D+h)-1)>>D)],p=r>>>24,H=r>>>16&255,U=65535&r,!(D+p<=k);){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}B>>>=D,k-=D,e.back+=D}if(B>>>=p,k-=p,e.back+=p,64&H){i.ij="invalid distance code",e.mode=t;break}e.offset=U,e.extra=15&H,e.mode=24;case 24:if(e.extra){for(q=e.extra;k<q;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}e.offset+=B&(1<<e.extra)-1,B>>>=e.extra,k-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){i.ij="invalid distance too far back",e.mode=t;break}e.mode=25;case 25:if(0===Z)break i;if(n=C-Z,e.offset>n){if(n=e.offset-n,n>e.whave&&e.sane){i.ij="invalid distance too far back",e.mode=t;break}n>e.wnext?(n-=e.wnext,I=e.wsize-n):I=e.wnext-n,n>e.length&&(n=e.length),d=e.window}else d=f,I=O-e.offset,n=e.length;n>Z&&(n=Z),Z-=n,e.length-=n;do{f[O++]=d[I++]}while(--n);0===e.length&&(e.mode=21);break;case 26:if(0===Z)break i;f[O++]=e.length,Z--,e.mode=21;break;case 27:if(e.wrap){for(;k<32;){if(0===l)break i;l--,B|=S[w++]<<k,k+=8}if(C-=Z,i.total_out+=C,e.total+=C,C&&(i.adler=e.check=e.flags?E(e.check,f,C,O-C):j(e.check,f,C,O-C)),C=Z,(e.flags?B:V(B))!==e.check){i.ij="incorrect data check",e.mode=t;break}B=0,k=0}e.mode=28;case 28:if(e.wrap&&e.flags){for(;k<32;){if(0===l)break i;l--,B+=S[w++]<<k,k+=8}if(B!==(4294967295&e.total)){i.ij="incorrect length check",e.mode=t;break}B=0,k=0}e.mode=29;case 29:y=A;break i;case t:y=o;break i;case 31:return M;default:return L}return i.next_out=O,i.avail_out=Z,i.next_in=w,i.avail_in=l,e.hold=B,e.bits=k,(e.wsize||C!==i.avail_out&&e.mode<t&&(e.mode<27||x!==J))&&mi(i,i.output,i.next_out,C-i.avail_out)?(e.mode=31,M):(X-=i.avail_in,C-=i.avail_out,i.total_in+=X,i.total_out+=C,e.total+=C,e.wrap&&C&&(i.adler=e.check=e.flags?E(e.check,f,C,i.next_out-C):j(e.check,f,C,i.next_out-C)),i.data_type=e.bits+(e.last?64:0)+(e.mode===Q?128:0)+(20===e.mode||15===e.mode?256:0),(0===X&&0===C||x===J)&&y===g&&(y=z),y)},i.exports.inflateEnd=i=>{if(!i||!i.state)return L;let x=i.state;return x.window&&(x.window=null),i.state=null,g},i.exports.inflateGetHeader=(i,x)=>{if(!i||!i.state)return L;const e=i.state;return 0===(2&e.wrap)?L:(e.head=x,x.done=!1,g)},i.exports.inflateSetDictionary=(i,x)=>{const e=x.length;let E,a,Y;return i&&i.state?(E=i.state,0!==E.wrap&&11!==E.mode?L:11===E.mode&&(a=1,a=j(a,x,e,0),a!==E.check)?o:(Y=mi(i,x,e,e),Y?(E.mode=31,M):(E.havedict=1,g))):L},i.exports.inflateInfo="pako inflate (from Nodeca project)"},13413:i=>{"use strict";const x=15,e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),j=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),E=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),a=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);i.exports=(i,Y,J,u,b,g,A,K)=>{const L=K.bits;let o,M,z,T,Q,t,V=0,S=0,f=0,w=0,O=0,l=0,Z=0,B=0,k=0,N=0,mi=null,X=0;const C=new Uint16Array(16),n=new Uint16Array(16);let I,d,p,H=null,U=0;for(V=0;V<=x;V++)C[V]=0;for(S=0;S<u;S++)C[Y[J+S]]++;for(O=L,w=x;w>=1&&0===C[w];w--);if(O>w&&(O=w),0===w)return b[g++]=20971520,b[g++]=20971520,K.bits=1,0;for(f=1;f<w&&0===C[f];f++);for(O<f&&(O=f),B=1,V=1;V<=x;V++)if(B<<=1,B-=C[V],B<0)return-1;if(B>0&&(0===i||1!==w))return-1;for(n[1]=0,V=1;V<x;V++)n[V+1]=n[V]+C[V];for(S=0;S<u;S++)0!==Y[J+S]&&(A[n[Y[J+S]]++]=S);if(0===i?(mi=H=A,t=19):1===i?(mi=e,X-=257,H=j,U-=257,t=256):(mi=E,H=a,t=-1),N=0,S=0,V=f,Q=g,l=O,Z=0,z=-1,k=1<<O,T=k-1,1===i&&k>852||2===i&&k>592)return 1;for(;;){I=V-Z,A[S]<t?(d=0,p=A[S]):A[S]>t?(d=H[U+A[S]],p=mi[X+A[S]]):(d=96,p=0),o=1<<V-Z,M=1<<l,f=M;do{M-=o,b[Q+(N>>Z)+M]=I<<24|d<<16|p}while(0!==M);for(o=1<<V-1;N&o;)o>>=1;if(0!==o?(N&=o-1,N+=o):N=0,S++,0===--C[V]){if(V===w)break;V=Y[J+A[S]]}if(V>O&&(N&T)!==z){for(0===Z&&(Z=O),Q+=f,l=V-Z,B=1<<l;l+Z<w&&(B-=C[l+Z],!(B<=0));)l++,B<<=1;if(k+=1<<l,1===i&&k>852||2===i&&k>592)return 1;z=N&T,b[z]=O<<24|l<<16|Q-g}}return 0!==N&&(b[Q+N]=V-Z<<24|64<<16),K.bits=O,0}},13369:i=>{"use strict";i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},13356:i=>{"use strict";function x(i){let x=i.length;for(;--x>=0;)i[x]=0}const e=256,j=286,E=30,a=15,Y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),J=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),u=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),b=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new Array(576);x(g);const A=new Array(60);x(A);const K=new Array(512);x(K);const L=new Array(256);x(L);const o=new Array(29);x(o);const M=new Array(E);function z(i,x,e,j,E){this.static_tree=i,this.extra_bits=x,this.extra_base=e,this.elems=j,this.max_length=E,this.has_stree=i&&i.length}let T,Q,t;function V(i,x){this.dyn_tree=i,this.max_code=0,this.stat_desc=x}x(M);const S=i=>i<256?K[i]:K[256+(i>>>7)],f=(i,x)=>{i.pending_buf[i.pending++]=255&x,i.pending_buf[i.pending++]=x>>>8&255},w=(i,x,e)=>{i.bi_valid>16-e?(i.bi_buf|=x<<i.bi_valid&65535,f(i,i.bi_buf),i.bi_buf=x>>16-i.bi_valid,i.bi_valid+=e-16):(i.bi_buf|=x<<i.bi_valid&65535,i.bi_valid+=e)},O=(i,x,e)=>{w(i,e[2*x],e[2*x+1])},l=(i,x)=>{let e=0;do{e|=1&i,i>>>=1,e<<=1}while(--x>0);return e>>>1},Z=(i,x,e)=>{const j=new Array(16);let E,Y,J=0;for(E=1;E<=a;E++)j[E]=J=J+e[E-1]<<1;for(Y=0;Y<=x;Y++){let x=i[2*Y+1];0!==x&&(i[2*Y]=l(j[x]++,x))}},B=i=>{let x;for(x=0;x<j;x++)i.dyn_ltree[2*x]=0;for(x=0;x<E;x++)i.dyn_dtree[2*x]=0;for(x=0;x<19;x++)i.bl_tree[2*x]=0;i.dyn_ltree[512]=1,i.opt_len=i.static_len=0,i.last_lit=i.matches=0},k=i=>{i.bi_valid>8?f(i,i.bi_buf):i.bi_valid>0&&(i.pending_buf[i.pending++]=i.bi_buf),i.bi_buf=0,i.bi_valid=0},N=(i,x,e,j)=>{const E=2*x,a=2*e;return i[E]<i[a]||i[E]===i[a]&&j[x]<=j[e]},mi=(i,x,e)=>{const j=i.heap[e];let E=e<<1;for(;E<=i.heap_len&&(E<i.heap_len&&N(x,i.heap[E+1],i.heap[E],i.depth)&&E++,!N(x,j,i.heap[E],i.depth));)i.heap[e]=i.heap[E],e=E,E<<=1;i.heap[e]=j},X=(i,x,j)=>{let E,a,u,b,g=0;if(0!==i.last_lit)do{E=i.pending_buf[i.d_buf+2*g]<<8|i.pending_buf[i.d_buf+2*g+1],a=i.pending_buf[i.l_buf+g],g++,0===E?O(i,a,x):(u=L[a],O(i,u+e+1,x),b=Y[u],0!==b&&(a-=o[u],w(i,a,b)),E--,u=S(E),O(i,u,j),b=J[u],0!==b&&(E-=M[u],w(i,E,b)))}while(g<i.last_lit);O(i,256,x)},C=(i,x)=>{const e=x.dyn_tree,j=x.stat_desc.static_tree,E=x.stat_desc.has_stree,Y=x.stat_desc.elems;let J,u,b,g=-1;for(i.heap_len=0,i.heap_max=573,J=0;J<Y;J++)0!==e[2*J]?(i.heap[++i.heap_len]=g=J,i.depth[J]=0):e[2*J+1]=0;for(;i.heap_len<2;)b=i.heap[++i.heap_len]=g<2?++g:0,e[2*b]=1,i.depth[b]=0,i.opt_len--,E&&(i.static_len-=j[2*b+1]);for(x.max_code=g,J=i.heap_len>>1;J>=1;J--)mi(i,e,J);b=Y;do{J=i.heap[1],i.heap[1]=i.heap[i.heap_len--],mi(i,e,1),u=i.heap[1],i.heap[--i.heap_max]=J,i.heap[--i.heap_max]=u,e[2*b]=e[2*J]+e[2*u],i.depth[b]=(i.depth[J]>=i.depth[u]?i.depth[J]:i.depth[u])+1,e[2*J+1]=e[2*u+1]=b,i.heap[1]=b++,mi(i,e,1)}while(i.heap_len>=2);i.heap[--i.heap_max]=i.heap[1],((i,x)=>{const e=x.dyn_tree,j=x.max_code,E=x.stat_desc.static_tree,Y=x.stat_desc.has_stree,J=x.stat_desc.extra_bits,u=x.stat_desc.extra_base,b=x.stat_desc.max_length;let g,A,K,L,o,M,z=0;for(L=0;L<=a;L++)i.bl_count[L]=0;for(e[2*i.heap[i.heap_max]+1]=0,g=i.heap_max+1;g<573;g++)A=i.heap[g],L=e[2*e[2*A+1]+1]+1,L>b&&(L=b,z++),e[2*A+1]=L,A>j||(i.bl_count[L]++,o=0,A>=u&&(o=J[A-u]),M=e[2*A],i.opt_len+=M*(L+o),Y&&(i.static_len+=M*(E[2*A+1]+o)));if(0!==z){do{for(L=b-1;0===i.bl_count[L];)L--;i.bl_count[L]--,i.bl_count[L+1]+=2,i.bl_count[b]--,z-=2}while(z>0);for(L=b;0!==L;L--)for(A=i.bl_count[L];0!==A;)K=i.heap[--g],K>j||(e[2*K+1]!==L&&(i.opt_len+=(L-e[2*K+1])*e[2*K],e[2*K+1]=L),A--)}})(i,x),Z(e,g,i.bl_count)},n=(i,x,e)=>{let j,E,a=-1,Y=x[1],J=0,u=7,b=4;for(0===Y&&(u=138,b=3),x[2*(e+1)+1]=65535,j=0;j<=e;j++)E=Y,Y=x[2*(j+1)+1],++J<u&&E===Y||(J<b?i.bl_tree[2*E]+=J:0!==E?(E!==a&&i.bl_tree[2*E]++,i.bl_tree[32]++):J<=10?i.bl_tree[34]++:i.bl_tree[36]++,J=0,a=E,0===Y?(u=138,b=3):E===Y?(u=6,b=3):(u=7,b=4))},I=(i,x,e)=>{let j,E,a=-1,Y=x[1],J=0,u=7,b=4;for(0===Y&&(u=138,b=3),j=0;j<=e;j++)if(E=Y,Y=x[2*(j+1)+1],!(++J<u&&E===Y)){if(J<b)do{O(i,E,i.bl_tree)}while(0!==--J);else 0!==E?(E!==a&&(O(i,E,i.bl_tree),J--),O(i,16,i.bl_tree),w(i,J-3,2)):J<=10?(O(i,17,i.bl_tree),w(i,J-3,3)):(O(i,18,i.bl_tree),w(i,J-11,7));J=0,a=E,0===Y?(u=138,b=3):E===Y?(u=6,b=3):(u=7,b=4)}};let d=!1;const p=(i,x,e,j)=>{w(i,0+(j?1:0),3),((i,x,e,j)=>{k(i),j&&(f(i,e),f(i,~e)),i.pending_buf.set(i.window.subarray(x,x+e),i.pending),i.pending+=e})(i,x,e,!0)};i.exports._tr_init=i=>{d||((()=>{let i,x,e,b,V;const S=new Array(16);for(e=0,b=0;b<28;b++)for(o[b]=e,i=0;i<1<<Y[b];i++)L[e++]=b;for(L[e-1]=b,V=0,b=0;b<16;b++)for(M[b]=V,i=0;i<1<<J[b];i++)K[V++]=b;for(V>>=7;b<E;b++)for(M[b]=V<<7,i=0;i<1<<J[b]-7;i++)K[256+V++]=b;for(x=0;x<=a;x++)S[x]=0;for(i=0;i<=143;)g[2*i+1]=8,i++,S[8]++;for(;i<=255;)g[2*i+1]=9,i++,S[9]++;for(;i<=279;)g[2*i+1]=7,i++,S[7]++;for(;i<=287;)g[2*i+1]=8,i++,S[8]++;for(Z(g,287,S),i=0;i<E;i++)A[2*i+1]=5,A[2*i]=l(i,5);T=new z(g,Y,257,j,a),Q=new z(A,J,0,E,a),t=new z(new Array(0),u,0,19,7)})(),d=!0),i.l_desc=new V(i.dyn_ltree,T),i.d_desc=new V(i.dyn_dtree,Q),i.bl_desc=new V(i.bl_tree,t),i.bi_buf=0,i.bi_valid=0,B(i)},i.exports._tr_stored_block=p,i.exports._tr_flush_block=(i,x,j,E)=>{let a,Y,J=0;i.level>0?(2===i.strm.data_type&&(i.strm.data_type=(i=>{let x,j=4093624447;for(x=0;x<=31;x++,j>>>=1)if(1&j&&0!==i.dyn_ltree[2*x])return 0;if(0!==i.dyn_ltree[18]||0!==i.dyn_ltree[20]||0!==i.dyn_ltree[26])return 1;for(x=32;x<e;x++)if(0!==i.dyn_ltree[2*x])return 1;return 0})(i)),C(i,i.l_desc),C(i,i.d_desc),J=(i=>{let x;for(n(i,i.dyn_ltree,i.l_desc.max_code),n(i,i.dyn_dtree,i.d_desc.max_code),C(i,i.bl_desc),x=18;x>=3&&0===i.bl_tree[2*b[x]+1];x--);return i.opt_len+=3*(x+1)+5+5+4,x})(i),a=i.opt_len+3+7>>>3,Y=i.static_len+3+7>>>3,Y<=a&&(a=Y)):a=Y=j+5,j+4<=a&&-1!==x?p(i,x,j,E):4===i.strategy||Y===a?(w(i,2+(E?1:0),3),X(i,g,A)):(w(i,4+(E?1:0),3),((i,x,e,j)=>{let E;for(w(i,x-257,5),w(i,e-1,5),w(i,j-4,4),E=0;E<j;E++)w(i,i.bl_tree[2*b[E]+1],3);I(i,i.dyn_ltree,x-1),I(i,i.dyn_dtree,e-1)})(i,i.l_desc.max_code+1,i.d_desc.max_code+1,J+1),X(i,i.dyn_ltree,i.dyn_dtree)),B(i),E&&k(i)},i.exports._tr_tally=(i,x,j)=>(i.pending_buf[i.d_buf+2*i.last_lit]=x>>>8&255,i.pending_buf[i.d_buf+2*i.last_lit+1]=255&x,i.pending_buf[i.l_buf+i.last_lit]=255&j,i.last_lit++,0===x?i.dyn_ltree[2*j]++:(i.matches++,x--,i.dyn_ltree[2*(L[j]+e+1)]++,i.dyn_dtree[2*S(x)]++),i.last_lit===i.lit_bufsize-1),i.exports._tr_align=i=>{w(i,2,3),O(i,256,g),(i=>{16===i.bi_valid?(f(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)})(i)}},13391:i=>{"use strict";i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.ij="",this.state=null,this.data_type=2,this.adler=0}},13029:i=>{function x(i,x,e){for(var j=i.length,E=-1/0,a=1/0,Y=0;Y<j;Y++){var J=(e[0][Y]-i[Y])/x[Y],u=(e[1][Y]-i[Y])/x[Y];if(J>u){var b=J;J=u,u=b}if(u<E||J>a)return 1/0;J>E&&(E=J),u<a&&(a=u)}return E>a?1/0:E}i.exports=function(i,e,j,E){var a=x(e,j,E);if(a===1/0)i=null;else{i=i||[];for(var Y=0;Y<e.length;Y++)i[Y]=e[Y]+j[Y]*a}return i},i.exports.distance=x},14363:(i,x,e)=>{"use strict";e.d(x,{c:()=>Y});var j=e(34);const E=j.useLayoutEffect;const a=function(i){var x=(0,j.useRef)(i);return E((function(){x.current=i})),x};var Y=function(i){var x=a(i);(0,j.Ax)((function(){var i=function(i){var e;if(null!=x.current&&(e=x.current(i)),i.defaultPrevented&&(i.returnValue=""),"string"===typeof e)return i.returnValue=e,e};return window.addEventListener("beforeunload",i),function(){window.removeEventListener("beforeunload",i)}}),[])}},14317:(i,x,e)=>{"use strict";var j=e(14319),E=Array.prototype.concat,a=Array.prototype.slice,Y=i.exports=function(i){for(var x=[],e=0,Y=i.length;e<Y;e++){var J=i[e];j(J)?x=E.call(x,a.call(J)):x.push(J)}return x};Y.wrap=function(i){return function(){return i(Y(arguments))}}},14319:i=>{i.exports=function(i){return!(!i||"string"===typeof i)&&(i instanceof Array||Array.isArray(i)||i.length>=0&&(i.splice instanceof Function||Object.getOwnPropertyDescriptor(i,i.length-1)&&"String"!==i.constructor.name))}},13286:(i,x,e)=>{var j=e(13292);function E(i){for(var x,e,E=0,a=i.length,Y=0;Y<i.length;){for(x=i[Y],e=0;Y<a&&i[Y]===x;)++Y,++e;E+=j.log2(e)/7|0,E+=j.log2(x>>>0)/7|0,E+=2}return E}x.size=E,x.encode=function(i,x){x||(x=new Uint8Array(E(i)));for(var e,j,a=0,Y=x.length,J=0;J<i.length;){for(e=i[J],j=0;J<i.length&&i[J]===e;)++J,++j;for(;a<Y&&j>=128;)x[a++]=128+(127&j),j>>>=7;if(a>=Y)throw new Error("RLE buffer overflow");for(x[a++]=j,e>>>=0;a<Y&&e>=128;)x[a++]=128+(127&e),e>>>=7;if(a>=Y)throw new Error("RLE buffer overflow");x[a++]=e}return x},x.decode=function(i,x){for(var e,j,E,a,Y=x.length,J=i.length,u=0,b=0;b<J;){for(e=0,j=0;b<J&&i[b]>=128;)e+=(127&i[b++])<<j,j+=7;if(e+=i[b++]<<j,b>=J)throw new Error("RLE buffer underrun");if(u+e>Y)throw new Error("Chunk buffer overflow");for(E=0,j=0;b<J&&i[b]>=128;)E+=(127&i[b++])<<j,j+=7;if(b>=J)throw new Error("RLE buffer underrun");for(E+=i[b++]<<j,a=0;a<e;++a)x[u++]=E}return x}},13292:(i,x)=>{"use strict";function e(i){var x=32;return(i&=-i)&&x--,65535&i&&(x-=16),16711935&i&&(x-=8),252645135&i&&(x-=4),858993459&i&&(x-=2),1431655765&i&&(x-=1),x}x.INT_BITS=32,x.INT_MAX=2147483647,x.INT_MIN=-1<<31,x.sign=function(i){return(i>0)-(i<0)},x.abs=function(i){var x=i>>31;return(i^x)-x},x.min=function(i,x){return x^(i^x)&-(i<x)},x.max=function(i,x){return i^(i^x)&-(i<x)},x.isPow2=function(i){return!(i&i-1)&&!!i},x.log2=function(i){var x,e;return x=(i>65535)<<4,x|=e=((i>>>=x)>255)<<3,x|=e=((i>>>=e)>15)<<2,(x|=e=((i>>>=e)>3)<<1)|(i>>>=e)>>1},x.log10=function(i){return i>=1e9?9:i>=1e8?8:i>=1e7?7:i>=1e6?6:i>=1e5?5:i>=1e4?4:i>=1e3?3:i>=100?2:i>=10?1:0},x.popCount=function(i){return 16843009*((i=(858993459&(i-=i>>>1&1431655765))+(i>>>2&858993459))+(i>>>4)&252645135)>>>24},x.countTrailingZeros=e,x.nextPow2=function(i){return i+=0===i,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,(i|=i>>>16)+1},x.prevPow2=function(i){return i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,(i|=i>>>16)-(i>>>1)},x.parity=function(i){return i^=i>>>16,i^=i>>>8,i^=i>>>4,27030>>>(i&=15)&1};var j=new Array(256);!function(i){for(var x=0;x<256;++x){var e=x,j=x,E=7;for(e>>>=1;e;e>>>=1)j<<=1,j|=1&e,--E;i[x]=j<<E&255}}(j),x.reverse=function(i){return j[255&i]<<24|j[i>>>8&255]<<16|j[i>>>16&255]<<8|j[i>>>24&255]},x.interleave2=function(i,x){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i&=65535)|i<<8))|i<<4))|i<<2))|i<<1))|(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x&=65535)|x<<8))|x<<4))|x<<2))|x<<1))<<1},x.deinterleave2=function(i,x){return(i=65535&((i=16711935&((i=252645135&((i=858993459&((i=i>>>x&1431655765)|i>>>1))|i>>>2))|i>>>4))|i>>>16))<<16>>16},x.interleave3=function(i,x,e){return i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2),(i|=(x=1227133513&((x=3272356035&((x=251719695&((x=4278190335&((x&=1023)|x<<16))|x<<8))|x<<4))|x<<2))<<1)|(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<2},x.deinterleave3=function(i,x){return(i=1023&((i=4278190335&((i=251719695&((i=3272356035&((i=i>>>x&1227133513)|i>>>2))|i>>>4))|i>>>8))|i>>>16))<<22>>22},x.nextCombination=function(i){var x=i|i-1;return x+1|(~x&-~x)-1>>>e(i)+1}},13329:i=>{"use strict";i.exports=function(i,x,e,j){var E=self||window;try{try{var a;try{a=new E.Blob([i])}catch(b){(a=new(E.BlobBuilder||E.WebKitBlobBuilder||E.MozBlobBuilder||E.MSBlobBuilder)).append(i),a=a.getBlob()}var Y=E.URL||E.webkitURL,J=Y.createObjectURL(a),u=new E[x](J,e);return Y.revokeObjectURL(J),u}catch(b){return new E[x]("data:application/javascript,".concat(encodeURIComponent(i)),e)}}catch(b){if(!j)throw Error("Inline worker is not supported");return new E[x](j,e)}}},13014:(i,x,e)=>{"use strict";function j(i,x,e,j,E){var a={};return Object.keys(j).forEach((function(i){a[i]=j[i]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=e.slice().reverse().reduce((function(e,j){return j(i,x,e)||e}),a),E&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(E):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(i,x,a),a=null),a}e.d(x,{b:()=>j})},13009:(i,x,e)=>{"use strict";function j(i,x,e,j){e&&Object.defineProperty(i,x,{enumerable:e.enumerable,configurable:e.configurable,writable:e.writable,value:e.initializer?e.initializer.call(j):void 0})}e.d(x,{e:()=>j})},14347:(i,x,e)=>{"use strict";e.d(x,{e:()=>Y,g:()=>A,k:()=>J,n:()=>a,q:()=>u,u:()=>E,v:()=>b,z:()=>g});var j=e(12429);class E{constructor(){this._easingMode=E.EASINGMODE_EASEIN}setEasingMode(i){const x=Math.min(Math.max(i,0),2);this._easingMode=x}getEasingMode(){return this._easingMode}easeInCore(i){throw new Error("You must implement this method")}ease(i){switch(this._easingMode){case E.EASINGMODE_EASEIN:return this.easeInCore(i);case E.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-i)}return i>=.5?.5*(1-this.easeInCore(2*(1-i)))+.5:.5*this.easeInCore(2*i)}}E.EASINGMODE_EASEIN=0,E.EASINGMODE_EASEOUT=1,E.EASINGMODE_EASEINOUT=2;class a extends E{easeInCore(i){return i=Math.max(0,Math.min(1,i)),1-Math.sqrt(1-i*i)}}class Y extends E{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=i}easeInCore(i){const x=Math.max(0,this.amplitude);return Math.pow(i,3)-i*x*Math.sin(3.141592653589793*i)}}class J extends E{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=i,this.bounciness=x}easeInCore(i){const x=Math.max(0,this.bounces);let e=this.bounciness;e<=1&&(e=1.001);const j=Math.pow(e,x),E=1-e,a=(1-j)/E+.5*j,Y=i*a,J=Math.log(-Y*(1-e)+1)/Math.log(e),u=Math.floor(J),b=u+1,g=(1-Math.pow(e,u))/(E*a),A=.5*(g+(1-Math.pow(e,b))/(E*a)),K=i-A,L=A-g;return-Math.pow(1/e,x-u)/(L*L)*(K-L)*(K+L)}}class u extends E{easeInCore(i){return i*i*i}}class b extends E{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=i,this.springiness=x}easeInCore(i){let x;const e=Math.max(0,this.oscillations),j=Math.max(0,this.springiness);return x=0==j?i:(Math.exp(j*i)-1)/(Math.exp(j)-1),x*Math.sin((6.283185307179586*e+1.5707963267948966)*i)}}class g extends E{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=i}easeInCore(i){return this.exponent<=0?i:(Math.exp(this.exponent*i)-1)/(Math.exp(this.exponent)-1)}}class A extends E{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=i,this.y1=x,this.x2=e,this.y2=j}easeInCore(i){return j.b.Interpolate(i,this.x1,this.y1,this.x2,this.y2)}}},13800:(i,x,e)=>{"use strict";e.d(x,{c:()=>Y});var j=e(12250),E=e(12259),a=e(12639);class Y extends a.d{get _matrix(){return this._compose(),this.fL}set _matrix(i){(i.updateFlag!==this.fL.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.fL.A(i),this._markAsDirtyAndDecompose())}constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(i,x.wi(),!1),this.name=i,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=x,this.fL=(null===E||void 0===E?void 0:E.clone())??j.Matrix.Identity(),this._restMatrix=a??this.fL.clone(),this._bindMatrix=Y??this.fL.clone(),this._index=J,this._absoluteMatrix=new j.Matrix,this._absoluteBindMatrix=new j.Matrix,this._absoluteInverseBindMatrix=new j.Matrix,this._finalMatrix=new j.Matrix,x.bones.push(this),this.setParent(e,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(i){this.setParent(i)}setParent(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==i){if(this.parent){const i=this.parent.children.indexOf(this);-1!==i&&this.parent.children.splice(i,1)}this._parentNode=i,this.parent&&this.parent.children.push(this),x&&this._updateAbsoluteBindMatrices(),this.rg()}}getLocalMatrix(){return this._compose(),this.fL}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(i){this._restMatrix.A(i)}setRestPose(i){this.setRestMatrix(i)}getBindPose(){return this.getBindMatrix()}setBindMatrix(i){this.he(i)}setBindPose(i){this.setBindMatrix(i)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const i=j.TmpVectors.KJ[0],x=j.TmpVectors.Quaternion[0],e=j.TmpVectors.KJ[1];this.getRestMatrix().decompose(i,x,e),this._linkedTransformNode.position.A(e),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??j.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.A(x),this._linkedTransformNode.wJ.A(i)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(i){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=i,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.qJ}set position(i){this._decompose(),this.qJ.A(i),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(i){this.setRotation(i)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(i){this.setRotationQuaternion(i)}get wJ(){return this.getScale()}set wJ(i){this.setScale(i)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=j.KJ.Zero(),this._localRotation=j.Quaternion.Zero(),this.qJ=j.KJ.Zero()),this.fL.decompose(this._localScaling,this._localRotation,this.qJ))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,j.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.qJ,this.fL)):this._needToCompose=!1)}he(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.A(i),x&&this._updateAbsoluteBindMatrices(),e?this._matrix=i:this.rg()}_updateAbsoluteBindMatrices(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(i||(i=this._bindMatrix),this.parent?i.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.A(i),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),x)for(let e=0;e<this.children.length;e++)this.children[e]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}rg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.rg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.rg(),this._needToDecompose=!0}_updatePosition(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=this.getLocalMatrix();if(0==x)E?(a.addAtIndex(12,i.x),a.addAtIndex(13,i.y),a.addAtIndex(14,i.z)):a.setTranslationFromFloats(i.x,i.y,i.z);else{let x=null;e&&(x=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const J=Y._TmpMats[0],u=Y._TmpVecs[0];this.parent?e&&x?(J.A(this.parent.getAbsoluteMatrix()),J.multiplyToRef(x,J)):J.A(this.parent.getAbsoluteMatrix()):j.Matrix.IdentityToRef(J),E&&J.setTranslationFromFloats(0,0,0),J.invert(),j.KJ.TransformCoordinatesToRef(i,J,u),E?(a.addAtIndex(12,u.x),a.addAtIndex(13,u.y),a.addAtIndex(14,u.z)):a.setTranslationFromFloats(u.x,u.y,u.z)}this._markAsDirtyAndDecompose()}translate(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this._updatePosition(i,x,e,!0)}setPosition(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this._updatePosition(i,x,e,!1)}setAbsolutePosition(i,x){this.setPosition(i,1,x)}scale(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=this.getLocalMatrix(),J=Y._TmpMats[0];j.Matrix.ScalingToRef(i,x,e,J),J.multiplyToRef(a,a),J.invert();for(const j of this.children){const E=j.getLocalMatrix();E.multiplyToRef(J,E),E.multiplyAtIndex(12,i),E.multiplyAtIndex(13,x),E.multiplyAtIndex(14,e),j._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),E)for(const j of this.children)j.scale(i,x,e,E)}setScale(i){this._decompose(),this._localScaling.A(i),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(i){this._decompose(),i.A(this._localScaling)}setYawPitchRoll(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;if(0===E){const J=Y._TmpQuat;return j.Quaternion.RotationYawPitchRollToRef(i,x,e,J),void this.setRotationQuaternion(J,E,a)}const J=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(J,a))return;const u=Y._TmpMats[1];j.Matrix.RotationYawPitchRollToRef(i,x,e,u),J.multiplyToRef(u,u),this._rotateWithMatrix(u,E,a)}rotate(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;const a=Y._TmpMats[0];a.setTranslationFromFloats(0,0,0),j.Matrix.RotationAxisToRef(i,x,a),this._rotateWithMatrix(a,e,E)}setAxisAngle(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3?arguments[3]:void 0;if(0===e){const a=Y._TmpQuat;return j.Quaternion.RotationAxisToRef(i,x,a),void this.setRotationQuaternion(a,e,E)}const a=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(a,E))return;const J=Y._TmpMats[1];j.Matrix.RotationAxisToRef(i,x,J),a.multiplyToRef(J,J),this._rotateWithMatrix(J,e,E)}setRotation(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(i.y,i.x,i.z,x,e)}setRotationQuaternion(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(0===x)return this._decompose(),this._localRotation.A(i),void this._markAsDirtyAndCompose();const E=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,e))return;const a=Y._TmpMats[1];j.Matrix.FromQuaternionToRef(i,a),E.multiplyToRef(a,a),this._rotateWithMatrix(a,x,e)}setRotationMatrix(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(0===x){const E=Y._TmpQuat;return j.Quaternion.FromRotationMatrixToRef(i,E),void this.setRotationQuaternion(E,x,e)}const E=Y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(E,e))return;const a=Y._TmpMats[1];a.A(i),E.multiplyToRef(i,a),this._rotateWithMatrix(a,x,e)}_rotateWithMatrix(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;const j=this.getLocalMatrix(),E=j.m[12],a=j.m[13],J=j.m[14],u=this.getParent(),b=Y._TmpMats[3],g=Y._TmpMats[4];u&&1==x?(e?(b.A(e.getWorldMatrix()),u.getAbsoluteMatrix().multiplyToRef(b,b)):b.A(u.getAbsoluteMatrix()),g.A(b),g.invert(),j.multiplyToRef(b,j),j.multiplyToRef(i,j),j.multiplyToRef(g,j)):1==x&&e?(b.A(e.getWorldMatrix()),g.A(b),g.invert(),j.multiplyToRef(b,j),j.multiplyToRef(i,j),j.multiplyToRef(g,j)):j.multiplyToRef(i,j),j.setTranslationFromFloats(E,a,J),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(i,x){const e=Y._TmpMats[2];return i.A(this.getAbsoluteMatrix()),x?(i.multiplyToRef(x.getWorldMatrix(),i),j.Matrix.ScalingToRef(x.wJ.x,x.wJ.y,x.wJ.z,e)):j.Matrix.IdentityToRef(e),i.invert(),!isNaN(i.m[0])&&(e.multiplyAtIndex(0,this._scalingDeterminant),i.multiplyToRef(e,i),!0)}ie(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=j.KJ.Zero();return this.getPositionToRef(i,x,e),e}getPositionToRef(){let i=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const i=this.getLocalMatrix();x.x=i.m[12],x.y=i.m[13],x.z=i.m[14]}else{let e=null;i&&(e=i.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let j=Y._TmpMats[0];i&&e?(j.A(this.getAbsoluteMatrix()),j.multiplyToRef(e,j)):j=this.getAbsoluteMatrix(),x.x=j.m[12],x.y=j.m[13],x.z=j.m[14]}}getAbsolutePosition(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=j.KJ.Zero();return this.getPositionToRef(1,i,x),x}getAbsolutePositionToRef(i,x){this.getPositionToRef(1,i,x)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.fL.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.A(this.fL);const i=this._skeleton.getPoseMatrix();i&&this._absoluteMatrix.multiplyToRef(i,this._absoluteMatrix)}const i=this.children,x=i.length;for(let e=0;e<x;e++)i[e].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}fu(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=j.KJ.Zero();return this.getDirectionToRef(i,x,e),e}getDirectionToRef(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,E=null;x&&(E=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=Y._TmpMats[0];a.A(this.getAbsoluteMatrix()),x&&E&&a.multiplyToRef(E,a),j.KJ.TransformNormalToRef(i,a,e),e.normalize()}getRotation(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=j.KJ.Zero();return this.getRotationToRef(i,x,e),e}getRotationToRef(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;const j=Y._TmpQuat;this.getRotationQuaternionToRef(i,x,j),j.toEulerAnglesToRef(e)}getRotationQuaternion(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=j.Quaternion.Identity();return this.getRotationQuaternionToRef(i,x,e),e}getRotationQuaternionToRef(){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),x.A(this._localRotation);else{const e=Y._TmpMats[0],j=this.getAbsoluteMatrix();i?j.multiplyToRef(i.getWorldMatrix(),e):e.A(j),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.decompose(void 0,x,void 0)}}getRotationMatrix(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1?arguments[1]:void 0;const e=j.Matrix.Identity();return this.getRotationMatrixToRef(i,x,e),e}getRotationMatrixToRef(){let i=arguments.length>1?arguments[1]:void 0,x=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(x);else{const e=Y._TmpMats[0],j=this.getAbsoluteMatrix();i?j.multiplyToRef(i.getWorldMatrix(),e):e.A(j),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.getRotationMatrixToRef(x)}}getAbsolutePositionFromLocal(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=j.KJ.Zero();return this.getAbsolutePositionFromLocalToRef(i,x,e),e}getAbsolutePositionFromLocalToRef(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,E=null;x&&(E=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=Y._TmpMats[0];a.A(this.getAbsoluteMatrix()),x&&E&&a.multiplyToRef(E,a),j.KJ.TransformCoordinatesToRef(i,a,e)}getLocalPositionFromAbsolute(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=j.KJ.Zero();return this.getLocalPositionFromAbsoluteToRef(i,x,e),e}getLocalPositionFromAbsoluteToRef(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,E=null;x&&(E=x.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const a=Y._TmpMats[0];a.A(this.getAbsoluteMatrix()),x&&E&&a.multiplyToRef(E,a),a.invert(),j.KJ.TransformCoordinatesToRef(i,a,e)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const i=this._skeleton.bones.indexOf(this);if(-1!==i&&this._skeleton.bones.splice(i,1),this._parentNode&&this._parentNode.children){const i=this._parentNode.children,x=i.indexOf(this);-1!==x&&i.splice(x,1)}super.dispose()}}Y._TmpVecs=(0,E.d)(2,j.KJ.Zero),Y._TmpQuat=j.Quaternion.Identity(),Y._TmpMats=(0,E.d)(5,j.Matrix.Identity)},14345:(i,x,e)=>{"use strict";e.d(x,{e:()=>C});var j=e(12234),E=e(12236),a=e(12065),Y=e(12250),J=e(12264),u=e(12639),b=e(12675),g=e(12490),A=e(12089),K=e(12253);class L{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(i){this._zoomStopsAnimation=i}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(i){this._idleRotationSpeed=i}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(i){this._idleRotationWaitTime=i}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(i){this._idleRotationSpinupTime=i}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(i){this._attachedCamera=i;const x=this._attachedCamera.wi();this._onPrePointerObservableObserver=x.onPrePointerObservable.add((i=>{i.type!==g.e.POINTERDOWN?i.type===g.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const i=A.e.Now;let x=0;null!=this._lastFrameTime&&(x=i-this._lastFrameTime),this._lastFrameTime=i,this._applyUserInteraction();const e=i-this._lastInteractionTime-this._idleRotationWaitTime,j=Math.max(Math.min(e/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*j,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(x/1e3))}))}detach(){if(!this._attachedCamera)return;const i=this._attachedCamera.wi();this._onPrePointerObservableObserver&&i.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(i){this._lastInteractionTime=i??A.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<K.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let i=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(i=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?i:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=A.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var o=e(14347),M=e(12753);class z{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(i){if(this._autoTransitionRange===i)return;this._autoTransitionRange=i;const x=this._attachedCamera;x&&(i?this._onMeshTargetChangedObserver=x.onMeshTargetChangedObservable.add((i=>{if(i&&(i.Re(!0),i.getBoundingInfo)){const x=i.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*x,this.upperRadiusTransitionRange=.05*x}})):this._onMeshTargetChangedObserver&&x.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(i){this._attachedCamera=i,this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(i){return!!this._attachedCamera&&(this._attachedCamera.radius===i&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(i){if(!this._attachedCamera)return;this._radiusBounceTransition||(z.EasingFunction.setEasingMode(z.EasingMode),this._radiusBounceTransition=M.c.CreateAnimation("radius",M.c.ANIMATIONTYPE_FLOAT,60,z.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const x=M.c.TransitionTo("radius",this._attachedCamera.radius+i,this._attachedCamera,this._attachedCamera.wi(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));x&&this._animatables.push(x)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}z.EasingFunction=new o.e(.3),z.EasingMode=o.u.EASINGMODE_EASEOUT;class T{constructor(){this.onTargetFramingAnimationEndObservable=new a.b,this._mode=T.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(i){this._mode=i}get mode(){return this._mode}set radiusScale(i){this._radiusScale=i}get radiusScale(){return this._radiusScale}set positionScale(i){this._positionScale=i}get positionScale(){return this._positionScale}set defaultElevation(i){this._defaultElevation=i}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(i){this._elevationReturnTime=i}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(i){this._elevationReturnWaitTime=i}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(i){this._zoomStopsAnimation=i}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(i){this._framingTime=i}get framingTime(){return this._framingTime}init(){}attach(i){this._attachedCamera=i;const x=this._attachedCamera.wi();T.EasingFunction.setEasingMode(T.EasingMode),this._onPrePointerObservableObserver=x.onPrePointerObservable.add((i=>{i.type!==g.e.POINTERDOWN?i.type===g.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=i.onMeshTargetChangedObservable.add((i=>{i&&i.getBoundingInfo&&this.zoomOnMesh(i,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=i.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const i=this._attachedCamera.wi();this._onPrePointerObservableObserver&&i.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i.Re(!0);const j=i.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(j.minimumWorld,j.maximumWorld,x,e)}zoomOnMeshHierarchy(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i.Re(!0);const j=i.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(j.min,j.max,x,e)}zoomOnMeshesHierarchy(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new Y.KJ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),E=new Y.KJ(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let a=0;a<i.length;a++){const x=i[a].getHierarchyBoundingVectors(!0);Y.KJ.CheckExtends(x.min,j,E),Y.KJ.CheckExtends(x.max,j,E)}this.zoomOnBoundingInfo(j,E,x,e)}zoomOnBoundingInfo(i,x){let e,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const a=i.y,J=a+(x.y-a)*this._positionScale,u=x.Cx(i).scale(.5);if(!isFinite(J))return!1;if(j)e=new Y.KJ(0,J,0);else{const x=i.add(u);e=new Y.KJ(x.x,J,x.z)}this._vectorTransition||(this._vectorTransition=M.c.CreateAnimation("target",M.c.ANIMATIONTYPE_VECTOR3,60,T.EasingFunction)),this._betaIsAnimating=!0;let b=M.c.TransitionTo("target",e,this._attachedCamera,this._attachedCamera.wi(),60,this._vectorTransition,this._framingTime);b&&this._animatables.push(b);let g=0;if(this._mode===T.FitFrustumSidesMode){const e=this._calculateLowerRadiusFromModelBoundingSphere(i,x);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=u.length()+this._attachedCamera.De),g=e}else this._mode===T.IgnoreBoundsSizeMode&&(g=this._calculateLowerRadiusFromModelBoundingSphere(i,x),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.De));if(this.autoCorrectCameraLimitsAndSensibility){const e=x.Cx(i).length();this._attachedCamera.panningSensibility=5e3/e,this._attachedCamera.wheelPrecision=100/g}return this._radiusTransition||(this._radiusTransition=M.c.CreateAnimation("radius",M.c.ANIMATIONTYPE_FLOAT,60,T.EasingFunction)),b=M.c.TransitionTo("radius",g,this._attachedCamera,this._attachedCamera.wi(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),E&&E(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),b&&this._animatables.push(b),!0}_calculateLowerRadiusFromModelBoundingSphere(i,x){const e=this._attachedCamera;if(!e)return 0;let j=e._calculateLowerRadiusFromModelBoundingSphere(i,x,this._radiusScale);return e.lowerRadiusLimit&&this._mode===T.IgnoreBoundsSizeMode&&(j=j<e.lowerRadiusLimit?e.lowerRadiusLimit:j),e.upperRadiusLimit&&(j=j>e.upperRadiusLimit?e.upperRadiusLimit:j),j}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const i=A.e.Now-this._lastInteractionTime,x=.5*Math.PI-this._defaultElevation,e=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>e&&i>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=M.c.CreateAnimation("beta",M.c.ANIMATIONTYPE_FLOAT,60,T.EasingFunction));const i=M.c.TransitionTo("beta",x,this._attachedCamera,this._attachedCamera.wi(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));i&&this._animatables.push(i)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=A.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}T.EasingFunction=new o.z,T.EasingMode=o.u.EASINGMODE_EASEINOUT,T.IgnoreBoundsSizeMode=0,T.FitFrustumSidesMode=1;var Q=e(12677),t=e(12717),V=e(13796),S=e(12061);class f{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(i){i=S.Tools.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),e=x.getInputElement();let j=0,E=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=a=>{var Y,J;const u=a.event,b="touch"===u.pointerType;if(a.type!==g.e.POINTERMOVE&&-1===this.buttons.indexOf(u.button))return;const A=u.target;if(this._altKey=u.altKey,this._ctrlKey=u.ctrlKey,this._metaKey=u.metaKey,this._shiftKey=u.shiftKey,this._buttonsPressed=u.buttons,x.isPointerLock){const i=u.movementX,x=u.movementY;this.onTouch(null,i,x),this._pointA=null,this._pointB=null}else{if(a.type!==g.e.POINTERDOWN&&a.type!==g.e.POINTERDOUBLETAP&&b&&(null===(Y=this._pointA)||void 0===Y?void 0:Y.pointerId)!==u.pointerId&&(null===(J=this._pointB)||void 0===J?void 0:J.pointerId)!==u.pointerId)return;if(a.type!==g.e.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!b)if(a.type===g.e.POINTERDOUBLETAP)this.onDoubleTap(u.pointerType);else if(a.type!==g.e.POINTERUP||this._currentMousePointerIdDown!==u.pointerId&&!b){if(a.type===g.e.POINTERMOVE)if(i||u.preventDefault(),this._pointA&&null===this._pointB){const i=u.clientX-this._pointA.x,x=u.clientY-this._pointA.y;this._pointA.x=u.clientX,this._pointA.y=u.clientY,this.onTouch(this._pointA,i,x)}else if(this._pointA&&this._pointB){const i=this._pointA.pointerId===u.pointerId?this._pointA:this._pointB;i.x=u.clientX,i.y=u.clientY;const x=this._pointA.x-this._pointB.x,e=this._pointA.y-this._pointB.y,Y=x*x+e*e,J={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:u.pointerId,type:a.type};this.onMultiTouch(this._pointA,this._pointB,j,Y,E,J),E=J,j=Y}}else{try{null===A||void 0===A||A.releasePointerCapture(u.pointerId)}catch(K){}b||(this._pointB=null),x._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==u.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==u.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==j||E)&&(this.onMultiTouch(this._pointA,this._pointB,j,0,E,null),j=0,E=null),this._currentMousePointerIdDown=-1,this.onButtonUp(u),i||u.preventDefault()}else{try{null===A||void 0===A||A.setPointerCapture(u.pointerId)}catch(K){}if(null===this._pointA)this._pointA={x:u.clientX,y:u.clientY,pointerId:u.pointerId,type:u.pointerType};else{if(null!==this._pointB)return;this._pointB={x:u.clientX,y:u.clientY,pointerId:u.pointerId,type:u.pointerType}}-1!==this._currentMousePointerIdDown||b||(this._currentMousePointerIdDown=u.pointerId),this.onButtonDown(u),i||(u.preventDefault(),e&&e.focus())}}},this._observer=this.camera.wi()._inputManager._addCameraPointerObserver(this._pointerInput,g.e.POINTERDOWN|g.e.POINTERUP|g.e.POINTERMOVE|g.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,j=0,E=null,this.onLostFocus()},this._contextMenuBind=i=>this.onContextMenu(i),e&&e.addEventListener("contextmenu",this._contextMenuBind,!1);const a=this.camera.wi().getEngine().getHostWindow();a&&S.Tools.RegisterTopRootEvents(a,[{name:"blur",handler:this._onLostFocus}])}nK(){if(this._onLostFocus){const i=this.camera.wi().getEngine().getHostWindow();i&&S.Tools.UnregisterTopRootEvents(i,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.wi()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const i=this.camera.wi().getEngine().getInputElement();i&&i.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(i){}onTouch(i,x,e){}onMultiTouch(i,x,e,j,E,a){}onContextMenu(i){i.preventDefault()}onButtonDown(i){}onButtonUp(i){}onLostFocus(){}}(0,j.e)([(0,E.O)()],f.prototype,"buttons",void 0);class w extends f{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(i,x){if(0!==this.panningSensibility&&i&&x){const e=x.x-i.x,j=x.y-i.y;this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=j/this.panningSensibility}}_computePinchZoom(i,x){const e=this.camera.radius||w.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=e*Math.sqrt(i)/Math.sqrt(x):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(x-i)*e*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(x-i)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(i,x,e){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-x/this.panningSensibility,this.camera.inertialPanningY+=e/this.panningSensibility):(this.camera.inertialAlphaOffset-=x/this.angularSensibilityX,this.camera.inertialBetaOffset-=e/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(i,x,e,j,E,a){0===e&&null===E||0===j&&null===a||(this.multiTouchPanAndZoom?(this._computePinchZoom(e,j),this._computeMultiTouchPanning(E,a)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(j)-Math.sqrt(e))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(e,j),this._isPinching=!0):this._computeMultiTouchPanning(E,a)):this.multiTouchPanning?this._computeMultiTouchPanning(E,a):this.pinchZoom&&this._computePinchZoom(e,j))}onButtonDown(i){this._isPanClick=i.button===this.camera._panningMouseButton}onButtonUp(i){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}w.MinimumRadiusForPinch=.001,(0,j.e)([(0,E.O)()],w.prototype,"buttons",void 0),(0,j.e)([(0,E.O)()],w.prototype,"angularSensibilityX",void 0),(0,j.e)([(0,E.O)()],w.prototype,"angularSensibilityY",void 0),(0,j.e)([(0,E.O)()],w.prototype,"pinchPrecision",void 0),(0,j.e)([(0,E.O)()],w.prototype,"pinchDeltaPercentage",void 0),(0,j.e)([(0,E.O)()],w.prototype,"useNaturalPinchZoom",void 0),(0,j.e)([(0,E.O)()],w.prototype,"pinchZoom",void 0),(0,j.e)([(0,E.O)()],w.prototype,"panningSensibility",void 0),(0,j.e)([(0,E.O)()],w.prototype,"multiTouchPanning",void 0),(0,j.e)([(0,E.O)()],w.prototype,"multiTouchPanAndZoom",void 0),V.e.ArcRotateCameraPointersInput=w;var O=e(12495);class l{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(i){i=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.wi(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const e=x.event;if(!e.metaKey)if(x.type===O.d.KEYDOWN){if(this._ctrlPressed=e.ctrlKey,this._altPressed=e.altKey,-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysReset.indexOf(e.keyCode)){-1===this._keys.indexOf(e.keyCode)&&this._keys.push(e.keyCode),e.preventDefault&&(i||e.preventDefault())}}else if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysReset.indexOf(e.keyCode)){const x=this._keys.indexOf(e.keyCode);x>=0&&this._keys.splice(x,1),e.preventDefault&&(i||e.preventDefault())}})))}nK(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const i=this.camera;for(let x=0;x<this._keys.length;x++){const e=this._keys[x];-1!==this.keysLeft.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?i.inertialPanningX-=1/this.panningSensibility:i.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?i.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?i.inertialRadiusOffset+=1/this.zoomingSensibility:i.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?i.inertialPanningX+=1/this.panningSensibility:i.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?i.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?i.inertialRadiusOffset-=1/this.zoomingSensibility:i.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(e)&&i.useInputToRestoreState&&i.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,j.e)([(0,E.O)()],l.prototype,"keysUp",void 0),(0,j.e)([(0,E.O)()],l.prototype,"keysDown",void 0),(0,j.e)([(0,E.O)()],l.prototype,"keysLeft",void 0),(0,j.e)([(0,E.O)()],l.prototype,"keysRight",void 0),(0,j.e)([(0,E.O)()],l.prototype,"keysReset",void 0),(0,j.e)([(0,E.O)()],l.prototype,"panningSensibility",void 0),(0,j.e)([(0,E.O)()],l.prototype,"zoomingSensibility",void 0),(0,j.e)([(0,E.O)()],l.prototype,"useAltToZoom",void 0),(0,j.e)([(0,E.O)()],l.prototype,"angularSpeed",void 0),V.e.ArcRotateCameraKeyboardMoveInput=l;var Z=e(12295),B=e(12498);class k{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new Y.KJ(0,0,0),this._globalOffset=new Y.KJ(0,0,0),this._inertialPanning=Y.KJ.Zero()}_computeDeltaFromMouseWheelLegacyEvent(i,x){let e=0;const j=.01*i*this.wheelDeltaPercentage*x;return e=i>0?j/(1+this.wheelDeltaPercentage):j*(1+this.wheelDeltaPercentage),e}attachControl(i){i=S.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==g.e.POINTERWHEEL)return;const e=x.event;let j=0;const E=e.deltaMode===B.b.DOM_DELTA_LINE?40:1,a=-e.deltaY*E;if(this.customComputeDeltaFromMouseWheel)j=this.customComputeDeltaFromMouseWheel(a,this,e);else if(this.wheelDeltaPercentage){if(j=this._computeDeltaFromMouseWheelLegacyEvent(a,this.camera.radius),j>0){let i=this.camera.radius,x=this.camera.inertialRadiusOffset+j;for(let e=0;e<20&&!(i<=x)&&!(Math.abs(x*this.camera.inertia)<.001);e++)i-=x,x*=this.camera.inertia;i=(0,J.Clamp)(i,0,Number.MAX_VALUE),j=this._computeDeltaFromMouseWheelLegacyEvent(a,i)}}else j=a/(40*this.wheelPrecision);j&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(j)):this.camera.inertialRadiusOffset+=j),e.preventDefault&&(i||e.preventDefault())},this._observer=this.camera.wi()._inputManager._addCameraPointerObserver(this._wheel,g.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.OJ(0)}nK(){this._observer&&(this.camera.wi()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const i=this.camera;0+i.inertialAlphaOffset+i.inertialBetaOffset+i.inertialRadiusOffset&&(this._updateHitPlane(),i.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(i.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const i=this.camera,x=i.target.Cx(i.position);this._hitPlane=Z.e.FromPositionAndNormal(i.target,x)}_getPosition(){const i=this.camera,x=i.wi(),e=x.createPickingRay(x.pointerX,x.pointerY,Y.Matrix.Identity(),i,!1);0===i.targetScreenOffset.x&&0===i.targetScreenOffset.y||(this._viewOffset.set(i.targetScreenOffset.x,i.targetScreenOffset.y,0),i.getViewMatrix().invertToRef(i._cameraTransformMatrix),this._globalOffset=Y.KJ.TransformNormal(this._viewOffset,i._cameraTransformMatrix),e.origin.addInPlace(this._globalOffset));let j=0;return this._hitPlane&&(j=e.intersectsPlane(this._hitPlane)??0),e.origin.addInPlace(e.direction.scaleInPlace(j))}_zoomToMouse(i){const x=this.camera,e=1-x.inertia;if(x.lowerRadiusLimit){const j=x.lowerRadiusLimit??0;x.radius-(x.inertialRadiusOffset+i)/e<j&&(i=(x.radius-j)*e-x.inertialRadiusOffset)}if(x.upperRadiusLimit){const j=x.upperRadiusLimit??0;x.radius-(x.inertialRadiusOffset+i)/e>j&&(i=(x.radius-j)*e-x.inertialRadiusOffset)}const j=i/e/x.radius,E=this._getPosition(),a=Y.TmpVectors.KJ[6];E.subtractToRef(x.target,a),a.scaleInPlace(j),a.scaleInPlace(e),this._inertialPanning.addInPlace(a),x.inertialRadiusOffset+=i}_zeroIfClose(i){Math.abs(i.x)<K.e&&(i.x=0),Math.abs(i.y)<K.e&&(i.y=0),Math.abs(i.z)<K.e&&(i.z=0)}}(0,j.e)([(0,E.O)()],k.prototype,"wheelPrecision",void 0),(0,j.e)([(0,E.O)()],k.prototype,"zoomToMouseLocation",void 0),(0,j.e)([(0,E.O)()],k.prototype,"wheelDeltaPercentage",void 0),V.e.ArcRotateCameraMouseWheelInput=k;class N extends V.f{constructor(i){super(i)}addMouseWheel(){return this.add(new k),this}addPointers(){return this.add(new w),this}addKeyboard(){return this.add(new l),this}}var mi=e(12204);function X(i,x){return isNaN(i)?x:i}u.d.AddNodeConstructor("ArcRotateCamera",((i,x)=>()=>new C(i,0,0,1,Y.KJ.Zero(),x)));class C extends t.d{get target(){return this._target}set target(i){this.setTarget(i)}get targetHost(){return this._targetHost}set targetHost(i){i&&this.setTarget(i)}getTarget(){return this.target}get position(){return this._position}set position(i){this.setPosition(i)}set upVector(i){this._upToYMatrix||(this._yToUpMatrix=new Y.Matrix,this._upToYMatrix=new Y.Matrix,this._upVector=Y.KJ.Zero()),i.normalize(),this._upVector.A(i),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){Y.Matrix.RotationAlignToRef(Y.KJ.UpReadOnly,this._upVector,this._yToUpMatrix),Y.Matrix.RotationAlignToRef(this._upVector,Y.KJ.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const i=this.inputs.attached.pointers;return i?i.angularSensibilityX:0}set angularSensibilityX(i){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityX=i)}get angularSensibilityY(){const i=this.inputs.attached.pointers;return i?i.angularSensibilityY:0}set angularSensibilityY(i){const x=this.inputs.attached.pointers;x&&(x.angularSensibilityY=i)}get pinchPrecision(){const i=this.inputs.attached.pointers;return i?i.pinchPrecision:0}set pinchPrecision(i){const x=this.inputs.attached.pointers;x&&(x.pinchPrecision=i)}get pinchDeltaPercentage(){const i=this.inputs.attached.pointers;return i?i.pinchDeltaPercentage:0}set pinchDeltaPercentage(i){const x=this.inputs.attached.pointers;x&&(x.pinchDeltaPercentage=i)}get useNaturalPinchZoom(){const i=this.inputs.attached.pointers;return!!i&&i.useNaturalPinchZoom}set useNaturalPinchZoom(i){const x=this.inputs.attached.pointers;x&&(x.useNaturalPinchZoom=i)}get panningSensibility(){const i=this.inputs.attached.pointers;return i?i.panningSensibility:0}set panningSensibility(i){const x=this.inputs.attached.pointers;x&&(x.panningSensibility=i)}get keysUp(){const i=this.inputs.attached.keyboard;return i?i.keysUp:[]}set keysUp(i){const x=this.inputs.attached.keyboard;x&&(x.keysUp=i)}get keysDown(){const i=this.inputs.attached.keyboard;return i?i.keysDown:[]}set keysDown(i){const x=this.inputs.attached.keyboard;x&&(x.keysDown=i)}get keysLeft(){const i=this.inputs.attached.keyboard;return i?i.keysLeft:[]}set keysLeft(i){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=i)}get keysRight(){const i=this.inputs.attached.keyboard;return i?i.keysRight:[]}set keysRight(i){const x=this.inputs.attached.keyboard;x&&(x.keysRight=i)}get wheelPrecision(){const i=this.inputs.attached.mousewheel;return i?i.wheelPrecision:0}set wheelPrecision(i){const x=this.inputs.attached.mousewheel;x&&(x.wheelPrecision=i)}get zoomToMouseLocation(){const i=this.inputs.attached.mousewheel;return!!i&&i.zoomToMouseLocation}set zoomToMouseLocation(i){const x=this.inputs.attached.mousewheel;x&&(x.zoomToMouseLocation=i)}get wheelDeltaPercentage(){const i=this.inputs.attached.mousewheel;return i?i.wheelDeltaPercentage:0}set wheelDeltaPercentage(i){const x=this.inputs.attached.mousewheel;x&&(x.wheelDeltaPercentage=i)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(i){i!==this.useBouncingBehavior&&(i?(this._bouncingBehavior=new z,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(i){i!==this.useFramingBehavior&&(i?(this._framingBehavior=new T,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(i){i!==this.useAutoRotationBehavior&&(i?(this._autoRotationBehavior=new L,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(i,x,e,j,E,J){var u;let b=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(i,Y.KJ.Zero(),J,b),u=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=Y.KJ.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=Y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new Y.Matrix,this.panningAxis=new Y.KJ(1,1,0),this._transformedDirection=new Y.KJ,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new a.b,this.checkCollisions=!1,this.collisionRadius=new Y.KJ(.5,.5,.5),this._previousPosition=Y.KJ.Zero(),this._collisionVelocity=Y.KJ.Zero(),this._newPosition=Y.KJ.Zero(),this._computationVector=Y.KJ.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new Y.KJ(NaN,NaN,NaN),this._goalTargetScreenOffset=new Y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e?(u.setPosition(x),u.zo&&u.zo(e)):u._previousPosition.A(u._position);const j=Math.cos(u.alpha),E=Math.sin(u.alpha),a=Math.cos(u.beta);let Y=Math.sin(u.beta);0===Y&&(Y=1e-4);const J=u._getTargetPosition();u._computationVector.fJ(u.radius*j*Y,u.radius*a,u.radius*E*Y),J.addToRef(u._computationVector,u._newPosition),u._position.A(u._newPosition);let b=u.upVector;u.allowUpsideDown&&u.beta<0&&(b=b.clone(),b=b.negate()),u._computeViewMatrix(u._position,J,b),u._viewMatrix.addAtIndex(12,u.targetScreenOffset.x),u._viewMatrix.addAtIndex(13,u.targetScreenOffset.y),u._collisionTriggered=!1},this._target=Y.KJ.Zero(),E&&this.setTarget(E),this.alpha=x,this.beta=e,this.radius=j,this.getViewMatrix(),this.inputs=new N(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new Y.KJ(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=Y.Vector2.Zero()}_updateCache(i){i||super._updateCache(),this._cache._target.A(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.A(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const i=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?i.addToRef(this._targetBoundingCenter,this._target):this._target.A(i)}const i=this._getLockedTargetPosition();return i||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>K.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,a=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=a?this._currentInterpolationFactor=a:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=X(i,this._goalAlpha),this._goalBeta=X(x,this._goalBeta),this._goalRadius=X(e,this._goalRadius),this._goalTarget.set(X(j.x,this._goalTarget.x),X(j.y,this._goalTarget.y),X(j.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(X(E.x,this._goalTargetScreenOffset.x),X(E.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,J.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,J.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,J.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,J.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(i,x){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const E=arguments;x=S.Tools.BackCompatCameraNoPreventDefault(E),this._useCtrlForPanning=e,this._panningMouseButton=j,"boolean"===typeof E[0]&&(E.length>1&&(this._useCtrlForPanning=E[1]),E.length>2&&(this._panningMouseButton=E[2])),this.inputs.attachElement(x),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}nK(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let i=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){i=!0;const x=this.invertRotation?-1:1,e=this._calculateHandednessMultiplier();let j=this.inertialAlphaOffset*e;this.beta<0&&(j*=-1),this.alpha+=j*x,this.beta+=this.inertialBetaOffset*x,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<K.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<K.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*K.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){i=!0;const x=new Y.KJ(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),x.multiplyInPlace(this.panningAxis),Y.KJ.TransformNormalToRef(x,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const i=this.upVector,x=Y.KJ.CrossToRef(this._transformedDirection,i,this._transformedDirection);Y.KJ.CrossToRef(i,x,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);Y.KJ.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.A(this._transformedDirection)}else{if(this.parent){const i=Y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(i),i.transposeToRef(i),Y.KJ.TransformCoordinatesToRef(this._transformedDirection,i,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*K.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*K.e&&(this.inertialPanningY=0)}if(i)this.stopInterpolation();else if(this._isInterpolating){let i=!1;const x=this._scene.getEngine().getDeltaTime()/1e3,e=1-Math.pow(2,-x/this._currentInterpolationFactor),j=X(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const x=Y.TmpVectors.KJ[0].set(X(this._goalTarget.x,this._target.x),X(this._goalTarget.y,this._target.y),X(this._goalTarget.z,this._target.z));Y.KJ.LerpToRef(this.target,x,e,this._target),10*Y.KJ.Distance(this.target,x)/j<K.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.A(x),this.setTarget(this.target,!1,!0,!0)):i=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const x=Y.Quaternion.RotationAlphaBetaGammaToRef(X(this._goalAlpha,this.alpha),X(this._goalBeta,this.beta),0,Y.TmpVectors.Quaternion[0]),j=Y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,Y.TmpVectors.Quaternion[1]),E=Y.Quaternion.SlerpToRef(j,x,e,Y.TmpVectors.Quaternion[2]);E.normalize();const a=E.toAlphaBetaGammaToRef(Y.TmpVectors.KJ[0]);if(this.alpha=a.x,this.beta=a.y,E.isApprox(x,K.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const i=x.toAlphaBetaGammaToRef(Y.TmpVectors.KJ[0]);this.alpha=i.x,this.beta=i.y}else i=!0}if(isNaN(this._goalRadius)||(this.radius+=(j-this.radius)*e,Math.abs(j/this.radius-1)<K.e?(this._goalRadius=NaN,this.radius=j):i=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const x=Y.TmpVectors.Vector2[0].set(X(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),X(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));Y.Vector2.LerpToRef(this.targetScreenOffset,x,e,this.targetScreenOffset),Y.Vector2.Distance(this.targetScreenOffset,x)<K.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.A(x)):i=!0}this._isInterpolating=i}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.KJ.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const i=this.alpha;var x,e;this.alpha=function(i){let x=Math.PI/2;return 0===i.x&&0===i.z||(x=Math.acos(i.x/Math.sqrt(Math.pow(i.x,2)+Math.pow(i.z,2)))),i.z<0&&(x=2*Math.PI-x),x}(this._computationVector),this.beta=(x=this._computationVector.y,e=this.radius,Math.acos(x/e));const j=Math.round((i-this.alpha)/(2*Math.PI));this.alpha+=2*j*Math.PI,this._checkLimits()}setPosition(i){this._position.equals(i)||(this._position.A(i),this.rebuildAnglesAndRadius())}setTarget(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(j=this.overrideCloneAlphaBetaRadius??j,i.Re)x&&i.getBoundingInfo?this._targetBoundingCenter=i.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,i.Re(),this._targetHost=i,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const x=i,j=this._getTargetPosition();if(j&&!e&&j.equals(x))return;this._targetHost=null,this._target=x,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}j||this.rebuildAnglesAndRadius()}_getViewMatrix(){const i=Math.cos(this.alpha),x=Math.sin(this.alpha),e=Math.cos(this.beta);let j=Math.sin(this.beta);0===j&&(j=1e-4),0===this.radius&&(this.radius=1e-4);const E=this._getTargetPosition();if(this._computationVector.fJ(this.radius*i*j,this.radius*e,this.radius*x*j),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||Y.KJ.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),E.addToRef(this._computationVector,this._newPosition),this.wi().collisionsEnabled&&this.checkCollisions){const i=this.wi().collisionCoordinator;this._collider||(this._collider=i.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,i.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.A(this._newPosition);let i=this.upVector;this.allowUpsideDown&&j<0&&(i=i.negate()),this._computeViewMatrix(this._position,E,i),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.A(E),this._viewMatrix}zoomOn(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i=i||this.wi().meshes;const e=b.c.MinMax(i);let j=this._calculateLowerRadiusFromModelBoundingSphere(e.min,e.max);if(j=Math.max(Math.min(j,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=j*this.zoomOnFactor,this.mode===Q.b.ORTHOGRAPHIC_CAMERA){const i=this.wi().getEngine().getAspectRatio(this),x=j*this.zoomOnFactor/2;this.orthoLeft=-x*i,this.orthoRight=x*i,this.orthoBottom=-x,this.orthoTop=x}this.focusOn({min:e.min,max:e.max,distance:j},x)}focusOn(i){let x,e,j=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===i.min){const j=i||this.wi().meshes;x=b.c.MinMax(j),e=Y.KJ.Distance(x.min,x.max)}else{x=i,e=i.distance}this._target=b.c.Center(x),j||(this.maxZ=2*e)}createRigCamera(i,x){let e=0;switch(this.cameraRigMode){case Q.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case Q.b.RIG_MODE_VR:e=this._cameraRigParams.stereoHalfAngle*(0===x?1:-1);break;case Q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e=this._cameraRigParams.stereoHalfAngle*(0===x?-1:1)}const j=new C(i,this.alpha+e,this.beta,this.radius,this._target,this.wi());return j._cameraRigParams={},j.isRigCamera=!0,j.rigParent=this,j.upVector=this.upVector,j.mode=this.mode,j.orthoLeft=this.orthoLeft,j.orthoRight=this.orthoRight,j.orthoBottom=this.orthoBottom,j.orthoTop=this.orthoTop,j}_updateRigCameras(){const i=this._rigCameras[0],x=this._rigCameras[1];switch(i.beta=x.beta=this.beta,this.cameraRigMode){case Q.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Q.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Q.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case Q.b.RIG_MODE_VR:i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case Q.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,x.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const j=Y.KJ.Distance(i,x),E=this.wi().getEngine().getAspectRatio(this),a=Math.tan(this.fov/2),J=a*E,u=.5*j*e,b=u*Math.sqrt(1+1/(J*J)),g=u*Math.sqrt(1+1/(a*a));return Math.max(b,g)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,j.e)([(0,E.O)()],C.prototype,"alpha",void 0),(0,j.e)([(0,E.O)()],C.prototype,"beta",void 0),(0,j.e)([(0,E.O)()],C.prototype,"radius",void 0),(0,j.e)([(0,E.O)()],C.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,j.e)([(0,E.L)("target")],C.prototype,"_target",void 0),(0,j.e)([(0,E.w)("targetHost")],C.prototype,"_targetHost",void 0),(0,j.e)([(0,E.O)()],C.prototype,"inertialAlphaOffset",void 0),(0,j.e)([(0,E.O)()],C.prototype,"inertialBetaOffset",void 0),(0,j.e)([(0,E.O)()],C.prototype,"inertialRadiusOffset",void 0),(0,j.e)([(0,E.O)()],C.prototype,"lowerAlphaLimit",void 0),(0,j.e)([(0,E.O)()],C.prototype,"upperAlphaLimit",void 0),(0,j.e)([(0,E.O)()],C.prototype,"lowerBetaLimit",void 0),(0,j.e)([(0,E.O)()],C.prototype,"upperBetaLimit",void 0),(0,j.e)([(0,E.O)()],C.prototype,"lowerRadiusLimit",void 0),(0,j.e)([(0,E.O)()],C.prototype,"upperRadiusLimit",void 0),(0,j.e)([(0,E.O)()],C.prototype,"lowerTargetYLimit",void 0),(0,j.e)([(0,E.O)()],C.prototype,"inertialPanningX",void 0),(0,j.e)([(0,E.O)()],C.prototype,"inertialPanningY",void 0),(0,j.e)([(0,E.O)()],C.prototype,"pinchToPanMaxDistance",void 0),(0,j.e)([(0,E.O)()],C.prototype,"panningDistanceLimit",void 0),(0,j.e)([(0,E.L)()],C.prototype,"panningOriginTarget",void 0),(0,j.e)([(0,E.O)()],C.prototype,"panningInertia",void 0),(0,j.e)([(0,E.O)()],C.prototype,"zoomToMouseLocation",null),(0,j.e)([(0,E.O)()],C.prototype,"zoomOnFactor",void 0),(0,j.e)([(0,E.H)()],C.prototype,"targetScreenOffset",void 0),(0,j.e)([(0,E.O)()],C.prototype,"allowUpsideDown",void 0),(0,j.e)([(0,E.O)()],C.prototype,"useInputToRestoreState",void 0),(0,j.e)([(0,E.O)()],C.prototype,"restoreStateInterpolationFactor",void 0),(0,mi.f)("BABYLON.ArcRotateCamera",C)},13796:(i,x,e)=>{"use strict";e.d(x,{e:()=>Y,f:()=>J});var j=e(12072),E=e(12278),a=e(12677),Y={};class J{constructor(i){this.attachedToElement=!1,this.attached={},this.camera=i,this.checkInputs=()=>{}}add(i){const x=i.getSimpleName();this.attached[x]?j.c.Warn("camera input of type "+x+" already exists on camera"):(this.attached[x]=i,i.camera=this.camera,i.checkInputs&&(this.checkInputs=this._addCheckInputs(i.checkInputs.bind(i))),this.attachedToElement&&i.attachControl(this.noPreventDefault))}remove(i){for(const x in this.attached){const e=this.attached[x];if(e===i)return e.nK(),e.camera=null,delete this.attached[x],void this.rebuildInputCheck()}}removeByType(i){for(const x in this.attached){const e=this.attached[x];e.getClassName()===i&&(e.nK(),e.camera=null,delete this.attached[x],this.rebuildInputCheck())}}_addCheckInputs(i){const x=this.checkInputs;return()=>{x(),i()}}attachInput(i){this.attachedToElement&&i.attachControl(this.noPreventDefault)}attachElement(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){i=!a.b.ForceAttachControlToAlwaysPreventDefault&&i,this.attachedToElement=!0,this.noPreventDefault=i;for(const x in this.attached)this.attached[x].attachControl(i)}}detachElement(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const x in this.attached)this.attached[x].nK(),i&&(this.attached[x].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const i in this.attached){const x=this.attached[i];x.checkInputs&&(this.checkInputs=this._addCheckInputs(x.checkInputs.bind(x)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(i){const x={};for(const e in this.attached){const i=this.attached[e],j=E.b.Serialize(i);x[i.getClassName()]=j}i.inputsmgr=x}parse(i){const x=i.inputsmgr;if(x){this.clear();for(const i in x){const e=Y[i];if(e){const j=x[i],a=E.b.Parse((()=>new e),j,null);this.add(a)}}}else for(const e in this.attached){const x=Y[this.attached[e].getClassName()];if(x){const j=E.b.Parse((()=>new x),i,null);this.remove(this.attached[e]),this.add(j)}}}}},13793:(i,x,e)=>{"use strict";e.d(x,{b:()=>f});var j=e(12234),E=e(12236),a=e(12250),Y=e(12717),J=e(13796),u=e(12495),b=e(12061);class g{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(i){i=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.wi(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((x=>{const e=x.event;if(!e.metaKey)if(x.type===u.d.KEYDOWN){if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysUpward.indexOf(e.keyCode)||-1!==this.keysDownward.indexOf(e.keyCode)||-1!==this.keysRotateLeft.indexOf(e.keyCode)||-1!==this.keysRotateRight.indexOf(e.keyCode)||-1!==this.keysRotateUp.indexOf(e.keyCode)||-1!==this.keysRotateDown.indexOf(e.keyCode)){-1===this._keys.indexOf(e.keyCode)&&this._keys.push(e.keyCode),i||e.preventDefault()}}else if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysUpward.indexOf(e.keyCode)||-1!==this.keysDownward.indexOf(e.keyCode)||-1!==this.keysRotateLeft.indexOf(e.keyCode)||-1!==this.keysRotateRight.indexOf(e.keyCode)||-1!==this.keysRotateUp.indexOf(e.keyCode)||-1!==this.keysRotateDown.indexOf(e.keyCode)){const x=this._keys.indexOf(e.keyCode);x>=0&&this._keys.splice(x,1),i||e.preventDefault()}})))}nK(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const i=this.camera;for(let x=0;x<this._keys.length;x++){const e=this._keys[x],j=i._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(e)?i._localDirection.fJ(-j,0,0):-1!==this.keysUp.indexOf(e)?i._localDirection.fJ(0,0,j):-1!==this.keysRight.indexOf(e)?i._localDirection.fJ(j,0,0):-1!==this.keysDown.indexOf(e)?i._localDirection.fJ(0,0,-j):-1!==this.keysUpward.indexOf(e)?i._localDirection.fJ(0,j,0):-1!==this.keysDownward.indexOf(e)?i._localDirection.fJ(0,-j,0):-1!==this.keysRotateLeft.indexOf(e)?(i._localDirection.fJ(0,0,0),i.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(e)?(i._localDirection.fJ(0,0,0),i.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(e)?(i._localDirection.fJ(0,0,0),i.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(e)&&(i._localDirection.fJ(0,0,0),i.cameraRotation.x+=this._getLocalRotation()),i.wi().useRightHandedSystem&&(i._localDirection.z*=-1),i.getViewMatrix().invertToRef(i._cameraTransformMatrix),a.KJ.TransformNormalToRef(i._localDirection,i._cameraTransformMatrix,i._transformedDirection),i.cameraDirection.addInPlace(i._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const i=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*i}}(0,j.e)([(0,E.O)()],g.prototype,"keysUp",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysUpward",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysDown",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysDownward",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysLeft",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysRight",void 0),(0,j.e)([(0,E.O)()],g.prototype,"rotationSpeed",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysRotateLeft",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysRotateRight",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysRotateUp",void 0),(0,j.e)([(0,E.O)()],g.prototype,"keysRotateDown",void 0),J.e.FreeCameraKeyboardMoveInput=g;var A=e(12065),K=e(12490);class L{constructor(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=i,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new A.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(i){i=b.Tools.BackCompatCameraNoPreventDefault(arguments);const x=this.camera.getEngine(),e=x.getInputElement();this._pointerInput||(this._pointerInput=j=>{const E=j.event,a="touch"===E.pointerType;if(!this.touchEnabled&&a)return;if(j.type!==K.e.POINTERMOVE&&-1===this.buttons.indexOf(E.button))return;const Y=E.target;if(j.type===K.e.POINTERDOWN){if(a&&-1!==this._activePointerId||!a&&-1!==this._currentActiveButton)return;this._activePointerId=E.pointerId;try{null===Y||void 0===Y||Y.setPointerCapture(E.pointerId)}catch(J){}-1===this._currentActiveButton&&(this._currentActiveButton=E.button),this._previousPosition={x:E.clientX,y:E.clientY},i||(E.preventDefault(),e&&e.focus()),x.isPointerLock&&this._onMouseMove&&this._onMouseMove(j.event)}else if(j.type===K.e.POINTERUP){if(a&&this._activePointerId!==E.pointerId||!a&&this._currentActiveButton!==E.button)return;try{null===Y||void 0===Y||Y.releasePointerCapture(E.pointerId)}catch(J){}this._currentActiveButton=-1,this._previousPosition=null,i||E.preventDefault(),this._activePointerId=-1}else if(j.type===K.e.POINTERMOVE&&(this._activePointerId===E.pointerId||!a))if(x.isPointerLock&&this._onMouseMove)this._onMouseMove(j.event);else if(this._previousPosition){const x=this.camera._calculateHandednessMultiplier(),e=(E.clientX-this._previousPosition.x)*x,j=E.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=e/this.angularSensibility,this.camera.cameraRotation.x+=j/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:e,offsetY:j}),this._previousPosition={x:E.clientX,y:E.clientY},i||E.preventDefault()}}),this._onMouseMove=e=>{if(!x.isPointerLock)return;const j=this.camera._calculateHandednessMultiplier(),E=e.movementX*j;this.camera.cameraRotation.y+=E/this.angularSensibility;const a=e.movementY;this.camera.cameraRotation.x+=a/this.angularSensibility,this._previousPosition=null,i||e.preventDefault()},this._observer=this.camera.wi()._inputManager._addCameraPointerObserver(this._pointerInput,K.e.POINTERDOWN|K.e.POINTERUP|K.e.POINTERMOVE),e&&(this._contextMenuBind=i=>this.onContextMenu(i),e.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(i){i.preventDefault()}nK(){if(this._observer){if(this.camera.wi()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const i=this.camera.getEngine().getInputElement();i&&i.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,j.e)([(0,E.O)()],L.prototype,"buttons",void 0),(0,j.e)([(0,E.O)()],L.prototype,"angularSensibility",void 0),J.e.FreeCameraMouseInput=L;var o,M=e(12498);class z{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new A.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(i){i=b.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=x=>{if(x.type!==K.e.POINTERWHEEL)return;const e=x.event,j=e.deltaMode===M.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*j*e.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*j*e.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*j*e.deltaZ/this._normalize,e.preventDefault&&(i||e.preventDefault())},this._observer=this.camera.wi()._inputManager._addCameraPointerObserver(this._wheel,K.e.POINTERWHEEL)}nK(){this._observer&&(this.camera.wi()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,j.e)([(0,E.O)()],z.prototype,"wheelPrecisionX",void 0),(0,j.e)([(0,E.O)()],z.prototype,"wheelPrecisionY",void 0),(0,j.e)([(0,E.O)()],z.prototype,"wheelPrecisionZ",void 0),function(i){i[i.MoveRelative=0]="MoveRelative",i[i.RotateRelative=1]="RotateRelative",i[i.MoveScene=2]="MoveScene"}(o||(o={}));class T extends z{constructor(){super(...arguments),this._moveRelative=a.KJ.Zero(),this._rotateRelative=a.KJ.Zero(),this._moveScene=a.KJ.Zero(),this._wheelXAction=o.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=o.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(i){null===i&&this._wheelXAction!==o.MoveRelative||(this._wheelXAction=o.MoveRelative,this._wheelXActionCoordinate=i)}get wheelXMoveRelative(){return this._wheelXAction!==o.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(i){null===i&&this._wheelYAction!==o.MoveRelative||(this._wheelYAction=o.MoveRelative,this._wheelYActionCoordinate=i)}get wheelYMoveRelative(){return this._wheelYAction!==o.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(i){null===i&&this._wheelZAction!==o.MoveRelative||(this._wheelZAction=o.MoveRelative,this._wheelZActionCoordinate=i)}get wheelZMoveRelative(){return this._wheelZAction!==o.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(i){null===i&&this._wheelXAction!==o.RotateRelative||(this._wheelXAction=o.RotateRelative,this._wheelXActionCoordinate=i)}get wheelXRotateRelative(){return this._wheelXAction!==o.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(i){null===i&&this._wheelYAction!==o.RotateRelative||(this._wheelYAction=o.RotateRelative,this._wheelYActionCoordinate=i)}get wheelYRotateRelative(){return this._wheelYAction!==o.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(i){null===i&&this._wheelZAction!==o.RotateRelative||(this._wheelZAction=o.RotateRelative,this._wheelZActionCoordinate=i)}get wheelZRotateRelative(){return this._wheelZAction!==o.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(i){null===i&&this._wheelXAction!==o.MoveScene||(this._wheelXAction=o.MoveScene,this._wheelXActionCoordinate=i)}get wheelXMoveScene(){return this._wheelXAction!==o.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(i){null===i&&this._wheelYAction!==o.MoveScene||(this._wheelYAction=o.MoveScene,this._wheelYActionCoordinate=i)}get wheelYMoveScene(){return this._wheelYAction!==o.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(i){null===i&&this._wheelZAction!==o.MoveScene||(this._wheelZAction=o.MoveScene,this._wheelZActionCoordinate=i)}get wheelZMoveScene(){return this._wheelZAction!==o.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.OJ(0),this._rotateRelative.OJ(0),this._moveScene.OJ(0),this._updateCamera(),this.camera.wi().useRightHandedSystem&&(this._moveRelative.z*=-1);const i=a.Matrix.Zero();this.camera.getViewMatrix().invertToRef(i);const x=a.KJ.Zero();a.KJ.TransformNormalToRef(this._moveRelative,i,x),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(x),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(i,x,e){if(0===i)return;if(null===x||null===e)return;let j=null;switch(x){case o.MoveRelative:j=this._moveRelative;break;case o.RotateRelative:j=this._rotateRelative;break;case o.MoveScene:j=this._moveScene}switch(e){case 0:j.set(i,0,0);break;case 1:j.set(0,i,0);break;case 2:j.set(0,0,i)}}}(0,j.e)([(0,E.O)()],T.prototype,"wheelXMoveRelative",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelYMoveRelative",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelZMoveRelative",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelXRotateRelative",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelYRotateRelative",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelZRotateRelative",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelXMoveScene",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelYMoveScene",null),(0,j.e)([(0,E.O)()],T.prototype,"wheelZMoveScene",null),J.e.FreeCameraMouseWheelInput=T;class Q{constructor(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=i,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=b.Tools.IsSafari()}attachControl(i){i=b.Tools.BackCompatCameraNoPreventDefault(arguments);let x=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=e=>{const j=e.event,E="mouse"===j.pointerType||this._isSafari&&"undefined"===typeof j.pointerType;if(this.allowMouse||!E)if(e.type===K.e.POINTERDOWN){if(i||j.preventDefault(),this._pointerPressed.push(j.pointerId),1!==this._pointerPressed.length)return;x={x:j.clientX,y:j.clientY}}else if(e.type===K.e.POINTERUP){i||j.preventDefault();const e=this._pointerPressed.indexOf(j.pointerId);if(-1===e)return;if(this._pointerPressed.splice(e,1),0!=e)return;x=null,this._offsetX=null,this._offsetY=null}else if(e.type===K.e.POINTERMOVE){if(i||j.preventDefault(),!x)return;if(0!=this._pointerPressed.indexOf(j.pointerId))return;this._offsetX=j.clientX-x.x,this._offsetY=-(j.clientY-x.y)}}),this._observer=this.camera.wi()._inputManager._addCameraPointerObserver(this._pointerInput,K.e.POINTERDOWN|K.e.POINTERUP|K.e.POINTERMOVE),this._onLostFocus){const i=this.camera.getEngine().getInputElement();i&&i.addEventListener("blur",this._onLostFocus)}}nK(){if(this._pointerInput){if(this._observer&&(this.camera.wi()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const i=this.camera.getEngine().getInputElement();i&&i.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const i=this.camera,x=i._calculateHandednessMultiplier();i.cameraRotation.y=x*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)i.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const x=i._computeLocalCameraSpeed(),e=new a.KJ(0,0,0!==this.touchMoveSensibility?x*this._offsetY/this.touchMoveSensibility:0);a.Matrix.RotationYawPitchRollToRef(i.rotation.y,i.rotation.x,0,i._cameraRotationMatrix),i.cameraDirection.addInPlace(a.KJ.TransformCoordinates(e,i._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,j.e)([(0,E.O)()],Q.prototype,"touchAngularSensibility",void 0),(0,j.e)([(0,E.O)()],Q.prototype,"touchMoveSensibility",void 0),J.e.FreeCameraTouchInput=Q;class t extends J.f{constructor(i){super(i),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new g),this}addMouse(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new L(i),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new T,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new Q),this}clear(){super.clear(),this._mouseInput=null}}var V=e(12204),S=e(12150);class f extends Y.d{get angularSensibility(){const i=this.inputs.attached.mouse;return i?i.angularSensibility:0}set angularSensibility(i){const x=this.inputs.attached.mouse;x&&(x.angularSensibility=i)}get keysUp(){const i=this.inputs.attached.keyboard;return i?i.keysUp:[]}set keysUp(i){const x=this.inputs.attached.keyboard;x&&(x.keysUp=i)}get keysUpward(){const i=this.inputs.attached.keyboard;return i?i.keysUpward:[]}set keysUpward(i){const x=this.inputs.attached.keyboard;x&&(x.keysUpward=i)}get keysDown(){const i=this.inputs.attached.keyboard;return i?i.keysDown:[]}set keysDown(i){const x=this.inputs.attached.keyboard;x&&(x.keysDown=i)}get keysDownward(){const i=this.inputs.attached.keyboard;return i?i.keysDownward:[]}set keysDownward(i){const x=this.inputs.attached.keyboard;x&&(x.keysDownward=i)}get keysLeft(){const i=this.inputs.attached.keyboard;return i?i.keysLeft:[]}set keysLeft(i){const x=this.inputs.attached.keyboard;x&&(x.keysLeft=i)}get keysRight(){const i=this.inputs.attached.keyboard;return i?i.keysRight:[]}set keysRight(i){const x=this.inputs.attached.keyboard;x&&(x.keysRight=i)}get keysRotateLeft(){const i=this.inputs.attached.keyboard;return i?i.keysRotateLeft:[]}set keysRotateLeft(i){const x=this.inputs.attached.keyboard;x&&(x.keysRotateLeft=i)}get keysRotateRight(){const i=this.inputs.attached.keyboard;return i?i.keysRotateRight:[]}set keysRotateRight(i){const x=this.inputs.attached.keyboard;x&&(x.keysRotateRight=i)}get keysRotateUp(){const i=this.inputs.attached.keyboard;return i?i.keysRotateUp:[]}set keysRotateUp(i){const x=this.inputs.attached.keyboard;x&&(x.keysRotateUp=i)}get keysRotateDown(){const i=this.inputs.attached.keyboard;return i?i.keysRotateDown:[]}set keysRotateDown(i){const x=this.inputs.attached.keyboard;x&&(x.keysRotateDown=i)}constructor(i,x,e){var j;super(i,x,e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),j=this,this.ellipsoid=new a.KJ(.5,1,.5),this.ellipsoidOffset=new a.KJ(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=a.KJ.Zero(),this._diffPosition=a.KJ.Zero(),this._newPosition=a.KJ.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;j._newPosition.A(x),j._newPosition.subtractToRef(j._oldPosition,j._diffPosition),j._diffPosition.length()>S.c.CollisionsEpsilon&&(j.position.addToRef(j._diffPosition,j._deferredPositionUpdate),j._deferOnly?j._deferredUpdated=!0:j.position.A(j._deferredPositionUpdate),j.zo&&e&&j.zo(e))},this.inputs=new t(this),this.inputs.addKeyboard().addMouse()}attachControl(i,x){x=b.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(x)}nK(){this.inputs.detachElement(),this.cameraDirection=new a.KJ(0,0,0),this.cameraRotation=new a.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(i){this._collisionMask=isNaN(i)?-1:i}_collideWithWorld(i){let x;x=this.parent?a.KJ.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,x.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const e=this.wi().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let j=i;this.applyGravity&&(j=i.add(this.wi().gravity)),e.getNewPosition(this._oldPosition,j,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=a.KJ.Zero(),this._transformedDirection=a.KJ.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(i){this._needMoveForGravity=i}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.wi().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"eb"}}(0,j.e)([(0,E.L)()],f.prototype,"ellipsoid",void 0),(0,j.e)([(0,E.L)()],f.prototype,"ellipsoidOffset",void 0),(0,j.e)([(0,E.O)()],f.prototype,"checkCollisions",void 0),(0,j.e)([(0,E.O)()],f.prototype,"applyGravity",void 0),(0,V.f)("BABYLON.FreeCamera",f)},14404:(i,x,e)=>{"use strict";e.d(x,{e:()=>a});var j=e(12334),E=e(14412);class a{constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=e,this.sA=[],this._maxBlockCapacity=x||64,this._selectionContent=new j.b(1024),this._creationFunc=i}update(i,x,e){E.b._CreateBlocks(i,x,e,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}YA(i){for(let x=0;x<this.QA.length;x++){this.QA[x].addEntry(i)}}aA(i){for(let x=0;x<this.QA.length;x++){this.QA[x].removeEntry(i)}}select(i,x){this._selectionContent.reset();for(let e=0;e<this.QA.length;e++){this.QA[e].select(i,this._selectionContent,x)}return x?this._selectionContent.concat(this.sA):this._selectionContent.concatWithNoDuplicate(this.sA),this._selectionContent}intersects(i,x,e){this._selectionContent.reset();for(let j=0;j<this.QA.length;j++){this.QA[j].intersects(i,x,this._selectionContent,e)}return e?this._selectionContent.concat(this.sA):this._selectionContent.concatWithNoDuplicate(this.sA),this._selectionContent}intersectsRay(i){this._selectionContent.reset();for(let x=0;x<this.QA.length;x++){this.QA[x].intersectsRay(i,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.sA),this._selectionContent}}a.CreationFuncForMeshes=(i,x)=>{const e=i.getBoundingInfo();!i.isBlocked&&e.boundingBox.intersectsMinMax(x.EK,x.aK)&&x.entries.push(i)},a.CreationFuncForSubMeshes=(i,x)=>{i.getBoundingInfo().boundingBox.intersectsMinMax(x.EK,x.aK)&&x.entries.push(i)}},14412:(i,x,e)=>{"use strict";e.d(x,{b:()=>a});var j=e(12250),E=e(12557);class a{constructor(i,x,e,j,E,a){this.entries=[],this.YK=new Array,this._capacity=e,this._depth=j,this._maxDepth=E,this._creationFunc=a,this._minPoint=i,this._maxPoint=x,this.YK.push(i.clone()),this.YK.push(x.clone()),this.YK.push(i.clone()),this.YK[2].x=x.x,this.YK.push(i.clone()),this.YK[3].y=x.y,this.YK.push(i.clone()),this.YK[4].z=x.z,this.YK.push(x.clone()),this.YK[5].z=i.z,this.YK.push(x.clone()),this.YK[6].x=i.x,this.YK.push(x.clone()),this.YK[7].y=i.y}get Ue(){return this._capacity}get EK(){return this._minPoint}get aK(){return this._maxPoint}addEntry(i){if(this.QA)for(let x=0;x<this.QA.length;x++){this.QA[x].addEntry(i)}else this._creationFunc(i,this),this.entries.length>this.Ue&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(i){if(this.QA){for(let x=0;x<this.QA.length;x++){this.QA[x].removeEntry(i)}return}const x=this.entries.indexOf(i);x>-1&&this.entries.splice(x,1)}addEntries(i){for(let x=0;x<i.length;x++){const e=i[x];this.addEntry(e)}}select(i,x,e){if(E.b.IsInFrustum(this.YK,i)){if(this.QA){for(let j=0;j<this.QA.length;j++){this.QA[j].select(i,x,e)}return}e?x.concat(this.entries):x.concatWithNoDuplicate(this.entries)}}intersects(i,x,e,j){if(E.b.IntersectsSphere(this._minPoint,this._maxPoint,i,x)){if(this.QA){for(let E=0;E<this.QA.length;E++){this.QA[E].intersects(i,x,e,j)}return}j?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}}intersectsRay(i,x){if(i.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.QA){for(let e=0;e<this.QA.length;e++){this.QA[e].intersectsRay(i,x)}return}x.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){a._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(i,x,e,E,Y,J,u,b){u.QA=new Array;const g=new j.KJ((x.x-i.x)/2,(x.y-i.y)/2,(x.z-i.z)/2);for(let j=0;j<2;j++)for(let x=0;x<2;x++)for(let A=0;A<2;A++){const K=i.add(g.multiplyByFloats(j,x,A)),L=i.add(g.multiplyByFloats(j+1,x+1,A+1)),o=new a(K,L,E,Y+1,J,b);o.addEntries(e),u.QA.push(o)}}}},14418:(i,x,e)=>{"use strict";e.d(x,{d:()=>g});var j=e(12452),E=e(12250),a=e(12648),Y=e(13571),J=e(12482),u=e(14404),b=e(12108);j.d.prototype.createOrUpdateSelectionOctree=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=this._getComponent(J.c.NAME_OCTREE);e||(e=new g(this),this.Ye(e)),this.GA||(this.GA=new u.e(u.e.CreationFuncForMeshes,i,x));const j=this.getWorldExtends();return this.GA.update(j.min,j.max,this.meshes),this.GA},Object.defineProperty(j.d.prototype,"selectionOctree",{get:function(){return this.GA},enumerable:!0,configurable:!0}),a.e.prototype.createOrUpdateSubmeshesOctree=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const e=this.wi();let j=e._getComponent(J.c.NAME_OCTREE);j||(j=new g(e),e.Ye(j)),this._submeshesOctree||(this._submeshesOctree=new u.e(u.e.CreationFuncForSubMeshes,i,x)),this.Re(!0);const E=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(E.minimumWorld,E.maximumWorld,this.ne),this._submeshesOctree};class g{constructor(i){this.name=J.c.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new Y.b(E.KJ.Zero(),new E.KJ(1,1,1)),(i=i||b.e.LastCreatedScene)&&(this.LJ=i,this.LJ.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.LJ.getActiveSubMeshCandidates=i=>this.getActiveSubMeshCandidates(i),this.LJ.getCollidingSubMeshCandidates=(i,x)=>this.getCollidingSubMeshCandidates(i,x),this.LJ.getIntersectingSubMeshCandidates=(i,x)=>this.getIntersectingSubMeshCandidates(i,x))}register(){this.LJ.onMeshRemovedObservable.add((i=>{const x=this.LJ.selectionOctree;if(void 0!==x&&null!==x){const e=x.sA.indexOf(i);-1!==e&&x.sA.splice(e,1)}})),this.LJ.onMeshImportedObservable.add((i=>{const x=this.LJ.selectionOctree;void 0!==x&&null!==x&&x.YA(i)}))}getActiveMeshCandidates(){var i;return(null===(i=this.LJ.GA)||void 0===i?void 0:i.select(this.LJ.frustumPlanes))||this.LJ._getDefaultMeshCandidates()}getActiveSubMeshCandidates(i){if(i._submeshesOctree&&i.useOctreeForRenderingSelection){return i._submeshesOctree.select(this.LJ.frustumPlanes)}return this.LJ._getDefaultSubMeshCandidates(i)}getIntersectingSubMeshCandidates(i,x){if(i._submeshesOctree&&i.useOctreeForPicking){Y.b.TransformToRef(x,i.getWorldMatrix(),this._tempRay);return i._submeshesOctree.intersectsRay(this._tempRay)}return this.LJ._getDefaultSubMeshCandidates(i)}getCollidingSubMeshCandidates(i,x){if(i._submeshesOctree&&i.useOctreeForCollisions){const e=x._velocityWorldLength+Math.max(x._radius.x,x._radius.y,x._radius.z);return i._submeshesOctree.intersects(x._basePointWorld,e)}return this.LJ._getDefaultSubMeshCandidates(i)}rebuild(){}dispose(){}}},13571:(i,x,e)=>{"use strict";e.d(x,{b:()=>L});var j=e(12452),E=e(12677),a=e(12253),Y=e(12250),J=e(12259),u=e(12546),b=e(12476),g=e(12108),A=e(12505);const K={internalPickerForMesh:void 0};class L{constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a.e;this.origin=i,this.direction=x,this.length=e,this.epsilon=j}clone(){return new L(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const j=L._TmpVector3[0].fJ(i.x-e,i.y-e,i.z-e),E=L._TmpVector3[1].fJ(x.x+e,x.y+e,x.z+e);let a,Y,J,u,b=0,g=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<j.x||this.origin.x>E.x)return!1}else if(a=1/this.direction.x,Y=(j.x-this.origin.x)*a,J=(E.x-this.origin.x)*a,J===-1/0&&(J=1/0),Y>J&&(u=Y,Y=J,J=u),b=Math.max(Y,b),g=Math.min(J,g),b>g)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<j.y||this.origin.y>E.y)return!1}else if(a=1/this.direction.y,Y=(j.y-this.origin.y)*a,J=(E.y-this.origin.y)*a,J===-1/0&&(J=1/0),Y>J&&(u=Y,Y=J,J=u),b=Math.max(Y,b),g=Math.min(J,g),b>g)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<j.z||this.origin.z>E.z)return!1}else if(a=1/this.direction.z,Y=(j.z-this.origin.z)*a,J=(E.z-this.origin.z)*a,J===-1/0&&(J=1/0),Y>J&&(u=Y,Y=J,J=u),b=Math.max(Y,b),g=Math.min(J,g),b>g)return!1;return!0}intersectsBox(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(i.minimum,i.maximum,x)}intersectsSphere(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=i.center.x-this.origin.x,j=i.center.y-this.origin.y,E=i.center.z-this.origin.z,a=e*e+j*j+E*E,Y=i.radius+x,J=Y*Y;if(a<=J)return!0;const u=e*this.direction.x+j*this.direction.y+E*this.direction.z;if(u<0)return!1;return a-u*u<=J}intersectsTriangle(i,x,e){const j=L._TmpVector3[0],E=L._TmpVector3[1],a=L._TmpVector3[2],J=L._TmpVector3[3],b=L._TmpVector3[4];x.subtractToRef(i,j),e.subtractToRef(i,E),Y.KJ.CrossToRef(this.direction,E,a);const g=Y.KJ.Dot(j,a);if(0===g)return null;const A=1/g;this.origin.subtractToRef(i,J);const K=Y.KJ.Dot(J,a)*A;if(K<-this.epsilon||K>1+this.epsilon)return null;Y.KJ.CrossToRef(J,j,b);const o=Y.KJ.Dot(this.direction,b)*A;if(o<-this.epsilon||K+o>1+this.epsilon)return null;const M=Y.KJ.Dot(E,b)*A;return M>this.length?null:new u.d(1-K-o,K,M)}intersectsPlane(i){let x;const e=Y.KJ.Dot(i.normal,this.direction);if(Math.abs(e)<9.99999997475243e-7)return null;{const j=Y.KJ.Dot(i.normal,this.origin);return x=(-i.d-j)/e,x<0?x<-9.99999997475243e-7?null:0:x}}intersectsAxis(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(i){case"y":{const i=(this.origin.y-x)/this.direction.y;return i>0?null:new Y.KJ(this.origin.x+this.direction.x*-i,x,this.origin.z+this.direction.z*-i)}case"x":{const i=(this.origin.x-x)/this.direction.x;return i>0?null:new Y.KJ(x,this.origin.y+this.direction.y*-i,this.origin.z+this.direction.z*-i)}case"z":{const i=(this.origin.z-x)/this.direction.z;return i>0?null:new Y.KJ(this.origin.x+this.direction.x*-i,this.origin.y+this.direction.y*-i,x)}default:return null}}intersectsMesh(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const J=Y.TmpVectors.Matrix[0];return i.getWorldMatrix().invertToRef(J),this._tmpRay?L.TransformToRef(this,J,this._tmpRay):this._tmpRay=L.Transform(this,J),i.intersects(this._tmpRay,x,e,j,E,a)}intersectsMeshes(i,x,e){e?e.length=0:e=[];for(let j=0;j<i.length;j++){const E=this.intersectsMesh(i[j],x);E.hit&&e.push(E)}return e.sort(this._comparePickingInfo),e}_comparePickingInfo(i,x){return i.distance<x.distance?-1:i.distance>x.distance?1:0}intersectionSegment(i,x,e){const j=this.origin,E=Y.TmpVectors.KJ[0],a=Y.TmpVectors.KJ[1],J=Y.TmpVectors.KJ[2],u=Y.TmpVectors.KJ[3];x.subtractToRef(i,E),this.direction.scaleToRef(L._Rayl,J),j.addToRef(J,a),i.subtractToRef(j,u);const b=Y.KJ.Dot(E,E),g=Y.KJ.Dot(E,J),A=Y.KJ.Dot(J,J),K=Y.KJ.Dot(E,u),o=Y.KJ.Dot(J,u),M=b*A-g*g;let z,T,Q=M,t=M;M<L._Smallnum?(z=0,Q=1,T=o,t=A):(z=g*o-A*K,T=b*o-g*K,z<0?(z=0,T=o,t=A):z>Q&&(z=Q,T=o+g,t=A)),T<0?(T=0,-K<0?z=0:-K>b?z=Q:(z=-K,Q=b)):T>t&&(T=t,-K+g<0?z=0:-K+g>b?z=Q:(z=-K+g,Q=b));const V=Math.abs(z)<L._Smallnum?0:z/Q,S=Math.abs(T)<L._Smallnum?0:T/t,f=Y.TmpVectors.KJ[4];J.scaleToRef(S,f);const w=Y.TmpVectors.KJ[5];E.scaleToRef(V,w),w.addInPlace(u);const O=Y.TmpVectors.KJ[6];w.subtractToRef(f,O);return S>0&&S<=this.length&&O.lengthSquared()<e*e?w.length():-1}update(i,x,e,j,E,a,J){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){L._RayDistant||(L._RayDistant=L.Zero()),L._RayDistant.unprojectRayToRef(i,x,e,j,Y.Matrix.IdentityReadOnly,a,J);const u=Y.TmpVectors.Matrix[0];E.invertToRef(u),L.TransformToRef(L._RayDistant,u,this)}else this.unprojectRayToRef(i,x,e,j,E,a,J);return this}static Zero(){return new L(Y.KJ.Zero(),Y.KJ.Zero())}static CreateNew(i,x,e,j,E,a,Y){return L.Zero().update(i,x,e,j,E,a,Y)}static CreateNewFromTo(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Y.Matrix.IdentityReadOnly;const j=new L(new Y.KJ(0,0,0),new Y.KJ(0,0,0));return L.CreateFromToToRef(i,x,j,e)}static CreateFromToToRef(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Y.Matrix.IdentityReadOnly;e.origin.A(i);const E=x.subtractToRef(i,e.direction),a=Math.sqrt(E.x*E.x+E.y*E.y+E.z*E.z);return e.length=a,e.direction.normalize(),L.TransformToRef(e,j,e)}static Transform(i,x){const e=new L(new Y.KJ(0,0,0),new Y.KJ(0,0,0));return L.TransformToRef(i,x,e),e}static TransformToRef(i,x,e){Y.KJ.TransformCoordinatesToRef(i.origin,x,e.origin),Y.KJ.TransformNormalToRef(i.direction,x,e.direction),e.length=i.length,e.epsilon=i.epsilon;const j=e.direction,E=j.length();if(0!==E&&1!==E){const i=1/E;j.x*=i,j.y*=i,j.z*=i,e.length*=E}return e}unprojectRayToRef(i,x,e,j,E,a,J){const u=Y.TmpVectors.Matrix[0];E.multiplyToRef(a,u),u.multiplyToRef(J,u),u.invert();const b=g.e.LastCreatedEngine,A=Y.TmpVectors.KJ[0];A.x=i/e*2-1,A.y=-(x/j*2-1),A.z=null!==b&&void 0!==b&&b.ue?1:null!==b&&void 0!==b&&b.isNDCHalfZRange?0:-1;const K=Y.TmpVectors.KJ[1].fJ(A.x,A.y,1-1e-8),L=Y.TmpVectors.KJ[2],o=Y.TmpVectors.KJ[3];Y.KJ._UnprojectFromInvertedMatrixToRef(A,u,L),Y.KJ._UnprojectFromInvertedMatrixToRef(K,u,o),this.origin.A(L),o.subtractToRef(L,this.direction),this.direction.normalize()}}function o(i,x,e,j,E){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const Y=L.Zero();return M(i,x,e,j,Y,E,a),Y}function M(i,x,e,j,E,a){let J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const b=i.getEngine();if(!a&&!(a=i.activeCamera))return i;const g=a.viewport,A=b.getRenderHeight(),{x:K,y:L,width:o,height:M}=g.toGlobal(b.getRenderWidth(),A),z=1/b.getHardwareScalingLevel();return x=x*z-K,e=e*z-(A-L-M),E.update(x,e,o,M,j||Y.Matrix.IdentityReadOnly,J?Y.Matrix.IdentityReadOnly:a.getViewMatrix(),a.getProjectionMatrix(),u),i}function z(i,x,e,j,E){if(!b.c)return i;const a=i.getEngine();if(!E&&!(E=i.activeCamera))throw new Error("Active camera not set");const J=E.viewport,u=a.getRenderHeight(),{x:g,y:A,width:K,height:L}=J.toGlobal(a.getRenderWidth(),u),o=Y.Matrix.Identity(),M=1/a.getHardwareScalingLevel();return x=x*M-g,e=e*M-(u-A-L),j.update(x,e,K,L,o,o,E.getProjectionMatrix()),i}function T(i,x,e,j,E,a,Y,J){const u=x(j,e.enableDistantPicking),b=e.intersects(u,E,Y,a,j,J);return b&&b.hit?!E&&null!=i&&b.distance>=i.distance?null:b:null}function Q(i,x,e,j,E,a){let J=null;const u=!!(i.activeCameras&&i.activeCameras.length>1&&i.cameraToUseForPointers!==i.activeCamera),g=i.cameraToUseForPointers||i.activeCamera,A=K.internalPickerForMesh||T;for(let b=0;b<i.meshes.length;b++){const K=i.meshes[b];if(e){if(!e(K,-1))continue}else if(!K.isEnabled()||!K.isVisible||!K.hu)continue;const L=u&&K.isWorldMatrixCameraDependent(),o=K.Re(L,g);if(K.hasThinInstances&&K.Kg){const i=A(J,x,K,o,!0,!0,a);if(i){if(E)return i;const u=Y.TmpVectors.Matrix[1],b=K.thinInstanceGetWorldMatrices();for(let i=0;i<b.length;i++){if(e&&!e(K,i))continue;b[i].multiplyToRef(o,u);const Y=A(J,x,K,u,j,E,a,!0);if(Y&&(J=Y,J.thinInstanceIndex=i,j))return J}}}else{const i=A(J,x,K,o,j,E,a);if(i&&(J=i,j))return J}}return J||new b.c}function t(i,x,e,j){if(!b.c)return null;const E=[],a=!!(i.activeCameras&&i.activeCameras.length>1&&i.cameraToUseForPointers!==i.activeCamera),J=i.cameraToUseForPointers||i.activeCamera,u=K.internalPickerForMesh||T;for(let b=0;b<i.meshes.length;b++){const g=i.meshes[b];if(e){if(!e(g,-1))continue}else if(!g.isEnabled()||!g.isVisible||!g.hu)continue;const A=a&&g.isWorldMatrixCameraDependent(),K=g.Re(A,J);if(g.hasThinInstances&&g.Kg){if(u(null,x,g,K,!0,!0,j)){const i=Y.TmpVectors.Matrix[1],a=g.thinInstanceGetWorldMatrices();for(let Y=0;Y<a.length;Y++){if(e&&!e(g,Y))continue;a[Y].multiplyToRef(K,i);const J=u(null,x,g,i,!1,!1,j,!0);J&&(J.thinInstanceIndex=Y,E.push(J))}}}else{const i=u(null,x,g,K,!1,!1,j);i&&E.push(i)}}return E}function V(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,j=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0;j||(j=i.getWorldMatrix()),x.length=e,E?x.origin.A(E):x.origin.A(i.position);const a=Y.TmpVectors.KJ[2];a.set(0,0,i._scene.useRightHandedSystem?-1:1);const J=Y.TmpVectors.KJ[3];return Y.KJ.TransformNormalToRef(a,j,J),Y.KJ.NormalizeToRef(J,x.direction),x}var S,f;L._TmpVector3=(0,J.d)(6,Y.KJ.Zero),L._RayDistant=L.Zero(),L._Smallnum=1e-8,L._Rayl=1e9,S=j.d,(f=E.b)&&(f.prototype.getForwardRay=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,x=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;return V(this,new L(Y.KJ.Zero(),Y.KJ.Zero(),i),i,x,e)},f.prototype.getForwardRayToRef=function(i){return V(this,i,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),S&&(A.d._IsPickingAvailable=!0,S.prototype.createPickingRay=function(i,x,e,j){return o(this,i,x,e,j,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),j.d.prototype.createPickingRayToRef=function(i,x,e,j,E){return M(this,i,x,e,j,E,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},j.d.prototype.createPickingRayInCameraSpace=function(i,x,e){return function(i,x,e,j){const E=L.Zero();return z(i,x,e,E,j),E}(this,i,x,e)},j.d.prototype.createPickingRayInCameraSpaceToRef=function(i,x,e,j){return z(this,i,x,e,j)},j.d.prototype.pickWithBoundingInfo=function(i,x,e,j,E){return function(i,x,e,j,E,a){if(!b.c)return null;const J=Q(i,(j=>(i._tempPickingRay||(i._tempPickingRay=L.Zero()),M(i,x,e,j,i._tempPickingRay,a||null),i._tempPickingRay)),j,E,!0);return J&&(J.ray=o(i,x,e,Y.Matrix.Identity(),a||null)),J}(this,i,x,e,j,E)},j.d.prototype.gJ=function(i,x,e,j,E,a){return function(i,x,e,j,E,a,J){const u=Q(i,((j,E)=>(i._tempPickingRay||(i._tempPickingRay=L.Zero()),M(i,x,e,j,i._tempPickingRay,a||null,!1,E),i._tempPickingRay)),j,E,!1,J);return u&&(u.ray=o(i,x,e,Y.Matrix.Identity(),a||null)),u}(this,i,x,e,j,E,a)},j.d.prototype.pickWithRay=function(i,x,e,j){return function(i,x,e,j,E){const a=Q(i,(e=>(i._pickWithRayInverseMatrix||(i._pickWithRayInverseMatrix=Y.Matrix.Identity()),e.invertToRef(i._pickWithRayInverseMatrix),i._cachedRayForTransform||(i._cachedRayForTransform=L.Zero()),L.TransformToRef(x,i._pickWithRayInverseMatrix,i._cachedRayForTransform),i._cachedRayForTransform)),e,j,!1,E);return a&&(a.ray=x),a}(this,i,x,e,j)},j.d.prototype.multiPick=function(i,x,e,j,E){return function(i,x,e,j,E,a){return t(i,(j=>o(i,x,e,j,E||null)),j,a)}(this,i,x,e,j,E)},j.d.prototype.multiPickWithRay=function(i,x,e){return function(i,x,e,j){return t(i,(e=>(i._pickWithRayInverseMatrix||(i._pickWithRayInverseMatrix=Y.Matrix.Identity()),e.invertToRef(i._pickWithRayInverseMatrix),i._cachedRayForTransform||(i._cachedRayForTransform=L.Zero()),L.TransformToRef(x,i._pickWithRayInverseMatrix,i._cachedRayForTransform),i._cachedRayForTransform)),e,j)}(this,i,x,e)}},13839:(i,x,e)=>{"use strict";var j=e(12181),E=e(12072),a=e(12115),Y=e(12213),J=e(12150),u=e(12194);J.c.prototype._partialLoadFile=function(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(i,(i=>{e[x]=i,e._internalCount++,6===e._internalCount&&j(e)}),void 0,void 0,!0,((i,x)=>{E&&i&&E(i.status+" "+i.statusText,x)}))},J.c.prototype._cascadeLoadFiles=function(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const E=[];E._internalCount=0;for(let a=0;a<6;a++)this._partialLoadFile(e[a],a,E,x,j)},J.c.prototype._cascadeLoadImgs=function(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5?arguments[5]:void 0;const Y=[];Y._internalCount=0;for(let J=0;J<6;J++)this._partialLoadImg(j[J],J,Y,i,x,e,E,a)},J.c.prototype._partialLoadImg=function(i,x,e,j,E,J){let u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7?arguments[7]:void 0;const g=(0,Y.b)();(0,a.r)(i,(i=>{e[x]=i,e._internalCount++,j&&j.removePendingData(g),6===e._internalCount&&J&&J(E,e)}),((i,x)=>{j&&j.removePendingData(g),u&&u(i,x)}),j?j.offlineProvider:null,b),j&&j.addPendingData(g)},J.c.prototype.createCubeTextureBase=function(i,x,e,a){let Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6?arguments[6]:void 0,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8],K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,o=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,z=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,T=arguments.length>14&&void 0!==arguments[14]&&arguments[14],Q=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const t=o||new j.b(this,7);t.isCube=!0,t.url=i,t.generateMipMaps=!a,t._lodGenerationScale=K,t._lodGenerationOffset=L,t._useSRGBBuffer=!!T&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!a),t!==o&&(t.label=i.substring(0,60)),this._doNotHandleContextLost||(t._extension=g,t._files=e,t._buffer=Q);const V=i;this._transformTextureUrl&&!o&&(i=this._transformTextureUrl(i));const S=g??function(i){const x=i.split("?")[0],e=x.lastIndexOf(".");return e>-1?x.substring(e).toLowerCase():""}(i),f=(0,u.e)(S),w=(i,x)=>{t.dispose(),J?J(i,x):i&&E.c.Warn(i)},O=(j,J)=>{i===V?j&&w(j.status+" "+j.statusText,J):(E.c.Warn(`Failed to load ${i}, falling back to the ${V}`),this.createCubeTextureBase(V,x,e,!!a,Y,w,b,g,A,K,L,t,M,z,T,Q))};if(f)f.then((j=>{const E=i=>{M&&M(t,i),j.loadCubeData(i,t,A,Y,((i,x)=>{w(i,x)}))};Q?E(Q):e&&6===e.length?j.supportCascades?this._cascadeLoadFiles(x,(i=>E(i.map((i=>new Uint8Array(i))))),e,w):w("Textures type does not support cascades."):this._loadFile(i,(i=>E(new Uint8Array(i))),void 0,void 0,!0,O)}));else{if(!e||0===e.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(x,t,((i,x)=>{z&&z(i,x)}),e,w)}return this._internalTexturesCache.push(t),t}},14421:(i,x,e)=>{"use strict";e(12072);var j=e(12363);e(12181),e(12318),e(12173),e(12405),e(12371);j.c},13868:(i,x,e)=>{"use strict";e.d(x,{d:()=>E});var j=e(12204);class E{constructor(i){this.value=this._toInt(i)}_toInt(i){return 0|i}add(i){return new E(this.value+i.value)}Cx(i){return new E(this.value-i.value)}multiply(i){return new E(Math.imul(this.value,i.value))}divide(i){return new E(this.value/i.value)}getClassName(){return E.ClassName}equals(i){return this.value===i.value}static FromValue(i){return new E(i)}toString(){return this.value.toString()}}E.ClassName="FlowGraphInteger",(0,j.f)("FlowGraphInteger",E)},13877:(i,x,e)=>{"use strict";e.d(x,{e:()=>E,f:()=>a});var j=e(12250);class E{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Ze=i}get m(){return this.Ze}transformVector(i){return this.transformVectorToRef(i,new j.Vector2)}transformVectorToRef(i,x){return x.x=i.x*this.Ze[0]+i.y*this.Ze[1],x.y=i.x*this.Ze[2]+i.y*this.Ze[3],x}de(){return this.toArray()}toArray(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<4;x++)i[x]=this.Ze[x];return i}AJ(i){for(let x=0;x<4;x++)this.Ze[x]=i[x];return this}multiplyToRef(i,x){const e=i.Ze,j=this.Ze,E=x.Ze;return E[0]=e[0]*j[0]+e[1]*j[2],E[1]=e[0]*j[1]+e[1]*j[3],E[2]=e[2]*j[0]+e[3]*j[2],E[3]=e[2]*j[1]+e[3]*j[3],x}multiply(i){return this.multiplyToRef(i,new E)}divideToRef(i,x){const e=this.Ze,j=i.Ze,E=x.Ze;return E[0]=e[0]/j[0],E[1]=e[1]/j[1],E[2]=e[2]/j[2],E[3]=e[3]/j[3],x}divide(i){return this.divideToRef(i,new E)}addToRef(i,x){const e=this.Ze,j=i.m,E=x.m;return E[0]=e[0]+j[0],E[1]=e[1]+j[1],E[2]=e[2]+j[2],E[3]=e[3]+j[3],x}add(i){return this.addToRef(i,new E)}subtractToRef(i,x){const e=this.Ze,j=i.m,E=x.m;return E[0]=e[0]-j[0],E[1]=e[1]-j[1],E[2]=e[2]-j[2],E[3]=e[3]-j[3],x}Cx(i){return this.subtractToRef(i,new E)}transpose(){const i=this.Ze;return new E([i[0],i[2],i[1],i[3]])}determinant(){const i=this.Ze;return i[0]*i[3]-i[1]*i[2]}inverse(){const i=this.determinant();if(0===i)throw new Error("Matrix is not invertible");const x=this.Ze,e=1/i;return new E([x[3]*e,-x[1]*e,-x[2]*e,x[0]*e])}equals(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.Ze,j=i.m;return 0===x?e[0]===j[0]&&e[1]===j[1]&&e[2]===j[2]&&e[3]===j[3]:Math.abs(e[0]-j[0])<x&&Math.abs(e[1]-j[1])<x&&Math.abs(e[2]-j[2])<x&&Math.abs(e[3]-j[3])<x}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Ze.join(", ")})`}}class a{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Ze=i}get m(){return this.Ze}transformVector(i){return this.transformVectorToRef(i,new j.KJ)}transformVectorToRef(i,x){const e=this.Ze;return x.x=i.x*e[0]+i.y*e[1]+i.z*e[2],x.y=i.x*e[3]+i.y*e[4]+i.z*e[5],x.z=i.x*e[6]+i.y*e[7]+i.z*e[8],x}multiplyToRef(i,x){const e=i.Ze,j=this.Ze,E=x.m;return E[0]=e[0]*j[0]+e[1]*j[3]+e[2]*j[6],E[1]=e[0]*j[1]+e[1]*j[4]+e[2]*j[7],E[2]=e[0]*j[2]+e[1]*j[5]+e[2]*j[8],E[3]=e[3]*j[0]+e[4]*j[3]+e[5]*j[6],E[4]=e[3]*j[1]+e[4]*j[4]+e[5]*j[7],E[5]=e[3]*j[2]+e[4]*j[5]+e[5]*j[8],E[6]=e[6]*j[0]+e[7]*j[3]+e[8]*j[6],E[7]=e[6]*j[1]+e[7]*j[4]+e[8]*j[7],E[8]=e[6]*j[2]+e[7]*j[5]+e[8]*j[8],x}multiply(i){return this.multiplyToRef(i,new a)}divideToRef(i,x){const e=this.Ze,j=i.m,E=x.m;return E[0]=e[0]/j[0],E[1]=e[1]/j[1],E[2]=e[2]/j[2],E[3]=e[3]/j[3],E[4]=e[4]/j[4],E[5]=e[5]/j[5],E[6]=e[6]/j[6],E[7]=e[7]/j[7],E[8]=e[8]/j[8],x}divide(i){return this.divideToRef(i,new a)}addToRef(i,x){const e=this.Ze,j=i.m,E=x.m;return E[0]=e[0]+j[0],E[1]=e[1]+j[1],E[2]=e[2]+j[2],E[3]=e[3]+j[3],E[4]=e[4]+j[4],E[5]=e[5]+j[5],E[6]=e[6]+j[6],E[7]=e[7]+j[7],E[8]=e[8]+j[8],x}add(i){return this.addToRef(i,new a)}subtractToRef(i,x){const e=this.Ze,j=i.m,E=x.m;return E[0]=e[0]-j[0],E[1]=e[1]-j[1],E[2]=e[2]-j[2],E[3]=e[3]-j[3],E[4]=e[4]-j[4],E[5]=e[5]-j[5],E[6]=e[6]-j[6],E[7]=e[7]-j[7],E[8]=e[8]-j[8],x}Cx(i){return this.subtractToRef(i,new a)}toArray(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let x=0;x<9;x++)i[x]=this.Ze[x];return i}de(){return this.toArray()}AJ(i){for(let x=0;x<9;x++)this.Ze[x]=i[x];return this}transpose(){const i=this.Ze;return new a([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]])}determinant(){const i=this.Ze;return i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6])}inverse(){const i=this.determinant();if(0===i)throw new Error("Matrix is not invertible");const x=this.Ze,e=1/i;return new a([(x[4]*x[8]-x[5]*x[7])*e,(x[2]*x[7]-x[1]*x[8])*e,(x[1]*x[5]-x[2]*x[4])*e,(x[5]*x[6]-x[3]*x[8])*e,(x[0]*x[8]-x[2]*x[6])*e,(x[2]*x[3]-x[0]*x[5])*e,(x[3]*x[7]-x[4]*x[6])*e,(x[1]*x[6]-x[0]*x[7])*e,(x[0]*x[4]-x[1]*x[3])*e])}equals(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.Ze,j=i.m;return 0===x?e[0]===j[0]&&e[1]===j[1]&&e[2]===j[2]&&e[3]===j[3]&&e[4]===j[4]&&e[5]===j[5]&&e[6]===j[6]&&e[7]===j[7]&&e[8]===j[8]:Math.abs(e[0]-j[0])<x&&Math.abs(e[1]-j[1])<x&&Math.abs(e[2]-j[2])<x&&Math.abs(e[3]-j[3])<x&&Math.abs(e[4]-j[4])<x&&Math.abs(e[5]-j[5])<x&&Math.abs(e[6]-j[6])<x&&Math.abs(e[7]-j[7])<x&&Math.abs(e[8]-j[8])<x}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Ze.join(", ")})`}}},13886:(i,x,e)=>{"use strict";var j;function E(i,x,e,j){switch(x){case"Animation":return j?i.animations.find((i=>i.uniqueId===e))??null:i.animations[e]??null;case"AnimationGroup":return j?i.animationGroups.find((i=>i.uniqueId===e))??null:i.animationGroups[e]??null;case"Mesh":return j?i.meshes.find((i=>i.uniqueId===e))??null:i.meshes[e]??null;case"Material":return j?i.materials.find((i=>i.uniqueId===e))??null:i.materials[e]??null;case"oA":return j?i.cameras.find((i=>i.uniqueId===e))??null:i.cameras[e]??null;case"Light":return j?i.lights.find((i=>i.uniqueId===e))??null:i.lights[e]??null;default:return null}}e.d(x,{d:()=>E}),function(i){i.Animation="Animation",i.AnimationGroup="AnimationGroup",i.Mesh="Mesh",i.Material="Material",i.oA="oA",i.Light="Light"}(j||(j={}))},13924:(i,x,e)=>{"use strict";e.d(x,{b:()=>E});var j=e(13930);class E extends j.b{constructor(i,x){if(super(i),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),x)for(const e of x)this._eventsSignalOutputs[e]=this._registerSignalOutput(e+"Event")}_executeOnTick(i){}_startPendingTasks(i){i._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(i),this._resetAfterCanceled(i)),this._preparePendingTasks(i),i._addPendingBlock(this),this.out._activateSignal(i),i._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(i){i._deleteExecutionVariable(this,"_initialized"),i._removePendingBlock(this)}}},13900:(i,x,e)=>{"use strict";e.d(x,{e:()=>b});var j=e(12213),E=e(12204),a=e(13906),Y=e(12065),J=e(13866);class u extends a.d{constructor(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:j.defaultValue,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(i,x,e),this.richType=j,this._defaultValue=E,this._optional=a,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new Y.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(i){this._isDisabled!==i&&(this._isDisabled=i,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(i,x){x._getConnectionValue(this)!==i&&(x._setConnectionValue(this,i),this.onValueChangedObservable.notifyObservers(i))}resetToDefaultValue(i){i._setConnectionValue(this,this._defaultValue)}connectTo(i){this._isDisabled||super.connectTo(i)}_getValueOrDefault(i){const x=i._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(x):x}getValue(i){if(1===this.connectionType){i._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(i);const x=this._getValueOrDefault(i);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}const x=this.isConnected()?this._connectedPoint[0].getValue(i):this._getValueOrDefault(i);return this._lastValue=x,this.richType.typeTransformer?this.richType.typeTransformer(x):x}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(i),i.richType={},this.richType.serialize(i.richType),i.optional=this._optional,(0,J.i)("defaultValue",this._defaultValue,i)}}(0,E.f)("FlowGraphDataConnection",u);class b{constructor(i){var x;this.config=i,this.uniqueId=(0,j.b)(),this.name=(null===(x=this.config)||void 0===x?void 0:x.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(i){}registerDataInput(i,x,e){const j=new u(i,0,this,x,e);return this.dataInputs.push(j),j}registerDataOutput(i,x,e){const j=new u(i,1,this,x,e);return this.dataOutputs.push(j),j}getDataInput(i){return this.dataInputs.find((x=>x.name===i))}getDataOutput(i){return this.dataOutputs.find((x=>x.name===i))}serialize(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.i;if(i.uniqueId=this.uniqueId,i.config={},this.config){const e=this.config,j=Object.keys(e);for(const E of j)x(E,e[E],i.config)}i.dataInputs=[],i.dataOutputs=[],i.className=this.getClassName();for(const e of this.dataInputs){const x={};e.serialize(x),i.dataInputs.push(x)}for(const e of this.dataOutputs){const x={};e.serialize(x),i.dataOutputs.push(x)}}deserialize(i){}_log(i,x,e){var j;null===(j=i.logger)||void 0===j||j.addLogItem({action:x,yx:e,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13906:(i,x,e)=>{"use strict";e.d(x,{d:()=>a});var j,E=e(12213);!function(i){i[i.Input=0]="Input",i[i.Output=1]="Output"}(j||(j={}));class a{constructor(i,x,e){this._ownerBlock=e,this._connectedPoint=[],this.uniqueId=(0,E.b)(),this.connectedPointIds=[],this.name=i,this._connectionType=x}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(i){if(this._connectionType===i._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||i._isSingularConnection()&&i._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(i),i._connectedPoint.push(this)}disconnectFrom(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this._connectedPoint.indexOf(i),j=i._connectedPoint.indexOf(this);-1!==e&&-1!==j&&(x&&this._connectedPoint.splice(e,1),i._connectedPoint.splice(j,1))}disconnectFromAll(){for(const i of this._connectedPoint)this.disconnectFrom(i,!1);this._connectedPoint.length=0}dispose(){for(const i of this._connectedPoint)this.disconnectFrom(i)}serialize(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.uniqueId=this.uniqueId,i.name=this.name,i._connectionType=this._connectionType,i.connectedPointIds=[],i.className=this.getClassName();for(const x of this._connectedPoint)i.connectedPointIds.push(x.uniqueId)}getClassName(){return"FGConnection"}deserialize(i){this.uniqueId=i.uniqueId,this.name=i.name,this._connectionType=i._connectionType,this.connectedPointIds=i.connectedPointIds}}},13859:(i,x,e)=>{"use strict";e.d(x,{e:()=>t});var j,E=e(12065),a=e(12234),Y=e(12236),J=e(12213),u=e(13866),b=e(13886),g=e(12072);!function(i){i.ExecuteBlock="ExecuteBlock",i.ExecuteEvent="ExecuteEvent",i.TriggerConnection="TriggerConnection",i.ContextVariableSet="ContextVariableSet",i.GlobalVariableSet="GlobalVariableSet",i.GlobalVariableDelete="GlobalVariableDelete",i.GlobalVariableGet="GlobalVariableGet",i.AddConnection="AddConnection",i.GetConnectionValue="GetConnectionValue",i.SetConnectionValue="SetConnectionValue",i.ActivateSignal="ActivateSignal",i.ContextVariableGet="ContextVariableGet"}(j||(j={}));class A{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(i){if(i.time||(i.time=Date.now()),this.log.push(i),this.logToConsole){var x;const e=null===(x=i.yx)||void 0===x?void 0:x.value;"object"===typeof e&&e.getClassName?g.c.Log(`[FGLog] ${i.className}:${i.uniqueId.split("-")[0]} ${i.action} - ${JSON.stringify(e.getClassName())}: ${e.toString()}`):g.c.Log(`[FGLog] ${i.className}:${i.uniqueId.split("-")[0]} ${i.action} - ${JSON.stringify(i.yx)}`)}}getItemsOfType(i){return this.log.filter((x=>x.action===i))}}class K{get enableLogging(){return this._enableLogging}set enableLogging(i){this._enableLogging!==i&&(this._enableLogging=i,this._enableLogging?(this.logger=new A,this.logger.logToConsole=!0):this.logger=null)}constructor(i){this.uniqueId=(0,J.b)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new E.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=i,this.assetsContext=i.assetsContext??i.LJ}hasVariable(i){return i in this._userVariables}setVariable(i,x){var e;this._userVariables[i]=x,null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",yx:{name:i,value:x}})}getAsset(i,x){return(0,b.d)(this.assetsContext,i,x)}getVariable(i){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",yx:{name:i,value:this._userVariables[i]}}),this._userVariables[i]}get userVariables(){return this._userVariables}wi(){return this._configuration.LJ}_getUniqueIdPrefixedName(i,x){return`${i.uniqueId}_${x}`}_getGlobalContextVariable(i,x){var e;return null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",yx:{name:i,defaultValue:x,possibleValue:this._globalContextVariables[i]}}),this._hasGlobalContextVariable(i)?this._globalContextVariables[i]:x}_setGlobalContextVariable(i,x){var e;null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",yx:{name:i,value:x}}),this._globalContextVariables[i]=x}_deleteGlobalContextVariable(i){var x;null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",yx:{name:i}}),delete this._globalContextVariables[i]}_hasGlobalContextVariable(i){return i in this._globalContextVariables}_setExecutionVariable(i,x,e){this._executionVariables[this._getUniqueIdPrefixedName(i,x)]=e}_getExecutionVariable(i,x,e){return this._hasExecutionVariable(i,x)?this._executionVariables[this._getUniqueIdPrefixedName(i,x)]:e}_deleteExecutionVariable(i,x){delete this._executionVariables[this._getUniqueIdPrefixedName(i,x)]}_hasExecutionVariable(i,x){return this._getUniqueIdPrefixedName(i,x)in this._executionVariables}_hasConnectionValue(i){return i.uniqueId in this._connectionValues}_setConnectionValue(i,x){var e;this._connectionValues[i.uniqueId]=x,null===(e=this.logger)||void 0===e||e.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",yx:{connectionPointId:i.uniqueId,value:x}})}_setConnectionValueByKey(i,x){this._connectionValues[i]=x}_getConnectionValue(i){var x;return null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",yx:{connectionPointId:i.uniqueId,value:this._connectionValues[i.uniqueId]}}),this._connectionValues[i.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(i){this._pendingBlocks.includes(i)||(this._pendingBlocks.push(i),this._pendingBlocks.sort(((i,x)=>i.priority-x.priority)))}_removePendingBlock(i){const x=this._pendingBlocks.indexOf(i);-1!==x&&this._pendingBlocks.splice(x,1)}_clearPendingBlocks(){for(const i of this._pendingBlocks)i._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(i){var x;this.onNodeExecutedObservable.notifyObservers(i),null===(x=this.logger)||void 0===x||x.addLogItem({time:Date.now(),className:i.getClassName(),uniqueId:i.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(i){this._setGlobalContextVariable("timeSinceStart",i.timeSinceStart),this._setGlobalContextVariable("deltaTime",i.deltaTime);for(const e of this._pendingBlocks){var x;null===(x=e._executeOnTick)||void 0===x||x.call(e,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.i;i.uniqueId=this.uniqueId,i._userVariables={};for(const j in this._userVariables)x(j,this._userVariables[j],i._userVariables);i._connectionValues={};for(const j in this._connectionValues)x(j,this._connectionValues[j],i._connectionValues);var e;this.assetsContext!==this.wi()&&(i._assetsContext={meshes:this.assetsContext.meshes.map((i=>i.id)),materials:this.assetsContext.materials.map((i=>i.id)),textures:this.assetsContext.textures.map((i=>i.name)),animations:this.assetsContext.animations.map((i=>i.name)),lights:this.assetsContext.lights.map((i=>i.id)),cameras:this.assetsContext.cameras.map((i=>i.id)),nL:null===(e=this.assetsContext.nL)||void 0===e?void 0:e.map((i=>i.name)),skeletons:this.assetsContext.skeletons.map((i=>i.id)),iL:this.assetsContext.iL.map((i=>i.name)),geometries:this.assetsContext.geometries.map((i=>i.id)),multiMaterials:this.assetsContext.multiMaterials.map((i=>i.id)),transformNodes:this.assetsContext.transformNodes.map((i=>i.id))})}getClassName(){return"FlowGraphContext"}}(0,a.e)([(0,Y.O)()],K.prototype,"uniqueId",void 0);var L=e(13895),o=e(12490);class M{constructor(i){this.onEventTriggeredObservable=new E.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=i,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.te.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const i=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",yx:{timeSinceStart:this._startingTime,deltaTime:i}}),this._startingTime+=i})),this._meshPickedObserver=this._scene.onPointerObservable.add((i=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",yx:i})}),o.e.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((i=>{const x=i.pointerId,e=i.mesh,j=this._pointerUnderMeshState[x];!j&&e?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",yx:{pointerId:x,mesh:e}}):j&&!e?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",yx:{pointerId:x,mesh:j}}):j&&e&&j!==e&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",yx:{pointerId:x,mesh:j,over:e}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",yx:{pointerId:x,mesh:e,out:j}})),this._pointerUnderMeshState[x]=e}),o.e.POINTERMOVE)}dispose(){var i,x,e,j,E;null===(i=this._sceneDisposeObserver)||void 0===i||i.remove(),null===(x=this._sceneReadyObserver)||void 0===x||x.remove(),null===(e=this._sceneOnBeforeRenderObserver)||void 0===e||e.remove(),null===(j=this._meshPickedObserver)||void 0===j||j.remove(),null===(E=this._meshUnderPointerObserver)||void 0===E||E.remove(),this.onEventTriggeredObservable.clear()}}var z,T=e(13912);!function(i){i[i.Stopped=0]="Stopped",i[i.Started=1]="Started"}(z||(z={}));class Q{get state(){return this._state}set state(i){this._state=i,this.onStateChangedObservable.notifyObservers(i)}constructor(i){this.onStateChangedObservable=new E.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=i.LJ,this._sceneEventCoordinator=new M(this._scene),this._coordinator=i.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((i=>{for(const x of this._executionContexts){const e=this._getContextualOrder(i.type,x);for(const j of e)if(!j._executeEvent(x,i.yx))break}switch(i.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const x of this._executionContexts)x._notifyOnTick(i.yx);break;case"SceneDispose":this.dispose()}}))}createContext(){const i=new K({LJ:this._scene,coordinator:this._coordinator});return this._executionContexts.push(i),i}getContext(i){return this._executionContexts[i]}addEventBlock(i){if("PointerOver"!==i.type&&"PointerOut"!==i.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==i.type&&this._eventBlocks[i.type].push(i),1===this.state)for(const x of this._executionContexts)i._startPendingTasks(x);else this.onStateChangedObservable.addOnce((x=>{if(1===x)for(const e of this._executionContexts)i._startPendingTasks(e)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((i=>{1===i&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const i of this._executionContexts)for(const x in this._eventBlocks){const e=this._getContextualOrder(x,i);for(const x of e)x._startPendingTasks(i)}}_getContextualOrder(i,x){const e=this._eventBlocks[i].sort(((i,x)=>x.initPriority-i.initPriority));if("MeshPick"===i){const i=[];for(const j of e){const E=j.asset.getValue(x);let a=0;for(;a<e.length;a++){const i=e[a].asset.getValue(x);if(E&&i&&(0,T.n)(E,i))break}i.splice(a,0,j)}return i}return e}dispose(){var i;if(0!==this.state){this.state=0;for(const i of this._executionContexts)i._clearPendingBlocks();this._executionContexts.length=0;for(const i in this._eventBlocks)this._eventBlocks[i].length=0;null===(i=this._eventObserver)||void 0===i||i.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(i){const x=[],e=new Set;for(const j in this._eventBlocks)for(const i of this._eventBlocks[j])x.push(i),e.add(i.uniqueId);for(;x.length>0;){const j=x.pop();i(j);for(const i of j.dataInputs)for(const j of i._connectedPoint)e.has(j._ownerBlock.uniqueId)||(x.push(j._ownerBlock),e.add(j._ownerBlock.uniqueId));if(j instanceof L.d)for(const i of j.signalOutputs)for(const j of i._connectedPoint)e.has(j._ownerBlock.uniqueId)||(x.push(j._ownerBlock),e.add(j._ownerBlock.uniqueId))}}serialize(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},x=arguments.length>1?arguments[1]:void 0;i.allBlocks=[],this.visitAllBlocks((x=>{const e={};x.serialize(e),i.allBlocks.push(e)})),i.executionContexts=[];for(const e of this._executionContexts){const j={};e.serialize(j,x),i.executionContexts.push(j)}}}class t{constructor(i){this.config=i,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.LJ.te.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.LJ.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const i=this._executeOnNextFrame.slice(0);if(i.length)for(const x of i){this.notifyCustomEvent(x.id,x.data,!1);const i=this._executeOnNextFrame.findIndex((i=>i.uniqueId===x.uniqueId));-1!==i&&this._executeOnNextFrame.splice(i,1)}}));(t.SceneCoordinators.get(this.config.LJ)??[]).push(this)}createGraph(){const i=new Q({LJ:this.config.LJ,coordinator:this});return this._flowGraphs.push(i),i}removeGraph(i){const x=this._flowGraphs.indexOf(i);-1!==x&&(i.dispose(),this._flowGraphs.splice(x,1))}start(){for(const i of this._flowGraphs)i.start()}dispose(){var i,x;for(const E of this._flowGraphs)E.dispose();this._flowGraphs.length=0,null===(i=this._disposeObserver)||void 0===i||i.remove(),null===(x=this._onBeforeRenderObserver)||void 0===x||x.remove();const e=t.SceneCoordinators.get(this.config.LJ)??[],j=e.indexOf(this);-1!==j&&e.splice(j,1)}serialize(i,x){i._flowGraphs=[];for(const e of this._flowGraphs){const j={};e.serialize(j,x),i._flowGraphs.push(j)}i.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(i){let x=this._customEventsMap.get(i);return x||(x=new E.b,this._customEventsMap.set(i,x)),x}notifyCustomEvent(i,x){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:i,data:x,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(i)){const x=this._eventExecutionCounter.get(i);if(this._eventExecutionCounter.set(i,x+1),x>=t.MaxEventTypeExecutionPerFrame)return void(x===t.MaxEventTypeExecutionPerFrame&&g.c.Warn(`FlowGraphCoordinator: Too many executions of event "${i}".`))}else this._eventExecutionCounter.set(i,1);const e=this._customEventsMap.get(i);e&&e.notifyObservers(x)}}t.MaxEventsPerType=30,t.MaxEventTypeExecutionPerFrame=30,t.SceneCoordinators=new Map},13919:(i,x,e)=>{"use strict";e.d(x,{e:()=>E});var j=e(13924);class E extends j.b{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(i){i._notifyExecuteNode(this),this.done._activateSignal(i)}}},13895:(i,x,e)=>{"use strict";e.d(x,{d:()=>J});var j=e(13900),E=e(13906),a=e(12204);class Y extends E.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(i){super.connectTo(i),this._connectedPoint.sort(((i,x)=>x.priority-i.priority))}_activateSignal(i){var x;if(null===(x=i.logger)||void 0===x||x.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,yx:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)i._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(i,this),i._increaseExecutionId();else for(const e of this._connectedPoint)e._activateSignal(i)}}(0,a.f)("FlowGraphSignalConnection",Y);class J extends j.e{constructor(i){super(i),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(i){const x=new Y(i,0,this);return this.signalInputs.push(x),x}_registerSignalOutput(i){const x=new Y(i,1,this);return this.signalOutputs.push(x),x}_unregisterSignalInput(i){const x=this.signalInputs.findIndex((x=>x.name===i));-1!==x&&(this.signalInputs[x].dispose(),this.signalInputs.splice(x,1))}_unregisterSignalOutput(i){const x=this.signalOutputs.findIndex((x=>x.name===i));-1!==x&&(this.signalOutputs[x].dispose(),this.signalOutputs.splice(x,1))}_reportError(i,x){this.error.yx="string"===typeof x?new Error(x):x,this.error._activateSignal(i)}getSignalInput(i){return this.signalInputs.find((x=>x.name===i))}getSignalOutput(i){return this.signalOutputs.find((x=>x.name===i))}serialize(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(i),i.signalInputs=[],i.signalOutputs=[];for(const x of this.signalInputs){const e={};x.serialize(e),i.signalInputs.push(e)}for(const x of this.signalOutputs){const e={};x.serialize(e),i.signalOutputs.push(e)}}deserialize(i){for(let x=0;x<i.signalInputs.length;x++){const e=this.getSignalInput(i.signalInputs[x].name);if(!e)throw new Error("Could not find signal input with name "+i.signalInputs[x].name+" in block "+i.className);e.deserialize(i.signalInputs[x])}for(let x=0;x<i.signalOutputs.length;x++){const e=this.getSignalOutput(i.signalOutputs[x].name);if(!e)throw new Error("Could not find signal output with name "+i.signalOutputs[x].name+" in block "+i.className);e.deserialize(i.signalOutputs[x])}}getClassName(){return"FlowGraphExecutionBlock"}}},13930:(i,x,e)=>{"use strict";e.d(x,{b:()=>E});var j=e(13895);class E extends j.d{constructor(i){super(i),this.out=this._registerSignalOutput("out")}}},13874:(i,x,e)=>{"use strict";e.d(x,{A:()=>L,E:()=>o,G:()=>M,I:()=>l,L:()=>Z,N:()=>O,O:()=>w,c:()=>b,g:()=>K,h:()=>f,i:()=>z,l:()=>T,p:()=>Q,q:()=>A,s:()=>S,w:()=>g});var j,E=e(12250),a=e(12286),Y=e(13868),J=e(13877);!function(i){i.Any="any",i.String="string",i.Number="number",i.Boolean="boolean",i.Object="object",i.Integer="FlowGraphInteger",i.Vector2="Vector2",i.KJ="KJ",i.Vector4="Vector4",i.Quaternion="Quaternion",i.Matrix="Matrix",i.Matrix2D="Matrix2D",i.Matrix3D="Matrix3D",i.MJ="MJ",i.lJ="lJ"}(j||(j={}));class u{constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=i,this.defaultValue=x,this.animationType=e}serialize(i){i.typeName=this.typeName,i.defaultValue=this.defaultValue}}const b=new u("any",void 0),g=new u("string",""),A=new u("number",0,0),K=new u("boolean",!1),L=new u("Vector2",E.Vector2.Zero(),5),o=new u("KJ",E.KJ.Zero(),1),M=new u("Vector4",E.Vector4.Zero()),z=new u("Matrix",E.Matrix.Identity(),3),T=new u("Matrix2D",new J.e),Q=new u("Matrix3D",new J.f),t=new u("MJ",a.MJ.Black(),4),V=new u("lJ",new a.lJ(0,0,0,0),7),S=new u("Quaternion",E.Quaternion.Identity(),2);S.typeTransformer=i=>{if(i.getClassName){if("Vector4"===i.getClassName())return E.Quaternion.zJ(i.de());if("KJ"===i.getClassName())return E.Quaternion.FromEulerVector(i);if("Matrix"===i.getClassName())return E.Quaternion.FromRotationMatrix(i)}return i};const f=new u("FlowGraphInteger",new Y.d(0),0);function w(i){const x=i;switch(typeof i){case"string":return g;case"number":return A;case"boolean":return K;case"object":if(x.getClassName)switch(x.getClassName()){case"Vector2":return L;case"KJ":return o;case"Vector4":return M;case"Matrix":return z;case"MJ":return t;case"lJ":return V;case"Quaternion":return S;case"FlowGraphInteger":return f;case"Matrix2D":return T;case"Matrix3D":return Q}return b;default:return b}}function O(i){switch(i){case"string":return g;case"number":return A;case"boolean":return K;case"Vector2":return L;case"KJ":return o;case"Vector4":return M;case"Matrix":return z;case"MJ":return t;case"lJ":return V;case"Quaternion":return S;case"FlowGraphInteger":return f;case"Matrix2D":return T;case"Matrix3D":return Q;default:return b}}function l(i){switch(i){case"number":default:return 0;case"Vector2":return 5;case"KJ":return 1;case"Matrix":return 3;case"MJ":return 4;case"lJ":return 7;case"Quaternion":return 2}}function Z(i){switch(i){case 0:return A;case 5:return L;case 1:return o;case 3:return z;case 4:return t;case 7:return V;case 2:return S;default:return b}}},13866:(i,x,e)=>{"use strict";e.d(x,{e:()=>g,i:()=>b,k:()=>A});var j=e(12286),E=e(12250),a=e(13868),Y=e(13874),J=e(13877);function u(i){return"Vector2"===i||"KJ"===i||"Vector4"===i||"Quaternion"===i||"MJ"===i||"lJ"===i}function b(i,x,e){var j;const E=(null===x||void 0===x||null===(j=x.getClassName)||void 0===j?void 0:j.call(x))??"";if(u(E)||function(i){return"Matrix"===i||"Matrix2D"===i||"Matrix3D"===i}(E))e[i]={value:x.de(),className:E};else if("FlowGraphInteger"===E)e[i]={value:x.value,className:E};else if(E&&(x.id||x.name))e[i]={id:x.id,name:x.name,className:E};else{if("object"===typeof x)throw new Error(`Could not serialize value ${x}`);e[i]=x}}function g(i,x,e,b){const A=x[i];let K;const L=(null===A||void 0===A?void 0:A.type)??(null===A||void 0===A?void 0:A.className);if(function(i){return"Mesh"===i||"AbstractMesh"===i||"GroundMesh"===i||"InstanceMesh"===i||"LinesMesh"===i||"GoldbergMesh"===i||"GreasedLineMesh"===i||"TrailMesh"===i}(L)){let i=b.meshes.filter((i=>A.id?i.id===A.id:i.name===A.name));0===i.length&&(i=b.transformNodes.filter((i=>A.id?i.id===A.id:i.name===A.name))),K=A.uniqueId?i.find((i=>i.uniqueId===A.uniqueId)):i[0]}else if(u(L))K=function(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===i)return E.Vector2.zJ(x);if("KJ"===i)return e&&(x[2]*=-1),E.KJ.zJ(x);if("Vector4"===i)return E.Vector4.zJ(x);if("Quaternion"===i)return e&&(x[2]*=-1,x[3]*=-1),E.Quaternion.zJ(x);if("MJ"===i)return new j.MJ(x[0],x[1],x[2]);if("lJ"===i)return new j.lJ(x[0],x[1],x[2],x[3]);throw new Error(`Unknown vector class name ${i}`)}(L,A.value);else if(function(i){return"AnimationGroup"===i}(L)){const i=b.animationGroups.filter((i=>i.name===A.name));K=1===i.length?i[0]:i.find((i=>i.uniqueId===A.uniqueId))}else K="Matrix"===L?E.Matrix.zJ(A.value):"Matrix2D"===L?new J.e(A.value):"Matrix3D"===L?new J.f(A.value):"FlowGraphInteger"===L?a.d.FromValue(A.value):"number"===L||"string"===L||"boolean"===L?A.value[0]:A&&void 0!==A.value?A.value:Array.isArray(A)?A.reduce(((i,x)=>x.eventData?(i[x.id]={type:(0,Y.N)(x.type)},"undefined"!==typeof x.value&&(i[x.id].value=g("value",x,e,b)),i):i),{}):A;return K}function A(i){return"FlowGraphJsonPointerParserBlock"===i}},13912:(i,x,e)=>{"use strict";function j(i,x){return!(!i.parent||i.parent!==x&&!j(i.parent,x))}function E(i){if(i.getClassName)return i.getClassName()}function a(i,x){return i===x&&("Vector2"===i||"KJ"===i||"Vector4"===i||"Quaternion"===i)}function Y(i,x){return i===x&&("Matrix"===i||"Matrix2D"===i||"Matrix3D"===i)}function J(i,x){return"FlowGraphInteger"===i&&"FlowGraphInteger"===x}function u(i,x){const e="number"===typeof i||"number"===typeof(null===i||void 0===i?void 0:i.value);return e&&!x?!isNaN(b(i)):e}function b(i){return"number"===typeof i?i:i.value}e.d(x,{e:()=>J,i:()=>Y,k:()=>a,l:()=>E,n:()=>j,r:()=>b,s:()=>u})},13320:(i,x,e)=>{"use strict";e.r(x),e.d(x,{SceneInstrumentation:()=>a});var j=e(12061),E=e(12434);class a{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(i){i!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=i,i?(this._onBeforeActiveMeshesEvaluationObserver=this.LJ.onBeforeActiveMeshesEvaluationObservable.add((()=>{j.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.LJ.onAfterActiveMeshesEvaluationObservable.add((()=>{j.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.LJ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.LJ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(i){i!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=i,i?(this._onBeforeRenderTargetsRenderObserver=this.LJ.onBeforeRenderTargetsRenderObservable.add((()=>{j.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.LJ.onAfterRenderTargetsRenderObservable.add((()=>{j.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.LJ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.LJ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(i){i!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=i,i?(this._onBeforeParticlesRenderingObserver=this.LJ.onBeforeParticlesRenderingObservable.add((()=>{j.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.LJ.onAfterParticlesRenderingObservable.add((()=>{j.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.LJ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.LJ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(i){i!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=i,this.LJ.spriteManagers&&(i?(this._onBeforeSpritesRenderingObserver=this.LJ.onBeforeSpritesRenderingObservable.add((()=>{j.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.LJ.onAfterSpritesRenderingObservable.add((()=>{j.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.LJ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.LJ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(i){i!==this._capturePhysicsTime&&this.LJ.onBeforePhysicsObservable&&(this._capturePhysicsTime=i,i?(this._onBeforePhysicsObserver=this.LJ.onBeforePhysicsObservable.add((()=>{j.Tools.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.LJ.onAfterPhysicsObservable.add((()=>{j.Tools.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.LJ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.LJ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(i){i!==this._captureAnimationsTime&&(this._captureAnimationsTime=i,i?this._onAfterAnimationsObserver=this.LJ.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.LJ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(i){this._captureFrameTime=i}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(i){this._captureInterFrameTime=i}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(i){i!==this._captureRenderTime&&(this._captureRenderTime=i,i?(this._onBeforeDrawPhaseObserver=this.LJ.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),j.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.LJ.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),j.Tools.EndPerformanceCounter("Main render")}))):(this.LJ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.LJ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(i){i!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=i,i?(this._onBeforeCameraRenderObserver=this.LJ.onBeforeCameraRenderObservable.add((i=>{this._cameraRenderTime.beginMonitoring(),j.Tools.StartPerformanceCounter(`Rendering camera ${i.name}`)})),this._onAfterCameraRenderObserver=this.LJ.onAfterCameraRenderObservable.add((i=>{this._cameraRenderTime.endMonitoring(!1),j.Tools.EndPerformanceCounter(`Rendering camera ${i.name}`)}))):(this.LJ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.LJ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.LJ.getEngine()._drawCalls}constructor(i){this.LJ=i,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new E.c,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new E.c,this._captureFrameTime=!1,this._frameTime=new E.c,this._captureRenderTime=!1,this._renderTime=new E.c,this._captureInterFrameTime=!1,this._interFrameTime=new E.c,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new E.c,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new E.c,this._capturePhysicsTime=!1,this._physicsTime=new E.c,this._captureAnimationsTime=!1,this._animationsTime=new E.c,this._captureCameraRenderTime=!1,this._cameraRenderTime=new E.c,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=i.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(j.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.LJ.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=i.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(j.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.ze(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.ze(),this._captureParticlesRenderTime&&this._particlesRenderTime.ze(),this._captureSpritesRenderTime&&this._spritesRenderTime.ze(),this._captureRenderTime&&this._renderTime.ze(),this._captureCameraRenderTime&&this._cameraRenderTime.ze()}))}dispose(){this._disposed||(this.LJ.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.LJ.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.LJ.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.LJ.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.LJ.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.LJ.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.LJ.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.LJ.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.LJ.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.LJ.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.LJ.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.LJ.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.LJ.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.LJ.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.LJ.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.LJ.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.LJ.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.LJ=null,this._disposed=!0)}}},13854:(i,x,e)=>{"use strict";e.d(x,{c:()=>g});var j=e(12234),E=e(12236),a=e(12250),Y=e(12639),J=e(12773),u=e(12819),b=e(12204);Y.d.AddNodeConstructor("Light_Type_1",((i,x)=>()=>new g(i,a.KJ.Zero(),x)));class g extends u.c{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(i){this._shadowFrustumSize=i,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(i){this._shadowOrthoScale=i,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(i){this._orthoLeft=i}get orthoRight(){return this._orthoRight}set orthoRight(i){this._orthoRight=i}get orthoTop(){return this._orthoTop}set orthoTop(i){this._orthoTop=i}get orthoBottom(){return this._orthoBottom}set orthoBottom(i){this._orthoBottom=i}constructor(i,x,e){super(i,e),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=x.scale(-1),this.direction=x}getClassName(){return"Eb"}getTypeID(){return J.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(i,x,e){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(i):this._setDefaultAutoExtendShadowProjectionMatrix(i,x,e)}_setDefaultFixedFrustumShadowProjectionMatrix(i){const x=this.wi().activeCamera;x&&a.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:x.De,void 0!==this.shadowMaxZ?this.shadowMaxZ:x.maxZ,i,this.wi().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(i,x,e){const j=this.wi().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const i=a.KJ.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let j=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let Y=0;Y<e.length;Y++){const J=e[Y];if(!J)continue;const u=J.getBoundingInfo().boundingBox;for(let e=0;e<u.vectorsWorld.length;e++)a.KJ.TransformCoordinatesToRef(u.vectorsWorld[e],x,i),i.x<this._orthoLeft&&(this._orthoLeft=i.x),i.y<this._orthoBottom&&(this._orthoBottom=i.y),i.x>this._orthoRight&&(this._orthoRight=i.x),i.y>this._orthoTop&&(this._orthoTop=i.y),this.autoCalcShadowZBounds&&(i.z<j&&(j=i.z),i.z>E&&(E=i.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=j,this._shadowMaxZ=E)}const E=this._orthoRight-this._orthoLeft,Y=this._orthoTop-this._orthoBottom,J=void 0!==this.shadowMinZ?this.shadowMinZ:(null===j||void 0===j?void 0:j.De)||0,u=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===j||void 0===j?void 0:j.maxZ)||1e4,b=this.wi().getEngine().ue;a.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-E*this.shadowOrthoScale,this._orthoRight+E*this.shadowOrthoScale,this._orthoBottom-Y*this.shadowOrthoScale,this._orthoTop+Y*this.shadowOrthoScale,b?u:J,b?J:u,i,this.wi().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(i,x){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,x),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,x),this)}transferToNodeMaterialEffect(i,x){return this.computeTransformedInformation()?(i.setFloat3(x,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(i.setFloat3(x,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(i){const x=this._scene.getEngine();return!x.ue&&x.isNDCHalfZRange?0:1}getDepthMaxZ(i){const x=this._scene.getEngine();return x.ue&&x.isNDCHalfZRange?0:1}prepareLightSpecificDefines(i,x){i["DIRLIGHT"+x]=!0}}(0,j.e)([(0,E.O)()],g.prototype,"shadowFrustumSize",null),(0,j.e)([(0,E.O)()],g.prototype,"shadowOrthoScale",null),(0,j.e)([(0,E.O)()],g.prototype,"autoUpdateExtends",void 0),(0,j.e)([(0,E.O)()],g.prototype,"autoCalcShadowZBounds",void 0),(0,j.e)([(0,E.O)("orthoLeft")],g.prototype,"_orthoLeft",void 0),(0,j.e)([(0,E.O)("orthoRight")],g.prototype,"_orthoRight",void 0),(0,j.e)([(0,E.O)("orthoTop")],g.prototype,"_orthoTop",void 0),(0,j.e)([(0,E.O)("orthoBottom")],g.prototype,"_orthoBottom",void 0),(0,b.f)("BABYLON.DirectionalLight",g)},14356:(i,x,e)=>{"use strict";e.d(x,{c:()=>g});var j=e(12234),E=e(12236),a=e(12250),Y=e(12286),J=e(12639),u=e(12773),b=e(12204);J.d.AddNodeConstructor("Light_Type_3",((i,x)=>()=>new g(i,a.KJ.Zero(),x)));class g extends u.e{constructor(i,x,e){super(i,e),this.groundColor=new Y.MJ(0,0,0),this.direction=x||a.KJ.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Yb"}setDirectionToTarget(i){return this.direction=a.KJ.Normalize(i.Cx(a.KJ.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(i,x){const e=a.KJ.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",e.x,e.y,e.z,0,x),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.kJ),x),this}transferToNodeMaterialEffect(i,x){const e=a.KJ.Normalize(this.direction);return i.setFloat3(x,e.x,e.y,e.z),this}Re(){return this._worldMatrix||(this._worldMatrix=a.Matrix.Identity()),this._worldMatrix}getTypeID(){return u.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(i,x){i["HEMILIGHT"+x]=!0}}(0,j.e)([(0,E.j)()],g.prototype,"groundColor",void 0),(0,j.e)([(0,E.L)()],g.prototype,"direction",void 0),(0,b.f)("BABYLON.HemisphericLight",g)},13815:(i,x,e)=>{"use strict";e.d(x,{d:()=>A});var j=e(12234),E=e(12236),a=e(12250),Y=e(12639),J=e(12773),u=e(12819),b=e(12227),g=e(12204);Y.d.AddNodeConstructor("Light_Type_2",((i,x)=>()=>new A(i,a.KJ.Zero(),a.KJ.Zero(),0,0,x)));class A extends u.c{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(i){this._iesProfileTexture!==i&&(this._iesProfileTexture=i,this._iesProfileTexture&&A._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(i){this._angle=i,this._cosHalfAngle=Math.cos(.5*i),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(i){this._innerAngle=i,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(i){this._shadowAngleScale=i,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(i){this._projectionTextureLightNear=i,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(i){this._projectionTextureLightFar=i,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(i){this._projectionTextureUpDirection=i,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(i){this._projectionTexture!==i&&(this._projectionTexture=i,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(A._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):A._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(i){return void 0!==i.onGeneratedObservable}static _IsTexture(i){return void 0!==i.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(i){this._projectionTextureProjectionLightMatrix=i,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(i,x,e,j,E,Y){super(i,Y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=a.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=a.KJ.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=a.KJ.Zero(),this._projectionTextureViewLightMatrix=a.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=a.Matrix.Zero(),this._projectionTextureScalingMatrix=a.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=x,this.direction=e,this.angle=j,this.exponent=E}getClassName(){return"SpotLight"}getTypeID(){return J.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(i){super._setDirection(i),this._projectionTextureViewLightDirty=!0}_setPosition(i){super._setPosition(i),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(i,x,e){const j=this.wi().activeCamera;if(!j)return;this._shadowAngleScale=this._shadowAngleScale||1;const E=this._shadowAngleScale*this._angle,Y=void 0!==this.shadowMinZ?this.shadowMinZ:j.De,J=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,u=this.wi().getEngine().ue;a.Matrix.PerspectiveFovLHToRef(E,1,u?J:Y,u?Y:J,i,!0,this._scene.getEngine().isNDCHalfZRange,void 0,u)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),a.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const i=this.projectionTextureLightFar,x=this.projectionTextureLightNear,e=i/(i-x),j=-e*x,E=1/Math.tan(this._angle/2);a.Matrix.FromValuesToRef(E/1,0,0,0,0,E,0,0,0,0,e,1,0,0,j,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof b.d){const i=this._projectionTexture.uScale/2,x=this._projectionTexture.vScale/2;a.Matrix.FromValuesToRef(i,0,0,0,0,x,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(i,x){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),i.setMatrix("textureProjectionMatrix"+x,this._projectionTextureMatrix),i.setTexture("projectionLightTexture"+x,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&i.setTexture("iesLightTexture"+x,this._iesProfileTexture),this}transferToEffect(i,x){let e;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,x),e=a.KJ.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,x),e=a.KJ.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",e.x,e.y,e.z,this._cosHalfAngle,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,x),this}transferToNodeMaterialEffect(i,x){let e;return e=this.computeTransformedInformation()?a.KJ.Normalize(this.transformedDirection):a.KJ.Normalize(this.direction),this.wi().useRightHandedSystem?i.setFloat3(x,-e.x,-e.y,-e.z):i.setFloat3(x,e.x,e.y,e.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(i){const x=this._scene.getEngine(),e=void 0!==this.shadowMinZ?this.shadowMinZ:(null===i||void 0===i?void 0:i.De)??0;return x.ue&&x.isNDCHalfZRange?e:this._scene.getEngine().isNDCHalfZRange?0:e}getDepthMaxZ(i){const x=this._scene.getEngine(),e=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===i||void 0===i?void 0:i.maxZ)??1e4;return x.ue&&x.isNDCHalfZRange?0:e}prepareLightSpecificDefines(i,x){i["SPOTLIGHT"+x]=!0,i["PROJECTEDLIGHTTEXTURE"+x]=!(!this.projectionTexture||!this.projectionTexture.isReady()),i["IESLIGHTTEXTURE"+x]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,j.e)([(0,E.O)()],A.prototype,"angle",null),(0,j.e)([(0,E.O)()],A.prototype,"innerAngle",null),(0,j.e)([(0,E.O)()],A.prototype,"shadowAngleScale",null),(0,j.e)([(0,E.O)()],A.prototype,"exponent",void 0),(0,j.e)([(0,E.O)()],A.prototype,"projectionTextureLightNear",null),(0,j.e)([(0,E.O)()],A.prototype,"projectionTextureLightFar",null),(0,j.e)([(0,E.O)()],A.prototype,"projectionTextureUpDirection",null),(0,j.e)([(0,E.D)("projectedLightTexture")],A.prototype,"_projectionTexture",void 0),(0,g.f)("BABYLON.SpotLight",A)},13564:(i,x,e)=>{"use strict";e.d(x,{c:()=>Y,d:()=>a,h:()=>J});const j={},E={};function a(i,x){j[i]=x}function Y(i,x){E[i]=x}function J(i){return E[i]?E[i]:null}},13493:(i,x,e)=>{"use strict";e.d(x,{e:()=>w,h:()=>I});var j,E=e(12061),a=e(12065),Y=e(12452),J=e(12108),u=e(12072),b=e(12690),g=e(12115),A=e(12120),K=e(12213),L=e(12150),o=e(12101);!function(i){i[i.Clean=0]="Clean",i[i.Stop=1]="Stop",i[i.Sync=2]="Sync",i[i.NoSync=3]="NoSync"}(j||(j={}));const M=new a.b,z={};let T=!1;function Q(){return z[".babylon"]}function t(i,x){const e=z[i];return e||(u.c.Warn("Unable to find a plugin to load "+i+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),x?Q():void 0)}function V(i,x,e){let j="Unable to load from "+(i.rawData?"binary data":i.url);return x?j+=`: ${x}`:e&&(j+=`: ${e}`),j}async function S(i,x,e,j,E,a,Y,J,u){var b;const A="data:"===(K=i.url).substring(0,5)?K.substring(5):null;var K;if(i.rawData&&!Y)throw"When using ArrayBufferView to load data the file extension must be provided.";const T=A||Y?"":function(i){const x=i.indexOf("?");-1!==x&&(i=i.substring(0,x));const e=i.lastIndexOf(".");return i.substring(e,i.length).toLowerCase()}(i.url);let V=Y?t(Y,!0):A?function(i){for(const x in z){const e=z[x].plugin;if(e.canDirectLoad&&e.canDirectLoad(i))return z[x]}return Q()}(i.url):t(T,!1);if(!V&&T){if(i.url&&!i.url.startsWith("blob:")){const x=await async function(i,x){const e=x.method||"GET";return await new Promise(((j,E)=>{const a=new o.e;a.addEventListener("readystatechange",(()=>{if(4==a.readyState)if(200==a.status){const i={};if(x.responseHeaders)for(const e of x.responseHeaders)i[e]=a.getResponseHeader(e)||"";j({response:a.response,headerValues:i})}else E(`Unable to fetch data from ${i}. Error code: ${a.status}`)})),a.open(e,i),a.send()}))}(i.url,{method:"HEAD",responseHeaders:["Content-Type"]}),e=x.headerValues?x.headerValues["Content-Type"]:"";e&&(V=function(i){for(const x in z){const e=z[x];if(e.mimeType===i)return e}}(e))}V||(V=Q())}if(!V)throw new Error(`No plugin or fallback for ${Y??i.url}`);if(!1===(null===u||void 0===u||null===(b=u[V.plugin.name])||void 0===b?void 0:b.enabled))throw new Error(`The '${V.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(i.rawData&&!V.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(i=>{if(V.plugin.createPlugin){const x=V.plugin.createPlugin(u??{});return x instanceof Promise?(x.then(i).catch((i=>{E("Error instantiating plugin.",i)})),null):(i(x),x)}return i(V.plugin),V.plugin})((u=>{var b;if(!u)throw`The loader plugin corresponding to the '${Y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(M.notifyObservers(u),A&&(u.canDirectLoad&&u.canDirectLoad(i.url)||!(0,g.l)(i.url))){if(u.directLoad){const i=u.directLoad(x,A);i instanceof Promise?i.then((i=>{e(u,i)})).catch((i=>{E("Error in directLoad of _loadData: "+i,i)})):e(u,i)}else e(u,A);return}const K=V.isBinary,o=(i,j)=>{x.M?E("Scene has been disposed"):e(u,i,j)};let z=null,T=!1;null===(b=u.te)||void 0===b||b.add((()=>{T=!0,z&&(z.abort(),z=null),a()}));const Q=()=>{if(T)return;const e=(i,x)=>{E(null===i||void 0===i?void 0:i.statusText,x)};if(!u.loadFile&&i.rawData)throw"Plugin does not support loading ArrayBufferView.";z=u.loadFile?u.loadFile(x,i.rawData||i.file||i.url,i.rootUrl,o,j,K,e,J):x._loadFile(i.file||i.url,o,j,!0,K,e)},t=x.getEngine();let S=t.enableOfflineSupport;if(S){let e=!1;for(const j of x.disableOfflineSupportExceptionRules)if(j.test(i.url)){e=!0;break}S=!e}S&&L.c.OfflineProviderFactory?x.offlineProvider=L.c.OfflineProviderFactory(i.url,Q,t.disableManifestCheck):Q()}))}function f(i,x){let e,j,a=null,Y=null;if(x)if(x.name)e=`file:${x.name}`,j=x.name,a=x;else if(ArrayBuffer.isView(x))e="",j=(0,K.b)(),Y=x;else if(x.startsWith("data:"))e=x,j="";else if(i){const a=x;if("/"===a.substring(0,1))return E.Tools.Error("Wrong sceneFilename parameter"),null;e=i+a,j=a}else e=x,j=E.Tools.GetFilename(x),i=E.Tools.GetFolderPath(x);else e=i,j=E.Tools.GetFilename(i),i=E.Tools.GetFolderPath(i);return{url:e,rootUrl:i,name:j,file:a,rawData:Y}}function w(i){if("string"===typeof i.extensions){const x=i.extensions;z[x.toLowerCase()]={plugin:i,isBinary:!1}}else{const x=i.extensions,e=Object.keys(x);for(const j of e)z[j.toLowerCase()]={plugin:i,isBinary:x[j].isBinary,mimeType:x[j].mimeType}}}async function O(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.e.LastCreatedScene,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",K=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!j)return u.c.Error("No scene available to import mesh to"),null;const L=f(x,e);if(!L)return null;const o={};j.addPendingData(o);const M=()=>{j.removePendingData(o)},z=(i,x)=>{const e=V(L,i,x);Y?Y(j,e,new A.i(e,A.g.SceneLoaderError,x)):u.c.Error(e),M()},T=a?i=>{try{a(i)}catch(x){z("Error in onProgress callback: "+x,x)}}:void 0,Q=(i,x,e,a,Y,J,u,b)=>{if(j.importedMeshesFiles.push(L.url),E)try{E(i,x,e,a,Y,J,u,b)}catch(g){z("Error in onSuccess callback: "+g,g)}j.removePendingData(o)};return await S(L,j,((x,e,E)=>{if(x.rewriteRootURL&&(L.rootUrl=x.rewriteRootURL(L.rootUrl,E)),x.importMesh){const E=[],a=[],Y=[];if(!x.importMesh(i,j,e,L.rootUrl,E,a,Y,z))return;j.loadingPluginName=x.name,Q(E,a,Y,[],[],[],[],[])}else{x.importMeshAsync(i,j,e,L.rootUrl,T,L.name).then((i=>{j.loadingPluginName=x.name,Q(i.meshes,i.iL,i.skeletons,i.animationGroups,i.transformNodes,i.geometries,i.lights,i.spriteManagers)})).catch((i=>{z(i.message,i)}))}}),T,z,M,b,g,K)}async function l(i,x,e,j,E,a,Y,J){return await new Promise(((u,b)=>{try{O(i,x,e,j,((i,x,e,j,E,a,Y,J)=>{u({meshes:i,iL:x,skeletons:e,animationGroups:j,transformNodes:E,geometries:a,lights:Y,spriteManagers:J})}),E,((i,x,e)=>{b(e||new Error(x))}),a,Y,J).catch(b)}catch(A){b(A)}}))}async function Z(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedEngine,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};e?await k(i,x,new Y.d(e),j,a,u,b,g,A):E.Tools.Error("No engine available")}async function B(i,x,e,j,E,a,Y){return await new Promise(((J,u)=>{Z(i,x,e,(i=>{J(i)}),j,((i,x,e)=>{u(e||new Error(x))}),E,a,Y)}))}async function k(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",K=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!e)return u.c.Error("No scene available to append to"),null;const L=f(i,x);if(!L)return null;const o={};e.addPendingData(o);const M=()=>{e.removePendingData(o)};b.c.ShowLoadingScreen&&!T&&(T=!0,e.getEngine().displayLoadingUI(),e.executeWhenReady((()=>{e.getEngine().hideLoadingUI(),T=!1})));const z=(i,x)=>{const j=V(L,i,x);a?a(e,j,new A.i(j,A.g.SceneLoaderError,x)):u.c.Error(j),M()},Q=E?i=>{try{E(i)}catch(x){z("Error in onProgress callback",x)}}:void 0,t=()=>{if(j)try{j(e)}catch(i){z("Error in onSuccess callback",i)}e.removePendingData(o)};return await S(L,e,((i,x)=>{if(i.load){if(!i.load(e,x,L.rootUrl,z))return;e.loadingPluginName=i.name,t()}else{i.loadAsync(e,x,L.rootUrl,Q,L.name).then((()=>{e.loadingPluginName=i.name,t()})).catch((i=>{z(i.message,i)}))}}),Q,z,M,Y,g,K)}async function N(i,x,e,j,E,a,Y){return await new Promise(((J,u)=>{try{k(i,x,e,(i=>{J(i)}),j,((i,x,e)=>{u(e||new Error(x))}),E,a,Y).catch(u)}catch(A){u(A)}}))}async function mi(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedScene,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!e)return u.c.Error("No scene available to load asset container to"),null;const K=f(i,x);if(!K)return null;const L={};e.addPendingData(L);const o=()=>{e.removePendingData(L)},M=(i,x)=>{const j=V(K,i,x);a?a(e,j,new A.i(j,A.g.SceneLoaderError,x)):u.c.Error(j),o()},z=E?i=>{try{E(i)}catch(x){M("Error in onProgress callback",x)}}:void 0,T=i=>{if(j)try{j(i)}catch(x){M("Error in onSuccess callback",x)}e.removePendingData(L)};return await S(K,e,((i,x)=>{if(i.loadAssetContainer){const j=i.loadAssetContainer(e,x,K.rootUrl,M);if(!j)return;j.populateRootNodes(),e.loadingPluginName=i.name,T(j)}else if(i.loadAssetContainerAsync){i.loadAssetContainerAsync(e,x,K.rootUrl,z,K.name).then((x=>{x.populateRootNodes(),e.loadingPluginName=i.name,T(x)})).catch((i=>{M(i.message,i)}))}else M("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),z,M,o,Y,b,g)}async function X(i,x,e,j,E,a,Y){return await new Promise(((J,u)=>{try{mi(i,x,e,(i=>{J(i)}),j,((i,x,e)=>{u(e||new Error(x))}),E,a,Y).catch(u)}catch(A){u(A)}}))}async function C(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:J.e.LastCreatedScene,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,b=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!e)return void u.c.Error("No scene available to load animations to");if(j){for(const j of e.animatables)j.reset();e.stopAllAnimations();const i=e.animationGroups.slice();for(const e of i)e.dispose();const x=e.getNodes();for(const e of x)e.animations&&(e.animations=[])}else switch(E){case 0:const i=e.animationGroups.slice();for(const x of i)x.dispose();break;case 1:for(const x of e.animationGroups)x.stop();break;case 2:for(const x of e.animationGroups)x.reset(),x.restart();break;case 3:break;default:return void u.c.Error("Unknown animation group loading mode value '"+E+"'")}const o=e.animatables.length;await mi(i,x,e,(i=>{i.mergeAnimationsTo(e,e.animatables.slice(o),a),i.dispose(),e.onAnimationFileImportedObservable.notifyObservers(e),Y&&Y(e)}),b,g,A,K,L)}async function n(i,x,e,j,E,a,Y,J,u,b){return await new Promise(((g,K)=>{try{C(i,x,e,j,E,a,(i=>{g(i)}),Y,((i,x,e)=>{K(e||new Error(x))}),J,u,b).catch(K)}catch(A){K(A)}}))}class I{static get ForceFullSceneLoadingForIncremental(){return b.c.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(i){b.c.ForceFullSceneLoadingForIncremental=i}static get ShowLoadingScreen(){return b.c.ShowLoadingScreen}static set ShowLoadingScreen(i){b.c.ShowLoadingScreen=i}static get loggingLevel(){return b.c.loggingLevel}static set loggingLevel(i){b.c.loggingLevel=i}static get CleanBoneMatrixWeights(){return b.c.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(i){b.c.CleanBoneMatrixWeights=i}static GetDefaultPlugin(){return Q()}static GetPluginForExtension(i){var x;return null===(x=t(i,!0))||void 0===x?void 0:x.plugin}static IsPluginForExtensionAvailable(i){return function(i){return!!z[i]}(i)}static RegisterPlugin(i){w(i)}static ImportMesh(i,x,e,j,E,a,Y,u,b){O(i,x,e,j,E,a,Y,u,b).catch((i=>null===Y||void 0===Y?void 0:Y(J.e.LastCreatedScene,null===i||void 0===i?void 0:i.message,i)))}static async ImportMeshAsync(i,x,e,j,E,a,Y){return await l(i,x,e,j,E,a,Y)}static Load(i,x,e,j,E,a,Y,u){Z(i,x,e,j,E,a,Y,u).catch((i=>null===a||void 0===a?void 0:a(J.e.LastCreatedScene,null===i||void 0===i?void 0:i.message,i)))}static async LoadAsync(i,x,e,j,E,a){return await B(i,x,e,j,E,a)}static Append(i,x,e,j,E,a,Y,u){k(i,x,e,j,E,a,Y,u).catch((i=>null===a||void 0===a?void 0:a(e??J.e.LastCreatedScene,null===i||void 0===i?void 0:i.message,i)))}static async AppendAsync(i,x,e,j,E,a){return await N(i,x,e,j,E,a)}static LoadAssetContainer(i,x,e,j,E,a,Y,u){mi(i,x,e,j,E,a,Y,u).catch((i=>null===a||void 0===a?void 0:a(e??J.e.LastCreatedScene,null===i||void 0===i?void 0:i.message,i)))}static async LoadAssetContainerAsync(i,x,e,j,E,a){return await X(i,x,e,j,E,a)}static ImportAnimations(i,x,e,j,E,a,Y,u,b,g,A){C(i,x,e,j,E,a,Y,u,b,g,A).catch((i=>null===b||void 0===b?void 0:b(e??J.e.LastCreatedScene,null===i||void 0===i?void 0:i.message,i)))}static async ImportAnimationsAsync(i,x,e,j,E,a,Y,J,u,b,g){return await n(i,x,e,j,E,a,J,b,g)}}I.NO_LOGGING=0,I.MINIMAL_LOGGING=1,I.SUMMARY_LOGGING=2,I.DETAILED_LOGGING=3,I.OnPluginActivatedObservable=M},13831:(i,x,e)=>{"use strict";e.d(x,{c:()=>K});var j=e(12234),E=e(12236),a=e(12061),Y=e(12250),J=e(12272),u=e(12227),b=e(12204),g=e(12065),A=e(12278);e(13839);class K extends J.b{set boundingBoxSize(i){if(this._boundingBoxSize&&this._boundingBoxSize.equals(i))return;this._boundingBoxSize=i;const x=this.wi();x&&x.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(i){this._rotationY=i,this.setReflectionTextureMatrix(Y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(i,x,e){let j="";for(const E of i)j+=E;return new K(j,x,null,e,i)}static CreateFromPrefilteredData(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const E=x.useDelayedTextureLoading;x.useDelayedTextureLoading=!1;const a=new K(i,x,null,!1,null,null,null,void 0,!0,e,j);return x.useDelayedTextureLoading=E,a}constructor(i,x){var e;let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,K=arguments.length>8&&void 0!==arguments[8]&&arguments[8],L=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,o=arguments.length>10&&void 0!==arguments[10]&&arguments[10],M=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,T=arguments.length>13?arguments[13]:void 0,Q=arguments.length>14?arguments[14]:void 0;super(x),this.onLoadObservable=new g.b,this.boundingBoxPosition=Y.KJ.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new Y.Matrix,this._buffer=null,this.name=i,this.url=i,this._noMipmap=E,this.He=!1,this.isCube=!0,this._textureMatrix=Y.Matrix.Identity(),this.coordinatesMode=u.d.CUBIC_MODE;let t=null,V=null;null===j||Array.isArray(j)?(this._noMipmap=E,this._format=A,this._createPolynomials=o,t=j,this._loaderOptions=T,this._useSRGBBuffer=Q,this._lodScale=M,this._lodOffset=z):(t=j.extensions??null,this._noMipmap=j.noMipmap??!1,a=j.files??null,V=j.buffer??null,this._format=j.format??5,K=j.prefiltered??!1,L=j.forcedExtension??null,this._createPolynomials=j.createPolynomials??!1,this._lodScale=j.lodScale??.8,this._lodOffset=j.lodOffset??0,this._loaderOptions=j.loaderOptions,this._useSRGBBuffer=j.useSRGBBuffer,J=j.W??null,b=j.onError??null),(i||a)&&this.updateURL(i,L,J,K,b,t,null===(e=this.wi())||void 0===e?void 0:e.useDelayedTextureLoading,a,V)}getClassName(){return"CubeTexture"}updateURL(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=i),this.url=i,x&&(this._forcedExtension=x);const b=i.lastIndexOf("."),g=x||(b>-1?i.substring(b).toLowerCase():""),A=0===g.indexOf(".dds"),K=0===g.indexOf(".env"),L=0===g.indexOf(".basis");if(K?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=j,j&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),J)this._files=J;else if(L||K||A||a||(a=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,a){for(let x=0;x<a.length;x++)this._files.push(i+a[x]);this._extensions=a}this._buffer=u,Y?(this.delayLoadState=4,this._delayedOnLoad=e,this._delayedOnError=E):this._loadTexture(e,E)}delayLoad(i){4===this.delayLoadState&&(i&&(this._forcedExtension=i),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(i){var x,e;if(i.updateFlag===this._textureMatrix.updateFlag)return;i.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(e=this.wi())||void 0===e||e.markAllMaterialsAsDirty(1,(i=>-1!==i.getActiveTextures().indexOf(this))));if(this._textureMatrix=i,null===(x=this.wi())||void 0===x||!x.useRightHandedSystem)return;const j=Y.TmpVectors.KJ[0],E=Y.TmpVectors.Quaternion[0],a=Y.TmpVectors.KJ[1];this._textureMatrix.decompose(j,E,a),E.z*=-1,E.w*=-1,Y.Matrix.ComposeToRef(j,E,a,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var i;return null!==(i=this.wi())&&void 0!==i&&i.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.wi(),j=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const E=()=>{var x;(this.onLoadObservable.notifyObservers(this),j)&&(j.dispose(),null===(x=this.wi())||void 0===x||x.markAllMaterialsAsDirty(1));i&&i()},Y=(i,e)=>{this._loadingError=!0,this._errorObject={message:i,exception:e},x&&x(i,e),u.d.OnTextureLoadErrorObservable.notifyObservers(this)};var J;this._texture?this._texture.isReady?a.Tools.SetImmediate((()=>E())):this._texture.onLoadedObservable.add((()=>E())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,e,this._lodScale,this._lodOffset,i,Y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,e,this._files,this._noMipmap,i,Y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(J=this._texture)||void 0===J||J.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(i,x,e){const j=A.b.Parse((()=>{let j=!1;return i.prefiltered&&(j=i.prefiltered),new K(e+(i.url??i.name),x,i.extensions,!1,i.files||null,null,null,void 0,j,i.forcedExtension)}),i,x);if(i.boundingBoxPosition&&(j.boundingBoxPosition=Y.KJ.zJ(i.boundingBoxPosition)),i.boundingBoxSize&&(j.boundingBoxSize=Y.KJ.zJ(i.boundingBoxSize)),i.animations)for(let E=0;E<i.animations.length;E++){const x=i.animations[E],e=(0,b.e)("BABYLON.Animation");e&&j.animations.push(e.Parse(x))}return j}clone(){let i=0;const x=A.b.Clone((()=>{const x=new K(this.url,this.wi()||this._getEngine(),this._extensions,this._noMipmap,this._files);return i=x.uniqueId,x}),this);return x.uniqueId=i,x}}(0,j.e)([(0,E.O)()],K.prototype,"url",void 0),(0,j.e)([(0,E.L)()],K.prototype,"boundingBoxPosition",void 0),(0,j.e)([(0,E.L)()],K.prototype,"boundingBoxSize",null),(0,j.e)([(0,E.O)("rotationY")],K.prototype,"rotationY",null),(0,j.e)([(0,E.O)("files")],K.prototype,"_files",void 0),(0,j.e)([(0,E.O)("forcedExtension")],K.prototype,"_forcedExtension",void 0),(0,j.e)([(0,E.O)("extensions")],K.prototype,"_extensions",void 0),(0,j.e)([(0,E.u)("textureMatrix")],K.prototype,"_textureMatrix",void 0),(0,j.e)([(0,E.u)("textureMatrixRefraction")],K.prototype,"_textureMatrixRefraction",void 0),u.d._CubeTextureParser=K.Parse,(0,b.f)("BABYLON.CubeTexture",K)},14370:(i,x,e)=>{"use strict";e.d(x,{d:()=>u});var j=e(12072),E=e(12227),a=e(12216),Y=e(12367),J=e(12181);Y.ThinEngine.prototype.createDynamicTexture=function(i,x,e,j){const E=new J.b(this,4);return E.baseWidth=i,E.baseHeight=x,e&&(i=this.needPOTTextures?(0,a.g)(i,this._caps.maxTextureSize):i,x=this.needPOTTextures?(0,a.g)(x,this._caps.maxTextureSize):x),E.width=i,E.height=x,E.isReady=!1,E.generateMipMaps=e,E.samplingMode=j,this.updateTextureSamplingMode(j,E),this._internalTexturesCache.push(E),E},Y.ThinEngine.prototype.updateDynamicTexture=function(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!i)return;const Y=this._gl,J=Y.TEXTURE_2D,u=this._bindTextureDirectly(J,i,!0,a);this._unpackFlipY(void 0===e?i.invertY:e),j&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const b=this._getWebGLTextureType(i.type),g=this._getInternalFormat(E||i.format),A=this._getRGBABufferInternalSizedFormat(i.type,g);Y.texImage2D(J,0,A,g,b,x),i.generateMipMaps&&Y.generateMipmap(J),u||this._bindTextureDirectly(J,null),j&&Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),E&&(i.format=E),i._dynamicTextureSource=x,i._premulAlpha=j,i.invertY=e||!1,i.isReady=!0};class u extends E.d{constructor(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,J=arguments.length>6?arguments[6]:void 0;const u=!e||e._isScene;super(null,u?e:null===e||void 0===e?void 0:e.LJ,u?!j:e,J,a,void 0,void 0,void 0,void 0,Y),this.name=i,this.wrapU=E.d.CLAMP_ADDRESSMODE,this.wrapV=E.d.CLAMP_ADDRESSMODE,this._generateMipMaps=j;const b=this._getEngine();if(!b)return;if(x.getContext)this._canvas=x,this._ownCanvas=!1,this._texture=b.createDynamicTexture(this._canvas.width,this._canvas.height,j,a);else{this._canvas=b.createCanvas(1,1),this._ownCanvas=!0;const i=x;i.width||0===i.width?this._texture=b.createDynamicTexture(i.width,i.height,j,a):this._texture=b.createDynamicTexture(x,x,j,a)}const g=this.getSize();this._canvas.width!==g.width&&(this._canvas.width=g.width),this._canvas.height!==g.height&&(this._canvas.height=g.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(i){this._canvas.width=i.width,this._canvas.height=i.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(i.width,i.height,this._generateMipMaps,this.samplingMode)}scale(i){const x=this.getSize();x.width*=i,x.height*=i,this._recreate(x)}scaleTo(i,x){const e=this.getSize();e.width=i,e.height=x,this._recreate(e)}getContext(){return this._context}clear(i){const x=this.getSize();i&&(this._context.fillStyle=i),this._context.clearRect(0,0,x.width,x.height)}update(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===i||i,x,this._format||void 0,void 0,e)}drawText(i,x,e,j,E,a,Y){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const u=this.getSize();if(a&&(this._context.fillStyle=a,this._context.fillRect(0,0,u.width,u.height)),this._context.font=j,null===x||void 0===x){const e=this._context.measureText(i);x=(u.width-e.width)/2}if(null===e||void 0===e){const i=parseInt(j.replace(/\D/g,""));e=u.height/2+i/3.65}this._context.fillStyle=E||"",this._context.fillText(i,x,e),J&&this.update(Y)}dispose(){var i,x;(super.dispose(),this._ownCanvas)&&(null===(i=this._canvas)||void 0===i||null===(x=i.remove)||void 0===x||x.call(i));this._canvas=null,this._context=null}clone(){const i=this.wi();if(!i)return this;const x=this.getSize(),e=new u(this.name,x,i,this._generateMipMaps);return e.He=this.He,e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e}serialize(){const i=this.wi();i&&!i.isReady()&&j.c.Warn("The scene must be ready before serializing the dynamic texture");const x=super.serialize();return u._IsCanvasElement(this._canvas)&&(x.base64String=this._canvas.toDataURL()),x.invertY=this._invertY,x.samplingMode=this.samplingMode,x}static _IsCanvasElement(i){return void 0!==i.toDataURL}_rebuild(){this.update()}}},13756:(i,x,e)=>{"use strict";e.d(x,{d:()=>E});var j=e(12227);class E extends j.d{get depth(){return this._depth}constructor(i,x,e,E,a,Y){let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:j.d.TRILINEAR_SAMPLINGMODE,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,A=arguments.length>10?arguments[10]:void 0;super(null,Y,!J,u),this.format=a,this._texture=Y.getEngine().createRawTexture2DArray(i,x,e,E,a,J,u,b,null,g,A),this._depth=E,this.is2DArray=!0}update(i){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,i,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(i,x,e,j,a){return new E(i,x,e,j,5,a,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},13576:(i,x,e)=>{"use strict";e.d(x,{e:()=>J,f:()=>u,j:()=>a,m:()=>Y});var j=e(12264),E=e(12250);function a(i,x){return`{X: ${i.x.toFixed(x)} Y: ${i.y.toFixed(x)}}`}function Y(i,x){return`{X: ${i._x.toFixed(x)} Y: ${i._y.toFixed(x)} Z: ${i._z.toFixed(x)}}`}function J(i,x){return 2*Math.acos((0,j.Clamp)(E.Quaternion.Dot(i,x)))}function u(i,x){const e=new E.Quaternion;return function(i,x,e){const a=E.KJ.Cross(i,x),Y=Math.acos((0,j.Clamp)(E.KJ.Dot(i,x),-1,1));E.Quaternion.RotationAxisToRef(a,Y,e)}(i,x,e),e}},13447:(i,x,e)=>{"use strict";e.d(x,{b:()=>b});var j=e(12250),E=e(12286),a=e(12675),Y=e(12657),J=e(12301);e(13451);function u(i){let x=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const e=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],a=[];let u=[];const b=i.width||i.size||1,g=i.height||i.size||1,A=i.depth||i.size||1,K=i.wrap||!1;let L=void 0===i.topBaseAt?1:i.topBaseAt,o=void 0===i.bottomBaseAt?0:i.bottomBaseAt;L=(L+4)%4,o=(o+4)%4;let M=[2,0,3,1][L],z=[2,0,1,3][o],T=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(K){x=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],T=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let i=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],e=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const j=[17,18,19,16],E=[22,23,20,21];for(;M>0;)i.unshift(i.pop()),j.unshift(j.pop()),M--;for(;z>0;)e.unshift(e.pop()),E.unshift(E.pop()),z--;i=i.flat(),e=e.flat(),T=T.concat(i).concat(e),x.push(j[0],j[2],j[3],j[0],j[1],j[2]),x.push(E[0],E[2],E[3],E[0],E[1],E[2])}const Q=[b/2,g/2,A/2];u=T.reduce(((i,x,e)=>i.concat(x*Q[e%3])),[]);const t=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE,V=i.faceUV||new Array(6),S=i.faceColors,f=[];for(let Y=0;Y<6;Y++)void 0===V[Y]&&(V[Y]=new j.Vector4(0,0,1,1)),S&&void 0===S[Y]&&(S[Y]=new E.lJ(1,1,1,1));for(let j=0;j<6;j++)if(a.push(V[j].z,J.d?1-V[j].w:V[j].w),a.push(V[j].x,J.d?1-V[j].w:V[j].w),a.push(V[j].x,J.d?1-V[j].y:V[j].y),a.push(V[j].z,J.d?1-V[j].y:V[j].y),S)for(let i=0;i<4;i++)f.push(S[j].r,S[j].g,S[j].b,S[j].a);Y.e._ComputeSides(t,u,x,e,a,i.frontUVs,i.backUVs);const w=new Y.e;if(w.indices=x,w.li=u,w.Zi=e,w.ki=a,S){const i=t===Y.e.DOUBLESIDE?f.concat(f):f;w.Bi=i}return w}function b(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new a.c(i,e);x.sideOrientation=a.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return u(x).mx(j,x.updatable),j}Y.e.CreateBox=u,a.c.CreateBox=function(i,x){return b(i,{size:x,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},13567:(i,x,e)=>{"use strict";e.d(x,{d:()=>J});var j=e(12675),E=e(12657),a=e(12301);function Y(i){const x=[],e=[],j=[],Y=[],J=i.radius||.5,u=i.tessellation||64,b=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,g=0===i.sideOrientation?0:i.sideOrientation||E.e.DEFAULTSIDE;x.push(0,0,0),Y.push(.5,.5);const A=2*Math.PI*b,K=1===b?A/u:A/(u-1);let L=0;for(let E=0;E<u;E++){const i=Math.cos(L),e=Math.sin(L),j=(i+1)/2,E=(1-e)/2;x.push(J*i,J*e,0),Y.push(j,a.d?1-E:E),L+=K}1===b&&(x.push(x[3],x[4],x[5]),Y.push(Y[2],a.d?1-Y[3]:Y[3]));const o=x.length/3;for(let E=1;E<o-1;E++)e.push(E+1,0,E);E.e.ComputeNormals(x,e,j),E.e._ComputeSides(g,x,e,j,Y,i.frontUVs,i.backUVs);const M=new E.e;return M.indices=e,M.li=x,M.Zi=j,M.ki=Y,M}function J(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new j.c(i,e);x.sideOrientation=j.c._GetDefaultSideOrientation(x.sideOrientation),E._originalBuilderSideOrientation=x.sideOrientation;return Y(x).mx(E,x.updatable),E}E.e.CreateDisc=Y,j.c.CreateDisc=function(i,x,e){return J(i,{radius:x,tessellation:e,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},13451:(i,x,e)=>{"use strict";e.d(x,{i:()=>z,e:()=>Q,k:()=>T});var j=e(12250),E=e(12286),a=e(12675),Y=e(12657),J=e(12314);a.c._GroundMeshParser=(i,x)=>u.Parse(i,x);class u extends a.c{constructor(i,x){super(i,x),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=i,this._subdivisionsY=i,this.subdivide(i);const e=this;e.createOrUpdateSubmeshesOctree&&e.createOrUpdateSubmeshesOctree(x)}getHeightAtCoordinates(i,x){const e=this.getWorldMatrix(),E=j.TmpVectors.Matrix[5];e.invertToRef(E);const a=j.TmpVectors.KJ[8];if(j.KJ.TransformCoordinatesFromFloatsToRef(i,0,x,E,a),i=a.x,x=a.z,i<this._minX||i>=this._maxX||x<=this._minZ||x>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const Y=this._getFacetAt(i,x),J=-(Y.x*i+Y.z*x+Y.w)/Y.y;return j.KJ.TransformCoordinatesFromFloatsToRef(0,J,0,e,a),a.y}getNormalAtCoordinates(i,x){const e=new j.KJ(0,1,0);return this.getNormalAtCoordinatesToRef(i,x,e),e}getNormalAtCoordinatesToRef(i,x,e){const E=this.getWorldMatrix(),a=j.TmpVectors.Matrix[5];E.invertToRef(a);const Y=j.TmpVectors.KJ[8];if(j.KJ.TransformCoordinatesFromFloatsToRef(i,0,x,a,Y),i=Y.x,x=Y.z,i<this._minX||i>this._maxX||x<this._minZ||x>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const J=this._getFacetAt(i,x);return j.KJ.TransformNormalFromFloatsToRef(J.x,J.y,J.z,E,e),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(i,x){const e=Math.floor((i+this._maxX)*this._subdivisionsX/this._width),j=Math.floor(-(x+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),E=this._heightQuads[j*this._subdivisionsX+e];let a;return a=x<E.slope.x*i+E.slope.y?E.facet1:E.facet2,a}_initHeightQuads(){const i=this._subdivisionsX,x=this._subdivisionsY;this._heightQuads=[];for(let e=0;e<x;e++)for(let x=0;x<i;x++){const E={slope:j.Vector2.Zero(),facet1:new j.Vector4(0,0,0,0),facet2:new j.Vector4(0,0,0,0)};this._heightQuads[e*i+x]=E}return this}_computeHeightQuads(){const i=this.getVerticesData(J.f.PositionKind);if(!i)return this;const x=j.TmpVectors.KJ[3],e=j.TmpVectors.KJ[2],E=j.TmpVectors.KJ[1],a=j.TmpVectors.KJ[0],Y=j.TmpVectors.KJ[4],u=j.TmpVectors.KJ[5],b=j.TmpVectors.KJ[6],g=j.TmpVectors.KJ[7],A=j.TmpVectors.KJ[8];let K=0,L=0,o=0,M=0,z=0,T=0,Q=0;const t=this._subdivisionsX,V=this._subdivisionsY;for(let J=0;J<V;J++)for(let V=0;V<t;V++){K=3*V,L=J*(t+1)*3,o=(J+1)*(t+1)*3,x.x=i[L+K],x.y=i[L+K+1],x.z=i[L+K+2],e.x=i[L+K+3],e.y=i[L+K+4],e.z=i[L+K+5],E.x=i[o+K],E.y=i[o+K+1],E.z=i[o+K+2],a.x=i[o+K+3],a.y=i[o+K+4],a.z=i[o+K+5],M=(a.z-x.z)/(a.x-x.x),z=x.z-M*x.x,e.subtractToRef(x,Y),E.subtractToRef(x,u),a.subtractToRef(x,b),j.KJ.CrossToRef(b,u,g),j.KJ.CrossToRef(Y,b,A),g.normalize(),A.normalize(),T=-(g.x*x.x+g.y*x.y+g.z*x.z),Q=-(A.x*e.x+A.y*e.y+A.z*e.z);const S=this._heightQuads[J*t+V];S.slope.fJ(M,z),S.facet1.fJ(g.x,g.y,g.z,T),S.facet2.fJ(A.x,A.y,A.z,Q)}return this}serialize(i){super.serialize(i),i.subdivisionsX=this._subdivisionsX,i.subdivisionsY=this._subdivisionsY,i.minX=this._minX,i.maxX=this._maxX,i.De=this._minZ,i.maxZ=this._maxZ,i.width=this._width,i.height=this._height}static Parse(i,x){const e=new u(i.name,x);return e._subdivisionsX=i.subdivisionsX||1,e._subdivisionsY=i.subdivisionsY||1,e._minX=i.minX,e._maxX=i.maxX,e._minZ=i.De,e._maxZ=i.maxZ,e._width=i.width,e._height=i.height,e}}var b=e(12061),g=e(12108),A=e(12253),K=e(12301);function L(i){const x=[],e=[],E=[],a=[];let J,u;const b=i.width||i.size||1,g=i.height||i.size||1,A=0|(i.subdivisionsX||i.subdivisions||1),L=0|(i.subdivisionsY||i.subdivisions||1);for(J=0;J<=L;J++)for(u=0;u<=A;u++){const i=new j.KJ(u*b/A-b/2,0,(L-J)*g/L-g/2),x=new j.KJ(0,1,0);e.push(i.x,i.y,i.z),E.push(x.x,x.y,x.z),a.push(u/A,K.d?J/L:1-J/L)}for(J=0;J<L;J++)for(u=0;u<A;u++)x.push(u+1+(J+1)*(A+1)),x.push(u+1+J*(A+1)),x.push(u+J*(A+1)),x.push(u+(J+1)*(A+1)),x.push(u+1+(J+1)*(A+1)),x.push(u+J*(A+1));const o=new Y.e;return o.indices=x,o.li=e,o.Zi=E,o.ki=a,o}function o(i){const x=void 0!==i.xmin&&null!==i.xmin?i.xmin:-1,e=void 0!==i.zmin&&null!==i.zmin?i.zmin:-1,E=void 0!==i.xmax&&null!==i.xmax?i.xmax:1,a=void 0!==i.zmax&&null!==i.zmax?i.zmax:1,J=i.subdivisions||{w:1,h:1},u=i.precision||{w:1,h:1},b=[],g=[],A=[],K=[];let L,o,M,z;J.h=J.h<1?1:J.h,J.w=J.w<1?1:J.w,u.w=u.w<1?1:u.w,u.h=u.h<1?1:u.h;const T=(E-x)/J.w,Q=(a-e)/J.h;function t(i,x,e,E){const a=g.length/3,Y=u.w+1;for(L=0;L<u.h;L++)for(o=0;o<u.w;o++){const i=[a+o+L*Y,a+(o+1)+L*Y,a+(o+1)+(L+1)*Y,a+o+(L+1)*Y];b.push(i[1]),b.push(i[2]),b.push(i[3]),b.push(i[0]),b.push(i[1]),b.push(i[3])}const J=j.KJ.Zero(),M=new j.KJ(0,1,0);for(L=0;L<=u.h;L++)for(J.z=L*(E-x)/u.h+x,o=0;o<=u.w;o++)J.x=o*(e-i)/u.w+i,J.y=0,g.push(J.x,J.y,J.z),A.push(M.x,M.y,M.z),K.push(o/u.w,L/u.h)}for(M=0;M<J.h;M++)for(z=0;z<J.w;z++)t(x+z*T,e+M*Q,x+(z+1)*T,e+(M+1)*Q);const V=new Y.e;return V.indices=b,V.li=g,V.Zi=A,V.ki=K,V}function M(i){const x=[],e=[],a=[],J=[];let u,b;const g=i.colorFilter||new E.MJ(.3,.59,.11),K=i.alphaFilter||0;let L=!1;if(i.minHeight>i.maxHeight){L=!0;const x=i.maxHeight;i.maxHeight=i.minHeight,i.minHeight=x}for(u=0;u<=i.subdivisions;u++)for(b=0;b<=i.subdivisions;b++){const x=new j.KJ(b*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-u)*i.height/i.subdivisions-i.height/2),E=4*(((x.x+i.width/2)/i.width*(i.bufferWidth-1)|0)+((1-(x.z+i.height/2)/i.height)*(i.bufferHeight-1)|0)*i.bufferWidth);let Y=i.buffer[E]/255,o=i.buffer[E+1]/255,M=i.buffer[E+2]/255;const z=i.buffer[E+3]/255;L&&(Y=1-Y,o=1-o,M=1-M);const T=Y*g.r+o*g.g+M*g.b;x.y=z>=K?i.minHeight+(i.maxHeight-i.minHeight)*T:i.minHeight-A.e,i.heightBuffer&&(i.heightBuffer[u*(i.subdivisions+1)+b]=x.y),e.push(x.x,x.y,x.z),a.push(0,0,0),J.push(b/i.subdivisions,1-u/i.subdivisions)}for(u=0;u<i.subdivisions;u++)for(b=0;b<i.subdivisions;b++){const j=b+1+(u+1)*(i.subdivisions+1),E=b+1+u*(i.subdivisions+1),a=b+u*(i.subdivisions+1),Y=b+(u+1)*(i.subdivisions+1),J=e[3*j+1]>=i.minHeight,g=e[3*E+1]>=i.minHeight,A=e[3*a+1]>=i.minHeight;J&&g&&A&&(x.push(j),x.push(E),x.push(a));e[3*Y+1]>=i.minHeight&&J&&A&&(x.push(Y),x.push(j),x.push(a))}Y.e.ComputeNormals(e,x,a);const o=new Y.e;return o.indices=x,o.li=e,o.Zi=a,o.ki=J,o}function z(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=new u(i,arguments.length>2?arguments[2]:void 0);e._setReady(!1),e._subdivisionsX=x.subdivisionsX||x.subdivisions||1,e._subdivisionsY=x.subdivisionsY||x.subdivisions||1,e._width=x.width||1,e._height=x.height||1,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ;return L(x).mx(e,x.updatable),e._setReady(!0),e}function T(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new a.c(i,e);return o(x).mx(j,x.updatable),j}function Q(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const a=e.width||10,Y=e.height||10,J=e.subdivisions||1,A=e.minHeight||0,K=e.maxHeight||1,L=e.colorFilter||new E.MJ(.3,.59,.11),o=e.alphaFilter||0,z=e.updatable,T=e.onReady;j=j||g.e.LastCreatedScene;const Q=new u(i,j);let t;Q._subdivisionsX=J,Q._subdivisionsY=J,Q._width=a,Q._height=Y,Q._maxX=Q._width/2,Q._maxZ=Q._height/2,Q._minX=-Q._maxX,Q._minZ=-Q._maxZ,Q._setReady(!1),e.passHeightBufferInCallback&&(t=new Float32Array((J+1)*(J+1)));const V=(i,x,e)=>{M({width:a,height:Y,subdivisions:J,minHeight:A,maxHeight:K,colorFilter:L,buffer:i,bufferWidth:x,bufferHeight:e,alphaFilter:o,heightBuffer:t}).mx(Q,z),T&&T(Q,t),Q._setReady(!0)};if("string"===typeof x){const i=i=>{var x;const e=i.width,E=i.height;if(j.M)return;const a=null===(x=j)||void 0===x?void 0:x.getEngine().resizeImageBitmap(i,e,E);V(a,e,E)};b.Tools.LoadImage(x,i,e.onError?e.onError:()=>{},j.offlineProvider)}else V(x.data,x.width,x.height);return Q}Y.e.CreateGround=L,Y.e.CreateTiledGround=o,Y.e.CreateGroundFromHeightMap=M,a.c.CreateGround=(i,x,e,j,E,a)=>z(i,{width:x,height:e,subdivisions:j,updatable:a},E),a.c.CreateTiledGround=(i,x,e,j,E,a,Y,J,u)=>T(i,{xmin:x,zmin:e,xmax:j,zmax:E,subdivisions:a,precision:Y,updatable:u},J),a.c.CreateGroundFromHeightMap=(i,x,e,j,E,a,Y,J,u,b,g)=>Q(i,x,{width:e,height:j,subdivisions:E,minHeight:a,maxHeight:Y,updatable:u,onReady:b,alphaFilter:g},J)},14075:(i,x,e)=>{"use strict";e.d(x,{c:()=>L,e:()=>A,i:()=>K});var j=e(12250),E=e(12675),a=e(12657),Y=e(12777),J=e(12314),u=e(12072);function b(i){const x=[],e=[],j=i.lines,E=i.Bi,Y=[];let J=0;for(let a=0;a<j.length;a++){const i=j[a];for(let j=0;j<i.length;j++){const{x:u,y:b,z:g}=i[j];if(e.push(u,b,g),E){const i=E[a],{r:x,g:e,b:J,a:u}=i[j];Y.push(x,e,J,u)}j>0&&(x.push(J-1),x.push(J)),J++}}const u=new a.e;return u.indices=x,u.li=e,E&&(u.Bi=Y),u}function g(i){const x=i.dashSize||3,e=i.gapSize||1,E=i.dashNb||200,Y=i.points,J=[],u=[],b=j.KJ.Zero();let g=0,A=0,K=0,L=0,o=0,M=0,z=0;for(z=0;z<Y.length-1;z++)Y[z+1].subtractToRef(Y[z],b),g+=b.length();for(K=g/E,L=x*K/(x+e),z=0;z<Y.length-1;z++){Y[z+1].subtractToRef(Y[z],b),A=Math.floor(b.length()/K),b.normalize();for(let i=0;i<A;i++)o=K*i,J.push(Y[z].x+o*b.x,Y[z].y+o*b.y,Y[z].z+o*b.z),J.push(Y[z].x+(o+L)*b.x,Y[z].y+(o+L)*b.y,Y[z].z+(o+L)*b.z),u.push(M,M+1),M+=2}const T=new a.e;return T.li=J,T.indices=u,T}function A(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=x.instance,E=x.lines,a=x.Bi;if(j){const i=j.getVerticesData(J.f.PositionKind);let x,e;a&&(x=j.getVerticesData(J.f.ColorKind));let Y=0,u=0;for(let j=0;j<E.length;j++){const J=E[j];for(let E=0;E<J.length;E++)i[Y]=J[E].x,i[Y+1]=J[E].y,i[Y+2]=J[E].z,a&&x&&(e=a[j],x[u]=e[E].r,x[u+1]=e[E].g,x[u+2]=e[E].b,x[u+3]=e[E].a,u+=4),Y+=3}return j.updateVerticesData(J.f.PositionKind,i,!1,!1),a&&x&&j.updateVerticesData(J.f.ColorKind,x,!1,!1),j.refreshBoundingInfo(),j}const u=!!a,g=new Y.b(i,e,null,void 0,void 0,u,x.useVertexAlpha,x.material);return b(x).mx(g,x.updatable),g}function K(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=x.Bi?[x.Bi]:null;return A(i,{lines:[x.points],updatable:x.updatable,instance:x.instance,Bi:j,useVertexAlpha:x.useVertexAlpha,material:x.material},e)}function L(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=x.points,J=x.instance,b=x.gapSize||1,A=x.dashSize||3;if(J){const i=i=>{const x=j.KJ.Zero(),e=i.length/6;let E=0,Y=0,u=0,b=0,g=0,A=0,K=0,L=0;for(K=0;K<a.length-1;K++)a[K+1].subtractToRef(a[K],x),E+=x.length();u=E/e;const o=J._creationDataStorage.dashSize;for(b=o*u/(o+J._creationDataStorage.gapSize),K=0;K<a.length-1;K++)for(a[K+1].subtractToRef(a[K],x),Y=Math.floor(x.length()/u),x.normalize(),L=0;L<Y&&A<i.length;)g=u*L,i[A]=a[K].x+g*x.x,i[A+1]=a[K].y+g*x.y,i[A+2]=a[K].z+g*x.z,i[A+3]=a[K].x+(g+b)*x.x,i[A+4]=a[K].y+(g+b)*x.y,i[A+5]=a[K].z+(g+b)*x.z,A+=6,L++;for(;A<i.length;)i[A]=a[K].x,i[A+1]=a[K].y,i[A+2]=a[K].z,A+=3};return(x.dashNb||x.dashSize||x.gapSize||x.useVertexAlpha||x.material)&&u.c.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),J.updateMeshPositions(i,!1),J}const K=new Y.b(i,e,null,void 0,void 0,void 0,x.useVertexAlpha,x.material);return g(x).mx(K,x.updatable),K._creationDataStorage=new E.f,K._creationDataStorage.dashSize=A,K._creationDataStorage.gapSize=b,K}a.e.CreateLineSystem=b,a.e.CreateDashedLines=g,E.c.Ag=function(i,x){return K(i,{points:x,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},E.c.CreateDashedLines=function(i,x,e,j,E){return L(i,{points:x,dashSize:e,gapSize:j,dashNb:E,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},13500:(i,x,e)=>{"use strict";e.d(x,{b:()=>J,e:()=>u});var j=e(12675),E=e(12657),a=e(12301);function Y(i){const x=[],e=[],j=[],Y=[],J=void 0!==i.width?i.width:void 0!==i.size?i.size:1,u=void 0!==i.height?i.height:void 0!==i.size?i.size:1,b=0===i.sideOrientation?0:i.sideOrientation||E.e.DEFAULTSIDE,g=J/2,A=u/2;e.push(-g,-A,0),j.push(0,0,-1),Y.push(0,a.d?1:0),e.push(g,-A,0),j.push(0,0,-1),Y.push(1,a.d?1:0),e.push(g,A,0),j.push(0,0,-1),Y.push(1,a.d?0:1),e.push(-g,A,0),j.push(0,0,-1),Y.push(0,a.d?0:1),x.push(0),x.push(1),x.push(2),x.push(0),x.push(2),x.push(3),E.e._ComputeSides(b,e,x,j,Y,i.frontUVs,i.backUVs);const K=new E.e;return K.indices=x,K.li=e,K.Zi=j,K.ki=Y,K}function J(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const E=new j.c(i,e);x.sideOrientation=j.c._GetDefaultSideOrientation(x.sideOrientation),E._originalBuilderSideOrientation=x.sideOrientation;return Y(x).mx(E,x.updatable),x.sourcePlane&&(E.translate(x.sourcePlane.normal,-x.sourcePlane.d),E.setDirection(x.sourcePlane.normal.scale(-1))),E}const u={zg:J};E.e.zg=Y,j.c.zg=(i,x,e,j,E)=>J(i,{size:x,width:x,height:x,sideOrientation:E,updatable:j},e)},13562:(i,x,e)=>{"use strict";e.d(x,{c:()=>u});var j=e(12250),E=e(12675),a=e(12657),Y=e(12301);function J(i){const x=0|(i.segments||32),e=i.diameterX||i.diameter||1,E=i.diameterY||i.diameter||1,J=i.diameterZ||i.diameter||1,u=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,b=i.slice&&i.slice<=0?1:i.slice||1,g=0===i.sideOrientation?0:i.sideOrientation||a.e.DEFAULTSIDE,A=!!i.dedupTopBottomIndices,K=new j.KJ(e/2,E/2,J/2),L=2+x,o=2*L,M=[],z=[],T=[],Q=[];for(let a=0;a<=L;a++){const i=a/L,x=i*Math.PI*b;for(let e=0;e<=o;e++){const E=e/o,a=E*Math.PI*2*u,J=j.Matrix.RotationZ(-x),b=j.Matrix.RotationY(a),g=j.KJ.TransformCoordinates(j.KJ.Up(),J),A=j.KJ.TransformCoordinates(g,b),L=A.multiply(K),M=A.divide(K).normalize();z.push(L.x,L.y,L.z),T.push(M.x,M.y,M.z),Q.push(E,Y.d?1-i:i)}if(a>0){const i=z.length/3;for(let x=i-2*(o+1);x+o+2<i;x++)A?(a>1&&(M.push(x),M.push(x+1),M.push(x+o+1)),(a<L||b<1)&&(M.push(x+o+1),M.push(x+1),M.push(x+o+2))):(M.push(x),M.push(x+1),M.push(x+o+1),M.push(x+o+1),M.push(x+1),M.push(x+o+2))}}a.e._ComputeSides(g,z,M,T,Q,i.frontUVs,i.backUVs);const t=new a.e;return t.indices=M,t.li=z,t.Zi=T,t.ki=Q,t}function u(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return J(x).mx(j,x.updatable),j}a.e.CreateSphere=J,E.c.CreateSphere=(i,x,e,j,E,a)=>u(i,{segments:x,diameterX:e,diameterY:e,diameterZ:e,sideOrientation:a,updatable:E},j)},14377:(i,x,e)=>{"use strict";e.d(x,{b:()=>J});var j=e(12793),E=e(13847),a=e(12814),Y=e(12657);class J{static get Configuration(){return{get decoder(){return E.e.DefaultConfiguration},set decoder(i){E.e.DefaultConfiguration=i}}}static set Configuration(i){E.e.DefaultConfiguration=i.decoder}static get DecoderAvailable(){return(0,j.h)(E.e.DefaultConfiguration)}static get Default(){return J._Default??(J._Default=new J),J._Default}static ResetDefault(i){J._Default&&(i||J._Default.dispose(),J._Default=null)}constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.DefaultNumWorkers;const x="number"===typeof i?{...E.e.DefaultConfiguration,numWorkers:i}:{...E.e.DefaultConfiguration,...i};this._decoder=new E.e(x)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(i,x,e){return this._decoder.decodeMeshToMeshDataAsync(i,x,e)}async decodeMeshToGeometryAsync(i,x,e,j){return await this._decoder.decodeMeshToGeometryAsync(i,x,e,j)}async _decodeMeshToGeometryForGltfAsync(i,x,e,j,E,a){return await this._decoder._decodeMeshToGeometryForGltfAsync(i,x,e,j,E,a)}async decodeMeshAsync(i,x){const e=await this._decoder.decodeMeshToMeshDataAsync(i,x),j=new Y.e;e.indices&&(j.indices=e.indices);for(const E of e.attributes){const i=a.d.GetFloatData(E.data,E.size,a.d.GetDataType(E.data),E.byteOffset,E.byteStride,E.normalized,e.totalVertices);j.set(i,E.kind)}return j}}J.DefaultNumWorkers=(0,j.f)(),J._Default=null},13847:(i,x,e)=>{"use strict";e.d(x,{e:()=>b});var j=e(12793),E=e(12061),a=e(12682),Y=e(12814),J=e(12072),u=e(12807);class b extends j.d{static get DefaultAvailable(){return(0,j.h)(b.DefaultConfiguration)}static get Default(){return b._Default??(b._Default=new b),b._Default}static ResetDefault(i){b._Default&&(i||b._Default.dispose(),b._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(i,x){return{module:await(x||DracoDecoderModule)({wasmBinary:i})}}_getWorkerContent(){return`${u.b}(${u.e})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.DefaultConfiguration)}decodeMeshToMeshDataAsync(i,x,e){const j=i instanceof ArrayBuffer?new Int8Array(i):new Int8Array(i.buffer,i.byteOffset,i.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async i=>await new Promise(((E,a)=>{i.push(((i,Y)=>{let u=null;const b=[],g=x=>{i.removeEventListener("error",g),i.removeEventListener("message",A),a(x),Y()},A=x=>{const j=x.data;switch(j.id){case"indices":u=j.data;break;case"attribute":b.push({kind:j.kind,data:j.data,size:j.size,byteOffset:j.byteOffset,byteStride:j.byteStride,normalized:(a=j.kind,K=j.normalized,e&&void 0!==e[a]?(K!==e[a]&&J.c.Warn(`Normalized flag from Draco data (${K}) does not match normalized flag from glTF accessor (${e[a]}). Using flag from glTF accessor.`),e[a]):K)});break;case"decodeMeshDone":i.removeEventListener("error",g),i.removeEventListener("message",A),E({indices:u,attributes:b,totalVertices:j.totalVertices}),Y()}var a,K};i.addEventListener("error",g),i.addEventListener("message",A);const K=j.slice();i.postMessage({id:"decodeMesh",dataView:K,attributes:x},[K.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((i=>{let e=null;const E=[],a=(0,u.b)(i.module,j,x,(i=>{e=i}),((i,x,e,j,a,Y)=>{E.push({kind:i,data:x,size:e,byteOffset:j,byteStride:a,normalized:Y})}));return{indices:e,attributes:E,totalVertices:a}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(i,x,e,j){const E=await this.decodeMeshToMeshDataAsync(e,j),J=new a.b(i,x);E.indices&&J.setIndices(E.indices);for(const a of E.attributes)J.setVerticesBuffer(new Y.d(x.getEngine(),a.data,a.kind,!1,void 0,a.byteStride,void 0,a.byteOffset,a.size,void 0,a.normalized,!0),E.totalVertices);return J}async _decodeMeshToGeometryForGltfAsync(i,x,e,j,E,J){const u=await this.decodeMeshToMeshDataAsync(e,j,E),b=new a.b(i,x);J&&(b._boundingInfo=J,b.useBoundingInfoFromGeometry=!0),u.indices&&b.setIndices(u.indices);for(const a of u.attributes)b.setVerticesBuffer(new Y.d(x.getEngine(),a.data,a.kind,!1,void 0,a.byteStride,void 0,a.byteOffset,a.size,void 0,a.normalized,!0),u.totalVertices);return b}}b.DefaultConfiguration={wasmUrl:`${E.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${E.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},b._Default=null},14069:(i,x,e)=>{"use strict";e.d(x,{e:()=>Ji});var j=e(12250),E=e(12675),a=e(12314),Y=e(12657),J=e(12301);function u(i){let x=i.pathArray;const e=i.closeArray||!1,j=i.closePath||!1,E=i.invertUV||!1,u=Math.floor(x[0].length/2);let b=i.offset||u;b=b>u?u:Math.floor(b);const g=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE,A=i.ki,K=i.Bi,L=[],o=[],M=[],z=[],T=[],Q=[],t=[],V=[];let S;const f=[],w=[];let O,l,Z;if(x.length<2){const i=[],e=[];for(l=0;l<x[0].length-b;l++)i.push(x[0][l]),e.push(x[0][l+b]);x=[i,e]}let B=0;const k=j?1:0,N=e?1:0;let mi,X,C,n,I,d;for(S=x[0].length,O=0;O<x.length+N;O++){for(t[O]=0,T[O]=[0],mi=O===x.length?x[0]:x[O],X=mi.length,S=S<X?S:X,Z=0;Z<X;)L.push(mi[Z].x,mi[Z].y,mi[Z].z),Z>0&&(C=mi[Z].Cx(mi[Z-1]).length(),n=C+t[O],T[O].push(n),t[O]=n),Z++;j&&(Z--,L.push(mi[0].x,mi[0].y,mi[0].z),C=mi[Z].Cx(mi[0]).length(),n=C+t[O],T[O].push(n),t[O]=n),f[O]=X+k,w[O]=B,B+=X+k}let p,H,U=null,D=null;for(l=0;l<S+k;l++)for(V[l]=0,Q[l]=[0],O=0;O<x.length-1+N;O++)I=x[O],d=O===x.length-1?x[0]:x[O+1],l===S?(U=I[0],D=d[0]):(U=I[l],D=d[l]),C=D.Cx(U).length(),n=C+V[l],Q[l].push(n),V[l]=n;if(A)for(O=0;O<A.length;O++)z.push(A[O].x,J.d?1-A[O].y:A[O].y);else for(O=0;O<x.length+N;O++)for(l=0;l<S+k;l++)p=0!=t[O]?T[O][l]/t[O]:0,H=0!=V[l]?Q[l][O]/V[l]:0,E?z.push(H,p):z.push(p,J.d?1-H:H);O=0;let h=0,F=f[O]-1,R=f[O+1]-1,y=F<R?F:R,r=w[1]-w[0];const c=f.length-1;for(;h<=y&&O<c;)o.push(h,h+r,h+1),o.push(h+r+1,h+1,h+r),h+=1,h===y&&(O++,r=w[O+1]-w[O],F=f[O]-1,R=f[O+1]-1,h=w[O],y=F<R?F+h:R+h);if(Y.e.ComputeNormals(L,o,M),j){let i=0,e=0;for(O=0;O<x.length;O++){i=3*w[O],e=O+1<x.length?3*(w[O+1]-1):M.length-3,M[i]=.5*(M[i]+M[e]),M[i+1]=.5*(M[i+1]+M[e+1]),M[i+2]=.5*(M[i+2]+M[e+2]);const j=Math.sqrt(M[i]*M[i]+M[i+1]*M[i+1]+M[i+2]*M[i+2]);M[i]/=j,M[i+1]/=j,M[i+2]/=j,M[e]=M[i],M[e+1]=M[i+1],M[e+2]=M[i+2]}}if(e){let i=3*w[0],e=3*w[x.length];for(l=0;l<S+k;l++){M[i]=.5*(M[i]+M[e]),M[i+1]=.5*(M[i+1]+M[e+1]),M[i+2]=.5*(M[i+2]+M[e+2]);const x=Math.sqrt(M[i]*M[i]+M[i+1]*M[i+1]+M[i+2]*M[i+2]);M[i]/=x,M[i+1]/=x,M[i+2]/=x,M[e]=M[i],M[e+1]=M[i+1],M[e+2]=M[i+2],i+=3,e+=3}}Y.e._ComputeSides(g,L,o,M,z,i.frontUVs,i.backUVs);let P=null;if(K){P=new Float32Array(4*K.length);for(let i=0;i<K.length;i++)P[4*i]=K[i].r,P[4*i+1]=K[i].g,P[4*i+2]=K[i].b,P[4*i+3]=K[i].a}const q=new Y.e,W=new Float32Array(L),G=new Float32Array(M),v=new Float32Array(z);return q.indices=o,q.li=W,q.Zi=G,q.ki=v,P&&q.set(P,a.f.ColorKind),j&&(q._idx=w),q}function b(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const b=x.pathArray,g=x.closeArray,A=x.closePath,K=E.c._GetDefaultSideOrientation(x.sideOrientation),L=x.instance,o=x.updatable;if(L){const i=j.TmpVectors.KJ[0].OJ(Number.MAX_VALUE),e=j.TmpVectors.KJ[1].OJ(-Number.MAX_VALUE),u=x=>{let j=b[0].length;const a=L;let Y=0;const J=a._originalBuilderSideOrientation===E.c.DOUBLESIDE?2:1;for(let E=1;E<=J;++E)for(let J=0;J<b.length;++J){const E=b[J],u=E.length;j=j<u?j:u;for(let a=0;a<j;++a){const j=E[a];x[Y]=j.x,x[Y+1]=j.y,x[Y+2]=j.z,i.minimizeInPlaceFromFloats(j.x,j.y,j.z),e.maximizeInPlaceFromFloats(j.x,j.y,j.z),Y+=3}if(a._creationDataStorage&&a._creationDataStorage.closePath){const i=E[0];x[Y]=i.x,x[Y+1]=i.y,x[Y+2]=i.z,Y+=3}}},g=L.getVerticesData(a.f.PositionKind);if(u(g),L.hasBoundingInfo?L.getBoundingInfo().reConstruct(i,e,L._worldMatrix):L.buildBoundingInfo(i,e,L._worldMatrix),L.updateVerticesData(a.f.PositionKind,g,!1,!1),x.Bi){const i=L.getVerticesData(a.f.ColorKind);for(let e=0,j=0;e<x.Bi.length;e++,j+=4){const E=x.Bi[e];i[j]=E.r,i[j+1]=E.g,i[j+2]=E.b,i[j+3]=E.a}L.updateVerticesData(a.f.ColorKind,i,!1,!1)}if(x.ki){const i=L.getVerticesData(a.f.UVKind);for(let e=0;e<x.ki.length;e++)i[2*e]=x.ki[e].x,i[2*e+1]=J.d?1-x.ki[e].y:x.ki[e].y;L.updateVerticesData(a.f.UVKind,i,!1,!1)}if(!L.areNormalsFrozen||L.isFacetDataEnabled){const i=L.Pe(),x=L.getVerticesData(a.f.NormalKind),e=L.isFacetDataEnabled?L.getFacetDataParameters():null;if(Y.e.ComputeNormals(g,i,x,e),L._creationDataStorage&&L._creationDataStorage.closePath){let i=0,e=0;for(let j=0;j<b.length;j++)i=3*L._creationDataStorage.idx[j],e=j+1<b.length?3*(L._creationDataStorage.idx[j+1]-1):x.length-3,x[i]=.5*(x[i]+x[e]),x[i+1]=.5*(x[i+1]+x[e+1]),x[i+2]=.5*(x[i+2]+x[e+2]),x[e]=x[i],x[e+1]=x[i+1],x[e+2]=x[i+2]}L.areNormalsFrozen||L.updateVerticesData(a.f.NormalKind,x,!1,!1)}return L}{const j=new E.c(i,e);j._originalBuilderSideOrientation=K,j._creationDataStorage=new E.f;const a=u(x);return A&&(j._creationDataStorage.idx=a._idx),j._creationDataStorage.closePath=A,j._creationDataStorage.closeArray=g,a.mx(j,o),j}}Y.e.CreateRibbon=u,E.c.CreateRibbon=function(i,x){return b(i,{pathArray:x,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var g=e(13567),A=e(13447),K=e(12286);function L(i){const x=i.pattern||E.c.NO_FLIP,e=i.tileWidth||i.tileSize||1,j=i.tileHeight||i.tileSize||1,a=i.alignHorizontal||0,J=i.alignVertical||0,u=i.width||i.size||1,b=Math.floor(u/e);let g=u-b*e;const A=i.height||i.size||1,K=Math.floor(A/j);let L=A-K*j;const o=e*b/2,M=j*K/2;let z=0,T=0,Q=0,t=0,V=0,S=0;if(g>0||L>0){switch(Q=-o,t=-M,V=o,S=M,a){case E.c.CENTER:g/=2,Q-=g,V+=g;break;case E.c.LEFT:V+=g,z=-g/2;break;case E.c.RIGHT:Q-=g,z=g/2}switch(J){case E.c.CENTER:L/=2,t-=L,S+=L;break;case E.c.BOTTOM:S+=L,T=-L/2;break;case E.c.TOP:t-=L,T=L/2}}const f=[],w=[],O=[];O[0]=[0,0,1,0,1,1,0,1],O[1]=[0,0,1,0,1,1,0,1],x!==E.c.ROTATE_TILE&&x!==E.c.ROTATE_ROW||(O[1]=[1,1,0,1,0,0,1,0]),x!==E.c.FLIP_TILE&&x!==E.c.FLIP_ROW||(O[1]=[1,0,0,0,0,1,1,1]),x!==E.c.FLIP_N_ROTATE_TILE&&x!==E.c.FLIP_N_ROTATE_ROW||(O[1]=[0,1,1,1,1,0,0,0]);let l=[];const Z=[],B=[];let k=0;for(let Y=0;Y<K;Y++)for(let i=0;i<b;i++)f.push(i*e-o+z,Y*j-M+T,0),f.push((i+1)*e-o+z,Y*j-M+T,0),f.push((i+1)*e-o+z,(Y+1)*j-M+T,0),f.push(i*e-o+z,(Y+1)*j-M+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),l=x===E.c.FLIP_TILE||x===E.c.ROTATE_TILE||x===E.c.FLIP_N_ROTATE_TILE?l.concat(O[(i%2+Y%2)%2]):x===E.c.FLIP_ROW||x===E.c.ROTATE_ROW||x===E.c.FLIP_N_ROTATE_ROW?l.concat(O[Y%2]):l.concat(O[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),k+=4;if(g>0||L>0){const i=L>0&&(J===E.c.CENTER||J===E.c.TOP),Y=L>0&&(J===E.c.CENTER||J===E.c.BOTTOM),u=g>0&&(a===E.c.CENTER||a===E.c.RIGHT),A=g>0&&(a===E.c.CENTER||a===E.c.LEFT);let O,N,mi,X,C=[];if(i&&u&&(f.push(Q+z,t+T,0),f.push(-o+z,t+T,0),f.push(-o+z,t+L+T,0),f.push(Q+z,t+L+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,O=1-g/e,N=1-L/j,mi=1,X=1,C=[O,N,mi,N,mi,X,O,X],x===E.c.ROTATE_ROW&&(C=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),x===E.c.FLIP_ROW&&(C=[1-O,N,1-mi,N,1-mi,X,1-O,X]),x===E.c.FLIP_N_ROTATE_ROW&&(C=[O,1-N,mi,1-N,mi,1-X,O,1-X]),l=l.concat(C),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i&&A&&(f.push(o+z,t+T,0),f.push(V+z,t+T,0),f.push(V+z,t+L+T,0),f.push(o+z,t+L+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,O=0,N=1-L/j,mi=g/e,X=1,C=[O,N,mi,N,mi,X,O,X],(x===E.c.ROTATE_ROW||x===E.c.ROTATE_TILE&&b%2===0)&&(C=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),(x===E.c.FLIP_ROW||x===E.c.FLIP_TILE&&b%2===0)&&(C=[1-O,N,1-mi,N,1-mi,X,1-O,X]),(x===E.c.FLIP_N_ROTATE_ROW||x===E.c.FLIP_N_ROTATE_TILE&&b%2===0)&&(C=[O,1-N,mi,1-N,mi,1-X,O,1-X]),l=l.concat(C),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&u&&(f.push(Q+z,M+T,0),f.push(-o+z,M+T,0),f.push(-o+z,S+T,0),f.push(Q+z,S+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,O=1-g/e,N=0,mi=1,X=L/j,C=[O,N,mi,N,mi,X,O,X],(x===E.c.ROTATE_ROW&&K%2===1||x===E.c.ROTATE_TILE&&K%1===0)&&(C=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),(x===E.c.FLIP_ROW&&K%2===1||x===E.c.FLIP_TILE&&K%2===0)&&(C=[1-O,N,1-mi,N,1-mi,X,1-O,X]),(x===E.c.FLIP_N_ROTATE_ROW&&K%2===1||x===E.c.FLIP_N_ROTATE_TILE&&K%2===0)&&(C=[O,1-N,mi,1-N,mi,1-X,O,1-X]),l=l.concat(C),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),Y&&A&&(f.push(o+z,M+T,0),f.push(V+z,M+T,0),f.push(V+z,S+T,0),f.push(o+z,S+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,O=0,N=0,mi=g/e,X=L/j,C=[O,N,mi,N,mi,X,O,X],(x===E.c.ROTATE_ROW&&K%2===1||x===E.c.ROTATE_TILE&&(K+b)%2===1)&&(C=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),(x===E.c.FLIP_ROW&&K%2===1||x===E.c.FLIP_TILE&&(K+b)%2===1)&&(C=[1-O,N,1-mi,N,1-mi,X,1-O,X]),(x===E.c.FLIP_N_ROTATE_ROW&&K%2===1||x===E.c.FLIP_N_ROTATE_TILE&&(K+b)%2===1)&&(C=[O,1-N,mi,1-N,mi,1-X,O,1-X]),l=l.concat(C),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),i){const i=[];O=0,N=1-L/j,mi=1,X=1,i[0]=[O,N,mi,N,mi,X,O,X],i[1]=[O,N,mi,N,mi,X,O,X],x!==E.c.ROTATE_TILE&&x!==E.c.ROTATE_ROW||(i[1]=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),x!==E.c.FLIP_TILE&&x!==E.c.FLIP_ROW||(i[1]=[1-O,N,1-mi,N,1-mi,X,1-O,X]),x!==E.c.FLIP_N_ROTATE_TILE&&x!==E.c.FLIP_N_ROTATE_ROW||(i[1]=[O,1-N,mi,1-N,mi,1-X,O,1-X]);for(let j=0;j<b;j++)f.push(j*e-o+z,t+T,0),f.push((j+1)*e-o+z,t+T,0),f.push((j+1)*e-o+z,t+L+T,0),f.push(j*e-o+z,t+L+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,l=x===E.c.FLIP_TILE||x===E.c.ROTATE_TILE||x===E.c.FLIP_N_ROTATE_TILE?l.concat(i[(j+1)%2]):x===E.c.FLIP_ROW||x===E.c.ROTATE_ROW||x===E.c.FLIP_N_ROTATE_ROW?l.concat(i[1]):l.concat(i[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Y){const i=[];O=0,N=0,mi=1,X=L/j,i[0]=[O,N,mi,N,mi,X,O,X],i[1]=[O,N,mi,N,mi,X,O,X],x!==E.c.ROTATE_TILE&&x!==E.c.ROTATE_ROW||(i[1]=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),x!==E.c.FLIP_TILE&&x!==E.c.FLIP_ROW||(i[1]=[1-O,N,1-mi,N,1-mi,X,1-O,X]),x!==E.c.FLIP_N_ROTATE_TILE&&x!==E.c.FLIP_N_ROTATE_ROW||(i[1]=[O,1-N,mi,1-N,mi,1-X,O,1-X]);for(let j=0;j<b;j++)f.push(j*e-o+z,S-L+T,0),f.push((j+1)*e-o+z,S-L+T,0),f.push((j+1)*e-o+z,S+T,0),f.push(j*e-o+z,S+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,l=x===E.c.FLIP_TILE||x===E.c.ROTATE_TILE||x===E.c.FLIP_N_ROTATE_TILE?l.concat(i[(j+K)%2]):x===E.c.FLIP_ROW||x===E.c.ROTATE_ROW||x===E.c.FLIP_N_ROTATE_ROW?l.concat(i[K%2]):l.concat(i[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(u){const i=[];O=1-g/e,N=0,mi=1,X=1,i[0]=[O,N,mi,N,mi,X,O,X],i[1]=[O,N,mi,N,mi,X,O,X],x!==E.c.ROTATE_TILE&&x!==E.c.ROTATE_ROW||(i[1]=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),x!==E.c.FLIP_TILE&&x!==E.c.FLIP_ROW||(i[1]=[1-O,N,1-mi,N,1-mi,X,1-O,X]),x!==E.c.FLIP_N_ROTATE_TILE&&x!==E.c.FLIP_N_ROTATE_ROW||(i[1]=[O,1-N,mi,1-N,mi,1-X,O,1-X]);for(let e=0;e<K;e++)f.push(Q+z,e*j-M+T,0),f.push(Q+g+z,e*j-M+T,0),f.push(Q+g+z,(e+1)*j-M+T,0),f.push(Q+z,(e+1)*j-M+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,l=x===E.c.FLIP_TILE||x===E.c.ROTATE_TILE||x===E.c.FLIP_N_ROTATE_TILE?l.concat(i[(e+1)%2]):x===E.c.FLIP_ROW||x===E.c.ROTATE_ROW||x===E.c.FLIP_N_ROTATE_ROW?l.concat(i[e%2]):l.concat(i[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(A){const i=[];O=0,N=0,mi=g/j,X=1,i[0]=[O,N,mi,N,mi,X,O,X],i[1]=[O,N,mi,N,mi,X,O,X],x!==E.c.ROTATE_TILE&&x!==E.c.ROTATE_ROW||(i[1]=[1-O,1-N,1-mi,1-N,1-mi,1-X,1-O,1-X]),x!==E.c.FLIP_TILE&&x!==E.c.FLIP_ROW||(i[1]=[1-O,N,1-mi,N,1-mi,X,1-O,X]),x!==E.c.FLIP_N_ROTATE_TILE&&x!==E.c.FLIP_N_ROTATE_ROW||(i[1]=[O,1-N,mi,1-N,mi,1-X,O,1-X]);for(let e=0;e<K;e++)f.push(V-g+z,e*j-M+T,0),f.push(V+z,e*j-M+T,0),f.push(V+z,(e+1)*j-M+T,0),f.push(V-g+z,(e+1)*j-M+T,0),B.push(k,k+1,k+3,k+1,k+2,k+3),k+=4,l=x===E.c.FLIP_TILE||x===E.c.ROTATE_TILE||x===E.c.FLIP_N_ROTATE_TILE?l.concat(i[(e+b)%2]):x===E.c.FLIP_ROW||x===E.c.ROTATE_ROW||x===E.c.FLIP_N_ROTATE_ROW?l.concat(i[e%2]):l.concat(i[0]),Z.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),w.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const N=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE;Y.e._ComputeSides(N,f,B,w,l,i.frontUVs,i.backUVs);const mi=new Y.e;mi.indices=B,mi.li=f,mi.Zi=w,mi.ki=l;const X=N===Y.e.DOUBLESIDE?Z.concat(Z):Z;return mi.Bi=X,mi}function o(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return L(x).mx(j,x.updatable),j}function M(i){const x=i.faceUV||new Array(6),e=i.faceColors,a=i.pattern||E.c.NO_FLIP,u=i.width||i.size||1,b=i.height||i.size||1,g=i.depth||i.size||1,A=i.tileWidth||i.tileSize||1,o=i.tileHeight||i.tileSize||1,M=i.alignHorizontal||0,z=i.alignVertical||0,T=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE;for(let E=0;E<6;E++)void 0===x[E]&&(x[E]=new j.Vector4(0,0,1,1)),e&&void 0===e[E]&&(e[E]=new K.lJ(1,1,1,1));const Q=u/2,t=b/2,V=g/2,S=[];for(let j=0;j<2;j++)S[j]=L({pattern:a,tileWidth:A,tileHeight:o,width:u,height:b,alignVertical:z,alignHorizontal:M,sideOrientation:T});for(let j=2;j<4;j++)S[j]=L({pattern:a,tileWidth:A,tileHeight:o,width:g,height:b,alignVertical:z,alignHorizontal:M,sideOrientation:T});let f=z;z===E.c.BOTTOM?f=E.c.TOP:z===E.c.TOP&&(f=E.c.BOTTOM);for(let j=4;j<6;j++)S[j]=L({pattern:a,tileWidth:A,tileHeight:o,width:u,height:g,alignVertical:f,alignHorizontal:M,sideOrientation:T});let w=[],O=[],l=[],Z=[];const B=[],k=[],N=[],mi=[];let X=0,C=0;for(let E=0;E<6;E++){const i=S[E].li.length;k[E]=[],N[E]=[];for(let x=0;x<i/3;x++)k[E].push(new j.KJ(S[E].li[3*x],S[E].li[3*x+1],S[E].li[3*x+2])),N[E].push(new j.KJ(S[E].Zi[3*x],S[E].Zi[3*x+1],S[E].Zi[3*x+2]));X=S[E].ki.length,mi[E]=[];for(let e=0;e<X;e+=2)mi[E][e]=x[E].x+(x[E].z-x[E].x)*S[E].ki[e],mi[E][e+1]=x[E].y+(x[E].w-x[E].y)*S[E].ki[e+1],J.d&&(mi[E][e+1]=1-mi[E][e+1]);if(l=l.concat(mi[E]),Z=Z.concat(S[E].indices.map((i=>i+C))),C+=k[E].length,e)for(let x=0;x<4;x++)B.push(e[E].r,e[E].g,e[E].b,e[E].a)}const n=new j.KJ(0,0,V),I=j.Matrix.RotationY(Math.PI);w=k[0].map((i=>j.KJ.TransformNormal(i,I).add(n))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[]),O=N[0].map((i=>j.KJ.TransformNormal(i,I))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[]),w=w.concat(k[1].map((i=>i.Cx(n))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[])),O=O.concat(N[1].map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[]));const d=new j.KJ(Q,0,0),p=j.Matrix.RotationY(-Math.PI/2);w=w.concat(k[2].map((i=>j.KJ.TransformNormal(i,p).add(d))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[])),O=O.concat(N[2].map((i=>j.KJ.TransformNormal(i,p))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[]));const H=j.Matrix.RotationY(Math.PI/2);w=w.concat(k[3].map((i=>j.KJ.TransformNormal(i,H).Cx(d))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[])),O=O.concat(N[3].map((i=>j.KJ.TransformNormal(i,H))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[]));const U=new j.KJ(0,t,0),D=j.Matrix.RotationX(Math.PI/2);w=w.concat(k[4].map((i=>j.KJ.TransformNormal(i,D).add(U))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[])),O=O.concat(N[4].map((i=>j.KJ.TransformNormal(i,D))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[]));const h=j.Matrix.RotationX(-Math.PI/2);w=w.concat(k[5].map((i=>j.KJ.TransformNormal(i,h).Cx(U))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[])),O=O.concat(N[5].map((i=>j.KJ.TransformNormal(i,h))).map((i=>[i.x,i.y,i.z])).reduce(((i,x)=>i.concat(x)),[])),Y.e._ComputeSides(T,w,Z,O,l);const F=new Y.e;if(F.indices=Z,F.li=w,F.Zi=O,F.ki=l,e){const i=T===Y.e.DOUBLESIDE?B.concat(B):B;F.Bi=i}return F}function z(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return M(x).mx(j,x.updatable),j}Y.e.CreateTiledPlane=L;Y.e.CreateTiledBox=M;var T=e(13562),Q=e(12452),t=e(12423);function V(i){const x=i.height||2;let e=0===i.diameterTop?0:i.diameterTop||i.diameter||1,a=0===i.diameterBottom?0:i.diameterBottom||i.diameter||1;e=e||1e-5,a=a||1e-5;const u=0|(i.tessellation||24),b=0|(i.subdivisions||1),g=!!i.hasRings,A=!!i.enclose,L=0===i.cap?0:i.cap||E.c.CAP_ALL,o=i.arc&&(i.arc<=0||i.arc>1)?1:i.arc||1,M=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE,z=i.faceUV||new Array(3),T=i.faceColors,Q=2+(1+(1!==o&&A?2:0))*(g?b:1);let V;for(V=0;V<Q;V++)T&&void 0===T[V]&&(T[V]=new K.lJ(1,1,1,1));for(V=0;V<Q;V++)z&&void 0===z[V]&&(z[V]=new j.Vector4(0,0,1,1));const S=[],f=[],w=[],O=[],l=[],Z=2*Math.PI*o/u;let B,k,N;const mi=(a-e)/2/x,X=j.KJ.Zero(),C=j.KJ.Zero(),n=j.KJ.Zero(),I=j.KJ.Zero(),d=j.KJ.Zero(),p=t.d.Y;let H,U,D,h=1,F=1,R=0,y=0;for(H=0;H<=b;H++)for(k=H/b,N=(k*(e-a)+a)/2,h=g&&0!==H&&H!==b?2:1,D=0;D<h;D++){for(g&&(F+=D),A&&(F+=2*D),U=0;U<=u;U++)B=U*Z,X.x=Math.cos(-B)*N,X.y=-x/2+k*x,X.z=Math.sin(-B)*N,0===e&&H===b?(C.x=w[w.length-3*(u+1)],C.y=w[w.length-3*(u+1)+1],C.z=w[w.length-3*(u+1)+2]):(C.x=X.x,C.z=X.z,C.y=Math.sqrt(C.x*C.x+C.z*C.z)*mi,C.normalize()),0===U&&(n.A(X),I.A(C)),f.push(X.x,X.y,X.z),w.push(C.x,C.y,C.z),y=g?R!==F?z[F].y:z[F].w:z[F].y+(z[F].w-z[F].y)*k,O.push(z[F].x+(z[F].z-z[F].x)*U/u,J.d?1-y:y),T&&l.push(T[F].r,T[F].g,T[F].b,T[F].a);1!==o&&A&&(f.push(X.x,X.y,X.z),f.push(0,X.y,0),f.push(0,X.y,0),f.push(n.x,n.y,n.z),j.KJ.CrossToRef(p,C,d),d.normalize(),w.push(d.x,d.y,d.z,d.x,d.y,d.z),j.KJ.CrossToRef(I,p,d),d.normalize(),w.push(d.x,d.y,d.z,d.x,d.y,d.z),y=g?R!==F?z[F+1].y:z[F+1].w:z[F+1].y+(z[F+1].w-z[F+1].y)*k,O.push(z[F+1].x,J.d?1-y:y),O.push(z[F+1].z,J.d?1-y:y),y=g?R!==F?z[F+2].y:z[F+2].w:z[F+2].y+(z[F+2].w-z[F+2].y)*k,O.push(z[F+2].x,J.d?1-y:y),O.push(z[F+2].z,J.d?1-y:y),T&&(l.push(T[F+1].r,T[F+1].g,T[F+1].b,T[F+1].a),l.push(T[F+1].r,T[F+1].g,T[F+1].b,T[F+1].a),l.push(T[F+2].r,T[F+2].g,T[F+2].b,T[F+2].a),l.push(T[F+2].r,T[F+2].g,T[F+2].b,T[F+2].a))),R!==F&&(R=F)}const r=1!==o&&A?u+4:u;for(H=0,F=0;F<b;F++){let i=0,x=0,e=0,j=0;for(U=0;U<u;U++)i=H*(r+1)+U,x=(H+1)*(r+1)+U,e=H*(r+1)+(U+1),j=(H+1)*(r+1)+(U+1),S.push(i,x,e),S.push(j,e,x);1!==o&&A&&(S.push(i+2,x+2,e+2),S.push(j+2,e+2,x+2),S.push(i+4,x+4,e+4),S.push(j+4,e+4,x+4)),H=g?H+2:H+1}const c=i=>{const E=i?e/2:a/2;if(0===E)return;let Y,b,g;const A=i?z[Q-1]:z[0];let K=null;T&&(K=i?T[Q-1]:T[0]);const L=f.length/3,M=i?x/2:-x/2,t=new j.KJ(0,M,0);f.push(t.x,t.y,t.z),w.push(0,i?1:-1,0);const V=A.y+.5*(A.w-A.y);O.push(A.x+.5*(A.z-A.x),J.d?1-V:V),K&&l.push(K.r,K.g,K.b,K.a);const Z=new j.Vector2(.5,.5);for(g=0;g<=u;g++){Y=2*Math.PI*g*o/u;const x=Math.cos(-Y),e=Math.sin(-Y);b=new j.KJ(x*E,M,e*E);const a=new j.Vector2(x*Z.x+.5,e*Z.y+.5);f.push(b.x,b.y,b.z),w.push(0,i?1:-1,0);const L=A.y+(A.w-A.y)*a.y;O.push(A.x+(A.z-A.x)*a.x,J.d?1-L:L),K&&l.push(K.r,K.g,K.b,K.a)}for(g=0;g<u;g++)i?(S.push(L),S.push(L+(g+2)),S.push(L+(g+1))):(S.push(L),S.push(L+(g+1)),S.push(L+(g+2)))};L!==E.c.CAP_START&&L!==E.c.CAP_ALL||c(!1),L!==E.c.CAP_END&&L!==E.c.CAP_ALL||c(!0),Y.e._ComputeSides(M,f,S,w,O,i.frontUVs,i.backUVs);const P=new Y.e;return P.indices=S,P.li=f,P.Zi=w,P.ki=O,T&&(P.Bi=l),P}function S(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return V(x).mx(j,x.updatable),j}function f(i){const x=[],e=[],E=[],a=[],u=i.diameter||1,b=i.thickness||.5,g=0|(i.tessellation||16),A=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE,K=g+1;for(let Y=0;Y<=g;Y++){const i=Y/g,A=Y*Math.PI*2/g-Math.PI/2,L=j.Matrix.Translation(u/2,0,0).multiply(j.Matrix.RotationY(A));for(let u=0;u<=g;u++){const A=1-u/g,o=u*Math.PI*2/g+Math.PI,M=Math.cos(o),z=Math.sin(o);let T=new j.KJ(M,z,0),Q=T.scale(b/2);const t=new j.Vector2(i,A);Q=j.KJ.TransformCoordinates(Q,L),T=j.KJ.TransformNormal(T,L),e.push(Q.x,Q.y,Q.z),E.push(T.x,T.y,T.z),a.push(t.x,J.d?1-t.y:t.y);const V=(Y+1)%K,S=(u+1)%K;x.push(Y*K+u),x.push(Y*K+S),x.push(V*K+u),x.push(Y*K+S),x.push(V*K+S),x.push(V*K+u)}}Y.e._ComputeSides(A,e,x,E,a,i.frontUVs,i.backUVs);const L=new Y.e;return L.indices=x,L.li=e,L.Zi=E,L.ki=a,L}function w(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return f(x).mx(j,x.updatable),j}Y.e.CreateCylinder=V,E.c.CreateCylinder=(i,x,e,j,a,Y,J,u,b)=>{void 0!==J&&J instanceof Q.d||(void 0!==J&&(b=u||E.c.DEFAULTSIDE,u=J),J=Y,Y=1);return S(i,{height:x,diameterTop:e,diameterBottom:j,tessellation:a,subdivisions:Y,sideOrientation:b,updatable:u},J)};function O(i){const x=[],e=[],E=[],a=[],u=i.radius||2,b=i.tube||.5,g=i.radialSegments||32,A=i.tubularSegments||32,K=i.p||2,L=i.q||3,o=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE,M=i=>{const x=Math.cos(i),e=Math.sin(i),E=L/K*i,a=Math.cos(E),Y=u*(2+a)*.5*x,J=u*(2+a)*e*.5,b=u*Math.sin(E)*.5;return new j.KJ(Y,J,b)};let z,T;for(z=0;z<=g;z++){const i=z%g/g*2*K*Math.PI,x=M(i),E=M(i+.01),Y=E.Cx(x);let u=E.add(x);const L=j.KJ.Cross(Y,u);for(u=j.KJ.Cross(L,Y),L.normalize(),u.normalize(),T=0;T<A;T++){const i=T%A/A*2*Math.PI,j=-b*Math.cos(i),E=b*Math.sin(i);e.push(x.x+j*u.x+E*L.x),e.push(x.y+j*u.y+E*L.y),e.push(x.z+j*u.z+E*L.z),a.push(z/g),a.push(J.d?1-T/A:T/A)}}for(z=0;z<g;z++)for(T=0;T<A;T++){const i=(T+1)%A,e=z*A+T,j=(z+1)*A+T,E=(z+1)*A+i,a=z*A+i;x.push(a),x.push(j),x.push(e),x.push(a),x.push(E),x.push(j)}Y.e.ComputeNormals(e,x,E),Y.e._ComputeSides(o,e,x,E,a,i.frontUVs,i.backUVs);const Q=new Y.e;return Q.indices=x,Q.li=e,Q.Zi=E,Q.ki=a,Q}function l(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return O(x).mx(j,x.updatable),j}Y.e.CreateTorus=f,E.c.CreateTorus=(i,x,e,j,E,a,Y)=>w(i,{diameter:x,thickness:e,tessellation:j,sideOrientation:Y,updatable:a},E);Y.e.CreateTorusKnot=O,E.c.CreateTorusKnot=(i,x,e,j,E,a,Y,J,u,b)=>l(i,{radius:x,tube:e,radialSegments:j,tubularSegments:E,p:a,q:Y,sideOrientation:b,updatable:u},J);var Z=e(14075),B=e(12783),k=e(12429);function N(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=x.path,a=x.shape,Y=x.scale||1,J=x.rotation||0,u=0===x.cap?0:x.cap||E.c.NO_CAP,b=x.updatable,g=E.c._GetDefaultSideOrientation(x.sideOrientation),A=x.instance||null,K=x.invertUV||!1,L=x.closeShape||!1,o=x.closePath||!1,M=x.capFunction||null;return X(i,a,j,Y,J,null,null,o,L,u,!1,e,!!b,g,A,K,x.frontUVs||null,x.backUVs||null,x.firstNormal||null,!!x.adjustFrame,M)}function mi(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=x.path,a=x.shape,Y=x.scaleFunction||(()=>1),J=x.rotationFunction||(()=>0),u=x.closePath||x.ribbonCloseArray||!1,b=x.closeShape||x.ribbonClosePath||!1,g=0===x.cap?0:x.cap||E.c.NO_CAP,A=x.updatable,K=x.firstNormal||null,L=x.adjustFrame||!1,o=E.c._GetDefaultSideOrientation(x.sideOrientation),M=x.instance,z=x.invertUV||!1,T=x.capFunction||null;return X(i,a,j,null,null,Y,J,u,b,g,!0,e,!!A,o,M||null,z,x.frontUVs||null,x.backUVs||null,K,L,T||null)}function X(i,x,e,a,Y,J,u,g,A,K,L,o,M,z,T,Q,t,V,S,f,w){const O=(i,x,e,a,Y,J,u,b,g,A,K)=>{const L=e.getTangents(),o=e.getNormals(),M=e.getBinormals(),z=e.getDistances();if(K)for(let E=0;E<L.length;E++)if(0==L[E].x&&0==L[E].y&&0==L[E].z&&L[E].A(L[E-1]),0==o[E].x&&0==o[E].y&&0==o[E].z&&o[E].A(o[E-1]),0==M[E].x&&0==M[E].y&&0==M[E].z&&M[E].A(M[E-1]),E>0){let i=L[E-1];j.KJ.Dot(i,L[E])<0&&L[E].scaleInPlace(-1),i=o[E-1],j.KJ.Dot(i,o[E])<0&&o[E].scaleInPlace(-1),i=M[E-1],j.KJ.Dot(i,M[E])<0&&M[E].scaleInPlace(-1)}let T=0;const Q=A&&b?b:()=>null!==J?J:0,t=A&&u?u:()=>null!==Y?Y:1;let V=g===E.c.NO_CAP||g===E.c.CAP_END?0:2;const S=j.TmpVectors.Matrix[0];for(let E=0;E<x.length;E++){const e=[],Y=Q(E,z[E]),J=t(E,z[E]);j.Matrix.RotationAxisToRef(L[E],T,S);for(let a=0;a<i.length;a++){const Y=L[E].scale(i[a].z).add(o[E].scale(i[a].x)).add(M[E].scale(i[a].y)),u=j.KJ.Zero();j.KJ.TransformCoordinatesToRef(Y,S,u),u.scaleInPlace(J).addInPlace(x[E]),e[a]=u}a[V]=e,T+=Y,V++}const f=w||(i=>{const x=Array(),e=j.KJ.Zero();let E;for(E=0;E<i.length;E++)e.addInPlace(i[E]);for(e.scaleInPlace(1/i.length),E=0;E<i.length;E++)x.push(e);return x});switch(g){case E.c.NO_CAP:break;case E.c.CAP_START:a[0]=f(a[2]),a[1]=a[2];break;case E.c.CAP_END:a[V]=a[V-1],a[V+1]=f(a[V-1]);break;case E.c.CAP_ALL:a[0]=f(a[2]),a[1]=a[2],a[V]=a[V-1],a[V+1]=f(a[V-1])}return a};let l,Z;if(T){const i=T._creationDataStorage;return l=S?i.path3D.update(e,S):i.path3D.update(e),Z=O(x,e,i.path3D,i.pathArray,a,Y,J,u,i.cap,L,f),T=b("",{pathArray:Z,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:T},o||void 0)}l=S?new k.j(e,S):new k.j(e);Z=O(x,e,l,new Array,a,Y,J,u,K=K<0||K>3?0:K,L,f);const B=b(i,{pathArray:Z,closeArray:g,closePath:A,updatable:M,sideOrientation:z,invertUV:Q,frontUVs:t||void 0,backUVs:V||void 0},o);return B._creationDataStorage.pathArray=Z,B._creationDataStorage.path3D=l,B._creationDataStorage.cap=K,B}function C(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=x.arc?x.arc<=0||x.arc>1?1:x.arc:1,Y=void 0===x.closed||x.closed,J=x.shape,u=x.radius||1,g=x.tessellation||64,A=x.clip||0,K=x.updatable,L=E.c._GetDefaultSideOrientation(x.sideOrientation),o=x.cap||E.c.NO_CAP,M=2*Math.PI,z=[],T=x.invertUV||!1;let Q=0,t=0;const V=M/g*a;let S,f;for(Q=0;Q<=g-A;Q++){for(f=[],o!=E.c.CAP_START&&o!=E.c.CAP_ALL||(f.push(new j.KJ(0,J[0].y,0)),f.push(new j.KJ(Math.cos(Q*V)*J[0].x*u,J[0].y,Math.sin(Q*V)*J[0].x*u))),t=0;t<J.length;t++)S=new j.KJ(Math.cos(Q*V)*J[t].x*u,J[t].y,Math.sin(Q*V)*J[t].x*u),f.push(S);o!=E.c.CAP_END&&o!=E.c.CAP_ALL||(f.push(new j.KJ(Math.cos(Q*V)*J[J.length-1].x*u,J[J.length-1].y,Math.sin(Q*V)*J[J.length-1].x*u)),f.push(new j.KJ(0,J[J.length-1].y,0))),z.push(f)}return b(i,{pathArray:z,closeArray:Y,sideOrientation:L,updatable:K,invertUV:T,frontUVs:x.frontUVs,backUVs:x.backUVs},e)}E.c.ExtrudeShape=function(i,x,e,j,a,Y){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7?arguments[7]:void 0,b=arguments.length>8?arguments[8]:void 0,g=arguments.length>9?arguments[9]:void 0;return N(i,{shape:x,path:e,scale:j,rotation:a,cap:0===Y?0:Y||E.c.NO_CAP,sideOrientation:b,instance:g,updatable:u},J)},E.c.ExtrudeShapeCustom=(i,x,e,j,a,Y,J,u,b,g,A,K)=>mi(i,{shape:x,path:e,scaleFunction:j,rotationFunction:a,ribbonCloseArray:Y,ribbonClosePath:J,cap:0===u?0:u||E.c.NO_CAP,sideOrientation:A,instance:K,updatable:g},b);E.c.CreateLathe=(i,x,e,j,E,a,Y)=>C(i,{shape:x,radius:e,tessellation:j,sideOrientation:Y,updatable:a},E);var n=e(13500),I=e(13451);function d(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=x.path;let Y=x.instance,J=1;void 0!==x.radius?J=x.radius:Y&&(J=Y._creationDataStorage.radius);const u=x.tessellation||64,g=x.radiusFunction||null;let A=x.cap||E.c.NO_CAP;const K=x.invertUV||!1,L=x.updatable,o=E.c._GetDefaultSideOrientation(x.sideOrientation);x.arc=x.arc&&(x.arc<=0||x.arc>1)?1:x.arc||1;const M=(i,x,e,a,Y,J,u,b)=>{const g=x.getTangents(),A=x.getNormals(),K=x.getDistances(),L=2*Math.PI/Y*b,o=J||(()=>a);let M,z,T,Q;const t=j.TmpVectors.Matrix[0];let V=u===E.c.NO_CAP||u===E.c.CAP_END?0:2;for(let E=0;E<i.length;E++){z=o(E,K[E]),M=Array(),T=A[E];for(let x=0;x<Y;x++)j.Matrix.RotationAxisToRef(g[E],L*x,t),Q=M[x]?M[x]:j.KJ.Zero(),j.KJ.TransformCoordinatesToRef(T,t,Q),Q.scaleInPlace(z).addInPlace(i[E]),M[x]=Q;e[V]=M,V++}const S=(x,e)=>{const j=Array();for(let E=0;E<x;E++)j.push(i[e]);return j};switch(u){case E.c.NO_CAP:break;case E.c.CAP_START:e[0]=S(Y,0),e[1]=e[2].slice(0);break;case E.c.CAP_END:e[V]=e[V-1].slice(0),e[V+1]=S(Y,i.length-1);break;case E.c.CAP_ALL:e[0]=S(Y,0),e[1]=e[2].slice(0),e[V]=e[V-1].slice(0),e[V+1]=S(Y,i.length-1)}return e};let z,T;if(Y){const i=Y._creationDataStorage,e=x.arc||i.arc;return z=i.path3D.update(a),T=M(a,z,i.pathArray,J,i.tessellation,g,i.cap,e),Y=b("",{pathArray:T,instance:Y}),i.path3D=z,i.pathArray=T,i.arc=e,i.radius=J,Y}z=new k.j(a);A=A<0||A>3?0:A,T=M(a,z,new Array,J,u,g,A,x.arc);const Q=b(i,{pathArray:T,closePath:!0,closeArray:!1,updatable:L,sideOrientation:o,invertUV:K,frontUVs:x.frontUVs,backUVs:x.backUVs},e);return Q._creationDataStorage.pathArray=T,Q._creationDataStorage.path3D=z,Q._creationDataStorage.tessellation=u,Q._creationDataStorage.cap=A,Q._creationDataStorage.arc=x.arc,Q._creationDataStorage.radius=J,Q}function p(i){const x=[];x[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},x[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},x[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},x[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},x[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},x[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},x[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},x[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},x[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},x[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},x[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},x[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},x[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},x[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},x[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const e=i.type&&(i.type<0||i.type>=x.length)?0:i.type||0,E=i.size,a=i.sizeX||E||1,u=i.sizeY||E||1,b=i.sizeZ||E||1,g=i.custom||x[e],A=g.face.length,L=i.faceUV||new Array(A),o=i.faceColors,M=void 0===i.flat||i.flat,z=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE,T=[],Q=[],t=[],V=[],S=[];let f=0,w=0;const O=[];let l,Z,B,k,N,mi,X=0,C=0;if(M)for(C=0;C<A;C++)o&&void 0===o[C]&&(o[C]=new K.lJ(1,1,1,1)),L&&void 0===L[C]&&(L[C]=new j.Vector4(0,0,1,1));if(M)for(C=0;C<A;C++){const i=g.face[C].length;for(B=2*Math.PI/i,k=.5*Math.tan(B/2),N=.5,X=0;X<i;X++)T.push(g.vertex[g.face[C][X]][0]*a,g.vertex[g.face[C][X]][1]*u,g.vertex[g.face[C][X]][2]*b),O.push(f),f++,l=L[C].x+(L[C].z-L[C].x)*(.5+k),Z=L[C].y+(L[C].w-L[C].y)*(N-.5),V.push(l,J.d?1-Z:Z),mi=k*Math.cos(B)-N*Math.sin(B),N=k*Math.sin(B)+N*Math.cos(B),k=mi,o&&S.push(o[C].r,o[C].g,o[C].b,o[C].a);for(X=0;X<i-2;X++)Q.push(O[0+w],O[X+2+w],O[X+1+w]);w+=i}else{for(X=0;X<g.vertex.length;X++)T.push(g.vertex[X][0]*a,g.vertex[X][1]*u,g.vertex[X][2]*b),V.push(0,J.d?1:0);for(C=0;C<A;C++)for(X=0;X<g.face[C].length-2;X++)Q.push(g.face[C][0],g.face[C][X+2],g.face[C][X+1])}Y.e.ComputeNormals(T,Q,t),Y.e._ComputeSides(z,T,Q,t,V,i.frontUVs,i.backUVs);const n=new Y.e;return n.li=T,n.indices=Q,n.Zi=t,n.ki=V,o&&M&&(n.Bi=S),n}function H(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return p(x).mx(j,x.updatable),j}E.c.CreateTube=(i,x,e,j,E,a,Y,J,u,b)=>d(i,{path:x,radius:e,tessellation:j,radiusFunction:E,arc:1,cap:a,updatable:J,sideOrientation:u,instance:b},Y);function U(i){const x=i.sideOrientation||Y.e.DEFAULTSIDE,e=i.radius||1,E=void 0===i.flat||i.flat,a=0|(i.subdivisions||4),u=i.radiusX||e,b=i.radiusY||e,g=i.radiusZ||e,A=(1+Math.sqrt(5))/2,K=[-1,A,-0,1,A,0,-1,-A,0,1,-A,0,0,-1,-A,0,1,-A,0,-1,A,0,1,A,A,0,1,A,0,-1,-A,0,1,-A,0,-1],L=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],o=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],M=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],z=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],T=[],Q=[],t=[],V=[];let S=0;const f=new Array(3),w=new Array(3);let O;for(O=0;O<3;O++)f[O]=j.KJ.Zero(),w[O]=j.Vector2.Zero();for(let Y=0;Y<20;Y++){for(O=0;O<3;O++){const i=L[3*Y+O];f[O].fJ(K[3*o[i]],K[3*o[i]+1],K[3*o[i]+2]),f[O].normalize(),w[O].fJ(.134765625*M[2*i]+.05859375+-.0390625*z[Y],.2333984375*M[2*i+1]+.025390625+.01953125*z[Y])}const i=(i,x,e,Y)=>{const A=j.KJ.Lerp(f[0],f[2],x/a),K=j.KJ.Lerp(f[1],f[2],x/a),L=a===x?f[2]:j.KJ.Lerp(A,K,i/(a-x));let o;if(L.normalize(),E){const i=j.KJ.Lerp(f[0],f[2],Y/a),x=j.KJ.Lerp(f[1],f[2],Y/a);o=j.KJ.Lerp(i,x,e/(a-Y))}else o=new j.KJ(L.x,L.y,L.z);o.x/=u,o.y/=b,o.z/=g,o.normalize();const M=j.Vector2.Lerp(w[0],w[2],x/a),z=j.Vector2.Lerp(w[1],w[2],x/a),O=a===x?w[2]:j.Vector2.Lerp(M,z,i/(a-x));Q.push(L.x*u,L.y*b,L.z*g),t.push(o.x,o.y,o.z),V.push(O.x,J.d?1-O.y:O.y),T.push(S),S++};for(let x=0;x<a;x++)for(let e=0;e+x<a;e++)i(e,x,e+1/3,x+1/3),i(e+1,x,e+1/3,x+1/3),i(e,x+1,e+1/3,x+1/3),e+x+1<a&&(i(e+1,x,e+2/3,x+2/3),i(e+1,x+1,e+2/3,x+2/3),i(e,x+1,e+2/3,x+2/3))}Y.e._ComputeSides(x,Q,T,t,V,i.frontUVs,i.backUVs);const l=new Y.e;return l.indices=T,l.li=Q,l.Zi=t,l.ki=V,l}function D(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new E.c(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),j._originalBuilderSideOrientation=x.sideOrientation;return U(x).mx(j,x.updatable),j}Y.e.CreatePolyhedron=p,E.c.CreatePolyhedron=(i,x,e)=>H(i,x,e);Y.e.CreateIcoSphere=U,E.c.CreateIcoSphere=(i,x,e)=>D(i,x,e);var h=e(12264);const F=new j.KJ(1,0,0),R=new j.KJ(-1,0,0),y=new j.KJ(0,1,0),r=new j.KJ(0,-1,0),c=new j.KJ(0,0,1),P=new j.KJ(0,0,-1);class q{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.KJ.Zero(),x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.KJ.Up(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.Vector2.Zero(),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=i,this.normal=x,this.uv=e,this.vertexIdx=E,this.vertexIdxForBones=a,this.localPositionOverride=Y,this.localNormalOverride=J,this.matrixIndicesOverride=u,this.matrixWeightsOverride=b}clone(){var i,x,e,j;return new q(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(i=this.localPositionOverride)||void 0===i?void 0:i.slice(),null===(x=this.localNormalOverride)||void 0===x?void 0:x.slice(),null===(e=this.matrixIndicesOverride)||void 0===e?void 0:e.slice(),null===(j=this.matrixWeightsOverride)||void 0===j?void 0:j.slice())}}function W(i,x,e){var u,b,g,A,K;const L=!!x.skeleton,o=!(null===(u=x.morphTargetManager)||void 0===u||!u.numTargets),M=e.localMode||L,z=x.Pe(),T=L||o?x.HJ(!0,!0):x.getVerticesData(a.f.PositionKind),Q=L||o?x.getNormalsData(!0,!0):x.getVerticesData(a.f.NormalKind),t=M?L?x.getVerticesData(a.f.PositionKind):T:null,V=M?L?x.getVerticesData(a.f.NormalKind):Q:null,S=x.getVerticesData(a.f.UVKind),f=L?x.getVerticesData(a.f.MatricesIndicesKind):null,w=L?x.getVerticesData(a.f.MatricesWeightsKind):null,O=L?x.getVerticesData(a.f.MatricesIndicesExtraKind):null,l=L?x.getVerticesData(a.f.MatricesWeightsExtraKind):null,Z=e.position||j.KJ.Zero();let B=e.normal||j.KJ.Up();const k=e.size||j.KJ.One(),N=e.angle||0;if(!B){const i=new j.KJ(0,0,1),e=x.wi().activeCamera,E=j.KJ.TransformCoordinates(i,e.getWorldMatrix());B=e.globalPosition.Cx(E)}const mi=-Math.atan2(B.z,B.x)-Math.PI/2,X=Math.sqrt(B.x*B.x+B.z*B.z),C=Math.atan2(B.y,X),n=new Y.e;n.indices=[],n.li=[],n.Zi=[],n.ki=[],n.matricesIndices=L?[]:null,n.matricesWeights=L?[]:null,n.matricesIndicesExtra=O?[]:null,n.matricesWeightsExtra=l?[]:null;let I=0;const d=(i,x)=>{const E=new q;if(!z||!T||!Q)return E;const a=z[i];if(E.vertexIdx=3*a,E.vertexIdxForBones=4*a,E.position=new j.KJ(T[3*a],T[3*a+1],T[3*a+2]),j.KJ.TransformCoordinatesToRef(E.position,x,E.position),E.normal=new j.KJ(Q[3*a],Q[3*a+1],Q[3*a+2]),j.KJ.TransformNormalToRef(E.normal,x,E.normal),e.captureUVS&&S){const i=S[2*a+1];E.uv=new j.Vector2(S[2*a],J.d?1-i:i)}return E},p=[0,0,0,0],H=(i,x)=>{if(0===i.length)return i;const e=.5*Math.abs(j.KJ.Dot(k,x)),E=(i,x,e,j)=>{for(let E=0;E<j;++E)if(i[e+E]===x)return e+E;return-1},a=(i,a)=>{const Y=j.KJ.GetClipFactor(i.position,a.position,x,e);let J=p,u=p;if(f&&w){const x=i.matrixIndicesOverride?0:i.vertexIdxForBones,e=i.matrixIndicesOverride??f,j=i.matrixWeightsOverride??w,b=a.matrixIndicesOverride?0:a.vertexIdxForBones,g=a.matrixIndicesOverride??f,A=a.matrixWeightsOverride??w;J=[0,0,0,0],u=[0,0,0,0];let K=0;for(let i=0;i<4;++i)if(j[x+i]>0){const a=E(g,e[x+i],b,4);J[K]=e[x+i],u[K]=(0,h.Lerp)(j[x+i],a>=0?A[a]:0,Y),K++}for(let i=0;i<4&&K<4;++i){const j=g[b+i];-1===E(e,j,x,4)&&(J[K]=j,u[K]=(0,h.Lerp)(0,A[b+i],Y),K++)}const L=u[0]+u[1]+u[2]+u[3];u[0]/=L,u[1]/=L,u[2]/=L,u[3]/=L}const b=i.localPositionOverride?i.localPositionOverride[0]:(null===t||void 0===t?void 0:t[i.vertexIdx])??0,g=i.localPositionOverride?i.localPositionOverride[1]:(null===t||void 0===t?void 0:t[i.vertexIdx+1])??0,A=i.localPositionOverride?i.localPositionOverride[2]:(null===t||void 0===t?void 0:t[i.vertexIdx+2])??0,K=a.localPositionOverride?a.localPositionOverride[0]:(null===t||void 0===t?void 0:t[a.vertexIdx])??0,L=a.localPositionOverride?a.localPositionOverride[1]:(null===t||void 0===t?void 0:t[a.vertexIdx+1])??0,o=a.localPositionOverride?a.localPositionOverride[2]:(null===t||void 0===t?void 0:t[a.vertexIdx+2])??0,M=i.localNormalOverride?i.localNormalOverride[0]:(null===V||void 0===V?void 0:V[i.vertexIdx])??0,z=i.localNormalOverride?i.localNormalOverride[1]:(null===V||void 0===V?void 0:V[i.vertexIdx+1])??0,T=i.localNormalOverride?i.localNormalOverride[2]:(null===V||void 0===V?void 0:V[i.vertexIdx+2])??0,Q=M+((a.localNormalOverride?a.localNormalOverride[0]:(null===V||void 0===V?void 0:V[a.vertexIdx])??0)-M)*Y,S=z+((a.localNormalOverride?a.localNormalOverride[1]:(null===V||void 0===V?void 0:V[a.vertexIdx+1])??0)-z)*Y,O=T+((a.localNormalOverride?a.localNormalOverride[2]:(null===V||void 0===V?void 0:V[a.vertexIdx+2])??0)-T)*Y,l=Math.sqrt(Q*Q+S*S+O*O);return new q(j.KJ.Lerp(i.position,a.position,Y),j.KJ.Lerp(i.normal,a.normal,Y).normalize(),j.Vector2.Lerp(i.uv,a.uv,Y),-1,-1,t?[b+(K-b)*Y,g+(L-g)*Y,A+(o-A)*Y]:null,V?[Q/l,S/l,O/l]:null,J,u)};let Y=null;i.length>3&&(Y=[]);for(let J=0;J<i.length;J+=3){let E=0,u=null,b=null,g=null,A=null;const K=j.KJ.Dot(i[J].position,x)-e>0,L=j.KJ.Dot(i[J+1].position,x)-e>0,o=j.KJ.Dot(i[J+2].position,x)-e>0;switch(E=(K?1:0)+(L?1:0)+(o?1:0),E){case 0:i.length>3?(Y.push(i[J]),Y.push(i[J+1]),Y.push(i[J+2])):Y=i;break;case 1:if(Y=Y??new Array,K&&(u=i[J+1],b=i[J+2],g=a(i[J],u),A=a(i[J],b)),L){u=i[J],b=i[J+2],g=a(i[J+1],u),A=a(i[J+1],b),Y.push(g),Y.push(b.clone()),Y.push(u.clone()),Y.push(b.clone()),Y.push(g.clone()),Y.push(A);break}o&&(u=i[J],b=i[J+1],g=a(i[J+2],u),A=a(i[J+2],b)),u&&b&&g&&A&&(Y.push(u.clone()),Y.push(b.clone()),Y.push(g),Y.push(A),Y.push(g.clone()),Y.push(b.clone()));break;case 2:Y=Y??new Array,K||(u=i[J].clone(),b=a(u,i[J+1]),g=a(u,i[J+2]),Y.push(u),Y.push(b),Y.push(g)),L||(u=i[J+1].clone(),b=a(u,i[J+2]),g=a(u,i[J]),Y.push(u),Y.push(b),Y.push(g)),o||(u=i[J+2].clone(),b=a(u,i[J]),g=a(u,i[J+1]),Y.push(u),Y.push(b),Y.push(g))}}return Y},U=x instanceof E.c?x:null,D=null===U||void 0===U?void 0:U._thinInstanceDataStorage.matrixData,W=(null===U||void 0===U?void 0:U.BJ)||1,G=j.TmpVectors.Matrix[0];G.A(j.Matrix.IdentityReadOnly);for(let E=0;E<W;++E){if(null!==U&&void 0!==U&&U.hasThinInstances&&D){const i=16*E;G.setRowFromFloats(0,D[i+0],D[i+1],D[i+2],D[i+3]),G.setRowFromFloats(1,D[i+4],D[i+5],D[i+6],D[i+7]),G.setRowFromFloats(2,D[i+8],D[i+9],D[i+10],D[i+11]),G.setRowFromFloats(3,D[i+12],D[i+13],D[i+14],D[i+15])}const i=j.Matrix.RotationYawPitchRoll(mi,C,N).multiply(j.Matrix.Translation(Z.x,Z.y,Z.z)),a=j.Matrix.Invert(i),Y=x.getWorldMatrix(),u=G.multiply(Y).multiply(a),b=new Array(3);for(let x=0;x<z.length;x+=3){let i=b;if(i[0]=d(x,u),i[1]=d(x+1,u),i[2]=d(x+2,u),!(e.cullBackFaces&&-i[0].normal.z<=0&&-i[1].normal.z<=0&&-i[2].normal.z<=0)&&(i=H(i,F),i&&(i=H(i,R),i&&(i=H(i,y),i&&(i=H(i,r),i&&(i=H(i,c),i&&(i=H(i,P),i)))))))for(let x=0;x<i.length;x++){const j=i[x];if(n.indices.push(I),M?(j.localPositionOverride?(n.li[3*I]=j.localPositionOverride[0],n.li[3*I+1]=j.localPositionOverride[1],n.li[3*I+2]=j.localPositionOverride[2]):t&&(n.li[3*I]=t[j.vertexIdx],n.li[3*I+1]=t[j.vertexIdx+1],n.li[3*I+2]=t[j.vertexIdx+2]),j.localNormalOverride?(n.Zi[3*I]=j.localNormalOverride[0],n.Zi[3*I+1]=j.localNormalOverride[1],n.Zi[3*I+2]=j.localNormalOverride[2]):V&&(n.Zi[3*I]=V[j.vertexIdx],n.Zi[3*I+1]=V[j.vertexIdx+1],n.Zi[3*I+2]=V[j.vertexIdx+2])):(j.position.toArray(n.li,3*I),j.normal.toArray(n.Zi,3*I)),n.matricesIndices&&n.matricesWeights&&(j.matrixIndicesOverride?(n.matricesIndices[4*I]=j.matrixIndicesOverride[0],n.matricesIndices[4*I+1]=j.matrixIndicesOverride[1],n.matricesIndices[4*I+2]=j.matrixIndicesOverride[2],n.matricesIndices[4*I+3]=j.matrixIndicesOverride[3]):(f&&(n.matricesIndices[4*I]=f[j.vertexIdxForBones],n.matricesIndices[4*I+1]=f[j.vertexIdxForBones+1],n.matricesIndices[4*I+2]=f[j.vertexIdxForBones+2],n.matricesIndices[4*I+3]=f[j.vertexIdxForBones+3]),O&&n.matricesIndicesExtra&&(n.matricesIndicesExtra[4*I]=O[j.vertexIdxForBones],n.matricesIndicesExtra[4*I+1]=O[j.vertexIdxForBones+1],n.matricesIndicesExtra[4*I+2]=O[j.vertexIdxForBones+2],n.matricesIndicesExtra[4*I+3]=O[j.vertexIdxForBones+3])),j.matrixWeightsOverride?(n.matricesWeights[4*I]=j.matrixWeightsOverride[0],n.matricesWeights[4*I+1]=j.matrixWeightsOverride[1],n.matricesWeights[4*I+2]=j.matrixWeightsOverride[2],n.matricesWeights[4*I+3]=j.matrixWeightsOverride[3]):(w&&(n.matricesWeights[4*I]=w[j.vertexIdxForBones],n.matricesWeights[4*I+1]=w[j.vertexIdxForBones+1],n.matricesWeights[4*I+2]=w[j.vertexIdxForBones+2],n.matricesWeights[4*I+3]=w[j.vertexIdxForBones+3]),l&&n.matricesWeightsExtra&&(n.matricesWeightsExtra[4*I]=l[j.vertexIdxForBones],n.matricesWeightsExtra[4*I+1]=l[j.vertexIdxForBones+1],n.matricesWeightsExtra[4*I+2]=l[j.vertexIdxForBones+2],n.matricesWeightsExtra[4*I+3]=l[j.vertexIdxForBones+3]))),e.captureUVS)j.uv.toArray(n.ki,2*I);else{n.ki.push(.5+j.position.x/k.x);const i=.5+j.position.y/k.y;n.ki.push(J.d?1-i:i)}I++}}}0===n.indices.length&&(n.indices=null),0===n.li.length&&(n.li=null),0===n.Zi.length&&(n.Zi=null),0===n.ki.length&&(n.ki=null),0===(null===(b=n.matricesIndices)||void 0===b?void 0:b.length)&&(n.matricesIndices=null),0===(null===(g=n.matricesWeights)||void 0===g?void 0:g.length)&&(n.matricesWeights=null),0===(null===(A=n.matricesIndicesExtra)||void 0===A?void 0:A.length)&&(n.matricesIndicesExtra=null),0===(null===(K=n.matricesWeightsExtra)||void 0===K?void 0:K.length)&&(n.matricesWeightsExtra=null);const v=new E.c(i,x.wi());return n.mx(v),M?(v.skeleton=x.skeleton,v.parent=x):(v.position=Z.clone(),v.rotation=new j.KJ(C,mi,N)),v.Re(!0),v.refreshBoundingInfo(!0,!0),v}function G(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const x=0|Math.max(i.subdivisions?i.subdivisions:2,1),e=0|Math.max(i.tessellation?i.tessellation:16,3),E=Math.max(i.height?i.height:1,0),a=Math.max(i.radius?i.radius:.25,0),u=0|Math.max(i.capSubdivisions?i.capSubdivisions:6,1),b=e,g=x,A=Math.max(i.radiusTop?i.radiusTop:a,0),K=Math.max(i.radiusBottom?i.radiusBottom:a,0),L=E-(A+K),o=2*Math.PI,M=Math.max(i.topCapSubdivisions?i.topCapSubdivisions:u,1),z=Math.max(i.bottomCapSubdivisions?i.bottomCapSubdivisions:u,1),T=Math.acos((K-A)/E);let Q=[];const t=[],V=[],S=[];let f=0;const w=[],O=.5*L,l=.5*Math.PI;let Z,B;const k=j.KJ.Zero(),N=j.KJ.Zero(),mi=Math.cos(T),X=Math.sin(T),C=new j.Vector2(A*X,O+A*mi).Cx(new j.Vector2(K*X,K*mi-O)).length(),n=A*T+C+K*(l-T);let I=0;for(B=0;B<=M;B++){const i=[],x=l-T*(B/M);I+=A*T/M;const e=Math.cos(x),j=Math.sin(x),E=e*A;for(Z=0;Z<=b;Z++){const x=Z/b,a=x*o+0,Y=Math.sin(a),u=Math.cos(a);N.x=E*Y,N.y=O+j*A,N.z=E*u,t.push(N.x,N.y,N.z),k.set(e*Y,j,e*u),V.push(k.x,k.y,k.z),S.push(x,J.d?I/n:1-I/n),i.push(f),f++}w.push(i)}const d=E-A-K+mi*A-mi*K,p=X*(K-A)/d;for(B=1;B<=g;B++){const i=[];I+=C/g;const x=X*(B*(K-A)/g+A);for(Z=0;Z<=b;Z++){const e=Z/b,j=e*o+0,E=Math.sin(j),a=Math.cos(j);N.x=x*E,N.y=O+mi*A-B*d/g,N.z=x*a,t.push(N.x,N.y,N.z),k.set(E,p,a).normalize(),V.push(k.x,k.y,k.z),S.push(e,J.d?I/n:1-I/n),i.push(f),f++}w.push(i)}for(B=1;B<=z;B++){const i=[],x=l-T-(Math.PI-T)*(B/z);I+=K*T/z;const e=Math.cos(x),j=Math.sin(x),E=e*K;for(Z=0;Z<=b;Z++){const x=Z/b,a=x*o+0,Y=Math.sin(a),u=Math.cos(a);N.x=E*Y,N.y=j*K-O,N.z=E*u,t.push(N.x,N.y,N.z),k.set(e*Y,j,e*u),V.push(k.x,k.y,k.z),S.push(x,J.d?I/n:1-I/n),i.push(f),f++}w.push(i)}for(Z=0;Z<b;Z++)for(B=0;B<M+g+z;B++){const i=w[B][Z],x=w[B+1][Z],e=w[B+1][Z+1],j=w[B][Z+1];Q.push(i),Q.push(x),Q.push(j),Q.push(x),Q.push(e),Q.push(j)}if(Q=Q.reverse(),i.orientation&&!i.orientation.equals(j.KJ.Up())){const x=new j.Matrix;i.orientation.clone().scale(.5*Math.PI).cross(j.KJ.Up()).toQuaternion().toRotationMatrix(x);const e=j.KJ.Zero();for(let i=0;i<t.length;i+=3)e.set(t[i],t[i+1],t[i+2]),j.KJ.TransformCoordinatesToRef(e.clone(),x,e),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z}const H=new Y.e;return H.li=t,H.Zi=V,H.ki=S,H.indices=Q,H}function v(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:j.KJ.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=new E.c(i,e);return G(x).mx(a,x.updatable),a}E.c.CreateDecal=(i,x,e,j,E,a)=>W(i,x,{position:e,normal:j,size:E,angle:a});E.c.CreateCapsule=(i,x,e)=>v(i,x,e),Y.e.CreateCapsule=G;var s=e(12072),ii=e(12253);class xi{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=i,this.y=x,i!==Math.floor(i)&&(i=Math.floor(i),s.c.Warn("x is not an integer, floor(x) used")),x!==Math.floor(x)&&(x=Math.floor(x),s.c.Warn("y is not an integer, floor(y) used"))}clone(){return new xi(this.x,this.y)}rotate60About(i){const x=this.x;return this.x=i.x+i.y-this.y,this.y=x+this.y-i.x,this}rotateNeg60About(i){const x=this.x;return this.x=x+this.y-i.y,this.y=i.x+i.y-x,this}rotate120(i,x){i!==Math.floor(i)&&(i=Math.floor(i),s.c.Warn("m not an integer only floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),s.c.Warn("n not an integer only floor(n) used"));const e=this.x;return this.x=i-e-this.y,this.y=x+e,this}rotateNeg120(i,x){i!==Math.floor(i)&&(i=Math.floor(i),s.c.Warn("m is not an integer, floor(m) used")),x!==Math.floor(x)&&(x=Math.floor(x),s.c.Warn("n is not an integer,   floor(n) used"));const e=this.x;return this.x=this.y-x,this.y=i+x-e-this.y,this}toCartesianOrigin(i,x){const e=j.KJ.Zero();return e.x=i.x+2*this.x*x+this.y*x,e.y=i.y+Math.sqrt(3)*this.y*x,e}static Zero(){return new xi(0,0)}}class ei{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ji("icosahedron","Regular",[[0,ii.h,-1],[-ii.h,1,0],[-1,0,-ii.h],[1,0,-ii.h],[ii.h,1,0],[0,ii.h,1],[-1,0,ii.h],[-ii.h,-1,0],[0,-ii.h,-1],[ii.h,-1,0],[1,0,ii.h],[0,-ii.h,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let i=12;const x={},e=this.m,j=this.n;let E,a,Y,J,u,b=e,g=1,A=0;0!==j&&(b=(0,h.HighestCommonFactor)(e,j)),g=e/b,A=j/b;const K=xi.Zero(),L=new xi(e,j),o=new xi(-j,e+j),M=xi.Zero(),z=xi.Zero(),T=xi.Zero();let Q,t,V,S,f=[];const w=[],O=this.vertByDist,l=(e,j,E,a)=>{Q=e+"|"+E,t=j+"|"+a,Q in x||t in x?Q in x&&!(t in x)?x[t]=x[Q]:t in x&&!(Q in x)&&(x[Q]=x[t]):(x[Q]=i,x[t]=i,i++),O[E][0]>2?w[x[Q]]=[-O[E][0],O[E][1],x[Q]]:w[x[Q]]=[f[O[E][0]],O[E][1],x[Q]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let Z=0;Z<20;Z++){if(f=this.IDATA.face[Z],Y=f[2],J=f[1],u=f[0],V=K.x+"|"+K.y,Q=Z+"|"+V,Q in x||(x[Q]=Y,w[Y]=[f[O[V][0]],O[V][1]]),V=L.x+"|"+L.y,Q=Z+"|"+V,Q in x||(x[Q]=J,w[J]=[f[O[V][0]],O[V][1]]),V=o.x+"|"+o.y,Q=Z+"|"+V,Q in x||(x[Q]=u,w[u]=[f[O[V][0]],O[V][1]]),E=this.IDATA.edgematch[Z][0],a=this.IDATA.edgematch[Z][1],"B"===a)for(let i=1;i<b;i++)z.x=e-i*(g+A),z.y=j+i*g,T.x=-i*A,T.y=i*(g+A),V=z.x+"|"+z.y,S=T.x+"|"+T.y,l(Z,E,V,S);if("O"===a)for(let i=1;i<b;i++)T.x=-i*A,T.y=i*(g+A),M.x=i*g,M.y=i*A,V=T.x+"|"+T.y,S=M.x+"|"+M.y,l(Z,E,V,S);if(E=this.IDATA.edgematch[Z][2],a=this.IDATA.edgematch[Z][3],a&&"A"===a)for(let i=1;i<b;i++)M.x=i*g,M.y=i*A,z.x=e-(b-i)*(g+A),z.y=j+(b-i)*g,V=M.x+"|"+M.y,S=z.x+"|"+z.y,l(Z,E,V,S);for(let e=0;e<this.vertices.length;e++)V=this.vertices[e].x+"|"+this.vertices[e].y,Q=Z+"|"+V,Q in x||(x[Q]=i++,O[V][0]>2?w[x[Q]]=[-O[V][0],O[V][1],x[Q]]:w[x[Q]]=[f[O[V][0]],O[V][1],x[Q]])}this.closestTo=w,this.vecToidx=x}calcCoeffs(){const i=this.m,x=this.n,e=Math.sqrt(3)/3,j=i*i+x*x+i*x;this.coau=(i+x)/j,this.cobu=-x/j,this.coav=-e*(i-x)/j,this.cobv=e*(2*i+x)/j}createInnerFacets(){const i=this.m,x=this.n;for(let e=0;e<x+i+1;e++)for(let i=this.min[e];i<this.max[e]+1;i++)i<this.max[e]&&i<this.max[e+1]+1&&this.innerFacets.push(["|"+i+"|"+e,"|"+i+"|"+(e+1),"|"+(i+1)+"|"+e]),e>0&&i<this.max[e-1]&&i+1<this.max[e]+1&&this.innerFacets.push(["|"+i+"|"+e,"|"+(i+1)+"|"+e,"|"+(i+1)+"|"+(e-1)])}edgeVecsABOB(){const i=this.m,x=this.n,e=new xi(-x,i+x);for(let j=1;j<i+x;j++){const i=new xi(this.min[j],j),x=new xi(this.min[j-1],j-1),E=new xi(this.min[j+1],j+1),a=i.clone(),Y=x.clone(),J=E.clone();a.rotate60About(e),Y.rotate60About(e),J.rotate60About(e);const u=new xi(this.max[a.y],a.y),b=new xi(this.max[a.y-1],a.y-1),g=new xi(this.max[a.y-1]-1,a.y-1);a.x===u.x&&a.y===u.y||(a.x!==b.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([i,b,g]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([i,g,u])):a.y===J.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([i,x,b]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([i,b,E])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([i,x,b]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([i,b,u])))}}mapABOBtoOBOA(){const i=new xi(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const e=[];for(let j=0;j<3;j++)i.x=this.isoVecsABOB[x][j].x,i.y=this.isoVecsABOB[x][j].y,0===this.vertexTypes[x][j]&&i.rotateNeg120(this.m,this.n),e.push(i.clone());this.isoVecsOBOA.push(e)}}mapABOBtoBAOA(){const i=new xi(0,0);for(let x=0;x<this.isoVecsABOB.length;x++){const e=[];for(let j=0;j<3;j++)i.x=this.isoVecsABOB[x][j].x,i.y=this.isoVecsABOB[x][j].y,1===this.vertexTypes[x][j]&&i.rotate120(this.m,this.n),e.push(i.clone());this.isoVecsBAOA.push(e)}}MapToFace(i,x){const e=this.IDATA.face[i],E=e[2],a=e[1],Y=e[0],J=j.KJ.zJ(this.IDATA.vertex[E]),u=j.KJ.zJ(this.IDATA.vertex[a]),b=j.KJ.zJ(this.IDATA.vertex[Y]),g=u.Cx(J),A=b.Cx(J),K=g.scale(this.coau).add(A.scale(this.cobu)),L=g.scale(this.coav).add(A.scale(this.cobv)),o=[];let M,z=j.TmpVectors.KJ[0];for(let j=0;j<this.cartesian.length;j++)z=K.scale(this.cartesian[j].x).add(L.scale(this.cartesian[j].y)).add(J),o[j]=[z.x,z.y,z.z],M=i+"|"+this.vertices[j].x+"|"+this.vertices[j].y,x.vertex[this.vecToidx[M]]=[z.x,z.y,z.z]}build(i,x){const e=[],j=xi.Zero(),E=new xi(i,x),a=new xi(-x,i+x);e.push(j,E,a);for(let V=x;V<i+1;V++)for(let x=0;x<i+1-V;x++)e.push(new xi(x,V));if(x>0){const j=(0,h.HighestCommonFactor)(i,x),E=i/j,a=x/j;for(let J=1;J<j;J++)e.push(new xi(J*E,J*a)),e.push(new xi(-J*a,J*(E+a))),e.push(new xi(i-J*(E+a),x+J*E));const Y=i/x;for(let J=1;J<x;J++)for(let j=0;j<J*Y;j++)e.push(new xi(j,J)),e.push(new xi(j,J).rotate120(i,x)),e.push(new xi(j,J).rotateNeg120(i,x))}e.sort(((i,x)=>i.x-x.x)),e.sort(((i,x)=>i.y-x.y));const Y=new Array(i+x+1),J=new Array(i+x+1);for(let V=0;V<Y.length;V++)Y[V]=1/0,J[V]=-1/0;let u=0,b=0;const g=e.length;for(let V=0;V<g;V++)b=e[V].x,u=e[V].y,Y[u]=Math.min(b,Y[u]),J[u]=Math.max(b,J[u]);const A=(e,j)=>{const E=e.clone();return"A"===j&&E.rotateNeg120(i,x),"B"===j&&E.rotate120(i,x),E.x<0?E.y:E.x+E.y},K=[],L=[],o=[],M=[],z={},T=[];let Q=-1,t=-1;for(let V=0;V<g;V++)K[V]=e[V].toCartesianOrigin(new xi(0,0),.5),L[V]=A(e[V],"O"),o[V]=A(e[V],"A"),M[V]=A(e[V],"B"),L[V]===o[V]&&o[V]===M[V]?(Q=3,t=L[V]):L[V]===o[V]?(Q=4,t=L[V]):o[V]===M[V]?(Q=5,t=o[V]):M[V]===L[V]&&(Q=6,t=L[V]),L[V]<o[V]&&L[V]<M[V]&&(Q=2,t=L[V]),o[V]<L[V]&&o[V]<M[V]&&(Q=1,t=o[V]),M[V]<o[V]&&M[V]<L[V]&&(Q=0,t=M[V]),T.push([Q,t,e[V].x,e[V].y]);T.sort(((i,x)=>i[2]-x[2])),T.sort(((i,x)=>i[3]-x[3])),T.sort(((i,x)=>i[1]-x[1])),T.sort(((i,x)=>i[0]-x[0]));for(let V=0;V<T.length;V++)z[T[V][2]+"|"+T[V][3]]=[T[V][0],T[V][1],V];return this.m=i,this.n=x,this.vertices=e,this.vertByDist=z,this.cartesian=K,this.min=Y,this.max=J,this}}class ji{constructor(i,x,e,j){this.name=i,this.category=x,this.vertex=e,this.face=j}}class Ei extends ji{innerToData(i,x){for(let e=0;e<x.innerFacets.length;e++)this.face.push(x.innerFacets[e].map((e=>x.vecToidx[i+e])))}mapABOBtoDATA(i,x){const e=x.IDATA.edgematch[i][0];for(let j=0;j<x.isoVecsABOB.length;j++){const E=[];for(let a=0;a<3;a++)0===x.vertexTypes[j][a]?E.push(i+"|"+x.isoVecsABOB[j][a].x+"|"+x.isoVecsABOB[j][a].y):E.push(e+"|"+x.isoVecsABOB[j][a].x+"|"+x.isoVecsABOB[j][a].y);this.face.push([x.vecToidx[E[0]],x.vecToidx[E[1]],x.vecToidx[E[2]]])}}mapOBOAtoDATA(i,x){const e=x.IDATA.edgematch[i][0];for(let j=0;j<x.isoVecsOBOA.length;j++){const E=[];for(let a=0;a<3;a++)1===x.vertexTypes[j][a]?E.push(i+"|"+x.isoVecsOBOA[j][a].x+"|"+x.isoVecsOBOA[j][a].y):E.push(e+"|"+x.isoVecsOBOA[j][a].x+"|"+x.isoVecsOBOA[j][a].y);this.face.push([x.vecToidx[E[0]],x.vecToidx[E[1]],x.vecToidx[E[2]]])}}mapBAOAtoDATA(i,x){const e=x.IDATA.edgematch[i][2];for(let j=0;j<x.isoVecsBAOA.length;j++){const E=[];for(let a=0;a<3;a++)1===x.vertexTypes[j][a]?E.push(i+"|"+x.isoVecsBAOA[j][a].x+"|"+x.isoVecsBAOA[j][a].y):E.push(e+"|"+x.isoVecsBAOA[j][a].x+"|"+x.isoVecsBAOA[j][a].y);this.face.push([x.vecToidx[E[0]],x.vecToidx[E[1]],x.vecToidx[E[2]]])}}orderData(i){const x=[];for(let a=0;a<13;a++)x[a]=[];const e=i.closestTo;for(let a=0;a<e.length;a++)e[a][0]>-1?e[a][1]>0&&x[e[a][0]].push([a,e[a][1]]):x[12].push([a,e[a][0]]);const j=[];for(let a=0;a<12;a++)j[a]=a;let E=12;for(let a=0;a<12;a++){x[a].sort(((i,x)=>i[1]-x[1]));for(let i=0;i<x[a].length;i++)j[x[a][i][0]]=E++}for(let a=0;a<x[12].length;a++)j[x[12][a][0]]=E++;for(let a=0;a<this.vertex.length;a++)this.vertex[a].push(j[a]);this.vertex.sort(((i,x)=>i[3]-x[3]));for(let a=0;a<this.vertex.length;a++)this.vertex[a].pop();for(let a=0;a<this.face.length;a++)for(let i=0;i<this.face[a].length;i++)this.face[a][i]=j[this.face[a][i]];this.sharedNodes=x[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(i,x){const e=[],j=[];let E=x.pop();j.push(E);let a=this.face[E].indexOf(i);a=(a+2)%3;let Y=this.face[E][a];e.push(Y);let J=0;for(;x.length>0;)E=x[J],this.face[E].indexOf(Y)>-1?(a=(this.face[E].indexOf(Y)+1)%3,Y=this.face[E][a],e.push(Y),j.push(E),x.splice(J,1),J=0):J++;return this.adjacentFaces.push(e),j}toGoldbergPolyhedronData(){const i=new ji("GeoDual","Goldberg",[],[]);i.name="GD dual";const x=this.vertex.length,e=new Array(x);for(let u=0;u<x;u++)e[u]=[];for(let u=0;u<this.face.length;u++)for(let i=0;i<3;i++)e[this.face[u][i]].push(u);let j=0,E=0,a=0,Y=[],J=[];this.adjacentFaces=[];for(let u=0;u<e.length;u++){i.face[u]=this.setOrder(u,e[u].concat([]));for(const x of e[u]){j=0,E=0,a=0,Y=this.face[x];for(let i=0;i<3;i++)J=this.vertex[Y[i]],j+=J[0],E+=J[1],a+=J[2];i.vertex[x]=[j/3,E/3,a/3]}}return i}static BuildGeodesicData(i){const x=new Ei("Geodesic-m-n","Geodesic",[[0,ii.h,-1],[-ii.h,1,0],[-1,0,-ii.h],[1,0,-ii.h],[ii.h,1,0],[0,ii.h,1],[-1,0,ii.h],[-ii.h,-1,0],[0,-ii.h,-1],[ii.h,-1,0],[1,0,ii.h],[0,-ii.h,1]],[]);i.setIndices(),i.calcCoeffs(),i.createInnerFacets(),i.edgeVecsABOB(),i.mapABOBtoOBOA(),i.mapABOBtoBAOA();for(let e=0;e<i.IDATA.face.length;e++)i.MapToFace(e,x),x.innerToData(e,i),"B"===i.IDATA.edgematch[e][1]&&x.mapABOBtoDATA(e,i),"O"===i.IDATA.edgematch[e][1]&&x.mapOBOAtoDATA(e,i),"A"===i.IDATA.edgematch[e][3]&&x.mapBAOAtoDATA(e,i);x.orderData(i);return x.vertex=x.vertex.map((function(i){const x=i[0],e=i[1],j=i[2],E=Math.sqrt(x*x+e*e+j*j);return i[0]*=1/E,i[1]*=1/E,i[2]*=1/E,i})),x}}E.c._GoldbergMeshParser=(i,x)=>ai.Parse(i,x);class ai extends E.c{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(i,x){return void 0===x?(i>this.goldbergData.nbUnsharedFaces-1&&(s.c.Warn("Maximum number of unshared faces used"),i=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+i):(i>11&&(s.c.Warn("Last pole used"),i=11),x>this.goldbergData.nbFacesAtPole-1&&(s.c.Warn("Maximum number of faces at a pole used"),x=this.goldbergData.nbFacesAtPole-1),12+i*this.goldbergData.nbFacesAtPole+x)}_changeGoldbergFaceColors(i){for(let e=0;e<i.length;e++){const x=i[e][0],j=i[e][1],E=i[e][2];for(let i=x;i<j+1;i++)this.goldbergData.faceColors[i]=E}const x=[];for(let e=0;e<12;e++)for(let i=0;i<5;i++)x.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let i=0;i<6;i++)x.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return x}setGoldbergFaceColors(i){const x=this._changeGoldbergFaceColors(i);this.Ii(a.f.ColorKind,x)}updateGoldbergFaceColors(i){const x=this._changeGoldbergFaceColors(i);this.updateVerticesData(a.f.ColorKind,x)}_changeGoldbergFaceUVs(i){const x=this.getVerticesData(a.f.UVKind);for(let e=0;e<i.length;e++){const j=i[e][0],E=i[e][1],a=i[e][2],Y=i[e][3],J=i[e][4],u=[],b=[];let g,A;for(let i=0;i<5;i++)g=a.x+Y*Math.cos(J+i*Math.PI/2.5),A=a.y+Y*Math.sin(J+i*Math.PI/2.5),g<0&&(g=0),g>1&&(g=1),u.push(g,A);for(let i=0;i<6;i++)g=a.x+Y*Math.cos(J+i*Math.PI/3),A=a.y+Y*Math.sin(J+i*Math.PI/3),g<0&&(g=0),g>1&&(g=1),b.push(g,A);for(let i=j;i<Math.min(12,E+1);i++)for(let e=0;e<5;e++)x[10*i+2*e]=u[2*e],x[10*i+2*e+1]=u[2*e+1];for(let i=Math.max(12,j);i<E+1;i++)for(let e=0;e<6;e++)x[12*i-24+2*e]=b[2*e],x[12*i-23+2*e]=b[2*e+1]}return x}setGoldbergFaceUVs(i){const x=this._changeGoldbergFaceUVs(i);this.Ii(a.f.UVKind,x)}updateGoldbergFaceUVs(i){const x=this._changeGoldbergFaceUVs(i);this.updateVerticesData(a.f.UVKind,x)}placeOnGoldbergFaceAt(i,x,e){const E=j.KJ.RotationFromAxis(this.goldbergData.faceXaxis[x],this.goldbergData.faceYaxis[x],this.goldbergData.faceZaxis[x]);i.rotation=E,i.position=this.goldbergData.faceCenters[x].add(this.goldbergData.faceXaxis[x].scale(e.x)).add(this.goldbergData.faceYaxis[x].scale(e.y)).add(this.goldbergData.faceZaxis[x].scale(e.z))}serialize(i){super.serialize(i),i.type="GoldbergMesh";const x={};if(x.adjacentFaces=this.goldbergData.adjacentFaces,x.nbSharedFaces=this.goldbergData.nbSharedFaces,x.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,x.nbFaces=this.goldbergData.nbFaces,x.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){x.faceColors=[];for(const i of this.goldbergData.faceColors)x.faceColors.push(i.de())}if(this.goldbergData.faceCenters){x.faceCenters=[];for(const i of this.goldbergData.faceCenters)x.faceCenters.push(i.de())}if(this.goldbergData.faceZaxis){x.faceZaxis=[];for(const i of this.goldbergData.faceZaxis)x.faceZaxis.push(i.de())}if(this.goldbergData.faceYaxis){x.faceYaxis=[];for(const i of this.goldbergData.faceYaxis)x.faceYaxis.push(i.de())}if(this.goldbergData.faceXaxis){x.faceXaxis=[];for(const i of this.goldbergData.faceXaxis)x.faceXaxis.push(i.de())}i.goldbergData=x}static Parse(i,x){const e=i.goldbergData;e.faceColors=e.faceColors.map((i=>K.lJ.zJ(i))),e.faceCenters=e.faceCenters.map((i=>j.KJ.zJ(i))),e.faceZaxis=e.faceZaxis.map((i=>j.KJ.zJ(i))),e.faceXaxis=e.faceXaxis.map((i=>j.KJ.zJ(i))),e.faceYaxis=e.faceYaxis.map((i=>j.KJ.zJ(i)));const E=new ai(i.name,x);return E.goldbergData=e,E}}var Yi=e(12780);const Ji={CreateBox:A.b,CreateTiledBox:z,CreateSphere:T.c,CreateDisc:g.d,CreateIcoSphere:D,CreateRibbon:b,CreateCylinder:S,CreateTorus:w,CreateTorusKnot:l,CreateLineSystem:Z.e,Ag:Z.i,CreateDashedLines:Z.c,ExtrudeShape:N,ExtrudeShapeCustom:mi,CreateLathe:C,CreateTiledPlane:o,zg:n.b,CreateGround:I.i,CreateTiledGround:I.k,CreateGroundFromHeightMap:I.e,CreatePolygon:B.d,ExtrudePolygon:B.e,CreateTube:d,CreatePolyhedron:H,CreateGeodesic:function(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=x.m||1;j!==Math.floor(j)&&(j=Math.floor(j),s.c.Warn("m not an integer only floor(m) used"));let E=x.n||0;if(E!==Math.floor(E)&&(E=Math.floor(E),s.c.Warn("n not an integer only floor(n) used")),E>j){const i=E;E=j,j=i,s.c.Warn("n > m therefore m and n swapped")}const a=new ei;return a.build(j,E),H(i,{custom:Ei.BuildGeodesicData(a),size:x.size,sizeX:x.sizeX,sizeY:x.sizeY,sizeZ:x.sizeZ,faceUV:x.faceUV,faceColors:x.faceColors,flat:x.flat,updatable:x.updatable,sideOrientation:x.sideOrientation,frontUVs:x.frontUVs,backUVs:x.backUVs},e)},CreateGoldberg:function(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=x.size,u=x.sizeX||a||1,b=x.sizeY||a||1,g=x.sizeZ||a||1;let A=x.m||1;A!==Math.floor(A)&&(A=Math.floor(A),s.c.Warn("m not an integer only floor(m) used"));let L=x.n||0;if(L!==Math.floor(L)&&(L=Math.floor(L),s.c.Warn("n not an integer only floor(n) used")),L>A){const i=L;L=A,A=i,s.c.Warn("n > m therefore m and n swapped")}const o=new ei;o.build(A,L);const M=Ei.BuildGeodesicData(o),z=M.toGoldbergPolyhedronData(),T=new ai(i,e);x.sideOrientation=E.c._GetDefaultSideOrientation(x.sideOrientation),T._originalBuilderSideOrientation=x.sideOrientation;(function(i,x){const e=i.size,E=i.sizeX||e||1,a=i.sizeY||e||1,u=i.sizeZ||e||1,b=0===i.sideOrientation?0:i.sideOrientation||Y.e.DEFAULTSIDE,g=[],A=[],K=[],L=[];let o=1/0,M=-1/0,z=1/0,T=-1/0;for(let j=0;j<x.vertex.length;j++)o=Math.min(o,x.vertex[j][0]*E),M=Math.max(M,x.vertex[j][0]*E),z=Math.min(z,x.vertex[j][1]*a),T=Math.max(T,x.vertex[j][1]*a);let Q=0;for(let Y=0;Y<x.face.length;Y++){const i=x.face[Y],e=j.KJ.zJ(x.vertex[i[0]]),b=j.KJ.zJ(x.vertex[i[2]]),t=j.KJ.zJ(x.vertex[i[1]]),V=b.Cx(e),S=t.Cx(e),f=j.KJ.Cross(S,V).normalize();for(let j=0;j<i.length;j++){K.push(f.x,f.y,f.z);const e=x.vertex[i[j]];g.push(e[0]*E,e[1]*a,e[2]*u);const Y=(e[1]*a-z)/(T-z);L.push((e[0]*E-o)/(M-o),J.d?1-Y:Y)}for(let x=0;x<i.length-2;x++)A.push(Q,Q+x+2,Q+x+1);Q+=i.length}Y.e._ComputeSides(b,g,A,K,L);const t=new Y.e;return t.li=g,t.indices=A,t.Zi=K,t.ki=L,t})(x,z).mx(T,x.updatable),T.goldbergData.nbSharedFaces=M.sharedNodes,T.goldbergData.nbUnsharedFaces=M.poleNodes,T.goldbergData.adjacentFaces=M.adjacentFaces,T.goldbergData.nbFaces=T.goldbergData.nbSharedFaces+T.goldbergData.nbUnsharedFaces,T.goldbergData.nbFacesAtPole=(T.goldbergData.nbUnsharedFaces-12)/12;for(let E=0;E<M.vertex.length;E++)T.goldbergData.faceCenters.push(j.KJ.zJ(M.vertex[E])),T.goldbergData.faceCenters[E].x*=u,T.goldbergData.faceCenters[E].y*=b,T.goldbergData.faceCenters[E].z*=g,T.goldbergData.faceColors.push(new K.lJ(1,1,1,1));for(let E=0;E<z.face.length;E++){const i=z.face[E],x=j.KJ.zJ(z.vertex[i[0]]),e=j.KJ.zJ(z.vertex[i[2]]),a=j.KJ.zJ(z.vertex[i[1]]),Y=e.Cx(x),J=a.Cx(x),u=j.KJ.Cross(J,Y).normalize(),b=j.KJ.Cross(J,u).normalize();T.goldbergData.faceXaxis.push(J.normalize()),T.goldbergData.faceYaxis.push(u),T.goldbergData.faceZaxis.push(b)}return T},CreateDecal:W,CreateCapsule:v,CreateText:Yi.f}},13514:(i,x,e)=>{"use strict";e.d(x,{b:()=>Jx});var j=e(12250),E=e(12591);class a extends E.e{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var Y=e(12286),J=(e(12393),e(12204));class u{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(i){this._targetStopDuration!==i&&(this._targetStopDuration=i)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(i){this._noiseTexture!==i&&(this._noiseTexture=i,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(i){this._animationSheetEnabled!==i&&(this._animationSheetEnabled=i)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(i){this._isAnimationSheetEnabled!=i&&(this._isAnimationSheetEnabled=i,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(i){this._useLogarithmicDepth=i&&this.wi().getEngine().getCaps().fragmentDepthSupported}wi(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(i){switch(i){case u.BLENDMODE_MULTIPLYADD:return;case u.BLENDMODE_ADD:i=1;break;case u.BLENDMODE_ONEONE:i=6;break;case u.BLENDMODE_STANDARD:i=2;break;case u.BLENDMODE_MULTIPLY:i=4;break;case u.BLENDMODE_SUBTRACT:i=3}this._engine.setAlphaMode(i)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:j.KJ.Zero()}set direction1(i){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=i)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:j.KJ.Zero()}set direction2(i){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=i)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:j.KJ.Zero()}set minEmitBox(i){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=i)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:j.KJ.Zero()}set maxEmitBox(i){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=i)}get billboardMode(){return this._billboardMode}set billboardMode(i){this._billboardMode!==i&&(this._billboardMode=i,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(i){this._isBillboardBased!==i&&(this._isBillboardBased=i,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(i){this._attachImageProcessingConfiguration(i)}_attachImageProcessingConfiguration(i){i!==this._imageProcessingConfiguration&&(!i&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=i)}_reset(){}_removeGradientAndTexture(i,x,e){if(!x)return this;let j=0;for(const E of x){if(E.gradient===i){x.splice(j,1);break}j++}return e&&e.dispose(),this}constructor(i){this.animations=[],this.renderingGroupId=0,this.Yx=j.KJ.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new j.KJ(10,10,10),this.onAnimationEnd=null,this.blendMode=u.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new j.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Jg=new j.KJ(0,0,0),this._useLogarithmicDepth=!1,this.gravity=j.KJ.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new Y.lJ(1,1,1,1),this.color2=new Y.lJ(1,1,1,1),this.colorDead=new Y.lJ(0,0,0,1),this.textureMask=new Y.lJ(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new a,this.id=i,this.name=i}createPointEmitter(i,x){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new j.KJ(0,1,0),arguments.length>2&&void 0!==arguments[2]||new j.KJ(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new j.KJ(0,1,0),arguments.length>4&&void 0!==arguments[4]||new j.KJ(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new j.KJ(0,1,0),arguments.length>3&&void 0!==arguments[3]||new j.KJ(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(i,x,e,j){throw new Error("Method not implemented.")}}u.BLENDMODE_ONEONE=0,u.BLENDMODE_STANDARD=1,u.BLENDMODE_ADD=2,u.BLENDMODE_MULTIPLY=3,u.BLENDMODE_MULTIPLYADD=4,u.BLENDMODE_SUBTRACT=-1,(0,J.f)("BABYLON.BaseParticleSystem",u);var b=e(12264),g=e(12080);class A{constructor(){this.direction1=new j.KJ(0,1,0),this.direction2=new j.KJ(0,1,0),this.minEmitBox=new j.KJ(-.5,-.5,-.5),this.maxEmitBox=new j.KJ(.5,.5,.5)}startDirectionFunction(i,x,e,E){const a=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),J=(0,b.RandomRange)(this.direction1.z,this.direction2.z);if(E)return x.x=a,x.y=Y,void(x.z=J);j.KJ.TransformNormalFromFloatsToRef(a,Y,J,i,x)}startPositionFunction(i,x,e,E){const a=(0,b.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),Y=(0,b.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),J=(0,b.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(E)return x.x=a,x.y=Y,void(x.z=J);j.KJ.TransformCoordinatesFromFloatsToRef(a,Y,J,i,x)}clone(){const i=new A;return g.d.DeepCopy(this,i),i}applyToShader(i){i.setVector3("direction1",this.direction1),i.setVector3("direction2",this.direction2),i.setVector3("minEmitBox",this.minEmitBox),i.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(i){i.addUniform("direction1",3),i.addUniform("direction2",3),i.addUniform("minEmitBox",3),i.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const i={};return i.type=this.getClassName(),i.direction1=this.direction1.de(),i.direction2=this.direction2.de(),i.minEmitBox=this.minEmitBox.de(),i.maxEmitBox=this.maxEmitBox.de(),i}parse(i){j.KJ.FromArrayToRef(i.direction1,0,this.direction1),j.KJ.FromArrayToRef(i.direction2,0,this.direction2),j.KJ.FromArrayToRef(i.minEmitBox,0,this.minEmitBox),j.KJ.FromArrayToRef(i.maxEmitBox,0,this.maxEmitBox)}}class K{get radius(){return this._radius}set radius(i){this._radius=i,this._buildHeight()}get angle(){return this._angle}set angle(i){this._angle=i,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=e,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=x,this.radius=i}startDirectionFunction(i,x,e,E){E?j.TmpVectors.KJ[0].A(e.qJ).normalize():e.position.subtractToRef(i.getTranslation(),j.TmpVectors.KJ[0]).normalize();const a=(0,b.RandomRange)(0,this.directionRandomizer),Y=(0,b.RandomRange)(0,this.directionRandomizer),J=(0,b.RandomRange)(0,this.directionRandomizer);x.x=j.TmpVectors.KJ[0].x+a,x.y=j.TmpVectors.KJ[0].y+Y,x.z=j.TmpVectors.KJ[0].z+J,x.normalize()}startPositionFunction(i,x,e,E){const a=(0,b.RandomRange)(0,2*Math.PI);let Y;this.emitFromSpawnPointOnly?Y=1e-4:(Y=(0,b.RandomRange)(0,this.heightRange),Y=1-Y*Y);let J=this._radius-(0,b.RandomRange)(0,this._radius*this.radiusRange);J*=Y;const u=J*Math.sin(a),g=J*Math.cos(a),A=Y*this._height;if(E)return x.x=u,x.y=A,void(x.z=g);j.KJ.TransformCoordinatesFromFloatsToRef(u,A,g,i,x)}clone(){const i=new K(this._radius,this._angle,this.directionRandomizer);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setFloat2("radius",this._radius,this.radiusRange),i.setFloat("coneAngle",this._angle),i.setFloat2("height",this._height,this.heightRange),i.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(i){i.addUniform("radius",2),i.addUniform("coneAngle",1),i.addUniform("height",2),i.addUniform("directionRandomizer",1)}getEffectDefines(){let i="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(i+="\n#define CONEEMITTERSPAWNPOINT"),i}getClassName(){return"ConeParticleEmitter"}serialize(){const i={};return i.type=this.getClassName(),i.radius=this._radius,i.angle=this._angle,i.directionRandomizer=this.directionRandomizer,i.radiusRange=this.radiusRange,i.heightRange=this.heightRange,i.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,i}parse(i){this.radius=i.radius,this.angle=i.angle,this.directionRandomizer=i.directionRandomizer,this.radiusRange=void 0!==i.radiusRange?i.radiusRange:1,this.heightRange=void 0!==i.radiusRange?i.heightRange:1,this.emitFromSpawnPointOnly=void 0!==i.emitFromSpawnPointOnly&&i.emitFromSpawnPointOnly}}class L extends K{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0);super(i,x),this.direction1=e,this.direction2=E}startDirectionFunction(i,x){const e=(0,b.RandomRange)(this.direction1.x,this.direction2.x),E=(0,b.RandomRange)(this.direction1.y,this.direction2.y),a=(0,b.RandomRange)(this.direction1.z,this.direction2.z);j.KJ.TransformNormalFromFloatsToRef(e,E,a,i,x)}clone(){const i=new L(this.radius,this.angle,this.direction1,this.direction2);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setFloat("radius",this.radius),i.setFloat("radiusRange",this.radiusRange),i.setVector3("direction1",this.direction1),i.setVector3("direction2",this.direction2)}buildUniformLayout(i){i.addUniform("radius",1),i.addUniform("radiusRange",1),i.addUniform("direction1",3),i.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const i=super.serialize();return i.direction1=this.direction1.de(),i.direction2=this.direction2.de(),i}parse(i){super.parse(i),this.direction1.A(i.direction1),this.direction2.A(i.direction2)}}class o{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=i,this.height=x,this.radiusRange=e,this.directionRandomizer=E,this._tempVector=j.KJ.Zero()}startDirectionFunction(i,x,e,E,a){e.position.subtractToRef(i.getTranslation(),this._tempVector),this._tempVector.normalize(),j.KJ.TransformNormalToRef(this._tempVector,a,this._tempVector);const Y=(0,b.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let J=Math.atan2(this._tempVector.x,this._tempVector.z);J+=(0,b.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=Y,this._tempVector.x=Math.sin(J),this._tempVector.z=Math.cos(J),this._tempVector.normalize(),E?x.A(this._tempVector):j.KJ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,i,x)}startPositionFunction(i,x,e,E){const a=(0,b.RandomRange)(-this.height/2,this.height/2),Y=(0,b.RandomRange)(0,2*Math.PI),J=(0,b.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),u=Math.sqrt(J)*this.radius,g=u*Math.cos(Y),A=u*Math.sin(Y);E?x.fJ(g,a,A):j.KJ.TransformCoordinatesFromFloatsToRef(g,a,A,i,x)}clone(){const i=new o(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setFloat("radius",this.radius),i.setFloat("height",this.height),i.setFloat("radiusRange",this.radiusRange),i.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(i){i.addUniform("radius",1),i.addUniform("height",1),i.addUniform("radiusRange",1),i.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const i={};return i.type=this.getClassName(),i.radius=this.radius,i.height=this.height,i.radiusRange=this.radiusRange,i.directionRandomizer=this.directionRandomizer,i}parse(i){this.radius=i.radius,this.height=i.height,this.radiusRange=i.radiusRange,this.directionRandomizer=i.directionRandomizer}}class M extends o{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.KJ(0,1,0);super(i,x,e),this.direction1=E,this.direction2=a}startDirectionFunction(i,x,e,E){const a=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),J=(0,b.RandomRange)(this.direction1.z,this.direction2.z);E?x.fJ(a,Y,J):j.KJ.TransformNormalFromFloatsToRef(a,Y,J,i,x)}clone(){const i=new M(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setFloat("radius",this.radius),i.setFloat("height",this.height),i.setFloat("radiusRange",this.radiusRange),i.setVector3("direction1",this.direction1),i.setVector3("direction2",this.direction2)}buildUniformLayout(i){i.addUniform("radius",1),i.addUniform("height",1),i.addUniform("radiusRange",1),i.addUniform("direction1",3),i.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const i=super.serialize();return i.direction1=this.direction1.de(),i.direction2=this.direction2.de(),i}parse(i){super.parse(i),j.KJ.FromArrayToRef(i.direction1,0,this.direction1),j.KJ.FromArrayToRef(i.direction2,0,this.direction2)}}class z{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=i,this.radiusRange=x,this.directionRandomizer=e}startDirectionFunction(i,x,e,E){const a=e.position.Cx(i.getTranslation()).normalize(),Y=(0,b.RandomRange)(0,this.directionRandomizer),J=(0,b.RandomRange)(0,this.directionRandomizer),u=(0,b.RandomRange)(0,this.directionRandomizer);a.x+=Y,a.y+=J,a.z+=u,a.normalize(),E?x.A(a):j.KJ.TransformNormalFromFloatsToRef(a.x,a.y,a.z,i,x)}startPositionFunction(i,x,e,E){const a=this.radius-(0,b.RandomRange)(0,this.radius*this.radiusRange),Y=(0,b.RandomRange)(0,1),J=(0,b.RandomRange)(0,2*Math.PI),u=Math.acos(2*Y-1),g=a*Math.cos(J)*Math.sin(u),A=a*Math.cos(u),K=a*Math.sin(J)*Math.sin(u);E?x.fJ(g,Math.abs(A),K):j.KJ.TransformCoordinatesFromFloatsToRef(g,Math.abs(A),K,i,x)}clone(){const i=new z(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setFloat("radius",this.radius),i.setFloat("radiusRange",this.radiusRange),i.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(i){i.addUniform("radius",1),i.addUniform("radiusRange",1),i.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const i={};return i.type=this.getClassName(),i.radius=this.radius,i.radiusRange=this.radiusRange,i.directionRandomizer=this.directionRandomizer,i}parse(i){this.radius=i.radius,this.radiusRange=i.radiusRange,this.directionRandomizer=i.directionRandomizer}}class T{constructor(){this.direction1=new j.KJ(0,1,0),this.direction2=new j.KJ(0,1,0)}startDirectionFunction(i,x,e,E){const a=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),J=(0,b.RandomRange)(this.direction1.z,this.direction2.z);E?x.fJ(a,Y,J):j.KJ.TransformNormalFromFloatsToRef(a,Y,J,i,x)}startPositionFunction(i,x,e,E){E?x.fJ(0,0,0):j.KJ.TransformCoordinatesFromFloatsToRef(0,0,0,i,x)}clone(){const i=new T;return g.d.DeepCopy(this,i),i}applyToShader(i){i.setVector3("direction1",this.direction1),i.setVector3("direction2",this.direction2)}buildUniformLayout(i){i.addUniform("direction1",3),i.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const i={};return i.type=this.getClassName(),i.direction1=this.direction1.de(),i.direction2=this.direction2.de(),i}parse(i){j.KJ.FromArrayToRef(i.direction1,0,this.direction1),j.KJ.FromArrayToRef(i.direction2,0,this.direction2)}}class Q{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=i,this.radiusRange=x,this.directionRandomizer=e}startDirectionFunction(i,x,e,E){const a=e.position.Cx(i.getTranslation()).normalize(),Y=(0,b.RandomRange)(0,this.directionRandomizer),J=(0,b.RandomRange)(0,this.directionRandomizer),u=(0,b.RandomRange)(0,this.directionRandomizer);a.x+=Y,a.y+=J,a.z+=u,a.normalize(),E?x.A(a):j.KJ.TransformNormalFromFloatsToRef(a.x,a.y,a.z,i,x)}startPositionFunction(i,x,e,E){const a=this.radius-(0,b.RandomRange)(0,this.radius*this.radiusRange),Y=(0,b.RandomRange)(0,1),J=(0,b.RandomRange)(0,2*Math.PI),u=Math.acos(2*Y-1),g=a*Math.cos(J)*Math.sin(u),A=a*Math.cos(u),K=a*Math.sin(J)*Math.sin(u);E?x.fJ(g,A,K):j.KJ.TransformCoordinatesFromFloatsToRef(g,A,K,i,x)}clone(){const i=new Q(this.radius,this.directionRandomizer);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setFloat("radius",this.radius),i.setFloat("radiusRange",this.radiusRange),i.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(i){i.addUniform("radius",1),i.addUniform("radiusRange",1),i.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const i={};return i.type=this.getClassName(),i.radius=this.radius,i.radiusRange=this.radiusRange,i.directionRandomizer=this.directionRandomizer,i}parse(i){this.radius=i.radius,this.radiusRange=i.radiusRange,this.directionRandomizer=i.directionRandomizer}}class t extends Q{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.KJ(0,1,0),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0);super(i),this.direction1=x,this.direction2=e}startDirectionFunction(i,x){const e=(0,b.RandomRange)(this.direction1.x,this.direction2.x),E=(0,b.RandomRange)(this.direction1.y,this.direction2.y),a=(0,b.RandomRange)(this.direction1.z,this.direction2.z);j.KJ.TransformNormalFromFloatsToRef(e,E,a,i,x)}clone(){const i=new t(this.radius,this.direction1,this.direction2);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setFloat("radius",this.radius),i.setFloat("radiusRange",this.radiusRange),i.setVector3("direction1",this.direction1),i.setVector3("direction2",this.direction2)}buildUniformLayout(i){i.addUniform("radius",1),i.addUniform("radiusRange",1),i.addUniform("direction1",3),i.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const i=super.serialize();return i.direction1=this.direction1.de(),i.direction2=this.direction2.de(),i}parse(i){super.parse(i),this.direction1.A(i.direction1),this.direction2.A(i.direction2)}}class V{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(i,x,e,E){const a=j.TmpVectors.KJ[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,e,a);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,e,a);const i=j.TmpVectors.KJ[1];a.subtractToRef(e.position,i),i.scaleToRef(1/e.lifeTime,a)}else a.set(0,0,0);E?x.A(a):j.KJ.TransformNormalToRef(a,i,x)}startPositionFunction(i,x,e,E){const a=j.TmpVectors.KJ[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,e,a):a.set(0,0,0),E?x.A(a):j.KJ.TransformCoordinatesToRef(a,i,x)}clone(){const i=new V;return g.d.DeepCopy(this,i),i}applyToShader(i){}buildUniformLayout(i){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const i={};return i.type=this.getClassName(),i.particlePositionGenerator=this.particlePositionGenerator,i.particleDestinationGenerator=this.particleDestinationGenerator,i}parse(i){i.particlePositionGenerator&&(this.particlePositionGenerator=i.particlePositionGenerator),i.particleDestinationGenerator&&(this.particleDestinationGenerator=i.particleDestinationGenerator)}}var S=e(12314);class f{get mesh(){return this._mesh}set mesh(i){this._mesh!==i&&(this._mesh=i,i?(this._indices=i.Pe(),this._positions=i.getVerticesData(S.f.PositionKind),this._normals=i.getVerticesData(S.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=j.KJ.Zero(),this._mesh=null,this.direction1=new j.KJ(0,1,0),this.direction2=new j.KJ(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=i}startDirectionFunction(i,x,e,E){if(this.useMeshNormalsForDirection&&this._normals)return void j.KJ.TransformNormalToRef(this._storedNormal,i,x);const a=(0,b.RandomRange)(this.direction1.x,this.direction2.x),Y=(0,b.RandomRange)(this.direction1.y,this.direction2.y),J=(0,b.RandomRange)(this.direction1.z,this.direction2.z);E?x.fJ(a,Y,J):j.KJ.TransformNormalFromFloatsToRef(a,Y,J,i,x)}startPositionFunction(i,x,e,E){if(!this._indices||!this._positions)return;const a=3*(Math.random()*(this._indices.length/3)|0),Y=Math.random(),J=Math.random()*(1-Y),u=1-Y-J,b=this._indices[a],g=this._indices[a+1],A=this._indices[a+2],K=j.TmpVectors.KJ[0],L=j.TmpVectors.KJ[1],o=j.TmpVectors.KJ[2],M=j.TmpVectors.KJ[3];j.KJ.FromArrayToRef(this._positions,3*b,K),j.KJ.FromArrayToRef(this._positions,3*g,L),j.KJ.FromArrayToRef(this._positions,3*A,o),M.x=Y*K.x+J*L.x+u*o.x,M.y=Y*K.y+J*L.y+u*o.y,M.z=Y*K.z+J*L.z+u*o.z,E?x.fJ(M.x,M.y,M.z):j.KJ.TransformCoordinatesFromFloatsToRef(M.x,M.y,M.z,i,x),this.useMeshNormalsForDirection&&this._normals&&(j.KJ.FromArrayToRef(this._normals,3*b,K),j.KJ.FromArrayToRef(this._normals,3*g,L),j.KJ.FromArrayToRef(this._normals,3*A,o),this._storedNormal.x=Y*K.x+J*L.x+u*o.x,this._storedNormal.y=Y*K.y+J*L.y+u*o.y,this._storedNormal.z=Y*K.z+J*L.z+u*o.z)}clone(){const i=new f(this.mesh);return g.d.DeepCopy(this,i),i}applyToShader(i){i.setVector3("direction1",this.direction1),i.setVector3("direction2",this.direction2)}buildUniformLayout(i){i.addUniform("direction1",3),i.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var i;const x={};return x.type=this.getClassName(),x.direction1=this.direction1.de(),x.direction2=this.direction2.de(),x.meshId=null===(i=this.mesh)||void 0===i?void 0:i.id,x.useMeshNormalsForDirection=this.useMeshNormalsForDirection,x}parse(i,x){j.KJ.FromArrayToRef(i.direction1,0,this.direction1),j.KJ.FromArrayToRef(i.direction2,0,this.direction2),i.meshId&&x&&(this.mesh=x.getLastMeshById(i.meshId)),this.useMeshNormalsForDirection=i.useMeshNormalsForDirection}}class w{_isUbo(i){return void 0!==i.addUniform}constructor(i){this._isUbo(i)?(this.setMatrix3x3=i.updateMatrix3x3.bind(i),this.setMatrix2x2=i.updateMatrix2x2.bind(i),this.setFloat=i.updateFloat.bind(i),this.setFloat2=i.updateFloat2.bind(i),this.setFloat3=i.updateFloat3.bind(i),this.setFloat4=i.updateFloat4.bind(i),this.setFloatArray=i.updateFloatArray.bind(i),this.setArray=i.updateArray.bind(i),this.setIntArray=i.updateIntArray.bind(i),this.setMatrix=i.he.bind(i),this.setMatrices=i.updateMatrices.bind(i),this.setVector3=i.updateVector3.bind(i),this.setVector4=i.updateVector4.bind(i),this.setColor3=i.updateColor3.bind(i),this.setColor4=i.updateColor4.bind(i),this.setDirectColor4=i.updateDirectColor4.bind(i),this.setInt=i.updateInt.bind(i),this.setInt2=i.updateInt2.bind(i),this.setInt3=i.updateInt3.bind(i),this.setInt4=i.updateInt4.bind(i)):(this.setMatrix3x3=i.setMatrix3x3.bind(i),this.setMatrix2x2=i.setMatrix2x2.bind(i),this.setFloat=i.setFloat.bind(i),this.setFloat2=i.setFloat2.bind(i),this.setFloat3=i.setFloat3.bind(i),this.setFloat4=i.setFloat4.bind(i),this.setFloatArray=i.setFloatArray.bind(i),this.setArray=i.setArray.bind(i),this.setIntArray=i.setIntArray.bind(i),this.setMatrix=i.setMatrix.bind(i),this.setMatrices=i.setMatrices.bind(i),this.setVector3=i.setVector3.bind(i),this.setVector4=i.setVector4.bind(i),this.setColor3=i.setColor3.bind(i),this.setColor4=i.setColor4.bind(i),this.setDirectColor4=i.setDirectColor4.bind(i),this.setInt=i.setInt.bind(i),this.setInt2=i.setInt2.bind(i),this.setInt3=i.setInt3.bind(i),this.setInt4=i.setInt4.bind(i))}}var O=e(12162);const l="gpuUpdateParticlesPixelShader",Z="#version 300 es\nvoid main() {discard;}\n";O.c.ShadersStore[l]||(O.c.ShadersStore[l]=Z);const B="gpuUpdateParticlesVertexShader",k="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";O.c.ShadersStore[B]||(O.c.ShadersStore[B]=k);(0,J.f)("BABYLON.WebGL2ParticleSystem",class{constructor(i,x){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=i,this._engine=x,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var i;return(null===(i=this._updateEffect)||void 0===i?void 0:i.isReady())??!1}createUpdateBuffer(i){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof V&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=i,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new w(this._updateEffect)}createVertexBuffers(i,x){this._updateVAO.push(this._createUpdateVAO(i)),this._renderVAO.push(this._engine.recordVertexArrayObject(x,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=x}createParticleBuffer(i){return i}bindDrawBuffers(i,x,e){e?this._engine.bindBuffers(this._renderVertexBuffers,e,x):this._engine.bindVertexArrayObject(this._renderVAO[i],null)}preUpdateParticleBuffer(){const i=this._engine;if(this._engine.enableEffect(this._updateEffect),!i.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(i,x,e){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[i],null);const j=this._engine;j.bindTransformFeedbackBuffer(x.getBuffer()),j.setRasterizerState(!1),j.beginTransformFeedback(!0),j.drawArraysType(3,0,e),j.endTransformFeedback(),j.setRasterizerState(!0),j.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let i=0;i<this._updateVAO.length;i++)this._engine.releaseVertexArrayObject(this._updateVAO[i]);this._updateVAO.length=0;for(let i=0;i<this._renderVAO.length;i++)this._engine.releaseVertexArrayObject(this._renderVAO[i]);this._renderVAO.length=0}_createUpdateVAO(i){const x={};x.position=i.createVertexBuffer("position",0,3);let e=3;x.age=i.createVertexBuffer("age",e,1),e+=1,x.size=i.createVertexBuffer("size",e,3),e+=3,x.life=i.createVertexBuffer("life",e,1),e+=1,x.seed=i.createVertexBuffer("seed",e,4),e+=4,x.direction=i.createVertexBuffer("direction",e,3),e+=3,this._parent.particleEmitterType instanceof V&&(x.initialPosition=i.createVertexBuffer("initialPosition",e,3),e+=3),this._parent._colorGradientsTexture||(x.color=i.createVertexBuffer("color",e,4),e+=4),this._parent._isBillboardBased||(x.initialDirection=i.createVertexBuffer("initialDirection",e,3),e+=3),this._parent.noiseTexture&&(x.noiseCoordinates1=i.createVertexBuffer("noiseCoordinates1",e,3),e+=3,x.noiseCoordinates2=i.createVertexBuffer("noiseCoordinates2",e,3),e+=3),this._parent._angularSpeedGradientsTexture?(x.angle=i.createVertexBuffer("angle",e,1),e+=1):(x.angle=i.createVertexBuffer("angle",e,2),e+=2),this._parent._isAnimationSheetEnabled&&(x.cellIndex=i.createVertexBuffer("cellIndex",e,1),e+=1,this._parent.spriteRandomStartCell&&(x.cellStartOffset=i.createVertexBuffer("cellStartOffset",e,1),e+=1));const j=this._engine.recordVertexArrayObject(x,null,this._updateEffect);return this._engine.bindArrayBuffer(null),j}});class N{constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,j=arguments.length>3?arguments[3]:void 0;this._engine=i,this._label=j,this._engine._storageBuffers.push(this),this._create(x,e)}_create(i,x){this._bufferSize=i,this._creationFlags=x,this._buffer=this._engine.createStorageBuffer(i,x,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(i,x,e){this._buffer&&this._engine.updateStorageBuffer(this._buffer,i,x,e)}async read(i,x,e,j){return await this._engine.readFromStorageBuffer(this._buffer,i,x,e,j)}dispose(){const i=this._engine._storageBuffers,x=i.indexOf(this);-1!==x&&(i[x]=i[i.length-1],i.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var mi=e(12234),X=e(12236),C=e(12278),n=e(12227),I=e(12513),d=e(12072),p=e(12187),H=e(12434);class U{constructor(){this._gpuTimeInFrameId=-1,this.counter=new H.c}_addDuration(i,x){i<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==i?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(x,!1),this._gpuTimeInFrameId=i):this.counter.addCount(x,!1))}}var D=e(12142);class h{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=i,this._engine=x,this.uniqueId=I.c.UniqueId,x.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new U),this._engine.getCaps().supportComputeShaders?j.bindingsMapping?(this._context=x.createComputeContext(),this._shaderPath=e,this._options={bindingsMapping:{},defines:[],...j}):d.c.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):d.c.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(i,x){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const j=this._bindings[i];this._bindings[i]={type:e?0:4,object:x,indexInGroupEntries:null===j||void 0===j?void 0:j.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!j||j.object!==x||j.type!==this._bindings[i].type)}setStorageTexture(i,x){const e=this._bindings[i];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==x),this._bindings[i]={type:1,object:x,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setExternalTexture(i,x){const e=this._bindings[i];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==x),this._bindings[i]={type:6,object:x,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setVideoTexture(i,x){return!!x.externalTexture&&(this.setExternalTexture(i,x.externalTexture),!0)}setUniformBuffer(i,x){const e=this._bindings[i];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==x),this._bindings[i]={type:h._BufferIsDataBuffer(x)?7:2,object:x,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setStorageBuffer(i,x){const e=this._bindings[i];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==x),this._bindings[i]={type:h._BufferIsDataBuffer(x)?7:3,object:x,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setTextureSampler(i,x){const e=this._bindings[i];this._contextIsDirty||(this._contextIsDirty=!e||!x.compareSampler(e.object)),this._bindings[i]={type:5,object:x,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}isReady(){let i=this._effect;for(const E in this._bindings){const i=this._bindings[E],x=i.type,e=i.object;switch(x){case 0:case 4:case 1:if(!e.isReady())return!1;break;case 6:if(!e.isReady())return!1;break}}const x=[],e=this._shaderPath;if(this._options.defines)for(let E=0;E<this._options.defines.length;E++)x.push(this._options.defines[E]);const j=x.join("\n");return this._cachedDefines!==j&&(this._cachedDefines=j,i=this._engine.createComputeEffect(e,{defines:j,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=i),!!i.isReady()}dispatch(i,x,e){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,i,x,e,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const e=h._BufferIsDataBuffer(i)?i:i.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,e,x,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const x in this._bindings){const e=this._bindings[x];if(!this._options.bindingsMapping[x])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+x+"'");switch(e.type){case 0:{const j=this._samplers[x],E=e.object;var i;if(!j||!E._texture||!j.compareSampler(E._texture))this._samplers[x]=(new p.b).setParameters(E.wrapU,E.wrapV,E.wrapR,E.anisotropicFilteringLevel,E._texture.samplingMode,null===(i=E._texture)||void 0===i?void 0:i._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const i=e.object;i.getBuffer()!==e.buffer&&(e.buffer=i.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((E=>{(0,D.d)((()=>this.dispatch(i,x,e)),E,void 0,j)}))}serialize(){const i=C.b.Serialize(this);i.options=this._options,i.shaderPath=this._shaderPath,i.JL={},i.textures={};for(const x in this._bindings){const e=this._bindings[x],j=e.object;switch(e.type){case 0:case 4:case 1:{const E=j.serialize();E&&(i.textures[x]=E,i.JL[x]={type:e.type});break}}}return i}static Parse(i,x,e){const j=C.b.Parse((()=>new h(i.name,x.getEngine(),i.shaderPath,i.options)),i,x,e);for(const E in i.textures){const a=i.JL[E],Y=n.d.Parse(i.textures[E],x,e);0===a.type?j.setTexture(E,Y):4===a.type?j.setTexture(E,Y,!1):j.setStorageTexture(E,Y)}return j}static _BufferIsDataBuffer(i){return void 0!==i.underlyingResource}}(0,mi.e)([(0,X.O)()],h.prototype,"name",void 0),(0,mi.e)([(0,X.O)()],h.prototype,"fastMode",void 0),(0,J.f)("BABYLON.ComputeShader",h);var F=e(12470);const R="gpuUpdateParticlesComputeShader",y="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";O.c.ShadersStoreWGSL[R]||(O.c.ShadersStoreWGSL[R]=y);(0,J.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(i,x){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=i,this._engine=x}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var i;return(null===(i=this._updateComputeShader)||void 0===i?void 0:i.isReady())??!1}createUpdateBuffer(i){var x;const e={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(e.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(e.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(e.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(e.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(e.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(e.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(e.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new h("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:e,defines:i.split("\n")}),null===(x=this._simParamsComputeShader)||void 0===x||x.dispose(),this._simParamsComputeShader=new F.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new w(this._simParamsComputeShader)}createVertexBuffers(i,x){this._renderVertexBuffers.push(x)}createParticleBuffer(i){const x=new N(this._engine,4*i.length,11,"ComputeShaderParticleSystemBuffer");return x.update(i),this._bufferComputeShader.push(x),x.getBuffer()}bindDrawBuffers(i,x,e){this._engine.bindBuffers(this._renderVertexBuffers[i],e,x)}preUpdateParticleBuffer(){}updateParticleBuffer(i,x,e){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[i]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^i]),this._updateComputeShader.dispatch(Math.ceil(e/64))}releaseBuffers(){var i;for(let x=0;x<this._bufferComputeShader.length;++x)this._bufferComputeShader[x].dispose();this._bufferComputeShader.length=0,null===(i=this._simParamsComputeShader)||void 0===i||i.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class r{constructor(i,x,e){this.gradient=i,this.color1=x,this.color2=e}getColorToRef(i){this.color2?Y.lJ.LerpToRef(this.color1,this.color2,Math.random(),i):i.A(this.color1)}}class c{constructor(i,x){this.gradient=i,this.color=x}}class P{constructor(i,x,e){this.gradient=i,this.factor1=x,this.factor2=e}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class q{static GetCurrentGradient(i,x,e){if(x[0].gradient>i)return void e(x[0],x[0],1);for(let E=0;E<x.length-1;E++){const j=x[E],a=x[E+1];if(i>=j.gradient&&i<=a.gradient){return void e(j,a,(i-j.gradient)/(a.gradient-j.gradient))}}const j=x.length-1;e(x[j],x[j],1)}}var W=e(12065),G=e(12702),v=e(12108);class s{constructor(i){this.particleSystem=i,this.position=j.KJ.Zero(),this.direction=j.KJ.Zero(),this.color=new Y.lJ(0,0,0,0),this.colorStep=new Y.lJ(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new j.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new Y.lJ(0,0,0,0),this._currentColor2=new Y.lJ(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=s._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let i=this.age,x=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===x?(x=1,i=this._randomCellOffset):i+=this._randomCellOffset);const e=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let j;j=this._initialSpriteCellLoop?(0,b.Clamp)(i*x%this.lifeTime/this.lifeTime):(0,b.Clamp)(i*x/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+j*e|0}_inheritParticleInfoToSubEmitter(i){if(i.particleSystem.Yx.position){const x=i.particleSystem.Yx;if(x.position.A(this.position),i.inheritDirection){const i=j.TmpVectors.KJ[0];this.direction.normalizeToRef(i),x.setDirection(i,0,Math.PI/2)}}else{i.particleSystem.Yx.A(this.position)}this.direction.scaleToRef(i.inheritedVelocityAmount/2,j.TmpVectors.KJ[0]),i.particleSystem._inheritedVelocityOffset.A(j.TmpVectors.KJ[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const i of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(i)}_reset(){this.age=0,this.id=s._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(i){i.position.A(this.position),this._initialDirection?i._initialDirection?i._initialDirection.A(this._initialDirection):i._initialDirection=this._initialDirection.clone():i._initialDirection=null,i.direction.A(this.direction),this.qJ&&(i.qJ?i.qJ.A(this.qJ):i.qJ=this.qJ.clone()),i.color.A(this.color),i.colorStep.A(this.colorStep),i.lifeTime=this.lifeTime,i.age=this.age,i._randomCellOffset=this._randomCellOffset,i.size=this.size,i.scale.A(this.scale),i.angle=this.angle,i.angularSpeed=this.angularSpeed,i.particleSystem=this.particleSystem,i.cellIndex=this.cellIndex,i.id=this.id,i._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(i._currentColorGradient=this._currentColorGradient,i._currentColor1.A(this._currentColor1),i._currentColor2.A(this._currentColor2)),this._currentSizeGradient&&(i._currentSizeGradient=this._currentSizeGradient,i._currentSize1=this._currentSize1,i._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(i._currentAngularSpeedGradient=this._currentAngularSpeedGradient,i._currentAngularSpeed1=this._currentAngularSpeed1,i._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(i._currentVelocityGradient=this._currentVelocityGradient,i._currentVelocity1=this._currentVelocity1,i._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(i._currentLimitVelocityGradient=this._currentLimitVelocityGradient,i._currentLimitVelocity1=this._currentLimitVelocity1,i._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(i._currentDragGradient=this._currentDragGradient,i._currentDrag1=this._currentDrag1,i._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(i._initialStartSpriteCellId=this._initialStartSpriteCellId,i._initialEndSpriteCellId=this._initialEndSpriteCellId,i._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(i.remapData&&this.remapData?i.remapData.A(this.remapData):i.remapData=new j.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(i._randomNoiseCoordinates1?(i._randomNoiseCoordinates1.A(this._randomNoiseCoordinates1),i._randomNoiseCoordinates2.A(this._randomNoiseCoordinates2)):(i._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),i._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}s._Count=0;var ii=e(12353),xi=(e(12391),e(12580)),ei=e(12571),ji=e(12466);function Ei(i,x){const e=(0,b.RandomRange)(0,1);Y.lJ.LerpToRef(x.color1,x.color2,e,i.color),x.colorDead.subtractToRef(i.color,x._colorDiff),x._colorDiff.scaleToRef(1/i.lifeTime,i.colorStep)}function ai(i,x){i._currentColorGradient=x._colorGradients[0],i._currentColorGradient.getColorToRef(i.color),i._currentColor1.A(i.color),x._colorGradients.length>1?x._colorGradients[1].getColorToRef(i._currentColor2):i._currentColor2.A(i.color)}function Yi(i,x){const e=x._colorGradients;q.GetCurrentGradient(x._ratio,e,((x,e,j)=>{x!==i._currentColorGradient&&(i._currentColor1.A(i._currentColor2),e.getColorToRef(i._currentColor2),i._currentColorGradient=x),Y.lJ.LerpToRef(i._currentColor1,i._currentColor2,j,i.color)}))}function Ji(i,x){i.colorStep.scaleToRef(x._scaledUpdateSpeed,x._scaledColorStep),i.color.addInPlace(x._scaledColorStep),i.color.a<0&&(i.color.a=0)}function ui(i,x){q.GetCurrentGradient(x._ratio,x._angularSpeedGradients,((x,e,j)=>{x!==i._currentAngularSpeedGradient&&(i._currentAngularSpeed1=i._currentAngularSpeed2,i._currentAngularSpeed2=e.getFactor(),i._currentAngularSpeedGradient=x),i.angularSpeed=(0,b.Lerp)(i._currentAngularSpeed1,i._currentAngularSpeed2,j)}))}function bi(i,x){i.angle+=i.angularSpeed*x._scaledUpdateSpeed}function gi(i,x){x.particleEmitterType.startDirectionFunction(x._emitterWorldMatrix,i.direction,i,x.isLocal,x._emitterInverseWorldMatrix)}function Ai(i,x){x.startDirectionFunction(x._emitterWorldMatrix,i.direction,i,x.isLocal)}function Ki(i,x){i._currentVelocityGradient=x._velocityGradients[0],i._currentVelocity1=i._currentVelocityGradient.getFactor(),x._velocityGradients.length>1?i._currentVelocity2=x._velocityGradients[1].getFactor():i._currentVelocity2=i._currentVelocity1}function Li(i,x){i._currentLimitVelocityGradient=x._limitVelocityGradients[0],i._currentLimitVelocity1=i._currentLimitVelocityGradient.getFactor(),x._limitVelocityGradients.length>1?i._currentLimitVelocity2=x._limitVelocityGradients[1].getFactor():i._currentLimitVelocity2=i._currentLimitVelocity1}function oi(i,x){q.GetCurrentGradient(x._ratio,x._velocityGradients,((e,j,E)=>{e!==i._currentVelocityGradient&&(i._currentVelocity1=i._currentVelocity2,i._currentVelocity2=j.getFactor(),i._currentVelocityGradient=e),x._directionScale*=(0,b.Lerp)(i._currentVelocity1,i._currentVelocity2,E)}))}function Mi(i,x){q.GetCurrentGradient(x._ratio,x._limitVelocityGradients,((e,j,E)=>{e!==i._currentLimitVelocityGradient&&(i._currentLimitVelocity1=i._currentLimitVelocity2,i._currentLimitVelocity2=j.getFactor(),i._currentLimitVelocityGradient=e);const a=(0,b.Lerp)(i._currentLimitVelocity1,i._currentLimitVelocity2,E);i.direction.length()>a&&i.direction.scaleInPlace(x.limitVelocityDamping)}))}function zi(i,x){i.direction.scaleToRef(x._directionScale,x._scaledDirection)}function Ti(i,x){x.particleEmitterType.startPositionFunction(x._emitterWorldMatrix,i.position,i,x.isLocal)}function Qi(i,x){x.startPositionFunction(x._emitterWorldMatrix,i.position,i,x.isLocal)}function ti(i,x){i.qJ?i.qJ.A(i.position):i.qJ=i.position.clone(),j.KJ.TransformCoordinatesToRef(i.qJ,x._emitterWorldMatrix,i.position)}function Vi(i,x){x.isLocal&&i.qJ?(i.qJ.addInPlace(x._scaledDirection),j.KJ.TransformCoordinatesToRef(i.qJ,x._emitterWorldMatrix,i.position)):i.position.addInPlace(x._scaledDirection)}function Si(i,x){i._currentDragGradient=x._dragGradients[0],i._currentDrag1=i._currentDragGradient.getFactor(),x._dragGradients.length>1?i._currentDrag2=x._dragGradients[1].getFactor():i._currentDrag2=i._currentDrag1}function fi(i,x){q.GetCurrentGradient(x._ratio,x._dragGradients,((e,j,E)=>{e!==i._currentDragGradient&&(i._currentDrag1=i._currentDrag2,i._currentDrag2=j.getFactor(),i._currentDragGradient=e);const a=(0,b.Lerp)(i._currentDrag1,i._currentDrag2,E);x._scaledDirection.scaleInPlace(1-a)}))}function wi(i,x){i._randomNoiseCoordinates1?(i._randomNoiseCoordinates1.fJ(Math.random(),Math.random(),Math.random()),i._randomNoiseCoordinates2.fJ(Math.random(),Math.random(),Math.random())):(i._randomNoiseCoordinates1=new j.KJ(Math.random(),Math.random(),Math.random()),i._randomNoiseCoordinates2=new j.KJ(Math.random(),Math.random(),Math.random()))}function Oi(i,x){const e=x._noiseTextureData,E=x._noiseTextureSize;if(e&&E&&i._randomNoiseCoordinates1){const a=x._fetchR(i._randomNoiseCoordinates1.x,i._randomNoiseCoordinates1.y,E.width,E.height,e),Y=x._fetchR(i._randomNoiseCoordinates1.z,i._randomNoiseCoordinates2.x,E.width,E.height,e),J=x._fetchR(i._randomNoiseCoordinates2.y,i._randomNoiseCoordinates2.z,E.width,E.height,e),u=j.TmpVectors.KJ[0],b=j.TmpVectors.KJ[1];u.fJ((2*a-1)*x.noiseStrength.x,(2*Y-1)*x.noiseStrength.y,(2*J-1)*x.noiseStrength.z),u.scaleToRef(x._tempScaledUpdateSpeed,b),i.direction.addInPlace(b)}}function li(i,x){x.gravity.scaleToRef(x._tempScaledUpdateSpeed,x._scaledGravity),i.direction.addInPlace(x._scaledGravity)}function Zi(i,x){i.size=(0,b.RandomRange)(x.minSize,x.maxSize),i.scale.fJ((0,b.RandomRange)(x.minScaleX,x.maxScaleX),(0,b.RandomRange)(x.minScaleY,x.maxScaleY))}function Bi(i,x){i._currentSizeGradient=x._sizeGradients[0],i._currentSize1=i._currentSizeGradient.getFactor(),i.size=i._currentSize1,x._sizeGradients.length>1?i._currentSize2=x._sizeGradients[1].getFactor():i._currentSize2=i._currentSize1,i.scale.fJ((0,b.RandomRange)(x.minScaleX,x.maxScaleX),(0,b.RandomRange)(x.minScaleY,x.maxScaleY))}function ki(i,x){const e=x._actualFrame/x.targetStopDuration;q.GetCurrentGradient(e,x._startSizeGradients,((e,j,E)=>{e!==x._currentStartSizeGradient&&(x._currentStartSize1=x._currentStartSize2,x._currentStartSize2=j.getFactor(),x._currentStartSizeGradient=e);const a=(0,b.Lerp)(x._currentStartSize1,x._currentStartSize2,E);i.scale.scaleInPlace(a)}))}function Ni(i,x){q.GetCurrentGradient(x._ratio,x._sizeGradients,((x,e,j)=>{x!==i._currentSizeGradient&&(i._currentSize1=i._currentSize2,i._currentSize2=e.getFactor(),i._currentSizeGradient=x),i.size=(0,b.Lerp)(i._currentSize1,i._currentSize2,j)}))}function mx(i,x){i.remapData=new j.Vector4(0,1,0,1)}function Xi(i,x){x._colorRemapGradients&&x._colorRemapGradients.length>0&&q.GetCurrentGradient(x._ratio,x._colorRemapGradients,((x,e,j)=>{const E=(0,b.Lerp)(x.factor1,e.factor1,j),a=(0,b.Lerp)(x.factor2,e.factor2,j);i.remapData.x=E,i.remapData.y=a-E})),x._alphaRemapGradients&&x._alphaRemapGradients.length>0&&q.GetCurrentGradient(x._ratio,x._alphaRemapGradients,((x,e,j)=>{const E=(0,b.Lerp)(x.factor1,e.factor1,j),a=(0,b.Lerp)(x.factor2,e.factor2,j);i.remapData.z=E,i.remapData.w=a-E}))}function Ci(i,x){const e=(0,b.Clamp)(x._actualFrame/x.targetStopDuration);q.GetCurrentGradient(e,x._lifeTimeGradients,((x,j)=>{const E=x,a=j,Y=E.getFactor(),J=a.getFactor(),u=(e-E.gradient)/(a.gradient-E.gradient);i.lifeTime=(0,b.Lerp)(Y,J,u)})),x._emitPower=(0,b.RandomRange)(x.minEmitPower,x.maxEmitPower)}function ni(i,x){i.lifeTime=(0,b.RandomRange)(x.minLifeTime,x.maxLifeTime),x._emitPower=(0,b.RandomRange)(x.minEmitPower,x.maxEmitPower)}function Ii(i,x){0===x._emitPower?(i._initialDirection?i._initialDirection.A(i.direction):i._initialDirection=i.direction.clone(),i.direction.set(0,0,0)):(i._initialDirection=null,i.direction.scaleInPlace(x._emitPower)),i.direction.addInPlace(x._inheritedVelocityOffset)}function di(i,x){i.angularSpeed=(0,b.RandomRange)(x.minAngularSpeed,x.maxAngularSpeed),i.angle=(0,b.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function pi(i,x){i._currentAngularSpeedGradient=x._angularSpeedGradients[0],i.angularSpeed=i._currentAngularSpeedGradient.getFactor(),i._currentAngularSpeed1=i.angularSpeed,x._angularSpeedGradients.length>1?i._currentAngularSpeed2=x._angularSpeedGradients[1].getFactor():i._currentAngularSpeed2=i._currentAngularSpeed1,i.angle=(0,b.RandomRange)(x.minInitialRotation,x.maxInitialRotation)}function Hi(i,x){i._initialStartSpriteCellId=x.startSpriteCellID,i._initialEndSpriteCellId=x.endSpriteCellID,i._initialSpriteCellLoop=x.spriteCellLoop}function Ui(i,x){i.previousItem=x.previousItem,i.nextItem=x,x.previousItem&&(x.previousItem.nextItem=i),x.previousItem=i}function Di(i,x){i.previousItem=x,i.nextItem=x.nextItem,x.nextItem&&(x.nextItem.previousItem=i),x.nextItem=i}function hi(i,x){let e=x;for(;e.nextItem;)e=e.nextItem;i.previousItem=e,i.nextItem=e.nextItem,e.nextItem=i}function Fi(i){i.previousItem&&(i.previousItem.nextItem=i.nextItem),i.nextItem&&(i.nextItem.previousItem=i.previousItem)}class Ri extends u{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(i){this._startDirectionFunction!==i&&(this._startDirectionFunction=i,this._directionProcessing.process=i?Ai:gi)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(i){this._startPositionFunction!==i&&(this._startPositionFunction=i,this._positionCreation.process=i?Qi:Ti)}set onDispose(i){this._onDisposeObserver&&this.te.remove(this._onDisposeObserver),this._onDisposeObserver=this.te.add(i)}get M(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(i){this._useRampGradients!==i&&(this._useRampGradients=i,this._resetEffect(),i?(this._rampCreation={process:mx,previousItem:null,nextItem:null},Di(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:Xi,previousItem:null,nextItem:null},Di(this._remapGradientProcessing,this._gravityProcessing)):(Fi(this._rampCreation),Fi(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(i){this._isLocal!==i&&(this._isLocal=i,i?(this._isLocalCreation={process:ti,previousItem:null,nextItem:null},Di(this._isLocalCreation,this._positionCreation)):Fi(this._isLocalCreation))}get particles(){return this.eL}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(i){this._animationSheetEnabled!==i&&(this._animationSheetEnabled=i,i?(this._sheetCreation={process:Hi,previousItem:null,nextItem:null},Di(this._sheetCreation,this._colorCreation)):Fi(this._sheetCreation),this._reset())}getActiveCount(){return this.eL.length}getClassName(){return"mb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var i;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(i=this._customWrappers[x])||void 0===i?void 0:i.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[i]??this._customWrappers[0]}setCustomEffect(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new ii.e(this._engine),this._customWrappers[x].effect=i,this._customWrappers[x].drawContext&&(this._customWrappers[x].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new W.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(i){if(this.noiseTexture!==i){if(this._noiseTexture=i,!i)return Fi(this._noiseCreation),void Fi(this._noiseProcessing);this._noiseCreation={process:wi,previousItem:null,nextItem:null},Di(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:Oi,previousItem:null,nextItem:null},Di(this._noiseProcessing,this._positionProcessing)}}constructor(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,u=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(i),this._emitterInverseWorldMatrix=j.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new j.KJ,this.te=new W.b,this.onStoppedObservable=new W.b,this.onStartedObservable=new W.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.eL=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new Y.lJ(0,0,0,0),this._colorDiff=new Y.lJ(0,0,0,0),this._scaledDirection=j.KJ.Zero(),this._scaledGravity=j.KJ.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=i=>{},this.recycleParticle=i=>{const x=this.eL.pop();x!==i&&x.copyTo(i),this._stockParticles.push(x)},this._createParticle=()=>{let i;return 0!==this._stockParticles.length?(i=this._stockParticles.pop(),i._reset()):i=new s(this),this._prepareParticle(i),i},this.paused=!1,this._shadersLoaded=!1,this._capacity=x,this._epsilon=J,e&&"Scene"!==e.getClassName()?(this._engine=e,this.defaultProjectionMatrix=j.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=e||v.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.iL.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:ni,previousItem:null,nextItem:null},this._positionCreation={process:Ti,previousItem:null,nextItem:null},Di(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:gi,previousItem:null,nextItem:null},Di(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:Ii,previousItem:null,nextItem:null},Di(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:Zi,previousItem:null,nextItem:null},Di(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:di,previousItem:null,nextItem:null},Di(this._angleCreation,this._sizeCreation),this._colorCreation={process:Ei,previousItem:null,nextItem:null},Di(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,u||(this._colorProcessing={process:Ji,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:bi,previousItem:null,nextItem:null},Di(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:zi,previousItem:null,nextItem:null},Di(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:Vi,previousItem:null,nextItem:null},Di(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:li,previousItem:null,nextItem:null},Di(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=a,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new ii.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new A,this.updateFunction=i=>{var x;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(x=this.noiseTexture.getContent())||void 0===x||x.then((i=>{this._noiseTextureData=i})));const e=i===this.eL;for(let j=0;j<i.length;j++){const x=i[j];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const E=x.age;if(x.age+=this._tempScaledUpdateSpeed,x.age>x.lifeTime){const i=x.age-E,e=x.lifeTime-E;this._tempScaledUpdateSpeed=e*this._tempScaledUpdateSpeed/i,x.age=x.lifeTime}this._ratio=x.age/x.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let a=this._updateQueueStart;for(;a;)a.process(x,this),a=a.nextItem;if(this._isAnimationSheetEnabled&&!u&&x.updateCellIndex(),x._inheritParticleInfoToSubEmitters(),x.age>=x.lifeTime){if(this._emitFromParticle(x),x._attachedSubEmitters){for(const i of x._attachedSubEmitters)i.particleSystem.disposeOnStop=!0,i.particleSystem.stop();x._attachedSubEmitters=null}this.recycleParticle(x),e&&j--}else;}}}serialize(i){throw new Error("Method not implemented.")}clone(i,x){throw new Error("Method not implemented.")}_addFactorGradient(i,x,e,j){const E=new P(x,e,j);i.push(E),i.sort(((i,x)=>i.gradient<x.gradient?-1:i.gradient>x.gradient?1:0))}_removeFactorGradient(i,x){if(!i)return;let e=0;for(const j of i){if(j.gradient===x){i.splice(e,1);break}e++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=Ci:this._lifeTimeCreation.process=ni}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:ki,previousItem:null,nextItem:null},Di(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(Fi(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(i){this.targetStopDuration!==i&&(this._targetStopDuration=i,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(i,x,e){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,i,x,e),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(i){return this._removeFactorGradient(this._lifeTimeGradients,i),this._syncLifeTimeCreation(),this}addSizeGradient(i,x,e){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=Bi,this._sizeGradientProcessing={process:Ni,previousItem:null,nextItem:null},Ui(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,i,x,e),this}removeSizeGradient(i){var x;return this._removeFactorGradient(this._sizeGradients,i),0===(null===(x=this._sizeGradients)||void 0===x?void 0:x.length)&&(Fi(this._sizeGradientProcessing),this._sizeCreation.process=Zi),this}addColorRemapGradient(i,x,e){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,i,x,e),this}removeColorRemapGradient(i){return this._removeFactorGradient(this._colorRemapGradients,i),this}addAlphaRemapGradient(i,x,e){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,i,x,e),this}removeAlphaRemapGradient(i){return this._removeFactorGradient(this._alphaRemapGradients,i),this}addAngularSpeedGradient(i,x,e){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=pi,this._angularSpeedGradientProcessing={process:ui,previousItem:null,nextItem:null},Ui(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,i,x,e),this}removeAngularSpeedGradient(i){var x;return this._removeFactorGradient(this._angularSpeedGradients,i),0===(null===(x=this._angularSpeedGradients)||void 0===x?void 0:x.length)&&(this._angleCreation.process=di,Fi(this._angularSpeedGradientProcessing)),this}addVelocityGradient(i,x,e){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:Ki,previousItem:null,nextItem:null},Di(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:oi,previousItem:null,nextItem:null},Ui(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,i,x,e),this}removeVelocityGradient(i){var x;return this._removeFactorGradient(this._velocityGradients,i),0===(null===(x=this._velocityGradients)||void 0===x?void 0:x.length)&&(Fi(this._velocityCreation),Fi(this._velocityGradientProcessing)),this}addLimitVelocityGradient(i,x,e){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:Li,previousItem:null,nextItem:null},Di(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:Mi,previousItem:null,nextItem:null},Di(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,i,x,e),this}removeLimitVelocityGradient(i){var x;return this._removeFactorGradient(this._limitVelocityGradients,i),0===(null===(x=this._limitVelocityGradients)||void 0===x?void 0:x.length)&&(Fi(this._limitVelocityCreation),Fi(this._limitVelocityGradientProcessing)),this}addDragGradient(i,x,e){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:Si,previousItem:null,nextItem:null},Ui(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:fi,previousItem:null,nextItem:null},Ui(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,i,x,e),this}removeDragGradient(i){var x;return this._removeFactorGradient(this._dragGradients,i),0===(null===(x=this._dragGradients)||void 0===x?void 0:x.length)&&(Fi(this._dragCreation),Fi(this._dragGradientProcessing)),this}addEmitRateGradient(i,x,e){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,i,x,e),this}removeEmitRateGradient(i){return this._removeFactorGradient(this._emitRateGradients,i),this}addStartSizeGradient(i,x,e){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,i,x,e),this._syncStartSizeCreation(),this}removeStartSizeGradient(i){return this._removeFactorGradient(this._startSizeGradients,i),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const i=new Uint8Array(4*this._rawTextureWidth),x=Y.TmpColors.MJ[0];for(let e=0;e<this._rawTextureWidth;e++){const j=e/this._rawTextureWidth;q.GetCurrentGradient(j,this._rampGradients,((j,E,a)=>{Y.MJ.LerpToRef(j.color,E.color,a,x),i[4*e]=255*x.r,i[4*e+1]=255*x.g,i[4*e+2]=255*x.b,i[4*e+3]=255}))}this._rampGradientsTexture=G.e.CreateRGBATexture(i,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((i,x)=>i.gradient<x.gradient?-1:i.gradient>x.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(i,x){this._rampGradients||(this._rampGradients=[]);const e=new c(i,x);return this._rampGradients.push(e),this._syncRampGradientTexture(),this}removeRampGradient(i){return this._removeGradientAndTexture(i,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(i,x,e){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=ai,this._colorProcessing.process=Yi);const j=new r(i,x,e);return this._colorGradients.push(j),this._colorGradients.sort(((i,x)=>i.gradient<x.gradient?-1:i.gradient>x.gradient?1:0)),this}removeColorGradient(i){if(!this._colorGradients)return this;let x=0;for(const e of this._colorGradients){if(e.gradient===i){this._colorGradients.splice(x,1);break}x++}return 0===this._colorGradients.length&&(this._colorCreation.process=Ei,this._colorProcessing.process=Ji),this}resetDrawCache(){if(this._drawWrappers){for(const i of this._drawWrappers)if(i)for(const x of i)null===x||void 0===x||x.dispose();this._drawWrappers=[]}}_fetchR(i,x,e,j,E){return E[4*(((i=.5*Math.abs(i)+.5)*e%e|0)+((x=.5*Math.abs(x)+.5)*j%j|0)*e)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const i=this._engine,x=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*x),this._vertexBuffer=new S.d(i,this._vertexData,!0,x);let e=0;const j=this._vertexBuffer.createVertexBuffer(S.f.PositionKind,e,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.f.PositionKind]=j,e+=3;const E=this._vertexBuffer.createVertexBuffer(S.f.ColorKind,e,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[S.f.ColorKind]=E,e+=4;const a=this._vertexBuffer.createVertexBuffer("angle",e,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=a,e+=1;const Y=this._vertexBuffer.createVertexBuffer("size",e,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=Y,e+=2,this._isAnimationSheetEnabled){const i=this._vertexBuffer.createVertexBuffer("cellIndex",e,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=i,e+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const i=this._vertexBuffer.createVertexBuffer("direction",e,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=i,e+=3}if(this._useRampGradients){const i=this._vertexBuffer.createVertexBuffer("remapData",e,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=i,e+=4}let J;if(this._useInstancing){const x=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new S.d(i,x,!1,2),J=this._spriteBuffer.createVertexBuffer("offset",0,2)}else J=this._vertexBuffer.createVertexBuffer("offset",e,2,this._vertexBufferSize,this._useInstancing),e+=2;this._vertexBuffers.offset=J,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const i=[],x=[];let e=0;for(let j=0;j<this._capacity;j++)i.push(e),i.push(e+1),i.push(e+2),i.push(e),i.push(e+2),i.push(e+3),x.push(e,e+1,e+1,e+2,e+2,e+3,e+3,e,e,e+3),e+=4;this._indexBuffer=this._engine.createIndexBuffer(i),this._linesIndexBuffer=this._engine.createIndexBuffer(x)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(i)setTimeout((()=>{this.start(0)}),i);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var x;-1!==(null===(x=this.Yx)||void 0===x?void 0:x.getClassName().indexOf("Mesh"))&&this.Yx.Re(!0);const i=this.noiseTexture;if(i&&i.onGeneratedObservable)i.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let x=0;x<this.preWarmCycles;x++)this.animate(!0),i.render()}))}));else for(let x=0;x<this.preWarmCycles;x++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(i))}_postStop(i){}reset(){this._stockParticles.length=0,this.eL.length=0}_appendParticleVertex(i,x,e,E){let a=i*this._vertexBufferSize;if(this._vertexData[a++]=x.position.x+this.Jg.x,this._vertexData[a++]=x.position.y+this.Jg.y,this._vertexData[a++]=x.position.z+this.Jg.z,this._vertexData[a++]=x.color.r,this._vertexData[a++]=x.color.g,this._vertexData[a++]=x.color.b,this._vertexData[a++]=x.color.a,this._vertexData[a++]=x.angle,this._vertexData[a++]=x.scale.x*x.size,this._vertexData[a++]=x.scale.y*x.size,this._isAnimationSheetEnabled&&(this._vertexData[a++]=x.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[a++]=x.direction.x,this._vertexData[a++]=x.direction.y,this._vertexData[a++]=x.direction.z);else if(x._initialDirection){let i=x._initialDirection;this.isLocal&&(j.KJ.TransformNormalToRef(i,this._emitterWorldMatrix,j.TmpVectors.KJ[0]),i=j.TmpVectors.KJ[0]),0===i.x&&0===i.z&&(i.x=.001),this._vertexData[a++]=i.x,this._vertexData[a++]=i.y,this._vertexData[a++]=i.z}else{let i=x.direction;this.isLocal&&(j.KJ.TransformNormalToRef(i,this._emitterWorldMatrix,j.TmpVectors.KJ[0]),i=j.TmpVectors.KJ[0]),0===i.x&&0===i.z&&(i.x=.001),this._vertexData[a++]=i.x,this._vertexData[a++]=i.y,this._vertexData[a++]=i.z}this._useRampGradients&&x.remapData&&(this._vertexData[a++]=x.remapData.x,this._vertexData[a++]=x.remapData.y,this._vertexData[a++]=x.remapData.z,this._vertexData[a++]=x.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===e?e=this._epsilon:1===e&&(e=1-this._epsilon),0===E?E=this._epsilon:1===E&&(E=1-this._epsilon)),this._vertexData[a++]=e,this._vertexData[a++]=E)}_prepareParticle(i){}_createNewOnes(i){let x;for(let e=0;e<i&&this.eL.length!==this._capacity;e++){x=this._createParticle(),this.eL.push(x);let i=this._createQueueStart;for(;i;)i.process(x,this),i=i.nextItem;x._inheritParticleInfoToSubEmitters()}}_update(i){if(this._alive=this.eL.length>0,this.Yx.position){const i=this.Yx;this._emitterWorldMatrix=i.getWorldMatrix()}else{const i=this.Yx;this._emitterWorldMatrix=j.Matrix.Translation(i.x,i.y,i.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.eL),this._createNewOnes(i)}static _GetAttributeNamesOrOptions(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=[S.f.PositionKind,S.f.ColorKind,"angle","offset","size"];return i&&j.push("cellIndex"),x||j.push("direction"),e&&j.push("remapData"),j}static _GetEffectCreationOptions(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,xi.b)(j),i&&j.push("particlesInfos"),x&&j.push("logarithmicDepthConstant"),e&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(i,x){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xi.i)(this,this._scene,i),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&i.push("#define FOG")),this._isAnimationSheetEnabled&&i.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&i.push("#define LOGARITHMICDEPTH"),x===u.BLENDMODE_MULTIPLY&&i.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&i.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(i.push("#define BILLBOARD"),this.billboardMode){case 2:i.push("#define BILLBOARDY");break;case 8:case 9:i.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&i.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:i.push("#define BILLBOARDMODE_ALL")}e&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),i.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(i,x,e){x.push(...Ri._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),i.push(...Ri._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),e.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ji.f)(i,this._imageProcessingConfigurationDefines),(0,ji.b)(e,this._imageProcessingConfigurationDefines))}_getWrapper(i){const x=this._getCustomDrawWrapper(i);if(null!==x&&void 0!==x&&x.effect)return x;const e=[];this.fillDefines(e,i);const j=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let E=this._drawWrappers[j];E||(E=this._drawWrappers[j]=[]);let a=E[i];a||(a=new ii.e(this._engine),a.drawContext&&(a.drawContext.useInstancing=this._useInstancing),E[i]=a);const Y=e.join("\n");if(a.defines!==Y){const i=[],x=[],e=[];this.fillUniformsAttributesAndSamplerNames(x,i,e),a.setEffect(this._engine.createEffect("particles",i,x,e,Y,void 0,void 0,void 0,void 0,this._shaderLanguage),Y)}return a}animate(){var i;let x,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!e&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:(null===(i=this._scene)||void 0===i?void 0:i.getAnimationRatio())||1),this.manualEmitCount>-1)x=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let i=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const x=this._actualFrame/this.targetStopDuration;q.GetCurrentGradient(x,this._emitRateGradients,((x,e,j)=>{x!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=e.getFactor(),this._currentEmitRateGradient=x),i=(0,b.Lerp)(this._currentEmitRate1,this._currentEmitRate2,j)}))}x=i*this._scaledUpdateSpeed|0,this._newPartsExcess+=i*this._scaledUpdateSpeed-x}if(this._newPartsExcess>1&&(x+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?x=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(x),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!e){let i=0;for(let x=0;x<this.eL.length;x++){const e=this.eL[x];this._appendParticleVertices(i,e),i+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.eL.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(i,x){this._appendParticleVertex(i++,x,0,0),this._useInstancing||(this._appendParticleVertex(i++,x,1,0),this._appendParticleVertex(i++,x,1,1),this._appendParticleVertex(i++,x,0,1))}rebuild(){var i;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(i=this._spriteBuffer)||void 0===i||i._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Ri.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(e.bind(e,13652)),Promise.resolve().then(e.bind(e,13604))])):await Promise.all([Promise.resolve().then(e.bind(e,13594)),Promise.resolve().then(e.bind(e,13581))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Yx||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==u.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(u.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(u.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(i){const x=this._getWrapper(i),e=x.effect,E=this._engine;E.enableEffect(x);const a=this.defaultViewMatrix??this._scene.getViewMatrix();if(e.setTexture("diffuseSampler",this.particleTexture),e.setMatrix("view",a),e.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const i=this.particleTexture.getBaseSize();e.setFloat3("particlesInfos",this.spriteCellWidth/i.width,this.spriteCellHeight/i.height,this.spriteCellWidth/i.width)}if(e.setVector2("translationPivot",this.translationPivot),e.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const i=this._scene.activeCamera;e.setVector3("eyePosition",i.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),e.setTexture("rampSampler",this._rampGradientsTexture));const Y=e.defines;var J,u,b,g,A,K;(this._scene&&((0,xi.d)(e,this,this._scene),this.applyFog&&(0,ei.d)(this._scene,void 0,e)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(a.invertToRef(j.TmpVectors.Matrix[0]),e.setMatrix("invView",j.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(J=this._scene)&&void 0!==J&&J.forceWireframe?E.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,e):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,e)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?E.bindBuffers(this._vertexBuffers,null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?this._linesIndexBuffer:this._indexBuffer,e):E.bindBuffers(this._vertexBuffers,null!==(g=this._scene)&&void 0!==g&&g.forceWireframe?this._linesIndexBufferUseInstancing:null,e);(this.useLogarithmicDepth&&this._scene&&(0,ei.j)(Y,e,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(e),this._setEngineBasedOnBlendMode(i),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(e),this._useInstancing)?null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?E.drawElementsType(6,0,10,this.eL.length):E.drawArraysType(7,0,4,this.eL.length):null!==(K=this._scene)&&void 0!==K&&K.forceWireframe?E.drawElementsType(1,0,10*this.eL.length):E.drawElementsType(0,0,6*this.eL.length);return this.eL.length}render(){if(!this.isReady()||!this.eL.length)return 0;const i=this._engine;i.setState&&(i.setState(!1),this.forceDepthWrite&&i.setDepthWrite(!0));let x=0;return x=this.blendMode===u.BLENDMODE_MULTIPLYADD?this._render(u.BLENDMODE_MULTIPLY)+this._render(u.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),x}_onDispose(){}dispose(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),i&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),i&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(x,e),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const i=this._scene.iL.indexOf(this);i>-1&&this._scene.iL.splice(i,1),this._scene._activeParticleSystems.dispose()}this.te.notifyObservers(this),this.te.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}Ri.ForceGLSL=!1;var yi,ri=e(12092);!function(i){i[i.ATTACHED=0]="ATTACHED",i[i.END=1]="END"}(yi||(yi={}));class ci{constructor(i){if(this.particleSystem=i,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!i.Yx||!i.Yx.dispose){const x=(0,J.e)("BABYLON.AbstractMesh");i.Yx=new x("SubemitterSystemEmitter",i.wi()),i._disposeEmitterOnDispose=!0}}clone(){let i=this.particleSystem.Yx;if(i){if(i instanceof j.KJ)i=i.clone();else if(-1!==i.getClassName().indexOf("Mesh")){i=new((0,J.e)("BABYLON.Mesh"))("",i.wi()),i.isVisible=!1}}else i=new j.KJ;const x=new ci(this.particleSystem.clone(this.particleSystem.name,i));return x.particleSystem.name+="Clone",x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem._disposeEmitterOnDispose=!0,x.particleSystem.disposeOnStop=!0,x}serialize(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return x.type=this.type,x.inheritDirection=this.inheritDirection,x.inheritedVelocityAmount=this.inheritedVelocityAmount,x.particleSystem=this.particleSystem.serialize(i),x}static _ParseParticleSystem(i,x,e){throw(0,ri.e)("ParseParticle")}static Parse(i,x,e){const j=i.particleSystem,E=new ci(ci._ParseParticleSystem(j,x,e,!0));return E.type=i.type,E.inheritDirection=i.inheritDirection,E.inheritedVelocityAmount=i.inheritedVelocityAmount,E.particleSystem._isSubEmitter=!0,E}dispose(){this.particleSystem.dispose()}}var Pi=e(12150);function qi(i,x){const e=new T;return e.direction1=i,e.direction2=x,e}function Wi(){return new z(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function Gi(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function vi(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.KJ(0,1,0),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0);return new t(i,x,e)}function si(){return new o(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function ix(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.KJ(0,1,0);return new M(i,x,e,E,a)}function xx(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new K(i,x)}function ex(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0),E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0);return new L(i,x,e,E)}const jx=j.KJ.Zero(),Ex=j.KJ.Zero(),ax=j.KJ.Zero();class Yx{constructor(){this.strength=0,this.position=j.KJ.Zero()}_processParticle(i,x){this.position.subtractToRef(i.position,jx);const e=jx.lengthSquared()+1;jx.normalize().scaleToRef(this.strength/e,Ex),Ex.scaleToRef(x._tempScaledUpdateSpeed,ax),i.direction.addInPlace(ax)}serialize(){return{position:this.position.de(),strength:this.strength}}}class Jx extends Ri{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=i=>{if(!this._subEmitters||0===this._subEmitters.length)return;const x=Math.floor(Math.random()*this._subEmitters.length);for(const e of this._subEmitters[x])if(1===e.type){const x=e.clone();i._inheritParticleInfoToSubEmitter(x),x.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(x.particleSystem),x.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(i,x){const e=qi(i,x);return this.particleEmitterType=e,e}get flowMap(){return this._flowMap}set flowMap(i){this._flowMap!==i&&(this._flowMap=i,this._flowMapUpdate&&(Fi(this._flowMapUpdate),this._flowMapUpdate=null),i&&(this._flowMapUpdate={process:i=>{var x;const e=null===(x=this.wi())||void 0===x?void 0:x.getTransformMatrix();this._flowMap._processParticle(i,this.flowMapStrength*this._tempScaledUpdateSpeed,e)},previousItem:null,nextItem:null},Di(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(i){this._attractors.push(i),1===this._attractors.length&&(this._attractorUpdate={process:i=>{for(const x of this._attractors)x._processParticle(i,this)},previousItem:null,nextItem:null},Di(this._attractorUpdate,this._directionProcessing))}removeAttractor(i){const x=this._attractors.indexOf(i);-1!==x&&this._attractors.splice(x,1),0===this._attractors.length&&Fi(this._attractorUpdate)}start(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(i)}createHemisphericEmitter(){const i=Wi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=i,i}createSphereEmitter(){const i=Gi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=i,i}createDirectedSphereEmitter(){const i=vi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.KJ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0));return this.particleEmitterType=i,i}createCylinderEmitter(){const i=si(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=i,i}createDirectedCylinderEmitter(){const i=ix(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.KJ(0,1,0));return this.particleEmitterType=i,i}createConeEmitter(){const i=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=i,i}createDirectedConeEmitter(){const i=ex(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0));return this.particleEmitterType=i,i}createBoxEmitter(i,x,e,j){const E=new A;return this.particleEmitterType=E,this.direction1=i,this.direction2=x,this.minEmitBox=e,this.maxEmitBox=j,E}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const i of this.subEmitters)i instanceof Jx?this._subEmitters.push([new ci(i)]):i instanceof ci?this._subEmitters.push([i]):i instanceof Array&&this._subEmitters.push(i)}_stopSubEmitters(){if(this.activeSubSystems){for(const i of this.activeSubSystems)i.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const i=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==i&&this._rootParticleSystem.activeSubSystems.splice(i,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(i){i&&this._stopSubEmitters()}_prepareParticle(i){if(this._subEmitters&&this._subEmitters.length>0){const x=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];i._attachedSubEmitters=[];for(const e of x)if(0===e.type){const x=e.clone();i._attachedSubEmitters.push(x),x.particleSystem.start()}}}_onDispose(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),i&&this.particles)for(const e of this.particles)if(e._attachedSubEmitters)for(let i=e._attachedSubEmitters.length-1;i>=0;i-=1)e._attachedSubEmitters[i].dispose();if(x&&this.activeSubSystems)for(let e=this.activeSubSystems.length-1;e>=0;e-=1)this.activeSubSystems[e].dispose();if(this._subEmitters&&this._subEmitters.length){for(let i=0;i<this._subEmitters.length;i++)for(const x of this._subEmitters[i])x.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Yx&&this.Yx.dispose&&this.Yx.dispose(!0)}static _Parse(i,x,e,E){let a;a=e instanceof Pi.c?null:e;const u=(0,J.e)("BABYLON.Texture");if(u&&a&&(i.texture?x.particleTexture=u.Parse(i.texture,a,E):i.textureName&&(x.particleTexture=new u(E+i.textureName,a,!1,void 0===i.invertY||i.invertY),x.particleTexture.name=i.textureName)),i.emitterId||0===i.emitterId||void 0!==i.Yx?i.emitterId&&a?x.Yx=a.getLastMeshById(i.emitterId):x.Yx=j.KJ.zJ(i.Yx):x.Yx=j.KJ.Zero(),x.isLocal=!!i.isLocal,void 0!==i.renderingGroupId&&(x.renderingGroupId=i.renderingGroupId),void 0!==i.isBillboardBased&&(x.isBillboardBased=i.isBillboardBased),void 0!==i.billboardMode&&(x.billboardMode=i.billboardMode),void 0!==i.useLogarithmicDepth&&(x.useLogarithmicDepth=i.useLogarithmicDepth),i.animations){for(let e=0;e<i.animations.length;e++){const j=i.animations[e],E=(0,J.e)("BABYLON.Animation");E&&x.animations.push(E.Parse(j))}x.beginAnimationOnStart=i.beginAnimationOnStart,x.beginAnimationFrom=i.beginAnimationFrom,x.beginAnimationTo=i.beginAnimationTo,x.beginAnimationLoop=i.beginAnimationLoop}if(i.autoAnimate&&a&&a.beginAnimation(x,i.autoAnimateFrom,i.autoAnimateTo,i.autoAnimateLoop,i.autoAnimateSpeed||1),x.startDelay=0|i.startDelay,x.minAngularSpeed=i.minAngularSpeed,x.maxAngularSpeed=i.maxAngularSpeed,x.minSize=i.minSize,x.maxSize=i.maxSize,i.minScaleX&&(x.minScaleX=i.minScaleX,x.maxScaleX=i.maxScaleX,x.minScaleY=i.minScaleY,x.maxScaleY=i.maxScaleY),void 0!==i.preWarmCycles&&(x.preWarmCycles=i.preWarmCycles,x.preWarmStepOffset=i.preWarmStepOffset),void 0!==i.minInitialRotation&&(x.minInitialRotation=i.minInitialRotation,x.maxInitialRotation=i.maxInitialRotation),x.minLifeTime=i.minLifeTime,x.maxLifeTime=i.maxLifeTime,x.minEmitPower=i.minEmitPower,x.maxEmitPower=i.maxEmitPower,x.emitRate=i.emitRate,x.gravity=j.KJ.zJ(i.gravity),i.noiseStrength&&(x.noiseStrength=j.KJ.zJ(i.noiseStrength)),x.color1=Y.lJ.zJ(i.color1),x.color2=Y.lJ.zJ(i.color2),x.colorDead=Y.lJ.zJ(i.colorDead),x.updateSpeed=i.updateSpeed,x.targetStopDuration=i.targetStopDuration,x.blendMode=i.blendMode,i.colorGradients)for(const j of i.colorGradients)x.addColorGradient(j.gradient,Y.lJ.zJ(j.color1),j.color2?Y.lJ.zJ(j.color2):void 0);if(i.rampGradients){for(const e of i.rampGradients)x.addRampGradient(e.gradient,Y.MJ.zJ(e.color));x.useRampGradients=i.useRampGradients}if(i.colorRemapGradients)for(const j of i.colorRemapGradients)x.addColorRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.alphaRemapGradients)for(const j of i.alphaRemapGradients)x.addAlphaRemapGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.sizeGradients)for(const j of i.sizeGradients)x.addSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.angularSpeedGradients)for(const j of i.angularSpeedGradients)x.addAngularSpeedGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.velocityGradients)for(const j of i.velocityGradients)x.addVelocityGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.dragGradients)for(const j of i.dragGradients)x.addDragGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.emitRateGradients)for(const j of i.emitRateGradients)x.addEmitRateGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.startSizeGradients)for(const j of i.startSizeGradients)x.addStartSizeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.lifeTimeGradients)for(const j of i.lifeTimeGradients)x.addLifeTimeGradient(j.gradient,void 0!==j.factor1?j.factor1:j.factor,j.factor2);if(i.limitVelocityGradients){for(const e of i.limitVelocityGradients)x.addLimitVelocityGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);x.limitVelocityDamping=i.limitVelocityDamping}if(i.noiseTexture&&a){const e=(0,J.e)("BABYLON.ProceduralTexture");x.noiseTexture=e.Parse(i.noiseTexture,a,E)}let b;if(i.particleEmitterType){switch(i.particleEmitterType.type){case"SphereParticleEmitter":b=new Q;break;case"SphereDirectedParticleEmitter":b=new t;break;case"ConeEmitter":case"ConeParticleEmitter":b=new K;break;case"ConeDirectedParticleEmitter":b=new L;break;case"CylinderParticleEmitter":b=new o;break;case"CylinderDirectedParticleEmitter":b=new M;break;case"HemisphericParticleEmitter":b=new z;break;case"PointParticleEmitter":b=new T;break;case"MeshParticleEmitter":b=new f;break;case"CustomParticleEmitter":b=new V;break;default:b=new A}b.parse(i.particleEmitterType,a)}else b=new A,b.parse(i,a);x.particleEmitterType=b,x.startSpriteCellID=i.startSpriteCellID,x.endSpriteCellID=i.endSpriteCellID,x.spriteCellLoop=i.spriteCellLoop??!0,x.spriteCellWidth=i.spriteCellWidth,x.spriteCellHeight=i.spriteCellHeight,x.spriteCellChangeSpeed=i.spriteCellChangeSpeed,x.spriteRandomStartCell=i.spriteRandomStartCell,x.disposeOnStop=i.disposeOnStop??!1,x.manualEmitCount=i.manualEmitCount??-1}static Parse(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;const J=i.name;let u,b,g=null,A=null;if(x instanceof Pi.c?u=x:(b=x,u=b.getEngine()),i.customShader&&u.createEffectForParticles){A=i.customShader;const x=A.shaderOptions.defines.length>0?A.shaderOptions.defines.join("\n"):"";g=u.createEffectForParticles(A.shaderPath.fragmentElement,A.shaderOptions.uniforms,A.shaderOptions.samplers,x)}const K=new Jx(J,a||i.Ue,x,g,i.isAnimationSheetEnabled);if(K.customShader=A,K._rootUrl=e,i.id&&(K.id=i.id),i.subEmitters){K.subEmitters=[];for(const j of i.subEmitters){const i=[];for(const E of j)i.push(ci.Parse(E,x,e));K.subEmitters.push(i)}}if(i.attractors)for(const Y of i.attractors){const i=new Yx;i.position=j.KJ.zJ(Y.position),i.strength=Y.strength,K.addAttractor(i)}return Jx._Parse(i,K,x,e),i.textureMask&&(K.textureMask=Y.lJ.zJ(i.textureMask)),i.Jg&&(K.Jg=j.KJ.zJ(i.Jg)),i.preventAutoStart&&(K.preventAutoStart=i.preventAutoStart),E||K.preventAutoStart||K.start(),K}serialize(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};if(Jx._Serialize(x,this,i),x.textureMask=this.textureMask.de(),x.customShader=this.customShader,x.preventAutoStart=this.preventAutoStart,x.Jg=this.Jg.de(),this.subEmitters){x.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const e of this._subEmitters){const j=[];for(const x of e)j.push(x.serialize(i));x.subEmitters.push(j)}}if(this._attractors&&this._attractors.length){x.attractors=[];for(const i of this._attractors)x.attractors.push(i.serialize())}return x}static _Serialize(i,x,e){if(i.name=x.name,i.id=x.id,i.Ue=x.getCapacity(),i.disposeOnStop=x.disposeOnStop,i.manualEmitCount=x.manualEmitCount,x.Yx.position){const e=x.Yx;i.emitterId=e.id}else{const e=x.Yx;i.Yx=e.de()}x.particleEmitterType&&(i.particleEmitterType=x.particleEmitterType.serialize()),x.particleTexture&&(e?i.texture=x.particleTexture.serialize():(i.textureName=x.particleTexture.name,i.invertY=!!x.particleTexture._invertY)),i.isLocal=x.isLocal,C.b.AppendSerializedAnimations(x,i),i.beginAnimationOnStart=x.beginAnimationOnStart,i.beginAnimationFrom=x.beginAnimationFrom,i.beginAnimationTo=x.beginAnimationTo,i.beginAnimationLoop=x.beginAnimationLoop,i.startDelay=x.startDelay,i.renderingGroupId=x.renderingGroupId,i.isBillboardBased=x.isBillboardBased,i.billboardMode=x.billboardMode,i.minAngularSpeed=x.minAngularSpeed,i.maxAngularSpeed=x.maxAngularSpeed,i.minSize=x.minSize,i.maxSize=x.maxSize,i.minScaleX=x.minScaleX,i.maxScaleX=x.maxScaleX,i.minScaleY=x.minScaleY,i.maxScaleY=x.maxScaleY,i.minEmitPower=x.minEmitPower,i.maxEmitPower=x.maxEmitPower,i.minLifeTime=x.minLifeTime,i.maxLifeTime=x.maxLifeTime,i.emitRate=x.emitRate,i.gravity=x.gravity.de(),i.noiseStrength=x.noiseStrength.de(),i.color1=x.color1.de(),i.color2=x.color2.de(),i.colorDead=x.colorDead.de(),i.updateSpeed=x.updateSpeed,i.targetStopDuration=x.targetStopDuration,i.blendMode=x.blendMode,i.preWarmCycles=x.preWarmCycles,i.preWarmStepOffset=x.preWarmStepOffset,i.minInitialRotation=x.minInitialRotation,i.maxInitialRotation=x.maxInitialRotation,i.startSpriteCellID=x.startSpriteCellID,i.spriteCellLoop=x.spriteCellLoop,i.endSpriteCellID=x.endSpriteCellID,i.spriteCellChangeSpeed=x.spriteCellChangeSpeed,i.spriteCellWidth=x.spriteCellWidth,i.spriteCellHeight=x.spriteCellHeight,i.spriteRandomStartCell=x.spriteRandomStartCell,i.isAnimationSheetEnabled=x.isAnimationSheetEnabled,i.useLogarithmicDepth=x.useLogarithmicDepth;const j=x.getColorGradients();if(j){i.colorGradients=[];for(const x of j){const e={gradient:x.gradient,color1:x.color1.de()};x.color2?e.color2=x.color2.de():e.color2=x.color1.de(),i.colorGradients.push(e)}}const E=x.getRampGradients();if(E){i.rampGradients=[];for(const x of E){const e={gradient:x.gradient,color:x.color.de()};i.rampGradients.push(e)}i.useRampGradients=x.useRampGradients}const a=x.getColorRemapGradients();if(a){i.colorRemapGradients=[];for(const x of a){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.colorRemapGradients.push(e)}}const Y=x.getAlphaRemapGradients();if(Y){i.alphaRemapGradients=[];for(const x of Y){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.alphaRemapGradients.push(e)}}const J=x.getSizeGradients();if(J){i.sizeGradients=[];for(const x of J){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.sizeGradients.push(e)}}const u=x.getAngularSpeedGradients();if(u){i.angularSpeedGradients=[];for(const x of u){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.angularSpeedGradients.push(e)}}const b=x.getVelocityGradients();if(b){i.velocityGradients=[];for(const x of b){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.velocityGradients.push(e)}}const g=x.getDragGradients();if(g){i.dragGradients=[];for(const x of g){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.dragGradients.push(e)}}const A=x.getEmitRateGradients();if(A){i.emitRateGradients=[];for(const x of A){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.emitRateGradients.push(e)}}const K=x.getStartSizeGradients();if(K){i.startSizeGradients=[];for(const x of K){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.startSizeGradients.push(e)}}const L=x.getLifeTimeGradients();if(L){i.lifeTimeGradients=[];for(const x of L){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.lifeTimeGradients.push(e)}}const o=x.getLimitVelocityGradients();if(o){i.limitVelocityGradients=[];for(const x of o){const e={gradient:x.gradient,factor1:x.factor1};void 0!==x.factor2?e.factor2=x.factor2:e.factor2=x.factor1,i.limitVelocityGradients.push(e)}i.limitVelocityDamping=x.limitVelocityDamping}x.noiseTexture&&(i.noiseTexture=x.noiseTexture.serialize())}clone(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let E=null;const a=this._engine;if(a.createEffectForParticles&&null!=this.customShader){E=this.customShader;const i=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"",x=a.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,i);j[0]?j[0].effect=x:this.setCustomEffect(x,0)}const Y=this.serialize(e),J=Jx.Parse(Y,this._scene||this._engine,this._rootUrl);return J.name=i,J.customShader=E,J._customWrappers=j,void 0===x&&(x=this.Yx),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.Yx=x,this.preventAutoStart||J.start(),J}}Jx.BILLBOARDMODE_Y=2,Jx.BILLBOARDMODE_ALL=7,Jx.BILLBOARDMODE_STRETCHED=8,Jx.BILLBOARDMODE_STRETCHED_LOCAL=9,ci._ParseParticleSystem=Jx.Parse;var ux=e(12454),bx=e(12452),gx=e(12363);gx.c.prototype.createTransformFeedback=function(){const i=this._gl.createTransformFeedback();if(!i)throw new Error("Unable to create Transform Feedback");return i},gx.c.prototype.deleteTransformFeedback=function(i){this._gl.deleteTransformFeedback(i)},gx.c.prototype.bindTransformFeedback=function(i){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,i)},gx.c.prototype.beginTransformFeedback=function(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(i?this._gl.POINTS:this._gl.TRIANGLES)},gx.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},gx.c.prototype.setTranformFeedbackVaryings=function(i,x){this._gl.transformFeedbackVaryings(i,x,this._gl.INTERLEAVED_ATTRIBS)},gx.c.prototype.bindTransformFeedbackBuffer=function(i){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,i?i.underlyingResource:null)},gx.c.prototype.readTransformFeedbackBuffer=function(i){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,i)};const Ax="clipPlaneFragmentDeclaration2",Kx="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";O.c.IncludesShadersStore[Ax]||(O.c.IncludesShadersStore[Ax]=Kx);e(13519),e(13522),e(13525),e(13527),e(13533),e(13536),e(13538),e(13541);const Lx="gpuRenderParticlesPixelShader",ox="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";O.c.ShadersStore[Lx]||(O.c.ShadersStore[Lx]=ox);const Mx="clipPlaneVertexDeclaration2",zx="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";O.c.IncludesShadersStore[Mx]||(O.c.IncludesShadersStore[Mx]=zx);e(13546),e(13548),e(13550),e(13555);const Tx="gpuRenderParticlesVertexShader",Qx="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";O.c.ShadersStore[Tx]||(O.c.ShadersStore[Tx]=Qx);class tx extends u{static get IsSupported(){if(!v.e.LastCreatedEngine)return!1;const i=v.e.LastCreatedEngine.getCaps();return i.supportTransformFeedbacks||i.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(i){this._maxActiveParticleCount=Math.min(i,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(i){this.maxActiveParticleCount=i}createPointEmitter(i,x){const e=qi(i,x);return this.particleEmitterType=e,e}createHemisphericEmitter(){const i=Wi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=i,i}createSphereEmitter(){const i=Gi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=i,i}createDirectedSphereEmitter(){const i=vi(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new j.KJ(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0));return this.particleEmitterType=i,i}createCylinderEmitter(){const i=si(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=i,i}createDirectedCylinderEmitter(){const i=ix(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new j.KJ(0,1,0));return this.particleEmitterType=i,i}createConeEmitter(){const i=xx(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=i,i}createDirectedConeEmitter(){const i=ex(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new j.KJ(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new j.KJ(0,1,0));return this.particleEmitterType=i,i}createBoxEmitter(i,x,e,j){const E=new A;return this.particleEmitterType=E,this.direction1=i,this.direction2=x,this.minEmitBox=e,this.maxEmitBox=j,E}get flowMap(){return this._flowMap}set flowMap(i){this._flowMap!==i&&(this._flowMap=i)}isReady(){if(!this.Yx||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Jx.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Jx.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Jx.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";i?setTimeout((()=>{this.start(0)}),i):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var i;let x=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(i=this._customWrappers[x])||void 0===i?void 0:i.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[i]??this._customWrappers[0]}setCustomEffect(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[x]=new ii.e(this._engine),this._customWrappers[x].effect=i}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new W.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(i,x,e){return super._removeGradientAndTexture(i,x,e),this._releaseBuffers(),this}addColorGradient(i,x){this._colorGradients||(this._colorGradients=[]);const e=new r(i,x);return this._colorGradients.push(e),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(i&&this._colorGradients.sort(((i,x)=>i.gradient<x.gradient?-1:i.gradient>x.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(i){return this._removeGradientAndTexture(i,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const x in this._drawWrappers){var i;null===(i=this._drawWrappers[x].drawContext)||void 0===i||i.reset()}}_addFactorGradient(i,x,e){const j=new P(x,e);i.push(j),this._releaseBuffers()}addSizeGradient(i,x){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,i,x),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(i){return this._removeGradientAndTexture(i,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(i,x){if(!i)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&i.sort(((i,x)=>i.gradient<x.gradient?-1:i.gradient>x.gradient?1:0));const e=this;e[x]&&(e[x].dispose(),e[x]=null)}addAngularSpeedGradient(i,x){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,i,x),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(i){return this._removeGradientAndTexture(i,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(i,x){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,i,x),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(i){return this._removeGradientAndTexture(i,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(i,x){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,i,x),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(i){return this._removeGradientAndTexture(i,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(i,x){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,i,x),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(i){return this._removeGradientAndTexture(i,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(i){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(i),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.te=new W.b,this.onStoppedObservable=new W.b,this.onStartedObservable=new W.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,e&&"Scene"!==e.getClassName()?(this._engine=e,this.defaultProjectionMatrix=j.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=e||v.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.iL.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,J.e)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.e)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,J.e)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,J.e)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new ii.e(this._engine)},this._customWrappers[0].effect=E,this._drawWrappers={0:new ii.e(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(x=x??{}).randomTextureSize||delete x.randomTextureSize;const Y={Ue:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...x},u=x;isFinite(u)&&(Y.Ue=u),this._capacity=Y.Ue,this._maxActiveParticleCount=Y.Ue,this._currentActiveCount=0,this._isAnimationSheetEnabled=a,this.particleEmitterType=new A;const b=Math.min(this._engine.getCaps().maxTextureSize,Y.randomTextureSize);let g=[];for(let j=0;j<b;++j)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture=new G.e(new Float32Array(g),b,1,5,e,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,g=[];for(let j=0;j<b;++j)g.push(Math.random()),g.push(Math.random()),g.push(Math.random()),g.push(Math.random());this._randomTexture2=new G.e(new Float32Array(g),b,1,5,e,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=b}_reset(){this._releaseBuffers()}_createVertexBuffers(i,x,e){const j={};j.position=x.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let E=3;j.age=x.createVertexBuffer("age",E,1,this._attributesStrideSize,!0),E+=1,j.size=x.createVertexBuffer("size",E,3,this._attributesStrideSize,!0),E+=3,j.life=x.createVertexBuffer("life",E,1,this._attributesStrideSize,!0),E+=1,E+=4,this.billboardMode===Jx.BILLBOARDMODE_STRETCHED&&(j.direction=x.createVertexBuffer("direction",E,3,this._attributesStrideSize,!0)),E+=3,this._platform.alignDataInBuffer&&(E+=1),this.particleEmitterType instanceof V&&(E+=3,this._platform.alignDataInBuffer&&(E+=1)),this._colorGradientsTexture||(j.color=x.createVertexBuffer("color",E,4,this._attributesStrideSize,!0),E+=4),this._isBillboardBased||(j.initialDirection=x.createVertexBuffer("initialDirection",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),this.noiseTexture&&(j.noiseCoordinates1=x.createVertexBuffer("noiseCoordinates1",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1),j.noiseCoordinates2=x.createVertexBuffer("noiseCoordinates2",E,3,this._attributesStrideSize,!0),E+=3,this._platform.alignDataInBuffer&&(E+=1)),j.angle=x.createVertexBuffer("angle",E,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?E++:E+=2,this._isAnimationSheetEnabled&&(j.cellIndex=x.createVertexBuffer("cellIndex",E,1,this._attributesStrideSize,!0),E+=1,this.spriteRandomStartCell&&(j.cellStartOffset=x.createVertexBuffer("cellStartOffset",E,1,this._attributesStrideSize,!0),E+=1)),j.offset=e.createVertexBuffer("offset",0,2),j.uv=e.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(j),this._platform.createVertexBuffers(i,j),this.resetDrawCache()}_initialize(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!i)return;const x=this._engine,e=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof V&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const E=this.particleEmitterType instanceof V,a=j.TmpVectors.KJ[0];let Y=0;for(let j=0;j<this._capacity;j++)if(e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),E?(this.particleEmitterType.particleDestinationGenerator(j,null,a),e.push(a.x),e.push(a.y),e.push(a.z)):(e.push(0),e.push(0),e.push(0)),this._platform.alignDataInBuffer&&e.push(0),Y+=16,E&&(this.particleEmitterType.particlePositionGenerator(j,null,a),e.push(a.x),e.push(a.y),e.push(a.z),this._platform.alignDataInBuffer&&e.push(0),Y+=4),this._colorGradientsTexture||(e.push(0),e.push(0),e.push(0),e.push(0),Y+=4),this.isBillboardBased||(e.push(0),e.push(0),e.push(0),this._platform.alignDataInBuffer&&e.push(0),Y+=4),this.noiseTexture&&(e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),this._platform.alignDataInBuffer&&e.push(0),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),this._platform.alignDataInBuffer&&e.push(0),Y+=8),e.push(0),Y+=1,this._angularSpeedGradientsTexture||(e.push(0),Y+=1),this._isAnimationSheetEnabled&&(e.push(0),Y+=1,this.spriteRandomStartCell&&(e.push(0),Y+=1)),this._platform.alignDataInBuffer){let i=3-(Y+3&3);for(Y+=i;i-- >0;)e.push(0)}const J=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),u=this._platform.createParticleBuffer(e),b=this._platform.createParticleBuffer(e);this._buffer0=new S.d(x,u,!1,this._attributesStrideSize),this._buffer1=new S.d(x,b,!1,this._attributesStrideSize),this._spriteBuffer=new S.d(x,J,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let i=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(i+="\n#define BILLBOARD"),this._colorGradientsTexture&&(i+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(i+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(i+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(i+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(i+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(i+="\n#define DRAGGRADIENTS"),this._flowMap&&(i+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(i+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(i+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(i+="\n#define NOISE"),this.isLocal&&(i+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===i||(this._cachedUpdateDefines=i,this._updateBuffer=this._platform.createUpdateBuffer(i)),this._platform.isUpdateBufferReady()}_getWrapper(i){const x=this._getCustomDrawWrapper(i);if(null!==x&&void 0!==x&&x.effect)return x;const e=[];this.fillDefines(e,i);let j=this._drawWrappers[i];j||(j=new ii.e(this._engine),j.drawContext&&(j.drawContext.useInstancing=!0),this._drawWrappers[i]=j);const E=e.join("\n");if(j.defines!==E){const i=[],x=[],e=[];this.fillUniformsAttributesAndSamplerNames(x,i,e),j.setEffect(this._engine.createEffect("gpuRenderParticles",i,x,e,E),E)}return j}static _GetAttributeNamesOrOptions(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const E=[S.f.PositionKind,"age","life","size","angle"];return i||E.push(S.f.ColorKind),x&&E.push("cellIndex"),e||E.push("initialDirection"),j&&E.push("direction"),E.push("offset",S.f.UVKind),E}static _GetEffectCreationOptions(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j=["emitterWM","Jg","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,xi.b)(j),i&&j.push("sheetInfos"),x&&j.push("logarithmicDepthConstant"),e&&(j.push("vFogInfos"),j.push("vFogColor")),j}fillDefines(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,xi.i)(this,this._scene,i),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==bx.d.FOGMODE_NONE&&i.push("#define FOG")),x===Jx.BLENDMODE_MULTIPLY&&i.push("#define BLENDMULTIPLYMODE"),this.isLocal&&i.push("#define LOCAL"),this.useLogarithmicDepth&&i.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(i.push("#define BILLBOARD"),this.billboardMode){case Jx.BILLBOARDMODE_Y:i.push("#define BILLBOARDY");break;case Jx.BILLBOARDMODE_STRETCHED:i.push("#define BILLBOARDSTRETCHED");break;case Jx.BILLBOARDMODE_ALL:i.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&i.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&i.push("#define ANIMATESHEET"),e&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),i.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(i,x,e){x.push(...tx._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Jx.BILLBOARDMODE_STRETCHED)),i.push(...tx._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),e.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(ux.c.PrepareUniforms(i,this._imageProcessingConfigurationDefines),ux.c.PrepareSamplers(e,this._imageProcessingConfigurationDefines))}animate(){var i;let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(x?this.preWarmStepOffset:(null===(i=this._scene)||void 0===i?void 0:i.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(i,x){const e=this[x];if(!i||!i.length||e)return;const j=new Float32Array(this._rawTextureWidth);for(let E=0;E<this._rawTextureWidth;E++){const x=E/this._rawTextureWidth;q.GetCurrentGradient(x,i,((i,x,e)=>{j[E]=(0,b.Lerp)(i.factor1,x.factor1,e)}))}this[x]=G.e.CreateRTexture(j,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[x].name=x.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const i=new Uint8Array(4*this._rawTextureWidth),x=Y.TmpColors.lJ[0];for(let e=0;e<this._rawTextureWidth;e++){const j=e/this._rawTextureWidth;q.GetCurrentGradient(j,this._colorGradients,((j,E,a)=>{Y.lJ.LerpToRef(j.color1,E.color1,a,x),i[4*e]=255*x.r,i[4*e+1]=255*x.g,i[4*e+2]=255*x.b,i[4*e+3]=255*x.a}))}this._colorGradientsTexture=G.e.CreateRGBATexture(i,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(i,x){var e,E,a,Y;const J=this._getWrapper(i),u=J.effect;this._engine.enableEffect(J);const b=(null===(e=this._scene)||void 0===e?void 0:e.getViewMatrix())||j.Matrix.IdentityReadOnly;if(u.setMatrix("view",b),u.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),u.setTexture("diffuseSampler",this.particleTexture),u.setVector2("translationPivot",this.translationPivot),u.setVector3("Jg",this.Jg),this.isLocal&&u.setMatrix("emitterWM",x),this._colorGradientsTexture?u.setTexture("colorGradientSampler",this._colorGradientsTexture):u.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const i=this.particleTexture.getBaseSize();u.setFloat3("sheetInfos",this.spriteCellWidth/i.width,this.spriteCellHeight/i.height,i.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const i=this._scene.activeCamera;u.setVector3("eyePosition",i.globalPosition)}const g=u.defines;if(this._scene&&((0,xi.d)(u,this,this._scene),this.applyFog&&(0,ei.d)(this._scene,void 0,u)),g.indexOf("#define BILLBOARDMODE_ALL")>=0){const i=b.clone();i.invert(),u.setMatrix("invView",i)}return this.useLogarithmicDepth&&this._scene&&(0,ei.j)(g,u,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(u),this._setEngineBasedOnBlendMode(i),this._platform.bindDrawBuffers(this._targetIndex,u,null!==(E=this._scene)&&void 0!==E&&E.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(u),null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(i){if(!this.Yx||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!i)if(this.Yx.position){i=this.Yx.getWorldMatrix()}else{const x=this.Yx;i=j.TmpVectors.Matrix[0],j.Matrix.TranslationToRef(x.x,x.y,x.z,i)}const x=this._engine,e=x.getDepthWrite();if(x.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const i=this.wi();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",i.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",i),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const E=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=E,x.setDepthWrite(e)}render(){let i,x=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!x&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let i=0;i<this.preWarmCycles;i++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const i=0|this._accumulatedCount;this._accumulatedCount-=i,this._currentActiveCount+=i}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Yx.position){i=this.Yx.getWorldMatrix()}else{const x=this.Yx;i=j.TmpVectors.Matrix[0],j.Matrix.TranslationToRef(x.x,x.y,x.z,i)}const E=this._engine;this.updateInAnimate||this._update(i);let a=0;return x||e||(E.setState(!1),this.forceDepthWrite&&E.setDepthWrite(!0),a=this.blendMode===Jx.BLENDMODE_MULTIPLYADD?this._render(Jx.BLENDMODE_MULTIPLY,i)+this._render(Jx.BLENDMODE_ADD,i):this._render(this.blendMode,i),this._engine.setAlphaMode(0)),a}rebuild(){const i=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(i,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,i()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const x in this._drawWrappers){this._drawWrappers[x].dispose()}if(this._drawWrappers={},this._scene){const i=this._scene.iL.indexOf(this);i>-1&&this._scene.iL.splice(i,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let x=0;x<this._renderVertexBuffers.length;++x){const i=this._renderVertexBuffers[x];for(const x in i)i[x].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),i&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),i&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.te.notifyObservers(this),this.te.clear()}clone(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const j={...this._customWrappers};let E=null;const a=this._engine;if(a.createEffectForParticles&&null!=this.customShader){E=this.customShader;const i=E.shaderOptions.defines.length>0?E.shaderOptions.defines.join("\n"):"";j[0]=a.createEffectForParticles(E.shaderPath.fragmentElement,E.shaderOptions.uniforms,E.shaderOptions.samplers,i,void 0,void 0,void 0,this)}const Y=this.serialize(e),J=tx.Parse(Y,this._scene||this._engine,this._rootUrl);return J.name=i,J.customShader=E,J._customWrappers=j,void 0===x&&(x=this.Yx),this.noiseTexture&&(J.noiseTexture=this.noiseTexture.clone()),J.Yx=x,J}serialize(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={};return Jx._Serialize(x,this,i),x.activeParticleCount=this.activeParticleCount,x.randomTextureSize=this._randomTextureSize,x.customShader=this.customShader,x}static Parse(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4?arguments[4]:void 0;const a=i.name;let Y,J;x instanceof Pi.c?Y=x:(J=x,Y=J.getEngine());const u=new tx(a,{Ue:E||i.Ue,randomTextureSize:i.randomTextureSize},x,null,i.isAnimationSheetEnabled);if(u._rootUrl=e,i.customShader&&Y.createEffectForParticles){const x=i.customShader,e=x.shaderOptions.defines.length>0?x.shaderOptions.defines.join("\n"):"",j=Y.createEffectForParticles(x.shaderPath.fragmentElement,x.shaderOptions.uniforms,x.shaderOptions.samplers,e,void 0,void 0,void 0,u);u.setCustomEffect(j,0),u.customShader=x}return i.id&&(u.id=i.id),i.activeParticleCount&&(u.activeParticleCount=i.activeParticleCount),Jx._Parse(i,u,x,e),i.preventAutoStart&&(u.preventAutoStart=i.preventAutoStart),j||u.preventAutoStart||u.start(),u}}var Vx=e(12061),Sx=e(13562),fx=e(12583);class wx{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(i){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const x of this.systems)x.Yx=i;this._emitterNode=i}setEmitterAsSphere(i,x,e){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:i,renderingGroupId:x};const j=(0,Sx.c)("emitterSphere",{diameter:i.diameter,segments:i.segments},e);j.renderingGroupId=x;const E=new fx.oJ("emitterSphereMaterial",e);E.emissiveColor=i.color,j.material=E;for(const a of this.systems)a.Yx=j;this._emitterNode=j}start(i){for(const x of this.systems)i&&(x.Yx=i),x.start()}dispose(){for(const i of this.systems)i.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const x={systems:[]};for(const e of this.systems)x.systems.push(e.serialize(i));return this._emitterNode&&(x.Yx=this._emitterCreationOptions),x}static Parse(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;const E=new wx,a=this.BaseAssetsUrl+"/textures/";x=x||v.e.LastCreatedScene;for(const Y of i.systems)E.systems.push(e?tx.Parse(Y,x,a,!0,j):Jx.Parse(Y,x,a,!0,j));if(i.Yx){const e=i.Yx.options;if("Sphere"===i.Yx.kind)E.setEmitterAsSphere({diameter:e.diameter,segments:e.segments,color:Y.MJ.zJ(e.color)},i.Yx.renderingGroupId,x)}return E}}wx.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ox=e(12101);class lx{static CreateDefault(i){let x,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,j=arguments.length>2?arguments[2]:void 0;x=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new tx("default system",{Ue:e},j):new Jx("default system",e,j),x.Yx=i;const E=Vx.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return x.particleTexture=new n.d(E,x.wi()),x.createConeEmitter(.1,Math.PI/4),x.color1=new Y.lJ(1,1,1,1),x.color2=new Y.lJ(1,1,1,1),x.colorDead=new Y.lJ(1,1,1,0),x.minSize=.1,x.maxSize=.1,x.minEmitPower=2,x.maxEmitPower=2,x.updateSpeed=1/60,x.emitRate=30,x}static CreateAsync(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0;x||(x=v.e.LastCreatedScene);const E={};return x.addPendingData(E),new Promise(((a,Y)=>{if(e&&!tx.IsSupported)return x.removePendingData(E),Y("Particle system with GPU is not supported.");Vx.Tools.LoadFile(`${lx.BaseAssetsUrl}/systems/${i}.json`,(i=>{x.removePendingData(E);const Y=JSON.parse(i.toString());return a(wx.Parse(Y,x,e,j))}),void 0,void 0,void 0,(()=>(x.removePendingData(E),Y(`An error occurred with the creation of your particle system. Check if your type '${i}' exists.`))))}))}static ExportSet(i){const x=new wx;for(const e of i)x.systems.push(e);return x}static ParseFromFileAsync(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3],E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=arguments.length>5?arguments[5]:void 0;return new Promise(((Y,J)=>{const u=new Ox.e;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const x=JSON.parse(u.responseText);let J;J=j?tx.Parse(x,e,E,!1,a):Jx.Parse(x,e,E,!1,a),i&&(J.name=i),Y(J)}else J("Unable to load the particle system")})),u.open("GET",x),u.send()}))}static ParseFromSnippetAsync(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",E=arguments.length>4?arguments[4]:void 0;if("_BLANK"===i){const i=this.CreateDefault(null);return i.start(),Promise.resolve(i)}return new Promise(((a,Y)=>{const J=new Ox.e;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const Y=JSON.parse(JSON.parse(J.responseText).jsonPayload),u=JSON.parse(Y.particleSystem);let b;b=e?tx.Parse(u,x,j,!1,E):Jx.Parse(u,x,j,!1,E),b.snippetId=i,a(b)}else Y("Unable to load the snippet "+i)})),J.open("GET",this.SnippetUrl+"/"+i.replace(/#/g,"/")),J.send()}))}}lx.BaseAssetsUrl=wx.BaseAssetsUrl,lx.SnippetUrl="https://snippet.babylonjs.com",lx.CreateFromSnippetAsync=lx.ParseFromSnippetAsync;var Zx=e(12675),Bx=e(12482),kx=e(13564);(0,kx.d)(Bx.c.NAME_PARTICLESYSTEM,((i,x,e,j)=>{const E=(0,kx.h)(Bx.c.NAME_PARTICLESYSTEM);if(E&&void 0!==i.iL&&null!==i.iL)for(let a=0,Y=i.iL.length;a<Y;a++){const Y=i.iL[a];e.iL.push(E(Y,x,j))}})),(0,kx.c)(Bx.c.NAME_PARTICLESYSTEM,((i,x,e)=>{if(i.activeParticleCount){return tx.Parse(i,x,e)}return Jx.Parse(i,x,e)})),Pi.c.prototype.createEffectForParticles=function(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,b=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,g=arguments.length>9?arguments[9]:void 0,A=[],K=[];const L=[];return u?u.fillUniformsAttributesAndSamplerNames(K,A,L):(A=Jx._GetAttributeNamesOrOptions(),K=Jx._GetEffectCreationOptions()),-1===E.indexOf(" BILLBOARD")&&(E+="\n#define BILLBOARD\n"),null!==u&&void 0!==u&&u.isAnimationSheetEnabled&&-1===E.indexOf(" ANIMATESHEET")&&(E+="\n#define ANIMATESHEET\n"),-1===j.indexOf("diffuseSampler")&&j.push("diffuseSampler"),this.createEffect({vertex:g??(null===u||void 0===u?void 0:u.vertexShaderName)??"particles",fragmentElement:i},A,K.concat(x),L.concat(j),E,a,Y,J,void 0,b,(async()=>{0===b?await Promise.resolve().then(e.bind(e,13594)):await Promise.resolve().then(e.bind(e,13652))}))},Zx.c.prototype.getEmittedParticleSystems=function(){const i=[];for(let x=0;x<this.wi().iL.length;x++){const e=this.wi().iL[x];e.Yx===this&&i.push(e)}return i},Zx.c.prototype.getHierarchyEmittedParticleSystems=function(){const i=[],x=this.getDescendants();x.push(this);for(let e=0;e<this.wi().iL.length;e++){const j=this.wi().iL[e],E=j.Yx;E.position&&-1!==x.indexOf(E)&&i.push(j)}return i};e(12551),e(12565),e(12648);e(12657),e(13567),e(12423),e(12543),e(12698);e(12421);var Nx;e(13571),e(12272);!function(i){i[i.Color=2]="Color",i[i.UV=1]="UV",i[i.Random=0]="Random",i[i.Stated=3]="Stated"}(Nx||(Nx={}));var me=e(12442);const Xx=new j.KJ(0,0,0),Cx=new j.KJ(0,0,0),nx=new j.KJ(0,0,0);class Ix{constructor(i,x,e){this.width=i,this.height=x,this.data=e}processFlowable(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;if(!e)return;e instanceof j.Matrix?j.KJ.TransformCoordinatesToRef(i.position,e,nx):(nx.x=e.x,nx.y=e.y,nx.z=e.z);const E=.5*nx.x+.5,a=1-(.5*nx.y+.5),Y=Math.floor(E*this.width),J=Math.floor(a*this.height);if(Y<0||Y>=this.width||J<0||J>=this.height)return;const u=4*(J*this.width+Y),b=this.data[u]/255*2-1,g=this.data[u+1]/255*2-1,A=this.data[u+2]/255*2-1,K=this.data[u+3]/255;Xx.set(b,g,A),Xx.scaleToRef(x*K,Cx),i.direction.addInPlace(Cx)}_processParticle(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;this.processFlowable(i,x,e)}static async FromUrlAsync(i){return await new Promise(((x,e)=>{const j=document.createElement("canvas"),E=j.getContext("2d");let a=null;const Y=new Image;Y.crossOrigin="anonymous",Y.src=i,Y.onerror=x=>{e(new Error(`Failed to load image: ${i} : ${x}`))},Y.onload=()=>{j.width=Y.width,j.height=Y.height,E.drawImage(Y,0,0),a=E.getImageData(0,0,j.width,j.height),x(new Ix(j.width,j.height,a.data))}}))}static async ExtractFromTextureAsync(i){return await new Promise(((x,e)=>{if(!i.isReady())return void i.onLoadObservable.addOnce((async()=>{try{const e=await this.ExtractFromTextureAsync(i);x(e)}catch(j){e(j)}}));const j=i.getSize();me.i.GetTextureDataAsync(i,j.width,j.height).then((i=>{x(new Ix(j.width,j.height,new Uint8ClampedArray(i)))})).catch(e)}))}}var dx,px,Hx,Ux,Dx,hx,Fx,Rx,yx;!function(i){i[i.Int=1]="Int",i[i.Float=2]="Float",i[i.Vector2=4]="Vector2",i[i.KJ=8]="KJ",i[i.Matrix=16]="Matrix",i[i.Particle=32]="Particle",i[i.Texture=64]="Texture",i[i.lJ=128]="lJ",i[i.FloatGradient=256]="FloatGradient",i[i.Vector2Gradient=512]="Vector2Gradient",i[i.Vector3Gradient=1024]="Vector3Gradient",i[i.Color4Gradient=2048]="Color4Gradient",i[i.System=4096]="System",i[i.AutoDetect=8192]="AutoDetect",i[i.BasedOnInput=16384]="BasedOnInput",i[i.Undefined=32768]="Undefined",i[i.All=65535]="All"}(dx||(dx={})),function(i){i[i.Compatible=0]="Compatible",i[i.TypeIncompatible=1]="TypeIncompatible",i[i.HierarchyIssue=2]="HierarchyIssue"}(px||(px={})),function(i){i[i.Input=0]="Input",i[i.Output=1]="Output"}(Hx||(Hx={}));class rx{get direction(){return this._direction}get type(){if(this._type===dx.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===dx.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(i){this._type=i}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((i=>i.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(i,x,e){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=dx.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new W.b,this.onDisconnectionObservable=new W.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=x,this.name=i,this._direction=e}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(i){var x;return this.isConnected?null!==(x=this._connectedPoint)&&void 0!==x&&x._storedFunction?this._connectedPoint._storedFunction(i):this._connectedPoint._storedValue:this.value}canConnectTo(i){return 0===this.checkCompatibilityState(i)}checkCompatibilityState(i){const x=this._ownerBlock,e=i.ownerBlock;if(this.type!==i.type&&i.innerType!==dx.AutoDetect)return i.acceptedConnectionPointTypes&&-1!==i.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(i.excludedConnectionPointTypes&&-1!==i.excludedConnectionPointTypes.indexOf(this.type))return 1;let j=e,E=x;return 0===this.direction&&(j=x,E=e),j.isAnAncestorOf(E)?2:0}connectTo(i){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(i))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${i.ownerBlock.name}".${i.name}`;return this._endpoints.push(i),i._connectedPoint=this,this.onConnectionObservable.notifyObservers(i),i.onConnectionObservable.notifyObservers(this),this}disconnectFrom(i){const x=this._endpoints.indexOf(i);return-1===x||(this._endpoints.splice(x,1),i._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(i),i.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(i){let x=1;for(;x<dx.All;)i&x||this.excludedConnectionPointTypes.push(x),x<<=1}serialize(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const x={};return x.name=this.name,x.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.de?(x.valueType="BABYLON."+this.value.getClassName(),x.value=this.value.de()):(x.valueType="number",x.value=this.value)),i&&this.connectedPoint&&(x.inputName=this.name,x.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,x.targetConnectionName=this.connectedPoint.name,x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(x.isExposedOnFrame=!0,x.exposedPortPosition=this.exposedPortPosition),x}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class cx{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(i){this._name=i}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(i){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new W.b,this.te=new W.b,this.onInputChangedObservable=new W.b,this.visibleOnFrame=!1,this._name=i,this.uniqueId=I.c.UniqueId}_inputRename(i){return i}_outputRename(i){return i}isAnAncestorOf(i){for(const x of this._outputs)if(x.hasEndpoints)for(const e of x.endpoints){if(e.ownerBlock===i)return!0;if(e.ownerBlock.isAnAncestorOf(i))return!0}return!1}isAnAncestorOfType(i){if(this.getClassName()===i)return!0;for(const x of this._outputs)if(x.hasEndpoints)for(const e of x.endpoints)if(e.ownerBlock.isAnAncestorOfType(i))return!0;return!1}getInputByName(i){const x=this._inputs.filter((x=>x.name===i));return x.length?x[0]:null}_linkConnectionTypes(i,x){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[x]._acceptedConnectionPointType=this._inputs[i]:(this._inputs[i]._linkedConnectionSource=this._inputs[x],this._inputs[i]._isMainLinkSource=!0),this._inputs[x]._linkedConnectionSource=this._inputs[i]}registerInput(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3?arguments[3]:void 0,E=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0;const Y=new rx(i,this,0);return Y.type=x,Y.isOptional=e,Y.defaultValue=j,Y.value=j,Y.valueMin=E,Y.valueMax=a,this._inputs.push(Y),this.onInputChangedObservable.notifyObservers(Y),this}registerOutput(i,x,e){return(e=e??new rx(i,this,1)).type=x,this._outputs.push(e),this}_build(i){}_customBuildStep(i){}build(i){if(this._buildId===i.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((i=>i.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=i.buildId;for(const x of this._inputs){if(!x.connectedPoint){x.isOptional||i.notConnectedNonOptionalInputs.push(x);continue}const e=x.connectedPoint.ownerBlock;e&&e!==this&&!e.isSystem&&e.build(i)}return this._customBuildStep(i),i.verbose&&d.c.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(i),this.onBuildObservable.notifyObservers(this),!1}serialize(){const i={};i.customType="BABYLON."+this.getClassName(),i.id=this.uniqueId,i.name=this.name,i.visibleOnFrame=this.visibleOnFrame,i.inputs=[],i.outputs=[];for(const x of this.inputs)i.inputs.push(x.serialize());for(const x of this.outputs)i.outputs.push(x.serialize(!1));return i}_deserialize(i){this._name=i.name,this.comments=i.comments,this.visibleOnFrame=!!i.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(i)}_deserializePortDisplayNamesAndExposedOnFrame(i){const x=i.inputs,e=i.outputs;if(x)for(const j of x){const i=this.inputs.find((i=>i.name===j.name));if(!i)return;if(j.displayName&&(i.displayName=j.displayName),j.isExposedOnFrame&&(i.isExposedOnFrame=j.isExposedOnFrame,i.exposedPortPosition=j.exposedPortPosition),void 0!==j.value&&null!==j.value)if("number"===j.valueType)i.value=j.value;else{const x=(0,J.e)(j.valueType);x&&(i.value=x.zJ(j.value))}}if(e)for(let j=0;j<e.length;j++){const i=e[j];i.displayName&&(this.outputs[j].displayName=i.displayName),i.isExposedOnFrame&&(this.outputs[j].isExposedOnFrame=i.isExposedOnFrame,this.outputs[j].exposedPortPosition=i.exposedPortPosition)}}clone(){const i=this.serialize(),x=(0,J.e)(i.customType);if(x){const e=new x;return e._deserialize(i),e}return null}dispose(){this.te.notifyObservers(this),this.te.clear();for(const i of this.inputs)i.dispose();for(const i of this.outputs)i.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Px(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",j=arguments.length>3?arguments[3]:void 0;return(E,a)=>{let Y=E._propStore;Y||(Y=[],E._propStore=Y),Y.push({propertyName:a,displayName:i,type:x,groupName:e,options:j??{},className:E.getClassName()})}}(0,mi.e)([(0,X.O)("comment")],cx.prototype,"comments",void 0),function(i){i[i.Boolean=0]="Boolean",i[i.Float=1]="Float",i[i.Int=2]="Int",i[i.Vector2=3]="Vector2",i[i.List=4]="List",i[i.lJ=5]="lJ",i[i.SamplingMode=6]="SamplingMode",i[i.TextureFormat=7]="TextureFormat",i[i.TextureType=8]="TextureType"}(Ux||(Ux={})),function(i){i[i.None=0]="None",i[i.Position=1]="Position",i[i.Direction=2]="Direction",i[i.Age=3]="Age",i[i.Lifetime=4]="Lifetime",i[i.Color=5]="Color",i[i.ScaledDirection=6]="ScaledDirection",i[i.Scale=7]="Scale",i[i.AgeGradient=8]="AgeGradient",i[i.Angle=9]="Angle",i[i.SpriteCellIndex=16]="SpriteCellIndex",i[i.SpriteCellStart=17]="SpriteCellStart",i[i.SpriteCellEnd=18]="SpriteCellEnd"}(Dx||(Dx={})),function(i){i[i.None=0]="None",i[i.Time=1]="Time",i[i.Delta=2]="Delta",i[i.Emitter=3]="Emitter"}(hx||(hx={}));class qx{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let i="";for(const x of this.notConnectedNonOptionalInputs)i+=`input ${x.name} from block ${x.ownerBlock.name}[${x.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(i)throw"Build of Node Particle System Set failed:\n"+i}adapt(i,x){const e=i.getConnectedValue(this)||0;if(i.type===x)return e;switch(x){case dx.Vector2:return new j.Vector2(e,e);case dx.KJ:return new j.KJ(e,e,e);case dx.lJ:return new Y.lJ(e,e,e,e)}return null}getContextualValue(i){if(!this.particleContext||!this.systemContext)return null;switch(i){case Dx.Position:return this.particleContext.position;case Dx.Direction:return this.particleContext.direction;case Dx.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case Dx.Color:return this.particleContext.color;case Dx.Age:return this.particleContext.age;case Dx.Lifetime:return this.particleContext.lifeTime;case Dx.Angle:return this.particleContext.angle;case Dx.Scale:return this.particleContext.scale;case Dx.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case Dx.SpriteCellEnd:return this.systemContext.endSpriteCellID;case Dx.SpriteCellIndex:return this.particleContext.cellIndex;case Dx.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Yx.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Yx.absolutePosition:this.systemContext.Yx:null}getSystemValue(i){if(!this.particleContext||!this.systemContext)return null;switch(i){case hx.Time:return this.systemContext._actualFrame;case hx.Delta:return this.systemContext._scaledUpdateSpeed;case hx.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Yx.absolutePosition}return this.systemContext.Yx}return null}}function Wx(i,x,e){const j=new qx;j.LJ=x;const E=i.createSystem(j);return E.canStart=()=>!0,E.Yx=e.clone(),E.disposeOnStop=!0,E.start(),E}class Gx extends cx{constructor(i){super(i),this.blendMode=u.BLENDMODE_ONEONE,this.Ue=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",dx.Particle),this.registerInput("texture",dx.Texture),this.registerInput("onStart",dx.System,!0),this.registerInput("onEnd",dx.System,!0),this.registerOutput("system",dx.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(i){i.Ue=this.Ue,i.buildId=this._buildId++,this.build(i);const x=this.particle.getConnectedValue(i);return x.particleTexture=this.texture.getConnectedValue(i),x.emitRate=this.emitRate,x.blendMode=this.blendMode,x.name=this.name,x._nodeGenerated=!0,x._targetStopDuration=this.targetStopDuration,x.startDelay=this.startDelay,this.system._storedValue=this,x.canStart=()=>!this.doNoStart,x.onStartedObservable.add((e=>{const j=this.onStart.getConnectedValue(i);j&&e.onStartedObservable.addOnce((()=>{i.systemContext=x;const e=Wx(j,i.LJ,i.emitterPosition);this.te.addOnce((()=>{e.dispose()}))}));const E=this.onEnd.getConnectedValue(i);E&&e.onStoppedObservable.addOnce((()=>{i.systemContext=x;const e=Wx(E,i.LJ,i.emitterPosition);this.te.addOnce((()=>{e.dispose()}))}))})),this.te.addOnce((()=>{x.dispose()})),x}serialize(){const i=super.serialize();return i.Ue=this.Ue,i.emitRate=this.emitRate,i.blendMode=this.blendMode,i.doNoStart=this.doNoStart,i.targetStopDuration=this.targetStopDuration,i.startDelay=this.startDelay,i}_deserialize(i){super._deserialize(i),this.Ue=i.Ue,this.emitRate=i.emitRate,this.doNoStart=!!i.doNoStart,void 0!==i.blendMode&&(this.blendMode=i.blendMode),void 0!==i.targetStopDuration&&(this.targetStopDuration=i.targetStopDuration),void 0!==i.startDelay&&(this.startDelay=i.startDelay)}}(0,mi.e)([Px("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:u.BLENDMODE_ONEONE},{label:"Standard",value:u.BLENDMODE_STANDARD},{label:"Add",value:u.BLENDMODE_ADD},{label:"Multiply",value:u.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:u.BLENDMODE_MULTIPLYADD}]})],Gx.prototype,"blendMode",void 0),(0,mi.e)([Px("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],Gx.prototype,"Ue",void 0),(0,mi.e)([Px("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gx.prototype,"emitRate",void 0),(0,mi.e)([Px("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gx.prototype,"targetStopDuration",void 0),(0,mi.e)([Px("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Gx.prototype,"startDelay",void 0),(0,mi.e)([Px("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],Gx.prototype,"doNoStart",void 0),(0,J.f)("BABYLON.SystemBlock",Gx);class vx extends cx{get type(){if(this._type===dx.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=dx.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=dx.Vector2,this._type;case"KJ":return this._type=dx.KJ,this._type;case"lJ":return this._type=dx.lJ,this._type;case"Matrix":return this._type=dx.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===Dx.None&&this._systemSource!==hx.None}get systemSource(){return this._systemSource}set systemSource(i){if(this._systemSource=i,i!==hx.None){switch(this._contextualSource=Dx.None,this._type=dx.Float,i){case hx.Time:case hx.Delta:this._type=dx.Float;break;case hx.Emitter:this._type=dx.KJ}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==Dx.None}get contextualValue(){return this._contextualSource}set contextualValue(i){if(this._contextualSource=i,i!==Dx.None){switch(this._systemSource=hx.None,i){case Dx.Scale:this._type=dx.Vector2;break;case Dx.Position:case Dx.Direction:case Dx.ScaledDirection:this._type=dx.KJ;break;case Dx.Color:this._type=dx.lJ;break;case Dx.Age:case Dx.Lifetime:case Dx.Angle:case Dx.AgeGradient:this._type=dx.Float;break;case Dx.SpriteCellEnd:case Dx.SpriteCellStart:case Dx.SpriteCellIndex:this._type=dx.Int}this.output&&(this.output.type=this._type)}}constructor(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dx.AutoDetect;super(i),this._type=dx.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new W.b,this._systemSource=hx.None,this._contextualSource=Dx.None,this._type=x,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",x)}get value(){return this._storedValue}set value(i){this.type===dx.Float&&this.min!==this.max&&(i=Math.max(this.min,i),i=Math.min(this.max,i)),this._storedValue=i,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(i){this._valueCallback=i}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case dx.Int:case dx.Float:this.value=0;break;case dx.Vector2:this.value=j.Vector2.Zero();break;case dx.KJ:this.value=j.KJ.Zero();break;case dx.lJ:this.value=new Y.lJ(1,1,1,1);break;case dx.Matrix:this.value=j.Matrix.Identity()}}_build(i){super._build(i),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=i=>i.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=i=>i.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const i=super.serialize();return i.type=this.type,i.contextualValue=this.contextualValue,i.systemSource=this.systemSource,i.min=this.min,i.max=this.max,i.groupInInspector=this.groupInInspector,i.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.de?(i.valueType="BABYLON."+this._storedValue.getClassName(),i.value=this._storedValue.de()):(i.valueType="number",i.value=this._storedValue)),i}_deserialize(i){if(super._deserialize(i),this._type=i.type,this.contextualValue=i.contextualValue,this.systemSource=i.systemSource||hx.None,this.min=i.min||0,this.max=i.max||0,this.groupInInspector=i.groupInInspector||"",void 0!==i.displayInInspector&&(this.displayInInspector=i.displayInInspector),i.valueType)if("number"===i.valueType)this._storedValue=i.value;else{const x=(0,J.e)(i.valueType);x&&(this._storedValue=x.zJ(i.value))}}}(0,J.f)("BABYLON.ParticleInputBlock",vx);class sx extends cx{get url(){return this._url}set url(i){this._url!==i&&(this._cachedData=null,this._url=i,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(i){this._textureDataUrl!==i&&(this._cachedData=null,this._textureDataUrl=i,this._url="",this._sourceTexture=null)}set sourceTexture(i){this._sourceTexture!==i&&(this._cachedData=null,this._sourceTexture=i,this._url="",this._textureDataUrl="")}constructor(i){super(i),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",dx.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const i=this.texture._storedValue;return await new Promise(((x,e)=>{if(!i.isReady())return void i.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),x(this._cachedData)}catch(i){e(i)}}));const j=i.getSize();me.i.GetTextureDataAsync(i,j.width,j.height).then((e=>{this._cachedData={width:j.width,height:j.height,data:new Uint8ClampedArray(e)},i.dispose(),x(this._cachedData)})).catch(e)}))}_build(i){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new n.d(this._textureDataUrl,i.LJ):this.texture._storedValue=new n.d(this._url,i.LJ):this.texture._storedValue=null}serialize(){const i=super.serialize();return i.url=this.url,i.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(i.textureDataUrl=this.textureDataUrl),i}_deserialize(i){super._deserialize(i),this.url=i.url,this.serializedCachedData=!!i.serializedCachedData,i.textureDataUrl&&(this.textureDataUrl=i.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,J.f)("BABYLON.ParticleTextureSourceBlock",sx);class ie extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("position",dx.KJ),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(i){const x=this.particle.getConnectedValue(i);if(this.output._storedValue=x,!this.position.isConnected)return;const e={process:e=>{i.particleContext=e,i.systemContext=x,e.position.A(this.position.getConnectedValue(i))},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e}}(0,J.f)("BABYLON.UpdatePositionBlock",ie),function(i){i[i.Add=0]="Add",i[i.Subtract=1]="Subtract",i[i.Multiply=2]="Multiply",i[i.Divide=3]="Divide",i[i.Max=4]="Max",i[i.Min=5]="Min"}(Fx||(Fx={}));class xe extends cx{constructor(i){super(i),this.operation=Fx.Add,this.registerInput("left",dx.AutoDetect),this.registerInput("right",dx.AutoDetect),this.registerOutput("output",dx.BasedOnInput),this.output._typeConnectionSource=this.left;const x=[dx.Matrix,dx.Particle,dx.Texture,dx.System,dx.FloatGradient,dx.Color4Gradient,dx.Vector2Gradient,dx.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...x),this.right.excludedConnectionPointTypes.push(...x),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(i){let x;const e=this.left,E=this.right;if(!e.isConnected||!E.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const a=e.type===dx.Float||e.type===dx.Int,J=E.type===dx.Float||E.type===dx.Int,u=a&&J;switch(this.operation){case Fx.Add:x=u?i=>e.getConnectedValue(i)+E.getConnectedValue(i):a?i=>i.adapt(e,E.type).add(E.getConnectedValue(i)):i=>e.getConnectedValue(i).add(i.adapt(E,e.type));break;case Fx.Subtract:x=u?i=>e.getConnectedValue(i)-E.getConnectedValue(i):a?i=>i.adapt(e,E.type).Cx(E.getConnectedValue(i)):i=>e.getConnectedValue(i).Cx(i.adapt(E,e.type));break;case Fx.Multiply:x=u?i=>e.getConnectedValue(i)*E.getConnectedValue(i):a?i=>i.adapt(e,E.type).multiply(E.getConnectedValue(i)):i=>e.getConnectedValue(i).multiply(i.adapt(E,e.type));break;case Fx.Divide:x=u?i=>e.getConnectedValue(i)/E.getConnectedValue(i):a?i=>i.adapt(e,E.type).divide(E.getConnectedValue(i)):i=>e.getConnectedValue(i).divide(i.adapt(E,e.type));break;case Fx.Min:if(u)x=i=>Math.min(e.getConnectedValue(i),E.getConnectedValue(i));else{const[i,J]=a?[E,e]:[e,E];switch(i.type){case dx.Vector2:x=x=>j.Vector2.Minimize(i.getConnectedValue(x),x.adapt(J,i.type));break;case dx.KJ:x=x=>j.KJ.Minimize(i.getConnectedValue(x),x.adapt(J,i.type));break;case dx.lJ:x=x=>{const e=i.getConnectedValue(x),{r:j,g:E,b:a,a:u}=x.adapt(J,i.type);return new Y.lJ(Math.min(e.r,j),Math.min(e.g,E),Math.min(e.b,a),Math.min(e.a,u))}}}break;case Fx.Max:if(!u){const[i,J]=a?[E,e]:[e,E];switch(i.type){case dx.Vector2:x=x=>j.Vector2.Maximize(i.getConnectedValue(x),x.adapt(J,i.type));break;case dx.KJ:x=x=>j.KJ.Maximize(i.getConnectedValue(x),x.adapt(J,i.type));break;case dx.lJ:x=x=>{const e=i.getConnectedValue(x),{r:j,g:E,b:a,a:u}=x.adapt(J,i.type);return new Y.lJ(Math.max(e.r,j),Math.min(e.g,E),Math.min(e.b,a),Math.min(e.a,u))}}break}x=i=>Math.max(e.getConnectedValue(i),E.getConnectedValue(i))}this.output._storedFunction=i=>e.type===dx.Int?0|x(i):x(i)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===dx.Int||this.left.type===dx.Float&&this.right.type!==dx.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[i,x]of[[this.left,this.right],[this.right,this.left]])i.acceptedConnectionPointTypes=[dx.Int,dx.Float],x.isConnected&&(i.acceptedConnectionPointTypes.push(x.type),x.type!==dx.Int&&x.type!==dx.Float||i.acceptedConnectionPointTypes.push(dx.Vector2,dx.KJ,dx.lJ))}dispose(){super.dispose();for(const i of this._connectionObservers)i.remove();this._connectionObservers.length=0}serialize(){const i=super.serialize();return i.operation=this.operation,i}_deserialize(i){super._deserialize(i),this.operation=i.operation}}(0,mi.e)([Px("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Fx.Add},{label:"Subtract",value:Fx.Subtract},{label:"Multiply",value:Fx.Multiply},{label:"Divide",value:Fx.Divide},{label:"Max",value:Fx.Max},{label:"Min",value:Fx.Min}]})],xe.prototype,"operation",void 0),(0,J.f)("BABYLON.ParticleMathBlock",xe);class ee extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("direction1",dx.KJ,!0,new j.KJ(0,1,0)),this.registerInput("direction2",dx.KJ,!0,new j.KJ(0,1,0)),this.registerInput("minEmitBox",dx.KJ,!0,new j.KJ(-.5,-.5,-.5)),this.registerInput("maxEmitBox",dx.KJ,!0,new j.KJ(.5,.5,.5)),this.registerOutput("output",dx.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(i){const x=this.particle.getConnectedValue(i);x._directionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.direction1.getConnectedValue(i),a=this.direction2.getConnectedValue(i),Y=(0,b.RandomRange)(E.x,a.x),J=(0,b.RandomRange)(E.y,a.y),u=(0,b.RandomRange)(E.z,a.z);i.isEmitterTransformNode?j.KJ.TransformNormalFromFloatsToRef(Y,J,u,i.emitterWorldMatrix,e.direction):e.direction.fJ(Y,J,u)},x._positionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.minEmitBox.getConnectedValue(i),a=this.maxEmitBox.getConnectedValue(i),Y=(0,b.RandomRange)(E.x,a.x),J=(0,b.RandomRange)(E.y,a.y),u=(0,b.RandomRange)(E.z,a.z);i.isEmitterTransformNode?j.KJ.TransformCoordinatesFromFloatsToRef(Y,J,u,i.emitterWorldMatrix,e.position):(e.position.fJ(Y,J,u),e.position.addInPlace(i.emitterPosition))},this.output._storedValue=x}}(0,J.f)("BABYLON.BoxShapeBlock",ee);class je extends cx{constructor(i){super(i),this.registerInput("emitPower",dx.Float,!0,1),this.registerInput("lifeTime",dx.Float,!0,1),this.registerInput("color",dx.lJ,!0,new Y.lJ(1,1,1,1)),this.registerInput("scale",dx.Vector2,!0,new j.Vector2(1,1)),this.registerInput("angle",dx.Float,!0,0),this.registerOutput("particle",dx.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(i){const x=new Jx(this.name,i.Ue,i.LJ,null,!1,void 0,!0);x.particleEmitterType=new T,x._lifeTimeCreation.process=(x,e)=>{i.particleContext=x,x.lifeTime=this.lifeTime.getConnectedValue(i),e._emitPower=this.emitPower.getConnectedValue(i)},x._colorCreation.process=x=>{i.particleContext=x,x.color.A(this.color.getConnectedValue(i))},x._sizeCreation.process=x=>{i.particleContext=x,x.size=1,x.scale.A(this.scale.getConnectedValue(i))},x._angleCreation.process=x=>{i.particleContext=x,x.angle=this.angle.getConnectedValue(i)},this.particle._storedValue=x}}(0,J.f)("BABYLON.CreateParticleBlock",je);class Ee{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const i=[];for(const x of this.attachedBlocks)x.isInput&&i.push(x);return i}constructor(i){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new W.b,this.name=i}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(i)&&this.attachedBlocks.push(i);for(const e of i.inputs){const j=e.connectedPoint;if(j){const e=j.ownerBlock;e!==i&&this._initializeBlock(e,x)}}}async buildAsync(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((e=>{const j=new wx;for(const i of this._systemBlocks)this._initializeBlock(i);for(const E of this.systemBlocks){const e=new qx;e.buildId=this._buildId++,e.LJ=i,e.verbose=x;const a=E.createSystem(e);e.emitErrors(),j.systems.push(a)}this.onBuildObservable.notifyObservers(this),e(j)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const i=new Gx("Particle system"),x=new ie("Update position");x.output.connectTo(i.particle);const e=new vx("Position");e.contextualValue=Dx.Position;const j=new vx("Scaled direction");j.contextualValue=Dx.ScaledDirection;const E=new xe("Add");E.operation=Fx.Add,e.output.connectTo(E.left),j.output.connectTo(E.right),E.output.connectTo(x.position);const a=new je("Create particle"),Y=new ee("Box shape");a.particle.connectTo(Y.particle),Y.output.connectTo(x.particle);const J=new sx("Texture");J.texture.connectTo(i.texture),J.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(i)}removeBlock(i){const x=this.attachedBlocks.indexOf(i);if(x>-1&&this.attachedBlocks.splice(x,1),i.isSystem){const x=this._systemBlocks.indexOf(i);x>-1&&this._systemBlocks.splice(x,1)}}parseSerializedObject(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x||this.clear();const e={};for(const j of i.QA){const i=(0,J.e)(j.customType);if(i){const x=new i;x._deserialize(j),e[j.id]=x,this.attachedBlocks.push(x),x.isSystem&&this._systemBlocks.push(x)}}for(const j of this.attachedBlocks)if(j.isTeleportOut){const i=j,x=i._tempEntryPointUniqueId;if(x){const j=e[x];j&&j.attachToEndpoint(i)}}for(let j=0;j<i.QA.length;j++){const E=i.QA[j],a=e[E.id];a&&(a.inputs.length&&E.inputs.some((i=>i.targetConnectionName))&&!x||this._restoreConnections(a,i,e))}if(i.locations||i.editorData&&i.editorData.locations){const j=i.locations||i.editorData.locations;for(const i of j)e[i.lE]&&(i.lE=e[i.lE].uniqueId);x&&this.editorData&&this.editorData.locations&&j.concat(this.editorData.locations),i.locations?this.editorData={locations:j}:(this.editorData=i.editorData,this.editorData.locations=j);const E=[];for(const i in e)E[i]=e[i].uniqueId;this.editorData.map=E}this.comment=i.comment}_restoreConnections(i,x,e){for(const j of i.outputs)for(const E of x.QA){const a=e[E.id];if(a)for(const Y of E.inputs)if(e[Y.targetBlockId]!==i||Y.targetConnectionName!==j.name);else{const i=a.getInputByName(Y.inputName);if(!i||i.isConnected)continue;j.connectTo(i,!0),this._restoreConnections(a,x,e)}}}serialize(i){const x=i?{}:C.b.Serialize(this);x.editorData=JSON.parse(JSON.stringify(this.editorData));let e=[];i?e=i:x.customType="BABYLON.NodeParticleSystemSet",x.QA=[];for(const j of e)x.QA.push(j.serialize());if(!i)for(const j of this.attachedBlocks)-1===e.indexOf(j)&&x.QA.push(j.serialize());return x}dispose(){for(const i of this.attachedBlocks)i.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(i){const x=new Ee(i);return x.setToDefault(),x}static Parse(i){const x=C.b.Parse((()=>new Ee(i.name)),i,null);return x.parseSerializedObject(i),x}static ParseFromSnippetAsync(i,x){return"_BLANK"===i?Promise.resolve(Ee.CreateDefault("blank")):new Promise(((e,j)=>{const E=new Ox.e;E.addEventListener("readystatechange",(()=>{if(4==E.readyState)if(200==E.status){const Y=JSON.parse(JSON.parse(E.responseText).jsonPayload),J=JSON.parse(Y.nodeParticle);x||(x=C.b.Parse((()=>new Ee(i)),J,null)),x.parseSerializedObject(J),x.snippetId=i;try{e(x)}catch(a){j(a)}}else j("Unable to load the snippet "+i)})),E.open("GET",this.SnippetUrl+"/"+i.replace(/#/g,"/")),E.send()}))}}Ee.EditorURL=`${Vx.Tools._DefaultCdnUrl}/v${Pi.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,Ee.SnippetUrl="https://snippet.babylonjs.com",(0,mi.e)([(0,X.O)()],Ee.prototype,"name",void 0),(0,mi.e)([(0,X.O)("comment")],Ee.prototype,"comment",void 0),function(i){i[i.None=0]="None",i[i.PerParticle=1]="PerParticle",i[i.PerSystem=2]="PerSystem"}(Rx||(Rx={}));class ae extends cx{constructor(i){super(i),this._currentLockId=-2,this.lockMode=Rx.PerParticle,this.registerInput("min",dx.AutoDetect,!0,0),this.registerInput("max",dx.AutoDetect,!0,1),this.registerOutput("output",dx.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dx.Float|dx.Int|dx.Vector2|dx.KJ|dx.lJ),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(dx.Float|dx.Int|dx.Vector2|dx.KJ|dx.lJ),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=dx.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let i=null;switch(this._currentLockId=-2,this.min.type){case dx.AutoDetect:case dx.Int:case dx.Float:i=i=>{const x=this.min.getConnectedValue(i)||0,e=this.max.getConnectedValue(i)||1;return x+Math.random()*(e-x)};break;case dx.Vector2:i=i=>{const x=this.min.getConnectedValue(i)||j.Vector2.Zero(),e=this.max.getConnectedValue(i)||j.Vector2.One();return new j.Vector2(x.x+Math.random()*(e.x-x.x),x.y+Math.random()*(e.y-x.y))};break;case dx.KJ:i=i=>{const x=this.min.getConnectedValue(i)||j.KJ.Zero(),e=this.max.getConnectedValue(i)||j.KJ.One();return new j.KJ(x.x+Math.random()*(e.x-x.x),x.y+Math.random()*(e.y-x.y),x.z+Math.random()*(e.z-x.z))};break;case dx.lJ:i=i=>{const x=this.min.getConnectedValue(i)||new Y.lJ(0,0,0,0),e=this.max.getConnectedValue(i)||new Y.lJ(1,1,1,1);return new Y.lJ(x.x+Math.random()*(e.x-x.x),x.y+Math.random()*(e.y-x.y),x.z+Math.random()*(e.z-x.z),x.w+Math.random()*(e.w-x.w))}}this.output._storedFunction=x=>{var e;let j=0;switch(this.lockMode){case Rx.PerParticle:j=(null===(e=x.particleContext)||void 0===e?void 0:e.id)||-1;break;case Rx.PerSystem:j=x.buildId||0}return this._currentLockId!==j&&(this.lockMode!==Rx.None&&(this._currentLockId=j),this.output._storedValue=i(x)),this.output._storedValue}}serialize(){const i=super.serialize();return i.lockMode=this.lockMode,i}_deserialize(i){super._deserialize(i),this.lockMode=i.lockMode}}(0,mi.e)([Px("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Rx.None},{label:"Per particle",value:Rx.PerParticle},{label:"Per system",value:Rx.PerSystem}]})],ae.prototype,"lockMode",void 0),(0,J.f)("BABYLON.ParticleRandomBlock",ae);class Ye extends cx{constructor(i){super(i),this._currentLockId=-2,this.lockMode=Rx.PerParticle,this.registerInput("min",dx.AutoDetect),this.registerInput("max",dx.AutoDetect),this.registerOutput("output",dx.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const x=[dx.Matrix,dx.Particle,dx.Texture,dx.System,dx.FloatGradient,dx.Color4Gradient,dx.Vector2Gradient,dx.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...x),this.max.excludedConnectionPointTypes.push(...x)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let i=null;switch(this._currentLockId=-2,this.min.type){case dx.Float:case dx.Int:i=i=>{const x=this.min.getConnectedValue(i),e=this.max.getConnectedValue(i);return Math.random()*(e-x)+x};break;case dx.Vector2:i=i=>{const x=this.min.getConnectedValue(i),e=this.max.getConnectedValue(i);return new j.Vector2(Math.random()*(e.x-x.x)+x.x,Math.random()*(e.y-x.y)+x.y)};break;case dx.KJ:i=i=>{const x=this.min.getConnectedValue(i),e=this.max.getConnectedValue(i);return new j.KJ(Math.random()*(e.x-x.x)+x.x,Math.random()*(e.y-x.y)+x.y,Math.random()*(e.z-x.z)+x.z)};break;case dx.lJ:i=i=>{const x=this.min.getConnectedValue(i),e=this.max.getConnectedValue(i);return new Y.lJ(Math.random()*(e.r-x.r)+x.r,Math.random()*(e.g-x.g)+x.g,Math.random()*(e.b-x.b)+x.b,Math.random()*(e.a-x.a)+x.a)}}this.output._storedFunction=x=>{var e;let j=0;switch(this.lockMode){case Rx.PerParticle:j=(null===(e=x.particleContext)||void 0===e?void 0:e.id)||-1;break;case Rx.PerSystem:j=x.buildId||0}return this._currentLockId!==j&&(this.lockMode!==Rx.None&&(this._currentLockId=j),this.output._storedValue=i(x)),this.output._storedValue}}serialize(){const i=super.serialize();return i.lockMode=this.lockMode,i}_deserialize(i){super._deserialize(i),void 0!==i.lockMode&&(this.lockMode=i.lockMode)}}(0,mi.e)([Px("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:Rx.None},{label:"Per particle",value:Rx.PerParticle},{label:"Per system",value:Rx.PerSystem}]})],Ye.prototype,"lockMode",void 0),(0,J.f)("BABYLON.RandomRangeBlock",Ye);(0,J.f)("BABYLON.ParticleLerpBlock",class extends cx{constructor(i){super(i),this.registerInput("left",dx.AutoDetect),this.registerInput("right",dx.AutoDetect),this.registerInput("gradient",dx.Float,!0,0,0,1),this.registerOutput("output",dx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dx.Float|dx.Int|dx.Vector2|dx.KJ|dx.lJ)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const i=(i,x,e)=>(1-i)*x+i*e;this.output._storedFunction=x=>{const e=this.left.getConnectedValue(x),E=this.right.getConnectedValue(x),a=this.gradient.getConnectedValue(x);switch(this.left.type){case dx.Int:case dx.Float:return i(a,e,E);case dx.Vector2:return new j.Vector2(i(a,e.x,E.x),i(a,e.y,E.y));case dx.KJ:return new j.KJ(i(a,e.x,E.x),i(a,e.y,E.y),i(a,e.z,E.z));case dx.lJ:return new Y.lJ(i(a,e.r,E.r),i(a,e.g,E.g),i(a,e.b,E.b),i(a,e.a,E.a))}return 0}}});(0,J.f)("BABYLON.UpdateDirectionBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("direction",dx.KJ),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(i){const x=this.particle.getConnectedValue(i);if(this.output._storedValue=x,!this.direction.isConnected)return;const e={process:e=>{i.particleContext=e,i.systemContext=x,e.direction.A(this.direction.getConnectedValue(i))},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e}});(0,J.f)("BABYLON.UpdateColorBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("color",dx.lJ),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(i){const x=this.particle.getConnectedValue(i);if(this.output._storedValue=x,!this.color.isConnected)return;const e={process:e=>{i.particleContext=e,i.systemContext=x,e.color.A(this.color.getConnectedValue(i))},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e}});(0,J.f)("BABYLON.UpdateScaleBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("scale",dx.Vector2),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(i){const x=this.particle.getConnectedValue(i);if(this.output._storedValue=x,!this.scale.isConnected)return;const e={process:e=>{i.particleContext=e,i.systemContext=x,e.scale.A(this.scale.getConnectedValue(i))},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e}});(0,J.f)("BABYLON.UpdateAngleBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("angle",dx.Float),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(i){const x=this.particle.getConnectedValue(i);if(this.output._storedValue=x,!this.angle.isConnected)return;const e={process:e=>{i.particleContext=e,i.systemContext=x,e.angle=this.angle.getConnectedValue(i)},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e}});(0,J.f)("BABYLON.BasicPositionUpdateBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(i){const x=this.particle.getConnectedValue(i),e={process:e=>{i.particleContext=e,i.systemContext=x,e.direction.scaleToRef(x._directionScale,x._scaledDirection),e.position.addInPlace(x._scaledDirection)},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e,this.output._storedValue=x}});(0,J.f)("BABYLON.BasicSpriteUpdateBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(i){const x=this.particle.getConnectedValue(i),e={process:e=>{i.particleContext=e,i.systemContext=x,e.updateCellIndex()},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e,this.output._storedValue=x}});(0,J.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("cellIndex",dx.Int),this.registerOutput("output",dx.Particle),this.cellIndex.acceptedConnectionPointTypes=[dx.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(i){const x=this.particle.getConnectedValue(i);if(this.output._storedValue=x,!this.cellIndex.isConnected)return;const e={process:e=>{i.particleContext=e,i.systemContext=x,e.cellIndex=Math.floor(this.cellIndex.getConnectedValue(i))},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e}});class Je extends cx{constructor(i){super(i),this.strength=1,this.registerInput("particle",dx.Particle),this.registerInput("flowMap",dx.Texture),this.registerOutput("output",dx.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(i){var x;const e=this.particle.getConnectedValue(i),j=i.LJ;let E;(null===(x=this.flowMap.connectedPoint)||void 0===x?void 0:x.ownerBlock).extractTextureContentAsync().then((i=>{i&&(E=new Ix(i.width,i.height,i.data))}));const a={process:i=>{const x=j.getTransformMatrix();E&&E._processParticle(i,this.strength*e._tempScaledUpdateSpeed,x)},previousItem:null,nextItem:null};e._updateQueueStart?hi(a,e._updateQueueStart):e._updateQueueStart=a,this.output._storedValue=e}serialize(){const i=super.serialize();return i.strength=this.strength,i}_deserialize(i){super._deserialize(i),this.strength=i.strength}}(0,mi.e)([Px("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Je.prototype,"strength",void 0),(0,J.f)("BABYLON.UpdateFlowMapBlock",Je);(0,J.f)("BABYLON.SphereShapeBlock",class extends cx{constructor(i){super(i),this.registerInput("input",dx.Particle),this.registerInput("radius",dx.Float,!0,1),this.registerInput("radiusRange",dx.Float,!0,1,0,1),this.registerInput("directionRandomizer",dx.Float,!0,0,0,1),this.registerOutput("output",dx.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(i){const x=this.input.getConnectedValue(i);x._directionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.directionRandomizer.getConnectedValue(i),a=e.position.Cx(i.emitterPosition).normalize(),Y=(0,b.RandomRange)(0,E),J=(0,b.RandomRange)(0,E),u=(0,b.RandomRange)(0,E);a.x+=Y,a.y+=J,a.z+=u,a.normalize(),i.isEmitterTransformNode?j.KJ.TransformNormalFromFloatsToRef(Y,J,u,i.emitterWorldMatrix,e.direction):e.direction.fJ(Y,J,u)},x._positionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.radius.getConnectedValue(i),a=this.radiusRange.getConnectedValue(i),Y=E-(0,b.RandomRange)(0,E*a),J=(0,b.RandomRange)(0,1),u=(0,b.RandomRange)(0,2*Math.PI),g=Math.acos(2*J-1),A=Y*Math.cos(u)*Math.sin(g),K=Y*Math.cos(g),L=Y*Math.sin(u)*Math.sin(g);i.isEmitterTransformNode?j.KJ.TransformCoordinatesFromFloatsToRef(A,K,L,i.emitterWorldMatrix,e.position):(e.position.fJ(A,K,L),e.position.addInPlace(i.emitterPosition))},this.output._storedValue=x}});(0,J.f)("BABYLON.PointShapeBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("direction1",dx.KJ,!0,new j.KJ(0,1,0)),this.registerInput("direction2",dx.KJ,!0,new j.KJ(0,1,0)),this.registerOutput("output",dx.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(i){const x=this.particle.getConnectedValue(i);x._directionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.direction1.getConnectedValue(i),a=this.direction2.getConnectedValue(i),Y=(0,b.RandomRange)(E.x,a.x),J=(0,b.RandomRange)(E.y,a.y),u=(0,b.RandomRange)(E.z,a.z);i.isEmitterTransformNode?j.KJ.TransformNormalFromFloatsToRef(Y,J,u,i.emitterWorldMatrix,e.direction):e.direction.fJ(Y,J,u)},x._positionCreation.process=e=>{i.systemContext=x,i.isEmitterTransformNode?j.KJ.TransformCoordinatesFromFloatsToRef(0,0,0,i.emitterWorldMatrix,e.position):e.position.A(i.emitterPosition)},this.output._storedValue=x}});(0,J.f)("BABYLON.CustomShapeBlock",class extends cx{constructor(i){super(i),this.registerInput("particle",dx.Particle),this.registerInput("position",dx.KJ,!0,new j.KJ(0,0,0)),this.registerInput("direction",dx.KJ,!0,new j.KJ(0,1,0)),this.registerOutput("output",dx.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(i){const x=this.particle.getConnectedValue(i);x._directionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.direction.getConnectedValue(i);i.isEmitterTransformNode?j.KJ.TransformNormalToRef(E,i.emitterWorldMatrix,e.direction):e.direction.A(E)},x._positionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.position.getConnectedValue(i);i.isEmitterTransformNode?j.KJ.TransformCoordinatesToRef(E,i.emitterWorldMatrix,e.position):(e.position.A(E),e.position.addInPlace(i.emitterPosition))},this.output._storedValue=x}});(0,J.f)("BABYLON.CylinderShapeBlock",class extends cx{constructor(i){super(i),this._tempVector=j.KJ.Zero(),this.registerInput("particle",dx.Particle),this.registerInput("radius",dx.Float,!0,1),this.registerInput("height",dx.Float,!0,1,0),this.registerInput("radiusRange",dx.Float,!0,1,0,1),this.registerInput("directionRandomizer",dx.Float,!0,0,0,1),this.registerOutput("output",dx.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(i){const x=this.particle.getConnectedValue(i);x._directionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.directionRandomizer.getConnectedValue(i);e.position.subtractToRef(i.emitterPosition,this._tempVector),this._tempVector.normalize(),i.isEmitterTransformNode&&j.KJ.TransformNormalToRef(this._tempVector,i.emitterInverseWorldMatrix,this._tempVector);const a=(0,b.RandomRange)(-E/2,E/2);let Y=Math.atan2(this._tempVector.x,this._tempVector.z);Y+=(0,b.RandomRange)(-Math.PI/2,Math.PI/2)*E,this._tempVector.y=a,this._tempVector.x=Math.sin(Y),this._tempVector.z=Math.cos(Y),this._tempVector.normalize(),i.isEmitterTransformNode?j.KJ.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,i.emitterWorldMatrix,e.direction):e.direction.A(this._tempVector)},x._positionCreation.process=e=>{i.particleContext=e,i.systemContext=x;const E=this.height.getConnectedValue(i),a=this.radiusRange.getConnectedValue(i),Y=this.radius.getConnectedValue(i),J=(0,b.RandomRange)(-E/2,E/2),u=(0,b.RandomRange)(0,2*Math.PI),g=(0,b.RandomRange)((1-a)*(1-a),1),A=Math.sqrt(g)*Y,K=A*Math.cos(u),L=A*Math.sin(u);i.isEmitterTransformNode?j.KJ.TransformCoordinatesFromFloatsToRef(K,J,L,i.emitterWorldMatrix,e.position):(e.position.fJ(K,J,L),e.position.addInPlace(i.emitterPosition))},this.output._storedValue=x}});class ue extends cx{constructor(i){super(i),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",dx.Particle),this.registerOutput("output",dx.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(i){super._build(i);const x=this.particle.getConnectedValue(i);x._isAnimationSheetEnabled=!0,x.spriteCellWidth=this.width,x.spriteCellHeight=this.height,x.startSpriteCellID=this.start,x.endSpriteCellID=this.end,x.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=x}serialize(){const i=super.serialize();return i.width=this.width,i.height=this.height,i.start=this.start,i.end=this.end,i.randomStartCell=this.randomStartCell,i}_deserialize(i){super._deserialize(i),this.width=i.width,this.height=i.height,this.start=i.start,this.end=i.end,this.randomStartCell=i.randomStartCell}}(0,mi.e)([Px("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ue.prototype,"start",void 0),(0,mi.e)([Px("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ue.prototype,"end",void 0),(0,mi.e)([Px("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ue.prototype,"width",void 0),(0,mi.e)([Px("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],ue.prototype,"height",void 0),(0,mi.e)([Px("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ue.prototype,"loop",void 0),(0,mi.e)([Px("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],ue.prototype,"randomStartCell",void 0),(0,J.f)("BABYLON.SetupSpriteSheetBlock",ue);class be extends cx{constructor(i){super(i),this.reference=0,this.registerInput("value",dx.AutoDetect),this.registerOutput("output",dx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=i=>{switch(i){case dx.Float:return dx.FloatGradient;case dx.Vector2:return dx.Vector2Gradient;case dx.KJ:return dx.Vector3Gradient;case dx.lJ:return dx.Color4Gradient}return i},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dx.Float|dx.Vector2|dx.KJ|dx.lJ)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=i=>null}serialize(){const i=super.serialize();return i.reference=this.reference,i}_deserialize(i){super._deserialize(i),this.reference=i.reference}}(0,mi.e)([Px("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],be.prototype,"reference",void 0),(0,J.f)("BABYLON.ParticleGradientValueBlock",be);(0,J.f)("BABYLON.ParticleGradientBlock",class extends cx{constructor(i){super(i),this._entryCount=1,this.registerInput("gradient",dx.Float,!0,1,0,1),this.registerInput("value0",dx.AutoDetect),this.registerOutput("output",dx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=i=>{switch(i){case dx.FloatGradient:return dx.Float;case dx.Vector2Gradient:return dx.Vector2;case dx.Vector3Gradient:return dx.KJ;case dx.Color4Gradient:return dx.lJ}return i},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(dx.FloatGradient|dx.Vector2Gradient|dx.Vector3Gradient|dx.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(i){this._inputs[i].onConnectionObservable.add((()=>{this._entryCount>i||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),dx.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const i=[];for(let e=1;e<this._inputs.length;e++){var x;if(this._inputs[e].isConnected)i.push(null===(x=this._inputs[e].connectedPoint)||void 0===x?void 0:x.ownerBlock)}i.sort(((i,x)=>i.reference-x.reference)),this.output._storedFunction=x=>{const e=this.gradient.getConnectedValue(x);if(1===i.length)return i[0].value.getConnectedValue(x);let E=null;for(let a=i.length-1;a>=0;a--){const J=i[a];if(J.reference<=e){const i=J.value.getConnectedValue(x);if(E){const a=E.value.getConnectedValue(x),u=E.reference,g=J.reference,A=Math.max(0,Math.min(1,(e-g)/(u-g)));switch(this.output.type){case dx.Float:return(0,b.Lerp)(i,a,A);case dx.Vector2:return j.Vector2.Lerp(i,a,A);case dx.KJ:return j.KJ.Lerp(i,a,A);case dx.lJ:return Y.lJ.Lerp(i,a,A)}}return i}E=J}return 0}}});(0,J.f)("BABYLON.ParticleConverterBlock",class extends cx{constructor(i){super(i),this.registerInput("color ",dx.lJ,!0),this.registerInput("xyz ",dx.KJ,!0),this.registerInput("xy ",dx.Vector2,!0),this.registerInput("zw ",dx.Vector2,!0),this.registerInput("x ",dx.Float,!0),this.registerInput("y ",dx.Float,!0),this.registerInput("z ",dx.Float,!0),this.registerInput("w ",dx.Float,!0),this.registerOutput("color",dx.lJ),this.registerOutput("xyz",dx.KJ),this.registerOutput("xy",dx.Vector2),this.registerOutput("zw",dx.Vector2),this.registerOutput("x",dx.Float),this.registerOutput("y",dx.Float),this.registerOutput("z",dx.Float),this.registerOutput("w",dx.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(i){return"color "===i?"colorIn":"xyz "===i?"xyzIn":"xy "===i?"xyIn":"zw "===i?"zwIn":"x "===i?"xIn":"y "===i?"yIn":"z "===i?"zIn":"w "===i?"wIn":i}_outputRename(i){switch(i){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return i}}_build(i){super._build(i);const x=this.xIn,e=this.yIn,E=this.zIn,a=this.wIn,J=this.xyIn,u=this.zwIn,b=this.xyzIn,g=this.colorIn,A=this.colorOut,K=this.xyzOut,L=this.xyOut,o=this.zwOut,M=this.xOut,z=this.yOut,T=this.zOut,Q=this.wOut,t=i=>{if(g.isConnected)return g.getConnectedValue(i);let j=0,A=0,K=0,L=0;if(x.isConnected&&(j=x.getConnectedValue(i)),e.isConnected&&(A=e.getConnectedValue(i)),E.isConnected&&(K=E.getConnectedValue(i)),a.isConnected&&(L=a.getConnectedValue(i)),J.isConnected){const x=J.getConnectedValue(i);x&&(j=x.x,A=x.y)}if(u.isConnected){const x=u.getConnectedValue(i);x&&(K=x.x,L=x.y)}if(b.isConnected){const x=b.getConnectedValue(i);x&&(j=x.x,A=x.y,K=x.z)}return new Y.lJ(j,A,K,L)};A._storedFunction=i=>t(i),K._storedFunction=i=>{const x=t(i);return new j.KJ(x.r,x.g,x.b)},L._storedFunction=i=>{const x=t(i);return new j.Vector2(x.r,x.g)},o._storedFunction=i=>{const x=t(i);return new j.Vector2(x.b,x.a)},M._storedFunction=i=>t(i).r,z._storedFunction=i=>t(i).g,T._storedFunction=i=>t(i).b,Q._storedFunction=i=>t(i).a}}),function(i){i[i.Cos=0]="Cos",i[i.Sin=1]="Sin",i[i.Abs=2]="Abs",i[i.Exp=3]="Exp",i[i.Exp2=4]="Exp2",i[i.Round=5]="Round",i[i.Floor=6]="Floor",i[i.Ceiling=7]="Ceiling",i[i.Sqrt=8]="Sqrt",i[i.Log=9]="Log",i[i.Tan=10]="Tan",i[i.ArcTan=11]="ArcTan",i[i.ArcCos=12]="ArcCos",i[i.ArcSin=13]="ArcSin",i[i.Sign=14]="Sign",i[i.Negate=15]="Negate",i[i.OneMinus=16]="OneMinus",i[i.Reciprocal=17]="Reciprocal",i[i.ToDegrees=18]="ToDegrees",i[i.ToRadians=19]="ToRadians",i[i.Fract=20]="Fract"}(yx||(yx={}));class ge extends cx{constructor(i){super(i),this.operation=yx.Cos,this.registerInput("input",dx.AutoDetect),this.registerOutput("output",dx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(dx.Float|dx.Int|dx.Vector2|dx.KJ|dx.lJ)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(i){super._build(i);let x=null;switch(this.operation){case yx.Cos:x=i=>Math.cos(i);break;case yx.Sin:x=i=>Math.sin(i);break;case yx.Abs:x=i=>Math.abs(i);break;case yx.Exp:x=i=>Math.exp(i);break;case yx.Exp2:x=i=>Math.pow(2,i);break;case yx.Round:x=i=>Math.round(i);break;case yx.Floor:x=i=>Math.floor(i);break;case yx.Ceiling:x=i=>Math.ceil(i);break;case yx.Sqrt:x=i=>Math.sqrt(i);break;case yx.Log:x=i=>Math.log(i);break;case yx.Tan:x=i=>Math.tan(i);break;case yx.ArcTan:x=i=>Math.atan(i);break;case yx.ArcCos:x=i=>Math.acos(i);break;case yx.ArcSin:x=i=>Math.asin(i);break;case yx.Sign:x=i=>Math.sign(i);break;case yx.Negate:x=i=>-i;break;case yx.OneMinus:x=i=>1-i;break;case yx.Reciprocal:x=i=>1/i;break;case yx.ToRadians:x=i=>i*Math.PI/180;break;case yx.ToDegrees:x=i=>180*i/Math.PI;break;case yx.Fract:x=i=>i>=0?i-Math.floor(i):i-Math.ceil(i)}if(!x)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case dx.Int:case dx.Float:this.output._storedFunction=i=>{const e=this.input.getConnectedValue(i);return x(e)};break;case dx.Vector2:this.output._storedFunction=i=>{const e=this.input.getConnectedValue(i);return new j.Vector2(x(e.x),x(e.y))};break;case dx.KJ:this.output._storedFunction=i=>{const e=this.input.getConnectedValue(i);return new j.KJ(x(e.x),x(e.y),x(e.z))};break;case dx.lJ:this.output._storedFunction=i=>{const e=this.input.getConnectedValue(i);return new Y.lJ(x(e.r),x(e.g),x(e.b),x(e.a))}}return this}serialize(){const i=super.serialize();return i.operation=this.operation,i}_deserialize(i){super._deserialize(i),this.operation=i.operation}}(0,mi.e)([Px("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:yx.Cos},{label:"Sin",value:yx.Sin},{label:"Abs",value:yx.Abs},{label:"Exp",value:yx.Exp},{label:"Exp2",value:yx.Exp2},{label:"Round",value:yx.Round},{label:"Floor",value:yx.Floor},{label:"Ceiling",value:yx.Ceiling},{label:"Sqrt",value:yx.Sqrt},{label:"Log",value:yx.Log},{label:"Tan",value:yx.Tan},{label:"ArcTan",value:yx.ArcTan},{label:"ArcCos",value:yx.ArcCos},{label:"ArcSin",value:yx.ArcSin},{label:"Sign",value:yx.Sign},{label:"Negate",value:yx.Negate},{label:"OneMinus",value:yx.OneMinus},{label:"Reciprocal",value:yx.Reciprocal},{label:"ToDegrees",value:yx.ToDegrees},{label:"ToRadians",value:yx.ToRadians},{label:"Fract",value:yx.Fract}]})],ge.prototype,"operation",void 0),(0,J.f)("BABYLON.ParticleTrigonometryBlock",ge);var Ae,Ke=e(13576);class Le extends cx{constructor(i){super(i),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",dx.AutoDetect),this.registerOutput("output",dx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(dx.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(dx.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(dx.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(dx.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(dx.System),this._inputs[0].excludedConnectionPointTypes.push(dx.Particle),this._inputs[0].excludedConnectionPointTypes.push(dx.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(i){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const x=i=>{const x=this.input.getConnectedValue(i);if(this.log.length>=this.stackSize)return x;if(null===x||void 0===x)return this.log.push(["null",""]),x;switch(this.input.type){case dx.Vector2:this.log.push([(0,Ke.j)(x,4),x.toString()]);break;case dx.KJ:this.log.push([(0,Ke.m)(x,4),x.toString()]);break;case dx.lJ:this.log.push([`{R: ${x.r.toFixed(4)} G: ${x.g.toFixed(4)} B: ${x.b.toFixed(4)} A: ${x.a.toFixed(4)}}`,x.toString()]);break;default:this.log.push([x.toString(),x.toString()])}return x};this.output.isConnected?this.output._storedFunction=x:this.output._storedValue=x(i)}serialize(){const i=super.serialize();return i.stackSize=this.stackSize,i}_deserialize(i){super._deserialize(i),this.stackSize=i.stackSize}}(0,mi.e)([Px("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],Le.prototype,"stackSize",void 0),(0,J.f)("BABYLON.ParticleDebugBlock",Le);(0,J.f)("BABYLON.ParticleElbowBlock",class extends cx{constructor(i){super(i),this.registerInput("input",dx.AutoDetect),this.registerOutput("output",dx.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(i){super._build(i);const x=this._outputs[0],e=this._inputs[0];x._storedFunction=i=>e.getConnectedValue(i)}});(0,J.f)("BABYLON.ParticleTeleportInBlock",class extends cx{get endpoints(){return this._endpoints}constructor(i){super(i),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",dx.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(i){if(this.getClassName()===i)return!0;for(const x of this.endpoints)if(x.isAnAncestorOfType(i))return!0;return!1}isAnAncestorOf(i){for(const x of this.endpoints){if(x===i)return!0;if(x.isAnAncestorOf(i))return!0}return!1}attachToEndpoint(i){i.detach(),this._endpoints.push(i),i._entryPoint=this,i._outputs[0]._typeConnectionSource=this._inputs[0],i._tempEntryPointUniqueId=null,i.name="> "+this.name}detachFromEndpoint(i){const x=this._endpoints.indexOf(i);-1!==x&&(this._endpoints.splice(x,1),i._outputs[0]._typeConnectionSource=null,i._entryPoint=null)}_build(){for(const i of this._endpoints)i.output._storedFunction=i=>this.input.getConnectedValue(i)}});(0,J.f)("BABYLON.ParticleTeleportOutBlock",class extends cx{constructor(i){super(i),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",dx.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(i){this.entryPoint&&this.entryPoint.build(i)}clone(){const i=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(i),i}serialize(){var i;const x=super.serialize();return x.entryPoint=(null===(i=this.entryPoint)||void 0===i?void 0:i.uniqueId)??"",x}_deserialize(i){super._deserialize(i),this._tempEntryPointUniqueId=i.entryPoint}}),function(i){i[i.Equal=0]="Equal",i[i.NotEqual=1]="NotEqual",i[i.LessThan=2]="LessThan",i[i.GreaterThan=3]="GreaterThan",i[i.LessOrEqual=4]="LessOrEqual",i[i.GreaterOrEqual=5]="GreaterOrEqual",i[i.Xor=6]="Xor",i[i.Or=7]="Or",i[i.And=8]="And"}(Ae||(Ae={}));class oe extends cx{constructor(i){super(i),this.test=Ae.Equal,this.epsilon=0,this.registerInput("left",dx.Float),this.registerInput("right",dx.Float,!0,0),this.registerInput("ifTrue",dx.AutoDetect,!0,1),this.registerInput("ifFalse",dx.AutoDetect,!0,0),this.registerOutput("output",dx.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=dx.Float,this._inputs[0].acceptedConnectionPointTypes.push(dx.Int),this._inputs[1].acceptedConnectionPointTypes.push(dx.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const i=i=>{const x=this.left.getConnectedValue(i),e=this.right.getConnectedValue(i);let j=!1;switch(this.test){case Ae.Equal:j=(0,b.WithinEpsilon)(x,e,this.epsilon);break;case Ae.NotEqual:j=!(0,b.WithinEpsilon)(x,e,this.epsilon);break;case Ae.LessThan:j=x<e+this.epsilon;break;case Ae.GreaterThan:j=x>e-this.epsilon;break;case Ae.LessOrEqual:j=x<=e+this.epsilon;break;case Ae.GreaterOrEqual:j=x>=e-this.epsilon;break;case Ae.Xor:j=!!x&&!e||!x&&!!e;break;case Ae.Or:j=!!x||!!e;break;case Ae.And:j=!!x&&!!e}return j};this.output._storedFunction=x=>i(x)?this.ifTrue.getConnectedValue(x):this.ifFalse.getConnectedValue(x)}serialize(){const i=super.serialize();return i.test=this.test,i.epsilon=this.epsilon,i}_deserialize(i){super._deserialize(i),this.test=i.test,void 0!==i.epsilon&&(this.epsilon=i.epsilon)}}(0,mi.e)([Px("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:Ae.Equal},{label:"NotEqual",value:Ae.NotEqual},{label:"LessThan",value:Ae.LessThan},{label:"GreaterThan",value:Ae.GreaterThan},{label:"LessOrEqual",value:Ae.LessOrEqual},{label:"GreaterOrEqual",value:Ae.GreaterOrEqual},{label:"Xor",value:Ae.Xor},{label:"Or",value:Ae.Or},{label:"And",value:Ae.And}]})],oe.prototype,"test",void 0),(0,mi.e)([Px("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],oe.prototype,"epsilon",void 0),(0,J.f)("BABYLON.ParticleConditionBlock",oe);class Me extends cx{constructor(i){super(i),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",dx.Particle),this.registerInput("condition",dx.Float,!0,0),this.registerInput("system",dx.System),this.registerOutput("output",dx.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(i){this._triggerCount=0;const x=this.input.getConnectedValue(i),e={process:e=>{if(i.particleContext=e,i.systemContext=x,0!==this.condition.getConnectedValue(i)&&(0===this.limit||this._triggerCount<this.limit)){const j=(new Date).getTime();if(this._previousOne&&j-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=j;const E=this.system.getConnectedValue(i);if(E){const j=Wx(E,i.LJ,e.position);j.te.addOnce((()=>{this._triggerCount--})),x.te.addOnce((()=>{j.dispose()}))}}},previousItem:null,nextItem:null};x._updateQueueStart?hi(e,x._updateQueueStart):x._updateQueueStart=e,this.output._storedValue=x}serialize(){const i=super.serialize();return i.limit=this.limit,i.delay=this.delay,i}_deserialize(i){super._deserialize(i),void 0!==i.limit&&(this.limit=i.limit),void 0!==i.delay&&(this.delay=i.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,mi.e)([Px("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Me.prototype,"limit",void 0),(0,mi.e)([Px("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],Me.prototype,"delay",void 0),(0,J.f)("BABYLON.ParticleTriggerBlock",Me);e(13581),e(13594),e(13604),e(13652)},13635:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneFragment",a="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13607:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneFragmentDeclaration",a="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13670:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneVertex",a="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13657:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneVertexDeclaration",a="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13646:(i,x,e)=>{"use strict";var j=e(12162);const E="fogFragment",a="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13631:(i,x,e)=>{"use strict";var j=e(12162);const E="fogFragmentDeclaration",a="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13672:(i,x,e)=>{"use strict";var j=e(12162);const E="fogVertex",a="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13661:(i,x,e)=>{"use strict";var j=e(12162);const E="fogVertexDeclaration",a="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13617:(i,x,e)=>{"use strict";var j=e(12162);const E="helperFunctions",a="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13611:(i,x,e)=>{"use strict";var j=e(12162);const E="imageProcessingDeclaration",a="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13623:(i,x,e)=>{"use strict";var j=e(12162);const E="imageProcessingFunctions",a="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13615:(i,x,e)=>{"use strict";var j=e(12162);const E="logDepthDeclaration",a="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13641:(i,x,e)=>{"use strict";var j=e(12162);const E="logDepthFragment",a="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13680:(i,x,e)=>{"use strict";var j=e(12162);const E="logDepthVertex",a="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";j.c.IncludesShadersStoreWGSL[E]||(j.c.IncludesShadersStoreWGSL[E]=a)},13604:(i,x,e)=>{"use strict";e.r(x),e.d(x,{particlesPixelShaderWGSL:()=>Y});var j=e(12162);e(13607),e(13611),e(13615),e(13617),e(13623),e(13631),e(13635),e(13641),e(13646);const E="particlesPixelShader",a="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.c.ShadersStoreWGSL[E]||(j.c.ShadersStoreWGSL[E]=a);const Y={name:E,shader:a}},13652:(i,x,e)=>{"use strict";e.r(x),e.d(x,{particlesVertexShaderWGSL:()=>Y});var j=e(12162);e(13657),e(13661),e(13615),e(13670),e(13672),e(13680);const E="particlesVertexShader",a="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.c.ShadersStoreWGSL[E]||(j.c.ShadersStoreWGSL[E]=a);const Y={name:E,shader:a}},13536:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneFragment",a="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13587:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneFragmentDeclaration",a="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13548:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneVertex",a="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13597:(i,x,e)=>{"use strict";var j=e(12162);const E="clipPlaneVertexDeclaration",a="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13541:(i,x,e)=>{"use strict";var j=e(12162);const E="fogFragment",a="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13533:(i,x,e)=>{"use strict";var j=e(12162);const E="fogFragmentDeclaration",a="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13550:(i,x,e)=>{"use strict";var j=e(12162);const E="fogVertex",a="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13546:(i,x,e)=>{"use strict";var j=e(12162);const E="fogVertexDeclaration",a="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13525:(i,x,e)=>{"use strict";var j=e(12162);const E="helperFunctions",a="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13519:(i,x,e)=>{"use strict";var j=e(12162);const E="imageProcessingDeclaration",a="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13527:(i,x,e)=>{"use strict";var j=e(12162);const E="imageProcessingFunctions",a="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13522:(i,x,e)=>{"use strict";var j=e(12162);const E="logDepthDeclaration",a="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13538:(i,x,e)=>{"use strict";var j=e(12162);const E="logDepthFragment",a="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13555:(i,x,e)=>{"use strict";var j=e(12162);const E="logDepthVertex",a="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";j.c.IncludesShadersStore[E]||(j.c.IncludesShadersStore[E]=a)},13581:(i,x,e)=>{"use strict";e.r(x),e.d(x,{particlesPixelShader:()=>Y});var j=e(12162);e(13587),e(13519),e(13522),e(13525),e(13527),e(13533),e(13536),e(13538),e(13541);const E="particlesPixelShader",a="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";j.c.ShadersStore[E]||(j.c.ShadersStore[E]=a);const Y={name:E,shader:a}},13594:(i,x,e)=>{"use strict";e.r(x),e.d(x,{particlesVertexShader:()=>Y});var j=e(12162);e(13597),e(13546),e(13522),e(13548),e(13550),e(13555);const E="particlesVertexShader",a="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";j.c.ShadersStore[E]||(j.c.ShadersStore[E]=a);const Y={name:E,shader:a}},13933:(i,x,e)=>{"use strict";e.r(x),e.d(x,{FlowGraphGLTFDataProvider:()=>a});var j=e(13900),E=e(13874);class a extends j.e{constructor(i){var x,e;super();const j=i.glTF,a=(null===(x=j.animations)||void 0===x?void 0:x.map((i=>i._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",E.c,a);const Y=(null===(e=j.nodes)||void 0===e?void 0:e.map((i=>i._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",E.c,Y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},13811:(i,x,e)=>{"use strict";e.d(x,{c:()=>z,e:()=>o,g:()=>L,i:()=>M});var j=e(12250),E=e(12710),a=e(12286),Y=e(13815);const J=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class u{constructor(i,x){this._gltf=i,this._infoTree=x}convert(i){let x,e=this._gltf,j=this._infoTree;if(!i.startsWith("/"))throw new Error("Path must start with a /");const E=i.split("/");if(E.shift(),E[E.length-1].includes(".length")){const i=E[E.length-1].split(".");E.pop(),E.push(...i)}let a=!1;for(const u of E){const E="length"===u;if(E&&!j.__array__)throw new Error(`Path ${i} is invalid`);if(j.__ignoreObjectTree__&&(a=!0),j.__array__&&!E)j=j.__array__;else if(j=j[u],!j)throw new Error(`Path ${i} is invalid`);if(!a)if(void 0===e){if(!J.find((x=>x.regex.test(i))))throw new Error(`Path ${i} is invalid`)}else if(!E){var Y;e=null===(Y=e)||void 0===Y?void 0:Y[u]}(j.__target__||E)&&(x=e)}return{object:x,info:j}}}function b(i,x,e,j){const E=g(i,x);return j?E[e][j]:E[e]}function g(i,x,e){var j,a;return null===(j=i._data)||void 0===j||null===(a=j[(null===e||void 0===e?void 0:e.fillMode)??E.b.MATERIAL_TriangleFillMode])||void 0===a?void 0:a.babylonMaterial}function A(i,x){return{offset:{componentsCount:2,type:"Vector2",get:(e,E,a)=>{const Y=b(e,a,i,x);return new j.Vector2(null===Y||void 0===Y?void 0:Y.uOffset,null===Y||void 0===Y?void 0:Y.vOffset)},getTarget:g,set:(e,j,E,a)=>{const Y=b(j,a,i,x);Y.uOffset=e.x,Y.vOffset=e.y},getPropertyName:[()=>`${i}${x?"."+x:""}.uOffset`,()=>`${i}${x?"."+x:""}.vOffset`]},rotation:{type:"number",get:(e,j,E)=>{var a;return null===(a=b(e,E,i,x))||void 0===a?void 0:a.wAng},getTarget:g,set:(e,j,E,a)=>b(j,a,i,x).wAng=e,getPropertyName:[()=>`${i}${x?"."+x:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(e,E,a)=>{const Y=b(e,a,i,x);return new j.Vector2(null===Y||void 0===Y?void 0:Y.uScale,null===Y||void 0===Y?void 0:Y.vScale)},getTarget:g,set:(e,j,E,a)=>{const Y=b(j,a,i,x);Y.uScale=e.x,Y.vScale=e.y},getPropertyName:[()=>`${i}${x?"."+x:""}.uScale`,()=>`${i}${x?"."+x:""}.vScale`]}}}const K={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:i=>{var x,e;return new j.Vector2((null===(x=i._babylonCamera)||void 0===x?void 0:x.orthoLeft)??0,(null===(e=i._babylonCamera)||void 0===e?void 0:e.orthoRight)??0)},set:(i,x)=>{x._babylonCamera&&(x._babylonCamera.orthoLeft=i.x,x._babylonCamera.orthoRight=i.y)},getTarget:i=>i,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:i=>{var x,e;return new j.Vector2((null===(x=i._babylonCamera)||void 0===x?void 0:x.orthoBottom)??0,(null===(e=i._babylonCamera)||void 0===e?void 0:e.orthoTop)??0)},set:(i,x)=>{x._babylonCamera&&(x._babylonCamera.orthoBottom=i.x,x._babylonCamera.orthoTop=i.y)},getTarget:i=>i,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:i=>{var x;return null===(x=i._babylonCamera)||void 0===x?void 0:x.maxZ},set:(i,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=i)},getTarget:i=>i,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:i=>{var x;return null===(x=i._babylonCamera)||void 0===x?void 0:x.De},set:(i,x)=>{x._babylonCamera&&(x._babylonCamera.De=i)},getTarget:i=>i,getPropertyName:[()=>"De"]}},perspective:{aspectRatio:{type:"number",get:i=>{var x;return null===(x=i._babylonCamera)||void 0===x?void 0:x.getEngine().getAspectRatio(i._babylonCamera)},getTarget:i=>i,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:i=>{var x;return null===(x=i._babylonCamera)||void 0===x?void 0:x.fov},set:(i,x)=>{x._babylonCamera&&(x._babylonCamera.fov=i)},getTarget:i=>i,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:i=>{var x;return null===(x=i._babylonCamera)||void 0===x?void 0:x.maxZ},set:(i,x)=>{x._babylonCamera&&(x._babylonCamera.maxZ=i)},getTarget:i=>i,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:i=>{var x;return null===(x=i._babylonCamera)||void 0===x?void 0:x.De},set:(i,x)=>{x._babylonCamera&&(x._babylonCamera.De=i)},getTarget:i=>i,getPropertyName:[()=>"De"]}}}},nodes:{length:{type:"number",get:i=>i.length,getTarget:i=>i.map((i=>i._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"KJ",get:i=>{var x;return null===(x=i._babylonTransformNode)||void 0===x?void 0:x.position},set:(i,x)=>{var e;return null===(e=x._babylonTransformNode)||void 0===e?void 0:e.position.A(i)},getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:i=>{var x;return null===(x=i._babylonTransformNode)||void 0===x?void 0:x.rotationQuaternion},set:(i,x)=>{var e,j;return null===(e=x._babylonTransformNode)||void 0===e||null===(j=e.rotationQuaternion)||void 0===j?void 0:j.A(i)},getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"KJ",get:i=>{var x;return null===(x=i._babylonTransformNode)||void 0===x?void 0:x.wJ},set:(i,x)=>{var e;return null===(e=x._babylonTransformNode)||void 0===e?void 0:e.wJ.A(i)},getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"wJ"]},weights:{length:{type:"number",get:i=>i._numMorphTargets,getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(i,x)=>{var e,j;return void 0!==x?null===(e=i._primitiveBabylonMeshes)||void 0===e||null===(j=e[0].morphTargetManager)||void 0===j?void 0:j.getTarget(x).influence:void 0},getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(i,x)=>[0],getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:i=>{var x,e,E;return j.Matrix.Compose(null===(x=i._babylonTransformNode)||void 0===x?void 0:x.wJ,null===(e=i._babylonTransformNode)||void 0===e?void 0:e.rotationQuaternion,null===(E=i._babylonTransformNode)||void 0===E?void 0:E.position)},getTarget:i=>i._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:i=>{var x,e,E,a;const Y=j.Matrix.Identity();let J=i.parent;for(;J&&J.parent;)J=J.parent;const u=(null===(x=i._babylonTransformNode)||void 0===x?void 0:x.position._isDirty)||(null===(e=i._babylonTransformNode)||void 0===e||null===(E=e.rotationQuaternion)||void 0===E?void 0:E._isDirty)||(null===(a=i._babylonTransformNode)||void 0===a?void 0:a.wJ._isDirty);if(J){var b;const x=null===(b=J._babylonTransformNode)||void 0===b?void 0:b.Re(!0).invert();var g,A;if(x)null===(g=i._babylonTransformNode)||void 0===g||null===(A=g.Re(u))||void 0===A||A.multiplyToRef(x,Y)}else i._babylonTransformNode&&Y.A(i._babylonTransformNode.Re(u));return Y},getTarget:i=>i._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:i=>{var x,e;return null===(x=i._babylonTransformNode)||void 0===x||null===(e=x.getChildren((i=>i instanceof Y.d),!0)[0])||void 0===e?void 0:e.kJ},getTarget:i=>{var x;return null===(x=i._babylonTransformNode)||void 0===x?void 0:x.getChildren((i=>i instanceof Y.d),!0)[0]},set:(i,x)=>{if(x._babylonTransformNode){const e=x._babylonTransformNode.getChildren((i=>i instanceof Y.d),!0)[0];e&&(e.kJ=i)}}},color:{type:"MJ",get:i=>{var x,e;return null===(x=i._babylonTransformNode)||void 0===x||null===(e=x.getChildren((i=>i instanceof Y.d),!0)[0])||void 0===e?void 0:e.NJ},getTarget:i=>{var x;return null===(x=i._babylonTransformNode)||void 0===x?void 0:x.getChildren((i=>i instanceof Y.d),!0)[0]},set:(i,x)=>{if(x._babylonTransformNode){const e=x._babylonTransformNode.getChildren((i=>i instanceof Y.d),!0)[0];e&&(e.NJ=i)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"MJ",get:(i,x,e)=>g(i,x,e).emissiveColor,set:(i,x,e,j)=>g(x,e,j).emissiveColor.A(i),getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:A("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(i,x,e)=>{var j;return null===(j=b(i,e,"bumpTexture"))||void 0===j?void 0:j.level},set:(i,x,e,j)=>{const E=b(x,j,"bumpTexture");E&&(E.level=i)},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:A("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(i,x,e)=>g(i,x,e).ambientTextureStrength,set:(i,x,e,j)=>{const E=g(x,e,j);E&&(E.ambientTextureStrength=i)},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:A("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"lJ",get:(i,x,e)=>{const j=g(i,x,e);return a.lJ.FromColor3(j.albedoColor,j.alpha)},set:(i,x,e,j)=>{const E=g(x,e,j);E.albedoColor.set(i.r,i.g,i.b),E.alpha=i.a},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:A("albedoTexture")}},metallicFactor:{type:"number",get:(i,x,e)=>g(i,x,e).metallic,set:(i,x,e,j)=>{const E=g(x,e,j);E&&(E.metallic=i)},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(i,x,e)=>g(i,x,e).roughness,set:(i,x,e,j)=>{const E=g(x,e,j);E&&(E.roughness=i)},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:A("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(i,x,e)=>g(i,x,e).anisotropy.kJ,set:(i,x,e,j)=>{g(x,e,j).anisotropy.kJ=i},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(i,x,e)=>g(i,x,e).anisotropy.angle,set:(i,x,e,j)=>{g(x,e,j).anisotropy.angle=i},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:A("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(i,x,e)=>g(i,x,e).clearCoat.kJ,set:(i,x,e,j)=>{g(x,e,j).clearCoat.kJ=i},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(i,x,e)=>g(i,x,e).clearCoat.roughness,set:(i,x,e,j)=>{g(x,e,j).clearCoat.roughness=i},getTarget:(i,x,e)=>g(i,x,e),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:A("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(i,x,e)=>{var j;return null===(j=g(i,x,e).clearCoat.bumpTexture)||void 0===j?void 0:j.level},getTarget:g,set:(i,x,e,j)=>g(x,e,j).clearCoat.bumpTexture.level=i},extensions:{KHR_texture_transform:A("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:A("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(i,x,e)=>g(i,x,e).subSurface.dispersion,getTarget:g,set:(i,x,e,j)=>g(x,e,j).subSurface.dispersion=i}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(i,x,e)=>g(i,x,e).emissiveIntensity,getTarget:g,set:(i,x,e,j)=>g(x,e,j).emissiveIntensity=i}},KHR_materials_ior:{ior:{type:"number",get:(i,x,e)=>g(i,x,e).indexOfRefraction,getTarget:g,set:(i,x,e,j)=>g(x,e,j).indexOfRefraction=i}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(i,x,e)=>g(i,x,e).iridescence.kJ,getTarget:g,set:(i,x,e,j)=>g(x,e,j).iridescence.kJ=i},iridescenceIor:{type:"number",get:(i,x,e)=>g(i,x,e).iridescence.indexOfRefraction,getTarget:g,set:(i,x,e,j)=>g(x,e,j).iridescence.indexOfRefraction=i},iridescenceTexture:{extensions:{KHR_texture_transform:A("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(i,x,e)=>g(i,x,e).iridescence.maximumThickness,getTarget:g,set:(i,x,e,j)=>g(x,e,j).iridescence.maximumThickness=i},iridescenceThicknessMinimum:{type:"number",get:(i,x,e)=>g(i,x,e).iridescence.minimumThickness,getTarget:g,set:(i,x,e,j)=>g(x,e,j).iridescence.minimumThickness=i},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:A("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"MJ",get:(i,x,e)=>g(i,x,e).sheen.color,getTarget:g,set:(i,x,e,j)=>g(x,e,j).sheen.color.A(i)},sheenColorTexture:{extensions:{KHR_texture_transform:A("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(i,x,e)=>g(i,x,e).sheen.kJ,getTarget:g,set:(i,x,e,j)=>g(x,e,j).sheen.kJ=i},sheenRoughnessTexture:{extensions:{KHR_texture_transform:A("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(i,x,e)=>g(i,x,e).metallicF0Factor,getTarget:g,set:(i,x,e,j)=>g(x,e,j).metallicF0Factor=i,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"MJ",get:(i,x,e)=>g(i,x,e).metallicReflectanceColor,getTarget:g,set:(i,x,e,j)=>g(x,e,j).metallicReflectanceColor.A(i),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:A("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:A("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(i,x,e)=>g(i,x,e).subSurface.refractionIntensity,getTarget:g,set:(i,x,e,j)=>g(x,e,j).subSurface.refractionIntensity=i,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:A("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(i,x,e)=>g(i,x,e).subSurface.translucencyIntensity,getTarget:g,set:(i,x,e,j)=>g(x,e,j).subSurface.translucencyIntensity=i},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:A("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"MJ",get:(i,x,e)=>g(i,x,e).subSurface.translucencyColor,getTarget:g,set:(i,x,e,j)=>{var E;return i&&(null===(E=g(x,e,j).subSurface.translucencyColor)||void 0===E?void 0:E.A(i))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:A("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"MJ",get:(i,x,e)=>g(i,x,e).subSurface.tintColor,getTarget:g,set:(i,x,e,j)=>g(x,e,j).subSurface.tintColor.A(i)},attenuationDistance:{type:"number",get:(i,x,e)=>g(i,x,e).subSurface.tintColorAtDistance,getTarget:g,set:(i,x,e,j)=>g(x,e,j).subSurface.tintColorAtDistance=i},thicknessFactor:{type:"number",get:(i,x,e)=>g(i,x,e).subSurface.maximumThickness,getTarget:g,set:(i,x,e,j)=>g(x,e,j).subSurface.maximumThickness=i},thicknessTexture:{extensions:{KHR_texture_transform:A("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:i=>i.length,getTarget:i=>i.map((i=>i._babylonLight)),getPropertyName:[i=>"length"]},__array__:{__target__:!0,color:{type:"MJ",get:i=>{var x;return null===(x=i._babylonLight)||void 0===x?void 0:x.NJ},set:(i,x)=>{var e;return null===(e=x._babylonLight)||void 0===e?void 0:e.NJ.A(i)},getTarget:i=>i._babylonLight,getPropertyName:[i=>"diffuse"]},kJ:{type:"number",get:i=>{var x;return null===(x=i._babylonLight)||void 0===x?void 0:x.kJ},set:(i,x)=>x._babylonLight?x._babylonLight.kJ=i:void 0,getTarget:i=>i._babylonLight,getPropertyName:[i=>"intensity"]},range:{type:"number",get:i=>{var x;return null===(x=i._babylonLight)||void 0===x?void 0:x.range},set:(i,x)=>x._babylonLight?x._babylonLight.range=i:void 0,getTarget:i=>i._babylonLight,getPropertyName:[i=>"range"]},spot:{innerConeAngle:{type:"number",get:i=>{var x;return null===(x=i._babylonLight)||void 0===x?void 0:x.innerAngle},set:(i,x)=>x._babylonLight?x._babylonLight.innerAngle=i:void 0,getTarget:i=>i._babylonLight,getPropertyName:[i=>"innerConeAngle"]},outerConeAngle:{type:"number",get:i=>{var x;return null===(x=i._babylonLight)||void 0===x?void 0:x.angle},set:(i,x)=>x._babylonLight?x._babylonLight.angle=i:void 0,getTarget:i=>i._babylonLight,getPropertyName:[i=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:i=>i.length,getTarget:i=>i.map((i=>i._babylonLight)),getPropertyName:[i=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:i=>i.length,getTarget:i=>i.map((i=>i._babylonTexture)),getPropertyName:[i=>"length"]},__array__:{__target__:!0,kJ:{type:"number",get:i=>{var x;return null===(x=i._babylonTexture)||void 0===x?void 0:x.level},set:(i,x)=>{x._babylonTexture&&(x._babylonTexture.level=i)},getTarget:i=>i._babylonTexture},rotation:{type:"Quaternion",get:i=>{var x;return i._babylonTexture&&j.Quaternion.FromRotationMatrix(null===(x=i._babylonTexture)||void 0===x?void 0:x.getReflectionTextureMatrix())},set:(i,x)=>{var e;x._babylonTexture&&(null!==(e=x._babylonTexture.wi())&&void 0!==e&&e.useRightHandedSystem||(i=j.Quaternion.Inverse(i)),j.Matrix.FromQuaternionToRef(i,x._babylonTexture.getReflectionTextureMatrix()))},getTarget:i=>i._babylonTexture}}}}},animations:{length:{type:"number",get:i=>i.length,getTarget:i=>i.map((i=>i._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:i=>i.length,getTarget:i=>i.map((i=>{var x;return null===(x=i.primitives[0]._instanceData)||void 0===x?void 0:x.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function L(i){return new u(i,K)}function o(i){const x=i.split("/").map((i=>i.replace(/{}/g,"__array__")));let e=K;for(const j of x)j&&(e=e[j]);if(e&&e.type&&e.get)return e}function M(i,x){const e=i.split("/").map((i=>i.replace(/{}/g,"__array__")));let j=K;for(const E of e)E&&(j=j[E]);j&&j.type&&j.get&&(j.interpolation=x)}function z(i,x){const e=i.split("/").map((i=>i.replace(/{}/g,"__array__")));let j=K;for(const E of e)if(E){if(!j[E]){if("?"===E){j.__ignoreObjectTree__=!0;continue}j[E]={},"__array__"===E&&(j[E].__target__=!0)}j=j[E]}Object.assign(j,x)}},13821:(i,x,e)=>{"use strict";e.r(x),e.d(x,{AnimationPropertyInfo:()=>b,TransformNodeAnimationPropertyInfo:()=>g,WeightAnimationPropertyInfo:()=>A,getQuaternion:()=>J,getVector3:()=>Y,getWeights:()=>u});var j=e(12753),E=e(12250),a=e(13811);function Y(i,x,e,j){return E.KJ.zJ(x,e).scaleInPlace(j)}function J(i,x,e,j){return E.Quaternion.zJ(x,e).scaleInPlace(j)}function u(i,x,e,j){const E=new Array(i._numMorphTargets);for(let a=0;a<E.length;a++)E[a]=x[e++]*j;return E}class b{constructor(i,x,e,j){this.type=i,this.name=x,this.getValue=e,this.getStride=j}_buildAnimation(i,x,e){const E=new j.c(i,this.name,x,this.type);return E.setKeys(e),E}}class g extends b{buildAnimations(i,x,e,j){const E=[];return E.push({babylonAnimatable:i._babylonTransformNode,babylonAnimation:this._buildAnimation(x,e,j)}),E}}class A extends b{buildAnimations(i,x,e,E){const a=[];if(i._numMorphTargets)for(let Y=0;Y<i._numMorphTargets;Y++){const J=new j.c(`${x}_${Y}`,this.name,e,this.type);if(J.setKeys(E.map((i=>({frame:i.frame,inTangent:i.inTangent?i.inTangent[Y]:void 0,value:i.value[Y],outTangent:i.outTangent?i.outTangent[Y]:void 0,interpolation:i.interpolation})))),i._primitiveBabylonMeshes)for(const x of i._primitiveBabylonMeshes)if(x.morphTargetManager){const i=x.morphTargetManager.getTarget(Y),e=J.clone();i.animations.push(e),a.push({babylonAnimatable:i,babylonAnimation:e})}}return a}}(0,a.i)("/nodes/{}/translation",[new g(j.c.ANIMATIONTYPE_VECTOR3,"position",Y,(()=>3))]),(0,a.i)("/nodes/{}/rotation",[new g(j.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",J,(()=>4))]),(0,a.i)("/nodes/{}/scale",[new g(j.c.ANIMATIONTYPE_VECTOR3,"wJ",Y,(()=>3))]),(0,a.i)("/nodes/{}/weights",[new A(j.c.ANIMATIONTYPE_FLOAT,"influence",u,(i=>i._numMorphTargets))])},13786:(i,x,e)=>{"use strict";class j{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((i,x)=>{this._resolve=i,this._reject=x}))}}var E=e(12250),a=e(12286),Y=e(12061),J=e(12677),u=e(13793),b=e(13800),g=e(12065),A=e(12702),K=e(12753),L=e(12759),o=e(12108),M=e(12072),z=e(12080);class T{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(i){this._useTextureToStoreBoneMatrices=i,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(i){this._animationPropertiesOverride=i}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(i,x,e){this.name=i,this.id=x,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=E.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new g.b,this.bones=[],this._scene=e||o.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const j=this._scene.getEngine().getCaps();this._canUseTextureForBones=j.textureFloat&&j.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((i=>!i.getParent()))}getTransformMatrices(i){if(this.needInitialSkinMatrix){if(!i)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return i._bonesTransformMatrices||this.prepare(!0),i._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(i){return this.needInitialSkinMatrix&&i._transformMatrixTexture?i._transformMatrixTexture:this._transformMatrixTexture}wi(){return this._scene}toString(i){let x=`Name: ${this.name}, nBones: ${this.bones.length}`;if(x+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,i){x+=", Ranges: {";let i=!0;for(const e in this._ranges)i&&(x+=", ",i=!1),x+=e;x+="}"}return x}getBoneIndexByName(i){for(let x=0,e=this.bones.length;x<e;x++)if(this.bones[x].name===i)return x;return-1}createAnimationRange(i,x,e){if(!this._ranges[i]){this._ranges[i]=new L.b(i,x,e);for(let j=0,E=this.bones.length;j<E;j++)this.bones[j].animations[0]&&this.bones[j].animations[0].createRange(i,x,e)}}deleteAnimationRange(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let e=0,j=this.bones.length;e<j;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].deleteRange(i,x);this._ranges[i]=null}getAnimationRange(i){return this._ranges[i]||null}getAnimationRanges(){const i=[];let x;for(x in this._ranges)i.push(this._ranges[x]);return i}copyAnimationRange(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[x]||!i.getAnimationRange(x))return!1;let j=!0;const E=this._getHighestAnimationFrame()+1,a={},Y=i.bones;let J,u;for(u=0,J=Y.length;u<J;u++)a[Y[u].name]=Y[u];this.bones.length!==Y.length&&(M.c.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${Y.length}`),j=!1);const b=e&&this.dimensionsAtRest&&i.dimensionsAtRest?this.dimensionsAtRest.divide(i.dimensionsAtRest):null;for(u=0,J=this.bones.length;u<J;u++){const i=this.bones[u].name,Y=a[i];Y?j=j&&this.bones[u].copyAnimationRange(Y,x,E,e,b):(M.c.Warn("copyAnimationRange: not same rig, missing source bone "+i),j=!1)}const g=i.getAnimationRange(x);return g&&(this._ranges[x]=new L.b(x,g.from+E,g.to+E)),j}returnToRest(){for(const i of this.bones)-1!==i._index&&i.returnToRest()}_getHighestAnimationFrame(){let i=0;for(let x=0,e=this.bones.length;x<e;x++)if(this.bones[x].animations[0]){const e=this.bones[x].animations[0].getHighestFrame();i<e&&(i=e)}return i}beginAnimation(i,x,e,j){const E=this.getAnimationRange(i);return E?this._scene.beginAnimation(this,E.from,E.to,x,e,j):null}static MakeAnimationAdditive(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;const j=i.getAnimationRange(e);if(!j)return null;const E=i._scene.getAllAnimatablesByTarget(i);let a=null;for(let J=0;J<E.length;J++){const i=E[J];if(i.fromFrame===(null===j||void 0===j?void 0:j.from)&&i.toFrame===(null===j||void 0===j?void 0:j.to)){a=i;break}}const Y=i.getAnimatables();for(let J=0;J<Y.length;J++){const i=Y[J].animations;if(i)for(let j=0;j<i.length;j++)K.c.MakeAnimationAdditive(i[j],x,e)}return a&&(a.isAdditive=!0),i}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(i){this._meshesWithPoseMatrix.push(i)}_unregisterMeshWithPoseMatrix(i){const x=this._meshesWithPoseMatrix.indexOf(i);x>-1&&this._meshesWithPoseMatrix.splice(x,1)}_computeTransformMatrices(i,x){this.onBeforeComputeObservable.notifyObservers(this);for(let e=0;e<this.bones.length;e++){const j=this.bones[e];j._childUpdateId++;const E=j.getParent();if(E?j.getLocalMatrix().multiplyToRef(E.getFinalMatrix(),j.getFinalMatrix()):x?j.getLocalMatrix().multiplyToRef(x,j.getFinalMatrix()):j.getFinalMatrix().A(j.getLocalMatrix()),-1!==j._index){const x=null===j._index?e:j._index;j.getAbsoluteInverseBindMatrix().multiplyToArray(j.getFinalMatrix(),i,16*x)}}this._identity.copyToArray(i,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const i=this.wi().getRenderId();if(this._currentRenderId===i)return;this._currentRenderId=i}if(this._numBonesWithLinkedTransformNode>0)for(const i of this.bones)if(i._linkedTransformNode){const x=i._linkedTransformNode;i.position=x.position,x.rotationQuaternion?i.rotationQuaternion=x.rotationQuaternion:i.rotation=x.rotation,i.wJ=x.wJ}if(this.needInitialSkinMatrix)for(const i of this._meshesWithPoseMatrix){const x=i.getPoseMatrix();let e=this._isDirty;if(i._bonesTransformMatrices&&i._bonesTransformMatrices.length===16*(this.bones.length+1)||(i._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),e=!0),e){if(this._synchronizedWithMesh!==i){this._synchronizedWithMesh=i;for(const i of this.bones)if(!i.getParent()){i.getBindMatrix().multiplyToRef(x,E.TmpVectors.Matrix[1]),i._updateAbsoluteBindMatrices(E.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const x=4*(this.bones.length+1);i._transformMatrixTexture&&i._transformMatrixTexture.getSize().width===x||(i._transformMatrixTexture&&i._transformMatrixTexture.dispose(),i._transformMatrixTexture=A.e.CreateRGBATexture(i._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(i._bonesTransformMatrices,x),this.isUsingTextureForMatrices&&i._transformMatrixTexture&&i._transformMatrixTexture.update(i._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=A.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let i=0;i<this.bones.length;i++)this._animatables.push(this.bones[i])}return this._animatables}clone(i,x){const e=new T(i,x||i,this._scene);e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let j=0;j<this.bones.length;j++){const i=this.bones[j];let x=null;const E=i.getParent();if(E){const i=this.bones.indexOf(E);x=e.bones[i]}const a=new b.c(i.name,e,x,i.getBindMatrix().clone(),i.getRestMatrix().clone());a._index=i._index,i._linkedTransformNode&&a.linkTransformNode(i._linkedTransformNode),z.d.DeepCopy(i.animations,a.animations)}if(this._ranges){e._ranges={};for(const i in this._ranges){const x=this._ranges[i];x&&(e._ranges[i]=x.clone())}}return this._isDirty=!0,e.prepare(!0),e}enableBlending(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const x of this.bones)for(const e of x.animations)e.enableBlending=!0,e.blendingSpeed=i}dispose(){if(this._meshesWithPoseMatrix.length=0,this.wi().stopAnimation(this),this.wi().removeSkeleton(this),this._parentContainer){const i=this._parentContainer.skeletons.indexOf(this);i>-1&&this._parentContainer.skeletons.splice(i,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const i={};i.name=this.name,i.id=this.id,this.dimensionsAtRest&&(i.dimensionsAtRest=this.dimensionsAtRest.de()),i.bones=[],i.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){var x;const j=this.bones[e],E=j.getParent(),a={parentBoneIndex:E?this.bones.indexOf(E):-1,index:j.getIndex(),name:j.name,id:j.id,matrix:j.getBindMatrix().de(),rest:j.getRestMatrix().de(),linkedTransformNodeId:null===(x=j.getTransformNode())||void 0===x?void 0:x.id};i.bones.push(a),j.length&&(a.length=j.length),j.metadata&&(a.metadata=j.metadata),j.animations&&j.animations.length>0&&(a.animation=j.animations[0].serialize()),i.ranges=[];for(const x in this._ranges){const e=this._ranges[x];if(!e)continue;const j={};j.name=x,j.from=e.from,j.to=e.to,i.ranges.push(j)}}return i}static Parse(i,x){const e=new T(i.name,i.id,x);let j;for(i.dimensionsAtRest&&(e.dimensionsAtRest=E.KJ.zJ(i.dimensionsAtRest)),e.needInitialSkinMatrix=i.needInitialSkinMatrix,j=0;j<i.bones.length;j++){const x=i.bones[j],a=i.bones[j].index;let Y=null;x.parentBoneIndex>-1&&(Y=e.bones[x.parentBoneIndex]);const J=x.rest?E.Matrix.zJ(x.rest):null,u=new b.c(x.name,e,Y,E.Matrix.zJ(x.matrix),J,null,a);void 0!==x.id&&null!==x.id&&(u.id=x.id),x.length&&(u.length=x.length),x.metadata&&(u.metadata=x.metadata),x.animation&&u.animations.push(K.c.Parse(x.animation)),void 0!==x.linkedTransformNodeId&&null!==x.linkedTransformNodeId&&(e._hasWaitingData=!0,u._waitingTransformNodeId=x.linkedTransformNodeId)}if(i.ranges)for(j=0;j<i.ranges.length;j++){const x=i.ranges[j];e.createAnimationRange(x.name,x.from,x.to)}return e}computeAbsoluteMatrices(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||i)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(i)}getPoseMatrix(){let i=null;return this._meshesWithPoseMatrix.length>0&&(i=this._meshesWithPoseMatrix[0].getPoseMatrix()),i}sortBones(){const i=[],x=new Array(this.bones.length);for(let e=0;e<this.bones.length;e++)this._sortBones(e,i,x);this.bones=i}_sortBones(i,x,e){if(e[i])return;e[i]=!0;const j=this.bones[i];if(!j)return;void 0===j._index&&(j._index=i);const E=j.getParent();E&&this._sortBones(this.bones.indexOf(E),x,e),x.push(j)}setCurrentPoseAsRest(){for(const i of this.bones)i.setCurrentPoseAsRest()}}var Q=e(12539),t=e(12722),V=e(12227),S=e(12633),f=e(12314),w=e(12682),O=e(12648),l=e(12675),Z=e(12765),B=e(12334),k=e(13756);class N{set areUpdatesFrozen(i){i?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new B.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,i||(i=o.e.LastCreatedScene),this._scene=i,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const i=this._scene.getEngine().getCaps();this._canUseTextureForTargets=i.canUseGLVertexID&&i.textureFloat&&i.maxVertexTextureImageUnits>0&&i.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return N.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?N.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(i){this._numMaxInfluencers!==i&&(this._numMaxInfluencers=i,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(i){this._useTextureToStoreTargets!==i&&(this._useTextureToStoreTargets=i,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var i;return N.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(i=this._scene)&&void 0!==i&&i.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(i){return this._activeTargets.data[i]}getTarget(i){return this._targets[i]}getTargetByName(i){for(const x of this._targets)if(x.name===i)return x;return null}addTarget(i){this._targets.push(i),this._targetInfluenceChangedObservers.push(i.onInfluenceChanged.add((i=>{this.areUpdatesFrozen&&i&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(i)}))),this._targetDataLayoutChangedObservers.push(i._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(i){const x=this._targets.indexOf(i);x>=0&&(this._targets.splice(x,1),i.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(x,1)[0]),i._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(x,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(i)}_bind(i){i.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),i.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),i.setTexture("morphTargets",this._targetStoreTexture),i.setInt("morphTargetCount",this.numInfluencers)}clone(){const i=new N(this._scene);for(const x of this._targets)i.addTarget(x.clone());return i.enablePositionMorphing=this.enablePositionMorphing,i.enableNormalMorphing=this.enableNormalMorphing,i.enableTangentMorphing=this.enableTangentMorphing,i.enableUVMorphing=this.enableUVMorphing,i.enableUV2Morphing=this.enableUV2Morphing,i.enableColorMorphing=this.enableColorMorphing,i}serialize(){const i={};i.id=this.uniqueId,i.targets=[];for(const x of this._targets)i.targets.push(x.serialize());return i}_syncActiveTargets(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const x=!!this._targetStoreTexture,e=this.isUsingTextureForTargets;(this._mustSynchronize||x!==e)&&(this._mustSynchronize=!1,this.synchronize());let j=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let E=-1;for(const a of this._targets)if(E++,0!==a.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=N.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(a),this._morphTargetTextureIndices[j]=E,this._tempInfluences[j++]=a.influence}this._morphTargetTextureIndices.length!==j&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,j)),this._influences&&this._influences.length===j||(this._influences=new Float32Array(j));for(let a=0;a<j;a++)this._influences[a]=this._tempInfluences[a];if(i&&this._scene)for(const a of this._scene.meshes)a.morphTargetManager===this&&(e?a._markSubMeshesAsAttributesDirty():a._syncGeometryWithMorphTargetManager())}synchronize(){var i;if(!this._scene||this.areUpdatesFrozen)return;const x=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(i=this._targetStoreTexture)||void 0===i||i.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>x.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const e of this._targets){this._supportsPositions=this._supportsPositions&&e.hasPositions,this._supportsNormals=this._supportsNormals&&e.hasNormals,this._supportsTangents=this._supportsTangents&&e.hasTangents,this._supportsUVs=this._supportsUVs&&e.hasUVs,this._supportsUV2s=this._supportsUV2s&&e.hasUV2s,this._supportsColors=this._supportsColors&&e.hasColors;const i=e.vertexCount;if(0===this._vertexCount)this._vertexCount=i;else if(this._vertexCount!==i)return void M.c.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${e.name}": ${i}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const i=x.getCaps().maxTextureSize;this._textureWidth>i&&(this._textureHeight=Math.ceil(this._textureWidth/i),this._textureWidth=i);const e=this._targets.length,j=new Float32Array(e*this._textureWidth*this._textureHeight*4);let E=0;for(let x=0;x<e;x++){const i=this._targets[x],e=i.getPositions(),a=i.getNormals(),Y=i.getUVs(),J=i.getTangents(),u=i.getUV2s(),b=i.getColors();E=x*this._textureWidth*this._textureHeight*4;for(let x=0;x<this._vertexCount;x++)this._supportsPositions&&e&&(j[E]=e[3*x],j[E+1]=e[3*x+1],j[E+2]=e[3*x+2],E+=4),this._supportsNormals&&a&&(j[E]=a[3*x],j[E+1]=a[3*x+1],j[E+2]=a[3*x+2],E+=4),this._supportsUVs&&Y&&(j[E]=Y[2*x],j[E+1]=Y[2*x+1],E+=4),this._supportsTangents&&J&&(j[E]=J[3*x],j[E+1]=J[3*x+1],j[E+2]=J[3*x+2],E+=4),this._supportsUV2s&&u&&(j[E]=u[2*x],j[E+1]=u[2*x+1],E+=4),this._supportsColors&&b&&(j[E]=b[4*x],j[E+1]=b[4*x+1],j[E+2]=b[4*x+2],j[E+3]=b[4*x+3],E+=4)}this._targetStoreTexture=k.d.CreateRGBATexture(j,this._textureWidth,this._textureHeight,e,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const e of this._scene.meshes)e.morphTargetManager===this&&e._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const i=this._parentContainer.morphTargetManagers.indexOf(this);i>-1&&this._parentContainer.morphTargetManagers.splice(i,1),this._parentContainer=null}for(const i of this._targets)this._scene.stopAnimation(i)}}static Parse(i,x){const e=new N(x);for(const j of i.targets)e.addTarget(Z.c.Parse(j,x));return e}}N.EnableTextureStorage=!0,N.MaxActiveMorphTargetsInVertexAttributeMode=8,N.ConstantTargetCountForTextureMode=0;var mi=e(13806),X=e(12115),C=e(12551);const n=new Map,I=n;function d(i,x,e){p(i)&&M.c.Warn(`Extension with the name '${i}' already exists`),n.set(i,{isGLTFExtension:x,factory:e})}function p(i){return n.delete(i)}var H=e(13811),U=e(12817),D=e(12320);class h{static Get(i,x,e){if(!x||void 0==e||!x[e])throw new Error(`${i}: Failed to find index (${e})`);return x[e]}static TryGet(i,x){return i&&void 0!=x&&i[x]?i[x]:null}static Assign(i){if(i)for(let x=0;x<i.length;x++)i[x].index=x}}function F(i){if(i.min&&i.max){const x=i.min,e=i.max,j=E.TmpVectors.KJ[0].fJ(x[0],x[1],x[2]),a=E.TmpVectors.KJ[1].fJ(e[0],e[1],e[2]);if(i.normalized&&5126!==i.componentType){let x=1;switch(i.componentType){case 5120:x=127;break;case 5121:x=255;break;case 5122:x=32767;break;case 5123:x=65535}const e=1/x;j.scaleInPlace(e),a.scaleInPlace(e)}return new C.b(j,a)}return null}class R{static RegisterExtension(i,x){d(i,!1,x)}static UnregisterExtension(i){return p(i)}get Ne(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(i){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=i}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((i=>i.dispose&&i.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(i,x,e,j,E,a){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=x,this._assetContainer=e,this._loadData(j);let a=null;if(i){const x={};if(this._gltf.nodes)for(const i of this._gltf.nodes)i.name&&(x[i.name]=i.index);a=(i instanceof Array?i:[i]).map((i=>{const e=x[i];if(void 0===e)throw new Error(`Failed to find node '${i}'`);return e}))}return await this._loadAsync(E,Y,a,(()=>({meshes:this._getMeshes(),iL:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=i,this._loadData(x),await this._loadAsync(e,E,null,(()=>{}))}async _loadAsync(i,x,e,j){return await Promise.resolve().then((async()=>{this._rootUrl=i,this._uniqueRootUrl=!i.startsWith("file:")&&x?i:`${i}${Date.now()}/`,this._fileName=x,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const E=`${mi.n[mi.n.LOADING]} => ${mi.n[mi.n.READY]}`,a=`${mi.n[mi.n.LOADING]} => ${mi.n[mi.n.COMPLETE]}`;this._parent._startPerformanceCounter(E),this._parent._startPerformanceCounter(a),this._parent._setState(mi.n.LOADING),this._extensionsOnLoading();const J=new Array;if(!this.parent.loadOnlyMaterials)if(e)J.push(this.loadSceneAsync("/nodes",{nodes:e,index:-1}));else if(void 0!=this._gltf.LJ||this._gltf.scenes&&this._gltf.scenes[0]){const i=h.Get("/scene",this._gltf.scenes,this._gltf.LJ||0);J.push(this.loadSceneAsync(`/scenes/${i.index}`,i))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let i=0;i<this._gltf.materials.length;++i){const x=this._gltf.materials[i],e="/materials/"+i,j=Q.e.TriangleFillMode;J.push(this._loadMaterialAsync(e,x,null,j,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&J.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&J.push(this._compileShadowGeneratorsAsync());const u=Promise.all(J).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.cJ(!0);for(const i of this._babylonScene.materials){const x=i;void 0!==x.maxSimultaneousLights&&(x.maxSimultaneousLights=Math.max(x.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(mi.n.READY),this._skipStartAnimationStep||this._startAnimations(),j()}));return await u.then((i=>(this._parent._endPerformanceCounter(E),Y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(a),this._parent._setState(mi.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(i=>{this._parent.onErrorObservable.notifyObservers(i),this._parent.onErrorObservable.clear(),this.dispose()}))})),i)))})).catch((i=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(i),this._parent.onErrorObservable.clear(),this.dispose()),i}))}_loadData(i){if(this._gltf=i.json,this._setupData(),i.bin){const x=this._gltf.buffers;if(x&&x[0]&&!x[0].uri){const e=x[0];(e.byteLength<i.bin.byteLength-3||e.byteLength>i.bin.byteLength)&&M.c.Warn(`Binary buffer length (${e.byteLength}) from JSON does not match chunk length (${i.bin.byteLength})`),this._bin=i.bin}else M.c.Warn("Unexpected BIN chunk")}}_setupData(){if(h.Assign(this._gltf.accessors),h.Assign(this._gltf.animations),h.Assign(this._gltf.buffers),h.Assign(this._gltf.bufferViews),h.Assign(this._gltf.cameras),h.Assign(this._gltf.images),h.Assign(this._gltf.materials),h.Assign(this._gltf.meshes),h.Assign(this._gltf.nodes),h.Assign(this._gltf.samplers),h.Assign(this._gltf.scenes),h.Assign(this._gltf.skins),h.Assign(this._gltf.textures),this._gltf.nodes){const i={};for(const e of this._gltf.nodes)if(e.children)for(const x of e.children)i[x]=e.index;const x=this._createRootNode();for(const e of this._gltf.nodes){const j=i[e.index];e.parent=void 0===j?x:this._gltf.nodes[j]}}}async _loadExtensionsAsync(){const i=[];if(I.forEach(((x,e)=>{var j;!1===(null===(j=this.parent.extensionOptions[e])||void 0===j?void 0:j.enabled)?x.isGLTFExtension&&this.isExtensionUsed(e)&&M.c.Warn(`Extension ${e} is used but has been explicitly disabled.`):x.isGLTFExtension&&!this.isExtensionUsed(e)||i.push((async()=>{const i=await x.factory(this);return i.name!==e&&M.c.Warn(`The name of the glTF loader extension instance does not match the registered name: ${i.name} !== ${e}`),this._parent.onExtensionLoadedObservable.notifyObservers(i),i})())})),this._extensions.push(...await Promise.all(i)),this._extensions.sort(((i,x)=>(i.order||Number.MAX_VALUE)-(x.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const e of this._gltf.extensionsRequired){if(!this._extensions.some((i=>i.name===e&&i.enabled))){var x;if(!1===(null===(x=this.parent.extensionOptions[e])||void 0===x?void 0:x.enabled))throw new Error(`Required extension ${e} is disabled`);throw new Error(`Required extension ${e} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new l.c("__root__",this._babylonScene);this._rootBabylonMesh=i,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.cJ(!1);const x={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case mi.l.AUTO:this._babylonScene.useRightHandedSystem||(x.rotation=[0,1,0,0],x.scale=[1,1,-1],R._LoadTransform(x,this._rootBabylonMesh));break;case mi.l.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(i),x}loadSceneAsync(i,x){const e=this._extensionsLoadSceneAsync(i,x);if(e)return e;const j=new Array;if(this.logOpen(`${i} ${x.name||""}`),x.nodes)for(const E of x.nodes){const x=h.Get(`${i}/nodes/${E}`,this._gltf.nodes,E);j.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(i=>{i.parent=this._rootBabylonMesh})))}for(const E of this._postSceneLoadActions)E();return j.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(j).then((()=>{}))}_forEachPrimitive(i,x){if(i._primitiveBabylonMeshes)for(const e of i._primitiveBabylonMeshes)x(e)}_getGeometries(){const i=[],x=this._gltf.nodes;if(x)for(const e of x)this._forEachPrimitive(e,(x=>{const e=x.ye;e&&-1===i.indexOf(e)&&i.push(e)}));return i}_getMeshes(){const i=[];this._rootBabylonMesh instanceof O.e&&i.push(this._rootBabylonMesh);const x=this._gltf.nodes;if(x)for(const e of x)this._forEachPrimitive(e,(x=>{i.push(x)}));return i}_getTransformNodes(){const i=[],x=this._gltf.nodes;if(x)for(const e of x)e._babylonTransformNode&&"xb"===e._babylonTransformNode.getClassName()&&i.push(e._babylonTransformNode),e._babylonTransformNodeForSkin&&i.push(e._babylonTransformNodeForSkin);return i}_getSkeletons(){const i=[],x=this._gltf.skins;if(x)for(const e of x)e._data&&i.push(e._data.babylonSkeleton);return i}_getAnimationGroups(){const i=[],x=this._gltf.animations;if(x)for(const e of x)e._babylonAnimationGroup&&i.push(e._babylonAnimationGroup);return i}_startAnimations(){switch(this._parent.animationStartMode){case mi.i.NONE:break;case mi.i.FIRST:{const i=this._getAnimationGroups();0!==i.length&&i[0].start(!0);break}case mi.i.ALL:{const i=this._getAnimationGroups();for(const x of i)x.start(!0);break}default:return void M.c.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadNodeAsync(i,x,e);if(j)return j;if(x._babylonTransformNode)throw new Error(`${i}: Invalid recursive node hierarchy`);const E=new Array;this.logOpen(`${i} ${x.name||""}`);const a=j=>{if(R.AddPointerMetadata(j,i),R._LoadTransform(x,j),void 0!=x.camera){const e=h.Get(`${i}/camera`,this._gltf.cameras,x.camera);E.push(this.loadCameraAsync(`/cameras/${e.index}`,e,(i=>{i.parent=j,this._babylonScene.useRightHandedSystem||(j.wJ.x=-1)})))}if(x.children)for(const e of x.children){const x=h.Get(`${i}/children/${e}`,this._gltf.nodes,e);E.push(this.loadNodeAsync(`/nodes/${x.index}`,x,(i=>{i.parent=j})))}e(j)},Y=void 0!=x.mesh,J=this._parent.loadSkins&&void 0!=x.skin;if(!Y||J){const i=x.name||`node${x.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new S.d(i,this._babylonScene);e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==x.mesh?x._babylonTransformNode=e:x._babylonTransformNodeForSkin=e,a(e)}if(Y)if(J){const e=h.Get(`${i}/mesh`,this._gltf.meshes,x.mesh);E.push(this._loadMeshAsync(`/meshes/${e.index}`,x,e,(e=>{const j=x._babylonTransformNodeForSkin;e.metadata=(0,U.b)(j.metadata,e.metadata||{});const a=h.Get(`${i}/skin`,this._gltf.skins,x.skin);E.push(this._loadSkinAsync(`/skins/${a.index}`,x,a,(i=>{this._forEachPrimitive(x,(x=>{x.skeleton=i})),this._postSceneLoadActions.push((()=>{if(void 0!=a.skeleton){const i=h.Get(`/skins/${a.index}/skeleton`,this._gltf.nodes,a.skeleton).parent;x.index===i.index?e.parent=j.parent:e.parent=i._babylonTransformNode}else e.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:j,skinnedNode:e})}))})))})))}else{const e=h.Get(`${i}/mesh`,this._gltf.meshes,x.mesh);E.push(this._loadMeshAsync(`/meshes/${e.index}`,x,e,a))}return this.logClose(),Promise.all(E).then((()=>(this._forEachPrimitive(x,(i=>{const x=i;!x.isAnInstance&&x.ye&&x.ye.useBoundingInfoFromGeometry?i.Ci():i.refreshBoundingInfo(!0,!0)})),x._babylonTransformNode)))}_loadMeshAsync(i,x,e,j){const E=e.primitives;if(!E||!E.length)throw new Error(`${i}: Primitives are missing`);void 0==E[0].index&&h.Assign(E);const a=new Array;this.logOpen(`${i} ${e.name||""}`);const Y=x.name||`node${x.index}`;if(1===E.length){const j=e.primitives[0];a.push(this._loadMeshPrimitiveAsync(`${i}/primitives/${j.index}`,Y,x,e,j,(i=>{x._babylonTransformNode=i,x._primitiveBabylonMeshes=[i]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,x._babylonTransformNode=new S.d(Y,this._babylonScene),x._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._primitiveBabylonMeshes=[];for(const j of E)a.push(this._loadMeshPrimitiveAsync(`${i}/primitives/${j.index}`,`${Y}_primitive${j.index}`,x,e,j,(i=>{i.parent=x._babylonTransformNode,x._primitiveBabylonMeshes.push(i)})))}return j(x._babylonTransformNode),this.logClose(),Promise.all(a).then((()=>x._babylonTransformNode))}_loadMeshPrimitiveAsync(i,x,e,j,E,a){const Y=this._extensionsLoadMeshPrimitiveAsync(i,x,e,j,E,a);if(Y)return Y;this.logOpen(`${i}`);const J=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==e.skin&&!j.primitives[0].targets;let u,b;if(J&&E._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,u=E._instanceData.babylonSourceMesh.createInstance(x),u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b=E._instanceData.promise;else{const a=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new l.c(x,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y.sideOrientation=this._babylonScene.useRightHandedSystem?Q.e.CounterClockWiseSideOrientation:Q.e.ClockWiseSideOrientation,this._createMorphTargets(i,e,j,E,Y),a.push(this._loadVertexDataAsync(i,E,Y).then((async x=>await this._loadMorphTargetsAsync(i,E,Y,x).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,x.mx(Y),x._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const g=R._GetDrawMode(i,E.mode);if(void 0==E.material){let i=this._defaultBabylonMaterialData[g];i||(i=this._createDefaultMaterial("__GLTFLoader._default",g),this._parent.onMaterialLoadedObservable.notifyObservers(i),this._defaultBabylonMaterialData[g]=i),Y.material=i}else if(!this.parent.skipMaterials){const x=h.Get(`${i}/material`,this._gltf.materials,E.material);a.push(this._loadMaterialAsync(`/materials/${x.index}`,x,Y,g,(i=>{Y.material=i})))}b=Promise.all(a),J&&(E._instanceData={babylonSourceMesh:Y,promise:b}),u=Y}return R.AddPointerMetadata(u,i),this._parent.onMeshLoadedObservable.notifyObservers(u),a(u),this.logClose(),b.then((()=>u))}_loadVertexDataAsync(i,x,e){const j=this._extensionsLoadVertexDataAsync(i,x,e);if(j)return j;const E=x.attributes;if(!E)throw new Error(`${i}: Attributes are missing`);const a=new Array,Y=new w.b(e.name,this._babylonScene);if(void 0==x.indices)e.isUnIndexed=!0;else{const e=h.Get(`${i}/indices`,this._gltf.accessors,x.indices);a.push(this._loadIndicesAccessorAsync(`/accessors/${e.index}`,e).then((i=>{Y.setIndices(i)})))}const J=(x,j,J)=>{if(void 0==E[x])return;e._delayInfo=e._delayInfo||[],-1===e._delayInfo.indexOf(j)&&e._delayInfo.push(j);const u=h.Get(`${i}/attributes/${x}`,this._gltf.accessors,E[x]);a.push(this._loadVertexAccessorAsync(`/accessors/${u.index}`,u,j).then((i=>{if(i.getKind()===f.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!e.skeleton){const i=F(u);i&&(Y._boundingInfo=i,Y.useBoundingInfoFromGeometry=!0)}Y.setVerticesBuffer(i,u.count)}))),j==f.f.MatricesIndicesExtraKind&&(e.numBoneInfluencers=8),J&&J(u)};return J("POSITION",f.f.PositionKind),J("NORMAL",f.f.NormalKind),J("TANGENT",f.f.TangentKind),J("TEXCOORD_0",f.f.UVKind),J("TEXCOORD_1",f.f.UV2Kind),J("TEXCOORD_2",f.f.UV3Kind),J("TEXCOORD_3",f.f.UV4Kind),J("TEXCOORD_4",f.f.UV5Kind),J("TEXCOORD_5",f.f.UV6Kind),J("JOINTS_0",f.f.MatricesIndicesKind),J("WEIGHTS_0",f.f.MatricesWeightsKind),J("JOINTS_1",f.f.MatricesIndicesExtraKind),J("WEIGHTS_1",f.f.MatricesWeightsExtraKind),J("COLOR_0",f.f.ColorKind,(i=>{"VEC4"===i.type&&(e.hasVertexAlpha=!0)})),Promise.all(a).then((()=>Y))}_createMorphTargets(i,x,e,j,E){if(!j.targets||!this._parent.loadMorphTargets)return;if(void 0==x._numMorphTargets)x._numMorphTargets=j.targets.length;else if(j.targets.length!==x._numMorphTargets)throw new Error(`${i}: Primitives do not have the same number of targets`);const a=e.extras?e.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,E.morphTargetManager=new N(this._babylonScene),E.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,E.morphTargetManager.areUpdatesFrozen=!0;for(let Y=0;Y<j.targets.length;Y++){const i=x.weights?x.weights[Y]:e.weights?e.weights[Y]:0,j=a?a[Y]:`morphTarget${Y}`;E.morphTargetManager.addTarget(new Z.c(j,i,E.wi()))}}_loadMorphTargetsAsync(i,x,e,j){if(!x.targets||!this._parent.loadMorphTargets)return Promise.resolve();const E=new Array,a=e.morphTargetManager;for(let Y=0;Y<a.numTargets;Y++){const e=a.getTarget(Y);E.push(this._loadMorphTargetVertexDataAsync(`${i}/targets/${Y}`,j,x.targets[Y],e))}return Promise.all(E).then((()=>{a.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(i,x,e,j){const E=new Array,a=(j,a,Y)=>{if(void 0==e[j])return;const J=x.getVertexBuffer(a);if(!J)return;const u=h.Get(`${i}/${j}`,this._gltf.accessors,e[j]);E.push(this._loadFloatAccessorAsync(`/accessors/${u.index}`,u).then((i=>{Y(J,i)})))};return a("POSITION",f.f.PositionKind,((i,x)=>{const e=new Float32Array(x.length);i.forEach(x.length,((i,j)=>{e[j]=x[j]+i})),j.setPositions(e)})),a("NORMAL",f.f.NormalKind,((i,x)=>{const e=new Float32Array(x.length);i.forEach(e.length,((i,j)=>{e[j]=x[j]+i})),j.setNormals(e)})),a("TANGENT",f.f.TangentKind,((i,x)=>{const e=new Float32Array(x.length/3*4);let E=0;i.forEach(x.length/3*4,((i,j)=>{(j+1)%4!==0&&(e[E]=x[E]+i,E++)})),j.setTangents(e)})),a("TEXCOORD_0",f.f.UVKind,((i,x)=>{const e=new Float32Array(x.length);i.forEach(x.length,((i,j)=>{e[j]=x[j]+i})),j.setUVs(e)})),a("TEXCOORD_1",f.f.UV2Kind,((i,x)=>{const e=new Float32Array(x.length);i.forEach(x.length,((i,j)=>{e[j]=x[j]+i})),j.setUV2s(e)})),a("COLOR_0",f.f.ColorKind,((x,e)=>{let E=null;const a=x.getSize();if(3===a){E=new Float32Array(e.length/3*4),x.forEach(e.length,((i,x)=>{const j=Math.floor(x/3),a=x%3;E[4*j+a]=e[3*j+a]+i}));for(let i=0;i<e.length/3;++i)E[4*i+3]=1}else{if(4!==a)throw new Error(`${i}: Invalid number of components (${a}) for COLOR_0 attribute`);E=new Float32Array(e.length),x.forEach(e.length,((i,x)=>{E[x]=e[x]+i}))}j.setColors(E)})),await Promise.all(E).then((()=>{}))}static _LoadTransform(i,x){if(void 0!=i.skin)return;let e=E.KJ.Zero(),j=E.Quaternion.Identity(),a=E.KJ.One();if(i.matrix){E.Matrix.zJ(i.matrix).decompose(a,j,e)}else i.translation&&(e=E.KJ.zJ(i.translation)),i.rotation&&(j=E.Quaternion.zJ(i.rotation)),i.scale&&(a=E.KJ.zJ(i.scale));x.position=e,x.rotationQuaternion=j,x.wJ=a}_loadSkinAsync(i,x,e,j){if(!this._parent.loadSkins)return Promise.resolve();const E=this._extensionsLoadSkinAsync(i,x,e);if(E)return E;if(e._data)return j(e._data.babylonSkeleton),e._data.promise;const a=`skeleton${e.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new T(e.name||a,a,this._babylonScene);Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(i,e,Y);const J=this._loadSkinInverseBindMatricesDataAsync(i,e).then((i=>{this._updateBoneMatrices(Y,i)}));return e._data={babylonSkeleton:Y,promise:J},j(Y),J}_loadBones(i,x,e){if(void 0==x.skeleton||this._parent.alwaysComputeSkeletonRootNode){const e=this._findSkeletonRootNode(`${i}/joints`,x.joints);if(e)if(void 0===x.skeleton)x.skeleton=e.index;else{const j=(i,x)=>{for(;x.parent;x=x.parent)if(x.parent===i)return!0;return!1},E=h.Get(`${i}/skeleton`,this._gltf.nodes,x.skeleton);E===e||j(E,e)||(M.c.Warn(`${i}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),x.skeleton=e.index)}else M.c.Warn(`${i}: Failed to find common root`)}const j={};for(const E of x.joints){const a=h.Get(`${i}/joints/${E}`,this._gltf.nodes,E);this._loadBone(a,x,e,j)}}_findSkeletonRootNode(i,x){if(0===x.length)return null;const e={};for(const E of x){const x=[];let j=h.Get(`${i}/${E}`,this._gltf.nodes,E);for(;-1!==j.index;)x.unshift(j),j=j.parent;e[E]=x}let j=null;for(let E=0;;++E){let i=e[x[0]];if(E>=i.length)return j;const a=i[E];for(let Y=1;Y<x.length;++Y)if(i=e[x[Y]],E>=i.length||a!==i[E])return j;j=a}}_loadBone(i,x,e,j){i._isJoint=!0;let E=j[i.index];if(E)return E;let a=null;i.index!==x.skeleton&&(i.parent&&-1!==i.parent.index?a=this._loadBone(i.parent,x,e,j):void 0!==x.skeleton&&M.c.Warn(`/skins/${x.index}/skeleton: Skeleton node is not a common root`));const Y=x.joints.indexOf(i.index);return E=new b.c(i.name||`joint${i.index}`,e,a,this._getNodeMatrix(i),null,null,Y),j[i.index]=E,this._postSceneLoadActions.push((()=>{E.linkTransformNode(i._babylonTransformNode)})),E}_loadSkinInverseBindMatricesDataAsync(i,x){if(void 0==x.inverseBindMatrices)return Promise.resolve(null);const e=h.Get(`${i}/inverseBindMatrices`,this._gltf.accessors,x.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${e.index}`,e)}_updateBoneMatrices(i,x){for(const e of i.bones){const i=E.Matrix.Identity(),j=e._index;x&&-1!==j&&(E.Matrix.FromArrayToRef(x,16*j,i),i.invertToRef(i));const a=e.getParent();a&&i.multiplyToRef(a.getAbsoluteInverseBindMatrix(),i),e.he(i,!1,!1),e._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(i){return i.matrix?E.Matrix.zJ(i.matrix):E.Matrix.Compose(i.scale?E.KJ.zJ(i.scale):E.KJ.One(),i.rotation?E.Quaternion.zJ(i.rotation):E.Quaternion.Identity(),i.translation?E.KJ.zJ(i.translation):E.KJ.Zero())}loadCameraAsync(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadCameraAsync(i,x,e);if(j)return j;const a=new Array;this.logOpen(`${i} ${x.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y=new u.b(x.name||`camera${x.index}`,E.KJ.Zero(),this._babylonScene,!1);switch(Y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonCamera=Y,Y.setTarget(new E.KJ(0,0,-1)),x.type){case"perspective":{const e=x.perspective;if(!e)throw new Error(`${i}: Camera perspective properties are missing`);Y.fov=e.yfov,Y.De=e.znear,Y.maxZ=e.zfar||0;break}case"orthographic":if(!x.orthographic)throw new Error(`${i}: Camera orthographic properties are missing`);Y.mode=J.b.ORTHOGRAPHIC_CAMERA,Y.orthoLeft=-x.orthographic.xmag,Y.orthoRight=x.orthographic.xmag,Y.orthoBottom=-x.orthographic.ymag,Y.orthoTop=x.orthographic.ymag,Y.De=x.orthographic.znear,Y.maxZ=x.orthographic.zfar;break;default:throw new Error(`${i}: Invalid camera type (${x.type})`)}return R.AddPointerMetadata(Y,i),this._parent.onCameraLoadedObservable.notifyObservers(Y),e(Y),this.logClose(),Promise.all(a).then((()=>Y))}_loadAnimationsAsync(){const i=this._gltf.animations;if(!i)return Promise.resolve();const x=new Array;for(let e=0;e<i.length;e++){const j=i[e];x.push(this.loadAnimationAsync(`/animations/${j.index}`,j).then((i=>{0===i.targetedAnimations.length&&i.dispose()})))}return Promise.all(x).then((()=>{}))}loadAnimationAsync(i,x){const j=this._extensionsLoadAnimationAsync(i,x);return j||e.e(78).then(e.bind(e,15311)).then((e=>{let{AnimationGroup:j}=e;this._babylonScene._blockEntityCollection=!!this._assetContainer;const E=new j(x.name||`animation${x.index}`,this._babylonScene);E._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,x._babylonAnimationGroup=E;const a=new Array;h.Assign(x.channels),h.Assign(x.samplers);for(const Y of x.channels)a.push(this._loadAnimationChannelAsync(`${i}/channels/${Y.index}`,i,x,Y,((i,x)=>{i.animations=i.animations||[],i.animations.push(x),E.addTargetedAnimation(x,i)})));return Promise.all(a).then((()=>(E.normalize(0),E)))}))}async _loadAnimationChannelAsync(i,x,j,E,a){const Y=this._extensionsLoadAnimationChannelAsync(i,x,j,E,a);if(Y)return await Y;if(void 0==E.target.node)return await Promise.resolve();const J=h.Get(`${i}/target/node`,this._gltf.nodes,E.target.node),u=E.target.path,b="weights"===u;if(b&&!J._numMorphTargets||!b&&!J._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!b&&!J._isJoint)return await Promise.resolve();let g;switch(await Promise.resolve().then(e.bind(e,13821)),u){case"translation":var A;g=null===(A=(0,H.e)("/nodes/{}/translation"))||void 0===A?void 0:A.interpolation;break;case"rotation":var K;g=null===(K=(0,H.e)("/nodes/{}/rotation"))||void 0===K?void 0:K.interpolation;break;case"scale":var L;g=null===(L=(0,H.e)("/nodes/{}/scale"))||void 0===L?void 0:L.interpolation;break;case"weights":var o;g=null===(o=(0,H.e)("/nodes/{}/weights"))||void 0===o?void 0:o.interpolation;break;default:throw new Error(`${i}/target/path: Invalid value (${E.target.path})`)}if(!g)throw new Error(`${i}/target/path: Could not find interpolation properties for target path (${E.target.path})`);const M={object:J,info:g};return await this._loadAnimationChannelFromTargetInfoAsync(i,x,j,E,M,a)}_loadAnimationChannelFromTargetInfoAsync(i,x,e,j,E,a){const Y=this.parent.targetFps,J=1/Y,u=h.Get(`${i}/sampler`,e.samplers,j.sampler);return this._loadAnimationSamplerAsync(`${x}/samplers/${j.sampler}`,u).then((i=>{let x=0;const u=E.object,b=E.info;for(const E of b){const b=E.getStride(u),g=i.input,A=i.output,K=new Array(g.length);let L=0;switch(i.interpolation){case"STEP":for(let i=0;i<g.length;i++){const x=E.getValue(u,A,L,1);L+=b,K[i]={frame:g[i]*Y,value:x,interpolation:1}}break;case"CUBICSPLINE":for(let i=0;i<g.length;i++){const x=E.getValue(u,A,L,J);L+=b;const e=E.getValue(u,A,L,1);L+=b;const j=E.getValue(u,A,L,J);L+=b,K[i]={frame:g[i]*Y,inTangent:x,value:e,outTangent:j}}break;case"LINEAR":for(let i=0;i<g.length;i++){const x=E.getValue(u,A,L,1);L+=b,K[i]={frame:g[i]*Y,value:x}}}if(L>0){const i=`${e.name||`animation${e.index}`}_channel${j.index}_${x}`,J=E.buildAnimations(u,i,Y,K);for(const e of J)x++,a(e.babylonAnimatable,e.babylonAnimation)}}}))}_loadAnimationSamplerAsync(i,x){if(x._data)return x._data;const e=x.interpolation||"LINEAR";switch(e){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${i}/interpolation: Invalid value (${x.interpolation})`)}const j=h.Get(`${i}/input`,this._gltf.accessors,x.input),E=h.Get(`${i}/output`,this._gltf.accessors,x.output);return x._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${j.index}`,j),this._loadFloatAccessorAsync(`/accessors/${E.index}`,E)]).then((i=>{let[x,j]=i;return{input:x,interpolation:e,output:j}})),x._data}loadBufferAsync(i,x,e,j){const E=this._extensionsLoadBufferAsync(i,x,e,j);if(E)return E;if(!x._data)if(x.uri)x._data=this.loadUriAsync(`${i}/uri`,x,x.uri);else{if(!this._bin)throw new Error(`${i}: Uri is missing or the binary glTF is missing its binary chunk`);x._data=this._bin.readAsync(0,x.byteLength)}return x._data.then((x=>{try{return new Uint8Array(x.buffer,x.byteOffset+e,j)}catch(E){throw new Error(`${i}: ${E.message}`)}}))}loadBufferViewAsync(i,x){const e=this._extensionsLoadBufferViewAsync(i,x);if(e)return e;if(x._data)return x._data;const j=h.Get(`${i}/buffer`,this._gltf.buffers,x.buffer);return x._data=this.loadBufferAsync(`/buffers/${j.index}`,j,x.byteOffset||0,x.byteLength),x._data}_loadAccessorAsync(i,x,e){if(x._data)return x._data;const j=R._GetNumComponents(i,x.type),E=j*f.f.GetTypeByteLength(x.componentType),a=j*x.count;if(void 0==x.bufferView)x._data=Promise.resolve(new e(a));else{const Y=h.Get(`${i}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y).then((J=>{if(5126!==x.componentType||x.normalized||Y.byteStride&&Y.byteStride!==E){const i=new e(a);return f.f.ForEach(J,x.byteOffset||0,Y.byteStride||E,j,x.componentType,i.length,x.normalized||!1,((x,e)=>{i[e]=x})),i}return R._GetTypedArray(i,x.componentType,J,x.byteOffset,a)}))}if(x.sparse){const a=x.sparse;x._data=x._data.then((Y=>{const J=Y,u=h.Get(`${i}/sparse/indices/bufferView`,this._gltf.bufferViews,a.indices.bufferView),b=h.Get(`${i}/sparse/values/bufferView`,this._gltf.bufferViews,a.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${u.index}`,u),this.loadBufferViewAsync(`/bufferViews/${b.index}`,b)]).then((Y=>{let[u,b]=Y;const g=R._GetTypedArray(`${i}/sparse/indices`,a.indices.componentType,u,a.indices.byteOffset,a.count),A=j*a.count;let K;if(5126!==x.componentType||x.normalized){const Y=R._GetTypedArray(`${i}/sparse/values`,x.componentType,b,a.values.byteOffset,A);K=new e(A),f.f.ForEach(Y,0,E,j,x.componentType,K.length,x.normalized||!1,((i,x)=>{K[x]=i}))}else K=R._GetTypedArray(`${i}/sparse/values`,x.componentType,b,a.values.byteOffset,A);let L=0;for(let i=0;i<g.length;i++){let x=g[i]*j;for(let i=0;i<j;i++)J[x++]=K[L++]}return J}))}))}return x._data}_loadFloatAccessorAsync(i,x){return this._loadAccessorAsync(i,x,Float32Array)}_loadIndicesAccessorAsync(i,x){if("SCALAR"!==x.type)throw new Error(`${i}/type: Invalid value ${x.type}`);if(5121!==x.componentType&&5123!==x.componentType&&5125!==x.componentType)throw new Error(`${i}/componentType: Invalid value ${x.componentType}`);if(x._data)return x._data;if(x.sparse){const e=R._GetTypedArrayConstructor(`${i}/componentType`,x.componentType);x._data=this._loadAccessorAsync(i,x,e)}else{const e=h.Get(`${i}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>R._GetTypedArray(i,x.componentType,e,x.byteOffset,x.count)))}return x._data}_loadVertexBufferViewAsync(i){if(i._babylonBuffer)return i._babylonBuffer;const x=this._babylonScene.getEngine();return i._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then((i=>new f.d(x,i,!1))),i._babylonBuffer}_loadVertexAccessorAsync(i,x,e){var j;if(null!==(j=x._babylonVertexBuffer)&&void 0!==j&&j[e])return x._babylonVertexBuffer[e];x._babylonVertexBuffer||(x._babylonVertexBuffer={});const E=this._babylonScene.getEngine();if(x.sparse||void 0==x.bufferView)x._babylonVertexBuffer[e]=this._loadFloatAccessorAsync(i,x).then((i=>new f.f(E,i,e,!1)));else{const j=h.Get(`${i}/bufferView`,this._gltf.bufferViews,x.bufferView);x._babylonVertexBuffer[e]=this._loadVertexBufferViewAsync(j).then((a=>{const Y=R._GetNumComponents(i,x.type);return new f.f(E,a,e,!1,void 0,j.byteStride,void 0,x.byteOffset,Y,x.componentType,x.normalized,!0,void 0,!0)}))}return x._babylonVertexBuffer[e]}_loadMaterialMetallicRoughnessPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return x&&(x.baseColorFactor?(e.albedoColor=a.MJ.zJ(x.baseColorFactor),e.alpha=x.baseColorFactor[3]):e.albedoColor=a.MJ.White(),e.metallic=void 0==x.metallicFactor?1:x.metallicFactor,e.roughness=void 0==x.roughnessFactor?1:x.roughnessFactor,x.baseColorTexture&&j.push(this.loadTextureInfoAsync(`${i}/baseColorTexture`,x.baseColorTexture,(i=>{i.name=`${e.name} (Base Color)`,e.albedoTexture=i}))),x.metallicRoughnessTexture&&(x.metallicRoughnessTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${i}/metallicRoughnessTexture`,x.metallicRoughnessTexture,(i=>{i.name=`${e.name} (Metallic Roughness)`,e.metallicTexture=i}))),e.useMetallnessFromMetallicTextureBlue=!0,e.useRoughnessFromMetallicTextureGreen=!0,e.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(j).then((()=>{}))}_loadMaterialAsync(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const a=this._extensionsLoadMaterialAsync(i,x,e,j,E);if(a)return a;x._data=x._data||{};let Y=x._data[j];if(!Y){this.logOpen(`${i} ${x.name||""}`);const e=this.createMaterial(i,x,j);Y={babylonMaterial:e,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(i,x,e)},x._data[j]=Y,R.AddPointerMetadata(e,i),this._parent.onMaterialLoadedObservable.notifyObservers(e),this.logClose()}return e&&(Y.babylonMeshes.push(e),e.te.addOnce((()=>{const i=Y.babylonMeshes.indexOf(e);-1!==i&&Y.babylonMeshes.splice(i,1)}))),E(Y.babylonMaterial),Y.promise.then((()=>Y.babylonMaterial))}_createDefaultMaterial(i,x){this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new t.e(i,this._babylonScene);return e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.fillMode=x,e.enableSpecularAntiAliasing=!0,e.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,e.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,e.transparencyMode=t.e.PBRMATERIAL_OPAQUE,e.metallic=1,e.roughness=1,e}createMaterial(i,x,e){const j=this._extensionsCreateMaterial(i,x,e);if(j)return j;const E=x.name||`material${x.index}`;return this._createDefaultMaterial(E,e)}loadMaterialPropertiesAsync(i,x,e){const j=this._extensionsLoadMaterialPropertiesAsync(i,x,e);if(j)return j;const E=new Array;return E.push(this.loadMaterialBasePropertiesAsync(i,x,e)),x.pbrMetallicRoughness&&E.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${i}/pbrMetallicRoughness`,x.pbrMetallicRoughness,e)),this.loadMaterialAlphaProperties(i,x,e),Promise.all(E).then((()=>{}))}loadMaterialBasePropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return e.emissiveColor=x.emissiveFactor?a.MJ.zJ(x.emissiveFactor):new a.MJ(0,0,0),x.doubleSided&&(e.qe=!1,e.twoSidedLighting=!0),x.normalTexture&&(x.normalTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${i}/normalTexture`,x.normalTexture,(i=>{i.name=`${e.name} (Normal)`,e.bumpTexture=i}))),e.invertNormalMapX=!this._babylonScene.useRightHandedSystem,e.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=x.normalTexture.scale&&e.bumpTexture&&(e.bumpTexture.level=x.normalTexture.scale),e.forceIrradianceInFragment=!0),x.occlusionTexture&&(x.occlusionTexture.nonColorData=!0,j.push(this.loadTextureInfoAsync(`${i}/occlusionTexture`,x.occlusionTexture,(i=>{i.name=`${e.name} (Occlusion)`,e.ambientTexture=i}))),e.useAmbientInGrayScale=!0,void 0!=x.occlusionTexture.strength&&(e.ambientTextureStrength=x.occlusionTexture.strength)),x.emissiveTexture&&j.push(this.loadTextureInfoAsync(`${i}/emissiveTexture`,x.emissiveTexture,(i=>{i.name=`${e.name} (Emissive)`,e.emissiveTexture=i}))),Promise.all(j).then((()=>{}))}loadMaterialAlphaProperties(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);switch(x.alphaMode||"OPAQUE"){case"OPAQUE":e.transparencyMode=t.e.PBRMATERIAL_OPAQUE,e.alpha=1;break;case"MASK":e.transparencyMode=t.e.PBRMATERIAL_ALPHATEST,e.alphaCutOff=void 0==x.alphaCutoff?.5:x.alphaCutoff,e.albedoTexture&&(e.albedoTexture.He=!0);break;case"BLEND":e.transparencyMode=t.e.PBRMATERIAL_ALPHABLEND,e.albedoTexture&&(e.albedoTexture.He=!0,e.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${i}/alphaMode: Invalid value (${x.alphaMode})`)}}loadTextureInfoAsync(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureInfoAsync(i,x,e);if(j)return j;if(this.logOpen(`${i}`),x.texCoord>=6)throw new Error(`${i}/texCoord: Invalid value (${x.texCoord})`);const E=h.Get(`${i}/index`,this._gltf.textures,x.index);E._textureInfo=x;const a=this._loadTextureAsync(`/textures/${x.index}`,E,(j=>{j.coordinatesIndex=x.texCoord||0,R.AddPointerMetadata(j,i),this._parent.onTextureLoadedObservable.notifyObservers(j),e(j)}));return this.logClose(),a}_loadTextureAsync(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const j=this._extensionsLoadTextureAsync(i,x,e);if(j)return j;this.logOpen(`${i} ${x.name||""}`);const E=void 0==x.sampler?R.DefaultSampler:h.Get(`${i}/sampler`,this._gltf.samplers,x.sampler),a=h.Get(`${i}/source`,this._gltf.images,x.source),Y=this._createTextureAsync(i,E,a,e,void 0,!x._textureInfo.nonColorData);return this.logClose(),Y}_createTextureAsync(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},a=arguments.length>4?arguments[4]:void 0,Y=arguments.length>5?arguments[5]:void 0;const J=this._loadSampler(`/samplers/${x.index}`,x),u=new Array,b=new j;this._babylonScene._blockEntityCollection=!!this._assetContainer;const g={noMipmap:J.noMipMaps,invertY:!1,samplingMode:J.samplingMode,W:()=>{this._disposed||b.resolve()},onError:(x,e)=>{this._disposed||b.reject(new Error(`${i}: ${e&&e.message?e.message:x||"Failed to load texture"}`))},mimeType:e.mimeType??(0,X.j)(e.uri??""),loaderOptions:a,useSRGBBuffer:!!Y&&this._parent.useSRGBBuffers},A=new V.d(null,this._babylonScene,g);return A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u.push(b.promise),u.push(this.loadImageAsync(`/images/${e.index}`,e).then((i=>{const x=e.uri||`${this._fileName}#image${e.index}`,j=`data:${this._uniqueRootUrl}${x}`;A.updateURL(j,i);const E=A.getInternalTexture();E&&(E.label=e.name)}))),A.wrapU=J.wrapU,A.wrapV=J.wrapV,E(A),this._parent.useGltfTextureNames&&(A.name=e.name||e.uri||`image${e.index}`),Promise.all(u).then((()=>A))}_loadSampler(i,x){return x._data||(x._data={noMipMaps:9728===x.minFilter||9729===x.minFilter,samplingMode:R._GetTextureSamplingMode(i,x),wrapU:R._GetTextureWrapMode(`${i}/wrapS`,x.wrapS),wrapV:R._GetTextureWrapMode(`${i}/wrapT`,x.wrapT)}),x._data}loadImageAsync(i,x){if(!x._data){if(this.logOpen(`${i} ${x.name||""}`),x.uri)x._data=this.loadUriAsync(`${i}/uri`,x,x.uri);else{const e=h.Get(`${i}/bufferView`,this._gltf.bufferViews,x.bufferView);x._data=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e)}this.logClose()}return x._data}loadUriAsync(i,x,e){const j=this._extensionsLoadUriAsync(i,x,e);if(j)return j;if(!R._ValidateUri(e))throw new Error(`${i}: '${e}' is invalid`);if((0,X.l)(e)){const x=new Uint8Array((0,X.d)(e));return this.log(`${i}: Decoded ${e.substring(0,64)}... (${x.length} bytes)`),Promise.resolve(x)}return this.log(`${i}: Loading ${e}`),this._parent.preprocessUrlAsync(this._rootUrl+e).then((x=>new Promise(((j,E)=>{this._parent._loadFile(this._babylonScene,x,(x=>{this._disposed||(this.log(`${i}: Loaded ${e} (${x.byteLength} bytes)`),j(new Uint8Array(x)))}),!0,(x=>{E(new X.o(`${i}: Failed to load '${e}'${x?": "+x.status+" "+x.statusText:""}`,x))}))}))))}static AddPointerMetadata(i,x){i.metadata=i.metadata||{};const e=i._internalMetadata=i._internalMetadata||{},j=e.Ne=e.Ne||{};(j.pointers=j.pointers||[]).push(x)}static _GetTextureWrapMode(i,x){switch(x=void 0==x?10497:x){case 33071:return V.d.CLAMP_ADDRESSMODE;case 33648:return V.d.MIRROR_ADDRESSMODE;case 10497:return V.d.WRAP_ADDRESSMODE;default:return M.c.Warn(`${i}: Invalid value (${x})`),V.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(i,x){const e=void 0==x.magFilter?9729:x.magFilter,j=void 0==x.minFilter?9987:x.minFilter;if(9729===e)switch(j){case 9728:return V.d.LINEAR_NEAREST;case 9729:return V.d.LINEAR_LINEAR;case 9984:return V.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return V.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return V.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return V.d.LINEAR_LINEAR_MIPLINEAR;default:return M.c.Warn(`${i}/minFilter: Invalid value (${j})`),V.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==e&&M.c.Warn(`${i}/magFilter: Invalid value (${e})`),j){case 9728:return V.d.NEAREST_NEAREST;case 9729:return V.d.NEAREST_LINEAR;case 9984:return V.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return V.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return V.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return V.d.NEAREST_LINEAR_MIPLINEAR;default:return M.c.Warn(`${i}/minFilter: Invalid value (${j})`),V.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(i,x){try{return(0,D.q)(x)}catch(e){throw new Error(`${i}: ${e.message}`)}}static _GetTypedArray(i,x,e,j,E){const a=e.buffer;j=e.byteOffset+(j||0);const Y=R._GetTypedArrayConstructor(`${i}/componentType`,x),J=f.f.GetTypeByteLength(x);return j%J!==0?(M.c.Warn(`${i}: Copying buffer as byte offset (${j}) is not a multiple of component type byte length (${J})`),new Y(a.slice(j,j+E*J),0)):new Y(a,j,E)}static _GetNumComponents(i,x){switch(x){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${i}: Invalid type (${x})`)}static _ValidateUri(i){return Y.Tools.IsBase64(i)||-1===i.indexOf("..")}static _GetDrawMode(i,x){switch(void 0==x&&(x=4),x){case 0:return Q.e.PointListDrawMode;case 1:return Q.e.LineListDrawMode;case 2:return Q.e.LineLoopDrawMode;case 3:return Q.e.LineStripDrawMode;case 4:return Q.e.TriangleFillMode;case 5:return Q.e.TriangleStripDrawMode;case 6:return Q.e.TriangleFanDrawMode}throw new Error(`${i}: Invalid mesh primitive mode (${x})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const i=new Array;if(this._gltf.materials)for(const x of this._gltf.materials)if(x._data)for(const e in x._data){const j=x._data[e];for(const x of j.babylonMeshes){x.Re(!0);const e=j.babylonMaterial;i.push(e.forceCompilationAsync(x)),i.push(e.forceCompilationAsync(x,{useInstances:!0})),this._parent.useClipPlane&&(i.push(e.forceCompilationAsync(x,{clipPlane:!0})),i.push(e.forceCompilationAsync(x,{clipPlane:!0,useInstances:!0})))}}return Promise.all(i).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const i=new Array,x=this._babylonScene.lights;for(const e of x){const x=e.getShadowGenerator();x&&i.push(x.forceCompilationAsync())}return Promise.all(i).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(i){for(const x of this._extensions)x.enabled&&i(x)}_applyExtensions(i,x,e){for(const j of this._extensions)if(j.enabled){const E=`${j.name}.${x}`,a=i;a._activeLoaderExtensionFunctions=a._activeLoaderExtensionFunctions||{};const Y=a._activeLoaderExtensionFunctions;if(!Y[E]){Y[E]=!0;try{const i=e(j);if(i)return i}finally{delete Y[E]}}}return null}_extensionsOnLoading(){this._forEachExtensions((i=>i.onLoading&&i.onLoading()))}_extensionsOnReady(){this._forEachExtensions((i=>i.onReady&&i.onReady()))}_extensionsLoadSceneAsync(i,x){return this._applyExtensions(x,"loadScene",(e=>e.loadSceneAsync&&e.loadSceneAsync(i,x)))}_extensionsLoadNodeAsync(i,x,e){return this._applyExtensions(x,"loadNode",(j=>j.loadNodeAsync&&j.loadNodeAsync(i,x,e)))}_extensionsLoadCameraAsync(i,x,e){return this._applyExtensions(x,"loadCamera",(j=>j.loadCameraAsync&&j.loadCameraAsync(i,x,e)))}_extensionsLoadVertexDataAsync(i,x,e){return this._applyExtensions(x,"loadVertexData",(j=>j._loadVertexDataAsync&&j._loadVertexDataAsync(i,x,e)))}_extensionsLoadMeshPrimitiveAsync(i,x,e,j,E,a){return this._applyExtensions(E,"loadMeshPrimitive",(Y=>Y._loadMeshPrimitiveAsync&&Y._loadMeshPrimitiveAsync(i,x,e,j,E,a)))}_extensionsLoadMaterialAsync(i,x,e,j,E){return this._applyExtensions(x,"loadMaterial",(a=>a._loadMaterialAsync&&a._loadMaterialAsync(i,x,e,j,E)))}_extensionsCreateMaterial(i,x,e){return this._applyExtensions(x,"createMaterial",(j=>j.createMaterial&&j.createMaterial(i,x,e)))}_extensionsLoadMaterialPropertiesAsync(i,x,e){return this._applyExtensions(x,"loadMaterialProperties",(j=>j.loadMaterialPropertiesAsync&&j.loadMaterialPropertiesAsync(i,x,e)))}_extensionsLoadTextureInfoAsync(i,x,e){return this._applyExtensions(x,"loadTextureInfo",(j=>j.loadTextureInfoAsync&&j.loadTextureInfoAsync(i,x,e)))}_extensionsLoadTextureAsync(i,x,e){return this._applyExtensions(x,"loadTexture",(j=>j._loadTextureAsync&&j._loadTextureAsync(i,x,e)))}_extensionsLoadAnimationAsync(i,x){return this._applyExtensions(x,"loadAnimation",(e=>e.loadAnimationAsync&&e.loadAnimationAsync(i,x)))}_extensionsLoadAnimationChannelAsync(i,x,e,j,E){return this._applyExtensions(e,"loadAnimationChannel",(a=>a._loadAnimationChannelAsync&&a._loadAnimationChannelAsync(i,x,e,j,E)))}_extensionsLoadSkinAsync(i,x,e){return this._applyExtensions(e,"loadSkin",(j=>j._loadSkinAsync&&j._loadSkinAsync(i,x,e)))}_extensionsLoadUriAsync(i,x,e){return this._applyExtensions(x,"loadUri",(j=>j._loadUriAsync&&j._loadUriAsync(i,x,e)))}_extensionsLoadBufferViewAsync(i,x){return this._applyExtensions(x,"loadBufferView",(e=>e.loadBufferViewAsync&&e.loadBufferViewAsync(i,x)))}_extensionsLoadBufferAsync(i,x,e,j){return this._applyExtensions(x,"loadBuffer",(E=>E.loadBufferAsync&&E.loadBufferAsync(i,x,e,j)))}static LoadExtensionAsync(i,x,e,j){if(!x.extensions)return null;const E=x.extensions[e];return E?j(`${i}/extensions/${e}`,E):null}static LoadExtraAsync(i,x,e,j){if(!x.extras)return null;const E=x.extras[e];return E?j(`${i}/extras/${e}`,E):null}isExtensionUsed(i){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(i)}logOpen(i){this._parent._logOpen(i)}logClose(){this._parent._logClose()}log(i){this._parent._log(i)}startPerformanceCounter(i){this._parent._startPerformanceCounter(i)}endPerformanceCounter(i){this._parent._endPerformanceCounter(i)}}R.DefaultSampler={index:-1},mi.e._CreateGLTF2Loader=i=>new R(i);var y=e(13821),r=e(12413),c=e(12278),P=e(13827),q=e(13831);class W extends q.c{constructor(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",i),this._texture=i.getEngine().createRawCubeTexture(x,e,j,E,a,Y,J,u)}update(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,i,x,e,j,E)}updateRGBDAsync(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,P.k)(this._texture,i,x,e,j).then((()=>{}))}clone(){return c.b.Clone((()=>{const i=this.wi(),x=this._texture,e=new W(i,x._bufferViewArray,x.width,x.format,x.type,x.generateMipMaps,x.invertY,x.samplingMode,x._compression);return 13===x.source&&e.updateRGBDAsync(x._bufferViewArrayArray,x._sphericalPolynomial,x._lodGenerationScale,x._lodGenerationOffset),e}),this)}}const G="EXT_lights_image_based";class v{constructor(i){this.name=G,this._loader=i,this.enabled=this._loader.isExtensionUsed(G)}dispose(){this._loader=null,delete this._lights}onLoading(){const i=this._loader.Ne.extensions;if(i&&i[this.name]){const x=i[this.name];this._lights=x.lights}}loadSceneAsync(i,x){return R.LoadExtensionAsync(i,x,this.name,(async(e,j)=>{this._loader._allMaterialsDirtyRequired=!0;const E=new Array;E.push(this._loader.loadSceneAsync(i,x)),this._loader.logOpen(`${e}`);const a=h.Get(`${e}/light`,this._lights,j.ae);return E.push(this._loadLightAsync(`/extensions/${this.name}/lights/${j.ae}`,a).then((i=>{this._loader.babylonScene.environmentTexture=i}))),this._loader.logClose(),await Promise.all(E).then((()=>{}))}))}_loadLightAsync(i,x){if(!x._loaded){const e=new Array;this._loader.logOpen(`${i}`);const j=new Array(x.specularImages.length);for(let E=0;E<x.specularImages.length;E++){const a=x.specularImages[E];j[E]=new Array(a.length);for(let x=0;x<a.length;x++){const Y=`${i}/specularImages/${E}/${x}`;this._loader.logOpen(`${Y}`);const J=a[x],u=h.Get(Y,this._loader.Ne.images,J);e.push(this._loader.loadImageAsync(`/images/${J}`,u).then((i=>{j[E][x]=i}))),this._loader.logClose()}}this._loader.logClose(),x._loaded=Promise.all(e).then((async()=>{const e=new W(this._loader.babylonScene,null,x.specularImageSize);if(e.name=x.name||"environment",x._babylonTexture=e,void 0!=x.kJ&&(e.level=x.kJ),x.rotation){let i=E.Quaternion.zJ(x.rotation);this._loader.babylonScene.useRightHandedSystem||(i=E.Quaternion.Inverse(i)),E.Matrix.FromQuaternionToRef(i,e.getReflectionTextureMatrix())}if(!x.irradianceCoefficients)throw new Error(`${i}: Irradiance coefficients are missing`);const a=r.d.zJ(x.irradianceCoefficients);a.scaleInPlace(x.kJ),a.convertIrradianceToLambertianRadiance();const Y=r.g.FromHarmonics(a),J=(j.length-1)/Math.log2(x.specularImageSize);return await e.updateRGBDAsync(j,Y,J)}))}return x._loaded.then((()=>x._babylonTexture))}}p(G),d(G,!0,(i=>new v(i)));e(12789);const s="EXT_mesh_gpu_instancing";class ii{constructor(i){this.name=s,this._loader=i,this.enabled=this._loader.isExtensionUsed(s)}dispose(){this._loader=null}loadNodeAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(i,j)=>{this._loader._disableInstancedMesh++;const a=this._loader.loadNodeAsync(`/nodes/${x.index}`,x,e);if(this._loader._disableInstancedMesh--,!x._primitiveBabylonMeshes)return await a;const Y=new Array;let J=0;const u=x=>{if(void 0==j.attributes[x])return void Y.push(Promise.resolve(null));const e=h.Get(`${i}/attributes/${x}`,this._loader.Ne.accessors,j.attributes[x]);if(Y.push(this._loader._loadFloatAccessorAsync(`/accessors/${e.bufferView}`,e)),0===J)J=e.count;else if(J!==e.count)throw new Error(`${i}/attributes: Instance buffer accessors do not have the same count.`)};return u("TRANSLATION"),u("ROTATION"),u("SCALE"),await a.then((async i=>{const[e,j,a]=await Promise.all(Y),u=new Float32Array(16*J);E.TmpVectors.KJ[0].fJ(0,0,0),E.TmpVectors.Quaternion[0].fJ(0,0,0,1),E.TmpVectors.KJ[1].fJ(1,1,1);for(let x=0;x<J;++x)e&&E.KJ.FromArrayToRef(e,3*x,E.TmpVectors.KJ[0]),j&&E.Quaternion.FromArrayToRef(j,4*x,E.TmpVectors.Quaternion[0]),a&&E.KJ.FromArrayToRef(a,3*x,E.TmpVectors.KJ[1]),E.Matrix.ComposeToRef(E.TmpVectors.KJ[1],E.TmpVectors.Quaternion[0],E.TmpVectors.KJ[0],E.TmpVectors.Matrix[0]),E.TmpVectors.Matrix[0].copyToArray(u,16*x);for(const E of x._primitiveBabylonMeshes)E.tK("matrix",u,16,!0);return i}))}))}}p(s),d(s,!0,(i=>new ii(i)));let xi=0,ei=null;class ji{static get Default(){return ji._Default||(ji._Default=new ji),ji._Default}constructor(){const i=ji.Configuration.decoder;this._decoderModulePromise=Y.Tools.LoadBabylonScriptAsync(i.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(i,x,e,j,E){await this._decoderModulePromise,0===xi&&(MeshoptDecoder.useWorkers(1),xi=1);const a=await MeshoptDecoder.decodeGltfBufferAsync(x,e,i,j,E);return null!==ei&&clearTimeout(ei),ei=setTimeout((()=>{MeshoptDecoder.useWorkers(0),xi=0,ei=null}),1e3),a}}ji.Configuration={decoder:{url:`${Y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},ji._Default=null;const Ei="EXT_meshopt_compression";class ai{constructor(i){this.name=Ei,this.enabled=i.isExtensionUsed(Ei),this._loader=i}dispose(){this._loader=null}loadBufferViewAsync(i,x){return R.LoadExtensionAsync(i,x,this.name,(async(e,j)=>{const E=x;if(E._meshOptData)return await E._meshOptData;const a=h.Get(`${i}/buffer`,this._loader.Ne.buffers,j.buffer);return E._meshOptData=this._loader.loadBufferAsync(`/buffers/${a.index}`,a,j.byteOffset||0,j.byteLength).then((async i=>await ji.Default.decodeGltfBufferAsync(i,j.count,j.byteStride,j.mode,j.filter))),await E._meshOptData}))}}p(Ei),d(Ei,!0,(i=>new ai(i)));const Yi="EXT_texture_webp";class Ji{constructor(i){this.name=Yi,this._loader=i,this.enabled=i.isExtensionUsed(Yi)}dispose(){this._loader=null}_loadTextureAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=void 0==x.sampler?R.DefaultSampler:h.Get(`${i}/sampler`,this._loader.Ne.samplers,x.sampler),Y=h.Get(`${j}/source`,this._loader.Ne.images,E.source);return await this._loader._createTextureAsync(i,a,Y,(i=>{e(i)}),void 0,!x._textureInfo.nonColorData)}))}}p(Yi),d(Yi,!0,(i=>new Ji(i)));const ui="EXT_texture_avif";class bi{constructor(i){this.name=ui,this._loader=i,this.enabled=i.isExtensionUsed(ui)}dispose(){this._loader=null}_loadTextureAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=void 0==x.sampler?R.DefaultSampler:h.Get(`${i}/sampler`,this._loader.Ne.samplers,x.sampler),Y=h.Get(`${j}/source`,this._loader.Ne.images,E.source);return await this._loader._createTextureAsync(i,a,Y,(i=>{e(i)}),void 0,!x._textureInfo.nonColorData)}))}}p(ui),d(ui,!0,(i=>new bi(i)));var gi=e(13815),Ai=e(12773);const Ki="EXT_lights_ies";class Li{constructor(i){this.name=Ki,this._loader=i,this.enabled=this._loader.isExtensionUsed(Ki)}dispose(){this._loader=null,delete this._lights}onLoading(){const i=this._loader.Ne.extensions;if(i&&i[this.name]){const x=i[this.name];this._lights=x.lights,h.Assign(this._lights)}}loadNodeAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,Y)=>{let J,u;this._loader._allMaterialsDirtyRequired=!0;const b=await this._loader.loadNodeAsync(i,x,(i=>{u=h.Get(j,this._lights,Y.ae);const x=u.name||i.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J=new gi.d(x,E.KJ.Zero(),E.KJ.Backward(),0,1,this._loader.babylonScene),J.angle=Math.PI/2,J.innerAngle=0,J._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=J,J.falloffType=Ai.e.FALLOFF_GLTF,J.NJ=Y.color?a.MJ.zJ(Y.color):a.MJ.White(),J.kJ=Y.multiplier||1,J.range=Number.MAX_VALUE,J.parent=i,this._loader._babylonLights.push(J),R.AddPointerMetadata(J,j),e(i)}));let g;if(u.uri)g=await this._loader.loadUriAsync(i,u,u.uri);else{const x=h.Get(`${i}/bufferView`,this._loader.Ne.bufferViews,u.bufferView);g=await this._loader.loadBufferViewAsync(`/bufferViews/${x.index}`,x)}return J.iesProfileTexture=new V.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,g,!0,void 0,void 0,void 0,void 0,".ies"),b}))}}p(Ki),d(Ki,!0,(i=>new Li(i)));var oi=e(13847);const Mi="KHR_draco_mesh_compression";class zi{constructor(i){this.name=Mi,this.useNormalizedFlagFromAccessor=!0,this._loader=i,this.enabled=oi.e.DefaultAvailable&&this._loader.isExtensionUsed(Mi)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{if(void 0!=x.mode&&4!==x.mode&&5!==x.mode)throw new Error(`${i}: Unsupported mode ${x.mode}`);const a={},Y={},J=(i,j)=>{const J=E.attributes[i];if(void 0!=J&&(e._delayInfo=e._delayInfo||[],-1===e._delayInfo.indexOf(j)&&e._delayInfo.push(j),a[j]=J,this.useNormalizedFlagFromAccessor)){const e=h.TryGet(this._loader.Ne.accessors,x.attributes[i]);e&&(Y[j]=e.normalized||!1)}};J("POSITION",f.f.PositionKind),J("NORMAL",f.f.NormalKind),J("TANGENT",f.f.TangentKind),J("TEXCOORD_0",f.f.UVKind),J("TEXCOORD_1",f.f.UV2Kind),J("TEXCOORD_2",f.f.UV3Kind),J("TEXCOORD_3",f.f.UV4Kind),J("TEXCOORD_4",f.f.UV5Kind),J("TEXCOORD_5",f.f.UV6Kind),J("JOINTS_0",f.f.MatricesIndicesKind),J("WEIGHTS_0",f.f.MatricesWeightsKind),J("COLOR_0",f.f.ColorKind);const u=h.Get(j,this._loader.Ne.bufferViews,E.bufferView);return u._dracoBabylonGeometry||(u._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u).then((async j=>{const E=this.dracoDecoder||oi.e.Default,J=h.TryGet(this._loader.Ne.accessors,x.attributes.POSITION),u=this._loader.parent.alwaysComputeBoundingBox||e.skeleton||!J?null:F(J);return await E._decodeMeshToGeometryForGltfAsync(e.name,this._loader.babylonScene,j,a,Y,u).catch((x=>{throw new Error(`${i}: ${x.message}`)}))}))),await u._dracoBabylonGeometry}))}}p(Mi),d(Mi,!0,(i=>new zi(i)));var Ti=e(13854),Qi=e(12234),ti=e(12236),Vi=e(12639),Si=e(12819),fi=e(12204);Vi.d.AddNodeConstructor("Light_Type_0",((i,x)=>()=>new wi(i,E.KJ.Zero(),x)));class wi extends Si.c{get shadowAngle(){return this._shadowAngle}set shadowAngle(i){this._shadowAngle=i,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(i){const x=this.needCube();if(this._direction=i,this.needCube()!==x&&this._shadowGenerators){const i=this._shadowGenerators.values();for(let x=i.next();!0!==x.done;x=i.next()){x.value.recreateShadowMap()}}}constructor(i,x,e){super(i,e),this._shadowAngle=Math.PI/2,this.position=x}getClassName(){return"PointLight"}getTypeID(){return Ai.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(i){if(this.direction)return super.getShadowDirection(i);switch(i){case 0:return new E.KJ(1,0,0);case 1:return new E.KJ(-1,0,0);case 2:return new E.KJ(0,-1,0);case 3:return new E.KJ(0,1,0);case 4:return new E.KJ(0,0,1);case 5:return new E.KJ(0,0,-1)}return E.KJ.Zero()}_setDefaultShadowProjectionMatrix(i,x,e){const j=this.wi().activeCamera;if(!j)return;const a=void 0!==this.shadowMinZ?this.shadowMinZ:j.De,Y=void 0!==this.shadowMaxZ?this.shadowMaxZ:j.maxZ,J=this.wi().getEngine().ue;E.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,J?Y:a,J?a:Y,i,!0,this._scene.getEngine().isNDCHalfZRange,void 0,J)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(i,x){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,x):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,x),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,x),this}transferToNodeMaterialEffect(i,x){return this.computeTransformedInformation()?i.setFloat3(x,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):i.setFloat3(x,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(i,x){i["POINTLIGHT"+x]=!0}}(0,Qi.e)([(0,ti.O)()],wi.prototype,"shadowAngle",null),(0,fi.f)("BABYLON.PointLight",wi);const Oi="KHR_lights_punctual";class li{constructor(i){this.name=Oi,this._loader=i,this.enabled=this._loader.isExtensionUsed(Oi)}dispose(){this._loader=null,delete this._lights}onLoading(){const i=this._loader.Ne.extensions;if(i&&i[this.name]){const x=i[this.name];this._lights=x.lights,h.Assign(this._lights)}}loadNodeAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,Y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(i,x,(i=>{let x;const J=h.Get(j,this._lights,Y.ae),u=J.name||i.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,J.type){case"directional":{const i=new Ti.c(u,E.KJ.Backward(),this._loader.babylonScene);i.position.OJ(0),x=i;break}case"point":x=new wi(u,E.KJ.Zero(),this._loader.babylonScene);break;case"spot":{const i=new gi.d(u,E.KJ.Zero(),E.KJ.Backward(),0,1,this._loader.babylonScene);i.angle=2*(J.spot&&J.spot.outerConeAngle||Math.PI/4),i.innerAngle=2*(J.spot&&J.spot.innerConeAngle||0),x=i;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${j}: Invalid light type (${J.type})`)}x._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,J._babylonLight=x,x.falloffType=Ai.e.FALLOFF_GLTF,x.NJ=J.color?a.MJ.zJ(J.color):a.MJ.White(),x.kJ=void 0==J.kJ?1:J.kJ,x.range=void 0==J.range?Number.MAX_VALUE:J.range,x.parent=i,this._loader._babylonLights.push(x),R.AddPointerMetadata(x,j),e(i)})))))}}p(Oi),d(Oi,!0,(i=>new li(i)));const Zi="KHR_materials_pbrSpecularGlossiness";class Bi{constructor(i){this.name=Zi,this.order=200,this._loader=i,this.enabled=this._loader.isExtensionUsed(Zi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialBasePropertiesAsync(i,x,e)),a.push(this._loadSpecularGlossinessPropertiesAsync(j,E,e)),this._loader.loadMaterialAlphaProperties(i,x,e),await Promise.all(a).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return e.metallic=null,e.roughness=null,x.diffuseFactor?(e.albedoColor=a.MJ.zJ(x.diffuseFactor),e.alpha=x.diffuseFactor[3]):e.albedoColor=a.MJ.White(),e.reflectivityColor=x.specularFactor?a.MJ.zJ(x.specularFactor):a.MJ.White(),e.microSurface=void 0==x.glossinessFactor?1:x.glossinessFactor,x.diffuseTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/diffuseTexture`,x.diffuseTexture,(i=>{i.name=`${e.name} (Diffuse)`,e.albedoTexture=i}))),x.specularGlossinessTexture&&(j.push(this._loader.loadTextureInfoAsync(`${i}/specularGlossinessTexture`,x.specularGlossinessTexture,(i=>{i.name=`${e.name} (Specular Glossiness)`,e.reflectivityTexture=i,e.reflectivityTexture.He=!0}))),e.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(j).then((()=>{}))}}p(Zi),d(Zi,!0,(i=>new Bi(i)));const ki="KHR_materials_unlit";class Ni{constructor(i){this.name=ki,this.order=210,this._loader=i,this.enabled=this._loader.isExtensionUsed(ki)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async()=>await this._loadUnlitPropertiesAsync(i,x,e)))}_loadUnlitPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;e.unlit=!0;const E=x.pbrMetallicRoughness;return E&&(E.baseColorFactor?(e.albedoColor=a.MJ.zJ(E.baseColorFactor),e.alpha=E.baseColorFactor[3]):e.albedoColor=a.MJ.White(),E.baseColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/baseColorTexture`,E.baseColorTexture,(i=>{i.name=`${e.name} (Base Color)`,e.albedoTexture=i})))),x.doubleSided&&(e.qe=!1,e.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(i,x,e),Promise.all(j).then((()=>{}))}}p(ki),d(ki,!0,(i=>new Ni(i)));const mx="KHR_materials_clearcoat";class Xi{constructor(i){this.name=mx,this.order=190,this._loader=i,this.enabled=this._loader.isExtensionUsed(mx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadClearCoatPropertiesAsync(j,E,e)),await Promise.all(a)}))}_loadClearCoatPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return e.clearCoat.isEnabled=!0,e.clearCoat.useRoughnessFromMainTexture=!1,e.clearCoat.remapF0OnInterfaceChange=!1,void 0!=x.clearcoatFactor?e.clearCoat.kJ=x.clearcoatFactor:e.clearCoat.kJ=0,x.clearcoatTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/clearcoatTexture`,x.clearcoatTexture,(i=>{i.name=`${e.name} (ClearCoat)`,e.clearCoat.texture=i}))),void 0!=x.clearcoatRoughnessFactor?e.clearCoat.roughness=x.clearcoatRoughnessFactor:e.clearCoat.roughness=0,x.clearcoatRoughnessTexture&&(x.clearcoatRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${i}/clearcoatRoughnessTexture`,x.clearcoatRoughnessTexture,(i=>{i.name=`${e.name} (ClearCoat Roughness)`,e.clearCoat.textureRoughness=i})))),x.clearcoatNormalTexture&&(x.clearcoatNormalTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${i}/clearcoatNormalTexture`,x.clearcoatNormalTexture,(i=>{i.name=`${e.name} (ClearCoat Normal)`,e.clearCoat.bumpTexture=i}))),e.invertNormalMapX=!e.wi().useRightHandedSystem,e.invertNormalMapY=e.wi().useRightHandedSystem,void 0!=x.clearcoatNormalTexture.scale&&(e.clearCoat.bumpTexture.level=x.clearcoatNormalTexture.scale)),Promise.all(j).then((()=>{}))}}p(mx),d(mx,!0,(i=>new Xi(i)));const Ci="KHR_materials_iridescence";class ni{constructor(i){this.name=Ci,this.order=195,this._loader=i,this.enabled=this._loader.isExtensionUsed(Ci)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadIridescencePropertiesAsync(j,E,e)),await Promise.all(a).then((()=>{}))}))}_loadIridescencePropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return e.iridescence.isEnabled=!0,e.iridescence.kJ=x.iridescenceFactor??0,e.iridescence.indexOfRefraction=x.iridescenceIor??x.iridescenceIOR??1.3,e.iridescence.minimumThickness=x.iridescenceThicknessMinimum??100,e.iridescence.maximumThickness=x.iridescenceThicknessMaximum??400,x.iridescenceTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/iridescenceTexture`,x.iridescenceTexture,(i=>{i.name=`${e.name} (Iridescence)`,e.iridescence.texture=i}))),x.iridescenceThicknessTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/iridescenceThicknessTexture`,x.iridescenceThicknessTexture,(i=>{i.name=`${e.name} (Iridescence Thickness)`,e.iridescence.thicknessTexture=i}))),Promise.all(j).then((()=>{}))}}p(Ci),d(Ci,!0,(i=>new ni(i)));const Ii="KHR_materials_anisotropy";class di{constructor(i){this.name=Ii,this.order=195,this._loader=i,this.enabled=this._loader.isExtensionUsed(Ii)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadIridescencePropertiesAsync(j,E,e)),await Promise.all(a)}))}async _loadIridescencePropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;e.anisotropy.isEnabled=!0,e.anisotropy.kJ=x.anisotropyStrength??0,e.anisotropy.angle=x.anisotropyRotation??0,x.anisotropyTexture&&(x.anisotropyTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${i}/anisotropyTexture`,x.anisotropyTexture,(i=>{i.name=`${e.name} (Anisotropy Intensity)`,e.anisotropy.texture=i})))),await Promise.all(j)}}p(Ii),d(Ii,!0,(i=>new di(i)));const pi="KHR_materials_emissive_strength";class Hi{constructor(i){this.name=pi,this.order=170,this._loader=i,this.enabled=this._loader.isExtensionUsed(pi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>await this._loader.loadMaterialPropertiesAsync(i,x,e).then((()=>{this._loadEmissiveProperties(j,E,e)}))))}_loadEmissiveProperties(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);void 0!==x.emissiveStrength&&(e.emissiveIntensity=x.emissiveStrength)}}p(pi),d(pi,!0,(i=>new Hi(i)));const Ui="KHR_materials_sheen";class Di{constructor(i){this.name=Ui,this.order=190,this._loader=i,this.enabled=this._loader.isExtensionUsed(Ui)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadSheenPropertiesAsync(j,E,e)),await Promise.all(a).then((()=>{}))}))}_loadSheenPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return e.sheen.isEnabled=!0,e.sheen.kJ=1,void 0!=x.sheenColorFactor?e.sheen.color=a.MJ.zJ(x.sheenColorFactor):e.sheen.color=a.MJ.Black(),x.sheenColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/sheenColorTexture`,x.sheenColorTexture,(i=>{i.name=`${e.name} (Sheen Color)`,e.sheen.texture=i}))),void 0!==x.sheenRoughnessFactor?e.sheen.roughness=x.sheenRoughnessFactor:e.sheen.roughness=0,x.sheenRoughnessTexture&&(x.sheenRoughnessTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${i}/sheenRoughnessTexture`,x.sheenRoughnessTexture,(i=>{i.name=`${e.name} (Sheen Roughness)`,e.sheen.textureRoughness=i})))),e.sheen.albedoScaling=!0,e.sheen.useRoughnessFromMainTexture=!1,Promise.all(j).then((()=>{}))}}p(Ui),d(Ui,!0,(i=>new Di(i)));var hi=e(12710);const Fi="KHR_materials_specular";class Ri{constructor(i){this.name=Fi,this.order=190,this._loader=i,this.enabled=this._loader.isExtensionUsed(Fi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;if(a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadSpecularPropertiesAsync(j,E,e)),E.extensions&&E.extensions.EXT_materials_specular_edge_color&&e instanceof t.e){E.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(e.brdf.dielectricSpecularModel=hi.b.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,e.brdf.conductorSpecularModel=hi.b.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(a).then((()=>{}))}))}_loadSpecularPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return void 0!==x.specularFactor&&(e.metallicF0Factor=x.specularFactor),void 0!==x.specularColorFactor&&(e.metallicReflectanceColor=a.MJ.zJ(x.specularColorFactor)),x.specularTexture&&(x.specularTexture.nonColorData=!0,j.push(this._loader.loadTextureInfoAsync(`${i}/specularTexture`,x.specularTexture,(i=>{i.name=`${e.name} (Specular)`,e.metallicReflectanceTexture=i,e.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),x.specularColorTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/specularColorTexture`,x.specularColorTexture,(i=>{i.name=`${e.name} (Specular Color)`,e.reflectanceTexture=i}))),Promise.all(j).then((()=>{}))}}p(Fi),d(Fi,!0,(i=>new Ri(i)));const yi="KHR_materials_ior";class ri{constructor(i){this.name=yi,this.order=180,this._loader=i,this.enabled=this._loader.isExtensionUsed(yi)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadIorPropertiesAsync(j,E,e)),await Promise.all(a).then((()=>{}))}))}_loadIorPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);return void 0!==x.ior?e.indexOfRefraction=x.ior:e.indexOfRefraction=ri._DEFAULT_IOR,Promise.resolve()}}ri._DEFAULT_IOR=1.5,p(yi),d(yi,!0,(i=>new ri(i)));const ci="KHR_materials_variants";class Pi{constructor(i){this.name=ci,this._loader=i,this.enabled=this._loader.isExtensionUsed(ci)}dispose(){this._loader=null}static GetAvailableVariants(i){const x=this._GetExtensionMetadata(i);return x?Object.keys(x.variants):[]}getAvailableVariants(i){return Pi.GetAvailableVariants(i)}static SelectVariant(i,x){const e=this._GetExtensionMetadata(i);if(!e)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${ci} extension`);const j=i=>{const x=e.variants[i];if(x)for(const e of x)e.mesh.material=e.material};if(x instanceof Array)for(const E of x)j(E);else j(x);e.lastSelected=x}selectVariant(i,x){Pi.SelectVariant(i,x)}static Reset(i){const x=this._GetExtensionMetadata(i);if(!x)throw new Error(`Cannot reset on a glTF mesh that does not have the ${ci} extension`);for(const e of x.original)e.mesh.material=e.material;x.lastSelected=null}reset(i){Pi.Reset(i)}static GetLastSelectedVariant(i){const x=this._GetExtensionMetadata(i);if(!x)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${ci} extension`);return x.lastSelected}getLastSelectedVariant(i){return Pi.GetLastSelectedVariant(i)}static _GetExtensionMetadata(i){var x,e;return(null===i||void 0===i||null===(x=i._internalMetadata)||void 0===x||null===(e=x.Ne)||void 0===e?void 0:e[ci])||null}onLoading(){const i=this._loader.Ne.extensions;if(i&&i[this.name]){const x=i[this.name];this._variants=x.variants}}onReady(){const i=this._loader.rootBabylonMesh;if(i){var x;const e=this._loader.parent.extensionOptions[ci];null!==e&&void 0!==e&&e.defaultVariant&&Pi.SelectVariant(i,e.defaultVariant),null===e||void 0===e||null===(x=e.onLoaded)||void 0===x||x.call(e,{get variants(){return Pi.GetAvailableVariants(i)},get selectedVariant(){const x=Pi.GetLastSelectedVariant(i);return x?Array.isArray(x)?x[0]:x:Pi.GetAvailableVariants(i)[0]},set selectedVariant(x){Pi.SelectVariant(i,x)}})}}_loadMeshPrimitiveAsync(i,x,e,j,E,a){return R.LoadExtensionAsync(i,E,this.name,(async(Y,J)=>{const u=new Array;return u.push(this._loader._loadMeshPrimitiveAsync(i,x,e,j,E,(x=>{if(a(x),x instanceof l.c){const e=R._GetDrawMode(i,E.mode),j=this._loader.rootBabylonMesh,a=j?j._internalMetadata=j._internalMetadata||{}:{},b=a.Ne=a.Ne||{},g=b[ci]=b[ci]||{lastSelected:null,original:[],variants:{}};g.original.push({mesh:x,material:x.material});for(let i=0;i<J.mappings.length;++i){const E=J.mappings[i],a=h.Get(`${Y}/mappings/${i}/material`,this._loader.Ne.materials,E.material);u.push(this._loader._loadMaterialAsync(`#/materials/${E.material}`,a,x,e,(i=>{for(let e=0;e<E.variants.length;++e){const a=E.variants[e],Y=h.Get(`/extensions/${ci}/variants/${a}`,this._variants,a);g.variants[Y.name]=g.variants[Y.name]||[],g.variants[Y.name].push({mesh:x,material:i}),x.onClonedObservable.add((i=>{const e=i;let E=null,a=e;do{if(a=a.parent,!a)return;E=Pi._GetExtensionMetadata(a)}while(null===E);if(j&&E===Pi._GetExtensionMetadata(j)){a._internalMetadata={};for(const i in j._internalMetadata)a._internalMetadata[i]=j._internalMetadata[i];a._internalMetadata.Ne=[];for(const i in j._internalMetadata.Ne)a._internalMetadata.Ne[i]=j._internalMetadata.Ne[i];a._internalMetadata.Ne[ci]={lastSelected:null,original:[],variants:{}};for(const i of E.original)a._internalMetadata.Ne[ci].original.push({mesh:i.mesh,material:i.material});for(const i in E.variants)if(Object.prototype.hasOwnProperty.call(E.variants,i)){a._internalMetadata.Ne[ci].variants[i]=[];for(const x of E.variants[i])a._internalMetadata.Ne[ci].variants[i].push({mesh:x.mesh,material:x.material})}E=a._internalMetadata.Ne[ci]}for(const j of E.original)j.mesh===x&&(j.mesh=e);for(const j of E.variants[Y.name])j.mesh===x&&(j.mesh=e)}))}})))}}}))),await Promise.all(u).then((i=>{let[x]=i;return x}))}))}}p(ci),d(ci,!0,(i=>new Pi(i)));var qi=e(12306);class Wi{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:hi.b.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(i,x){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...Wi._GetDefaultOptions(),...i},this._scene=x,this._scene._transmissionHelper=this,this.onErrorObservable=new g.b,this._scene.te.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(i){if(!Object.keys(i).filter((x=>this._options[x]!==i[x])).length)return;const x={...this._options,...i},e=this._options;this._options=x,x.renderSize===e.renderSize&&x.renderTargetTextureType===e.renderTargetTextureType&&x.generateMipmaps===e.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=x.samples,this._opaqueRenderTarget.lodGenerationScale=x.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=x.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(i){return!!i&&!!(i instanceof t.e&&i.subSurface.isRefractionEnabled)}_addMesh(i){this._materialObservers[i.uniqueId]=i.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),Y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(i.material)?(i.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(i)&&this._transparentMeshesCache.push(i)):-1===this._opaqueMeshesCache.indexOf(i)&&this._opaqueMeshesCache.push(i)}))}_removeMesh(i){i.onMaterialChangedObservable.remove(this._materialObservers[i.uniqueId]),delete this._materialObservers[i.uniqueId];let x=this._transparentMeshesCache.indexOf(i);-1!==x&&this._transparentMeshesCache.splice(x,1),x=this._opaqueMeshesCache.indexOf(i),-1!==x&&this._opaqueMeshesCache.splice(x,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(i){const x=this._transparentMeshesCache.indexOf(i),e=this._opaqueMeshesCache.indexOf(i);this._shouldRenderAsTransmission(i.material)?(i.material instanceof t.e&&(i.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==e?(this._opaqueMeshesCache.splice(e,1),this._transparentMeshesCache.push(i)):-1===x&&this._transparentMeshesCache.push(i)):-1!==x?(this._transparentMeshesCache.splice(x,1),this._opaqueMeshesCache.push(i)):-1===e&&this._opaqueMeshesCache.push(i)}_isRenderTargetValid(){var i;return null!==(null===(i=this._opaqueRenderTarget)||void 0===i?void 0:i.getInternalTexture())}_setupRenderTargets(){var i;let x;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new qi.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(i=this._options.clearColor)||void 0===i?void 0:i.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((i=>{x=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?i.clearColor.A(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(i.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=x}));for(const e of this._transparentMeshesCache)this._shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const Gi="KHR_materials_transmission";class vi{constructor(i){this.name=Gi,this.order=175,this._loader=i,this.enabled=this._loader.isExtensionUsed(Gi),this.enabled&&(i.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadTransparentPropertiesAsync(j,x,e,E)),await Promise.all(a).then((()=>{}))}))}_loadTransparentPropertiesAsync(i,x,e,j){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const E=e;if(E.subSurface.isRefractionEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.useAlbedoToTintRefraction=!0,void 0===j.transmissionFactor)return E.subSurface.refractionIntensity=0,E.subSurface.isRefractionEnabled=!1,Promise.resolve();{var a;E.subSurface.refractionIntensity=j.transmissionFactor;const i=E.wi();if(E.subSurface.refractionIntensity&&!i._transmissionHelper)new Wi({},E.wi());else if(E.subSurface.refractionIntensity&&(null===(a=i._transmissionHelper)||void 0===a||!a._isRenderTargetValid())){var Y;null===(Y=i._transmissionHelper)||void 0===Y||Y._setupRenderTargets()}}return E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,j.transmissionTexture?(j.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${i}/transmissionTexture`,j.transmissionTexture,void 0).then((i=>{i.name=`${e.name} (Transmission)`,E.subSurface.refractionIntensityTexture=i,E.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}p(Gi),d(Gi,!0,(i=>new vi(i)));const si="KHR_materials_diffuse_transmission";class ix{constructor(i){this.name=si,this.order=174,this._loader=i,this.enabled=this._loader.isExtensionUsed(si),this.enabled&&(i.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadTranslucentPropertiesAsync(j,x,e,E)),await Promise.all(a).then((()=>{}))}))}_loadTranslucentPropertiesAsync(i,x,e,j){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const E=e;if(E.subSurface.isTranslucencyEnabled=!0,E.subSurface.volumeIndexOfRefraction=1,E.subSurface.minimumThickness=0,E.subSurface.maximumThickness=0,E.subSurface.useAlbedoToTintTranslucency=!1,void 0===j.diffuseTransmissionFactor)return E.subSurface.translucencyIntensity=0,E.subSurface.isTranslucencyEnabled=!1,Promise.resolve();E.subSurface.translucencyIntensity=j.diffuseTransmissionFactor;const Y=new Array;return E.subSurface.useGltfStyleTextures=!0,j.diffuseTransmissionTexture&&(j.diffuseTransmissionTexture.nonColorData=!0,Y.push(this._loader.loadTextureInfoAsync(`${i}/diffuseTransmissionTexture`,j.diffuseTransmissionTexture).then((i=>{i.name=`${e.name} (Diffuse Transmission)`,E.subSurface.translucencyIntensityTexture=i})))),void 0!==j.diffuseTransmissionColorFactor?E.subSurface.translucencyColor=a.MJ.zJ(j.diffuseTransmissionColorFactor):E.subSurface.translucencyColor=a.MJ.White(),j.diffuseTransmissionColorTexture&&Y.push(this._loader.loadTextureInfoAsync(`${i}/diffuseTransmissionColorTexture`,j.diffuseTransmissionColorTexture).then((i=>{i.name=`${e.name} (Diffuse Transmission Color)`,E.subSurface.translucencyColorTexture=i}))),Promise.all(Y).then((()=>{}))}}p(si),d(si,!0,(i=>new ix(i)));const xx="KHR_materials_volume";class ex{constructor(i){this.name=xx,this.order=173,this._loader=i,this.enabled=this._loader.isExtensionUsed(xx),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadVolumePropertiesAsync(j,x,e,E)),await Promise.all(a).then((()=>{}))}))}_loadVolumePropertiesAsync(i,x,e,j){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);if(!e.subSurface.isRefractionEnabled&&!e.subSurface.isTranslucencyEnabled||!j.thicknessFactor)return Promise.resolve();e.subSurface.volumeIndexOfRefraction=e.indexOfRefraction;const E=void 0!==j.attenuationDistance?j.attenuationDistance:Number.MAX_VALUE;return e.subSurface.tintColorAtDistance=E,void 0!==j.attenuationColor&&3==j.attenuationColor.length&&e.subSurface.tintColor.fJ(j.attenuationColor[0],j.attenuationColor[1],j.attenuationColor[2]),e.subSurface.minimumThickness=0,e.subSurface.maximumThickness=j.thicknessFactor,e.subSurface.useThicknessAsDepth=!0,j.thicknessTexture?(j.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${i}/thicknessTexture`,j.thicknessTexture).then((i=>{i.name=`${e.name} (Thickness)`,e.subSurface.thicknessTexture=i,e.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}p(xx),d(xx,!0,(i=>new ex(i)));const jx="KHR_materials_dispersion";class Ex{constructor(i){this.name=jx,this.order=174,this._loader=i,this.enabled=this._loader.isExtensionUsed(jx)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadDispersionPropertiesAsync(j,x,e,E)),await Promise.all(a).then((()=>{}))}))}_loadDispersionPropertiesAsync(i,x,e,j){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);return e.subSurface.isRefractionEnabled&&j.dispersion?(e.subSurface.isDispersionEnabled=!0,e.subSurface.dispersion=j.dispersion,Promise.resolve()):Promise.resolve()}}p(jx),d(jx,!0,(i=>new Ex(i)));const ax="EXT_materials_diffuse_roughness";class Yx{constructor(i){this.name=ax,this.order=190,this._loader=i,this.enabled=this._loader.isExtensionUsed(ax)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=new Array;return a.push(this._loader.loadMaterialPropertiesAsync(i,x,e)),a.push(this._loadDiffuseRoughnessPropertiesAsync(j,E,e)),await Promise.all(a).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(i,x,e){if(!(e instanceof t.e))throw new Error(`${i}: Material type not supported`);const j=new Array;return e.brdf.baseDiffuseModel=hi.b.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=x.diffuseRoughnessFactor?e.baseDiffuseRoughness=x.diffuseRoughnessFactor:e.baseDiffuseRoughness=0,x.diffuseRoughnessTexture&&j.push(this._loader.loadTextureInfoAsync(`${i}/diffuseRoughnessTexture`,x.diffuseRoughnessTexture,(i=>{i.name=`${e.name} (Diffuse Roughness)`,e.baseDiffuseRoughnessTexture=i}))),Promise.all(j).then((()=>{}))}}p(ax),d(ax,!0,(i=>new Yx(i)));const Jx="KHR_mesh_quantization";class ux{constructor(i){this.name=Jx,this.enabled=i.isExtensionUsed(Jx)}dispose(){}}p(Jx),d(Jx,!0,(i=>new ux(i)));const bx="KHR_texture_basisu";class gx{constructor(i){this.name=bx,this._loader=i,this.enabled=i.isExtensionUsed(bx)}dispose(){this._loader=null}_loadTextureAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>{const a=void 0==x.sampler?R.DefaultSampler:h.Get(`${i}/sampler`,this._loader.Ne.samplers,x.sampler),Y=h.Get(`${j}/source`,this._loader.Ne.images,E.source);return await this._loader._createTextureAsync(i,a,Y,(i=>{e(i)}),x._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!x._textureInfo.nonColorData)}))}}p(bx),d(bx,!0,(i=>new gx(i)));const Ax="KHR_texture_transform";class Kx{constructor(i){this.name=Ax,this._loader=i,this.enabled=this._loader.isExtensionUsed(Ax)}dispose(){this._loader=null}loadTextureInfoAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(j,E)=>await this._loader.loadTextureInfoAsync(i,x,(i=>{if(!(i instanceof V.d))throw new Error(`${j}: Texture type not supported`);E.offset&&(i.uOffset=E.offset[0],i.vOffset=E.offset[1]),i.uRotationCenter=0,i.vRotationCenter=0,E.rotation&&(i.wAng=-E.rotation),E.scale&&(i.uScale=E.scale[0],i.vScale=E.scale[1]),void 0!=E.texCoord&&(i.coordinatesIndex=E.texCoord),e(i)}))))}}p(Ax),d(Ax,!0,(i=>new Kx(i)));const Lx="KHR_xmp_json_ld";class ox{constructor(i){this.name=Lx,this.order=100,this._loader=i,this.enabled=this._loader.isExtensionUsed(Lx)}dispose(){this._loader=null}onLoading(){var i,x,e;if(null===this._loader.rootBabylonMesh)return;const j=null===(i=this._loader.Ne.extensions)||void 0===i?void 0:i.KHR_xmp_json_ld,E=null===(x=this._loader.Ne.asset)||void 0===x||null===(e=x.extensions)||void 0===e?void 0:e.KHR_xmp_json_ld;if(j&&E){const i=+E.packet;j.packets&&i<j.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=j.packets[i])}}}function Mx(i,x,e,j){return a.MJ.zJ(x,e).scale(j)}function zx(i,x,e,j){return x[e]*j}function Tx(i,x,e,j){return-x[e]*j}function Qx(i,x,e,j){return x[e+1]*j}function tx(i,x,e,j){return x[e]*j*2}function Vx(i){return{scale:[new fx(K.c.ANIMATIONTYPE_FLOAT,`${i}.uScale`,zx,(()=>2)),new fx(K.c.ANIMATIONTYPE_FLOAT,`${i}.vScale`,Qx,(()=>2))],offset:[new fx(K.c.ANIMATIONTYPE_FLOAT,`${i}.uOffset`,zx,(()=>2)),new fx(K.c.ANIMATIONTYPE_FLOAT,`${i}.vOffset`,Qx,(()=>2))],rotation:[new fx(K.c.ANIMATIONTYPE_FLOAT,`${i}.wAng`,Tx,(()=>1))]}}p(Lx),d(Lx,!0,(i=>new ox(i)));class Sx extends y.AnimationPropertyInfo{buildAnimations(i,x,e,j){return[{babylonAnimatable:i._babylonCamera,babylonAnimation:this._buildAnimation(x,e,j)}]}}class fx extends y.AnimationPropertyInfo{buildAnimations(i,x,e,j){const E=[];for(const a in i._data)E.push({babylonAnimatable:i._data[a].babylonMaterial,babylonAnimation:this._buildAnimation(x,e,j)});return E}}class wx extends y.AnimationPropertyInfo{buildAnimations(i,x,e,j){return[{babylonAnimatable:i._babylonLight,babylonAnimation:this._buildAnimation(x,e,j)}]}}(0,H.i)("/cameras/{}/orthographic/xmag",[new Sx(K.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Tx,(()=>1)),new Sx(K.c.ANIMATIONTYPE_FLOAT,"orthoRight",Qx,(()=>1))]),(0,H.i)("/cameras/{}/orthographic/ymag",[new Sx(K.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Tx,(()=>1)),new Sx(K.c.ANIMATIONTYPE_FLOAT,"orthoTop",Qx,(()=>1))]),(0,H.i)("/cameras/{}/orthographic/zfar",[new Sx(K.c.ANIMATIONTYPE_FLOAT,"maxZ",zx,(()=>1))]),(0,H.i)("/cameras/{}/orthographic/znear",[new Sx(K.c.ANIMATIONTYPE_FLOAT,"De",zx,(()=>1))]),(0,H.i)("/cameras/{}/perspective/yfov",[new Sx(K.c.ANIMATIONTYPE_FLOAT,"fov",zx,(()=>1))]),(0,H.i)("/cameras/{}/perspective/zfar",[new Sx(K.c.ANIMATIONTYPE_FLOAT,"maxZ",zx,(()=>1))]),(0,H.i)("/cameras/{}/perspective/znear",[new Sx(K.c.ANIMATIONTYPE_FLOAT,"De",zx,(()=>1))]),(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new fx(K.c.ANIMATIONTYPE_COLOR3,"albedoColor",Mx,(()=>4)),new fx(K.c.ANIMATIONTYPE_FLOAT,"alpha",(function(i,x,e,j){return x[e+3]*j}),(()=>4))]),(0,H.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"metallic",zx,(()=>1))]),(0,H.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"roughness",zx,(()=>1))]);const Ox=Vx("albedoTexture");(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Ox.scale),(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Ox.offset),(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Ox.rotation);const lx=Vx("metallicTexture");(0,H.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",lx.scale),(0,H.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",lx.offset),(0,H.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",lx.rotation),(0,H.i)("/materials/{}/emissiveFactor",[new fx(K.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Mx,(()=>3))]);const Zx=Vx("bumpTexture");(0,H.i)("/materials/{}/normalTexture/scale",[new fx(K.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",zx,(()=>1))]),(0,H.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Zx.scale),(0,H.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Zx.offset),(0,H.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Zx.rotation),(0,H.i)("/materials/{}/occlusionTexture/strength",[new fx(K.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",zx,(()=>1))]);const Bx=Vx("ambientTexture");(0,H.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Bx.scale),(0,H.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Bx.offset),(0,H.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Bx.rotation);const kx=Vx("emissiveTexture");(0,H.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",kx.scale),(0,H.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",kx.offset),(0,H.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",kx.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new fx(K.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new fx(K.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",zx,(()=>1))]);const Nx=Vx("anisotropy.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Nx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Nx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Nx.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",zx,(()=>1))]);const me=Vx("clearCoat.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",me.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",me.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",me.rotation);const Xx=Vx("clearCoat.bumpTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new fx(K.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Xx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Xx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Xx.rotation);const Cx=Vx("clearCoat.textureRoughness");(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",Cx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",Cx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",Cx.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new fx(K.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new fx(K.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new fx(K.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new fx(K.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",zx,(()=>1))]);const nx=Vx("iridescence.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",nx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",nx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",nx.rotation);const Ix=Vx("iridescence.thicknessTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Ix.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Ix.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Ix.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new fx(K.c.ANIMATIONTYPE_COLOR3,"sheen.color",Mx,(()=>3))]),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",zx,(()=>1))]);const dx=Vx("sheen.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",dx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",dx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",dx.rotation);const px=Vx("sheen.textureRoughness");(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",px.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",px.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",px.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new fx(K.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Mx,(()=>3))]);const Hx=Vx("metallicReflectanceTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Hx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Hx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Hx.rotation);const Ux=Vx("reflectanceTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Ux.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Ux.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Ux.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",zx,(()=>1))]);const Dx=Vx("subSurface.refractionIntensityTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Dx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Dx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Dx.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new fx(K.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Mx,(()=>3))]),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new fx(K.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",zx,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",zx,(()=>1))]);const hx=Vx("subSurface.thicknessTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",hx.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",hx.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",hx.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new fx(K.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",zx,(()=>1))]);const Fx=Vx("subSurface.translucencyIntensityTexture");(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Fx.scale),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Fx.offset),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Fx.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new fx(K.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Mx,(()=>3))]);const Rx=Vx("subSurface.translucencyColorTexture");(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",Rx.scale),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",Rx.offset),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",Rx.rotation),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new wx(K.c.ANIMATIONTYPE_COLOR3,"diffuse",Mx,(()=>3))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new wx(K.c.ANIMATIONTYPE_FLOAT,"intensity",zx,(()=>1))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new wx(K.c.ANIMATIONTYPE_FLOAT,"range",zx,(()=>1))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new wx(K.c.ANIMATIONTYPE_FLOAT,"innerAngle",tx,(()=>1))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new wx(K.c.ANIMATIONTYPE_FLOAT,"angle",tx,(()=>1))]),(0,H.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new wx(K.c.ANIMATIONTYPE_COLOR3,"diffuse",Mx,(()=>3))]),(0,H.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new wx(K.c.ANIMATIONTYPE_FLOAT,"intensity",zx,(()=>1))]);const yx="KHR_animation_pointer";class rx{constructor(i){this.name=yx,this._loader=i,this._pathToObjectConverter=(0,H.g)(this._loader.Ne)}get enabled(){return this._loader.isExtensionUsed(yx)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(i,x,e,j,E){var a;const Y=null===(a=j.target.extensions)||void 0===a?void 0:a.KHR_animation_pointer;if(!Y||!this._pathToObjectConverter)return null;"pointer"!==j.target.path&&M.c.Warn(`${i}/target/path: Value (${j.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=j.target.node&&M.c.Warn(`${i}/target/node: Value (${j.target.node}) must not be present when using the ${this.name} extension`);const J=`${i}/extensions/${this.name}`,u=Y.pointer;if(!u)throw new Error(`${J}: Pointer is missing`);try{const a=this._pathToObjectConverter.convert(u);if(!a.info.interpolation)throw new Error(`${J}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(i,x,e,j,{object:a.object,info:a.info.interpolation},E)}catch(b){return M.c.Warn(`${J}/pointer: Invalid pointer (${u}) skipped`),null}}}p(yx),d(yx,!0,(i=>new rx(i)));class cx{constructor(i,x,e){this.frame=i,this.action=x,this.onlyOnce=e,this.isDone=!1}_clone(){return new cx(this.frame,this.action,this.onlyOnce)}}var Px=e(12092),qx=e(12150),Wx=e(12142);class Gx{get loop(){return this._loop}set loop(i){i!==this._loop&&(this._loop=i,this.updateOptions({loop:i}))}get currentTime(){var i;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(i=qx.c.audioEngine)&&void 0!==i&&i.audioContext&&(this.isPlaying||this.isPaused)){const i=this.isPaused?0:qx.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+i}return 0}get spatialSound(){return this._spatialSound}set spatialSound(i){if(i==this._spatialSound)return;const x=this.isPlaying;this.pause(),i?(this._spatialSound=i,this._updateSpatialParameters()):this._disableSpatialSound(),x&&this.play()}constructor(i,x,e){var j;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new g.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=E.KJ.Zero(),this._localDirection=new E.KJ(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=i,e=e||o.e.LastCreatedScene)if(this._scene=e,Gx._SceneComponentInitialization(e),this._readyToPlayCallback=a,this._customAttenuationFunction=(i,x,e,j,E)=>x<e?i*(1-x/e):0,J&&(this.autoplay=J.autoplay||!1,this._loop=J.loop||!1,void 0!==J.volume&&(this._volume=J.volume),this._spatialSound=J.spatialSound??!1,this.maxDistance=J.maxDistance??100,this.useCustomAttenuation=J.useCustomAttenuation??!1,this.rolloffFactor=J.rolloffFactor||1,this.refDistance=J.refDistance||1,this.distanceModel=J.distanceModel||"linear",this._playbackRate=J.playbackRate||1,this._streaming=J.streaming??!1,this._length=J.length,this._offset=J.offset),null!==(j=qx.c.audioEngine)&&void 0!==j&&j.canUseWebAudio&&qx.c.audioEngine.audioContext){this._soundGain=qx.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let i=!0;if(x)try{"string"===typeof x?(this._urlType="String",this._url=x):x instanceof ArrayBuffer?this._urlType="ArrayBuffer":x instanceof HTMLMediaElement?this._urlType="MediaElement":x instanceof MediaStream?this._urlType="MediaStream":x instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(x)&&(this._urlType="Array");let e=[],j=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=qx.c.audioEngine.audioContext.createMediaElementSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=qx.c.audioEngine.audioContext.createMediaStreamSource(x),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":x.byteLength>0&&(j=!0,this._soundLoaded(x));break;case"AudioBuffer":this._audioBufferLoaded(x);break;case"String":e.push(x);case"Array":0===e.length&&(e=x);for(let i=0;i<e.length;i++){const x=e[i];if(j=J&&J.skipCodecCheck||-1!==x.indexOf(".mp3",x.length-4)&&qx.c.audioEngine.isMP3supported||-1!==x.indexOf(".ogg",x.length-4)&&qx.c.audioEngine.isOGGsupported||-1!==x.indexOf(".wav",x.length-4)||-1!==x.indexOf(".m4a",x.length-4)||-1!==x.indexOf(".mp4",x.length-4)||-1!==x.indexOf("blob:"),j){this._streaming?(this._htmlAudioElement=new Audio(x),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,Y.Tools.SetCorsBehavior(x,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(x,(i=>{this._soundLoaded(i)}),void 0,!0,!0,(i=>{i&&M.c.Error("XHR "+i.status+" error on: "+x+"."),M.c.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:i=!1}i?j||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):M.c.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(u){M.c.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),qx.c.audioEngine&&!qx.c.audioEngine.WarnedWebAudioUnsupported&&(M.c.Error("Web Audio is not supported by your browser."),qx.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var i;null!==(i=qx.c.audioEngine)&&void 0!==i&&i.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(i){var x;null!==(x=qx.c.audioEngine)&&void 0!==x&&x.audioContext&&(this._audioBuffer=i,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(i){var x;null!==(x=qx.c.audioEngine)&&void 0!==x&&x.audioContext&&qx.c.audioEngine.audioContext.decodeAudioData(i,(i=>{this._audioBufferLoaded(i)}),(i=>{M.c.Error("Error while decoding audio data for: "+this.name+" / Error: "+i)}))}setAudioBuffer(i){var x;null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&(this._audioBuffer=i,this._isReadyToPlay=!0)}updateOptions(i){i&&(this.loop=i.loop??this.loop,this.maxDistance=i.maxDistance??this.maxDistance,this.useCustomAttenuation=i.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=i.rolloffFactor??this.rolloffFactor,this.refDistance=i.refDistance??this.refDistance,this.distanceModel=i.distanceModel??this.distanceModel,this._playbackRate=i.playbackRate??this._playbackRate,this._length=i.length??void 0,this.spatialSound=i.spatialSound??this._spatialSound,this._setOffset(i.offset??void 0),this.setVolume(i.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var i;null!==(i=qx.c.audioEngine)&&void 0!==i&&i.canUseWebAudio&&qx.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??qx.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var i;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(i=this._soundPanner)||void 0===i||i.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var i;null!==(i=qx.c.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(i){var x;null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(i),this._isOutputConnected=!0)}setDirectionalCone(i,x,e){x<i?M.c.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=i,this._coneOuterAngle=x,this._coneOuterGain=e,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(i){if(i!=this._coneInnerAngle){var x;if(this._coneOuterAngle<i)return void M.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=i,null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(i){if(i!=this._coneOuterAngle){var x;if(i<this._coneInnerAngle)return void M.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=i,null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(i){var x;i.equals(this._position)||(this._position.A(i),null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(i){var x;this._localDirection=i,null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const i=this._connectedTransformNode.getWorldMatrix(),x=E.KJ.TransformNormal(this._localDirection,i);x.normalize(),this._soundPanner.orientationX.value=x.x,this._soundPanner.orientationY.value=x.y,this._soundPanner.orientationZ.value=x.z}updateDistanceFromListener(){var i;if(null!==(i=qx.c.audioEngine)&&void 0!==i&&i.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const i=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Cx(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,i,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(i){this._customAttenuationFunction=i}play(i,x,e){var j;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(j=qx.c.audioEngine)&&void 0!==j&&j.audioContext)try{var E,a;this._clearTimeoutsAndObservers();let j=i?(null===(E=qx.c.audioEngine)||void 0===E?void 0:E.audioContext.currentTime)+i:null===(a=qx.c.audioEngine)||void 0===a?void 0:a.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=qx.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const i=()=>{var e;if(null!==(e=qx.c.audioEngine)&&void 0!==e&&e.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=x??0;const e=this._htmlAudioElement.play();void 0!==e&&e.catch((()=>{var x,e;(null===(x=qx.c.audioEngine)||void 0===x||x.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(e=qx.c.audioEngine)||void 0===e?void 0:e.onAudioUnlockedObservable.addOnce((()=>{i()})))}))}else{var j;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(j=qx.c.audioEngine)||void 0===j?void 0:j.onAudioUnlockedObservable.addOnce((()=>{i()}))}};i()}}else{var Y;const E=()=>{var E;if(null!==(E=qx.c.audioEngine)&&void 0!==E&&E.audioContext){var a;if(e=e||this._length,void 0!==x&&this._setOffset(x),this._soundSource){const i=this._soundSource;i.onended=()=>{i.disconnect()}}if(this._soundSource=null===(a=qx.c.audioEngine)||void 0===a?void 0:a.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var Y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==x&&(this._soundSource.loopStart=x),void 0!==e&&(this._soundSource.loopEnd=(0|x)+e),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},j=i?(null===(Y=qx.c.audioEngine)||void 0===Y?void 0:Y.audioContext.currentTime)+i:qx.c.audioEngine.audioContext.currentTime;const E=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(j,E,this.loop?void 0:e)}}};"suspended"===(null===(Y=qx.c.audioEngine)||void 0===Y?void 0:Y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var i;"suspended"===(null===(i=qx.c.audioEngine)||void 0===i?void 0:i.audioContext.state)?(qx.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=qx.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{E()})))):E()}),500):E()}this._startTime=j,this.isPlaying=!0,this.isPaused=!1}catch(J){M.c.Error("Error while trying to play audio: "+this.name+", "+J.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(i){var x;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var e;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(e=this._streamingSource)||void 0===e||e.disconnect();this.isPlaying=!1}else if(null!==(x=qx.c.audioEngine)&&void 0!==x&&x.audioContext&&this._soundSource){const x=i?qx.c.audioEngine.audioContext.currentTime+i:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(x)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var i;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var x;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(x=this._streamingSource)||void 0===x||x.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(i=qx.c.audioEngine)&&void 0!==i&&i.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=qx.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(i,x){var e;null!==(e=qx.c.audioEngine)&&void 0!==e&&e.canUseWebAudio&&this._soundGain&&(x&&qx.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(qx.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,qx.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(i,qx.c.audioEngine.audioContext.currentTime+x)):this._soundGain.gain.value=i),this._volume=i}setPlaybackRate(i){this._playbackRate=i,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(i){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=i,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=i=>this._onRegisterAfterWorldMatrixUpdate(i),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(i){var x;if(i.getBoundingInfo){const x=i.getBoundingInfo();this.setPosition(x.boundingSphere.centerWorld)}else this.setPosition(i.absolutePosition);null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const i=()=>{(0,Wx.d)((()=>this._isReadyToPlay),(()=>{e._audioBuffer=this.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play(0,this._offset,this._length)}),void 0,300)},x={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},e=new Gx(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,x);return this.useCustomAttenuation&&e.setAttenuationFunction(this._customAttenuationFunction),e.setPosition(this._position),e.setPlaybackRate(this._playbackRate),i(),e}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const i={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(i.connectedMeshId=this._connectedTransformNode.id),i.position=this._position.de(),i.refDistance=this.refDistance,i.distanceModel=this.distanceModel,i.isDirectional=this._isDirectional,i.localDirectionToMesh=this._localDirection.de(),i.coneInnerAngle=this._coneInnerAngle,i.coneOuterAngle=this._coneOuterAngle,i.coneOuterGain=this._coneOuterGain),i}static Parse(i,x,e,j){const a=i.name;let Y;Y=i.url?e+i.url:e+a;const J={autoplay:i.autoplay,loop:i.loop,volume:i.volume,spatialSound:i.spatialSound,maxDistance:i.maxDistance,rolloffFactor:i.rolloffFactor,refDistance:i.refDistance,distanceModel:i.distanceModel,playbackRate:i.playbackRate};let u;if(j){const i=()=>{(0,Wx.d)((()=>j._isReadyToPlay),(()=>{u._audioBuffer=j.getAudioBuffer(),u._isReadyToPlay=!0,u.autoplay&&u.play(0,u._offset,u._length)}),void 0,300)};u=new Gx(a,new ArrayBuffer(0),x,null,J),i()}else u=new Gx(a,Y,x,(()=>{x.removePendingData(u)}),J),x.addPendingData(u);if(i.position){const x=E.KJ.zJ(i.position);u.setPosition(x)}if(i.isDirectional&&(u.setDirectionalCone(i.coneInnerAngle||360,i.coneOuterAngle||360,i.coneOuterGain||0),i.localDirectionToMesh)){const x=E.KJ.zJ(i.localDirectionToMesh);u.setLocalDirectionToMesh(x)}if(i.connectedMeshId){const e=x.getMeshById(i.connectedMeshId);e&&u.attachToMesh(e)}return i.metadata&&(u.metadata=i.metadata),u}_setOffset(i){this._offset!==i&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=i)}_clearTimeoutsAndObservers(){var i;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(i=qx.c.audioEngine)||void 0===i||i.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}Gx._SceneComponentInitialization=i=>{throw(0,Px.e)("AudioSceneComponent")},(0,fi.f)("BABYLON.Sound",Gx);class vx{constructor(i,x,e){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],x.length!==e.length)throw new Error("Sounds length does not equal weights length");this.loop=i,this._weights=e;let j=0;for(const a of e)j+=a;const E=j>0?1/j:0;for(let a=0;a<this._weights.length;a++)this._weights[a]*=E;this._sounds=x;for(const a of this._sounds)a.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(i){if(i!==this._coneInnerAngle){if(this._coneOuterAngle<i)return void M.c.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=i;for(const x of this._sounds)x.directionalConeInnerAngle=i}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(i){if(i!==this._coneOuterAngle){if(i<this._coneInnerAngle)return void M.c.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=i;for(const x of this._sounds)x.directionalConeOuterAngle=i}}get volume(){return this._volume}set volume(i){if(i!==this._volume)for(const x of this._sounds)x.setVolume(i)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(i){if(!this.isPaused){this.stop();const i=Math.random();let x=0;for(let e=0;e<this._weights.length;e++)if(x+=this._weights[e],i<=x){this._currentIndex=e;break}}const x=this._sounds[this._currentIndex??0];x.isReady()?x.play(0,this.isPaused?void 0:i):x.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class sx{constructor(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(i=i||o.e.LastCreatedScene)&&(this._scene=i,this.soundCollection=[],this._options=x,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var i;null!==(i=qx.c.audioEngine)&&void 0!==i&&i.canUseWebAudio&&qx.c.audioEngine.audioContext&&(this._outputAudioNode=qx.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(qx.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(qx.c.audioEngine&&qx.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(i){var x;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&i.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==i.soundTrackId&&(-1===i.soundTrackId?this._scene.mainSoundTrack.removeSound(i):this._scene.soundTracks&&this._scene.soundTracks[i.soundTrackId].removeSound(i)),this.soundCollection.push(i),i.soundTrackId=this.id}removeSound(i){const x=this.soundCollection.indexOf(i);-1!==x&&this.soundCollection.splice(x,1)}setVolume(i){var x;null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=i)}switchPanningModelToHRTF(){var i;if(null!==(i=qx.c.audioEngine)&&void 0!==i&&i.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var i;if(null!==(i=qx.c.audioEngine)&&void 0!==i&&i.canUseWebAudio)for(let x=0;x<this.soundCollection.length;x++)this.soundCollection[x].switchPanningModelToEqualPower()}connectToAnalyser(i){var x;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=i,null!==(x=qx.c.audioEngine)&&void 0!==x&&x.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,qx.c.audioEngine.masterGain))}}var ie=e(12482),xe=e(12452),ee=e(12069);qx.c.AudioEngineFactory=(i,x,e)=>new je(i,x,e);class je{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new g.b,this.onAudioLockedObservable=new g.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,ee.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const j=document.createElement("audio");this._hostElement=i,this._audioContext=x,this._audioDestination=e;try{j&&j.canPlayType&&(j.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||j.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(E){}try{j&&j.canPlayType&&j.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(E){}}lock(){this._triggerSuspendedState()}unlock(){var i,x;if("running"===(null===(i=this._audioContext)||void 0===i?void 0:i.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(x=this._audioContext)||void 0===x||x.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{M.c.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var i;null===(i=this._audioContext)||void 0===i||i.addEventListener("statechange",(()=>{var i;this.unlocked&&"running"!==(null===(i=this._audioContext)||void 0===i?void 0:i.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var i;return null!==(i=this._audioContext)&&void 0!==i&&i.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(i){this.canUseWebAudio=!1,M.c.Error("Web Audio: "+i.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(i){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const i=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",x=document.createElement("style");x.appendChild(document.createTextNode(i)),document.getElementsByTagName("head")[0].appendChild(x),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var i;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(i=this._audioContext)||void 0===i||i.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(i){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=i)}connectToAnalyser(i){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=i,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var Ee=e(12089);(0,e(13564).d)(ie.c.NAME_AUDIO,((i,x,e,j)=>{let E,a=[];if(e.nL=e.nL||[],void 0!==i.nL&&null!==i.nL)for(let J=0,u=i.nL.length;J<u;J++){var Y;const u=i.nL[J];null!==(Y=qx.c.audioEngine)&&void 0!==Y&&Y.canUseWebAudio?(u.url||(u.url=u.name),a[u.url]?e.nL.push(Gx.Parse(u,x,j,a[u.url])):(E=Gx.Parse(u,x,j),a[u.url]=E,e.nL.push(E))):e.nL.push(new Gx(u.name,null,x))}a=[]})),Object.defineProperty(xe.d.prototype,"mainSoundTrack",{get:function(){let i=this._getComponent(ie.c.NAME_AUDIO);return i||(i=new ae(this),this.Ye(i)),this._mainSoundTrack||(this._mainSoundTrack=new sx(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),xe.d.prototype.getSoundByName=function(i){let x;for(x=0;x<this.mainSoundTrack.soundCollection.length;x++)if(this.mainSoundTrack.soundCollection[x].name===i)return this.mainSoundTrack.soundCollection[x];if(this.soundTracks)for(let e=0;e<this.soundTracks.length;e++)for(x=0;x<this.soundTracks[e].soundCollection.length;x++)if(this.soundTracks[e].soundCollection[x].name===i)return this.soundTracks[e].soundCollection[x];return null},Object.defineProperty(xe.d.prototype,"audioEnabled",{get:function(){let i=this._getComponent(ie.c.NAME_AUDIO);return i||(i=new ae(this),this.Ye(i)),i.audioEnabled},set:function(i){let x=this._getComponent(ie.c.NAME_AUDIO);x||(x=new ae(this),this.Ye(x)),i?x.enableAudio():x.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(xe.d.prototype,"headphone",{get:function(){let i=this._getComponent(ie.c.NAME_AUDIO);return i||(i=new ae(this),this.Ye(i)),i.headphone},set:function(i){let x=this._getComponent(ie.c.NAME_AUDIO);x||(x=new ae(this),this.Ye(x)),i?x.switchAudioModeForHeadphones():x.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(xe.d.prototype,"audioListenerPositionProvider",{get:function(){let i=this._getComponent(ie.c.NAME_AUDIO);return i||(i=new ae(this),this.Ye(i)),i.audioListenerPositionProvider},set:function(i){let x=this._getComponent(ie.c.NAME_AUDIO);if(x||(x=new ae(this),this.Ye(x)),i&&"function"!==typeof i)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");x.audioListenerPositionProvider=i},enumerable:!0,configurable:!0}),Object.defineProperty(xe.d.prototype,"audioListenerRotationProvider",{get:function(){let i=this._getComponent(ie.c.NAME_AUDIO);return i||(i=new ae(this),this.Ye(i)),i.audioListenerRotationProvider},set:function(i){let x=this._getComponent(ie.c.NAME_AUDIO);if(x||(x=new ae(this),this.Ye(x)),i&&"function"!==typeof i)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");x.audioListenerRotationProvider=i},enumerable:!0,configurable:!0}),Object.defineProperty(xe.d.prototype,"audioPositioningRefreshRate",{get:function(){let i=this._getComponent(ie.c.NAME_AUDIO);return i||(i=new ae(this),this.Ye(i)),i.audioPositioningRefreshRate},set:function(i){let x=this._getComponent(ie.c.NAME_AUDIO);x||(x=new ae(this),this.Ye(x)),x.audioPositioningRefreshRate=i},enumerable:!0,configurable:!0});class ae{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(i){this.name=ie.c.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new E.KJ,this._cachedCameraPosition=new E.KJ,this._lastCheck=0,this._invertMatrixTemp=new E.Matrix,this._cameraDirectionTemp=new E.KJ,(i=i||o.e.LastCreatedScene)&&(this.LJ=i,i.soundTracks=[],i.nL=[])}register(){this.LJ._afterRenderStage.registerStep(ie.c.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(i){if(i.nL=[],this.LJ.soundTracks)for(let x=0;x<this.LJ.soundTracks.length;x++){const e=this.LJ.soundTracks[x];for(let x=0;x<e.soundCollection.length;x++)i.nL.push(e.soundCollection[x].serialize())}}addFromContainer(i){if(i.nL)for(const x of i.nL)x.play(),x.autoplay=!0,this.LJ.mainSoundTrack.addSound(x)}removeFromContainer(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i.nL)for(const e of i.nL)e.stop(),e.autoplay=!1,this.LJ.mainSoundTrack.removeSound(e),x&&e.dispose()}dispose(){const i=this.LJ;if(i._mainSoundTrack&&i.mainSoundTrack.dispose(),i.soundTracks)for(let x=0;x<i.soundTracks.length;x++)i.soundTracks[x].dispose()}disableAudio(){const i=this.LJ;let x;for(this._audioEnabled=!1,qx.c.audioEngine&&qx.c.audioEngine.audioContext&&qx.c.audioEngine.audioContext.suspend(),x=0;x<i.mainSoundTrack.soundCollection.length;x++)i.mainSoundTrack.soundCollection[x].pause();if(i.soundTracks)for(x=0;x<i.soundTracks.length;x++)for(let e=0;e<i.soundTracks[x].soundCollection.length;e++)i.soundTracks[x].soundCollection[e].pause()}enableAudio(){const i=this.LJ;let x;for(this._audioEnabled=!0,qx.c.audioEngine&&qx.c.audioEngine.audioContext&&qx.c.audioEngine.audioContext.resume(),x=0;x<i.mainSoundTrack.soundCollection.length;x++)i.mainSoundTrack.soundCollection[x].isPaused&&i.mainSoundTrack.soundCollection[x].play();if(i.soundTracks)for(x=0;x<i.soundTracks.length;x++)for(let e=0;e<i.soundTracks[x].soundCollection.length;e++)i.soundTracks[x].soundCollection[e].isPaused&&i.soundTracks[x].soundCollection[e].play()}switchAudioModeForHeadphones(){const i=this.LJ;if(this._headphone=!0,i.mainSoundTrack.switchPanningModelToHRTF(),i.soundTracks)for(let x=0;x<i.soundTracks.length;x++)i.soundTracks[x].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const i=this.LJ;if(this._headphone=!1,i.mainSoundTrack.switchPanningModelToEqualPower(),i.soundTracks)for(let x=0;x<i.soundTracks.length;x++)i.soundTracks[x].switchPanningModelToEqualPower()}_afterRender(){const i=Ee.e.Now;if(this._lastCheck&&i-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=i;const x=this.LJ;if(!this._audioEnabled||!x._mainSoundTrack||!x.soundTracks||0===x._mainSoundTrack.soundCollection.length&&1===x.soundTracks.length)return;const e=qx.c.audioEngine;if(e&&e.audioContext){let i,j=x.activeCamera;if(x.activeCameras&&x.activeCameras.length>0&&(j=x.activeCameras[0]),this.audioListenerPositionProvider){const i=this.audioListenerPositionProvider();e.audioContext.listener.setPosition(i.x||0,i.y||0,i.z||0)}else j?this._cachedCameraPosition.equals(j.globalPosition)||(this._cachedCameraPosition.A(j.globalPosition),e.audioContext.listener.setPosition(j.globalPosition.x,j.globalPosition.y,j.globalPosition.z)):e.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const i=this.audioListenerRotationProvider();e.audioContext.listener.setOrientation(i.x||0,i.y||0,i.z||0,0,1,0)}else j?(j.rigCameras&&j.rigCameras.length>0&&(j=j.rigCameras[0]),j.getViewMatrix().invertToRef(this._invertMatrixTemp),E.KJ.TransformNormalToRef(ae._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.A(this._cameraDirectionTemp),e.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):e.audioContext.listener.setOrientation(0,0,0,0,1,0);for(i=0;i<x.mainSoundTrack.soundCollection.length;i++){const e=x.mainSoundTrack.soundCollection[i];e.useCustomAttenuation&&e.updateDistanceFromListener()}if(x.soundTracks)for(i=0;i<x.soundTracks.length;i++)for(let e=0;e<x.soundTracks[i].soundCollection.length;e++){const j=x.soundTracks[i].soundCollection[e];j.useCustomAttenuation&&j.updateDistanceFromListener()}}}}ae._CameraDirection=new E.KJ(0,0,-1),Gx._SceneComponentInitialization=i=>{let x=i._getComponent(ie.c.NAME_AUDIO);x||(x=new ae(i),i.Ye(x))};const Ye="MSFT_audio_emitter";class Je{constructor(i){this.name=Ye,this._loader=i,this.enabled=this._loader.isExtensionUsed(Ye)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const i=this._loader.Ne.extensions;if(i&&i[this.name]){const x=i[this.name];this._clips=x.clips,this._emitters=x.emitters,h.Assign(this._clips),h.Assign(this._emitters)}}loadSceneAsync(i,x){return R.LoadExtensionAsync(i,x,this.name,(async(e,j)=>{const E=new Array;E.push(this._loader.loadSceneAsync(i,x));for(const i of j.emitters){const x=h.Get(`${e}/emitters`,this._emitters,i);if(void 0!=x.refDistance||void 0!=x.maxDistance||void 0!=x.rolloffFactor||void 0!=x.distanceModel||void 0!=x.innerAngle||void 0!=x.outerAngle)throw new Error(`${e}: Direction or Distance properties are not allowed on emitters attached to a scene`);E.push(this._loadEmitterAsync(`${e}/emitters/${x.index}`,x))}await Promise.all(E)}))}loadNodeAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(i,j)=>{const a=new Array,J=await this._loader.loadNodeAsync(i,x,(x=>{for(const e of j.emitters){const j=h.Get(`${i}/emitters`,this._emitters,e);a.push(this._loadEmitterAsync(`${i}/emitters/${j.index}`,j).then((()=>{for(const i of j._babylonSounds)i.attachToMesh(x),void 0==j.innerAngle&&void 0==j.outerAngle||(i.setLocalDirectionToMesh(E.KJ.Forward()),i.setDirectionalCone(2*Y.Tools.ToDegrees(void 0==j.innerAngle?Math.PI:j.innerAngle),2*Y.Tools.ToDegrees(void 0==j.outerAngle?Math.PI:j.outerAngle),0))})))}e(x)}));return await Promise.all(a),J}))}loadAnimationAsync(i,x){return R.LoadExtensionAsync(i,x,this.name,(async(e,j)=>{const E=await this._loader.loadAnimationAsync(i,x),a=new Array;h.Assign(j.events);for(const Y of j.events)a.push(this._loadAnimationEventAsync(`${e}/events/${Y.index}`,i,x,Y,E));return await Promise.all(a),E}))}_loadClipAsync(i,x){if(x._objectURL)return x._objectURL;let e;if(x.uri)e=this._loader.loadUriAsync(i,x,x.uri);else{const j=h.Get(`${i}/bufferView`,this._loader.Ne.bufferViews,x.bufferView);e=this._loader.loadBufferViewAsync(`/bufferViews/${j.index}`,j)}return x._objectURL=e.then((i=>URL.createObjectURL(new Blob([i],{type:x.mimeType})))),x._objectURL}_loadEmitterAsync(i,x){if(x._babylonSounds=x._babylonSounds||[],!x._babylonData){const i=new Array,e=x.name||`emitter${x.index}`,j={loop:!1,autoplay:!1,volume:void 0==x.volume?1:x.volume};for(let a=0;a<x.clips.length;a++){const E=`/extensions/${this.name}/clips`,Y=h.Get(E,this._clips,x.clips[a].clip);i.push(this._loadClipAsync(`${E}/${x.clips[a].clip}`,Y).then((i=>{const E=x._babylonSounds[a]=new Gx(e,i,this._loader.babylonScene,null,j);E.refDistance=x.refDistance||1,E.maxDistance=x.maxDistance||256,E.rolloffFactor=x.rolloffFactor||1,E.distanceModel=x.distanceModel||"exponential"})))}const E=Promise.all(i).then((()=>{const i=x.clips.map((i=>i.weight||1)),e=new vx(x.loop||!1,x._babylonSounds,i);x.innerAngle&&(e.directionalConeInnerAngle=2*Y.Tools.ToDegrees(x.innerAngle)),x.outerAngle&&(e.directionalConeOuterAngle=2*Y.Tools.ToDegrees(x.outerAngle)),x.volume&&(e.volume=x.volume),x._babylonData.sound=e}));x._babylonData={loaded:E}}return x._babylonData.loaded}_getEventAction(i,x,e,j,E){switch(e){case"play":return i=>{const e=(E||0)+(i-j);x.play(e)};case"stop":return()=>{x.stop()};case"pause":return()=>{x.pause()};default:throw new Error(`${i}: Unsupported action ${e}`)}}_loadAnimationEventAsync(i,x,e,j,E){if(0==E.targetedAnimations.length)return Promise.resolve();const a=E.targetedAnimations[0],Y=j.Yx,J=h.Get(`/extensions/${this.name}/emitters`,this._emitters,Y);return this._loadEmitterAsync(i,J).then((()=>{const x=J._babylonData.sound;if(x){const e=new cx(j.time,this._getEventAction(i,x,j.action,j.time,j.startOffset));a.animation.addEvent(e),E.onAnimationGroupEndObservable.add((()=>{x.stop()})),E.onAnimationGroupPauseObservable.add((()=>{x.pause()}))}}))}}p(Ye),d(Ye,!0,(i=>new Je(i)));const ue="MSFT_lod";class be{constructor(i){var x;this.name=ue,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new g.b,this.onMaterialLODsLoadedObservable=new g.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=i,this.maxLODsToLoad=(null===(x=this._loader.parent.extensionOptions[ue])||void 0===x?void 0:x.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(ue)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let i=0;i<this._nodePromiseLODs.length;i++){const x=Promise.all(this._nodePromiseLODs[i]).then((()=>{0!==i&&(this._loader.endPerformanceCounter(`Node LOD ${i}`),this._loader.log(`Loaded node LOD ${i}`)),this.onNodeLODsLoadedObservable.notifyObservers(i),i!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${i+1}`),this._loadBufferLOD(this._nodeBufferLODs,i+1),this._nodeSignalLODs[i]&&this._nodeSignalLODs[i].resolve())}));this._loader._completePromises.push(x)}for(let i=0;i<this._materialPromiseLODs.length;i++){const x=Promise.all(this._materialPromiseLODs[i]).then((()=>{0!==i&&(this._loader.endPerformanceCounter(`Material LOD ${i}`),this._loader.log(`Loaded material LOD ${i}`)),this.onMaterialLODsLoadedObservable.notifyObservers(i),i!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${i+1}`),this._loadBufferLOD(this._materialBufferLODs,i+1),this._materialSignalLODs[i]&&this._materialSignalLODs[i].resolve())}));this._loader._completePromises.push(x)}}loadSceneAsync(i,x){const e=this._loader.loadSceneAsync(i,x);return this._loadBufferLOD(this._bufferLODs,0),e}loadNodeAsync(i,x,e){return R.LoadExtensionAsync(i,x,this.name,(async(i,E)=>{let a;const Y=this._getLODs(i,x,this._loader.Ne.nodes,E.ids);this._loader.logOpen(`${i}`);for(let x=0;x<Y.length;x++){const i=Y[x];0!==x&&(this._nodeIndexLOD=x,this._nodeSignalLODs[x]=this._nodeSignalLODs[x]||new j);const E=i=>{e(i),i.cJ(!1)},J=this._loader.loadNodeAsync(`/nodes/${i.index}`,i,E).then((i=>{if(0!==x){const i=Y[x-1];i._babylonTransformNode&&(this._disposeTransformNode(i._babylonTransformNode),delete i._babylonTransformNode)}return i.cJ(!0),i}));this._nodePromiseLODs[x]=this._nodePromiseLODs[x]||[],0===x?a=J:(this._nodeIndexLOD=null,this._nodePromiseLODs[x].push(J))}return this._loader.logClose(),await a}))}_loadMaterialAsync(i,x,e,j,E){return this._nodeIndexLOD?null:R.LoadExtensionAsync(i,x,this.name,(async(i,a)=>{let Y;const J=this._getLODs(i,x,this._loader.Ne.materials,a.ids);this._loader.logOpen(`${i}`);for(let x=0;x<J.length;x++){const i=J[x];0!==x&&(this._materialIndexLOD=x);const a=this._loader._loadMaterialAsync(`/materials/${i.index}`,i,e,j,(i=>{0===x&&E(i)})).then((i=>{if(0!==x){E(i);const e=J[x-1]._data;e[j]&&(this._disposeMaterials([e[j].babylonMaterial]),delete e[j])}return i}));this._materialPromiseLODs[x]=this._materialPromiseLODs[x]||[],0===x?Y=a:(this._materialIndexLOD=null,this._materialPromiseLODs[x].push(a))}return this._loader.logClose(),await Y}))}_loadUriAsync(i,x,e){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const E=this._nodeIndexLOD-1;return this._nodeSignalLODs[E]=this._nodeSignalLODs[E]||new j,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(i,x,e)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const E=this._materialIndexLOD-1;return this._materialSignalLODs[E]=this._materialSignalLODs[E]||new j,this._materialSignalLODs[E].promise.then((async()=>await this._loader.loadUriAsync(i,x,e)))}return null}loadBufferAsync(i,x,e,E){if(this._loader.parent.useRangeRequests&&!x.uri){if(!this._loader.bin)throw new Error(`${i}: Uri is missing or the binary glTF is missing its binary chunk`);const x=async(i,x)=>{const a=e,Y=a+E-1;let J=i[x];return J?(J.start=Math.min(J.start,a),J.end=Math.max(J.end,Y)):(J={start:a,end:Y,loaded:new j},i[x]=J),await J.loaded.promise.then((i=>new Uint8Array(i.buffer,i.byteOffset+e-J.start,E)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?x(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?x(this._materialBufferLODs,this._materialIndexLOD):x(this._bufferLODs,0)}return null}_loadBufferLOD(i,x){const e=i[x];e&&(this._loader.log(`Loading buffer range [${e.start}-${e.end}]`),this._loader.bin.readAsync(e.start,e.end-e.start+1).then((i=>{e.loaded.resolve(i)}),(i=>{e.loaded.reject(i)})))}_getLODs(i,x,e,j){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const E=[];for(let a=j.length-1;a>=0;a--)if(E.push(h.Get(`${i}/ids/${j[a]}`,e,j[a])),E.length===this.maxLODsToLoad)return E;return E.push(x),E}_disposeTransformNode(i){const x=[],e=i.material;e&&x.push(e);for(const E of i.getChildMeshes())E.material&&x.push(E.material);i.dispose();const j=x.filter((i=>this._loader.babylonScene.meshes.every((x=>x.material!=i))));this._disposeMaterials(j)}_disposeMaterials(i){const x={};for(const e of i){for(const i of e.getActiveTextures())x[i.uniqueId]=i;e.dispose()}for(const e in x)for(const i of this._loader.babylonScene.materials)i.hasTexture(x[e])&&delete x[e];for(const e in x)x[e].dispose()}}p(ue),d(ue,!0,(i=>new be(i)));const ge="MSFT_minecraftMesh";class Ae{constructor(i){this.name=ge,this._loader=i,this.enabled=this._loader.isExtensionUsed(ge)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtraAsync(i,x,this.name,(async(j,E)=>{if(E){if(!(e instanceof t.e))throw new Error(`${j}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(i,x,e);return e.needAlphaBlending()&&(e.forceDepthWrite=!0,e.separateCullingPass=!0),e.qe=e.forceDepthWrite,e.twoSidedLighting=!0,await E}}))}}p(ge),d(ge,!0,(i=>new Ae(i)));const Ke="MSFT_sRGBFactors";class Le{constructor(i){this.name=Ke,this._loader=i,this.enabled=this._loader.isExtensionUsed(Ke)}dispose(){this._loader=null}loadMaterialPropertiesAsync(i,x,e){return R.LoadExtraAsync(i,x,this.name,(async(j,E)=>{if(E){if(!(e instanceof t.e))throw new Error(`${j}: Material type not supported`);const E=this._loader.loadMaterialPropertiesAsync(i,x,e),a=e.wi().getEngine().useExactSrgbConversions;return e.albedoTexture||e.albedoColor.toLinearSpaceToRef(e.albedoColor,a),e.reflectivityTexture||e.reflectivityColor.toLinearSpaceToRef(e.reflectivityColor,a),await E}}))}}p(Ke),d(Ke,!0,(i=>new Le(i)));var oe=e(13859);const Me={};var ze=e(13919),Te=e(13895),Qe=e(13866),te=e(13874);function Ve(i,x){for(const e of i)for(const i of e.dataOutputs)if(i.uniqueId===x)return i;throw new Error("Could not find data out connection with unique id "+x)}function Se(i,x){for(const e of i)if(e instanceof Te.d)for(const i of e.signalInputs)if(i.uniqueId===x)return i;throw new Error("Could not find signal in connection with unique id "+x)}async function fe(i,x){const j=await Promise.all(i.allBlocks.map((async i=>{const x=function(i){switch(i){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([e.e(78),e.e(79)]).then(e.bind(e,15319))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await e.e(80).then(e.bind(e,15323))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await e.e(81).then(e.bind(e,15329))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await e.e(82).then(e.bind(e,15333))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await e.e(83).then(e.bind(e,15335))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await e.e(84).then(e.bind(e,15342))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await e.e(85).then(e.bind(e,15344))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await e.e(86).then(e.bind(e,15351))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await e.e(87).then(e.bind(e,15354))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await e.e(90).then(e.bind(e,15388))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await e.e(90).then(e.bind(e,15388))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await e.e(90).then(e.bind(e,15388))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await e.e(90).then(e.bind(e,15388))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await e.e(95).then(e.bind(e,15391))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await e.e(96).then(e.bind(e,15396))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await e.e(97).then(e.bind(e,15398))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await e.e(98).then(e.bind(e,15402))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await e.e(99).then(e.bind(e,15407))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await e.e(100).then(e.bind(e,15414))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await e.e(101).then(e.bind(e,15421))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await e.e(102).then(e.bind(e,15428))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await e.e(103).then(e.bind(e,15436))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await e.e(104).then(e.bind(e,15438))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await e.e(105).then(e.bind(e,15443))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await e.e(106).then(e.bind(e,15452))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await e.e(107).then(e.bind(e,15458))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await e.e(108).then(e.bind(e,15461))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await e.e(109).then(e.bind(e,15464))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await e.e(110).then(e.bind(e,15469))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await e.e(111).then(e.bind(e,15472))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await e.e(112).then(e.bind(e,15475))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await e.e(113).then(e.bind(e,15480))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await e.e(92).then(e.bind(e,15488))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await e.e(114).then(e.bind(e,15490))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await e.e(115).then(e.bind(e,15497))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await e.e(116).then(e.bind(e,15506))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await e.e(93).then(e.bind(e,15514))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await e.e(88).then(e.bind(e,15362))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await e.e(94).then(e.bind(e,15518))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await e.e(89).then(e.bind(e,15383))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await e.e(90).then(e.bind(e,15388))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await e.e(90).then(e.bind(e,15388))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await e.e(91).then(e.bind(e,15520))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await e.e(91).then(e.bind(e,15520))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await e.e(91).then(e.bind(e,15520))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await e.e(91).then(e.bind(e,15520))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await e.e(91).then(e.bind(e,15520))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await e.e(91).then(e.bind(e,15520))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await e.e(117).then(e.bind(e,15526))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await e.e(118).then(e.bind(e,15529))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await e.e(119).then(e.bind(e,15531))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await e.e(120).then(e.bind(e,15535))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await e.e(121).then(e.bind(e,15538))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await e.e(122).then(e.bind(e,15540))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await e.e(123).then(e.bind(e,15545))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await e.e(124).then(e.bind(e,15554))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await e.e(125).then(e.bind(e,15558))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await e.e(126).then(e.bind(e,15562))).FlowGraphDataSwitchBlock;default:if(Me[i])return Me[i];throw new Error(`Unknown block name ${i}`)}}(i.className);return await x()})));return function(i,x,e){const j=x.coordinator.createGraph(),E=[],a=x.valueParseFunction??Qe.e;for(let Y=0;Y<i.allBlocks.length;Y++){const J=Oe(i.allBlocks[Y],{LJ:x.coordinator.config.LJ,pathConverter:x.pathConverter,assetsContainer:x.coordinator.config.LJ,valueParseFunction:a},e[Y]);E.push(J),J instanceof ze.e&&j.addEventBlock(J)}for(const Y of E){for(const i of Y.dataInputs)for(const x of i.connectedPointIds){const e=Ve(E,x);i.connectTo(e)}if(Y instanceof Te.d)for(const i of Y.signalOutputs)for(const x of i.connectedPointIds){const e=Se(E,x);i.connectTo(e)}}for(const Y of i.executionContexts)we(Y,{graph:j,valueParseFunction:a},i.rightHanded);return j}(i,x,j)}function we(i,x,e){const j=x.graph.createContext();i.enableLogging&&(j.enableLogging=!0),j.treatDataAsRightHanded=e||!1;const E=x.valueParseFunction??Qe.e;j.uniqueId=i.uniqueId;const a=j.wi();if(i._assetsContext){var Y,J,u,b,g,A,K,L,o,M;const x=i._assetsContext,e={meshes:null===(Y=x.meshes)||void 0===Y?void 0:Y.map((i=>a.getMeshById(i))),lights:null===(J=x.lights)||void 0===J?void 0:J.map((i=>a.getLightByName(i))),cameras:null===(u=x.cameras)||void 0===u?void 0:u.map((i=>a.getCameraByName(i))),materials:null===(b=x.materials)||void 0===b?void 0:b.map((i=>a.getMaterialById(i))),textures:null===(g=x.textures)||void 0===g?void 0:g.map((i=>a.getTextureByName(i))),animations:null===(A=x.animations)||void 0===A?void 0:A.map((i=>a.animations.find((x=>x.name===i)))),skeletons:null===(K=x.skeletons)||void 0===K?void 0:K.map((i=>a.getSkeletonByName(i))),iL:null===(L=x.iL)||void 0===L?void 0:L.map((i=>a.getParticleSystemById(i))),animationGroups:null===(o=x.animationGroups)||void 0===o?void 0:o.map((i=>a.getAnimationGroupByName(i))),transformNodes:null===(M=x.transformNodes)||void 0===M?void 0:M.map((i=>a.getTransformNodeById(i))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],nL:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};j.assetsContext=e}for(const z in i._userVariables){const x=E(z,i._userVariables,j.assetsContext,a);j.userVariables[z]=x}for(const z in i._connectionValues){const x=E(z,i._connectionValues,j.assetsContext,a);j._setConnectionValueByKey(z,x)}return j}function Oe(i,x,e){const j={},E=x.valueParseFunction??Qe.e;if(i.config)for(const Y in i.config)j[Y]=E(Y,i.config,x.assetsContainer||x.LJ,x.LJ);if((0,Qe.k)(i.className)){if(!x.pathConverter)throw new Error("Path converter is required for this block");j.pathConverter=x.pathConverter}const a=new e(j);a.uniqueId=i.uniqueId;for(let Y=0;Y<i.dataInputs.length;Y++){const x=a.getDataInput(i.dataInputs[Y].name);if(!x)throw new Error("Could not find data input with name "+i.dataInputs[Y].name+" in block "+i.className);x.deserialize(i.dataInputs[Y])}for(let Y=0;Y<i.dataOutputs.length;Y++){const x=a.getDataOutput(i.dataOutputs[Y].name);if(!x)throw new Error("Could not find data output with name "+i.dataOutputs[Y].name+" in block "+i.className);x.deserialize(i.dataOutputs[Y])}return a.metadata=i.metadata,a.deserialize&&a.deserialize(i),a}function le(i){const[x,e]=i.split(":");return Ze({op:x,extension:e})}function Ze(i){var x;let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const j=i.extension?null===(x=ke[i.extension])||void 0===x?void 0:x[i.op]:Ne[i.op];if(!j&&(M.c.Warn(`No mapping found for operation ${i.op} and extension ${i.extension||"KHR_interactivity"}`),e)){const x={},e={flows:{}};if(i.inputValueSockets){x.values={};for(const e in i.inputValueSockets)x.values[e]={name:e}}return i.outputValueSockets&&(e.values={},Object.keys(i.outputValueSockets).forEach((i=>{e.values[i]={name:i}}))),{QA:[],inputs:x,outputs:e}}return j}function Be(i,x,e){ke[x]||(ke[x]={}),ke[x][i]=e}const ke={BABYLON:{"flow/log":{QA:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ne={"event/onStart":{QA:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{QA:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{QA:["FlowGraphSendCustomEventBlock"],extraProcessor(i,x,e,j,E){if("event/send"!==x.op||!i.configuration||1!==Object.keys(i.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const a=i.configuration.event.value[0];if("number"!==typeof a)throw new Error("Event id should be a number");const Y=j.arrays.events[a],J=E[0];return J.config||(J.config={}),J.config.eventId=Y.eventId,J.config.eventData=Y.eventData,E}},"event/receive":{QA:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(i,x){var e;if(!i.configuration)return M.c.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const j=i.configuration.event;if(!j)return M.c.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const E=j.value[0];if("number"!==typeof E)return M.c.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(e=x.events)||void 0===e?void 0:e[E])?{valid:!0}:(M.c.Error(`Event with id ${E} not found`),{valid:!1,error:`Event with id ${E} not found`})},extraProcessor(i,x,e,j,E){if("event/receive"!==x.op||!i.configuration||1!==Object.keys(i.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const a=i.configuration.event.value[0];if("number"!==typeof a)throw new Error("Event id should be a number");const Y=j.arrays.events[a],J=E[0];return J.config||(J.config={}),J.config.eventId=Y.eventId,J.config.eventData=Y.eventData,E}},"math/e":mj("FlowGraphEBlock"),"math/pi":mj("FlowGraphPIBlock"),"math/inf":mj("FlowGraphInfBlock"),"math/nan":mj("FlowGraphNaNBlock"),"math/abs":mj("FlowGraphAbsBlock"),"math/sign":mj("FlowGraphSignBlock"),"math/trunc":mj("FlowGraphTruncBlock"),"math/floor":mj("FlowGraphFloorBlock"),"math/ceil":mj("FlowGraphCeilBlock"),"math/round":{QA:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E){var a;return(a=E[0]).config||(a.config={}),E[0].config.roundHalfAwayFromZero=!0,E}},"math/fract":mj("FlowGraphFractBlock"),"math/neg":mj("FlowGraphNegationBlock"),"math/add":mj("FlowGraphAddBlock",["a","b"],!0),"math/sub":mj("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{QA:["FlowGraphMultiplyBlock"],extraProcessor(i,x,e,j,E){var a;(a=E[0]).config||(a.config={}),E[0].config.useMatrixPerComponent=!0,E[0].config.preventIntegerFloatArithmetic=!0;let Y=-1;return Object.keys(i.values||{}).find((x=>{var e;return void 0!==(null===(e=i.values)||void 0===e?void 0:e[x].type)&&(Y=i.values[x].type,!0)})),-1!==Y&&(E[0].config.type=j.arrays.types[Y].flowGraphType),E},validation:i=>i.values?Xe(i):{valid:!0}},"math/div":mj("FlowGraphDivideBlock",["a","b"],!0),"math/rem":mj("FlowGraphModuloBlock",["a","b"]),"math/min":mj("FlowGraphMinBlock",["a","b"]),"math/max":mj("FlowGraphMaxBlock",["a","b"]),"math/clamp":mj("FlowGraphClampBlock",["a","b","c"]),"math/saturate":mj("FlowGraphSaturateBlock"),"math/mix":mj("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":mj("FlowGraphEqualityBlock",["a","b"]),"math/lt":mj("FlowGraphLessThanBlock",["a","b"]),"math/le":mj("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":mj("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":mj("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":mj("FlowGraphIsNaNBlock"),"math/isinf":mj("FlowGraphIsInfBlock"),"math/select":{QA:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{QA:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":mj("FlowGraphSinBlock"),"math/cos":mj("FlowGraphCosBlock"),"math/tan":mj("FlowGraphTanBlock"),"math/asin":mj("FlowGraphASinBlock"),"math/acos":mj("FlowGraphACosBlock"),"math/atan":mj("FlowGraphATanBlock"),"math/atan2":mj("FlowGraphATan2Block",["a","b"]),"math/sinh":mj("FlowGraphSinhBlock"),"math/cosh":mj("FlowGraphCoshBlock"),"math/tanh":mj("FlowGraphTanhBlock"),"math/asinh":mj("FlowGraphASinhBlock"),"math/acosh":mj("FlowGraphACoshBlock"),"math/atanh":mj("FlowGraphATanhBlock"),"math/exp":mj("FlowGraphExponentialBlock"),"math/log":mj("FlowGraphLogBlock"),"math/log2":mj("FlowGraphLog2Block"),"math/log10":mj("FlowGraphLog10Block"),"math/sqrt":mj("FlowGraphSquareRootBlock"),"math/cbrt":mj("FlowGraphCubeRootBlock"),"math/pow":mj("FlowGraphPowerBlock",["a","b"]),"math/length":mj("FlowGraphLengthBlock"),"math/normalize":mj("FlowGraphNormalizeBlock"),"math/dot":mj("FlowGraphDotBlock",["a","b"]),"math/cross":mj("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":mj("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":mj("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{QA:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{QA:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{QA:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{QA:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{QA:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{QA:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{QA:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":mj("FlowGraphTransposeBlock"),"math/determinant":mj("FlowGraphDeterminantBlock"),"math/inverse":mj("FlowGraphInvertMatrixBlock"),"math/matmul":mj("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{QA:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"wJ",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E,a){const Y=E[0].dataInputs.find((i=>"rotationQuaternion"===i.name));if(!Y)throw new Error("Rotation quaternion input not found");return a._connectionValues[Y.uniqueId]&&(a._connectionValues[Y.uniqueId].type="Quaternion"),E}},"math/matDecompose":{QA:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"wJ"}}}},"math/quatConjugate":mj("FlowGraphConjugateBlock",["a"]),"math/quatMul":{QA:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E){var a;return(a=E[0]).config||(a.config={}),E[0].config.type="Quaternion",E}},"math/quatAngleBetween":mj("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{QA:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":mj("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":mj("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{QA:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E){var a;return(a=E[0]).config||(a.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract2x2":{QA:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{QA:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E){var a;return(a=E[0]).config||(a.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract3x3":{QA:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{QA:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E){var a;return(a=E[0]).config||(a.config={}),E[0].config.inputIsColumnMajor=!0,E}},"math/extract4x4":{QA:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{QA:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E,a){var Y,J;(J=E[0]).config||(J.config={});const u=E[0].dataInputs[0];return E[0].config.valueType=(null===(Y=a._connectionValues[u.uniqueId])||void 0===Y?void 0:Y.type)??"FlowGraphInteger",E}},"math/and":{QA:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E,a){var Y,J,u;(u=E[0]).config||(u.config={});const b=E[0].dataInputs[0],g=E[0].dataInputs[1];return E[0].config.valueType=(null===(Y=a._connectionValues[b.uniqueId])||void 0===Y?void 0:Y.type)??(null===(J=a._connectionValues[g.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",E}},"math/or":{QA:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E,a){var Y,J,u;(u=E[0]).config||(u.config={});const b=E[0].dataInputs[0],g=E[0].dataInputs[1];return E[0].config.valueType=(null===(Y=a._connectionValues[b.uniqueId])||void 0===Y?void 0:Y.type)??(null===(J=a._connectionValues[g.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",E}},"math/xor":{QA:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(i,x,e,j,E,a){var Y,J,u;(u=E[0]).config||(u.config={});const b=E[0].dataInputs[0],g=E[0].dataInputs[1];return E[0].config.valueType=(null===(Y=a._connectionValues[b.uniqueId])||void 0===Y?void 0:Y.type)??(null===(J=a._connectionValues[g.uniqueId])||void 0===J?void 0:J.type)??"FlowGraphInteger",E}},"math/asr":mj("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":mj("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":mj("FlowGraphLeadingZerosBlock"),"math/ctz":mj("FlowGraphTrailingZerosBlock"),"math/popcnt":mj("FlowGraphOneBitsCounterBlock"),"math/rad":mj("FlowGraphDegToRadBlock"),"math/deg":mj("FlowGraphRadToDegBlock"),"type/boolToInt":mj("FlowGraphBooleanToInt"),"type/boolToFloat":mj("FlowGraphBooleanToFloat"),"type/intToBool":mj("FlowGraphIntToBoolean"),"type/intToFloat":mj("FlowGraphIntToFloat"),"type/floatToInt":mj("FlowGraphFloatToInt"),"type/floatToBool":mj("FlowGraphFloatToBoolean"),"flow/sequence":{QA:["FlowGraphSequenceBlock"],extraProcessor(i,x,e,j,E){const a=E[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(i.flows||[]).length,a.signalOutputs.forEach(((i,x)=>{i.name="out_"+x})),E}},"flow/branch":{QA:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{QA:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(i){if(i.configuration&&i.configuration.cases){const x=i.configuration.cases.value;if(!x.every((i=>"number"===typeof i&&/^-?\d+$/.test(i.toString()))))return M.c.Warn("Switch cases should be integers. Using empty array instead."),i.configuration.cases.value=[],{valid:!0};const e=new Set(x);i.configuration.cases.value=Array.from(e)}return{valid:!0}},extraProcessor(i,x,e,j,E){if("flow/switch"!==x.op||!i.flows||0===Object.keys(i.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return E[0].signalOutputs.forEach((i=>{"default"!==i.name&&(i.name="out_"+i.name)})),E}},"flow/while":{QA:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{QA:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(i,x,e,j,E){const a=E[0];return a.config||(a.config={}),a.config.incrementIndexWhenLoopDone=!0,E}},"flow/doN":{QA:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{QA:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(i,x,e,j,E){if("flow/multiGate"!==x.op||!i.flows||0===Object.keys(i.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const a=E[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(i.flows).length,a.signalOutputs.forEach(((i,x)=>{i.name="out_"+x})),E}},"flow/waitAll":{QA:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(i){var x,e;return"number"!==typeof(null===(x=i.configuration)||void 0===x||null===(e=x.inputFlows)||void 0===e?void 0:e.value[0])&&(i.configuration=i.configuration||{inputFlows:{value:[0]}},i.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{QA:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{QA:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{QA:["FlowGraphCancelDelayBlock"]},"variable/get":{QA:["FlowGraphGetVariableBlock"],validation(i){var x,e;return null!==(x=i.configuration)&&void 0!==x&&null!==(e=x.variable)&&void 0!==e&&e.value?{valid:!0}:(M.c.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(i,x)=>[x.getVariableName(i[0])]}}},"variable/set":{QA:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(i,x)=>[x.getVariableName(i[0])]}}},"variable/setMultiple":{QA:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(i,x)=>[i[0].map((i=>x.getVariableName(i)))]}},extraProcessor:(i,x,e,j,E)=>(E[0].dataInputs.forEach((i=>{i.name=j.getVariableName(+i.name)})),E)},"variable/interpolate":{QA:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(i,x)=>[x.getVariableName(i[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:i=>!0===i[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ge:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ge:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ge:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ge:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ge:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ge:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(i,x,e,j,E){var a,Y,J;const u=E[0],b=null===(a=i.configuration)||void 0===a?void 0:a.variable.value[0];if("number"!==typeof b)throw M.c.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const g=j.arrays.staticVariables[b];"undefined"===typeof u.config.animationType.value&&(j.arrays.staticVariables,u.config.animationType.value=(0,te.I)(g.type));const A=E[4];return A.config||(A.config={}),(Y=A.config).variable||(Y.variable={}),A.config.variable.value=j.getVariableName(b),(J=E[3]).config||(J.config={}),E}},"pointer/get":{QA:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ge:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",Ge:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(i,x,e,j,E)=>(E.forEach((i=>{"FlowGraphJsonPointerParserBlock"===i.className&&(i.config||(i.config={}),i.config.outputValue=!0)})),E)},"pointer/set":{QA:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",Ge:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",Ge:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(i,x,e,j,E)=>(E.forEach((i=>{"FlowGraphJsonPointerParserBlock"===i.className&&(i.config||(i.config={}),i.config.outputValue=!0)})),E)},"pointer/interpolate":{QA:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",Ge:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",Ge:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",Ge:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",Ge:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",Ge:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",Ge:"FlowGraphPlayAnimationBlock"},out:{name:"out",Ge:"FlowGraphPlayAnimationBlock"},done:{name:"done",Ge:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(i,x,e,j,E)=>(E.forEach((x=>{"FlowGraphJsonPointerParserBlock"===x.className?(x.config||(x.config={}),x.config.outputValue=!0):"FlowGraphInterpolationBlock"===x.className&&(x.config||(x.config={}),Object.keys(i.values||[]).forEach((e=>{var E;const a=null===(E=i.values)||void 0===E?void 0:E[e];if("value"===e&&a){const i=a.type;void 0!==i&&(x.config.animationType=j.arrays.types[i].flowGraphType)}})))})),E)},"animation/start":{QA:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ge:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(i,x)=>[i[0]*x._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(i,x)=>[i[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(i,x,e,j,E,a,Y){const J=E[E.length-1];return J.config||(J.config={}),J.config.glTF=Y,E}},"animation/stop":{QA:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",Ge:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(i,x,e,j,E,a,Y){const J=E[E.length-1];return J.config||(J.config={}),J.config.glTF=Y,E}},"animation/stopAt":{QA:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",Ge:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(i,x)=>[i[0]*x._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(i,x,e,j,E,a,Y){const J=E[E.length-1];return J.config||(J.config={}),J.config.glTF=Y,E}},"math/switch":{QA:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(i){if(i.configuration&&i.configuration.cases){const x=i.configuration.cases.value;if(!x.every((i=>"number"===typeof i&&/^-?\d+$/.test(i.toString()))))return M.c.Warn("Switch cases should be integers. Using empty array instead."),i.configuration.cases.value=[],{valid:!0};const e=new Set(x);i.configuration.cases.value=Array.from(e)}return{valid:!0}},extraProcessor(i,x,e,j,E){const a=E[0];return a.dataInputs.forEach((i=>{"default"!==i.name&&"case"!==i.name&&(i.name="in_"+i.name)})),a.config||(a.config={}),a.config.treatCasesAsIntegers=!0,E}},"debug/log":{QA:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function mj(i){let x=arguments.length>2?arguments[2]:void 0;return{QA:[i],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((i,x)=>(i[x]={name:x},i)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(i,e,j,E,a){var Y;if(x){(Y=a[0]).config||(Y.config={}),a[0].config.preventIntegerFloatArithmetic=!0;let x=-1;Object.keys(i.values||{}).find((e=>{var j;return void 0!==(null===(j=i.values)||void 0===j?void 0:j[e].type)&&(x=i.values[e].type,!0)})),-1!==x&&(a[0].config.type=E.arrays.types[x].flowGraphType)}return a},validation:i=>x?Xe(i):{valid:!0}}}function Xe(i){if(i.values){const x=Object.keys(i.values).map((x=>i.values[x].type)).filter((i=>void 0!==i));if(!x.every((i=>i===x[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}Ne["math/compose"]=Ne["math/matCompose"],Ne["math/decompose"]=Ne["math/matDecompose"];var Ce=e(12213);const ne={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"KJ",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class Ie{constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=i,this._gltf=x,this._animationTargetFps=e,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const i of this._interactivityGraph.types)this._types.push(ne[i.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const i of this._interactivityGraph.declarations){const x=Ze(i);if(!x)throw M.c.Error(["No mapping found for declaration",i]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:x,fullOperationName:i.extension?i.op+":"+i.extension:i.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const i of this._interactivityGraph.variables){const x=this._parseVariable(i);this._staticVariables.push(x)}}_parseVariable(i,x){const e=this._types[i.type];if(!e)throw M.c.Error(["No type found for variable",i]),new Error("Error parsing variables");if(i.value&&i.value.length!==e.length)throw M.c.Error(["Invalid value length for variable",i,e]),new Error("Error parsing variables");const j=i.value||[];if(!j.length)switch(e.flowGraphType){case"boolean":j.push(!1);break;case"FlowGraphInteger":j.push(0);break;case"number":j.push(NaN);break;case"Vector2":j.push(NaN,NaN);break;case"KJ":j.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":j.fill(NaN,0,4);break;case"Matrix":j.fill(NaN,0,16);break;case"Matrix3D":j.fill(NaN,0,9)}return"number"===e.elementType&&"string"===typeof j[0]&&(j[0]=parseFloat(j[0])),{type:e.flowGraphType,value:x?x(j,this):j}}_parseEvents(){if(this._interactivityGraph.events)for(const i of this._interactivityGraph.events){const x={eventId:i.id||"internalEvent_"+this._internalEventsCounter++};i.values&&(x.eventData=Object.keys(i.values).map((x=>{var e;const j=null===(e=i.values)||void 0===e?void 0:e[x];if(!j)throw M.c.Error(["No value found for event key",x]),new Error("Error parsing events");const E=this._types[j.type];if(!E)throw M.c.Error(["No type found for event value",j]),new Error("Error parsing events");const a="undefined"!==typeof j.value?this._parseVariable(j):void 0;return{id:x,type:E.flowGraphType,eventData:!0,value:a}}))),this._events.push(x)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const x of this._interactivityGraph.nodes){if("number"!==typeof x.declaration)throw M.c.Error(["No declaration found for node",x]),new Error("Error parsing nodes");const e=this._mappings[x.declaration];if(!e)throw M.c.Error(["No mapping found for node",x]),new Error("Error parsing nodes");if(e.flowGraphMapping.validation){const j=e.flowGraphMapping.validation(x,this._interactivityGraph,this._gltf);var i;if(!j.valid)throw new Error(`Error validating interactivity node ${null===(i=this._interactivityGraph.declarations)||void 0===i?void 0:i[x.declaration].op} - ${j.error}`)}const j=[];for(const i of e.flowGraphMapping.QA){const E=this._getEmptyBlock(i,e.fullOperationName);this._parseNodeConfiguration(x,E,e.flowGraphMapping,i),j.push(E)}this._nodes.push({QA:j,fullOperationName:e.fullOperationName})}}_getEmptyBlock(i,x){return{uniqueId:(0,Ce.b)(),className:i,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:x,metadata:{}}}_parseNodeConfiguration(i,x,e,j){const E=x.config;if(i.configuration){const x=Object.keys(i.configuration);for(const J of x){var a,Y;const x=null===(a=i.configuration)||void 0===a?void 0:a[J];if(!x)throw M.c.Error(["No value found for node configuration",J]),new Error("Error parsing node configuration");const u=null===(Y=e.configuration)||void 0===Y?void 0:Y[J];if(u&&u.Ge?u.Ge===j:0===e.QA.indexOf(j)){const i=(null===u||void 0===u?void 0:u.name)||J;x&&"undefined"!==typeof x.value||"undefined"===typeof(null===u||void 0===u?void 0:u.defaultValue)?x.value.length>=0?E[i]={value:1===x.value.length?x.value[0]:x.value}:M.c.Warn(["Invalid value for node configuration",x]):E[i]={value:u.defaultValue},u&&u.dataTransformer&&(E[i].value=u.dataTransformer([E[i].value],this)[0])}}}}_parseNodeConnections(i){for(let f=0;f<this._nodes.length;f++){var x;const w=null===(x=this._interactivityGraph.nodes)||void 0===x?void 0:x[f];if(!w)throw M.c.Error(["No node found for interactivity node",this._nodes[f]]),new Error("Error parsing node connections");const O=this._nodes[f],l=this._mappings[w.declaration];if(!l)throw M.c.Error(["No mapping found for node",w]),new Error("Error parsing node connections");const Z=w.flows||{},B=Object.keys(Z).sort();for(const i of B){var e,j,E,a;const x=Z[i],b=null===(e=l.flowGraphMapping.outputs)||void 0===e||null===(j=e.flows)||void 0===j?void 0:j[i],g=(null===b||void 0===b?void 0:b.name)||i,A=this._createNewSocketConnection(g,!0);(b&&b.Ge&&O.QA.find((i=>i.className===b.Ge))||O.QA[0]).signalOutputs.push(A);const K=x.node,L=this._nodes[K];if(!L)throw M.c.Error(["No node found for input node id",K]),new Error("Error parsing node connections");const o=le(L.fullOperationName);if(!o)throw M.c.Error(["No mapping found for input node",L]),new Error("Error parsing node connections");let z=null===(E=o.inputs)||void 0===E||null===(a=E.flows)||void 0===a?void 0:a[x.socket||"in"],T=!1;if(!z)for(const i in null===(Y=o.inputs)||void 0===Y?void 0:Y.flows){var Y,J,u;if(i.startsWith("[")&&i.endsWith("]"))T=!0,z=null===(J=o.inputs)||void 0===J||null===(u=J.flows)||void 0===u?void 0:u[i]}const Q=z?T?z.name.replace("$1",x.socket||""):z.name:x.socket||"in",t=z&&z.Ge&&L.QA.find((i=>i.className===z.Ge))||L.QA[0];let V=t.signalInputs.find((i=>i.name===Q));V||(V=this._createNewSocketConnection(Q),t.signalInputs.push(V)),V.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(V.uniqueId)}const k=w.values||{},N=Object.keys(k);for(const x of N){var b,g;const e=k[x];let j=null===(b=l.flowGraphMapping.inputs)||void 0===b||null===(g=b.values)||void 0===g?void 0:g[x],E=!1;if(!j)for(const i in null===(A=l.flowGraphMapping.inputs)||void 0===A?void 0:A.values){var A,K,L;if(i.startsWith("[")&&i.endsWith("]"))E=!0,j=null===(K=l.flowGraphMapping.inputs)||void 0===K||null===(L=K.values)||void 0===L?void 0:L[i]}const a=j?E?j.name.replace("$1",x):j.name:x,Y=this._createNewSocketConnection(a);if((j&&j.Ge&&O.QA.find((i=>i.className===j.Ge))||O.QA[0]).dataInputs.push(Y),void 0!==e.value){const x=this._parseVariable(e,j&&j.dataTransformer);i._connectionValues[Y.uniqueId]=x}else{if("undefined"===typeof e.node)throw M.c.Error(["Invalid value for value connection",e]),new Error("Error parsing node connections");{var o,z,T;const i=e.node,x=e.socket||"value",j=this._nodes[i];if(!j)throw M.c.Error(["No node found for output socket reference",e]),new Error("Error parsing node connections");const E=le(j.fullOperationName);if(!E)throw M.c.Error(["No mapping found for output socket reference",e]),new Error("Error parsing node connections");let a=null===(o=E.outputs)||void 0===o||null===(z=o.values)||void 0===z?void 0:z[x],J=!1;if(!a)for(const e in null===(Q=E.outputs)||void 0===Q?void 0:Q.values){var Q,t,V;if(e.startsWith("[")&&e.endsWith("]"))J=!0,a=null===(t=E.outputs)||void 0===t||null===(V=t.values)||void 0===V?void 0:V[e]}const u=a?J?a.name.replace("$1",x):null===(T=a)||void 0===T?void 0:T.name:x,b=a&&a.Ge&&j.QA.find((i=>i.className===a.Ge))||j.QA[0];let g=b.dataOutputs.find((i=>i.name===u));g||(g=this._createNewSocketConnection(u,!0),b.dataOutputs.push(g)),Y.connectedPointIds.push(g.uniqueId),g.connectedPointIds.push(Y.uniqueId)}}}if(l.flowGraphMapping.interBlockConnectors)for(const i of l.flowGraphMapping.interBlockConnectors){const x=i.input,e=i.output,j=i.isVariable;this._connectFlowGraphNodes(x,e,O.QA[i.inputBlockIndex],O.QA[i.outputBlockIndex],j)}if(l.flowGraphMapping.extraProcessor){var S;const x=null===(S=this._interactivityGraph.declarations)||void 0===S?void 0:S[w.declaration];if(!x)throw M.c.Error(["No declaration found for extra processor",w]),new Error("Error parsing node connections");O.QA=l.flowGraphMapping.extraProcessor(w,x,l.flowGraphMapping,this,O.QA,i,this._gltf)}}}_createNewSocketConnection(i,x){return{uniqueId:(0,Ce.b)(),name:i,_connectionType:x?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(i,x,e,j,E){const a=E?e.dataInputs:e.signalInputs,Y=E?j.dataOutputs:j.signalOutputs,J=a.find((x=>x.name===i))||this._createNewSocketConnection(i),u=Y.find((i=>i.name===x))||this._createNewSocketConnection(x,!0);a.find((x=>x.name===i))||a.push(J),Y.find((i=>i.name===x))||Y.push(u),J.connectedPointIds.push(u.uniqueId),u.connectedPointIds.push(J.uniqueId)}getVariableName(i){return"staticVariable_"+i}serializeToFlowGraph(){const i={uniqueId:(0,Ce.b)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(i);for(let x=0;x<this._staticVariables.length;x++){const e=this._staticVariables[x];i._userVariables[this.getVariableName(x)]=e}return{rightHanded:!0,allBlocks:this._nodes.reduce(((i,x)=>i.concat(x.QA)),[]),executionContexts:[i]}}}const de="KHR_interactivity";class pe{constructor(i){this._loader=i,this.name=de,this.enabled=this._loader.isExtensionUsed(de),this._pathConverter=(0,H.g)(this._loader.Ne),i._skipStartAnimationStep=!0;const x=i.babylonScene;x&&function(i){(0,H.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!i.activeCamera)return new E.Quaternion(NaN,NaN,NaN,NaN);const x=E.Quaternion.FromRotationMatrix(i.activeCamera.getWorldMatrix()).normalize();return i.useRightHandedSystem||(x.w*=-1,x.x*=-1),x},type:"Quaternion",getTarget:()=>i.activeCamera}),(0,H.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!i.activeCamera)return new E.KJ(NaN,NaN,NaN);const x=i.activeCamera.getWorldMatrix().getTranslation();return i.useRightHandedSystem||(x.x*=-1),x},type:"KJ",getTarget:()=>i.activeCamera}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:i=>{var x;return(null===(x=i._babylonAnimationGroup)||void 0===x?void 0:x.isPlaying)??!1},type:"boolean",getTarget:i=>i._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:i=>{var x;return((null===(x=i._babylonAnimationGroup)||void 0===x?void 0:x.from)??0)/60},type:"number",getTarget:i=>i._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:i=>{var x;return((null===(x=i._babylonAnimationGroup)||void 0===x?void 0:x.to)??0)/60},type:"number",getTarget:i=>i._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:i=>{var x;return((null===(x=i._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:i=>i._babylonAnimationGroup}),(0,H.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:i=>{var x;return((null===(x=i._babylonAnimationGroup)||void 0===x?void 0:x.getCurrentFrame())??0)/60},type:"number",getTarget:i=>i._babylonAnimationGroup})}(x)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var i;if(!this._loader.babylonScene||!this._pathConverter)return;const x=this._loader.babylonScene,e=null===(i=this._loader.Ne.extensions)||void 0===i?void 0:i.KHR_interactivity;if(!e)return;const j=new oe.e({LJ:x});j.dispatchEventsSynchronously=!1;const E=e.graphs.map((i=>new Ie(i,this._loader.Ne,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(E.map((async i=>await fe(i,{coordinator:j,pathConverter:this._pathConverter})))),j.start()}}var He;He=async()=>(await Promise.resolve().then(e.bind(e,13933))).FlowGraphGLTFDataProvider,Me[`${de}/${"FlowGraphGLTFDataProvider"}`]=He,p(de),d(de,!0,(i=>new pe(i)));const Ue="KHR_node_visibility";(0,H.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:i=>{const x=i._babylonTransformNode;return!x||void 0===x.isVisible||x.isVisible},set:(i,x)=>{var e,j;null===(e=x._primitiveBabylonMeshes)||void 0===e||e.forEach((i=>{i.inheritVisibility=!0})),x._babylonTransformNode&&(x._babylonTransformNode.isVisible=i),null===(j=x._primitiveBabylonMeshes)||void 0===j||j.forEach((x=>{x.isVisible=i}))},getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class De{constructor(i){this.name=Ue,this._loader=i,this.enabled=i.isExtensionUsed(Ue)}async onReady(){var i;null===(i=this._loader.Ne.nodes)||void 0===i||i.forEach((i=>{var x,e,j,E;(null===(x=i._primitiveBabylonMeshes)||void 0===x||x.forEach((i=>{i.inheritVisibility=!0})),null!==(e=i.extensions)&&void 0!==e&&e.KHR_node_visibility)&&(!1===(null===(j=i.extensions)||void 0===j?void 0:j.KHR_node_visibility.visible)&&(i._babylonTransformNode&&(i._babylonTransformNode.isVisible=!1),null===(E=i._primitiveBabylonMeshes)||void 0===E||E.forEach((i=>{i.isVisible=!1}))))}))}dispose(){this._loader=null}}p(Ue),d(Ue,!0,(i=>new De(i)));const he="KHR_node_selectability";Be("event/onSelect",he,{QA:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ge:"FlowGraphGetVariableBlock",dataTransformer:i=>["pickedMesh_"+i[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",Ge:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(i,x,e,j,E,a,Y){var J,u,b,g,A,K;const L=E[E.length-1];L.config=L.config||{},L.config.glTF=Y;const o=null===(J=i.configuration)||void 0===J||null===(u=J.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===o||"number"!==typeof o)throw new Error("nodeIndex not found in configuration");const M="pickedMesh_"+o;return E[1].config.variable=M,a._userVariables[M]={className:"Mesh",id:null===Y||void 0===Y||null===(b=Y.nodes)||void 0===b||null===(g=b[o]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===Y||void 0===Y||null===(A=Y.nodes)||void 0===A||null===(K=A[o]._babylonTransformNode)||void 0===K?void 0:K.uniqueId},E}}),(0,H.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:i=>{const x=i._babylonTransformNode;return!x||void 0===x.hu||x.hu},set:(i,x)=>{var e;null===(e=x._primitiveBabylonMeshes)||void 0===e||e.forEach((x=>{x.hu=i}))},getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"hu"],type:"boolean"});class Fe{constructor(i){this.name=he,this._loader=i,this.enabled=i.isExtensionUsed(he)}async onReady(){var i;null===(i=this._loader.Ne.nodes)||void 0===i||i.forEach((i=>{var x,e,j;null!==(x=i.extensions)&&void 0!==x&&x.KHR_node_selectability&&!1===(null===(e=i.extensions)||void 0===e?void 0:e.KHR_node_selectability.selectable)&&(null===(j=i._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((i=>{i.hu=!1})))}))}dispose(){this._loader=null}}p(he),d(he,!0,(i=>new Fe(i)));const Re="KHR_node_hoverability",ye="targetMeshPointerOver_";Be("event/onHoverIn",Re,{QA:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ge:"FlowGraphGetVariableBlock",dataTransformer:i=>[ye+i[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ge:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(i,x,e,j,E,a,Y){var J,u,b,g,A,K;const L=E[E.length-1];L.config=L.config||{},L.config.glTF=Y;const o=null===(J=i.configuration)||void 0===J||null===(u=J.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===o||"number"!==typeof o)throw new Error("nodeIndex not found in configuration");const M=ye+o;return E[1].config.variable=M,a._userVariables[M]={className:"Mesh",id:null===Y||void 0===Y||null===(b=Y.nodes)||void 0===b||null===(g=b[o]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===Y||void 0===Y||null===(A=Y.nodes)||void 0===A||null===(K=A[o]._babylonTransformNode)||void 0===K?void 0:K.uniqueId},E}});const re="targetMeshPointerOut_";Be("event/onHoverOut",Re,{QA:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",Ge:"FlowGraphGetVariableBlock",dataTransformer:i=>[re+i[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",Ge:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(i,x,e,j,E,a,Y){var J,u,b,g,A,K;const L=E[E.length-1];L.config=L.config||{},L.config.glTF=Y;const o=null===(J=i.configuration)||void 0===J||null===(u=J.nodeIndex)||void 0===u?void 0:u.value[0];if(void 0===o||"number"!==typeof o)throw new Error("nodeIndex not found in configuration");const M=re+o;return E[1].config.variable=M,a._userVariables[M]={className:"Mesh",id:null===Y||void 0===Y||null===(b=Y.nodes)||void 0===b||null===(g=b[o]._babylonTransformNode)||void 0===g?void 0:g.id,uniqueId:null===Y||void 0===Y||null===(A=Y.nodes)||void 0===A||null===(K=A[o]._babylonTransformNode)||void 0===K?void 0:K.uniqueId},E}}),(0,H.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:i=>{const x=i._babylonTransformNode;return!x||void 0===x.pointerOverDisableMeshTesting||x.pointerOverDisableMeshTesting},set:(i,x)=>{var e;null===(e=x._primitiveBabylonMeshes)||void 0===e||e.forEach((x=>{x.pointerOverDisableMeshTesting=!i}))},getTarget:i=>i._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class ce{constructor(i){this.name=Re,this._loader=i,this.enabled=i.isExtensionUsed(Re)}async onReady(){var i;null===(i=this._loader.Ne.nodes)||void 0===i||i.forEach((i=>{var x,e,j;null!==(x=i.extensions)&&void 0!==x&&x.KHR_node_hoverability&&!1===(null===(e=i.extensions)||void 0===e?void 0:e.KHR_node_hoverability.hoverable)&&(null===(j=i._babylonTransformNode)||void 0===j||j.getChildMeshes().forEach((i=>{i.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}p(Re),d(Re,!0,(i=>new ce(i)));const Pe="ExtrasAsMetadata";class qe{_assignExtras(i,x){if(x.extras&&Object.keys(x.extras).length>0){const e=i.metadata=i.metadata||{};(e.Ne=e.Ne||{}).extras=x.extras}}constructor(i){this.name=Pe,this.enabled=!0,this._loader=i}dispose(){this._loader=null}loadNodeAsync(i,x,e){return this._loader.loadNodeAsync(i,x,(i=>{this._assignExtras(i,x),e(i)}))}loadCameraAsync(i,x,e){return this._loader.loadCameraAsync(i,x,(i=>{this._assignExtras(i,x),e(i)}))}createMaterial(i,x,e){const j=this._loader.createMaterial(i,x,e);return this._assignExtras(j,x),j}}p(Pe),d(Pe,!1,(i=>new qe(i)));e(13933)},13806:(i,x,e)=>{"use strict";e.d(x,{e:()=>X,i:()=>l,l:()=>O,n:()=>Z});var j=e(12065),E=e(12061),a=e(13493),Y=e(12675),J=e(12633),u=e(12648),b=e(12072),g=e(12108),A=e(12672),K=e(12773),L=e(12677),o=e(12283);class M{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.iL=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.nL=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(i){this._environmentTexture=i}getNodes(){let i=[];i=i.concat(this.meshes),i=i.concat(this.lights),i=i.concat(this.cameras),i=i.concat(this.transformNodes);for(const x of this.skeletons)i=i.concat(x.bones);return i}}class z extends M{}class T{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const i=this.rootNodes;for(const j of i)j.dispose();i.length=0;const x=this.skeletons;for(const j of x)j.dispose();x.length=0;const e=this.animationGroups;for(const j of e)j.dispose();e.length=0}}class Q extends M{constructor(i){super(),this._wasAddedToScene=!1,(i=i||g.e.LastCreatedScene)&&(this.LJ=i,this.proceduralTextures=[],i.te.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=i.getEngine().onContextRestoredObservable.add((()=>{for(const i of this.geometries)i._rebuild();for(const i of this.meshes)i._rebuild();for(const i of this.iL)i.rebuild();for(const i of this.textures)i._rebuild()})))}_topologicalSort(i){const x=new Map;for(const Y of i)x.set(Y.uniqueId,Y);const e={dependsOn:new Map,dependedBy:new Map};for(const Y of i){const i=Y.uniqueId;e.dependsOn.set(i,new Set),e.dependedBy.set(i,new Set)}for(const Y of i){const i=Y.uniqueId,j=e.dependsOn.get(i);if(Y instanceof A.b){const E=Y.sourceMesh;x.has(E.uniqueId)&&(j.add(E.uniqueId),e.dependedBy.get(E.uniqueId).add(i))}const E=e.dependedBy.get(i);for(const a of Y.getDescendants()){const j=a.uniqueId;if(x.has(j)){E.add(j);e.dependsOn.get(j).add(i)}}}const j=[],E=[];for(const Y of i){const i=Y.uniqueId;0===e.dependsOn.get(i).size&&(E.push(Y),x.delete(i))}const a=E;for(;a.length>0;){const i=a.shift();j.push(i);const E=e.dependedBy.get(i.uniqueId);for(const j of Array.from(E.values())){const E=e.dependsOn.get(j);E.delete(i.uniqueId),0===E.size&&x.get(j)&&(a.push(x.get(j)),x.delete(j))}}return x.size>0&&(b.c.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),x.forEach((i=>{b.c.Error(i.name)}))),j}_addNodeAndDescendantsToList(i,x,e,j){if(e&&(!j||j(e))&&!x.has(e.uniqueId)){i.push(e),x.add(e.uniqueId);for(const E of e.getDescendants(!0))this._addNodeAndDescendantsToList(i,x,E,j)}}_isNodeInContainer(i){return i instanceof u.e&&-1!==this.meshes.indexOf(i)||(i instanceof J.d&&-1!==this.transformNodes.indexOf(i)||(i instanceof K.e&&-1!==this.lights.indexOf(i)||i instanceof L.b&&-1!==this.cameras.indexOf(i)))}_isValidHierarchy(){for(const i of this.meshes)if(i.parent&&!this._isNodeInContainer(i.parent))return b.c.Warn(`Node ${i.name} has a parent that is not in the container.`),!1;for(const i of this.transformNodes)if(i.parent&&!this._isNodeInContainer(i.parent))return b.c.Warn(`Node ${i.name} has a parent that is not in the container.`),!1;for(const i of this.lights)if(i.parent&&!this._isNodeInContainer(i.parent))return b.c.Warn(`Node ${i.name} has a parent that is not in the container.`),!1;for(const i of this.cameras)if(i.parent&&!this._isNodeInContainer(i.parent))return b.c.Warn(`Node ${i.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(i){let x=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const j={},a={},J=new T,u=[],b=[],g={doNotInstantiate:!0,...e},A=[],K=new Set;for(const E of this.transformNodes)null===E.parent&&this._addNodeAndDescendantsToList(A,K,E,g.predicate);for(const E of this.meshes)null===E.parent&&this._addNodeAndDescendantsToList(A,K,E,g.predicate);const L=this._topologicalSort(A),o=(e,E)=>{if(((x,e)=>{if(j[x.uniqueId]=e.uniqueId,a[e.uniqueId]=e,i&&(e.name=i(x.name)),e instanceof Y.c){const i=e;if(i.morphTargetManager){const e=x.morphTargetManager;i.morphTargetManager=e.clone();for(let x=0;x<e.numTargets;x++){const E=e.getTarget(x),Y=i.morphTargetManager.getTarget(x);j[E.uniqueId]=Y.uniqueId,a[Y.uniqueId]=Y}}}})(e,E),e.parent){const i=j[e.parent.uniqueId],x=a[i];E.parent=x||e.parent}if(E.position&&e.position&&E.position.A(e.position),E.rotationQuaternion&&e.rotationQuaternion&&E.rotationQuaternion.A(e.rotationQuaternion),E.rotation&&e.rotation&&E.rotation.A(e.rotation),E.wJ&&e.wJ&&E.wJ.A(e.wJ),E.material){const Y=E;if(Y.material)if(x){const x=e.material;if(-1===b.indexOf(x)){let e=x.clone(i?i(x.name):"Clone of "+x.name);if(b.push(x),j[x.uniqueId]=e.uniqueId,a[e.uniqueId]=e,"MultiMaterial"===x.getClassName()){const E=x;for(const x of E.ZJ)x&&(e=x.clone(i?i(x.name):"Clone of "+x.name),b.push(x),j[x.uniqueId]=e.uniqueId,a[e.uniqueId]=e);E.ZJ=E.ZJ.map((i=>i&&a[j[i.uniqueId]]))}}"InstancedMesh"!==Y.getClassName()&&(Y.material=a[j[x.uniqueId]])}else"MultiMaterial"===Y.material.getClassName()?-1===this.LJ.multiMaterials.indexOf(Y.material)&&this.LJ.addMultiMaterial(Y.material):-1===this.LJ.materials.indexOf(Y.material)&&this.LJ.addMaterial(Y.material)}null===E.parent&&J.rootNodes.push(E)};for(const E of L)if("InstancedMesh"===E.getClassName()){const i=E,x=i.sourceMesh,e=j[x.uniqueId];o(i,("number"===typeof e?a[e]:x).createInstance(i.name))}else{let i=!0;"xb"===E.getClassName()||"Node"===E.getClassName()||E.skeleton||!E.getTotalVertices||0===E.getTotalVertices()?i=!1:g.doNotInstantiate&&(i="function"===typeof g.doNotInstantiate?!g.doNotInstantiate(E):!g.doNotInstantiate);const x=i?E.createInstance(`instance of ${E.name}`):E.clone(`Clone of ${E.name}`,null,!0);if(!x)throw new Error(`Could not clone or instantiate node on Asset Container ${E.name}`);o(E,x)}for(const E of this.skeletons){if(g.predicate&&!g.predicate(E))continue;const x=E.clone(i?i(E.name):"Clone of "+E.name);for(const i of this.meshes)if(i.skeleton===E&&!i.isAnInstance){const e=a[j[i.uniqueId]];if(!e||e.isAnInstance)continue;if(e.skeleton=x,-1!==u.indexOf(x))continue;u.push(x);for(const i of x.bones)i._linkedTransformNode&&(i._linkedTransformNode=a[j[i._linkedTransformNode.uniqueId]])}J.skeletons.push(x)}for(const E of this.animationGroups){if(g.predicate&&!g.predicate(E))continue;const x=E.clone(i?i(E.name):"Clone of "+E.name,(i=>a[j[i.uniqueId]]||i));J.animationGroups.push(x)}return J}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.LJ.environmentTexture=this.environmentTexture);for(const i of this.LJ._serializableComponents)i.addFromContainer(this);this.LJ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const x=[];for(const e of this.cameras)i&&!i(e)||(this.LJ.addCamera(e),x.push(e));for(const e of this.lights)i&&!i(e)||(this.LJ.addLight(e),x.push(e));for(const e of this.meshes)i&&!i(e)||(this.LJ.YA(e),x.push(e));for(const e of this.skeletons)i&&!i(e)||this.LJ.addSkeleton(e);for(const e of this.animations)i&&!i(e)||this.LJ.addAnimation(e);for(const e of this.animationGroups)i&&!i(e)||this.LJ.addAnimationGroup(e);for(const e of this.multiMaterials)i&&!i(e)||this.LJ.addMultiMaterial(e);for(const e of this.materials)i&&!i(e)||this.LJ.addMaterial(e);for(const e of this.morphTargetManagers)i&&!i(e)||this.LJ.addMorphTargetManager(e);for(const e of this.geometries)i&&!i(e)||this.LJ.addGeometry(e);for(const e of this.transformNodes)i&&!i(e)||(this.LJ.addTransformNode(e),x.push(e));for(const e of this.actionManagers)i&&!i(e)||this.LJ.addActionManager(e);for(const e of this.textures)i&&!i(e)||this.LJ.addTexture(e);for(const e of this.reflectionProbes)i&&!i(e)||this.LJ.addReflectionProbe(e);for(const e of x)e.parent&&-1===this.LJ.getNodes().indexOf(e.parent)&&(e.setParent?e.setParent(null):e.parent=null)}removeAllFromScene(){this._isValidHierarchy()||E.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.LJ.environmentTexture&&(this.LJ.environmentTexture=null);for(const i of this.LJ._serializableComponents)i.removeFromContainer(this)}removeFromScene(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const x of this.cameras)i&&!i(x)||this.LJ.removeCamera(x);for(const x of this.lights)i&&!i(x)||this.LJ.removeLight(x);for(const x of this.meshes)i&&!i(x)||this.LJ.aA(x,!0);for(const x of this.skeletons)i&&!i(x)||this.LJ.removeSkeleton(x);for(const x of this.animations)i&&!i(x)||this.LJ.removeAnimation(x);for(const x of this.animationGroups)i&&!i(x)||this.LJ.removeAnimationGroup(x);for(const x of this.multiMaterials)i&&!i(x)||this.LJ.removeMultiMaterial(x);for(const x of this.materials)i&&!i(x)||this.LJ.removeMaterial(x);for(const x of this.morphTargetManagers)i&&!i(x)||this.LJ.removeMorphTargetManager(x);for(const x of this.geometries)i&&!i(x)||this.LJ.removeGeometry(x);for(const x of this.transformNodes)i&&!i(x)||this.LJ.removeTransformNode(x);for(const x of this.actionManagers)i&&!i(x)||this.LJ.removeActionManager(x);for(const x of this.textures)i&&!i(x)||this.LJ.removeTexture(x);for(const x of this.reflectionProbes)i&&!i(x)||this.LJ.removeReflectionProbe(x)}dispose(){const i=this.cameras.slice(0);for(const L of i)L.dispose();this.cameras.length=0;const x=this.lights.slice(0);for(const L of x)L.dispose();this.lights.length=0;const e=this.meshes.slice(0);for(const L of e)L.dispose();this.meshes.length=0;const j=this.skeletons.slice(0);for(const L of j)L.dispose();this.skeletons.length=0;const E=this.animationGroups.slice(0);for(const L of E)L.dispose();this.animationGroups.length=0;const a=this.multiMaterials.slice(0);for(const L of a)L.dispose();this.multiMaterials.length=0;const Y=this.materials.slice(0);for(const L of Y)L.dispose();this.materials.length=0;const J=this.geometries.slice(0);for(const L of J)L.dispose();this.geometries.length=0;const u=this.transformNodes.slice(0);for(const L of u)L.dispose();this.transformNodes.length=0;const b=this.actionManagers.slice(0);for(const L of b)L.dispose();this.actionManagers.length=0;const g=this.textures.slice(0);for(const L of g)L.dispose();this.textures.length=0;const A=this.reflectionProbes.slice(0);for(const L of A)L.dispose();this.reflectionProbes.length=0;const K=this.morphTargetManagers.slice(0);for(const L of K)L.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const L of this.LJ._serializableComponents)L.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.LJ.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(i,x,e){if(i&&x)for(const j of i){let i=!0;if(e)for(const x of e)if(j===x){i=!1;break}i&&(x.push(j),j._parentContainer=this)}}moveAllFromScene(i){this._wasAddedToScene=!1,void 0===i&&(i=new z);for(const x in this)Object.prototype.hasOwnProperty.call(this,x)&&(this[x]=this[x]||("_environmentTexture"===x?null:[]),this._moveAssets(this.LJ[x],this[x],i[x]));this.environmentTexture=this.LJ.environmentTexture,this.removeAllFromScene()}createRootMesh(){const i=new Y.c("assetContainerRootMesh",this.LJ);for(const x of this.meshes)x.parent||i.addChild(x);return this.meshes.unshift(i),i}mergeAnimationsTo(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.e.LastCreatedScene,x=arguments.length>1?arguments[1]:void 0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!i)return b.c.Error("No scene available to merge animations to"),[];const j=e||(x=>{let e=null;const j=x.animations.length?x.animations[0].targetProperty:"",E=x.name.split(".").join("").split("_primitive")[0];switch(j){case"position":case"rotationQuaternion":e=i.getTransformNodeByName(x.name)||i.getTransformNodeByName(E);break;case"influence":e=i.getMorphTargetByName(x.name)||i.getMorphTargetByName(E);break;default:e=i.getNodeByName(x.name)||i.getNodeByName(E)}return e}),E=this.getNodes();for(const J of E){const i=j(J);if(null!==i){for(const x of J.animations){const e=i.animations.filter((i=>i.targetProperty===x.targetProperty));for(const x of e){const e=i.animations.indexOf(x,0);e>-1&&i.animations.splice(e,1)}}i.animations=i.animations.concat(J.animations)}}const a=[],Y=this.animationGroups.slice();for(const J of Y){a.push(J.clone(J.name,j));for(const i of J.animatables)i.stop()}for(const J of x){const x=j(J.target);x&&(i.beginAnimation(x,J.fromFrame,J.toFrame,J.loopAnimation,J.speedRatio,J.onAnimationEnd?J.onAnimationEnd:void 0,void 0,!0,void 0,J.onAnimationLoop?J.onAnimationLoop:void 0),i.stopAnimation(J.target))}return a}populateRootNodes(){this.rootNodes.length=0;for(const i of this.meshes)i.parent||-1!==this.rootNodes.indexOf(i)||this.rootNodes.push(i);for(const i of this.transformNodes)i.parent||-1!==this.rootNodes.indexOf(i)||this.rootNodes.push(i);for(const i of this.lights)i.parent||-1!==this.rootNodes.indexOf(i)||this.rootNodes.push(i);for(const i of this.cameras)i.parent||-1!==this.rootNodes.indexOf(i)||this.rootNodes.push(i)}addAllAssetsToContainer(i){if(!i)return;const x=[],e=new Set;for(x.push(i);x.length>0;){const i=x.pop();if(i instanceof Y.c?(i.ye&&-1===this.geometries.indexOf(i.ye)&&this.geometries.push(i.ye),this.meshes.push(i)):i instanceof A.b?this.meshes.push(i):i instanceof J.d?this.transformNodes.push(i):i instanceof K.e?this.lights.push(i):i instanceof L.b&&this.cameras.push(i),i instanceof u.e){if(i.material&&-1===this.materials.indexOf(i.material)){this.materials.push(i.material);for(const x of i.material.getActiveTextures())-1===this.textures.indexOf(x)&&this.textures.push(x)}i.skeleton&&-1===this.skeletons.indexOf(i.skeleton)&&this.skeletons.push(i.skeleton),i.morphTargetManager&&-1===this.morphTargetManagers.indexOf(i.morphTargetManager)&&this.morphTargetManagers.push(i.morphTargetManager)}for(const j of i.getChildren())e.has(j)||x.push(j);e.add(i)}this.populateRootNodes()}_getByTags(i,x,e){if(void 0===x)return i;const j=[];for(const E in i){const a=i[E];o.c&&o.c.MatchesQuery(a,x)&&(!e||e(a))&&j.push(a)}return j}getMeshesByTags(i,x){return this._getByTags(this.meshes,i,x)}getCamerasByTags(i,x){return this._getByTags(this.cameras,i,x)}getLightsByTags(i,x){return this._getByTags(this.lights,i,x)}getMaterialsByTags(i,x){return this._getByTags(this.materials,i,x).concat(this._getByTags(this.multiMaterials,i,x))}getTransformNodesByTags(i,x){return this._getByTags(this.transformNodes,i,x)}}var t=e(12128);class V{constructor(i){this.byteOffset=0,this.buffer=i}async loadAsync(i){const x=await this.buffer.readAsync(this.byteOffset,i);this._dataView=new DataView(x.buffer,x.byteOffset,x.byteLength),this._dataByteOffset=0}readUint32(){const i=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,i}readUint8Array(i){const x=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,i);return this._dataByteOffset+=i,this.byteOffset+=i,x}readString(i){return(0,t.g)(this.readUint8Array(i))}skipBytes(i){this._dataByteOffset+=i,this.byteOffset+=i}}var S=e(13808);const f="Z2xURg",w={name:"Ne",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:i=>-1!==i.indexOf("asset")&&-1!==i.indexOf("version")||i.startsWith("data:base64,"+f)||i.startsWith("data:;base64,"+f)||i.startsWith("data:application/octet-stream;base64,"+f)||i.startsWith("data:model/gltf-binary;base64,"+f)};var O,l,Z,B=e(12115),k=e(12120);function N(i,x,e){try{return Promise.resolve(new Uint8Array(i,x,e))}catch(j){return Promise.reject(j)}}!function(i){i[i.AUTO=0]="AUTO",i[i.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(O||(O={})),function(i){i[i.NONE=0]="NONE",i[i.FIRST=1]="FIRST",i[i.ALL=2]="ALL"}(l||(l={})),function(i){i[i.LOADING=0]="LOADING",i[i.READY=1]="READY",i[i.COMPLETE=2]="COMPLETE"}(Z||(Z={}));class mi{constructor(){this.coordinateSystemMode=O.AUTO,this.animationStartMode=l.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=i=>Promise.resolve(i),this.extensionOptions={}}A(i){i&&(this.onParsed=i.onParsed,this.coordinateSystemMode=i.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=i.animationStartMode??this.animationStartMode,this.loadNodeAnimations=i.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=i.loadSkins??this.loadSkins,this.loadMorphTargets=i.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=i.compileMaterials??this.compileMaterials,this.useClipPlane=i.useClipPlane??this.useClipPlane,this.compileShadowGenerators=i.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=i.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=i.useRangeRequests??this.useRangeRequests,this.createInstances=i.createInstances??this.createInstances,this.alwaysComputeBoundingBox=i.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=i.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=i.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=i.skipMaterials??this.skipMaterials,this.useSRGBBuffers=i.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=i.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=i.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=i.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=i.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=i.customRootNode,this.onMeshLoaded=i.onMeshLoaded,this.onSkinLoaded=i.onSkinLoaded,this.onTextureLoaded=i.onTextureLoaded,this.onMaterialLoaded=i.onMaterialLoaded,this.onCameraLoaded=i.onCameraLoaded,this.extensionOptions=i.extensionOptions??this.extensionOptions)}}class X extends mi{constructor(i){super(),this.onParsedObservable=new j.b,this.onMeshLoadedObservable=new j.b,this.onSkinLoadedObservable=new j.b,this.onTextureLoadedObservable=new j.b,this.onMaterialLoadedObservable=new j.b,this.onCameraLoadedObservable=new j.b,this.onCompleteObservable=new j.b,this.onErrorObservable=new j.b,this.te=new j.b,this.onExtensionLoadedObservable=new j.b,this.validate=!1,this.onValidatedObservable=new j.b,this._loader=null,this._state=null,this._requests=new Array,this.name=w.name,this.extensions=w.extensions,this.onLoaderStateChangedObservable=new j.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.A(i)}set onParsed(i){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),i&&(this._onParsedObserver=this.onParsedObservable.add(i))}set onMeshLoaded(i){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),i&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(i))}set onSkinLoaded(i){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),i&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((x=>i(x.node,x.skinnedNode))))}set onTextureLoaded(i){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),i&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(i))}set onMaterialLoaded(i){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),i&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(i))}set onCameraLoaded(i){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),i&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(i))}set onComplete(i){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(i)}set onError(i){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(i)}set onDispose(i){this._onDisposeObserver&&this.te.remove(this._onDisposeObserver),this._onDisposeObserver=this.te.add(i)}set onExtensionLoaded(i){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(i)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(i){this._loggingEnabled!==i&&(this._loggingEnabled=i,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(i){this._capturePerformanceCounters!==i&&(this._capturePerformanceCounters=i,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(i){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(i)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const i of this._requests)i.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=i=>Promise.resolve(i),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.te.notifyObservers(void 0),this.te.clear()}loadFile(i,x,e,a,Y,J,u,g){if(ArrayBuffer.isView(x))return this._loadBinary(i,x,e,a,u,g),null;this._progressCallback=Y;const A=x.name||E.Tools.GetFilename(x);if(J){if(this.useRangeRequests){this.validate&&b.c.Warn("glTF validation is not supported when range requests are enabled");const e={abort:()=>{},onCompleteObservable:new j.b},E={readAsync:(e,j)=>new Promise(((E,a)=>{this._loadFile(i,x,(i=>{E(new Uint8Array(i))}),!0,(i=>{a(i)}),(i=>{i.setRequestHeader("Range",`bytes=${e}-${e+j-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new V(E)).then((i=>{e.onCompleteObservable.notifyObservers(e),a(i)}),u?i=>u(void 0,i):void 0),e}return this._loadFile(i,x,(x=>{this._validate(i,new Uint8Array(x,0,x.byteLength),e,A),this._unpackBinaryAsync(new V({readAsync:(i,e)=>N(x,i,e),byteLength:x.byteLength})).then((i=>{a(i)}),u?i=>u(void 0,i):void 0)}),!0,u)}return this._loadFile(i,x,(x=>{try{this._validate(i,x,e,A),a({json:this._parseJson(x)})}catch{u&&u()}}),!1,u)}_loadBinary(i,x,e,j,E,a){this._validate(i,new Uint8Array(x.buffer,x.byteOffset,x.byteLength),e,a),this._unpackBinaryAsync(new V({readAsync:(i,e)=>function(i,x,e){try{if(x<0||x>=i.byteLength)throw new RangeError("Offset is out of range.");if(x+e>i.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(i.buffer,i.byteOffset+x,e))}catch(j){return Promise.reject(j)}}(x,i,e),byteLength:x.byteLength})).then((i=>{j(i)}),E?i=>E(void 0,i):void 0)}importMeshAsync(i,x,e,j,E,a){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(e),this.onParsedObservable.clear(),this._log(`Loading ${a||""}`),this._loader=this._getLoader(e),this._loader.importMeshAsync(i,x,null,e,j,E,a))))}loadAsync(i,x,e,j,E){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(x),this._loader.loadAsync(i,x,e,j,E))))}loadAssetContainerAsync(i,x,e,j,E){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(x),this.onParsedObservable.clear(),this._log(`Loading ${E||""}`),this._loader=this._getLoader(x);const a=new Q(i),Y=[];this.onMaterialLoadedObservable.add((i=>{Y.push(i)}));const J=[];this.onTextureLoadedObservable.add((i=>{J.push(i)}));const u=[];this.onCameraLoadedObservable.add((i=>{u.push(i)}));const b=[];return this.onMeshLoadedObservable.add((i=>{i.morphTargetManager&&b.push(i.morphTargetManager)})),this._loader.importMeshAsync(null,i,a,x,e,j,E).then((i=>(Array.prototype.push.apply(a.geometries,i.geometries),Array.prototype.push.apply(a.meshes,i.meshes),Array.prototype.push.apply(a.iL,i.iL),Array.prototype.push.apply(a.skeletons,i.skeletons),Array.prototype.push.apply(a.animationGroups,i.animationGroups),Array.prototype.push.apply(a.materials,Y),Array.prototype.push.apply(a.textures,J),Array.prototype.push.apply(a.lights,i.lights),Array.prototype.push.apply(a.transformNodes,i.transformNodes),Array.prototype.push.apply(a.cameras,u),Array.prototype.push.apply(a.morphTargetManagers,b),a)))}))}canDirectLoad(i){return w.canDirectLoad(i)}directLoad(i,x){if(x.startsWith("base64,"+f)||x.startsWith(";base64,"+f)||x.startsWith("application/octet-stream;base64,"+f)||x.startsWith("model/gltf-binary;base64,"+f)){const e=(0,B.d)(x);return this._validate(i,new Uint8Array(e,0,e.byteLength)),this._unpackBinaryAsync(new V({readAsync:(i,x)=>N(e,i,x),byteLength:e.byteLength}))}return this._validate(i,x),Promise.resolve({json:this._parseJson(x)})}createPlugin(i){return new X(i[w.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((i,x)=>{this.onCompleteObservable.addOnce((()=>{i()})),this.onErrorObservable.addOnce((i=>{x(i)}))}))}_setState(i){this._state!==i&&(this._state=i,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(Z[this._state]))}_loadFile(i,x,e,j,E,a){const Y=i._loadFile(x,e,(i=>{this._onProgress(i,Y)}),!0,j,E,a);return Y.onCompleteObservable.add((()=>{Y._lengthComputable=!0,Y._total=Y._loaded})),this._requests.push(Y),Y}_onProgress(i,x){if(!this._progressCallback)return;x._lengthComputable=i.lengthComputable,x._loaded=i.loaded,x._total=i.total;let e=!0,j=0,E=0;for(const a of this._requests){if(void 0===a._lengthComputable||void 0===a._loaded||void 0===a._total)return;e=e&&a._lengthComputable,j+=a._loaded,E+=a._total}this._progressCallback({lengthComputable:e,loaded:j,total:e?E:0})}_validate(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),S.d.ValidateAsync(x,e,j,(x=>this.preprocessUrlAsync(e+x).then((x=>i._loadFileAsync(x,void 0,!0,!0).then((i=>new Uint8Array(i,0,i.byteLength))))))).then((i=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(i),this.onValidatedObservable.clear()}),(i=>{this._endPerformanceCounter("Validate JSON"),E.Tools.Warn(`Failed to validate: ${i.message}`),this.onValidatedObservable.clear()})))}_getLoader(i){const x=i.json.asset||{};this._log(`Asset version: ${x.version}`),x.minVersion&&this._log(`Asset minimum version: ${x.minVersion}`),x.generator&&this._log(`Asset generator: ${x.generator}`);const e=X._parseVersion(x.version);if(!e)throw new Error("Invalid version: "+x.version);if(void 0!==x.minVersion){const i=X._parseVersion(x.minVersion);if(!i)throw new Error("Invalid minimum version: "+x.minVersion);if(X._compareVersion(i,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+x.minVersion)}const j={1:X._CreateGLTF1Loader,2:X._CreateGLTF2Loader}[e.major];if(!j)throw new Error("Unsupported version: "+x.version);return j(this)}_parseJson(i){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${i.length}`);const x=JSON.parse(i);return this._endPerformanceCounter("Parse JSON"),x}_unpackBinaryAsync(i){return this._startPerformanceCounter("Unpack Binary"),i.loadAsync(20).then((()=>{const x=i.readUint32();if(1179937895!==x)throw new k.i("Unexpected magic: "+x,k.g.GLTFLoaderUnexpectedMagicError);const e=i.readUint32();this.loggingEnabled&&this._log(`Binary version: ${e}`);const j=i.readUint32();let E;switch(this.useRangeRequests||j===i.buffer.byteLength||b.c.Warn(`Length in header does not match actual data length: ${j} != ${i.buffer.byteLength}`),e){case 1:E=this._unpackBinaryV1Async(i,j);break;case 2:E=this._unpackBinaryV2Async(i,j);break;default:throw new Error("Unsupported version: "+e)}return this._endPerformanceCounter("Unpack Binary"),E}))}_unpackBinaryV1Async(i,x){const e=i.readUint32(),j=i.readUint32();if(0!==j)throw new Error(`Unexpected content format: ${j}`);const E=x-i.byteOffset,a={json:this._parseJson(i.readString(e)),bin:null};if(0!==E){const x=i.byteOffset;a.bin={readAsync:(e,j)=>i.buffer.readAsync(x+e,j),byteLength:E}}return Promise.resolve(a)}_unpackBinaryV2Async(i,x){const e=1313821514,j=5130562,E=i.readUint32();if(i.readUint32()!==e)throw new Error("First chunk format is not JSON");return i.byteOffset+E===x?i.loadAsync(E).then((()=>({json:this._parseJson(i.readString(E)),bin:null}))):i.loadAsync(E+8).then((()=>{const a={json:this._parseJson(i.readString(E)),bin:null},Y=()=>{const E=i.readUint32();switch(i.readUint32()){case e:throw new Error("Unexpected JSON chunk");case j:{const x=i.byteOffset;a.bin={readAsync:(e,j)=>i.buffer.readAsync(x+e,j),byteLength:E},i.skipBytes(E);break}default:i.skipBytes(E)}return i.byteOffset!==x?i.loadAsync(8).then(Y):Promise.resolve(a)};return Y()}))}static _parseVersion(i){if("1.0"===i||"1.0.1"===i)return{major:1,minor:0};const x=(i+"").match(/^(\d+)\.(\d+)/);return x?{major:parseInt(x[1]),minor:parseInt(x[2])}:null}static _compareVersion(i,x){return i.major>x.major?1:i.major<x.major?-1:i.minor>x.minor?1:i.minor<x.minor?-1:0}_logOpen(i){this._log(i),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(i){const x=X._logSpaces.substring(0,2*this._logIndentLevel);b.c.Log(`${x}${i}`)}_logDisabled(i){}_startPerformanceCounterEnabled(i){E.Tools.StartPerformanceCounter(i)}_startPerformanceCounterDisabled(i){}_endPerformanceCounterEnabled(i){E.Tools.EndPerformanceCounter(i)}_endPerformanceCounterDisabled(i){}}X.IncrementalLoading=!0,X.HomogeneousCoordinates=!1,X._logSpaces="                                ",(0,a.e)(new X)},13808:(i,x,e)=>{"use strict";e.d(x,{d:()=>Y});var j=e(12061);function E(i,x,e,j){const E={externalResourceFunction:j};return e&&(E.uri="file:"===x?e:x+e),ArrayBuffer.isView(i)?GLTFValidator.validateBytes(i,E):GLTFValidator.validateString(i,E)}function a(){const i=[];onmessage=x=>{const e=x.data;switch(e.id){case"init":importScripts(e.url);break;case"validate":E(e.data,e.rootUrl,e.fileName,(x=>new Promise(((e,j)=>{const E=i.length;i.push({resolve:e,reject:j}),postMessage({id:"getExternalResource",index:E,uri:x})})))).then((i=>{postMessage({id:"validate.resolve",value:i})}),(i=>{postMessage({id:"validate.reject",reason:i})}));break;case"getExternalResource.resolve":i[e.index].resolve(e.value);break;case"getExternalResource.reject":i[e.index].reject(e.reason)}}}class Y{static ValidateAsync(i,x,e,Y){return"function"===typeof Worker?new Promise(((J,u)=>{const b=`${E}(${a})()`,g=URL.createObjectURL(new Blob([b],{type:"application/javascript"})),A=new Worker(g),K=i=>{A.removeEventListener("error",K),A.removeEventListener("message",L),u(i)},L=i=>{const x=i.data;switch(x.id){case"getExternalResource":Y(x.uri).then((i=>{A.postMessage({id:"getExternalResource.resolve",index:x.index,value:i},[i.buffer])}),(i=>{A.postMessage({id:"getExternalResource.reject",index:x.index,reason:i})}));break;case"validate.resolve":A.removeEventListener("error",K),A.removeEventListener("message",L),J(x.value),A.terminate();break;case"validate.reject":A.removeEventListener("error",K),A.removeEventListener("message",L),u(x.reason),A.terminate()}};if(A.addEventListener("error",K),A.addEventListener("message",L),A.postMessage({id:"init",url:j.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(i)){const j=i.slice();A.postMessage({id:"validate",data:j,rootUrl:x,fileName:e},[j.buffer])}else A.postMessage({id:"validate",data:i,rootUrl:x,fileName:e})})):(this._LoadScriptPromise||(this._LoadScriptPromise=j.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>E(i,x,e,Y))))}}Y.Configuration={url:`${j.Tools._DefaultCdnUrl}/gltf_validator.js`}},14374:(i,x,e)=>{"use strict";e.d(x,{d:()=>w});var j=e(12234),E=e(12236),a=e(12278),Y=e(12250),J=e(12591),u=e(12537),b=e(12314),g=e(12452),A=e(12204),K=e(12162);e(13587),e(13522),e(13533),e(13525),e(13536),e(13538),e(13541);const L="imageProcessingCompatibility",o="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";K.c.IncludesShadersStore[L]||(K.c.IncludesShadersStore[L]=o);const M="skyPixelShader",z="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";K.c.ShadersStore[M]||(K.c.ShadersStore[M]=z);e(13597),e(13546),e(13548),e(13555),e(13550);const T="skyVertexShader",Q="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";K.c.ShadersStore[T]||(K.c.ShadersStore[T]=Q);var t=e(12530),V=e(12580),S=e(12571);class f extends J.e{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class w extends u.d{constructor(i,x){super(i,x),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new Y.KJ(0,100,0),this.useSunPosition=!1,this.cameraOffset=Y.KJ.Zero(),this.up=Y.KJ.Up(),this.dithering=!1,this._cameraPosition=Y.KJ.Zero(),this._skyOrientation=new Y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(i,x){const e=x._drawWrapper;if(this.isFrozen&&e.effect&&e._wasPreviouslyReady)return!0;x.materialDefines||(x.materialDefines=new f);const j=x.materialDefines,E=this.wi();if(this._isReadyForSubMesh(x))return!0;if((0,S.M)(i,E,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,j),(0,S.E)(i,j,!0,!1),j.IMAGEPROCESSINGPOSTPROCESS!==E.imageProcessingConfiguration.applyByPostProcess&&j.markAsMiscDirty(),j.DITHER!==this.dithering&&j.markAsMiscDirty(),j.isDirty){j.markAsProcessed(),E.resetCachedMaterial();const i=new t.b;j.FOG&&i.addFallback(1,"FOG"),j.IMAGEPROCESSINGPOSTPROCESS=E.imageProcessingConfiguration.applyByPostProcess,j.DITHER=this.dithering;const e=[b.f.PositionKind];j.VERTEXCOLOR&&e.push(b.f.ColorKind);const a="sky",Y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,V.b)(Y);const J=j.toString();x.setEffect(E.getEngine().createEffect(a,e,Y,[],J,i,this.onCompiled,this.onError),j,this._materialContext)}return!(!x.effect||!x.effect.isReady())&&(j._renderId=E.getRenderId(),e._wasPreviouslyReady=!0,!0)}bindForSubMesh(i,x,e){const j=this.wi(),E=e.materialDefines;if(!E)return;const a=e.effect;if(!a)return;this._activeEffect=a,this.bindOnlyWorldMatrix(i),this._activeEffect.setMatrix("viewProjection",j.getTransformMatrix()),this._mustRebind(j,a,e)&&((0,V.d)(a,this,j),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,S.j)(E,a,j)),j.fogEnabled&&x.applyFog&&j.fogMode!==g.d.FOGMODE_NONE&&this._activeEffect.setMatrix("view",j.getViewMatrix()),(0,S.d)(j,x,this._activeEffect);const J=j.activeCamera;if(J){const i=J.getWorldMatrix();this._cameraPosition.x=i.m[12],this._cameraPosition.y=i.m[13],this._cameraPosition.z=i.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const i=Math.PI*(this.inclination-.5),x=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(x)*Math.cos(i),this.sunPosition.y=this.distance*Math.sin(-i),this.sunPosition.z=this.distance*Math.sin(x)*Math.cos(i),Y.Quaternion.FromUnitVectorsToRef(Y.KJ.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(x,this._activeEffect,e)}getAnimatables(){return[]}dispose(i){super.dispose(i)}clone(i){return a.b.Clone((()=>new w(i,this.wi())),this)}serialize(){const i=super.serialize();return i.customType="BABYLON.SkyMaterial",i}getClassName(){return"SkyMaterial"}static Parse(i,x,e){return a.b.Parse((()=>new w(i.name,x)),i,x,e)}}(0,j.e)([(0,E.O)()],w.prototype,"luminance",void 0),(0,j.e)([(0,E.O)()],w.prototype,"turbidity",void 0),(0,j.e)([(0,E.O)()],w.prototype,"rayleigh",void 0),(0,j.e)([(0,E.O)()],w.prototype,"mieCoefficient",void 0),(0,j.e)([(0,E.O)()],w.prototype,"mieDirectionalG",void 0),(0,j.e)([(0,E.O)()],w.prototype,"distance",void 0),(0,j.e)([(0,E.O)()],w.prototype,"inclination",void 0),(0,j.e)([(0,E.O)()],w.prototype,"azimuth",void 0),(0,j.e)([(0,E.L)()],w.prototype,"sunPosition",void 0),(0,j.e)([(0,E.O)()],w.prototype,"useSunPosition",void 0),(0,j.e)([(0,E.L)()],w.prototype,"cameraOffset",void 0),(0,j.e)([(0,E.L)()],w.prototype,"up",void 0),(0,j.e)([(0,E.O)()],w.prototype,"dithering",void 0),(0,A.f)("BABYLON.SkyMaterial",w)},12915:(i,x,e)=>{"use strict";function j(i,x){x.headers=i.headers||{},x.statusMessage=i.statusText,x.statusCode=i.status,x.data=i.response}function E(i,x,e){return new Promise((function(E,a){e=e||{};var Y,J,u,b=new XMLHttpRequest,g=e.body,A=e.headers||{};for(Y in e.timeout&&(b.timeout=e.timeout),b.ontimeout=b.onerror=function(i){i.timeout="timeout"==i.type,a(i)},b.open(i,x.href||x),b.onload=function(){for(u=b.getAllResponseHeaders().trim().split(/[\r\n]+/),j(b,b);J=u.shift();)J=J.split(": "),b.headers[J.shift().toLowerCase()]=J.join(": ");if((J=b.headers["content-type"])&&~J.indexOf("application/json"))try{b.data=JSON.parse(b.data,e.reviver)}catch(i){return j(b,i),a(i)}(b.status>=400?a:E)(b)},typeof FormData<"u"&&g instanceof FormData||g&&"object"==typeof g&&(A["content-type"]="application/json",g=JSON.stringify(g)),b.withCredentials=!!e.withCredentials,A)b.setRequestHeader(Y,A[Y]);b.send(g)}))}e.r(x),e.d(x,{del:()=>u,get:()=>a,patch:()=>J,post:()=>Y,put:()=>b,send:()=>E});var a=E.bind(E,"GET"),Y=E.bind(E,"POST"),J=E.bind(E,"PATCH"),u=E.bind(E,"DELETE"),b=E.bind(E,"PUT")},14483:(i,x,e)=>{"use strict";e.d(x,{c:()=>A});const j=.5*(Math.sqrt(3)-1),E=(3-Math.sqrt(3))/6,a=1/3,Y=1/6,J=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20,b=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),g=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const A=class{constructor(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const x="function"==typeof i?i:function(i){let x=0,e=0,j=0,E=1;const a=function(){let i=4022871197;return function(x){x=x.toString();for(let e=0;e<x.length;e++){i+=x.charCodeAt(e);let j=.02519603282416938*i;i=j>>>0,j-=i,j*=i,i=j>>>0,j-=i,i+=4294967296*j}return 2.3283064365386963e-10*(i>>>0)}}();x=a(" "),e=a(" "),j=a(" "),x-=a(i),x<0&&(x+=1);e-=a(i),e<0&&(e+=1);j-=a(i),j<0&&(j+=1);return function(){const i=2091639*x+2.3283064365386963e-10*E;return x=e,e=j,j=i-(E=0|i)}}(i);this.p=function(i){const x=new Uint8Array(256);for(let e=0;e<256;e++)x[e]=e;for(let e=0;e<255;e++){const j=e+~~(i()*(256-e)),E=x[e];x[e]=x[j],x[j]=E}return x}(x),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}noise2D(i,x){const e=this.permMod12,a=this.perm;let Y=0,J=0,u=0;const g=(i+x)*j,A=Math.floor(i+g),K=Math.floor(x+g),L=(A+K)*E,o=i-(A-L),M=x-(K-L);let z,T;o>M?(z=1,T=0):(z=0,T=1);const Q=o-z+E,t=M-T+E,V=o-1+2*E,S=M-1+2*E,f=255&A,w=255&K;let O=.5-o*o-M*M;if(O>=0){const i=3*e[f+a[w]];O*=O,Y=O*O*(b[i]*o+b[i+1]*M)}let l=.5-Q*Q-t*t;if(l>=0){const i=3*e[f+z+a[w+T]];l*=l,J=l*l*(b[i]*Q+b[i+1]*t)}let Z=.5-V*V-S*S;if(Z>=0){const i=3*e[f+1+a[w+1]];Z*=Z,u=Z*Z*(b[i]*V+b[i+1]*S)}return 70*(Y+J+u)}noise3D(i,x,e){const j=this.permMod12,E=this.perm;let J,u,g,A;const K=(i+x+e)*a,L=Math.floor(i+K),o=Math.floor(x+K),M=Math.floor(e+K),z=(L+o+M)*Y,T=i-(L-z),Q=x-(o-z),t=e-(M-z);let V,S,f,w,O,l;T>=Q?Q>=t?(V=1,S=0,f=0,w=1,O=1,l=0):T>=t?(V=1,S=0,f=0,w=1,O=0,l=1):(V=0,S=0,f=1,w=1,O=0,l=1):Q<t?(V=0,S=0,f=1,w=0,O=1,l=1):T<t?(V=0,S=1,f=0,w=0,O=1,l=1):(V=0,S=1,f=0,w=1,O=1,l=0);const Z=T-V+Y,B=Q-S+Y,k=t-f+Y,N=T-w+2*Y,mi=Q-O+2*Y,X=t-l+2*Y,C=T-1+.5,n=Q-1+.5,I=t-1+.5,d=255&L,p=255&o,H=255&M;let U=.6-T*T-Q*Q-t*t;if(U<0)J=0;else{const i=3*j[d+E[p+E[H]]];U*=U,J=U*U*(b[i]*T+b[i+1]*Q+b[i+2]*t)}let D=.6-Z*Z-B*B-k*k;if(D<0)u=0;else{const i=3*j[d+V+E[p+S+E[H+f]]];D*=D,u=D*D*(b[i]*Z+b[i+1]*B+b[i+2]*k)}let h=.6-N*N-mi*mi-X*X;if(h<0)g=0;else{const i=3*j[d+w+E[p+O+E[H+l]]];h*=h,g=h*h*(b[i]*N+b[i+1]*mi+b[i+2]*X)}let F=.6-C*C-n*n-I*I;if(F<0)A=0;else{const i=3*j[d+1+E[p+1+E[H+1]]];F*=F,A=F*F*(b[i]*C+b[i+1]*n+b[i+2]*I)}return 32*(J+u+g+A)}noise4D(i,x,e,j){const E=this.perm;let a,Y,b,A,K;const L=(i+x+e+j)*J,o=Math.floor(i+L),M=Math.floor(x+L),z=Math.floor(e+L),T=Math.floor(j+L),Q=(o+M+z+T)*u,t=i-(o-Q),V=x-(M-Q),S=e-(z-Q),f=j-(T-Q);let w=0,O=0,l=0,Z=0;t>V?w++:O++,t>S?w++:l++,t>f?w++:Z++,V>S?O++:l++,V>f?O++:Z++,S>f?l++:Z++;const B=w>=3?1:0,k=O>=3?1:0,N=l>=3?1:0,mi=Z>=3?1:0,X=w>=2?1:0,C=O>=2?1:0,n=l>=2?1:0,I=Z>=2?1:0,d=w>=1?1:0,p=O>=1?1:0,H=l>=1?1:0,U=Z>=1?1:0,D=t-B+u,h=V-k+u,F=S-N+u,R=f-mi+u,y=t-X+2*u,r=V-C+2*u,c=S-n+2*u,P=f-I+2*u,q=t-d+3*u,W=V-p+3*u,G=S-H+3*u,v=f-U+3*u,s=t-1+4*u,ii=V-1+4*u,xi=S-1+4*u,ei=f-1+4*u,ji=255&o,Ei=255&M,ai=255&z,Yi=255&T;let Ji=.6-t*t-V*V-S*S-f*f;if(Ji<0)a=0;else{const i=E[ji+E[Ei+E[ai+E[Yi]]]]%32*4;Ji*=Ji,a=Ji*Ji*(g[i]*t+g[i+1]*V+g[i+2]*S+g[i+3]*f)}let ui=.6-D*D-h*h-F*F-R*R;if(ui<0)Y=0;else{const i=E[ji+B+E[Ei+k+E[ai+N+E[Yi+mi]]]]%32*4;ui*=ui,Y=ui*ui*(g[i]*D+g[i+1]*h+g[i+2]*F+g[i+3]*R)}let bi=.6-y*y-r*r-c*c-P*P;if(bi<0)b=0;else{const i=E[ji+X+E[Ei+C+E[ai+n+E[Yi+I]]]]%32*4;bi*=bi,b=bi*bi*(g[i]*y+g[i+1]*r+g[i+2]*c+g[i+3]*P)}let gi=.6-q*q-W*W-G*G-v*v;if(gi<0)A=0;else{const i=E[ji+d+E[Ei+p+E[ai+H+E[Yi+U]]]]%32*4;gi*=gi,A=gi*gi*(g[i]*q+g[i+1]*W+g[i+2]*G+g[i+3]*v)}let Ai=.6-s*s-ii*ii-xi*xi-ei*ei;if(Ai<0)K=0;else{const i=E[ji+1+E[Ei+1+E[ai+1+E[Yi+1]]]]%32*4;Ai*=Ai,K=Ai*Ai*(g[i]*s+g[i+1]*ii+g[i+2]*xi+g[i+3]*ei)}return 27*(a+Y+b+A+K)}}}}]);