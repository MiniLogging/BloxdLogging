/*! For license information please see zihy6i.32.0754afdb.chunk.js.LICENSE.txt */
(self["2fwzcez286e"]=self["2fwzcez286e"]||[]).push([[32],{14964:(B,u,F)=>{"use strict";var Z=F(14970),V=F(14974),p=F(14981);F.g.__TYPEDARRAY_POOL||(F.g.__TYPEDARRAY_POOL={UINT8:V([32,0]),UINT16:V([32,0]),UINT32:V([32,0]),INT8:V([32,0]),INT16:V([32,0]),INT32:V([32,0]),FLOAT:V([32,0]),DOUBLE:V([32,0]),DATA:V([32,0]),UINT8C:V([32,0]),BUFFER:V([32,0])});var G="undefined"!==typeof Uint8ClampedArray,R=F.g.__TYPEDARRAY_POOL;R.UINT8C||(R.UINT8C=V([32,0])),R.BUFFER||(R.BUFFER=V([32,0]));var e=R.DATA,s=R.BUFFER;function Y(B){if(B){var u=B.length||B.byteLength,F=Z.log2(u);e[F].push(B)}}function Q(B){B=Z.nextPow2(B);var u=Z.log2(B),F=e[u];return F.length>0?F.pop():new ArrayBuffer(B)}function t(B){return new Uint8Array(Q(B),0,B)}function v(B){return new Uint16Array(Q(2*B),0,B)}function D(B){return new Uint32Array(Q(4*B),0,B)}function L(B){return new Int8Array(Q(B),0,B)}function q(B){return new Int16Array(Q(2*B),0,B)}function W(B){return new Int32Array(Q(4*B),0,B)}function X(B){return new Float32Array(Q(4*B),0,B)}function f(B){return new Float64Array(Q(8*B),0,B)}function C(B){return G?new Uint8ClampedArray(Q(B),0,B):t(B)}function x(B){return new DataView(Q(B),0,B)}u.free=function(B){if(p(B))s[Z.log2(B.length)].push(B);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(B)&&(B=B.buffer),!B)return;var u=B.length||B.byteLength,F=0|Z.log2(u);e[F].push(B)}},u.freeUint8=u.freeUint16=u.freeUint32=u.freeInt8=u.freeInt16=u.freeInt32=u.freeFloat32=u.freeFloat=u.freeFloat64=u.freeDouble=u.freeUint8Clamped=u.freeDataView=function(B){Y(B.buffer)},u.freeArrayBuffer=Y,u.freeBuffer=function(B){s[Z.log2(B.length)].push(B)},u.malloc=function(B,u){if(void 0===u||"arraybuffer"===u)return Q(B);switch(u){case"uint8":return t(B);case"uint16":return v(B);case"uint32":return D(B);case"int8":return L(B);case"int16":return q(B);case"int32":return W(B);case"float":case"float32":return X(B);case"double":case"float64":return f(B);case"uint8_clamped":return C(B);case"buffer":throw"Buffer not supported";case"data":case"dataview":return x(B);default:return null}return null},u.mallocArrayBuffer=Q,u.mallocUint8=t,u.mallocUint16=v,u.mallocUint32=D,u.mallocInt8=L,u.mallocInt16=q,u.mallocInt32=W,u.mallocFloat32=u.mallocFloat=X,u.mallocFloat64=u.mallocDouble=f,u.mallocUint8Clamped=C,u.mallocDataView=x,u.clearCache=function(){for(var B=0;B<32;++B)R.UINT8[B].length=0,R.UINT16[B].length=0,R.UINT32[B].length=0,R.INT8[B].length=0,R.INT16[B].length=0,R.INT32[B].length=0,R.FLOAT[B].length=0,R.DOUBLE[B].length=0,R.UINT8C[B].length=0,e[B].length=0,s[B].length=0}},15050:(B,u,F)=>{B.exports=V;var Z=F(13771);function V(B,u){if(!(this instanceof V))return new V(B,u);var F=Z.create();Z.add(F,B,u),this.base=Z.min(Z.create(),B,F),this.xY=Z.clone(u),this.max=Z.max(Z.create(),B,F),this.mag=Z.length(this.xY)}var p=V.prototype;p.width=function(){return this.xY[0]},p.height=function(){return this.xY[1]},p.depth=function(){return this.xY[2]},p.x0=function(){return this.base[0]},p.y0=function(){return this.base[1]},p.z0=function(){return this.base[2]},p.x1=function(){return this.max[0]},p.y1=function(){return this.max[1]},p.z1=function(){return this.max[2]},p.translate=function(B){return Z.add(this.max,this.max,B),Z.add(this.base,this.base,B),this},p.setPosition=function(B){return Z.add(this.max,B,this.xY),Z.k(this.base,B),this},p.expand=function(B){var u=Z.create(),F=Z.create();return Z.max(u,B.max,this.max),Z.min(F,B.base,this.base),Z.Lu(u,u,F),new V(F,u)},p.intersects=function(B){return!(B.base[0]>this.max[0])&&(!(B.base[1]>this.max[1])&&(!(B.base[2]>this.max[2])&&(!(B.max[0]<this.base[0])&&(!(B.max[1]<this.base[1])&&!(B.max[2]<this.base[2])))))},p.touches=function(B){var u=this.union(B);return null!==u&&(0==u.width()||0==u.height()||0==u.depth())},p.union=function(B){if(!this.intersects(B))return null;var u=Math.max(B.base[0],this.base[0]),F=Math.max(B.base[1],this.base[1]),Z=Math.max(B.base[2],this.base[2]);return new V([u,F,Z],[Math.min(B.max[0],this.max[0])-u,Math.min(B.max[1],this.max[1])-F,Math.min(B.max[2],this.max[2])-Z])}},14970:(B,u)=>{"use strict";function F(B){var u=32;return(B&=-B)&&u--,65535&B&&(u-=16),16711935&B&&(u-=8),252645135&B&&(u-=4),858993459&B&&(u-=2),1431655765&B&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(B){return(B>0)-(B<0)},u.abs=function(B){var u=B>>31;return(B^u)-u},u.min=function(B,u){return u^(B^u)&-(B<u)},u.max=function(B,u){return B^(B^u)&-(B<u)},u.isPow2=function(B){return!(B&B-1)&&!!B},u.log2=function(B){var u,F;return u=(B>65535)<<4,u|=F=((B>>>=u)>255)<<3,u|=F=((B>>>=F)>15)<<2,(u|=F=((B>>>=F)>3)<<1)|(B>>>=F)>>1},u.log10=function(B){return B>=1e9?9:B>=1e8?8:B>=1e7?7:B>=1e6?6:B>=1e5?5:B>=1e4?4:B>=1e3?3:B>=100?2:B>=10?1:0},u.popCount=function(B){return 16843009*((B=(858993459&(B-=B>>>1&1431655765))+(B>>>2&858993459))+(B>>>4)&252645135)>>>24},u.countTrailingZeros=F,u.nextPow2=function(B){return B+=0===B,--B,B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)+1},u.prevPow2=function(B){return B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)-(B>>>1)},u.parity=function(B){return B^=B>>>16,B^=B>>>8,B^=B>>>4,27030>>>(B&=15)&1};var Z=new Array(256);!function(B){for(var u=0;u<256;++u){var F=u,Z=u,V=7;for(F>>>=1;F;F>>>=1)Z<<=1,Z|=1&F,--V;B[u]=Z<<V&255}}(Z),u.reverse=function(B){return Z[255&B]<<24|Z[B>>>8&255]<<16|Z[B>>>16&255]<<8|Z[B>>>24&255]},u.interleave2=function(B,u){return(B=1431655765&((B=858993459&((B=252645135&((B=16711935&((B&=65535)|B<<8))|B<<4))|B<<2))|B<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(B,u){return(B=65535&((B=16711935&((B=252645135&((B=858993459&((B=B>>>u&1431655765)|B>>>1))|B>>>2))|B>>>4))|B>>>16))<<16>>16},u.interleave3=function(B,u,F){return B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2),(B|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2))<<2},u.deinterleave3=function(B,u){return(B=1023&((B=4278190335&((B=251719695&((B=3272356035&((B=B>>>u&1227133513)|B>>>2))|B>>>4))|B>>>8))|B>>>16))<<22>>22},u.nextCombination=function(B){var u=B|B-1;return u+1|(~u&-~u)-1>>>F(B)+1}},14958:(B,u,F)=>{"use strict";B.exports=function(B,u,F){switch(arguments.length){case 1:return Z=[],s(V=B,V,Y,!0),Z;case 2:return"function"===typeof u?s(B,B,u,!0):function(B,u){return Z=[],s(B,u,Y,!1),Z}(B,u);case 3:return s(B,u,F,!1);default:throw new Error("box-intersect: Invalid arguments")}var V};var Z,V=F(14964),p=F(14986),G=F(14994);function R(B,u){for(var F=0;F<B;++F)if(!(u[F]<=u[F+B]))return!0;return!1}function e(B,u,F,Z){for(var V=0,p=0,G=0,e=B.length;G<e;++G){var s=B[G];if(!R(u,s)){for(var Y=0;Y<2*u;++Y)F[V++]=s[Y];Z[p++]=G}}return p}function s(B,u,F,Z){var R=B.length,s=u.length;if(!(R<=0||s<=0)){var Y=B[0].length>>>1;if(!(Y<=0)){var Q,t=V.mallocDouble(2*Y*R),v=V.mallocInt32(R);if((R=e(B,Y,t,v))>0){if(1===Y&&Z)p.init(R),Q=p.sweepComplete(Y,F,0,R,t,v,0,R,t,v);else{var D=V.mallocDouble(2*Y*s),L=V.mallocInt32(s);(s=e(u,Y,D,L))>0&&(p.init(R+s),Q=1===Y?p.sweepBipartite(Y,F,0,R,t,v,0,s,D,L):G(Y,F,Z,R,t,v,s,D,L),V.free(D),V.free(L))}V.free(t),V.free(v)}return Q}}}function Y(B,u){Z.push([B,u])}},15e3:(B,u)=>{"use strict";var F="d",Z="ax",V="fp",p="es",G="rs",R="re",e="rb",s="bs",Y="be",Q="bb",t=[F,Z,"vv",G,R,e,"ri",s,Y,Q,"bi"];function v(B){var u="bruteForce"+(B?"Full":"Partial"),Z=[],G=t.slice();B||G.splice(3,0,V);var R=["function "+u+"("+G.join()+"){"];function e(u,V){var G=function(B,u,Z){var V="bruteForce"+(B?"Red":"Blue")+(u?"Flip":"")+(Z?"Full":""),G=["function ",V,"(",t.join(),"){","var ",p,"=2*",F,";"],R="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",e="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(Z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return B?G.push(R,"Q",":",e):G.push(e,"Q",":",R),Z?G.push("if(y1<x0||x1<y0)continue;"):u?G.push("if(y0<=x0||x1<y0)continue;"):G.push("if(y0<x0||x1<y0)continue;"),G.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),u?G.push("yi,xi"):G.push("xi,yi"),G.push(");if(rv!==void 0)return rv;}}}"),{name:V,code:G.join("")}}(u,V,B);Z.push(G.code),R.push("return "+G.name+"("+t.join()+");")}R.push("if(re-rs>be-bs){"),B?(e(!0,!1),R.push("}else{"),e(!1,!1)):(R.push("if(fp){"),e(!0,!0),R.push("}else{"),e(!0,!1),R.push("}}else{if(fp){"),e(!1,!0),R.push("}else{"),e(!1,!1),R.push("}")),R.push("}}return "+u);var s=Z.join("")+R.join("");return new Function(s)()}u.partial=v(!1),u.full=v(!0)},14994:(B,u,F)=>{"use strict";B.exports=function(B,u,F,p,Y,a,T,z,M){!function(B,u){var F=8*V.log2(u+1)*(B+1)|0,p=V.nextPow2(C*F);U.length<p&&(Z.free(U),U=Z.mallocInt32(p));var G=V.nextPow2(x*F);y.length<G&&(Z.free(y),y=Z.mallocDouble(G))}(B,p+T);var j,o=0,I=2*B;O(o++,0,0,p,0,T,F?16:0,-1/0,1/0),F||O(o++,0,0,T,0,p,1,-1/0,1/0);for(;o>0;){var mB=(o-=1)*C,E=U[mB],w=U[mB+1],H=U[mB+2],n=U[mB+3],d=U[mB+4],l=U[mB+5],P=o*x,c=y[P],h=y[P+1],i=1&l,r=!!(16&l),K=Y,N=a,A=z,b=M;if(i&&(K=z,N=M,A=Y,b=a),!(2&l&&w>=(H=q(B,E,w,H,K,N,h)))&&!(4&l&&(w=W(B,E,w,H,K,N,c))>=H)){var k=H-w,S=d-n;if(r){if(B*k*(k+S)<v){if(void 0!==(j=e.scanComplete(B,E,u,w,H,K,N,n,d,A,b)))return j;continue}}else{if(B*Math.min(k,S)<Q){if(void 0!==(j=G(B,E,u,i,w,H,K,N,n,d,A,b)))return j;continue}if(B*k*S<t){if(void 0!==(j=e.scanBipartite(B,E,u,i,w,H,K,N,n,d,A,b)))return j;continue}}var BB=D(B,E,w,H,K,N,c,h);if(w<BB)if(B*(BB-w)<Q){if(void 0!==(j=R(B,E+1,u,w,BB,K,N,n,d,A,b)))return j}else if(E===B-2){if(void 0!==(j=i?e.sweepBipartite(B,u,n,d,A,b,w,BB,K,N):e.sweepBipartite(B,u,w,BB,K,N,n,d,A,b)))return j}else O(o++,E+1,w,BB,n,d,i,-1/0,1/0),O(o++,E+1,n,d,w,BB,1^i,-1/0,1/0);if(BB<H){var uB=s(B,E,n,d,A,b),FB=A[I*uB+E],ZB=L(B,E,uB,d,A,b,FB);if(ZB<d&&O(o++,E,BB,H,ZB,d,(4|i)+(r?16:0),FB,h),n<uB&&O(o++,E,BB,H,n,uB,(2|i)+(r?16:0),c,FB),uB+1===ZB){if(void 0!==(j=r?J(B,E,u,BB,H,K,N,uB,A,b[uB]):g(B,E,u,i,BB,H,K,N,uB,A,b[uB])))return j}else if(uB<ZB){var VB;if(r){if(BB<(VB=X(B,E,BB,H,K,N,FB))){var pB=L(B,E,BB,VB,K,N,FB);if(E===B-2){if(BB<pB&&void 0!==(j=e.sweepComplete(B,u,BB,pB,K,N,uB,ZB,A,b)))return j;if(pB<VB&&void 0!==(j=e.sweepBipartite(B,u,pB,VB,K,N,uB,ZB,A,b)))return j}else BB<pB&&O(o++,E+1,BB,pB,uB,ZB,16,-1/0,1/0),pB<VB&&(O(o++,E+1,pB,VB,uB,ZB,0,-1/0,1/0),O(o++,E+1,uB,ZB,pB,VB,1,-1/0,1/0))}}else BB<(VB=i?f(B,E,BB,H,K,N,FB):X(B,E,BB,H,K,N,FB))&&(E===B-2?j=i?e.sweepBipartite(B,u,uB,ZB,A,b,BB,VB,K,N):e.sweepBipartite(B,u,BB,VB,K,N,uB,ZB,A,b):(O(o++,E+1,BB,VB,uB,ZB,i,-1/0,1/0),O(o++,E+1,uB,ZB,BB,VB,1^i,-1/0,1/0)))}}}}};var Z=F(14964),V=F(14970),p=F(15e3),G=p.partial,R=p.full,e=F(14986),s=F(15007),Y=F(15009),Q=128,t=1<<22,v=1<<22,D=Y("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),L=Y("lo===p0",["p0"]),q=Y("lo<p0",["p0"]),W=Y("hi<=p0",["p0"]),X=Y("lo<=p0&&p0<=hi",["p0"]),f=Y("lo<p0&&p0<=hi",["p0"]),C=6,x=2,U=Z.mallocInt32(1024),y=Z.mallocDouble(1024);function O(B,u,F,Z,V,p,G,R,e){var s=C*B;U[s]=u,U[s+1]=F,U[s+2]=Z,U[s+3]=V,U[s+4]=p,U[s+5]=G;var Y=x*B;y[Y]=R,y[Y+1]=e}function g(B,u,F,Z,V,p,G,R,e,s,Y){var Q=2*B,t=e*Q,v=s[t+u];B:for(var D=V,L=V*Q;D<p;++D,L+=Q){var q=G[L+u],W=G[L+u+B];if(!(v<q||W<v)&&(!Z||v!==q)){for(var X,f=R[D],C=u+1;C<B;++C){q=G[L+C],W=G[L+C+B];var x=s[t+C],U=s[t+C+B];if(W<x||U<q)continue B}if(void 0!==(X=Z?F(Y,f):F(f,Y)))return X}}}function J(B,u,F,Z,V,p,G,R,e,s){var Y=2*B,Q=R*Y,t=e[Q+u];B:for(var v=Z,D=Z*Y;v<V;++v,D+=Y){var L=G[v];if(L!==s){var q=p[D+u],W=p[D+u+B];if(!(t<q||W<t)){for(var X=u+1;X<B;++X){q=p[D+X],W=p[D+X+B];var f=e[Q+X],C=e[Q+X+B];if(W<f||C<q)continue B}var x=F(L,s);if(void 0!==x)return x}}}}},15007:(B,u,F)=>{"use strict";B.exports=function(B,u,F,G,R,e){if(G<=F+1)return F;var s=F,Y=G,Q=G+F>>>1,t=2*B,v=Q,D=R[t*Q+u];for(;s<Y;){if(Y-s<V){p(B,u,s,Y,R,e),D=R[t*Q+u];break}var L=Y-s,q=Math.random()*L+s|0,W=R[t*q+u],X=Math.random()*L+s|0,f=R[t*X+u],C=Math.random()*L+s|0,x=R[t*C+u];W<=f?x>=f?(v=X,D=f):W>=x?(v=q,D=W):(v=C,D=x):f>=x?(v=X,D=f):x>=W?(v=q,D=W):(v=C,D=x);for(var U=t*(Y-1),y=t*v,O=0;O<t;++O,++U,++y){var g=R[U];R[U]=R[y],R[y]=g}var J=e[Y-1];e[Y-1]=e[v],e[v]=J;for(U=t*(Y-1),y=t*(v=Z(B,u,s,Y-1,R,e,D)),O=0;O<t;++O,++U,++y){g=R[U];R[U]=R[y],R[y]=g}J=e[Y-1];if(e[Y-1]=e[v],e[v]=J,Q<v){for(Y=v-1;s<Y&&R[t*(Y-1)+u]===D;)Y-=1;Y+=1}else{if(!(v<Q))break;for(s=v+1;s<Y&&R[t*s+u]===D;)s+=1}}return Z(B,u,F,Q,R,e,R[t*Q+u])};var Z=F(15009)("lo<p0",["p0"]),V=8;function p(B,u,F,Z,V,p){for(var G=2*B,R=G*(F+1)+u,e=F+1;e<Z;++e,R+=G)for(var s=V[R],Y=e,Q=G*(e-1);Y>F&&V[Q+u]>s;--Y,Q-=G){for(var t=Q,v=Q+G,D=0;D<G;++D,++t,++v){var L=V[t];V[t]=V[v],V[v]=L}var q=p[Y];p[Y]=p[Y-1],p[Y-1]=q}}},15009:B=>{"use strict";B.exports=function(B,F){var Z="abcdef".split("").concat(F),V=[];B.indexOf("lo")>=0&&V.push("lo=e[k+n]");B.indexOf("hi")>=0&&V.push("hi=e[k+o]");return Z.push(u.replace("_",V.join()).replace("$",B)),Function.apply(void 0,Z)};var u="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},14991:B=>{"use strict";B.exports=function(B,Z){Z<=4*u?F(0,Z-1,B):s(0,Z-1,B)};var u=32;function F(B,u,F){for(var Z=2*(B+1),V=B+1;V<=u;++V){for(var p=F[Z++],G=F[Z++],R=V,e=Z-2;R-- >B;){var s=F[e-2],Y=F[e-1];if(s<p)break;if(s===p&&Y<G)break;F[e]=s,F[e+1]=Y,e-=2}F[e]=p,F[e+1]=G}}function Z(B,u,F){u*=2;var Z=F[B*=2],V=F[B+1];F[B]=F[u],F[B+1]=F[u+1],F[u]=Z,F[u+1]=V}function V(B,u,F){u*=2,F[B*=2]=F[u],F[B+1]=F[u+1]}function p(B,u,F,Z){u*=2,F*=2;var V=Z[B*=2],p=Z[B+1];Z[B]=Z[u],Z[B+1]=Z[u+1],Z[u]=Z[F],Z[u+1]=Z[F+1],Z[F]=V,Z[F+1]=p}function G(B,u,F,Z,V){u*=2,V[B*=2]=V[u],V[u]=F,V[B+1]=V[u+1],V[u+1]=Z}function R(B,u,F){u*=2;var Z=F[B*=2],V=F[u];return!(Z<V)&&(Z!==V||F[B+1]>F[u+1])}function e(B,u,F,Z){var V=Z[B*=2];return V<u||V===u&&Z[B+1]<F}function s(B,Y,Q){var t=(Y-B+1)/6|0,v=B+t,D=Y-t,L=B+Y>>1,q=L-t,W=L+t,X=v,f=q,C=L,x=W,U=D,y=B+1,O=Y-1,g=0;R(X,f,Q)&&(g=X,X=f,f=g),R(x,U,Q)&&(g=x,x=U,U=g),R(X,C,Q)&&(g=X,X=C,C=g),R(f,C,Q)&&(g=f,f=C,C=g),R(X,x,Q)&&(g=X,X=x,x=g),R(C,x,Q)&&(g=C,C=x,x=g),R(f,U,Q)&&(g=f,f=U,U=g),R(f,C,Q)&&(g=f,f=C,C=g),R(x,U,Q)&&(g=x,x=U,U=g);for(var J=Q[2*f],a=Q[2*f+1],T=Q[2*x],z=Q[2*x+1],M=2*X,j=2*C,o=2*U,I=2*v,mB=2*L,E=2*D,w=0;w<2;++w){var H=Q[M+w],n=Q[j+w],d=Q[o+w];Q[I+w]=H,Q[mB+w]=n,Q[E+w]=d}V(q,B,Q),V(W,Y,Q);for(var l=y;l<=O;++l)if(e(l,J,a,Q))l!==y&&Z(l,y,Q),++y;else if(!e(l,T,z,Q))for(;;){if(e(O,T,z,Q)){e(O,J,a,Q)?(p(l,y,O,Q),++y,--O):(Z(l,O,Q),--O);break}if(--O<l)break}G(B,y-1,J,a,Q),G(Y,O+1,T,z,Q),y-2-B<=u?F(B,y-2,Q):s(B,y-2,Q),Y-(O+2)<=u?F(O+2,Y,Q):s(O+2,Y,Q),O-y<=u?F(y,O,Q):s(y,O,Q)}},14986:(B,u,F)=>{"use strict";B.exports={init:function(B){var u=V.nextPow2(B);e.length<u&&(Z.free(e),e=Z.mallocInt32(u));s.length<u&&(Z.free(s),s=Z.mallocInt32(u));Y.length<u&&(Z.free(Y),Y=Z.mallocInt32(u));Q.length<u&&(Z.free(Q),Q=Z.mallocInt32(u));t.length<u&&(Z.free(t),t=Z.mallocInt32(u));v.length<u&&(Z.free(v),v=Z.mallocInt32(u));var F=8*u;D.length<F&&(Z.free(D),D=Z.mallocDouble(F))},sweepBipartite:function(B,u,F,Z,V,R,t,v,W,X){for(var f=0,C=2*B,x=B-1,U=C-1,y=F;y<Z;++y){var O=R[y],g=C*y;D[f++]=V[g+x],D[f++]=-(O+1),D[f++]=V[g+U],D[f++]=O}for(y=t;y<v;++y){O=X[y]+G;var J=C*y;D[f++]=W[J+x],D[f++]=-O,D[f++]=W[J+U],D[f++]=O}var a=f>>>1;p(D,a);var T=0,z=0;for(y=0;y<a;++y){var M=0|D[2*y+1];if(M>=G)L(Y,Q,z--,M=M-G|0);else if(M>=0)L(e,s,T--,M);else if(M<=-G){M=-M-G|0;for(var j=0;j<T;++j){if(void 0!==(o=u(e[j],M)))return o}q(Y,Q,z++,M)}else{M=-M-1|0;for(j=0;j<z;++j){var o;if(void 0!==(o=u(M,Y[j])))return o}q(e,s,T++,M)}}},sweepComplete:function(B,u,F,Z,V,G,R,W,X,f){for(var C=0,x=2*B,U=B-1,y=x-1,O=F;O<Z;++O){var g=G[O]+1<<1,J=x*O;D[C++]=V[J+U],D[C++]=-g,D[C++]=V[J+y],D[C++]=g}for(O=R;O<W;++O){g=f[O]+1<<1;var a=x*O;D[C++]=X[a+U],D[C++]=1|-g,D[C++]=X[a+y],D[C++]=1|g}var T=C>>>1;p(D,T);var z=0,M=0,j=0;for(O=0;O<T;++O){var o=0|D[2*O+1],I=1&o;if(O<T-1&&o>>1===D[2*O+3]>>1&&(I=2,O+=1),o<0){for(var mB=-(o>>1)-1,E=0;E<j;++E){if(void 0!==(w=u(t[E],mB)))return w}if(0!==I)for(E=0;E<z;++E){if(void 0!==(w=u(e[E],mB)))return w}if(1!==I)for(E=0;E<M;++E){var w;if(void 0!==(w=u(Y[E],mB)))return w}0===I?q(e,s,z++,mB):1===I?q(Y,Q,M++,mB):2===I&&q(t,v,j++,mB)}else{mB=(o>>1)-1;0===I?L(e,s,z--,mB):1===I?L(Y,Q,M--,mB):2===I&&L(t,v,j--,mB)}}},scanBipartite:function(B,u,F,Z,V,R,Y,Q,t,v,W,X){var f=0,C=2*B,x=u,U=u+B,y=1,O=1;Z?O=G:y=G;for(var g=V;g<R;++g){var J=g+y,a=C*g;D[f++]=Y[a+x],D[f++]=-J,D[f++]=Y[a+U],D[f++]=J}for(g=t;g<v;++g){J=g+O;var T=C*g;D[f++]=W[T+x],D[f++]=-J}var z=f>>>1;p(D,z);var M=0;for(g=0;g<z;++g){var j=0|D[2*g+1];if(j<0){var o=!1;if((J=-j)>=G?(o=!Z,J-=G):(o=!!Z,J-=1),o)q(e,s,M++,J);else{var I=X[J],mB=C*J,E=W[mB+u+1],w=W[mB+u+1+B];B:for(var H=0;H<M;++H){var n=e[H],d=C*n;if(!(w<Y[d+u+1]||Y[d+u+1+B]<E)){for(var l=u+2;l<B;++l)if(W[mB+l+B]<Y[d+l]||Y[d+l+B]<W[mB+l])continue B;var P,c=Q[n];if(void 0!==(P=Z?F(I,c):F(c,I)))return P}}}}else L(e,s,M--,j-y)}},scanComplete:function(B,u,F,Z,V,R,s,Y,Q,t,v){for(var L=0,q=2*B,W=u,X=u+B,f=Z;f<V;++f){var C=f+G,x=q*f;D[L++]=R[x+W],D[L++]=-C,D[L++]=R[x+X],D[L++]=C}for(f=Y;f<Q;++f){C=f+1;var U=q*f;D[L++]=t[U+W],D[L++]=-C}var y=L>>>1;p(D,y);var O=0;for(f=0;f<y;++f){var g=0|D[2*f+1];if(g<0){if((C=-g)>=G)e[O++]=C-G;else{var J=v[C-=1],a=q*C,T=t[a+u+1],z=t[a+u+1+B];B:for(var M=0;M<O;++M){var j=e[M],o=s[j];if(o===J)break;var I=q*j;if(!(z<R[I+u+1]||R[I+u+1+B]<T)){for(var mB=u+2;mB<B;++mB)if(t[a+mB+B]<R[I+mB]||R[I+mB+B]<t[a+mB])continue B;var E=F(o,J);if(void 0!==E)return E}}}}else{for(C=g-G,M=O-1;M>=0;--M)if(e[M]===C){for(mB=M+1;mB<O;++mB)e[mB-1]=e[mB];break}--O}}}};var Z=F(14964),V=F(14970),p=F(14991),G=1<<28,R=1024,e=Z.mallocInt32(R),s=Z.mallocInt32(R),Y=Z.mallocInt32(R),Q=Z.mallocInt32(R),t=Z.mallocInt32(R),v=Z.mallocInt32(R),D=Z.mallocDouble(8192);function L(B,u,F,Z){var V=u[Z],p=B[F-1];B[V]=p,u[p]=V}function q(B,u,F,Z){B[F]=Z,u[Z]=F}},14974:B=>{"use strict";function u(B,F,Z){var V=0|B[Z];if(V<=0)return[];var p,G=new Array(V);if(Z===B.length-1)for(p=0;p<V;++p)G[p]=F;else for(p=0;p<V;++p)G[p]=u(B,F,Z+1);return G}B.exports=function(B,F){switch("undefined"===typeof F&&(F=0),typeof B){case"number":if(B>0)return function(B,u){var F,Z;for(F=new Array(B),Z=0;Z<B;++Z)F[Z]=u;return F}(0|B,F);break;case"object":if("number"===typeof B.length)return u(B,F,0)}return[]}},14925:(B,u,F)=>{B.exports=function(){var B=this;this.components={},this.comps=this.components;var u=this.components,F=1,V={},p=[],G=[],R={timeout:!1,removals:[],multiComps:[]};function e(B,F){var Z=u[F],p=V[F],G=p.hash[B];G&&(p.remove(B),Z.IV&&(Z.multi?(G.forEach((u=>{u&&Z.IV(B,u)})),G.length=0):Z.IV(B,G)),R.removals.push(p),s())}function s(){R.timeout||(R.timeout=!0,setTimeout(Y,1))}function Y(){R.timeout=!1,Q()}function Q(){R.multiComps.length&&function(B){for(var u=0;u<B.length;u++){var{entID:F,data:Z}=B[u],V=Z.hash[F];if(V){for(var p=0;p<V.length;p++)V[p]||(V.splice(p,1),p--);0===V.length&&(Z.remove(F),R.removals.push(Z))}}B.length=0}(R.multiComps),R.removals.length&&function(B){for(var u=0;u<B.length;u++){B[u].flush()}B.length=0}(R.removals)}this.wQ=V,this._systems=p,this._renderSystems=G,this.vs=function(u){var Z=F++;return Array.isArray(u)&&u.forEach((u=>B.ps(Z,u))),Z},this.deleteEntity=function(u){return Object.keys(V).forEach((B=>{V[B].hash[u]&&e(u,B)})),B},this.nY=function(B){if(!B)throw new Error("Missing component definition");var F=B.name;if(!F)throw new Error("Component definition must have a name property.");if("string"!==typeof F)throw new Error("Component name must be a string.");if(""===F)throw new Error("Component name must be a non-empty string.");if(V[F])throw new Error(`Component ${F} already exists.`);var R={};return R.name=F,R.multi=!!B.multi,R.order=isNaN(B.order)?99:B.order,R.stateConstructor=B.stateConstructor||null,R.state=B.state||{},R.ER=B.ER||null,R.IV=B.IV||null,R.system=B.system||null,R.PR=B.PR||null,u[F]=R,V[F]=new Z,V[F]._pendingMultiCleanup=!1,V[F]._multiCleanupIDs=R.multi?[]:null,R.system&&(p.push(F),p.sort(((B,F)=>u[B].order-u[F].order))),R.PR&&(G.push(F),G.sort(((B,F)=>u[B].order-u[F].order))),F},this.overwriteComponent=function(B,F){var Z=u[B];if(!Z)throw new Error(`Unknown component: ${B}`);if(!F)throw new Error("Missing component definition");if(Z.name!==F.name)throw new Error("Overwriting component must use the same name property.");var R={};R.name=B,R.multi=!!F.multi,R.order=isNaN(F.order)?99:F.order,R.state=F.state||{},R.ER=F.ER||null,R.IV=F.IV||null,R.system=F.system||null,R.PR=F.PR||null,u[B]=R,V[B]._pendingMultiCleanup=!1,V[B]._multiCleanupIDs=R.multi?[]:null;var e=p.indexOf(B);R.system&&e<0&&p.push(B),!R.system&&e>=0&&p.splice(e,1),p.sort(((B,F)=>u[B].order-u[F].order));var s=G.indexOf(B);R.PR&&s<0&&G.push(B),!R.PR&&s>=0&&G.splice(s,1),G.sort(((B,F)=>u[B].order-u[F].order));var Y=R.state;return this.GY(B).forEach((B=>{for(var u in Y)u in B||(B[u]=Y[u]);R.ER&&R.ER(B.dR,B)})),B},this.deleteComponent=function(F){var Z=V[F];if(!Z)throw new Error(`Unknown component: ${F}`);Z.flush(),Z.list.forEach((B=>{B&&e(B.dR||B[0].dR,F)}));var R=p.indexOf(F),s=G.indexOf(F);return R>-1&&p.splice(R,1),s>-1&&G.splice(s,1),V[F].dispose(),delete V[F],delete u[F],B},this.ps=function(B,F,Z){var p,G=u[F],R=V[F];if(!R)throw new Error(`Unknown component: ${F}.`);if(R.hash[B]&&!G.multi)throw new Error(`Entity ${B} already has component: ${F}.`);if(G.stateConstructor){if(!(p=new G.stateConstructor).hasOwnProperty("dR"))throw new Error(`Component ${G.name} stateConstructor type does not have property __id`)}else p=Object.assign({},{dR:B},G.state,Z);if(p.dR=B,G.multi){var e=R.hash[B];e||(e=[],R.add(B,e)),e.push(p)}else R.add(B,p);return G.ER&&G.ER(B,p),this},this.qs=function(B,u){var F=V[u];if(!F)throw new Error(`Unknown component: ${u}.`);return!!F.hash[B]},this.ss=function(u,F){if(!V[F])throw new Error(`Unknown component: ${F}.`);return e(u,F),B},this.getState=function(B,u){var F=V[u];if(!F)throw new Error(`Unknown component: ${u}.`);return F.hash[B]},this.GY=function(B){var u=V[B];if(!u)throw new Error(`Unknown component: ${B}.`);return Q(),u.list},this.Jv=function(B){if(!V[B])throw new Error(`Unknown component: ${B}.`);var u=V[B].hash;return B=>u[B]},this.zv=function(B){if(!V[B])throw new Error(`Unknown component: ${B}.`);var u=V[B].hash;return B=>!!u[B]},this.FR=function(F){Q();for(var Z=0;Z<p.length;Z++){var G=p[Z],R=u[G],e=V[G];R.system(F,e.list),Q()}return B},this.render=function(F){Q();for(var Z=0;Z<G.length;Z++){var p=G[Z],R=u[p],e=V[p];R.PR(F,e.list),Q()}return B},this.removeMultiComponent=function(F,Z,p){var G=u[Z],e=V[Z];if(!e)throw new Error(`Unknown component: ${Z}.`);if(!G.multi)throw new Error("removeMultiComponent called on non-multi component");return function(B,u,F,Z){var V=F.hash[B];if(V){var p=V[Z];p&&(V[Z]=null,u.IV&&u.IV(B,p),R.multiComps.push({entID:B,data:F}),s())}}(F,G,e,p),B}};var Z=F(14932)},14932:B=>{function u(B,u){var F=B._map[u];if(delete B.hash[u],delete B._map[u],F===B.list.length-1)B.list.pop();else{var Z=B.list.pop();if(B.list[F]=Z,null===Z||null===Z[0]){var V=B.list.length;for(var p in B._map)if(B._map[p]===V)return void(B._map[p]=F)}else{var G=Z.dR||Z[0].dR;B._map[G]=F}}}B.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(B,u){if("number"===typeof this._map[B]){var F=this._map[B];this.hash[B]=u,this.list[F]=u}else this._map[B]=this.list.length,this.hash[B]=u,this.list.push(u)}remove(B){var u=this._map[B];this.hash[B]=null,this.list[u]=null,this._pendingRemovals.push(B)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var B=0;B<this._pendingRemovals.length;B++){var F=this._pendingRemovals[B];null===this.hash[F]&&u(this,F)}this._pendingRemovals.length=0}}},14897:B=>{"use strict";var u,F="object"===typeof Reflect?Reflect:null,Z=function(B,u,F){return Function.prototype.apply.call(B,u,F)};u=F&&"function"===typeof F.ownKeys?F.ownKeys:Object.getOwnPropertySymbols?function(B){return Object.getOwnPropertyNames(B).concat(Object.getOwnPropertySymbols(B))}:function(B){return Object.getOwnPropertyNames(B)};var V=Number.isNaN||function(B){return B!==B};function p(){p.init.call(this)}B.exports=p,B.exports.once=function(B,u){return new Promise((function(F,Z){function V(F){B.removeListener(u,p),Z(F)}function p(){"function"===typeof B.removeListener&&B.removeListener("error",V),F([].slice.call(arguments))}L(B,u,p,{once:!0}),"error"!==u&&function(B,u,F){"function"===typeof B.on&&L(B,"error",u,F)}(B,V,{once:!0})}))},p.EventEmitter=p,p.prototype._events=void 0,p.prototype._eventsCount=0,p.prototype._maxListeners=void 0;var G=10;function R(B){if("function"!==typeof B)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof B)}function e(B){return void 0===B._maxListeners?p.defaultMaxListeners:B._maxListeners}function s(B,u,F,Z){var V,p,G,s;if(R(F),void 0===(p=B._events)?(p=B._events=Object.create(null),B._eventsCount=0):(void 0!==p.newListener&&(B.emit("newListener",u,F.listener?F.listener:F),p=B._events),G=p[u]),void 0===G)G=p[u]=F,++B._eventsCount;else if("function"===typeof G?G=p[u]=Z?[F,G]:[G,F]:Z?G.unshift(F):G.push(F),(V=e(B))>0&&G.length>V&&!G.warned){G.warned=!0;var Y=new Error("Possible EventEmitter memory leak detected. "+G.length+" "+String(u)+" listeners added. Use emitter.setMaxListeners() to increase limit");Y.name="MaxListenersExceededWarning",Y.Zu=B,Y.type=u,Y.count=G.length,s=Y,console&&console.warn&&console.warn(s)}return B}function Y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Q(B,u,F){var Z={fired:!1,wrapFn:void 0,target:B,type:u,listener:F},V=Y.bind(Z);return V.listener=F,Z.wrapFn=V,V}function t(B,u,F){var Z=B._events;if(void 0===Z)return[];var V=Z[u];return void 0===V?[]:"function"===typeof V?F?[V.listener||V]:[V]:F?function(B){for(var u=new Array(B.length),F=0;F<u.length;++F)u[F]=B[F].listener||B[F];return u}(V):D(V,V.length)}function v(B){var u=this._events;if(void 0!==u){var F=u[B];if("function"===typeof F)return 1;if(void 0!==F)return F.length}return 0}function D(B,u){for(var F=new Array(u),Z=0;Z<u;++Z)F[Z]=B[Z];return F}function L(B,u,F,Z){if("function"===typeof B.on)Z.once?B.once(u,F):B.on(u,F);else{if("function"!==typeof B.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof B);B.addEventListener(u,(function V(p){Z.once&&B.removeEventListener(u,V),F(p)}))}}Object.defineProperty(p,"defaultMaxListeners",{enumerable:!0,get:function(){return G},set:function(B){if("number"!==typeof B||B<0||V(B))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+B+".");G=B}}),p.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},p.prototype.setMaxListeners=function(B){if("number"!==typeof B||B<0||V(B))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+B+".");return this._maxListeners=B,this},p.prototype.getMaxListeners=function(){return e(this)},p.prototype.emit=function(B){for(var u=[],F=1;F<arguments.length;F++)u.push(arguments[F]);var V="error"===B,p=this._events;if(void 0!==p)V=V&&void 0===p.error;else if(!V)return!1;if(V){var G;if(u.length>0&&(G=u[0]),G instanceof Error)throw G;var R=new Error("Unhandled error."+(G?" ("+G.message+")":""));throw R.context=G,R}var e=p[B];if(void 0===e)return!1;if("function"===typeof e)Z(e,this,u);else{var s=e.length,Y=D(e,s);for(F=0;F<s;++F)Z(Y[F],this,u)}return!0},p.prototype.addListener=function(B,u){return s(this,B,u,!1)},p.prototype.on=p.prototype.addListener,p.prototype.prependListener=function(B,u){return s(this,B,u,!0)},p.prototype.once=function(B,u){return R(u),this.on(B,Q(this,B,u)),this},p.prototype.prependOnceListener=function(B,u){return R(u),this.prependListener(B,Q(this,B,u)),this},p.prototype.removeListener=function(B,u){var F,Z,V,p,G;if(R(u),void 0===(Z=this._events))return this;if(void 0===(F=Z[B]))return this;if(F===u||F.listener===u)0===--this._eventsCount?this._events=Object.create(null):(delete Z[B],Z.removeListener&&this.emit("removeListener",B,F.listener||u));else if("function"!==typeof F){for(V=-1,p=F.length-1;p>=0;p--)if(F[p]===u||F[p].listener===u){G=F[p].listener,V=p;break}if(V<0)return this;0===V?F.shift():function(B,u){for(;u+1<B.length;u++)B[u]=B[u+1];B.pop()}(F,V),1===F.length&&(Z[B]=F[0]),void 0!==Z.removeListener&&this.emit("removeListener",B,G||u)}return this},p.prototype.off=p.prototype.removeListener,p.prototype.Vu=function(B){var u,F,Z;if(void 0===(F=this._events))return this;if(void 0===F.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==F[B]&&(0===--this._eventsCount?this._events=Object.create(null):delete F[B]),this;if(0===arguments.length){var V,p=Object.keys(F);for(Z=0;Z<p.length;++Z)"removeListener"!==(V=p[Z])&&this.Vu(V);return this.Vu("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(u=F[B]))this.removeListener(B,u);else if(void 0!==u)for(Z=u.length-1;Z>=0;Z--)this.removeListener(B,u[Z]);return this},p.prototype.listeners=function(B){return t(this,B,!0)},p.prototype.rawListeners=function(B){return t(this,B,!1)},p.listenerCount=function(B,u){return"function"===typeof B.listenerCount?B.listenerCount(u):v.call(B,u)},p.prototype.listenerCount=v,p.prototype.eventNames=function(){return this._eventsCount>0?u(this._events):[]}},15205:B=>{"use strict";B.exports=function(B,u,F,Z,V,p){var G=+u[0],R=+u[1],e=+u[2],s=+F[0],Y=+F[1],Q=+F[2],t=Math.sqrt(s*s+Y*Y+Q*Q);if(0===t)throw new Error("Can't raycast along a zero vector");return function(B,u,F,Z,V,p,G,R,e,s){for(var Y=0,Q=Math.floor,t=0|Q(u),v=0|Q(F),D=0|Q(Z),L=V>0?1:-1,q=p>0?1:-1,W=G>0?1:-1,X=Math.abs(1/V),f=Math.abs(1/p),C=Math.abs(1/G),x=X<1/0?X*(L>0?t+1-u:u-t):1/0,U=f<1/0?f*(q>0?v+1-F:F-v):1/0,y=C<1/0?C*(W>0?D+1-Z:Z-D):1/0,O=-1;Y<=R;){var g=B(t,v,D);if(g)return e&&(e[0]=u+Y*V,e[1]=F+Y*p,e[2]=Z+Y*G),s&&(s[0]=s[1]=s[2]=0,0===O&&(s[0]=-L),1===O&&(s[1]=-q),2===O&&(s[2]=-W)),g;x<U?x<y?(t+=L,Y=x,x+=X,O=0):(D+=W,Y=y,y+=C,O=2):U<y?(v+=q,Y=U,U+=f,O=1):(D+=W,Y=y,y+=C,O=2)}return e&&(e[0]=u+Y*V,e[1]=F+Y*p,e[2]=Z+Y*G),s&&(s[0]=s[1]=s[2]=0),0}(B,G,R,e,s/=t,Y/=t,Q/=t,Z="undefined"===typeof Z?64:+Z,V,p)}},15239:(B,u,F)=>{"use strict";F.d(u,{b:()=>p});var Z=F(14897);function V(){this.Jt=!1,this.stopPropagation=!1,this.Tt=!1,this.disabled=!1}class p{constructor(B,u){this.version="0.7.0";var F=Object.assign({},new V,u||{});this.element=B||document,this.Jt=!!F.Jt,this.stopPropagation=!!F.stopPropagation,this.Tt=!!F.Tt,this.disabled=!!F.disabled,this.filterEvents=(B,u)=>!0,this.down=new Z.EventEmitter,this.up=new Z.EventEmitter,this.state={},this.BY={dx:0,dy:0,Wv:0,Ss:0,Xv:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?R(this):document.addEventListener("DOMContentLoaded",(B=>{R(this)}),{once:!0})}bind(B){for(var u=arguments.length,F=new Array(u>1?u-1:0),Z=1;Z<u;Z++)F[Z-1]=arguments[Z];F.forEach((u=>{var F=this._keyBindmap[u]||[];F.includes(B)||(F.push(B),this._keyBindmap[u]=F)})),this.state[B]=!!this.state[B],this.pressCount[B]=this.pressCount[B]||0,this.releaseCount[B]=this.releaseCount[B]||0}unbind(B){for(var u in this._keyBindmap){var F=this._keyBindmap[u],Z=F.indexOf(B);Z>-1&&F.splice(Z,1)}}getBindings(){var B={};for(var u in this._keyBindmap){this._keyBindmap[u].forEach((F=>{B[F]=B[F]||[],B[F].push(u)}))}return B}FR(){G(this.BY),G(this.pressCount),G(this.releaseCount)}}function G(B){for(var u in B)B[u]=0}function R(B){window.addEventListener("keydown",D.bind(null,B,!0),!1),window.addEventListener("keyup",D.bind(null,B,!1),!1);var u={passive:!0};B.element.addEventListener("touchstart",Q.bind(void 0,B),{passive:!1}),B.element.addEventListener("touchend",v.bind(void 0,B),u),B.element.addEventListener("mousedown",L.bind(null,B,!0),u),window.document.addEventListener("mouseup",L.bind(null,B,!1),u),B.element.addEventListener("touchmove",q.bind(null,B),u),B.element.addEventListener("mousemove",q.bind(null,B),u),window.PointerEvent,B.element.addEventListener("wheel",W.bind(null,B),u),B.element.addEventListener("contextmenu",X.bind(null,B),!1),window.addEventListener("blur",f.bind(null,B),!1)}var e=0,s=0,Y=null;function Q(B,u){u.preventDefault(),t(u)}function t(B){let u=!1;for(let F=0;F<B.touches.length;++F)if(B.touches[F].identifier===Y){u=!0;break}if(!u){const u=B.changedTouches[0];e=u.clientX,s=u.clientY,Y=u.identifier}}function v(B,u){for(var F=u.changedTouches,Z=0;Z<F.length;++Z)F[Z].identifier===Y&&(Y=null)}function D(B,u,F){C(F.code,u,B,F)}function L(B,u,F){if("pointerId"in F)if(u){if(null!==B._touches.currID)return;B._touches.currID=F.pointerId}else{if(B._touches.currID!==F.pointerId)return;B._touches.currID=null}return C("Mouse"+("button"in F?F.button+1:1),u,B,F),!1}function q(B,u){var F=u.movementX||u.mozMovementX||0,Z=u.movementY||u.mozMovementY||0;if(u.touches&&0===(F|Z)){var V=function(B){t(B);for(let u=0;u<B.changedTouches.length;++u)if(B.changedTouches[u].identifier==Y){const F=B.changedTouches[u],Z=[F.clientX-e,F.clientY-s];return e=F.clientX,s=F.clientY,Z}return console.error(`Did not find touch id ${Y}`),[0,0]}(u);F=V[0],Z=V[1]}B.BY.dx+=F,B.BY.dy+=Z}function W(B,u){var F=1;switch(u.deltaMode){case 0:F=1;break;case 1:F=12;break;case 2:F=B.element.clientHeight||window.innerHeight}B.BY.Wv+=(u.deltaX||0)*F,B.BY.Ss+=(u.deltaY||0)*F,B.BY.Xv+=(u.deltaZ||0)*F}function X(B,u){if(!B.Tt)return u.preventDefault(),!1}function f(B){for(var u in B._keyStates)B._keyStates[u]&&(/^Mouse\d/.test(u)||C(u,!1,B,{code:u,note:"d4bp5988ej6",preventDefault:()=>{},stopPropagation:()=>{}}))}function C(B,u,F,Z){var V=F._keyBindmap[B];V&&(x(F._keyStates[B],u)&&(F._keyStates[B]=u,V.forEach((B=>{(!F.filterEvents||F.filterEvents(Z,B))&&function(B,u,F,Z){var V=u?F.pressCount:F.releaseCount;V[B]=(V[B]||0)+1;var p=F._bindPressCount[B]||0;(p+=u?1:-1)<0&&(p=0);F._bindPressCount[B]=p;var G=F.state[B];if(x(G,p)){F.state[B]=p>0;var R=u?F.down:F.up;F.disabled||R.emit(B,Z)}}(B,u,F,Z)}))),"button"in Z||(F.Jt&&!Z.defaultPrevented&&Z.preventDefault(),F.stopPropagation&&Z.stopPropagation()))}function x(B,u){return B?!u:u}},13839:B=>{B.exports=function(B,u,F){return B[0]=u[0]+F[0],B[1]=u[1]+F[1],B[2]=u[2]+F[2],B}},13799:(B,u,F)=>{B.exports=function(B,u){var F=Z(B[0],B[1],B[2]),G=Z(u[0],u[1],u[2]);V(F,F),V(G,G);var R=p(F,G);return R>1?0:Math.acos(R)};var Z=F(13805),V=F(13807),p=F(13815)},13884:B=>{B.exports=function(B,u){return B[0]=Math.ceil(u[0]),B[1]=Math.ceil(u[1]),B[2]=Math.ceil(u[2]),B}},13797:B=>{B.exports=function(B){var u=new Float32Array(3);return u[0]=B[0],u[1]=B[1],u[2]=B[2],u}},13818:B=>{B.exports=function(B,u){return B[0]=u[0],B[1]=u[1],B[2]=u[2],B}},13788:B=>{B.exports=function(){var B=new Float32Array(3);return B[0]=0,B[1]=0,B[2]=0,B}},13958:B=>{B.exports=function(B,u,F){var Z=u[0],V=u[1],p=u[2],G=F[0],R=F[1],e=F[2];return B[0]=V*e-p*R,B[1]=p*G-Z*e,B[2]=Z*R-V*G,B}},13907:(B,u,F)=>{B.exports=F(13903)},13903:B=>{B.exports=function(B,u){var F=u[0]-B[0],Z=u[1]-B[1],V=u[2]-B[2];return Math.sqrt(F*F+Z*Z+V*V)}},13868:(B,u,F)=>{B.exports=F(13863)},13863:B=>{B.exports=function(B,u,F){return B[0]=u[0]/F[0],B[1]=u[1]/F[1],B[2]=u[2]/F[2],B}},13815:B=>{B.exports=function(B,u){return B[0]*u[0]+B[1]*u[1]+B[2]*u[2]}},13779:B=>{B.exports=1e-6},13832:(B,u,F)=>{B.exports=function(B,u){var F=B[0],V=B[1],p=B[2],G=u[0],R=u[1],e=u[2];return Math.abs(F-G)<=Z*Math.max(1,Math.abs(F),Math.abs(G))&&Math.abs(V-R)<=Z*Math.max(1,Math.abs(V),Math.abs(R))&&Math.abs(p-e)<=Z*Math.max(1,Math.abs(p),Math.abs(e))};var Z=F(13779)},13837:B=>{B.exports=function(B,u){return B[0]===u[0]&&B[1]===u[1]&&B[2]===u[2]}},13878:B=>{B.exports=function(B,u){return B[0]=Math.floor(u[0]),B[1]=Math.floor(u[1]),B[2]=Math.floor(u[2]),B}},14004:(B,u,F)=>{B.exports=function(B,u,F,V,p,G){var R,e;u||(u=3);F||(F=0);e=V?Math.min(V*u+F,B.length):B.length;for(R=F;R<e;R+=u)Z[0]=B[R],Z[1]=B[R+1],Z[2]=B[R+2],p(Z,Z,G),B[R]=Z[0],B[R+1]=Z[1],B[R+2]=Z[2];return B};var Z=F(13788)()},13805:B=>{B.exports=function(B,u,F){var Z=new Float32Array(3);return Z[0]=B,Z[1]=u,Z[2]=F,Z}},13771:(B,u,F)=>{B.exports={EPSILON:F(13779),create:F(13788),clone:F(13797),angle:F(13799),rG:F(13805),k:F(13818),set:F(13827),equals:F(13832),exactEquals:F(13837),add:F(13839),Lu:F(13841),sub:F(13844),multiply:F(13852),mul:F(13855),divide:F(13863),div:F(13868),min:F(13874),max:F(13876),floor:F(13878),ceil:F(13884),round:F(13890),scale:F(13899),KG:F(13901),distance:F(13903),j:F(13907),squaredDistance:F(13912),sqrDist:F(13918),length:F(13926),len:F(13932),squaredLength:F(13936),NG:F(13941),negate:F(13943),inverse:F(13950),normalize:F(13807),dot:F(13815),cross:F(13958),wG:F(13960),random:F(13965),transformMat4:F(13971),transformMat3:F(13973),transformQuat:F(13975),AG:F(13983),bG:F(13990),kG:F(13997),forEach:F(14004)}},13950:B=>{B.exports=function(B,u){return B[0]=1/u[0],B[1]=1/u[1],B[2]=1/u[2],B}},13932:(B,u,F)=>{B.exports=F(13926)},13926:B=>{B.exports=function(B){var u=B[0],F=B[1],Z=B[2];return Math.sqrt(u*u+F*F+Z*Z)}},13960:B=>{B.exports=function(B,u,F,Z){var V=u[0],p=u[1],G=u[2];return B[0]=V+Z*(F[0]-V),B[1]=p+Z*(F[1]-p),B[2]=G+Z*(F[2]-G),B}},13876:B=>{B.exports=function(B,u,F){return B[0]=Math.max(u[0],F[0]),B[1]=Math.max(u[1],F[1]),B[2]=Math.max(u[2],F[2]),B}},13874:B=>{B.exports=function(B,u,F){return B[0]=Math.min(u[0],F[0]),B[1]=Math.min(u[1],F[1]),B[2]=Math.min(u[2],F[2]),B}},13855:(B,u,F)=>{B.exports=F(13852)},13852:B=>{B.exports=function(B,u,F){return B[0]=u[0]*F[0],B[1]=u[1]*F[1],B[2]=u[2]*F[2],B}},13943:B=>{B.exports=function(B,u){return B[0]=-u[0],B[1]=-u[1],B[2]=-u[2],B}},13807:B=>{B.exports=function(B,u){var F=u[0],Z=u[1],V=u[2],p=F*F+Z*Z+V*V;p>0&&(p=1/Math.sqrt(p),B[0]=u[0]*p,B[1]=u[1]*p,B[2]=u[2]*p);return B}},13965:B=>{B.exports=function(B,u){u=u||1;var F=2*Math.random()*Math.PI,Z=2*Math.random()-1,V=Math.sqrt(1-Z*Z)*u;return B[0]=Math.cos(F)*V,B[1]=Math.sin(F)*V,B[2]=Z*u,B}},13983:B=>{B.exports=function(B,u,F,Z){var V=F[1],p=F[2],G=u[1]-V,R=u[2]-p,e=Math.sin(Z),s=Math.cos(Z);return B[0]=u[0],B[1]=V+G*s-R*e,B[2]=p+G*e+R*s,B}},13990:B=>{B.exports=function(B,u,F,Z){var V=F[0],p=F[2],G=u[0]-V,R=u[2]-p,e=Math.sin(Z),s=Math.cos(Z);return B[0]=V+R*e+G*s,B[1]=u[1],B[2]=p+R*s-G*e,B}},13997:B=>{B.exports=function(B,u,F,Z){var V=F[0],p=F[1],G=u[0]-V,R=u[1]-p,e=Math.sin(Z),s=Math.cos(Z);return B[0]=V+G*s-R*e,B[1]=p+G*e+R*s,B[2]=u[2],B}},13890:B=>{B.exports=function(B,u){return B[0]=Math.round(u[0]),B[1]=Math.round(u[1]),B[2]=Math.round(u[2]),B}},13899:B=>{B.exports=function(B,u,F){return B[0]=u[0]*F,B[1]=u[1]*F,B[2]=u[2]*F,B}},13901:B=>{B.exports=function(B,u,F,Z){return B[0]=u[0]+F[0]*Z,B[1]=u[1]+F[1]*Z,B[2]=u[2]+F[2]*Z,B}},13827:B=>{B.exports=function(B,u,F,Z){return B[0]=u,B[1]=F,B[2]=Z,B}},13918:(B,u,F)=>{B.exports=F(13912)},13941:(B,u,F)=>{B.exports=F(13936)},13912:B=>{B.exports=function(B,u){var F=u[0]-B[0],Z=u[1]-B[1],V=u[2]-B[2];return F*F+Z*Z+V*V}},13936:B=>{B.exports=function(B){var u=B[0],F=B[1],Z=B[2];return u*u+F*F+Z*Z}},13844:(B,u,F)=>{B.exports=F(13841)},13841:B=>{B.exports=function(B,u,F){return B[0]=u[0]-F[0],B[1]=u[1]-F[1],B[2]=u[2]-F[2],B}},13973:B=>{B.exports=function(B,u,F){var Z=u[0],V=u[1],p=u[2];return B[0]=Z*F[0]+V*F[3]+p*F[6],B[1]=Z*F[1]+V*F[4]+p*F[7],B[2]=Z*F[2]+V*F[5]+p*F[8],B}},13971:B=>{B.exports=function(B,u,F){var Z=u[0],V=u[1],p=u[2],G=F[3]*Z+F[7]*V+F[11]*p+F[15];return G=G||1,B[0]=(F[0]*Z+F[4]*V+F[8]*p+F[12])/G,B[1]=(F[1]*Z+F[5]*V+F[9]*p+F[13])/G,B[2]=(F[2]*Z+F[6]*V+F[10]*p+F[14])/G,B}},13975:B=>{B.exports=function(B,u,F){var Z=u[0],V=u[1],p=u[2],G=F[0],R=F[1],e=F[2],s=F[3],Y=s*Z+R*p-e*V,Q=s*V+e*Z-G*p,t=s*p+G*V-R*Z,v=-G*Z-R*V-e*p;return B[0]=Y*s+v*-G+Q*-e-t*-R,B[1]=Q*s+v*-R+t*-G-Y*-e,B[2]=t*s+v*-e+Y*-R-Q*-G,B}},14916:B=>{"use strict";B.exports=function(B){for(var u=new Array(B),F=0;F<B;++F)u[F]=F;return u}},14981:B=>{B.exports=function(B){return null!=B&&null!=B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}},15212:(B,u,F)=>{"use strict";F.d(u,{c:()=>Z});class Z{constructor(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.RQ=!1,this.eQ=!1,this.pQ=30,this.GQ=0,this.qQ=!1,this.fullscreen=!1,this.YQ=function(B){},this.QQ=function(){},this.DQ=function(){},this.Up=function(){},this.tQ=function(B){},this.onFullscreenChanged=function(B){},s((()=>{!function(B,u){B._nowObject=performance||Date,B._lastTick=0,B._renderAccum=0,B._rt=0,B._frameCB=R.bind(null,B),requestAnimationFrame(B._frameCB),u>0&&(B._intervalCB=G.bind(null,B),B._interval=setInterval(B._intervalCB,Math.max(u,1e3/B.pQ/2)))}(this,u),function(B,u){if(!u)return;var F=!1,Z=!1;document.addEventListener("pointerlockchange",(Z=>{F=document.pointerLockElement===u,B.tQ(F)})),document.addEventListener("fullscreenchange",(F=>{Z=document.fullscreenElement===u,B.onFullscreenChanged(Z)})),Object.defineProperty(B,"qQ",{get:()=>F,set:B=>{B&&!F?e(u):F&&!B&&function(B){B.exitPointerLock&&B.exitPointerLock()}(document)}}),Object.defineProperty(B,"fullscreen",{get:()=>Z,set:B=>{B&&!Z?u.requestFullscreen():Z&&!B&&document.exitFullscreen()}}),u.addEventListener("click",(V=>{B.RQ&&!F&&e(u),B.eQ&&!Z&&u.requestFullscreen()}));var V=()=>B.Up();if(window.ResizeObserver){new ResizeObserver(V).observe(u)}else window.addEventListener("resize",V)}(this,B),this.DQ()}))}}var V=3,p=20;function G(B){for(var u=1e3/B.pQ,F=B._nowObject.now()+p,Z=0;B._nowObject.now()>=B._lastTick+u&&B._nowObject.now()<F&&++Z<=V;)B.YQ(u),B._lastTick+=u;var G=5*(u+5),R=B._nowObject.now();if(R-B._lastTick>G)for(;R>=B._lastTick+u;)B._lastTick+=u}function R(B){requestAnimationFrame(B._frameCB),G(B);var u=B._nowObject.now(),F=u-B._rt;if(B._rt=u,B.GQ>0){B._renderAccum+=F;var Z=1e3/B.GQ;if(B._renderAccum<Z)return;B._renderAccum=Math.min(B._renderAccum-Z,Z)}var V=1e3/B.pQ,p=(u-B._lastTick)/V;B.QQ(F,p,V)}function e(B){B.requestPointerLock&&B.requestPointerLock()}var s=B=>{if("loading"===document.readyState){var u=()=>{document.removeEventListener("readystatechange",u),B()};document.addEventListener("readystatechange",u)}else setTimeout(B,1)}},14911:(B,u,F)=>{var Z=F(14916),V=F(14919),p="undefined"!==typeof Float64Array;function G(B,u){return B[0]-u[0]}function R(){var B,u=this.stride,F=new Array(u.length);for(B=0;B<F.length;++B)F[B]=[Math.abs(u[B]),B];F.sort(G);var Z=new Array(F.length);for(B=0;B<Z.length;++B)Z[B]=F[B][1];return Z}function e(B,u){var F=["View",u,"d",B].join("");u<0&&(F="View_Nil"+B);var V="generic"===B;if(-1===u){var p="function "+F+"(a){this.data=a;};var proto="+F+".prototype;proto.dtype='"+B+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+F+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+F+"(a){return new "+F+"(a);}";return new Function(p)()}if(0===u){p="function "+F+"(a,d) {this.data = a;this.offset = d};var proto="+F+".prototype;proto.dtype='"+B+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+F+"_copy() {return new "+F+"(this.data,this.offset)};proto.pick=function "+F+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+F+"_get(){return "+(V?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+F+"_set(v){return "+(V?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+F+"(a,b,c,d){return new "+F+"(a,d)}";return new Function("TrivialArray",p)(s[B][0])}p=["'use strict'"];var G=Z(u),e=G.map((function(B){return"i"+B})),Y="this.offset+"+G.map((function(B){return"this.stride["+B+"]*i"+B})).join("+"),Q=G.map((function(B){return"b"+B})).join(","),t=G.map((function(B){return"c"+B})).join(",");p.push("function "+F+"(a,"+Q+","+t+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+t+"]","this.offset=d|0}","var proto="+F+".prototype","proto.dtype='"+B+"'","proto.dimension="+u),p.push("Object.defineProperty(proto,'size',{get:function "+F+"_size(){return "+G.map((function(B){return"this.shape["+B+"]"})).join("*"),"}})"),1===u?p.push("proto.order=[0]"):(p.push("Object.defineProperty(proto,'order',{get:"),u<4?(p.push("function "+F+"_order(){"),2===u?p.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===u&&p.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):p.push("ORDER})")),p.push("proto.set=function "+F+"_set("+e.join(",")+",v){"),V?p.push("return this.data.set("+Y+",v)}"):p.push("return this.data["+Y+"]=v}"),p.push("proto.get=function "+F+"_get("+e.join(",")+"){"),V?p.push("return this.data.get("+Y+")}"):p.push("return this.data["+Y+"]}"),p.push("proto.index=function "+F+"_index(",e.join(),"){return "+Y+"}"),p.push("proto.hi=function "+F+"_hi("+e.join(",")+"){return new "+F+"(this.data,"+G.map((function(B){return["(typeof i",B,"!=='number'||i",B,"<0)?this.shape[",B,"]:i",B,"|0"].join("")})).join(",")+","+G.map((function(B){return"this.stride["+B+"]"})).join(",")+",this.offset)}");var v=G.map((function(B){return"a"+B+"=this.shape["+B+"]"})),D=G.map((function(B){return"c"+B+"=this.stride["+B+"]"}));p.push("proto.lo=function "+F+"_lo("+e.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+D.join(","));for(var L=0;L<u;++L)p.push("if(typeof i"+L+"==='number'&&i"+L+">=0){d=i"+L+"|0;b+=c"+L+"*d;a"+L+"-=d}");p.push("return new "+F+"(this.data,"+G.map((function(B){return"a"+B})).join(",")+","+G.map((function(B){return"c"+B})).join(",")+",b)}"),p.push("proto.step=function "+F+"_step("+e.join(",")+"){var "+G.map((function(B){return"a"+B+"=this.shape["+B+"]"})).join(",")+","+G.map((function(B){return"b"+B+"=this.stride["+B+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(L=0;L<u;++L)p.push("if(typeof i"+L+"==='number'){d=i"+L+"|0;if(d<0){c+=b"+L+"*(a"+L+"-1);a"+L+"=ceil(-a"+L+"/d)}else{a"+L+"=ceil(a"+L+"/d)}b"+L+"*=d}");p.push("return new "+F+"(this.data,"+G.map((function(B){return"a"+B})).join(",")+","+G.map((function(B){return"b"+B})).join(",")+",c)}");var q=new Array(u),W=new Array(u);for(L=0;L<u;++L)q[L]="a[i"+L+"]",W[L]="b[i"+L+"]";p.push("proto.transpose=function "+F+"_transpose("+e+"){"+e.map((function(B,u){return B+"=("+B+"===undefined?"+u+":"+B+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+F+"(this.data,"+q.join(",")+","+W.join(",")+",this.offset)}"),p.push("proto.pick=function "+F+"_pick("+e+"){var a=[],b=[],c=this.offset");for(L=0;L<u;++L)p.push("if(typeof i"+L+"==='number'&&i"+L+">=0){c=(c+this.stride["+L+"]*i"+L+")|0}else{a.push(this.shape["+L+"]);b.push(this.stride["+L+"])}");return p.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),p.push("return function construct_"+F+"(data,shape,stride,offset){return new "+F+"(data,"+G.map((function(B){return"shape["+B+"]"})).join(",")+","+G.map((function(B){return"stride["+B+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",p.join("\n"))(s[B],R)}var s={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};B.exports=function(B,u,F,Z){if(void 0===B)return(0,s.array[0])([]);"number"===typeof B&&(B=[B]),void 0===u&&(u=[B.length]);var G=u.length;if(void 0===F){F=new Array(G);for(var R=G-1,Y=1;R>=0;--R)F[R]=Y,Y*=u[R]}if(void 0===Z){Z=0;for(R=0;R<G;++R)F[R]<0&&(Z-=(u[R]-1)*F[R])}for(var Q=function(B){if(V(B))return"buffer";if(p)switch(Object.prototype.toString.call(B)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(B)?"array":"generic"}(B),t=s[Q];t.length<=G+1;)t.push(e(Q,t.length-1));return(0,t[G+1])(B,u,F,Z)}},14919:B=>{function u(B){return!!B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}B.exports=function(B){return null!=B&&(u(B)||function(B){return"function"===typeof B.readFloatLE&&"function"===typeof B.slice&&u(B.slice(0,0))}(B)||!!B._isBuffer)}},15054:B=>{"use strict";var u=[],F=[],Z=[],V=[],p=[],G=[],R=[],e=[],s=[],Y=[],Q=[],t=[];B.exports=function(B,v,D,L,q,W){for(var X=R,f=s,C=Y,x=t,U=0;U<3;U++)X[U]=+D[U],C[U]=+v.max[U],f[U]=+v.base[U];W||(W=1e-10);var y=function(B,R,s,Y,t,v){var D=u,L=F,q=Z,W=V,X=p,f=G,C=e,x=Math.floor,U=0,y=0,O=0,g=0,J=0;if(a(),0===O)return 0;for(g=M();y<=O;){if(T(g)&&z())return U;g=M()}for(U+=O,J=0;J<3;J++)Y[J]+=s[J],t[J]+=s[J];return U;function a(){if(y=0,0!==(O=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2])))for(var B=0;B<3;B++){var u=s[B]>=0;W[B]=u?1:-1;var F=u?t[B]:Y[B];D[B]=u?Y[B]:t[B],L[B]=j(F,W[B]),q[B]=o(D[B],W[B]),C[B]=s[B]/O,X[B]=Math.abs(1/C[B]);var Z=u?L[B]+1-F:F-L[B];f[B]=X[B]<1/0?X[B]*Z:1/0}}function T(u){for(var F=W[0],Z=0===u?L[0]:q[0],V=L[0]+F,p=W[1],G=1===u?L[1]:q[1],R=L[1]+p,e=W[2],s=2===u?L[2]:q[2],Y=L[2]+e,Q=Z;Q!=V;Q+=F)for(var t=G;t!=R;t+=p)for(var v=s;v!=Y;v+=e)if(B(Q,t,v))return!0;return!1}function z(){U+=y;var B=W[g],u=y/O,F=Q;for(J=0;J<3;J++){var Z=s[J]*u;Y[J]+=Z,t[J]+=Z,F[J]=s[J]-Z}if(B>0?t[g]=Math.round(t[g]):Y[g]=Math.round(Y[g]),R(U,g,B,F))return!0;for(J=0;J<3;J++)s[J]=F[J];return a(),0===O}function M(){var B=f[0]<f[1]?f[0]<f[2]?0:2:f[1]<f[2]?1:2,u=f[B]-y;for(y=f[B],L[B]+=W[B],f[B]+=X[B],J=0;J<3;J++)D[J]+=u*C[J],q[J]=o(D[J],W[J]);return B}function j(B,u){return x(B-u*v)}function o(B,u){return x(B+u*v)}}(B,L,X,f,C,W);if(!q){for(U=0;U<3;U++)x[U]=D[U]>0?C[U]-v.max[U]:f[U]-v.base[U];v.translate(x)}return y}},15244:(B,u,F)=>{"use strict";F.d(u,{b:()=>Q});var Z=F(15050),V=F(13771);class p{constructor(B,u,F,p,G,R,e){this.pY=new Z(B.base,B.xY),this.mV=u,this.friction=F,this.restitution=p,this.zG=G,this.Hv=R,this.MG=!!e,this.CY=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.OD=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.os=V.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=V.create(),this._impulses=V.create(),this._sleepFrameCount=10}loadFromCopy(B){V.k(this.pY.base,B.pY.base),V.k(this.pY.xY,B.pY.xY),V.k(this.pY.max,B.pY.max),this.pY.mag=B.pY.mag,this.mV=B.mV,this.friction=B.friction,this.restitution=B.restitution,this.zG=B.zG,this.Hv=B.Hv,this.MG=B.MG,this.CY=B.CY,this.fluidDrag=B.fluidDrag,this.OD=B.OD,this.preventFallOffEdge=B.preventFallOffEdge,this.rolledBackLastTick=B.rolledBackLastTick,V.k(this.os,B.os),V.k(this.resting,B.resting),this.inFluid=B.inFluid,this._ratioInFluid=B._ratioInFluid,V.k(this._forces,B._forces),V.k(this._impulses,B._impulses),this._sleepFrameCount=B._sleepFrameCount}setPosition(B){G(B),V.Lu(B,B,this.pY.base),this.pY.translate(B),this.Es()}dp(){return V.clone(this.pY.base)}applyForce(B){G(B),V.add(this._forces,this._forces,B),this.Es()}applyImpulse(B){G(B),V.add(this._impulses,this._impulses,B),this.Es()}Es(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var G=B=>{};var R=F(15050),e=F(13771),s=F(15054);function Y(){this.CY=.1,this.fluidDrag=.4,this.EG=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function Q(B,u,F){B=Object.assign(new Y,B),this.gravity=B.gravity||[0,-10,0],this.CY=B.CY||.1,this.EG=B.EG||2,this.fluidDrag=B.fluidDrag||.4,this.minBounceImpulse=B.minBounceImpulse,this.bodies=[],this.Rv=B.Rv,this.testSolid=u,this.testFluid=F}Q.prototype.iv=function(B,u,F,Z,V,G){B=B||new R([0,0,0],[1,1,1]),"undefined"==typeof u&&(u=1),"undefined"==typeof F&&(F=1),"undefined"==typeof Z&&(Z=0),"undefined"==typeof V&&(V=1);var e=new p(B,u,F,Z,V,G);return this.bodies.push(e),e},Q.prototype.rv=function(B){var u=this.bodies.indexOf(B);u<0||(this.bodies.splice(u,1),B.pY=B.Hv=null)};var t=e.create(),v=e.create(),D=e.create(),L=e.create(),q=e.create(),W=e.create(),X=e.create(),f=new R([0,0,0],[1,1,1]),C=new p(f,1,1,0,1,(()=>{}),!1);function x(B,u,F){return u=F,u*=1-(1-B.ratioInFluid)**2}Q.prototype.FR=function(B){B/=1e3;var u=H(0,e.squaredLength(this.gravity));this.bodies.forEach((F=>function(B,u,F,Z){e.k(q,u.resting),B.Rv&&C.loadFromCopy(u);if(u.mV<=0)return e.set(u.os,0,0,0),e.set(u._forces,0,0,0),void e.set(u._impulses,0,0,0);var V=Z||0===u.zG;if(function(B,u,F,Z){if(u._sleepFrameCount>0)return!1;if(Z)return!0;var V=!1,p=.5*F*F*u.zG;return e.scale(w,B.gravity,p),s(B.testSolid,u.pY,w,(function(){return V=!0,!0}),!0),V}(B,u,F,V))return;u._sleepFrameCount--,function(B,u){var F=u.pY,Z=Math.floor(F.base[0]),V=Math.floor(F.base[2]),p=Math.floor(F.base[1]),G=Math.floor(F.max[1]);if(!B.testFluid(Z,p,V))return u.inFluid=!1,void(u.ratioInFluid=0);var R=1,s=p+1;for(;s<=G&&B.testFluid(Z,s,V);)R++,s++;var Y=(p+R-F.base[1])/F.xY[1];Y>1&&(Y=1);var Q=F.xY[0]*F.xY[1]*F.xY[2]*Y,t=y;e.scale(t,B.gravity,-B.EG*Q*u.zG),u.applyForce(t),u.inFluid=!0,u.ratioInFluid=Y}(B,u),d(u._forces),d(u._impulses),d(u.os),d(u.resting),e.scale(t,u._forces,1/u.mV),e.KG(t,t,B.gravity,u.zG),e.scale(v,u._impulses,1/u.mV),e.KG(v,v,t,F),e.add(u.os,u.os,v),u.friction&&(O(B,0,u,v,F),O(B,1,u,v,F),O(B,2,u,v,F));var p=u.fluidDrag>=0?u.fluidDrag:B.fluidDrag,G=u.CY>=0?u.CY:B.CY,R=G,Y=G;u.inFluid&&(R=x(u,R,u.fluidDragHoriz>=0?u.fluidDragHoriz:p),Y=x(u,Y,u.fluidDragVert>=0?u.fluidDragVert:p));R=Math.max(1-R*F/u.mV,0),Y=Math.max(1-Y*F/u.mV,0),e.set(U,R,Y,R),e.multiply(u.os,u.os,U),e.scale(D,u.os,F),e.set(u._forces,0,0,0),e.set(u._impulses,0,0,0),u.MG&&n(a,u.pY);e.k(W,D),e.set(X,0,0,0),u.preventFallOffEdge&&function(B,u,F,Z){if(!u.resting[1]||F[1]>0)return;var V=I;n(V,u.pY);for(var p=0;p<3;p+=2){e.set(o,0,0,0),o[p]=F[p];var G=!0;(G=(G=(G=(G=G&&!E(B,V.base[0]+o[0]+1e-5,V.base[1],V.base[2]+o[2]+1e-5))&&!E(B,V.max[0]+o[0]-1e-5,V.base[1],V.base[2]+o[2]+1e-5))&&!E(B,V.base[0]+o[0]+1e-5,V.base[1],V.max[2]+o[2]-1e-5))&&!E(B,V.max[0]+o[0]-1e-5,V.base[1],V.max[2]+o[2]-1e-5))?(Z[p]=F[p]>0?1:-1,F[p]=0):0===p&&(e.set(mB,F[0],0,0),J(B,V,mB,Z,u.slideOnCollision))}}(B,u,D,X);J(B,u.pY,D,u.resting,u.slideOnCollision),u.MG&&function(B,u,F,Z){if(u.resting[1]>=0&&!u.inFluid)return;var V=0!==u.resting[0],p=0!==u.resting[2];if(!V&&!p)return;var G=Math.abs(Z[0]/Z[2]),R=4;if(!V&&G>R)return;if(!p&&G<1/R)return;e.add(z,F.base,Z);var Y=B.testSolid;s(Y,F,Z,(function(B,u,F,Z){if(1!==u)return!0;Z[u]=0}));var Q=F.base[1],t=u.inFluid?1.951:1.001,v=Math.floor(Q+t)-Q;e.set(M,0,v,0);var D=!1;if(s(Y,F,M,(function(B,u,F,Z){return D=!0,!0})),D)return;e.Lu(j,z,F.base),j[1]=0,J(B,F,j,T,!0);var L=H(F.base[0],z[0]),q=H(F.base[2],z[2]);if(V&&!L&&(!q||!p))return;if(p&&(!L||!V)&&!q)return;var W=!0;if(W=W&&!E(B,F.base[0]+1e-5,F.base[1],F.base[2]+1e-5),W=W&&!E(B,F.max[0]-1e-5,F.base[1],F.base[2]+1e-5),W=W&&!E(B,F.base[0]+1e-5,F.base[1],F.max[2]-1e-5),W=W&&!E(B,F.max[0]-1e-5,F.base[1],F.max[2]-1e-5),W)return;n(u.pY,F),u.resting[0]=T[0],u.resting[2]=T[2],u.OD&&u.OD()}(B,u,a,W);for(var Q=0;Q<3;++Q)u.resting[Q]=u.resting[Q]||X[Q],L[Q]=0,u.resting[Q]&&(q[Q]||(L[Q]=-u.os[Q]),u.os[Q]=0);var f=e.length(L);f>.001&&(e.scale(L,L,u.mV),u.Hv&&u.Hv(L),u.restitution>0&&f>B.minBounceImpulse&&(e.scale(L,L,u.restitution),u.applyImpulse(L)));var g=e.squaredLength(u.os);g>1e-5&&u.Es();B.Rv&&B.Rv(u)?(u.loadFromCopy(C),u.rolledBackLastTick=!0):u.rolledBackLastTick=!1}(this,F,B,u)))};var U=e.create([0,0,0]);var y=e.create();function O(B,u,F,Z,V){var p=F.resting[u],G=Z[u];if(!F.alwaysApplyHorizFriction||1!==u){if(0===p)return;if(p*G<=0)return}e.k(g,F.os),g[u]=0;var R=e.length(g);if(!H(R,0)){var s=Math.abs(F.friction*B.gravity[u]*V),Y=R>s?(R-s)/R:0;F.os[(u+1)%3]*=Y,F.os[(u+2)%3]*=Y}}var g=e.create();function J(B,u,F,Z,V){return e.set(Z,0,0,0),s(B.testSolid,u,F,(function(B,u,F,p){Z[u]=F,p[u]=0,V||(p[0]=0,p[1]=0,p[2]=0)}))}var a=new R([],[]),T=e.create(),z=e.create(),M=e.create(),j=e.create();var o=e.create(),I=new R([],[]),mB=e.create();function E(B,u,F,Z){return B.testSolid(Math.floor(u),Math.floor(F-1),Math.floor(Z))}var w=e.create();function H(B,u){return Math.abs(B-u)<1e-5}function n(B,u){for(var F=0;F<3;F++)B.base[F]=u.base[F],B.max[F]=u.max[F],B.xY[F]=u.xY[F]}var d=function(B){}},13647:function(B,u){!function(B){"use strict";var u=function(B,F){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(B,u){B.__proto__=u}||function(B,u){for(var F in u)Object.prototype.hasOwnProperty.call(u,F)&&(B[F]=u[F])},u(B,F)};function F(B,F){if("function"!==typeof F&&null!==F)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");function Z(){this.constructor=B}u(B,F),B.prototype=null===F?Object.create(F):(Z.prototype=F.prototype,new Z)}function Z(B,u,F,Z){var V,p=arguments.length,G=p<3?u:null===Z?Z=Object.getOwnPropertyDescriptor(u,F):Z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)G=Reflect.decorate(B,u,F,Z);else for(var R=B.length-1;R>=0;R--)(V=B[R])&&(G=(p<3?V(G):p>3?V(u,F,G):V(u,F))||G);return p>3&&G&&Object.defineProperty(u,F,G),G}function V(B,u,F){if(F||2===arguments.length)for(var Z,V=0,p=u.length;V<p;V++)!Z&&V in u||(Z||(Z=Array.prototype.slice.call(u,0,V)),Z[V]=u[V]);return B.concat(Z||Array.prototype.slice.call(u))}var p,G=255,R=213;B.OPERATION=void 0,(p=B.OPERATION||(B.OPERATION={}))[p.ADD=128]="ADD",p[p.REPLACE=0]="REPLACE",p[p.DELETE=64]="DELETE",p[p.DELETE_AND_ADD=192]="DELETE_AND_ADD",p[p.TOUCH=1]="TOUCH",p[p.CLEAR=10]="CLEAR";var e=function(){function u(B,u,F){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=B,this.setParent(u,F)}return u.prototype.setParent=function(B,u,F){var Z=this;if(this.indexes||(this.indexes=this.ref instanceof jB?this.ref._definition.indexes:{}),this.parent=B,this.parentIndex=F,u)if(this.root=u,this.ref instanceof jB){var V=this.ref._definition;for(var p in V.schema){var G=this.ref[p];if(G&&G.$changes){var R=V.indexes[p];G.$changes.setParent(this.ref,u,R)}}}else"object"===typeof this.ref&&this.ref.forEach((function(B,u){if(B instanceof jB){var F=B.$changes,V=Z.ref.$changes.indexes[u];F.setParent(Z.ref,Z.root,V)}}))},u.prototype.operation=function(B){this.changes.set(--this.currentCustomOperation,B)},u.prototype.change=function(u,F){void 0===F&&(F=B.OPERATION.ADD);var Z="number"===typeof u?u:this.indexes[u];this.assertValidIndex(Z,u);var V=this.changes.get(Z);V&&V.op!==B.OPERATION.DELETE&&V.op!==B.OPERATION.TOUCH||this.changes.set(Z,{op:V&&V.op===B.OPERATION.DELETE?B.OPERATION.DELETE_AND_ADD:F,index:Z}),this.allChanges.add(Z),this.changed=!0,this.touchParents()},u.prototype.touch=function(u){var F="number"===typeof u?u:this.indexes[u];this.assertValidIndex(F,u),this.changes.has(F)||this.changes.set(F,{op:B.OPERATION.TOUCH,index:F}),this.allChanges.add(F),this.touchParents()},u.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},u.prototype.getType=function(B){if(this.ref._definition)return(u=this.ref._definition).schema[u.fieldsByIndex[B]];var u,F=(u=this.parent._definition).schema[u.fieldsByIndex[this.parentIndex]];return Object.values(F)[0]},u.prototype.getChildrenFilter=function(){var B=this.parent._definition.childFilters;return B&&B[this.parentIndex]},u.prototype.getValue=function(B){return this.ref.getByIndex(B)},u.prototype.delete=function(u){var F="number"===typeof u?u:this.indexes[u];if(void 0!==F){var Z=this.getValue(F);this.changes.set(F,{op:B.OPERATION.DELETE,index:F}),this.allChanges.delete(F),delete this.caches[F],Z&&Z.$changes&&(Z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(u," (").concat(F,")"))},u.prototype.discard=function(u,F){var Z=this;void 0===u&&(u=!1),void 0===F&&(F=!1),this.ref instanceof jB||this.changes.forEach((function(u){if(u.op===B.OPERATION.DELETE){var F=Z.ref.getIndex(u.index);delete Z.indexes[F]}})),this.changes.clear(),this.changed=u,F&&this.allChanges.clear(),this.currentCustomOperation=0},u.prototype.discardAll=function(){var B=this;this.changes.forEach((function(u){var F=B.getValue(u.index);F&&F.$changes&&F.$changes.discardAll()})),this.discard()},u.prototype.cache=function(B,u){this.caches[B]=u},u.prototype.clone=function(){return new u(this.ref,this.parent,this.root)},u.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},u.prototype.assertValidIndex=function(B,u){if(void 0===B)throw new Error('ChangeTree: missing index for field "'.concat(u,'"'))},u}();function s(B,u,F,Z){return B[u]||(B[u]=[]),B[u].push(F),null===Z||void 0===Z||Z.forEach((function(B,u){return F(B,u)})),function(){return Q(B[u],B[u].indexOf(F))}}function Y(u){var F=this,Z="string"!==typeof this.$changes.getType();this.$items.forEach((function(V,p){u.push({refId:F.$changes.refId,op:B.OPERATION.DELETE,field:p,value:void 0,previousValue:V}),Z&&F.$changes.root.removeRef(V.$changes.refId)}))}function Q(B,u){if(-1===u||u>=B.length)return!1;for(var F=B.length-1,Z=u;Z<F;Z++)B[Z]=B[Z+1];return B.length=F,!0}var t=function(B,u){var F=B.toString(),Z=u.toString();return F<Z?-1:F>Z?1:0};function v(B){return B.$proxy=!0,B=new Proxy(B,{get:function(B,u){return"symbol"===typeof u||isNaN(u)?B[u]:B.at(u)},set:function(B,u,F){if("symbol"===typeof u||isNaN(u))B[u]=F;else{var Z=Array.from(B.$items.keys()),V=parseInt(Z[u]||u);void 0===F||null===F?B.deleteAt(V):B.setAt(V,F)}return!0},deleteProperty:function(B,u){return"number"===typeof u?B.deleteAt(u):delete B[u],!0}})}var D=function(){function u(){for(var B=[],u=0;u<arguments.length;u++)B[u]=arguments[u];this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,B)}return u.prototype.ER=function(u,F){return void 0===F&&(F=!0),s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,u,F?this.$items:void 0)},u.prototype.IV=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,u)},u.is=function(B){return Array.isArray(B)||void 0!==B.array},Object.defineProperty(u.prototype,"length",{get:function(){return this.$items.size},set:function(B){0===B?this.clear():this.splice(B,this.length-B)},enumerable:!1,configurable:!0}),u.prototype.push=function(){for(var B,u=this,F=[],Z=0;Z<arguments.length;Z++)F[Z]=arguments[Z];return F.forEach((function(F){B=u.$refId++,u.setAt(B,F)})),B},u.prototype.pop=function(){var B=Array.from(this.$indexes.values()).pop();if(void 0!==B){this.$changes.delete(B),this.$indexes.delete(B);var u=this.$items.get(B);return this.$items.delete(B),u}},u.prototype.at=function(B){var u=Array.from(this.$items.keys())[B];return this.$items.get(u)},u.prototype.setAt=function(u,F){var Z,V;if(void 0!==F&&null!==F){if(this.$items.get(u)!==F){void 0!==F.$changes&&F.$changes.setParent(this,this.$changes.root,u);var p=null!==(V=null===(Z=this.$changes.indexes[u])||void 0===Z?void 0:Z.op)&&void 0!==V?V:B.OPERATION.ADD;this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,F),this.$changes.change(u,p)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},u.prototype.deleteAt=function(B){var u=Array.from(this.$items.keys())[B];return void 0!==u&&this.$deleteAt(u)},u.prototype.$deleteAt=function(B){return this.$changes.delete(B),this.$indexes.delete(B),this.$items.delete(B)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&Y.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.concat=function(){for(var B,F=[],Z=0;Z<arguments.length;Z++)F[Z]=arguments[Z];return new(u.bind.apply(u,V([void 0],(B=Array.from(this.$items.values())).concat.apply(B,F),!1)))},u.prototype.join=function(B){return Array.from(this.$items.values()).join(B)},u.prototype.reverse=function(){var B=this,u=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(F,Z){B.setAt(u[Z],F)})),this},u.prototype.shift=function(){var B=Array.from(this.$items.keys()).shift();if(void 0!==B){var u=this.$items.get(B);return this.$deleteAt(B),u}},u.prototype.slice=function(B,F){var Z=new u;return Z.push.apply(Z,Array.from(this.$items.values()).slice(B,F)),Z},u.prototype.sort=function(B){var u=this;void 0===B&&(B=t);var F=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(B).forEach((function(B,Z){u.setAt(F[Z],B)})),this},u.prototype.splice=function(B,u){void 0===u&&(u=this.length-B);for(var F=Array.from(this.$items.keys()),Z=[],V=B;V<B+u;V++)Z.push(this.$items.get(F[V])),this.$deleteAt(F[V]);return Z},u.prototype.unshift=function(){for(var B=this,u=[],F=0;F<arguments.length;F++)u[F]=arguments[F];var Z=this.length,V=u.length,p=Array.from(this.$items.values());return u.forEach((function(u,F){B.setAt(F,u)})),p.forEach((function(u,F){B.setAt(V+F,u)})),Z+V},u.prototype.indexOf=function(B,u){return Array.from(this.$items.values()).indexOf(B,u)},u.prototype.lastIndexOf=function(B,u){return void 0===u&&(u=this.length-1),Array.from(this.$items.values()).lastIndexOf(B,u)},u.prototype.every=function(B,u){return Array.from(this.$items.values()).every(B,u)},u.prototype.some=function(B,u){return Array.from(this.$items.values()).some(B,u)},u.prototype.forEach=function(B,u){Array.from(this.$items.values()).forEach(B,u)},u.prototype.map=function(B,u){return Array.from(this.$items.values()).map(B,u)},u.prototype.filter=function(B,u){return Array.from(this.$items.values()).filter(B,u)},u.prototype.reduce=function(B,u){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},u.prototype.reduceRight=function(B,u){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},u.prototype.find=function(B,u){return Array.from(this.$items.values()).find(B,u)},u.prototype.findIndex=function(B,u){return Array.from(this.$items.values()).findIndex(B,u)},u.prototype.fill=function(B,u,F){throw new Error("ArraySchema#fill() not implemented")},u.prototype.copyWithin=function(B,u,F){throw new Error("ArraySchema#copyWithin() not implemented")},u.prototype.toString=function(){return this.$items.toString()},u.prototype.toLocaleString=function(){return this.$items.toLocaleString()},u.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},u.prototype.includes=function(B,u){return Array.from(this.$items.values()).includes(B,u)},u.prototype.flatMap=function(B,u){throw new Error("ArraySchema#flatMap() is not supported.")},u.prototype.flat=function(B){throw new Error("ArraySchema#flat() is not supported.")},u.prototype.findLast=function(){var B=Array.from(this.$items.values());return B.findLast.apply(B,arguments)},u.prototype.findLastIndex=function(){var B=Array.from(this.$items.values());return B.findLastIndex.apply(B,arguments)},u.prototype.setIndex=function(B,u){this.$indexes.set(B,u)},u.prototype.getIndex=function(B){return this.$indexes.get(B)},u.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},u.prototype.deleteByIndex=function(B){var u=this.$indexes.get(B);this.$items.delete(u),this.$indexes.delete(B)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){return this.toArray().map((function(B){return"function"===typeof B.toJSON?B.toJSON():B}))},u.prototype.clone=function(B){return B?new(u.bind.apply(u,V([void 0],Array.from(this.$items.values()),!1))):new(u.bind.apply(u,V([void 0],this.map((function(B){return B.$changes?B.clone():B})),!1)))},u}();function L(B){return B.$proxy=!0,B=new Proxy(B,{get:function(B,u){return"symbol"!==typeof u&&"undefined"===typeof B[u]?B.get(u):B[u]},set:function(B,u,F){return"symbol"!==typeof u&&-1===u.indexOf("$")&&"ER"!==u&&"IV"!==u&&"onChange"!==u?B.set(u,F):B[u]=F,!0},deleteProperty:function(B,u){return B.delete(u),!0}})}var q=function(){function u(B){var F=this;if(this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B)if(B instanceof Map||B instanceof u)B.forEach((function(B,u){return F.set(u,B)}));else for(var Z in B)this.set(Z,B[Z])}return u.prototype.ER=function(u,F){return void 0===F&&(F=!0),s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,u,F?this.$items:void 0)},u.prototype.IV=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,u)},u.is=function(B){return void 0!==B.map},u.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(u.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(u,Symbol.species,{get:function(){return u},enumerable:!1,configurable:!0}),u.prototype.set=function(u,F){if(void 0===F||null===F)throw new Error("MapSchema#set('".concat(u,"', ").concat(F,"): trying to set ").concat(F," value on '").concat(u,"'."));u=u.toString();var Z="undefined"!==typeof this.$changes.indexes[u],V=Z?this.$changes.indexes[u]:this.$refId++,p=Z?B.OPERATION.REPLACE:B.OPERATION.ADD,G=void 0!==F.$changes;if(G&&F.$changes.setParent(this,this.$changes.root,V),Z){if(!G&&this.$items.get(u)===F)return;G&&this.$items.get(u)!==F&&(p=B.OPERATION.ADD)}else this.$changes.indexes[u]=V,this.$indexes.set(V,u);return this.$items.set(u,F),this.$changes.change(u,p),this},u.prototype.get=function(B){return this.$items.get(B)},u.prototype.delete=function(B){return this.$changes.delete(B),this.$items.delete(B)},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&Y.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(B){return this.$items.has(B)},u.prototype.forEach=function(B){this.$items.forEach(B)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.keys=function(){return this.$items.keys()},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(B,u){this.$indexes.set(B,u)},u.prototype.getIndex=function(B){return this.$indexes.get(B)},u.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},u.prototype.deleteByIndex=function(B){var u=this.$indexes.get(B);this.$items.delete(u),this.$indexes.delete(B)},u.prototype.toJSON=function(){var B={};return this.forEach((function(u,F){B[F]="function"===typeof u.toJSON?u.toJSON():u})),B},u.prototype.clone=function(B){var F;return B?F=Object.assign(new u,this):(F=new u,this.forEach((function(B,u){B.$changes?F.set(u,B.clone()):F.set(u,B)}))),F},u}(),W={};function X(B,u){W[B]=u}function f(B){return W[B]}var C=function(){function B(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return B.create=function(u){var F=new B;return F.schema=Object.assign({},u&&u.schema||{}),F.indexes=Object.assign({},u&&u.indexes||{}),F.fieldsByIndex=Object.assign({},u&&u.fieldsByIndex||{}),F.descriptors=Object.assign({},u&&u.descriptors||{}),F.deprecated=Object.assign({},u&&u.deprecated||{}),F},B.prototype.addField=function(B,u){var F=this.getNextFieldIndex();this.fieldsByIndex[F]=B,this.indexes[B]=F,this.schema[B]=Array.isArray(u)?{array:u[0]}:u},B.prototype.hasField=function(B){return void 0!==this.indexes[B]},B.prototype.addFilter=function(B,u){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[B]]=u,this.indexesWithFilters.push(this.indexes[B]),!0},B.prototype.addChildrenFilter=function(B,u){var F=this.indexes[B],Z=this.schema[B];if(f(Object.keys(Z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[F]=u,!0;console.warn("@filterChildren: field '".concat(B,"' can't have children. Ignoring filter."))},B.prototype.getChildrenFilter=function(B){return this.childFilters&&this.childFilters[this.indexes[B]]},B.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},B}();function x(B){return B._context&&B._context.useFilters}var U=function(){function B(){this.types={},this.schemas=new Map,this.useFilters=!1}return B.prototype.has=function(B){return this.schemas.has(B)},B.prototype.get=function(B){return this.types[B]},B.prototype.add=function(B,u){void 0===u&&(u=this.schemas.size),B._definition=C.create(B._definition),B._typeid=u,this.types[u]=B,this.schemas.set(B,u)},B.create=function(u){return void 0===u&&(u={}),function(F){return u.context||(u.context=new B),O(F,u)}},B}(),y=new U;function O(B,u){return void 0===u&&(u={}),function(F,Z){var p=u.context||y,G=F.constructor;if(G._context=p,!B)throw new Error("".concat(G.name,': @type() reference provided for "').concat(Z,"\" is undefined. Make sure you don't have any circular dependencies."));p.has(G)||p.add(G);var R=G._definition;if(R.addField(Z,B),R.descriptors[Z]){if(R.deprecated[Z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(Z,"' definition on '").concat(G.name,"'.\nCheck @type() annotation"))}catch(W){var e=W.stack.split("\n")[4].trim();throw new Error("".concat(W.message," ").concat(e))}}var s=D.is(B),Y=!s&&q.is(B);if("string"!==typeof B&&!jB.is(B)){var Q=Object.values(B)[0];"string"===typeof Q||p.has(Q)||p.add(Q)}if(u.manual)R.descriptors[Z]={enumerable:!0,configurable:!0,writable:!0};else{var t="_".concat(Z);R.descriptors[t]={enumerable:!1,configurable:!1,writable:!0},R.descriptors[Z]={get:function(){return this[t]},set:function(B){B!==this[t]&&(void 0!==B&&null!==B?(!s||B instanceof D||(B=new(D.bind.apply(D,V([void 0],B,!1)))),!Y||B instanceof q||(B=new q(B)),void 0===B.$proxy&&(Y?B=L(B):s&&(B=v(B))),this.$changes.change(Z),B.$changes&&B.$changes.setParent(this,this.$changes.root,this._definition.indexes[Z])):this[t]&&this.$changes.delete(Z),this[t]=B)},enumerable:!0,configurable:!0}}}}function g(B){return function(u,F){var Z=u.constructor;Z._definition.addFilter(F,B)&&(Z._context.useFilters=!0)}}function J(B){return function(u,F){var Z=u.constructor;Z._definition.addChildrenFilter(F,B)&&(Z._context.useFilters=!0)}}function a(B){return void 0===B&&(B=!0),function(u,F){var Z=u.constructor._definition;Z.deprecated[F]=!0,B&&(Z.descriptors[F]={get:function(){throw new Error("".concat(F," is deprecated."))},set:function(B){},enumerable:!1,configurable:!0})}}function T(B,u,F){for(var Z in void 0===F&&(F={}),F.context||(F.context=B._context||F.context||y),u)O(u[Z],F)(B.prototype,Z);return B}function z(B){for(var u=0,F=0,Z=0,V=B.length;Z<V;Z++)(u=B.charCodeAt(Z))<128?F+=1:u<2048?F+=2:u<55296||u>=57344?F+=3:(Z++,F+=4);return F}function M(B,u,F){for(var Z=0,V=0,p=F.length;V<p;V++)(Z=F.charCodeAt(V))<128?B[u++]=Z:Z<2048?(B[u++]=192|Z>>6,B[u++]=128|63&Z):Z<55296||Z>=57344?(B[u++]=224|Z>>12,B[u++]=128|Z>>6&63,B[u++]=128|63&Z):(V++,Z=65536+((1023&Z)<<10|1023&F.charCodeAt(V)),B[u++]=240|Z>>18,B[u++]=128|Z>>12&63,B[u++]=128|Z>>6&63,B[u++]=128|63&Z)}function j(B,u){B.push(255&u)}function o(B,u){B.push(255&u)}function I(B,u){B.push(255&u),B.push(u>>8&255)}function mB(B,u){B.push(255&u),B.push(u>>8&255)}function E(B,u){B.push(255&u),B.push(u>>8&255),B.push(u>>16&255),B.push(u>>24&255)}function w(B,u){var F=u>>24,Z=u>>16,V=u>>8,p=u;B.push(255&p),B.push(255&V),B.push(255&Z),B.push(255&F)}function H(B,u){var F=Math.floor(u/Math.pow(2,32));w(B,u>>>0),w(B,F)}function n(B,u){var F=u/Math.pow(2,32)|0;w(B,u>>>0),w(B,F)}function d(B,u){i(B,u)}function l(B,u){r(B,u)}var P=new Int32Array(2),c=new Float32Array(P.buffer),h=new Float64Array(P.buffer);function i(B,u){c[0]=u,E(B,P[0])}function r(B,u){h[0]=u,E(B,P[0]),E(B,P[1])}function K(B,u){return o(B,u?1:0)}function N(B,u){u||(u="");var F=z(u),Z=0;if(F<32)B.push(160|F),Z=1;else if(F<256)B.push(217),o(B,F),Z=2;else if(F<65536)B.push(218),mB(B,F),Z=3;else{if(!(F<4294967296))throw new Error("String too long");B.push(219),w(B,F),Z=5}return M(B,B.length,u),Z+F}function A(B,u){return isNaN(u)?A(B,0):isFinite(u)?u!==(0|u)?(B.push(203),r(B,u),9):u>=0?u<128?(o(B,u),1):u<256?(B.push(204),o(B,u),2):u<65536?(B.push(205),mB(B,u),3):u<4294967296?(B.push(206),w(B,u),5):(B.push(207),n(B,u),9):u>=-32?(B.push(224|u+32),1):u>=-128?(B.push(208),j(B,u),2):u>=-32768?(B.push(209),I(B,u),3):u>=-2147483648?(B.push(210),E(B,u),5):(B.push(211),H(B,u),9):A(B,u>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var b=Object.freeze({__proto__:null,utf8Write:M,int8:j,uint8:o,int16:I,uint16:mB,int32:E,uint32:w,int64:H,uint64:n,float32:d,float64:l,writeFloat32:i,writeFloat64:r,boolean:K,string:N,number:A});function k(B,u,F){for(var Z="",V=0,p=u,G=u+F;p<G;p++){var R=B[p];0!==(128&R)?192!==(224&R)?224!==(240&R)?240!==(248&R)?console.error("Invalid byte "+R.toString(16)):(V=(7&R)<<18|(63&B[++p])<<12|(63&B[++p])<<6|63&B[++p])>=65536?(V-=65536,Z+=String.fromCharCode(55296+(V>>>10),56320+(1023&V))):Z+=String.fromCharCode(V):Z+=String.fromCharCode((15&R)<<12|(63&B[++p])<<6|63&B[++p]):Z+=String.fromCharCode((31&R)<<6|63&B[++p]):Z+=String.fromCharCode(R)}return Z}function S(B,u){return BB(B,u)<<24>>24}function BB(B,u){return B[u.offset++]}function uB(B,u){return FB(B,u)<<16>>16}function FB(B,u){return B[u.offset++]|B[u.offset++]<<8}function ZB(B,u){return B[u.offset++]|B[u.offset++]<<8|B[u.offset++]<<16|B[u.offset++]<<24}function VB(B,u){return ZB(B,u)>>>0}function pB(B,u){return tB(B,u)}function GB(B,u){return vB(B,u)}function RB(B,u){var F=VB(B,u);return ZB(B,u)*Math.pow(2,32)+F}function eB(B,u){var F=VB(B,u);return VB(B,u)*Math.pow(2,32)+F}var sB=new Int32Array(2),YB=new Float32Array(sB.buffer),QB=new Float64Array(sB.buffer);function tB(B,u){return sB[0]=ZB(B,u),YB[0]}function vB(B,u){return sB[0]=ZB(B,u),sB[1]=ZB(B,u),QB[0]}function DB(B,u){return BB(B,u)>0}function LB(B,u){var F,Z=B[u.offset++];Z<192?F=31&Z:217===Z?F=BB(B,u):218===Z?F=FB(B,u):219===Z&&(F=VB(B,u));var V=k(B,u.offset,F);return u.offset+=F,V}function qB(B,u){var F=B[u.offset];return F<192&&F>160||217===F||218===F||219===F}function WB(B,u){var F=B[u.offset++];return F<128?F:202===F?tB(B,u):203===F?vB(B,u):204===F?BB(B,u):205===F?FB(B,u):206===F?VB(B,u):207===F?eB(B,u):208===F?S(B,u):209===F?uB(B,u):210===F?ZB(B,u):211===F?RB(B,u):F>223?-1*(255-F+1):void 0}function XB(B,u){var F=B[u.offset];return F<128||F>=202&&F<=211}function fB(B,u){return B[u.offset]<160}function CB(B,u){return B[u.offset-1]===G&&(B[u.offset]<128||B[u.offset]>=202&&B[u.offset]<=211)}var xB=Object.freeze({__proto__:null,int8:S,uint8:BB,int16:uB,uint16:FB,int32:ZB,uint32:VB,float32:pB,float64:GB,int64:RB,uint64:eB,readFloat32:tB,readFloat64:vB,boolean:DB,string:LB,stringCheck:qB,number:WB,numberCheck:XB,arrayCheck:fB,switchStructureCheck:CB}),UB=function(){function u(B){var u=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B&&B.forEach((function(B){return u.add(B)}))}return u.prototype.ER=function(u,F){return void 0===F&&(F=!0),s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,u,F?this.$items:void 0)},u.prototype.IV=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,u)},u.is=function(B){return void 0!==B.collection},u.prototype.add=function(B){var u=this.$refId++;return void 0!==B.$changes&&B.$changes.setParent(this,this.$changes.root,u),this.$changes.indexes[u]=u,this.$indexes.set(u,u),this.$items.set(u,B),this.$changes.change(u),u},u.prototype.at=function(B){var u=Array.from(this.$items.keys())[B];return this.$items.get(u)},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(B){for(var u,F,Z=this.$items.entries();(F=Z.next())&&!F.done;)if(B===F.value[1]){u=F.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&Y.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(B){return Array.from(this.$items.values()).some((function(u){return u===B}))},u.prototype.forEach=function(B){var u=this;this.$items.forEach((function(F,Z,V){return B(F,Z,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(B,u){this.$indexes.set(B,u)},u.prototype.getIndex=function(B){return this.$indexes.get(B)},u.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},u.prototype.deleteByIndex=function(B){var u=this.$indexes.get(B);this.$items.delete(u),this.$indexes.delete(B)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var B=[];return this.forEach((function(u,F){B.push("function"===typeof u.toJSON?u.toJSON():u)})),B},u.prototype.clone=function(B){var F;return B?F=Object.assign(new u,this):(F=new u,this.forEach((function(B){B.$changes?F.add(B.clone()):F.add(B)}))),F},u}(),yB=function(){function u(B){var u=this;this.$changes=new e(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,B&&B.forEach((function(B){return u.add(B)}))}return u.prototype.ER=function(u,F){return void 0===F&&(F=!0),s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.ADD,u,F?this.$items:void 0)},u.prototype.IV=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,u)},u.prototype.onChange=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,u)},u.is=function(B){return void 0!==B.set},u.prototype.add=function(u){var F,Z;if(this.has(u))return!1;var V=this.$refId++;void 0!==u.$changes&&u.$changes.setParent(this,this.$changes.root,V);var p=null!==(Z=null===(F=this.$changes.indexes[V])||void 0===F?void 0:F.op)&&void 0!==Z?Z:B.OPERATION.ADD;return this.$changes.indexes[V]=V,this.$indexes.set(V,V),this.$items.set(V,u),this.$changes.change(V,p),V},u.prototype.entries=function(){return this.$items.entries()},u.prototype.delete=function(B){for(var u,F,Z=this.$items.entries();(F=Z.next())&&!F.done;)if(B===F.value[1]){u=F.value[0];break}return void 0!==u&&(this.$changes.delete(u),this.$indexes.delete(u),this.$items.delete(u))},u.prototype.clear=function(u){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),u&&Y.call(this,u),this.$items.clear(),this.$changes.operation({index:0,op:B.OPERATION.CLEAR}),this.$changes.touchParents()},u.prototype.has=function(B){for(var u,F=this.$items.values(),Z=!1;(u=F.next())&&!u.done;)if(B===u.value){Z=!0;break}return Z},u.prototype.forEach=function(B){var u=this;this.$items.forEach((function(F,Z,V){return B(F,Z,u)}))},u.prototype.values=function(){return this.$items.values()},Object.defineProperty(u.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),u.prototype.setIndex=function(B,u){this.$indexes.set(B,u)},u.prototype.getIndex=function(B){return this.$indexes.get(B)},u.prototype.getByIndex=function(B){return this.$items.get(this.$indexes.get(B))},u.prototype.deleteByIndex=function(B){var u=this.$indexes.get(B);this.$items.delete(u),this.$indexes.delete(B)},u.prototype.toArray=function(){return Array.from(this.$items.values())},u.prototype.toJSON=function(){var B=[];return this.forEach((function(u,F){B.push("function"===typeof u.toJSON?u.toJSON():u)})),B},u.prototype.clone=function(B){var F;return B?F=Object.assign(new u,this):(F=new u,this.forEach((function(B){B.$changes?F.add(B.clone()):F.add(B)}))),F},u}(),OB=function(){function B(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return B.prototype.addRefId=function(B){this.refIds.has(B)||(this.refIds.add(B),this.containerIndexes.set(B,new Set))},B.get=function(u){return void 0===u.$filterState&&(u.$filterState=new B),u.$filterState},B}(),gB=function(){function B(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return B.prototype.getNextUniqueId=function(){return this.nextUniqueId++},B.prototype.addRef=function(B,u,F){void 0===F&&(F=!0),this.refs.set(B,u),F&&(this.refCounts[B]=(this.refCounts[B]||0)+1)},B.prototype.removeRef=function(B){this.refCounts[B]=this.refCounts[B]-1,this.deletedRefs.add(B)},B.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},B.prototype.garbageCollectDeletedRefs=function(){var B=this;this.deletedRefs.forEach((function(u){if(!(B.refCounts[u]>0)){var F=B.refs.get(u);if(F instanceof jB)for(var Z in F._definition.schema)"string"!==typeof F._definition.schema[Z]&&F[Z]&&F[Z].$changes&&B.removeRef(F[Z].$changes.refId);else{var V=F.$changes.parent._definition,p=V.schema[V.fieldsByIndex[F.$changes.parentIndex]];"function"===typeof Object.values(p)[0]&&Array.from(F.values()).forEach((function(u){return B.removeRef(u.$changes.refId)}))}B.refs.delete(u),delete B.refCounts[u]}})),this.deletedRefs.clear()},B}(),JB=function(B){function u(){return null!==B&&B.apply(this,arguments)||this}return F(u,B),u}(Error);function aB(B,u,F,Z){var V,p=!1;switch(u){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":V="number",isNaN(B)&&console.log('trying to encode "NaN" in '.concat(F.constructor.name,"#").concat(Z));break;case"string":V="string",p=!0;break;case"boolean":return}if(typeof B!==V&&(!p||p&&null!==B)){var G="'".concat(JSON.stringify(B),"'").concat(B&&B.constructor&&" (".concat(B.constructor.name,")")||"");throw new JB("a '".concat(V,"' was expected, but ").concat(G," was provided in ").concat(F.constructor.name,"#").concat(Z))}}function TB(B,u,F,Z){if(!(B instanceof u))throw new JB("a '".concat(u.name,"' was expected, but '").concat(B.constructor.name,"' was provided in ").concat(F.constructor.name,"#").concat(Z))}function zB(B,u,F,Z,V){aB(F,B,Z,V);var p=b[B];if(!p)throw new JB("a '".concat(B,"' was expected, but ").concat(F," was provided in ").concat(Z.constructor.name,"#").concat(V));p(u,F)}function MB(B,u,F){return xB[B](u,F)}var jB=function(){function u(){for(var B=[],u=0;u<arguments.length;u++)B[u]=arguments[u];Object.defineProperties(this,{$changes:{value:new e(this,void 0,new gB),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var F=this._definition.descriptors;F&&Object.defineProperties(this,F),B[0]&&this.assign(B[0])}return u.onError=function(B){console.error(B)},u.is=function(B){return B._definition&&void 0!==B._definition.schema},u.prototype.onChange=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.REPLACE,u)},u.prototype.IV=function(u){return s(this.$callbacks||(this.$callbacks=[]),B.OPERATION.DELETE,u)},u.prototype.assign=function(B){return Object.assign(this,B),this},Object.defineProperty(u.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),u.prototype.setDirty=function(B,u){this.$changes.change(B,u)},u.prototype.listen=function(B,u,F){var Z=this;return void 0===F&&(F=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[B]||(this.$callbacks[B]=[]),this.$callbacks[B].push(u),F&&void 0!==this[B]&&u(this[B],void 0),function(){return Q(Z.$callbacks[B],Z.$callbacks[B].indexOf(u))}},u.prototype.decode=function(F,Z,V){var p;void 0===Z&&(Z={offset:0}),void 0===V&&(V=this);var R=[],e=this.$changes.root,s=F.length,Y=0;for(e.refs.set(Y,this);Z.offset<s;){var Q=F[Z.offset++];if(Q!=G){var t=V.$changes,v=void 0!==V._definition,L=v?Q>>6<<6:Q;if(L!==B.OPERATION.CLEAR){var W=v?Q%(L||255):WB(F,Z),X=v?V._definition.fieldsByIndex[W]:"",C=t.getType(W),x=void 0,U=void 0,y=void 0;if(v?U=V["_".concat(X)]:(U=V.getByIndex(W),(L&B.OPERATION.ADD)===B.OPERATION.ADD?(y=V instanceof q?LB(F,Z):W,V.setIndex(W,y)):y=V.getIndex(W)),(L&B.OPERATION.DELETE)===B.OPERATION.DELETE&&(L!==B.OPERATION.DELETE_AND_ADD&&V.deleteByIndex(W),U&&U.$changes&&e.removeRef(U.$changes.refId),x=null),void 0!==X){if(L===B.OPERATION.DELETE);else if(u.is(C)){var O=WB(F,Z);if(x=e.refs.get(O),L!==B.OPERATION.REPLACE){var g=this.getSchemaType(F,Z,C);x||((x=this.createTypeInstance(g)).$changes.refId=O,U&&(x.$callbacks=U.$callbacks,U.$changes.refId&&O!==U.$changes.refId&&e.removeRef(U.$changes.refId))),e.addRef(O,x,x!==U)}}else if("string"===typeof C)x=MB(C,F,Z);else{var J=f(Object.keys(C)[0]),a=WB(F,Z),T=e.refs.has(a)?U||e.refs.get(a):new J.constructor;if((x=T.clone(!0)).$changes.refId=a,U&&(x.$callbacks=U.$callbacks,U.$changes.refId&&a!==U.$changes.refId)){e.removeRef(U.$changes.refId);for(var z=U.entries(),M=void 0;(M=z.next())&&!M.done;){var j=(p=M.value)[0],o=p[1];R.push({refId:a,op:B.OPERATION.DELETE,field:j,value:void 0,previousValue:o})}}e.addRef(a,x,T!==U)}if(null!==x&&void 0!==x)if(x.$changes&&x.$changes.setParent(t.ref,t.root,W),V instanceof u)V[X]=x;else if(V instanceof q)j=y,V.$items.set(j,x),V.$changes.allChanges.add(W);else if(V instanceof D)V.setAt(W,x);else if(V instanceof UB){var I=V.add(x);V.setIndex(W,I)}else V instanceof yB&&!1!==(I=V.add(x))&&V.setIndex(W,I);U!==x&&R.push({refId:Y,op:L,field:X,dynamicIndex:y,value:x,previousValue:U})}else{console.warn("@colyseus/schema: definition mismatch");for(var mB={offset:Z.offset};Z.offset<s&&(!CB(F,Z)||(mB.offset=Z.offset+1,!e.refs.has(WB(F,mB))));)Z.offset++}}else V.clear(R)}else{Y=WB(F,Z);var E=e.refs.get(Y);if(!E)throw new Error('"refId" not found: '.concat(Y));V=E}}return this._triggerChanges(R),e.garbageCollectDeletedRefs(),R},u.prototype.encode=function(F,Z,V){void 0===F&&(F=!1),void 0===Z&&(Z=[]),void 0===V&&(V=!1);for(var p=this.$changes,R=new WeakSet,e=[p],s=1,Y=0;Y<s;Y++){var Q=e[Y],t=Q.ref,v=t instanceof u;Q.ensureRefId(),R.add(Q),Q!==p&&(Q.changed||F)&&(o(Z,G),A(Z,Q.refId));for(var D=F?Array.from(Q.allChanges):Array.from(Q.changes.values()),L=0,W=D.length;L<W;L++){var X=F?{op:B.OPERATION.ADD,index:D[L]}:D[L],C=X.index,x=v?t._definition.fieldsByIndex&&t._definition.fieldsByIndex[C]:C,U=Z.length;if(X.op!==B.OPERATION.TOUCH)if(v)o(Z,C|X.op);else{if(o(Z,X.op),X.op===B.OPERATION.CLEAR)continue;A(Z,C)}if(v||(X.op&B.OPERATION.ADD)!=B.OPERATION.ADD||t instanceof q&&N(Z,Q.ref.$indexes.get(C)),X.op!==B.OPERATION.DELETE){var y=Q.getType(C),O=Q.getValue(C);if(O&&O.$changes&&!R.has(O.$changes)&&(e.push(O.$changes),O.$changes.ensureRefId(),s++),X.op!==B.OPERATION.TOUCH){if(u.is(y))TB(O,y,t,x),A(Z,O.$changes.refId),(X.op&B.OPERATION.ADD)===B.OPERATION.ADD&&this.tryEncodeTypeId(Z,y,O.constructor);else if("string"===typeof y)zB(y,Z,O,t,x);else{var g=f(Object.keys(y)[0]);TB(t["_".concat(x)],g.constructor,t,x),A(Z,O.$changes.refId)}V&&Q.cache(C,Z.slice(U))}}}F||V||Q.discard()}return Z},u.prototype.encodeAll=function(B){return this.encode(!0,[],B)},u.prototype.applyFilters=function(F,Z){var V,p;void 0===Z&&(Z=!1);for(var R=this,e=new Set,s=OB.get(F),Y=[this.$changes],Q=1,t=[],v=function(v){var D=Y[v];if(e.has(D.refId))return"continue";var L=D.ref,W=L instanceof u;o(t,G),A(t,D.refId);var X=s.refIds.has(D),f=Z||!X;s.addRefId(D);var C=s.containerIndexes.get(D),x=f?Array.from(D.allChanges):Array.from(D.changes.values());!Z&&W&&L._definition.indexesWithFilters&&L._definition.indexesWithFilters.forEach((function(u){!C.has(u)&&D.allChanges.has(u)&&(f?x.push(u):x.push({op:B.OPERATION.ADD,index:u}))}));for(var U=0,y=x.length;U<y;U++){var O=f?{op:B.OPERATION.ADD,index:x[U]}:x[U];if(O.op!==B.OPERATION.CLEAR){var g=O.index;if(O.op!==B.OPERATION.DELETE){var J=D.getValue(g),a=D.getType(g);if(W){if((T=L._definition.filters&&L._definition.filters[g])&&!T.call(L,F,J,R)){J&&J.$changes&&e.add(J.$changes.refId);continue}}else{var T,z=D.parent;if((T=D.getChildrenFilter())&&!T.call(z,F,L.$indexes.get(g),J,R)){J&&J.$changes&&e.add(J.$changes.refId);continue}}if(J.$changes&&(Y.push(J.$changes),Q++),O.op!==B.OPERATION.TOUCH)if(O.op===B.OPERATION.ADD||W)t.push.apply(t,null!==(V=D.caches[g])&&void 0!==V?V:[]),C.add(g);else if(C.has(g))t.push.apply(t,null!==(p=D.caches[g])&&void 0!==p?p:[]);else{if(C.add(g),o(t,B.OPERATION.ADD),A(t,g),L instanceof q){var M=D.ref.$indexes.get(g);N(t,M)}J.$changes?A(t,J.$changes.refId):b[a](t,J)}else J.$changes&&!W&&(o(t,B.OPERATION.ADD),A(t,g),L instanceof q&&(M=D.ref.$indexes.get(g),N(t,M)),A(t,J.$changes.refId))}else W?o(t,O.op|g):(o(t,O.op),A(t,g))}else o(t,O.op)}},D=0;D<Q;D++)v(D);return t},u.prototype.clone=function(){var B,u=new this.constructor,F=this._definition.schema;for(var Z in F)"object"===typeof this[Z]&&"function"===typeof(null===(B=this[Z])||void 0===B?void 0:B.clone)?u[Z]=this[Z].clone():u[Z]=this[Z];return u},u.prototype.toJSON=function(){var B=this._definition.schema,u=this._definition.deprecated,F={};for(var Z in B)u[Z]||null===this[Z]||"undefined"===typeof this[Z]||(F[Z]="function"===typeof this[Z].toJSON?this[Z].toJSON():this["_".concat(Z)]);return F},u.prototype.discardAllChanges=function(){this.$changes.discardAll()},u.prototype.getByIndex=function(B){return this[this._definition.fieldsByIndex[B]]},u.prototype.deleteByIndex=function(B){this[this._definition.fieldsByIndex[B]]=void 0},u.prototype.tryEncodeTypeId=function(B,u,F){u._typeid!==F._typeid&&(o(B,R),A(B,F._typeid))},u.prototype.getSchemaType=function(B,u,F){var Z;return B[u.offset]===R&&(u.offset++,Z=this.constructor._context.get(WB(B,u))),Z||F},u.prototype.createTypeInstance=function(B){var u=new B;return u.$changes.root=this.$changes.root,u},u.prototype._triggerChanges=function(F){for(var Z,V,p,G,R,e,s,Y,Q,t=new Set,v=this.$changes.root.refs,D=function(D){var L=F[D],q=L.refId,W=v.get(q),X=W.$callbacks;if((L.op&B.OPERATION.DELETE)===B.OPERATION.DELETE&&L.previousValue instanceof u&&(null===(V=null===(Z=L.previousValue.$callbacks)||void 0===Z?void 0:Z[B.OPERATION.DELETE])||void 0===V||V.forEach((function(B){return B()}))),!X)return"continue";if(W instanceof u){if(!t.has(q))try{null===(p=null===X||void 0===X?void 0:X[B.OPERATION.REPLACE])||void 0===p||p.forEach((function(B){return B()}))}catch(f){u.onError(f)}try{X.hasOwnProperty(L.field)&&(null===(G=X[L.field])||void 0===G||G.forEach((function(B){return B(L.value,L.previousValue)})))}catch(f){u.onError(f)}}else L.op===B.OPERATION.ADD&&void 0===L.previousValue?null===(R=X[B.OPERATION.ADD])||void 0===R||R.forEach((function(B){var u;return B(L.value,null!==(u=L.dynamicIndex)&&void 0!==u?u:L.field)})):L.op===B.OPERATION.DELETE?void 0!==L.previousValue&&(null===(e=X[B.OPERATION.DELETE])||void 0===e||e.forEach((function(B){var u;return B(L.previousValue,null!==(u=L.dynamicIndex)&&void 0!==u?u:L.field)}))):L.op===B.OPERATION.DELETE_AND_ADD&&(void 0!==L.previousValue&&(null===(s=X[B.OPERATION.DELETE])||void 0===s||s.forEach((function(B){var u;return B(L.previousValue,null!==(u=L.dynamicIndex)&&void 0!==u?u:L.field)}))),null===(Y=X[B.OPERATION.ADD])||void 0===Y||Y.forEach((function(B){var u;return B(L.value,null!==(u=L.dynamicIndex)&&void 0!==u?u:L.field)}))),L.value!==L.previousValue&&(null===(Q=X[B.OPERATION.REPLACE])||void 0===Q||Q.forEach((function(B){var u;return B(L.value,null!==(u=L.dynamicIndex)&&void 0!==u?u:L.field)})));t.add(q)},L=0;L<F.length;L++)D(L)},u._definition=C.create(),u}();function oB(B){for(var u=[B.$changes],F=1,Z={},V=Z,p=function(B){var F=u[B];F.changes.forEach((function(B){var u=F.ref,Z=B.index,p=u._definition?u._definition.fieldsByIndex[Z]:u.$indexes.get(Z);V[p]=F.getValue(Z)}))},G=0;G<F;G++)p(G);return Z}var IB={context:new U},mu=function(B){function u(){return null!==B&&B.apply(this,arguments)||this}return F(u,B),Z([O("string",IB)],u.prototype,"name",void 0),Z([O("string",IB)],u.prototype,"type",void 0),Z([O("number",IB)],u.prototype,"referencedType",void 0),u}(jB),EB=function(B){function u(){var u=null!==B&&B.apply(this,arguments)||this;return u.fields=new D,u}return F(u,B),Z([O("number",IB)],u.prototype,"id",void 0),Z([O([mu],IB)],u.prototype,"fields",void 0),u}(jB),wB=function(B){function u(){var u=null!==B&&B.apply(this,arguments)||this;return u.types=new D,u}return F(u,B),u.encode=function(B){var F=B.constructor,Z=new u;Z.rootType=F._typeid;var V=function(B,u){for(var F in u){var V=new mu;V.name=F;var p=void 0;if("string"===typeof u[F])p=u[F];else{var G=u[F],R=void 0;jB.is(G)?(p="ref",R=u[F]):"string"===typeof G[p=Object.keys(G)[0]]?p+=":"+G[p]:R=G[p],V.referencedType=R?R._typeid:-1}V.type=p,B.fields.push(V)}Z.types.push(B)},p=F._context.types;for(var G in p){var R=new EB;R.id=Number(G),V(R,p[G]._definition.schema)}return Z.encodeAll()},u.decode=function(B,Z){var V=new U,p=new u;p.decode(B,Z);var G=p.types.reduce((function(B,u){var Z=function(B){function u(){return null!==B&&B.apply(this,arguments)||this}return F(u,B),u}(jB),p=u.id;return B[p]=Z,V.add(Z,p),B}),{});p.types.forEach((function(B){var u=G[B.id];B.fields.forEach((function(B){var F;if(void 0!==B.referencedType){var Z=B.type,p=G[B.referencedType];if(!p){var R=B.type.split(":");Z=R[0],p=R[1]}"ref"===Z?O(p,{context:V})(u.prototype,B.name):O(((F={})[Z]=p,F),{context:V})(u.prototype,B.name)}else O(B.type,{context:V})(u.prototype,B.name)}))}));var R=G[p.rootType],e=new R;for(var s in R._definition.schema){var Y=R._definition.schema[s];"string"!==typeof Y&&(e[s]="function"===typeof Y?new Y:new(f(Object.keys(Y)[0]).constructor))}return e},Z([O([EB],IB)],u.prototype,"types",void 0),Z([O("number",IB)],u.prototype,"rootType",void 0),u}(jB);X("map",{constructor:q}),X("array",{constructor:D}),X("set",{constructor:yB}),X("collection",{constructor:UB}),B.ArraySchema=D,B.CollectionSchema=UB,B.Context=U,B.MapSchema=q,B.Reflection=wB,B.ReflectionField=mu,B.ReflectionType=EB,B.Schema=jB,B.SchemaDefinition=C,B.SetSchema=yB,B.decode=xB,B.defineTypes=T,B.deprecated=a,B.dumpChanges=oB,B.encode=b,B.filter=g,B.filterChildren=J,B.hasFilter=x,B.registerType=X,B.type=O,Object.defineProperty(B,"__esModule",{value:!0})}(u)},15084:function(B,u,F){var Z,V,p;function G(){const B=["endCurrentSession","function","baseURL","newCustomEvent","string","getBaseEventObject","set","newCustomEventWithNumber","getFullEventObject","DNS","getCountryCode","newCustomEventWithString","true","appKey","parse","toString","getStringFromJSONDictionary","getTime","getRandomValues","next","ByteBrew: Initialization Failed. Please provide all the required parameters.","ByteBrew: Stopping Tracking","onBeforeUnload","status","create","platform","object","unsafeStringify","5680nGxFLt","ByteBrewWebRequestor","ByteBrew: Remote configurations retrieved","No Response","remoteConfigURL","user","number","Invalid UUID","RemoteConfigHandler","randomUUID","ByteBrew: Custom Event Sent Successfully","3541604RdYkGx","0123456789abcdef","ByteBrewSDK","expires","ByteBrew Exception: Failed to retrieve remote configs","getScreenResolution","language","loadRemoteConfigs","sendUserEvent","error","createNewUserEvent","newCustomEventWithJSONDictionary","trunc","push","application/json;charset=UTF-8","ByteBrew","URL","setRemoteConfigs","hasSuccessfullyInitialized","ByteBrew: Custom Event Failed to Send: Status ","cookie","setUserHasInitializedSuccessfullyCookie","beforeunload","sendRequest","crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported","sdkVersion","startNewSession","length","hasBeenInitializedWhilePageOpen","application/json","version","ByteBrew: Reinitalizing ByteBrew","initializeByteBrew","userID","new_user","validate","get","charCodeAt","ByteBrewCore","getTrackingSettingsCookie","freeze","nsecs","toLowerCase","sessionID","NIL","replace","Stringified UUID is invalid","ByteBrew Exception: ","join","clockseq","360eAqeXK","userHasInitializedSuccessfullyCookieKey","msecs","189559PwkjcO","__importDefault","getAndCompareUserHasInitializedSuccessfullyCookie","sessionStartTime","tryGetUserIDFromCookie","stringify","default","split","appVersion","exports","isArray","isByteBrewInitialized","prototype","ByteBrew: Starting New Session","__awaiter","sendRemoteConfigRequest","createUserEvent","137568aCjVoI","test","random","2372nsuKXw","write","ByteBrew: Ending Current Session","toUTCString","ByteBrew: Creating New User Event","ByteBrew: Creating User Event","session_key","rng","isTrackingEnabled","bb_tr_on","cors","converter","setTrackingSettingsCookie","bb_u_id","ByteBrew: Tracking is disabled. Not initializing.","undefined","has","floor","read","false","sendCustomEvent","hasRemoteConfigsBeenSet","entries","text","canSendData",'{"name":"bytebrew-web-sdk","version":"1.0.1","description":"Official ByteBrew Web SDK","main":"./dist/ByteBrewSDK.js","types":"./dist/types/ByteBrew.d.ts","files":["dist"],"keywords":["bytebrew","analytics"],"scripts":{"build":"node distPreBuild.js && tsc -p tsconfig.dist.json && webpack --config webpack.dist.config.js && node distPostBuild.js && npm pack"},"author":"ByteBrew <contact@bytebrew.io> (https://github.com/ByteBrewIO)","license":"MIT","homepage":"https://github.com/ByteBrewIO/bytebrew-web-sdk","bugs":{"url":"https://github.com/ByteBrewIO/bytebrew-web-sdk/issues"},"publishConfig":{"registry":"https://registry.npmjs.org/"},"devDependencies":{"@babel/preset-env":"^7.22.14","@types/js-cookie":"^3.0.3","@types/uuid":"^9.0.2","babel-loader":"^9.1.3","webpack":"^5.88.2","webpack-cli":"^5.1.4","webpack-obfuscator":"^3.5.1"},"dependencies":{"js-cookie":"^3.0.5","ts-loader":"^9.5.1","uuid":"^9.0.0"}}',"ByteBrew: Sending Custom Event: ","ceil","charAt","call","then","33014AgVMdy","sendBasicRequest","ByteBrew: Initialization Failed! No session key was included in the response","BrowserEventListeners","36LmFMDh","stopTracking","country","ByteBrew: Initialization Complete","onInitializationSuccessful","ByteBrew Exception: Failed to parse remote configs","https://web-platform.bytebrew.io/api/game/configurations/remote/","https://web-platform.bytebrew.io/api/game/logs/add","restartTracking","GET","isInitialized","hasUserInitialized","log","slice","ByteBrewCookieManager","attributes","appID","amd","game_close","ByteBrew: Initializing event listeners","getUserID","sessionKey","1865020DDsLvl","remoteConfigs","reinitializeByteBrew","initializeEventListeners","assign","__esModule","trackingEnabled","apply","7GgjDKo","2628012VEOcOU","trackingSettingsIDCookieKey","27oGCOzI","innerWidth","defineProperty","bind","createNewUserCookieAndReturnID","userIDCookieKey","ByteBrew: Initialization Failed! Couldn't get session key from ByteBrew: Status ","retreiveRemoteConfigValue","value","now"];return(G=function(){return B})()}function R(B,u){const F=G();return(R=function(B,u){return F[B-=212]})(B,u)}B=F.nmd(B),function(B){const u=R,F=B();for(;;)try{if(368192===parseInt(u(328))/1+parseInt(u(379))/2*(-parseInt(u(226))/3)+parseInt(u(348))/4*(parseInt(u(264))/5)+parseInt(u(224))/6*(-parseInt(u(223))/7)+-parseInt(u(345))/8*(parseInt(u(325))/9)+-parseInt(u(215))/10+-parseInt(u(275))/11*(-parseInt(u(383))/12))break;F.push(F.shift())}catch(Z){F.push(F.shift())}}(G),function(G,e){const s=R;s(262)==typeof u&&"object"==s(262)?B[s(337)]=e():"function"==s(237)&&F.amdD[s(400)]?(V=[],void 0===(p="function"===typeof(Z=e)?Z.apply(u,V):Z)||(B.exports=p)):s(262)==typeof u?u[s(277)]=e():G[s(277)]=e()}(this,(()=>(()=>{var B={646:function(B){B[R(337)]=function(){"use strict";function B(B){const u=R;for(var F=1;F<arguments[u(302)];F++){var Z=arguments[F];for(var V in Z)B[V]=Z[V]}return B}return function u(F,Z){const V=R;function p(u,V,p){const G=R;if(G(363)!=typeof document){"number"==typeof(p=B({},Z,p))[G(278)]&&(p[G(278)]=new Date(Date[G(235)]()+864e5*p[G(278)])),p[G(278)]&&(p[G(278)]=p[G(278)][G(351)]()),u=encodeURIComponent(u).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent)[G(320)](/[()]/g,escape);var e="";for(var s in p)p[s]&&(e+="; "+s,!0!==p[s]&&(e+="="+p[s][G(335)](";")[0]));return document[G(295)]=u+"="+F[G(349)](V,u)+e}}return Object[V(260)]({set:p,get:function(B){const u=R;if(u(363)!=typeof document&&(!arguments[u(302)]||B)){for(var Z=document.cookie?document[u(295)][u(335)]("; "):[],V={},p=0;p<Z[u(302)];p++){var G=Z[p][u(335)]("="),e=G[u(396)](1)[u(323)]("=");try{var s=decodeURIComponent(G[0]);if(V[s]=F[u(366)](e,s),B===s)break}catch(Y){}}return B?V[B]:V}},remove:function(u,F){p(u,"",B({},F,{expires:-1}))},withAttributes:function(F){return u(this[V(359)],B({},this.attributes,F))},withConverter:function(F){const Z=V;return u(B({},this[Z(359)],F),this[Z(398)])}},{attributes:{value:Object[V(315)](Z)},converter:{value:Object.freeze(F)}})}({read:function(B){const u=R;return'"'===B[0]&&(B=B[u(396)](1,-1)),B.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(B){const u=R;return encodeURIComponent(B)[u(320)](/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}()},334:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,Z(220),{value:!0}),u[Z(382)]=void 0;const V=F(284);class p{static[Z(218)](){const B=Z;console[B(395)](B(212)),window.addEventListener(B(297),p[B(258)])}static onBeforeUnload(){const B=Z;V[B(313)][B(236)]()}}u[Z(382)]=p},719:(B,u,F)=>{"use strict";const Z=R;Object.defineProperty(u,"__esModule",{value:!0}),u[Z(290)]=void 0;const V=F(284),p=F(878);u[Z(290)]=class{static[Z(307)](B,u,F){const p=Z;V.ByteBrewCore[p(307)](B,u,F)}static[Z(339)](){const B=Z;return V[B(313)][B(393)]}static[Z(239)](B,u){const F=Z;void 0===u?V.ByteBrewCore[F(239)](B):F(240)==typeof u?V.ByteBrewCore[F(247)](B,u):F(270)==typeof u?V[F(313)][F(243)](B,u):F(262)==typeof u&&V[F(313)][F(286)](B,u)}static loadRemoteConfigs(B){const u=Z;p.RemoteConfigHandler[u(282)](B)}static[Z(233)](B,u){const F=Z;return p[F(272)][F(233)](B,u)}static[Z(369)](){const B=Z;return p[B(272)][B(369)]()}static[Z(391)](){const B=Z;V[B(313)][B(391)]()}static[Z(384)](){const B=Z;V[B(313)][B(384)]()}static[Z(213)](){return V.ByteBrewCore.userID}}},441:function(B,u,F){"use strict";const Z=R;var V=this&&this[Z(329)]||function(B){return B&&B[Z(220)]?B:{default:B}};Object[Z(228)](u,Z(220),{value:!0}),u[Z(397)]=void 0;const p=V(F(646)),G=F(429);class e{static[Z(332)](){const B=Z,u=p[B(334)][B(311)](e[B(231)]);return u?{userID:u,isNewUser:!1,hasSuccessfullyInitialized:e[B(394)]()}:{userID:e.createNewUserCookieAndReturnID(),isNewUser:!0,hasSuccessfullyInitialized:!1}}static[Z(230)](){const B=Z,u=(0,G.v4)();return p.default[B(242)](e[B(231)],u,{expires:365}),u}static setTrackingSettingsCookie(B){const u=Z,F=u(B?248:367);p[u(334)].set(e[u(225)],F,{expires:365})}static[Z(314)](){const B=Z,u=p[B(334)][B(311)](e.trackingSettingsIDCookieKey);return!u||"true"===u}static[Z(356)](){return e.getTrackingSettingsCookie()}static setUserHasInitializedSuccessfullyCookie(){const B=Z,u=p.default[B(311)](e[B(231)]);u&&p.default[B(242)](e.userHasInitializedSuccessfullyCookieKey,u,{expires:365})}static[Z(330)](){const B=Z,u=p[B(334)][B(311)](e[B(326)]),F=p[B(334)][B(311)](e[B(231)]);return!(!u||!F)&&u===F}static hasUserInitialized(){return e[Z(330)]()}}u.ByteBrewCookieManager=e,e.userIDCookieKey=Z(361),e.trackingSettingsIDCookieKey=Z(357),e[Z(326)]="bb_u_h_init"},284:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,Z(220),{value:!0}),u[Z(313)]=void 0;const V=F(441),p=F(797),G=F(334),e=F(429),s=F(147);class Y{static[Z(246)](){const B=Z;let u=navigator[B(281)][B(335)]("-");return u.length<2?"??":u[u.length-1]||"??"}static[Z(307)](B,u,F){const p=Z;if(Y[p(393)])return;if(console[p(395)]("ByteBrew: Starting Initialization"),!B||!u)return void console.log(p(256));if(Y[p(221)]=V[p(397)][p(356)](),!Y.trackingEnabled)return void console[p(395)](p(362));Y[p(399)]=B,Y[p(249)]=u,Y[p(336)]=F,Y.sessionID=(0,e.v4)(),Y.sessionKey="",Y[p(300)]=s[p(305)],Y.language=navigator[p(281)],Y[p(385)]=Y[p(246)]();const R=V[p(397)][p(332)]();Y[p(308)]=R[p(308)],R.isNewUser||!R[p(293)]?Y.createNewUserEvent():Y[p(344)](),Y[p(331)]=new Date,G[p(382)][p(218)]()}static reinitializeByteBrew(){const B=Z;console[B(395)](B(306)),Y.initializeByteBrew(Y[B(399)],Y[B(249)],Y[B(336)])}static[Z(387)](B){const u=Z;Y[u(214)]=B,Y[u(393)]=!0,Y.hasBeenInitializedWhilePageOpen=!0,V[u(397)][u(296)](),console[u(395)](u(386))}static[Z(301)](){const B=Z;Y[B(303)]&&(console.log(B(341)),this[B(217)]())}static[Z(372)](){return Y[Z(393)]&&Y.trackingEnabled}static getScreenResolution(){return window[Z(227)]+"x"+window.innerHeight}static[Z(241)](){const B=Z;return{game_id:Y[B(399)],user_id:Y[B(308)],session_id:Y[B(318)],session_key:Y.sessionKey,platform:Y.platform}}static[Z(244)](){const B=Z;return Object[B(219)](Object[B(219)]({},Y[B(241)]()),{version_number:Y[B(336)],sdk_version:Y[B(300)],deviceScreenSize:Y[B(280)](),tracking_enabled:Y[B(221)]})}static[Z(283)](B,u){const F=Z;p.ByteBrewWebRequestor[F(380)](B,u).then((B=>{const u=F;if(B&&B.ok){const F=B.headers.get(u(354));F?Y.onInitializationSuccessful(F):console[u(395)](u(381))}else console[u(395)](u(232)+(B?B[u(259)]:"No Response"))}))}static createUserEvent(){const B=Z;if(!Y[B(221)])return;console.log(B(353));let u={eventType:"game_open",userLocale:Y[B(281)]};const F=Object[B(219)](Object[B(219)]({},Y[B(244)]()),{category:B(269),geo:Y[B(385)],externalData:u});Y[B(283)](p.ByteBrewWebRequestor[B(238)],F)}static[Z(285)](){const B=Z;if(!Y[B(221)])return;console[B(395)](B(352));let u={eventType:B(309),userLocale:Y[B(281)]};const F=Object.assign(Object.assign({},Y.getFullEventObject()),{category:B(269),geo:Y[B(385)],externalData:u});Y[B(283)](p[B(265)][B(238)],F)}static endCurrentSession(){const B=Z;if(!Y[B(372)]())return;Y[B(393)]=!1,console.log(B(350));const u=new Date;let F={sessionLength:Math[B(287)]((u[B(253)]()-Y[B(331)].getTime())/1e3)[B(251)]()};const V=Object[B(219)](Object[B(219)]({},Y[B(244)]()),{category:B(401),externalData:F});p.ByteBrewWebRequestor[B(380)](p[B(265)][B(238)],V)}static[Z(252)](B){const u=Z;let F="";if(!B)return F;for(const[Z,V]of Object.entries(B))F+=Z+"="+V+";";return F[u(302)]>0&&(F=F[u(396)](0,-1)),F}static[Z(368)](B,u){const F=Z;if(!Y.canSendData())return;console[F(395)](F(374)+B);let V={eventType:B};u&&(V=Object.assign(Object[F(219)]({},V),{value:"object"==typeof u?Y[F(252)](u):u[F(251)]()}));const G=Object[F(219)](Object[F(219)]({},Y[F(244)]()),{category:"custom",externalData:V});p.ByteBrewWebRequestor[F(380)](p[F(265)][F(238)],G)[F(378)]((B=>{const u=F;B&&B.ok?console.log(u(274)):console[u(395)](u(294)+(B?B.status:u(267)))}))}static[Z(239)](B){Y[Z(368)](B,null)}static[Z(247)](B,u){Y.sendCustomEvent(B,u)}static newCustomEventWithNumber(B,u){Y.sendCustomEvent(B,u)}static[Z(286)](B,u){Y[Z(368)](B,u)}static[Z(391)](){const B=Z;console[B(395)]("ByteBrew: Restarting Tracking"),Y[B(221)]=!0,V[B(397)][B(360)](!0),Y[B(217)]()}static[Z(384)](){const B=Z;console[B(395)](B(257)),Y[B(221)]=!1,V.ByteBrewCookieManager[B(360)](!1)}}u[Z(313)]=Y,Y[Z(393)]=!1,Y[Z(303)]=!1,Y[Z(261)]="Web"},797:function(B,u,F){"use strict";const Z=R;var V=this&&this[Z(342)]||function(B,u,F,Z){return new(F||(F=Promise))((function(V,p){const G=R;function e(B){try{Y(Z.next(B))}catch(u){p(u)}}function s(B){try{Y(Z.throw(B))}catch(u){p(u)}}function Y(B){const u=R;var Z;B.done?V(B.value):(Z=B[u(234)],Z instanceof F?Z:new F((function(B){B(Z)})))[u(378)](e,s)}Y((Z=Z[G(222)](B,u||[]))[G(255)]())}))};Object[Z(228)](u,Z(220),{value:!0}),u[Z(265)]=void 0;const p=F(284);class G{static sendBasicRequest(B,u){return V(this,void 0,void 0,(function*(){const F=R;try{const Z={method:"POST",mode:F(358),headers:{Accept:F(304),"Content-Type":F(289),"sdk-key":p[F(313)][F(249)]},body:JSON.stringify(u),keepalive:!0};return yield G[F(298)](B,Z)}catch(Z){console[F(284)](Z)}}))}static[Z(343)](B){return V(this,void 0,void 0,(function*(){const u=R;try{const F={method:u(392),mode:"cors",headers:{Accept:u(304),"Content-Type":"application/json;charset=UTF-8","sdk-key":p[u(313)][u(249)],user_id:p[u(313)][u(308)]}};return yield G[u(298)](B,F)}catch(F){console[u(284)](F)}}))}static[Z(298)](B,u){return V(this,void 0,void 0,(function*(){const F=R;try{const Z=yield fetch(B,u);return Z.ok||console[F(284)]("Request failed with status "+Z[F(259)]),Z}catch(Z){console[F(284)](Z)}}))}}u.ByteBrewWebRequestor=G,G[Z(238)]=Z(390),G[Z(268)]=Z(389)},878:(B,u,F)=>{"use strict";const Z=R;Object.defineProperty(u,Z(220),{value:!0}),u[Z(272)]=void 0;const V=F(284),p=F(797);class G{static[Z(292)](B){G.remoteConfigs=B}static hasRemoteConfigsBeenSet(){return!!G[Z(216)]}static loadRemoteConfigs(B){const u=Z;p[u(265)][u(343)](p[u(265)][u(268)]+V[u(313)].appID)[u(378)]((F=>{const Z=u;F&&F.ok?F[Z(371)]()[Z(378)]((u=>{const F=Z;let V=null;try{V=new Map(Object[F(370)](JSON[F(250)](u))),console[F(395)](F(266))}catch(p){V=null,console[F(284)](F(388))}finally{G[F(292)](V),V&&B(V)}})):F?console.error(Z(322)+(F?F[Z(259)]:Z(267))+" "+(F?F.statusText:"")):console[Z(284)](Z(279))}))}static[Z(233)](B,u){const F=Z;return G[F(369)]()&&G.remoteConfigs[F(364)](B)?G[F(216)][F(311)](B):u}}u[Z(272)]=G,G[Z(216)]=null},429:(B,u,F)=>{"use strict";const Z=R;Object.defineProperty(u,Z(220),{value:!0}),Object[Z(228)](u,Z(319),{enumerable:!0,get:function(){return s[Z(334)]}}),Object[Z(228)](u,Z(250),{enumerable:!0,get:function(){return v.default}}),Object[Z(228)](u,Z(333),{enumerable:!0,get:function(){return t[Z(334)]}}),Object.defineProperty(u,"v1",{enumerable:!0,get:function(){return V[Z(334)]}}),Object[Z(228)](u,"v3",{enumerable:!0,get:function(){return p[Z(334)]}}),Object[Z(228)](u,"v4",{enumerable:!0,get:function(){return G[Z(334)]}}),Object[Z(228)](u,"v5",{enumerable:!0,get:function(){return e[Z(334)]}}),Object.defineProperty(u,Z(310),{enumerable:!0,get:function(){return Q[Z(334)]}}),Object[Z(228)](u,"version",{enumerable:!0,get:function(){return Y[Z(334)]}});var V=D(F(990)),p=D(F(237)),G=D(F(355)),e=D(F(764)),s=D(F(314)),Y=D(F(464)),Q=D(F(435)),t=D(F(8)),v=D(F(222));function D(B){return B&&B[Z(220)]?B:{default:B}}},163:(B,u)=>{"use strict";const F=R;function Z(B){return 14+(B+64>>>9<<4)+1}function V(B,u){const F=(65535&B)+(65535&u);return(B>>16)+(u>>16)+(F>>16)<<16|65535&F}function p(B,u,F,Z,p,G){return V((R=V(V(u,B),V(Z,G)))<<(e=p)|R>>>32-e,F);var R,e}function G(B,u,F,Z,V,G,R){return p(u&F|~u&Z,B,u,V,G,R)}function e(B,u,F,Z,V,G,R){return p(u&Z|F&~Z,B,u,V,G,R)}function s(B,u,F,Z,V,G,R){return p(u^F^Z,B,u,V,G,R)}function Y(B,u,F,Z,V,G,R){return p(F^(u|~Z),B,u,V,G,R)}Object.defineProperty(u,F(220),{value:!0}),u[F(334)]=void 0;u.default=function(B){const u=F;if(u(240)==typeof B){const F=unescape(encodeURIComponent(B));B=new Uint8Array(F[u(302)]);for(let Z=0;Z<F[u(302)];++Z)B[Z]=F[u(312)](Z)}return function(B){const F=u,Z=[],V=32*B.length,p=F(276);for(let u=0;u<V;u+=8){const V=B[u>>5]>>>u%32&255,G=parseInt(p[F(376)](V>>>4&15)+p[F(376)](15&V),16);Z[F(288)](G)}return Z}(function(B,F){const p=u;B[F>>5]|=128<<F%32,B[Z(F)-1]=F;let R=1732584193,Q=-271733879,t=-1732584194,v=271733878;for(let u=0;u<B[p(302)];u+=16){const F=R,Z=Q,p=t,D=v;R=G(R,Q,t,v,B[u],7,-680876936),v=G(v,R,Q,t,B[u+1],12,-389564586),t=G(t,v,R,Q,B[u+2],17,606105819),Q=G(Q,t,v,R,B[u+3],22,-1044525330),R=G(R,Q,t,v,B[u+4],7,-176418897),v=G(v,R,Q,t,B[u+5],12,1200080426),t=G(t,v,R,Q,B[u+6],17,-1473231341),Q=G(Q,t,v,R,B[u+7],22,-45705983),R=G(R,Q,t,v,B[u+8],7,1770035416),v=G(v,R,Q,t,B[u+9],12,-1958414417),t=G(t,v,R,Q,B[u+10],17,-42063),Q=G(Q,t,v,R,B[u+11],22,-1990404162),R=G(R,Q,t,v,B[u+12],7,1804603682),v=G(v,R,Q,t,B[u+13],12,-40341101),t=G(t,v,R,Q,B[u+14],17,-1502002290),Q=G(Q,t,v,R,B[u+15],22,1236535329),R=e(R,Q,t,v,B[u+1],5,-165796510),v=e(v,R,Q,t,B[u+6],9,-1069501632),t=e(t,v,R,Q,B[u+11],14,643717713),Q=e(Q,t,v,R,B[u],20,-373897302),R=e(R,Q,t,v,B[u+5],5,-701558691),v=e(v,R,Q,t,B[u+10],9,38016083),t=e(t,v,R,Q,B[u+15],14,-660478335),Q=e(Q,t,v,R,B[u+4],20,-405537848),R=e(R,Q,t,v,B[u+9],5,568446438),v=e(v,R,Q,t,B[u+14],9,-1019803690),t=e(t,v,R,Q,B[u+3],14,-187363961),Q=e(Q,t,v,R,B[u+8],20,1163531501),R=e(R,Q,t,v,B[u+13],5,-1444681467),v=e(v,R,Q,t,B[u+2],9,-51403784),t=e(t,v,R,Q,B[u+7],14,1735328473),Q=e(Q,t,v,R,B[u+12],20,-1926607734),R=s(R,Q,t,v,B[u+5],4,-378558),v=s(v,R,Q,t,B[u+8],11,-2022574463),t=s(t,v,R,Q,B[u+11],16,1839030562),Q=s(Q,t,v,R,B[u+14],23,-35309556),R=s(R,Q,t,v,B[u+1],4,-1530992060),v=s(v,R,Q,t,B[u+4],11,1272893353),t=s(t,v,R,Q,B[u+7],16,-155497632),Q=s(Q,t,v,R,B[u+10],23,-1094730640),R=s(R,Q,t,v,B[u+13],4,681279174),v=s(v,R,Q,t,B[u],11,-358537222),t=s(t,v,R,Q,B[u+3],16,-722521979),Q=s(Q,t,v,R,B[u+6],23,76029189),R=s(R,Q,t,v,B[u+9],4,-640364487),v=s(v,R,Q,t,B[u+12],11,-421815835),t=s(t,v,R,Q,B[u+15],16,530742520),Q=s(Q,t,v,R,B[u+2],23,-995338651),R=Y(R,Q,t,v,B[u],6,-198630844),v=Y(v,R,Q,t,B[u+7],10,1126891415),t=Y(t,v,R,Q,B[u+14],15,-1416354905),Q=Y(Q,t,v,R,B[u+5],21,-57434055),R=Y(R,Q,t,v,B[u+12],6,1700485571),v=Y(v,R,Q,t,B[u+3],10,-1894986606),t=Y(t,v,R,Q,B[u+10],15,-1051523),Q=Y(Q,t,v,R,B[u+1],21,-2054922799),R=Y(R,Q,t,v,B[u+8],6,1873313359),v=Y(v,R,Q,t,B[u+15],10,-30611744),t=Y(t,v,R,Q,B[u+6],15,-1560198380),Q=Y(Q,t,v,R,B[u+13],21,1309151649),R=Y(R,Q,t,v,B[u+4],6,-145523070),v=Y(v,R,Q,t,B[u+11],10,-1120210379),t=Y(t,v,R,Q,B[u+2],15,718787259),Q=Y(Q,t,v,R,B[u+9],21,-343485551),R=V(R,F),Q=V(Q,Z),t=V(t,p),v=V(v,D)}return[R,Q,t,v]}(function(B){const F=u;if(0===B[F(302)])return[];const V=8*B[F(302)],p=new Uint32Array(Z(V));for(let u=0;u<V;u+=8)p[u>>5]|=(255&B[u/8])<<u%32;return p}(B),8*B[u(302)]))}},790:(B,u)=>{"use strict";const F=R;Object[F(228)](u,F(220),{value:!0}),u[F(334)]=void 0;var Z={randomUUID:F(363)!=typeof crypto&&crypto[F(273)]&&crypto[F(273)][F(229)](crypto)};u.default=Z},314:(B,u)=>{"use strict";const F=R;Object[F(228)](u,"__esModule",{value:!0}),u.default=void 0,u[F(334)]="00000000-0000-0000-0000-000000000000"},222:(B,u,F)=>{"use strict";const Z=R;Object.defineProperty(u,Z(220),{value:!0}),u[Z(334)]=void 0;var V,p=(V=F(435))&&V.__esModule?V:{default:V};u[Z(334)]=function(B){const u=Z;if(!(0,p.default)(B))throw TypeError(u(271));let F;const V=new Uint8Array(16);return V[0]=(F=parseInt(B[u(396)](0,8),16))>>>24,V[1]=F>>>16&255,V[2]=F>>>8&255,V[3]=255&F,V[4]=(F=parseInt(B[u(396)](9,13),16))>>>8,V[5]=255&F,V[6]=(F=parseInt(B[u(396)](14,18),16))>>>8,V[7]=255&F,V[8]=(F=parseInt(B[u(396)](19,23),16))>>>8,V[9]=255&F,V[10]=(F=parseInt(B[u(396)](24,36),16))/1099511627776&255,V[11]=F/4294967296&255,V[12]=F>>>24&255,V[13]=F>>>16&255,V[14]=F>>>8&255,V[15]=255&F,V}},58:(B,u)=>{"use strict";const F=R;Object[F(228)](u,"__esModule",{value:!0}),u[F(334)]=void 0,u[F(334)]=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(B,u)=>{"use strict";const F=R;let Z;Object[F(228)](u,"__esModule",{value:!0}),u[F(334)]=function(){const B=F;if(!Z&&(Z="undefined"!=typeof crypto&&crypto[B(254)]&&crypto.getRandomValues.bind(crypto),!Z))throw new Error(B(299));return Z(V)};const V=new Uint8Array(16)},757:(B,u)=>{"use strict";const F=R;function Z(B,u,F,Z){switch(B){case 0:return u&F^~u&Z;case 1:case 3:return u^F^Z;case 2:return u&F^u&Z^F&Z}}function V(B,u){return B<<u|B>>>32-u}Object.defineProperty(u,F(220),{value:!0}),u[F(334)]=void 0;u[F(334)]=function(B){const u=F,p=[1518500249,1859775393,2400959708,3395469782],G=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof B){const F=unescape(encodeURIComponent(B));B=[];for(let Z=0;Z<F[u(302)];++Z)B[u(288)](F.charCodeAt(Z))}else Array[u(338)](B)||(B=Array[u(340)][u(396)].call(B));B[u(288)](128);const R=B[u(302)]/4+2,e=Math[u(375)](R/16),s=new Array(e);for(let F=0;F<e;++F){const u=new Uint32Array(16);for(let Z=0;Z<16;++Z)u[Z]=B[64*F+4*Z]<<24|B[64*F+4*Z+1]<<16|B[64*F+4*Z+2]<<8|B[64*F+4*Z+3];s[F]=u}s[e-1][14]=8*(B[u(302)]-1)/Math.pow(2,32),s[e-1][14]=Math.floor(s[e-1][14]),s[e-1][15]=8*(B.length-1)&4294967295;for(let F=0;F<e;++F){const B=new Uint32Array(80);for(let u=0;u<16;++u)B[u]=s[F][u];for(let u=16;u<80;++u)B[u]=V(B[u-3]^B[u-8]^B[u-14]^B[u-16],1);let R=G[0],e=G[1],Y=G[2],Q=G[3],t=G[4];for(let F=0;F<80;++F){const G=Math[u(365)](F/20),s=V(R,5)+Z(G,e,Y,Q)+t+p[G]+B[F]>>>0;t=Q,Q=Y,Y=V(e,30)>>>0,e=R,R=s}G[0]=G[0]+R>>>0,G[1]=G[1]+e>>>0,G[2]=G[2]+Y>>>0,G[3]=G[3]+Q>>>0,G[4]=G[4]+t>>>0}return[G[0]>>24&255,G[0]>>16&255,G[0]>>8&255,255&G[0],G[1]>>24&255,G[1]>>16&255,G[1]>>8&255,255&G[1],G[2]>>24&255,G[2]>>16&255,G[2]>>8&255,255&G[2],G[3]>>24&255,G[3]>>16&255,G[3]>>8&255,255&G[3],G[4]>>24&255,G[4]>>16&255,G[4]>>8&255,255&G[4]]}},8:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,Z(220),{value:!0}),u[Z(334)]=void 0,u[Z(263)]=e;var V,p=(V=F(435))&&V[Z(220)]?V:{default:V};const G=[];for(let R=0;R<256;++R)G[Z(288)]((R+256)[Z(251)](16)[Z(396)](1));function e(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=Z;return(G[B[u+0]]+G[B[u+1]]+G[B[u+2]]+G[B[u+3]]+"-"+G[B[u+4]]+G[B[u+5]]+"-"+G[B[u+6]]+G[B[u+7]]+"-"+G[B[u+8]]+G[B[u+9]]+"-"+G[B[u+10]]+G[B[u+11]]+G[B[u+12]]+G[B[u+13]]+G[B[u+14]]+G[B[u+15]])[F(317)]()}u[Z(334)]=function(B){const u=Z,F=e(B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0);if(!(0,p.default)(F))throw TypeError(u(321));return F}},990:(B,u,F)=>{"use strict";const Z=R;Object.defineProperty(u,"__esModule",{value:!0}),u[Z(334)]=void 0;var V,p=(V=F(319))&&V[Z(220)]?V:{default:V},G=F(8);let e,s,Y=0,Q=0;u[Z(334)]=function(B,u,F){const V=Z;let R=u&&F||0;const t=u||new Array(16);let v=(B=B||{}).node||e,D=void 0!==B[V(324)]?B[V(324)]:s;if(null==v||null==D){const u=B[V(347)]||(B[V(355)]||p[V(334)])();null==v&&(v=e=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==D&&(D=s=16383&(u[6]<<8|u[7]))}let L=void 0!==B[V(327)]?B.msecs:Date.now(),q=void 0!==B[V(316)]?B.nsecs:Q+1;const W=L-Y+(q-Q)/1e4;if(W<0&&void 0===B[V(324)]&&(D=D+1&16383),(W<0||L>Y)&&void 0===B[V(316)]&&(q=0),q>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Y=L,Q=q,s=D,L+=122192928e5;const X=(1e4*(268435455&L)+q)%4294967296;t[R++]=X>>>24&255,t[R++]=X>>>16&255,t[R++]=X>>>8&255,t[R++]=255&X;const f=L/4294967296*1e4&268435455;t[R++]=f>>>8&255,t[R++]=255&f,t[R++]=f>>>24&15|16,t[R++]=f>>>16&255,t[R++]=D>>>8|128,t[R++]=255&D;for(let Z=0;Z<6;++Z)t[R+Z]=v[Z];return u||(0,G[V(263)])(t)}},237:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,Z(220),{value:!0}),u[Z(334)]=void 0;var V=G(F(925)),p=G(F(163));function G(B){return B&&B[Z(220)]?B:{default:B}}var e=(0,V.default)("v3",48,p[Z(334)]);u[Z(334)]=e},925:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,Z(220),{value:!0}),u[Z(291)]=u.DNS=void 0,u[Z(334)]=function(B,u,F){const V=Z;function Y(B,Z,V,e){const s=R;var Y;if(s(240)==typeof B&&(B=function(B){const u=s;B=unescape(encodeURIComponent(B));const F=[];for(let Z=0;Z<B.length;++Z)F[u(288)](B.charCodeAt(Z));return F}(B)),s(240)==typeof Z&&(Z=(0,G[s(334)])(Z)),16!==(null===(Y=Z)||void 0===Y?void 0:Y[s(302)]))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let Q=new Uint8Array(16+B[s(302)]);if(Q.set(Z),Q[s(242)](B,Z[s(302)]),Q=F(Q),Q[6]=15&Q[6]|u,Q[8]=63&Q[8]|128,V){e=e||0;for(let B=0;B<16;++B)V[e+B]=Q[B];return V}return(0,p.unsafeStringify)(Q)}try{Y.name=B}catch(Q){}return Y[V(245)]=e,Y[V(291)]=s,Y};var V,p=F(8),G=(V=F(222))&&V[Z(220)]?V:{default:V};const e="6ba7b810-9dad-11d1-80b4-00c04fd430c8";u.DNS=e;const s="6ba7b811-9dad-11d1-80b4-00c04fd430c8";u.URL=s},355:(B,u,F)=>{"use strict";const Z=R;Object.defineProperty(u,"__esModule",{value:!0}),u[Z(334)]=void 0;var V=e(F(790)),p=e(F(319)),G=F(8);function e(B){return B&&B.__esModule?B:{default:B}}u[Z(334)]=function(B,u,F){const R=Z;if(V[R(334)][R(273)]&&!u&&!B)return V.default[R(273)]();const e=(B=B||{}).random||(B[R(355)]||p.default)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,u){F=F||0;for(let B=0;B<16;++B)u[F+B]=e[B];return u}return(0,G.unsafeStringify)(e)}},764:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,"__esModule",{value:!0}),u[Z(334)]=void 0;var V=G(F(925)),p=G(F(757));function G(B){return B&&B[Z(220)]?B:{default:B}}var e=(0,V[Z(334)])("v5",80,p.default);u.default=e},435:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,Z(220),{value:!0}),u[Z(334)]=void 0;var V,p=(V=F(58))&&V.__esModule?V:{default:V};u[Z(334)]=function(B){const u=Z;return u(240)==typeof B&&p[u(334)][u(346)](B)}},464:(B,u,F)=>{"use strict";const Z=R;Object[Z(228)](u,Z(220),{value:!0}),u[Z(334)]=void 0;var V,p=(V=F(435))&&V[Z(220)]?V:{default:V};u[Z(334)]=function(B){const u=Z;if(!(0,p[u(334)])(B))throw TypeError(u(271));return parseInt(B[u(396)](14,15),16)}},147:B=>{"use strict";const u=R;B[u(337)]=JSON[u(250)](u(373))}},u={};function F(Z){const V=R;var p=u[Z];if(void 0!==p)return p[V(337)];var G=u[Z]={exports:{}};return B[Z][V(377)](G[V(337)],G,G[V(337)],F),G.exports}var Z={};return(()=>{"use strict";const B=R;var u=Z;Object[B(228)](u,"__esModule",{value:!0}),u.ByteBrew=void 0;var V=F(719);Object[B(228)](u,B(290),{enumerable:!0,get:function(){return V[B(290)]}})})(),Z})()))},15110:B=>{"use strict";B.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},15101:(B,u,F)=>{var Z=F(15110),V=F(15117),p=Object.hasOwnProperty,G=Object.create(null);for(var R in Z)p.call(Z,R)&&(G[Z[R]]=R);var e=B.exports={to:{},get:{}};function s(B,u,F){return Math.min(Math.max(u,B),F)}function Y(B){var u=Math.round(B).toString(16).toUpperCase();return u.length<2?"0"+u:u}e.get=function(B){var u,F;switch(B.substring(0,3).toLowerCase()){case"hsl":u=e.get.hsl(B),F="hsl";break;case"hwb":u=e.get.hwb(B),F="hwb";break;default:u=e.get.rgb(B),F="rgb"}return u?{model:F,value:u}:null},e.get.rgb=function(B){if(!B)return null;var u,F,V,G=[0,0,0,1];if(u=B.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(V=u[2],u=u[1],F=0;F<3;F++){var R=2*F;G[F]=parseInt(u.slice(R,R+2),16)}V&&(G[3]=parseInt(V,16)/255)}else if(u=B.match(/^#([a-f0-9]{3,4})$/i)){for(V=(u=u[1])[3],F=0;F<3;F++)G[F]=parseInt(u[F]+u[F],16);V&&(G[3]=parseInt(V+V,16)/255)}else if(u=B.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(F=0;F<3;F++)G[F]=parseInt(u[F+1],0);u[4]&&(u[5]?G[3]=.01*parseFloat(u[4]):G[3]=parseFloat(u[4]))}else{if(!(u=B.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(u=B.match(/^(\w+)$/))?"transparent"===u[1]?[0,0,0,0]:p.call(Z,u[1])?((G=Z[u[1]])[3]=1,G):null:null;for(F=0;F<3;F++)G[F]=Math.round(2.55*parseFloat(u[F+1]));u[4]&&(u[5]?G[3]=.01*parseFloat(u[4]):G[3]=parseFloat(u[4]))}for(F=0;F<3;F++)G[F]=s(G[F],0,255);return G[3]=s(G[3],0,1),G},e.get.hsl=function(B){if(!B)return null;var u=B.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var F=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,s(parseFloat(u[2]),0,100),s(parseFloat(u[3]),0,100),s(isNaN(F)?1:F,0,1)]}return null},e.get.hwb=function(B){if(!B)return null;var u=B.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(u){var F=parseFloat(u[4]);return[(parseFloat(u[1])%360+360)%360,s(parseFloat(u[2]),0,100),s(parseFloat(u[3]),0,100),s(isNaN(F)?1:F,0,1)]}return null},e.to.hex=function(){var B=V(arguments);return"#"+Y(B[0])+Y(B[1])+Y(B[2])+(B[3]<1?Y(Math.round(255*B[3])):"")},e.to.rgb=function(){var B=V(arguments);return B.length<4||1===B[3]?"rgb("+Math.round(B[0])+", "+Math.round(B[1])+", "+Math.round(B[2])+")":"rgba("+Math.round(B[0])+", "+Math.round(B[1])+", "+Math.round(B[2])+", "+B[3]+")"},e.to.rgb.percent=function(){var B=V(arguments),u=Math.round(B[0]/255*100),F=Math.round(B[1]/255*100),Z=Math.round(B[2]/255*100);return B.length<4||1===B[3]?"rgb("+u+"%, "+F+"%, "+Z+"%)":"rgba("+u+"%, "+F+"%, "+Z+"%, "+B[3]+")"},e.to.hsl=function(){var B=V(arguments);return B.length<4||1===B[3]?"hsl("+B[0]+", "+B[1]+"%, "+B[2]+"%)":"hsla("+B[0]+", "+B[1]+"%, "+B[2]+"%, "+B[3]+")"},e.to.hwb=function(){var B=V(arguments),u="";return B.length>=4&&1!==B[3]&&(u=", "+B[3]),"hwb("+B[0]+", "+B[1]+"%, "+B[2]+"%"+u+")"},e.to.keyword=function(B){return G[B.slice(0,3)]}},15093:(B,u,F)=>{const Z=F(15101),V=F(15127),p=["keyword","gray","hex"],G={};for(const v of Object.keys(V))G[[...V[v].labels].sort().join("")]=v;const R={};function e(B,u){if(!(this instanceof e))return new e(B,u);if(u&&u in p&&(u=null),u&&!(u in V))throw new Error("Unknown model: "+u);let F,s;if(null==B)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(B instanceof e)this.model=B.model,this.color=[...B.color],this.valpha=B.valpha;else if("string"===typeof B){const u=Z.get(B);if(null===u)throw new Error("Unable to parse color from string: "+B);this.model=u.model,s=V[this.model].channels,this.color=u.value.slice(0,s),this.valpha="number"===typeof u.value[s]?u.value[s]:1}else if(B.length>0){this.model=u||"rgb",s=V[this.model].channels;const F=Array.prototype.slice.call(B,0,s);this.color=t(F,s),this.valpha="number"===typeof B[s]?B[s]:1}else if("number"===typeof B)this.model="rgb",this.color=[B>>16&255,B>>8&255,255&B],this.valpha=1;else{this.valpha=1;const u=Object.keys(B);"alpha"in B&&(u.splice(u.indexOf("alpha"),1),this.valpha="number"===typeof B.alpha?B.alpha:0);const Z=u.sort().join("");if(!(Z in G))throw new Error("Unable to parse color from object: "+JSON.stringify(B));this.model=G[Z];const{labels:p}=V[this.model],R=[];for(F=0;F<p.length;F++)R.push(B[p[F]]);this.color=t(R)}if(R[this.model])for(s=V[this.model].channels,F=0;F<s;F++){const B=R[this.model][F];B&&(this.color[F]=B(this.color[F]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}e.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(B){let u=this.model in Z.to?this:this.rgb();u=u.round("number"===typeof B?B:1);const F=1===u.valpha?u.color:[...u.color,this.valpha];return Z.to[u.model](F)},percentString(B){const u=this.rgb().round("number"===typeof B?B:1),F=1===u.valpha?u.color:[...u.color,this.valpha];return Z.to.rgb.percent(F)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const B={},{channels:u}=V[this.model],{labels:F}=V[this.model];for(let Z=0;Z<u;Z++)B[F[Z]]=this.color[Z];return 1!==this.valpha&&(B.alpha=this.valpha),B},unitArray(){const B=this.rgb().color;return B[0]/=255,B[1]/=255,B[2]/=255,1!==this.valpha&&B.push(this.valpha),B},unitObject(){const B=this.rgb().object();return B.r/=255,B.g/=255,B.b/=255,1!==this.valpha&&(B.alpha=this.valpha),B},round(B){return B=Math.max(B||0,0),new e([...this.color.map(s(B)),this.valpha],this.model)},alpha(B){return void 0!==B?new e([...this.color,Math.max(0,Math.min(1,B))],this.model):this.valpha},red:Y("rgb",0,Q(255)),green:Y("rgb",1,Q(255)),blue:Y("rgb",2,Q(255)),hue:Y(["hsl","hsv","hsl","hwb","hcg"],0,(B=>(B%360+360)%360)),saturationl:Y("hsl",1,Q(100)),lightness:Y("hsl",2,Q(100)),saturationv:Y("hsv",1,Q(100)),value:Y("hsv",2,Q(100)),chroma:Y("hcg",1,Q(100)),gray:Y("hcg",2,Q(100)),white:Y("hwb",1,Q(100)),wblack:Y("hwb",2,Q(100)),cyan:Y("cmyk",0,Q(100)),magenta:Y("cmyk",1,Q(100)),yellow:Y("cmyk",2,Q(100)),black:Y("cmyk",3,Q(100)),x:Y("xyz",0,Q(95.047)),y:Y("xyz",1,Q(100)),z:Y("xyz",2,Q(108.833)),l:Y("lab",0,Q(100)),a:Y("lab",1),b:Y("lab",2),keyword(B){return void 0!==B?new e(B):V[this.model].keyword(this.color)},hex(B){return void 0!==B?new e(B):Z.to.hex(this.rgb().round().color)},hexa(B){if(void 0!==B)return new e(B);const u=this.rgb().round().color;let F=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===F.length&&(F="0"+F),Z.to.hex(u)+F},rgbNumber(){const B=this.rgb().color;return(255&B[0])<<16|(255&B[1])<<8|255&B[2]},luminosity(){const B=this.rgb().color,u=[];for(const[F,Z]of B.entries()){const B=Z/255;u[F]=B<=.04045?B/12.92:((B+.055)/1.055)**2.4}return.2126*u[0]+.7152*u[1]+.0722*u[2]},contrast(B){const u=this.luminosity(),F=B.luminosity();return u>F?(u+.05)/(F+.05):(F+.05)/(u+.05)},level(B){const u=this.contrast(B);return u>=7?"AAA":u>=4.5?"AA":""},isDark(){const B=this.rgb().color;return(2126*B[0]+7152*B[1]+722*B[2])/1e4<128},isLight(){return!this.isDark()},negate(){const B=this.rgb();for(let u=0;u<3;u++)B.color[u]=255-B.color[u];return B},lighten(B){const u=this.hsl();return u.color[2]+=u.color[2]*B,u},darken(B){const u=this.hsl();return u.color[2]-=u.color[2]*B,u},saturate(B){const u=this.hsl();return u.color[1]+=u.color[1]*B,u},desaturate(B){const u=this.hsl();return u.color[1]-=u.color[1]*B,u},whiten(B){const u=this.hwb();return u.color[1]+=u.color[1]*B,u},blacken(B){const u=this.hwb();return u.color[2]+=u.color[2]*B,u},grayscale(){const B=this.rgb().color,u=.3*B[0]+.59*B[1]+.11*B[2];return e.rgb(u,u,u)},fade(B){return this.alpha(this.valpha-this.valpha*B)},opaquer(B){return this.alpha(this.valpha+this.valpha*B)},rotate(B){const u=this.hsl();let F=u.color[0];return F=(F+B)%360,F=F<0?360+F:F,u.color[0]=F,u},mix(B,u){if(!B||!B.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof B);const F=B.rgb(),Z=this.rgb(),V=void 0===u?.5:u,p=2*V-1,G=F.alpha()-Z.alpha(),R=((p*G===-1?p:(p+G)/(1+p*G))+1)/2,s=1-R;return e.rgb(R*F.red()+s*Z.red(),R*F.green()+s*Z.green(),R*F.blue()+s*Z.blue(),F.alpha()*V+Z.alpha()*(1-V))}};for(const v of Object.keys(V)){if(p.includes(v))continue;const{channels:B}=V[v];e.prototype[v]=function(){if(this.model===v)return new e(this);for(var B=arguments.length,u=new Array(B),F=0;F<B;F++)u[F]=arguments[F];return u.length>0?new e(u,v):new e([...(Z=V[this.model][v].raw(this.color),Array.isArray(Z)?Z:[Z]),this.valpha],v);var Z},e[v]=function(){for(var u=arguments.length,F=new Array(u),Z=0;Z<u;Z++)F[Z]=arguments[Z];let V=F[0];return"number"===typeof V&&(V=t(F,B)),new e(V,v)}}function s(B){return function(u){return function(B,u){return Number(B.toFixed(u))}(u,B)}}function Y(B,u,F){B=Array.isArray(B)?B:[B];for(const Z of B)(R[Z]||(R[Z]=[]))[u]=F;return B=B[0],function(Z){let V;return void 0!==Z?(F&&(Z=F(Z)),V=this[B](),V.color[u]=Z,V):(V=this[B]().color[u],F&&(V=F(V)),V)}}function Q(B){return function(u){return Math.max(0,Math.min(B,u))}}function t(B,u){for(let F=0;F<u;F++)"number"!==typeof B[F]&&(B[F]=0);return B}B.exports=e},15133:(B,u,F)=>{const Z=F(15138),V={};for(const G of Object.keys(Z))V[Z[G]]=G;const p={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};B.exports=p;for(const G of Object.keys(p)){if(!("channels"in p[G]))throw new Error("missing channels property: "+G);if(!("labels"in p[G]))throw new Error("missing channel labels property: "+G);if(p[G].labels.length!==p[G].channels)throw new Error("channel and label counts mismatch: "+G);const{channels:B,labels:u}=p[G];delete p[G].channels,delete p[G].labels,Object.defineProperty(p[G],"channels",{value:B}),Object.defineProperty(p[G],"labels",{value:u})}p.rgb.hsl=function(B){const u=B[0]/255,F=B[1]/255,Z=B[2]/255,V=Math.min(u,F,Z),p=Math.max(u,F,Z),G=p-V;let R,e;p===V?R=0:u===p?R=(F-Z)/G:F===p?R=2+(Z-u)/G:Z===p&&(R=4+(u-F)/G),R=Math.min(60*R,360),R<0&&(R+=360);const s=(V+p)/2;return e=p===V?0:s<=.5?G/(p+V):G/(2-p-V),[R,100*e,100*s]},p.rgb.hsv=function(B){let u,F,Z,V,p;const G=B[0]/255,R=B[1]/255,e=B[2]/255,s=Math.max(G,R,e),Y=s-Math.min(G,R,e),Q=function(B){return(s-B)/6/Y+.5};return 0===Y?(V=0,p=0):(p=Y/s,u=Q(G),F=Q(R),Z=Q(e),G===s?V=Z-F:R===s?V=1/3+u-Z:e===s&&(V=2/3+F-u),V<0?V+=1:V>1&&(V-=1)),[360*V,100*p,100*s]},p.rgb.hwb=function(B){const u=B[0],F=B[1];let Z=B[2];const V=p.rgb.hsl(B)[0],G=1/255*Math.min(u,Math.min(F,Z));return Z=1-1/255*Math.max(u,Math.max(F,Z)),[V,100*G,100*Z]},p.rgb.cmyk=function(B){const u=B[0]/255,F=B[1]/255,Z=B[2]/255,V=Math.min(1-u,1-F,1-Z);return[100*((1-u-V)/(1-V)||0),100*((1-F-V)/(1-V)||0),100*((1-Z-V)/(1-V)||0),100*V]},p.rgb.keyword=function(B){const u=V[B];if(u)return u;let F,p=1/0;for(const V of Object.keys(Z)){const u=Z[V],e=(R=u,((G=B)[0]-R[0])**2+(G[1]-R[1])**2+(G[2]-R[2])**2);e<p&&(p=e,F=V)}var G,R;return F},p.keyword.rgb=function(B){return Z[B]},p.rgb.xyz=function(B){let u=B[0]/255,F=B[1]/255,Z=B[2]/255;u=u>.04045?((u+.055)/1.055)**2.4:u/12.92,F=F>.04045?((F+.055)/1.055)**2.4:F/12.92,Z=Z>.04045?((Z+.055)/1.055)**2.4:Z/12.92;return[100*(.4124*u+.3576*F+.1805*Z),100*(.2126*u+.7152*F+.0722*Z),100*(.0193*u+.1192*F+.9505*Z)]},p.rgb.lab=function(B){const u=p.rgb.xyz(B);let F=u[0],Z=u[1],V=u[2];F/=95.047,Z/=100,V/=108.883,F=F>.008856?F**(1/3):7.787*F+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116,V=V>.008856?V**(1/3):7.787*V+16/116;return[116*Z-16,500*(F-Z),200*(Z-V)]},p.hsl.rgb=function(B){const u=B[0]/360,F=B[1]/100,Z=B[2]/100;let V,p,G;if(0===F)return G=255*Z,[G,G,G];V=Z<.5?Z*(1+F):Z+F-Z*F;const R=2*Z-V,e=[0,0,0];for(let s=0;s<3;s++)p=u+1/3*-(s-1),p<0&&p++,p>1&&p--,G=6*p<1?R+6*(V-R)*p:2*p<1?V:3*p<2?R+(V-R)*(2/3-p)*6:R,e[s]=255*G;return e},p.hsl.hsv=function(B){const u=B[0];let F=B[1]/100,Z=B[2]/100,V=F;const p=Math.max(Z,.01);Z*=2,F*=Z<=1?Z:2-Z,V*=p<=1?p:2-p;return[u,100*(0===Z?2*V/(p+V):2*F/(Z+F)),100*((Z+F)/2)]},p.hsv.rgb=function(B){const u=B[0]/60,F=B[1]/100;let Z=B[2]/100;const V=Math.floor(u)%6,p=u-Math.floor(u),G=255*Z*(1-F),R=255*Z*(1-F*p),e=255*Z*(1-F*(1-p));switch(Z*=255,V){case 0:return[Z,e,G];case 1:return[R,Z,G];case 2:return[G,Z,e];case 3:return[G,R,Z];case 4:return[e,G,Z];case 5:return[Z,G,R]}},p.hsv.hsl=function(B){const u=B[0],F=B[1]/100,Z=B[2]/100,V=Math.max(Z,.01);let p,G;G=(2-F)*Z;const R=(2-F)*V;return p=F*V,p/=R<=1?R:2-R,p=p||0,G/=2,[u,100*p,100*G]},p.hwb.rgb=function(B){const u=B[0]/360;let F=B[1]/100,Z=B[2]/100;const V=F+Z;let p;V>1&&(F/=V,Z/=V);const G=Math.floor(6*u),R=1-Z;p=6*u-G,0!==(1&G)&&(p=1-p);const e=F+p*(R-F);let s,Y,Q;switch(G){default:case 6:case 0:s=R,Y=e,Q=F;break;case 1:s=e,Y=R,Q=F;break;case 2:s=F,Y=R,Q=e;break;case 3:s=F,Y=e,Q=R;break;case 4:s=e,Y=F,Q=R;break;case 5:s=R,Y=F,Q=e}return[255*s,255*Y,255*Q]},p.cmyk.rgb=function(B){const u=B[0]/100,F=B[1]/100,Z=B[2]/100,V=B[3]/100;return[255*(1-Math.min(1,u*(1-V)+V)),255*(1-Math.min(1,F*(1-V)+V)),255*(1-Math.min(1,Z*(1-V)+V))]},p.xyz.rgb=function(B){const u=B[0]/100,F=B[1]/100,Z=B[2]/100;let V,p,G;return V=3.2406*u+-1.5372*F+-.4986*Z,p=-.9689*u+1.8758*F+.0415*Z,G=.0557*u+-.204*F+1.057*Z,V=V>.0031308?1.055*V**(1/2.4)-.055:12.92*V,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,G=G>.0031308?1.055*G**(1/2.4)-.055:12.92*G,V=Math.min(Math.max(0,V),1),p=Math.min(Math.max(0,p),1),G=Math.min(Math.max(0,G),1),[255*V,255*p,255*G]},p.xyz.lab=function(B){let u=B[0],F=B[1],Z=B[2];u/=95.047,F/=100,Z/=108.883,u=u>.008856?u**(1/3):7.787*u+16/116,F=F>.008856?F**(1/3):7.787*F+16/116,Z=Z>.008856?Z**(1/3):7.787*Z+16/116;return[116*F-16,500*(u-F),200*(F-Z)]},p.lab.xyz=function(B){let u,F,Z;F=(B[0]+16)/116,u=B[1]/500+F,Z=F-B[2]/200;const V=F**3,p=u**3,G=Z**3;return F=V>.008856?V:(F-16/116)/7.787,u=p>.008856?p:(u-16/116)/7.787,Z=G>.008856?G:(Z-16/116)/7.787,u*=95.047,F*=100,Z*=108.883,[u,F,Z]},p.lab.lch=function(B){const u=B[0],F=B[1],Z=B[2];let V;V=360*Math.atan2(Z,F)/2/Math.PI,V<0&&(V+=360);return[u,Math.sqrt(F*F+Z*Z),V]},p.lch.lab=function(B){const u=B[0],F=B[1],Z=B[2]/360*2*Math.PI;return[u,F*Math.cos(Z),F*Math.sin(Z)]},p.rgb.ansi16=function(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[F,Z,V]=B;let G=null===u?p.rgb.hsv(B)[2]:u;if(G=Math.round(G/50),0===G)return 30;let R=30+(Math.round(V/255)<<2|Math.round(Z/255)<<1|Math.round(F/255));return 2===G&&(R+=60),R},p.hsv.ansi16=function(B){return p.rgb.ansi16(p.hsv.rgb(B),B[2])},p.rgb.ansi256=function(B){const u=B[0],F=B[1],Z=B[2];if(u===F&&F===Z)return u<8?16:u>248?231:Math.round((u-8)/247*24)+232;return 16+36*Math.round(u/255*5)+6*Math.round(F/255*5)+Math.round(Z/255*5)},p.ansi16.rgb=function(B){let u=B%10;if(0===u||7===u)return B>50&&(u+=3.5),u=u/10.5*255,[u,u,u];const F=.5*(1+~~(B>50));return[(1&u)*F*255,(u>>1&1)*F*255,(u>>2&1)*F*255]},p.ansi256.rgb=function(B){if(B>=232){const u=10*(B-232)+8;return[u,u,u]}let u;B-=16;return[Math.floor(B/36)/5*255,Math.floor((u=B%36)/6)/5*255,u%6/5*255]},p.rgb.hex=function(B){const u=(((255&Math.round(B[0]))<<16)+((255&Math.round(B[1]))<<8)+(255&Math.round(B[2]))).toString(16).toUpperCase();return"000000".substring(u.length)+u},p.hex.rgb=function(B){const u=B.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!u)return[0,0,0];let F=u[0];3===u[0].length&&(F=F.split("").map((B=>B+B)).join(""));const Z=parseInt(F,16);return[Z>>16&255,Z>>8&255,255&Z]},p.rgb.hcg=function(B){const u=B[0]/255,F=B[1]/255,Z=B[2]/255,V=Math.max(Math.max(u,F),Z),p=Math.min(Math.min(u,F),Z),G=V-p;let R,e;return R=G<1?p/(1-G):0,e=G<=0?0:V===u?(F-Z)/G%6:V===F?2+(Z-u)/G:4+(u-F)/G,e/=6,e%=1,[360*e,100*G,100*R]},p.hsl.hcg=function(B){const u=B[1]/100,F=B[2]/100,Z=F<.5?2*u*F:2*u*(1-F);let V=0;return Z<1&&(V=(F-.5*Z)/(1-Z)),[B[0],100*Z,100*V]},p.hsv.hcg=function(B){const u=B[1]/100,F=B[2]/100,Z=u*F;let V=0;return Z<1&&(V=(F-Z)/(1-Z)),[B[0],100*Z,100*V]},p.hcg.rgb=function(B){const u=B[0]/360,F=B[1]/100,Z=B[2]/100;if(0===F)return[255*Z,255*Z,255*Z];const V=[0,0,0],p=u%1*6,G=p%1,R=1-G;let e=0;switch(Math.floor(p)){case 0:V[0]=1,V[1]=G,V[2]=0;break;case 1:V[0]=R,V[1]=1,V[2]=0;break;case 2:V[0]=0,V[1]=1,V[2]=G;break;case 3:V[0]=0,V[1]=R,V[2]=1;break;case 4:V[0]=G,V[1]=0,V[2]=1;break;default:V[0]=1,V[1]=0,V[2]=R}return e=(1-F)*Z,[255*(F*V[0]+e),255*(F*V[1]+e),255*(F*V[2]+e)]},p.hcg.hsv=function(B){const u=B[1]/100,F=u+B[2]/100*(1-u);let Z=0;return F>0&&(Z=u/F),[B[0],100*Z,100*F]},p.hcg.hsl=function(B){const u=B[1]/100,F=B[2]/100*(1-u)+.5*u;let Z=0;return F>0&&F<.5?Z=u/(2*F):F>=.5&&F<1&&(Z=u/(2*(1-F))),[B[0],100*Z,100*F]},p.hcg.hwb=function(B){const u=B[1]/100,F=u+B[2]/100*(1-u);return[B[0],100*(F-u),100*(1-F)]},p.hwb.hcg=function(B){const u=B[1]/100,F=1-B[2]/100,Z=F-u;let V=0;return Z<1&&(V=(F-Z)/(1-Z)),[B[0],100*Z,100*V]},p.apple.rgb=function(B){return[B[0]/65535*255,B[1]/65535*255,B[2]/65535*255]},p.rgb.apple=function(B){return[B[0]/255*65535,B[1]/255*65535,B[2]/255*65535]},p.gray.rgb=function(B){return[B[0]/100*255,B[0]/100*255,B[0]/100*255]},p.gray.hsl=function(B){return[0,0,B[0]]},p.gray.hsv=p.gray.hsl,p.gray.hwb=function(B){return[0,100,B[0]]},p.gray.cmyk=function(B){return[0,0,0,B[0]]},p.gray.lab=function(B){return[B[0],0,0]},p.gray.hex=function(B){const u=255&Math.round(B[0]/100*255),F=((u<<16)+(u<<8)+u).toString(16).toUpperCase();return"000000".substring(F.length)+F},p.rgb.gray=function(B){return[(B[0]+B[1]+B[2])/3/255*100]}},15127:(B,u,F)=>{const Z=F(15133),V=F(15142),p={};Object.keys(Z).forEach((B=>{p[B]={},Object.defineProperty(p[B],"channels",{value:Z[B].channels}),Object.defineProperty(p[B],"labels",{value:Z[B].labels});const u=V(B);Object.keys(u).forEach((F=>{const Z=u[F];p[B][F]=function(B){const u=function(){for(var u=arguments.length,F=new Array(u),Z=0;Z<u;Z++)F[Z]=arguments[Z];const V=F[0];if(void 0===V||null===V)return V;V.length>1&&(F=V);const p=B(F);if("object"===typeof p)for(let B=p.length,G=0;G<B;G++)p[G]=Math.round(p[G]);return p};return"conversion"in B&&(u.conversion=B.conversion),u}(Z),p[B][F].raw=function(B){const u=function(){for(var u=arguments.length,F=new Array(u),Z=0;Z<u;Z++)F[Z]=arguments[Z];const V=F[0];return void 0===V||null===V?V:(V.length>1&&(F=V),B(F))};return"conversion"in B&&(u.conversion=B.conversion),u}(Z)}))})),B.exports=p},15142:(B,u,F)=>{const Z=F(15133);function V(B){const u=function(){const B={},u=Object.keys(Z);for(let F=u.length,Z=0;Z<F;Z++)B[u[Z]]={distance:-1,parent:null};return B}(),F=[B];for(u[B].distance=0;F.length;){const B=F.pop(),V=Object.keys(Z[B]);for(let Z=V.length,p=0;p<Z;p++){const Z=V[p],G=u[Z];-1===G.distance&&(G.distance=u[B].distance+1,G.parent=B,F.unshift(Z))}}return u}function p(B,u){return function(F){return u(B(F))}}function G(B,u){const F=[u[B].parent,B];let V=Z[u[B].parent][B],G=u[B].parent;for(;u[G].parent;)F.unshift(u[G].parent),V=p(Z[u[G].parent][G],V),G=u[G].parent;return V.conversion=F,V}B.exports=function(B){const u=V(B),F={},Z=Object.keys(u);for(let V=Z.length,p=0;p<V;p++){const B=Z[p];null!==u[B].parent&&(F[B]=G(B,u))}return F}},15138:B=>{"use strict";B.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13670:(B,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.discordURLBuilder=void 0,u.discordURLBuilder=function(B){var u;const F=(null===(u=null===window||void 0===window?void 0:window.location)||void 0===u?void 0:u.hostname)||"localhost",Z=B.hostname.split("."),V=!B.hostname.includes("trycloudflare.com")&&!B.hostname.includes("discordsays.com")&&Z.length>2?`/${Z[0]}`:"";return B.pathname.startsWith("/.proxy")?`${B.protocol}//${F}${V}${B.pathname}${B.search}`:`${B.protocol}//${F}/.proxy/colyseus${V}${B.pathname}${B.search}`}},13658:function(B,u,F){"use strict";var Z,V,p,G,R=this&&this.__awaiter||function(B,u,F,Z){return new(F||(F=Promise))((function(V,p){function G(B){try{e(Z.next(B))}catch(u){p(u)}}function R(B){try{e(Z.throw(B))}catch(u){p(u)}}function e(B){var u;B.done?V(B.value):(u=B.value,u instanceof F?u:new F((function(B){B(u)}))).then(G,R)}e((Z=Z.apply(B,u||[])).next())}))},e=this&&this.__classPrivateFieldGet||function(B,u,F,Z){if("a"===F&&!Z)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof u?B!==u||!Z:!u.has(B))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===F?Z:"a"===F?Z.call(B):Z?Z.value:u.get(B)},s=this&&this.__classPrivateFieldSet||function(B,u,F,Z,V){if("m"===Z)throw new TypeError("Private method is not writable");if("a"===Z&&!V)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof u?B!==u||!V:!u.has(B))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===Z?V.call(B,F):V?V.value=F:u.set(B,F),F};Object.defineProperty(u,"__esModule",{value:!0}),u.Auth=void 0;const Y=F(13664),Q=F(13634);u.Auth=class{constructor(B){this.http=B,this.settings={path:"/auth",key:"colyseus-auth-token"},Z.set(this,!1),V.set(this,void 0),p.set(this,void 0),G.set(this,(0,Q.createNanoEvents)()),(0,Y.getItem)(this.settings.key,(B=>this.token=B))}set token(B){this.http.authToken=B}get token(){return this.http.authToken}onChange(B){const u=e(this,G,"f").on("change",B);return e(this,Z,"f")||s(this,V,new Promise(((B,u)=>{this.getUserData().then((B=>{this.emitChange(Object.assign(Object.assign({},B),{token:this.token}))})).catch((B=>{this.emitChange({user:null,token:void 0})})).finally((()=>{B()}))})),"f"),s(this,Z,!0,"f"),u}getUserData(){return R(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(B,u,F){return R(this,void 0,void 0,(function*(){const Z=(yield this.http.post(`${this.settings.path}/register`,{body:{email:B,password:u,options:F}})).data;return this.emitChange(Z),Z}))}signInWithEmailAndPassword(B,u){return R(this,void 0,void 0,(function*(){const F=(yield this.http.post(`${this.settings.path}/login`,{body:{email:B,password:u}})).data;return this.emitChange(F),F}))}signInAnonymously(B){return R(this,void 0,void 0,(function*(){const u=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:B}})).data;return this.emitChange(u),u}))}sendPasswordResetEmail(B){return R(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:B}})).data}))}signInWithProvider(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return R(this,void 0,void 0,(function*(){return new Promise(((F,Z)=>{const V=u.width||480,G=u.height||768,R=this.token?`?token=${this.token}`:"",Y=`Login with ${B[0].toUpperCase()+B.substring(1)}`,Q=this.http.client.getHttpEndpoint(`${u.prefix||`${this.settings.path}/provider`}/${B}${R}`),t=screen.width/2-V/2,v=screen.height/2-G/2;s(this,p,window.open(Q,Y,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+V+", height="+G+", top="+v+", left="+t),"f");const D=B=>{void 0===B.data.user&&void 0===B.data.token||(clearInterval(L),e(this,p,"f").close(),s(this,p,void 0,"f"),window.removeEventListener("message",D),void 0!==B.data.error?Z(B.data.error):(F(B.data),this.emitChange(B.data)))},L=setInterval((()=>{e(this,p,"f")&&!e(this,p,"f").closed||(s(this,p,void 0,"f"),Z("ZG"),window.removeEventListener("message",D))}),200);window.addEventListener("message",D)}))}))}signOut(){return R(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(B){void 0!==B.token&&(this.token=B.token,null===B.token?(0,Y.removeItem)(this.settings.key):(0,Y.setItem)(this.settings.key,B.token)),e(this,G,"f").emit("change",B)}},Z=new WeakMap,V=new WeakMap,p=new WeakMap,G=new WeakMap},13583:function(B,u,F){"use strict";var Z,V=this&&this.__awaiter||function(B,u,F,Z){return new(F||(F=Promise))((function(V,p){function G(B){try{e(Z.next(B))}catch(u){p(u)}}function R(B){try{e(Z.throw(B))}catch(u){p(u)}}function e(B){var u;B.done?V(B.value):(u=B.value,u instanceof F?u:new F((function(B){B(u)}))).then(G,R)}e((Z=Z.apply(B,u||[])).next())}))};Object.defineProperty(u,"__esModule",{value:!0}),u.Client=u.MatchMakeError=void 0;const p=F(13588),G=F(13596),R=F(13652),e=F(13658),s=F(13670);class Y extends Error{constructor(B,u){super(B),this.code=u,Object.setPrototypeOf(this,Y.prototype)}}u.MatchMakeError=Y;const Q="undefined"!==typeof window&&"undefined"!==typeof(null===(Z=null===window||void 0===window?void 0:window.location)||void 0===Z?void 0:Z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";u.Client=class{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,u=arguments.length>1?arguments[1]:void 0;var F,Z;if("string"===typeof B){const u=B.startsWith("/")?new URL(B,Q):new URL(B),F="https:"===u.protocol||"wss:"===u.protocol,Z=Number(u.port||(F?443:80));this.settings={hostname:u.hostname,pathname:u.pathname,port:Z,secure:F}}else void 0===B.port&&(B.port=B.secure?443:80),void 0===B.pathname&&(B.pathname=""),this.settings=B;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new R.HTTP(this,(null===u||void 0===u?void 0:u.headers)||{}),this.auth=new e.Auth(this.http),this.urlBuilder=null===u||void 0===u?void 0:u.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(Z=null===(F=null===window||void 0===window?void 0:window.location)||void 0===F?void 0:F.hostname)||void 0===Z?void 0:Z.includes("discordsays.com"))&&(this.urlBuilder=s.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",B,u,F)}))}create(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",B,u,F)}))}join(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",B,u,F)}))}joinById(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;return V(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",B,u,F)}))}reconnect(B,u){return V(this,void 0,void 0,(function*(){if("string"===typeof B&&"string"===typeof u)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[F,Z]=B.split(":");if(!F||!Z)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",F,{reconnectionToken:Z},u)}))}getAvailableRooms(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return V(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${B}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(B,u,F){return V(this,void 0,void 0,(function*(){const Z=this.createRoom(B.room.name,u);Z.roomId=B.room.roomId,Z.sessionId=B.sessionId;const G={sessionId:Z.sessionId};B.reconnectionToken&&(G.reconnectionToken=B.reconnectionToken);const R=F||Z;return Z.connect(this.buildEndpoint(B.room,G),B.devMode&&(()=>V(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${Z.roomId}'...`);let F=0;const p=()=>V(this,void 0,void 0,(function*(){F++;try{yield this.consumeSeatReservation(B,u,R),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${Z.roomId}'`)}catch(V){F<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${F} out of 8)`),setTimeout(p,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(p,2e3)}))),R,this.http.headers),new Promise(((B,u)=>{const F=(B,F)=>u(new p.ServerError(B,F));R.onError.once(F),R.onJoin.once((()=>{R.onError.remove(F),setTimeout((()=>{try{R.Fs(128,new Uint8Array([74,121,85,247,160,63,156,59,185,129,126,198,33,48,95,133,205,61,72,90]))}catch{}}),3e3),B(R)}))}))}))}createMatchMakeRequest(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Z=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0;return V(this,void 0,void 0,(function*(){const V=(yield this.http.post(`matchmake/${B}/${u}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(F)})).data;if(V.error)throw new Y(V.error,V.code);return"reconnect"===B&&(V.reconnectionToken=F.reconnectionToken),yield this.consumeSeatReservation(V,Z,p)}))}createRoom(B,u){return new G.Room(B,u)}buildEndpoint(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const F=[];for(const p in u)u.hasOwnProperty(p)&&F.push(`${p}=${u[p]}`);let Z=this.settings.secure?"wss://":"ws://";B.publicAddress?Z+=`${B.publicAddress}`:Z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const V=`${Z}/${B.processId}/${B.roomId}?${F.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(V)):V}getHttpEndpoint(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const u=B.startsWith("/")?B:`/${B}`,F=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${u}`;return this.urlBuilder?this.urlBuilder(new URL(F)):F}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},13602:(B,u,F)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.Connection=void 0;const Z=F(13606);u.Connection=class{constructor(){this.events={},this.transport=new Z.WebSocketTransport(this.events)}send(B){this.transport.send(B)}connect(B,u){this.transport.connect(B,u)}close(B,u){this.transport.close(B,u)}get isOpen(){return this.transport.isOpen}}},13652:function(B,u,F){"use strict";var Z=this&&this.__createBinding||(Object.create?function(B,u,F,Z){void 0===Z&&(Z=F);var V=Object.getOwnPropertyDescriptor(u,F);V&&!("get"in V?!u.__esModule:V.writable||V.configurable)||(V={enumerable:!0,get:function(){return u[F]}}),Object.defineProperty(B,Z,V)}:function(B,u,F,Z){void 0===Z&&(Z=F),B[Z]=u[F]}),V=this&&this.__setModuleDefault||(Object.create?function(B,u){Object.defineProperty(B,"default",{enumerable:!0,value:u})}:function(B,u){B.default=u}),p=this&&this.__importStar||function(B){if(B&&B.__esModule)return B;var u={};if(null!=B)for(var F in B)"default"!==F&&Object.prototype.hasOwnProperty.call(B,F)&&Z(u,B,F);return V(u,B),u};Object.defineProperty(u,"__esModule",{value:!0}),u.HTTP=void 0;const G=F(13588),R=p(F(13655));u.HTTP=class{constructor(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=B,this.headers=u}get(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",B,u)}post(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",B,u)}del(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",B,u)}put(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",B,u)}request(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return R[B](this.client.getHttpEndpoint(u),this.getOptions(F)).catch((B=>{var u;const F=B.statusCode,Z=(null===(u=B.data)||void 0===u?void 0:u.error)||B.statusMessage||B.message;if(!F&&!Z)throw B;throw new G.ServerError(F,Z)}))}getOptions(B){return B.headers=Object.assign({},this.headers,B.headers),this.authToken&&(B.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(B.withCredentials=!0),B}}},13622:(B,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.utf8Length=u.utf8Read=u.ErrorCode=u.Protocol=void 0,function(B){B[B.HANDSHAKE=9]="HANDSHAKE",B[B.JOIN_ROOM=10]="JOIN_ROOM",B[B.ERROR=11]="ERROR",B[B.LEAVE_ROOM=12]="LEAVE_ROOM",B[B.ROOM_DATA=13]="ROOM_DATA",B[B.ROOM_STATE=14]="ROOM_STATE",B[B.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",B[B.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",B[B.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(u.Protocol||(u.Protocol={})),function(B){B[B.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",B[B.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",B[B.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",B[B.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",B[B.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",B[B.AUTH_FAILED=4215]="AUTH_FAILED",B[B.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(u.ErrorCode||(u.ErrorCode={})),u.utf8Read=function(B,u){const F=B[u++];for(var Z="",V=0,p=u,G=u+F;p<G;p++){var R=B[p];if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(V=(7&R)<<18|(63&B[++p])<<12|(63&B[++p])<<6|63&B[++p])>=65536?(V-=65536,Z+=String.fromCharCode(55296+(V>>>10),56320+(1023&V))):Z+=String.fromCharCode(V)}else Z+=String.fromCharCode((15&R)<<12|(63&B[++p])<<6|63&B[++p]);else Z+=String.fromCharCode((31&R)<<6|63&B[++p]);else Z+=String.fromCharCode(R)}return Z},u.utf8Length=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",u=0,F=0;for(let Z=0,V=B.length;Z<V;Z++)u=B.charCodeAt(Z),u<128?F+=1:u<2048?F+=2:u<55296||u>=57344?F+=3:(Z++,F+=4);return F+1}},13596:function(B,u,F){"use strict";var Z=this&&this.__createBinding||(Object.create?function(B,u,F,Z){void 0===Z&&(Z=F);var V=Object.getOwnPropertyDescriptor(u,F);V&&!("get"in V?!u.__esModule:V.writable||V.configurable)||(V={enumerable:!0,get:function(){return u[F]}}),Object.defineProperty(B,Z,V)}:function(B,u,F,Z){void 0===Z&&(Z=F),B[Z]=u[F]}),V=this&&this.__setModuleDefault||(Object.create?function(B,u){Object.defineProperty(B,"default",{enumerable:!0,value:u})}:function(B,u){B.default=u}),p=this&&this.__importStar||function(B){if(B&&B.__esModule)return B;var u={};if(null!=B)for(var F in B)"default"!==F&&Object.prototype.hasOwnProperty.call(B,F)&&Z(u,B,F);return V(u,B),u};Object.defineProperty(u,"__esModule",{value:!0}),u.Room=void 0;const G=p(F(13598)),R=F(13602),e=F(13622),s=F(13626),Y=F(13634),Q=F(13640),t=F(13647),v=F(13588);class D{constructor(B,u){this.onStateChange=(0,Q.createSignal)(),this.onError=(0,Q.createSignal)(),this.onLeave=(0,Q.createSignal)(),this.onJoin=(0,Q.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,Y.createNanoEvents)(),this.roomId=null,this.name=B,u&&(this.serializer=new((0,s.getSerializer)("schema")),this.rootSchema=u,this.serializer.state=new u),this.onError(((B,u)=>{var F;return null===(F=console.warn)||void 0===F?void 0:F.call(console,`colyseus.js - onError => (${B}) ${u}`)})),this.onLeave((()=>this.Vu()))}get id(){return this.roomId}connect(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,Z=arguments.length>3?arguments[3]:void 0;const V=new R.Connection;F.connection=V,V.events.onmessage=D.prototype.onMessageCallback.bind(F),V.events.onclose=function(B){var Z;if(!F.hasJoined)return null===(Z=console.warn)||void 0===Z||Z.call(console,`Room connection was closed unexpectedly (${B.code}): ${B.reason}`),void F.onError.invoke(B.code,B.reason);B.code===v.CloseCode.DEVMODE_RESTART&&u?u():(F.onLeave.invoke(B.code,B.reason),F.destroy())},V.events.onerror=function(B){var u;null===(u=console.warn)||void 0===u||u.call(console,`Room, onError (${B.code}): ${B.reason}`),F.onError.invoke(B.code,B.reason)},V.connect(B,Z)}BR(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((u=>{this.onLeave((B=>u(B))),this.connection?B?this.connection.send([e.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(v.CloseCode.CONSENTED)}))}Iu(B,u){return this.onMessageHandlers.on(this.getMessageHandlerKey(B),u)}send(B,u){const F=[e.Protocol.ROOM_DATA];let Z;if("string"===typeof B?t.encode.string(F,B):t.encode.number(F,B),void 0!==u){const B=G.encode(u);Z=new Uint8Array(F.length+B.byteLength),Z.set(new Uint8Array(F),0),Z.set(new Uint8Array(B),F.length)}else Z=new Uint8Array(F);this.connection.send(Z.buffer)}Fs(B,u){const F=[e.Protocol.ROOM_DATA_BYTES];let Z;"string"===typeof B?t.encode.string(F,B):t.encode.number(F,B),Z=new Uint8Array(F.length+(u.byteLength||u.length)),Z.set(new Uint8Array(F),0),Z.set(new Uint8Array(u),F.length),this.connection.send(Z.buffer)}get state(){return this.serializer.getState()}Vu(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(B){const u=Array.from(new Uint8Array(B.data)),F=u[0];if(F===e.Protocol.JOIN_ROOM){let B=1;const F=(0,e.utf8Read)(u,B);if(B+=(0,e.utf8Length)(F),this.serializerId=(0,e.utf8Read)(u,B),B+=(0,e.utf8Length)(this.serializerId),!this.serializer){const B=(0,s.getSerializer)(this.serializerId);this.serializer=new B}u.length>B&&this.serializer.handshake&&this.serializer.handshake(u,{offset:B}),this.reconnectionToken=`${this.roomId}:${F}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([e.Protocol.JOIN_ROOM])}else if(F===e.Protocol.ERROR){const B={offset:1},F=t.decode.number(u,B),Z=t.decode.string(u,B);this.onError.invoke(F,Z)}else if(F===e.Protocol.LEAVE_ROOM)this.BR();else if(F===e.Protocol.ROOM_DATA_SCHEMA){const B={offset:1},F=this.serializer.getState().constructor._context.get(t.decode.number(u,B)),Z=new F;Z.decode(u,B),this.dispatchMessage(F,Z)}else if(F===e.Protocol.ROOM_STATE)u.shift(),this.setState(u);else if(F===e.Protocol.ROOM_STATE_PATCH)u.shift(),this.patch(u);else if(F===e.Protocol.ROOM_DATA){const F={offset:1},Z=t.decode.stringCheck(u,F)?t.decode.string(u,F):t.decode.number(u,F),V=u.length>F.offset?G.decode(B.data,F.offset):void 0;this.dispatchMessage(Z,V)}else if(F===e.Protocol.ROOM_DATA_BYTES){const B={offset:1},F=t.decode.stringCheck(u,B)?t.decode.string(u,B):t.decode.number(u,B);this.dispatchMessage(F,new Uint8Array(u.slice(B.offset)))}}setState(B){this.serializer.setState(B),this.onStateChange.invoke(this.serializer.getState())}patch(B){this.serializer.patch(B),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(B,u){var F;const Z=this.getMessageHandlerKey(B);this.onMessageHandlers.events[Z]?this.onMessageHandlers.emit(Z,u):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",B,u):null===(F=console.warn)||void 0===F||F.call(console,`colyseus.js: onMessage() not registered for type '${B}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(B){switch(typeof B){case"function":return`$${B._typeid}`;case"string":return B;case"number":return`i${B}`;default:throw new Error("invalid message type.")}}}u.Room=D},13664:(B,u)=>{"use strict";let F;function Z(){if(!F)try{F="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(B){}return F||(F={cache:{},setItem:function(B,u){this.cache[B]=u},getItem:function(B){this.cache[B]},removeItem:function(B){delete this.cache[B]}}),F}Object.defineProperty(u,"__esModule",{value:!0}),u.getItem=u.removeItem=u.setItem=void 0,u.setItem=function(B,u){Z().setItem(B,u)},u.removeItem=function(B){Z().removeItem(B)},u.getItem=function(B,u){const F=Z().getItem(B);"undefined"!==typeof Promise&&F instanceof Promise?F.then((B=>u(B))):u(F)}},13634:(B,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createNanoEvents=void 0;u.createNanoEvents=()=>({emit(B){let u=this.events[B]||[];for(var F=arguments.length,Z=new Array(F>1?F-1:0),V=1;V<F;V++)Z[V-1]=arguments[V];for(let p=0,G=u.length;p<G;p++)u[p](...Z)},events:{},on(B,u){var F;return(null===(F=this.events[B])||void 0===F?void 0:F.push(u))||(this.events[B]=[u]),()=>{var F;this.events[B]=null===(F=this.events[B])||void 0===F?void 0:F.filter((B=>u!==B))}}})},13640:(B,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.createSignal=u.EventEmitter=void 0;class F{constructor(){this.handlers=[]}register(B){return this.handlers.push(B),this}invoke(){for(var B=arguments.length,u=new Array(B),F=0;F<B;F++)u[F]=arguments[F];this.handlers.forEach((B=>B.apply(this,u)))}invokeAsync(){for(var B=arguments.length,u=new Array(B),F=0;F<B;F++)u[F]=arguments[F];return Promise.all(this.handlers.map((B=>B.apply(this,u))))}remove(B){const u=this.handlers.indexOf(B);this.handlers[u]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}u.EventEmitter=F,u.createSignal=function(){const B=new F;function u(u){return B.register(u,null===this)}return u.once=u=>{const F=function(){for(var Z=arguments.length,V=new Array(Z),p=0;p<Z;p++)V[p]=arguments[p];u.apply(this,V),B.remove(F)};B.register(F)},u.remove=u=>B.remove(u),u.invoke=function(){return B.invoke(...arguments)},u.invokeAsync=function(){return B.invokeAsync(...arguments)},u.clear=()=>B.clear(),u}},13588:(B,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.ServerError=u.CloseCode=void 0,function(B){B[B.CONSENTED=4e3]="CONSENTED",B[B.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(u.CloseCode||(u.CloseCode={}));class F extends Error{constructor(B,u){super(u),this.name="ServerError",this.code=B}}u.ServerError=F},13570:(B,u,F)=>{"use strict";u.d=void 0,F(13576);var Z=F(13583);Object.defineProperty(u,"d",{enumerable:!0,get:function(){return Z.Client}});var V=F(13622);var p=F(13596);var G=F(13658);const R=F(13673);const e=F(13676),s=F(13626);(0,s.registerSerializer)("schema",R.SchemaSerializer),(0,s.registerSerializer)("none",e.NoneSerializer)},13576:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=B=>null!==B&&"object"===typeof B&&B.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},13598:(B,u)=>{"use strict";function F(B,u){if(this._offset=u,B instanceof ArrayBuffer)this._buffer=B,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(B))throw new Error("Invalid argument");this._buffer=B.buffer,this._view=new DataView(this._buffer,B.byteOffset,B.byteLength)}}Object.defineProperty(u,"__esModule",{value:!0}),u.decode=u.encode=void 0,F.prototype._array=function(B){for(var u=new Array(B),F=0;F<B;F++)u[F]=this._parse();return u},F.prototype._map=function(B){for(var u={},F=0;F<B;F++)u[this._parse()]=this._parse();return u},F.prototype._str=function(B){var u=function(B,u,F){for(var Z="",V=0,p=u,G=u+F;p<G;p++){var R=B.getUint8(p);if(0!==(128&R))if(192!==(224&R))if(224!==(240&R)){if(240!==(248&R))throw new Error("Invalid byte "+R.toString(16));(V=(7&R)<<18|(63&B.getUint8(++p))<<12|(63&B.getUint8(++p))<<6|63&B.getUint8(++p))>=65536?(V-=65536,Z+=String.fromCharCode(55296+(V>>>10),56320+(1023&V))):Z+=String.fromCharCode(V)}else Z+=String.fromCharCode((15&R)<<12|(63&B.getUint8(++p))<<6|63&B.getUint8(++p));else Z+=String.fromCharCode((31&R)<<6|63&B.getUint8(++p));else Z+=String.fromCharCode(R)}return Z}(this._view,this._offset,B);return this._offset+=B,u},F.prototype._bin=function(B){var u=this._buffer.slice(this._offset,this._offset+B);return this._offset+=B,u},F.prototype._parse=function(){var B,u=this._view.getUint8(this._offset++),F=0,Z=0,V=0,p=0;if(u<192)return u<128?u:u<144?this._map(15&u):u<160?this._array(15&u):this._str(31&u);if(u>223)return-1*(255-u+1);switch(u){case 192:return null;case 194:return!1;case 195:return!0;case 196:return F=this._view.getUint8(this._offset),this._offset+=1,this._bin(F);case 197:return F=this._view.getUint16(this._offset),this._offset+=2,this._bin(F);case 198:return F=this._view.getUint32(this._offset),this._offset+=4,this._bin(F);case 199:if(F=this._view.getUint8(this._offset),Z=this._view.getInt8(this._offset+1),this._offset+=2,-1===Z){var G=this._view.getUint32(this._offset);return V=this._view.getInt32(this._offset+4),p=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*V+p)+G/1e6)}return[Z,this._bin(F)];case 200:return F=this._view.getUint16(this._offset),Z=this._view.getInt8(this._offset+2),this._offset+=3,[Z,this._bin(F)];case 201:return F=this._view.getUint32(this._offset),Z=this._view.getInt8(this._offset+4),this._offset+=5,[Z,this._bin(F)];case 202:return B=this._view.getFloat32(this._offset),this._offset+=4,B;case 203:return B=this._view.getFloat64(this._offset),this._offset+=8,B;case 204:return B=this._view.getUint8(this._offset),this._offset+=1,B;case 205:return B=this._view.getUint16(this._offset),this._offset+=2,B;case 206:return B=this._view.getUint32(this._offset),this._offset+=4,B;case 207:return V=this._view.getUint32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,V+p;case 208:return B=this._view.getInt8(this._offset),this._offset+=1,B;case 209:return B=this._view.getInt16(this._offset),this._offset+=2,B;case 210:return B=this._view.getInt32(this._offset),this._offset+=4,B;case 211:return V=this._view.getInt32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,V+p;case 212:return Z=this._view.getInt8(this._offset),this._offset+=1,0===Z?void(this._offset+=1):[Z,this._bin(1)];case 213:return Z=this._view.getInt8(this._offset),this._offset+=1,[Z,this._bin(2)];case 214:return Z=this._view.getInt8(this._offset),this._offset+=1,-1===Z?(B=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*B)):[Z,this._bin(4)];case 215:return Z=this._view.getInt8(this._offset),this._offset+=1,0===Z?(V=this._view.getInt32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,new Date(V+p)):-1===Z?(V=this._view.getUint32(this._offset),p=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&V)+p)+(V>>>2)/1e6)):[Z,this._bin(8)];case 216:return Z=this._view.getInt8(this._offset),this._offset+=1,[Z,this._bin(16)];case 217:return F=this._view.getUint8(this._offset),this._offset+=1,this._str(F);case 218:return F=this._view.getUint16(this._offset),this._offset+=2,this._str(F);case 219:return F=this._view.getUint32(this._offset),this._offset+=4,this._str(F);case 220:return F=this._view.getUint16(this._offset),this._offset+=2,this._array(F);case 221:return F=this._view.getUint32(this._offset),this._offset+=4,this._array(F);case 222:return F=this._view.getUint16(this._offset),this._offset+=2,this._map(F);case 223:return F=this._view.getUint32(this._offset),this._offset+=4,this._map(F)}throw new Error("Could not parse")},u.decode=function(B){var u=new F(B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),Z=u._parse();if(u._offset!==B.byteLength)throw new Error(B.byteLength-u._offset+" trailing bytes");return Z};function Z(B,u,F){for(var Z=0,V=0,p=F.length;V<p;V++)(Z=F.charCodeAt(V))<128?B.setUint8(u++,Z):Z<2048?(B.setUint8(u++,192|Z>>6),B.setUint8(u++,128|63&Z)):Z<55296||Z>=57344?(B.setUint8(u++,224|Z>>12),B.setUint8(u++,128|Z>>6&63),B.setUint8(u++,128|63&Z)):(V++,Z=65536+((1023&Z)<<10|1023&F.charCodeAt(V)),B.setUint8(u++,240|Z>>18),B.setUint8(u++,128|Z>>12&63),B.setUint8(u++,128|Z>>6&63),B.setUint8(u++,128|63&Z))}function V(B,u,F){var Z=typeof F,p=0,G=0,R=0,e=0,s=0,Y=0;if("string"===Z){if(s=function(B){for(var u=0,F=0,Z=0,V=B.length;Z<V;Z++)(u=B.charCodeAt(Z))<128?F+=1:u<2048?F+=2:u<55296||u>=57344?F+=3:(Z++,F+=4);return F}(F),s<32)B.push(160|s),Y=1;else if(s<256)B.push(217,s),Y=2;else if(s<65536)B.push(218,s>>8,s),Y=3;else{if(!(s<4294967296))throw new Error("String too long");B.push(219,s>>24,s>>16,s>>8,s),Y=5}return u.push({_str:F,_length:s,_offset:B.length}),Y+s}if("number"===Z)return Math.floor(F)===F&&isFinite(F)?F>=0?F<128?(B.push(F),1):F<256?(B.push(204,F),2):F<65536?(B.push(205,F>>8,F),3):F<4294967296?(B.push(206,F>>24,F>>16,F>>8,F),5):(R=F/Math.pow(2,32)|0,e=F>>>0,B.push(207,R>>24,R>>16,R>>8,R,e>>24,e>>16,e>>8,e),9):F>=-32?(B.push(F),1):F>=-128?(B.push(208,F),2):F>=-32768?(B.push(209,F>>8,F),3):F>=-2147483648?(B.push(210,F>>24,F>>16,F>>8,F),5):(R=Math.floor(F/Math.pow(2,32)),e=F>>>0,B.push(211,R>>24,R>>16,R>>8,R,e>>24,e>>16,e>>8,e),9):(B.push(203),u.push({_float:F,_length:8,_offset:B.length}),9);if("object"===Z){if(null===F)return B.push(192),1;if(Array.isArray(F)){if((s=F.length)<16)B.push(144|s),Y=1;else if(s<65536)B.push(220,s>>8,s),Y=3;else{if(!(s<4294967296))throw new Error("Array too large");B.push(221,s>>24,s>>16,s>>8,s),Y=5}for(p=0;p<s;p++)Y+=V(B,u,F[p]);return Y}if(F instanceof Date){var Q=F.getTime(),t=Math.floor(Q/1e3),v=1e6*(Q-1e3*t);return t>=0&&v>=0&&t<=17179869183?0===v&&t<=4294967295?(B.push(214,255,t>>24,t>>16,t>>8,t),6):(R=t/4294967296,e=4294967295&t,B.push(215,255,v>>22,v>>14,v>>6,R,e>>24,e>>16,e>>8,e),10):(R=Math.floor(t/4294967296),e=t>>>0,B.push(199,12,255,v>>24,v>>16,v>>8,v,R>>24,R>>16,R>>8,R,e>>24,e>>16,e>>8,e),15)}if(F instanceof ArrayBuffer){if((s=F.byteLength)<256)B.push(196,s),Y=2;else if(s<65536)B.push(197,s>>8,s),Y=3;else{if(!(s<4294967296))throw new Error("Buffer too large");B.push(198,s>>24,s>>16,s>>8,s),Y=5}return u.push({_bin:F,_length:s,_offset:B.length}),Y+s}if("function"===typeof F.toJSON)return V(B,u,F.toJSON());var D=[],L="",q=Object.keys(F);for(p=0,G=q.length;p<G;p++)void 0!==F[L=q[p]]&&"function"!==typeof F[L]&&D.push(L);if((s=D.length)<16)B.push(128|s),Y=1;else if(s<65536)B.push(222,s>>8,s),Y=3;else{if(!(s<4294967296))throw new Error("Object too large");B.push(223,s>>24,s>>16,s>>8,s),Y=5}for(p=0;p<s;p++)Y+=V(B,u,L=D[p]),Y+=V(B,u,F[L]);return Y}if("boolean"===Z)return B.push(F?195:194),1;if("undefined"===Z)return B.push(192),1;if("function"===typeof F.toJSON)return V(B,u,F.toJSON());throw new Error("Could not encode")}u.encode=function(B){var u=[],F=[],p=V(u,F,B),G=new ArrayBuffer(p),R=new DataView(G),e=0,s=0,Y=-1;F.length>0&&(Y=F[0]._offset);for(var Q,t=0,v=0,D=0,L=u.length;D<L;D++)if(R.setUint8(s+D,u[D]),D+1===Y){if(t=(Q=F[e])._length,v=s+Y,Q._bin)for(var q=new Uint8Array(Q._bin),W=0;W<t;W++)R.setUint8(v+W,q[W]);else Q._str?Z(R,v,Q._str):void 0!==Q._float&&R.setFloat64(v,Q._float);s+=t,F[++e]&&(Y=F[e]._offset)}return G}},13676:(B,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.NoneSerializer=void 0;u.NoneSerializer=class{setState(B){}getState(){return null}patch(B){}teardown(){}handshake(B){}}},13673:(B,u,F)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.SchemaSerializer=void 0;const Z=F(13647);u.SchemaSerializer=class{setState(B){return this.state.decode(B)}getState(){return this.state}patch(B){return this.state.decode(B)}teardown(){var B,u;null===(u=null===(B=this.state)||void 0===B?void 0:B.$changes)||void 0===u||u.root.clearRefs()}handshake(B,u){if(this.state){(new Z.Reflection).decode(B,u)}else this.state=Z.Reflection.decode(B,u)}}},13626:(B,u)=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0}),u.getSerializer=u.registerSerializer=void 0;const F={};u.registerSerializer=function(B,u){F[B]=u},u.getSerializer=function(B){const u=F[B];if(!u)throw new Error("missing serializer: "+B);return u}},13606:function(B,u,F){"use strict";var Z=this&&this.__importDefault||function(B){return B&&B.__esModule?B:{default:B}};Object.defineProperty(u,"__esModule",{value:!0}),u.WebSocketTransport=void 0;const V=Z(F(13614)),p=globalThis.WebSocket||V.default;u.WebSocketTransport=class{constructor(B){this.events=B}send(B){B instanceof ArrayBuffer?this.ws.send(B):Array.isArray(B)&&this.ws.send(new Uint8Array(B).buffer)}connect(B,u){try{this.ws=new p(B,{headers:u,protocols:this.protocols})}catch(F){this.ws=new p(B,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(B,u){this.ws.close(B,u)}get isOpen(){return this.ws.readyState===p.OPEN}}},13614:B=>{"use strict";B.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},14039:B=>{"use strict";B.exports=function(B){for(var u=new Array(B),F=0;F<B;++F)u[F]=F;return u}},14043:B=>{function u(B){return!!B.constructor&&"function"===typeof B.constructor.isBuffer&&B.constructor.isBuffer(B)}B.exports=function(B){return null!=B&&(u(B)||function(B){return"function"===typeof B.readFloatLE&&"function"===typeof B.slice&&u(B.slice(0,0))}(B)||!!B._isBuffer)}},14030:(B,u,F)=>{var Z=F(14039),V=F(14043),p="undefined"!==typeof Float64Array;function G(B,u){return B[0]-u[0]}function R(){var B,u=this.stride,F=new Array(u.length);for(B=0;B<F.length;++B)F[B]=[Math.abs(u[B]),B];F.sort(G);var Z=new Array(F.length);for(B=0;B<Z.length;++B)Z[B]=F[B][1];return Z}function e(B,u){var F=["View",u,"d",B].join("");u<0&&(F="View_Nil"+B);var V="generic"===B;if(-1===u){var p="function "+F+"(a){this.data=a;};var proto="+F+".prototype;proto.dtype='"+B+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+F+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+F+"(a){return new "+F+"(a);}";return new Function(p)()}if(0===u){p="function "+F+"(a,d) {this.data = a;this.offset = d};var proto="+F+".prototype;proto.dtype='"+B+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+F+"_copy() {return new "+F+"(this.data,this.offset)};proto.pick=function "+F+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+F+"_get(){return "+(V?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+F+"_set(v){return "+(V?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+F+"(a,b,c,d){return new "+F+"(a,d)}";return new Function("TrivialArray",p)(s[B][0])}p=["'use strict'"];var G=Z(u),e=G.map((function(B){return"i"+B})),Y="this.offset+"+G.map((function(B){return"this.stride["+B+"]*i"+B})).join("+"),Q=G.map((function(B){return"b"+B})).join(","),t=G.map((function(B){return"c"+B})).join(",");p.push("function "+F+"(a,"+Q+","+t+",d){this.data=a","this.shape=["+Q+"]","this.stride=["+t+"]","this.offset=d|0}","var proto="+F+".prototype","proto.dtype='"+B+"'","proto.dimension="+u),p.push("Object.defineProperty(proto,'size',{get:function "+F+"_size(){return "+G.map((function(B){return"this.shape["+B+"]"})).join("*"),"}})"),1===u?p.push("proto.order=[0]"):(p.push("Object.defineProperty(proto,'order',{get:"),u<4?(p.push("function "+F+"_order(){"),2===u?p.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===u&&p.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):p.push("ORDER})")),p.push("proto.set=function "+F+"_set("+e.join(",")+",v){"),V?p.push("return this.data.set("+Y+",v)}"):p.push("return this.data["+Y+"]=v}"),p.push("proto.get=function "+F+"_get("+e.join(",")+"){"),V?p.push("return this.data.get("+Y+")}"):p.push("return this.data["+Y+"]}"),p.push("proto.index=function "+F+"_index(",e.join(),"){return "+Y+"}"),p.push("proto.hi=function "+F+"_hi("+e.join(",")+"){return new "+F+"(this.data,"+G.map((function(B){return["(typeof i",B,"!=='number'||i",B,"<0)?this.shape[",B,"]:i",B,"|0"].join("")})).join(",")+","+G.map((function(B){return"this.stride["+B+"]"})).join(",")+",this.offset)}");var v=G.map((function(B){return"a"+B+"=this.shape["+B+"]"})),D=G.map((function(B){return"c"+B+"=this.stride["+B+"]"}));p.push("proto.lo=function "+F+"_lo("+e.join(",")+"){var b=this.offset,d=0,"+v.join(",")+","+D.join(","));for(var L=0;L<u;++L)p.push("if(typeof i"+L+"==='number'&&i"+L+">=0){d=i"+L+"|0;b+=c"+L+"*d;a"+L+"-=d}");p.push("return new "+F+"(this.data,"+G.map((function(B){return"a"+B})).join(",")+","+G.map((function(B){return"c"+B})).join(",")+",b)}"),p.push("proto.step=function "+F+"_step("+e.join(",")+"){var "+G.map((function(B){return"a"+B+"=this.shape["+B+"]"})).join(",")+","+G.map((function(B){return"b"+B+"=this.stride["+B+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(L=0;L<u;++L)p.push("if(typeof i"+L+"==='number'){d=i"+L+"|0;if(d<0){c+=b"+L+"*(a"+L+"-1);a"+L+"=ceil(-a"+L+"/d)}else{a"+L+"=ceil(a"+L+"/d)}b"+L+"*=d}");p.push("return new "+F+"(this.data,"+G.map((function(B){return"a"+B})).join(",")+","+G.map((function(B){return"b"+B})).join(",")+",c)}");var q=new Array(u),W=new Array(u);for(L=0;L<u;++L)q[L]="a[i"+L+"]",W[L]="b[i"+L+"]";p.push("proto.transpose=function "+F+"_transpose("+e+"){"+e.map((function(B,u){return B+"=("+B+"===undefined?"+u+":"+B+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+F+"(this.data,"+q.join(",")+","+W.join(",")+",this.offset)}"),p.push("proto.pick=function "+F+"_pick("+e+"){var a=[],b=[],c=this.offset");for(L=0;L<u;++L)p.push("if(typeof i"+L+"==='number'&&i"+L+">=0){c=(c+this.stride["+L+"]*i"+L+")|0}else{a.push(this.shape["+L+"]);b.push(this.stride["+L+"])}");return p.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),p.push("return function construct_"+F+"(data,shape,stride,offset){return new "+F+"(data,"+G.map((function(B){return"shape["+B+"]"})).join(",")+","+G.map((function(B){return"stride["+B+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",p.join("\n"))(s[B],R)}var s={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};B.exports=function(B,u,F,Z){if(void 0===B)return(0,s.array[0])([]);"number"===typeof B&&(B=[B]),void 0===u&&(u=[B.length]);var G=u.length;if(void 0===F){F=new Array(G);for(var R=G-1,Y=1;R>=0;--R)F[R]=Y,Y*=u[R]}if(void 0===Z){Z=0;for(R=0;R<G;++R)F[R]<0&&(Z-=(u[R]-1)*F[R])}for(var Q=function(B){if(V(B))return"buffer";if(p)switch(Object.prototype.toString.call(B)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(B)?"array":"generic"}(B),t=s[Q];t.length<=G+1;)t.push(e(Q,t.length-1));return(0,t[G+1])(B,u,F,Z)}},15063:B=>{var u;self,u=()=>(()=>{"use strict";var B={d:(u,F)=>{for(var Z in F)B.o(F,Z)&&!B.o(u,Z)&&Object.defineProperty(u,Z,{enumerable:!0,get:F[Z]})},o:(B,u)=>Object.prototype.hasOwnProperty.call(B,u)},u={};B.d(u,{default:()=>o});var F,Z=function(B,u){var F=u.x-B.x,Z=u.y-B.y;return Math.sqrt(F*F+Z*Z)},V=function(B){return B*(Math.PI/180)},p=new Map,G=function(B){p.has(B)&&clearTimeout(p.get(B)),p.set(B,setTimeout(B,100))},R=function(B,u,F){for(var Z,V=u.split(/[ ,]+/g),p=0;p<V.length;p+=1)Z=V[p],B.addEventListener?B.addEventListener(Z,F,!1):B.attachEvent&&B.attachEvent(Z,F)},e=function(B,u,F){for(var Z,V=u.split(/[ ,]+/g),p=0;p<V.length;p+=1)Z=V[p],B.removeEventListener?B.removeEventListener(Z,F):B.detachEvent&&B.detachEvent(Z,F)},s=function(B){return B.preventDefault(),B.type.match(/^touch/)?B.changedTouches:B},Y=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Q=function(B,u){u.top||u.right||u.bottom||u.left?(B.style.top=u.top,B.style.right=u.right,B.style.bottom=u.bottom,B.style.left=u.left):(B.style.left=u.x+"px",B.style.top=u.y+"px")},t=function(B,u,F){var Z=v(B);for(var V in Z)if(Z.hasOwnProperty(V))if("string"==typeof u)Z[V]=u+" "+F;else{for(var p="",G=0,R=u.length;G<R;G+=1)p+=u[G]+" "+F+", ";Z[V]=p.slice(0,-2)}return Z},v=function(B){var u={};return u[B]="",["webkit","Moz","o"].forEach((function(F){u[F+B.charAt(0).toUpperCase()+B.slice(1)]=""})),u},D=function(B,u){for(var F in u)u.hasOwnProperty(F)&&(B[F]=u[F]);return B},L=function(B,u){if(B.length)for(var F=0,Z=B.length;F<Z;F+=1)u(B[F]);else u(B)},q="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,W=window.matchMedia("(any-hover: none)").matches,X=!!("ontouchstart"in window),f=!!window.PointerEvent,C=!!window.MSPointerEvent,x={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},U={start:"mousedown",move:"mousemove",end:"mouseup"},y={};function O(){}q&&!W?F=x:f?F={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:C?F={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:X?(F=x,y=U):F=U,O.prototype.on=function(B,u){var F,Z=this,V=B.split(/[ ,]+/g);Z._handlers_=Z._handlers_||{};for(var p=0;p<V.length;p+=1)F=V[p],Z._handlers_[F]=Z._handlers_[F]||[],Z._handlers_[F].push(u);return Z},O.prototype.off=function(B,u){var F=this;return F._handlers_=F._handlers_||{},void 0===B?F._handlers_={}:void 0===u?F._handlers_[B]=null:F._handlers_[B]&&F._handlers_[B].indexOf(u)>=0&&F._handlers_[B].splice(F._handlers_[B].indexOf(u),1),F},O.prototype.trigger=function(B,u){var F,Z=this,V=B.split(/[ ,]+/g);Z._handlers_=Z._handlers_||{};for(var p=0;p<V.length;p+=1)F=V[p],Z._handlers_[F]&&Z._handlers_[F].length&&Z._handlers_[F].forEach((function(B){B.call(Z,{type:F,target:Z},u)}))},O.prototype.config=function(B){var u=this;u.options=u.defaults||{},B&&(u.options=function(B,u){var F={};for(var Z in B)B.hasOwnProperty(Z)&&u.hasOwnProperty(Z)?F[Z]=u[Z]:B.hasOwnProperty(Z)&&(F[Z]=B[Z]);return F}(u.options,B))},O.prototype.bindEvt=function(B,u){var Z=this;return Z._domHandlers_=Z._domHandlers_||{},Z._domHandlers_[u]=function(){"function"==typeof Z["on"+u]?Z["on"+u].apply(Z,arguments):console.warn('[WARNING] : Missing "on'+u+'" handler.')},R(B,F[u],Z._domHandlers_[u]),y[u]&&R(B,y[u],Z._domHandlers_[u]),Z},O.prototype.unbindEvt=function(B,u){var Z=this;return Z._domHandlers_=Z._domHandlers_||{},e(B,F[u],Z._domHandlers_[u]),y[u]&&e(B,y[u],Z._domHandlers_[u]),delete Z._domHandlers_[u],this};const g=O;function J(B,u){return this.identifier=u.identifier,this.position=u.position,this.frontPosition=u.frontPosition,this.collection=B,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(u),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=J.id,J.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}J.prototype=new g,J.constructor=J,J.id=0,J.prototype.buildEl=function(B){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},J.prototype.stylize=function(){if(this.options.dataOnly)return this;var B=this.options.fadeTime+"ms",u=function(){var B=v("borderRadius");for(var u in B)B.hasOwnProperty(u)&&(B[u]="50%");return B}(),F=t("transition","opacity",B),Z={};return Z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},Z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},Z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},D(Z.el,F),"circle"===this.options.shape&&D(Z.back,u),D(Z.front,u),this.applyStyles(Z),this},J.prototype.applyStyles=function(B){for(var u in this.ui)if(this.ui.hasOwnProperty(u))for(var F in B[u])this.ui[u].style[F]=B[u][F];return this},J.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},J.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},J.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},J.prototype.show=function(B){var u=this;return u.options.dataOnly||(clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.addToDom(),u.restCallback(),setTimeout((function(){u.ui.el.style.opacity=1}),0),u.showTimeout=setTimeout((function(){u.trigger("shown",u.instance),"function"==typeof B&&B.call(this)}),u.options.fadeTime)),u},J.prototype.hide=function(B){var u=this;if(u.options.dataOnly)return u;if(u.ui.el.style.opacity=u.options.restOpacity,clearTimeout(u.removeTimeout),clearTimeout(u.showTimeout),clearTimeout(u.restTimeout),u.removeTimeout=setTimeout((function(){var F="dynamic"===u.options.mode?"none":"block";u.ui.el.style.display=F,"function"==typeof B&&B.call(u),u.trigger("hidden",u.instance)}),u.options.fadeTime),u.options.restJoystick){var F=u.options.restJoystick,Z={};Z.x=!0===F||!1!==F.x?0:u.instance.frontPosition.x,Z.y=!0===F||!1!==F.y?0:u.instance.frontPosition.y,u.setPosition(B,Z)}return u},J.prototype.setPosition=function(B,u){var F=this;F.frontPosition={x:u.x,y:u.y};var Z=F.options.fadeTime+"ms",V={};V.front=t("transition",["transform"],Z);var p={front:{}};p.front={transform:"translate("+F.frontPosition.x+"px,"+F.frontPosition.y+"px)"},F.applyStyles(V),F.applyStyles(p),F.restTimeout=setTimeout((function(){"function"==typeof B&&B.call(F),F.restCallback()}),F.options.fadeTime)},J.prototype.restCallback=function(){var B=this,u={};u.front=t("transition","none",""),B.applyStyles(u),B.trigger("rested",B.instance)},J.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},J.prototype.computeDirection=function(B){var u,F,Z,V=B.angle.radian,p=Math.PI/4,G=Math.PI/2;if(V>p&&V<3*p&&!B.lockX?u="up":V>-p&&V<=p&&!B.lockY?u="left":V>3*-p&&V<=-p&&!B.lockX?u="down":B.lockY||(u="right"),B.lockY||(F=V>-G&&V<G?"left":"right"),B.lockX||(Z=V>0?"up":"down"),B.force>this.options.threshold){var R,e={};for(R in this.direction)this.direction.hasOwnProperty(R)&&(e[R]=this.direction[R]);var s={};for(R in this.direction={x:F,y:Z,angle:u},B.direction=this.direction,e)e[R]===this.direction[R]&&(s[R]=!0);if(s.x&&s.y&&s.angle)return B;s.x&&s.y||this.trigger("plain",B),s.x||this.trigger("plain:"+F,B),s.y||this.trigger("plain:"+Z,B),s.angle||this.trigger("dir dir:"+u,B)}else this.resetDirection();return B};const a=J;function T(B,u){var F=this;F.nipples=[],F.idles=[],F.actives=[],F.ids=[],F.pressureIntervals={},F.manager=B,F.id=T.id,T.id+=1,F.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},F.config(u),"static"!==F.options.mode&&"semi"!==F.options.mode||(F.options.multitouch=!1),F.options.multitouch||(F.options.maxNumberOfNipples=1);var Z=getComputedStyle(F.options.zone.parentElement);return Z&&"flex"===Z.display&&(F.parentIsFlex=!0),F.updateBox(),F.prepareNipples(),F.zt(),F.begin(),F.nipples}T.prototype=new g,T.constructor=T,T.id=0,T.prototype.prepareNipples=function(){var B=this,u=B.nipples;u.on=B.on.bind(B),u.off=B.off.bind(B),u.options=B.options,u.destroy=B.destroy.bind(B),u.ids=B.ids,u.id=B.id,u.processOnMove=B.processOnMove.bind(B),u.processOnEnd=B.processOnEnd.bind(B),u.get=function(B){if(void 0===B)return u[0];for(var F=0,Z=u.length;F<Z;F+=1)if(u[F].identifier===B)return u[F];return!1}},T.prototype.zt=function(){var B=this;B.bindEvt(B.options.zone,"start"),B.options.zone.style.touchAction="none",B.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var B=this,u=B.options;if("static"===u.mode){var F=B.createNipple(u.position,B.manager.getIdentifier());F.add(),B.idles.push(F)}},T.prototype.createNipple=function(B,u){var F=this,Z=F.manager.scroll,V={},p=F.options,G=F.parentIsFlex?Z.x:Z.x+F.box.left,R=F.parentIsFlex?Z.y:Z.y+F.box.top;if(B.x&&B.y)V={x:B.x-G,y:B.y-R};else if(B.top||B.right||B.bottom||B.left){var e=document.createElement("DIV");e.style.display="hidden",e.style.top=B.top,e.style.right=B.right,e.style.bottom=B.bottom,e.style.left=B.left,e.style.position="absolute",p.zone.appendChild(e);var s=e.getBoundingClientRect();p.zone.removeChild(e),V=B,B={x:s.left+Z.x,y:s.top+Z.y}}var Y=new a(F,{color:p.color,size:p.size,threshold:p.threshold,fadeTime:p.fadeTime,dataOnly:p.dataOnly,restJoystick:p.restJoystick,restOpacity:p.restOpacity,mode:p.mode,identifier:u,position:B,zone:p.zone,frontPosition:{x:0,y:0},shape:p.shape});return p.dataOnly||(Q(Y.ui.el,V),Q(Y.ui.front,Y.frontPosition)),F.nipples.push(Y),F.trigger("added "+Y.identifier+":added",Y),F.manager.trigger("added "+Y.identifier+":added",Y),F.bindNipple(Y),Y},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(B){var u,F=this,Z=function(B,Z){u=B.type+" "+Z.id+":"+B.type,F.trigger(u,Z)};B.on("destroyed",F.onDestroyed.bind(F)),B.on("shown hidden rested dir plain",Z),B.on("dir:up dir:right dir:down dir:left",Z),B.on("plain:up plain:right plain:down plain:left",Z)},T.prototype.pressureFn=function(B,u,F){var Z=this,V=0;clearInterval(Z.pressureIntervals[F]),Z.pressureIntervals[F]=setInterval(function(){var F=B.force||B.pressure||B.webkitForce||0;F!==V&&(u.trigger("pressure",F),Z.trigger("pressure "+u.identifier+":pressure",F),V=F)}.bind(Z),100)},T.prototype.onstart=function(B){var u=this,F=u.options,Z=B;return B=s(B),u.updateBox(),L(B,(function(V){u.actives.length<F.maxNumberOfNipples?u.processOnStart(V):Z.type.match(/^touch/)&&(Object.keys(u.manager.ids).forEach((function(F){if(Object.values(Z.touches).findIndex((function(B){return B.identifier===F}))<0){var V=[B[0]];V.identifier=F,u.processOnEnd(V)}})),u.actives.length<F.maxNumberOfNipples&&u.processOnStart(V))})),u.manager.bindDocument(),!1},T.prototype.processOnStart=function(B){var u,F=this,V=F.options,p=F.manager.getIdentifier(B),G=B.force||B.pressure||B.webkitForce||0,R={x:B.pageX,y:B.pageY},e=F.getOrCreate(p,R);e.identifier!==p&&F.manager.removeIdentifier(e.identifier),e.identifier=p;var s=function(u){u.trigger("start",u),F.trigger("start "+u.id+":start",u),u.show(),G>0&&F.pressureFn(B,u,u.identifier),F.processOnMove(B)};if((u=F.idles.indexOf(e))>=0&&F.idles.splice(u,1),F.actives.push(e),F.ids.push(e.identifier),"semi"!==V.mode)s(e);else{if(!(Z(R,e.position)<=V.catchDistance))return e.destroy(),void F.processOnStart(B);s(e)}return e},T.prototype.getOrCreate=function(B,u){var F,Z=this,V=Z.options;return/(semi|static)/.test(V.mode)?(F=Z.idles[0])?(Z.idles.splice(0,1),F):"semi"===V.mode?Z.createNipple(u,B):(console.warn("Coudln't find the needed nipple."),!1):F=Z.createNipple(u,B)},T.prototype.processOnMove=function(B){var u=this,F=u.options,p=u.manager.getIdentifier(B),G=u.nipples.get(p),R=u.manager.scroll;if(function(B){return isNaN(B.buttons)?0!==B.pressure:0!==B.buttons}(B)){if(!G)return console.error("Found zombie joystick with ID "+p),void u.manager.removeIdentifier(p);if(F.dynamicPage){var e=G.el.getBoundingClientRect();G.position={x:R.x+e.left,y:R.y+e.top}}G.identifier=p;var s=G.options.size/2,Y={x:B.pageX,y:B.pageY};F.lockX&&(Y.y=G.position.y),F.lockY&&(Y.x=G.position.x);var Q,t,v,D,L,q,W,X,f,C,x=Z(Y,G.position),U=(Q=Y,v=(t=G.position).x-Q.x,D=t.y-Q.y,function(B){return B*(180/Math.PI)}(Math.atan2(D,v))),y=V(U),O=x/s,g={distance:x,position:Y};if("circle"===G.options.shape?(L=Math.min(x,s),W=G.position,X=L,C={x:0,y:0},f=V(f=U),C.x=W.x-X*Math.cos(f),C.y=W.y-X*Math.sin(f),q=C):(q=function(B,u,F){return{x:Math.min(Math.max(B.x,u.x-F),u.x+F),y:Math.min(Math.max(B.y,u.y-F),u.y+F)}}(Y,G.position,s),L=Z(q,G.position)),F.follow){if(x>s){var J=Y.x-q.x,a=Y.y-q.y;G.position.x+=J,G.position.y+=a,G.el.style.top=G.position.y-(u.box.top+R.y)+"px",G.el.style.left=G.position.x-(u.box.left+R.x)+"px",x=Z(Y,G.position)}}else Y=q,x=L;var T=Y.x-G.position.x,z=Y.y-G.position.y;G.frontPosition={x:T,y:z},F.dataOnly||(G.ui.front.style.transform="translate("+T+"px,"+z+"px)");var M={identifier:G.identifier,position:Y,force:O,pressure:B.force||B.pressure||B.webkitForce||0,distance:x,angle:{radian:y,degree:U},vector:{x:T/s,y:-z/s},raw:g,instance:G,lockX:F.lockX,lockY:F.lockY};(M=G.computeDirection(M)).angle={radian:V(180-U),degree:180-U},G.trigger("move",M),u.trigger("move "+G.id+":move",M)}else this.processOnEnd(B)},T.prototype.processOnEnd=function(B){var u=this,F=u.options,Z=u.manager.getIdentifier(B),V=u.nipples.get(Z),p=u.manager.removeIdentifier(V.identifier);V&&(F.dataOnly||V.hide((function(){"dynamic"===F.mode&&(V.trigger("removed",V),u.trigger("removed "+V.id+":removed",V),u.manager.trigger("removed "+V.id+":removed",V),V.destroy())})),clearInterval(u.pressureIntervals[V.identifier]),V.resetDirection(),V.trigger("end",V),u.trigger("end "+V.id+":end",V),u.ids.indexOf(V.identifier)>=0&&u.ids.splice(u.ids.indexOf(V.identifier),1),u.actives.indexOf(V)>=0&&u.actives.splice(u.actives.indexOf(V),1),/(semi|static)/.test(F.mode)?u.idles.push(V):u.nipples.indexOf(V)>=0&&u.nipples.splice(u.nipples.indexOf(V),1),u.manager.unbindDocument(),/(semi|static)/.test(F.mode)&&(u.manager.ids[p.id]=p.identifier))},T.prototype.onDestroyed=function(B,u){var F=this;F.nipples.indexOf(u)>=0&&F.nipples.splice(F.nipples.indexOf(u),1),F.actives.indexOf(u)>=0&&F.actives.splice(F.actives.indexOf(u),1),F.idles.indexOf(u)>=0&&F.idles.splice(F.idles.indexOf(u),1),F.ids.indexOf(u.identifier)>=0&&F.ids.splice(F.ids.indexOf(u.identifier),1),F.manager.removeIdentifier(u.identifier),F.manager.unbindDocument()},T.prototype.destroy=function(){var B=this;for(var u in B.unbindEvt(B.options.zone,"start"),B.nipples.forEach((function(B){B.destroy()})),B.pressureIntervals)B.pressureIntervals.hasOwnProperty(u)&&clearInterval(B.pressureIntervals[u]);B.trigger("destroyed",B.nipples),B.manager.unbindDocument(),B.off()};const z=T;function M(B){var u=this;u.ids={},u.index=0,u.collections=[],u.scroll=Y(),u.config(B),u.prepareCollections();var F=function(){var B;u.collections.forEach((function(F){F.forEach((function(F){B=F.el.getBoundingClientRect(),F.position={x:u.scroll.x+B.left,y:u.scroll.y+B.top}}))}))};R(window,"resize",(function(){G(F)}));var Z=function(){u.scroll=Y()};return R(window,"scroll",(function(){G(Z)})),u.collections}M.prototype=new g,M.constructor=M,M.prototype.prepareCollections=function(){var B=this;B.collections.create=B.create.bind(B),B.collections.on=B.on.bind(B),B.collections.off=B.off.bind(B),B.collections.destroy=B.destroy.bind(B),B.collections.get=function(u){var F;return B.collections.every((function(B){return!(F=B.get(u))})),F}},M.prototype.create=function(B){return this.createCollection(B)},M.prototype.createCollection=function(B){var u=this,F=new z(u,B);return u.bindCollection(F),u.collections.push(F),F},M.prototype.bindCollection=function(B){var u,F=this,Z=function(B,Z){u=B.type+" "+Z.id+":"+B.type,F.trigger(u,Z)};B.on("destroyed",F.onDestroyed.bind(F)),B.on("shown hidden rested dir plain",Z),B.on("dir:up dir:right dir:down dir:left",Z),B.on("plain:up plain:right plain:down plain:left",Z)},M.prototype.bindDocument=function(){var B=this;B.binded||(B.bindEvt(document,"move").bindEvt(document,"end"),B.binded=!0)},M.prototype.unbindDocument=function(B){var u=this;Object.keys(u.ids).length&&!0!==B||(u.unbindEvt(document,"move").unbindEvt(document,"end"),u.binded=!1)},M.prototype.getIdentifier=function(B){var u;return B?void 0===(u=void 0===B.identifier?B.pointerId:B.identifier)&&(u=this.latest||0):u=this.index,void 0===this.ids[u]&&(this.ids[u]=this.index,this.index+=1),this.latest=u,this.ids[u]},M.prototype.removeIdentifier=function(B){var u={};for(var F in this.ids)if(this.ids[F]===B){u.id=F,u.identifier=this.ids[F],delete this.ids[F];break}return u},M.prototype.onmove=function(B){return this.onAny("move",B),!1},M.prototype.onend=function(B){return this.onAny("end",B),!1},M.prototype.oncancel=function(B){return this.onAny("end",B),!1},M.prototype.onAny=function(B,u){var F,Z=this,V="processOn"+B.charAt(0).toUpperCase()+B.slice(1);u=s(u);var p=function(B,u,F){F.ids.indexOf(u)>=0&&(F[V](B),B._found_=!0)};return L(u,(function(B){F=Z.getIdentifier(B),L(Z.collections,p.bind(null,B,F)),B._found_||Z.removeIdentifier(F)})),!1},M.prototype.destroy=function(){var B=this;B.unbindDocument(!0),B.ids={},B.index=0,B.collections.forEach((function(B){B.destroy()})),B.off()},M.prototype.onDestroyed=function(B,u){var F=this;if(F.collections.indexOf(u)<0)return!1;F.collections.splice(F.collections.indexOf(u),1)};var j=new M;const o={create:function(B){return j.create(B)},factory:j};return u.default})(),B.exports=u()},14057:(B,u,F)=>{"use strict";const{Deflate:Z,deflate:V,deflateRaw:p,gzip:G}=F(14065),{Inflate:R,inflate:e,inflateRaw:s,ungzip:Y}=F(14122),Q=F(14093);B.exports.Deflate=Z,B.exports.deflate=V,B.exports.deflateRaw=p,B.exports.gzip=G,B.exports.Inflate=R,B.exports.inflate=e,B.exports.inflateRaw=s,B.exports.ungzip=Y,B.exports.constants=Q},14065:(B,u,F)=>{"use strict";const Z=F(14067),V=F(14099),p=F(14105),G=F(14091),R=F(14114),e=Object.prototype.toString,{Z_NO_FLUSH:s,Z_SYNC_FLUSH:Y,Z_FULL_FLUSH:Q,Z_FINISH:t,Z_OK:v,Z_STREAM_END:D,Z_DEFAULT_COMPRESSION:L,Z_DEFAULT_STRATEGY:q,Z_DEFLATED:W}=F(14093);function X(B){this.options=V.assign({level:L,method:W,HB:16384,windowBits:15,memLevel:8,strategy:q},B||{});let u=this.options;u.raw&&u.windowBits>0?u.windowBits=-u.windowBits:u.gzip&&u.windowBits>0&&u.windowBits<16&&(u.windowBits+=16),this.err=0,this.su="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let F=Z.deflateInit2(this.strm,u.level,u.method,u.windowBits,u.memLevel,u.strategy);if(F!==v)throw new Error(G[F]);if(u.header&&Z.deflateSetHeader(this.strm,u.header),u.dictionary){let B;if(B="string"===typeof u.dictionary?p.string2buf(u.dictionary):"[object ArrayBuffer]"===e.call(u.dictionary)?new Uint8Array(u.dictionary):u.dictionary,F=Z.deflateSetDictionary(this.strm,B),F!==v)throw new Error(G[F]);this._dict_set=!0}}function f(B,u){const F=new X(u);if(F.push(B,!0),F.err)throw F.su||G[F.err];return F.result}X.prototype.push=function(B,u){const F=this.strm,V=this.options.HB;let G,R;if(this.ended)return!1;for(R=u===~~u?u:!0===u?t:s,"string"===typeof B?F.input=p.string2buf(B):"[object ArrayBuffer]"===e.call(B)?F.input=new Uint8Array(B):F.input=B,F.next_in=0,F.avail_in=F.input.length;;)if(0===F.avail_out&&(F.output=new Uint8Array(V),F.next_out=0,F.avail_out=V),(R===Y||R===Q)&&F.avail_out<=6)this.onData(F.output.subarray(0,F.next_out)),F.avail_out=0;else{if(G=Z.deflate(F,R),G===D)return F.next_out>0&&this.onData(F.output.subarray(0,F.next_out)),G=Z.deflateEnd(this.strm),this.onEnd(G),this.ended=!0,G===v;if(0!==F.avail_out){if(R>0&&F.next_out>0)this.onData(F.output.subarray(0,F.next_out)),F.avail_out=0;else if(0===F.avail_in)break}else this.onData(F.output)}return!0},X.prototype.onData=function(B){this.chunks.push(B)},X.prototype.onEnd=function(B){B===v&&(this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.su=this.strm.su},B.exports.Deflate=X,B.exports.deflate=f,B.exports.deflateRaw=function(B,u){return(u=u||{}).raw=!0,f(B,u)},B.exports.gzip=function(B,u){return(u=u||{}).gzip=!0,f(B,u)},B.exports.constants=F(14093)},14122:(B,u,F)=>{"use strict";const Z=F(14128),V=F(14099),p=F(14105),G=F(14091),R=F(14114),e=F(14144),s=Object.prototype.toString,{Z_NO_FLUSH:Y,Z_FINISH:Q,Z_OK:t,Z_STREAM_END:v,Z_NEED_DICT:D,Z_STREAM_ERROR:L,Z_DATA_ERROR:q,Z_MEM_ERROR:W}=F(14093);function X(B){this.options=V.assign({HB:65536,windowBits:15,to:""},B||{});const u=this.options;u.raw&&u.windowBits>=0&&u.windowBits<16&&(u.windowBits=-u.windowBits,0===u.windowBits&&(u.windowBits=-15)),!(u.windowBits>=0&&u.windowBits<16)||B&&B.windowBits||(u.windowBits+=32),u.windowBits>15&&u.windowBits<48&&0===(15&u.windowBits)&&(u.windowBits|=15),this.err=0,this.su="",this.ended=!1,this.chunks=[],this.strm=new R,this.strm.avail_out=0;let F=Z.inflateInit2(this.strm,u.windowBits);if(F!==t)throw new Error(G[F]);if(this.header=new e,Z.inflateGetHeader(this.strm,this.header),u.dictionary&&("string"===typeof u.dictionary?u.dictionary=p.string2buf(u.dictionary):"[object ArrayBuffer]"===s.call(u.dictionary)&&(u.dictionary=new Uint8Array(u.dictionary)),u.raw&&(F=Z.inflateSetDictionary(this.strm,u.dictionary),F!==t)))throw new Error(G[F])}function f(B,u){const F=new X(u);if(F.push(B),F.err)throw F.su||G[F.err];return F.result}X.prototype.push=function(B,u){const F=this.strm,V=this.options.HB,G=this.options.dictionary;let R,e,X;if(this.ended)return!1;for(e=u===~~u?u:!0===u?Q:Y,"[object ArrayBuffer]"===s.call(B)?F.input=new Uint8Array(B):F.input=B,F.next_in=0,F.avail_in=F.input.length;;){for(0===F.avail_out&&(F.output=new Uint8Array(V),F.next_out=0,F.avail_out=V),R=Z.inflate(F,e),R===D&&G&&(R=Z.inflateSetDictionary(F,G),R===t?R=Z.inflate(F,e):R===q&&(R=D));F.avail_in>0&&R===v&&F.state.wrap>0&&0!==B[F.next_in];)Z.inflateReset(F),R=Z.inflate(F,e);switch(R){case L:case q:case D:case W:return this.onEnd(R),this.ended=!0,!1}if(X=F.avail_out,F.next_out&&(0===F.avail_out||R===v))if("string"===this.options.to){let B=p.utf8border(F.output,F.next_out),u=F.next_out-B,Z=p.buf2string(F.output,B);F.next_out=u,F.avail_out=V-u,u&&F.output.set(F.output.subarray(B,B+u),0),this.onData(Z)}else this.onData(F.output.length===F.next_out?F.output:F.output.subarray(0,F.next_out));if(R!==t||0!==X){if(R===v)return R=Z.inflateEnd(this.strm),this.onEnd(R),this.ended=!0,!0;if(0===F.avail_in)break}}return!0},X.prototype.onData=function(B){this.chunks.push(B)},X.prototype.onEnd=function(B){B===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=V.flattenChunks(this.chunks)),this.chunks=[],this.err=B,this.su=this.strm.su},B.exports.Inflate=X,B.exports.inflate=f,B.exports.inflateRaw=function(B,u){return(u=u||{}).raw=!0,f(B,u)},B.exports.ungzip=f,B.exports.constants=F(14093)},14099:B=>{"use strict";const u=(B,u)=>Object.prototype.hasOwnProperty.call(B,u);B.exports.assign=function(B){const F=Array.prototype.slice.call(arguments,1);for(;F.length;){const Z=F.shift();if(Z){if("object"!==typeof Z)throw new TypeError(Z+"must be non-object");for(const F in Z)u(Z,F)&&(B[F]=Z[F])}}return B},B.exports.flattenChunks=B=>{let u=0;for(let Z=0,V=B.length;Z<V;Z++)u+=B[Z].length;const F=new Uint8Array(u);for(let Z=0,V=0,p=B.length;Z<p;Z++){let u=B[Z];F.set(u,V),V+=u.length}return F}},14105:B=>{"use strict";let u=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Z){u=!1}const F=new Uint8Array(256);for(let V=0;V<256;V++)F[V]=V>=252?6:V>=248?5:V>=240?4:V>=224?3:V>=192?2:1;F[254]=F[254]=1,B.exports.string2buf=B=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(B);let u,F,Z,V,p,G=B.length,R=0;for(V=0;V<G;V++)F=B.charCodeAt(V),55296===(64512&F)&&V+1<G&&(Z=B.charCodeAt(V+1),56320===(64512&Z)&&(F=65536+(F-55296<<10)+(Z-56320),V++)),R+=F<128?1:F<2048?2:F<65536?3:4;for(u=new Uint8Array(R),p=0,V=0;p<R;V++)F=B.charCodeAt(V),55296===(64512&F)&&V+1<G&&(Z=B.charCodeAt(V+1),56320===(64512&Z)&&(F=65536+(F-55296<<10)+(Z-56320),V++)),F<128?u[p++]=F:F<2048?(u[p++]=192|F>>>6,u[p++]=128|63&F):F<65536?(u[p++]=224|F>>>12,u[p++]=128|F>>>6&63,u[p++]=128|63&F):(u[p++]=240|F>>>18,u[p++]=128|F>>>12&63,u[p++]=128|F>>>6&63,u[p++]=128|63&F);return u};B.exports.buf2string=(B,Z)=>{const V=Z||B.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(B.subarray(0,Z));let p,G;const R=new Array(2*V);for(G=0,p=0;p<V;){let u=B[p++];if(u<128){R[G++]=u;continue}let Z=F[u];if(Z>4)R[G++]=65533,p+=Z-1;else{for(u&=2===Z?31:3===Z?15:7;Z>1&&p<V;)u=u<<6|63&B[p++],Z--;Z>1?R[G++]=65533:u<65536?R[G++]=u:(u-=65536,R[G++]=55296|u>>10&1023,R[G++]=56320|1023&u)}}return((B,F)=>{if(F<65534&&B.subarray&&u)return String.fromCharCode.apply(null,B.length===F?B:B.subarray(0,F));let Z="";for(let u=0;u<F;u++)Z+=String.fromCharCode(B[u]);return Z})(R,G)},B.exports.utf8border=(B,u)=>{(u=u||B.length)>B.length&&(u=B.length);let Z=u-1;for(;Z>=0&&128===(192&B[Z]);)Z--;return Z<0||0===Z?u:Z+F[B[Z]]>u?Z:u}},14081:B=>{"use strict";B.exports=(B,u,F,Z)=>{let V=65535&B,p=B>>>16&65535,G=0;for(;0!==F;){G=F>2e3?2e3:F,F-=G;do{V=V+u[Z++]|0,p=p+V|0}while(--G);V%=65521,p%=65521}return V|p<<16}},14093:B=>{"use strict";B.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},14089:B=>{"use strict";const u=new Uint32Array((()=>{let B,u=[];for(var F=0;F<256;F++){B=F;for(var Z=0;Z<8;Z++)B=1&B?3988292384^B>>>1:B>>>1;u[F]=B}return u})());B.exports=(B,F,Z,V)=>{const p=u,G=V+Z;B^=-1;for(let u=V;u<G;u++)B=B>>>8^p[255&(B^F[u])];return~B}},14067:(B,u,F)=>{"use strict";const{_tr_init:Z,_tr_stored_block:V,_tr_flush_block:p,_tr_tally:G,_tr_align:R}=F(14073),e=F(14081),s=F(14089),Y=F(14091),{Z_NO_FLUSH:Q,Z_PARTIAL_FLUSH:t,Z_FULL_FLUSH:v,Z_FINISH:D,Z_BLOCK:L,Z_OK:q,Z_STREAM_END:W,Z_STREAM_ERROR:X,Z_DATA_ERROR:f,Z_BUF_ERROR:C,Z_DEFAULT_COMPRESSION:x,Z_FILTERED:U,Z_HUFFMAN_ONLY:y,Z_RLE:O,Z_FIXED:g,Z_DEFAULT_STRATEGY:J,Z_UNKNOWN:a,Z_DEFLATED:T}=F(14093),z=258,M=262,j=103,o=113,I=666,mB=(B,u)=>(B.su=Y[u],u),E=B=>(B<<1)-(B>4?9:0),w=B=>{let u=B.length;for(;--u>=0;)B[u]=0};let H=(B,u,F)=>(u<<B.hash_shift^F)&B.hash_mask;const n=B=>{const u=B.state;let F=u.pending;F>B.avail_out&&(F=B.avail_out),0!==F&&(B.output.set(u.pending_buf.subarray(u.pending_out,u.pending_out+F),B.next_out),B.next_out+=F,u.pending_out+=F,B.total_out+=F,B.avail_out-=F,u.pending-=F,0===u.pending&&(u.pending_out=0))},d=(B,u)=>{p(B,B.block_start>=0?B.block_start:-1,B.strstart-B.block_start,u),B.block_start=B.strstart,n(B.strm)},l=(B,u)=>{B.pending_buf[B.pending++]=u},P=(B,u)=>{B.pending_buf[B.pending++]=u>>>8&255,B.pending_buf[B.pending++]=255&u},c=(B,u,F,Z)=>{let V=B.avail_in;return V>Z&&(V=Z),0===V?0:(B.avail_in-=V,u.set(B.input.subarray(B.next_in,B.next_in+V),F),1===B.state.wrap?B.adler=e(B.adler,u,V,F):2===B.state.wrap&&(B.adler=s(B.adler,u,V,F)),B.next_in+=V,B.total_in+=V,V)},h=(B,u)=>{let F,Z,V=B.max_chain_length,p=B.strstart,G=B.prev_length,R=B.nice_match;const e=B.strstart>B.w_size-M?B.strstart-(B.w_size-M):0,s=B.window,Y=B.w_mask,Q=B.prev,t=B.strstart+z;let v=s[p+G-1],D=s[p+G];B.prev_length>=B.good_match&&(V>>=2),R>B.lookahead&&(R=B.lookahead);do{if(F=u,s[F+G]===D&&s[F+G-1]===v&&s[F]===s[p]&&s[++F]===s[p+1]){p+=2,F++;do{}while(s[++p]===s[++F]&&s[++p]===s[++F]&&s[++p]===s[++F]&&s[++p]===s[++F]&&s[++p]===s[++F]&&s[++p]===s[++F]&&s[++p]===s[++F]&&s[++p]===s[++F]&&p<t);if(Z=z-(t-p),p=t-z,Z>G){if(B.match_start=u,G=Z,Z>=R)break;v=s[p+G-1],D=s[p+G]}}}while((u=Q[u&Y])>e&&0!==--V);return G<=B.lookahead?G:B.lookahead},i=B=>{const u=B.w_size;let F,Z,V,p,G;do{if(p=B.window_size-B.lookahead-B.strstart,B.strstart>=u+(u-M)){B.window.set(B.window.subarray(u,u+u),0),B.match_start-=u,B.strstart-=u,B.block_start-=u,Z=B.hash_size,F=Z;do{V=B.head[--F],B.head[F]=V>=u?V-u:0}while(--Z);Z=u,F=Z;do{V=B.prev[--F],B.prev[F]=V>=u?V-u:0}while(--Z);p+=u}if(0===B.strm.avail_in)break;if(Z=c(B.strm,B.window,B.strstart+B.lookahead,p),B.lookahead+=Z,B.lookahead+B.insert>=3)for(G=B.strstart-B.insert,B.ins_h=B.window[G],B.ins_h=H(B,B.ins_h,B.window[G+1]);B.insert&&(B.ins_h=H(B,B.ins_h,B.window[G+3-1]),B.prev[G&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=G,G++,B.insert--,!(B.lookahead+B.insert<3)););}while(B.lookahead<M&&0!==B.strm.avail_in)},r=(B,u)=>{let F,Z;for(;;){if(B.lookahead<M){if(i(B),B.lookahead<M&&u===Q)return 1;if(0===B.lookahead)break}if(F=0,B.lookahead>=3&&(B.ins_h=H(B,B.ins_h,B.window[B.strstart+3-1]),F=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),0!==F&&B.strstart-F<=B.w_size-M&&(B.match_length=h(B,F)),B.match_length>=3)if(Z=G(B,B.strstart-B.match_start,B.match_length-3),B.lookahead-=B.match_length,B.match_length<=B.max_lazy_match&&B.lookahead>=3){B.match_length--;do{B.strstart++,B.ins_h=H(B,B.ins_h,B.window[B.strstart+3-1]),F=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart}while(0!==--B.match_length);B.strstart++}else B.strstart+=B.match_length,B.match_length=0,B.ins_h=B.window[B.strstart],B.ins_h=H(B,B.ins_h,B.window[B.strstart+1]);else Z=G(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++;if(Z&&(d(B,!1),0===B.strm.avail_out))return 1}return B.insert=B.strstart<2?B.strstart:2,u===D?(d(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(d(B,!1),0===B.strm.avail_out)?1:2},K=(B,u)=>{let F,Z,V;for(;;){if(B.lookahead<M){if(i(B),B.lookahead<M&&u===Q)return 1;if(0===B.lookahead)break}if(F=0,B.lookahead>=3&&(B.ins_h=H(B,B.ins_h,B.window[B.strstart+3-1]),F=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart),B.prev_length=B.match_length,B.prev_match=B.match_start,B.match_length=2,0!==F&&B.prev_length<B.max_lazy_match&&B.strstart-F<=B.w_size-M&&(B.match_length=h(B,F),B.match_length<=5&&(B.strategy===U||3===B.match_length&&B.strstart-B.match_start>4096)&&(B.match_length=2)),B.prev_length>=3&&B.match_length<=B.prev_length){V=B.strstart+B.lookahead-3,Z=G(B,B.strstart-1-B.prev_match,B.prev_length-3),B.lookahead-=B.prev_length-1,B.prev_length-=2;do{++B.strstart<=V&&(B.ins_h=H(B,B.ins_h,B.window[B.strstart+3-1]),F=B.prev[B.strstart&B.w_mask]=B.head[B.ins_h],B.head[B.ins_h]=B.strstart)}while(0!==--B.prev_length);if(B.match_available=0,B.match_length=2,B.strstart++,Z&&(d(B,!1),0===B.strm.avail_out))return 1}else if(B.match_available){if(Z=G(B,0,B.window[B.strstart-1]),Z&&d(B,!1),B.strstart++,B.lookahead--,0===B.strm.avail_out)return 1}else B.match_available=1,B.strstart++,B.lookahead--}return B.match_available&&(Z=G(B,0,B.window[B.strstart-1]),B.match_available=0),B.insert=B.strstart<2?B.strstart:2,u===D?(d(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(d(B,!1),0===B.strm.avail_out)?1:2};function N(B,u,F,Z,V){this.good_length=B,this.max_lazy=u,this.nice_length=F,this.max_chain=Z,this.func=V}const A=[new N(0,0,0,0,((B,u)=>{let F=65535;for(F>B.pending_buf_size-5&&(F=B.pending_buf_size-5);;){if(B.lookahead<=1){if(i(B),0===B.lookahead&&u===Q)return 1;if(0===B.lookahead)break}B.strstart+=B.lookahead,B.lookahead=0;const Z=B.block_start+F;if((0===B.strstart||B.strstart>=Z)&&(B.lookahead=B.strstart-Z,B.strstart=Z,d(B,!1),0===B.strm.avail_out))return 1;if(B.strstart-B.block_start>=B.w_size-M&&(d(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,u===D?(d(B,!0),0===B.strm.avail_out?3:4):(B.strstart>B.block_start&&(d(B,!1),B.strm.avail_out),1)})),new N(4,4,8,4,r),new N(4,5,16,8,r),new N(4,6,32,32,r),new N(4,4,16,16,K),new N(8,16,32,32,K),new N(8,16,128,128,K),new N(8,32,128,256,K),new N(32,128,258,1024,K),new N(32,258,258,4096,K)];function b(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),w(this.dyn_ltree),w(this.dyn_dtree),w(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),w(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),w(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const k=B=>{if(!B||!B.state)return mB(B,X);B.total_in=B.total_out=0,B.data_type=a;const u=B.state;return u.pending=0,u.pending_out=0,u.wrap<0&&(u.wrap=-u.wrap),u.status=u.wrap?42:o,B.adler=2===u.wrap?0:1,u.last_flush=Q,Z(u),q},S=B=>{const u=k(B);var F;return u===q&&((F=B.state).window_size=2*F.w_size,w(F.head),F.max_lazy_match=A[F.level].max_lazy,F.good_match=A[F.level].good_length,F.nice_match=A[F.level].nice_length,F.max_chain_length=A[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=2,F.match_available=0,F.ins_h=0),u},BB=(B,u,F,Z,V,p)=>{if(!B)return X;let G=1;if(u===x&&(u=6),Z<0?(G=0,Z=-Z):Z>15&&(G=2,Z-=16),V<1||V>9||F!==T||Z<8||Z>15||u<0||u>9||p<0||p>g)return mB(B,X);8===Z&&(Z=9);const R=new b;return B.state=R,R.strm=B,R.wrap=G,R.gzhead=null,R.w_bits=Z,R.w_size=1<<R.w_bits,R.w_mask=R.w_size-1,R.hash_bits=V+7,R.hash_size=1<<R.hash_bits,R.hash_mask=R.hash_size-1,R.hash_shift=~~((R.hash_bits+3-1)/3),R.window=new Uint8Array(2*R.w_size),R.head=new Uint16Array(R.hash_size),R.prev=new Uint16Array(R.w_size),R.lit_bufsize=1<<V+6,R.pending_buf_size=4*R.lit_bufsize,R.pending_buf=new Uint8Array(R.pending_buf_size),R.d_buf=1*R.lit_bufsize,R.l_buf=3*R.lit_bufsize,R.level=u,R.strategy=p,R.method=F,S(B)};B.exports.deflateInit=(B,u)=>BB(B,u,T,15,8,J),B.exports.deflateInit2=BB,B.exports.deflateReset=S,B.exports.deflateResetKeep=k,B.exports.deflateSetHeader=(B,u)=>B&&B.state?2!==B.state.wrap?X:(B.state.gzhead=u,q):X,B.exports.deflate=(B,u)=>{let F,Z;if(!B||!B.state||u>L||u<0)return B?mB(B,X):X;const p=B.state;if(!B.output||!B.input&&0!==B.avail_in||p.status===I&&u!==D)return mB(B,0===B.avail_out?C:X);p.strm=B;const e=p.last_flush;if(p.last_flush=u,42===p.status)if(2===p.wrap)B.adler=0,l(p,31),l(p,139),l(p,8),p.gzhead?(l(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),l(p,255&p.gzhead.time),l(p,p.gzhead.time>>8&255),l(p,p.gzhead.time>>16&255),l(p,p.gzhead.time>>24&255),l(p,9===p.level?2:p.strategy>=y||p.level<2?4:0),l(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(l(p,255&p.gzhead.extra.length),l(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(B.adler=s(B.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=69):(l(p,0),l(p,0),l(p,0),l(p,0),l(p,0),l(p,9===p.level?2:p.strategy>=y||p.level<2?4:0),l(p,3),p.status=o);else{let u=T+(p.w_bits-8<<4)<<8,F=-1;F=p.strategy>=y||p.level<2?0:p.level<6?1:6===p.level?2:3,u|=F<<6,0!==p.strstart&&(u|=32),u+=31-u%31,p.status=o,P(p,u),0!==p.strstart&&(P(p,B.adler>>>16),P(p,65535&B.adler)),B.adler=1}if(69===p.status)if(p.gzhead.extra){for(F=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>F&&(B.adler=s(B.adler,p.pending_buf,p.pending-F,F)),n(B),F=p.pending,p.pending!==p.pending_buf_size));)l(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>F&&(B.adler=s(B.adler,p.pending_buf,p.pending-F,F)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=73)}else p.status=73;if(73===p.status)if(p.gzhead.name){F=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>F&&(B.adler=s(B.adler,p.pending_buf,p.pending-F,F)),n(B),F=p.pending,p.pending===p.pending_buf_size)){Z=1;break}Z=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,l(p,Z)}while(0!==Z);p.gzhead.hcrc&&p.pending>F&&(B.adler=s(B.adler,p.pending_buf,p.pending-F,F)),0===Z&&(p.gzindex=0,p.status=91)}else p.status=91;if(91===p.status)if(p.gzhead.comment){F=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>F&&(B.adler=s(B.adler,p.pending_buf,p.pending-F,F)),n(B),F=p.pending,p.pending===p.pending_buf_size)){Z=1;break}Z=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,l(p,Z)}while(0!==Z);p.gzhead.hcrc&&p.pending>F&&(B.adler=s(B.adler,p.pending_buf,p.pending-F,F)),0===Z&&(p.status=j)}else p.status=j;if(p.status===j&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&n(B),p.pending+2<=p.pending_buf_size&&(l(p,255&B.adler),l(p,B.adler>>8&255),B.adler=0,p.status=o)):p.status=o),0!==p.pending){if(n(B),0===B.avail_out)return p.last_flush=-1,q}else if(0===B.avail_in&&E(u)<=E(e)&&u!==D)return mB(B,C);if(p.status===I&&0!==B.avail_in)return mB(B,C);if(0!==B.avail_in||0!==p.lookahead||u!==Q&&p.status!==I){let F=p.strategy===y?((B,u)=>{let F;for(;;){if(0===B.lookahead&&(i(B),0===B.lookahead)){if(u===Q)return 1;break}if(B.match_length=0,F=G(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,F&&(d(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,u===D?(d(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(d(B,!1),0===B.strm.avail_out)?1:2})(p,u):p.strategy===O?((B,u)=>{let F,Z,V,p;const R=B.window;for(;;){if(B.lookahead<=z){if(i(B),B.lookahead<=z&&u===Q)return 1;if(0===B.lookahead)break}if(B.match_length=0,B.lookahead>=3&&B.strstart>0&&(V=B.strstart-1,Z=R[V],Z===R[++V]&&Z===R[++V]&&Z===R[++V])){p=B.strstart+z;do{}while(Z===R[++V]&&Z===R[++V]&&Z===R[++V]&&Z===R[++V]&&Z===R[++V]&&Z===R[++V]&&Z===R[++V]&&Z===R[++V]&&V<p);B.match_length=z-(p-V),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=3?(F=G(B,1,B.match_length-3),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(F=G(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),F&&(d(B,!1),0===B.strm.avail_out))return 1}return B.insert=0,u===D?(d(B,!0),0===B.strm.avail_out?3:4):B.last_lit&&(d(B,!1),0===B.strm.avail_out)?1:2})(p,u):A[p.level].func(p,u);if(3!==F&&4!==F||(p.status=I),1===F||3===F)return 0===B.avail_out&&(p.last_flush=-1),q;if(2===F&&(u===t?R(p):u!==L&&(V(p,0,0,!1),u===v&&(w(p.head),0===p.lookahead&&(p.strstart=0,p.block_start=0,p.insert=0))),n(B),0===B.avail_out))return p.last_flush=-1,q}return u!==D?q:p.wrap<=0?W:(2===p.wrap?(l(p,255&B.adler),l(p,B.adler>>8&255),l(p,B.adler>>16&255),l(p,B.adler>>24&255),l(p,255&B.total_in),l(p,B.total_in>>8&255),l(p,B.total_in>>16&255),l(p,B.total_in>>24&255)):(P(p,B.adler>>>16),P(p,65535&B.adler)),n(B),p.wrap>0&&(p.wrap=-p.wrap),0!==p.pending?q:W)},B.exports.deflateEnd=B=>{if(!B||!B.state)return X;const u=B.state.status;return 42!==u&&69!==u&&73!==u&&91!==u&&u!==j&&u!==o&&u!==I?mB(B,X):(B.state=null,u===o?mB(B,f):q)},B.exports.deflateSetDictionary=(B,u)=>{let F=u.length;if(!B||!B.state)return X;const Z=B.state,V=Z.wrap;if(2===V||1===V&&42!==Z.status||Z.lookahead)return X;if(1===V&&(B.adler=e(B.adler,u,F,0)),Z.wrap=0,F>=Z.w_size){0===V&&(w(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0);let B=new Uint8Array(Z.w_size);B.set(u.subarray(F-Z.w_size,F),0),u=B,F=Z.w_size}const p=B.avail_in,G=B.next_in,R=B.input;for(B.avail_in=F,B.next_in=0,B.input=u,i(Z);Z.lookahead>=3;){let B=Z.strstart,u=Z.lookahead-2;do{Z.ins_h=H(Z,Z.ins_h,Z.window[B+3-1]),Z.prev[B&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=B,B++}while(--u);Z.strstart=B,Z.lookahead=2,i(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=2,Z.match_available=0,B.next_in=G,B.input=R,B.avail_in=p,Z.wrap=V,q},B.exports.deflateInfo="pako deflate (from Nodeca project)"},14144:B=>{"use strict";B.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},14130:B=>{"use strict";B.exports=function(B,u){let F,Z,V,p,G,R,e,s,Y,Q,t,v,D,L,q,W,X,f,C,x,U,y,O,g;const J=B.state;F=B.next_in,O=B.input,Z=F+(B.avail_in-5),V=B.next_out,g=B.output,p=V-(u-B.avail_out),G=V+(B.avail_out-257),R=J.dmax,e=J.wsize,s=J.whave,Y=J.wnext,Q=J.window,t=J.hold,v=J.bits,D=J.lencode,L=J.distcode,q=(1<<J.lenbits)-1,W=(1<<J.distbits)-1;B:do{v<15&&(t+=O[F++]<<v,v+=8,t+=O[F++]<<v,v+=8),X=D[t&q];u:for(;;){if(f=X>>>24,t>>>=f,v-=f,f=X>>>16&255,0===f)g[V++]=65535&X;else{if(!(16&f)){if(0===(64&f)){X=D[(65535&X)+(t&(1<<f)-1)];continue u}if(32&f){J.mode=12;break B}B.su="invalid literal/length code",J.mode=30;break B}C=65535&X,f&=15,f&&(v<f&&(t+=O[F++]<<v,v+=8),C+=t&(1<<f)-1,t>>>=f,v-=f),v<15&&(t+=O[F++]<<v,v+=8,t+=O[F++]<<v,v+=8),X=L[t&W];F:for(;;){if(f=X>>>24,t>>>=f,v-=f,f=X>>>16&255,!(16&f)){if(0===(64&f)){X=L[(65535&X)+(t&(1<<f)-1)];continue F}B.su="invalid distance code",J.mode=30;break B}if(x=65535&X,f&=15,v<f&&(t+=O[F++]<<v,v+=8,v<f&&(t+=O[F++]<<v,v+=8)),x+=t&(1<<f)-1,x>R){B.su="invalid distance too far back",J.mode=30;break B}if(t>>>=f,v-=f,f=V-p,x>f){if(f=x-f,f>s&&J.sane){B.su="invalid distance too far back",J.mode=30;break B}if(U=0,y=Q,0===Y){if(U+=e-f,f<C){C-=f;do{g[V++]=Q[U++]}while(--f);U=V-x,y=g}}else if(Y<f){if(U+=e+Y-f,f-=Y,f<C){C-=f;do{g[V++]=Q[U++]}while(--f);if(U=0,Y<C){f=Y,C-=f;do{g[V++]=Q[U++]}while(--f);U=V-x,y=g}}}else if(U+=Y-f,f<C){C-=f;do{g[V++]=Q[U++]}while(--f);U=V-x,y=g}for(;C>2;)g[V++]=y[U++],g[V++]=y[U++],g[V++]=y[U++],C-=3;C&&(g[V++]=y[U++],C>1&&(g[V++]=y[U++]))}else{U=V-x;do{g[V++]=g[U++],g[V++]=g[U++],g[V++]=g[U++],C-=3}while(C>2);C&&(g[V++]=g[U++],C>1&&(g[V++]=g[U++]))}break}}break}}while(F<Z&&V<G);C=v>>3,F-=C,v-=C<<3,t&=(1<<v)-1,B.next_in=F,B.next_out=V,B.avail_in=F<Z?Z-F+5:5-(F-Z),B.avail_out=V<G?G-V+257:257-(V-G),J.hold=t,J.bits=v}},14128:(B,u,F)=>{"use strict";const Z=F(14081),V=F(14089),p=F(14130),G=F(14136),{Z_FINISH:R,Z_BLOCK:e,Z_TREES:s,Z_OK:Y,Z_STREAM_END:Q,Z_NEED_DICT:t,Z_STREAM_ERROR:v,Z_DATA_ERROR:D,Z_MEM_ERROR:L,Z_BUF_ERROR:q,Z_DEFLATED:W}=F(14093),X=12,f=30,C=B=>(B>>>24&255)+(B>>>8&65280)+((65280&B)<<8)+((255&B)<<24);function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const U=B=>{if(!B||!B.state)return v;const u=B.state;return B.total_in=B.total_out=u.total=0,B.su="",u.wrap&&(B.adler=1&u.wrap),u.mode=1,u.last=0,u.havedict=0,u.dmax=32768,u.head=null,u.hold=0,u.bits=0,u.lencode=u.lendyn=new Int32Array(852),u.distcode=u.distdyn=new Int32Array(592),u.sane=1,u.back=-1,Y},y=B=>{if(!B||!B.state)return v;const u=B.state;return u.wsize=0,u.whave=0,u.wnext=0,U(B)},O=(B,u)=>{let F;if(!B||!B.state)return v;const Z=B.state;return u<0?(F=0,u=-u):(F=1+(u>>4),u<48&&(u&=15)),u&&(u<8||u>15)?v:(null!==Z.window&&Z.wbits!==u&&(Z.window=null),Z.wrap=F,Z.wbits=u,y(B))},g=(B,u)=>{if(!B)return v;const F=new x;B.state=F,F.window=null;const Z=O(B,u);return Z!==Y&&(B.state=null),Z};let J,a,T=!0;const z=B=>{if(T){J=new Int32Array(512),a=new Int32Array(32);let u=0;for(;u<144;)B.lens[u++]=8;for(;u<256;)B.lens[u++]=9;for(;u<280;)B.lens[u++]=7;for(;u<288;)B.lens[u++]=8;for(G(1,B.lens,0,288,J,0,B.work,{bits:9}),u=0;u<32;)B.lens[u++]=5;G(2,B.lens,0,32,a,0,B.work,{bits:5}),T=!1}B.lencode=J,B.lenbits=9,B.distcode=a,B.distbits=5},M=(B,u,F,Z)=>{let V;const p=B.state;return null===p.window&&(p.wsize=1<<p.wbits,p.wnext=0,p.whave=0,p.window=new Uint8Array(p.wsize)),Z>=p.wsize?(p.window.set(u.subarray(F-p.wsize,F),0),p.wnext=0,p.whave=p.wsize):(V=p.wsize-p.wnext,V>Z&&(V=Z),p.window.set(u.subarray(F-Z,F-Z+V),p.wnext),(Z-=V)?(p.window.set(u.subarray(F-Z,F),0),p.wnext=Z,p.whave=p.wsize):(p.wnext+=V,p.wnext===p.wsize&&(p.wnext=0),p.whave<p.wsize&&(p.whave+=V))),0};B.exports.inflateReset=y,B.exports.inflateReset2=O,B.exports.inflateResetKeep=U,B.exports.inflateInit=B=>g(B,15),B.exports.inflateInit2=g,B.exports.inflate=(B,u)=>{let F,x,U,y,O,g,J,a,T,j,o,I,mB,E,w,H,n,d,l,P,c,h,i=0;const r=new Uint8Array(4);let K,N;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!B||!B.state||!B.output||!B.input&&0!==B.avail_in)return v;F=B.state,F.mode===X&&(F.mode=13),O=B.next_out,U=B.output,J=B.avail_out,y=B.next_in,x=B.input,g=B.avail_in,a=F.hold,T=F.bits,j=g,o=J,h=Y;B:for(;;)switch(F.mode){case 1:if(0===F.wrap){F.mode=13;break}for(;T<16;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(2&F.wrap&&35615===a){F.check=0,r[0]=255&a,r[1]=a>>>8&255,F.check=V(F.check,r,2,0),a=0,T=0,F.mode=2;break}if(F.flags=0,F.head&&(F.head.done=!1),!(1&F.wrap)||(((255&a)<<8)+(a>>8))%31){B.su="incorrect header check",F.mode=f;break}if((15&a)!==W){B.su="unknown compression method",F.mode=f;break}if(a>>>=4,T-=4,c=8+(15&a),0===F.wbits)F.wbits=c;else if(c>F.wbits){B.su="invalid window size",F.mode=f;break}F.dmax=1<<F.wbits,B.adler=F.check=1,F.mode=512&a?10:X,a=0,T=0;break;case 2:for(;T<16;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(F.flags=a,(255&F.flags)!==W){B.su="unknown compression method",F.mode=f;break}if(57344&F.flags){B.su="unknown header flags set",F.mode=f;break}F.head&&(F.head.text=a>>8&1),512&F.flags&&(r[0]=255&a,r[1]=a>>>8&255,F.check=V(F.check,r,2,0)),a=0,T=0,F.mode=3;case 3:for(;T<32;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}F.head&&(F.head.time=a),512&F.flags&&(r[0]=255&a,r[1]=a>>>8&255,r[2]=a>>>16&255,r[3]=a>>>24&255,F.check=V(F.check,r,4,0)),a=0,T=0,F.mode=4;case 4:for(;T<16;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}F.head&&(F.head.xflags=255&a,F.head.os=a>>8),512&F.flags&&(r[0]=255&a,r[1]=a>>>8&255,F.check=V(F.check,r,2,0)),a=0,T=0,F.mode=5;case 5:if(1024&F.flags){for(;T<16;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}F.length=a,F.head&&(F.head.extra_len=a),512&F.flags&&(r[0]=255&a,r[1]=a>>>8&255,F.check=V(F.check,r,2,0)),a=0,T=0}else F.head&&(F.head.extra=null);F.mode=6;case 6:if(1024&F.flags&&(I=F.length,I>g&&(I=g),I&&(F.head&&(c=F.head.extra_len-F.length,F.head.extra||(F.head.extra=new Uint8Array(F.head.extra_len)),F.head.extra.set(x.subarray(y,y+I),c)),512&F.flags&&(F.check=V(F.check,x,I,y)),g-=I,y+=I,F.length-=I),F.length))break B;F.length=0,F.mode=7;case 7:if(2048&F.flags){if(0===g)break B;I=0;do{c=x[y+I++],F.head&&c&&F.length<65536&&(F.head.name+=String.fromCharCode(c))}while(c&&I<g);if(512&F.flags&&(F.check=V(F.check,x,I,y)),g-=I,y+=I,c)break B}else F.head&&(F.head.name=null);F.length=0,F.mode=8;case 8:if(4096&F.flags){if(0===g)break B;I=0;do{c=x[y+I++],F.head&&c&&F.length<65536&&(F.head.comment+=String.fromCharCode(c))}while(c&&I<g);if(512&F.flags&&(F.check=V(F.check,x,I,y)),g-=I,y+=I,c)break B}else F.head&&(F.head.comment=null);F.mode=9;case 9:if(512&F.flags){for(;T<16;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(a!==(65535&F.check)){B.su="header crc mismatch",F.mode=f;break}a=0,T=0}F.head&&(F.head.hcrc=F.flags>>9&1,F.head.done=!0),B.adler=F.check=0,F.mode=X;break;case 10:for(;T<32;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}B.adler=F.check=C(a),a=0,T=0,F.mode=11;case 11:if(0===F.havedict)return B.next_out=O,B.avail_out=J,B.next_in=y,B.avail_in=g,F.hold=a,F.bits=T,t;B.adler=F.check=1,F.mode=X;case X:if(u===e||u===s)break B;case 13:if(F.last){a>>>=7&T,T-=7&T,F.mode=27;break}for(;T<3;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}switch(F.last=1&a,a>>>=1,T-=1,3&a){case 0:F.mode=14;break;case 1:if(z(F),F.mode=20,u===s){a>>>=2,T-=2;break B}break;case 2:F.mode=17;break;case 3:B.su="invalid block type",F.mode=f}a>>>=2,T-=2;break;case 14:for(a>>>=7&T,T-=7&T;T<32;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if((65535&a)!==(a>>>16^65535)){B.su="invalid stored block lengths",F.mode=f;break}if(F.length=65535&a,a=0,T=0,F.mode=15,u===s)break B;case 15:F.mode=16;case 16:if(I=F.length,I){if(I>g&&(I=g),I>J&&(I=J),0===I)break B;U.set(x.subarray(y,y+I),O),g-=I,y+=I,J-=I,O+=I,F.length-=I;break}F.mode=X;break;case 17:for(;T<14;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(F.nlen=257+(31&a),a>>>=5,T-=5,F.ndist=1+(31&a),a>>>=5,T-=5,F.ncode=4+(15&a),a>>>=4,T-=4,F.nlen>286||F.ndist>30){B.su="too many length or distance symbols",F.mode=f;break}F.have=0,F.mode=18;case 18:for(;F.have<F.ncode;){for(;T<3;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}F.lens[A[F.have++]]=7&a,a>>>=3,T-=3}for(;F.have<19;)F.lens[A[F.have++]]=0;if(F.lencode=F.lendyn,F.lenbits=7,K={bits:F.lenbits},h=G(0,F.lens,0,19,F.lencode,0,F.work,K),F.lenbits=K.bits,h){B.su="invalid code lengths set",F.mode=f;break}F.have=0,F.mode=19;case 19:for(;F.have<F.nlen+F.ndist;){for(;i=F.lencode[a&(1<<F.lenbits)-1],w=i>>>24,H=i>>>16&255,n=65535&i,!(w<=T);){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(n<16)a>>>=w,T-=w,F.lens[F.have++]=n;else{if(16===n){for(N=w+2;T<N;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(a>>>=w,T-=w,0===F.have){B.su="invalid bit length repeat",F.mode=f;break}c=F.lens[F.have-1],I=3+(3&a),a>>>=2,T-=2}else if(17===n){for(N=w+3;T<N;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}a>>>=w,T-=w,c=0,I=3+(7&a),a>>>=3,T-=3}else{for(N=w+7;T<N;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}a>>>=w,T-=w,c=0,I=11+(127&a),a>>>=7,T-=7}if(F.have+I>F.nlen+F.ndist){B.su="invalid bit length repeat",F.mode=f;break}for(;I--;)F.lens[F.have++]=c}}if(F.mode===f)break;if(0===F.lens[256]){B.su="invalid code -- missing end-of-block",F.mode=f;break}if(F.lenbits=9,K={bits:F.lenbits},h=G(1,F.lens,0,F.nlen,F.lencode,0,F.work,K),F.lenbits=K.bits,h){B.su="invalid literal/lengths set",F.mode=f;break}if(F.distbits=6,F.distcode=F.distdyn,K={bits:F.distbits},h=G(2,F.lens,F.nlen,F.ndist,F.distcode,0,F.work,K),F.distbits=K.bits,h){B.su="invalid distances set",F.mode=f;break}if(F.mode=20,u===s)break B;case 20:F.mode=21;case 21:if(g>=6&&J>=258){B.next_out=O,B.avail_out=J,B.next_in=y,B.avail_in=g,F.hold=a,F.bits=T,p(B,o),O=B.next_out,U=B.output,J=B.avail_out,y=B.next_in,x=B.input,g=B.avail_in,a=F.hold,T=F.bits,F.mode===X&&(F.back=-1);break}for(F.back=0;i=F.lencode[a&(1<<F.lenbits)-1],w=i>>>24,H=i>>>16&255,n=65535&i,!(w<=T);){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(H&&0===(240&H)){for(d=w,l=H,P=n;i=F.lencode[P+((a&(1<<d+l)-1)>>d)],w=i>>>24,H=i>>>16&255,n=65535&i,!(d+w<=T);){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}a>>>=d,T-=d,F.back+=d}if(a>>>=w,T-=w,F.back+=w,F.length=n,0===H){F.mode=26;break}if(32&H){F.back=-1,F.mode=X;break}if(64&H){B.su="invalid literal/length code",F.mode=f;break}F.extra=15&H,F.mode=22;case 22:if(F.extra){for(N=F.extra;T<N;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}F.length+=a&(1<<F.extra)-1,a>>>=F.extra,T-=F.extra,F.back+=F.extra}F.was=F.length,F.mode=23;case 23:for(;i=F.distcode[a&(1<<F.distbits)-1],w=i>>>24,H=i>>>16&255,n=65535&i,!(w<=T);){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(0===(240&H)){for(d=w,l=H,P=n;i=F.distcode[P+((a&(1<<d+l)-1)>>d)],w=i>>>24,H=i>>>16&255,n=65535&i,!(d+w<=T);){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}a>>>=d,T-=d,F.back+=d}if(a>>>=w,T-=w,F.back+=w,64&H){B.su="invalid distance code",F.mode=f;break}F.offset=n,F.extra=15&H,F.mode=24;case 24:if(F.extra){for(N=F.extra;T<N;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}F.offset+=a&(1<<F.extra)-1,a>>>=F.extra,T-=F.extra,F.back+=F.extra}if(F.offset>F.dmax){B.su="invalid distance too far back",F.mode=f;break}F.mode=25;case 25:if(0===J)break B;if(I=o-J,F.offset>I){if(I=F.offset-I,I>F.whave&&F.sane){B.su="invalid distance too far back",F.mode=f;break}I>F.wnext?(I-=F.wnext,mB=F.wsize-I):mB=F.wnext-I,I>F.length&&(I=F.length),E=F.window}else E=U,mB=O-F.offset,I=F.length;I>J&&(I=J),J-=I,F.length-=I;do{U[O++]=E[mB++]}while(--I);0===F.length&&(F.mode=21);break;case 26:if(0===J)break B;U[O++]=F.length,J--,F.mode=21;break;case 27:if(F.wrap){for(;T<32;){if(0===g)break B;g--,a|=x[y++]<<T,T+=8}if(o-=J,B.total_out+=o,F.total+=o,o&&(B.adler=F.check=F.flags?V(F.check,U,o,O-o):Z(F.check,U,o,O-o)),o=J,(F.flags?a:C(a))!==F.check){B.su="incorrect data check",F.mode=f;break}a=0,T=0}F.mode=28;case 28:if(F.wrap&&F.flags){for(;T<32;){if(0===g)break B;g--,a+=x[y++]<<T,T+=8}if(a!==(4294967295&F.total)){B.su="incorrect length check",F.mode=f;break}a=0,T=0}F.mode=29;case 29:h=Q;break B;case f:h=D;break B;case 31:return L;default:return v}return B.next_out=O,B.avail_out=J,B.next_in=y,B.avail_in=g,F.hold=a,F.bits=T,(F.wsize||o!==B.avail_out&&F.mode<f&&(F.mode<27||u!==R))&&M(B,B.output,B.next_out,o-B.avail_out)?(F.mode=31,L):(j-=B.avail_in,o-=B.avail_out,B.total_in+=j,B.total_out+=o,F.total+=o,F.wrap&&o&&(B.adler=F.check=F.flags?V(F.check,U,o,B.next_out-o):Z(F.check,U,o,B.next_out-o)),B.data_type=F.bits+(F.last?64:0)+(F.mode===X?128:0)+(20===F.mode||15===F.mode?256:0),(0===j&&0===o||u===R)&&h===Y&&(h=q),h)},B.exports.inflateEnd=B=>{if(!B||!B.state)return v;let u=B.state;return u.window&&(u.window=null),B.state=null,Y},B.exports.inflateGetHeader=(B,u)=>{if(!B||!B.state)return v;const F=B.state;return 0===(2&F.wrap)?v:(F.head=u,u.done=!1,Y)},B.exports.inflateSetDictionary=(B,u)=>{const F=u.length;let V,p,G;return B&&B.state?(V=B.state,0!==V.wrap&&11!==V.mode?v:11===V.mode&&(p=1,p=Z(p,u,F,0),p!==V.check)?D:(G=M(B,u,F,F),G?(V.mode=31,L):(V.havedict=1,Y))):v},B.exports.inflateInfo="pako inflate (from Nodeca project)"},14136:B=>{"use strict";const u=15,F=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),V=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),p=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);B.exports=(B,G,R,e,s,Y,Q,t)=>{const v=t.bits;let D,L,q,W,X,f,C=0,x=0,U=0,y=0,O=0,g=0,J=0,a=0,T=0,z=0,M=null,j=0;const o=new Uint16Array(16),I=new Uint16Array(16);let mB,E,w,H=null,n=0;for(C=0;C<=u;C++)o[C]=0;for(x=0;x<e;x++)o[G[R+x]]++;for(O=v,y=u;y>=1&&0===o[y];y--);if(O>y&&(O=y),0===y)return s[Y++]=20971520,s[Y++]=20971520,t.bits=1,0;for(U=1;U<y&&0===o[U];U++);for(O<U&&(O=U),a=1,C=1;C<=u;C++)if(a<<=1,a-=o[C],a<0)return-1;if(a>0&&(0===B||1!==y))return-1;for(I[1]=0,C=1;C<u;C++)I[C+1]=I[C]+o[C];for(x=0;x<e;x++)0!==G[R+x]&&(Q[I[G[R+x]]++]=x);if(0===B?(M=H=Q,f=19):1===B?(M=F,j-=257,H=Z,n-=257,f=256):(M=V,H=p,f=-1),z=0,x=0,C=U,X=Y,g=O,J=0,q=-1,T=1<<O,W=T-1,1===B&&T>852||2===B&&T>592)return 1;for(;;){mB=C-J,Q[x]<f?(E=0,w=Q[x]):Q[x]>f?(E=H[n+Q[x]],w=M[j+Q[x]]):(E=96,w=0),D=1<<C-J,L=1<<g,U=L;do{L-=D,s[X+(z>>J)+L]=mB<<24|E<<16|w}while(0!==L);for(D=1<<C-1;z&D;)D>>=1;if(0!==D?(z&=D-1,z+=D):z=0,x++,0===--o[C]){if(C===y)break;C=G[R+Q[x]]}if(C>O&&(z&W)!==q){for(0===J&&(J=O),X+=U,g=C-J,a=1<<g;g+J<y&&(a-=o[g+J],!(a<=0));)g++,a<<=1;if(T+=1<<g,1===B&&T>852||2===B&&T>592)return 1;q=z&W,s[q]=O<<24|g<<16|X-Y}}return 0!==z&&(s[X+z]=C-J<<24|64<<16),t.bits=O,0}},14091:B=>{"use strict";B.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},14073:B=>{"use strict";function u(B){let u=B.length;for(;--u>=0;)B[u]=0}const F=256,Z=286,V=30,p=15,G=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),R=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Y=new Array(576);u(Y);const Q=new Array(60);u(Q);const t=new Array(512);u(t);const v=new Array(256);u(v);const D=new Array(29);u(D);const L=new Array(V);function q(B,u,F,Z,V){this.static_tree=B,this.extra_bits=u,this.extra_base=F,this.elems=Z,this.max_length=V,this.has_stree=B&&B.length}let W,X,f;function C(B,u){this.dyn_tree=B,this.max_code=0,this.stat_desc=u}u(L);const x=B=>B<256?t[B]:t[256+(B>>>7)],U=(B,u)=>{B.pending_buf[B.pending++]=255&u,B.pending_buf[B.pending++]=u>>>8&255},y=(B,u,F)=>{B.bi_valid>16-F?(B.bi_buf|=u<<B.bi_valid&65535,U(B,B.bi_buf),B.bi_buf=u>>16-B.bi_valid,B.bi_valid+=F-16):(B.bi_buf|=u<<B.bi_valid&65535,B.bi_valid+=F)},O=(B,u,F)=>{y(B,F[2*u],F[2*u+1])},g=(B,u)=>{let F=0;do{F|=1&B,B>>>=1,F<<=1}while(--u>0);return F>>>1},J=(B,u,F)=>{const Z=new Array(16);let V,G,R=0;for(V=1;V<=p;V++)Z[V]=R=R+F[V-1]<<1;for(G=0;G<=u;G++){let u=B[2*G+1];0!==u&&(B[2*G]=g(Z[u]++,u))}},a=B=>{let u;for(u=0;u<Z;u++)B.dyn_ltree[2*u]=0;for(u=0;u<V;u++)B.dyn_dtree[2*u]=0;for(u=0;u<19;u++)B.bl_tree[2*u]=0;B.dyn_ltree[512]=1,B.opt_len=B.static_len=0,B.last_lit=B.matches=0},T=B=>{B.bi_valid>8?U(B,B.bi_buf):B.bi_valid>0&&(B.pending_buf[B.pending++]=B.bi_buf),B.bi_buf=0,B.bi_valid=0},z=(B,u,F,Z)=>{const V=2*u,p=2*F;return B[V]<B[p]||B[V]===B[p]&&Z[u]<=Z[F]},M=(B,u,F)=>{const Z=B.heap[F];let V=F<<1;for(;V<=B.heap_len&&(V<B.heap_len&&z(u,B.heap[V+1],B.heap[V],B.depth)&&V++,!z(u,Z,B.heap[V],B.depth));)B.heap[F]=B.heap[V],F=V,V<<=1;B.heap[F]=Z},j=(B,u,Z)=>{let V,p,e,s,Y=0;if(0!==B.last_lit)do{V=B.pending_buf[B.d_buf+2*Y]<<8|B.pending_buf[B.d_buf+2*Y+1],p=B.pending_buf[B.l_buf+Y],Y++,0===V?O(B,p,u):(e=v[p],O(B,e+F+1,u),s=G[e],0!==s&&(p-=D[e],y(B,p,s)),V--,e=x(V),O(B,e,Z),s=R[e],0!==s&&(V-=L[e],y(B,V,s)))}while(Y<B.last_lit);O(B,256,u)},o=(B,u)=>{const F=u.dyn_tree,Z=u.stat_desc.static_tree,V=u.stat_desc.has_stree,G=u.stat_desc.elems;let R,e,s,Y=-1;for(B.heap_len=0,B.heap_max=573,R=0;R<G;R++)0!==F[2*R]?(B.heap[++B.heap_len]=Y=R,B.depth[R]=0):F[2*R+1]=0;for(;B.heap_len<2;)s=B.heap[++B.heap_len]=Y<2?++Y:0,F[2*s]=1,B.depth[s]=0,B.opt_len--,V&&(B.static_len-=Z[2*s+1]);for(u.max_code=Y,R=B.heap_len>>1;R>=1;R--)M(B,F,R);s=G;do{R=B.heap[1],B.heap[1]=B.heap[B.heap_len--],M(B,F,1),e=B.heap[1],B.heap[--B.heap_max]=R,B.heap[--B.heap_max]=e,F[2*s]=F[2*R]+F[2*e],B.depth[s]=(B.depth[R]>=B.depth[e]?B.depth[R]:B.depth[e])+1,F[2*R+1]=F[2*e+1]=s,B.heap[1]=s++,M(B,F,1)}while(B.heap_len>=2);B.heap[--B.heap_max]=B.heap[1],((B,u)=>{const F=u.dyn_tree,Z=u.max_code,V=u.stat_desc.static_tree,G=u.stat_desc.has_stree,R=u.stat_desc.extra_bits,e=u.stat_desc.extra_base,s=u.stat_desc.max_length;let Y,Q,t,v,D,L,q=0;for(v=0;v<=p;v++)B.bl_count[v]=0;for(F[2*B.heap[B.heap_max]+1]=0,Y=B.heap_max+1;Y<573;Y++)Q=B.heap[Y],v=F[2*F[2*Q+1]+1]+1,v>s&&(v=s,q++),F[2*Q+1]=v,Q>Z||(B.bl_count[v]++,D=0,Q>=e&&(D=R[Q-e]),L=F[2*Q],B.opt_len+=L*(v+D),G&&(B.static_len+=L*(V[2*Q+1]+D)));if(0!==q){do{for(v=s-1;0===B.bl_count[v];)v--;B.bl_count[v]--,B.bl_count[v+1]+=2,B.bl_count[s]--,q-=2}while(q>0);for(v=s;0!==v;v--)for(Q=B.bl_count[v];0!==Q;)t=B.heap[--Y],t>Z||(F[2*t+1]!==v&&(B.opt_len+=(v-F[2*t+1])*F[2*t],F[2*t+1]=v),Q--)}})(B,u),J(F,Y,B.bl_count)},I=(B,u,F)=>{let Z,V,p=-1,G=u[1],R=0,e=7,s=4;for(0===G&&(e=138,s=3),u[2*(F+1)+1]=65535,Z=0;Z<=F;Z++)V=G,G=u[2*(Z+1)+1],++R<e&&V===G||(R<s?B.bl_tree[2*V]+=R:0!==V?(V!==p&&B.bl_tree[2*V]++,B.bl_tree[32]++):R<=10?B.bl_tree[34]++:B.bl_tree[36]++,R=0,p=V,0===G?(e=138,s=3):V===G?(e=6,s=3):(e=7,s=4))},mB=(B,u,F)=>{let Z,V,p=-1,G=u[1],R=0,e=7,s=4;for(0===G&&(e=138,s=3),Z=0;Z<=F;Z++)if(V=G,G=u[2*(Z+1)+1],!(++R<e&&V===G)){if(R<s)do{O(B,V,B.bl_tree)}while(0!==--R);else 0!==V?(V!==p&&(O(B,V,B.bl_tree),R--),O(B,16,B.bl_tree),y(B,R-3,2)):R<=10?(O(B,17,B.bl_tree),y(B,R-3,3)):(O(B,18,B.bl_tree),y(B,R-11,7));R=0,p=V,0===G?(e=138,s=3):V===G?(e=6,s=3):(e=7,s=4)}};let E=!1;const w=(B,u,F,Z)=>{y(B,0+(Z?1:0),3),((B,u,F,Z)=>{T(B),Z&&(U(B,F),U(B,~F)),B.pending_buf.set(B.window.subarray(u,u+F),B.pending),B.pending+=F})(B,u,F,!0)};B.exports._tr_init=B=>{E||((()=>{let B,u,F,s,C;const x=new Array(16);for(F=0,s=0;s<28;s++)for(D[s]=F,B=0;B<1<<G[s];B++)v[F++]=s;for(v[F-1]=s,C=0,s=0;s<16;s++)for(L[s]=C,B=0;B<1<<R[s];B++)t[C++]=s;for(C>>=7;s<V;s++)for(L[s]=C<<7,B=0;B<1<<R[s]-7;B++)t[256+C++]=s;for(u=0;u<=p;u++)x[u]=0;for(B=0;B<=143;)Y[2*B+1]=8,B++,x[8]++;for(;B<=255;)Y[2*B+1]=9,B++,x[9]++;for(;B<=279;)Y[2*B+1]=7,B++,x[7]++;for(;B<=287;)Y[2*B+1]=8,B++,x[8]++;for(J(Y,287,x),B=0;B<V;B++)Q[2*B+1]=5,Q[2*B]=g(B,5);W=new q(Y,G,257,Z,p),X=new q(Q,R,0,V,p),f=new q(new Array(0),e,0,19,7)})(),E=!0),B.l_desc=new C(B.dyn_ltree,W),B.d_desc=new C(B.dyn_dtree,X),B.bl_desc=new C(B.bl_tree,f),B.bi_buf=0,B.bi_valid=0,a(B)},B.exports._tr_stored_block=w,B.exports._tr_flush_block=(B,u,Z,V)=>{let p,G,R=0;B.level>0?(2===B.strm.data_type&&(B.strm.data_type=(B=>{let u,Z=4093624447;for(u=0;u<=31;u++,Z>>>=1)if(1&Z&&0!==B.dyn_ltree[2*u])return 0;if(0!==B.dyn_ltree[18]||0!==B.dyn_ltree[20]||0!==B.dyn_ltree[26])return 1;for(u=32;u<F;u++)if(0!==B.dyn_ltree[2*u])return 1;return 0})(B)),o(B,B.l_desc),o(B,B.d_desc),R=(B=>{let u;for(I(B,B.dyn_ltree,B.l_desc.max_code),I(B,B.dyn_dtree,B.d_desc.max_code),o(B,B.bl_desc),u=18;u>=3&&0===B.bl_tree[2*s[u]+1];u--);return B.opt_len+=3*(u+1)+5+5+4,u})(B),p=B.opt_len+3+7>>>3,G=B.static_len+3+7>>>3,G<=p&&(p=G)):p=G=Z+5,Z+4<=p&&-1!==u?w(B,u,Z,V):4===B.strategy||G===p?(y(B,2+(V?1:0),3),j(B,Y,Q)):(y(B,4+(V?1:0),3),((B,u,F,Z)=>{let V;for(y(B,u-257,5),y(B,F-1,5),y(B,Z-4,4),V=0;V<Z;V++)y(B,B.bl_tree[2*s[V]+1],3);mB(B,B.dyn_ltree,u-1),mB(B,B.dyn_dtree,F-1)})(B,B.l_desc.max_code+1,B.d_desc.max_code+1,R+1),j(B,B.dyn_ltree,B.dyn_dtree)),a(B),V&&T(B)},B.exports._tr_tally=(B,u,Z)=>(B.pending_buf[B.d_buf+2*B.last_lit]=u>>>8&255,B.pending_buf[B.d_buf+2*B.last_lit+1]=255&u,B.pending_buf[B.l_buf+B.last_lit]=255&Z,B.last_lit++,0===u?B.dyn_ltree[2*Z]++:(B.matches++,u--,B.dyn_ltree[2*(v[Z]+F+1)]++,B.dyn_dtree[2*x(u)]++),B.last_lit===B.lit_bufsize-1),B.exports._tr_align=B=>{y(B,2,3),O(B,256,Y),(B=>{16===B.bi_valid?(U(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):B.bi_valid>=8&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)})(B)}},14114:B=>{"use strict";B.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.su="",this.state=null,this.data_type=2,this.adler=0}},13758:B=>{function u(B,u,F){for(var Z=B.length,V=-1/0,p=1/0,G=0;G<Z;G++){var R=(F[0][G]-B[G])/u[G],e=(F[1][G]-B[G])/u[G];if(R>e){var s=R;R=e,e=s}if(e<V||R>p)return 1/0;R>V&&(V=R),e<p&&(p=e)}return V>p?1/0:V}B.exports=function(B,F,Z,V){var p=u(F,Z,V);if(p===1/0)B=null;else{B=B||[];for(var G=0;G<F.length;G++)B[G]=F[G]+Z[G]*p}return B},B.exports.distance=u},15168:(B,u,F)=>{"use strict";F.d(u,{d:()=>G});var Z=F(41);const V=Z.useLayoutEffect;const p=function(B){var u=(0,Z.useRef)(B);return V((function(){u.current=B})),u};var G=function(B){var u=p(B);(0,Z.Gu)((function(){var B=function(B){var F;if(null!=u.current&&(F=u.current(B)),B.defaultPrevented&&(B.returnValue=""),"string"===typeof F)return B.returnValue=F,F};return window.addEventListener("beforeunload",B),function(){window.removeEventListener("beforeunload",B)}}),[])}},15117:(B,u,F)=>{"use strict";var Z=F(15119),V=Array.prototype.concat,p=Array.prototype.slice,G=B.exports=function(B){for(var u=[],F=0,G=B.length;F<G;F++){var R=B[F];Z(R)?u=V.call(u,p.call(R)):u.push(R)}return u};G.wrap=function(B){return function(){return B(G(arguments))}}},15119:B=>{B.exports=function(B){return!(!B||"string"===typeof B)&&(B instanceof Array||Array.isArray(B)||B.length>=0&&(B.splice instanceof Function||Object.getOwnPropertyDescriptor(B,B.length-1)&&"String"!==B.constructor.name))}},14020:(B,u,F)=>{var Z=F(14022);function V(B){for(var u,F,V=0,p=B.length,G=0;G<B.length;){for(u=B[G],F=0;G<p&&B[G]===u;)++G,++F;V+=Z.log2(F)/7|0,V+=Z.log2(u>>>0)/7|0,V+=2}return V}u.size=V,u.encode=function(B,u){u||(u=new Uint8Array(V(B)));for(var F,Z,p=0,G=u.length,R=0;R<B.length;){for(F=B[R],Z=0;R<B.length&&B[R]===F;)++R,++Z;for(;p<G&&Z>=128;)u[p++]=128+(127&Z),Z>>>=7;if(p>=G)throw new Error("RLE buffer overflow");for(u[p++]=Z,F>>>=0;p<G&&F>=128;)u[p++]=128+(127&F),F>>>=7;if(p>=G)throw new Error("RLE buffer overflow");u[p++]=F}return u},u.decode=function(B,u){for(var F,Z,V,p,G=u.length,R=B.length,e=0,s=0;s<R;){for(F=0,Z=0;s<R&&B[s]>=128;)F+=(127&B[s++])<<Z,Z+=7;if(F+=B[s++]<<Z,s>=R)throw new Error("RLE buffer underrun");if(e+F>G)throw new Error("Chunk buffer overflow");for(V=0,Z=0;s<R&&B[s]>=128;)V+=(127&B[s++])<<Z,Z+=7;if(s>=R)throw new Error("RLE buffer underrun");for(V+=B[s++]<<Z,p=0;p<F;++p)u[e++]=V}return u}},14022:(B,u)=>{"use strict";function F(B){var u=32;return(B&=-B)&&u--,65535&B&&(u-=16),16711935&B&&(u-=8),252645135&B&&(u-=4),858993459&B&&(u-=2),1431655765&B&&(u-=1),u}u.INT_BITS=32,u.INT_MAX=2147483647,u.INT_MIN=-1<<31,u.sign=function(B){return(B>0)-(B<0)},u.abs=function(B){var u=B>>31;return(B^u)-u},u.min=function(B,u){return u^(B^u)&-(B<u)},u.max=function(B,u){return B^(B^u)&-(B<u)},u.isPow2=function(B){return!(B&B-1)&&!!B},u.log2=function(B){var u,F;return u=(B>65535)<<4,u|=F=((B>>>=u)>255)<<3,u|=F=((B>>>=F)>15)<<2,(u|=F=((B>>>=F)>3)<<1)|(B>>>=F)>>1},u.log10=function(B){return B>=1e9?9:B>=1e8?8:B>=1e7?7:B>=1e6?6:B>=1e5?5:B>=1e4?4:B>=1e3?3:B>=100?2:B>=10?1:0},u.popCount=function(B){return 16843009*((B=(858993459&(B-=B>>>1&1431655765))+(B>>>2&858993459))+(B>>>4)&252645135)>>>24},u.countTrailingZeros=F,u.nextPow2=function(B){return B+=0===B,--B,B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)+1},u.prevPow2=function(B){return B|=B>>>1,B|=B>>>2,B|=B>>>4,B|=B>>>8,(B|=B>>>16)-(B>>>1)},u.parity=function(B){return B^=B>>>16,B^=B>>>8,B^=B>>>4,27030>>>(B&=15)&1};var Z=new Array(256);!function(B){for(var u=0;u<256;++u){var F=u,Z=u,V=7;for(F>>>=1;F;F>>>=1)Z<<=1,Z|=1&F,--V;B[u]=Z<<V&255}}(Z),u.reverse=function(B){return Z[255&B]<<24|Z[B>>>8&255]<<16|Z[B>>>16&255]<<8|Z[B>>>24&255]},u.interleave2=function(B,u){return(B=1431655765&((B=858993459&((B=252645135&((B=16711935&((B&=65535)|B<<8))|B<<4))|B<<2))|B<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u&=65535)|u<<8))|u<<4))|u<<2))|u<<1))<<1},u.deinterleave2=function(B,u){return(B=65535&((B=16711935&((B=252645135&((B=858993459&((B=B>>>u&1431655765)|B>>>1))|B>>>2))|B>>>4))|B>>>16))<<16>>16},u.interleave3=function(B,u,F){return B=1227133513&((B=3272356035&((B=251719695&((B=4278190335&((B&=1023)|B<<16))|B<<8))|B<<4))|B<<2),(B|=(u=1227133513&((u=3272356035&((u=251719695&((u=4278190335&((u&=1023)|u<<16))|u<<8))|u<<4))|u<<2))<<1)|(F=1227133513&((F=3272356035&((F=251719695&((F=4278190335&((F&=1023)|F<<16))|F<<8))|F<<4))|F<<2))<<2},u.deinterleave3=function(B,u){return(B=1023&((B=4278190335&((B=251719695&((B=3272356035&((B=B>>>u&1227133513)|B>>>2))|B>>>4))|B>>>8))|B>>>16))<<22>>22},u.nextCombination=function(B){var u=B|B-1;return u+1|(~u&-~u)-1>>>F(B)+1}},14054:B=>{"use strict";B.exports=function(B,u,F,Z){var V=self||window;try{try{var p;try{p=new V.Blob([B])}catch(s){(p=new(V.BlobBuilder||V.WebKitBlobBuilder||V.MozBlobBuilder||V.MSBlobBuilder)).append(B),p=p.getBlob()}var G=V.URL||V.webkitURL,R=G.createObjectURL(p),e=new V[u](R,F);return G.revokeObjectURL(R),e}catch(s){return new V[u]("data:application/javascript,".concat(encodeURIComponent(B)),F)}}catch(s){if(!Z)throw Error("Inline worker is not supported");return new V[u](Z,F)}}},13741:(B,u,F)=>{"use strict";function Z(B,u,F,Z,V){var p={};return Object.keys(Z).forEach((function(B){p[B]=Z[B]})),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=F.slice().reverse().reduce((function(F,Z){return Z(B,u,F)||F}),p),V&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(V):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(B,u,p),p=null),p}F.d(u,{c:()=>Z})},13733:(B,u,F)=>{"use strict";function Z(B,u,F,Z){F&&Object.defineProperty(B,u,{enumerable:F.enumerable,configurable:F.configurable,writable:F.writable,value:F.initializer?F.initializer.call(Z):void 0})}F.d(u,{d:()=>Z})},15155:(B,u,F)=>{"use strict";F.d(u,{C:()=>Y,e:()=>G,i:()=>Q,m:()=>R,p:()=>p,t:()=>e,w:()=>V,y:()=>s});var Z=F(13199);class V{constructor(){this._easingMode=V.EASINGMODE_EASEIN}setEasingMode(B){const u=Math.min(Math.max(B,0),2);this._easingMode=u}getEasingMode(){return this._easingMode}easeInCore(B){throw new Error("You must implement this method")}ease(B){switch(this._easingMode){case V.EASINGMODE_EASEIN:return this.easeInCore(B);case V.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-B)}return B>=.5?.5*(1-this.easeInCore(2*(1-B)))+.5:.5*this.easeInCore(2*B)}}V.EASINGMODE_EASEIN=0,V.EASINGMODE_EASEOUT=1,V.EASINGMODE_EASEINOUT=2;class p extends V{easeInCore(B){return B=Math.max(0,Math.min(1,B)),1-Math.sqrt(1-B*B)}}class G extends V{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=B}easeInCore(B){const u=Math.max(0,this.amplitude);return Math.pow(B,3)-B*u*Math.sin(3.141592653589793*B)}}class R extends V{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=B,this.bounciness=u}easeInCore(B){const u=Math.max(0,this.bounces);let F=this.bounciness;F<=1&&(F=1.001);const Z=Math.pow(F,u),V=1-F,p=(1-Z)/V+.5*Z,G=B*p,R=Math.log(-G*(1-F)+1)/Math.log(F),e=Math.floor(R),s=e+1,Y=(1-Math.pow(F,e))/(V*p),Q=.5*(Y+(1-Math.pow(F,s))/(V*p)),t=B-Q,v=Q-Y;return-Math.pow(1/F,u-e)/(v*v)*(t-v)*(t+v)}}class e extends V{easeInCore(B){return B*B*B}}class s extends V{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=B,this.springiness=u}easeInCore(B){let u;const F=Math.max(0,this.oscillations),Z=Math.max(0,this.springiness);return u=0==Z?B:(Math.exp(Z*B)-1)/(Math.exp(Z)-1),u*Math.sin((6.283185307179586*F+1.5707963267948966)*B)}}class Y extends V{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=B}easeInCore(B){return this.exponent<=0?B:(Math.exp(this.exponent*B)-1)/(Math.exp(this.exponent)-1)}}class Q extends V{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=B,this.y1=u,this.x2=F,this.y2=Z}easeInCore(B){return Z.b.Interpolate(B,this.x1,this.y1,this.x2,this.y2)}}},14625:(B,u,F)=>{"use strict";F.d(u,{c:()=>G});var Z=F(12979),V=F(12985),p=F(13391);class G extends p.b{get _matrix(){return this._compose(),this.it}set _matrix(B){(B.updateFlag!==this.it.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.it.Z(B),this._markAsDirtyAndDecompose())}constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(B,u.yB(),!1),this.name=B,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=u,this.it=(null===V||void 0===V?void 0:V.clone())??Z.Matrix.Identity(),this._restMatrix=p??this.it.clone(),this._bindMatrix=G??this.it.clone(),this._index=R,this._absoluteMatrix=new Z.Matrix,this._absoluteBindMatrix=new Z.Matrix,this._absoluteInverseBindMatrix=new Z.Matrix,this._finalMatrix=new Z.Matrix,u.bones.push(this),this.setParent(F,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(B){this.setParent(B)}setParent(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==B){if(this.parent){const B=this.parent.children.indexOf(this);-1!==B&&this.parent.children.splice(B,1)}this._parentNode=B,this.parent&&this.parent.children.push(this),u&&this._updateAbsoluteBindMatrices(),this.vY()}}getLocalMatrix(){return this._compose(),this.it}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(B){this._restMatrix.Z(B)}setRestPose(B){this.setRestMatrix(B)}getBindPose(){return this.getBindMatrix()}setBindMatrix(B){this.WR(B)}setBindPose(B){this.setBindMatrix(B)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const B=Z.TmpVectors.Du[0],u=Z.TmpVectors.Quaternion[0],F=Z.TmpVectors.Du[1];this.getRestMatrix().decompose(B,u,F),this._linkedTransformNode.position.Z(F),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??Z.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.Z(u),this._linkedTransformNode.yR.Z(B)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(B){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=B,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.NR}set position(B){this._decompose(),this.NR.Z(B),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(B){this.setRotation(B)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(B){this.setRotationQuaternion(B)}get yR(){return this.getScale()}set yR(B){this.setScale(B)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=Z.Du.Zero(),this._localRotation=Z.Quaternion.Zero(),this.NR=Z.Du.Zero()),this.it.decompose(this._localScaling,this._localRotation,this.NR))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,Z.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.NR,this.it)):this._needToCompose=!1)}WR(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.Z(B),u&&this._updateAbsoluteBindMatrices(),F?this._matrix=B:this.vY()}_updateAbsoluteBindMatrices(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(B||(B=this._bindMatrix),this.parent?B.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.Z(B),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),u)for(let F=0;F<this.children.length;F++)this.children[F]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}vY(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.vY(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.vY(),this._needToDecompose=!0}_updatePosition(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0,V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=this.getLocalMatrix();if(0==u)V?(p.addAtIndex(12,B.x),p.addAtIndex(13,B.y),p.addAtIndex(14,B.z)):p.setTranslationFromFloats(B.x,B.y,B.z);else{let u=null;F&&(u=F.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const R=G._TmpMats[0],e=G._TmpVecs[0];this.parent?F&&u?(R.Z(this.parent.getAbsoluteMatrix()),R.multiplyToRef(u,R)):R.Z(this.parent.getAbsoluteMatrix()):Z.Matrix.IdentityToRef(R),V&&R.setTranslationFromFloats(0,0,0),R.invert(),Z.Du.TransformCoordinatesToRef(B,R,e),V?(p.addAtIndex(12,e.x),p.addAtIndex(13,e.y),p.addAtIndex(14,e.z)):p.setTranslationFromFloats(e.x,e.y,e.z)}this._markAsDirtyAndDecompose()}translate(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this._updatePosition(B,u,F,!0)}setPosition(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this._updatePosition(B,u,F,!1)}setAbsolutePosition(B,u){this.setPosition(B,1,u)}scale(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=this.getLocalMatrix(),R=G._TmpMats[0];Z.Matrix.ScalingToRef(B,u,F,R),R.multiplyToRef(p,p),R.invert();for(const Z of this.children){const V=Z.getLocalMatrix();V.multiplyToRef(R,V),V.multiplyAtIndex(12,B),V.multiplyAtIndex(13,u),V.multiplyAtIndex(14,F),Z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),V)for(const Z of this.children)Z.scale(B,u,F,V)}setScale(B){this._decompose(),this._localScaling.Z(B),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(B){this._decompose(),B.Z(this._localScaling)}setYawPitchRoll(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4?arguments[4]:void 0;if(0===V){const R=G._TmpQuat;return Z.Quaternion.RotationYawPitchRollToRef(B,u,F,R),void this.setRotationQuaternion(R,V,p)}const R=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(R,p))return;const e=G._TmpMats[1];Z.Matrix.RotationYawPitchRollToRef(B,u,F,e),R.multiplyToRef(e,e),this._rotateWithMatrix(e,V,p)}rotate(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,V=arguments.length>3?arguments[3]:void 0;const p=G._TmpMats[0];p.setTranslationFromFloats(0,0,0),Z.Matrix.RotationAxisToRef(B,u,p),this._rotateWithMatrix(p,F,V)}setAxisAngle(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,V=arguments.length>3?arguments[3]:void 0;if(0===F){const p=G._TmpQuat;return Z.Quaternion.RotationAxisToRef(B,u,p),void this.setRotationQuaternion(p,F,V)}const p=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,V))return;const R=G._TmpMats[1];Z.Matrix.RotationAxisToRef(B,u,R),p.multiplyToRef(R,R),this._rotateWithMatrix(R,F,V)}setRotation(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(B.y,B.x,B.z,u,F)}setRotationQuaternion(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;if(0===u)return this._decompose(),this._localRotation.Z(B),void this._markAsDirtyAndCompose();const V=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(V,F))return;const p=G._TmpMats[1];Z.Matrix.FromQuaternionToRef(B,p),V.multiplyToRef(p,p),this._rotateWithMatrix(p,u,F)}setRotationMatrix(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;if(0===u){const V=G._TmpQuat;return Z.Quaternion.FromRotationMatrixToRef(B,V),void this.setRotationQuaternion(V,u,F)}const V=G._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(V,F))return;const p=G._TmpMats[1];p.Z(B),V.multiplyToRef(B,p),this._rotateWithMatrix(p,u,F)}_rotateWithMatrix(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;const Z=this.getLocalMatrix(),V=Z.m[12],p=Z.m[13],R=Z.m[14],e=this.getParent(),s=G._TmpMats[3],Y=G._TmpMats[4];e&&1==u?(F?(s.Z(F.getWorldMatrix()),e.getAbsoluteMatrix().multiplyToRef(s,s)):s.Z(e.getAbsoluteMatrix()),Y.Z(s),Y.invert(),Z.multiplyToRef(s,Z),Z.multiplyToRef(B,Z),Z.multiplyToRef(Y,Z)):1==u&&F?(s.Z(F.getWorldMatrix()),Y.Z(s),Y.invert(),Z.multiplyToRef(s,Z),Z.multiplyToRef(B,Z),Z.multiplyToRef(Y,Z)):Z.multiplyToRef(B,Z),Z.setTranslationFromFloats(V,p,R),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(B,u){const F=G._TmpMats[2];return B.Z(this.getAbsoluteMatrix()),u?(B.multiplyToRef(u.getWorldMatrix(),B),Z.Matrix.ScalingToRef(u.yR.x,u.yR.y,u.yR.z,F)):Z.Matrix.IdentityToRef(F),B.invert(),!isNaN(B.m[0])&&(F.multiplyAtIndex(0,this._scalingDeterminant),B.multiplyToRef(F,B),!0)}dp(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=Z.Du.Zero();return this.getPositionToRef(B,u,F),F}getPositionToRef(){let B=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const B=this.getLocalMatrix();u.x=B.m[12],u.y=B.m[13],u.z=B.m[14]}else{let F=null;B&&(F=B.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let Z=G._TmpMats[0];B&&F?(Z.Z(this.getAbsoluteMatrix()),Z.multiplyToRef(F,Z)):Z=this.getAbsoluteMatrix(),u.x=Z.m[12],u.y=Z.m[13],u.z=Z.m[14]}}getAbsolutePosition(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=Z.Du.Zero();return this.getPositionToRef(1,B,u),u}getAbsolutePositionToRef(B,u){this.getPositionToRef(1,B,u)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.it.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.Z(this.it);const B=this._skeleton.getPoseMatrix();B&&this._absoluteMatrix.multiplyToRef(B,this._absoluteMatrix)}const B=this.children,u=B.length;for(let F=0;F<u;F++)B[F].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Ie(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=Z.Du.Zero();return this.getDirectionToRef(B,u,F),F}getDirectionToRef(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,V=null;u&&(V=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=G._TmpMats[0];p.Z(this.getAbsoluteMatrix()),u&&V&&p.multiplyToRef(V,p),Z.Du.TransformNormalToRef(B,p,F),F.normalize()}getRotation(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=Z.Du.Zero();return this.getRotationToRef(B,u,F),F}getRotationToRef(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0;const Z=G._TmpQuat;this.getRotationQuaternionToRef(B,u,Z),Z.toEulerAnglesToRef(F)}getRotationQuaternion(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=Z.Quaternion.Identity();return this.getRotationQuaternionToRef(B,u,F),F}getRotationQuaternionToRef(){let B=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),u.Z(this._localRotation);else{const F=G._TmpMats[0],Z=this.getAbsoluteMatrix();B?Z.multiplyToRef(B.getWorldMatrix(),F):F.Z(Z),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.decompose(void 0,u,void 0)}}getRotationMatrix(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1?arguments[1]:void 0;const F=Z.Matrix.Identity();return this.getRotationMatrixToRef(B,u,F),F}getRotationMatrixToRef(){let B=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(u);else{const F=G._TmpMats[0],Z=this.getAbsoluteMatrix();B?Z.multiplyToRef(B.getWorldMatrix(),F):F.Z(Z),F.multiplyAtIndex(0,this._scalingDeterminant),F.multiplyAtIndex(1,this._scalingDeterminant),F.multiplyAtIndex(2,this._scalingDeterminant),F.getRotationMatrixToRef(u)}}getAbsolutePositionFromLocal(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=Z.Du.Zero();return this.getAbsolutePositionFromLocalToRef(B,u,F),F}getAbsolutePositionFromLocalToRef(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,V=null;u&&(V=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=G._TmpMats[0];p.Z(this.getAbsoluteMatrix()),u&&V&&p.multiplyToRef(V,p),Z.Du.TransformCoordinatesToRef(B,p,F)}getLocalPositionFromAbsolute(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=Z.Du.Zero();return this.getLocalPositionFromAbsoluteToRef(B,u,F),F}getLocalPositionFromAbsoluteToRef(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2?arguments[2]:void 0,V=null;u&&(V=u.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=G._TmpMats[0];p.Z(this.getAbsoluteMatrix()),u&&V&&p.multiplyToRef(V,p),p.invert(),Z.Du.TransformCoordinatesToRef(B,p,F)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const B=this._skeleton.bones.indexOf(this);if(-1!==B&&this._skeleton.bones.splice(B,1),this._parentNode&&this._parentNode.children){const B=this._parentNode.children,u=B.indexOf(this);-1!==u&&B.splice(u,1)}super.dispose()}}G._TmpVecs=(0,V.e)(2,Z.Du.Zero),G._TmpQuat=Z.Quaternion.Identity(),G._TmpMats=(0,V.e)(5,Z.Matrix.Identity)},15151:(B,u,F)=>{"use strict";F.d(u,{e:()=>o});var Z=F(12971),V=F(12973),p=F(12807),G=F(12979),R=F(12994),e=F(13391),s=F(13409),Y=F(13261),Q=F(12834),t=F(12982);class v{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(B){this._zoomStopsAnimation=B}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(B){this._idleRotationSpeed=B}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(B){this._idleRotationWaitTime=B}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(B){this._idleRotationSpinupTime=B}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(B){this._attachedCamera=B;const u=this._attachedCamera.yB();this._onPrePointerObservableObserver=u.onPrePointerObservable.add((B=>{B.type!==Y.d.POINTERDOWN?B.type===Y.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const B=Q.b.Now;let u=0;null!=this._lastFrameTime&&(u=B-this._lastFrameTime),this._lastFrameTime=B,this._applyUserInteraction();const F=B-this._lastInteractionTime-this._idleRotationWaitTime,Z=Math.max(Math.min(F/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*Z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(u/1e3))}))}detach(){if(!this._attachedCamera)return;const B=this._attachedCamera.yB();this._onPrePointerObservableObserver&&B.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(B){this._lastInteractionTime=B??Q.b.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<t.e}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let B=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(B=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?B:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=Q.b.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var D=F(15155),L=F(13488);class q{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(B){if(this._autoTransitionRange===B)return;this._autoTransitionRange=B;const u=this._attachedCamera;u&&(B?this._onMeshTargetChangedObserver=u.onMeshTargetChangedObservable.add((B=>{if(B&&(B.XR(!0),B.getBoundingInfo)){const u=B.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*u,this.upperRadiusTransitionRange=.05*u}})):this._onMeshTargetChangedObserver&&u.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(B){this._attachedCamera=B,this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(B){return!!this._attachedCamera&&(this._attachedCamera.radius===B&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(B){if(!this._attachedCamera)return;this._radiusBounceTransition||(q.EasingFunction.setEasingMode(q.EasingMode),this._radiusBounceTransition=L.e.CreateAnimation("radius",L.e.ANIMATIONTYPE_FLOAT,60,q.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const u=L.e.TransitionTo("radius",this._attachedCamera.radius+B,this._attachedCamera,this._attachedCamera.yB(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));u&&this._animatables.push(u)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}q.EasingFunction=new D.e(.3),q.EasingMode=D.w.EASINGMODE_EASEOUT;class W{constructor(){this.onTargetFramingAnimationEndObservable=new p.b,this._mode=W.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(B){this._mode=B}get mode(){return this._mode}set radiusScale(B){this._radiusScale=B}get radiusScale(){return this._radiusScale}set positionScale(B){this._positionScale=B}get positionScale(){return this._positionScale}set defaultElevation(B){this._defaultElevation=B}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(B){this._elevationReturnTime=B}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(B){this._elevationReturnWaitTime=B}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(B){this._zoomStopsAnimation=B}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(B){this._framingTime=B}get framingTime(){return this._framingTime}init(){}attach(B){this._attachedCamera=B;const u=this._attachedCamera.yB();W.EasingFunction.setEasingMode(W.EasingMode),this._onPrePointerObservableObserver=u.onPrePointerObservable.add((B=>{B.type!==Y.d.POINTERDOWN?B.type===Y.d.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=B.onMeshTargetChangedObservable.add((B=>{B&&B.getBoundingInfo&&this.zoomOnMesh(B,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=B.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const B=this._attachedCamera.yB();this._onPrePointerObservableObserver&&B.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B.XR(!0);const Z=B.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(Z.minimumWorld,Z.maximumWorld,u,F)}zoomOnMeshHierarchy(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;B.XR(!0);const Z=B.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(Z.min,Z.max,u,F)}zoomOnMeshesHierarchy(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new G.Du(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),V=new G.Du(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let p=0;p<B.length;p++){const u=B[p].getHierarchyBoundingVectors(!0);G.Du.CheckExtends(u.min,Z,V),G.Du.CheckExtends(u.max,Z,V)}this.zoomOnBoundingInfo(Z,V,u,F)}zoomOnBoundingInfo(B,u){let F,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const p=B.y,R=p+(u.y-p)*this._positionScale,e=u.Lu(B).scale(.5);if(!isFinite(R))return!1;if(Z)F=new G.Du(0,R,0);else{const u=B.add(e);F=new G.Du(u.x,R,u.z)}this._vectorTransition||(this._vectorTransition=L.e.CreateAnimation("target",L.e.ANIMATIONTYPE_VECTOR3,60,W.EasingFunction)),this._betaIsAnimating=!0;let s=L.e.TransitionTo("target",F,this._attachedCamera,this._attachedCamera.yB(),60,this._vectorTransition,this._framingTime);s&&this._animatables.push(s);let Y=0;if(this._mode===W.FitFrustumSidesMode){const F=this._calculateLowerRadiusFromModelBoundingSphere(B,u);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=e.length()+this._attachedCamera.qR),Y=F}else this._mode===W.IgnoreBoundsSizeMode&&(Y=this._calculateLowerRadiusFromModelBoundingSphere(B,u),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.qR));if(this.autoCorrectCameraLimitsAndSensibility){const F=u.Lu(B).length();this._attachedCamera.panningSensibility=5e3/F,this._attachedCamera.wheelPrecision=100/Y}return this._radiusTransition||(this._radiusTransition=L.e.CreateAnimation("radius",L.e.ANIMATIONTYPE_FLOAT,60,W.EasingFunction)),s=L.e.TransitionTo("radius",Y,this._attachedCamera,this._attachedCamera.yB(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),V&&V(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),s&&this._animatables.push(s),!0}_calculateLowerRadiusFromModelBoundingSphere(B,u){const F=this._attachedCamera;if(!F)return 0;let Z=F._calculateLowerRadiusFromModelBoundingSphere(B,u,this._radiusScale);return F.lowerRadiusLimit&&this._mode===W.IgnoreBoundsSizeMode&&(Z=Z<F.lowerRadiusLimit?F.lowerRadiusLimit:Z),F.upperRadiusLimit&&(Z=Z>F.upperRadiusLimit?F.upperRadiusLimit:Z),Z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const B=Q.b.Now-this._lastInteractionTime,u=.5*Math.PI-this._defaultElevation,F=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>F&&B>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=L.e.CreateAnimation("beta",L.e.ANIMATIONTYPE_FLOAT,60,W.EasingFunction));const B=L.e.TransitionTo("beta",u,this._attachedCamera,this._attachedCamera.yB(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));B&&this._animatables.push(B)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=Q.b.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}W.EasingFunction=new D.C,W.EasingMode=D.w.EASINGMODE_EASEINOUT,W.IgnoreBoundsSizeMode=0,W.FitFrustumSidesMode=1;var X=F(13414),f=F(13452),C=F(14622),x=F(12802);class U{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(B){B=x.Tools.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),F=u.getInputElement();let Z=0,V=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=p=>{var G,R;const e=p.event,s="touch"===e.pointerType;if(p.type!==Y.d.POINTERMOVE&&-1===this.buttons.indexOf(e.button))return;const Q=e.target;if(this._altKey=e.altKey,this._ctrlKey=e.ctrlKey,this._metaKey=e.metaKey,this._shiftKey=e.shiftKey,this._buttonsPressed=e.buttons,u.isPointerLock){const B=e.movementX,u=e.movementY;this.onTouch(null,B,u),this._pointA=null,this._pointB=null}else{if(p.type!==Y.d.POINTERDOWN&&p.type!==Y.d.POINTERDOUBLETAP&&s&&(null===(G=this._pointA)||void 0===G?void 0:G.pointerId)!==e.pointerId&&(null===(R=this._pointB)||void 0===R?void 0:R.pointerId)!==e.pointerId)return;if(p.type!==Y.d.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!s)if(p.type===Y.d.POINTERDOUBLETAP)this.onDoubleTap(e.pointerType);else if(p.type!==Y.d.POINTERUP||this._currentMousePointerIdDown!==e.pointerId&&!s){if(p.type===Y.d.POINTERMOVE)if(B||e.preventDefault(),this._pointA&&null===this._pointB){const B=e.clientX-this._pointA.x,u=e.clientY-this._pointA.y;this._pointA.x=e.clientX,this._pointA.y=e.clientY,this.onTouch(this._pointA,B,u)}else if(this._pointA&&this._pointB){const B=this._pointA.pointerId===e.pointerId?this._pointA:this._pointB;B.x=e.clientX,B.y=e.clientY;const u=this._pointA.x-this._pointB.x,F=this._pointA.y-this._pointB.y,G=u*u+F*F,R={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:e.pointerId,type:p.type};this.onMultiTouch(this._pointA,this._pointB,Z,G,V,R),V=R,Z=G}}else{try{null===Q||void 0===Q||Q.releasePointerCapture(e.pointerId)}catch(t){}s||(this._pointB=null),u._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==e.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==e.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==Z||V)&&(this.onMultiTouch(this._pointA,this._pointB,Z,0,V,null),Z=0,V=null),this._currentMousePointerIdDown=-1,this.onButtonUp(e),B||e.preventDefault()}else{try{null===Q||void 0===Q||Q.setPointerCapture(e.pointerId)}catch(t){}if(null===this._pointA)this._pointA={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType};else{if(null!==this._pointB)return;this._pointB={x:e.clientX,y:e.clientY,pointerId:e.pointerId,type:e.pointerType}}-1!==this._currentMousePointerIdDown||s||(this._currentMousePointerIdDown=e.pointerId),this.onButtonDown(e),B||(e.preventDefault(),F&&F.focus())}}},this._observer=this.camera.yB()._inputManager._addCameraPointerObserver(this._pointerInput,Y.d.POINTERDOWN|Y.d.POINTERUP|Y.d.POINTERMOVE|Y.d.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,Z=0,V=null,this.onLostFocus()},this._contextMenuBind=B=>this.onContextMenu(B),F&&F.addEventListener("contextmenu",this._contextMenuBind,!1);const p=this.camera.yB().getEngine().getHostWindow();p&&x.Tools.RegisterTopRootEvents(p,[{name:"blur",handler:this._onLostFocus}])}ut(){if(this._onLostFocus){const B=this.camera.yB().getEngine().getHostWindow();B&&x.Tools.UnregisterTopRootEvents(B,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.yB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const B=this.camera.yB().getEngine().getInputElement();B&&B.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(B){}onTouch(B,u,F){}onMultiTouch(B,u,F,Z,V,p){}onContextMenu(B){B.preventDefault()}onButtonDown(B){}onButtonUp(B){}onLostFocus(){}}(0,Z.d)([(0,V.L)()],U.prototype,"buttons",void 0);class y extends U{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(B,u){if(0!==this.panningSensibility&&B&&u){const F=u.x-B.x,Z=u.y-B.y;this.camera.inertialPanningX+=-F/this.panningSensibility,this.camera.inertialPanningY+=Z/this.panningSensibility}}_computePinchZoom(B,u){const F=this.camera.radius||y.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=F*Math.sqrt(B)/Math.sqrt(u):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(u-B)*F*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(u-B)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(B,u,F){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-u/this.panningSensibility,this.camera.inertialPanningY+=F/this.panningSensibility):(this.camera.inertialAlphaOffset-=u/this.angularSensibilityX,this.camera.inertialBetaOffset-=F/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(B,u,F,Z,V,p){0===F&&null===V||0===Z&&null===p||(this.multiTouchPanAndZoom?(this._computePinchZoom(F,Z),this._computeMultiTouchPanning(V,p)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(Z)-Math.sqrt(F))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(F,Z),this._isPinching=!0):this._computeMultiTouchPanning(V,p)):this.multiTouchPanning?this._computeMultiTouchPanning(V,p):this.pinchZoom&&this._computePinchZoom(F,Z))}onButtonDown(B){this._isPanClick=B.button===this.camera._panningMouseButton}onButtonUp(B){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}y.MinimumRadiusForPinch=.001,(0,Z.d)([(0,V.L)()],y.prototype,"buttons",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"angularSensibilityX",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"angularSensibilityY",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"pinchPrecision",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"pinchDeltaPercentage",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"useNaturalPinchZoom",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"pinchZoom",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"panningSensibility",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"multiTouchPanning",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"multiTouchPanAndZoom",void 0),C.c.ArcRotateCameraPointersInput=y;var O=F(13263);class g{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(B){B=x.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.yB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const F=u.event;if(!F.metaKey)if(u.type===O.d.KEYDOWN){if(this._ctrlPressed=F.ctrlKey,this._altPressed=F.altKey,-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysReset.indexOf(F.keyCode)){-1===this._keys.indexOf(F.keyCode)&&this._keys.push(F.keyCode),F.preventDefault&&(B||F.preventDefault())}}else if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysReset.indexOf(F.keyCode)){const u=this._keys.indexOf(F.keyCode);u>=0&&this._keys.splice(u,1),F.preventDefault&&(B||F.preventDefault())}})))}ut(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const B=this.camera;for(let u=0;u<this._keys.length;u++){const F=this._keys[u];-1!==this.keysLeft.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningX-=1/this.panningSensibility:B.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?B.inertialRadiusOffset+=1/this.zoomingSensibility:B.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningX+=1/this.panningSensibility:B.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(F)?this._ctrlPressed&&this.camera._useCtrlForPanning?B.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?B.inertialRadiusOffset-=1/this.zoomingSensibility:B.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(F)&&B.useInputToRestoreState&&B.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,Z.d)([(0,V.L)()],g.prototype,"keysUp",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"keysDown",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"keysLeft",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"keysRight",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"keysReset",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"panningSensibility",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"zoomingSensibility",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"useAltToZoom",void 0),(0,Z.d)([(0,V.L)()],g.prototype,"angularSpeed",void 0),C.c.ArcRotateCameraKeyboardMoveInput=g;var J=F(13029),a=F(13267);class T{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new G.Du(0,0,0),this._globalOffset=new G.Du(0,0,0),this._inertialPanning=G.Du.Zero()}_computeDeltaFromMouseWheelLegacyEvent(B,u){let F=0;const Z=.01*B*this.wheelDeltaPercentage*u;return F=B>0?Z/(1+this.wheelDeltaPercentage):Z*(1+this.wheelDeltaPercentage),F}attachControl(B){B=x.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==Y.d.POINTERWHEEL)return;const F=u.event;let Z=0;const V=F.deltaMode===a.d.DOM_DELTA_LINE?40:1,p=-F.deltaY*V;if(this.customComputeDeltaFromMouseWheel)Z=this.customComputeDeltaFromMouseWheel(p,this,F);else if(this.wheelDeltaPercentage){if(Z=this._computeDeltaFromMouseWheelLegacyEvent(p,this.camera.radius),Z>0){let B=this.camera.radius,u=this.camera.inertialRadiusOffset+Z;for(let F=0;F<20&&!(B<=u)&&!(Math.abs(u*this.camera.inertia)<.001);F++)B-=u,u*=this.camera.inertia;B=(0,R.Clamp)(B,0,Number.MAX_VALUE),Z=this._computeDeltaFromMouseWheelLegacyEvent(p,B)}}else Z=p/(40*this.wheelPrecision);Z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(Z)):this.camera.inertialRadiusOffset+=Z),F.preventDefault&&(B||F.preventDefault())},this._observer=this.camera.yB()._inputManager._addCameraPointerObserver(this._wheel,Y.d.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.OR(0)}ut(){this._observer&&(this.camera.yB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const B=this.camera;0+B.inertialAlphaOffset+B.inertialBetaOffset+B.inertialRadiusOffset&&(this._updateHitPlane(),B.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(B.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const B=this.camera,u=B.target.Lu(B.position);this._hitPlane=J.b.FromPositionAndNormal(B.target,u)}_getPosition(){const B=this.camera,u=B.yB(),F=u.createPickingRay(u.pointerX,u.pointerY,G.Matrix.Identity(),B,!1);0===B.targetScreenOffset.x&&0===B.targetScreenOffset.y||(this._viewOffset.set(B.targetScreenOffset.x,B.targetScreenOffset.y,0),B.getViewMatrix().invertToRef(B._cameraTransformMatrix),this._globalOffset=G.Du.TransformNormal(this._viewOffset,B._cameraTransformMatrix),F.origin.addInPlace(this._globalOffset));let Z=0;return this._hitPlane&&(Z=F.intersectsPlane(this._hitPlane)??0),F.origin.addInPlace(F.direction.scaleInPlace(Z))}_zoomToMouse(B){const u=this.camera,F=1-u.inertia;if(u.lowerRadiusLimit){const Z=u.lowerRadiusLimit??0;u.radius-(u.inertialRadiusOffset+B)/F<Z&&(B=(u.radius-Z)*F-u.inertialRadiusOffset)}if(u.upperRadiusLimit){const Z=u.upperRadiusLimit??0;u.radius-(u.inertialRadiusOffset+B)/F>Z&&(B=(u.radius-Z)*F-u.inertialRadiusOffset)}const Z=B/F/u.radius,V=this._getPosition(),p=G.TmpVectors.Du[6];V.subtractToRef(u.target,p),p.scaleInPlace(Z),p.scaleInPlace(F),this._inertialPanning.addInPlace(p),u.inertialRadiusOffset+=B}_zeroIfClose(B){Math.abs(B.x)<t.e&&(B.x=0),Math.abs(B.y)<t.e&&(B.y=0),Math.abs(B.z)<t.e&&(B.z=0)}}(0,Z.d)([(0,V.L)()],T.prototype,"wheelPrecision",void 0),(0,Z.d)([(0,V.L)()],T.prototype,"zoomToMouseLocation",void 0),(0,Z.d)([(0,V.L)()],T.prototype,"wheelDeltaPercentage",void 0),C.c.ArcRotateCameraMouseWheelInput=T;class z extends C.f{constructor(B){super(B)}addMouseWheel(){return this.add(new T),this}addPointers(){return this.add(new y),this}addKeyboard(){return this.add(new g),this}}var M=F(12949);function j(B,u){return isNaN(B)?u:B}e.b.AddNodeConstructor("ArcRotateCamera",((B,u)=>()=>new o(B,0,0,1,G.Du.Zero(),u)));class o extends f.b{get target(){return this._target}set target(B){this.setTarget(B)}get targetHost(){return this._targetHost}set targetHost(B){B&&this.setTarget(B)}getTarget(){return this.target}get position(){return this._position}set position(B){this.setPosition(B)}set upVector(B){this._upToYMatrix||(this._yToUpMatrix=new G.Matrix,this._upToYMatrix=new G.Matrix,this._upVector=G.Du.Zero()),B.normalize(),this._upVector.Z(B),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){G.Matrix.RotationAlignToRef(G.Du.UpReadOnly,this._upVector,this._yToUpMatrix),G.Matrix.RotationAlignToRef(this._upVector,G.Du.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const B=this.inputs.attached.pointers;return B?B.angularSensibilityX:0}set angularSensibilityX(B){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityX=B)}get angularSensibilityY(){const B=this.inputs.attached.pointers;return B?B.angularSensibilityY:0}set angularSensibilityY(B){const u=this.inputs.attached.pointers;u&&(u.angularSensibilityY=B)}get pinchPrecision(){const B=this.inputs.attached.pointers;return B?B.pinchPrecision:0}set pinchPrecision(B){const u=this.inputs.attached.pointers;u&&(u.pinchPrecision=B)}get pinchDeltaPercentage(){const B=this.inputs.attached.pointers;return B?B.pinchDeltaPercentage:0}set pinchDeltaPercentage(B){const u=this.inputs.attached.pointers;u&&(u.pinchDeltaPercentage=B)}get useNaturalPinchZoom(){const B=this.inputs.attached.pointers;return!!B&&B.useNaturalPinchZoom}set useNaturalPinchZoom(B){const u=this.inputs.attached.pointers;u&&(u.useNaturalPinchZoom=B)}get panningSensibility(){const B=this.inputs.attached.pointers;return B?B.panningSensibility:0}set panningSensibility(B){const u=this.inputs.attached.pointers;u&&(u.panningSensibility=B)}get keysUp(){const B=this.inputs.attached.keyboard;return B?B.keysUp:[]}set keysUp(B){const u=this.inputs.attached.keyboard;u&&(u.keysUp=B)}get keysDown(){const B=this.inputs.attached.keyboard;return B?B.keysDown:[]}set keysDown(B){const u=this.inputs.attached.keyboard;u&&(u.keysDown=B)}get keysLeft(){const B=this.inputs.attached.keyboard;return B?B.keysLeft:[]}set keysLeft(B){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=B)}get keysRight(){const B=this.inputs.attached.keyboard;return B?B.keysRight:[]}set keysRight(B){const u=this.inputs.attached.keyboard;u&&(u.keysRight=B)}get wheelPrecision(){const B=this.inputs.attached.mousewheel;return B?B.wheelPrecision:0}set wheelPrecision(B){const u=this.inputs.attached.mousewheel;u&&(u.wheelPrecision=B)}get zoomToMouseLocation(){const B=this.inputs.attached.mousewheel;return!!B&&B.zoomToMouseLocation}set zoomToMouseLocation(B){const u=this.inputs.attached.mousewheel;u&&(u.zoomToMouseLocation=B)}get wheelDeltaPercentage(){const B=this.inputs.attached.mousewheel;return B?B.wheelDeltaPercentage:0}set wheelDeltaPercentage(B){const u=this.inputs.attached.mousewheel;u&&(u.wheelDeltaPercentage=B)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(B){B!==this.useBouncingBehavior&&(B?(this._bouncingBehavior=new q,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(B){B!==this.useFramingBehavior&&(B?(this._framingBehavior=new W,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(B){B!==this.useAutoRotationBehavior&&(B?(this._autoRotationBehavior=new v,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(B,u,F,Z,V,R){var e;let s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(B,G.Du.Zero(),R,s),e=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=G.Du.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=G.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new G.Matrix,this.panningAxis=new G.Du(1,1,0),this._transformedDirection=new G.Du,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new p.b,this.checkCollisions=!1,this.collisionRadius=new G.Du(.5,.5,.5),this._previousPosition=G.Du.Zero(),this._collisionVelocity=G.Du.Zero(),this._newPosition=G.Du.Zero(),this._computationVector=G.Du.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new G.Du(NaN,NaN,NaN),this._goalTargetScreenOffset=new G.Vector2(NaN,NaN),this._onCollisionPositionChange=function(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;F?(e.setPosition(u),e.Hv&&e.Hv(F)):e._previousPosition.Z(e._position);const Z=Math.cos(e.alpha),V=Math.sin(e.alpha),p=Math.cos(e.beta);let G=Math.sin(e.beta);0===G&&(G=1e-4);const R=e._getTargetPosition();e._computationVector.UR(e.radius*Z*G,e.radius*p,e.radius*V*G),R.addToRef(e._computationVector,e._newPosition),e._position.Z(e._newPosition);let s=e.upVector;e.allowUpsideDown&&e.beta<0&&(s=s.clone(),s=s.negate()),e._computeViewMatrix(e._position,R,s),e._viewMatrix.addAtIndex(12,e.targetScreenOffset.x),e._viewMatrix.addAtIndex(13,e.targetScreenOffset.y),e._collisionTriggered=!1},this._target=G.Du.Zero(),V&&this.setTarget(V),this.alpha=u,this.beta=F,this.radius=Z,this.getViewMatrix(),this.inputs=new z(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new G.Du(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=G.Vector2.Zero()}_updateCache(B){B||super._updateCache(),this._cache._target.Z(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.Z(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const B=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?B.addToRef(this._targetBoundingCenter,this._target):this._target.Z(B)}const B=this._getLockedTargetPosition();return B||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>t.e&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,p=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=p?this._currentInterpolationFactor=p:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=j(B,this._goalAlpha),this._goalBeta=j(u,this._goalBeta),this._goalRadius=j(F,this._goalRadius),this._goalTarget.set(j(Z.x,this._goalTarget.x),j(Z.y,this._goalTarget.y),j(Z.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(j(V.x,this._goalTargetScreenOffset.x),j(V.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,R.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,R.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,R.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,R.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(B,u){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const V=arguments;u=x.Tools.BackCompatCameraNoPreventDefault(V),this._useCtrlForPanning=F,this._panningMouseButton=Z,"boolean"===typeof V[0]&&(V.length>1&&(this._useCtrlForPanning=V[1]),V.length>2&&(this._panningMouseButton=V[2])),this.inputs.attachElement(u),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}ut(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let B=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){B=!0;const u=this.invertRotation?-1:1,F=this._calculateHandednessMultiplier();let Z=this.inertialAlphaOffset*F;this.beta<0&&(Z*=-1),this.alpha+=Z*u,this.beta+=this.inertialBetaOffset*u,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<t.e&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<t.e&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*t.e&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){B=!0;const u=new G.Du(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),u.multiplyInPlace(this.panningAxis),G.Du.TransformNormalToRef(u,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const B=this.upVector,u=G.Du.CrossToRef(this._transformedDirection,B,this._transformedDirection);G.Du.CrossToRef(B,u,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);G.Du.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.Z(this._transformedDirection)}else{if(this.parent){const B=G.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(B),B.transposeToRef(B),G.Du.TransformCoordinatesToRef(this._transformedDirection,B,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*t.e&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*t.e&&(this.inertialPanningY=0)}if(B)this.stopInterpolation();else if(this._isInterpolating){let B=!1;const u=this._scene.getEngine().getDeltaTime()/1e3,F=1-Math.pow(2,-u/this._currentInterpolationFactor),Z=j(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const u=G.TmpVectors.Du[0].set(j(this._goalTarget.x,this._target.x),j(this._goalTarget.y,this._target.y),j(this._goalTarget.z,this._target.z));G.Du.LerpToRef(this.target,u,F,this._target),10*G.Du.Distance(this.target,u)/Z<t.e?(this._goalTarget.set(NaN,NaN,NaN),this.target.Z(u),this.setTarget(this.target,!1,!0,!0)):B=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const u=G.Quaternion.RotationAlphaBetaGammaToRef(j(this._goalAlpha,this.alpha),j(this._goalBeta,this.beta),0,G.TmpVectors.Quaternion[0]),Z=G.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,G.TmpVectors.Quaternion[1]),V=G.Quaternion.SlerpToRef(Z,u,F,G.TmpVectors.Quaternion[2]);V.normalize();const p=V.toAlphaBetaGammaToRef(G.TmpVectors.Du[0]);if(this.alpha=p.x,this.beta=p.y,V.isApprox(u,t.e/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const B=u.toAlphaBetaGammaToRef(G.TmpVectors.Du[0]);this.alpha=B.x,this.beta=B.y}else B=!0}if(isNaN(this._goalRadius)||(this.radius+=(Z-this.radius)*F,Math.abs(Z/this.radius-1)<t.e?(this._goalRadius=NaN,this.radius=Z):B=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const u=G.TmpVectors.Vector2[0].set(j(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),j(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));G.Vector2.LerpToRef(this.targetScreenOffset,u,F,this.targetScreenOffset),G.Vector2.Distance(this.targetScreenOffset,u)<t.e?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.Z(u)):B=!0}this._isInterpolating=B}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.Du.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const B=this.alpha;var u,F;this.alpha=function(B){let u=Math.PI/2;return 0===B.x&&0===B.z||(u=Math.acos(B.x/Math.sqrt(Math.pow(B.x,2)+Math.pow(B.z,2)))),B.z<0&&(u=2*Math.PI-u),u}(this._computationVector),this.beta=(u=this._computationVector.y,F=this.radius,Math.acos(u/F));const Z=Math.round((B-this.alpha)/(2*Math.PI));this.alpha+=2*Z*Math.PI,this._checkLimits()}setPosition(B){this._position.equals(B)||(this._position.Z(B),this.rebuildAnglesAndRadius())}setTarget(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Z=this.overrideCloneAlphaBetaRadius??Z,B.XR)u&&B.getBoundingInfo?this._targetBoundingCenter=B.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,B.XR(),this._targetHost=B,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const u=B,Z=this._getTargetPosition();if(Z&&!F&&Z.equals(u))return;this._targetHost=null,this._target=u,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}Z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const B=Math.cos(this.alpha),u=Math.sin(this.alpha),F=Math.cos(this.beta);let Z=Math.sin(this.beta);0===Z&&(Z=1e-4),0===this.radius&&(this.radius=1e-4);const V=this._getTargetPosition();if(this._computationVector.UR(this.radius*B*Z,this.radius*F,this.radius*u*Z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||G.Du.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),V.addToRef(this._computationVector,this._newPosition),this.yB().collisionsEnabled&&this.checkCollisions){const B=this.yB().collisionCoordinator;this._collider||(this._collider=B.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,B.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.Z(this._newPosition);let B=this.upVector;this.allowUpsideDown&&Z<0&&(B=B.negate()),this._computeViewMatrix(this._position,V,B),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.Z(V),this._viewMatrix}zoomOn(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B=B||this.yB().meshes;const F=s.b.MinMax(B);let Z=this._calculateLowerRadiusFromModelBoundingSphere(F.min,F.max);if(Z=Math.max(Math.min(Z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=Z*this.zoomOnFactor,this.mode===X.d.ORTHOGRAPHIC_CAMERA){const B=this.yB().getEngine().getAspectRatio(this),u=Z*this.zoomOnFactor/2;this.orthoLeft=-u*B,this.orthoRight=u*B,this.orthoBottom=-u,this.orthoTop=u}this.focusOn({min:F.min,max:F.max,distance:Z},u)}focusOn(B){let u,F,Z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===B.min){const Z=B||this.yB().meshes;u=s.b.MinMax(Z),F=G.Du.Distance(u.min,u.max)}else{u=B,F=B.distance}this._target=s.b.Center(u),Z||(this.maxZ=2*F)}createRigCamera(B,u){let F=0;switch(this.cameraRigMode){case X.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.d.RIG_MODE_VR:F=this._cameraRigParams.stereoHalfAngle*(0===u?1:-1);break;case X.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:F=this._cameraRigParams.stereoHalfAngle*(0===u?-1:1)}const Z=new o(B,this.alpha+F,this.beta,this.radius,this._target,this.yB());return Z._cameraRigParams={},Z.isRigCamera=!0,Z.rigParent=this,Z.upVector=this.upVector,Z.mode=this.mode,Z.orthoLeft=this.orthoLeft,Z.orthoRight=this.orthoRight,Z.orthoBottom=this.orthoBottom,Z.orthoTop=this.orthoTop,Z}_updateRigCameras(){const B=this._rigCameras[0],u=this._rigCameras[1];switch(B.beta=u.beta=this.beta,this.cameraRigMode){case X.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case X.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case X.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case X.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case X.d.RIG_MODE_VR:B.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case X.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:B.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,u.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const Z=G.Du.Distance(B,u),V=this.yB().getEngine().getAspectRatio(this),p=Math.tan(this.fov/2),R=p*V,e=.5*Z*F,s=e*Math.sqrt(1+1/(R*R)),Y=e*Math.sqrt(1+1/(p*p));return Math.max(s,Y)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,Z.d)([(0,V.L)()],o.prototype,"alpha",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"beta",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"radius",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,Z.d)([(0,V.H)("target")],o.prototype,"_target",void 0),(0,Z.d)([(0,V.z)("targetHost")],o.prototype,"_targetHost",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"inertialAlphaOffset",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"inertialBetaOffset",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"inertialRadiusOffset",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"lowerAlphaLimit",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"upperAlphaLimit",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"lowerBetaLimit",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"upperBetaLimit",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"lowerRadiusLimit",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"upperRadiusLimit",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"lowerTargetYLimit",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"inertialPanningX",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"inertialPanningY",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"pinchToPanMaxDistance",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"panningDistanceLimit",void 0),(0,Z.d)([(0,V.H)()],o.prototype,"panningOriginTarget",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"panningInertia",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"zoomToMouseLocation",null),(0,Z.d)([(0,V.L)()],o.prototype,"zoomOnFactor",void 0),(0,Z.d)([(0,V.G)()],o.prototype,"targetScreenOffset",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"allowUpsideDown",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"useInputToRestoreState",void 0),(0,Z.d)([(0,V.L)()],o.prototype,"restoreStateInterpolationFactor",void 0),(0,M.f)("BABYLON.ArcRotateCamera",o)},14622:(B,u,F)=>{"use strict";F.d(u,{c:()=>G,f:()=>R});var Z=F(12822),V=F(13014),p=F(13414),G={};class R{constructor(B){this.attachedToElement=!1,this.attached={},this.camera=B,this.checkInputs=()=>{}}add(B){const u=B.getSimpleName();this.attached[u]?Z.d.Warn("camera input of type "+u+" already exists on camera"):(this.attached[u]=B,B.camera=this.camera,B.checkInputs&&(this.checkInputs=this._addCheckInputs(B.checkInputs.bind(B))),this.attachedToElement&&B.attachControl(this.noPreventDefault))}remove(B){for(const u in this.attached){const F=this.attached[u];if(F===B)return F.ut(),F.camera=null,delete this.attached[u],void this.rebuildInputCheck()}}removeByType(B){for(const u in this.attached){const F=this.attached[u];F.getClassName()===B&&(F.ut(),F.camera=null,delete this.attached[u],this.rebuildInputCheck())}}_addCheckInputs(B){const u=this.checkInputs;return()=>{u(),B()}}attachInput(B){this.attachedToElement&&B.attachControl(this.noPreventDefault)}attachElement(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){B=!p.d.ForceAttachControlToAlwaysPreventDefault&&B,this.attachedToElement=!0,this.noPreventDefault=B;for(const u in this.attached)this.attached[u].attachControl(B)}}detachElement(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const u in this.attached)this.attached[u].ut(),B&&(this.attached[u].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const B in this.attached){const u=this.attached[B];u.checkInputs&&(this.checkInputs=this._addCheckInputs(u.checkInputs.bind(u)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(B){const u={};for(const F in this.attached){const B=this.attached[F],Z=V.c.Serialize(B);u[B.getClassName()]=Z}B.inputsmgr=u}parse(B){const u=B.inputsmgr;if(u){this.clear();for(const B in u){const F=G[B];if(F){const Z=u[B],p=V.c.Parse((()=>new F),Z,null);this.add(p)}}}else for(const F in this.attached){const u=G[this.attached[F].getClassName()];if(u){const Z=V.c.Parse((()=>new u),B,null);this.remove(this.attached[F]),this.add(Z)}}}}},14614:(B,u,F)=>{"use strict";F.d(u,{e:()=>U});var Z=F(12971),V=F(12973),p=F(12979),G=F(13452),R=F(14622),e=F(13263),s=F(12802);class Y{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(B){B=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.yB(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((u=>{const F=u.event;if(!F.metaKey)if(u.type===e.d.KEYDOWN){if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysUpward.indexOf(F.keyCode)||-1!==this.keysDownward.indexOf(F.keyCode)||-1!==this.keysRotateLeft.indexOf(F.keyCode)||-1!==this.keysRotateRight.indexOf(F.keyCode)||-1!==this.keysRotateUp.indexOf(F.keyCode)||-1!==this.keysRotateDown.indexOf(F.keyCode)){-1===this._keys.indexOf(F.keyCode)&&this._keys.push(F.keyCode),B||F.preventDefault()}}else if(-1!==this.keysUp.indexOf(F.keyCode)||-1!==this.keysDown.indexOf(F.keyCode)||-1!==this.keysLeft.indexOf(F.keyCode)||-1!==this.keysRight.indexOf(F.keyCode)||-1!==this.keysUpward.indexOf(F.keyCode)||-1!==this.keysDownward.indexOf(F.keyCode)||-1!==this.keysRotateLeft.indexOf(F.keyCode)||-1!==this.keysRotateRight.indexOf(F.keyCode)||-1!==this.keysRotateUp.indexOf(F.keyCode)||-1!==this.keysRotateDown.indexOf(F.keyCode)){const u=this._keys.indexOf(F.keyCode);u>=0&&this._keys.splice(u,1),B||F.preventDefault()}})))}ut(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const B=this.camera;for(let u=0;u<this._keys.length;u++){const F=this._keys[u],Z=B._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(F)?B._localDirection.UR(-Z,0,0):-1!==this.keysUp.indexOf(F)?B._localDirection.UR(0,0,Z):-1!==this.keysRight.indexOf(F)?B._localDirection.UR(Z,0,0):-1!==this.keysDown.indexOf(F)?B._localDirection.UR(0,0,-Z):-1!==this.keysUpward.indexOf(F)?B._localDirection.UR(0,Z,0):-1!==this.keysDownward.indexOf(F)?B._localDirection.UR(0,-Z,0):-1!==this.keysRotateLeft.indexOf(F)?(B._localDirection.UR(0,0,0),B.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(F)?(B._localDirection.UR(0,0,0),B.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(F)?(B._localDirection.UR(0,0,0),B.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(F)&&(B._localDirection.UR(0,0,0),B.cameraRotation.x+=this._getLocalRotation()),B.yB().useRightHandedSystem&&(B._localDirection.z*=-1),B.getViewMatrix().invertToRef(B._cameraTransformMatrix),p.Du.TransformNormalToRef(B._localDirection,B._cameraTransformMatrix,B._transformedDirection),B.cameraDirection.addInPlace(B._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const B=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*B}}(0,Z.d)([(0,V.L)()],Y.prototype,"keysUp",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysUpward",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysDown",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysDownward",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysLeft",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysRight",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"rotationSpeed",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysRotateLeft",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysRotateRight",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysRotateUp",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"keysRotateDown",void 0),R.c.FreeCameraKeyboardMoveInput=Y;var Q=F(12807),t=F(13261);class v{constructor(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=B,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new Q.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(B){B=s.Tools.BackCompatCameraNoPreventDefault(arguments);const u=this.camera.getEngine(),F=u.getInputElement();this._pointerInput||(this._pointerInput=Z=>{const V=Z.event,p="touch"===V.pointerType;if(!this.touchEnabled&&p)return;if(Z.type!==t.d.POINTERMOVE&&-1===this.buttons.indexOf(V.button))return;const G=V.target;if(Z.type===t.d.POINTERDOWN){if(p&&-1!==this._activePointerId||!p&&-1!==this._currentActiveButton)return;this._activePointerId=V.pointerId;try{null===G||void 0===G||G.setPointerCapture(V.pointerId)}catch(R){}-1===this._currentActiveButton&&(this._currentActiveButton=V.button),this._previousPosition={x:V.clientX,y:V.clientY},B||(V.preventDefault(),F&&F.focus()),u.isPointerLock&&this._onMouseMove&&this._onMouseMove(Z.event)}else if(Z.type===t.d.POINTERUP){if(p&&this._activePointerId!==V.pointerId||!p&&this._currentActiveButton!==V.button)return;try{null===G||void 0===G||G.releasePointerCapture(V.pointerId)}catch(R){}this._currentActiveButton=-1,this._previousPosition=null,B||V.preventDefault(),this._activePointerId=-1}else if(Z.type===t.d.POINTERMOVE&&(this._activePointerId===V.pointerId||!p))if(u.isPointerLock&&this._onMouseMove)this._onMouseMove(Z.event);else if(this._previousPosition){const u=this.camera._calculateHandednessMultiplier(),F=(V.clientX-this._previousPosition.x)*u,Z=V.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=F/this.angularSensibility,this.camera.cameraRotation.x+=Z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:F,offsetY:Z}),this._previousPosition={x:V.clientX,y:V.clientY},B||V.preventDefault()}}),this._onMouseMove=F=>{if(!u.isPointerLock)return;const Z=this.camera._calculateHandednessMultiplier(),V=F.movementX*Z;this.camera.cameraRotation.y+=V/this.angularSensibility;const p=F.movementY;this.camera.cameraRotation.x+=p/this.angularSensibility,this._previousPosition=null,B||F.preventDefault()},this._observer=this.camera.yB()._inputManager._addCameraPointerObserver(this._pointerInput,t.d.POINTERDOWN|t.d.POINTERUP|t.d.POINTERMOVE),F&&(this._contextMenuBind=B=>this.onContextMenu(B),F.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(B){B.preventDefault()}ut(){if(this._observer){if(this.camera.yB()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const B=this.camera.getEngine().getInputElement();B&&B.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,Z.d)([(0,V.L)()],v.prototype,"buttons",void 0),(0,Z.d)([(0,V.L)()],v.prototype,"angularSensibility",void 0),R.c.FreeCameraMouseInput=v;var D,L=F(13267);class q{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new Q.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(B){B=s.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=u=>{if(u.type!==t.d.POINTERWHEEL)return;const F=u.event,Z=F.deltaMode===L.d.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*Z*F.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*Z*F.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*Z*F.deltaZ/this._normalize,F.preventDefault&&(B||F.preventDefault())},this._observer=this.camera.yB()._inputManager._addCameraPointerObserver(this._wheel,t.d.POINTERWHEEL)}ut(){this._observer&&(this.camera.yB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,Z.d)([(0,V.L)()],q.prototype,"wheelPrecisionX",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"wheelPrecisionY",void 0),(0,Z.d)([(0,V.L)()],q.prototype,"wheelPrecisionZ",void 0),function(B){B[B.MoveRelative=0]="MoveRelative",B[B.RotateRelative=1]="RotateRelative",B[B.MoveScene=2]="MoveScene"}(D||(D={}));class W extends q{constructor(){super(...arguments),this._moveRelative=p.Du.Zero(),this._rotateRelative=p.Du.Zero(),this._moveScene=p.Du.Zero(),this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(B){null===B&&this._wheelXAction!==D.MoveRelative||(this._wheelXAction=D.MoveRelative,this._wheelXActionCoordinate=B)}get wheelXMoveRelative(){return this._wheelXAction!==D.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(B){null===B&&this._wheelYAction!==D.MoveRelative||(this._wheelYAction=D.MoveRelative,this._wheelYActionCoordinate=B)}get wheelYMoveRelative(){return this._wheelYAction!==D.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(B){null===B&&this._wheelZAction!==D.MoveRelative||(this._wheelZAction=D.MoveRelative,this._wheelZActionCoordinate=B)}get wheelZMoveRelative(){return this._wheelZAction!==D.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(B){null===B&&this._wheelXAction!==D.RotateRelative||(this._wheelXAction=D.RotateRelative,this._wheelXActionCoordinate=B)}get wheelXRotateRelative(){return this._wheelXAction!==D.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(B){null===B&&this._wheelYAction!==D.RotateRelative||(this._wheelYAction=D.RotateRelative,this._wheelYActionCoordinate=B)}get wheelYRotateRelative(){return this._wheelYAction!==D.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(B){null===B&&this._wheelZAction!==D.RotateRelative||(this._wheelZAction=D.RotateRelative,this._wheelZActionCoordinate=B)}get wheelZRotateRelative(){return this._wheelZAction!==D.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(B){null===B&&this._wheelXAction!==D.MoveScene||(this._wheelXAction=D.MoveScene,this._wheelXActionCoordinate=B)}get wheelXMoveScene(){return this._wheelXAction!==D.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(B){null===B&&this._wheelYAction!==D.MoveScene||(this._wheelYAction=D.MoveScene,this._wheelYActionCoordinate=B)}get wheelYMoveScene(){return this._wheelYAction!==D.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(B){null===B&&this._wheelZAction!==D.MoveScene||(this._wheelZAction=D.MoveScene,this._wheelZActionCoordinate=B)}get wheelZMoveScene(){return this._wheelZAction!==D.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.OR(0),this._rotateRelative.OR(0),this._moveScene.OR(0),this._updateCamera(),this.camera.yB().useRightHandedSystem&&(this._moveRelative.z*=-1);const B=p.Matrix.Zero();this.camera.getViewMatrix().invertToRef(B);const u=p.Du.Zero();p.Du.TransformNormalToRef(this._moveRelative,B,u),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(u),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(B,u,F){if(0===B)return;if(null===u||null===F)return;let Z=null;switch(u){case D.MoveRelative:Z=this._moveRelative;break;case D.RotateRelative:Z=this._rotateRelative;break;case D.MoveScene:Z=this._moveScene}switch(F){case 0:Z.set(B,0,0);break;case 1:Z.set(0,B,0);break;case 2:Z.set(0,0,B)}}}(0,Z.d)([(0,V.L)()],W.prototype,"wheelXMoveRelative",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelYMoveRelative",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelZMoveRelative",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelXRotateRelative",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelYRotateRelative",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelZRotateRelative",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelXMoveScene",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelYMoveScene",null),(0,Z.d)([(0,V.L)()],W.prototype,"wheelZMoveScene",null),R.c.FreeCameraMouseWheelInput=W;class X{constructor(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=B,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=s.Tools.IsSafari()}attachControl(B){B=s.Tools.BackCompatCameraNoPreventDefault(arguments);let u=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=F=>{const Z=F.event,V="mouse"===Z.pointerType||this._isSafari&&"undefined"===typeof Z.pointerType;if(this.allowMouse||!V)if(F.type===t.d.POINTERDOWN){if(B||Z.preventDefault(),this._pointerPressed.push(Z.pointerId),1!==this._pointerPressed.length)return;u={x:Z.clientX,y:Z.clientY}}else if(F.type===t.d.POINTERUP){B||Z.preventDefault();const F=this._pointerPressed.indexOf(Z.pointerId);if(-1===F)return;if(this._pointerPressed.splice(F,1),0!=F)return;u=null,this._offsetX=null,this._offsetY=null}else if(F.type===t.d.POINTERMOVE){if(B||Z.preventDefault(),!u)return;if(0!=this._pointerPressed.indexOf(Z.pointerId))return;this._offsetX=Z.clientX-u.x,this._offsetY=-(Z.clientY-u.y)}}),this._observer=this.camera.yB()._inputManager._addCameraPointerObserver(this._pointerInput,t.d.POINTERDOWN|t.d.POINTERUP|t.d.POINTERMOVE),this._onLostFocus){const B=this.camera.getEngine().getInputElement();B&&B.addEventListener("blur",this._onLostFocus)}}ut(){if(this._pointerInput){if(this._observer&&(this.camera.yB()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const B=this.camera.getEngine().getInputElement();B&&B.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const B=this.camera,u=B._calculateHandednessMultiplier();B.cameraRotation.y=u*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)B.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const u=B._computeLocalCameraSpeed(),F=new p.Du(0,0,0!==this.touchMoveSensibility?u*this._offsetY/this.touchMoveSensibility:0);p.Matrix.RotationYawPitchRollToRef(B.rotation.y,B.rotation.x,0,B._cameraRotationMatrix),B.cameraDirection.addInPlace(p.Du.TransformCoordinates(F,B._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,Z.d)([(0,V.L)()],X.prototype,"touchAngularSensibility",void 0),(0,Z.d)([(0,V.L)()],X.prototype,"touchMoveSensibility",void 0),R.c.FreeCameraTouchInput=X;class f extends R.f{constructor(B){super(B),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new Y),this}addMouse(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new v(B),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new W,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new X),this}clear(){super.clear(),this._mouseInput=null}}var C=F(12949),x=F(12888);class U extends G.b{get angularSensibility(){const B=this.inputs.attached.mouse;return B?B.angularSensibility:0}set angularSensibility(B){const u=this.inputs.attached.mouse;u&&(u.angularSensibility=B)}get keysUp(){const B=this.inputs.attached.keyboard;return B?B.keysUp:[]}set keysUp(B){const u=this.inputs.attached.keyboard;u&&(u.keysUp=B)}get keysUpward(){const B=this.inputs.attached.keyboard;return B?B.keysUpward:[]}set keysUpward(B){const u=this.inputs.attached.keyboard;u&&(u.keysUpward=B)}get keysDown(){const B=this.inputs.attached.keyboard;return B?B.keysDown:[]}set keysDown(B){const u=this.inputs.attached.keyboard;u&&(u.keysDown=B)}get keysDownward(){const B=this.inputs.attached.keyboard;return B?B.keysDownward:[]}set keysDownward(B){const u=this.inputs.attached.keyboard;u&&(u.keysDownward=B)}get keysLeft(){const B=this.inputs.attached.keyboard;return B?B.keysLeft:[]}set keysLeft(B){const u=this.inputs.attached.keyboard;u&&(u.keysLeft=B)}get keysRight(){const B=this.inputs.attached.keyboard;return B?B.keysRight:[]}set keysRight(B){const u=this.inputs.attached.keyboard;u&&(u.keysRight=B)}get keysRotateLeft(){const B=this.inputs.attached.keyboard;return B?B.keysRotateLeft:[]}set keysRotateLeft(B){const u=this.inputs.attached.keyboard;u&&(u.keysRotateLeft=B)}get keysRotateRight(){const B=this.inputs.attached.keyboard;return B?B.keysRotateRight:[]}set keysRotateRight(B){const u=this.inputs.attached.keyboard;u&&(u.keysRotateRight=B)}get keysRotateUp(){const B=this.inputs.attached.keyboard;return B?B.keysRotateUp:[]}set keysRotateUp(B){const u=this.inputs.attached.keyboard;u&&(u.keysRotateUp=B)}get keysRotateDown(){const B=this.inputs.attached.keyboard;return B?B.keysRotateDown:[]}set keysRotateDown(B){const u=this.inputs.attached.keyboard;u&&(u.keysRotateDown=B)}constructor(B,u,F){var Z;super(B,u,F,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),Z=this,this.ellipsoid=new p.Du(.5,1,.5),this.ellipsoidOffset=new p.Du(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=p.Du.Zero(),this._diffPosition=p.Du.Zero(),this._newPosition=p.Du.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Z._newPosition.Z(u),Z._newPosition.subtractToRef(Z._oldPosition,Z._diffPosition),Z._diffPosition.length()>x.c.CollisionsEpsilon&&(Z.position.addToRef(Z._diffPosition,Z._deferredPositionUpdate),Z._deferOnly?Z._deferredUpdated=!0:Z.position.Z(Z._deferredPositionUpdate),Z.Hv&&F&&Z.Hv(F))},this.inputs=new f(this),this.inputs.addKeyboard().addMouse()}attachControl(B,u){u=s.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(u)}ut(){this.inputs.detachElement(),this.cameraDirection=new p.Du(0,0,0),this.cameraRotation=new p.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(B){this._collisionMask=isNaN(B)?-1:B}_collideWithWorld(B){let u;u=this.parent?p.Du.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,u.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const F=this.yB().collisionCoordinator;this._collider||(this._collider=F.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let Z=B;this.applyGravity&&(Z=B.add(this.yB().gravity)),F.getNewPosition(this._oldPosition,Z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=p.Du.Zero(),this._transformedDirection=p.Du.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(B){this._needMoveForGravity=B}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.yB().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"Ge"}}(0,Z.d)([(0,V.H)()],U.prototype,"ellipsoid",void 0),(0,Z.d)([(0,V.H)()],U.prototype,"ellipsoidOffset",void 0),(0,Z.d)([(0,V.L)()],U.prototype,"checkCollisions",void 0),(0,Z.d)([(0,V.L)()],U.prototype,"applyGravity",void 0),(0,C.f)("BABYLON.FreeCamera",U)},15221:(B,u,F)=>{"use strict";F.d(u,{e:()=>p});var Z=F(13072),V=F(15223);class p{constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=F,this.fQ=[],this._maxBlockCapacity=u||64,this._selectionContent=new Z.e(1024),this._creationFunc=B}update(B,u,F){V.d._CreateBlocks(B,u,F,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}gY(B){for(let u=0;u<this.HY.length;u++){this.HY[u].addEntry(B)}}OY(B){for(let u=0;u<this.HY.length;u++){this.HY[u].removeEntry(B)}}select(B,u){this._selectionContent.reset();for(let F=0;F<this.HY.length;F++){this.HY[F].select(B,this._selectionContent,u)}return u?this._selectionContent.concat(this.fQ):this._selectionContent.concatWithNoDuplicate(this.fQ),this._selectionContent}intersects(B,u,F){this._selectionContent.reset();for(let Z=0;Z<this.HY.length;Z++){this.HY[Z].intersects(B,u,this._selectionContent,F)}return F?this._selectionContent.concat(this.fQ):this._selectionContent.concatWithNoDuplicate(this.fQ),this._selectionContent}intersectsRay(B){this._selectionContent.reset();for(let u=0;u<this.HY.length;u++){this.HY[u].intersectsRay(B,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.fQ),this._selectionContent}}p.CreationFuncForMeshes=(B,u)=>{const F=B.getBoundingInfo();!B.isBlocked&&F.boundingBox.intersectsMinMax(u.OQ,u.gQ)&&u.entries.push(B)},p.CreationFuncForSubMeshes=(B,u)=>{B.getBoundingInfo().boundingBox.intersectsMinMax(u.OQ,u.gQ)&&u.entries.push(B)}},15223:(B,u,F)=>{"use strict";F.d(u,{d:()=>p});var Z=F(12979),V=F(13325);class p{constructor(B,u,F,Z,V,p){this.entries=[],this.JQ=new Array,this._capacity=F,this._depth=Z,this._maxDepth=V,this._creationFunc=p,this._minPoint=B,this._maxPoint=u,this.JQ.push(B.clone()),this.JQ.push(u.clone()),this.JQ.push(B.clone()),this.JQ[2].x=u.x,this.JQ.push(B.clone()),this.JQ[3].y=u.y,this.JQ.push(B.clone()),this.JQ[4].z=u.z,this.JQ.push(u.clone()),this.JQ[5].z=B.z,this.JQ.push(u.clone()),this.JQ[6].x=B.x,this.JQ.push(u.clone()),this.JQ[7].y=B.y}get xu(){return this._capacity}get OQ(){return this._minPoint}get gQ(){return this._maxPoint}addEntry(B){if(this.HY)for(let u=0;u<this.HY.length;u++){this.HY[u].addEntry(B)}else this._creationFunc(B,this),this.entries.length>this.xu&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(B){if(this.HY){for(let u=0;u<this.HY.length;u++){this.HY[u].removeEntry(B)}return}const u=this.entries.indexOf(B);u>-1&&this.entries.splice(u,1)}addEntries(B){for(let u=0;u<B.length;u++){const F=B[u];this.addEntry(F)}}select(B,u,F){if(V.d.IsInFrustum(this.JQ,B)){if(this.HY){for(let Z=0;Z<this.HY.length;Z++){this.HY[Z].select(B,u,F)}return}F?u.concat(this.entries):u.concatWithNoDuplicate(this.entries)}}intersects(B,u,F,Z){if(V.d.IntersectsSphere(this._minPoint,this._maxPoint,B,u)){if(this.HY){for(let V=0;V<this.HY.length;V++){this.HY[V].intersects(B,u,F,Z)}return}Z?F.concat(this.entries):F.concatWithNoDuplicate(this.entries)}}intersectsRay(B,u){if(B.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.HY){for(let F=0;F<this.HY.length;F++){this.HY[F].intersectsRay(B,u)}return}u.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){p._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(B,u,F,V,G,R,e,s){e.HY=new Array;const Y=new Z.Du((u.x-B.x)/2,(u.y-B.y)/2,(u.z-B.z)/2);for(let Z=0;Z<2;Z++)for(let u=0;u<2;u++)for(let Q=0;Q<2;Q++){const t=B.add(Y.multiplyByFloats(Z,u,Q)),v=B.add(Y.multiplyByFloats(Z+1,u+1,Q+1)),D=new p(t,v,V,G+1,R,s);D.addEntries(F),e.HY.push(D)}}}},15231:(B,u,F)=>{"use strict";F.d(u,{d:()=>Y});var Z=F(13221),V=F(12979),p=F(13396),G=F(14349),R=F(13256),e=F(15221),s=F(12855);Z.e.prototype.createOrUpdateSelectionOctree=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,F=this._getComponent(R.d.NAME_OCTREE);F||(F=new Y(this),this.ZR(F)),this.WQ||(this.WQ=new e.e(e.e.CreationFuncForMeshes,B,u));const Z=this.getWorldExtends();return this.WQ.update(Z.min,Z.max,this.meshes),this.WQ},Object.defineProperty(Z.e.prototype,"selectionOctree",{get:function(){return this.WQ},enumerable:!0,configurable:!0}),p.e.prototype.createOrUpdateSubmeshesOctree=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const F=this.yB();let Z=F._getComponent(R.d.NAME_OCTREE);Z||(Z=new Y(F),F.ZR(Z)),this._submeshesOctree||(this._submeshesOctree=new e.e(e.e.CreationFuncForSubMeshes,B,u)),this.XR(!0);const V=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(V.minimumWorld,V.maximumWorld,this.vR),this._submeshesOctree};class Y{constructor(B){this.name=R.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new G.c(V.Du.Zero(),new V.Du(1,1,1)),(B=B||s.b.LastCreatedScene)&&(this.qu=B,this.qu.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.qu.getActiveSubMeshCandidates=B=>this.getActiveSubMeshCandidates(B),this.qu.getCollidingSubMeshCandidates=(B,u)=>this.getCollidingSubMeshCandidates(B,u),this.qu.getIntersectingSubMeshCandidates=(B,u)=>this.getIntersectingSubMeshCandidates(B,u))}register(){this.qu.onMeshRemovedObservable.add((B=>{const u=this.qu.selectionOctree;if(void 0!==u&&null!==u){const F=u.fQ.indexOf(B);-1!==F&&u.fQ.splice(F,1)}})),this.qu.onMeshImportedObservable.add((B=>{const u=this.qu.selectionOctree;void 0!==u&&null!==u&&u.gY(B)}))}getActiveMeshCandidates(){var B;return(null===(B=this.qu.WQ)||void 0===B?void 0:B.select(this.qu.frustumPlanes))||this.qu._getDefaultMeshCandidates()}getActiveSubMeshCandidates(B){if(B._submeshesOctree&&B.useOctreeForRenderingSelection){return B._submeshesOctree.select(this.qu.frustumPlanes)}return this.qu._getDefaultSubMeshCandidates(B)}getIntersectingSubMeshCandidates(B,u){if(B._submeshesOctree&&B.useOctreeForPicking){G.c.TransformToRef(u,B.getWorldMatrix(),this._tempRay);return B._submeshesOctree.intersectsRay(this._tempRay)}return this.qu._getDefaultSubMeshCandidates(B)}getCollidingSubMeshCandidates(B,u){if(B._submeshesOctree&&B.useOctreeForCollisions){const F=u._velocityWorldLength+Math.max(u._radius.x,u._radius.y,u._radius.z);return B._submeshesOctree.intersects(u._basePointWorld,F)}return this.qu._getDefaultSubMeshCandidates(B)}rebuild(){}dispose(){}}},14349:(B,u,F)=>{"use strict";F.d(u,{c:()=>v});var Z=F(13221),V=F(13414),p=F(12982),G=F(12979),R=F(12985),e=F(13315),s=F(13249),Y=F(12855),Q=F(13274);const t={internalPickerForMesh:void 0};class v{constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.e;this.origin=B,this.direction=u,this.length=F,this.epsilon=Z}clone(){return new v(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const Z=v._TmpVector3[0].UR(B.x-F,B.y-F,B.z-F),V=v._TmpVector3[1].UR(u.x+F,u.y+F,u.z+F);let p,G,R,e,s=0,Y=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<Z.x||this.origin.x>V.x)return!1}else if(p=1/this.direction.x,G=(Z.x-this.origin.x)*p,R=(V.x-this.origin.x)*p,R===-1/0&&(R=1/0),G>R&&(e=G,G=R,R=e),s=Math.max(G,s),Y=Math.min(R,Y),s>Y)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<Z.y||this.origin.y>V.y)return!1}else if(p=1/this.direction.y,G=(Z.y-this.origin.y)*p,R=(V.y-this.origin.y)*p,R===-1/0&&(R=1/0),G>R&&(e=G,G=R,R=e),s=Math.max(G,s),Y=Math.min(R,Y),s>Y)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<Z.z||this.origin.z>V.z)return!1}else if(p=1/this.direction.z,G=(Z.z-this.origin.z)*p,R=(V.z-this.origin.z)*p,R===-1/0&&(R=1/0),G>R&&(e=G,G=R,R=e),s=Math.max(G,s),Y=Math.min(R,Y),s>Y)return!1;return!0}intersectsBox(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(B.minimum,B.maximum,u)}intersectsSphere(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=B.center.x-this.origin.x,Z=B.center.y-this.origin.y,V=B.center.z-this.origin.z,p=F*F+Z*Z+V*V,G=B.radius+u,R=G*G;if(p<=R)return!0;const e=F*this.direction.x+Z*this.direction.y+V*this.direction.z;if(e<0)return!1;return p-e*e<=R}intersectsTriangle(B,u,F){const Z=v._TmpVector3[0],V=v._TmpVector3[1],p=v._TmpVector3[2],R=v._TmpVector3[3],s=v._TmpVector3[4];u.subtractToRef(B,Z),F.subtractToRef(B,V),G.Du.CrossToRef(this.direction,V,p);const Y=G.Du.Dot(Z,p);if(0===Y)return null;const Q=1/Y;this.origin.subtractToRef(B,R);const t=G.Du.Dot(R,p)*Q;if(t<-this.epsilon||t>1+this.epsilon)return null;G.Du.CrossToRef(R,Z,s);const D=G.Du.Dot(this.direction,s)*Q;if(D<-this.epsilon||t+D>1+this.epsilon)return null;const L=G.Du.Dot(V,s)*Q;return L>this.length?null:new e.e(1-t-D,t,L)}intersectsPlane(B){let u;const F=G.Du.Dot(B.normal,this.direction);if(Math.abs(F)<9.99999997475243e-7)return null;{const Z=G.Du.Dot(B.normal,this.origin);return u=(-B.d-Z)/F,u<0?u<-9.99999997475243e-7?null:0:u}}intersectsAxis(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(B){case"y":{const B=(this.origin.y-u)/this.direction.y;return B>0?null:new G.Du(this.origin.x+this.direction.x*-B,u,this.origin.z+this.direction.z*-B)}case"x":{const B=(this.origin.x-u)/this.direction.x;return B>0?null:new G.Du(u,this.origin.y+this.direction.y*-B,this.origin.z+this.direction.z*-B)}case"z":{const B=(this.origin.z-u)/this.direction.z;return B>0?null:new G.Du(this.origin.x+this.direction.x*-B,this.origin.y+this.direction.y*-B,u)}default:return null}}intersectsMesh(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const R=G.TmpVectors.Matrix[0];return B.getWorldMatrix().invertToRef(R),this._tmpRay?v.TransformToRef(this,R,this._tmpRay):this._tmpRay=v.Transform(this,R),B.intersects(this._tmpRay,u,F,Z,V,p)}intersectsMeshes(B,u,F){F?F.length=0:F=[];for(let Z=0;Z<B.length;Z++){const V=this.intersectsMesh(B[Z],u);V.hit&&F.push(V)}return F.sort(this._comparePickingInfo),F}_comparePickingInfo(B,u){return B.distance<u.distance?-1:B.distance>u.distance?1:0}intersectionSegment(B,u,F){const Z=this.origin,V=G.TmpVectors.Du[0],p=G.TmpVectors.Du[1],R=G.TmpVectors.Du[2],e=G.TmpVectors.Du[3];u.subtractToRef(B,V),this.direction.scaleToRef(v._Rayl,R),Z.addToRef(R,p),B.subtractToRef(Z,e);const s=G.Du.Dot(V,V),Y=G.Du.Dot(V,R),Q=G.Du.Dot(R,R),t=G.Du.Dot(V,e),D=G.Du.Dot(R,e),L=s*Q-Y*Y;let q,W,X=L,f=L;L<v._Smallnum?(q=0,X=1,W=D,f=Q):(q=Y*D-Q*t,W=s*D-Y*t,q<0?(q=0,W=D,f=Q):q>X&&(q=X,W=D+Y,f=Q)),W<0?(W=0,-t<0?q=0:-t>s?q=X:(q=-t,X=s)):W>f&&(W=f,-t+Y<0?q=0:-t+Y>s?q=X:(q=-t+Y,X=s));const C=Math.abs(q)<v._Smallnum?0:q/X,x=Math.abs(W)<v._Smallnum?0:W/f,U=G.TmpVectors.Du[4];R.scaleToRef(x,U);const y=G.TmpVectors.Du[5];V.scaleToRef(C,y),y.addInPlace(e);const O=G.TmpVectors.Du[6];y.subtractToRef(U,O);return x>0&&x<=this.length&&O.lengthSquared()<F*F?y.length():-1}update(B,u,F,Z,V,p,R){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){v._RayDistant||(v._RayDistant=v.Zero()),v._RayDistant.unprojectRayToRef(B,u,F,Z,G.Matrix.IdentityReadOnly,p,R);const e=G.TmpVectors.Matrix[0];V.invertToRef(e),v.TransformToRef(v._RayDistant,e,this)}else this.unprojectRayToRef(B,u,F,Z,V,p,R);return this}static Zero(){return new v(G.Du.Zero(),G.Du.Zero())}static CreateNew(B,u,F,Z,V,p,G){return v.Zero().update(B,u,F,Z,V,p,G)}static CreateNewFromTo(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:G.Matrix.IdentityReadOnly;const Z=new v(new G.Du(0,0,0),new G.Du(0,0,0));return v.CreateFromToToRef(B,u,Z,F)}static CreateFromToToRef(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G.Matrix.IdentityReadOnly;F.origin.Z(B);const V=u.subtractToRef(B,F.direction),p=Math.sqrt(V.x*V.x+V.y*V.y+V.z*V.z);return F.length=p,F.direction.normalize(),v.TransformToRef(F,Z,F)}static Transform(B,u){const F=new v(new G.Du(0,0,0),new G.Du(0,0,0));return v.TransformToRef(B,u,F),F}static TransformToRef(B,u,F){G.Du.TransformCoordinatesToRef(B.origin,u,F.origin),G.Du.TransformNormalToRef(B.direction,u,F.direction),F.length=B.length,F.epsilon=B.epsilon;const Z=F.direction,V=Z.length();if(0!==V&&1!==V){const B=1/V;Z.x*=B,Z.y*=B,Z.z*=B,F.length*=V}return F}unprojectRayToRef(B,u,F,Z,V,p,R){const e=G.TmpVectors.Matrix[0];V.multiplyToRef(p,e),e.multiplyToRef(R,e),e.invert();const s=Y.b.LastCreatedEngine,Q=G.TmpVectors.Du[0];Q.x=B/F*2-1,Q.y=-(u/Z*2-1),Q.z=null!==s&&void 0!==s&&s.o?1:null!==s&&void 0!==s&&s.isNDCHalfZRange?0:-1;const t=G.TmpVectors.Du[1].UR(Q.x,Q.y,1-1e-8),v=G.TmpVectors.Du[2],D=G.TmpVectors.Du[3];G.Du._UnprojectFromInvertedMatrixToRef(Q,e,v),G.Du._UnprojectFromInvertedMatrixToRef(t,e,D),this.origin.Z(v),D.subtractToRef(v,this.direction),this.direction.normalize()}}function D(B,u,F,Z,V){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const G=v.Zero();return L(B,u,F,Z,G,V,p),G}function L(B,u,F,Z,V,p){let R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const s=B.getEngine();if(!p&&!(p=B.activeCamera))return B;const Y=p.viewport,Q=s.getRenderHeight(),{x:t,y:v,width:D,height:L}=Y.toGlobal(s.getRenderWidth(),Q),q=1/s.getHardwareScalingLevel();return u=u*q-t,F=F*q-(Q-v-L),V.update(u,F,D,L,Z||G.Matrix.IdentityReadOnly,R?G.Matrix.IdentityReadOnly:p.getViewMatrix(),p.getProjectionMatrix(),e),B}function q(B,u,F,Z,V){if(!s.c)return B;const p=B.getEngine();if(!V&&!(V=B.activeCamera))throw new Error("Active camera not set");const R=V.viewport,e=p.getRenderHeight(),{x:Y,y:Q,width:t,height:v}=R.toGlobal(p.getRenderWidth(),e),D=G.Matrix.Identity(),L=1/p.getHardwareScalingLevel();return u=u*L-Y,F=F*L-(e-Q-v),Z.update(u,F,t,v,D,D,V.getProjectionMatrix()),B}function W(B,u,F,Z,V,p,G,R){const e=u(Z,F.enableDistantPicking),s=F.intersects(e,V,G,p,Z,R);return s&&s.hit?!V&&null!=B&&s.distance>=B.distance?null:s:null}function X(B,u,F,Z,V,p){let R=null;const e=!!(B.activeCameras&&B.activeCameras.length>1&&B.cameraToUseForPointers!==B.activeCamera),Y=B.cameraToUseForPointers||B.activeCamera,Q=t.internalPickerForMesh||W;for(let s=0;s<B.meshes.length;s++){const t=B.meshes[s];if(F){if(!F(t,-1))continue}else if(!t.isEnabled()||!t.isVisible||!t.Rs)continue;const v=e&&t.isWorldMatrixCameraDependent(),D=t.XR(v,Y);if(t.hasThinInstances&&t.Ps){const B=Q(R,u,t,D,!0,!0,p);if(B){if(V)return B;const e=G.TmpVectors.Matrix[1],s=t.thinInstanceGetWorldMatrices();for(let B=0;B<s.length;B++){if(F&&!F(t,B))continue;s[B].multiplyToRef(D,e);const G=Q(R,u,t,e,Z,V,p,!0);if(G&&(R=G,R.thinInstanceIndex=B,Z))return R}}}else{const B=Q(R,u,t,D,Z,V,p);if(B&&(R=B,Z))return R}}return R||new s.c}function f(B,u,F,Z){if(!s.c)return null;const V=[],p=!!(B.activeCameras&&B.activeCameras.length>1&&B.cameraToUseForPointers!==B.activeCamera),R=B.cameraToUseForPointers||B.activeCamera,e=t.internalPickerForMesh||W;for(let s=0;s<B.meshes.length;s++){const Y=B.meshes[s];if(F){if(!F(Y,-1))continue}else if(!Y.isEnabled()||!Y.isVisible||!Y.Rs)continue;const Q=p&&Y.isWorldMatrixCameraDependent(),t=Y.XR(Q,R);if(Y.hasThinInstances&&Y.Ps){if(e(null,u,Y,t,!0,!0,Z)){const B=G.TmpVectors.Matrix[1],p=Y.thinInstanceGetWorldMatrices();for(let G=0;G<p.length;G++){if(F&&!F(Y,G))continue;p[G].multiplyToRef(t,B);const R=e(null,u,Y,B,!1,!1,Z,!0);R&&(R.thinInstanceIndex=G,V.push(R))}}}else{const B=e(null,u,Y,t,!1,!1,Z);B&&V.push(B)}}return V}function C(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,Z=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0;Z||(Z=B.getWorldMatrix()),u.length=F,V?u.origin.Z(V):u.origin.Z(B.position);const p=G.TmpVectors.Du[2];p.set(0,0,B._scene.useRightHandedSystem?-1:1);const R=G.TmpVectors.Du[3];return G.Du.TransformNormalToRef(p,Z,R),G.Du.NormalizeToRef(R,u.direction),u}var x,U;v._TmpVector3=(0,R.e)(6,G.Du.Zero),v._RayDistant=v.Zero(),v._Smallnum=1e-8,v._Rayl=1e9,x=Z.e,(U=V.d)&&(U.prototype.getForwardRay=function(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,u=arguments.length>1?arguments[1]:void 0,F=arguments.length>2?arguments[2]:void 0;return C(this,new v(G.Du.Zero(),G.Du.Zero(),B),B,u,F)},U.prototype.getForwardRayToRef=function(B){return C(this,B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),x&&(Q.d._IsPickingAvailable=!0,x.prototype.createPickingRay=function(B,u,F,Z){return D(this,B,u,F,Z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),Z.e.prototype.createPickingRayToRef=function(B,u,F,Z,V){return L(this,B,u,F,Z,V,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},Z.e.prototype.createPickingRayInCameraSpace=function(B,u,F){return function(B,u,F,Z){const V=v.Zero();return q(B,u,F,V,Z),V}(this,B,u,F)},Z.e.prototype.createPickingRayInCameraSpaceToRef=function(B,u,F,Z){return q(this,B,u,F,Z)},Z.e.prototype.pickWithBoundingInfo=function(B,u,F,Z,V){return function(B,u,F,Z,V,p){if(!s.c)return null;const R=X(B,(Z=>(B._tempPickingRay||(B._tempPickingRay=v.Zero()),L(B,u,F,Z,B._tempPickingRay,p||null),B._tempPickingRay)),Z,V,!0);return R&&(R.ray=D(B,u,F,G.Matrix.Identity(),p||null)),R}(this,B,u,F,Z,V)},Z.e.prototype.tF=function(B,u,F,Z,V,p){return function(B,u,F,Z,V,p,R){const e=X(B,((Z,V)=>(B._tempPickingRay||(B._tempPickingRay=v.Zero()),L(B,u,F,Z,B._tempPickingRay,p||null,!1,V),B._tempPickingRay)),Z,V,!1,R);return e&&(e.ray=D(B,u,F,G.Matrix.Identity(),p||null)),e}(this,B,u,F,Z,V,p)},Z.e.prototype.pickWithRay=function(B,u,F,Z){return function(B,u,F,Z,V){const p=X(B,(F=>(B._pickWithRayInverseMatrix||(B._pickWithRayInverseMatrix=G.Matrix.Identity()),F.invertToRef(B._pickWithRayInverseMatrix),B._cachedRayForTransform||(B._cachedRayForTransform=v.Zero()),v.TransformToRef(u,B._pickWithRayInverseMatrix,B._cachedRayForTransform),B._cachedRayForTransform)),F,Z,!1,V);return p&&(p.ray=u),p}(this,B,u,F,Z)},Z.e.prototype.multiPick=function(B,u,F,Z,V){return function(B,u,F,Z,V,p){return f(B,(Z=>D(B,u,F,Z,V||null)),Z,p)}(this,B,u,F,Z,V)},Z.e.prototype.multiPickWithRay=function(B,u,F){return function(B,u,F,Z){return f(B,(F=>(B._pickWithRayInverseMatrix||(B._pickWithRayInverseMatrix=G.Matrix.Identity()),F.invertToRef(B._pickWithRayInverseMatrix),B._cachedRayForTransform||(B._cachedRayForTransform=v.Zero()),v.TransformToRef(u,B._pickWithRayInverseMatrix,B._cachedRayForTransform),B._cachedRayForTransform)),F,Z)}(this,B,u,F)}},14668:(B,u,F)=>{"use strict";var Z=F(12925),V=F(12822),p=F(12861),G=F(12955),R=F(12888),e=F(12937);R.c.prototype._partialLoadFile=function(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(B,(B=>{F[u]=B,F._internalCount++,6===F._internalCount&&Z(F)}),void 0,void 0,!0,((B,u)=>{V&&B&&V(B.status+" "+B.statusText,u)}))},R.c.prototype._cascadeLoadFiles=function(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const V=[];V._internalCount=0;for(let p=0;p<6;p++)this._partialLoadFile(F[p],p,V,u,Z)},R.c.prototype._cascadeLoadImgs=function(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5?arguments[5]:void 0;const G=[];G._internalCount=0;for(let R=0;R<6;R++)this._partialLoadImg(Z[R],R,G,B,u,F,V,p)},R.c.prototype._partialLoadImg=function(B,u,F,Z,V,R){let e=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7?arguments[7]:void 0;const Y=(0,G.d)();(0,p.n)(B,(B=>{F[u]=B,F._internalCount++,Z&&Z.removePendingData(Y),6===F._internalCount&&R&&R(V,F)}),((B,u)=>{Z&&Z.removePendingData(Y),e&&e(B,u)}),Z?Z.offlineProvider:null,s),Z&&Z.addPendingData(Y)},R.c.prototype.createCubeTextureBase=function(B,u,F,p){let G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,L=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,q=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,W=arguments.length>14&&void 0!==arguments[14]&&arguments[14],X=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const f=D||new Z.b(this,7);f.isCube=!0,f.url=B,f.generateMipMaps=!p,f._lodGenerationScale=t,f._lodGenerationOffset=v,f._useSRGBBuffer=!!W&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!p),f!==D&&(f.label=B.substring(0,60)),this._doNotHandleContextLost||(f._extension=Y,f._files=F,f._buffer=X);const C=B;this._transformTextureUrl&&!D&&(B=this._transformTextureUrl(B));const x=Y??function(B){const u=B.split("?")[0],F=u.lastIndexOf(".");return F>-1?u.substring(F).toLowerCase():""}(B),U=(0,e.e)(x),y=(B,u)=>{f.dispose(),R?R(B,u):B&&V.d.Warn(B)},O=(Z,R)=>{B===C?Z&&y(Z.status+" "+Z.statusText,R):(V.d.Warn(`Failed to load ${B}, falling back to the ${C}`),this.createCubeTextureBase(C,u,F,!!p,G,y,s,Y,Q,t,v,f,L,q,W,X))};if(U)U.then((Z=>{const V=B=>{L&&L(f,B),Z.loadCubeData(B,f,Q,G,((B,u)=>{y(B,u)}))};X?V(X):F&&6===F.length?Z.supportCascades?this._cascadeLoadFiles(u,(B=>V(B.map((B=>new Uint8Array(B))))),F,y):y("Textures type does not support cascades."):this._loadFile(B,(B=>V(new Uint8Array(B))),void 0,void 0,!0,O)}));else{if(!F||0===F.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(u,f,((B,u)=>{q&&q(B,u)}),F,y)}return this._internalTexturesCache.push(f),f}},15233:(B,u,F)=>{"use strict";F(12822);var Z=F(13108);F(12925),F(13055),F(12917),F(13157),F(13121);Z.b},14694:(B,u,F)=>{"use strict";F.d(u,{d:()=>V});var Z=F(12949);class V{constructor(B){this.value=this._toInt(B)}_toInt(B){return 0|B}add(B){return new V(this.value+B.value)}Lu(B){return new V(this.value-B.value)}multiply(B){return new V(Math.imul(this.value,B.value))}divide(B){return new V(this.value/B.value)}getClassName(){return V.ClassName}equals(B){return this.value===B.value}static FromValue(B){return new V(B)}toString(){return this.value.toString()}}V.ClassName="FlowGraphInteger",(0,Z.f)("FlowGraphInteger",V)},14707:(B,u,F)=>{"use strict";F.d(u,{e:()=>V,f:()=>p});var Z=F(12979);class V{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.eR=B}get m(){return this.eR}transformVector(B){return this.transformVectorToRef(B,new Z.Vector2)}transformVectorToRef(B,u){return u.x=B.x*this.eR[0]+B.y*this.eR[1],u.y=B.x*this.eR[2]+B.y*this.eR[3],u}DR(){return this.toArray()}toArray(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<4;u++)B[u]=this.eR[u];return B}vF(B){for(let u=0;u<4;u++)this.eR[u]=B[u];return this}multiplyToRef(B,u){const F=B.eR,Z=this.eR,V=u.eR;return V[0]=F[0]*Z[0]+F[1]*Z[2],V[1]=F[0]*Z[1]+F[1]*Z[3],V[2]=F[2]*Z[0]+F[3]*Z[2],V[3]=F[2]*Z[1]+F[3]*Z[3],u}multiply(B){return this.multiplyToRef(B,new V)}divideToRef(B,u){const F=this.eR,Z=B.eR,V=u.eR;return V[0]=F[0]/Z[0],V[1]=F[1]/Z[1],V[2]=F[2]/Z[2],V[3]=F[3]/Z[3],u}divide(B){return this.divideToRef(B,new V)}addToRef(B,u){const F=this.eR,Z=B.m,V=u.m;return V[0]=F[0]+Z[0],V[1]=F[1]+Z[1],V[2]=F[2]+Z[2],V[3]=F[3]+Z[3],u}add(B){return this.addToRef(B,new V)}subtractToRef(B,u){const F=this.eR,Z=B.m,V=u.m;return V[0]=F[0]-Z[0],V[1]=F[1]-Z[1],V[2]=F[2]-Z[2],V[3]=F[3]-Z[3],u}Lu(B){return this.subtractToRef(B,new V)}transpose(){const B=this.eR;return new V([B[0],B[2],B[1],B[3]])}determinant(){const B=this.eR;return B[0]*B[3]-B[1]*B[2]}inverse(){const B=this.determinant();if(0===B)throw new Error("Matrix is not invertible");const u=this.eR,F=1/B;return new V([u[3]*F,-u[1]*F,-u[2]*F,u[0]*F])}equals(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=this.eR,Z=B.m;return 0===u?F[0]===Z[0]&&F[1]===Z[1]&&F[2]===Z[2]&&F[3]===Z[3]:Math.abs(F[0]-Z[0])<u&&Math.abs(F[1]-Z[1])<u&&Math.abs(F[2]-Z[2])<u&&Math.abs(F[3]-Z[3])<u}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.eR.join(", ")})`}}class p{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.eR=B}get m(){return this.eR}transformVector(B){return this.transformVectorToRef(B,new Z.Du)}transformVectorToRef(B,u){const F=this.eR;return u.x=B.x*F[0]+B.y*F[1]+B.z*F[2],u.y=B.x*F[3]+B.y*F[4]+B.z*F[5],u.z=B.x*F[6]+B.y*F[7]+B.z*F[8],u}multiplyToRef(B,u){const F=B.eR,Z=this.eR,V=u.m;return V[0]=F[0]*Z[0]+F[1]*Z[3]+F[2]*Z[6],V[1]=F[0]*Z[1]+F[1]*Z[4]+F[2]*Z[7],V[2]=F[0]*Z[2]+F[1]*Z[5]+F[2]*Z[8],V[3]=F[3]*Z[0]+F[4]*Z[3]+F[5]*Z[6],V[4]=F[3]*Z[1]+F[4]*Z[4]+F[5]*Z[7],V[5]=F[3]*Z[2]+F[4]*Z[5]+F[5]*Z[8],V[6]=F[6]*Z[0]+F[7]*Z[3]+F[8]*Z[6],V[7]=F[6]*Z[1]+F[7]*Z[4]+F[8]*Z[7],V[8]=F[6]*Z[2]+F[7]*Z[5]+F[8]*Z[8],u}multiply(B){return this.multiplyToRef(B,new p)}divideToRef(B,u){const F=this.eR,Z=B.m,V=u.m;return V[0]=F[0]/Z[0],V[1]=F[1]/Z[1],V[2]=F[2]/Z[2],V[3]=F[3]/Z[3],V[4]=F[4]/Z[4],V[5]=F[5]/Z[5],V[6]=F[6]/Z[6],V[7]=F[7]/Z[7],V[8]=F[8]/Z[8],u}divide(B){return this.divideToRef(B,new p)}addToRef(B,u){const F=this.eR,Z=B.m,V=u.m;return V[0]=F[0]+Z[0],V[1]=F[1]+Z[1],V[2]=F[2]+Z[2],V[3]=F[3]+Z[3],V[4]=F[4]+Z[4],V[5]=F[5]+Z[5],V[6]=F[6]+Z[6],V[7]=F[7]+Z[7],V[8]=F[8]+Z[8],u}add(B){return this.addToRef(B,new p)}subtractToRef(B,u){const F=this.eR,Z=B.m,V=u.m;return V[0]=F[0]-Z[0],V[1]=F[1]-Z[1],V[2]=F[2]-Z[2],V[3]=F[3]-Z[3],V[4]=F[4]-Z[4],V[5]=F[5]-Z[5],V[6]=F[6]-Z[6],V[7]=F[7]-Z[7],V[8]=F[8]-Z[8],u}Lu(B){return this.subtractToRef(B,new p)}toArray(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let u=0;u<9;u++)B[u]=this.eR[u];return B}DR(){return this.toArray()}vF(B){for(let u=0;u<9;u++)this.eR[u]=B[u];return this}transpose(){const B=this.eR;return new p([B[0],B[3],B[6],B[1],B[4],B[7],B[2],B[5],B[8]])}determinant(){const B=this.eR;return B[0]*(B[4]*B[8]-B[5]*B[7])-B[1]*(B[3]*B[8]-B[5]*B[6])+B[2]*(B[3]*B[7]-B[4]*B[6])}inverse(){const B=this.determinant();if(0===B)throw new Error("Matrix is not invertible");const u=this.eR,F=1/B;return new p([(u[4]*u[8]-u[5]*u[7])*F,(u[2]*u[7]-u[1]*u[8])*F,(u[1]*u[5]-u[2]*u[4])*F,(u[5]*u[6]-u[3]*u[8])*F,(u[0]*u[8]-u[2]*u[6])*F,(u[2]*u[3]-u[0]*u[5])*F,(u[3]*u[7]-u[4]*u[6])*F,(u[1]*u[6]-u[0]*u[7])*F,(u[0]*u[4]-u[1]*u[3])*F])}equals(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const F=this.eR,Z=B.m;return 0===u?F[0]===Z[0]&&F[1]===Z[1]&&F[2]===Z[2]&&F[3]===Z[3]&&F[4]===Z[4]&&F[5]===Z[5]&&F[6]===Z[6]&&F[7]===Z[7]&&F[8]===Z[8]:Math.abs(F[0]-Z[0])<u&&Math.abs(F[1]-Z[1])<u&&Math.abs(F[2]-Z[2])<u&&Math.abs(F[3]-Z[3])<u&&Math.abs(F[4]-Z[4])<u&&Math.abs(F[5]-Z[5])<u&&Math.abs(F[6]-Z[6])<u&&Math.abs(F[7]-Z[7])<u&&Math.abs(F[8]-Z[8])<u}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.eR.join(", ")})`}}},14713:(B,u,F)=>{"use strict";var Z;function V(B,u,F,Z){switch(u){case"Animation":return Z?B.animations.find((B=>B.uniqueId===F))??null:B.animations[F]??null;case"AnimationGroup":return Z?B.animationGroups.find((B=>B.uniqueId===F))??null:B.animationGroups[F]??null;case"Mesh":return Z?B.meshes.find((B=>B.uniqueId===F))??null:B.meshes[F]??null;case"Material":return Z?B.materials.find((B=>B.uniqueId===F))??null:B.materials[F]??null;case"IY":return Z?B.cameras.find((B=>B.uniqueId===F))??null:B.cameras[F]??null;case"Light":return Z?B.lights.find((B=>B.uniqueId===F))??null:B.lights[F]??null;default:return null}}F.d(u,{b:()=>V}),function(B){B.Animation="Animation",B.AnimationGroup="AnimationGroup",B.Mesh="Mesh",B.Material="Material",B.IY="IY",B.Light="Light"}(Z||(Z={}))},14739:(B,u,F)=>{"use strict";F.d(u,{c:()=>V});var Z=F(14741);class V extends Z.b{constructor(B,u){if(super(B),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),u)for(const F of u)this._eventsSignalOutputs[F]=this._registerSignalOutput(F+"Event")}_executeOnTick(B){}_startPendingTasks(B){B._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(B),this._resetAfterCanceled(B)),this._preparePendingTasks(B),B._addPendingBlock(this),this.out._activateSignal(B),B._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(B){B._deleteExecutionVariable(this,"_initialized"),B._removePendingBlock(this)}}},14720:(B,u,F)=>{"use strict";F.d(u,{e:()=>s});var Z=F(12955),V=F(12949),p=F(14723),G=F(12807),R=F(14685);class e extends p.e{constructor(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Z.defaultValue,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(B,u,F),this.richType=Z,this._defaultValue=V,this._optional=p,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new G.b}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(B){this._isDisabled!==B&&(this._isDisabled=B,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(B,u){u._getConnectionValue(this)!==B&&(u._setConnectionValue(this,B),this.onValueChangedObservable.notifyObservers(B))}resetToDefaultValue(B){B._setConnectionValue(this,this._defaultValue)}connectTo(B){this._isDisabled||super.connectTo(B)}_getValueOrDefault(B){const u=B._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(u):u}getValue(B){if(1===this.connectionType){B._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(B);const u=this._getValueOrDefault(B);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}const u=this.isConnected()?this._connectedPoint[0].getValue(B):this._getValueOrDefault(B);return this._lastValue=u,this.richType.typeTransformer?this.richType.typeTransformer(u):u}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(B),B.richType={},this.richType.serialize(B.richType),B.optional=this._optional,(0,R.d)("defaultValue",this._defaultValue,B)}}(0,V.f)("FlowGraphDataConnection",e);class s{constructor(B){var u;this.config=B,this.uniqueId=(0,Z.d)(),this.name=(null===(u=this.config)||void 0===u?void 0:u.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(B){}registerDataInput(B,u,F){const Z=new e(B,0,this,u,F);return this.dataInputs.push(Z),Z}registerDataOutput(B,u,F){const Z=new e(B,1,this,u,F);return this.dataOutputs.push(Z),Z}getDataInput(B){return this.dataInputs.find((u=>u.name===B))}getDataOutput(B){return this.dataOutputs.find((u=>u.name===B))}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:R.d;if(B.uniqueId=this.uniqueId,B.config={},this.config){const F=this.config,Z=Object.keys(F);for(const V of Z)u(V,F[V],B.config)}B.dataInputs=[],B.dataOutputs=[],B.className=this.getClassName();for(const F of this.dataInputs){const u={};F.serialize(u),B.dataInputs.push(u)}for(const F of this.dataOutputs){const u={};F.serialize(u),B.dataOutputs.push(u)}}deserialize(B){}_log(B,u,F){var Z;null===(Z=B.logger)||void 0===Z||Z.addLogItem({action:u,DF:F,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},14723:(B,u,F)=>{"use strict";F.d(u,{e:()=>p});var Z,V=F(12955);!function(B){B[B.Input=0]="Input",B[B.Output=1]="Output"}(Z||(Z={}));class p{constructor(B,u,F){this._ownerBlock=F,this._connectedPoint=[],this.uniqueId=(0,V.d)(),this.connectedPointIds=[],this.name=B,this._connectionType=u}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(B){if(this._connectionType===B._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||B._isSingularConnection()&&B._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(B),B._connectedPoint.push(this)}disconnectFrom(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const F=this._connectedPoint.indexOf(B),Z=B._connectedPoint.indexOf(this);-1!==F&&-1!==Z&&(u&&this._connectedPoint.splice(F,1),B._connectedPoint.splice(Z,1))}disconnectFromAll(){for(const B of this._connectedPoint)this.disconnectFrom(B,!1);this._connectedPoint.length=0}dispose(){for(const B of this._connectedPoint)this.disconnectFrom(B)}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};B.uniqueId=this.uniqueId,B.name=this.name,B._connectionType=this._connectionType,B.connectedPointIds=[],B.className=this.getClassName();for(const u of this._connectedPoint)B.connectedPointIds.push(u.uniqueId)}getClassName(){return"FGConnection"}deserialize(B){this.uniqueId=B.uniqueId,this.name=B.name,this._connectionType=B._connectionType,this.connectedPointIds=B.connectedPointIds}}},14683:(B,u,F)=>{"use strict";F.d(u,{e:()=>f});var Z,V=F(12807),p=F(12971),G=F(12973),R=F(12955),e=F(14685),s=F(14713),Y=F(12822);!function(B){B.ExecuteBlock="ExecuteBlock",B.ExecuteEvent="ExecuteEvent",B.TriggerConnection="TriggerConnection",B.ContextVariableSet="ContextVariableSet",B.GlobalVariableSet="GlobalVariableSet",B.GlobalVariableDelete="GlobalVariableDelete",B.GlobalVariableGet="GlobalVariableGet",B.AddConnection="AddConnection",B.GetConnectionValue="GetConnectionValue",B.SetConnectionValue="SetConnectionValue",B.ActivateSignal="ActivateSignal",B.ContextVariableGet="ContextVariableGet"}(Z||(Z={}));class Q{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(B){if(B.time||(B.time=Date.now()),this.log.push(B),this.logToConsole){var u;const F=null===(u=B.DF)||void 0===u?void 0:u.value;"object"===typeof F&&F.getClassName?Y.d.Log(`[FGLog] ${B.className}:${B.uniqueId.split("-")[0]} ${B.action} - ${JSON.stringify(F.getClassName())}: ${F.toString()}`):Y.d.Log(`[FGLog] ${B.className}:${B.uniqueId.split("-")[0]} ${B.action} - ${JSON.stringify(B.DF)}`)}}getItemsOfType(B){return this.log.filter((u=>u.action===B))}}class t{get enableLogging(){return this._enableLogging}set enableLogging(B){this._enableLogging!==B&&(this._enableLogging=B,this._enableLogging?(this.logger=new Q,this.logger.logToConsole=!0):this.logger=null)}constructor(B){this.uniqueId=(0,R.d)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new V.b,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=B,this.assetsContext=B.assetsContext??B.qu}hasVariable(B){return B in this._userVariables}setVariable(B,u){var F;this._userVariables[B]=u,null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",DF:{name:B,value:u}})}getAsset(B,u){return(0,s.b)(this.assetsContext,B,u)}getVariable(B){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",DF:{name:B,value:this._userVariables[B]}}),this._userVariables[B]}get userVariables(){return this._userVariables}yB(){return this._configuration.qu}_getUniqueIdPrefixedName(B,u){return`${B.uniqueId}_${u}`}_getGlobalContextVariable(B,u){var F;return null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",DF:{name:B,defaultValue:u,possibleValue:this._globalContextVariables[B]}}),this._hasGlobalContextVariable(B)?this._globalContextVariables[B]:u}_setGlobalContextVariable(B,u){var F;null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",DF:{name:B,value:u}}),this._globalContextVariables[B]=u}_deleteGlobalContextVariable(B){var u;null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",DF:{name:B}}),delete this._globalContextVariables[B]}_hasGlobalContextVariable(B){return B in this._globalContextVariables}_setExecutionVariable(B,u,F){this._executionVariables[this._getUniqueIdPrefixedName(B,u)]=F}_getExecutionVariable(B,u,F){return this._hasExecutionVariable(B,u)?this._executionVariables[this._getUniqueIdPrefixedName(B,u)]:F}_deleteExecutionVariable(B,u){delete this._executionVariables[this._getUniqueIdPrefixedName(B,u)]}_hasExecutionVariable(B,u){return this._getUniqueIdPrefixedName(B,u)in this._executionVariables}_hasConnectionValue(B){return B.uniqueId in this._connectionValues}_setConnectionValue(B,u){var F;this._connectionValues[B.uniqueId]=u,null===(F=this.logger)||void 0===F||F.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",DF:{connectionPointId:B.uniqueId,value:u}})}_setConnectionValueByKey(B,u){this._connectionValues[B]=u}_getConnectionValue(B){var u;return null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",DF:{connectionPointId:B.uniqueId,value:this._connectionValues[B.uniqueId]}}),this._connectionValues[B.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(B){this._pendingBlocks.includes(B)||(this._pendingBlocks.push(B),this._pendingBlocks.sort(((B,u)=>B.priority-u.priority)))}_removePendingBlock(B){const u=this._pendingBlocks.indexOf(B);-1!==u&&this._pendingBlocks.splice(u,1)}_clearPendingBlocks(){for(const B of this._pendingBlocks)B._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(B){var u;this.onNodeExecutedObservable.notifyObservers(B),null===(u=this.logger)||void 0===u||u.addLogItem({time:Date.now(),className:B.getClassName(),uniqueId:B.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(B){this._setGlobalContextVariable("timeSinceStart",B.timeSinceStart),this._setGlobalContextVariable("deltaTime",B.deltaTime);for(const F of this._pendingBlocks){var u;null===(u=F._executeOnTick)||void 0===u||u.call(F,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.d;B.uniqueId=this.uniqueId,B._userVariables={};for(const Z in this._userVariables)u(Z,this._userVariables[Z],B._userVariables);B._connectionValues={};for(const Z in this._connectionValues)u(Z,this._connectionValues[Z],B._connectionValues);var F;this.assetsContext!==this.yB()&&(B._assetsContext={meshes:this.assetsContext.meshes.map((B=>B.id)),materials:this.assetsContext.materials.map((B=>B.id)),textures:this.assetsContext.textures.map((B=>B.name)),animations:this.assetsContext.animations.map((B=>B.name)),lights:this.assetsContext.lights.map((B=>B.id)),cameras:this.assetsContext.cameras.map((B=>B.id)),Zv:null===(F=this.assetsContext.Zv)||void 0===F?void 0:F.map((B=>B.name)),skeletons:this.assetsContext.skeletons.map((B=>B.id)),xt:this.assetsContext.xt.map((B=>B.name)),geometries:this.assetsContext.geometries.map((B=>B.id)),multiMaterials:this.assetsContext.multiMaterials.map((B=>B.id)),transformNodes:this.assetsContext.transformNodes.map((B=>B.id))})}getClassName(){return"FlowGraphContext"}}(0,p.d)([(0,G.L)()],t.prototype,"uniqueId",void 0);var v=F(14715),D=F(13261);class L{constructor(B){this.onEventTriggeredObservable=new V.b,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=B,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.GR.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const B=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",DF:{timeSinceStart:this._startingTime,deltaTime:B}}),this._startingTime+=B})),this._meshPickedObserver=this._scene.onPointerObservable.add((B=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",DF:B})}),D.d.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((B=>{const u=B.pointerId,F=B.mesh,Z=this._pointerUnderMeshState[u];!Z&&F?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",DF:{pointerId:u,mesh:F}}):Z&&!F?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",DF:{pointerId:u,mesh:Z}}):Z&&F&&Z!==F&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",DF:{pointerId:u,mesh:Z,over:F}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",DF:{pointerId:u,mesh:F,out:Z}})),this._pointerUnderMeshState[u]=F}),D.d.POINTERMOVE)}dispose(){var B,u,F,Z,V;null===(B=this._sceneDisposeObserver)||void 0===B||B.remove(),null===(u=this._sceneReadyObserver)||void 0===u||u.remove(),null===(F=this._sceneOnBeforeRenderObserver)||void 0===F||F.remove(),null===(Z=this._meshPickedObserver)||void 0===Z||Z.remove(),null===(V=this._meshUnderPointerObserver)||void 0===V||V.remove(),this.onEventTriggeredObservable.clear()}}var q,W=F(14725);!function(B){B[B.Stopped=0]="Stopped",B[B.Started=1]="Started"}(q||(q={}));class X{get state(){return this._state}set state(B){this._state=B,this.onStateChangedObservable.notifyObservers(B)}constructor(B){this.onStateChangedObservable=new V.b,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=B.qu,this._sceneEventCoordinator=new L(this._scene),this._coordinator=B.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((B=>{for(const u of this._executionContexts){const F=this._getContextualOrder(B.type,u);for(const Z of F)if(!Z._executeEvent(u,B.DF))break}switch(B.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const u of this._executionContexts)u._notifyOnTick(B.DF);break;case"SceneDispose":this.dispose()}}))}createContext(){const B=new t({qu:this._scene,coordinator:this._coordinator});return this._executionContexts.push(B),B}getContext(B){return this._executionContexts[B]}addEventBlock(B){if("PointerOver"!==B.type&&"PointerOut"!==B.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==B.type&&this._eventBlocks[B.type].push(B),1===this.state)for(const u of this._executionContexts)B._startPendingTasks(u);else this.onStateChangedObservable.addOnce((u=>{if(1===u)for(const F of this._executionContexts)B._startPendingTasks(F)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((B=>{1===B&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const B of this._executionContexts)for(const u in this._eventBlocks){const F=this._getContextualOrder(u,B);for(const u of F)u._startPendingTasks(B)}}_getContextualOrder(B,u){const F=this._eventBlocks[B].sort(((B,u)=>u.initPriority-B.initPriority));if("MeshPick"===B){const B=[];for(const Z of F){const V=Z.asset.getValue(u);let p=0;for(;p<F.length;p++){const B=F[p].asset.getValue(u);if(V&&B&&(0,W.l)(V,B))break}B.splice(p,0,Z)}return B}return F}dispose(){var B;if(0!==this.state){this.state=0;for(const B of this._executionContexts)B._clearPendingBlocks();this._executionContexts.length=0;for(const B in this._eventBlocks)this._eventBlocks[B].length=0;null===(B=this._eventObserver)||void 0===B||B.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(B){const u=[],F=new Set;for(const Z in this._eventBlocks)for(const B of this._eventBlocks[Z])u.push(B),F.add(B.uniqueId);for(;u.length>0;){const Z=u.pop();B(Z);for(const B of Z.dataInputs)for(const Z of B._connectedPoint)F.has(Z._ownerBlock.uniqueId)||(u.push(Z._ownerBlock),F.add(Z._ownerBlock.uniqueId));if(Z instanceof v.b)for(const B of Z.signalOutputs)for(const Z of B._connectedPoint)F.has(Z._ownerBlock.uniqueId)||(u.push(Z._ownerBlock),F.add(Z._ownerBlock.uniqueId))}}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0;B.allBlocks=[],this.visitAllBlocks((u=>{const F={};u.serialize(F),B.allBlocks.push(F)})),B.executionContexts=[];for(const F of this._executionContexts){const Z={};F.serialize(Z,u),B.executionContexts.push(Z)}}}class f{constructor(B){this.config=B,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.qu.GR.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.qu.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const B=this._executeOnNextFrame.slice(0);if(B.length)for(const u of B){this.notifyCustomEvent(u.id,u.data,!1);const B=this._executeOnNextFrame.findIndex((B=>B.uniqueId===u.uniqueId));-1!==B&&this._executeOnNextFrame.splice(B,1)}}));(f.SceneCoordinators.get(this.config.qu)??[]).push(this)}createGraph(){const B=new X({qu:this.config.qu,coordinator:this});return this._flowGraphs.push(B),B}removeGraph(B){const u=this._flowGraphs.indexOf(B);-1!==u&&(B.dispose(),this._flowGraphs.splice(u,1))}start(){for(const B of this._flowGraphs)B.start()}dispose(){var B,u;for(const V of this._flowGraphs)V.dispose();this._flowGraphs.length=0,null===(B=this._disposeObserver)||void 0===B||B.remove(),null===(u=this._onBeforeRenderObserver)||void 0===u||u.remove();const F=f.SceneCoordinators.get(this.config.qu)??[],Z=F.indexOf(this);-1!==Z&&F.splice(Z,1)}serialize(B,u){B._flowGraphs=[];for(const F of this._flowGraphs){const Z={};F.serialize(Z,u),B._flowGraphs.push(Z)}B.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(B){let u=this._customEventsMap.get(B);return u||(u=new V.b,this._customEventsMap.set(B,u)),u}notifyCustomEvent(B,u){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:B,data:u,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(B)){const u=this._eventExecutionCounter.get(B);if(this._eventExecutionCounter.set(B,u+1),u>=f.MaxEventTypeExecutionPerFrame)return void(u===f.MaxEventTypeExecutionPerFrame&&Y.d.Warn(`FlowGraphCoordinator: Too many executions of event "${B}".`))}else this._eventExecutionCounter.set(B,1);const F=this._customEventsMap.get(B);F&&F.notifyObservers(u)}}f.MaxEventsPerType=30,f.MaxEventTypeExecutionPerFrame=30,f.SceneCoordinators=new Map},14734:(B,u,F)=>{"use strict";F.d(u,{b:()=>V});var Z=F(14739);class V extends Z.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(B){B._notifyExecuteNode(this),this.done._activateSignal(B)}}},14715:(B,u,F)=>{"use strict";F.d(u,{b:()=>R});var Z=F(14720),V=F(14723),p=F(12949);class G extends V.e{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(B){super.connectTo(B),this._connectedPoint.sort(((B,u)=>u.priority-B.priority))}_activateSignal(B){var u;if(null===(u=B.logger)||void 0===u||u.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,DF:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)B._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(B,this),B._increaseExecutionId();else for(const F of this._connectedPoint)F._activateSignal(B)}}(0,p.f)("FlowGraphSignalConnection",G);class R extends Z.e{constructor(B){super(B),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(B){const u=new G(B,0,this);return this.signalInputs.push(u),u}_registerSignalOutput(B){const u=new G(B,1,this);return this.signalOutputs.push(u),u}_unregisterSignalInput(B){const u=this.signalInputs.findIndex((u=>u.name===B));-1!==u&&(this.signalInputs[u].dispose(),this.signalInputs.splice(u,1))}_unregisterSignalOutput(B){const u=this.signalOutputs.findIndex((u=>u.name===B));-1!==u&&(this.signalOutputs[u].dispose(),this.signalOutputs.splice(u,1))}_reportError(B,u){this.error.DF="string"===typeof u?new Error(u):u,this.error._activateSignal(B)}getSignalInput(B){return this.signalInputs.find((u=>u.name===B))}getSignalOutput(B){return this.signalOutputs.find((u=>u.name===B))}serialize(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(B),B.signalInputs=[],B.signalOutputs=[];for(const u of this.signalInputs){const F={};u.serialize(F),B.signalInputs.push(F)}for(const u of this.signalOutputs){const F={};u.serialize(F),B.signalOutputs.push(F)}}deserialize(B){for(let u=0;u<B.signalInputs.length;u++){const F=this.getSignalInput(B.signalInputs[u].name);if(!F)throw new Error("Could not find signal input with name "+B.signalInputs[u].name+" in block "+B.className);F.deserialize(B.signalInputs[u])}for(let u=0;u<B.signalOutputs.length;u++){const F=this.getSignalOutput(B.signalOutputs[u].name);if(!F)throw new Error("Could not find signal output with name "+B.signalOutputs[u].name+" in block "+B.className);F.deserialize(B.signalOutputs[u])}}getClassName(){return"FlowGraphExecutionBlock"}}},14741:(B,u,F)=>{"use strict";F.d(u,{b:()=>V});var Z=F(14715);class V extends Z.b{constructor(B){super(B),this.out=this._registerSignalOutput("out")}}},14701:(B,u,F)=>{"use strict";F.d(u,{C:()=>Y,D:()=>v,E:()=>D,G:()=>L,J:()=>g,L:()=>J,M:()=>O,Q:()=>y,c:()=>s,f:()=>t,h:()=>U,i:()=>q,m:()=>W,q:()=>X,u:()=>Q,y:()=>x});var Z,V=F(12979),p=F(13023),G=F(14694),R=F(14707);!function(B){B.Any="any",B.String="string",B.Number="number",B.Boolean="boolean",B.Object="object",B.Integer="FlowGraphInteger",B.Vector2="Vector2",B.Du="Du",B.Vector4="Vector4",B.Quaternion="Quaternion",B.Matrix="Matrix",B.Matrix2D="Matrix2D",B.Matrix3D="Matrix3D",B.Xu="Xu",B.gR="gR"}(Z||(Z={}));class e{constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=B,this.defaultValue=u,this.animationType=F}serialize(B){B.typeName=this.typeName,B.defaultValue=this.defaultValue}}const s=new e("any",void 0),Y=new e("string",""),Q=new e("number",0,0),t=new e("boolean",!1),v=new e("Vector2",V.Vector2.Zero(),5),D=new e("Du",V.Du.Zero(),1),L=new e("Vector4",V.Vector4.Zero()),q=new e("Matrix",V.Matrix.Identity(),3),W=new e("Matrix2D",new R.e),X=new e("Matrix3D",new R.f),f=new e("Xu",p.Xu.Black(),4),C=new e("gR",new p.gR(0,0,0,0),7),x=new e("Quaternion",V.Quaternion.Identity(),2);x.typeTransformer=B=>{if(B.getClassName){if("Vector4"===B.getClassName())return V.Quaternion.fu(B.DR());if("Du"===B.getClassName())return V.Quaternion.FromEulerVector(B);if("Matrix"===B.getClassName())return V.Quaternion.FromRotationMatrix(B)}return B};const U=new e("FlowGraphInteger",new G.d(0),0);function y(B){const u=B;switch(typeof B){case"string":return Y;case"number":return Q;case"boolean":return t;case"object":if(u.getClassName)switch(u.getClassName()){case"Vector2":return v;case"Du":return D;case"Vector4":return L;case"Matrix":return q;case"Xu":return f;case"gR":return C;case"Quaternion":return x;case"FlowGraphInteger":return U;case"Matrix2D":return W;case"Matrix3D":return X}return s;default:return s}}function O(B){switch(B){case"string":return Y;case"number":return Q;case"boolean":return t;case"Vector2":return v;case"Du":return D;case"Vector4":return L;case"Matrix":return q;case"Xu":return f;case"gR":return C;case"Quaternion":return x;case"FlowGraphInteger":return U;case"Matrix2D":return W;case"Matrix3D":return X;default:return s}}function g(B){switch(B){case"number":default:return 0;case"Vector2":return 5;case"Du":return 1;case"Matrix":return 3;case"Xu":return 4;case"gR":return 7;case"Quaternion":return 2}}function J(B){switch(B){case 0:return Q;case 5:return v;case 1:return D;case 3:return q;case 4:return f;case 7:return C;case 2:return x;default:return s}}},14685:(B,u,F)=>{"use strict";F.d(u,{c:()=>Y,d:()=>s,f:()=>Q});var Z=F(13023),V=F(12979),p=F(14694),G=F(14701),R=F(14707);function e(B){return"Vector2"===B||"Du"===B||"Vector4"===B||"Quaternion"===B||"Xu"===B||"gR"===B}function s(B,u,F){var Z;const V=(null===u||void 0===u||null===(Z=u.getClassName)||void 0===Z?void 0:Z.call(u))??"";if(e(V)||function(B){return"Matrix"===B||"Matrix2D"===B||"Matrix3D"===B}(V))F[B]={value:u.DR(),className:V};else if("FlowGraphInteger"===V)F[B]={value:u.value,className:V};else if(V&&(u.id||u.name))F[B]={id:u.id,name:u.name,className:V};else{if("object"===typeof u)throw new Error(`Could not serialize value ${u}`);F[B]=u}}function Y(B,u,F,s){const Q=u[B];let t;const v=(null===Q||void 0===Q?void 0:Q.type)??(null===Q||void 0===Q?void 0:Q.className);if(function(B){return"Mesh"===B||"AbstractMesh"===B||"GroundMesh"===B||"InstanceMesh"===B||"LinesMesh"===B||"GoldbergMesh"===B||"GreasedLineMesh"===B||"TrailMesh"===B}(v)){let B=s.meshes.filter((B=>Q.id?B.id===Q.id:B.name===Q.name));0===B.length&&(B=s.transformNodes.filter((B=>Q.id?B.id===Q.id:B.name===Q.name))),t=Q.uniqueId?B.find((B=>B.uniqueId===Q.uniqueId)):B[0]}else if(e(v))t=function(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===B)return V.Vector2.fu(u);if("Du"===B)return F&&(u[2]*=-1),V.Du.fu(u);if("Vector4"===B)return V.Vector4.fu(u);if("Quaternion"===B)return F&&(u[2]*=-1,u[3]*=-1),V.Quaternion.fu(u);if("Xu"===B)return new Z.Xu(u[0],u[1],u[2]);if("gR"===B)return new Z.gR(u[0],u[1],u[2],u[3]);throw new Error(`Unknown vector class name ${B}`)}(v,Q.value);else if(function(B){return"AnimationGroup"===B}(v)){const B=s.animationGroups.filter((B=>B.name===Q.name));t=1===B.length?B[0]:B.find((B=>B.uniqueId===Q.uniqueId))}else t="Matrix"===v?V.Matrix.fu(Q.value):"Matrix2D"===v?new R.e(Q.value):"Matrix3D"===v?new R.f(Q.value):"FlowGraphInteger"===v?p.d.FromValue(Q.value):"number"===v||"string"===v||"boolean"===v?Q.value[0]:Q&&void 0!==Q.value?Q.value:Array.isArray(Q)?Q.reduce(((B,u)=>u.eventData?(B[u.id]={type:(0,G.M)(u.type)},"undefined"!==typeof u.value&&(B[u.id].value=Y("value",u,F,s)),B):B),{}):Q;return t}function Q(B){return"FlowGraphJsonPointerParserBlock"===B}},14725:(B,u,F)=>{"use strict";function Z(B,u){return!(!B.parent||B.parent!==u&&!Z(B.parent,u))}function V(B){if(B.getClassName)return B.getClassName()}function p(B,u){return B===u&&("Vector2"===B||"Du"===B||"Vector4"===B||"Quaternion"===B)}function G(B,u){return B===u&&("Matrix"===B||"Matrix2D"===B||"Matrix3D"===B)}function R(B,u){return"FlowGraphInteger"===B&&"FlowGraphInteger"===u}function e(B,u){const F="number"===typeof B||"number"===typeof(null===B||void 0===B?void 0:B.value);return F&&!u?!isNaN(s(B)):F}function s(B){return"number"===typeof B?B:B.value}F.d(u,{b:()=>R,e:()=>G,g:()=>p,h:()=>V,l:()=>Z,m:()=>s,p:()=>e})},14045:(B,u,F)=>{"use strict";F.r(u),F.d(u,{SceneInstrumentation:()=>p});var Z=F(12802),V=F(13202);class p{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(B){B!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=B,B?(this._onBeforeActiveMeshesEvaluationObserver=this.qu.onBeforeActiveMeshesEvaluationObservable.add((()=>{Z.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.qu.onAfterActiveMeshesEvaluationObservable.add((()=>{Z.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.qu.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qu.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(B){B!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=B,B?(this._onBeforeRenderTargetsRenderObserver=this.qu.onBeforeRenderTargetsRenderObservable.add((()=>{Z.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.qu.onAfterRenderTargetsRenderObservable.add((()=>{Z.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.qu.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qu.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(B){B!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=B,B?(this._onBeforeParticlesRenderingObserver=this.qu.onBeforeParticlesRenderingObservable.add((()=>{Z.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.qu.onAfterParticlesRenderingObservable.add((()=>{Z.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.qu.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qu.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(B){B!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=B,this.qu.spriteManagers&&(B?(this._onBeforeSpritesRenderingObserver=this.qu.onBeforeSpritesRenderingObservable.add((()=>{Z.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.qu.onAfterSpritesRenderingObservable.add((()=>{Z.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.qu.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.qu.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(B){B!==this._capturePhysicsTime&&this.qu.onBeforePhysicsObservable&&(this._capturePhysicsTime=B,B?(this._onBeforePhysicsObserver=this.qu.onBeforePhysicsObservable.add((()=>{Z.Tools.StartPerformanceCounter("Re"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.qu.onAfterPhysicsObservable.add((()=>{Z.Tools.EndPerformanceCounter("Re"),this._physicsTime.endMonitoring()}))):(this.qu.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.qu.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(B){B!==this._captureAnimationsTime&&(this._captureAnimationsTime=B,B?this._onAfterAnimationsObserver=this.qu.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.qu.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(B){this._captureFrameTime=B}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(B){this._captureInterFrameTime=B}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(B){B!==this._captureRenderTime&&(this._captureRenderTime=B,B?(this._onBeforeDrawPhaseObserver=this.qu.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),Z.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.qu.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),Z.Tools.EndPerformanceCounter("Main render")}))):(this.qu.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qu.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(B){B!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=B,B?(this._onBeforeCameraRenderObserver=this.qu.onBeforeCameraRenderObservable.add((B=>{this._cameraRenderTime.beginMonitoring(),Z.Tools.StartPerformanceCounter(`Rendering camera ${B.name}`)})),this._onAfterCameraRenderObserver=this.qu.onAfterCameraRenderObservable.add((B=>{this._cameraRenderTime.endMonitoring(!1),Z.Tools.EndPerformanceCounter(`Rendering camera ${B.name}`)}))):(this.qu.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qu.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.qu.getEngine()._drawCalls}constructor(B){this.qu=B,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new V.b,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new V.b,this._captureFrameTime=!1,this._frameTime=new V.b,this._captureRenderTime=!1,this._renderTime=new V.b,this._captureInterFrameTime=!1,this._interFrameTime=new V.b,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new V.b,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new V.b,this._capturePhysicsTime=!1,this._physicsTime=new V.b,this._captureAnimationsTime=!1,this._animationsTime=new V.b,this._captureCameraRenderTime=!1,this._cameraRenderTime=new V.b,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=B.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(Z.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.qu.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=B.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(Z.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.pR(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.pR(),this._captureParticlesRenderTime&&this._particlesRenderTime.pR(),this._captureSpritesRenderTime&&this._spritesRenderTime.pR(),this._captureRenderTime&&this._renderTime.pR(),this._captureCameraRenderTime&&this._cameraRenderTime.pR()}))}dispose(){this._disposed||(this.qu.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.qu.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.qu.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.qu.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.qu.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.qu.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.qu.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.qu.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.qu.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.qu.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.qu.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.qu.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.qu.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.qu.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.qu.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.qu.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.qu.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.qu=null,this._disposed=!0)}}},14676:(B,u,F)=>{"use strict";F.d(u,{e:()=>Y});var Z=F(12971),V=F(12973),p=F(12979),G=F(13391),R=F(13508),e=F(13564),s=F(12949);G.b.AddNodeConstructor("Light_Type_1",((B,u)=>()=>new Y(B,p.Du.Zero(),u)));class Y extends e.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(B){this._shadowFrustumSize=B,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(B){this._shadowOrthoScale=B,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(B){this._orthoLeft=B}get orthoRight(){return this._orthoRight}set orthoRight(B){this._orthoRight=B}get orthoTop(){return this._orthoTop}set orthoTop(B){this._orthoTop=B}get orthoBottom(){return this._orthoBottom}set orthoBottom(B){this._orthoBottom=B}constructor(B,u,F){super(B,F),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=u.scale(-1),this.direction=u}getClassName(){return"ee"}getTypeID(){return R.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(B,u,F){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(B):this._setDefaultAutoExtendShadowProjectionMatrix(B,u,F)}_setDefaultFixedFrustumShadowProjectionMatrix(B){const u=this.yB().activeCamera;u&&p.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:u.qR,void 0!==this.shadowMaxZ?this.shadowMaxZ:u.maxZ,B,this.yB().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(B,u,F){const Z=this.yB().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const B=p.Du.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let Z=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(let G=0;G<F.length;G++){const R=F[G];if(!R)continue;const e=R.getBoundingInfo().boundingBox;for(let F=0;F<e.vectorsWorld.length;F++)p.Du.TransformCoordinatesToRef(e.vectorsWorld[F],u,B),B.x<this._orthoLeft&&(this._orthoLeft=B.x),B.y<this._orthoBottom&&(this._orthoBottom=B.y),B.x>this._orthoRight&&(this._orthoRight=B.x),B.y>this._orthoTop&&(this._orthoTop=B.y),this.autoCalcShadowZBounds&&(B.z<Z&&(Z=B.z),B.z>V&&(V=B.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=Z,this._shadowMaxZ=V)}const V=this._orthoRight-this._orthoLeft,G=this._orthoTop-this._orthoBottom,R=void 0!==this.shadowMinZ?this.shadowMinZ:(null===Z||void 0===Z?void 0:Z.qR)||0,e=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===Z||void 0===Z?void 0:Z.maxZ)||1e4,s=this.yB().getEngine().o;p.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-V*this.shadowOrthoScale,this._orthoRight+V*this.shadowOrthoScale,this._orthoBottom-G*this.shadowOrthoScale,this._orthoTop+G*this.shadowOrthoScale,s?e:R,s?R:e,B,this.yB().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(B,u){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,u),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,u),this)}transferToNodeMaterialEffect(B,u){return this.computeTransformedInformation()?(B.setFloat3(u,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(B.setFloat3(u,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(B){const u=this._scene.getEngine();return!u.o&&u.isNDCHalfZRange?0:1}getDepthMaxZ(B){const u=this._scene.getEngine();return u.o&&u.isNDCHalfZRange?0:1}prepareLightSpecificDefines(B,u){B["DIRLIGHT"+u]=!0}}(0,Z.d)([(0,V.L)()],Y.prototype,"shadowFrustumSize",null),(0,Z.d)([(0,V.L)()],Y.prototype,"shadowOrthoScale",null),(0,Z.d)([(0,V.L)()],Y.prototype,"autoUpdateExtends",void 0),(0,Z.d)([(0,V.L)()],Y.prototype,"autoCalcShadowZBounds",void 0),(0,Z.d)([(0,V.L)("orthoLeft")],Y.prototype,"_orthoLeft",void 0),(0,Z.d)([(0,V.L)("orthoRight")],Y.prototype,"_orthoRight",void 0),(0,Z.d)([(0,V.L)("orthoTop")],Y.prototype,"_orthoTop",void 0),(0,Z.d)([(0,V.L)("orthoBottom")],Y.prototype,"_orthoBottom",void 0),(0,s.f)("BABYLON.DirectionalLight",Y)},15160:(B,u,F)=>{"use strict";F.d(u,{c:()=>Y});var Z=F(12971),V=F(12973),p=F(12979),G=F(13023),R=F(13391),e=F(13508),s=F(12949);R.b.AddNodeConstructor("Light_Type_3",((B,u)=>()=>new Y(B,p.Du.Zero(),u)));class Y extends e.c{constructor(B,u,F){super(B,F),this.groundColor=new G.Xu(0,0,0),this.direction=u||p.Du.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"Le"}setDirectionToTarget(B){return this.direction=p.Du.Normalize(B.Lu(p.Du.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(B,u){const F=p.Du.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",F.x,F.y,F.z,0,u),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.TR),u),this}transferToNodeMaterialEffect(B,u){const F=p.Du.Normalize(this.direction);return B.setFloat3(u,F.x,F.y,F.z),this}XR(){return this._worldMatrix||(this._worldMatrix=p.Matrix.Identity()),this._worldMatrix}getTypeID(){return e.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(B,u){B["HEMILIGHT"+u]=!0}}(0,Z.d)([(0,V.l)()],Y.prototype,"groundColor",void 0),(0,Z.d)([(0,V.H)()],Y.prototype,"direction",void 0),(0,s.f)("BABYLON.HemisphericLight",Y)},14648:(B,u,F)=>{"use strict";F.d(u,{e:()=>Q});var Z=F(12971),V=F(12973),p=F(12979),G=F(13391),R=F(13508),e=F(13564),s=F(12969),Y=F(12949);G.b.AddNodeConstructor("Light_Type_2",((B,u)=>()=>new Q(B,p.Du.Zero(),p.Du.Zero(),0,0,u)));class Q extends e.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(B){this._iesProfileTexture!==B&&(this._iesProfileTexture=B,this._iesProfileTexture&&Q._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(B){this._angle=B,this._cosHalfAngle=Math.cos(.5*B),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(B){this._innerAngle=B,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(B){this._shadowAngleScale=B,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(B){this._projectionTextureLightNear=B,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(B){this._projectionTextureLightFar=B,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(B){this._projectionTextureUpDirection=B,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(B){this._projectionTexture!==B&&(this._projectionTexture=B,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Q._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Q._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(B){return void 0!==B.onGeneratedObservable}static _IsTexture(B){return void 0!==B.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(B){this._projectionTextureProjectionLightMatrix=B,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(B,u,F,Z,V,G){super(B,G),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=p.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=p.Du.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=p.Du.Zero(),this._projectionTextureViewLightMatrix=p.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=p.Matrix.Zero(),this._projectionTextureScalingMatrix=p.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=u,this.direction=F,this.angle=Z,this.exponent=V}getClassName(){return"SpotLight"}getTypeID(){return R.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(B){super._setDirection(B),this._projectionTextureViewLightDirty=!0}_setPosition(B){super._setPosition(B),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(B,u,F){const Z=this.yB().activeCamera;if(!Z)return;this._shadowAngleScale=this._shadowAngleScale||1;const V=this._shadowAngleScale*this._angle,G=void 0!==this.shadowMinZ?this.shadowMinZ:Z.qR,R=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,e=this.yB().getEngine().o;p.Matrix.PerspectiveFovLHToRef(V,1,e?R:G,e?G:R,B,!0,this._scene.getEngine().isNDCHalfZRange,void 0,e)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),p.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const B=this.projectionTextureLightFar,u=this.projectionTextureLightNear,F=B/(B-u),Z=-F*u,V=1/Math.tan(this._angle/2);p.Matrix.FromValuesToRef(V/1,0,0,0,0,V,0,0,0,0,F,1,0,0,Z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof s.d){const B=this._projectionTexture.uScale/2,u=this._projectionTexture.vScale/2;p.Matrix.FromValuesToRef(B,0,0,0,0,u,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(B,u){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),B.setMatrix("textureProjectionMatrix"+u,this._projectionTextureMatrix),B.setTexture("projectionLightTexture"+u,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&B.setTexture("iesLightTexture"+u,this._iesProfileTexture),this}transferToEffect(B,u){let F;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,u),F=p.Du.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,u),F=p.Du.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",F.x,F.y,F.z,this._cosHalfAngle,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,u),this}transferToNodeMaterialEffect(B,u){let F;return F=this.computeTransformedInformation()?p.Du.Normalize(this.transformedDirection):p.Du.Normalize(this.direction),this.yB().useRightHandedSystem?B.setFloat3(u,-F.x,-F.y,-F.z):B.setFloat3(u,F.x,F.y,F.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(B){const u=this._scene.getEngine(),F=void 0!==this.shadowMinZ?this.shadowMinZ:(null===B||void 0===B?void 0:B.qR)??0;return u.o&&u.isNDCHalfZRange?F:this._scene.getEngine().isNDCHalfZRange?0:F}getDepthMaxZ(B){const u=this._scene.getEngine(),F=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===B||void 0===B?void 0:B.maxZ)??1e4;return u.o&&u.isNDCHalfZRange?0:F}prepareLightSpecificDefines(B,u){B["SPOTLIGHT"+u]=!0,B["PROJECTEDLIGHTTEXTURE"+u]=!(!this.projectionTexture||!this.projectionTexture.isReady()),B["IESLIGHTTEXTURE"+u]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,Z.d)([(0,V.L)()],Q.prototype,"angle",null),(0,Z.d)([(0,V.L)()],Q.prototype,"innerAngle",null),(0,Z.d)([(0,V.L)()],Q.prototype,"shadowAngleScale",null),(0,Z.d)([(0,V.L)()],Q.prototype,"exponent",void 0),(0,Z.d)([(0,V.L)()],Q.prototype,"projectionTextureLightNear",null),(0,Z.d)([(0,V.L)()],Q.prototype,"projectionTextureLightFar",null),(0,Z.d)([(0,V.L)()],Q.prototype,"projectionTextureUpDirection",null),(0,Z.d)([(0,V.E)("projectedLightTexture")],Q.prototype,"_projectionTexture",void 0),(0,Y.f)("BABYLON.SpotLight",Q)},14332:(B,u,F)=>{"use strict";F.d(u,{d:()=>G,h:()=>p,j:()=>R});const Z={},V={};function p(B,u){Z[B]=u}function G(B,u){V[B]=u}function R(B){return V[B]?V[B]:null}},14235:(B,u,F)=>{"use strict";F.d(u,{d:()=>y,g:()=>mB});var Z,V=F(12802),p=F(12807),G=F(13221),R=F(12855),e=F(12822),s=F(13425),Y=F(12861),Q=F(12864),t=F(12955),v=F(12888),D=F(12852);!function(B){B[B.Clean=0]="Clean",B[B.Stop=1]="Stop",B[B.Sync=2]="Sync",B[B.NoSync=3]="NoSync"}(Z||(Z={}));const L=new p.b,q={};let W=!1;function X(){return q[".babylon"]}function f(B,u){const F=q[B];return F||(e.d.Warn("Unable to find a plugin to load "+B+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),u?X():void 0)}function C(B,u,F){let Z="Unable to load from "+(B.rawData?"binary data":B.url);return u?Z+=`: ${u}`:F&&(Z+=`: ${F}`),Z}async function x(B,u,F,Z,V,p,G,R,e){var s;const Q="data:"===(t=B.url).substring(0,5)?t.substring(5):null;var t;if(B.rawData&&!G)throw"When using ArrayBufferView to load data the file extension must be provided.";const W=Q||G?"":function(B){const u=B.indexOf("?");-1!==u&&(B=B.substring(0,u));const F=B.lastIndexOf(".");return B.substring(F,B.length).toLowerCase()}(B.url);let C=G?f(G,!0):Q?function(B){for(const u in q){const F=q[u].plugin;if(F.canDirectLoad&&F.canDirectLoad(B))return q[u]}return X()}(B.url):f(W,!1);if(!C&&W){if(B.url&&!B.url.startsWith("blob:")){const u=await async function(B,u){const F=u.method||"GET";return await new Promise(((Z,V)=>{const p=new D.c;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const B={};if(u.responseHeaders)for(const F of u.responseHeaders)B[F]=p.getResponseHeader(F)||"";Z({response:p.response,headerValues:B})}else V(`Unable to fetch data from ${B}. Error code: ${p.status}`)})),p.open(F,B),p.send()}))}(B.url,{method:"HEAD",responseHeaders:["Content-Type"]}),F=u.headerValues?u.headerValues["Content-Type"]:"";F&&(C=function(B){for(const u in q){const F=q[u];if(F.mimeType===B)return F}}(F))}C||(C=X())}if(!C)throw new Error(`No plugin or fallback for ${G??B.url}`);if(!1===(null===e||void 0===e||null===(s=e[C.plugin.name])||void 0===s?void 0:s.enabled))throw new Error(`The '${C.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(B.rawData&&!C.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(B=>{if(C.plugin.createPlugin){const u=C.plugin.createPlugin(e??{});return u instanceof Promise?(u.then(B).catch((B=>{V("Error instantiating plugin.",B)})),null):(B(u),u)}return B(C.plugin),C.plugin})((e=>{var s;if(!e)throw`The loader plugin corresponding to the '${G}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(L.notifyObservers(e),Q&&(e.canDirectLoad&&e.canDirectLoad(B.url)||!(0,Y.g)(B.url))){if(e.directLoad){const B=e.directLoad(u,Q);B instanceof Promise?B.then((B=>{F(e,B)})).catch((B=>{V("Error in directLoad of _loadData: "+B,B)})):F(e,B)}else F(e,Q);return}const t=C.isBinary,D=(B,Z)=>{u.G?V("Scene has been disposed"):F(e,B,Z)};let q=null,W=!1;null===(s=e.GR)||void 0===s||s.add((()=>{W=!0,q&&(q.abort(),q=null),p()}));const X=()=>{if(W)return;const F=(B,u)=>{V(null===B||void 0===B?void 0:B.statusText,u)};if(!e.loadFile&&B.rawData)throw"Plugin does not support loading ArrayBufferView.";q=e.loadFile?e.loadFile(u,B.rawData||B.file||B.url,B.rootUrl,D,Z,t,F,R):u._loadFile(B.file||B.url,D,Z,!0,t,F)},f=u.getEngine();let x=f.enableOfflineSupport;if(x){let F=!1;for(const Z of u.disableOfflineSupportExceptionRules)if(Z.test(B.url)){F=!0;break}x=!F}x&&v.c.OfflineProviderFactory?u.offlineProvider=v.c.OfflineProviderFactory(B.url,X,f.disableManifestCheck):X()}))}function U(B,u){let F,Z,p=null,G=null;if(u)if(u.name)F=`file:${u.name}`,Z=u.name,p=u;else if(ArrayBuffer.isView(u))F="",Z=(0,t.d)(),G=u;else if(u.startsWith("data:"))F=u,Z="";else if(B){const p=u;if("/"===p.substring(0,1))return V.Tools.Error("Wrong sceneFilename parameter"),null;F=B+p,Z=p}else F=u,Z=V.Tools.GetFilename(u),B=V.Tools.GetFolderPath(u);else F=B,Z=V.Tools.GetFilename(B),B=V.Tools.GetFolderPath(B);return{url:F,rootUrl:B,name:Z,file:p,rawData:G}}function y(B){if("string"===typeof B.extensions){const u=B.extensions;q[u.toLowerCase()]={plugin:B,isBinary:!1}}else{const u=B.extensions,F=Object.keys(u);for(const Z of F)q[Z.toLowerCase()]={plugin:B,isBinary:u[Z].isBinary,mimeType:u[Z].mimeType}}}async function O(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:R.b.LastCreatedScene,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!Z)return e.d.Error("No scene available to import mesh to"),null;const v=U(u,F);if(!v)return null;const D={};Z.addPendingData(D);const L=()=>{Z.removePendingData(D)},q=(B,u)=>{const F=C(v,B,u);G?G(Z,F,new Q.j(F,Q.i.SceneLoaderError,u)):e.d.Error(F),L()},W=p?B=>{try{p(B)}catch(u){q("Error in onProgress callback: "+u,u)}}:void 0,X=(B,u,F,p,G,R,e,s)=>{if(Z.importedMeshesFiles.push(v.url),V)try{V(B,u,F,p,G,R,e,s)}catch(Y){q("Error in onSuccess callback: "+Y,Y)}Z.removePendingData(D)};return await x(v,Z,((u,F,V)=>{if(u.rewriteRootURL&&(v.rootUrl=u.rewriteRootURL(v.rootUrl,V)),u.importMesh){const V=[],p=[],G=[];if(!u.importMesh(B,Z,F,v.rootUrl,V,p,G,q))return;Z.loadingPluginName=u.name,X(V,p,G,[],[],[],[],[])}else{u.importMeshAsync(B,Z,F,v.rootUrl,W,v.name).then((B=>{Z.loadingPluginName=u.name,X(B.meshes,B.xt,B.skeletons,B.animationGroups,B.transformNodes,B.geometries,B.lights,B.spriteManagers)})).catch((B=>{q(B.message,B)}))}}),W,q,L,s,Y,t)}async function g(B,u,F,Z,V,p,G,R){return await new Promise(((e,s)=>{try{O(B,u,F,Z,((B,u,F,Z,V,p,G,R)=>{e({meshes:B,xt:u,skeletons:F,animationGroups:Z,transformNodes:V,geometries:p,lights:G,spriteManagers:R})}),V,((B,u,F)=>{s(F||new Error(u))}),p,G,R).catch(s)}catch(Q){s(Q)}}))}async function J(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.b.LastCreatedEngine,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};F?await T(B,u,new G.e(F),Z,p,e,s,Y,Q):V.Tools.Error("No engine available")}async function a(B,u,F,Z,V,p,G){return await new Promise(((R,e)=>{J(B,u,F,(B=>{R(B)}),Z,((B,u,F)=>{e(F||new Error(u))}),V,p,G)}))}async function T(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.b.LastCreatedScene,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!F)return e.d.Error("No scene available to append to"),null;const v=U(B,u);if(!v)return null;const D={};F.addPendingData(D);const L=()=>{F.removePendingData(D)};s.b.ShowLoadingScreen&&!W&&(W=!0,F.getEngine().displayLoadingUI(),F.executeWhenReady((()=>{F.getEngine().hideLoadingUI(),W=!1})));const q=(B,u)=>{const Z=C(v,B,u);p?p(F,Z,new Q.j(Z,Q.i.SceneLoaderError,u)):e.d.Error(Z),L()},X=V?B=>{try{V(B)}catch(u){q("Error in onProgress callback",u)}}:void 0,f=()=>{if(Z)try{Z(F)}catch(B){q("Error in onSuccess callback",B)}F.removePendingData(D)};return await x(v,F,((B,u)=>{if(B.load){if(!B.load(F,u,v.rootUrl,q))return;F.loadingPluginName=B.name,f()}else{B.loadAsync(F,u,v.rootUrl,X,v.name).then((()=>{F.loadingPluginName=B.name,f()})).catch((B=>{q(B.message,B)}))}}),X,q,L,G,Y,t)}async function z(B,u,F,Z,V,p,G){return await new Promise(((R,e)=>{try{T(B,u,F,(B=>{R(B)}),Z,((B,u,F)=>{e(F||new Error(u))}),V,p,G).catch(e)}catch(Q){e(Q)}}))}async function M(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.b.LastCreatedScene,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!F)return e.d.Error("No scene available to load asset container to"),null;const t=U(B,u);if(!t)return null;const v={};F.addPendingData(v);const D=()=>{F.removePendingData(v)},L=(B,u)=>{const Z=C(t,B,u);p?p(F,Z,new Q.j(Z,Q.i.SceneLoaderError,u)):e.d.Error(Z),D()},q=V?B=>{try{V(B)}catch(u){L("Error in onProgress callback",u)}}:void 0,W=B=>{if(Z)try{Z(B)}catch(u){L("Error in onSuccess callback",u)}F.removePendingData(v)};return await x(t,F,((B,u)=>{if(B.loadAssetContainer){const Z=B.loadAssetContainer(F,u,t.rootUrl,L);if(!Z)return;Z.populateRootNodes(),F.loadingPluginName=B.name,W(Z)}else if(B.loadAssetContainerAsync){B.loadAssetContainerAsync(F,u,t.rootUrl,q,t.name).then((u=>{u.populateRootNodes(),F.loadingPluginName=B.name,W(u)})).catch((B=>{L(B.message,B)}))}else L("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),q,L,D,G,s,Y)}async function j(B,u,F,Z,V,p,G){return await new Promise(((R,e)=>{try{M(B,u,F,(B=>{R(B)}),Z,((B,u,F)=>{e(F||new Error(u))}),V,p,G).catch(e)}catch(Q){e(Q)}}))}async function o(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.b.LastCreatedScene,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Q=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!F)return void e.d.Error("No scene available to load animations to");if(Z){for(const Z of F.animatables)Z.reset();F.stopAllAnimations();const B=F.animationGroups.slice();for(const F of B)F.dispose();const u=F.getNodes();for(const F of u)F.animations&&(F.animations=[])}else switch(V){case 0:const B=F.animationGroups.slice();for(const u of B)u.dispose();break;case 1:for(const u of F.animationGroups)u.stop();break;case 2:for(const u of F.animationGroups)u.reset(),u.restart();break;case 3:break;default:return void e.d.Error("Unknown animation group loading mode value '"+V+"'")}const D=F.animatables.length;await M(B,u,F,(B=>{B.mergeAnimationsTo(F,F.animatables.slice(D),p),B.dispose(),F.onAnimationFileImportedObservable.notifyObservers(F),G&&G(F)}),s,Y,Q,t,v)}async function I(B,u,F,Z,V,p,G,R,e,s){return await new Promise(((Y,t)=>{try{o(B,u,F,Z,V,p,(B=>{Y(B)}),G,((B,u,F)=>{t(F||new Error(u))}),R,e,s).catch(t)}catch(Q){t(Q)}}))}class mB{static get ForceFullSceneLoadingForIncremental(){return s.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(B){s.b.ForceFullSceneLoadingForIncremental=B}static get ShowLoadingScreen(){return s.b.ShowLoadingScreen}static set ShowLoadingScreen(B){s.b.ShowLoadingScreen=B}static get loggingLevel(){return s.b.loggingLevel}static set loggingLevel(B){s.b.loggingLevel=B}static get CleanBoneMatrixWeights(){return s.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(B){s.b.CleanBoneMatrixWeights=B}static GetDefaultPlugin(){return X()}static GetPluginForExtension(B){var u;return null===(u=f(B,!0))||void 0===u?void 0:u.plugin}static IsPluginForExtensionAvailable(B){return function(B){return!!q[B]}(B)}static RegisterPlugin(B){y(B)}static ImportMesh(B,u,F,Z,V,p,G,e,s){O(B,u,F,Z,V,p,G,e,s).catch((B=>null===G||void 0===G?void 0:G(R.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async ImportMeshAsync(B,u,F,Z,V,p,G){return await g(B,u,F,Z,V,p,G)}static Load(B,u,F,Z,V,p,G,e){J(B,u,F,Z,V,p,G,e).catch((B=>null===p||void 0===p?void 0:p(R.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async LoadAsync(B,u,F,Z,V,p){return await a(B,u,F,Z,V,p)}static Append(B,u,F,Z,V,p,G,e){T(B,u,F,Z,V,p,G,e).catch((B=>null===p||void 0===p?void 0:p(F??R.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async AppendAsync(B,u,F,Z,V,p){return await z(B,u,F,Z,V,p)}static LoadAssetContainer(B,u,F,Z,V,p,G,e){M(B,u,F,Z,V,p,G,e).catch((B=>null===p||void 0===p?void 0:p(F??R.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async LoadAssetContainerAsync(B,u,F,Z,V,p){return await j(B,u,F,Z,V,p)}static ImportAnimations(B,u,F,Z,V,p,G,e,s,Y,Q){o(B,u,F,Z,V,p,G,e,s,Y,Q).catch((B=>null===s||void 0===s?void 0:s(F??R.b.LastCreatedScene,null===B||void 0===B?void 0:B.message,B)))}static async ImportAnimationsAsync(B,u,F,Z,V,p,G,R,e,s,Y){return await I(B,u,F,Z,V,p,R,s,Y)}}mB.NO_LOGGING=0,mB.MINIMAL_LOGGING=1,mB.SUMMARY_LOGGING=2,mB.DETAILED_LOGGING=3,mB.OnPluginActivatedObservable=L},14663:(B,u,F)=>{"use strict";F.d(u,{d:()=>t});var Z=F(12971),V=F(12973),p=F(12802),G=F(12979),R=F(13002),e=F(12969),s=F(12949),Y=F(12807),Q=F(13014);F(14668);class t extends R.d{set boundingBoxSize(B){if(this._boundingBoxSize&&this._boundingBoxSize.equals(B))return;this._boundingBoxSize=B;const u=this.yB();u&&u.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(B){this._rotationY=B,this.setReflectionTextureMatrix(G.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(B,u,F){let Z="";for(const V of B)Z+=V;return new t(Z,u,null,F,B)}static CreateFromPrefilteredData(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const V=u.useDelayedTextureLoading;u.useDelayedTextureLoading=!1;const p=new t(B,u,null,!1,null,null,null,void 0,!0,F,Z);return u.useDelayedTextureLoading=V,p}constructor(B,u){var F;let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Q=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],v=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]&&arguments[10],L=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,W=arguments.length>13?arguments[13]:void 0,X=arguments.length>14?arguments[14]:void 0;super(u),this.onLoadObservable=new Y.b,this.boundingBoxPosition=G.Du.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new G.Matrix,this._buffer=null,this.name=B,this.url=B,this._noMipmap=V,this.LR=!1,this.isCube=!0,this._textureMatrix=G.Matrix.Identity(),this.coordinatesMode=e.d.CUBIC_MODE;let f=null,C=null;null===Z||Array.isArray(Z)?(this._noMipmap=V,this._format=Q,this._createPolynomials=D,f=Z,this._loaderOptions=W,this._useSRGBBuffer=X,this._lodScale=L,this._lodOffset=q):(f=Z.extensions??null,this._noMipmap=Z.noMipmap??!1,p=Z.files??null,C=Z.buffer??null,this._format=Z.format??5,t=Z.prefiltered??!1,v=Z.forcedExtension??null,this._createPolynomials=Z.createPolynomials??!1,this._lodScale=Z.lodScale??.8,this._lodOffset=Z.lodOffset??0,this._loaderOptions=Z.loaderOptions,this._useSRGBBuffer=Z.useSRGBBuffer,R=Z.N??null,s=Z.onError??null),(B||p)&&this.updateURL(B,v,R,t,s,f,null===(F=this.yB())||void 0===F?void 0:F.useDelayedTextureLoading,p,C)}getClassName(){return"CubeTexture"}updateURL(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=B),this.url=B,u&&(this._forcedExtension=u);const s=B.lastIndexOf("."),Y=u||(s>-1?B.substring(s).toLowerCase():""),Q=0===Y.indexOf(".dds"),t=0===Y.indexOf(".env"),v=0===Y.indexOf(".basis");if(t?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=Z,Z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),R)this._files=R;else if(v||t||Q||p||(p=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,p){for(let u=0;u<p.length;u++)this._files.push(B+p[u]);this._extensions=p}this._buffer=e,G?(this.delayLoadState=4,this._delayedOnLoad=F,this._delayedOnError=V):this._loadTexture(F,V)}delayLoad(B){4===this.delayLoadState&&(B&&(this._forcedExtension=B),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(B){var u,F;if(B.updateFlag===this._textureMatrix.updateFlag)return;B.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(F=this.yB())||void 0===F||F.markAllMaterialsAsDirty(1,(B=>-1!==B.getActiveTextures().indexOf(this))));if(this._textureMatrix=B,null===(u=this.yB())||void 0===u||!u.useRightHandedSystem)return;const Z=G.TmpVectors.Du[0],V=G.TmpVectors.Quaternion[0],p=G.TmpVectors.Du[1];this._textureMatrix.decompose(Z,V,p),V.z*=-1,V.w*=-1,G.Matrix.ComposeToRef(Z,V,p,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var B;return null!==(B=this.yB())&&void 0!==B&&B.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this.yB(),Z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const V=()=>{var u;(this.onLoadObservable.notifyObservers(this),Z)&&(Z.dispose(),null===(u=this.yB())||void 0===u||u.markAllMaterialsAsDirty(1));B&&B()},G=(B,F)=>{this._loadingError=!0,this._errorObject={message:B,exception:F},u&&u(B,F),e.d.OnTextureLoadErrorObservable.notifyObservers(this)};var R;this._texture?this._texture.isReady?p.Tools.SetImmediate((()=>V())):this._texture.onLoadedObservable.add((()=>V())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,F,this._lodScale,this._lodOffset,B,G,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,F,this._files,this._noMipmap,B,G,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(R=this._texture)||void 0===R||R.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(B,u,F){const Z=Q.c.Parse((()=>{let Z=!1;return B.prefiltered&&(Z=B.prefiltered),new t(F+(B.url??B.name),u,B.extensions,!1,B.files||null,null,null,void 0,Z,B.forcedExtension)}),B,u);if(B.boundingBoxPosition&&(Z.boundingBoxPosition=G.Du.fu(B.boundingBoxPosition)),B.boundingBoxSize&&(Z.boundingBoxSize=G.Du.fu(B.boundingBoxSize)),B.animations)for(let V=0;V<B.animations.length;V++){const u=B.animations[V],F=(0,s.d)("BABYLON.Animation");F&&Z.animations.push(F.Parse(u))}return Z}clone(){let B=0;const u=Q.c.Clone((()=>{const u=new t(this.url,this.yB()||this._getEngine(),this._extensions,this._noMipmap,this._files);return B=u.uniqueId,u}),this);return u.uniqueId=B,u}}(0,Z.d)([(0,V.L)()],t.prototype,"url",void 0),(0,Z.d)([(0,V.H)()],t.prototype,"boundingBoxPosition",void 0),(0,Z.d)([(0,V.H)()],t.prototype,"boundingBoxSize",null),(0,Z.d)([(0,V.L)("rotationY")],t.prototype,"rotationY",null),(0,Z.d)([(0,V.L)("files")],t.prototype,"_files",void 0),(0,Z.d)([(0,V.L)("forcedExtension")],t.prototype,"_forcedExtension",void 0),(0,Z.d)([(0,V.L)("extensions")],t.prototype,"_extensions",void 0),(0,Z.d)([(0,V.w)("textureMatrix")],t.prototype,"_textureMatrix",void 0),(0,Z.d)([(0,V.w)("textureMatrixRefraction")],t.prototype,"_textureMatrixRefraction",void 0),e.d._CubeTextureParser=t.Parse,(0,s.f)("BABYLON.CubeTexture",t)},15177:(B,u,F)=>{"use strict";F.d(u,{d:()=>e});var Z=F(12822),V=F(12969),p=F(12960),G=F(13112),R=F(12925);G.ThinEngine.prototype.createDynamicTexture=function(B,u,F,Z){const V=new R.b(this,4);return V.baseWidth=B,V.baseHeight=u,F&&(B=this.needPOTTextures?(0,p.c)(B,this._caps.maxTextureSize):B,u=this.needPOTTextures?(0,p.c)(u,this._caps.maxTextureSize):u),V.width=B,V.height=u,V.isReady=!1,V.generateMipMaps=F,V.samplingMode=Z,this.updateTextureSamplingMode(Z,V),this._internalTexturesCache.push(V),V},G.ThinEngine.prototype.updateDynamicTexture=function(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!B)return;const G=this._gl,R=G.TEXTURE_2D,e=this._bindTextureDirectly(R,B,!0,p);this._unpackFlipY(void 0===F?B.invertY:F),Z&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const s=this._getWebGLTextureType(B.type),Y=this._getInternalFormat(V||B.format),Q=this._getRGBABufferInternalSizedFormat(B.type,Y);G.texImage2D(R,0,Q,Y,s,u),B.generateMipMaps&&G.generateMipmap(R),e||this._bindTextureDirectly(R,null),Z&&G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),V&&(B.format=V),B._dynamicTextureSource=u,B._premulAlpha=Z,B.invertY=F||!1,B.isReady=!0};class e extends V.d{constructor(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,R=arguments.length>6?arguments[6]:void 0;const e=!F||F._isScene;super(null,e?F:null===F||void 0===F?void 0:F.qu,e?!Z:F,R,p,void 0,void 0,void 0,void 0,G),this.name=B,this.wrapU=V.d.CLAMP_ADDRESSMODE,this.wrapV=V.d.CLAMP_ADDRESSMODE,this._generateMipMaps=Z;const s=this._getEngine();if(!s)return;if(u.getContext)this._canvas=u,this._ownCanvas=!1,this._texture=s.createDynamicTexture(this._canvas.width,this._canvas.height,Z,p);else{this._canvas=s.createCanvas(1,1),this._ownCanvas=!0;const B=u;B.width||0===B.width?this._texture=s.createDynamicTexture(B.width,B.height,Z,p):this._texture=s.createDynamicTexture(u,u,Z,p)}const Y=this.getSize();this._canvas.width!==Y.width&&(this._canvas.width=Y.width),this._canvas.height!==Y.height&&(this._canvas.height=Y.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(B){this._canvas.width=B.width,this._canvas.height=B.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(B.width,B.height,this._generateMipMaps,this.samplingMode)}scale(B){const u=this.getSize();u.width*=B,u.height*=B,this._recreate(u)}scaleTo(B,u){const F=this.getSize();F.width=B,F.height=u,this._recreate(F)}getContext(){return this._context}clear(B){const u=this.getSize();B&&(this._context.fillStyle=B),this._context.clearRect(0,0,u.width,u.height)}update(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===B||B,u,this._format||void 0,void 0,F)}drawText(B,u,F,Z,V,p,G){let R=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const e=this.getSize();if(p&&(this._context.fillStyle=p,this._context.fillRect(0,0,e.width,e.height)),this._context.font=Z,null===u||void 0===u){const F=this._context.measureText(B);u=(e.width-F.width)/2}if(null===F||void 0===F){const B=parseInt(Z.replace(/\D/g,""));F=e.height/2+B/3.65}this._context.fillStyle=V||"",this._context.fillText(B,u,F),R&&this.update(G)}dispose(){var B,u;(super.dispose(),this._ownCanvas)&&(null===(B=this._canvas)||void 0===B||null===(u=B.remove)||void 0===u||u.call(B));this._canvas=null,this._context=null}clone(){const B=this.yB();if(!B)return this;const u=this.getSize(),F=new e(this.name,u,B,this._generateMipMaps);return F.LR=this.LR,F.level=this.level,F.wrapU=this.wrapU,F.wrapV=this.wrapV,F}serialize(){const B=this.yB();B&&!B.isReady()&&Z.d.Warn("The scene must be ready before serializing the dynamic texture");const u=super.serialize();return e._IsCanvasElement(this._canvas)&&(u.base64String=this._canvas.toDataURL()),u.invertY=this._invertY,u.samplingMode=this.samplingMode,u}static _IsCanvasElement(B){return void 0!==B.toDataURL}_rebuild(){this.update()}}},14567:(B,u,F)=>{"use strict";F.d(u,{c:()=>V});var Z=F(12969);class V extends Z.d{get depth(){return this._depth}constructor(B,u,F,V,p,G){let R=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],e=arguments.length>7&&void 0!==arguments[7]&&arguments[7],s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Z.d.TRILINEAR_SAMPLINGMODE,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,Q=arguments.length>10?arguments[10]:void 0;super(null,G,!R,e),this.format=p,this._texture=G.getEngine().createRawTexture2DArray(B,u,F,V,p,R,e,s,null,Y,Q),this._depth=V,this.is2DArray=!0}update(B){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,B,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(B,u,F,Z,p){return new V(B,u,F,Z,5,p,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},14354:(B,u,F)=>{"use strict";F.d(u,{b:()=>R,d:()=>e,f:()=>p,h:()=>G});var Z=F(12994),V=F(12979);function p(B,u){return`{X: ${B.x.toFixed(u)} Y: ${B.y.toFixed(u)}}`}function G(B,u){return`{X: ${B._x.toFixed(u)} Y: ${B._y.toFixed(u)} Z: ${B._z.toFixed(u)}}`}function R(B,u){return 2*Math.acos((0,Z.Clamp)(V.Quaternion.Dot(B,u)))}function e(B,u){const F=new V.Quaternion;return function(B,u,F){const p=V.Du.Cross(B,u),G=Math.acos((0,Z.Clamp)(V.Du.Dot(B,u),-1,1));V.Quaternion.RotationAxisToRef(p,G,F)}(B,u,F),F}},14182:(B,u,F)=>{"use strict";F.d(u,{c:()=>s});var Z=F(12979),V=F(13023),p=F(13409),G=F(13398),R=F(13031);F(14188);function e(B){let u=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const F=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],p=[];let e=[];const s=B.width||B.size||1,Y=B.height||B.size||1,Q=B.depth||B.size||1,t=B.wrap||!1;let v=void 0===B.topBaseAt?1:B.topBaseAt,D=void 0===B.bottomBaseAt?0:B.bottomBaseAt;v=(v+4)%4,D=(D+4)%4;let L=[2,0,3,1][v],q=[2,0,1,3][D],W=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(t){u=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],W=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let B=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],F=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const Z=[17,18,19,16],V=[22,23,20,21];for(;L>0;)B.unshift(B.pop()),Z.unshift(Z.pop()),L--;for(;q>0;)F.unshift(F.pop()),V.unshift(V.pop()),q--;B=B.flat(),F=F.flat(),W=W.concat(B).concat(F),u.push(Z[0],Z[2],Z[3],Z[0],Z[1],Z[2]),u.push(V[0],V[2],V[3],V[0],V[1],V[2])}const X=[s/2,Y/2,Q/2];e=W.reduce(((B,u,F)=>B.concat(u*X[F%3])),[]);const f=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE,C=B.faceUV||new Array(6),x=B.faceColors,U=[];for(let G=0;G<6;G++)void 0===C[G]&&(C[G]=new Z.Vector4(0,0,1,1)),x&&void 0===x[G]&&(x[G]=new V.gR(1,1,1,1));for(let Z=0;Z<6;Z++)if(p.push(C[Z].z,R.b?1-C[Z].w:C[Z].w),p.push(C[Z].x,R.b?1-C[Z].w:C[Z].w),p.push(C[Z].x,R.b?1-C[Z].y:C[Z].y),p.push(C[Z].z,R.b?1-C[Z].y:C[Z].y),x)for(let B=0;B<4;B++)U.push(x[Z].r,x[Z].g,x[Z].b,x[Z].a);G.c._ComputeSides(f,e,u,F,p,B.frontUVs,B.backUVs);const y=new G.c;if(y.indices=u,y.gB=e,y.JB=F,y.TB=p,x){const B=f===G.c.DOUBLESIDE?U.concat(U):U;y.aB=B}return y}function s(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new p.b(B,F);u.sideOrientation=p.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return e(u).MB(Z,u.updatable),Z}G.c.CreateBox=e,p.b.CreateBox=function(B,u){return s(B,{size:u,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},14340:(B,u,F)=>{"use strict";F.d(u,{b:()=>R});var Z=F(13409),V=F(13398),p=F(13031);function G(B){const u=[],F=[],Z=[],G=[],R=B.radius||.5,e=B.tessellation||64,s=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,Y=0===B.sideOrientation?0:B.sideOrientation||V.c.DEFAULTSIDE;u.push(0,0,0),G.push(.5,.5);const Q=2*Math.PI*s,t=1===s?Q/e:Q/(e-1);let v=0;for(let V=0;V<e;V++){const B=Math.cos(v),F=Math.sin(v),Z=(B+1)/2,V=(1-F)/2;u.push(R*B,R*F,0),G.push(Z,p.b?1-V:V),v+=t}1===s&&(u.push(u[3],u[4],u[5]),G.push(G[2],p.b?1-G[3]:G[3]));const D=u.length/3;for(let V=1;V<D-1;V++)F.push(V+1,0,V);V.c.ComputeNormals(u,F,Z),V.c._ComputeSides(Y,u,F,Z,G,B.frontUVs,B.backUVs);const L=new V.c;return L.indices=F,L.gB=u,L.JB=Z,L.TB=G,L}function R(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new Z.b(B,F);u.sideOrientation=Z.b._GetDefaultSideOrientation(u.sideOrientation),V._originalBuilderSideOrientation=u.sideOrientation;return G(u).MB(V,u.updatable),V}V.c.CreateDisc=G,Z.b.CreateDisc=function(B,u,F){return R(B,{radius:u,tessellation:F,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},14188:(B,u,F)=>{"use strict";F.d(u,{e:()=>q,b:()=>X,f:()=>W});var Z=F(12979),V=F(13023),p=F(13409),G=F(13398),R=F(13047);p.b._GroundMeshParser=(B,u)=>e.Parse(B,u);class e extends p.b{constructor(B,u){super(B,u),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=B,this._subdivisionsY=B,this.subdivide(B);const F=this;F.createOrUpdateSubmeshesOctree&&F.createOrUpdateSubmeshesOctree(u)}getHeightAtCoordinates(B,u){const F=this.getWorldMatrix(),V=Z.TmpVectors.Matrix[5];F.invertToRef(V);const p=Z.TmpVectors.Du[8];if(Z.Du.TransformCoordinatesFromFloatsToRef(B,0,u,V,p),B=p.x,u=p.z,B<this._minX||B>=this._maxX||u<=this._minZ||u>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const G=this._getFacetAt(B,u),R=-(G.x*B+G.z*u+G.w)/G.y;return Z.Du.TransformCoordinatesFromFloatsToRef(0,R,0,F,p),p.y}getNormalAtCoordinates(B,u){const F=new Z.Du(0,1,0);return this.getNormalAtCoordinatesToRef(B,u,F),F}getNormalAtCoordinatesToRef(B,u,F){const V=this.getWorldMatrix(),p=Z.TmpVectors.Matrix[5];V.invertToRef(p);const G=Z.TmpVectors.Du[8];if(Z.Du.TransformCoordinatesFromFloatsToRef(B,0,u,p,G),B=G.x,u=G.z,B<this._minX||B>this._maxX||u<this._minZ||u>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const R=this._getFacetAt(B,u);return Z.Du.TransformNormalFromFloatsToRef(R.x,R.y,R.z,V,F),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(B,u){const F=Math.floor((B+this._maxX)*this._subdivisionsX/this._width),Z=Math.floor(-(u+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),V=this._heightQuads[Z*this._subdivisionsX+F];let p;return p=u<V.slope.x*B+V.slope.y?V.facet1:V.facet2,p}_initHeightQuads(){const B=this._subdivisionsX,u=this._subdivisionsY;this._heightQuads=[];for(let F=0;F<u;F++)for(let u=0;u<B;u++){const V={slope:Z.Vector2.Zero(),facet1:new Z.Vector4(0,0,0,0),facet2:new Z.Vector4(0,0,0,0)};this._heightQuads[F*B+u]=V}return this}_computeHeightQuads(){const B=this.getVerticesData(R.f.PositionKind);if(!B)return this;const u=Z.TmpVectors.Du[3],F=Z.TmpVectors.Du[2],V=Z.TmpVectors.Du[1],p=Z.TmpVectors.Du[0],G=Z.TmpVectors.Du[4],e=Z.TmpVectors.Du[5],s=Z.TmpVectors.Du[6],Y=Z.TmpVectors.Du[7],Q=Z.TmpVectors.Du[8];let t=0,v=0,D=0,L=0,q=0,W=0,X=0;const f=this._subdivisionsX,C=this._subdivisionsY;for(let R=0;R<C;R++)for(let C=0;C<f;C++){t=3*C,v=R*(f+1)*3,D=(R+1)*(f+1)*3,u.x=B[v+t],u.y=B[v+t+1],u.z=B[v+t+2],F.x=B[v+t+3],F.y=B[v+t+4],F.z=B[v+t+5],V.x=B[D+t],V.y=B[D+t+1],V.z=B[D+t+2],p.x=B[D+t+3],p.y=B[D+t+4],p.z=B[D+t+5],L=(p.z-u.z)/(p.x-u.x),q=u.z-L*u.x,F.subtractToRef(u,G),V.subtractToRef(u,e),p.subtractToRef(u,s),Z.Du.CrossToRef(s,e,Y),Z.Du.CrossToRef(G,s,Q),Y.normalize(),Q.normalize(),W=-(Y.x*u.x+Y.y*u.y+Y.z*u.z),X=-(Q.x*F.x+Q.y*F.y+Q.z*F.z);const x=this._heightQuads[R*f+C];x.slope.UR(L,q),x.facet1.UR(Y.x,Y.y,Y.z,W),x.facet2.UR(Q.x,Q.y,Q.z,X)}return this}serialize(B){super.serialize(B),B.subdivisionsX=this._subdivisionsX,B.subdivisionsY=this._subdivisionsY,B.minX=this._minX,B.maxX=this._maxX,B.qR=this._minZ,B.maxZ=this._maxZ,B.width=this._width,B.height=this._height}static Parse(B,u){const F=new e(B.name,u);return F._subdivisionsX=B.subdivisionsX||1,F._subdivisionsY=B.subdivisionsY||1,F._minX=B.minX,F._maxX=B.maxX,F._minZ=B.qR,F._maxZ=B.maxZ,F._width=B.width,F._height=B.height,F}}var s=F(12802),Y=F(12855),Q=F(12982),t=F(13031);function v(B){const u=[],F=[],V=[],p=[];let R,e;const s=B.width||B.size||1,Y=B.height||B.size||1,Q=0|(B.subdivisionsX||B.subdivisions||1),v=0|(B.subdivisionsY||B.subdivisions||1);for(R=0;R<=v;R++)for(e=0;e<=Q;e++){const B=new Z.Du(e*s/Q-s/2,0,(v-R)*Y/v-Y/2),u=new Z.Du(0,1,0);F.push(B.x,B.y,B.z),V.push(u.x,u.y,u.z),p.push(e/Q,t.b?R/v:1-R/v)}for(R=0;R<v;R++)for(e=0;e<Q;e++)u.push(e+1+(R+1)*(Q+1)),u.push(e+1+R*(Q+1)),u.push(e+R*(Q+1)),u.push(e+(R+1)*(Q+1)),u.push(e+1+(R+1)*(Q+1)),u.push(e+R*(Q+1));const D=new G.c;return D.indices=u,D.gB=F,D.JB=V,D.TB=p,D}function D(B){const u=void 0!==B.xmin&&null!==B.xmin?B.xmin:-1,F=void 0!==B.zmin&&null!==B.zmin?B.zmin:-1,V=void 0!==B.xmax&&null!==B.xmax?B.xmax:1,p=void 0!==B.zmax&&null!==B.zmax?B.zmax:1,R=B.subdivisions||{w:1,h:1},e=B.precision||{w:1,h:1},s=[],Y=[],Q=[],t=[];let v,D,L,q;R.h=R.h<1?1:R.h,R.w=R.w<1?1:R.w,e.w=e.w<1?1:e.w,e.h=e.h<1?1:e.h;const W=(V-u)/R.w,X=(p-F)/R.h;function f(B,u,F,V){const p=Y.length/3,G=e.w+1;for(v=0;v<e.h;v++)for(D=0;D<e.w;D++){const B=[p+D+v*G,p+(D+1)+v*G,p+(D+1)+(v+1)*G,p+D+(v+1)*G];s.push(B[1]),s.push(B[2]),s.push(B[3]),s.push(B[0]),s.push(B[1]),s.push(B[3])}const R=Z.Du.Zero(),L=new Z.Du(0,1,0);for(v=0;v<=e.h;v++)for(R.z=v*(V-u)/e.h+u,D=0;D<=e.w;D++)R.x=D*(F-B)/e.w+B,R.y=0,Y.push(R.x,R.y,R.z),Q.push(L.x,L.y,L.z),t.push(D/e.w,v/e.h)}for(L=0;L<R.h;L++)for(q=0;q<R.w;q++)f(u+q*W,F+L*X,u+(q+1)*W,F+(L+1)*X);const C=new G.c;return C.indices=s,C.gB=Y,C.JB=Q,C.TB=t,C}function L(B){const u=[],F=[],p=[],R=[];let e,s;const Y=B.colorFilter||new V.Xu(.3,.59,.11),t=B.alphaFilter||0;let v=!1;if(B.minHeight>B.maxHeight){v=!0;const u=B.maxHeight;B.maxHeight=B.minHeight,B.minHeight=u}for(e=0;e<=B.subdivisions;e++)for(s=0;s<=B.subdivisions;s++){const u=new Z.Du(s*B.width/B.subdivisions-B.width/2,0,(B.subdivisions-e)*B.height/B.subdivisions-B.height/2),V=4*(((u.x+B.width/2)/B.width*(B.bufferWidth-1)|0)+((1-(u.z+B.height/2)/B.height)*(B.bufferHeight-1)|0)*B.bufferWidth);let G=B.buffer[V]/255,D=B.buffer[V+1]/255,L=B.buffer[V+2]/255;const q=B.buffer[V+3]/255;v&&(G=1-G,D=1-D,L=1-L);const W=G*Y.r+D*Y.g+L*Y.b;u.y=q>=t?B.minHeight+(B.maxHeight-B.minHeight)*W:B.minHeight-Q.e,B.heightBuffer&&(B.heightBuffer[e*(B.subdivisions+1)+s]=u.y),F.push(u.x,u.y,u.z),p.push(0,0,0),R.push(s/B.subdivisions,1-e/B.subdivisions)}for(e=0;e<B.subdivisions;e++)for(s=0;s<B.subdivisions;s++){const Z=s+1+(e+1)*(B.subdivisions+1),V=s+1+e*(B.subdivisions+1),p=s+e*(B.subdivisions+1),G=s+(e+1)*(B.subdivisions+1),R=F[3*Z+1]>=B.minHeight,Y=F[3*V+1]>=B.minHeight,Q=F[3*p+1]>=B.minHeight;R&&Y&&Q&&(u.push(Z),u.push(V),u.push(p));F[3*G+1]>=B.minHeight&&R&&Q&&(u.push(G),u.push(Z),u.push(p))}G.c.ComputeNormals(F,u,p);const D=new G.c;return D.indices=u,D.gB=F,D.JB=p,D.TB=R,D}function q(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const F=new e(B,arguments.length>2?arguments[2]:void 0);F._setReady(!1),F._subdivisionsX=u.subdivisionsX||u.subdivisions||1,F._subdivisionsY=u.subdivisionsY||u.subdivisions||1,F._width=u.width||1,F._height=u.height||1,F._maxX=F._width/2,F._maxZ=F._height/2,F._minX=-F._maxX,F._minZ=-F._maxZ;return v(u).MB(F,u.updatable),F._setReady(!0),F}function W(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new p.b(B,F);return D(u).MB(Z,u.updatable),Z}function X(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=F.width||10,G=F.height||10,R=F.subdivisions||1,Q=F.minHeight||0,t=F.maxHeight||1,v=F.colorFilter||new V.Xu(.3,.59,.11),D=F.alphaFilter||0,q=F.updatable,W=F.onReady;Z=Z||Y.b.LastCreatedScene;const X=new e(B,Z);let f;X._subdivisionsX=R,X._subdivisionsY=R,X._width=p,X._height=G,X._maxX=X._width/2,X._maxZ=X._height/2,X._minX=-X._maxX,X._minZ=-X._maxZ,X._setReady(!1),F.passHeightBufferInCallback&&(f=new Float32Array((R+1)*(R+1)));const C=(B,u,F)=>{L({width:p,height:G,subdivisions:R,minHeight:Q,maxHeight:t,colorFilter:v,buffer:B,bufferWidth:u,bufferHeight:F,alphaFilter:D,heightBuffer:f}).MB(X,q),W&&W(X,f),X._setReady(!0)};if("string"===typeof u){const B=B=>{var u;const F=B.width,V=B.height;if(Z.G)return;const p=null===(u=Z)||void 0===u?void 0:u.getEngine().resizeImageBitmap(B,F,V);C(p,F,V)};s.Tools.LoadImage(u,B,F.onError?F.onError:()=>{},Z.offlineProvider)}else C(u.data,u.width,u.height);return X}G.c.CreateGround=v,G.c.CreateTiledGround=D,G.c.CreateGroundFromHeightMap=L,p.b.CreateGround=(B,u,F,Z,V,p)=>q(B,{width:u,height:F,subdivisions:Z,updatable:p},V),p.b.CreateTiledGround=(B,u,F,Z,V,p,G,R,e)=>W(B,{xmin:u,zmin:F,xmax:Z,zmax:V,subdivisions:p,precision:G,updatable:e},R),p.b.CreateGroundFromHeightMap=(B,u,F,Z,V,p,G,R,e,s,Y)=>X(B,u,{width:F,height:Z,subdivisions:V,minHeight:p,maxHeight:G,updatable:e,onReady:s,alphaFilter:Y},R)},14868:(B,u,F)=>{"use strict";F.d(u,{d:()=>v,f:()=>Q,j:()=>t});var Z=F(12979),V=F(13409),p=F(13398),G=F(13517),R=F(13047),e=F(12822);function s(B){const u=[],F=[],Z=B.lines,V=B.aB,G=[];let R=0;for(let p=0;p<Z.length;p++){const B=Z[p];for(let Z=0;Z<B.length;Z++){const{x:e,y:s,z:Y}=B[Z];if(F.push(e,s,Y),V){const B=V[p],{r:u,g:F,b:R,a:e}=B[Z];G.push(u,F,R,e)}Z>0&&(u.push(R-1),u.push(R)),R++}}const e=new p.c;return e.indices=u,e.gB=F,V&&(e.aB=G),e}function Y(B){const u=B.dashSize||3,F=B.gapSize||1,V=B.dashNb||200,G=B.points,R=[],e=[],s=Z.Du.Zero();let Y=0,Q=0,t=0,v=0,D=0,L=0,q=0;for(q=0;q<G.length-1;q++)G[q+1].subtractToRef(G[q],s),Y+=s.length();for(t=Y/V,v=u*t/(u+F),q=0;q<G.length-1;q++){G[q+1].subtractToRef(G[q],s),Q=Math.floor(s.length()/t),s.normalize();for(let B=0;B<Q;B++)D=t*B,R.push(G[q].x+D*s.x,G[q].y+D*s.y,G[q].z+D*s.z),R.push(G[q].x+(D+v)*s.x,G[q].y+(D+v)*s.y,G[q].z+(D+v)*s.z),e.push(L,L+1),L+=2}const W=new p.c;return W.gB=R,W.indices=e,W}function Q(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=u.instance,V=u.lines,p=u.aB;if(Z){const B=Z.getVerticesData(R.f.PositionKind);let u,F;p&&(u=Z.getVerticesData(R.f.ColorKind));let G=0,e=0;for(let Z=0;Z<V.length;Z++){const R=V[Z];for(let V=0;V<R.length;V++)B[G]=R[V].x,B[G+1]=R[V].y,B[G+2]=R[V].z,p&&u&&(F=p[Z],u[e]=F[V].r,u[e+1]=F[V].g,u[e+2]=F[V].b,u[e+3]=F[V].a,e+=4),G+=3}return Z.updateVerticesData(R.f.PositionKind,B,!1,!1),p&&u&&Z.updateVerticesData(R.f.ColorKind,u,!1,!1),Z.refreshBoundingInfo(),Z}const e=!!p,Y=new G.c(B,F,null,void 0,void 0,e,u.useVertexAlpha,u.material);return s(u).MB(Y,u.updatable),Y}function t(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=u.aB?[u.aB]:null;return Q(B,{lines:[u.points],updatable:u.updatable,instance:u.instance,aB:Z,useVertexAlpha:u.useVertexAlpha,material:u.material},F)}function v(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=u.points,R=u.instance,s=u.gapSize||1,Q=u.dashSize||3;if(R){const B=B=>{const u=Z.Du.Zero(),F=B.length/6;let V=0,G=0,e=0,s=0,Y=0,Q=0,t=0,v=0;for(t=0;t<p.length-1;t++)p[t+1].subtractToRef(p[t],u),V+=u.length();e=V/F;const D=R._creationDataStorage.dashSize;for(s=D*e/(D+R._creationDataStorage.gapSize),t=0;t<p.length-1;t++)for(p[t+1].subtractToRef(p[t],u),G=Math.floor(u.length()/e),u.normalize(),v=0;v<G&&Q<B.length;)Y=e*v,B[Q]=p[t].x+Y*u.x,B[Q+1]=p[t].y+Y*u.y,B[Q+2]=p[t].z+Y*u.z,B[Q+3]=p[t].x+(Y+s)*u.x,B[Q+4]=p[t].y+(Y+s)*u.y,B[Q+5]=p[t].z+(Y+s)*u.z,Q+=6,v++;for(;Q<B.length;)B[Q]=p[t].x,B[Q+1]=p[t].y,B[Q+2]=p[t].z,Q+=3};return(u.dashNb||u.dashSize||u.gapSize||u.useVertexAlpha||u.material)&&e.d.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),R.updateMeshPositions(B,!1),R}const t=new G.c(B,F,null,void 0,void 0,void 0,u.useVertexAlpha,u.material);return Y(u).MB(t,u.updatable),t._creationDataStorage=new V.c,t._creationDataStorage.dashSize=Q,t._creationDataStorage.gapSize=s,t}p.c.CreateLineSystem=s,p.c.CreateDashedLines=Y,V.b.ls=function(B,u){return t(B,{points:u,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},V.b.CreateDashedLines=function(B,u,F,Z,V){return v(B,{points:u,dashSize:F,gapSize:Z,dashNb:V,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},14240:(B,u,F)=>{"use strict";F.d(u,{b:()=>R,e:()=>e});var Z=F(13409),V=F(13398),p=F(13031);function G(B){const u=[],F=[],Z=[],G=[],R=void 0!==B.width?B.width:void 0!==B.size?B.size:1,e=void 0!==B.height?B.height:void 0!==B.size?B.size:1,s=0===B.sideOrientation?0:B.sideOrientation||V.c.DEFAULTSIDE,Y=R/2,Q=e/2;F.push(-Y,-Q,0),Z.push(0,0,-1),G.push(0,p.b?1:0),F.push(Y,-Q,0),Z.push(0,0,-1),G.push(1,p.b?1:0),F.push(Y,Q,0),Z.push(0,0,-1),G.push(1,p.b?0:1),F.push(-Y,Q,0),Z.push(0,0,-1),G.push(0,p.b?0:1),u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),V.c._ComputeSides(s,F,u,Z,G,B.frontUVs,B.backUVs);const t=new V.c;return t.indices=u,t.gB=F,t.JB=Z,t.TB=G,t}function R(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const V=new Z.b(B,F);u.sideOrientation=Z.b._GetDefaultSideOrientation(u.sideOrientation),V._originalBuilderSideOrientation=u.sideOrientation;return G(u).MB(V,u.updatable),u.sourcePlane&&(V.translate(u.sourcePlane.normal,-u.sourcePlane.d),V.setDirection(u.sourcePlane.normal.scale(-1))),V}const e={hs:R};V.c.hs=G,Z.b.hs=(B,u,F,Z,V)=>R(B,{size:u,width:u,height:u,sideOrientation:V,updatable:Z},F)},14329:(B,u,F)=>{"use strict";F.d(u,{c:()=>e});var Z=F(12979),V=F(13409),p=F(13398),G=F(13031);function R(B){const u=0|(B.segments||32),F=B.diameterX||B.diameter||1,V=B.diameterY||B.diameter||1,R=B.diameterZ||B.diameter||1,e=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,s=B.slice&&B.slice<=0?1:B.slice||1,Y=0===B.sideOrientation?0:B.sideOrientation||p.c.DEFAULTSIDE,Q=!!B.dedupTopBottomIndices,t=new Z.Du(F/2,V/2,R/2),v=2+u,D=2*v,L=[],q=[],W=[],X=[];for(let p=0;p<=v;p++){const B=p/v,u=B*Math.PI*s;for(let F=0;F<=D;F++){const V=F/D,p=V*Math.PI*2*e,R=Z.Matrix.RotationZ(-u),s=Z.Matrix.RotationY(p),Y=Z.Du.TransformCoordinates(Z.Du.Up(),R),Q=Z.Du.TransformCoordinates(Y,s),v=Q.multiply(t),L=Q.divide(t).normalize();q.push(v.x,v.y,v.z),W.push(L.x,L.y,L.z),X.push(V,G.b?1-B:B)}if(p>0){const B=q.length/3;for(let u=B-2*(D+1);u+D+2<B;u++)Q?(p>1&&(L.push(u),L.push(u+1),L.push(u+D+1)),(p<v||s<1)&&(L.push(u+D+1),L.push(u+1),L.push(u+D+2))):(L.push(u),L.push(u+1),L.push(u+D+1),L.push(u+D+1),L.push(u+1),L.push(u+D+2))}}p.c._ComputeSides(Y,q,L,W,X,B.frontUVs,B.backUVs);const f=new p.c;return f.indices=L,f.gB=q,f.JB=W,f.TB=X,f}function e(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return R(u).MB(Z,u.updatable),Z}p.c.CreateSphere=R,V.b.CreateSphere=(B,u,F,Z,V,p)=>e(B,{segments:u,diameterX:F,diameterY:F,diameterZ:F,sideOrientation:p,updatable:V},Z)},15190:(B,u,F)=>{"use strict";F.d(u,{e:()=>R});var Z=F(13533),V=F(14670),p=F(13554),G=F(13398);class R{static get Configuration(){return{get decoder(){return V.e.DefaultConfiguration},set decoder(B){V.e.DefaultConfiguration=B}}}static set Configuration(B){V.e.DefaultConfiguration=B.decoder}static get DecoderAvailable(){return(0,Z.g)(V.e.DefaultConfiguration)}static get Default(){return R._Default??(R._Default=new R),R._Default}static ResetDefault(B){R._Default&&(B||R._Default.dispose(),R._Default=null)}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.DefaultNumWorkers;const u="number"===typeof B?{...V.e.DefaultConfiguration,numWorkers:B}:{...V.e.DefaultConfiguration,...B};this._decoder=new V.e(u)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(B,u,F){return this._decoder.decodeMeshToMeshDataAsync(B,u,F)}async decodeMeshToGeometryAsync(B,u,F,Z){return await this._decoder.decodeMeshToGeometryAsync(B,u,F,Z)}async _decodeMeshToGeometryForGltfAsync(B,u,F,Z,V,p){return await this._decoder._decodeMeshToGeometryForGltfAsync(B,u,F,Z,V,p)}async decodeMeshAsync(B,u){const F=await this._decoder.decodeMeshToMeshDataAsync(B,u),Z=new G.c;F.indices&&(Z.indices=F.indices);for(const V of F.attributes){const B=p.d.GetFloatData(V.data,V.size,p.d.GetDataType(V.data),V.byteOffset,V.byteStride,V.normalized,F.totalVertices);Z.set(B,V.kind)}return Z}}R.DefaultNumWorkers=(0,Z.d)(),R._Default=null},14670:(B,u,F)=>{"use strict";F.d(u,{e:()=>s});var Z=F(13533),V=F(12802),p=F(13421),G=F(13554),R=F(12822),e=F(13546);class s extends Z.b{static get DefaultAvailable(){return(0,Z.g)(s.DefaultConfiguration)}static get Default(){return s._Default??(s._Default=new s),s._Default}static ResetDefault(B){s._Default&&(B||s._Default.dispose(),s._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(B,u){return{module:await(u||DracoDecoderModule)({wasmBinary:B})}}_getWorkerContent(){return`${e.b}(${e.c})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.DefaultConfiguration)}decodeMeshToMeshDataAsync(B,u,F){const Z=B instanceof ArrayBuffer?new Int8Array(B):new Int8Array(B.buffer,B.byteOffset,B.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async B=>await new Promise(((V,p)=>{B.push(((B,G)=>{let e=null;const s=[],Y=u=>{B.removeEventListener("error",Y),B.removeEventListener("message",Q),p(u),G()},Q=u=>{const Z=u.data;switch(Z.id){case"indices":e=Z.data;break;case"attribute":s.push({kind:Z.kind,data:Z.data,size:Z.size,byteOffset:Z.byteOffset,byteStride:Z.byteStride,normalized:(p=Z.kind,t=Z.normalized,F&&void 0!==F[p]?(t!==F[p]&&R.d.Warn(`Normalized flag from Draco data (${t}) does not match normalized flag from glTF accessor (${F[p]}). Using flag from glTF accessor.`),F[p]):t)});break;case"decodeMeshDone":B.removeEventListener("error",Y),B.removeEventListener("message",Q),V({indices:e,attributes:s,totalVertices:Z.totalVertices}),G()}var p,t};B.addEventListener("error",Y),B.addEventListener("message",Q);const t=Z.slice();B.postMessage({id:"decodeMesh",dataView:t,attributes:u},[t.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((B=>{let F=null;const V=[],p=(0,e.b)(B.module,Z,u,(B=>{F=B}),((B,u,F,Z,p,G)=>{V.push({kind:B,data:u,size:F,byteOffset:Z,byteStride:p,normalized:G})}));return{indices:F,attributes:V,totalVertices:p}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(B,u,F,Z){const V=await this.decodeMeshToMeshDataAsync(F,Z),R=new p.e(B,u);V.indices&&R.setIndices(V.indices);for(const p of V.attributes)R.setVerticesBuffer(new G.d(u.getEngine(),p.data,p.kind,!1,void 0,p.byteStride,void 0,p.byteOffset,p.size,void 0,p.normalized,!0),V.totalVertices);return R}async _decodeMeshToGeometryForGltfAsync(B,u,F,Z,V,R){const e=await this.decodeMeshToMeshDataAsync(F,Z,V),s=new p.e(B,u);R&&(s._boundingInfo=R,s.useBoundingInfoFromGeometry=!0),e.indices&&s.setIndices(e.indices);for(const p of e.attributes)s.setVerticesBuffer(new G.d(u.getEngine(),p.data,p.kind,!1,void 0,p.byteStride,void 0,p.byteOffset,p.size,void 0,p.normalized,!0),e.totalVertices);return s}}s.DefaultConfiguration={wasmUrl:`${V.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${V.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${V.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},s._Default=null},14860:(B,u,F)=>{"use strict";F.d(u,{c:()=>RB});var Z=F(12979),V=F(13409),p=F(13047),G=F(13398),R=F(13031);function e(B){let u=B.pathArray;const F=B.closeArray||!1,Z=B.closePath||!1,V=B.invertUV||!1,e=Math.floor(u[0].length/2);let s=B.offset||e;s=s>e?e:Math.floor(s);const Y=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE,Q=B.TB,t=B.aB,v=[],D=[],L=[],q=[],W=[],X=[],f=[],C=[];let x;const U=[],y=[];let O,g,J;if(u.length<2){const B=[],F=[];for(g=0;g<u[0].length-s;g++)B.push(u[0][g]),F.push(u[0][g+s]);u=[B,F]}let a=0;const T=Z?1:0,z=F?1:0;let M,j,o,I,mB,E;for(x=u[0].length,O=0;O<u.length+z;O++){for(f[O]=0,W[O]=[0],M=O===u.length?u[0]:u[O],j=M.length,x=x<j?x:j,J=0;J<j;)v.push(M[J].x,M[J].y,M[J].z),J>0&&(o=M[J].Lu(M[J-1]).length(),I=o+f[O],W[O].push(I),f[O]=I),J++;Z&&(J--,v.push(M[0].x,M[0].y,M[0].z),o=M[J].Lu(M[0]).length(),I=o+f[O],W[O].push(I),f[O]=I),U[O]=j+T,y[O]=a,a+=j+T}let w,H,n=null,d=null;for(g=0;g<x+T;g++)for(C[g]=0,X[g]=[0],O=0;O<u.length-1+z;O++)mB=u[O],E=O===u.length-1?u[0]:u[O+1],g===x?(n=mB[0],d=E[0]):(n=mB[g],d=E[g]),o=d.Lu(n).length(),I=o+C[g],X[g].push(I),C[g]=I;if(Q)for(O=0;O<Q.length;O++)q.push(Q[O].x,R.b?1-Q[O].y:Q[O].y);else for(O=0;O<u.length+z;O++)for(g=0;g<x+T;g++)w=0!=f[O]?W[O][g]/f[O]:0,H=0!=C[g]?X[g][O]/C[g]:0,V?q.push(H,w):q.push(w,R.b?1-H:H);O=0;let l=0,P=U[O]-1,c=U[O+1]-1,h=P<c?P:c,i=y[1]-y[0];const r=U.length-1;for(;l<=h&&O<r;)D.push(l,l+i,l+1),D.push(l+i+1,l+1,l+i),l+=1,l===h&&(O++,i=y[O+1]-y[O],P=U[O]-1,c=U[O+1]-1,l=y[O],h=P<c?P+l:c+l);if(G.c.ComputeNormals(v,D,L),Z){let B=0,F=0;for(O=0;O<u.length;O++){B=3*y[O],F=O+1<u.length?3*(y[O+1]-1):L.length-3,L[B]=.5*(L[B]+L[F]),L[B+1]=.5*(L[B+1]+L[F+1]),L[B+2]=.5*(L[B+2]+L[F+2]);const Z=Math.sqrt(L[B]*L[B]+L[B+1]*L[B+1]+L[B+2]*L[B+2]);L[B]/=Z,L[B+1]/=Z,L[B+2]/=Z,L[F]=L[B],L[F+1]=L[B+1],L[F+2]=L[B+2]}}if(F){let B=3*y[0],F=3*y[u.length];for(g=0;g<x+T;g++){L[B]=.5*(L[B]+L[F]),L[B+1]=.5*(L[B+1]+L[F+1]),L[B+2]=.5*(L[B+2]+L[F+2]);const u=Math.sqrt(L[B]*L[B]+L[B+1]*L[B+1]+L[B+2]*L[B+2]);L[B]/=u,L[B+1]/=u,L[B+2]/=u,L[F]=L[B],L[F+1]=L[B+1],L[F+2]=L[B+2],B+=3,F+=3}}G.c._ComputeSides(Y,v,D,L,q,B.frontUVs,B.backUVs);let K=null;if(t){K=new Float32Array(4*t.length);for(let B=0;B<t.length;B++)K[4*B]=t[B].r,K[4*B+1]=t[B].g,K[4*B+2]=t[B].b,K[4*B+3]=t[B].a}const N=new G.c,A=new Float32Array(v),b=new Float32Array(L),k=new Float32Array(q);return N.indices=D,N.gB=A,N.JB=b,N.TB=k,K&&N.set(K,p.f.ColorKind),Z&&(N._idx=y),N}function s(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=u.pathArray,Y=u.closeArray,Q=u.closePath,t=V.b._GetDefaultSideOrientation(u.sideOrientation),v=u.instance,D=u.updatable;if(v){const B=Z.TmpVectors.Du[0].OR(Number.MAX_VALUE),F=Z.TmpVectors.Du[1].OR(-Number.MAX_VALUE),e=u=>{let Z=s[0].length;const p=v;let G=0;const R=p._originalBuilderSideOrientation===V.b.DOUBLESIDE?2:1;for(let V=1;V<=R;++V)for(let R=0;R<s.length;++R){const V=s[R],e=V.length;Z=Z<e?Z:e;for(let p=0;p<Z;++p){const Z=V[p];u[G]=Z.x,u[G+1]=Z.y,u[G+2]=Z.z,B.minimizeInPlaceFromFloats(Z.x,Z.y,Z.z),F.maximizeInPlaceFromFloats(Z.x,Z.y,Z.z),G+=3}if(p._creationDataStorage&&p._creationDataStorage.closePath){const B=V[0];u[G]=B.x,u[G+1]=B.y,u[G+2]=B.z,G+=3}}},Y=v.getVerticesData(p.f.PositionKind);if(e(Y),v.hasBoundingInfo?v.getBoundingInfo().reConstruct(B,F,v._worldMatrix):v.buildBoundingInfo(B,F,v._worldMatrix),v.updateVerticesData(p.f.PositionKind,Y,!1,!1),u.aB){const B=v.getVerticesData(p.f.ColorKind);for(let F=0,Z=0;F<u.aB.length;F++,Z+=4){const V=u.aB[F];B[Z]=V.r,B[Z+1]=V.g,B[Z+2]=V.b,B[Z+3]=V.a}v.updateVerticesData(p.f.ColorKind,B,!1,!1)}if(u.TB){const B=v.getVerticesData(p.f.UVKind);for(let F=0;F<u.TB.length;F++)B[2*F]=u.TB[F].x,B[2*F+1]=R.b?1-u.TB[F].y:u.TB[F].y;v.updateVerticesData(p.f.UVKind,B,!1,!1)}if(!v.areNormalsFrozen||v.isFacetDataEnabled){const B=v.CR(),u=v.getVerticesData(p.f.NormalKind),F=v.isFacetDataEnabled?v.getFacetDataParameters():null;if(G.c.ComputeNormals(Y,B,u,F),v._creationDataStorage&&v._creationDataStorage.closePath){let B=0,F=0;for(let Z=0;Z<s.length;Z++)B=3*v._creationDataStorage.idx[Z],F=Z+1<s.length?3*(v._creationDataStorage.idx[Z+1]-1):u.length-3,u[B]=.5*(u[B]+u[F]),u[B+1]=.5*(u[B+1]+u[F+1]),u[B+2]=.5*(u[B+2]+u[F+2]),u[F]=u[B],u[F+1]=u[B+1],u[F+2]=u[B+2]}v.areNormalsFrozen||v.updateVerticesData(p.f.NormalKind,u,!1,!1)}return v}{const Z=new V.b(B,F);Z._originalBuilderSideOrientation=t,Z._creationDataStorage=new V.c;const p=e(u);return Q&&(Z._creationDataStorage.idx=p._idx),Z._creationDataStorage.closePath=Q,Z._creationDataStorage.closeArray=Y,p.MB(Z,D),Z}}G.c.CreateRibbon=e,V.b.CreateRibbon=function(B,u){return s(B,{pathArray:u,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var Y=F(14340),Q=F(14182),t=F(13023);function v(B){const u=B.pattern||V.b.NO_FLIP,F=B.tileWidth||B.tileSize||1,Z=B.tileHeight||B.tileSize||1,p=B.alignHorizontal||0,R=B.alignVertical||0,e=B.width||B.size||1,s=Math.floor(e/F);let Y=e-s*F;const Q=B.height||B.size||1,t=Math.floor(Q/Z);let v=Q-t*Z;const D=F*s/2,L=Z*t/2;let q=0,W=0,X=0,f=0,C=0,x=0;if(Y>0||v>0){switch(X=-D,f=-L,C=D,x=L,p){case V.b.CENTER:Y/=2,X-=Y,C+=Y;break;case V.b.LEFT:C+=Y,q=-Y/2;break;case V.b.RIGHT:X-=Y,q=Y/2}switch(R){case V.b.CENTER:v/=2,f-=v,x+=v;break;case V.b.BOTTOM:x+=v,W=-v/2;break;case V.b.TOP:f-=v,W=v/2}}const U=[],y=[],O=[];O[0]=[0,0,1,0,1,1,0,1],O[1]=[0,0,1,0,1,1,0,1],u!==V.b.ROTATE_TILE&&u!==V.b.ROTATE_ROW||(O[1]=[1,1,0,1,0,0,1,0]),u!==V.b.FLIP_TILE&&u!==V.b.FLIP_ROW||(O[1]=[1,0,0,0,0,1,1,1]),u!==V.b.FLIP_N_ROTATE_TILE&&u!==V.b.FLIP_N_ROTATE_ROW||(O[1]=[0,1,1,1,1,0,0,0]);let g=[];const J=[],a=[];let T=0;for(let G=0;G<t;G++)for(let B=0;B<s;B++)U.push(B*F-D+q,G*Z-L+W,0),U.push((B+1)*F-D+q,G*Z-L+W,0),U.push((B+1)*F-D+q,(G+1)*Z-L+W,0),U.push(B*F-D+q,(G+1)*Z-L+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),g=u===V.b.FLIP_TILE||u===V.b.ROTATE_TILE||u===V.b.FLIP_N_ROTATE_TILE?g.concat(O[(B%2+G%2)%2]):u===V.b.FLIP_ROW||u===V.b.ROTATE_ROW||u===V.b.FLIP_N_ROTATE_ROW?g.concat(O[G%2]):g.concat(O[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),T+=4;if(Y>0||v>0){const B=v>0&&(R===V.b.CENTER||R===V.b.TOP),G=v>0&&(R===V.b.CENTER||R===V.b.BOTTOM),e=Y>0&&(p===V.b.CENTER||p===V.b.RIGHT),Q=Y>0&&(p===V.b.CENTER||p===V.b.LEFT);let O,z,M,j,o=[];if(B&&e&&(U.push(X+q,f+W,0),U.push(-D+q,f+W,0),U.push(-D+q,f+v+W,0),U.push(X+q,f+v+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,O=1-Y/F,z=1-v/Z,M=1,j=1,o=[O,z,M,z,M,j,O,j],u===V.b.ROTATE_ROW&&(o=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),u===V.b.FLIP_ROW&&(o=[1-O,z,1-M,z,1-M,j,1-O,j]),u===V.b.FLIP_N_ROTATE_ROW&&(o=[O,1-z,M,1-z,M,1-j,O,1-j]),g=g.concat(o),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&Q&&(U.push(D+q,f+W,0),U.push(C+q,f+W,0),U.push(C+q,f+v+W,0),U.push(D+q,f+v+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,O=0,z=1-v/Z,M=Y/F,j=1,o=[O,z,M,z,M,j,O,j],(u===V.b.ROTATE_ROW||u===V.b.ROTATE_TILE&&s%2===0)&&(o=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),(u===V.b.FLIP_ROW||u===V.b.FLIP_TILE&&s%2===0)&&(o=[1-O,z,1-M,z,1-M,j,1-O,j]),(u===V.b.FLIP_N_ROTATE_ROW||u===V.b.FLIP_N_ROTATE_TILE&&s%2===0)&&(o=[O,1-z,M,1-z,M,1-j,O,1-j]),g=g.concat(o),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&e&&(U.push(X+q,L+W,0),U.push(-D+q,L+W,0),U.push(-D+q,x+W,0),U.push(X+q,x+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,O=1-Y/F,z=0,M=1,j=v/Z,o=[O,z,M,z,M,j,O,j],(u===V.b.ROTATE_ROW&&t%2===1||u===V.b.ROTATE_TILE&&t%1===0)&&(o=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),(u===V.b.FLIP_ROW&&t%2===1||u===V.b.FLIP_TILE&&t%2===0)&&(o=[1-O,z,1-M,z,1-M,j,1-O,j]),(u===V.b.FLIP_N_ROTATE_ROW&&t%2===1||u===V.b.FLIP_N_ROTATE_TILE&&t%2===0)&&(o=[O,1-z,M,1-z,M,1-j,O,1-j]),g=g.concat(o),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),G&&Q&&(U.push(D+q,L+W,0),U.push(C+q,L+W,0),U.push(C+q,x+W,0),U.push(D+q,x+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,O=0,z=0,M=Y/F,j=v/Z,o=[O,z,M,z,M,j,O,j],(u===V.b.ROTATE_ROW&&t%2===1||u===V.b.ROTATE_TILE&&(t+s)%2===1)&&(o=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),(u===V.b.FLIP_ROW&&t%2===1||u===V.b.FLIP_TILE&&(t+s)%2===1)&&(o=[1-O,z,1-M,z,1-M,j,1-O,j]),(u===V.b.FLIP_N_ROTATE_ROW&&t%2===1||u===V.b.FLIP_N_ROTATE_TILE&&(t+s)%2===1)&&(o=[O,1-z,M,1-z,M,1-j,O,1-j]),g=g.concat(o),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B){const B=[];O=0,z=1-v/Z,M=1,j=1,B[0]=[O,z,M,z,M,j,O,j],B[1]=[O,z,M,z,M,j,O,j],u!==V.b.ROTATE_TILE&&u!==V.b.ROTATE_ROW||(B[1]=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),u!==V.b.FLIP_TILE&&u!==V.b.FLIP_ROW||(B[1]=[1-O,z,1-M,z,1-M,j,1-O,j]),u!==V.b.FLIP_N_ROTATE_TILE&&u!==V.b.FLIP_N_ROTATE_ROW||(B[1]=[O,1-z,M,1-z,M,1-j,O,1-j]);for(let Z=0;Z<s;Z++)U.push(Z*F-D+q,f+W,0),U.push((Z+1)*F-D+q,f+W,0),U.push((Z+1)*F-D+q,f+v+W,0),U.push(Z*F-D+q,f+v+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,g=u===V.b.FLIP_TILE||u===V.b.ROTATE_TILE||u===V.b.FLIP_N_ROTATE_TILE?g.concat(B[(Z+1)%2]):u===V.b.FLIP_ROW||u===V.b.ROTATE_ROW||u===V.b.FLIP_N_ROTATE_ROW?g.concat(B[1]):g.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(G){const B=[];O=0,z=0,M=1,j=v/Z,B[0]=[O,z,M,z,M,j,O,j],B[1]=[O,z,M,z,M,j,O,j],u!==V.b.ROTATE_TILE&&u!==V.b.ROTATE_ROW||(B[1]=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),u!==V.b.FLIP_TILE&&u!==V.b.FLIP_ROW||(B[1]=[1-O,z,1-M,z,1-M,j,1-O,j]),u!==V.b.FLIP_N_ROTATE_TILE&&u!==V.b.FLIP_N_ROTATE_ROW||(B[1]=[O,1-z,M,1-z,M,1-j,O,1-j]);for(let Z=0;Z<s;Z++)U.push(Z*F-D+q,x-v+W,0),U.push((Z+1)*F-D+q,x-v+W,0),U.push((Z+1)*F-D+q,x+W,0),U.push(Z*F-D+q,x+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,g=u===V.b.FLIP_TILE||u===V.b.ROTATE_TILE||u===V.b.FLIP_N_ROTATE_TILE?g.concat(B[(Z+t)%2]):u===V.b.FLIP_ROW||u===V.b.ROTATE_ROW||u===V.b.FLIP_N_ROTATE_ROW?g.concat(B[t%2]):g.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(e){const B=[];O=1-Y/F,z=0,M=1,j=1,B[0]=[O,z,M,z,M,j,O,j],B[1]=[O,z,M,z,M,j,O,j],u!==V.b.ROTATE_TILE&&u!==V.b.ROTATE_ROW||(B[1]=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),u!==V.b.FLIP_TILE&&u!==V.b.FLIP_ROW||(B[1]=[1-O,z,1-M,z,1-M,j,1-O,j]),u!==V.b.FLIP_N_ROTATE_TILE&&u!==V.b.FLIP_N_ROTATE_ROW||(B[1]=[O,1-z,M,1-z,M,1-j,O,1-j]);for(let F=0;F<t;F++)U.push(X+q,F*Z-L+W,0),U.push(X+Y+q,F*Z-L+W,0),U.push(X+Y+q,(F+1)*Z-L+W,0),U.push(X+q,(F+1)*Z-L+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,g=u===V.b.FLIP_TILE||u===V.b.ROTATE_TILE||u===V.b.FLIP_N_ROTATE_TILE?g.concat(B[(F+1)%2]):u===V.b.FLIP_ROW||u===V.b.ROTATE_ROW||u===V.b.FLIP_N_ROTATE_ROW?g.concat(B[F%2]):g.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(Q){const B=[];O=0,z=0,M=Y/Z,j=1,B[0]=[O,z,M,z,M,j,O,j],B[1]=[O,z,M,z,M,j,O,j],u!==V.b.ROTATE_TILE&&u!==V.b.ROTATE_ROW||(B[1]=[1-O,1-z,1-M,1-z,1-M,1-j,1-O,1-j]),u!==V.b.FLIP_TILE&&u!==V.b.FLIP_ROW||(B[1]=[1-O,z,1-M,z,1-M,j,1-O,j]),u!==V.b.FLIP_N_ROTATE_TILE&&u!==V.b.FLIP_N_ROTATE_ROW||(B[1]=[O,1-z,M,1-z,M,1-j,O,1-j]);for(let F=0;F<t;F++)U.push(C-Y+q,F*Z-L+W,0),U.push(C+q,F*Z-L+W,0),U.push(C+q,(F+1)*Z-L+W,0),U.push(C-Y+q,(F+1)*Z-L+W,0),a.push(T,T+1,T+3,T+1,T+2,T+3),T+=4,g=u===V.b.FLIP_TILE||u===V.b.ROTATE_TILE||u===V.b.FLIP_N_ROTATE_TILE?g.concat(B[(F+s)%2]):u===V.b.FLIP_ROW||u===V.b.ROTATE_ROW||u===V.b.FLIP_N_ROTATE_ROW?g.concat(B[F%2]):g.concat(B[0]),J.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),y.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const z=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE;G.c._ComputeSides(z,U,a,y,g,B.frontUVs,B.backUVs);const M=new G.c;M.indices=a,M.gB=U,M.JB=y,M.TB=g;const j=z===G.c.DOUBLESIDE?J.concat(J):J;return M.aB=j,M}function D(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return v(u).MB(Z,u.updatable),Z}function L(B){const u=B.faceUV||new Array(6),F=B.faceColors,p=B.pattern||V.b.NO_FLIP,e=B.width||B.size||1,s=B.height||B.size||1,Y=B.depth||B.size||1,Q=B.tileWidth||B.tileSize||1,D=B.tileHeight||B.tileSize||1,L=B.alignHorizontal||0,q=B.alignVertical||0,W=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE;for(let V=0;V<6;V++)void 0===u[V]&&(u[V]=new Z.Vector4(0,0,1,1)),F&&void 0===F[V]&&(F[V]=new t.gR(1,1,1,1));const X=e/2,f=s/2,C=Y/2,x=[];for(let Z=0;Z<2;Z++)x[Z]=v({pattern:p,tileWidth:Q,tileHeight:D,width:e,height:s,alignVertical:q,alignHorizontal:L,sideOrientation:W});for(let Z=2;Z<4;Z++)x[Z]=v({pattern:p,tileWidth:Q,tileHeight:D,width:Y,height:s,alignVertical:q,alignHorizontal:L,sideOrientation:W});let U=q;q===V.b.BOTTOM?U=V.b.TOP:q===V.b.TOP&&(U=V.b.BOTTOM);for(let Z=4;Z<6;Z++)x[Z]=v({pattern:p,tileWidth:Q,tileHeight:D,width:e,height:Y,alignVertical:U,alignHorizontal:L,sideOrientation:W});let y=[],O=[],g=[],J=[];const a=[],T=[],z=[],M=[];let j=0,o=0;for(let V=0;V<6;V++){const B=x[V].gB.length;T[V]=[],z[V]=[];for(let u=0;u<B/3;u++)T[V].push(new Z.Du(x[V].gB[3*u],x[V].gB[3*u+1],x[V].gB[3*u+2])),z[V].push(new Z.Du(x[V].JB[3*u],x[V].JB[3*u+1],x[V].JB[3*u+2]));j=x[V].TB.length,M[V]=[];for(let F=0;F<j;F+=2)M[V][F]=u[V].x+(u[V].z-u[V].x)*x[V].TB[F],M[V][F+1]=u[V].y+(u[V].w-u[V].y)*x[V].TB[F+1],R.b&&(M[V][F+1]=1-M[V][F+1]);if(g=g.concat(M[V]),J=J.concat(x[V].indices.map((B=>B+o))),o+=T[V].length,F)for(let u=0;u<4;u++)a.push(F[V].r,F[V].g,F[V].b,F[V].a)}const I=new Z.Du(0,0,C),mB=Z.Matrix.RotationY(Math.PI);y=T[0].map((B=>Z.Du.TransformNormal(B,mB).add(I))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[]),O=z[0].map((B=>Z.Du.TransformNormal(B,mB))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[]),y=y.concat(T[1].map((B=>B.Lu(I))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[])),O=O.concat(z[1].map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[]));const E=new Z.Du(X,0,0),w=Z.Matrix.RotationY(-Math.PI/2);y=y.concat(T[2].map((B=>Z.Du.TransformNormal(B,w).add(E))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[])),O=O.concat(z[2].map((B=>Z.Du.TransformNormal(B,w))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[]));const H=Z.Matrix.RotationY(Math.PI/2);y=y.concat(T[3].map((B=>Z.Du.TransformNormal(B,H).Lu(E))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[])),O=O.concat(z[3].map((B=>Z.Du.TransformNormal(B,H))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[]));const n=new Z.Du(0,f,0),d=Z.Matrix.RotationX(Math.PI/2);y=y.concat(T[4].map((B=>Z.Du.TransformNormal(B,d).add(n))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[])),O=O.concat(z[4].map((B=>Z.Du.TransformNormal(B,d))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[]));const l=Z.Matrix.RotationX(-Math.PI/2);y=y.concat(T[5].map((B=>Z.Du.TransformNormal(B,l).Lu(n))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[])),O=O.concat(z[5].map((B=>Z.Du.TransformNormal(B,l))).map((B=>[B.x,B.y,B.z])).reduce(((B,u)=>B.concat(u)),[])),G.c._ComputeSides(W,y,J,O,g);const P=new G.c;if(P.indices=J,P.gB=y,P.JB=O,P.TB=g,F){const B=W===G.c.DOUBLESIDE?a.concat(a):a;P.aB=B}return P}function q(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return L(u).MB(Z,u.updatable),Z}G.c.CreateTiledPlane=v;G.c.CreateTiledBox=L;var W=F(14329),X=F(13221),f=F(13188);function C(B){const u=B.height||2;let F=0===B.diameterTop?0:B.diameterTop||B.diameter||1,p=0===B.diameterBottom?0:B.diameterBottom||B.diameter||1;F=F||1e-5,p=p||1e-5;const e=0|(B.tessellation||24),s=0|(B.subdivisions||1),Y=!!B.hasRings,Q=!!B.enclose,v=0===B.cap?0:B.cap||V.b.CAP_ALL,D=B.arc&&(B.arc<=0||B.arc>1)?1:B.arc||1,L=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE,q=B.faceUV||new Array(3),W=B.faceColors,X=2+(1+(1!==D&&Q?2:0))*(Y?s:1);let C;for(C=0;C<X;C++)W&&void 0===W[C]&&(W[C]=new t.gR(1,1,1,1));for(C=0;C<X;C++)q&&void 0===q[C]&&(q[C]=new Z.Vector4(0,0,1,1));const x=[],U=[],y=[],O=[],g=[],J=2*Math.PI*D/e;let a,T,z;const M=(p-F)/2/u,j=Z.Du.Zero(),o=Z.Du.Zero(),I=Z.Du.Zero(),mB=Z.Du.Zero(),E=Z.Du.Zero(),w=f.b.Y;let H,n,d,l=1,P=1,c=0,h=0;for(H=0;H<=s;H++)for(T=H/s,z=(T*(F-p)+p)/2,l=Y&&0!==H&&H!==s?2:1,d=0;d<l;d++){for(Y&&(P+=d),Q&&(P+=2*d),n=0;n<=e;n++)a=n*J,j.x=Math.cos(-a)*z,j.y=-u/2+T*u,j.z=Math.sin(-a)*z,0===F&&H===s?(o.x=y[y.length-3*(e+1)],o.y=y[y.length-3*(e+1)+1],o.z=y[y.length-3*(e+1)+2]):(o.x=j.x,o.z=j.z,o.y=Math.sqrt(o.x*o.x+o.z*o.z)*M,o.normalize()),0===n&&(I.Z(j),mB.Z(o)),U.push(j.x,j.y,j.z),y.push(o.x,o.y,o.z),h=Y?c!==P?q[P].y:q[P].w:q[P].y+(q[P].w-q[P].y)*T,O.push(q[P].x+(q[P].z-q[P].x)*n/e,R.b?1-h:h),W&&g.push(W[P].r,W[P].g,W[P].b,W[P].a);1!==D&&Q&&(U.push(j.x,j.y,j.z),U.push(0,j.y,0),U.push(0,j.y,0),U.push(I.x,I.y,I.z),Z.Du.CrossToRef(w,o,E),E.normalize(),y.push(E.x,E.y,E.z,E.x,E.y,E.z),Z.Du.CrossToRef(mB,w,E),E.normalize(),y.push(E.x,E.y,E.z,E.x,E.y,E.z),h=Y?c!==P?q[P+1].y:q[P+1].w:q[P+1].y+(q[P+1].w-q[P+1].y)*T,O.push(q[P+1].x,R.b?1-h:h),O.push(q[P+1].z,R.b?1-h:h),h=Y?c!==P?q[P+2].y:q[P+2].w:q[P+2].y+(q[P+2].w-q[P+2].y)*T,O.push(q[P+2].x,R.b?1-h:h),O.push(q[P+2].z,R.b?1-h:h),W&&(g.push(W[P+1].r,W[P+1].g,W[P+1].b,W[P+1].a),g.push(W[P+1].r,W[P+1].g,W[P+1].b,W[P+1].a),g.push(W[P+2].r,W[P+2].g,W[P+2].b,W[P+2].a),g.push(W[P+2].r,W[P+2].g,W[P+2].b,W[P+2].a))),c!==P&&(c=P)}const i=1!==D&&Q?e+4:e;for(H=0,P=0;P<s;P++){let B=0,u=0,F=0,Z=0;for(n=0;n<e;n++)B=H*(i+1)+n,u=(H+1)*(i+1)+n,F=H*(i+1)+(n+1),Z=(H+1)*(i+1)+(n+1),x.push(B,u,F),x.push(Z,F,u);1!==D&&Q&&(x.push(B+2,u+2,F+2),x.push(Z+2,F+2,u+2),x.push(B+4,u+4,F+4),x.push(Z+4,F+4,u+4)),H=Y?H+2:H+1}const r=B=>{const V=B?F/2:p/2;if(0===V)return;let G,s,Y;const Q=B?q[X-1]:q[0];let t=null;W&&(t=B?W[X-1]:W[0]);const v=U.length/3,L=B?u/2:-u/2,f=new Z.Du(0,L,0);U.push(f.x,f.y,f.z),y.push(0,B?1:-1,0);const C=Q.y+.5*(Q.w-Q.y);O.push(Q.x+.5*(Q.z-Q.x),R.b?1-C:C),t&&g.push(t.r,t.g,t.b,t.a);const J=new Z.Vector2(.5,.5);for(Y=0;Y<=e;Y++){G=2*Math.PI*Y*D/e;const u=Math.cos(-G),F=Math.sin(-G);s=new Z.Du(u*V,L,F*V);const p=new Z.Vector2(u*J.x+.5,F*J.y+.5);U.push(s.x,s.y,s.z),y.push(0,B?1:-1,0);const v=Q.y+(Q.w-Q.y)*p.y;O.push(Q.x+(Q.z-Q.x)*p.x,R.b?1-v:v),t&&g.push(t.r,t.g,t.b,t.a)}for(Y=0;Y<e;Y++)B?(x.push(v),x.push(v+(Y+2)),x.push(v+(Y+1))):(x.push(v),x.push(v+(Y+1)),x.push(v+(Y+2)))};v!==V.b.CAP_START&&v!==V.b.CAP_ALL||r(!1),v!==V.b.CAP_END&&v!==V.b.CAP_ALL||r(!0),G.c._ComputeSides(L,U,x,y,O,B.frontUVs,B.backUVs);const K=new G.c;return K.indices=x,K.gB=U,K.JB=y,K.TB=O,W&&(K.aB=g),K}function x(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return C(u).MB(Z,u.updatable),Z}function U(B){const u=[],F=[],V=[],p=[],e=B.diameter||1,s=B.thickness||.5,Y=0|(B.tessellation||16),Q=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE,t=Y+1;for(let G=0;G<=Y;G++){const B=G/Y,Q=G*Math.PI*2/Y-Math.PI/2,v=Z.Matrix.Translation(e/2,0,0).multiply(Z.Matrix.RotationY(Q));for(let e=0;e<=Y;e++){const Q=1-e/Y,D=e*Math.PI*2/Y+Math.PI,L=Math.cos(D),q=Math.sin(D);let W=new Z.Du(L,q,0),X=W.scale(s/2);const f=new Z.Vector2(B,Q);X=Z.Du.TransformCoordinates(X,v),W=Z.Du.TransformNormal(W,v),F.push(X.x,X.y,X.z),V.push(W.x,W.y,W.z),p.push(f.x,R.b?1-f.y:f.y);const C=(G+1)%t,x=(e+1)%t;u.push(G*t+e),u.push(G*t+x),u.push(C*t+e),u.push(G*t+x),u.push(C*t+x),u.push(C*t+e)}}G.c._ComputeSides(Q,F,u,V,p,B.frontUVs,B.backUVs);const v=new G.c;return v.indices=u,v.gB=F,v.JB=V,v.TB=p,v}function y(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return U(u).MB(Z,u.updatable),Z}G.c.CreateCylinder=C,V.b.CreateCylinder=(B,u,F,Z,p,G,R,e,s)=>{void 0!==R&&R instanceof X.e||(void 0!==R&&(s=e||V.b.DEFAULTSIDE,e=R),R=G,G=1);return x(B,{height:u,diameterTop:F,diameterBottom:Z,tessellation:p,subdivisions:G,sideOrientation:s,updatable:e},R)};function O(B){const u=[],F=[],V=[],p=[],e=B.radius||2,s=B.tube||.5,Y=B.radialSegments||32,Q=B.tubularSegments||32,t=B.p||2,v=B.q||3,D=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE,L=B=>{const u=Math.cos(B),F=Math.sin(B),V=v/t*B,p=Math.cos(V),G=e*(2+p)*.5*u,R=e*(2+p)*F*.5,s=e*Math.sin(V)*.5;return new Z.Du(G,R,s)};let q,W;for(q=0;q<=Y;q++){const B=q%Y/Y*2*t*Math.PI,u=L(B),V=L(B+.01),G=V.Lu(u);let e=V.add(u);const v=Z.Du.Cross(G,e);for(e=Z.Du.Cross(v,G),v.normalize(),e.normalize(),W=0;W<Q;W++){const B=W%Q/Q*2*Math.PI,Z=-s*Math.cos(B),V=s*Math.sin(B);F.push(u.x+Z*e.x+V*v.x),F.push(u.y+Z*e.y+V*v.y),F.push(u.z+Z*e.z+V*v.z),p.push(q/Y),p.push(R.b?1-W/Q:W/Q)}}for(q=0;q<Y;q++)for(W=0;W<Q;W++){const B=(W+1)%Q,F=q*Q+W,Z=(q+1)*Q+W,V=(q+1)*Q+B,p=q*Q+B;u.push(p),u.push(Z),u.push(F),u.push(p),u.push(V),u.push(Z)}G.c.ComputeNormals(F,u,V),G.c._ComputeSides(D,F,u,V,p,B.frontUVs,B.backUVs);const X=new G.c;return X.indices=u,X.gB=F,X.JB=V,X.TB=p,X}function g(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2?arguments[2]:void 0;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return O(u).MB(Z,u.updatable),Z}G.c.CreateTorus=U,V.b.CreateTorus=(B,u,F,Z,V,p,G)=>y(B,{diameter:u,thickness:F,tessellation:Z,sideOrientation:G,updatable:p},V);G.c.CreateTorusKnot=O,V.b.CreateTorusKnot=(B,u,F,Z,V,p,G,R,e,s)=>g(B,{radius:u,tube:F,radialSegments:Z,tubularSegments:V,p:p,q:G,sideOrientation:s,updatable:e},R);var J=F(14868),a=F(13525),T=F(13199);function z(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=u.path,p=u.shape,G=u.scale||1,R=u.rotation||0,e=0===u.cap?0:u.cap||V.b.NO_CAP,s=u.updatable,Y=V.b._GetDefaultSideOrientation(u.sideOrientation),Q=u.instance||null,t=u.invertUV||!1,v=u.closeShape||!1,D=u.closePath||!1,L=u.capFunction||null;return j(B,p,Z,G,R,null,null,D,v,e,!1,F,!!s,Y,Q,t,u.frontUVs||null,u.backUVs||null,u.firstNormal||null,!!u.adjustFrame,L)}function M(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=u.path,p=u.shape,G=u.scaleFunction||(()=>1),R=u.rotationFunction||(()=>0),e=u.closePath||u.ribbonCloseArray||!1,s=u.closeShape||u.ribbonClosePath||!1,Y=0===u.cap?0:u.cap||V.b.NO_CAP,Q=u.updatable,t=u.firstNormal||null,v=u.adjustFrame||!1,D=V.b._GetDefaultSideOrientation(u.sideOrientation),L=u.instance,q=u.invertUV||!1,W=u.capFunction||null;return j(B,p,Z,null,null,G,R,e,s,Y,!0,F,!!Q,D,L||null,q,u.frontUVs||null,u.backUVs||null,t,v,W||null)}function j(B,u,F,p,G,R,e,Y,Q,t,v,D,L,q,W,X,f,C,x,U,y){const O=(B,u,F,p,G,R,e,s,Y,Q,t)=>{const v=F.getTangents(),D=F.getNormals(),L=F.getBinormals(),q=F.getDistances();if(t)for(let V=0;V<v.length;V++)if(0==v[V].x&&0==v[V].y&&0==v[V].z&&v[V].Z(v[V-1]),0==D[V].x&&0==D[V].y&&0==D[V].z&&D[V].Z(D[V-1]),0==L[V].x&&0==L[V].y&&0==L[V].z&&L[V].Z(L[V-1]),V>0){let B=v[V-1];Z.Du.Dot(B,v[V])<0&&v[V].scaleInPlace(-1),B=D[V-1],Z.Du.Dot(B,D[V])<0&&D[V].scaleInPlace(-1),B=L[V-1],Z.Du.Dot(B,L[V])<0&&L[V].scaleInPlace(-1)}let W=0;const X=Q&&s?s:()=>null!==R?R:0,f=Q&&e?e:()=>null!==G?G:1;let C=Y===V.b.NO_CAP||Y===V.b.CAP_END?0:2;const x=Z.TmpVectors.Matrix[0];for(let V=0;V<u.length;V++){const F=[],G=X(V,q[V]),R=f(V,q[V]);Z.Matrix.RotationAxisToRef(v[V],W,x);for(let p=0;p<B.length;p++){const G=v[V].scale(B[p].z).add(D[V].scale(B[p].x)).add(L[V].scale(B[p].y)),e=Z.Du.Zero();Z.Du.TransformCoordinatesToRef(G,x,e),e.scaleInPlace(R).addInPlace(u[V]),F[p]=e}p[C]=F,W+=G,C++}const U=y||(B=>{const u=Array(),F=Z.Du.Zero();let V;for(V=0;V<B.length;V++)F.addInPlace(B[V]);for(F.scaleInPlace(1/B.length),V=0;V<B.length;V++)u.push(F);return u});switch(Y){case V.b.NO_CAP:break;case V.b.CAP_START:p[0]=U(p[2]),p[1]=p[2];break;case V.b.CAP_END:p[C]=p[C-1],p[C+1]=U(p[C-1]);break;case V.b.CAP_ALL:p[0]=U(p[2]),p[1]=p[2],p[C]=p[C-1],p[C+1]=U(p[C-1])}return p};let g,J;if(W){const B=W._creationDataStorage;return g=x?B.path3D.update(F,x):B.path3D.update(F),J=O(u,F,B.path3D,B.pathArray,p,G,R,e,B.cap,v,U),W=s("",{pathArray:J,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:W},D||void 0)}g=x?new T.k(F,x):new T.k(F);J=O(u,F,g,new Array,p,G,R,e,t=t<0||t>3?0:t,v,U);const a=s(B,{pathArray:J,closeArray:Y,closePath:Q,updatable:L,sideOrientation:q,invertUV:X,frontUVs:f||void 0,backUVs:C||void 0},D);return a._creationDataStorage.pathArray=J,a._creationDataStorage.path3D=g,a._creationDataStorage.cap=t,a}function o(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=u.arc?u.arc<=0||u.arc>1?1:u.arc:1,G=void 0===u.closed||u.closed,R=u.shape,e=u.radius||1,Y=u.tessellation||64,Q=u.clip||0,t=u.updatable,v=V.b._GetDefaultSideOrientation(u.sideOrientation),D=u.cap||V.b.NO_CAP,L=2*Math.PI,q=[],W=u.invertUV||!1;let X=0,f=0;const C=L/Y*p;let x,U;for(X=0;X<=Y-Q;X++){for(U=[],D!=V.b.CAP_START&&D!=V.b.CAP_ALL||(U.push(new Z.Du(0,R[0].y,0)),U.push(new Z.Du(Math.cos(X*C)*R[0].x*e,R[0].y,Math.sin(X*C)*R[0].x*e))),f=0;f<R.length;f++)x=new Z.Du(Math.cos(X*C)*R[f].x*e,R[f].y,Math.sin(X*C)*R[f].x*e),U.push(x);D!=V.b.CAP_END&&D!=V.b.CAP_ALL||(U.push(new Z.Du(Math.cos(X*C)*R[R.length-1].x*e,R[R.length-1].y,Math.sin(X*C)*R[R.length-1].x*e)),U.push(new Z.Du(0,R[R.length-1].y,0))),q.push(U)}return s(B,{pathArray:q,closeArray:G,sideOrientation:v,updatable:t,invertUV:W,frontUVs:u.frontUVs,backUVs:u.backUVs},F)}V.b.ExtrudeShape=function(B,u,F,Z,p,G){let R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0,Y=arguments.length>9?arguments[9]:void 0;return z(B,{shape:u,path:F,scale:Z,rotation:p,cap:0===G?0:G||V.b.NO_CAP,sideOrientation:s,instance:Y,updatable:e},R)},V.b.ExtrudeShapeCustom=(B,u,F,Z,p,G,R,e,s,Y,Q,t)=>M(B,{shape:u,path:F,scaleFunction:Z,rotationFunction:p,ribbonCloseArray:G,ribbonClosePath:R,cap:0===e?0:e||V.b.NO_CAP,sideOrientation:Q,instance:t,updatable:Y},s);V.b.CreateLathe=(B,u,F,Z,V,p,G)=>o(B,{shape:u,radius:F,tessellation:Z,sideOrientation:G,updatable:p},V);var I=F(14240),mB=F(14188);function E(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=u.path;let G=u.instance,R=1;void 0!==u.radius?R=u.radius:G&&(R=G._creationDataStorage.radius);const e=u.tessellation||64,Y=u.radiusFunction||null;let Q=u.cap||V.b.NO_CAP;const t=u.invertUV||!1,v=u.updatable,D=V.b._GetDefaultSideOrientation(u.sideOrientation);u.arc=u.arc&&(u.arc<=0||u.arc>1)?1:u.arc||1;const L=(B,u,F,p,G,R,e,s)=>{const Y=u.getTangents(),Q=u.getNormals(),t=u.getDistances(),v=2*Math.PI/G*s,D=R||(()=>p);let L,q,W,X;const f=Z.TmpVectors.Matrix[0];let C=e===V.b.NO_CAP||e===V.b.CAP_END?0:2;for(let V=0;V<B.length;V++){q=D(V,t[V]),L=Array(),W=Q[V];for(let u=0;u<G;u++)Z.Matrix.RotationAxisToRef(Y[V],v*u,f),X=L[u]?L[u]:Z.Du.Zero(),Z.Du.TransformCoordinatesToRef(W,f,X),X.scaleInPlace(q).addInPlace(B[V]),L[u]=X;F[C]=L,C++}const x=(u,F)=>{const Z=Array();for(let V=0;V<u;V++)Z.push(B[F]);return Z};switch(e){case V.b.NO_CAP:break;case V.b.CAP_START:F[0]=x(G,0),F[1]=F[2].slice(0);break;case V.b.CAP_END:F[C]=F[C-1].slice(0),F[C+1]=x(G,B.length-1);break;case V.b.CAP_ALL:F[0]=x(G,0),F[1]=F[2].slice(0),F[C]=F[C-1].slice(0),F[C+1]=x(G,B.length-1)}return F};let q,W;if(G){const B=G._creationDataStorage,F=u.arc||B.arc;return q=B.path3D.update(p),W=L(p,q,B.pathArray,R,B.tessellation,Y,B.cap,F),G=s("",{pathArray:W,instance:G}),B.path3D=q,B.pathArray=W,B.arc=F,B.radius=R,G}q=new T.k(p);Q=Q<0||Q>3?0:Q,W=L(p,q,new Array,R,e,Y,Q,u.arc);const X=s(B,{pathArray:W,closePath:!0,closeArray:!1,updatable:v,sideOrientation:D,invertUV:t,frontUVs:u.frontUVs,backUVs:u.backUVs},F);return X._creationDataStorage.pathArray=W,X._creationDataStorage.path3D=q,X._creationDataStorage.tessellation=e,X._creationDataStorage.cap=Q,X._creationDataStorage.arc=u.arc,X._creationDataStorage.radius=R,X}function w(B){const u=[];u[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},u[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},u[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},u[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},u[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},u[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},u[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},u[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},u[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},u[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},u[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},u[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},u[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},u[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},u[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const F=B.type&&(B.type<0||B.type>=u.length)?0:B.type||0,V=B.size,p=B.sizeX||V||1,e=B.sizeY||V||1,s=B.sizeZ||V||1,Y=B.custom||u[F],Q=Y.face.length,v=B.faceUV||new Array(Q),D=B.faceColors,L=void 0===B.flat||B.flat,q=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE,W=[],X=[],f=[],C=[],x=[];let U=0,y=0;const O=[];let g,J,a,T,z,M,j=0,o=0;if(L)for(o=0;o<Q;o++)D&&void 0===D[o]&&(D[o]=new t.gR(1,1,1,1)),v&&void 0===v[o]&&(v[o]=new Z.Vector4(0,0,1,1));if(L)for(o=0;o<Q;o++){const B=Y.face[o].length;for(a=2*Math.PI/B,T=.5*Math.tan(a/2),z=.5,j=0;j<B;j++)W.push(Y.vertex[Y.face[o][j]][0]*p,Y.vertex[Y.face[o][j]][1]*e,Y.vertex[Y.face[o][j]][2]*s),O.push(U),U++,g=v[o].x+(v[o].z-v[o].x)*(.5+T),J=v[o].y+(v[o].w-v[o].y)*(z-.5),C.push(g,R.b?1-J:J),M=T*Math.cos(a)-z*Math.sin(a),z=T*Math.sin(a)+z*Math.cos(a),T=M,D&&x.push(D[o].r,D[o].g,D[o].b,D[o].a);for(j=0;j<B-2;j++)X.push(O[0+y],O[j+2+y],O[j+1+y]);y+=B}else{for(j=0;j<Y.vertex.length;j++)W.push(Y.vertex[j][0]*p,Y.vertex[j][1]*e,Y.vertex[j][2]*s),C.push(0,R.b?1:0);for(o=0;o<Q;o++)for(j=0;j<Y.face[o].length-2;j++)X.push(Y.face[o][0],Y.face[o][j+2],Y.face[o][j+1])}G.c.ComputeNormals(W,X,f),G.c._ComputeSides(q,W,X,f,C,B.frontUVs,B.backUVs);const I=new G.c;return I.gB=W,I.indices=X,I.JB=f,I.TB=C,D&&L&&(I.aB=x),I}function H(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return w(u).MB(Z,u.updatable),Z}V.b.CreateTube=(B,u,F,Z,V,p,G,R,e,s)=>E(B,{path:u,radius:F,tessellation:Z,radiusFunction:V,arc:1,cap:p,updatable:R,sideOrientation:e,instance:s},G);function n(B){const u=B.sideOrientation||G.c.DEFAULTSIDE,F=B.radius||1,V=void 0===B.flat||B.flat,p=0|(B.subdivisions||4),e=B.radiusX||F,s=B.radiusY||F,Y=B.radiusZ||F,Q=(1+Math.sqrt(5))/2,t=[-1,Q,-0,1,Q,0,-1,-Q,0,1,-Q,0,0,-1,-Q,0,1,-Q,0,-1,Q,0,1,Q,Q,0,1,Q,0,-1,-Q,0,1,-Q,0,-1],v=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],D=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],L=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],q=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],W=[],X=[],f=[],C=[];let x=0;const U=new Array(3),y=new Array(3);let O;for(O=0;O<3;O++)U[O]=Z.Du.Zero(),y[O]=Z.Vector2.Zero();for(let G=0;G<20;G++){for(O=0;O<3;O++){const B=v[3*G+O];U[O].UR(t[3*D[B]],t[3*D[B]+1],t[3*D[B]+2]),U[O].normalize(),y[O].UR(.134765625*L[2*B]+.05859375+-.0390625*q[G],.2333984375*L[2*B+1]+.025390625+.01953125*q[G])}const B=(B,u,F,G)=>{const Q=Z.Du.Lerp(U[0],U[2],u/p),t=Z.Du.Lerp(U[1],U[2],u/p),v=p===u?U[2]:Z.Du.Lerp(Q,t,B/(p-u));let D;if(v.normalize(),V){const B=Z.Du.Lerp(U[0],U[2],G/p),u=Z.Du.Lerp(U[1],U[2],G/p);D=Z.Du.Lerp(B,u,F/(p-G))}else D=new Z.Du(v.x,v.y,v.z);D.x/=e,D.y/=s,D.z/=Y,D.normalize();const L=Z.Vector2.Lerp(y[0],y[2],u/p),q=Z.Vector2.Lerp(y[1],y[2],u/p),O=p===u?y[2]:Z.Vector2.Lerp(L,q,B/(p-u));X.push(v.x*e,v.y*s,v.z*Y),f.push(D.x,D.y,D.z),C.push(O.x,R.b?1-O.y:O.y),W.push(x),x++};for(let u=0;u<p;u++)for(let F=0;F+u<p;F++)B(F,u,F+1/3,u+1/3),B(F+1,u,F+1/3,u+1/3),B(F,u+1,F+1/3,u+1/3),F+u+1<p&&(B(F+1,u,F+2/3,u+2/3),B(F+1,u+1,F+2/3,u+2/3),B(F,u+1,F+2/3,u+2/3))}G.c._ComputeSides(u,X,W,f,C,B.frontUVs,B.backUVs);const g=new G.c;return g.indices=W,g.gB=X,g.JB=f,g.TB=C,g}function d(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Z=new V.b(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),Z._originalBuilderSideOrientation=u.sideOrientation;return n(u).MB(Z,u.updatable),Z}G.c.CreatePolyhedron=w,V.b.CreatePolyhedron=(B,u,F)=>H(B,u,F);G.c.CreateIcoSphere=n,V.b.CreateIcoSphere=(B,u,F)=>d(B,u,F);var l=F(12994);const P=new Z.Du(1,0,0),c=new Z.Du(-1,0,0),h=new Z.Du(0,1,0),i=new Z.Du(0,-1,0),r=new Z.Du(0,0,1),K=new Z.Du(0,0,-1);class N{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z.Du.Zero(),u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.Du.Up(),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Z.Vector2.Zero(),V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,R=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,e=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=B,this.normal=u,this.uv=F,this.vertexIdx=V,this.vertexIdxForBones=p,this.localPositionOverride=G,this.localNormalOverride=R,this.matrixIndicesOverride=e,this.matrixWeightsOverride=s}clone(){var B,u,F,Z;return new N(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(B=this.localPositionOverride)||void 0===B?void 0:B.slice(),null===(u=this.localNormalOverride)||void 0===u?void 0:u.slice(),null===(F=this.matrixIndicesOverride)||void 0===F?void 0:F.slice(),null===(Z=this.matrixWeightsOverride)||void 0===Z?void 0:Z.slice())}}function A(B,u,F){var e,s,Y,Q,t;const v=!!u.skeleton,D=!(null===(e=u.morphTargetManager)||void 0===e||!e.numTargets),L=F.localMode||v,q=u.CR(),W=v||D?u.HR(!0,!0):u.getVerticesData(p.f.PositionKind),X=v||D?u.getNormalsData(!0,!0):u.getVerticesData(p.f.NormalKind),f=L?v?u.getVerticesData(p.f.PositionKind):W:null,C=L?v?u.getVerticesData(p.f.NormalKind):X:null,x=u.getVerticesData(p.f.UVKind),U=v?u.getVerticesData(p.f.MatricesIndicesKind):null,y=v?u.getVerticesData(p.f.MatricesWeightsKind):null,O=v?u.getVerticesData(p.f.MatricesIndicesExtraKind):null,g=v?u.getVerticesData(p.f.MatricesWeightsExtraKind):null,J=F.position||Z.Du.Zero();let a=F.normal||Z.Du.Up();const T=F.size||Z.Du.One(),z=F.angle||0;if(!a){const B=new Z.Du(0,0,1),F=u.yB().activeCamera,V=Z.Du.TransformCoordinates(B,F.getWorldMatrix());a=F.globalPosition.Lu(V)}const M=-Math.atan2(a.z,a.x)-Math.PI/2,j=Math.sqrt(a.x*a.x+a.z*a.z),o=Math.atan2(a.y,j),I=new G.c;I.indices=[],I.gB=[],I.JB=[],I.TB=[],I.matricesIndices=v?[]:null,I.matricesWeights=v?[]:null,I.matricesIndicesExtra=O?[]:null,I.matricesWeightsExtra=g?[]:null;let mB=0;const E=(B,u)=>{const V=new N;if(!q||!W||!X)return V;const p=q[B];if(V.vertexIdx=3*p,V.vertexIdxForBones=4*p,V.position=new Z.Du(W[3*p],W[3*p+1],W[3*p+2]),Z.Du.TransformCoordinatesToRef(V.position,u,V.position),V.normal=new Z.Du(X[3*p],X[3*p+1],X[3*p+2]),Z.Du.TransformNormalToRef(V.normal,u,V.normal),F.captureUVS&&x){const B=x[2*p+1];V.uv=new Z.Vector2(x[2*p],R.b?1-B:B)}return V},w=[0,0,0,0],H=(B,u)=>{if(0===B.length)return B;const F=.5*Math.abs(Z.Du.Dot(T,u)),V=(B,u,F,Z)=>{for(let V=0;V<Z;++V)if(B[F+V]===u)return F+V;return-1},p=(B,p)=>{const G=Z.Du.GetClipFactor(B.position,p.position,u,F);let R=w,e=w;if(U&&y){const u=B.matrixIndicesOverride?0:B.vertexIdxForBones,F=B.matrixIndicesOverride??U,Z=B.matrixWeightsOverride??y,s=p.matrixIndicesOverride?0:p.vertexIdxForBones,Y=p.matrixIndicesOverride??U,Q=p.matrixWeightsOverride??y;R=[0,0,0,0],e=[0,0,0,0];let t=0;for(let B=0;B<4;++B)if(Z[u+B]>0){const p=V(Y,F[u+B],s,4);R[t]=F[u+B],e[t]=(0,l.Lerp)(Z[u+B],p>=0?Q[p]:0,G),t++}for(let B=0;B<4&&t<4;++B){const Z=Y[s+B];-1===V(F,Z,u,4)&&(R[t]=Z,e[t]=(0,l.Lerp)(0,Q[s+B],G),t++)}const v=e[0]+e[1]+e[2]+e[3];e[0]/=v,e[1]/=v,e[2]/=v,e[3]/=v}const s=B.localPositionOverride?B.localPositionOverride[0]:(null===f||void 0===f?void 0:f[B.vertexIdx])??0,Y=B.localPositionOverride?B.localPositionOverride[1]:(null===f||void 0===f?void 0:f[B.vertexIdx+1])??0,Q=B.localPositionOverride?B.localPositionOverride[2]:(null===f||void 0===f?void 0:f[B.vertexIdx+2])??0,t=p.localPositionOverride?p.localPositionOverride[0]:(null===f||void 0===f?void 0:f[p.vertexIdx])??0,v=p.localPositionOverride?p.localPositionOverride[1]:(null===f||void 0===f?void 0:f[p.vertexIdx+1])??0,D=p.localPositionOverride?p.localPositionOverride[2]:(null===f||void 0===f?void 0:f[p.vertexIdx+2])??0,L=B.localNormalOverride?B.localNormalOverride[0]:(null===C||void 0===C?void 0:C[B.vertexIdx])??0,q=B.localNormalOverride?B.localNormalOverride[1]:(null===C||void 0===C?void 0:C[B.vertexIdx+1])??0,W=B.localNormalOverride?B.localNormalOverride[2]:(null===C||void 0===C?void 0:C[B.vertexIdx+2])??0,X=L+((p.localNormalOverride?p.localNormalOverride[0]:(null===C||void 0===C?void 0:C[p.vertexIdx])??0)-L)*G,x=q+((p.localNormalOverride?p.localNormalOverride[1]:(null===C||void 0===C?void 0:C[p.vertexIdx+1])??0)-q)*G,O=W+((p.localNormalOverride?p.localNormalOverride[2]:(null===C||void 0===C?void 0:C[p.vertexIdx+2])??0)-W)*G,g=Math.sqrt(X*X+x*x+O*O);return new N(Z.Du.Lerp(B.position,p.position,G),Z.Du.Lerp(B.normal,p.normal,G).normalize(),Z.Vector2.Lerp(B.uv,p.uv,G),-1,-1,f?[s+(t-s)*G,Y+(v-Y)*G,Q+(D-Q)*G]:null,C?[X/g,x/g,O/g]:null,R,e)};let G=null;B.length>3&&(G=[]);for(let R=0;R<B.length;R+=3){let V=0,e=null,s=null,Y=null,Q=null;const t=Z.Du.Dot(B[R].position,u)-F>0,v=Z.Du.Dot(B[R+1].position,u)-F>0,D=Z.Du.Dot(B[R+2].position,u)-F>0;switch(V=(t?1:0)+(v?1:0)+(D?1:0),V){case 0:B.length>3?(G.push(B[R]),G.push(B[R+1]),G.push(B[R+2])):G=B;break;case 1:if(G=G??new Array,t&&(e=B[R+1],s=B[R+2],Y=p(B[R],e),Q=p(B[R],s)),v){e=B[R],s=B[R+2],Y=p(B[R+1],e),Q=p(B[R+1],s),G.push(Y),G.push(s.clone()),G.push(e.clone()),G.push(s.clone()),G.push(Y.clone()),G.push(Q);break}D&&(e=B[R],s=B[R+1],Y=p(B[R+2],e),Q=p(B[R+2],s)),e&&s&&Y&&Q&&(G.push(e.clone()),G.push(s.clone()),G.push(Y),G.push(Q),G.push(Y.clone()),G.push(s.clone()));break;case 2:G=G??new Array,t||(e=B[R].clone(),s=p(e,B[R+1]),Y=p(e,B[R+2]),G.push(e),G.push(s),G.push(Y)),v||(e=B[R+1].clone(),s=p(e,B[R+2]),Y=p(e,B[R]),G.push(e),G.push(s),G.push(Y)),D||(e=B[R+2].clone(),s=p(e,B[R]),Y=p(e,B[R+1]),G.push(e),G.push(s),G.push(Y))}}return G},n=u instanceof V.b?u:null,d=null===n||void 0===n?void 0:n._thinInstanceDataStorage.matrixData,A=(null===n||void 0===n?void 0:n.aR)||1,b=Z.TmpVectors.Matrix[0];b.Z(Z.Matrix.IdentityReadOnly);for(let V=0;V<A;++V){if(null!==n&&void 0!==n&&n.hasThinInstances&&d){const B=16*V;b.setRowFromFloats(0,d[B+0],d[B+1],d[B+2],d[B+3]),b.setRowFromFloats(1,d[B+4],d[B+5],d[B+6],d[B+7]),b.setRowFromFloats(2,d[B+8],d[B+9],d[B+10],d[B+11]),b.setRowFromFloats(3,d[B+12],d[B+13],d[B+14],d[B+15])}const B=Z.Matrix.RotationYawPitchRoll(M,o,z).multiply(Z.Matrix.Translation(J.x,J.y,J.z)),p=Z.Matrix.Invert(B),G=u.getWorldMatrix(),e=b.multiply(G).multiply(p),s=new Array(3);for(let u=0;u<q.length;u+=3){let B=s;if(B[0]=E(u,e),B[1]=E(u+1,e),B[2]=E(u+2,e),!(F.cullBackFaces&&-B[0].normal.z<=0&&-B[1].normal.z<=0&&-B[2].normal.z<=0)&&(B=H(B,P),B&&(B=H(B,c),B&&(B=H(B,h),B&&(B=H(B,i),B&&(B=H(B,r),B&&(B=H(B,K),B)))))))for(let u=0;u<B.length;u++){const Z=B[u];if(I.indices.push(mB),L?(Z.localPositionOverride?(I.gB[3*mB]=Z.localPositionOverride[0],I.gB[3*mB+1]=Z.localPositionOverride[1],I.gB[3*mB+2]=Z.localPositionOverride[2]):f&&(I.gB[3*mB]=f[Z.vertexIdx],I.gB[3*mB+1]=f[Z.vertexIdx+1],I.gB[3*mB+2]=f[Z.vertexIdx+2]),Z.localNormalOverride?(I.JB[3*mB]=Z.localNormalOverride[0],I.JB[3*mB+1]=Z.localNormalOverride[1],I.JB[3*mB+2]=Z.localNormalOverride[2]):C&&(I.JB[3*mB]=C[Z.vertexIdx],I.JB[3*mB+1]=C[Z.vertexIdx+1],I.JB[3*mB+2]=C[Z.vertexIdx+2])):(Z.position.toArray(I.gB,3*mB),Z.normal.toArray(I.JB,3*mB)),I.matricesIndices&&I.matricesWeights&&(Z.matrixIndicesOverride?(I.matricesIndices[4*mB]=Z.matrixIndicesOverride[0],I.matricesIndices[4*mB+1]=Z.matrixIndicesOverride[1],I.matricesIndices[4*mB+2]=Z.matrixIndicesOverride[2],I.matricesIndices[4*mB+3]=Z.matrixIndicesOverride[3]):(U&&(I.matricesIndices[4*mB]=U[Z.vertexIdxForBones],I.matricesIndices[4*mB+1]=U[Z.vertexIdxForBones+1],I.matricesIndices[4*mB+2]=U[Z.vertexIdxForBones+2],I.matricesIndices[4*mB+3]=U[Z.vertexIdxForBones+3]),O&&I.matricesIndicesExtra&&(I.matricesIndicesExtra[4*mB]=O[Z.vertexIdxForBones],I.matricesIndicesExtra[4*mB+1]=O[Z.vertexIdxForBones+1],I.matricesIndicesExtra[4*mB+2]=O[Z.vertexIdxForBones+2],I.matricesIndicesExtra[4*mB+3]=O[Z.vertexIdxForBones+3])),Z.matrixWeightsOverride?(I.matricesWeights[4*mB]=Z.matrixWeightsOverride[0],I.matricesWeights[4*mB+1]=Z.matrixWeightsOverride[1],I.matricesWeights[4*mB+2]=Z.matrixWeightsOverride[2],I.matricesWeights[4*mB+3]=Z.matrixWeightsOverride[3]):(y&&(I.matricesWeights[4*mB]=y[Z.vertexIdxForBones],I.matricesWeights[4*mB+1]=y[Z.vertexIdxForBones+1],I.matricesWeights[4*mB+2]=y[Z.vertexIdxForBones+2],I.matricesWeights[4*mB+3]=y[Z.vertexIdxForBones+3]),g&&I.matricesWeightsExtra&&(I.matricesWeightsExtra[4*mB]=g[Z.vertexIdxForBones],I.matricesWeightsExtra[4*mB+1]=g[Z.vertexIdxForBones+1],I.matricesWeightsExtra[4*mB+2]=g[Z.vertexIdxForBones+2],I.matricesWeightsExtra[4*mB+3]=g[Z.vertexIdxForBones+3]))),F.captureUVS)Z.uv.toArray(I.TB,2*mB);else{I.TB.push(.5+Z.position.x/T.x);const B=.5+Z.position.y/T.y;I.TB.push(R.b?1-B:B)}mB++}}}0===I.indices.length&&(I.indices=null),0===I.gB.length&&(I.gB=null),0===I.JB.length&&(I.JB=null),0===I.TB.length&&(I.TB=null),0===(null===(s=I.matricesIndices)||void 0===s?void 0:s.length)&&(I.matricesIndices=null),0===(null===(Y=I.matricesWeights)||void 0===Y?void 0:Y.length)&&(I.matricesWeights=null),0===(null===(Q=I.matricesIndicesExtra)||void 0===Q?void 0:Q.length)&&(I.matricesIndicesExtra=null),0===(null===(t=I.matricesWeightsExtra)||void 0===t?void 0:t.length)&&(I.matricesWeightsExtra=null);const k=new V.b(B,u.yB());return I.MB(k),L?(k.skeleton=u.skeleton,k.parent=u):(k.position=J.clone(),k.rotation=new Z.Du(o,M,z)),k.XR(!0),k.refreshBoundingInfo(!0,!0),k}function b(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const u=0|Math.max(B.subdivisions?B.subdivisions:2,1),F=0|Math.max(B.tessellation?B.tessellation:16,3),V=Math.max(B.height?B.height:1,0),p=Math.max(B.radius?B.radius:.25,0),e=0|Math.max(B.capSubdivisions?B.capSubdivisions:6,1),s=F,Y=u,Q=Math.max(B.radiusTop?B.radiusTop:p,0),t=Math.max(B.radiusBottom?B.radiusBottom:p,0),v=V-(Q+t),D=2*Math.PI,L=Math.max(B.topCapSubdivisions?B.topCapSubdivisions:e,1),q=Math.max(B.bottomCapSubdivisions?B.bottomCapSubdivisions:e,1),W=Math.acos((t-Q)/V);let X=[];const f=[],C=[],x=[];let U=0;const y=[],O=.5*v,g=.5*Math.PI;let J,a;const T=Z.Du.Zero(),z=Z.Du.Zero(),M=Math.cos(W),j=Math.sin(W),o=new Z.Vector2(Q*j,O+Q*M).Lu(new Z.Vector2(t*j,t*M-O)).length(),I=Q*W+o+t*(g-W);let mB=0;for(a=0;a<=L;a++){const B=[],u=g-W*(a/L);mB+=Q*W/L;const F=Math.cos(u),Z=Math.sin(u),V=F*Q;for(J=0;J<=s;J++){const u=J/s,p=u*D+0,G=Math.sin(p),e=Math.cos(p);z.x=V*G,z.y=O+Z*Q,z.z=V*e,f.push(z.x,z.y,z.z),T.set(F*G,Z,F*e),C.push(T.x,T.y,T.z),x.push(u,R.b?mB/I:1-mB/I),B.push(U),U++}y.push(B)}const E=V-Q-t+M*Q-M*t,w=j*(t-Q)/E;for(a=1;a<=Y;a++){const B=[];mB+=o/Y;const u=j*(a*(t-Q)/Y+Q);for(J=0;J<=s;J++){const F=J/s,Z=F*D+0,V=Math.sin(Z),p=Math.cos(Z);z.x=u*V,z.y=O+M*Q-a*E/Y,z.z=u*p,f.push(z.x,z.y,z.z),T.set(V,w,p).normalize(),C.push(T.x,T.y,T.z),x.push(F,R.b?mB/I:1-mB/I),B.push(U),U++}y.push(B)}for(a=1;a<=q;a++){const B=[],u=g-W-(Math.PI-W)*(a/q);mB+=t*W/q;const F=Math.cos(u),Z=Math.sin(u),V=F*t;for(J=0;J<=s;J++){const u=J/s,p=u*D+0,G=Math.sin(p),e=Math.cos(p);z.x=V*G,z.y=Z*t-O,z.z=V*e,f.push(z.x,z.y,z.z),T.set(F*G,Z,F*e),C.push(T.x,T.y,T.z),x.push(u,R.b?mB/I:1-mB/I),B.push(U),U++}y.push(B)}for(J=0;J<s;J++)for(a=0;a<L+Y+q;a++){const B=y[a][J],u=y[a+1][J],F=y[a+1][J+1],Z=y[a][J+1];X.push(B),X.push(u),X.push(Z),X.push(u),X.push(F),X.push(Z)}if(X=X.reverse(),B.orientation&&!B.orientation.equals(Z.Du.Up())){const u=new Z.Matrix;B.orientation.clone().scale(.5*Math.PI).cross(Z.Du.Up()).toQuaternion().toRotationMatrix(u);const F=Z.Du.Zero();for(let B=0;B<f.length;B+=3)F.set(f[B],f[B+1],f[B+2]),Z.Du.TransformCoordinatesToRef(F.clone(),u,F),f[B]=F.x,f[B+1]=F.y,f[B+2]=F.z}const H=new G.c;return H.gB=f,H.JB=C,H.TB=x,H.indices=X,H}function k(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:Z.Du.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new V.b(B,F);return b(u).MB(p,u.updatable),p}V.b.CreateDecal=(B,u,F,Z,V,p)=>A(B,u,{position:F,normal:Z,size:V,angle:p});V.b.CreateCapsule=(B,u,F)=>k(B,u,F),G.c.CreateCapsule=b;var S=F(12822),BB=F(12982);class uB{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=B,this.y=u,B!==Math.floor(B)&&(B=Math.floor(B),S.d.Warn("x is not an integer, floor(x) used")),u!==Math.floor(u)&&(u=Math.floor(u),S.d.Warn("y is not an integer, floor(y) used"))}clone(){return new uB(this.x,this.y)}rotate60About(B){const u=this.x;return this.x=B.x+B.y-this.y,this.y=u+this.y-B.x,this}rotateNeg60About(B){const u=this.x;return this.x=u+this.y-B.y,this.y=B.x+B.y-u,this}rotate120(B,u){B!==Math.floor(B)&&(B=Math.floor(B),S.d.Warn("m not an integer only floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),S.d.Warn("n not an integer only floor(n) used"));const F=this.x;return this.x=B-F-this.y,this.y=u+F,this}rotateNeg120(B,u){B!==Math.floor(B)&&(B=Math.floor(B),S.d.Warn("m is not an integer, floor(m) used")),u!==Math.floor(u)&&(u=Math.floor(u),S.d.Warn("n is not an integer,   floor(n) used"));const F=this.x;return this.x=this.y-u,this.y=B+u-F-this.y,this}toCartesianOrigin(B,u){const F=Z.Du.Zero();return F.x=B.x+2*this.x*u+this.y*u,F.y=B.y+Math.sqrt(3)*this.y*u,F}static Zero(){return new uB(0,0)}}class FB{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ZB("icosahedron","Regular",[[0,BB.f,-1],[-BB.f,1,0],[-1,0,-BB.f],[1,0,-BB.f],[BB.f,1,0],[0,BB.f,1],[-1,0,BB.f],[-BB.f,-1,0],[0,-BB.f,-1],[BB.f,-1,0],[1,0,BB.f],[0,-BB.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let B=12;const u={},F=this.m,Z=this.n;let V,p,G,R,e,s=F,Y=1,Q=0;0!==Z&&(s=(0,l.HighestCommonFactor)(F,Z)),Y=F/s,Q=Z/s;const t=uB.Zero(),v=new uB(F,Z),D=new uB(-Z,F+Z),L=uB.Zero(),q=uB.Zero(),W=uB.Zero();let X,f,C,x,U=[];const y=[],O=this.vertByDist,g=(F,Z,V,p)=>{X=F+"|"+V,f=Z+"|"+p,X in u||f in u?X in u&&!(f in u)?u[f]=u[X]:f in u&&!(X in u)&&(u[X]=u[f]):(u[X]=B,u[f]=B,B++),O[V][0]>2?y[u[X]]=[-O[V][0],O[V][1],u[X]]:y[u[X]]=[U[O[V][0]],O[V][1],u[X]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let J=0;J<20;J++){if(U=this.IDATA.face[J],G=U[2],R=U[1],e=U[0],C=t.x+"|"+t.y,X=J+"|"+C,X in u||(u[X]=G,y[G]=[U[O[C][0]],O[C][1]]),C=v.x+"|"+v.y,X=J+"|"+C,X in u||(u[X]=R,y[R]=[U[O[C][0]],O[C][1]]),C=D.x+"|"+D.y,X=J+"|"+C,X in u||(u[X]=e,y[e]=[U[O[C][0]],O[C][1]]),V=this.IDATA.edgematch[J][0],p=this.IDATA.edgematch[J][1],"B"===p)for(let B=1;B<s;B++)q.x=F-B*(Y+Q),q.y=Z+B*Y,W.x=-B*Q,W.y=B*(Y+Q),C=q.x+"|"+q.y,x=W.x+"|"+W.y,g(J,V,C,x);if("O"===p)for(let B=1;B<s;B++)W.x=-B*Q,W.y=B*(Y+Q),L.x=B*Y,L.y=B*Q,C=W.x+"|"+W.y,x=L.x+"|"+L.y,g(J,V,C,x);if(V=this.IDATA.edgematch[J][2],p=this.IDATA.edgematch[J][3],p&&"A"===p)for(let B=1;B<s;B++)L.x=B*Y,L.y=B*Q,q.x=F-(s-B)*(Y+Q),q.y=Z+(s-B)*Y,C=L.x+"|"+L.y,x=q.x+"|"+q.y,g(J,V,C,x);for(let F=0;F<this.vertices.length;F++)C=this.vertices[F].x+"|"+this.vertices[F].y,X=J+"|"+C,X in u||(u[X]=B++,O[C][0]>2?y[u[X]]=[-O[C][0],O[C][1],u[X]]:y[u[X]]=[U[O[C][0]],O[C][1],u[X]])}this.closestTo=y,this.vecToidx=u}calcCoeffs(){const B=this.m,u=this.n,F=Math.sqrt(3)/3,Z=B*B+u*u+B*u;this.coau=(B+u)/Z,this.cobu=-u/Z,this.coav=-F*(B-u)/Z,this.cobv=F*(2*B+u)/Z}createInnerFacets(){const B=this.m,u=this.n;for(let F=0;F<u+B+1;F++)for(let B=this.min[F];B<this.max[F]+1;B++)B<this.max[F]&&B<this.max[F+1]+1&&this.innerFacets.push(["|"+B+"|"+F,"|"+B+"|"+(F+1),"|"+(B+1)+"|"+F]),F>0&&B<this.max[F-1]&&B+1<this.max[F]+1&&this.innerFacets.push(["|"+B+"|"+F,"|"+(B+1)+"|"+F,"|"+(B+1)+"|"+(F-1)])}edgeVecsABOB(){const B=this.m,u=this.n,F=new uB(-u,B+u);for(let Z=1;Z<B+u;Z++){const B=new uB(this.min[Z],Z),u=new uB(this.min[Z-1],Z-1),V=new uB(this.min[Z+1],Z+1),p=B.clone(),G=u.clone(),R=V.clone();p.rotate60About(F),G.rotate60About(F),R.rotate60About(F);const e=new uB(this.max[p.y],p.y),s=new uB(this.max[p.y-1],p.y-1),Y=new uB(this.max[p.y-1]-1,p.y-1);p.x===e.x&&p.y===e.y||(p.x!==s.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,s,Y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,Y,e])):p.y===R.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([B,u,s]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([B,s,V])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([B,u,s]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([B,s,e])))}}mapABOBtoOBOA(){const B=new uB(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const F=[];for(let Z=0;Z<3;Z++)B.x=this.isoVecsABOB[u][Z].x,B.y=this.isoVecsABOB[u][Z].y,0===this.vertexTypes[u][Z]&&B.rotateNeg120(this.m,this.n),F.push(B.clone());this.isoVecsOBOA.push(F)}}mapABOBtoBAOA(){const B=new uB(0,0);for(let u=0;u<this.isoVecsABOB.length;u++){const F=[];for(let Z=0;Z<3;Z++)B.x=this.isoVecsABOB[u][Z].x,B.y=this.isoVecsABOB[u][Z].y,1===this.vertexTypes[u][Z]&&B.rotate120(this.m,this.n),F.push(B.clone());this.isoVecsBAOA.push(F)}}MapToFace(B,u){const F=this.IDATA.face[B],V=F[2],p=F[1],G=F[0],R=Z.Du.fu(this.IDATA.vertex[V]),e=Z.Du.fu(this.IDATA.vertex[p]),s=Z.Du.fu(this.IDATA.vertex[G]),Y=e.Lu(R),Q=s.Lu(R),t=Y.scale(this.coau).add(Q.scale(this.cobu)),v=Y.scale(this.coav).add(Q.scale(this.cobv)),D=[];let L,q=Z.TmpVectors.Du[0];for(let Z=0;Z<this.cartesian.length;Z++)q=t.scale(this.cartesian[Z].x).add(v.scale(this.cartesian[Z].y)).add(R),D[Z]=[q.x,q.y,q.z],L=B+"|"+this.vertices[Z].x+"|"+this.vertices[Z].y,u.vertex[this.vecToidx[L]]=[q.x,q.y,q.z]}build(B,u){const F=[],Z=uB.Zero(),V=new uB(B,u),p=new uB(-u,B+u);F.push(Z,V,p);for(let C=u;C<B+1;C++)for(let u=0;u<B+1-C;u++)F.push(new uB(u,C));if(u>0){const Z=(0,l.HighestCommonFactor)(B,u),V=B/Z,p=u/Z;for(let R=1;R<Z;R++)F.push(new uB(R*V,R*p)),F.push(new uB(-R*p,R*(V+p))),F.push(new uB(B-R*(V+p),u+R*V));const G=B/u;for(let R=1;R<u;R++)for(let Z=0;Z<R*G;Z++)F.push(new uB(Z,R)),F.push(new uB(Z,R).rotate120(B,u)),F.push(new uB(Z,R).rotateNeg120(B,u))}F.sort(((B,u)=>B.x-u.x)),F.sort(((B,u)=>B.y-u.y));const G=new Array(B+u+1),R=new Array(B+u+1);for(let C=0;C<G.length;C++)G[C]=1/0,R[C]=-1/0;let e=0,s=0;const Y=F.length;for(let C=0;C<Y;C++)s=F[C].x,e=F[C].y,G[e]=Math.min(s,G[e]),R[e]=Math.max(s,R[e]);const Q=(F,Z)=>{const V=F.clone();return"A"===Z&&V.rotateNeg120(B,u),"B"===Z&&V.rotate120(B,u),V.x<0?V.y:V.x+V.y},t=[],v=[],D=[],L=[],q={},W=[];let X=-1,f=-1;for(let C=0;C<Y;C++)t[C]=F[C].toCartesianOrigin(new uB(0,0),.5),v[C]=Q(F[C],"O"),D[C]=Q(F[C],"A"),L[C]=Q(F[C],"B"),v[C]===D[C]&&D[C]===L[C]?(X=3,f=v[C]):v[C]===D[C]?(X=4,f=v[C]):D[C]===L[C]?(X=5,f=D[C]):L[C]===v[C]&&(X=6,f=v[C]),v[C]<D[C]&&v[C]<L[C]&&(X=2,f=v[C]),D[C]<v[C]&&D[C]<L[C]&&(X=1,f=D[C]),L[C]<D[C]&&L[C]<v[C]&&(X=0,f=L[C]),W.push([X,f,F[C].x,F[C].y]);W.sort(((B,u)=>B[2]-u[2])),W.sort(((B,u)=>B[3]-u[3])),W.sort(((B,u)=>B[1]-u[1])),W.sort(((B,u)=>B[0]-u[0]));for(let C=0;C<W.length;C++)q[W[C][2]+"|"+W[C][3]]=[W[C][0],W[C][1],C];return this.m=B,this.n=u,this.vertices=F,this.vertByDist=q,this.cartesian=t,this.min=G,this.max=R,this}}class ZB{constructor(B,u,F,Z){this.name=B,this.category=u,this.vertex=F,this.face=Z}}class VB extends ZB{innerToData(B,u){for(let F=0;F<u.innerFacets.length;F++)this.face.push(u.innerFacets[F].map((F=>u.vecToidx[B+F])))}mapABOBtoDATA(B,u){const F=u.IDATA.edgematch[B][0];for(let Z=0;Z<u.isoVecsABOB.length;Z++){const V=[];for(let p=0;p<3;p++)0===u.vertexTypes[Z][p]?V.push(B+"|"+u.isoVecsABOB[Z][p].x+"|"+u.isoVecsABOB[Z][p].y):V.push(F+"|"+u.isoVecsABOB[Z][p].x+"|"+u.isoVecsABOB[Z][p].y);this.face.push([u.vecToidx[V[0]],u.vecToidx[V[1]],u.vecToidx[V[2]]])}}mapOBOAtoDATA(B,u){const F=u.IDATA.edgematch[B][0];for(let Z=0;Z<u.isoVecsOBOA.length;Z++){const V=[];for(let p=0;p<3;p++)1===u.vertexTypes[Z][p]?V.push(B+"|"+u.isoVecsOBOA[Z][p].x+"|"+u.isoVecsOBOA[Z][p].y):V.push(F+"|"+u.isoVecsOBOA[Z][p].x+"|"+u.isoVecsOBOA[Z][p].y);this.face.push([u.vecToidx[V[0]],u.vecToidx[V[1]],u.vecToidx[V[2]]])}}mapBAOAtoDATA(B,u){const F=u.IDATA.edgematch[B][2];for(let Z=0;Z<u.isoVecsBAOA.length;Z++){const V=[];for(let p=0;p<3;p++)1===u.vertexTypes[Z][p]?V.push(B+"|"+u.isoVecsBAOA[Z][p].x+"|"+u.isoVecsBAOA[Z][p].y):V.push(F+"|"+u.isoVecsBAOA[Z][p].x+"|"+u.isoVecsBAOA[Z][p].y);this.face.push([u.vecToidx[V[0]],u.vecToidx[V[1]],u.vecToidx[V[2]]])}}orderData(B){const u=[];for(let p=0;p<13;p++)u[p]=[];const F=B.closestTo;for(let p=0;p<F.length;p++)F[p][0]>-1?F[p][1]>0&&u[F[p][0]].push([p,F[p][1]]):u[12].push([p,F[p][0]]);const Z=[];for(let p=0;p<12;p++)Z[p]=p;let V=12;for(let p=0;p<12;p++){u[p].sort(((B,u)=>B[1]-u[1]));for(let B=0;B<u[p].length;B++)Z[u[p][B][0]]=V++}for(let p=0;p<u[12].length;p++)Z[u[12][p][0]]=V++;for(let p=0;p<this.vertex.length;p++)this.vertex[p].push(Z[p]);this.vertex.sort(((B,u)=>B[3]-u[3]));for(let p=0;p<this.vertex.length;p++)this.vertex[p].pop();for(let p=0;p<this.face.length;p++)for(let B=0;B<this.face[p].length;B++)this.face[p][B]=Z[this.face[p][B]];this.sharedNodes=u[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(B,u){const F=[],Z=[];let V=u.pop();Z.push(V);let p=this.face[V].indexOf(B);p=(p+2)%3;let G=this.face[V][p];F.push(G);let R=0;for(;u.length>0;)V=u[R],this.face[V].indexOf(G)>-1?(p=(this.face[V].indexOf(G)+1)%3,G=this.face[V][p],F.push(G),Z.push(V),u.splice(R,1),R=0):R++;return this.adjacentFaces.push(F),Z}toGoldbergPolyhedronData(){const B=new ZB("GeoDual","Goldberg",[],[]);B.name="GD dual";const u=this.vertex.length,F=new Array(u);for(let e=0;e<u;e++)F[e]=[];for(let e=0;e<this.face.length;e++)for(let B=0;B<3;B++)F[this.face[e][B]].push(e);let Z=0,V=0,p=0,G=[],R=[];this.adjacentFaces=[];for(let e=0;e<F.length;e++){B.face[e]=this.setOrder(e,F[e].concat([]));for(const u of F[e]){Z=0,V=0,p=0,G=this.face[u];for(let B=0;B<3;B++)R=this.vertex[G[B]],Z+=R[0],V+=R[1],p+=R[2];B.vertex[u]=[Z/3,V/3,p/3]}}return B}static BuildGeodesicData(B){const u=new VB("Geodesic-m-n","Geodesic",[[0,BB.f,-1],[-BB.f,1,0],[-1,0,-BB.f],[1,0,-BB.f],[BB.f,1,0],[0,BB.f,1],[-1,0,BB.f],[-BB.f,-1,0],[0,-BB.f,-1],[BB.f,-1,0],[1,0,BB.f],[0,-BB.f,1]],[]);B.setIndices(),B.calcCoeffs(),B.createInnerFacets(),B.edgeVecsABOB(),B.mapABOBtoOBOA(),B.mapABOBtoBAOA();for(let F=0;F<B.IDATA.face.length;F++)B.MapToFace(F,u),u.innerToData(F,B),"B"===B.IDATA.edgematch[F][1]&&u.mapABOBtoDATA(F,B),"O"===B.IDATA.edgematch[F][1]&&u.mapOBOAtoDATA(F,B),"A"===B.IDATA.edgematch[F][3]&&u.mapBAOAtoDATA(F,B);u.orderData(B);return u.vertex=u.vertex.map((function(B){const u=B[0],F=B[1],Z=B[2],V=Math.sqrt(u*u+F*F+Z*Z);return B[0]*=1/V,B[1]*=1/V,B[2]*=1/V,B})),u}}V.b._GoldbergMeshParser=(B,u)=>pB.Parse(B,u);class pB extends V.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(B,u){return void 0===u?(B>this.goldbergData.nbUnsharedFaces-1&&(S.d.Warn("Maximum number of unshared faces used"),B=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+B):(B>11&&(S.d.Warn("Last pole used"),B=11),u>this.goldbergData.nbFacesAtPole-1&&(S.d.Warn("Maximum number of faces at a pole used"),u=this.goldbergData.nbFacesAtPole-1),12+B*this.goldbergData.nbFacesAtPole+u)}_changeGoldbergFaceColors(B){for(let F=0;F<B.length;F++){const u=B[F][0],Z=B[F][1],V=B[F][2];for(let B=u;B<Z+1;B++)this.goldbergData.faceColors[B]=V}const u=[];for(let F=0;F<12;F++)for(let B=0;B<5;B++)u.push(this.goldbergData.faceColors[F].r,this.goldbergData.faceColors[F].g,this.goldbergData.faceColors[F].b,this.goldbergData.faceColors[F].a);for(let F=12;F<this.goldbergData.faceColors.length;F++)for(let B=0;B<6;B++)u.push(this.goldbergData.faceColors[F].r,this.goldbergData.faceColors[F].g,this.goldbergData.faceColors[F].b,this.goldbergData.faceColors[F].a);return u}setGoldbergFaceColors(B){const u=this._changeGoldbergFaceColors(B);this.mu(p.f.ColorKind,u)}updateGoldbergFaceColors(B){const u=this._changeGoldbergFaceColors(B);this.updateVerticesData(p.f.ColorKind,u)}_changeGoldbergFaceUVs(B){const u=this.getVerticesData(p.f.UVKind);for(let F=0;F<B.length;F++){const Z=B[F][0],V=B[F][1],p=B[F][2],G=B[F][3],R=B[F][4],e=[],s=[];let Y,Q;for(let B=0;B<5;B++)Y=p.x+G*Math.cos(R+B*Math.PI/2.5),Q=p.y+G*Math.sin(R+B*Math.PI/2.5),Y<0&&(Y=0),Y>1&&(Y=1),e.push(Y,Q);for(let B=0;B<6;B++)Y=p.x+G*Math.cos(R+B*Math.PI/3),Q=p.y+G*Math.sin(R+B*Math.PI/3),Y<0&&(Y=0),Y>1&&(Y=1),s.push(Y,Q);for(let B=Z;B<Math.min(12,V+1);B++)for(let F=0;F<5;F++)u[10*B+2*F]=e[2*F],u[10*B+2*F+1]=e[2*F+1];for(let B=Math.max(12,Z);B<V+1;B++)for(let F=0;F<6;F++)u[12*B-24+2*F]=s[2*F],u[12*B-23+2*F]=s[2*F+1]}return u}setGoldbergFaceUVs(B){const u=this._changeGoldbergFaceUVs(B);this.mu(p.f.UVKind,u)}updateGoldbergFaceUVs(B){const u=this._changeGoldbergFaceUVs(B);this.updateVerticesData(p.f.UVKind,u)}placeOnGoldbergFaceAt(B,u,F){const V=Z.Du.RotationFromAxis(this.goldbergData.faceXaxis[u],this.goldbergData.faceYaxis[u],this.goldbergData.faceZaxis[u]);B.rotation=V,B.position=this.goldbergData.faceCenters[u].add(this.goldbergData.faceXaxis[u].scale(F.x)).add(this.goldbergData.faceYaxis[u].scale(F.y)).add(this.goldbergData.faceZaxis[u].scale(F.z))}serialize(B){super.serialize(B),B.type="GoldbergMesh";const u={};if(u.adjacentFaces=this.goldbergData.adjacentFaces,u.nbSharedFaces=this.goldbergData.nbSharedFaces,u.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,u.nbFaces=this.goldbergData.nbFaces,u.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){u.faceColors=[];for(const B of this.goldbergData.faceColors)u.faceColors.push(B.DR())}if(this.goldbergData.faceCenters){u.faceCenters=[];for(const B of this.goldbergData.faceCenters)u.faceCenters.push(B.DR())}if(this.goldbergData.faceZaxis){u.faceZaxis=[];for(const B of this.goldbergData.faceZaxis)u.faceZaxis.push(B.DR())}if(this.goldbergData.faceYaxis){u.faceYaxis=[];for(const B of this.goldbergData.faceYaxis)u.faceYaxis.push(B.DR())}if(this.goldbergData.faceXaxis){u.faceXaxis=[];for(const B of this.goldbergData.faceXaxis)u.faceXaxis.push(B.DR())}B.goldbergData=u}static Parse(B,u){const F=B.goldbergData;F.faceColors=F.faceColors.map((B=>t.gR.fu(B))),F.faceCenters=F.faceCenters.map((B=>Z.Du.fu(B))),F.faceZaxis=F.faceZaxis.map((B=>Z.Du.fu(B))),F.faceXaxis=F.faceXaxis.map((B=>Z.Du.fu(B))),F.faceYaxis=F.faceYaxis.map((B=>Z.Du.fu(B)));const V=new pB(B.name,u);return V.goldbergData=F,V}}var GB=F(13522);const RB={CreateBox:Q.c,CreateTiledBox:q,CreateSphere:W.c,CreateDisc:Y.b,CreateIcoSphere:d,CreateRibbon:s,CreateCylinder:x,CreateTorus:y,CreateTorusKnot:g,CreateLineSystem:J.f,ls:J.j,CreateDashedLines:J.d,ExtrudeShape:z,ExtrudeShapeCustom:M,CreateLathe:o,CreateTiledPlane:D,hs:I.b,CreateGround:mB.e,CreateTiledGround:mB.f,CreateGroundFromHeightMap:mB.b,CreatePolygon:a.d,ExtrudePolygon:a.g,CreateTube:E,CreatePolyhedron:H,CreateGeodesic:function(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=u.m||1;Z!==Math.floor(Z)&&(Z=Math.floor(Z),S.d.Warn("m not an integer only floor(m) used"));let V=u.n||0;if(V!==Math.floor(V)&&(V=Math.floor(V),S.d.Warn("n not an integer only floor(n) used")),V>Z){const B=V;V=Z,Z=B,S.d.Warn("n > m therefore m and n swapped")}const p=new FB;return p.build(Z,V),H(B,{custom:VB.BuildGeodesicData(p),size:u.size,sizeX:u.sizeX,sizeY:u.sizeY,sizeZ:u.sizeZ,faceUV:u.faceUV,faceColors:u.faceColors,flat:u.flat,updatable:u.updatable,sideOrientation:u.sideOrientation,frontUVs:u.frontUVs,backUVs:u.backUVs},F)},CreateGoldberg:function(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=u.size,e=u.sizeX||p||1,s=u.sizeY||p||1,Y=u.sizeZ||p||1;let Q=u.m||1;Q!==Math.floor(Q)&&(Q=Math.floor(Q),S.d.Warn("m not an integer only floor(m) used"));let v=u.n||0;if(v!==Math.floor(v)&&(v=Math.floor(v),S.d.Warn("n not an integer only floor(n) used")),v>Q){const B=v;v=Q,Q=B,S.d.Warn("n > m therefore m and n swapped")}const D=new FB;D.build(Q,v);const L=VB.BuildGeodesicData(D),q=L.toGoldbergPolyhedronData(),W=new pB(B,F);u.sideOrientation=V.b._GetDefaultSideOrientation(u.sideOrientation),W._originalBuilderSideOrientation=u.sideOrientation;(function(B,u){const F=B.size,V=B.sizeX||F||1,p=B.sizeY||F||1,e=B.sizeZ||F||1,s=0===B.sideOrientation?0:B.sideOrientation||G.c.DEFAULTSIDE,Y=[],Q=[],t=[],v=[];let D=1/0,L=-1/0,q=1/0,W=-1/0;for(let Z=0;Z<u.vertex.length;Z++)D=Math.min(D,u.vertex[Z][0]*V),L=Math.max(L,u.vertex[Z][0]*V),q=Math.min(q,u.vertex[Z][1]*p),W=Math.max(W,u.vertex[Z][1]*p);let X=0;for(let G=0;G<u.face.length;G++){const B=u.face[G],F=Z.Du.fu(u.vertex[B[0]]),s=Z.Du.fu(u.vertex[B[2]]),f=Z.Du.fu(u.vertex[B[1]]),C=s.Lu(F),x=f.Lu(F),U=Z.Du.Cross(x,C).normalize();for(let Z=0;Z<B.length;Z++){t.push(U.x,U.y,U.z);const F=u.vertex[B[Z]];Y.push(F[0]*V,F[1]*p,F[2]*e);const G=(F[1]*p-q)/(W-q);v.push((F[0]*V-D)/(L-D),R.b?1-G:G)}for(let u=0;u<B.length-2;u++)Q.push(X,X+u+2,X+u+1);X+=B.length}G.c._ComputeSides(s,Y,Q,t,v);const f=new G.c;return f.gB=Y,f.indices=Q,f.JB=t,f.TB=v,f})(u,q).MB(W,u.updatable),W.goldbergData.nbSharedFaces=L.sharedNodes,W.goldbergData.nbUnsharedFaces=L.poleNodes,W.goldbergData.adjacentFaces=L.adjacentFaces,W.goldbergData.nbFaces=W.goldbergData.nbSharedFaces+W.goldbergData.nbUnsharedFaces,W.goldbergData.nbFacesAtPole=(W.goldbergData.nbUnsharedFaces-12)/12;for(let V=0;V<L.vertex.length;V++)W.goldbergData.faceCenters.push(Z.Du.fu(L.vertex[V])),W.goldbergData.faceCenters[V].x*=e,W.goldbergData.faceCenters[V].y*=s,W.goldbergData.faceCenters[V].z*=Y,W.goldbergData.faceColors.push(new t.gR(1,1,1,1));for(let V=0;V<q.face.length;V++){const B=q.face[V],u=Z.Du.fu(q.vertex[B[0]]),F=Z.Du.fu(q.vertex[B[2]]),p=Z.Du.fu(q.vertex[B[1]]),G=F.Lu(u),R=p.Lu(u),e=Z.Du.Cross(R,G).normalize(),s=Z.Du.Cross(R,e).normalize();W.goldbergData.faceXaxis.push(R.normalize()),W.goldbergData.faceYaxis.push(e),W.goldbergData.faceZaxis.push(s)}return W},CreateDecal:A,CreateCapsule:k,CreateText:GB.g}},14254:(B,u,F)=>{"use strict";F.d(u,{d:()=>Ru});var Z=F(12979),V=F(13364);class p extends V.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var G=F(13023),R=(F(13145),F(12949));class e{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(B){this._targetStopDuration!==B&&(this._targetStopDuration=B)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(B){this._noiseTexture!==B&&(this._noiseTexture=B,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(B){this._animationSheetEnabled!==B&&(this._animationSheetEnabled=B)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(B){this._isAnimationSheetEnabled!=B&&(this._isAnimationSheetEnabled=B,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(B){this._useLogarithmicDepth=B&&this.yB().getEngine().getCaps().fragmentDepthSupported}yB(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(B){switch(B){case e.BLENDMODE_MULTIPLYADD:return;case e.BLENDMODE_ADD:B=1;break;case e.BLENDMODE_ONEONE:B=6;break;case e.BLENDMODE_STANDARD:B=2;break;case e.BLENDMODE_MULTIPLY:B=4;break;case e.BLENDMODE_SUBTRACT:B=3}this._engine.setAlphaMode(B)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:Z.Du.Zero()}set direction1(B){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=B)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:Z.Du.Zero()}set direction2(B){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=B)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:Z.Du.Zero()}set minEmitBox(B){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=B)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:Z.Du.Zero()}set maxEmitBox(B){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=B)}get billboardMode(){return this._billboardMode}set billboardMode(B){this._billboardMode!==B&&(this._billboardMode=B,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(B){this._isBillboardBased!==B&&(this._isBillboardBased=B,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(B){this._attachImageProcessingConfiguration(B)}_attachImageProcessingConfiguration(B){B!==this._imageProcessingConfiguration&&(!B&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=B)}_reset(){}_removeGradientAndTexture(B,u,F){if(!u)return this;let Z=0;for(const V of u){if(V.gradient===B){u.splice(Z,1);break}Z++}return F&&F.dispose(),this}constructor(B){this.animations=[],this.renderingGroupId=0,this.Zu=Z.Du.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new Z.Du(10,10,10),this.onAnimationEnd=null,this.blendMode=e.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new Z.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Hs=new Z.Du(0,0,0),this._useLogarithmicDepth=!1,this.gravity=Z.Du.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new G.gR(1,1,1,1),this.color2=new G.gR(1,1,1,1),this.colorDead=new G.gR(0,0,0,1),this.textureMask=new G.gR(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new p,this.id=B,this.name=B}createPointEmitter(B,u){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new Z.Du(0,1,0),arguments.length>2&&void 0!==arguments[2]||new Z.Du(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new Z.Du(0,1,0),arguments.length>4&&void 0!==arguments[4]||new Z.Du(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new Z.Du(0,1,0),arguments.length>3&&void 0!==arguments[3]||new Z.Du(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(B,u,F,Z){throw new Error("Method not implemented.")}}e.BLENDMODE_ONEONE=0,e.BLENDMODE_STANDARD=1,e.BLENDMODE_ADD=2,e.BLENDMODE_MULTIPLY=3,e.BLENDMODE_MULTIPLYADD=4,e.BLENDMODE_SUBTRACT=-1,(0,R.f)("BABYLON.BaseParticleSystem",e);var s=F(12994),Y=F(12830);class Q{constructor(){this.direction1=new Z.Du(0,1,0),this.direction2=new Z.Du(0,1,0),this.minEmitBox=new Z.Du(-.5,-.5,-.5),this.maxEmitBox=new Z.Du(.5,.5,.5)}startDirectionFunction(B,u,F,V){const p=(0,s.RandomRange)(this.direction1.x,this.direction2.x),G=(0,s.RandomRange)(this.direction1.y,this.direction2.y),R=(0,s.RandomRange)(this.direction1.z,this.direction2.z);if(V)return u.x=p,u.y=G,void(u.z=R);Z.Du.TransformNormalFromFloatsToRef(p,G,R,B,u)}startPositionFunction(B,u,F,V){const p=(0,s.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),G=(0,s.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),R=(0,s.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(V)return u.x=p,u.y=G,void(u.z=R);Z.Du.TransformCoordinatesFromFloatsToRef(p,G,R,B,u)}clone(){const B=new Q;return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2),B.setVector3("minEmitBox",this.minEmitBox),B.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3),B.addUniform("minEmitBox",3),B.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.direction1=this.direction1.DR(),B.direction2=this.direction2.DR(),B.minEmitBox=this.minEmitBox.DR(),B.maxEmitBox=this.maxEmitBox.DR(),B}parse(B){Z.Du.FromArrayToRef(B.direction1,0,this.direction1),Z.Du.FromArrayToRef(B.direction2,0,this.direction2),Z.Du.FromArrayToRef(B.minEmitBox,0,this.minEmitBox),Z.Du.FromArrayToRef(B.maxEmitBox,0,this.maxEmitBox)}}class t{get radius(){return this._radius}set radius(B){this._radius=B,this._buildHeight()}get angle(){return this._angle}set angle(B){this._angle=B,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=F,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=u,this.radius=B}startDirectionFunction(B,u,F,V){V?Z.TmpVectors.Du[0].Z(F.NR).normalize():F.position.subtractToRef(B.getTranslation(),Z.TmpVectors.Du[0]).normalize();const p=(0,s.RandomRange)(0,this.directionRandomizer),G=(0,s.RandomRange)(0,this.directionRandomizer),R=(0,s.RandomRange)(0,this.directionRandomizer);u.x=Z.TmpVectors.Du[0].x+p,u.y=Z.TmpVectors.Du[0].y+G,u.z=Z.TmpVectors.Du[0].z+R,u.normalize()}startPositionFunction(B,u,F,V){const p=(0,s.RandomRange)(0,2*Math.PI);let G;this.emitFromSpawnPointOnly?G=1e-4:(G=(0,s.RandomRange)(0,this.heightRange),G=1-G*G);let R=this._radius-(0,s.RandomRange)(0,this._radius*this.radiusRange);R*=G;const e=R*Math.sin(p),Y=R*Math.cos(p),Q=G*this._height;if(V)return u.x=e,u.y=Q,void(u.z=Y);Z.Du.TransformCoordinatesFromFloatsToRef(e,Q,Y,B,u)}clone(){const B=new t(this._radius,this._angle,this.directionRandomizer);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setFloat2("radius",this._radius,this.radiusRange),B.setFloat("coneAngle",this._angle),B.setFloat2("height",this._height,this.heightRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",2),B.addUniform("coneAngle",1),B.addUniform("height",2),B.addUniform("directionRandomizer",1)}getEffectDefines(){let B="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(B+="\n#define CONEEMITTERSPAWNPOINT"),B}getClassName(){return"ConeParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this._radius,B.angle=this._angle,B.directionRandomizer=this.directionRandomizer,B.radiusRange=this.radiusRange,B.heightRange=this.heightRange,B.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,B}parse(B){this.radius=B.radius,this.angle=B.angle,this.directionRandomizer=B.directionRandomizer,this.radiusRange=void 0!==B.radiusRange?B.radiusRange:1,this.heightRange=void 0!==B.radiusRange?B.heightRange:1,this.emitFromSpawnPointOnly=void 0!==B.emitFromSpawnPointOnly&&B.emitFromSpawnPointOnly}}class v extends t{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0),V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0);super(B,u),this.direction1=F,this.direction2=V}startDirectionFunction(B,u){const F=(0,s.RandomRange)(this.direction1.x,this.direction2.x),V=(0,s.RandomRange)(this.direction1.y,this.direction2.y),p=(0,s.RandomRange)(this.direction1.z,this.direction2.z);Z.Du.TransformNormalFromFloatsToRef(F,V,p,B,u)}clone(){const B=new v(this.radius,this.angle,this.direction1,this.direction2);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.DR(),B.direction2=this.direction2.DR(),B}parse(B){super.parse(B),this.direction1.Z(B.direction1),this.direction2.Z(B.direction2)}}class D{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=B,this.height=u,this.radiusRange=F,this.directionRandomizer=V,this._tempVector=Z.Du.Zero()}startDirectionFunction(B,u,F,V,p){F.position.subtractToRef(B.getTranslation(),this._tempVector),this._tempVector.normalize(),Z.Du.TransformNormalToRef(this._tempVector,p,this._tempVector);const G=(0,s.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let R=Math.atan2(this._tempVector.x,this._tempVector.z);R+=(0,s.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=G,this._tempVector.x=Math.sin(R),this._tempVector.z=Math.cos(R),this._tempVector.normalize(),V?u.Z(this._tempVector):Z.Du.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,B,u)}startPositionFunction(B,u,F,V){const p=(0,s.RandomRange)(-this.height/2,this.height/2),G=(0,s.RandomRange)(0,2*Math.PI),R=(0,s.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),e=Math.sqrt(R)*this.radius,Y=e*Math.cos(G),Q=e*Math.sin(G);V?u.UR(Y,p,Q):Z.Du.TransformCoordinatesFromFloatsToRef(Y,p,Q,B,u)}clone(){const B=new D(this.radius,this.directionRandomizer);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("height",this.height),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("height",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.height=this.height,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.height=B.height,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class L extends D{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0),p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.Du(0,1,0);super(B,u,F),this.direction1=V,this.direction2=p}startDirectionFunction(B,u,F,V){const p=(0,s.RandomRange)(this.direction1.x,this.direction2.x),G=(0,s.RandomRange)(this.direction1.y,this.direction2.y),R=(0,s.RandomRange)(this.direction1.z,this.direction2.z);V?u.UR(p,G,R):Z.Du.TransformNormalFromFloatsToRef(p,G,R,B,u)}clone(){const B=new L(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("height",this.height),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("height",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.DR(),B.direction2=this.direction2.DR(),B}parse(B){super.parse(B),Z.Du.FromArrayToRef(B.direction1,0,this.direction1),Z.Du.FromArrayToRef(B.direction2,0,this.direction2)}}class q{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=B,this.radiusRange=u,this.directionRandomizer=F}startDirectionFunction(B,u,F,V){const p=F.position.Lu(B.getTranslation()).normalize(),G=(0,s.RandomRange)(0,this.directionRandomizer),R=(0,s.RandomRange)(0,this.directionRandomizer),e=(0,s.RandomRange)(0,this.directionRandomizer);p.x+=G,p.y+=R,p.z+=e,p.normalize(),V?u.Z(p):Z.Du.TransformNormalFromFloatsToRef(p.x,p.y,p.z,B,u)}startPositionFunction(B,u,F,V){const p=this.radius-(0,s.RandomRange)(0,this.radius*this.radiusRange),G=(0,s.RandomRange)(0,1),R=(0,s.RandomRange)(0,2*Math.PI),e=Math.acos(2*G-1),Y=p*Math.cos(R)*Math.sin(e),Q=p*Math.cos(e),t=p*Math.sin(R)*Math.sin(e);V?u.UR(Y,Math.abs(Q),t):Z.Du.TransformCoordinatesFromFloatsToRef(Y,Math.abs(Q),t,B,u)}clone(){const B=new q(this.radius,this.directionRandomizer);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class W{constructor(){this.direction1=new Z.Du(0,1,0),this.direction2=new Z.Du(0,1,0)}startDirectionFunction(B,u,F,V){const p=(0,s.RandomRange)(this.direction1.x,this.direction2.x),G=(0,s.RandomRange)(this.direction1.y,this.direction2.y),R=(0,s.RandomRange)(this.direction1.z,this.direction2.z);V?u.UR(p,G,R):Z.Du.TransformNormalFromFloatsToRef(p,G,R,B,u)}startPositionFunction(B,u,F,V){V?u.UR(0,0,0):Z.Du.TransformCoordinatesFromFloatsToRef(0,0,0,B,u)}clone(){const B=new W;return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.direction1=this.direction1.DR(),B.direction2=this.direction2.DR(),B}parse(B){Z.Du.FromArrayToRef(B.direction1,0,this.direction1),Z.Du.FromArrayToRef(B.direction2,0,this.direction2)}}class X{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=B,this.radiusRange=u,this.directionRandomizer=F}startDirectionFunction(B,u,F,V){const p=F.position.Lu(B.getTranslation()).normalize(),G=(0,s.RandomRange)(0,this.directionRandomizer),R=(0,s.RandomRange)(0,this.directionRandomizer),e=(0,s.RandomRange)(0,this.directionRandomizer);p.x+=G,p.y+=R,p.z+=e,p.normalize(),V?u.Z(p):Z.Du.TransformNormalFromFloatsToRef(p.x,p.y,p.z,B,u)}startPositionFunction(B,u,F,V){const p=this.radius-(0,s.RandomRange)(0,this.radius*this.radiusRange),G=(0,s.RandomRange)(0,1),R=(0,s.RandomRange)(0,2*Math.PI),e=Math.acos(2*G-1),Y=p*Math.cos(R)*Math.sin(e),Q=p*Math.cos(e),t=p*Math.sin(R)*Math.sin(e);V?u.UR(Y,Q,t):Z.Du.TransformCoordinatesFromFloatsToRef(Y,Q,t,B,u)}clone(){const B=new X(this.radius,this.directionRandomizer);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.radius=this.radius,B.radiusRange=this.radiusRange,B.directionRandomizer=this.directionRandomizer,B}parse(B){this.radius=B.radius,this.radiusRange=B.radiusRange,this.directionRandomizer=B.directionRandomizer}}class f extends X{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.Du(0,1,0),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0);super(B),this.direction1=u,this.direction2=F}startDirectionFunction(B,u){const F=(0,s.RandomRange)(this.direction1.x,this.direction2.x),V=(0,s.RandomRange)(this.direction1.y,this.direction2.y),p=(0,s.RandomRange)(this.direction1.z,this.direction2.z);Z.Du.TransformNormalFromFloatsToRef(F,V,p,B,u)}clone(){const B=new f(this.radius,this.direction1,this.direction2);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setFloat("radius",this.radius),B.setFloat("radiusRange",this.radiusRange),B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("radius",1),B.addUniform("radiusRange",1),B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const B=super.serialize();return B.direction1=this.direction1.DR(),B.direction2=this.direction2.DR(),B}parse(B){super.parse(B),this.direction1.Z(B.direction1),this.direction2.Z(B.direction2)}}class C{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(B,u,F,V){const p=Z.TmpVectors.Du[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,F,p);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,F,p);const B=Z.TmpVectors.Du[1];p.subtractToRef(F.position,B),B.scaleToRef(1/F.lifeTime,p)}else p.set(0,0,0);V?u.Z(p):Z.Du.TransformNormalToRef(p,B,u)}startPositionFunction(B,u,F,V){const p=Z.TmpVectors.Du[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,F,p):p.set(0,0,0),V?u.Z(p):Z.Du.TransformCoordinatesToRef(p,B,u)}clone(){const B=new C;return Y.c.DeepCopy(this,B),B}applyToShader(B){}buildUniformLayout(B){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const B={};return B.type=this.getClassName(),B.particlePositionGenerator=this.particlePositionGenerator,B.particleDestinationGenerator=this.particleDestinationGenerator,B}parse(B){B.particlePositionGenerator&&(this.particlePositionGenerator=B.particlePositionGenerator),B.particleDestinationGenerator&&(this.particleDestinationGenerator=B.particleDestinationGenerator)}}var x=F(13047);class U{get mesh(){return this._mesh}set mesh(B){this._mesh!==B&&(this._mesh=B,B?(this._indices=B.CR(),this._positions=B.getVerticesData(x.f.PositionKind),this._normals=B.getVerticesData(x.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=Z.Du.Zero(),this._mesh=null,this.direction1=new Z.Du(0,1,0),this.direction2=new Z.Du(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=B}startDirectionFunction(B,u,F,V){if(this.useMeshNormalsForDirection&&this._normals)return void Z.Du.TransformNormalToRef(this._storedNormal,B,u);const p=(0,s.RandomRange)(this.direction1.x,this.direction2.x),G=(0,s.RandomRange)(this.direction1.y,this.direction2.y),R=(0,s.RandomRange)(this.direction1.z,this.direction2.z);V?u.UR(p,G,R):Z.Du.TransformNormalFromFloatsToRef(p,G,R,B,u)}startPositionFunction(B,u,F,V){if(!this._indices||!this._positions)return;const p=3*(Math.random()*(this._indices.length/3)|0),G=Math.random(),R=Math.random()*(1-G),e=1-G-R,s=this._indices[p],Y=this._indices[p+1],Q=this._indices[p+2],t=Z.TmpVectors.Du[0],v=Z.TmpVectors.Du[1],D=Z.TmpVectors.Du[2],L=Z.TmpVectors.Du[3];Z.Du.FromArrayToRef(this._positions,3*s,t),Z.Du.FromArrayToRef(this._positions,3*Y,v),Z.Du.FromArrayToRef(this._positions,3*Q,D),L.x=G*t.x+R*v.x+e*D.x,L.y=G*t.y+R*v.y+e*D.y,L.z=G*t.z+R*v.z+e*D.z,V?u.UR(L.x,L.y,L.z):Z.Du.TransformCoordinatesFromFloatsToRef(L.x,L.y,L.z,B,u),this.useMeshNormalsForDirection&&this._normals&&(Z.Du.FromArrayToRef(this._normals,3*s,t),Z.Du.FromArrayToRef(this._normals,3*Y,v),Z.Du.FromArrayToRef(this._normals,3*Q,D),this._storedNormal.x=G*t.x+R*v.x+e*D.x,this._storedNormal.y=G*t.y+R*v.y+e*D.y,this._storedNormal.z=G*t.z+R*v.z+e*D.z)}clone(){const B=new U(this.mesh);return Y.c.DeepCopy(this,B),B}applyToShader(B){B.setVector3("direction1",this.direction1),B.setVector3("direction2",this.direction2)}buildUniformLayout(B){B.addUniform("direction1",3),B.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var B;const u={};return u.type=this.getClassName(),u.direction1=this.direction1.DR(),u.direction2=this.direction2.DR(),u.meshId=null===(B=this.mesh)||void 0===B?void 0:B.id,u.useMeshNormalsForDirection=this.useMeshNormalsForDirection,u}parse(B,u){Z.Du.FromArrayToRef(B.direction1,0,this.direction1),Z.Du.FromArrayToRef(B.direction2,0,this.direction2),B.meshId&&u&&(this.mesh=u.getLastMeshById(B.meshId)),this.useMeshNormalsForDirection=B.useMeshNormalsForDirection}}class y{_isUbo(B){return void 0!==B.addUniform}constructor(B){this._isUbo(B)?(this.setMatrix3x3=B.updateMatrix3x3.bind(B),this.setMatrix2x2=B.updateMatrix2x2.bind(B),this.setFloat=B.updateFloat.bind(B),this.setFloat2=B.updateFloat2.bind(B),this.setFloat3=B.updateFloat3.bind(B),this.setFloat4=B.updateFloat4.bind(B),this.setFloatArray=B.updateFloatArray.bind(B),this.setArray=B.updateArray.bind(B),this.setIntArray=B.updateIntArray.bind(B),this.setMatrix=B.WR.bind(B),this.setMatrices=B.updateMatrices.bind(B),this.setVector3=B.updateVector3.bind(B),this.setVector4=B.updateVector4.bind(B),this.setColor3=B.updateColor3.bind(B),this.setColor4=B.updateColor4.bind(B),this.setDirectColor4=B.updateDirectColor4.bind(B),this.setInt=B.updateInt.bind(B),this.setInt2=B.updateInt2.bind(B),this.setInt3=B.updateInt3.bind(B),this.setInt4=B.updateInt4.bind(B)):(this.setMatrix3x3=B.setMatrix3x3.bind(B),this.setMatrix2x2=B.setMatrix2x2.bind(B),this.setFloat=B.setFloat.bind(B),this.setFloat2=B.setFloat2.bind(B),this.setFloat3=B.setFloat3.bind(B),this.setFloat4=B.setFloat4.bind(B),this.setFloatArray=B.setFloatArray.bind(B),this.setArray=B.setArray.bind(B),this.setIntArray=B.setIntArray.bind(B),this.setMatrix=B.setMatrix.bind(B),this.setMatrices=B.setMatrices.bind(B),this.setVector3=B.setVector3.bind(B),this.setVector4=B.setVector4.bind(B),this.setColor3=B.setColor3.bind(B),this.setColor4=B.setColor4.bind(B),this.setDirectColor4=B.setDirectColor4.bind(B),this.setInt=B.setInt.bind(B),this.setInt2=B.setInt2.bind(B),this.setInt3=B.setInt3.bind(B),this.setInt4=B.setInt4.bind(B))}}var O=F(12897);const g="gpuUpdateParticlesPixelShader",J="#version 300 es\nvoid main() {discard;}\n";O.c.ShadersStore[g]||(O.c.ShadersStore[g]=J);const a="gpuUpdateParticlesVertexShader",T="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";O.c.ShadersStore[a]||(O.c.ShadersStore[a]=T);(0,R.f)("BABYLON.WebGL2ParticleSystem",class{constructor(B,u){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=B,this._engine=u,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var B;return(null===(B=this._updateEffect)||void 0===B?void 0:B.isReady())??!1}createUpdateBuffer(B){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof C&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=B,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new y(this._updateEffect)}createVertexBuffers(B,u){this._updateVAO.push(this._createUpdateVAO(B)),this._renderVAO.push(this._engine.recordVertexArrayObject(u,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=u}createParticleBuffer(B){return B}bindDrawBuffers(B,u,F){F?this._engine.bindBuffers(this._renderVertexBuffers,F,u):this._engine.bindVertexArrayObject(this._renderVAO[B],null)}preUpdateParticleBuffer(){const B=this._engine;if(this._engine.enableEffect(this._updateEffect),!B.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(B,u,F){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[B],null);const Z=this._engine;Z.bindTransformFeedbackBuffer(u.getBuffer()),Z.setRasterizerState(!1),Z.beginTransformFeedback(!0),Z.drawArraysType(3,0,F),Z.endTransformFeedback(),Z.setRasterizerState(!0),Z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let B=0;B<this._updateVAO.length;B++)this._engine.releaseVertexArrayObject(this._updateVAO[B]);this._updateVAO.length=0;for(let B=0;B<this._renderVAO.length;B++)this._engine.releaseVertexArrayObject(this._renderVAO[B]);this._renderVAO.length=0}_createUpdateVAO(B){const u={};u.position=B.createVertexBuffer("position",0,3);let F=3;u.age=B.createVertexBuffer("age",F,1),F+=1,u.size=B.createVertexBuffer("size",F,3),F+=3,u.life=B.createVertexBuffer("life",F,1),F+=1,u.seed=B.createVertexBuffer("seed",F,4),F+=4,u.direction=B.createVertexBuffer("direction",F,3),F+=3,this._parent.particleEmitterType instanceof C&&(u.initialPosition=B.createVertexBuffer("initialPosition",F,3),F+=3),this._parent._colorGradientsTexture||(u.color=B.createVertexBuffer("color",F,4),F+=4),this._parent._isBillboardBased||(u.initialDirection=B.createVertexBuffer("initialDirection",F,3),F+=3),this._parent.noiseTexture&&(u.noiseCoordinates1=B.createVertexBuffer("noiseCoordinates1",F,3),F+=3,u.noiseCoordinates2=B.createVertexBuffer("noiseCoordinates2",F,3),F+=3),this._parent._angularSpeedGradientsTexture?(u.angle=B.createVertexBuffer("angle",F,1),F+=1):(u.angle=B.createVertexBuffer("angle",F,2),F+=2),this._parent._isAnimationSheetEnabled&&(u.cellIndex=B.createVertexBuffer("cellIndex",F,1),F+=1,this._parent.spriteRandomStartCell&&(u.cellStartOffset=B.createVertexBuffer("cellStartOffset",F,1),F+=1));const Z=this._engine.recordVertexArrayObject(u,null,this._updateEffect);return this._engine.bindArrayBuffer(null),Z}});class z{constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Z=arguments.length>3?arguments[3]:void 0;this._engine=B,this._label=Z,this._engine._storageBuffers.push(this),this._create(u,F)}_create(B,u){this._bufferSize=B,this._creationFlags=u,this._buffer=this._engine.createStorageBuffer(B,u,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(B,u,F){this._buffer&&this._engine.updateStorageBuffer(this._buffer,B,u,F)}async read(B,u,F,Z){return await this._engine.readFromStorageBuffer(this._buffer,B,u,F,Z)}dispose(){const B=this._engine._storageBuffers,u=B.indexOf(this);-1!==u&&(B[u]=B[B.length-1],B.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var M=F(12971),j=F(12973),o=F(13014),I=F(12969),mB=F(13277),E=F(12822),w=F(12932),H=F(13202);class n{constructor(){this._gpuTimeInFrameId=-1,this.counter=new H.b}_addDuration(B,u){B<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==B?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(u,!1),this._gpuTimeInFrameId=B):this.counter.addCount(u,!1))}}var d=F(12882);class l{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=B,this._engine=u,this.uniqueId=mB.c.UniqueId,u.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new n),this._engine.getCaps().supportComputeShaders?Z.bindingsMapping?(this._context=u.createComputeContext(),this._shaderPath=F,this._options={bindingsMapping:{},defines:[],...Z}):E.d.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):E.d.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(B,u){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Z=this._bindings[B];this._bindings[B]={type:F?0:4,object:u,indexInGroupEntries:null===Z||void 0===Z?void 0:Z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!Z||Z.object!==u||Z.type!==this._bindings[B].type)}setStorageTexture(B,u){const F=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==u),this._bindings[B]={type:1,object:u,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setExternalTexture(B,u){const F=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==u),this._bindings[B]={type:6,object:u,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setVideoTexture(B,u){return!!u.externalTexture&&(this.setExternalTexture(B,u.externalTexture),!0)}setUniformBuffer(B,u){const F=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==u),this._bindings[B]={type:l._BufferIsDataBuffer(u)?7:2,object:u,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setStorageBuffer(B,u){const F=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!F||F.object!==u),this._bindings[B]={type:l._BufferIsDataBuffer(u)?7:3,object:u,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}setTextureSampler(B,u){const F=this._bindings[B];this._contextIsDirty||(this._contextIsDirty=!F||!u.compareSampler(F.object)),this._bindings[B]={type:5,object:u,indexInGroupEntries:null===F||void 0===F?void 0:F.indexInGroupEntries}}isReady(){let B=this._effect;for(const V in this._bindings){const B=this._bindings[V],u=B.type,F=B.object;switch(u){case 0:case 4:case 1:if(!F.isReady())return!1;break;case 6:if(!F.isReady())return!1;break}}const u=[],F=this._shaderPath;if(this._options.defines)for(let V=0;V<this._options.defines.length;V++)u.push(this._options.defines[V]);const Z=u.join("\n");return this._cachedDefines!==Z&&(this._cachedDefines=Z,B=this._engine.createComputeEffect(F,{defines:Z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=B),!!B.isReady()}dispatch(B,u,F){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,B,u,F,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const F=l._BufferIsDataBuffer(B)?B:B.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,F,u,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const u in this._bindings){const F=this._bindings[u];if(!this._options.bindingsMapping[u])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+u+"'");switch(F.type){case 0:{const Z=this._samplers[u],V=F.object;var B;if(!Z||!V._texture||!Z.compareSampler(V._texture))this._samplers[u]=(new w.c).setParameters(V.wrapU,V.wrapV,V.wrapR,V.anisotropicFilteringLevel,V._texture.samplingMode,null===(B=V._texture)||void 0===B?void 0:B._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const B=F.object;B.getBuffer()!==F.buffer&&(F.buffer=B.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((V=>{(0,d.d)((()=>this.dispatch(B,u,F)),V,void 0,Z)}))}serialize(){const B=o.c.Serialize(this);B.options=this._options,B.shaderPath=this._shaderPath,B.zt={},B.textures={};for(const u in this._bindings){const F=this._bindings[u],Z=F.object;switch(F.type){case 0:case 4:case 1:{const V=Z.serialize();V&&(B.textures[u]=V,B.zt[u]={type:F.type});break}}}return B}static Parse(B,u,F){const Z=o.c.Parse((()=>new l(B.name,u.getEngine(),B.shaderPath,B.options)),B,u,F);for(const V in B.textures){const p=B.zt[V],G=I.d.Parse(B.textures[V],u,F);0===p.type?Z.setTexture(V,G):4===p.type?Z.setTexture(V,G,!1):Z.setStorageTexture(V,G)}return Z}static _BufferIsDataBuffer(B){return void 0!==B.underlyingResource}}(0,M.d)([(0,j.L)()],l.prototype,"name",void 0),(0,M.d)([(0,j.L)()],l.prototype,"fastMode",void 0),(0,R.f)("BABYLON.ComputeShader",l);var P=F(13243);const c="gpuUpdateParticlesComputeShader",h="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";O.c.ShadersStoreWGSL[c]||(O.c.ShadersStoreWGSL[c]=h);(0,R.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(B,u){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=B,this._engine=u}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var B;return(null===(B=this._updateComputeShader)||void 0===B?void 0:B.isReady())??!1}createUpdateBuffer(B){var u;const F={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(F.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(F.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(F.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(F.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(F.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(F.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(F.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new l("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:F,defines:B.split("\n")}),null===(u=this._simParamsComputeShader)||void 0===u||u.dispose(),this._simParamsComputeShader=new P.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new y(this._simParamsComputeShader)}createVertexBuffers(B,u){this._renderVertexBuffers.push(u)}createParticleBuffer(B){const u=new z(this._engine,4*B.length,11,"ComputeShaderParticleSystemBuffer");return u.update(B),this._bufferComputeShader.push(u),u.getBuffer()}bindDrawBuffers(B,u,F){this._engine.bindBuffers(this._renderVertexBuffers[B],F,u)}preUpdateParticleBuffer(){}updateParticleBuffer(B,u,F){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[B]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^B]),this._updateComputeShader.dispatch(Math.ceil(F/64))}releaseBuffers(){var B;for(let u=0;u<this._bufferComputeShader.length;++u)this._bufferComputeShader[u].dispose();this._bufferComputeShader.length=0,null===(B=this._simParamsComputeShader)||void 0===B||B.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class i{constructor(B,u,F){this.gradient=B,this.color1=u,this.color2=F}getColorToRef(B){this.color2?G.gR.LerpToRef(this.color1,this.color2,Math.random(),B):B.Z(this.color1)}}class r{constructor(B,u){this.gradient=B,this.color=u}}class K{constructor(B,u,F){this.gradient=B,this.factor1=u,this.factor2=F}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class N{static GetCurrentGradient(B,u,F){if(u[0].gradient>B)return void F(u[0],u[0],1);for(let V=0;V<u.length-1;V++){const Z=u[V],p=u[V+1];if(B>=Z.gradient&&B<=p.gradient){return void F(Z,p,(B-Z.gradient)/(p.gradient-Z.gradient))}}const Z=u.length-1;F(u[Z],u[Z],1)}}var A=F(12807),b=F(13438),k=F(12855);class S{constructor(B){this.particleSystem=B,this.position=Z.Du.Zero(),this.direction=Z.Du.Zero(),this.color=new G.gR(0,0,0,0),this.colorStep=new G.gR(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new Z.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new G.gR(0,0,0,0),this._currentColor2=new G.gR(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=S._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let B=this.age,u=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===u?(u=1,B=this._randomCellOffset):B+=this._randomCellOffset);const F=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let Z;Z=this._initialSpriteCellLoop?(0,s.Clamp)(B*u%this.lifeTime/this.lifeTime):(0,s.Clamp)(B*u/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+Z*F|0}_inheritParticleInfoToSubEmitter(B){if(B.particleSystem.Zu.position){const u=B.particleSystem.Zu;if(u.position.Z(this.position),B.inheritDirection){const B=Z.TmpVectors.Du[0];this.direction.normalizeToRef(B),u.setDirection(B,0,Math.PI/2)}}else{B.particleSystem.Zu.Z(this.position)}this.direction.scaleToRef(B.inheritedVelocityAmount/2,Z.TmpVectors.Du[0]),B.particleSystem._inheritedVelocityOffset.Z(Z.TmpVectors.Du[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const B of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(B)}_reset(){this.age=0,this.id=S._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(B){B.position.Z(this.position),this._initialDirection?B._initialDirection?B._initialDirection.Z(this._initialDirection):B._initialDirection=this._initialDirection.clone():B._initialDirection=null,B.direction.Z(this.direction),this.NR&&(B.NR?B.NR.Z(this.NR):B.NR=this.NR.clone()),B.color.Z(this.color),B.colorStep.Z(this.colorStep),B.lifeTime=this.lifeTime,B.age=this.age,B._randomCellOffset=this._randomCellOffset,B.size=this.size,B.scale.Z(this.scale),B.angle=this.angle,B.angularSpeed=this.angularSpeed,B.particleSystem=this.particleSystem,B.cellIndex=this.cellIndex,B.id=this.id,B._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(B._currentColorGradient=this._currentColorGradient,B._currentColor1.Z(this._currentColor1),B._currentColor2.Z(this._currentColor2)),this._currentSizeGradient&&(B._currentSizeGradient=this._currentSizeGradient,B._currentSize1=this._currentSize1,B._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(B._currentAngularSpeedGradient=this._currentAngularSpeedGradient,B._currentAngularSpeed1=this._currentAngularSpeed1,B._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(B._currentVelocityGradient=this._currentVelocityGradient,B._currentVelocity1=this._currentVelocity1,B._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(B._currentLimitVelocityGradient=this._currentLimitVelocityGradient,B._currentLimitVelocity1=this._currentLimitVelocity1,B._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(B._currentDragGradient=this._currentDragGradient,B._currentDrag1=this._currentDrag1,B._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(B._initialStartSpriteCellId=this._initialStartSpriteCellId,B._initialEndSpriteCellId=this._initialEndSpriteCellId,B._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(B.remapData&&this.remapData?B.remapData.Z(this.remapData):B.remapData=new Z.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(B._randomNoiseCoordinates1?(B._randomNoiseCoordinates1.Z(this._randomNoiseCoordinates1),B._randomNoiseCoordinates2.Z(this._randomNoiseCoordinates2)):(B._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),B._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}S._Count=0;var BB=F(13094),uB=(F(13143),F(13352)),FB=F(13349),ZB=F(13238);function VB(B,u){const F=(0,s.RandomRange)(0,1);G.gR.LerpToRef(u.color1,u.color2,F,B.color),u.colorDead.subtractToRef(B.color,u._colorDiff),u._colorDiff.scaleToRef(1/B.lifeTime,B.colorStep)}function pB(B,u){B._currentColorGradient=u._colorGradients[0],B._currentColorGradient.getColorToRef(B.color),B._currentColor1.Z(B.color),u._colorGradients.length>1?u._colorGradients[1].getColorToRef(B._currentColor2):B._currentColor2.Z(B.color)}function GB(B,u){const F=u._colorGradients;N.GetCurrentGradient(u._ratio,F,((u,F,Z)=>{u!==B._currentColorGradient&&(B._currentColor1.Z(B._currentColor2),F.getColorToRef(B._currentColor2),B._currentColorGradient=u),G.gR.LerpToRef(B._currentColor1,B._currentColor2,Z,B.color)}))}function RB(B,u){B.colorStep.scaleToRef(u._scaledUpdateSpeed,u._scaledColorStep),B.color.addInPlace(u._scaledColorStep),B.color.a<0&&(B.color.a=0)}function eB(B,u){N.GetCurrentGradient(u._ratio,u._angularSpeedGradients,((u,F,Z)=>{u!==B._currentAngularSpeedGradient&&(B._currentAngularSpeed1=B._currentAngularSpeed2,B._currentAngularSpeed2=F.getFactor(),B._currentAngularSpeedGradient=u),B.angularSpeed=(0,s.Lerp)(B._currentAngularSpeed1,B._currentAngularSpeed2,Z)}))}function sB(B,u){B.angle+=B.angularSpeed*u._scaledUpdateSpeed}function YB(B,u){u.particleEmitterType.startDirectionFunction(u._emitterWorldMatrix,B.direction,B,u.isLocal,u._emitterInverseWorldMatrix)}function QB(B,u){u.startDirectionFunction(u._emitterWorldMatrix,B.direction,B,u.isLocal)}function tB(B,u){B._currentVelocityGradient=u._velocityGradients[0],B._currentVelocity1=B._currentVelocityGradient.getFactor(),u._velocityGradients.length>1?B._currentVelocity2=u._velocityGradients[1].getFactor():B._currentVelocity2=B._currentVelocity1}function vB(B,u){B._currentLimitVelocityGradient=u._limitVelocityGradients[0],B._currentLimitVelocity1=B._currentLimitVelocityGradient.getFactor(),u._limitVelocityGradients.length>1?B._currentLimitVelocity2=u._limitVelocityGradients[1].getFactor():B._currentLimitVelocity2=B._currentLimitVelocity1}function DB(B,u){N.GetCurrentGradient(u._ratio,u._velocityGradients,((F,Z,V)=>{F!==B._currentVelocityGradient&&(B._currentVelocity1=B._currentVelocity2,B._currentVelocity2=Z.getFactor(),B._currentVelocityGradient=F),u._directionScale*=(0,s.Lerp)(B._currentVelocity1,B._currentVelocity2,V)}))}function LB(B,u){N.GetCurrentGradient(u._ratio,u._limitVelocityGradients,((F,Z,V)=>{F!==B._currentLimitVelocityGradient&&(B._currentLimitVelocity1=B._currentLimitVelocity2,B._currentLimitVelocity2=Z.getFactor(),B._currentLimitVelocityGradient=F);const p=(0,s.Lerp)(B._currentLimitVelocity1,B._currentLimitVelocity2,V);B.direction.length()>p&&B.direction.scaleInPlace(u.limitVelocityDamping)}))}function qB(B,u){B.direction.scaleToRef(u._directionScale,u._scaledDirection)}function WB(B,u){u.particleEmitterType.startPositionFunction(u._emitterWorldMatrix,B.position,B,u.isLocal)}function XB(B,u){u.startPositionFunction(u._emitterWorldMatrix,B.position,B,u.isLocal)}function fB(B,u){B.NR?B.NR.Z(B.position):B.NR=B.position.clone(),Z.Du.TransformCoordinatesToRef(B.NR,u._emitterWorldMatrix,B.position)}function CB(B,u){u.isLocal&&B.NR?(B.NR.addInPlace(u._scaledDirection),Z.Du.TransformCoordinatesToRef(B.NR,u._emitterWorldMatrix,B.position)):B.position.addInPlace(u._scaledDirection)}function xB(B,u){B._currentDragGradient=u._dragGradients[0],B._currentDrag1=B._currentDragGradient.getFactor(),u._dragGradients.length>1?B._currentDrag2=u._dragGradients[1].getFactor():B._currentDrag2=B._currentDrag1}function UB(B,u){N.GetCurrentGradient(u._ratio,u._dragGradients,((F,Z,V)=>{F!==B._currentDragGradient&&(B._currentDrag1=B._currentDrag2,B._currentDrag2=Z.getFactor(),B._currentDragGradient=F);const p=(0,s.Lerp)(B._currentDrag1,B._currentDrag2,V);u._scaledDirection.scaleInPlace(1-p)}))}function yB(B,u){B._randomNoiseCoordinates1?(B._randomNoiseCoordinates1.UR(Math.random(),Math.random(),Math.random()),B._randomNoiseCoordinates2.UR(Math.random(),Math.random(),Math.random())):(B._randomNoiseCoordinates1=new Z.Du(Math.random(),Math.random(),Math.random()),B._randomNoiseCoordinates2=new Z.Du(Math.random(),Math.random(),Math.random()))}function OB(B,u){const F=u._noiseTextureData,V=u._noiseTextureSize;if(F&&V&&B._randomNoiseCoordinates1){const p=u._fetchR(B._randomNoiseCoordinates1.x,B._randomNoiseCoordinates1.y,V.width,V.height,F),G=u._fetchR(B._randomNoiseCoordinates1.z,B._randomNoiseCoordinates2.x,V.width,V.height,F),R=u._fetchR(B._randomNoiseCoordinates2.y,B._randomNoiseCoordinates2.z,V.width,V.height,F),e=Z.TmpVectors.Du[0],s=Z.TmpVectors.Du[1];e.UR((2*p-1)*u.noiseStrength.x,(2*G-1)*u.noiseStrength.y,(2*R-1)*u.noiseStrength.z),e.scaleToRef(u._tempScaledUpdateSpeed,s),B.direction.addInPlace(s)}}function gB(B,u){u.gravity.scaleToRef(u._tempScaledUpdateSpeed,u._scaledGravity),B.direction.addInPlace(u._scaledGravity)}function JB(B,u){B.size=(0,s.RandomRange)(u.minSize,u.maxSize),B.scale.UR((0,s.RandomRange)(u.minScaleX,u.maxScaleX),(0,s.RandomRange)(u.minScaleY,u.maxScaleY))}function aB(B,u){B._currentSizeGradient=u._sizeGradients[0],B._currentSize1=B._currentSizeGradient.getFactor(),B.size=B._currentSize1,u._sizeGradients.length>1?B._currentSize2=u._sizeGradients[1].getFactor():B._currentSize2=B._currentSize1,B.scale.UR((0,s.RandomRange)(u.minScaleX,u.maxScaleX),(0,s.RandomRange)(u.minScaleY,u.maxScaleY))}function TB(B,u){const F=u._actualFrame/u.targetStopDuration;N.GetCurrentGradient(F,u._startSizeGradients,((F,Z,V)=>{F!==u._currentStartSizeGradient&&(u._currentStartSize1=u._currentStartSize2,u._currentStartSize2=Z.getFactor(),u._currentStartSizeGradient=F);const p=(0,s.Lerp)(u._currentStartSize1,u._currentStartSize2,V);B.scale.scaleInPlace(p)}))}function zB(B,u){N.GetCurrentGradient(u._ratio,u._sizeGradients,((u,F,Z)=>{u!==B._currentSizeGradient&&(B._currentSize1=B._currentSize2,B._currentSize2=F.getFactor(),B._currentSizeGradient=u),B.size=(0,s.Lerp)(B._currentSize1,B._currentSize2,Z)}))}function MB(B,u){B.remapData=new Z.Vector4(0,1,0,1)}function jB(B,u){u._colorRemapGradients&&u._colorRemapGradients.length>0&&N.GetCurrentGradient(u._ratio,u._colorRemapGradients,((u,F,Z)=>{const V=(0,s.Lerp)(u.factor1,F.factor1,Z),p=(0,s.Lerp)(u.factor2,F.factor2,Z);B.remapData.x=V,B.remapData.y=p-V})),u._alphaRemapGradients&&u._alphaRemapGradients.length>0&&N.GetCurrentGradient(u._ratio,u._alphaRemapGradients,((u,F,Z)=>{const V=(0,s.Lerp)(u.factor1,F.factor1,Z),p=(0,s.Lerp)(u.factor2,F.factor2,Z);B.remapData.z=V,B.remapData.w=p-V}))}function oB(B,u){const F=(0,s.Clamp)(u._actualFrame/u.targetStopDuration);N.GetCurrentGradient(F,u._lifeTimeGradients,((u,Z)=>{const V=u,p=Z,G=V.getFactor(),R=p.getFactor(),e=(F-V.gradient)/(p.gradient-V.gradient);B.lifeTime=(0,s.Lerp)(G,R,e)})),u._emitPower=(0,s.RandomRange)(u.minEmitPower,u.maxEmitPower)}function IB(B,u){B.lifeTime=(0,s.RandomRange)(u.minLifeTime,u.maxLifeTime),u._emitPower=(0,s.RandomRange)(u.minEmitPower,u.maxEmitPower)}function mu(B,u){0===u._emitPower?(B._initialDirection?B._initialDirection.Z(B.direction):B._initialDirection=B.direction.clone(),B.direction.set(0,0,0)):(B._initialDirection=null,B.direction.scaleInPlace(u._emitPower)),B.direction.addInPlace(u._inheritedVelocityOffset)}function EB(B,u){B.angularSpeed=(0,s.RandomRange)(u.minAngularSpeed,u.maxAngularSpeed),B.angle=(0,s.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function wB(B,u){B._currentAngularSpeedGradient=u._angularSpeedGradients[0],B.angularSpeed=B._currentAngularSpeedGradient.getFactor(),B._currentAngularSpeed1=B.angularSpeed,u._angularSpeedGradients.length>1?B._currentAngularSpeed2=u._angularSpeedGradients[1].getFactor():B._currentAngularSpeed2=B._currentAngularSpeed1,B.angle=(0,s.RandomRange)(u.minInitialRotation,u.maxInitialRotation)}function HB(B,u){B._initialStartSpriteCellId=u.startSpriteCellID,B._initialEndSpriteCellId=u.endSpriteCellID,B._initialSpriteCellLoop=u.spriteCellLoop}function nB(B,u){B.previousItem=u.previousItem,B.nextItem=u,u.previousItem&&(u.previousItem.nextItem=B),u.previousItem=B}function dB(B,u){B.previousItem=u,B.nextItem=u.nextItem,u.nextItem&&(u.nextItem.previousItem=B),u.nextItem=B}function lB(B,u){let F=u;for(;F.nextItem;)F=F.nextItem;B.previousItem=F,B.nextItem=F.nextItem,F.nextItem=B}function PB(B){B.previousItem&&(B.previousItem.nextItem=B.nextItem),B.nextItem&&(B.nextItem.previousItem=B.previousItem)}class cB extends e{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(B){this._startDirectionFunction!==B&&(this._startDirectionFunction=B,this._directionProcessing.process=B?QB:YB)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(B){this._startPositionFunction!==B&&(this._startPositionFunction=B,this._positionCreation.process=B?XB:WB)}set onDispose(B){this._onDisposeObserver&&this.GR.remove(this._onDisposeObserver),this._onDisposeObserver=this.GR.add(B)}get G(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(B){this._useRampGradients!==B&&(this._useRampGradients=B,this._resetEffect(),B?(this._rampCreation={process:MB,previousItem:null,nextItem:null},dB(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:jB,previousItem:null,nextItem:null},dB(this._remapGradientProcessing,this._gravityProcessing)):(PB(this._rampCreation),PB(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(B){this._isLocal!==B&&(this._isLocal=B,B?(this._isLocalCreation={process:fB,previousItem:null,nextItem:null},dB(this._isLocalCreation,this._positionCreation)):PB(this._isLocalCreation))}get particles(){return this.yt}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(B){this._animationSheetEnabled!==B&&(this._animationSheetEnabled=B,B?(this._sheetCreation={process:HB,previousItem:null,nextItem:null},dB(this._sheetCreation,this._colorCreation)):PB(this._sheetCreation),this._reset())}getActiveCount(){return this.yt.length}getClassName(){return"ue"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var B;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(B=this._customWrappers[u])||void 0===B?void 0:B.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[B]??this._customWrappers[0]}setCustomEffect(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new BB.b(this._engine),this._customWrappers[u].effect=B,this._customWrappers[u].drawContext&&(this._customWrappers[u].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new A.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(B){if(this.noiseTexture!==B){if(this._noiseTexture=B,!B)return PB(this._noiseCreation),void PB(this._noiseProcessing);this._noiseCreation={process:yB,previousItem:null,nextItem:null},dB(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:OB,previousItem:null,nextItem:null},dB(this._noiseProcessing,this._positionProcessing)}}constructor(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,e=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(B),this._emitterInverseWorldMatrix=Z.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new Z.Du,this.GR=new A.b,this.onStoppedObservable=new A.b,this.onStartedObservable=new A.b,this._noiseTextureSize=null,this._noiseTextureData=null,this.yt=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new G.gR(0,0,0,0),this._colorDiff=new G.gR(0,0,0,0),this._scaledDirection=Z.Du.Zero(),this._scaledGravity=Z.Du.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=B=>{},this.recycleParticle=B=>{const u=this.yt.pop();u!==B&&u.copyTo(B),this._stockParticles.push(u)},this._createParticle=()=>{let B;return 0!==this._stockParticles.length?(B=this._stockParticles.pop(),B._reset()):B=new S(this),this._prepareParticle(B),B},this.paused=!1,this._shadersLoaded=!1,this._capacity=u,this._epsilon=R,F&&"Scene"!==F.getClassName()?(this._engine=F,this.defaultProjectionMatrix=Z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=F||k.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xt.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:IB,previousItem:null,nextItem:null},this._positionCreation={process:WB,previousItem:null,nextItem:null},dB(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:YB,previousItem:null,nextItem:null},dB(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:mu,previousItem:null,nextItem:null},dB(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:JB,previousItem:null,nextItem:null},dB(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:EB,previousItem:null,nextItem:null},dB(this._angleCreation,this._sizeCreation),this._colorCreation={process:VB,previousItem:null,nextItem:null},dB(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,e||(this._colorProcessing={process:RB,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:sB,previousItem:null,nextItem:null},dB(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:qB,previousItem:null,nextItem:null},dB(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:CB,previousItem:null,nextItem:null},dB(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:gB,previousItem:null,nextItem:null},dB(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=p,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=V,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new Q,this.updateFunction=B=>{var u;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(u=this.noiseTexture.getContent())||void 0===u||u.then((B=>{this._noiseTextureData=B})));const F=B===this.yt;for(let Z=0;Z<B.length;Z++){const u=B[Z];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const V=u.age;if(u.age+=this._tempScaledUpdateSpeed,u.age>u.lifeTime){const B=u.age-V,F=u.lifeTime-V;this._tempScaledUpdateSpeed=F*this._tempScaledUpdateSpeed/B,u.age=u.lifeTime}this._ratio=u.age/u.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let p=this._updateQueueStart;for(;p;)p.process(u,this),p=p.nextItem;if(this._isAnimationSheetEnabled&&!e&&u.updateCellIndex(),u._inheritParticleInfoToSubEmitters(),u.age>=u.lifeTime){if(this._emitFromParticle(u),u._attachedSubEmitters){for(const B of u._attachedSubEmitters)B.particleSystem.disposeOnStop=!0,B.particleSystem.stop();u._attachedSubEmitters=null}this.recycleParticle(u),F&&Z--}else;}}}serialize(B){throw new Error("Method not implemented.")}clone(B,u){throw new Error("Method not implemented.")}_addFactorGradient(B,u,F,Z){const V=new K(u,F,Z);B.push(V),B.sort(((B,u)=>B.gradient<u.gradient?-1:B.gradient>u.gradient?1:0))}_removeFactorGradient(B,u){if(!B)return;let F=0;for(const Z of B){if(Z.gradient===u){B.splice(F,1);break}F++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=oB:this._lifeTimeCreation.process=IB}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:TB,previousItem:null,nextItem:null},dB(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(PB(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(B){this.targetStopDuration!==B&&(this._targetStopDuration=B,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(B,u,F){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,B,u,F),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(B){return this._removeFactorGradient(this._lifeTimeGradients,B),this._syncLifeTimeCreation(),this}addSizeGradient(B,u,F){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=aB,this._sizeGradientProcessing={process:zB,previousItem:null,nextItem:null},nB(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,B,u,F),this}removeSizeGradient(B){var u;return this._removeFactorGradient(this._sizeGradients,B),0===(null===(u=this._sizeGradients)||void 0===u?void 0:u.length)&&(PB(this._sizeGradientProcessing),this._sizeCreation.process=JB),this}addColorRemapGradient(B,u,F){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,B,u,F),this}removeColorRemapGradient(B){return this._removeFactorGradient(this._colorRemapGradients,B),this}addAlphaRemapGradient(B,u,F){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,B,u,F),this}removeAlphaRemapGradient(B){return this._removeFactorGradient(this._alphaRemapGradients,B),this}addAngularSpeedGradient(B,u,F){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=wB,this._angularSpeedGradientProcessing={process:eB,previousItem:null,nextItem:null},nB(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,B,u,F),this}removeAngularSpeedGradient(B){var u;return this._removeFactorGradient(this._angularSpeedGradients,B),0===(null===(u=this._angularSpeedGradients)||void 0===u?void 0:u.length)&&(this._angleCreation.process=EB,PB(this._angularSpeedGradientProcessing)),this}addVelocityGradient(B,u,F){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:tB,previousItem:null,nextItem:null},dB(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:DB,previousItem:null,nextItem:null},nB(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,B,u,F),this}removeVelocityGradient(B){var u;return this._removeFactorGradient(this._velocityGradients,B),0===(null===(u=this._velocityGradients)||void 0===u?void 0:u.length)&&(PB(this._velocityCreation),PB(this._velocityGradientProcessing)),this}addLimitVelocityGradient(B,u,F){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:vB,previousItem:null,nextItem:null},dB(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:LB,previousItem:null,nextItem:null},dB(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,B,u,F),this}removeLimitVelocityGradient(B){var u;return this._removeFactorGradient(this._limitVelocityGradients,B),0===(null===(u=this._limitVelocityGradients)||void 0===u?void 0:u.length)&&(PB(this._limitVelocityCreation),PB(this._limitVelocityGradientProcessing)),this}addDragGradient(B,u,F){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:xB,previousItem:null,nextItem:null},nB(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:UB,previousItem:null,nextItem:null},nB(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,B,u,F),this}removeDragGradient(B){var u;return this._removeFactorGradient(this._dragGradients,B),0===(null===(u=this._dragGradients)||void 0===u?void 0:u.length)&&(PB(this._dragCreation),PB(this._dragGradientProcessing)),this}addEmitRateGradient(B,u,F){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,B,u,F),this}removeEmitRateGradient(B){return this._removeFactorGradient(this._emitRateGradients,B),this}addStartSizeGradient(B,u,F){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,B,u,F),this._syncStartSizeCreation(),this}removeStartSizeGradient(B){return this._removeFactorGradient(this._startSizeGradients,B),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const B=new Uint8Array(4*this._rawTextureWidth),u=G.TmpColors.Xu[0];for(let F=0;F<this._rawTextureWidth;F++){const Z=F/this._rawTextureWidth;N.GetCurrentGradient(Z,this._rampGradients,((Z,V,p)=>{G.Xu.LerpToRef(Z.color,V.color,p,u),B[4*F]=255*u.r,B[4*F+1]=255*u.g,B[4*F+2]=255*u.b,B[4*F+3]=255}))}this._rampGradientsTexture=b.b.CreateRGBATexture(B,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((B,u)=>B.gradient<u.gradient?-1:B.gradient>u.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(B,u){this._rampGradients||(this._rampGradients=[]);const F=new r(B,u);return this._rampGradients.push(F),this._syncRampGradientTexture(),this}removeRampGradient(B){return this._removeGradientAndTexture(B,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(B,u,F){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=pB,this._colorProcessing.process=GB);const Z=new i(B,u,F);return this._colorGradients.push(Z),this._colorGradients.sort(((B,u)=>B.gradient<u.gradient?-1:B.gradient>u.gradient?1:0)),this}removeColorGradient(B){if(!this._colorGradients)return this;let u=0;for(const F of this._colorGradients){if(F.gradient===B){this._colorGradients.splice(u,1);break}u++}return 0===this._colorGradients.length&&(this._colorCreation.process=VB,this._colorProcessing.process=RB),this}resetDrawCache(){if(this._drawWrappers){for(const B of this._drawWrappers)if(B)for(const u of B)null===u||void 0===u||u.dispose();this._drawWrappers=[]}}_fetchR(B,u,F,Z,V){return V[4*(((B=.5*Math.abs(B)+.5)*F%F|0)+((u=.5*Math.abs(u)+.5)*Z%Z|0)*F)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const B=this._engine,u=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*u),this._vertexBuffer=new x.b(B,this._vertexData,!0,u);let F=0;const Z=this._vertexBuffer.createVertexBuffer(x.f.PositionKind,F,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[x.f.PositionKind]=Z,F+=3;const V=this._vertexBuffer.createVertexBuffer(x.f.ColorKind,F,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[x.f.ColorKind]=V,F+=4;const p=this._vertexBuffer.createVertexBuffer("angle",F,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=p,F+=1;const G=this._vertexBuffer.createVertexBuffer("size",F,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=G,F+=2,this._isAnimationSheetEnabled){const B=this._vertexBuffer.createVertexBuffer("cellIndex",F,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=B,F+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const B=this._vertexBuffer.createVertexBuffer("direction",F,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=B,F+=3}if(this._useRampGradients){const B=this._vertexBuffer.createVertexBuffer("remapData",F,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=B,F+=4}let R;if(this._useInstancing){const u=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new x.b(B,u,!1,2),R=this._spriteBuffer.createVertexBuffer("offset",0,2)}else R=this._vertexBuffer.createVertexBuffer("offset",F,2,this._vertexBufferSize,this._useInstancing),F+=2;this._vertexBuffers.offset=R,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const B=[],u=[];let F=0;for(let Z=0;Z<this._capacity;Z++)B.push(F),B.push(F+1),B.push(F+2),B.push(F),B.push(F+2),B.push(F+3),u.push(F,F+1,F+1,F+2,F+2,F+3,F+3,F,F,F+3),F+=4;this._indexBuffer=this._engine.createIndexBuffer(B),this._linesIndexBuffer=this._engine.createIndexBuffer(u)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(B)setTimeout((()=>{this.start(0)}),B);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var u;-1!==(null===(u=this.Zu)||void 0===u?void 0:u.getClassName().indexOf("Mesh"))&&this.Zu.XR(!0);const B=this.noiseTexture;if(B&&B.onGeneratedObservable)B.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let u=0;u<this.preWarmCycles;u++)this.animate(!0),B.render()}))}));else for(let u=0;u<this.preWarmCycles;u++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(B))}_postStop(B){}reset(){this._stockParticles.length=0,this.yt.length=0}_appendParticleVertex(B,u,F,V){let p=B*this._vertexBufferSize;if(this._vertexData[p++]=u.position.x+this.Hs.x,this._vertexData[p++]=u.position.y+this.Hs.y,this._vertexData[p++]=u.position.z+this.Hs.z,this._vertexData[p++]=u.color.r,this._vertexData[p++]=u.color.g,this._vertexData[p++]=u.color.b,this._vertexData[p++]=u.color.a,this._vertexData[p++]=u.angle,this._vertexData[p++]=u.scale.x*u.size,this._vertexData[p++]=u.scale.y*u.size,this._isAnimationSheetEnabled&&(this._vertexData[p++]=u.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[p++]=u.direction.x,this._vertexData[p++]=u.direction.y,this._vertexData[p++]=u.direction.z);else if(u._initialDirection){let B=u._initialDirection;this.isLocal&&(Z.Du.TransformNormalToRef(B,this._emitterWorldMatrix,Z.TmpVectors.Du[0]),B=Z.TmpVectors.Du[0]),0===B.x&&0===B.z&&(B.x=.001),this._vertexData[p++]=B.x,this._vertexData[p++]=B.y,this._vertexData[p++]=B.z}else{let B=u.direction;this.isLocal&&(Z.Du.TransformNormalToRef(B,this._emitterWorldMatrix,Z.TmpVectors.Du[0]),B=Z.TmpVectors.Du[0]),0===B.x&&0===B.z&&(B.x=.001),this._vertexData[p++]=B.x,this._vertexData[p++]=B.y,this._vertexData[p++]=B.z}this._useRampGradients&&u.remapData&&(this._vertexData[p++]=u.remapData.x,this._vertexData[p++]=u.remapData.y,this._vertexData[p++]=u.remapData.z,this._vertexData[p++]=u.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===F?F=this._epsilon:1===F&&(F=1-this._epsilon),0===V?V=this._epsilon:1===V&&(V=1-this._epsilon)),this._vertexData[p++]=F,this._vertexData[p++]=V)}_prepareParticle(B){}_createNewOnes(B){let u;for(let F=0;F<B&&this.yt.length!==this._capacity;F++){u=this._createParticle(),this.yt.push(u);let B=this._createQueueStart;for(;B;)B.process(u,this),B=B.nextItem;u._inheritParticleInfoToSubEmitters()}}_update(B){if(this._alive=this.yt.length>0,this.Zu.position){const B=this.Zu;this._emitterWorldMatrix=B.getWorldMatrix()}else{const B=this.Zu;this._emitterWorldMatrix=Z.Matrix.Translation(B.x,B.y,B.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.yt),this._createNewOnes(B)}static _GetAttributeNamesOrOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=[x.f.PositionKind,x.f.ColorKind,"angle","offset","size"];return B&&Z.push("cellIndex"),u||Z.push("direction"),F&&Z.push("remapData"),Z}static _GetEffectCreationOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,uB.c)(Z),B&&Z.push("particlesInfos"),u&&Z.push("logarithmicDepthConstant"),F&&(Z.push("vFogInfos"),Z.push("vFogColor")),Z}fillDefines(B,u){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,uB.k)(this,this._scene,B),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&B.push("#define FOG")),this._isAnimationSheetEnabled&&B.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&B.push("#define LOGARITHMICDEPTH"),u===e.BLENDMODE_MULTIPLY&&B.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&B.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(B.push("#define BILLBOARD"),this.billboardMode){case 2:B.push("#define BILLBOARDY");break;case 8:case 9:B.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&B.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:B.push("#define BILLBOARDMODE_ALL")}F&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),B.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(B,u,F){u.push(...cB._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),B.push(...cB._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),F.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,ZB.f)(B,this._imageProcessingConfigurationDefines),(0,ZB.c)(F,this._imageProcessingConfigurationDefines))}_getWrapper(B){const u=this._getCustomDrawWrapper(B);if(null!==u&&void 0!==u&&u.effect)return u;const F=[];this.fillDefines(F,B);const Z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let V=this._drawWrappers[Z];V||(V=this._drawWrappers[Z]=[]);let p=V[B];p||(p=new BB.b(this._engine),p.drawContext&&(p.drawContext.useInstancing=this._useInstancing),V[B]=p);const G=F.join("\n");if(p.defines!==G){const B=[],u=[],F=[];this.fillUniformsAttributesAndSamplerNames(u,B,F),p.setEffect(this._engine.createEffect("particles",B,u,F,G,void 0,void 0,void 0,void 0,this._shaderLanguage),G)}return p}animate(){var B;let u,F=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!F&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(F?this.preWarmStepOffset:(null===(B=this._scene)||void 0===B?void 0:B.getAnimationRatio())||1),this.manualEmitCount>-1)u=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let B=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const u=this._actualFrame/this.targetStopDuration;N.GetCurrentGradient(u,this._emitRateGradients,((u,F,Z)=>{u!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=F.getFactor(),this._currentEmitRateGradient=u),B=(0,s.Lerp)(this._currentEmitRate1,this._currentEmitRate2,Z)}))}u=B*this._scaledUpdateSpeed|0,this._newPartsExcess+=B*this._scaledUpdateSpeed-u}if(this._newPartsExcess>1&&(u+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?u=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(u),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!F){let B=0;for(let u=0;u<this.yt.length;u++){const F=this.yt[u];this._appendParticleVertices(B,F),B+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.yt.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(B,u){this._appendParticleVertex(B++,u,0,0),this._useInstancing||(this._appendParticleVertex(B++,u,1,0),this._appendParticleVertex(B++,u,1,1),this._appendParticleVertex(B++,u,0,1))}rebuild(){var B;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(B=this._spriteBuffer)||void 0===B||B._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!cB.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(F.bind(F,14450)),Promise.resolve().then(F.bind(F,14383))])):await Promise.all([Promise.resolve().then(F.bind(F,14372)),Promise.resolve().then(F.bind(F,14363))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.Zu||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==e.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(e.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(e.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(B){const u=this._getWrapper(B),F=u.effect,V=this._engine;V.enableEffect(u);const p=this.defaultViewMatrix??this._scene.getViewMatrix();if(F.setTexture("diffuseSampler",this.particleTexture),F.setMatrix("view",p),F.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const B=this.particleTexture.getBaseSize();F.setFloat3("particlesInfos",this.spriteCellWidth/B.width,this.spriteCellHeight/B.height,this.spriteCellWidth/B.width)}if(F.setVector2("translationPivot",this.translationPivot),F.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const B=this._scene.activeCamera;F.setVector3("eyePosition",B.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),F.setTexture("rampSampler",this._rampGradientsTexture));const G=F.defines;var R,e,s,Y,Q,t;(this._scene&&((0,uB.g)(F,this,this._scene),this.applyFog&&(0,FB.d)(this._scene,void 0,F)),G.indexOf("#define BILLBOARDMODE_ALL")>=0&&(p.invertToRef(Z.TmpVectors.Matrix[0]),F.setMatrix("invView",Z.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(R=this._scene)&&void 0!==R&&R.forceWireframe?V.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,F):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,F)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(e=this._scene)&&void 0!==e&&e.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?V.bindBuffers(this._vertexBuffers,null!==(s=this._scene)&&void 0!==s&&s.forceWireframe?this._linesIndexBuffer:this._indexBuffer,F):V.bindBuffers(this._vertexBuffers,null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._linesIndexBufferUseInstancing:null,F);(this.useLogarithmicDepth&&this._scene&&(0,FB.h)(G,F,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(F),this._setEngineBasedOnBlendMode(B),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(F),this._useInstancing)?null!==(Q=this._scene)&&void 0!==Q&&Q.forceWireframe?V.drawElementsType(6,0,10,this.yt.length):V.drawArraysType(7,0,4,this.yt.length):null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?V.drawElementsType(1,0,10*this.yt.length):V.drawElementsType(0,0,6*this.yt.length);return this.yt.length}render(){if(!this.isReady()||!this.yt.length)return 0;const B=this._engine;B.setState&&(B.setState(!1),this.forceDepthWrite&&B.setDepthWrite(!0));let u=0;return u=this.blendMode===e.BLENDMODE_MULTIPLYADD?this._render(e.BLENDMODE_MULTIPLY)+this._render(e.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),u}_onDispose(){}dispose(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),B&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),B&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(u,F),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const B=this._scene.xt.indexOf(this);B>-1&&this._scene.xt.splice(B,1),this._scene._activeParticleSystems.dispose()}this.GR.notifyObservers(this),this.GR.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}cB.ForceGLSL=!1;var hB,iB=F(12843);!function(B){B[B.ATTACHED=0]="ATTACHED",B[B.END=1]="END"}(hB||(hB={}));class rB{constructor(B){if(this.particleSystem=B,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!B.Zu||!B.Zu.dispose){const u=(0,R.d)("BABYLON.AbstractMesh");B.Zu=new u("SubemitterSystemEmitter",B.yB()),B._disposeEmitterOnDispose=!0}}clone(){let B=this.particleSystem.Zu;if(B){if(B instanceof Z.Du)B=B.clone();else if(-1!==B.getClassName().indexOf("Mesh")){B=new((0,R.d)("BABYLON.Mesh"))("",B.yB()),B.isVisible=!1}}else B=new Z.Du;const u=new rB(this.particleSystem.clone(this.particleSystem.name,B));return u.particleSystem.name+="Clone",u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem._disposeEmitterOnDispose=!0,u.particleSystem.disposeOnStop=!0,u}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return u.type=this.type,u.inheritDirection=this.inheritDirection,u.inheritedVelocityAmount=this.inheritedVelocityAmount,u.particleSystem=this.particleSystem.serialize(B),u}static _ParseParticleSystem(B,u,F){throw(0,iB.e)("ParseParticle")}static Parse(B,u,F){const Z=B.particleSystem,V=new rB(rB._ParseParticleSystem(Z,u,F,!0));return V.type=B.type,V.inheritDirection=B.inheritDirection,V.inheritedVelocityAmount=B.inheritedVelocityAmount,V.particleSystem._isSubEmitter=!0,V}dispose(){this.particleSystem.dispose()}}var KB=F(12888);function NB(B,u){const F=new W;return F.direction1=B,F.direction2=u,F}function AB(){return new q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function bB(){return new X(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function kB(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.Du(0,1,0),F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0);return new f(B,u,F)}function SB(){return new D(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Bu(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0),p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.Du(0,1,0);return new L(B,u,F,V,p)}function uu(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new t(B,u)}function Fu(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0),V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0);return new v(B,u,F,V)}const Zu=Z.Du.Zero(),Vu=Z.Du.Zero(),pu=Z.Du.Zero();class Gu{constructor(){this.strength=0,this.position=Z.Du.Zero()}_processParticle(B,u){this.position.subtractToRef(B.position,Zu);const F=Zu.lengthSquared()+1;Zu.normalize().scaleToRef(this.strength/F,Vu),Vu.scaleToRef(u._tempScaledUpdateSpeed,pu),B.direction.addInPlace(pu)}serialize(){return{position:this.position.DR(),strength:this.strength}}}class Ru extends cB{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=B=>{if(!this._subEmitters||0===this._subEmitters.length)return;const u=Math.floor(Math.random()*this._subEmitters.length);for(const F of this._subEmitters[u])if(1===F.type){const u=F.clone();B._inheritParticleInfoToSubEmitter(u),u.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(u.particleSystem),u.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(B,u){const F=NB(B,u);return this.particleEmitterType=F,F}get flowMap(){return this._flowMap}set flowMap(B){this._flowMap!==B&&(this._flowMap=B,this._flowMapUpdate&&(PB(this._flowMapUpdate),this._flowMapUpdate=null),B&&(this._flowMapUpdate={process:B=>{var u;const F=null===(u=this.yB())||void 0===u?void 0:u.getTransformMatrix();this._flowMap._processParticle(B,this.flowMapStrength*this._tempScaledUpdateSpeed,F)},previousItem:null,nextItem:null},dB(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(B){this._attractors.push(B),1===this._attractors.length&&(this._attractorUpdate={process:B=>{for(const u of this._attractors)u._processParticle(B,this)},previousItem:null,nextItem:null},dB(this._attractorUpdate,this._directionProcessing))}removeAttractor(B){const u=this._attractors.indexOf(B);-1!==u&&this._attractors.splice(u,1),0===this._attractors.length&&PB(this._attractorUpdate)}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(B)}createHemisphericEmitter(){const B=AB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createSphereEmitter(){const B=bB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createDirectedSphereEmitter(){const B=kB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.Du(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0));return this.particleEmitterType=B,B}createCylinderEmitter(){const B=SB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=B,B}createDirectedCylinderEmitter(){const B=Bu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.Du(0,1,0));return this.particleEmitterType=B,B}createConeEmitter(){const B=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=B,B}createDirectedConeEmitter(){const B=Fu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0));return this.particleEmitterType=B,B}createBoxEmitter(B,u,F,Z){const V=new Q;return this.particleEmitterType=V,this.direction1=B,this.direction2=u,this.minEmitBox=F,this.maxEmitBox=Z,V}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const B of this.subEmitters)B instanceof Ru?this._subEmitters.push([new rB(B)]):B instanceof rB?this._subEmitters.push([B]):B instanceof Array&&this._subEmitters.push(B)}_stopSubEmitters(){if(this.activeSubSystems){for(const B of this.activeSubSystems)B.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const B=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==B&&this._rootParticleSystem.activeSubSystems.splice(B,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(B){B&&this._stopSubEmitters()}_prepareParticle(B){if(this._subEmitters&&this._subEmitters.length>0){const u=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];B._attachedSubEmitters=[];for(const F of u)if(0===F.type){const u=F.clone();B._attachedSubEmitters.push(u),u.particleSystem.start()}}}_onDispose(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),B&&this.particles)for(const F of this.particles)if(F._attachedSubEmitters)for(let B=F._attachedSubEmitters.length-1;B>=0;B-=1)F._attachedSubEmitters[B].dispose();if(u&&this.activeSubSystems)for(let F=this.activeSubSystems.length-1;F>=0;F-=1)this.activeSubSystems[F].dispose();if(this._subEmitters&&this._subEmitters.length){for(let B=0;B<this._subEmitters.length;B++)for(const u of this._subEmitters[B])u.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.Zu&&this.Zu.dispose&&this.Zu.dispose(!0)}static _Parse(B,u,F,V){let p;p=F instanceof KB.c?null:F;const e=(0,R.d)("BABYLON.Texture");if(e&&p&&(B.texture?u.particleTexture=e.Parse(B.texture,p,V):B.textureName&&(u.particleTexture=new e(V+B.textureName,p,!1,void 0===B.invertY||B.invertY),u.particleTexture.name=B.textureName)),B.emitterId||0===B.emitterId||void 0!==B.Zu?B.emitterId&&p?u.Zu=p.getLastMeshById(B.emitterId):u.Zu=Z.Du.fu(B.Zu):u.Zu=Z.Du.Zero(),u.isLocal=!!B.isLocal,void 0!==B.renderingGroupId&&(u.renderingGroupId=B.renderingGroupId),void 0!==B.isBillboardBased&&(u.isBillboardBased=B.isBillboardBased),void 0!==B.billboardMode&&(u.billboardMode=B.billboardMode),void 0!==B.useLogarithmicDepth&&(u.useLogarithmicDepth=B.useLogarithmicDepth),B.animations){for(let F=0;F<B.animations.length;F++){const Z=B.animations[F],V=(0,R.d)("BABYLON.Animation");V&&u.animations.push(V.Parse(Z))}u.beginAnimationOnStart=B.beginAnimationOnStart,u.beginAnimationFrom=B.beginAnimationFrom,u.beginAnimationTo=B.beginAnimationTo,u.beginAnimationLoop=B.beginAnimationLoop}if(B.autoAnimate&&p&&p.beginAnimation(u,B.autoAnimateFrom,B.autoAnimateTo,B.autoAnimateLoop,B.autoAnimateSpeed||1),u.startDelay=0|B.startDelay,u.minAngularSpeed=B.minAngularSpeed,u.maxAngularSpeed=B.maxAngularSpeed,u.minSize=B.minSize,u.maxSize=B.maxSize,B.minScaleX&&(u.minScaleX=B.minScaleX,u.maxScaleX=B.maxScaleX,u.minScaleY=B.minScaleY,u.maxScaleY=B.maxScaleY),void 0!==B.preWarmCycles&&(u.preWarmCycles=B.preWarmCycles,u.preWarmStepOffset=B.preWarmStepOffset),void 0!==B.minInitialRotation&&(u.minInitialRotation=B.minInitialRotation,u.maxInitialRotation=B.maxInitialRotation),u.minLifeTime=B.minLifeTime,u.maxLifeTime=B.maxLifeTime,u.minEmitPower=B.minEmitPower,u.maxEmitPower=B.maxEmitPower,u.emitRate=B.emitRate,u.gravity=Z.Du.fu(B.gravity),B.noiseStrength&&(u.noiseStrength=Z.Du.fu(B.noiseStrength)),u.color1=G.gR.fu(B.color1),u.color2=G.gR.fu(B.color2),u.colorDead=G.gR.fu(B.colorDead),u.updateSpeed=B.updateSpeed,u.targetStopDuration=B.targetStopDuration,u.blendMode=B.blendMode,B.colorGradients)for(const Z of B.colorGradients)u.addColorGradient(Z.gradient,G.gR.fu(Z.color1),Z.color2?G.gR.fu(Z.color2):void 0);if(B.rampGradients){for(const F of B.rampGradients)u.addRampGradient(F.gradient,G.Xu.fu(F.color));u.useRampGradients=B.useRampGradients}if(B.colorRemapGradients)for(const Z of B.colorRemapGradients)u.addColorRemapGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.alphaRemapGradients)for(const Z of B.alphaRemapGradients)u.addAlphaRemapGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.sizeGradients)for(const Z of B.sizeGradients)u.addSizeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.angularSpeedGradients)for(const Z of B.angularSpeedGradients)u.addAngularSpeedGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.velocityGradients)for(const Z of B.velocityGradients)u.addVelocityGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.dragGradients)for(const Z of B.dragGradients)u.addDragGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.emitRateGradients)for(const Z of B.emitRateGradients)u.addEmitRateGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.startSizeGradients)for(const Z of B.startSizeGradients)u.addStartSizeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.lifeTimeGradients)for(const Z of B.lifeTimeGradients)u.addLifeTimeGradient(Z.gradient,void 0!==Z.factor1?Z.factor1:Z.factor,Z.factor2);if(B.limitVelocityGradients){for(const F of B.limitVelocityGradients)u.addLimitVelocityGradient(F.gradient,void 0!==F.factor1?F.factor1:F.factor,F.factor2);u.limitVelocityDamping=B.limitVelocityDamping}if(B.noiseTexture&&p){const F=(0,R.d)("BABYLON.ProceduralTexture");u.noiseTexture=F.Parse(B.noiseTexture,p,V)}let s;if(B.particleEmitterType){switch(B.particleEmitterType.type){case"SphereParticleEmitter":s=new X;break;case"SphereDirectedParticleEmitter":s=new f;break;case"ConeEmitter":case"ConeParticleEmitter":s=new t;break;case"ConeDirectedParticleEmitter":s=new v;break;case"CylinderParticleEmitter":s=new D;break;case"CylinderDirectedParticleEmitter":s=new L;break;case"HemisphericParticleEmitter":s=new q;break;case"PointParticleEmitter":s=new W;break;case"MeshParticleEmitter":s=new U;break;case"CustomParticleEmitter":s=new C;break;default:s=new Q}s.parse(B.particleEmitterType,p)}else s=new Q,s.parse(B,p);u.particleEmitterType=s,u.startSpriteCellID=B.startSpriteCellID,u.endSpriteCellID=B.endSpriteCellID,u.spriteCellLoop=B.spriteCellLoop??!0,u.spriteCellWidth=B.spriteCellWidth,u.spriteCellHeight=B.spriteCellHeight,u.spriteCellChangeSpeed=B.spriteCellChangeSpeed,u.spriteRandomStartCell=B.spriteRandomStartCell,u.disposeOnStop=B.disposeOnStop??!1,u.manualEmitCount=B.manualEmitCount??-1}static Parse(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0;const R=B.name;let e,s,Y=null,Q=null;if(u instanceof KB.c?e=u:(s=u,e=s.getEngine()),B.customShader&&e.createEffectForParticles){Q=B.customShader;const u=Q.shaderOptions.defines.length>0?Q.shaderOptions.defines.join("\n"):"";Y=e.createEffectForParticles(Q.shaderPath.fragmentElement,Q.shaderOptions.uniforms,Q.shaderOptions.samplers,u)}const t=new Ru(R,p||B.xu,u,Y,B.isAnimationSheetEnabled);if(t.customShader=Q,t._rootUrl=F,B.id&&(t.id=B.id),B.subEmitters){t.subEmitters=[];for(const Z of B.subEmitters){const B=[];for(const V of Z)B.push(rB.Parse(V,u,F));t.subEmitters.push(B)}}if(B.attractors)for(const G of B.attractors){const B=new Gu;B.position=Z.Du.fu(G.position),B.strength=G.strength,t.addAttractor(B)}return Ru._Parse(B,t,u,F),B.textureMask&&(t.textureMask=G.gR.fu(B.textureMask)),B.Hs&&(t.Hs=Z.Du.fu(B.Hs)),B.preventAutoStart&&(t.preventAutoStart=B.preventAutoStart),V||t.preventAutoStart||t.start(),t}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};if(Ru._Serialize(u,this,B),u.textureMask=this.textureMask.DR(),u.customShader=this.customShader,u.preventAutoStart=this.preventAutoStart,u.Hs=this.Hs.DR(),this.subEmitters){u.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const F of this._subEmitters){const Z=[];for(const u of F)Z.push(u.serialize(B));u.subEmitters.push(Z)}}if(this._attractors&&this._attractors.length){u.attractors=[];for(const B of this._attractors)u.attractors.push(B.serialize())}return u}static _Serialize(B,u,F){if(B.name=u.name,B.id=u.id,B.xu=u.getCapacity(),B.disposeOnStop=u.disposeOnStop,B.manualEmitCount=u.manualEmitCount,u.Zu.position){const F=u.Zu;B.emitterId=F.id}else{const F=u.Zu;B.Zu=F.DR()}u.particleEmitterType&&(B.particleEmitterType=u.particleEmitterType.serialize()),u.particleTexture&&(F?B.texture=u.particleTexture.serialize():(B.textureName=u.particleTexture.name,B.invertY=!!u.particleTexture._invertY)),B.isLocal=u.isLocal,o.c.AppendSerializedAnimations(u,B),B.beginAnimationOnStart=u.beginAnimationOnStart,B.beginAnimationFrom=u.beginAnimationFrom,B.beginAnimationTo=u.beginAnimationTo,B.beginAnimationLoop=u.beginAnimationLoop,B.startDelay=u.startDelay,B.renderingGroupId=u.renderingGroupId,B.isBillboardBased=u.isBillboardBased,B.billboardMode=u.billboardMode,B.minAngularSpeed=u.minAngularSpeed,B.maxAngularSpeed=u.maxAngularSpeed,B.minSize=u.minSize,B.maxSize=u.maxSize,B.minScaleX=u.minScaleX,B.maxScaleX=u.maxScaleX,B.minScaleY=u.minScaleY,B.maxScaleY=u.maxScaleY,B.minEmitPower=u.minEmitPower,B.maxEmitPower=u.maxEmitPower,B.minLifeTime=u.minLifeTime,B.maxLifeTime=u.maxLifeTime,B.emitRate=u.emitRate,B.gravity=u.gravity.DR(),B.noiseStrength=u.noiseStrength.DR(),B.color1=u.color1.DR(),B.color2=u.color2.DR(),B.colorDead=u.colorDead.DR(),B.updateSpeed=u.updateSpeed,B.targetStopDuration=u.targetStopDuration,B.blendMode=u.blendMode,B.preWarmCycles=u.preWarmCycles,B.preWarmStepOffset=u.preWarmStepOffset,B.minInitialRotation=u.minInitialRotation,B.maxInitialRotation=u.maxInitialRotation,B.startSpriteCellID=u.startSpriteCellID,B.spriteCellLoop=u.spriteCellLoop,B.endSpriteCellID=u.endSpriteCellID,B.spriteCellChangeSpeed=u.spriteCellChangeSpeed,B.spriteCellWidth=u.spriteCellWidth,B.spriteCellHeight=u.spriteCellHeight,B.spriteRandomStartCell=u.spriteRandomStartCell,B.isAnimationSheetEnabled=u.isAnimationSheetEnabled,B.useLogarithmicDepth=u.useLogarithmicDepth;const Z=u.getColorGradients();if(Z){B.colorGradients=[];for(const u of Z){const F={gradient:u.gradient,color1:u.color1.DR()};u.color2?F.color2=u.color2.DR():F.color2=u.color1.DR(),B.colorGradients.push(F)}}const V=u.getRampGradients();if(V){B.rampGradients=[];for(const u of V){const F={gradient:u.gradient,color:u.color.DR()};B.rampGradients.push(F)}B.useRampGradients=u.useRampGradients}const p=u.getColorRemapGradients();if(p){B.colorRemapGradients=[];for(const u of p){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.colorRemapGradients.push(F)}}const G=u.getAlphaRemapGradients();if(G){B.alphaRemapGradients=[];for(const u of G){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.alphaRemapGradients.push(F)}}const R=u.getSizeGradients();if(R){B.sizeGradients=[];for(const u of R){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.sizeGradients.push(F)}}const e=u.getAngularSpeedGradients();if(e){B.angularSpeedGradients=[];for(const u of e){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.angularSpeedGradients.push(F)}}const s=u.getVelocityGradients();if(s){B.velocityGradients=[];for(const u of s){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.velocityGradients.push(F)}}const Y=u.getDragGradients();if(Y){B.dragGradients=[];for(const u of Y){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.dragGradients.push(F)}}const Q=u.getEmitRateGradients();if(Q){B.emitRateGradients=[];for(const u of Q){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.emitRateGradients.push(F)}}const t=u.getStartSizeGradients();if(t){B.startSizeGradients=[];for(const u of t){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.startSizeGradients.push(F)}}const v=u.getLifeTimeGradients();if(v){B.lifeTimeGradients=[];for(const u of v){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.lifeTimeGradients.push(F)}}const D=u.getLimitVelocityGradients();if(D){B.limitVelocityGradients=[];for(const u of D){const F={gradient:u.gradient,factor1:u.factor1};void 0!==u.factor2?F.factor2=u.factor2:F.factor2=u.factor1,B.limitVelocityGradients.push(F)}B.limitVelocityDamping=u.limitVelocityDamping}u.noiseTexture&&(B.noiseTexture=u.noiseTexture.serialize())}clone(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z={...this._customWrappers};let V=null;const p=this._engine;if(p.createEffectForParticles&&null!=this.customShader){V=this.customShader;const B=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"",u=p.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,B);Z[0]?Z[0].effect=u:this.setCustomEffect(u,0)}const G=this.serialize(F),R=Ru.Parse(G,this._scene||this._engine,this._rootUrl);return R.name=B,R.customShader=V,R._customWrappers=Z,void 0===u&&(u=this.Zu),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.Zu=u,this.preventAutoStart||R.start(),R}}Ru.BILLBOARDMODE_Y=2,Ru.BILLBOARDMODE_ALL=7,Ru.BILLBOARDMODE_STRETCHED=8,Ru.BILLBOARDMODE_STRETCHED_LOCAL=9,rB._ParseParticleSystem=Ru.Parse;var eu=F(13225),su=F(13221),Yu=F(13108);Yu.b.prototype.createTransformFeedback=function(){const B=this._gl.createTransformFeedback();if(!B)throw new Error("Unable to create Transform Feedback");return B},Yu.b.prototype.deleteTransformFeedback=function(B){this._gl.deleteTransformFeedback(B)},Yu.b.prototype.bindTransformFeedback=function(B){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,B)},Yu.b.prototype.beginTransformFeedback=function(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(B?this._gl.POINTS:this._gl.TRIANGLES)},Yu.b.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},Yu.b.prototype.setTranformFeedbackVaryings=function(B,u){this._gl.transformFeedbackVaryings(B,u,this._gl.INTERLEAVED_ATTRIBS)},Yu.b.prototype.bindTransformFeedbackBuffer=function(B){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,B?B.underlyingResource:null)},Yu.b.prototype.readTransformFeedbackBuffer=function(B){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,B)};const Qu="clipPlaneFragmentDeclaration2",tu="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";O.c.IncludesShadersStore[Qu]||(O.c.IncludesShadersStore[Qu]=tu);F(14257),F(14265),F(14271),F(14277),F(14282),F(14287),F(14294),F(14299);const vu="gpuRenderParticlesPixelShader",Du="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";O.c.ShadersStore[vu]||(O.c.ShadersStore[vu]=Du);const Lu="clipPlaneVertexDeclaration2",qu="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";O.c.IncludesShadersStore[Lu]||(O.c.IncludesShadersStore[Lu]=qu);F(14305),F(14313),F(14321),F(14323);const Wu="gpuRenderParticlesVertexShader",Xu="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";O.c.ShadersStore[Wu]||(O.c.ShadersStore[Wu]=Xu);class fu extends e{static get IsSupported(){if(!k.b.LastCreatedEngine)return!1;const B=k.b.LastCreatedEngine.getCaps();return B.supportTransformFeedbacks||B.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(B){this._maxActiveParticleCount=Math.min(B,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(B){this.maxActiveParticleCount=B}createPointEmitter(B,u){const F=NB(B,u);return this.particleEmitterType=F,F}createHemisphericEmitter(){const B=AB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createSphereEmitter(){const B=bB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=B,B}createDirectedSphereEmitter(){const B=kB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Z.Du(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0));return this.particleEmitterType=B,B}createCylinderEmitter(){const B=SB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=B,B}createDirectedCylinderEmitter(){const B=Bu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Z.Du(0,1,0));return this.particleEmitterType=B,B}createConeEmitter(){const B=uu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=B,B}createDirectedConeEmitter(){const B=Fu(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Z.Du(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Z.Du(0,1,0));return this.particleEmitterType=B,B}createBoxEmitter(B,u,F,Z){const V=new Q;return this.particleEmitterType=V,this.direction1=B,this.direction2=u,this.minEmitBox=F,this.maxEmitBox=Z,V}get flowMap(){return this._flowMap}set flowMap(B){this._flowMap!==B&&(this._flowMap=B)}isReady(){if(!this.Zu||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Ru.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Ru.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Ru.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";B?setTimeout((()=>{this.start(0)}),B):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var B;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(B=this._customWrappers[u])||void 0===B?void 0:B.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[B]??this._customWrappers[0]}setCustomEffect(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[u]=new BB.b(this._engine),this._customWrappers[u].effect=B}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new A.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(B,u,F){return super._removeGradientAndTexture(B,u,F),this._releaseBuffers(),this}addColorGradient(B,u){this._colorGradients||(this._colorGradients=[]);const F=new i(B,u);return this._colorGradients.push(F),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(B&&this._colorGradients.sort(((B,u)=>B.gradient<u.gradient?-1:B.gradient>u.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(B){return this._removeGradientAndTexture(B,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const u in this._drawWrappers){var B;null===(B=this._drawWrappers[u].drawContext)||void 0===B||B.reset()}}_addFactorGradient(B,u,F){const Z=new K(u,F);B.push(Z),this._releaseBuffers()}addSizeGradient(B,u){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,B,u),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(B){return this._removeGradientAndTexture(B,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(B,u){if(!B)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&B.sort(((B,u)=>B.gradient<u.gradient?-1:B.gradient>u.gradient?1:0));const F=this;F[u]&&(F[u].dispose(),F[u]=null)}addAngularSpeedGradient(B,u){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,B,u),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(B){return this._removeGradientAndTexture(B,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(B,u){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,B,u),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(B){return this._removeGradientAndTexture(B,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(B,u){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,B,u),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(B){return this._removeGradientAndTexture(B,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(B,u){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,B,u),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(B){return this._removeGradientAndTexture(B,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(B){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(B),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.GR=new A.b,this.onStoppedObservable=new A.b,this.onStartedObservable=new A.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,F&&"Scene"!==F.getClassName()?(this._engine=F,this.defaultProjectionMatrix=Z.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=F||k.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.xt.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,R.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,R.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,R.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new BB.b(this._engine)},this._customWrappers[0].effect=V,this._drawWrappers={0:new BB.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(u=u??{}).randomTextureSize||delete u.randomTextureSize;const G={xu:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...u},e=u;isFinite(e)&&(G.xu=e),this._capacity=G.xu,this._maxActiveParticleCount=G.xu,this._currentActiveCount=0,this._isAnimationSheetEnabled=p,this.particleEmitterType=new Q;const s=Math.min(this._engine.getCaps().maxTextureSize,G.randomTextureSize);let Y=[];for(let Z=0;Z<s;++Z)Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random());this._randomTexture=new b.b(new Float32Array(Y),s,1,5,F,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,Y=[];for(let Z=0;Z<s;++Z)Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random()),Y.push(Math.random());this._randomTexture2=new b.b(new Float32Array(Y),s,1,5,F,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=s}_reset(){this._releaseBuffers()}_createVertexBuffers(B,u,F){const Z={};Z.position=u.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let V=3;Z.age=u.createVertexBuffer("age",V,1,this._attributesStrideSize,!0),V+=1,Z.size=u.createVertexBuffer("size",V,3,this._attributesStrideSize,!0),V+=3,Z.life=u.createVertexBuffer("life",V,1,this._attributesStrideSize,!0),V+=1,V+=4,this.billboardMode===Ru.BILLBOARDMODE_STRETCHED&&(Z.direction=u.createVertexBuffer("direction",V,3,this._attributesStrideSize,!0)),V+=3,this._platform.alignDataInBuffer&&(V+=1),this.particleEmitterType instanceof C&&(V+=3,this._platform.alignDataInBuffer&&(V+=1)),this._colorGradientsTexture||(Z.color=u.createVertexBuffer("color",V,4,this._attributesStrideSize,!0),V+=4),this._isBillboardBased||(Z.initialDirection=u.createVertexBuffer("initialDirection",V,3,this._attributesStrideSize,!0),V+=3,this._platform.alignDataInBuffer&&(V+=1)),this.noiseTexture&&(Z.noiseCoordinates1=u.createVertexBuffer("noiseCoordinates1",V,3,this._attributesStrideSize,!0),V+=3,this._platform.alignDataInBuffer&&(V+=1),Z.noiseCoordinates2=u.createVertexBuffer("noiseCoordinates2",V,3,this._attributesStrideSize,!0),V+=3,this._platform.alignDataInBuffer&&(V+=1)),Z.angle=u.createVertexBuffer("angle",V,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?V++:V+=2,this._isAnimationSheetEnabled&&(Z.cellIndex=u.createVertexBuffer("cellIndex",V,1,this._attributesStrideSize,!0),V+=1,this.spriteRandomStartCell&&(Z.cellStartOffset=u.createVertexBuffer("cellStartOffset",V,1,this._attributesStrideSize,!0),V+=1)),Z.offset=F.createVertexBuffer("offset",0,2),Z.uv=F.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(Z),this._platform.createVertexBuffers(B,Z),this.resetDrawCache()}_initialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!B)return;const u=this._engine,F=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof C&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const V=this.particleEmitterType instanceof C,p=Z.TmpVectors.Du[0];let G=0;for(let Z=0;Z<this._capacity;Z++)if(F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(0),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),V?(this.particleEmitterType.particleDestinationGenerator(Z,null,p),F.push(p.x),F.push(p.y),F.push(p.z)):(F.push(0),F.push(0),F.push(0)),this._platform.alignDataInBuffer&&F.push(0),G+=16,V&&(this.particleEmitterType.particlePositionGenerator(Z,null,p),F.push(p.x),F.push(p.y),F.push(p.z),this._platform.alignDataInBuffer&&F.push(0),G+=4),this._colorGradientsTexture||(F.push(0),F.push(0),F.push(0),F.push(0),G+=4),this.isBillboardBased||(F.push(0),F.push(0),F.push(0),this._platform.alignDataInBuffer&&F.push(0),G+=4),this.noiseTexture&&(F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),this._platform.alignDataInBuffer&&F.push(0),F.push(Math.random()),F.push(Math.random()),F.push(Math.random()),this._platform.alignDataInBuffer&&F.push(0),G+=8),F.push(0),G+=1,this._angularSpeedGradientsTexture||(F.push(0),G+=1),this._isAnimationSheetEnabled&&(F.push(0),G+=1,this.spriteRandomStartCell&&(F.push(0),G+=1)),this._platform.alignDataInBuffer){let B=3-(G+3&3);for(G+=B;B-- >0;)F.push(0)}const R=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),e=this._platform.createParticleBuffer(F),s=this._platform.createParticleBuffer(F);this._buffer0=new x.b(u,e,!1,this._attributesStrideSize),this._buffer1=new x.b(u,s,!1,this._attributesStrideSize),this._spriteBuffer=new x.b(u,R,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let B=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(B+="\n#define BILLBOARD"),this._colorGradientsTexture&&(B+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(B+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(B+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(B+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(B+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(B+="\n#define DRAGGRADIENTS"),this._flowMap&&(B+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(B+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(B+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(B+="\n#define NOISE"),this.isLocal&&(B+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===B||(this._cachedUpdateDefines=B,this._updateBuffer=this._platform.createUpdateBuffer(B)),this._platform.isUpdateBufferReady()}_getWrapper(B){const u=this._getCustomDrawWrapper(B);if(null!==u&&void 0!==u&&u.effect)return u;const F=[];this.fillDefines(F,B);let Z=this._drawWrappers[B];Z||(Z=new BB.b(this._engine),Z.drawContext&&(Z.drawContext.useInstancing=!0),this._drawWrappers[B]=Z);const V=F.join("\n");if(Z.defines!==V){const B=[],u=[],F=[];this.fillUniformsAttributesAndSamplerNames(u,B,F),Z.setEffect(this._engine.createEffect("gpuRenderParticles",B,u,F,V),V)}return Z}static _GetAttributeNamesOrOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const V=[x.f.PositionKind,"age","life","size","angle"];return B||V.push(x.f.ColorKind),u&&V.push("cellIndex"),F||V.push("initialDirection"),Z&&V.push("direction"),V.push("offset",x.f.UVKind),V}static _GetEffectCreationOptions(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z=["emitterWM","Hs","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,uB.c)(Z),B&&Z.push("sheetInfos"),u&&Z.push("logarithmicDepthConstant"),F&&(Z.push("vFogInfos"),Z.push("vFogColor")),Z}fillDefines(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,uB.k)(this,this._scene,B),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==su.e.FOGMODE_NONE&&B.push("#define FOG")),u===Ru.BLENDMODE_MULTIPLY&&B.push("#define BLENDMULTIPLYMODE"),this.isLocal&&B.push("#define LOCAL"),this.useLogarithmicDepth&&B.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(B.push("#define BILLBOARD"),this.billboardMode){case Ru.BILLBOARDMODE_Y:B.push("#define BILLBOARDY");break;case Ru.BILLBOARDMODE_STRETCHED:B.push("#define BILLBOARDSTRETCHED");break;case Ru.BILLBOARDMODE_ALL:B.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&B.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&B.push("#define ANIMATESHEET"),F&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),B.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(B,u,F){u.push(...fu._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Ru.BILLBOARDMODE_STRETCHED)),B.push(...fu._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),F.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(eu.d.PrepareUniforms(B,this._imageProcessingConfigurationDefines),eu.d.PrepareSamplers(F,this._imageProcessingConfigurationDefines))}animate(){var B;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(u?this.preWarmStepOffset:(null===(B=this._scene)||void 0===B?void 0:B.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(B,u){const F=this[u];if(!B||!B.length||F)return;const Z=new Float32Array(this._rawTextureWidth);for(let V=0;V<this._rawTextureWidth;V++){const u=V/this._rawTextureWidth;N.GetCurrentGradient(u,B,((B,u,F)=>{Z[V]=(0,s.Lerp)(B.factor1,u.factor1,F)}))}this[u]=b.b.CreateRTexture(Z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[u].name=u.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const B=new Uint8Array(4*this._rawTextureWidth),u=G.TmpColors.gR[0];for(let F=0;F<this._rawTextureWidth;F++){const Z=F/this._rawTextureWidth;N.GetCurrentGradient(Z,this._colorGradients,((Z,V,p)=>{G.gR.LerpToRef(Z.color1,V.color1,p,u),B[4*F]=255*u.r,B[4*F+1]=255*u.g,B[4*F+2]=255*u.b,B[4*F+3]=255*u.a}))}this._colorGradientsTexture=b.b.CreateRGBATexture(B,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(B,u){var F,V,p,G;const R=this._getWrapper(B),e=R.effect;this._engine.enableEffect(R);const s=(null===(F=this._scene)||void 0===F?void 0:F.getViewMatrix())||Z.Matrix.IdentityReadOnly;if(e.setMatrix("view",s),e.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),e.setTexture("diffuseSampler",this.particleTexture),e.setVector2("translationPivot",this.translationPivot),e.setVector3("Hs",this.Hs),this.isLocal&&e.setMatrix("emitterWM",u),this._colorGradientsTexture?e.setTexture("colorGradientSampler",this._colorGradientsTexture):e.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const B=this.particleTexture.getBaseSize();e.setFloat3("sheetInfos",this.spriteCellWidth/B.width,this.spriteCellHeight/B.height,B.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const B=this._scene.activeCamera;e.setVector3("eyePosition",B.globalPosition)}const Y=e.defines;if(this._scene&&((0,uB.g)(e,this,this._scene),this.applyFog&&(0,FB.d)(this._scene,void 0,e)),Y.indexOf("#define BILLBOARDMODE_ALL")>=0){const B=s.clone();B.invert(),e.setMatrix("invView",B)}return this.useLogarithmicDepth&&this._scene&&(0,FB.h)(Y,e,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(e),this._setEngineBasedOnBlendMode(B),this._platform.bindDrawBuffers(this._targetIndex,e,null!==(V=this._scene)&&void 0!==V&&V.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(e),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(G=this._scene)&&void 0!==G&&G.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(B){if(!this.Zu||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!B)if(this.Zu.position){B=this.Zu.getWorldMatrix()}else{const u=this.Zu;B=Z.TmpVectors.Matrix[0],Z.Matrix.TranslationToRef(u.x,u.y,u.z,B)}const u=this._engine,F=u.getDepthWrite();if(u.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const B=this.yB();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",B.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",B),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const V=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=V,u.setDepthWrite(F)}render(){let B,u=arguments.length>0&&void 0!==arguments[0]&&arguments[0],F=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!u&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let B=0;B<this.preWarmCycles;B++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const B=0|this._accumulatedCount;this._accumulatedCount-=B,this._currentActiveCount+=B}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.Zu.position){B=this.Zu.getWorldMatrix()}else{const u=this.Zu;B=Z.TmpVectors.Matrix[0],Z.Matrix.TranslationToRef(u.x,u.y,u.z,B)}const V=this._engine;this.updateInAnimate||this._update(B);let p=0;return u||F||(V.setState(!1),this.forceDepthWrite&&V.setDepthWrite(!0),p=this.blendMode===Ru.BLENDMODE_MULTIPLYADD?this._render(Ru.BLENDMODE_MULTIPLY,B)+this._render(Ru.BLENDMODE_ADD,B):this._render(this.blendMode,B),this._engine.setAlphaMode(0)),p}rebuild(){const B=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(B,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,B()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const u in this._drawWrappers){this._drawWrappers[u].dispose()}if(this._drawWrappers={},this._scene){const B=this._scene.xt.indexOf(this);B>-1&&this._scene.xt.splice(B,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let u=0;u<this._renderVertexBuffers.length;++u){const B=this._renderVertexBuffers[u];for(const u in B)B[u].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),B&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),B&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.GR.notifyObservers(this),this.GR.clear()}clone(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Z={...this._customWrappers};let V=null;const p=this._engine;if(p.createEffectForParticles&&null!=this.customShader){V=this.customShader;const B=V.shaderOptions.defines.length>0?V.shaderOptions.defines.join("\n"):"";Z[0]=p.createEffectForParticles(V.shaderPath.fragmentElement,V.shaderOptions.uniforms,V.shaderOptions.samplers,B,void 0,void 0,void 0,this)}const G=this.serialize(F),R=fu.Parse(G,this._scene||this._engine,this._rootUrl);return R.name=B,R.customShader=V,R._customWrappers=Z,void 0===u&&(u=this.Zu),this.noiseTexture&&(R.noiseTexture=this.noiseTexture.clone()),R.Zu=u,R}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={};return Ru._Serialize(u,this,B),u.activeParticleCount=this.activeParticleCount,u.randomTextureSize=this._randomTextureSize,u.customShader=this.customShader,u}static Parse(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4?arguments[4]:void 0;const p=B.name;let G,R;u instanceof KB.c?G=u:(R=u,G=R.getEngine());const e=new fu(p,{xu:V||B.xu,randomTextureSize:B.randomTextureSize},u,null,B.isAnimationSheetEnabled);if(e._rootUrl=F,B.customShader&&G.createEffectForParticles){const u=B.customShader,F=u.shaderOptions.defines.length>0?u.shaderOptions.defines.join("\n"):"",Z=G.createEffectForParticles(u.shaderPath.fragmentElement,u.shaderOptions.uniforms,u.shaderOptions.samplers,F,void 0,void 0,void 0,e);e.setCustomEffect(Z,0),e.customShader=u}return B.id&&(e.id=B.id),B.activeParticleCount&&(e.activeParticleCount=B.activeParticleCount),Ru._Parse(B,e,u,F),B.preventAutoStart&&(e.preventAutoStart=B.preventAutoStart),Z||e.preventAutoStart||e.start(),e}}var Cu=F(12802),xu=F(14329),Uu=F(13359);class yu{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(B){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const u of this.systems)u.Zu=B;this._emitterNode=B}setEmitterAsSphere(B,u,F){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:B,renderingGroupId:u};const Z=(0,xu.c)("emitterSphere",{diameter:B.diameter,segments:B.segments},F);Z.renderingGroupId=u;const V=new Uu.Wu("emitterSphereMaterial",F);V.emissiveColor=B.color,Z.material=V;for(const p of this.systems)p.Zu=Z;this._emitterNode=Z}start(B){for(const u of this.systems)B&&(u.Zu=B),u.start()}dispose(){for(const B of this.systems)B.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u={systems:[]};for(const F of this.systems)u.systems.push(F.serialize(B));return this._emitterNode&&(u.Zu=this._emitterCreationOptions),u}static Parse(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;const V=new yu,p=this.BaseAssetsUrl+"/textures/";u=u||k.b.LastCreatedScene;for(const G of B.systems)V.systems.push(F?fu.Parse(G,u,p,!0,Z):Ru.Parse(G,u,p,!0,Z));if(B.Zu){const F=B.Zu.options;if("Sphere"===B.Zu.kind)V.setEmitterAsSphere({diameter:F.diameter,segments:F.segments,color:G.Xu.fu(F.color)},B.Zu.renderingGroupId,u)}return V}}yu.BaseAssetsUrl="https://assets.babylonjs.com/particles";var Ou=F(12852);class gu{static CreateDefault(B){let u,F=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,Z=arguments.length>2?arguments[2]:void 0;u=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new fu("default system",{xu:F},Z):new Ru("default system",F,Z),u.Zu=B;const V=Cu.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return u.particleTexture=new I.d(V,u.yB()),u.createConeEmitter(.1,Math.PI/4),u.color1=new G.gR(1,1,1,1),u.color2=new G.gR(1,1,1,1),u.colorDead=new G.gR(1,1,1,0),u.minSize=.1,u.maxSize=.1,u.minEmitPower=2,u.maxEmitPower=2,u.updateSpeed=1/60,u.emitRate=30,u}static CreateAsync(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;u||(u=k.b.LastCreatedScene);const V={};return u.addPendingData(V),new Promise(((p,G)=>{if(F&&!fu.IsSupported)return u.removePendingData(V),G("Particle system with GPU is not supported.");Cu.Tools.LoadFile(`${gu.BaseAssetsUrl}/systems/${B}.json`,(B=>{u.removePendingData(V);const G=JSON.parse(B.toString());return p(yu.Parse(G,u,F,Z))}),void 0,void 0,void 0,(()=>(u.removePendingData(V),G(`An error occurred with the creation of your particle system. Check if your type '${B}' exists.`))))}))}static ExportSet(B){const u=new yu;for(const F of B)u.systems.push(F);return u}static ParseFromFileAsync(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",p=arguments.length>5?arguments[5]:void 0;return new Promise(((G,R)=>{const e=new Ou.c;e.addEventListener("readystatechange",(()=>{if(4==e.readyState)if(200==e.status){const u=JSON.parse(e.responseText);let R;R=Z?fu.Parse(u,F,V,!1,p):Ru.Parse(u,F,V,!1,p),B&&(R.name=B),G(R)}else R("Unable to load the particle system")})),e.open("GET",u),e.send()}))}static ParseFromSnippetAsync(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",V=arguments.length>4?arguments[4]:void 0;if("_BLANK"===B){const B=this.CreateDefault(null);return B.start(),Promise.resolve(B)}return new Promise(((p,G)=>{const R=new Ou.c;R.addEventListener("readystatechange",(()=>{if(4==R.readyState)if(200==R.status){const G=JSON.parse(JSON.parse(R.responseText).jsonPayload),e=JSON.parse(G.particleSystem);let s;s=F?fu.Parse(e,u,Z,!1,V):Ru.Parse(e,u,Z,!1,V),s.snippetId=B,p(s)}else G("Unable to load the snippet "+B)})),R.open("GET",this.SnippetUrl+"/"+B.replace(/#/g,"/")),R.send()}))}}gu.BaseAssetsUrl=yu.BaseAssetsUrl,gu.SnippetUrl="https://snippet.babylonjs.com",gu.CreateFromSnippetAsync=gu.ParseFromSnippetAsync;var Ju=F(13409),au=F(13256),Tu=F(14332);(0,Tu.h)(au.d.NAME_PARTICLESYSTEM,((B,u,F,Z)=>{const V=(0,Tu.j)(au.d.NAME_PARTICLESYSTEM);if(V&&void 0!==B.xt&&null!==B.xt)for(let p=0,G=B.xt.length;p<G;p++){const G=B.xt[p];F.xt.push(V(G,u,Z))}})),(0,Tu.d)(au.d.NAME_PARTICLESYSTEM,((B,u,F)=>{if(B.activeParticleCount){return fu.Parse(B,u,F)}return Ru.Parse(B,u,F)})),KB.c.prototype.createEffectForParticles=function(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0,R=arguments.length>6?arguments[6]:void 0,e=arguments.length>7?arguments[7]:void 0,s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Y=arguments.length>9?arguments[9]:void 0,Q=[],t=[];const v=[];return e?e.fillUniformsAttributesAndSamplerNames(t,Q,v):(Q=Ru._GetAttributeNamesOrOptions(),t=Ru._GetEffectCreationOptions()),-1===V.indexOf(" BILLBOARD")&&(V+="\n#define BILLBOARD\n"),null!==e&&void 0!==e&&e.isAnimationSheetEnabled&&-1===V.indexOf(" ANIMATESHEET")&&(V+="\n#define ANIMATESHEET\n"),-1===Z.indexOf("diffuseSampler")&&Z.push("diffuseSampler"),this.createEffect({vertex:Y??(null===e||void 0===e?void 0:e.vertexShaderName)??"particles",fragmentElement:B},Q,t.concat(u),v.concat(Z),V,p,G,R,void 0,s,(async()=>{0===s?await Promise.resolve().then(F.bind(F,14372)):await Promise.resolve().then(F.bind(F,14450))}))},Ju.b.prototype.getEmittedParticleSystems=function(){const B=[];for(let u=0;u<this.yB().xt.length;u++){const F=this.yB().xt[u];F.Zu===this&&B.push(F)}return B},Ju.b.prototype.getHierarchyEmittedParticleSystems=function(){const B=[],u=this.getDescendants();u.push(this);for(let F=0;F<this.yB().xt.length;F++){const Z=this.yB().xt[F],V=Z.Zu;V.position&&-1!==u.indexOf(V)&&B.push(Z)}return B};F(13318),F(13333),F(13396);F(13398),F(14340),F(13188),F(13306),F(13433);F(13181);var zu;F(14349),F(13002);!function(B){B[B.Color=2]="Color",B[B.UV=1]="UV",B[B.Random=0]="Random",B[B.Stated=3]="Stated"}(zu||(zu={}));var Mu=F(13215);const ju=new Z.Du(0,0,0),ou=new Z.Du(0,0,0),Iu=new Z.Du(0,0,0);class mF{constructor(B,u,F){this.width=B,this.height=u,this.data=F}processFlowable(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2?arguments[2]:void 0;if(!F)return;F instanceof Z.Matrix?Z.Du.TransformCoordinatesToRef(B.position,F,Iu):(Iu.x=F.x,Iu.y=F.y,Iu.z=F.z);const V=.5*Iu.x+.5,p=1-(.5*Iu.y+.5),G=Math.floor(V*this.width),R=Math.floor(p*this.height);if(G<0||G>=this.width||R<0||R>=this.height)return;const e=4*(R*this.width+G),s=this.data[e]/255*2-1,Y=this.data[e+1]/255*2-1,Q=this.data[e+2]/255*2-1,t=this.data[e+3]/255;ju.set(s,Y,Q),ju.scaleToRef(u*t,ou),B.direction.addInPlace(ou)}_processParticle(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,F=arguments.length>2?arguments[2]:void 0;this.processFlowable(B,u,F)}static async FromUrlAsync(B){return await new Promise(((u,F)=>{const Z=document.createElement("canvas"),V=Z.getContext("2d");let p=null;const G=new Image;G.crossOrigin="anonymous",G.src=B,G.onerror=u=>{F(new Error(`Failed to load image: ${B} : ${u}`))},G.onload=()=>{Z.width=G.width,Z.height=G.height,V.drawImage(G,0,0),p=V.getImageData(0,0,Z.width,Z.height),u(new mF(Z.width,Z.height,p.data))}}))}static async ExtractFromTextureAsync(B){return await new Promise(((u,F)=>{if(!B.isReady())return void B.onLoadObservable.addOnce((async()=>{try{const F=await this.ExtractFromTextureAsync(B);u(F)}catch(Z){F(Z)}}));const Z=B.getSize();Mu.j.GetTextureDataAsync(B,Z.width,Z.height).then((B=>{u(new mF(Z.width,Z.height,new Uint8ClampedArray(B)))})).catch(F)}))}}var Eu,wu,Hu,nu,du,lu,Pu,cu,hu;!function(B){B[B.Int=1]="Int",B[B.Float=2]="Float",B[B.Vector2=4]="Vector2",B[B.Du=8]="Du",B[B.Matrix=16]="Matrix",B[B.Particle=32]="Particle",B[B.Texture=64]="Texture",B[B.gR=128]="gR",B[B.FloatGradient=256]="FloatGradient",B[B.Vector2Gradient=512]="Vector2Gradient",B[B.Vector3Gradient=1024]="Vector3Gradient",B[B.Color4Gradient=2048]="Color4Gradient",B[B.System=4096]="System",B[B.AutoDetect=8192]="AutoDetect",B[B.BasedOnInput=16384]="BasedOnInput",B[B.Undefined=32768]="Undefined",B[B.All=65535]="All"}(Eu||(Eu={})),function(B){B[B.Compatible=0]="Compatible",B[B.TypeIncompatible=1]="TypeIncompatible",B[B.HierarchyIssue=2]="HierarchyIssue"}(wu||(wu={})),function(B){B[B.Input=0]="Input",B[B.Output=1]="Output"}(Hu||(Hu={}));class iu{get direction(){return this._direction}get type(){if(this._type===Eu.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===Eu.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(B){this._type=B}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((B=>B.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(B,u,F){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=Eu.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new A.b,this.onDisconnectionObservable=new A.b,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=u,this.name=B,this._direction=F}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(B){var u;return this.isConnected?null!==(u=this._connectedPoint)&&void 0!==u&&u._storedFunction?this._connectedPoint._storedFunction(B):this._connectedPoint._storedValue:this.value}canConnectTo(B){return 0===this.checkCompatibilityState(B)}checkCompatibilityState(B){const u=this._ownerBlock,F=B.ownerBlock;if(this.type!==B.type&&B.innerType!==Eu.AutoDetect)return B.acceptedConnectionPointTypes&&-1!==B.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(B.excludedConnectionPointTypes&&-1!==B.excludedConnectionPointTypes.indexOf(this.type))return 1;let Z=F,V=u;return 0===this.direction&&(Z=u,V=F),Z.isAnAncestorOf(V)?2:0}connectTo(B){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(B))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${B.ownerBlock.name}".${B.name}`;return this._endpoints.push(B),B._connectedPoint=this,this.onConnectionObservable.notifyObservers(B),B.onConnectionObservable.notifyObservers(this),this}disconnectFrom(B){const u=this._endpoints.indexOf(B);return-1===u||(this._endpoints.splice(u,1),B._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(B),B.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(B){let u=1;for(;u<Eu.All;)B&u||this.excludedConnectionPointTypes.push(u),u<<=1}serialize(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const u={};return u.name=this.name,u.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.DR?(u.valueType="BABYLON."+this.value.getClassName(),u.value=this.value.DR()):(u.valueType="number",u.value=this.value)),B&&this.connectedPoint&&(u.inputName=this.name,u.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,u.targetConnectionName=this.connectedPoint.name,u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(u.isExposedOnFrame=!0,u.exposedPortPosition=this.exposedPortPosition),u}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class ru{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(B){this._name=B}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(B){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new A.b,this.GR=new A.b,this.onInputChangedObservable=new A.b,this.visibleOnFrame=!1,this._name=B,this.uniqueId=mB.c.UniqueId}_inputRename(B){return B}_outputRename(B){return B}isAnAncestorOf(B){for(const u of this._outputs)if(u.hasEndpoints)for(const F of u.endpoints){if(F.ownerBlock===B)return!0;if(F.ownerBlock.isAnAncestorOf(B))return!0}return!1}isAnAncestorOfType(B){if(this.getClassName()===B)return!0;for(const u of this._outputs)if(u.hasEndpoints)for(const F of u.endpoints)if(F.ownerBlock.isAnAncestorOfType(B))return!0;return!1}getInputByName(B){const u=this._inputs.filter((u=>u.name===B));return u.length?u[0]:null}_linkConnectionTypes(B,u){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[u]._acceptedConnectionPointType=this._inputs[B]:(this._inputs[B]._linkedConnectionSource=this._inputs[u],this._inputs[B]._isMainLinkSource=!0),this._inputs[u]._linkedConnectionSource=this._inputs[B]}registerInput(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;const G=new iu(B,this,0);return G.type=u,G.isOptional=F,G.defaultValue=Z,G.value=Z,G.valueMin=V,G.valueMax=p,this._inputs.push(G),this.onInputChangedObservable.notifyObservers(G),this}registerOutput(B,u,F){return(F=F??new iu(B,this,1)).type=u,this._outputs.push(F),this}_build(B){}_customBuildStep(B){}build(B){if(this._buildId===B.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((B=>B.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=B.buildId;for(const u of this._inputs){if(!u.connectedPoint){u.isOptional||B.notConnectedNonOptionalInputs.push(u);continue}const F=u.connectedPoint.ownerBlock;F&&F!==this&&!F.isSystem&&F.build(B)}return this._customBuildStep(B),B.verbose&&E.d.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(B),this.onBuildObservable.notifyObservers(this),!1}serialize(){const B={};B.customType="BABYLON."+this.getClassName(),B.id=this.uniqueId,B.name=this.name,B.visibleOnFrame=this.visibleOnFrame,B.inputs=[],B.outputs=[];for(const u of this.inputs)B.inputs.push(u.serialize());for(const u of this.outputs)B.outputs.push(u.serialize(!1));return B}_deserialize(B){this._name=B.name,this.comments=B.comments,this.visibleOnFrame=!!B.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(B)}_deserializePortDisplayNamesAndExposedOnFrame(B){const u=B.inputs,F=B.outputs;if(u)for(const Z of u){const B=this.inputs.find((B=>B.name===Z.name));if(!B)return;if(Z.displayName&&(B.displayName=Z.displayName),Z.isExposedOnFrame&&(B.isExposedOnFrame=Z.isExposedOnFrame,B.exposedPortPosition=Z.exposedPortPosition),void 0!==Z.value&&null!==Z.value)if("number"===Z.valueType)B.value=Z.value;else{const u=(0,R.d)(Z.valueType);u&&(B.value=u.fu(Z.value))}}if(F)for(let Z=0;Z<F.length;Z++){const B=F[Z];B.displayName&&(this.outputs[Z].displayName=B.displayName),B.isExposedOnFrame&&(this.outputs[Z].isExposedOnFrame=B.isExposedOnFrame,this.outputs[Z].exposedPortPosition=B.exposedPortPosition)}}clone(){const B=this.serialize(),u=(0,R.d)(B.customType);if(u){const F=new u;return F._deserialize(B),F}return null}dispose(){this.GR.notifyObservers(this),this.GR.clear();for(const B of this.inputs)B.dispose();for(const B of this.outputs)B.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function Ku(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",Z=arguments.length>3?arguments[3]:void 0;return(V,p)=>{let G=V._propStore;G||(G=[],V._propStore=G),G.push({propertyName:p,displayName:B,type:u,groupName:F,options:Z??{},className:V.getClassName()})}}(0,M.d)([(0,j.L)("comment")],ru.prototype,"comments",void 0),function(B){B[B.Boolean=0]="Boolean",B[B.Float=1]="Float",B[B.Int=2]="Int",B[B.Vector2=3]="Vector2",B[B.List=4]="List",B[B.gR=5]="gR",B[B.SamplingMode=6]="SamplingMode",B[B.TextureFormat=7]="TextureFormat",B[B.TextureType=8]="TextureType"}(nu||(nu={})),function(B){B[B.None=0]="None",B[B.Position=1]="Position",B[B.Direction=2]="Direction",B[B.Age=3]="Age",B[B.Lifetime=4]="Lifetime",B[B.Color=5]="Color",B[B.ScaledDirection=6]="ScaledDirection",B[B.Scale=7]="Scale",B[B.AgeGradient=8]="AgeGradient",B[B.Angle=9]="Angle",B[B.SpriteCellIndex=16]="SpriteCellIndex",B[B.SpriteCellStart=17]="SpriteCellStart",B[B.SpriteCellEnd=18]="SpriteCellEnd"}(du||(du={})),function(B){B[B.None=0]="None",B[B.Time=1]="Time",B[B.Delta=2]="Delta",B[B.Emitter=3]="Emitter"}(lu||(lu={}));class Nu{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let B="";for(const u of this.notConnectedNonOptionalInputs)B+=`input ${u.name} from block ${u.ownerBlock.name}[${u.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(B)throw"Build of Node Particle System Set failed:\n"+B}adapt(B,u){const F=B.getConnectedValue(this)||0;if(B.type===u)return F;switch(u){case Eu.Vector2:return new Z.Vector2(F,F);case Eu.Du:return new Z.Du(F,F,F);case Eu.gR:return new G.gR(F,F,F,F)}return null}getContextualValue(B){if(!this.particleContext||!this.systemContext)return null;switch(B){case du.Position:return this.particleContext.position;case du.Direction:return this.particleContext.direction;case du.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case du.Color:return this.particleContext.color;case du.Age:return this.particleContext.age;case du.Lifetime:return this.particleContext.lifeTime;case du.Angle:return this.particleContext.angle;case du.Scale:return this.particleContext.scale;case du.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case du.SpriteCellEnd:return this.systemContext.endSpriteCellID;case du.SpriteCellIndex:return this.particleContext.cellIndex;case du.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.Zu.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.Zu.absolutePosition:this.systemContext.Zu:null}getSystemValue(B){if(!this.particleContext||!this.systemContext)return null;switch(B){case lu.Time:return this.systemContext._actualFrame;case lu.Delta:return this.systemContext._scaledUpdateSpeed;case lu.Emitter:if(this.isEmitterTransformNode){return this.systemContext.Zu.absolutePosition}return this.systemContext.Zu}return null}}function Au(B,u,F){const Z=new Nu;Z.qu=u;const V=B.createSystem(Z);return V.canStart=()=>!0,V.Zu=F.clone(),V.disposeOnStop=!0,V.start(),V}class bu extends ru{constructor(B){super(B),this.blendMode=e.BLENDMODE_ONEONE,this.xu=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",Eu.Particle),this.registerInput("texture",Eu.Texture),this.registerInput("onStart",Eu.System,!0),this.registerInput("onEnd",Eu.System,!0),this.registerOutput("system",Eu.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(B){B.xu=this.xu,B.buildId=this._buildId++,this.build(B);const u=this.particle.getConnectedValue(B);return u.particleTexture=this.texture.getConnectedValue(B),u.emitRate=this.emitRate,u.blendMode=this.blendMode,u.name=this.name,u._nodeGenerated=!0,u._targetStopDuration=this.targetStopDuration,u.startDelay=this.startDelay,this.system._storedValue=this,u.canStart=()=>!this.doNoStart,u.onStartedObservable.add((F=>{const Z=this.onStart.getConnectedValue(B);Z&&F.onStartedObservable.addOnce((()=>{B.systemContext=u;const F=Au(Z,B.qu,B.emitterPosition);this.GR.addOnce((()=>{F.dispose()}))}));const V=this.onEnd.getConnectedValue(B);V&&F.onStoppedObservable.addOnce((()=>{B.systemContext=u;const F=Au(V,B.qu,B.emitterPosition);this.GR.addOnce((()=>{F.dispose()}))}))})),this.GR.addOnce((()=>{u.dispose()})),u}serialize(){const B=super.serialize();return B.xu=this.xu,B.emitRate=this.emitRate,B.blendMode=this.blendMode,B.doNoStart=this.doNoStart,B.targetStopDuration=this.targetStopDuration,B.startDelay=this.startDelay,B}_deserialize(B){super._deserialize(B),this.xu=B.xu,this.emitRate=B.emitRate,this.doNoStart=!!B.doNoStart,void 0!==B.blendMode&&(this.blendMode=B.blendMode),void 0!==B.targetStopDuration&&(this.targetStopDuration=B.targetStopDuration),void 0!==B.startDelay&&(this.startDelay=B.startDelay)}}(0,M.d)([Ku("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:e.BLENDMODE_ONEONE},{label:"Standard",value:e.BLENDMODE_STANDARD},{label:"Add",value:e.BLENDMODE_ADD},{label:"Multiply",value:e.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:e.BLENDMODE_MULTIPLYADD}]})],bu.prototype,"blendMode",void 0),(0,M.d)([Ku("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],bu.prototype,"xu",void 0),(0,M.d)([Ku("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bu.prototype,"emitRate",void 0),(0,M.d)([Ku("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bu.prototype,"targetStopDuration",void 0),(0,M.d)([Ku("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],bu.prototype,"startDelay",void 0),(0,M.d)([Ku("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],bu.prototype,"doNoStart",void 0),(0,R.f)("BABYLON.SystemBlock",bu);class ku extends ru{get type(){if(this._type===Eu.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=Eu.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=Eu.Vector2,this._type;case"Du":return this._type=Eu.Du,this._type;case"gR":return this._type=Eu.gR,this._type;case"Matrix":return this._type=Eu.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===du.None&&this._systemSource!==lu.None}get systemSource(){return this._systemSource}set systemSource(B){if(this._systemSource=B,B!==lu.None){switch(this._contextualSource=du.None,this._type=Eu.Float,B){case lu.Time:case lu.Delta:this._type=Eu.Float;break;case lu.Emitter:this._type=Eu.Du}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==du.None}get contextualValue(){return this._contextualSource}set contextualValue(B){if(this._contextualSource=B,B!==du.None){switch(this._systemSource=lu.None,B){case du.Scale:this._type=Eu.Vector2;break;case du.Position:case du.Direction:case du.ScaledDirection:this._type=Eu.Du;break;case du.Color:this._type=Eu.gR;break;case du.Age:case du.Lifetime:case du.Angle:case du.AgeGradient:this._type=Eu.Float;break;case du.SpriteCellEnd:case du.SpriteCellStart:case du.SpriteCellIndex:this._type=Eu.Int}this.output&&(this.output.type=this._type)}}constructor(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Eu.AutoDetect;super(B),this._type=Eu.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new A.b,this._systemSource=lu.None,this._contextualSource=du.None,this._type=u,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",u)}get value(){return this._storedValue}set value(B){this.type===Eu.Float&&this.min!==this.max&&(B=Math.max(this.min,B),B=Math.min(this.max,B)),this._storedValue=B,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(B){this._valueCallback=B}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case Eu.Int:case Eu.Float:this.value=0;break;case Eu.Vector2:this.value=Z.Vector2.Zero();break;case Eu.Du:this.value=Z.Du.Zero();break;case Eu.gR:this.value=new G.gR(1,1,1,1);break;case Eu.Matrix:this.value=Z.Matrix.Identity()}}_build(B){super._build(B),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=B=>B.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=B=>B.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const B=super.serialize();return B.type=this.type,B.contextualValue=this.contextualValue,B.systemSource=this.systemSource,B.min=this.min,B.max=this.max,B.groupInInspector=this.groupInInspector,B.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.DR?(B.valueType="BABYLON."+this._storedValue.getClassName(),B.value=this._storedValue.DR()):(B.valueType="number",B.value=this._storedValue)),B}_deserialize(B){if(super._deserialize(B),this._type=B.type,this.contextualValue=B.contextualValue,this.systemSource=B.systemSource||lu.None,this.min=B.min||0,this.max=B.max||0,this.groupInInspector=B.groupInInspector||"",void 0!==B.displayInInspector&&(this.displayInInspector=B.displayInInspector),B.valueType)if("number"===B.valueType)this._storedValue=B.value;else{const u=(0,R.d)(B.valueType);u&&(this._storedValue=u.fu(B.value))}}}(0,R.f)("BABYLON.ParticleInputBlock",ku);class Su extends ru{get url(){return this._url}set url(B){this._url!==B&&(this._cachedData=null,this._url=B,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(B){this._textureDataUrl!==B&&(this._cachedData=null,this._textureDataUrl=B,this._url="",this._sourceTexture=null)}set sourceTexture(B){this._sourceTexture!==B&&(this._cachedData=null,this._sourceTexture=B,this._url="",this._textureDataUrl="")}constructor(B){super(B),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",Eu.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const B=this.texture._storedValue;return await new Promise(((u,F)=>{if(!B.isReady())return void B.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),u(this._cachedData)}catch(B){F(B)}}));const Z=B.getSize();Mu.j.GetTextureDataAsync(B,Z.width,Z.height).then((F=>{this._cachedData={width:Z.width,height:Z.height,data:new Uint8ClampedArray(F)},B.dispose(),u(this._cachedData)})).catch(F)}))}_build(B){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new I.d(this._textureDataUrl,B.qu):this.texture._storedValue=new I.d(this._url,B.qu):this.texture._storedValue=null}serialize(){const B=super.serialize();return B.url=this.url,B.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(B.textureDataUrl=this.textureDataUrl),B}_deserialize(B){super._deserialize(B),this.url=B.url,this.serializedCachedData=!!B.serializedCachedData,B.textureDataUrl&&(this.textureDataUrl=B.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,R.f)("BABYLON.ParticleTextureSourceBlock",Su);class BF extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("position",Eu.Du),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(B){const u=this.particle.getConnectedValue(B);if(this.output._storedValue=u,!this.position.isConnected)return;const F={process:F=>{B.particleContext=F,B.systemContext=u,F.position.Z(this.position.getConnectedValue(B))},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F}}(0,R.f)("BABYLON.UpdatePositionBlock",BF),function(B){B[B.Add=0]="Add",B[B.Subtract=1]="Subtract",B[B.Multiply=2]="Multiply",B[B.Divide=3]="Divide",B[B.Max=4]="Max",B[B.Min=5]="Min"}(Pu||(Pu={}));class uF extends ru{constructor(B){super(B),this.operation=Pu.Add,this.registerInput("left",Eu.AutoDetect),this.registerInput("right",Eu.AutoDetect),this.registerOutput("output",Eu.BasedOnInput),this.output._typeConnectionSource=this.left;const u=[Eu.Matrix,Eu.Particle,Eu.Texture,Eu.System,Eu.FloatGradient,Eu.Color4Gradient,Eu.Vector2Gradient,Eu.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...u),this.right.excludedConnectionPointTypes.push(...u),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(B){let u;const F=this.left,V=this.right;if(!F.isConnected||!V.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const p=F.type===Eu.Float||F.type===Eu.Int,R=V.type===Eu.Float||V.type===Eu.Int,e=p&&R;switch(this.operation){case Pu.Add:u=e?B=>F.getConnectedValue(B)+V.getConnectedValue(B):p?B=>B.adapt(F,V.type).add(V.getConnectedValue(B)):B=>F.getConnectedValue(B).add(B.adapt(V,F.type));break;case Pu.Subtract:u=e?B=>F.getConnectedValue(B)-V.getConnectedValue(B):p?B=>B.adapt(F,V.type).Lu(V.getConnectedValue(B)):B=>F.getConnectedValue(B).Lu(B.adapt(V,F.type));break;case Pu.Multiply:u=e?B=>F.getConnectedValue(B)*V.getConnectedValue(B):p?B=>B.adapt(F,V.type).multiply(V.getConnectedValue(B)):B=>F.getConnectedValue(B).multiply(B.adapt(V,F.type));break;case Pu.Divide:u=e?B=>F.getConnectedValue(B)/V.getConnectedValue(B):p?B=>B.adapt(F,V.type).divide(V.getConnectedValue(B)):B=>F.getConnectedValue(B).divide(B.adapt(V,F.type));break;case Pu.Min:if(e)u=B=>Math.min(F.getConnectedValue(B),V.getConnectedValue(B));else{const[B,R]=p?[V,F]:[F,V];switch(B.type){case Eu.Vector2:u=u=>Z.Vector2.Minimize(B.getConnectedValue(u),u.adapt(R,B.type));break;case Eu.Du:u=u=>Z.Du.Minimize(B.getConnectedValue(u),u.adapt(R,B.type));break;case Eu.gR:u=u=>{const F=B.getConnectedValue(u),{r:Z,g:V,b:p,a:e}=u.adapt(R,B.type);return new G.gR(Math.min(F.r,Z),Math.min(F.g,V),Math.min(F.b,p),Math.min(F.a,e))}}}break;case Pu.Max:if(!e){const[B,R]=p?[V,F]:[F,V];switch(B.type){case Eu.Vector2:u=u=>Z.Vector2.Maximize(B.getConnectedValue(u),u.adapt(R,B.type));break;case Eu.Du:u=u=>Z.Du.Maximize(B.getConnectedValue(u),u.adapt(R,B.type));break;case Eu.gR:u=u=>{const F=B.getConnectedValue(u),{r:Z,g:V,b:p,a:e}=u.adapt(R,B.type);return new G.gR(Math.max(F.r,Z),Math.min(F.g,V),Math.min(F.b,p),Math.min(F.a,e))}}break}u=B=>Math.max(F.getConnectedValue(B),V.getConnectedValue(B))}this.output._storedFunction=B=>F.type===Eu.Int?0|u(B):u(B)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===Eu.Int||this.left.type===Eu.Float&&this.right.type!==Eu.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[B,u]of[[this.left,this.right],[this.right,this.left]])B.acceptedConnectionPointTypes=[Eu.Int,Eu.Float],u.isConnected&&(B.acceptedConnectionPointTypes.push(u.type),u.type!==Eu.Int&&u.type!==Eu.Float||B.acceptedConnectionPointTypes.push(Eu.Vector2,Eu.Du,Eu.gR))}dispose(){super.dispose();for(const B of this._connectionObservers)B.remove();this._connectionObservers.length=0}serialize(){const B=super.serialize();return B.operation=this.operation,B}_deserialize(B){super._deserialize(B),this.operation=B.operation}}(0,M.d)([Ku("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:Pu.Add},{label:"Subtract",value:Pu.Subtract},{label:"Multiply",value:Pu.Multiply},{label:"Divide",value:Pu.Divide},{label:"Max",value:Pu.Max},{label:"Min",value:Pu.Min}]})],uF.prototype,"operation",void 0),(0,R.f)("BABYLON.ParticleMathBlock",uF);class FF extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("direction1",Eu.Du,!0,new Z.Du(0,1,0)),this.registerInput("direction2",Eu.Du,!0,new Z.Du(0,1,0)),this.registerInput("minEmitBox",Eu.Du,!0,new Z.Du(-.5,-.5,-.5)),this.registerInput("maxEmitBox",Eu.Du,!0,new Z.Du(.5,.5,.5)),this.registerOutput("output",Eu.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(B){const u=this.particle.getConnectedValue(B);u._directionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.direction1.getConnectedValue(B),p=this.direction2.getConnectedValue(B),G=(0,s.RandomRange)(V.x,p.x),R=(0,s.RandomRange)(V.y,p.y),e=(0,s.RandomRange)(V.z,p.z);B.isEmitterTransformNode?Z.Du.TransformNormalFromFloatsToRef(G,R,e,B.emitterWorldMatrix,F.direction):F.direction.UR(G,R,e)},u._positionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.minEmitBox.getConnectedValue(B),p=this.maxEmitBox.getConnectedValue(B),G=(0,s.RandomRange)(V.x,p.x),R=(0,s.RandomRange)(V.y,p.y),e=(0,s.RandomRange)(V.z,p.z);B.isEmitterTransformNode?Z.Du.TransformCoordinatesFromFloatsToRef(G,R,e,B.emitterWorldMatrix,F.position):(F.position.UR(G,R,e),F.position.addInPlace(B.emitterPosition))},this.output._storedValue=u}}(0,R.f)("BABYLON.BoxShapeBlock",FF);class ZF extends ru{constructor(B){super(B),this.registerInput("emitPower",Eu.Float,!0,1),this.registerInput("lifeTime",Eu.Float,!0,1),this.registerInput("color",Eu.gR,!0,new G.gR(1,1,1,1)),this.registerInput("scale",Eu.Vector2,!0,new Z.Vector2(1,1)),this.registerInput("angle",Eu.Float,!0,0),this.registerOutput("particle",Eu.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(B){const u=new Ru(this.name,B.xu,B.qu,null,!1,void 0,!0);u.particleEmitterType=new W,u._lifeTimeCreation.process=(u,F)=>{B.particleContext=u,u.lifeTime=this.lifeTime.getConnectedValue(B),F._emitPower=this.emitPower.getConnectedValue(B)},u._colorCreation.process=u=>{B.particleContext=u,u.color.Z(this.color.getConnectedValue(B))},u._sizeCreation.process=u=>{B.particleContext=u,u.size=1,u.scale.Z(this.scale.getConnectedValue(B))},u._angleCreation.process=u=>{B.particleContext=u,u.angle=this.angle.getConnectedValue(B)},this.particle._storedValue=u}}(0,R.f)("BABYLON.CreateParticleBlock",ZF);class VF{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const B=[];for(const u of this.attachedBlocks)u.isInput&&B.push(u);return B}constructor(B){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new A.b,this.name=B}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(B)&&this.attachedBlocks.push(B);for(const F of B.inputs){const Z=F.connectedPoint;if(Z){const F=Z.ownerBlock;F!==B&&this._initializeBlock(F,u)}}}async buildAsync(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((F=>{const Z=new yu;for(const B of this._systemBlocks)this._initializeBlock(B);for(const V of this.systemBlocks){const F=new Nu;F.buildId=this._buildId++,F.qu=B,F.verbose=u;const p=V.createSystem(F);F.emitErrors(),Z.systems.push(p)}this.onBuildObservable.notifyObservers(this),F(Z)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const B=new bu("Particle system"),u=new BF("Update position");u.output.connectTo(B.particle);const F=new ku("Position");F.contextualValue=du.Position;const Z=new ku("Scaled direction");Z.contextualValue=du.ScaledDirection;const V=new uF("Add");V.operation=Pu.Add,F.output.connectTo(V.left),Z.output.connectTo(V.right),V.output.connectTo(u.position);const p=new ZF("Create particle"),G=new FF("Box shape");p.particle.connectTo(G.particle),G.output.connectTo(u.particle);const R=new Su("Texture");R.texture.connectTo(B.texture),R.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(B)}removeBlock(B){const u=this.attachedBlocks.indexOf(B);if(u>-1&&this.attachedBlocks.splice(u,1),B.isSystem){const u=this._systemBlocks.indexOf(B);u>-1&&this._systemBlocks.splice(u,1)}}parseSerializedObject(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u||this.clear();const F={};for(const Z of B.HY){const B=(0,R.d)(Z.customType);if(B){const u=new B;u._deserialize(Z),F[Z.id]=u,this.attachedBlocks.push(u),u.isSystem&&this._systemBlocks.push(u)}}for(const Z of this.attachedBlocks)if(Z.isTeleportOut){const B=Z,u=B._tempEntryPointUniqueId;if(u){const Z=F[u];Z&&Z.attachToEndpoint(B)}}for(let Z=0;Z<B.HY.length;Z++){const V=B.HY[Z],p=F[V.id];p&&(p.inputs.length&&V.inputs.some((B=>B.targetConnectionName))&&!u||this._restoreConnections(p,B,F))}if(B.locations||B.editorData&&B.editorData.locations){const Z=B.locations||B.editorData.locations;for(const B of Z)F[B.KF]&&(B.KF=F[B.KF].uniqueId);u&&this.editorData&&this.editorData.locations&&Z.concat(this.editorData.locations),B.locations?this.editorData={locations:Z}:(this.editorData=B.editorData,this.editorData.locations=Z);const V=[];for(const B in F)V[B]=F[B].uniqueId;this.editorData.map=V}this.comment=B.comment}_restoreConnections(B,u,F){for(const Z of B.outputs)for(const V of u.HY){const p=F[V.id];if(p)for(const G of V.inputs)if(F[G.targetBlockId]!==B||G.targetConnectionName!==Z.name);else{const B=p.getInputByName(G.inputName);if(!B||B.isConnected)continue;Z.connectTo(B,!0),this._restoreConnections(p,u,F)}}}serialize(B){const u=B?{}:o.c.Serialize(this);u.editorData=JSON.parse(JSON.stringify(this.editorData));let F=[];B?F=B:u.customType="BABYLON.NodeParticleSystemSet",u.HY=[];for(const Z of F)u.HY.push(Z.serialize());if(!B)for(const Z of this.attachedBlocks)-1===F.indexOf(Z)&&u.HY.push(Z.serialize());return u}dispose(){for(const B of this.attachedBlocks)B.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(B){const u=new VF(B);return u.setToDefault(),u}static Parse(B){const u=o.c.Parse((()=>new VF(B.name)),B,null);return u.parseSerializedObject(B),u}static ParseFromSnippetAsync(B,u){return"_BLANK"===B?Promise.resolve(VF.CreateDefault("blank")):new Promise(((F,Z)=>{const V=new Ou.c;V.addEventListener("readystatechange",(()=>{if(4==V.readyState)if(200==V.status){const G=JSON.parse(JSON.parse(V.responseText).jsonPayload),R=JSON.parse(G.nodeParticle);u||(u=o.c.Parse((()=>new VF(B)),R,null)),u.parseSerializedObject(R),u.snippetId=B;try{F(u)}catch(p){Z(p)}}else Z("Unable to load the snippet "+B)})),V.open("GET",this.SnippetUrl+"/"+B.replace(/#/g,"/")),V.send()}))}}VF.EditorURL=`${Cu.Tools._DefaultCdnUrl}/v${KB.c.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,VF.SnippetUrl="https://snippet.babylonjs.com",(0,M.d)([(0,j.L)()],VF.prototype,"name",void 0),(0,M.d)([(0,j.L)("comment")],VF.prototype,"comment",void 0),function(B){B[B.None=0]="None",B[B.PerParticle=1]="PerParticle",B[B.PerSystem=2]="PerSystem"}(cu||(cu={}));class pF extends ru{constructor(B){super(B),this._currentLockId=-2,this.lockMode=cu.PerParticle,this.registerInput("min",Eu.AutoDetect,!0,0),this.registerInput("max",Eu.AutoDetect,!0,1),this.registerOutput("output",Eu.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Eu.Float|Eu.Int|Eu.Vector2|Eu.Du|Eu.gR),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Eu.Float|Eu.Int|Eu.Vector2|Eu.Du|Eu.gR),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=Eu.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let B=null;switch(this._currentLockId=-2,this.min.type){case Eu.AutoDetect:case Eu.Int:case Eu.Float:B=B=>{const u=this.min.getConnectedValue(B)||0,F=this.max.getConnectedValue(B)||1;return u+Math.random()*(F-u)};break;case Eu.Vector2:B=B=>{const u=this.min.getConnectedValue(B)||Z.Vector2.Zero(),F=this.max.getConnectedValue(B)||Z.Vector2.One();return new Z.Vector2(u.x+Math.random()*(F.x-u.x),u.y+Math.random()*(F.y-u.y))};break;case Eu.Du:B=B=>{const u=this.min.getConnectedValue(B)||Z.Du.Zero(),F=this.max.getConnectedValue(B)||Z.Du.One();return new Z.Du(u.x+Math.random()*(F.x-u.x),u.y+Math.random()*(F.y-u.y),u.z+Math.random()*(F.z-u.z))};break;case Eu.gR:B=B=>{const u=this.min.getConnectedValue(B)||new G.gR(0,0,0,0),F=this.max.getConnectedValue(B)||new G.gR(1,1,1,1);return new G.gR(u.x+Math.random()*(F.x-u.x),u.y+Math.random()*(F.y-u.y),u.z+Math.random()*(F.z-u.z),u.w+Math.random()*(F.w-u.w))}}this.output._storedFunction=u=>{var F;let Z=0;switch(this.lockMode){case cu.PerParticle:Z=(null===(F=u.particleContext)||void 0===F?void 0:F.id)||-1;break;case cu.PerSystem:Z=u.buildId||0}return this._currentLockId!==Z&&(this.lockMode!==cu.None&&(this._currentLockId=Z),this.output._storedValue=B(u)),this.output._storedValue}}serialize(){const B=super.serialize();return B.lockMode=this.lockMode,B}_deserialize(B){super._deserialize(B),this.lockMode=B.lockMode}}(0,M.d)([Ku("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cu.None},{label:"Per particle",value:cu.PerParticle},{label:"Per system",value:cu.PerSystem}]})],pF.prototype,"lockMode",void 0),(0,R.f)("BABYLON.ParticleRandomBlock",pF);class GF extends ru{constructor(B){super(B),this._currentLockId=-2,this.lockMode=cu.PerParticle,this.registerInput("min",Eu.AutoDetect),this.registerInput("max",Eu.AutoDetect),this.registerOutput("output",Eu.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const u=[Eu.Matrix,Eu.Particle,Eu.Texture,Eu.System,Eu.FloatGradient,Eu.Color4Gradient,Eu.Vector2Gradient,Eu.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...u),this.max.excludedConnectionPointTypes.push(...u)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let B=null;switch(this._currentLockId=-2,this.min.type){case Eu.Float:case Eu.Int:B=B=>{const u=this.min.getConnectedValue(B),F=this.max.getConnectedValue(B);return Math.random()*(F-u)+u};break;case Eu.Vector2:B=B=>{const u=this.min.getConnectedValue(B),F=this.max.getConnectedValue(B);return new Z.Vector2(Math.random()*(F.x-u.x)+u.x,Math.random()*(F.y-u.y)+u.y)};break;case Eu.Du:B=B=>{const u=this.min.getConnectedValue(B),F=this.max.getConnectedValue(B);return new Z.Du(Math.random()*(F.x-u.x)+u.x,Math.random()*(F.y-u.y)+u.y,Math.random()*(F.z-u.z)+u.z)};break;case Eu.gR:B=B=>{const u=this.min.getConnectedValue(B),F=this.max.getConnectedValue(B);return new G.gR(Math.random()*(F.r-u.r)+u.r,Math.random()*(F.g-u.g)+u.g,Math.random()*(F.b-u.b)+u.b,Math.random()*(F.a-u.a)+u.a)}}this.output._storedFunction=u=>{var F;let Z=0;switch(this.lockMode){case cu.PerParticle:Z=(null===(F=u.particleContext)||void 0===F?void 0:F.id)||-1;break;case cu.PerSystem:Z=u.buildId||0}return this._currentLockId!==Z&&(this.lockMode!==cu.None&&(this._currentLockId=Z),this.output._storedValue=B(u)),this.output._storedValue}}serialize(){const B=super.serialize();return B.lockMode=this.lockMode,B}_deserialize(B){super._deserialize(B),void 0!==B.lockMode&&(this.lockMode=B.lockMode)}}(0,M.d)([Ku("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:cu.None},{label:"Per particle",value:cu.PerParticle},{label:"Per system",value:cu.PerSystem}]})],GF.prototype,"lockMode",void 0),(0,R.f)("BABYLON.RandomRangeBlock",GF);(0,R.f)("BABYLON.ParticleLerpBlock",class extends ru{constructor(B){super(B),this.registerInput("left",Eu.AutoDetect),this.registerInput("right",Eu.AutoDetect),this.registerInput("gradient",Eu.Float,!0,0,0,1),this.registerOutput("output",Eu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Eu.Float|Eu.Int|Eu.Vector2|Eu.Du|Eu.gR)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const B=(B,u,F)=>(1-B)*u+B*F;this.output._storedFunction=u=>{const F=this.left.getConnectedValue(u),V=this.right.getConnectedValue(u),p=this.gradient.getConnectedValue(u);switch(this.left.type){case Eu.Int:case Eu.Float:return B(p,F,V);case Eu.Vector2:return new Z.Vector2(B(p,F.x,V.x),B(p,F.y,V.y));case Eu.Du:return new Z.Du(B(p,F.x,V.x),B(p,F.y,V.y),B(p,F.z,V.z));case Eu.gR:return new G.gR(B(p,F.r,V.r),B(p,F.g,V.g),B(p,F.b,V.b),B(p,F.a,V.a))}return 0}}});(0,R.f)("BABYLON.UpdateDirectionBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("direction",Eu.Du),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(B){const u=this.particle.getConnectedValue(B);if(this.output._storedValue=u,!this.direction.isConnected)return;const F={process:F=>{B.particleContext=F,B.systemContext=u,F.direction.Z(this.direction.getConnectedValue(B))},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F}});(0,R.f)("BABYLON.UpdateColorBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("color",Eu.gR),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(B){const u=this.particle.getConnectedValue(B);if(this.output._storedValue=u,!this.color.isConnected)return;const F={process:F=>{B.particleContext=F,B.systemContext=u,F.color.Z(this.color.getConnectedValue(B))},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F}});(0,R.f)("BABYLON.UpdateScaleBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("scale",Eu.Vector2),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(B){const u=this.particle.getConnectedValue(B);if(this.output._storedValue=u,!this.scale.isConnected)return;const F={process:F=>{B.particleContext=F,B.systemContext=u,F.scale.Z(this.scale.getConnectedValue(B))},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F}});(0,R.f)("BABYLON.UpdateAngleBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("angle",Eu.Float),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(B){const u=this.particle.getConnectedValue(B);if(this.output._storedValue=u,!this.angle.isConnected)return;const F={process:F=>{B.particleContext=F,B.systemContext=u,F.angle=this.angle.getConnectedValue(B)},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F}});(0,R.f)("BABYLON.BasicPositionUpdateBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(B){const u=this.particle.getConnectedValue(B),F={process:F=>{B.particleContext=F,B.systemContext=u,F.direction.scaleToRef(u._directionScale,u._scaledDirection),F.position.addInPlace(u._scaledDirection)},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F,this.output._storedValue=u}});(0,R.f)("BABYLON.BasicSpriteUpdateBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(B){const u=this.particle.getConnectedValue(B),F={process:F=>{B.particleContext=F,B.systemContext=u,F.updateCellIndex()},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F,this.output._storedValue=u}});(0,R.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("cellIndex",Eu.Int),this.registerOutput("output",Eu.Particle),this.cellIndex.acceptedConnectionPointTypes=[Eu.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(B){const u=this.particle.getConnectedValue(B);if(this.output._storedValue=u,!this.cellIndex.isConnected)return;const F={process:F=>{B.particleContext=F,B.systemContext=u,F.cellIndex=Math.floor(this.cellIndex.getConnectedValue(B))},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F}});class RF extends ru{constructor(B){super(B),this.strength=1,this.registerInput("particle",Eu.Particle),this.registerInput("flowMap",Eu.Texture),this.registerOutput("output",Eu.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(B){var u;const F=this.particle.getConnectedValue(B),Z=B.qu;let V;(null===(u=this.flowMap.connectedPoint)||void 0===u?void 0:u.ownerBlock).extractTextureContentAsync().then((B=>{B&&(V=new mF(B.width,B.height,B.data))}));const p={process:B=>{const u=Z.getTransformMatrix();V&&V._processParticle(B,this.strength*F._tempScaledUpdateSpeed,u)},previousItem:null,nextItem:null};F._updateQueueStart?lB(p,F._updateQueueStart):F._updateQueueStart=p,this.output._storedValue=F}serialize(){const B=super.serialize();return B.strength=this.strength,B}_deserialize(B){super._deserialize(B),this.strength=B.strength}}(0,M.d)([Ku("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],RF.prototype,"strength",void 0),(0,R.f)("BABYLON.UpdateFlowMapBlock",RF);(0,R.f)("BABYLON.SphereShapeBlock",class extends ru{constructor(B){super(B),this.registerInput("input",Eu.Particle),this.registerInput("radius",Eu.Float,!0,1),this.registerInput("radiusRange",Eu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Eu.Float,!0,0,0,1),this.registerOutput("output",Eu.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(B){const u=this.input.getConnectedValue(B);u._directionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.directionRandomizer.getConnectedValue(B),p=F.position.Lu(B.emitterPosition).normalize(),G=(0,s.RandomRange)(0,V),R=(0,s.RandomRange)(0,V),e=(0,s.RandomRange)(0,V);p.x+=G,p.y+=R,p.z+=e,p.normalize(),B.isEmitterTransformNode?Z.Du.TransformNormalFromFloatsToRef(G,R,e,B.emitterWorldMatrix,F.direction):F.direction.UR(G,R,e)},u._positionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.radius.getConnectedValue(B),p=this.radiusRange.getConnectedValue(B),G=V-(0,s.RandomRange)(0,V*p),R=(0,s.RandomRange)(0,1),e=(0,s.RandomRange)(0,2*Math.PI),Y=Math.acos(2*R-1),Q=G*Math.cos(e)*Math.sin(Y),t=G*Math.cos(Y),v=G*Math.sin(e)*Math.sin(Y);B.isEmitterTransformNode?Z.Du.TransformCoordinatesFromFloatsToRef(Q,t,v,B.emitterWorldMatrix,F.position):(F.position.UR(Q,t,v),F.position.addInPlace(B.emitterPosition))},this.output._storedValue=u}});(0,R.f)("BABYLON.PointShapeBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("direction1",Eu.Du,!0,new Z.Du(0,1,0)),this.registerInput("direction2",Eu.Du,!0,new Z.Du(0,1,0)),this.registerOutput("output",Eu.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){const u=this.particle.getConnectedValue(B);u._directionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.direction1.getConnectedValue(B),p=this.direction2.getConnectedValue(B),G=(0,s.RandomRange)(V.x,p.x),R=(0,s.RandomRange)(V.y,p.y),e=(0,s.RandomRange)(V.z,p.z);B.isEmitterTransformNode?Z.Du.TransformNormalFromFloatsToRef(G,R,e,B.emitterWorldMatrix,F.direction):F.direction.UR(G,R,e)},u._positionCreation.process=F=>{B.systemContext=u,B.isEmitterTransformNode?Z.Du.TransformCoordinatesFromFloatsToRef(0,0,0,B.emitterWorldMatrix,F.position):F.position.Z(B.emitterPosition)},this.output._storedValue=u}});(0,R.f)("BABYLON.CustomShapeBlock",class extends ru{constructor(B){super(B),this.registerInput("particle",Eu.Particle),this.registerInput("position",Eu.Du,!0,new Z.Du(0,0,0)),this.registerInput("direction",Eu.Du,!0,new Z.Du(0,1,0)),this.registerOutput("output",Eu.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){const u=this.particle.getConnectedValue(B);u._directionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.direction.getConnectedValue(B);B.isEmitterTransformNode?Z.Du.TransformNormalToRef(V,B.emitterWorldMatrix,F.direction):F.direction.Z(V)},u._positionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.position.getConnectedValue(B);B.isEmitterTransformNode?Z.Du.TransformCoordinatesToRef(V,B.emitterWorldMatrix,F.position):(F.position.Z(V),F.position.addInPlace(B.emitterPosition))},this.output._storedValue=u}});(0,R.f)("BABYLON.CylinderShapeBlock",class extends ru{constructor(B){super(B),this._tempVector=Z.Du.Zero(),this.registerInput("particle",Eu.Particle),this.registerInput("radius",Eu.Float,!0,1),this.registerInput("height",Eu.Float,!0,1,0),this.registerInput("radiusRange",Eu.Float,!0,1,0,1),this.registerInput("directionRandomizer",Eu.Float,!0,0,0,1),this.registerOutput("output",Eu.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(B){const u=this.particle.getConnectedValue(B);u._directionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.directionRandomizer.getConnectedValue(B);F.position.subtractToRef(B.emitterPosition,this._tempVector),this._tempVector.normalize(),B.isEmitterTransformNode&&Z.Du.TransformNormalToRef(this._tempVector,B.emitterInverseWorldMatrix,this._tempVector);const p=(0,s.RandomRange)(-V/2,V/2);let G=Math.atan2(this._tempVector.x,this._tempVector.z);G+=(0,s.RandomRange)(-Math.PI/2,Math.PI/2)*V,this._tempVector.y=p,this._tempVector.x=Math.sin(G),this._tempVector.z=Math.cos(G),this._tempVector.normalize(),B.isEmitterTransformNode?Z.Du.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,B.emitterWorldMatrix,F.direction):F.direction.Z(this._tempVector)},u._positionCreation.process=F=>{B.particleContext=F,B.systemContext=u;const V=this.height.getConnectedValue(B),p=this.radiusRange.getConnectedValue(B),G=this.radius.getConnectedValue(B),R=(0,s.RandomRange)(-V/2,V/2),e=(0,s.RandomRange)(0,2*Math.PI),Y=(0,s.RandomRange)((1-p)*(1-p),1),Q=Math.sqrt(Y)*G,t=Q*Math.cos(e),v=Q*Math.sin(e);B.isEmitterTransformNode?Z.Du.TransformCoordinatesFromFloatsToRef(t,R,v,B.emitterWorldMatrix,F.position):(F.position.UR(t,R,v),F.position.addInPlace(B.emitterPosition))},this.output._storedValue=u}});class eF extends ru{constructor(B){super(B),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",Eu.Particle),this.registerOutput("output",Eu.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);const u=this.particle.getConnectedValue(B);u._isAnimationSheetEnabled=!0,u.spriteCellWidth=this.width,u.spriteCellHeight=this.height,u.startSpriteCellID=this.start,u.endSpriteCellID=this.end,u.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=u}serialize(){const B=super.serialize();return B.width=this.width,B.height=this.height,B.start=this.start,B.end=this.end,B.randomStartCell=this.randomStartCell,B}_deserialize(B){super._deserialize(B),this.width=B.width,this.height=B.height,this.start=B.start,this.end=B.end,this.randomStartCell=B.randomStartCell}}(0,M.d)([Ku("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eF.prototype,"start",void 0),(0,M.d)([Ku("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eF.prototype,"end",void 0),(0,M.d)([Ku("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eF.prototype,"width",void 0),(0,M.d)([Ku("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],eF.prototype,"height",void 0),(0,M.d)([Ku("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eF.prototype,"loop",void 0),(0,M.d)([Ku("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],eF.prototype,"randomStartCell",void 0),(0,R.f)("BABYLON.SetupSpriteSheetBlock",eF);class sF extends ru{constructor(B){super(B),this.reference=0,this.registerInput("value",Eu.AutoDetect),this.registerOutput("output",Eu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=B=>{switch(B){case Eu.Float:return Eu.FloatGradient;case Eu.Vector2:return Eu.Vector2Gradient;case Eu.Du:return Eu.Vector3Gradient;case Eu.gR:return Eu.Color4Gradient}return B},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Eu.Float|Eu.Vector2|Eu.Du|Eu.gR)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=B=>null}serialize(){const B=super.serialize();return B.reference=this.reference,B}_deserialize(B){super._deserialize(B),this.reference=B.reference}}(0,M.d)([Ku("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],sF.prototype,"reference",void 0),(0,R.f)("BABYLON.ParticleGradientValueBlock",sF);(0,R.f)("BABYLON.ParticleGradientBlock",class extends ru{constructor(B){super(B),this._entryCount=1,this.registerInput("gradient",Eu.Float,!0,1,0,1),this.registerInput("value0",Eu.AutoDetect),this.registerOutput("output",Eu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=B=>{switch(B){case Eu.FloatGradient:return Eu.Float;case Eu.Vector2Gradient:return Eu.Vector2;case Eu.Vector3Gradient:return Eu.Du;case Eu.Color4Gradient:return Eu.gR}return B},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(Eu.FloatGradient|Eu.Vector2Gradient|Eu.Vector3Gradient|Eu.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(B){this._inputs[B].onConnectionObservable.add((()=>{this._entryCount>B||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),Eu.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const B=[];for(let F=1;F<this._inputs.length;F++){var u;if(this._inputs[F].isConnected)B.push(null===(u=this._inputs[F].connectedPoint)||void 0===u?void 0:u.ownerBlock)}B.sort(((B,u)=>B.reference-u.reference)),this.output._storedFunction=u=>{const F=this.gradient.getConnectedValue(u);if(1===B.length)return B[0].value.getConnectedValue(u);let V=null;for(let p=B.length-1;p>=0;p--){const R=B[p];if(R.reference<=F){const B=R.value.getConnectedValue(u);if(V){const p=V.value.getConnectedValue(u),e=V.reference,Y=R.reference,Q=Math.max(0,Math.min(1,(F-Y)/(e-Y)));switch(this.output.type){case Eu.Float:return(0,s.Lerp)(B,p,Q);case Eu.Vector2:return Z.Vector2.Lerp(B,p,Q);case Eu.Du:return Z.Du.Lerp(B,p,Q);case Eu.gR:return G.gR.Lerp(B,p,Q)}}return B}V=R}return 0}}});(0,R.f)("BABYLON.ParticleConverterBlock",class extends ru{constructor(B){super(B),this.registerInput("color ",Eu.gR,!0),this.registerInput("xyz ",Eu.Du,!0),this.registerInput("xy ",Eu.Vector2,!0),this.registerInput("zw ",Eu.Vector2,!0),this.registerInput("x ",Eu.Float,!0),this.registerInput("y ",Eu.Float,!0),this.registerInput("z ",Eu.Float,!0),this.registerInput("w ",Eu.Float,!0),this.registerOutput("color",Eu.gR),this.registerOutput("xyz",Eu.Du),this.registerOutput("xy",Eu.Vector2),this.registerOutput("zw",Eu.Vector2),this.registerOutput("x",Eu.Float),this.registerOutput("y",Eu.Float),this.registerOutput("z",Eu.Float),this.registerOutput("w",Eu.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(B){return"color "===B?"colorIn":"xyz "===B?"xyzIn":"xy "===B?"xyIn":"zw "===B?"zwIn":"x "===B?"xIn":"y "===B?"yIn":"z "===B?"zIn":"w "===B?"wIn":B}_outputRename(B){switch(B){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return B}}_build(B){super._build(B);const u=this.xIn,F=this.yIn,V=this.zIn,p=this.wIn,R=this.xyIn,e=this.zwIn,s=this.xyzIn,Y=this.colorIn,Q=this.colorOut,t=this.xyzOut,v=this.xyOut,D=this.zwOut,L=this.xOut,q=this.yOut,W=this.zOut,X=this.wOut,f=B=>{if(Y.isConnected)return Y.getConnectedValue(B);let Z=0,Q=0,t=0,v=0;if(u.isConnected&&(Z=u.getConnectedValue(B)),F.isConnected&&(Q=F.getConnectedValue(B)),V.isConnected&&(t=V.getConnectedValue(B)),p.isConnected&&(v=p.getConnectedValue(B)),R.isConnected){const u=R.getConnectedValue(B);u&&(Z=u.x,Q=u.y)}if(e.isConnected){const u=e.getConnectedValue(B);u&&(t=u.x,v=u.y)}if(s.isConnected){const u=s.getConnectedValue(B);u&&(Z=u.x,Q=u.y,t=u.z)}return new G.gR(Z,Q,t,v)};Q._storedFunction=B=>f(B),t._storedFunction=B=>{const u=f(B);return new Z.Du(u.r,u.g,u.b)},v._storedFunction=B=>{const u=f(B);return new Z.Vector2(u.r,u.g)},D._storedFunction=B=>{const u=f(B);return new Z.Vector2(u.b,u.a)},L._storedFunction=B=>f(B).r,q._storedFunction=B=>f(B).g,W._storedFunction=B=>f(B).b,X._storedFunction=B=>f(B).a}}),function(B){B[B.Cos=0]="Cos",B[B.Sin=1]="Sin",B[B.Abs=2]="Abs",B[B.Exp=3]="Exp",B[B.Exp2=4]="Exp2",B[B.Round=5]="Round",B[B.Floor=6]="Floor",B[B.Ceiling=7]="Ceiling",B[B.Sqrt=8]="Sqrt",B[B.Log=9]="Log",B[B.Tan=10]="Tan",B[B.ArcTan=11]="ArcTan",B[B.ArcCos=12]="ArcCos",B[B.ArcSin=13]="ArcSin",B[B.Sign=14]="Sign",B[B.Negate=15]="Negate",B[B.OneMinus=16]="OneMinus",B[B.Reciprocal=17]="Reciprocal",B[B.ToDegrees=18]="ToDegrees",B[B.ToRadians=19]="ToRadians",B[B.Fract=20]="Fract"}(hu||(hu={}));class YF extends ru{constructor(B){super(B),this.operation=hu.Cos,this.registerInput("input",Eu.AutoDetect),this.registerOutput("output",Eu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(Eu.Float|Eu.Int|Eu.Vector2|Eu.Du|Eu.gR)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);let u=null;switch(this.operation){case hu.Cos:u=B=>Math.cos(B);break;case hu.Sin:u=B=>Math.sin(B);break;case hu.Abs:u=B=>Math.abs(B);break;case hu.Exp:u=B=>Math.exp(B);break;case hu.Exp2:u=B=>Math.pow(2,B);break;case hu.Round:u=B=>Math.round(B);break;case hu.Floor:u=B=>Math.floor(B);break;case hu.Ceiling:u=B=>Math.ceil(B);break;case hu.Sqrt:u=B=>Math.sqrt(B);break;case hu.Log:u=B=>Math.log(B);break;case hu.Tan:u=B=>Math.tan(B);break;case hu.ArcTan:u=B=>Math.atan(B);break;case hu.ArcCos:u=B=>Math.acos(B);break;case hu.ArcSin:u=B=>Math.asin(B);break;case hu.Sign:u=B=>Math.sign(B);break;case hu.Negate:u=B=>-B;break;case hu.OneMinus:u=B=>1-B;break;case hu.Reciprocal:u=B=>1/B;break;case hu.ToRadians:u=B=>B*Math.PI/180;break;case hu.ToDegrees:u=B=>180*B/Math.PI;break;case hu.Fract:u=B=>B>=0?B-Math.floor(B):B-Math.ceil(B)}if(!u)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case Eu.Int:case Eu.Float:this.output._storedFunction=B=>{const F=this.input.getConnectedValue(B);return u(F)};break;case Eu.Vector2:this.output._storedFunction=B=>{const F=this.input.getConnectedValue(B);return new Z.Vector2(u(F.x),u(F.y))};break;case Eu.Du:this.output._storedFunction=B=>{const F=this.input.getConnectedValue(B);return new Z.Du(u(F.x),u(F.y),u(F.z))};break;case Eu.gR:this.output._storedFunction=B=>{const F=this.input.getConnectedValue(B);return new G.gR(u(F.r),u(F.g),u(F.b),u(F.a))}}return this}serialize(){const B=super.serialize();return B.operation=this.operation,B}_deserialize(B){super._deserialize(B),this.operation=B.operation}}(0,M.d)([Ku("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:hu.Cos},{label:"Sin",value:hu.Sin},{label:"Abs",value:hu.Abs},{label:"Exp",value:hu.Exp},{label:"Exp2",value:hu.Exp2},{label:"Round",value:hu.Round},{label:"Floor",value:hu.Floor},{label:"Ceiling",value:hu.Ceiling},{label:"Sqrt",value:hu.Sqrt},{label:"Log",value:hu.Log},{label:"Tan",value:hu.Tan},{label:"ArcTan",value:hu.ArcTan},{label:"ArcCos",value:hu.ArcCos},{label:"ArcSin",value:hu.ArcSin},{label:"Sign",value:hu.Sign},{label:"Negate",value:hu.Negate},{label:"OneMinus",value:hu.OneMinus},{label:"Reciprocal",value:hu.Reciprocal},{label:"ToDegrees",value:hu.ToDegrees},{label:"ToRadians",value:hu.ToRadians},{label:"Fract",value:hu.Fract}]})],YF.prototype,"operation",void 0),(0,R.f)("BABYLON.ParticleTrigonometryBlock",YF);var QF,tF=F(14354);class vF extends ru{constructor(B){super(B),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",Eu.AutoDetect),this.registerOutput("output",Eu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(Eu.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(Eu.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(Eu.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(Eu.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(Eu.System),this._inputs[0].excludedConnectionPointTypes.push(Eu.Particle),this._inputs[0].excludedConnectionPointTypes.push(Eu.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const u=B=>{const u=this.input.getConnectedValue(B);if(this.log.length>=this.stackSize)return u;if(null===u||void 0===u)return this.log.push(["null",""]),u;switch(this.input.type){case Eu.Vector2:this.log.push([(0,tF.f)(u,4),u.toString()]);break;case Eu.Du:this.log.push([(0,tF.h)(u,4),u.toString()]);break;case Eu.gR:this.log.push([`{R: ${u.r.toFixed(4)} G: ${u.g.toFixed(4)} B: ${u.b.toFixed(4)} A: ${u.a.toFixed(4)}}`,u.toString()]);break;default:this.log.push([u.toString(),u.toString()])}return u};this.output.isConnected?this.output._storedFunction=u:this.output._storedValue=u(B)}serialize(){const B=super.serialize();return B.stackSize=this.stackSize,B}_deserialize(B){super._deserialize(B),this.stackSize=B.stackSize}}(0,M.d)([Ku("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],vF.prototype,"stackSize",void 0),(0,R.f)("BABYLON.ParticleDebugBlock",vF);(0,R.f)("BABYLON.ParticleElbowBlock",class extends ru{constructor(B){super(B),this.registerInput("input",Eu.AutoDetect),this.registerOutput("output",Eu.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(B){super._build(B);const u=this._outputs[0],F=this._inputs[0];u._storedFunction=B=>F.getConnectedValue(B)}});(0,R.f)("BABYLON.ParticleTeleportInBlock",class extends ru{get endpoints(){return this._endpoints}constructor(B){super(B),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",Eu.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(B){if(this.getClassName()===B)return!0;for(const u of this.endpoints)if(u.isAnAncestorOfType(B))return!0;return!1}isAnAncestorOf(B){for(const u of this.endpoints){if(u===B)return!0;if(u.isAnAncestorOf(B))return!0}return!1}attachToEndpoint(B){B.detach(),this._endpoints.push(B),B._entryPoint=this,B._outputs[0]._typeConnectionSource=this._inputs[0],B._tempEntryPointUniqueId=null,B.name="> "+this.name}detachFromEndpoint(B){const u=this._endpoints.indexOf(B);-1!==u&&(this._endpoints.splice(u,1),B._outputs[0]._typeConnectionSource=null,B._entryPoint=null)}_build(){for(const B of this._endpoints)B.output._storedFunction=B=>this.input.getConnectedValue(B)}});(0,R.f)("BABYLON.ParticleTeleportOutBlock",class extends ru{constructor(B){super(B),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",Eu.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(B){this.entryPoint&&this.entryPoint.build(B)}clone(){const B=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(B),B}serialize(){var B;const u=super.serialize();return u.entryPoint=(null===(B=this.entryPoint)||void 0===B?void 0:B.uniqueId)??"",u}_deserialize(B){super._deserialize(B),this._tempEntryPointUniqueId=B.entryPoint}}),function(B){B[B.Equal=0]="Equal",B[B.NotEqual=1]="NotEqual",B[B.LessThan=2]="LessThan",B[B.GreaterThan=3]="GreaterThan",B[B.LessOrEqual=4]="LessOrEqual",B[B.GreaterOrEqual=5]="GreaterOrEqual",B[B.Xor=6]="Xor",B[B.Or=7]="Or",B[B.And=8]="And"}(QF||(QF={}));class DF extends ru{constructor(B){super(B),this.test=QF.Equal,this.epsilon=0,this.registerInput("left",Eu.Float),this.registerInput("right",Eu.Float,!0,0),this.registerInput("ifTrue",Eu.AutoDetect,!0,1),this.registerInput("ifFalse",Eu.AutoDetect,!0,0),this.registerOutput("output",Eu.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=Eu.Float,this._inputs[0].acceptedConnectionPointTypes.push(Eu.Int),this._inputs[1].acceptedConnectionPointTypes.push(Eu.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const B=B=>{const u=this.left.getConnectedValue(B),F=this.right.getConnectedValue(B);let Z=!1;switch(this.test){case QF.Equal:Z=(0,s.WithinEpsilon)(u,F,this.epsilon);break;case QF.NotEqual:Z=!(0,s.WithinEpsilon)(u,F,this.epsilon);break;case QF.LessThan:Z=u<F+this.epsilon;break;case QF.GreaterThan:Z=u>F-this.epsilon;break;case QF.LessOrEqual:Z=u<=F+this.epsilon;break;case QF.GreaterOrEqual:Z=u>=F-this.epsilon;break;case QF.Xor:Z=!!u&&!F||!u&&!!F;break;case QF.Or:Z=!!u||!!F;break;case QF.And:Z=!!u&&!!F}return Z};this.output._storedFunction=u=>B(u)?this.ifTrue.getConnectedValue(u):this.ifFalse.getConnectedValue(u)}serialize(){const B=super.serialize();return B.test=this.test,B.epsilon=this.epsilon,B}_deserialize(B){super._deserialize(B),this.test=B.test,void 0!==B.epsilon&&(this.epsilon=B.epsilon)}}(0,M.d)([Ku("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:QF.Equal},{label:"NotEqual",value:QF.NotEqual},{label:"LessThan",value:QF.LessThan},{label:"GreaterThan",value:QF.GreaterThan},{label:"LessOrEqual",value:QF.LessOrEqual},{label:"GreaterOrEqual",value:QF.GreaterOrEqual},{label:"Xor",value:QF.Xor},{label:"Or",value:QF.Or},{label:"And",value:QF.And}]})],DF.prototype,"test",void 0),(0,M.d)([Ku("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],DF.prototype,"epsilon",void 0),(0,R.f)("BABYLON.ParticleConditionBlock",DF);class LF extends ru{constructor(B){super(B),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",Eu.Particle),this.registerInput("condition",Eu.Float,!0,0),this.registerInput("system",Eu.System),this.registerOutput("output",Eu.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(B){this._triggerCount=0;const u=this.input.getConnectedValue(B),F={process:F=>{if(B.particleContext=F,B.systemContext=u,0!==this.condition.getConnectedValue(B)&&(0===this.limit||this._triggerCount<this.limit)){const Z=(new Date).getTime();if(this._previousOne&&Z-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=Z;const V=this.system.getConnectedValue(B);if(V){const Z=Au(V,B.qu,F.position);Z.GR.addOnce((()=>{this._triggerCount--})),u.GR.addOnce((()=>{Z.dispose()}))}}},previousItem:null,nextItem:null};u._updateQueueStart?lB(F,u._updateQueueStart):u._updateQueueStart=F,this.output._storedValue=u}serialize(){const B=super.serialize();return B.limit=this.limit,B.delay=this.delay,B}_deserialize(B){super._deserialize(B),void 0!==B.limit&&(this.limit=B.limit),void 0!==B.delay&&(this.delay=B.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,M.d)([Ku("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LF.prototype,"limit",void 0),(0,M.d)([Ku("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],LF.prototype,"delay",void 0),(0,R.f)("BABYLON.ParticleTriggerBlock",LF);F(14363),F(14372),F(14383),F(14450)},14431:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneFragment",p="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14392:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneFragmentDeclaration",p="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14469:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneVertex",p="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14459:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneVertexDeclaration",p="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14442:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogFragment",p="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14428:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogFragmentDeclaration",p="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14474:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogVertex",p="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14466:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogVertexDeclaration",p="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14410:(B,u,F)=>{"use strict";var Z=F(12897);const V="helperFunctions",p="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14399:(B,u,F)=>{"use strict";var Z=F(12897);const V="imageProcessingDeclaration",p="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14419:(B,u,F)=>{"use strict";var Z=F(12897);const V="imageProcessingFunctions",p="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14401:(B,u,F)=>{"use strict";var Z=F(12897);const V="logDepthDeclaration",p="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14436:(B,u,F)=>{"use strict";var Z=F(12897);const V="logDepthFragment",p="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14481:(B,u,F)=>{"use strict";var Z=F(12897);const V="logDepthVertex",p="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";Z.c.IncludesShadersStoreWGSL[V]||(Z.c.IncludesShadersStoreWGSL[V]=p)},14383:(B,u,F)=>{"use strict";F.r(u),F.d(u,{particlesPixelShaderWGSL:()=>G});var Z=F(12897);F(14392),F(14399),F(14401),F(14410),F(14419),F(14428),F(14431),F(14436),F(14442);const V="particlesPixelShader",p="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Z.c.ShadersStoreWGSL[V]||(Z.c.ShadersStoreWGSL[V]=p);const G={name:V,shader:p}},14450:(B,u,F)=>{"use strict";F.r(u),F.d(u,{particlesVertexShaderWGSL:()=>G});var Z=F(12897);F(14459),F(14466),F(14401),F(14469),F(14474),F(14481);const V="particlesVertexShader",p="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Z.c.ShadersStoreWGSL[V]||(Z.c.ShadersStoreWGSL[V]=p);const G={name:V,shader:p}},14287:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneFragment",p="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14365:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneFragmentDeclaration",p="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14313:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneVertex",p="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14374:(B,u,F)=>{"use strict";var Z=F(12897);const V="clipPlaneVertexDeclaration",p="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14299:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogFragment",p="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14282:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogFragmentDeclaration",p="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14321:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogVertex",p="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14305:(B,u,F)=>{"use strict";var Z=F(12897);const V="fogVertexDeclaration",p="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14271:(B,u,F)=>{"use strict";var Z=F(12897);const V="helperFunctions",p="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14257:(B,u,F)=>{"use strict";var Z=F(12897);const V="imageProcessingDeclaration",p="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14277:(B,u,F)=>{"use strict";var Z=F(12897);const V="imageProcessingFunctions",p="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14265:(B,u,F)=>{"use strict";var Z=F(12897);const V="logDepthDeclaration",p="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14294:(B,u,F)=>{"use strict";var Z=F(12897);const V="logDepthFragment",p="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14323:(B,u,F)=>{"use strict";var Z=F(12897);const V="logDepthVertex",p="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";Z.c.IncludesShadersStore[V]||(Z.c.IncludesShadersStore[V]=p)},14363:(B,u,F)=>{"use strict";F.r(u),F.d(u,{particlesPixelShader:()=>G});var Z=F(12897);F(14365),F(14257),F(14265),F(14271),F(14277),F(14282),F(14287),F(14294),F(14299);const V="particlesPixelShader",p="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";Z.c.ShadersStore[V]||(Z.c.ShadersStore[V]=p);const G={name:V,shader:p}},14372:(B,u,F)=>{"use strict";F.r(u),F.d(u,{particlesVertexShader:()=>G});var Z=F(12897);F(14374),F(14305),F(14265),F(14313),F(14321),F(14323);const V="particlesVertexShader",p="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";Z.c.ShadersStore[V]||(Z.c.ShadersStore[V]=p);const G={name:V,shader:p}},14743:(B,u,F)=>{"use strict";F.r(u),F.d(u,{FlowGraphGLTFDataProvider:()=>p});var Z=F(14720),V=F(14701);class p extends Z.e{constructor(B){var u,F;super();const Z=B.glTF,p=(null===(u=Z.animations)||void 0===u?void 0:u.map((B=>B._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",V.c,p);const G=(null===(F=Z.nodes)||void 0===F?void 0:F.map((B=>B._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",V.c,G)}getClassName(){return"FlowGraphGLTFDataProvider"}}},14644:(B,u,F)=>{"use strict";F.d(u,{b:()=>q,f:()=>D,h:()=>v,i:()=>L});var Z=F(12979),V=F(13446),p=F(13023),G=F(14648);const R=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class e{constructor(B,u){this._gltf=B,this._infoTree=u}convert(B){let u,F=this._gltf,Z=this._infoTree;if(!B.startsWith("/"))throw new Error("Path must start with a /");const V=B.split("/");if(V.shift(),V[V.length-1].includes(".length")){const B=V[V.length-1].split(".");V.pop(),V.push(...B)}let p=!1;for(const e of V){const V="length"===e;if(V&&!Z.__array__)throw new Error(`Path ${B} is invalid`);if(Z.__ignoreObjectTree__&&(p=!0),Z.__array__&&!V)Z=Z.__array__;else if(Z=Z[e],!Z)throw new Error(`Path ${B} is invalid`);if(!p)if(void 0===F){if(!R.find((u=>u.regex.test(B))))throw new Error(`Path ${B} is invalid`)}else if(!V){var G;F=null===(G=F)||void 0===G?void 0:G[e]}(Z.__target__||V)&&(u=F)}return{object:u,info:Z}}}function s(B,u,F,Z){const V=Y(B,u);return Z?V[F][Z]:V[F]}function Y(B,u,F){var Z,p;return null===(Z=B._data)||void 0===Z||null===(p=Z[(null===F||void 0===F?void 0:F.fillMode)??V.d.MATERIAL_TriangleFillMode])||void 0===p?void 0:p.babylonMaterial}function Q(B,u){return{offset:{componentsCount:2,type:"Vector2",get:(F,V,p)=>{const G=s(F,p,B,u);return new Z.Vector2(null===G||void 0===G?void 0:G.uOffset,null===G||void 0===G?void 0:G.vOffset)},getTarget:Y,set:(F,Z,V,p)=>{const G=s(Z,p,B,u);G.uOffset=F.x,G.vOffset=F.y},getPropertyName:[()=>`${B}${u?"."+u:""}.uOffset`,()=>`${B}${u?"."+u:""}.vOffset`]},rotation:{type:"number",get:(F,Z,V)=>{var p;return null===(p=s(F,V,B,u))||void 0===p?void 0:p.wAng},getTarget:Y,set:(F,Z,V,p)=>s(Z,p,B,u).wAng=F,getPropertyName:[()=>`${B}${u?"."+u:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(F,V,p)=>{const G=s(F,p,B,u);return new Z.Vector2(null===G||void 0===G?void 0:G.uScale,null===G||void 0===G?void 0:G.vScale)},getTarget:Y,set:(F,Z,V,p)=>{const G=s(Z,p,B,u);G.uScale=F.x,G.vScale=F.y},getPropertyName:[()=>`${B}${u?"."+u:""}.uScale`,()=>`${B}${u?"."+u:""}.vScale`]}}}const t={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:B=>{var u,F;return new Z.Vector2((null===(u=B._babylonCamera)||void 0===u?void 0:u.orthoLeft)??0,(null===(F=B._babylonCamera)||void 0===F?void 0:F.orthoRight)??0)},set:(B,u)=>{u._babylonCamera&&(u._babylonCamera.orthoLeft=B.x,u._babylonCamera.orthoRight=B.y)},getTarget:B=>B,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:B=>{var u,F;return new Z.Vector2((null===(u=B._babylonCamera)||void 0===u?void 0:u.orthoBottom)??0,(null===(F=B._babylonCamera)||void 0===F?void 0:F.orthoTop)??0)},set:(B,u)=>{u._babylonCamera&&(u._babylonCamera.orthoBottom=B.x,u._babylonCamera.orthoTop=B.y)},getTarget:B=>B,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:B=>{var u;return null===(u=B._babylonCamera)||void 0===u?void 0:u.maxZ},set:(B,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=B)},getTarget:B=>B,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:B=>{var u;return null===(u=B._babylonCamera)||void 0===u?void 0:u.qR},set:(B,u)=>{u._babylonCamera&&(u._babylonCamera.qR=B)},getTarget:B=>B,getPropertyName:[()=>"qR"]}},perspective:{aspectRatio:{type:"number",get:B=>{var u;return null===(u=B._babylonCamera)||void 0===u?void 0:u.getEngine().getAspectRatio(B._babylonCamera)},getTarget:B=>B,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:B=>{var u;return null===(u=B._babylonCamera)||void 0===u?void 0:u.fov},set:(B,u)=>{u._babylonCamera&&(u._babylonCamera.fov=B)},getTarget:B=>B,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:B=>{var u;return null===(u=B._babylonCamera)||void 0===u?void 0:u.maxZ},set:(B,u)=>{u._babylonCamera&&(u._babylonCamera.maxZ=B)},getTarget:B=>B,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:B=>{var u;return null===(u=B._babylonCamera)||void 0===u?void 0:u.qR},set:(B,u)=>{u._babylonCamera&&(u._babylonCamera.qR=B)},getTarget:B=>B,getPropertyName:[()=>"qR"]}}}},nodes:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"Du",get:B=>{var u;return null===(u=B._babylonTransformNode)||void 0===u?void 0:u.position},set:(B,u)=>{var F;return null===(F=u._babylonTransformNode)||void 0===F?void 0:F.position.Z(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:B=>{var u;return null===(u=B._babylonTransformNode)||void 0===u?void 0:u.rotationQuaternion},set:(B,u)=>{var F,Z;return null===(F=u._babylonTransformNode)||void 0===F||null===(Z=F.rotationQuaternion)||void 0===Z?void 0:Z.Z(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"Du",get:B=>{var u;return null===(u=B._babylonTransformNode)||void 0===u?void 0:u.yR},set:(B,u)=>{var F;return null===(F=u._babylonTransformNode)||void 0===F?void 0:F.yR.Z(B)},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"yR"]},weights:{length:{type:"number",get:B=>B._numMorphTargets,getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(B,u)=>{var F,Z;return void 0!==u?null===(F=B._primitiveBabylonMeshes)||void 0===F||null===(Z=F[0].morphTargetManager)||void 0===Z?void 0:Z.getTarget(u).influence:void 0},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(B,u)=>[0],getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:B=>{var u,F,V;return Z.Matrix.Compose(null===(u=B._babylonTransformNode)||void 0===u?void 0:u.yR,null===(F=B._babylonTransformNode)||void 0===F?void 0:F.rotationQuaternion,null===(V=B._babylonTransformNode)||void 0===V?void 0:V.position)},getTarget:B=>B._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:B=>{var u,F,V,p;const G=Z.Matrix.Identity();let R=B.parent;for(;R&&R.parent;)R=R.parent;const e=(null===(u=B._babylonTransformNode)||void 0===u?void 0:u.position._isDirty)||(null===(F=B._babylonTransformNode)||void 0===F||null===(V=F.rotationQuaternion)||void 0===V?void 0:V._isDirty)||(null===(p=B._babylonTransformNode)||void 0===p?void 0:p.yR._isDirty);if(R){var s;const u=null===(s=R._babylonTransformNode)||void 0===s?void 0:s.XR(!0).invert();var Y,Q;if(u)null===(Y=B._babylonTransformNode)||void 0===Y||null===(Q=Y.XR(e))||void 0===Q||Q.multiplyToRef(u,G)}else B._babylonTransformNode&&G.Z(B._babylonTransformNode.XR(e));return G},getTarget:B=>B._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:B=>{var u,F;return null===(u=B._babylonTransformNode)||void 0===u||null===(F=u.getChildren((B=>B instanceof G.e),!0)[0])||void 0===F?void 0:F.TR},getTarget:B=>{var u;return null===(u=B._babylonTransformNode)||void 0===u?void 0:u.getChildren((B=>B instanceof G.e),!0)[0]},set:(B,u)=>{if(u._babylonTransformNode){const F=u._babylonTransformNode.getChildren((B=>B instanceof G.e),!0)[0];F&&(F.TR=B)}}},color:{type:"Xu",get:B=>{var u,F;return null===(u=B._babylonTransformNode)||void 0===u||null===(F=u.getChildren((B=>B instanceof G.e),!0)[0])||void 0===F?void 0:F.zR},getTarget:B=>{var u;return null===(u=B._babylonTransformNode)||void 0===u?void 0:u.getChildren((B=>B instanceof G.e),!0)[0]},set:(B,u)=>{if(u._babylonTransformNode){const F=u._babylonTransformNode.getChildren((B=>B instanceof G.e),!0)[0];F&&(F.zR=B)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Xu",get:(B,u,F)=>Y(B,u,F).emissiveColor,set:(B,u,F,Z)=>Y(u,F,Z).emissiveColor.Z(B),getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:Q("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(B,u,F)=>{var Z;return null===(Z=s(B,F,"bumpTexture"))||void 0===Z?void 0:Z.level},set:(B,u,F,Z)=>{const V=s(u,Z,"bumpTexture");V&&(V.level=B)},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:Q("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(B,u,F)=>Y(B,u,F).ambientTextureStrength,set:(B,u,F,Z)=>{const V=Y(u,F,Z);V&&(V.ambientTextureStrength=B)},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:Q("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"gR",get:(B,u,F)=>{const Z=Y(B,u,F);return p.gR.FromColor3(Z.albedoColor,Z.alpha)},set:(B,u,F,Z)=>{const V=Y(u,F,Z);V.albedoColor.set(B.r,B.g,B.b),V.alpha=B.a},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:Q("albedoTexture")}},metallicFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).metallic,set:(B,u,F,Z)=>{const V=Y(u,F,Z);V&&(V.metallic=B)},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).roughness,set:(B,u,F,Z)=>{const V=Y(u,F,Z);V&&(V.roughness=B)},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Q("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(B,u,F)=>Y(B,u,F).anisotropy.TR,set:(B,u,F,Z)=>{Y(u,F,Z).anisotropy.TR=B},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(B,u,F)=>Y(B,u,F).anisotropy.angle,set:(B,u,F,Z)=>{Y(u,F,Z).anisotropy.angle=B},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:Q("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).clearCoat.TR,set:(B,u,F,Z)=>{Y(u,F,Z).clearCoat.TR=B},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).clearCoat.roughness,set:(B,u,F,Z)=>{Y(u,F,Z).clearCoat.roughness=B},getTarget:(B,u,F)=>Y(B,u,F),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:Q("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(B,u,F)=>{var Z;return null===(Z=Y(B,u,F).clearCoat.bumpTexture)||void 0===Z?void 0:Z.level},getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).clearCoat.bumpTexture.level=B},extensions:{KHR_texture_transform:Q("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Q("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(B,u,F)=>Y(B,u,F).subSurface.dispersion,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).subSurface.dispersion=B}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(B,u,F)=>Y(B,u,F).emissiveIntensity,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).emissiveIntensity=B}},KHR_materials_ior:{ior:{type:"number",get:(B,u,F)=>Y(B,u,F).indexOfRefraction,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).indexOfRefraction=B}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).iridescence.TR,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).iridescence.TR=B},iridescenceIor:{type:"number",get:(B,u,F)=>Y(B,u,F).iridescence.indexOfRefraction,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).iridescence.indexOfRefraction=B},iridescenceTexture:{extensions:{KHR_texture_transform:Q("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(B,u,F)=>Y(B,u,F).iridescence.maximumThickness,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).iridescence.maximumThickness=B},iridescenceThicknessMinimum:{type:"number",get:(B,u,F)=>Y(B,u,F).iridescence.minimumThickness,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).iridescence.minimumThickness=B},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Q("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Xu",get:(B,u,F)=>Y(B,u,F).sheen.color,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).sheen.color.Z(B)},sheenColorTexture:{extensions:{KHR_texture_transform:Q("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).sheen.TR,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).sheen.TR=B},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Q("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).metallicF0Factor,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).metallicF0Factor=B,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"Xu",get:(B,u,F)=>Y(B,u,F).metallicReflectanceColor,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).metallicReflectanceColor.Z(B),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:Q("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Q("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).subSurface.refractionIntensity,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).subSurface.refractionIntensity=B,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).subSurface.translucencyIntensity,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).subSurface.translucencyIntensity=B},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Xu",get:(B,u,F)=>Y(B,u,F).subSurface.translucencyColor,getTarget:Y,set:(B,u,F,Z)=>{var V;return B&&(null===(V=Y(u,F,Z).subSurface.translucencyColor)||void 0===V?void 0:V.Z(B))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Q("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Xu",get:(B,u,F)=>Y(B,u,F).subSurface.tintColor,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).subSurface.tintColor.Z(B)},attenuationDistance:{type:"number",get:(B,u,F)=>Y(B,u,F).subSurface.tintColorAtDistance,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).subSurface.tintColorAtDistance=B},thicknessFactor:{type:"number",get:(B,u,F)=>Y(B,u,F).subSurface.maximumThickness,getTarget:Y,set:(B,u,F,Z)=>Y(u,F,Z).subSurface.maximumThickness=B},thicknessTexture:{extensions:{KHR_texture_transform:Q("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonLight)),getPropertyName:[B=>"length"]},__array__:{__target__:!0,color:{type:"Xu",get:B=>{var u;return null===(u=B._babylonLight)||void 0===u?void 0:u.zR},set:(B,u)=>{var F;return null===(F=u._babylonLight)||void 0===F?void 0:F.zR.Z(B)},getTarget:B=>B._babylonLight,getPropertyName:[B=>"diffuse"]},TR:{type:"number",get:B=>{var u;return null===(u=B._babylonLight)||void 0===u?void 0:u.TR},set:(B,u)=>u._babylonLight?u._babylonLight.TR=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"intensity"]},range:{type:"number",get:B=>{var u;return null===(u=B._babylonLight)||void 0===u?void 0:u.range},set:(B,u)=>u._babylonLight?u._babylonLight.range=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"range"]},spot:{innerConeAngle:{type:"number",get:B=>{var u;return null===(u=B._babylonLight)||void 0===u?void 0:u.innerAngle},set:(B,u)=>u._babylonLight?u._babylonLight.innerAngle=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"innerConeAngle"]},outerConeAngle:{type:"number",get:B=>{var u;return null===(u=B._babylonLight)||void 0===u?void 0:u.angle},set:(B,u)=>u._babylonLight?u._babylonLight.angle=B:void 0,getTarget:B=>B._babylonLight,getPropertyName:[B=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonLight)),getPropertyName:[B=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonTexture)),getPropertyName:[B=>"length"]},__array__:{__target__:!0,TR:{type:"number",get:B=>{var u;return null===(u=B._babylonTexture)||void 0===u?void 0:u.level},set:(B,u)=>{u._babylonTexture&&(u._babylonTexture.level=B)},getTarget:B=>B._babylonTexture},rotation:{type:"Quaternion",get:B=>{var u;return B._babylonTexture&&Z.Quaternion.FromRotationMatrix(null===(u=B._babylonTexture)||void 0===u?void 0:u.getReflectionTextureMatrix())},set:(B,u)=>{var F;u._babylonTexture&&(null!==(F=u._babylonTexture.yB())&&void 0!==F&&F.useRightHandedSystem||(B=Z.Quaternion.Inverse(B)),Z.Matrix.FromQuaternionToRef(B,u._babylonTexture.getReflectionTextureMatrix()))},getTarget:B=>B._babylonTexture}}}}},animations:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>B._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:B=>B.length,getTarget:B=>B.map((B=>{var u;return null===(u=B.primitives[0]._instanceData)||void 0===u?void 0:u.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function v(B){return new e(B,t)}function D(B){const u=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let F=t;for(const Z of u)Z&&(F=F[Z]);if(F&&F.type&&F.get)return F}function L(B,u){const F=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let Z=t;for(const V of F)V&&(Z=Z[V]);Z&&Z.type&&Z.get&&(Z.interpolation=u)}function q(B,u){const F=B.split("/").map((B=>B.replace(/{}/g,"__array__")));let Z=t;for(const V of F)if(V){if(!Z[V]){if("?"===V){Z.__ignoreObjectTree__=!0;continue}Z[V]={},"__array__"===V&&(Z[V].__target__=!0)}Z=Z[V]}Object.assign(Z,u)}},14656:(B,u,F)=>{"use strict";F.r(u),F.d(u,{AnimationPropertyInfo:()=>s,TransformNodeAnimationPropertyInfo:()=>Y,WeightAnimationPropertyInfo:()=>Q,getQuaternion:()=>R,getVector3:()=>G,getWeights:()=>e});var Z=F(13488),V=F(12979),p=F(14644);function G(B,u,F,Z){return V.Du.fu(u,F).scaleInPlace(Z)}function R(B,u,F,Z){return V.Quaternion.fu(u,F).scaleInPlace(Z)}function e(B,u,F,Z){const V=new Array(B._numMorphTargets);for(let p=0;p<V.length;p++)V[p]=u[F++]*Z;return V}class s{constructor(B,u,F,Z){this.type=B,this.name=u,this.getValue=F,this.getStride=Z}_buildAnimation(B,u,F){const V=new Z.e(B,this.name,u,this.type);return V.setKeys(F),V}}class Y extends s{buildAnimations(B,u,F,Z){const V=[];return V.push({babylonAnimatable:B._babylonTransformNode,babylonAnimation:this._buildAnimation(u,F,Z)}),V}}class Q extends s{buildAnimations(B,u,F,V){const p=[];if(B._numMorphTargets)for(let G=0;G<B._numMorphTargets;G++){const R=new Z.e(`${u}_${G}`,this.name,F,this.type);if(R.setKeys(V.map((B=>({frame:B.frame,inTangent:B.inTangent?B.inTangent[G]:void 0,value:B.value[G],outTangent:B.outTangent?B.outTangent[G]:void 0,interpolation:B.interpolation})))),B._primitiveBabylonMeshes)for(const u of B._primitiveBabylonMeshes)if(u.morphTargetManager){const B=u.morphTargetManager.getTarget(G),F=R.clone();B.animations.push(F),p.push({babylonAnimatable:B,babylonAnimation:F})}}return p}}(0,p.i)("/nodes/{}/translation",[new Y(Z.e.ANIMATIONTYPE_VECTOR3,"position",G,(()=>3))]),(0,p.i)("/nodes/{}/rotation",[new Y(Z.e.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",R,(()=>4))]),(0,p.i)("/nodes/{}/scale",[new Y(Z.e.ANIMATIONTYPE_VECTOR3,"yR",G,(()=>3))]),(0,p.i)("/nodes/{}/weights",[new Q(Z.e.ANIMATIONTYPE_FLOAT,"influence",e,(B=>B._numMorphTargets))])},14608:(B,u,F)=>{"use strict";class Z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((B,u)=>{this._resolve=B,this._reject=u}))}}var V=F(12979),p=F(13023),G=F(12802),R=F(13414),e=F(14614),s=F(14625),Y=F(12807),Q=F(13438),t=F(13488),v=F(13497),D=F(12855),L=F(12822),q=F(12830);class W{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(B){this._useTextureToStoreBoneMatrices=B,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(B){this._animationPropertiesOverride=B}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(B,u,F){this.name=B,this.id=u,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=V.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new Y.b,this.bones=[],this._scene=F||D.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const Z=this._scene.getEngine().getCaps();this._canUseTextureForBones=Z.textureFloat&&Z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((B=>!B.getParent()))}getTransformMatrices(B){if(this.needInitialSkinMatrix){if(!B)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return B._bonesTransformMatrices||this.prepare(!0),B._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(B){return this.needInitialSkinMatrix&&B._transformMatrixTexture?B._transformMatrixTexture:this._transformMatrixTexture}yB(){return this._scene}toString(B){let u=`Name: ${this.name}, nBones: ${this.bones.length}`;if(u+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,B){u+=", Ranges: {";let B=!0;for(const F in this._ranges)B&&(u+=", ",B=!1),u+=F;u+="}"}return u}getBoneIndexByName(B){for(let u=0,F=this.bones.length;u<F;u++)if(this.bones[u].name===B)return u;return-1}createAnimationRange(B,u,F){if(!this._ranges[B]){this._ranges[B]=new v.b(B,u,F);for(let Z=0,V=this.bones.length;Z<V;Z++)this.bones[Z].animations[0]&&this.bones[Z].animations[0].createRange(B,u,F)}}deleteAnimationRange(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let F=0,Z=this.bones.length;F<Z;F++)this.bones[F].animations[0]&&this.bones[F].animations[0].deleteRange(B,u);this._ranges[B]=null}getAnimationRange(B){return this._ranges[B]||null}getAnimationRanges(){const B=[];let u;for(u in this._ranges)B.push(this._ranges[u]);return B}copyAnimationRange(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[u]||!B.getAnimationRange(u))return!1;let Z=!0;const V=this._getHighestAnimationFrame()+1,p={},G=B.bones;let R,e;for(e=0,R=G.length;e<R;e++)p[G[e].name]=G[e];this.bones.length!==G.length&&(L.d.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${G.length}`),Z=!1);const s=F&&this.dimensionsAtRest&&B.dimensionsAtRest?this.dimensionsAtRest.divide(B.dimensionsAtRest):null;for(e=0,R=this.bones.length;e<R;e++){const B=this.bones[e].name,G=p[B];G?Z=Z&&this.bones[e].copyAnimationRange(G,u,V,F,s):(L.d.Warn("copyAnimationRange: not same rig, missing source bone "+B),Z=!1)}const Y=B.getAnimationRange(u);return Y&&(this._ranges[u]=new v.b(u,Y.from+V,Y.to+V)),Z}returnToRest(){for(const B of this.bones)-1!==B._index&&B.returnToRest()}_getHighestAnimationFrame(){let B=0;for(let u=0,F=this.bones.length;u<F;u++)if(this.bones[u].animations[0]){const F=this.bones[u].animations[0].getHighestFrame();B<F&&(B=F)}return B}beginAnimation(B,u,F,Z){const V=this.getAnimationRange(B);return V?this._scene.beginAnimation(this,V.from,V.to,u,F,Z):null}static MakeAnimationAdditive(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0;const Z=B.getAnimationRange(F);if(!Z)return null;const V=B._scene.getAllAnimatablesByTarget(B);let p=null;for(let R=0;R<V.length;R++){const B=V[R];if(B.fromFrame===(null===Z||void 0===Z?void 0:Z.from)&&B.toFrame===(null===Z||void 0===Z?void 0:Z.to)){p=B;break}}const G=B.getAnimatables();for(let R=0;R<G.length;R++){const B=G[R].animations;if(B)for(let Z=0;Z<B.length;Z++)t.e.MakeAnimationAdditive(B[Z],u,F)}return p&&(p.isAdditive=!0),B}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(B){this._meshesWithPoseMatrix.push(B)}_unregisterMeshWithPoseMatrix(B){const u=this._meshesWithPoseMatrix.indexOf(B);u>-1&&this._meshesWithPoseMatrix.splice(u,1)}_computeTransformMatrices(B,u){this.onBeforeComputeObservable.notifyObservers(this);for(let F=0;F<this.bones.length;F++){const Z=this.bones[F];Z._childUpdateId++;const V=Z.getParent();if(V?Z.getLocalMatrix().multiplyToRef(V.getFinalMatrix(),Z.getFinalMatrix()):u?Z.getLocalMatrix().multiplyToRef(u,Z.getFinalMatrix()):Z.getFinalMatrix().Z(Z.getLocalMatrix()),-1!==Z._index){const u=null===Z._index?F:Z._index;Z.getAbsoluteInverseBindMatrix().multiplyToArray(Z.getFinalMatrix(),B,16*u)}}this._identity.copyToArray(B,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const B=this.yB().getRenderId();if(this._currentRenderId===B)return;this._currentRenderId=B}if(this._numBonesWithLinkedTransformNode>0)for(const B of this.bones)if(B._linkedTransformNode){const u=B._linkedTransformNode;B.position=u.position,u.rotationQuaternion?B.rotationQuaternion=u.rotationQuaternion:B.rotation=u.rotation,B.yR=u.yR}if(this.needInitialSkinMatrix)for(const B of this._meshesWithPoseMatrix){const u=B.getPoseMatrix();let F=this._isDirty;if(B._bonesTransformMatrices&&B._bonesTransformMatrices.length===16*(this.bones.length+1)||(B._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),F=!0),F){if(this._synchronizedWithMesh!==B){this._synchronizedWithMesh=B;for(const B of this.bones)if(!B.getParent()){B.getBindMatrix().multiplyToRef(u,V.TmpVectors.Matrix[1]),B._updateAbsoluteBindMatrices(V.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const u=4*(this.bones.length+1);B._transformMatrixTexture&&B._transformMatrixTexture.getSize().width===u||(B._transformMatrixTexture&&B._transformMatrixTexture.dispose(),B._transformMatrixTexture=Q.b.CreateRGBATexture(B._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(B._bonesTransformMatrices,u),this.isUsingTextureForMatrices&&B._transformMatrixTexture&&B._transformMatrixTexture.update(B._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=Q.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let B=0;B<this.bones.length;B++)this._animatables.push(this.bones[B])}return this._animatables}clone(B,u){const F=new W(B,u||B,this._scene);F.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let Z=0;Z<this.bones.length;Z++){const B=this.bones[Z];let u=null;const V=B.getParent();if(V){const B=this.bones.indexOf(V);u=F.bones[B]}const p=new s.c(B.name,F,u,B.getBindMatrix().clone(),B.getRestMatrix().clone());p._index=B._index,B._linkedTransformNode&&p.linkTransformNode(B._linkedTransformNode),q.c.DeepCopy(B.animations,p.animations)}if(this._ranges){F._ranges={};for(const B in this._ranges){const u=this._ranges[B];u&&(F._ranges[B]=u.clone())}}return this._isDirty=!0,F.prepare(!0),F}enableBlending(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const u of this.bones)for(const F of u.animations)F.enableBlending=!0,F.blendingSpeed=B}dispose(){if(this._meshesWithPoseMatrix.length=0,this.yB().stopAnimation(this),this.yB().removeSkeleton(this),this._parentContainer){const B=this._parentContainer.skeletons.indexOf(this);B>-1&&this._parentContainer.skeletons.splice(B,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const B={};B.name=this.name,B.id=this.id,this.dimensionsAtRest&&(B.dimensionsAtRest=this.dimensionsAtRest.DR()),B.bones=[],B.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let F=0;F<this.bones.length;F++){var u;const Z=this.bones[F],V=Z.getParent(),p={parentBoneIndex:V?this.bones.indexOf(V):-1,index:Z.getIndex(),name:Z.name,id:Z.id,matrix:Z.getBindMatrix().DR(),rest:Z.getRestMatrix().DR(),linkedTransformNodeId:null===(u=Z.getTransformNode())||void 0===u?void 0:u.id};B.bones.push(p),Z.length&&(p.length=Z.length),Z.metadata&&(p.metadata=Z.metadata),Z.animations&&Z.animations.length>0&&(p.animation=Z.animations[0].serialize()),B.ranges=[];for(const u in this._ranges){const F=this._ranges[u];if(!F)continue;const Z={};Z.name=u,Z.from=F.from,Z.to=F.to,B.ranges.push(Z)}}return B}static Parse(B,u){const F=new W(B.name,B.id,u);let Z;for(B.dimensionsAtRest&&(F.dimensionsAtRest=V.Du.fu(B.dimensionsAtRest)),F.needInitialSkinMatrix=B.needInitialSkinMatrix,Z=0;Z<B.bones.length;Z++){const u=B.bones[Z],p=B.bones[Z].index;let G=null;u.parentBoneIndex>-1&&(G=F.bones[u.parentBoneIndex]);const R=u.rest?V.Matrix.fu(u.rest):null,e=new s.c(u.name,F,G,V.Matrix.fu(u.matrix),R,null,p);void 0!==u.id&&null!==u.id&&(e.id=u.id),u.length&&(e.length=u.length),u.metadata&&(e.metadata=u.metadata),u.animation&&e.animations.push(t.e.Parse(u.animation)),void 0!==u.linkedTransformNodeId&&null!==u.linkedTransformNodeId&&(F._hasWaitingData=!0,e._waitingTransformNodeId=u.linkedTransformNodeId)}if(B.ranges)for(Z=0;Z<B.ranges.length;Z++){const u=B.ranges[Z];F.createAnimationRange(u.name,u.from,u.to)}return F}computeAbsoluteMatrices(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||B)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(B)}getPoseMatrix(){let B=null;return this._meshesWithPoseMatrix.length>0&&(B=this._meshesWithPoseMatrix[0].getPoseMatrix()),B}sortBones(){const B=[],u=new Array(this.bones.length);for(let F=0;F<this.bones.length;F++)this._sortBones(F,B,u);this.bones=B}_sortBones(B,u,F){if(F[B])return;F[B]=!0;const Z=this.bones[B];if(!Z)return;void 0===Z._index&&(Z._index=B);const V=Z.getParent();V&&this._sortBones(this.bones.indexOf(V),u,F),u.push(Z)}setCurrentPoseAsRest(){for(const B of this.bones)B.setCurrentPoseAsRest()}}var X=F(13299),f=F(13460),C=F(12969),x=F(13389),U=F(13047),y=F(13421),O=F(13396),g=F(13409),J=F(13504),a=F(13072),T=F(14567);class z{set areUpdatesFrozen(B){B?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new a.h(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,B||(B=D.b.LastCreatedScene),this._scene=B,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const B=this._scene.getEngine().getCaps();this._canUseTextureForTargets=B.canUseGLVertexID&&B.textureFloat&&B.maxVertexTextureImageUnits>0&&B.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return z.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?z.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(B){this._numMaxInfluencers!==B&&(this._numMaxInfluencers=B,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(B){this._useTextureToStoreTargets!==B&&(this._useTextureToStoreTargets=B,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var B;return z.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(B=this._scene)&&void 0!==B&&B.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(B){return this._activeTargets.data[B]}getTarget(B){return this._targets[B]}getTargetByName(B){for(const u of this._targets)if(u.name===B)return u;return null}addTarget(B){this._targets.push(B),this._targetInfluenceChangedObservers.push(B.onInfluenceChanged.add((B=>{this.areUpdatesFrozen&&B&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(B)}))),this._targetDataLayoutChangedObservers.push(B._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(B){const u=this._targets.indexOf(B);u>=0&&(this._targets.splice(u,1),B.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(u,1)[0]),B._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(u,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(B)}_bind(B){B.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),B.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),B.setTexture("morphTargets",this._targetStoreTexture),B.setInt("morphTargetCount",this.numInfluencers)}clone(){const B=new z(this._scene);for(const u of this._targets)B.addTarget(u.clone());return B.enablePositionMorphing=this.enablePositionMorphing,B.enableNormalMorphing=this.enableNormalMorphing,B.enableTangentMorphing=this.enableTangentMorphing,B.enableUVMorphing=this.enableUVMorphing,B.enableUV2Morphing=this.enableUV2Morphing,B.enableColorMorphing=this.enableColorMorphing,B}serialize(){const B={};B.id=this.uniqueId,B.targets=[];for(const u of this._targets)B.targets.push(u.serialize());return B}_syncActiveTargets(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const u=!!this._targetStoreTexture,F=this.isUsingTextureForTargets;(this._mustSynchronize||u!==F)&&(this._mustSynchronize=!1,this.synchronize());let Z=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let V=-1;for(const p of this._targets)if(V++,0!==p.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=z.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(p),this._morphTargetTextureIndices[Z]=V,this._tempInfluences[Z++]=p.influence}this._morphTargetTextureIndices.length!==Z&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,Z)),this._influences&&this._influences.length===Z||(this._influences=new Float32Array(Z));for(let p=0;p<Z;p++)this._influences[p]=this._tempInfluences[p];if(B&&this._scene)for(const p of this._scene.meshes)p.morphTargetManager===this&&(F?p._markSubMeshesAsAttributesDirty():p._syncGeometryWithMorphTargetManager())}synchronize(){var B;if(!this._scene||this.areUpdatesFrozen)return;const u=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(B=this._targetStoreTexture)||void 0===B||B.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>u.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const F of this._targets){this._supportsPositions=this._supportsPositions&&F.hasPositions,this._supportsNormals=this._supportsNormals&&F.hasNormals,this._supportsTangents=this._supportsTangents&&F.hasTangents,this._supportsUVs=this._supportsUVs&&F.hasUVs,this._supportsUV2s=this._supportsUV2s&&F.hasUV2s,this._supportsColors=this._supportsColors&&F.hasColors;const B=F.vertexCount;if(0===this._vertexCount)this._vertexCount=B;else if(this._vertexCount!==B)return void L.d.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${F.name}": ${B}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const B=u.getCaps().maxTextureSize;this._textureWidth>B&&(this._textureHeight=Math.ceil(this._textureWidth/B),this._textureWidth=B);const F=this._targets.length,Z=new Float32Array(F*this._textureWidth*this._textureHeight*4);let V=0;for(let u=0;u<F;u++){const B=this._targets[u],F=B.getPositions(),p=B.getNormals(),G=B.getUVs(),R=B.getTangents(),e=B.getUV2s(),s=B.getColors();V=u*this._textureWidth*this._textureHeight*4;for(let u=0;u<this._vertexCount;u++)this._supportsPositions&&F&&(Z[V]=F[3*u],Z[V+1]=F[3*u+1],Z[V+2]=F[3*u+2],V+=4),this._supportsNormals&&p&&(Z[V]=p[3*u],Z[V+1]=p[3*u+1],Z[V+2]=p[3*u+2],V+=4),this._supportsUVs&&G&&(Z[V]=G[2*u],Z[V+1]=G[2*u+1],V+=4),this._supportsTangents&&R&&(Z[V]=R[3*u],Z[V+1]=R[3*u+1],Z[V+2]=R[3*u+2],V+=4),this._supportsUV2s&&e&&(Z[V]=e[2*u],Z[V+1]=e[2*u+1],V+=4),this._supportsColors&&s&&(Z[V]=s[4*u],Z[V+1]=s[4*u+1],Z[V+2]=s[4*u+2],Z[V+3]=s[4*u+3],V+=4)}this._targetStoreTexture=T.c.CreateRGBATexture(Z,this._textureWidth,this._textureHeight,F,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const F of this._scene.meshes)F.morphTargetManager===this&&F._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const B=this._parentContainer.morphTargetManagers.indexOf(this);B>-1&&this._parentContainer.morphTargetManagers.splice(B,1),this._parentContainer=null}for(const B of this._targets)this._scene.stopAnimation(B)}}static Parse(B,u){const F=new z(u);for(const Z of B.targets)F.addTarget(J.c.Parse(Z,u));return F}}z.EnableTextureStorage=!0,z.MaxActiveMorphTargetsInVertexAttributeMode=8,z.ConstantTargetCountForTextureMode=0;var M=F(14633),j=F(12861),o=F(13318);const I=new Map,mB=I;function E(B,u,F){w(B)&&L.d.Warn(`Extension with the name '${B}' already exists`),I.set(B,{isGLTFExtension:u,factory:F})}function w(B){return I.delete(B)}var H=F(14644),n=F(13560),d=F(13064);class l{static Get(B,u,F){if(!u||void 0==F||!u[F])throw new Error(`${B}: Failed to find index (${F})`);return u[F]}static TryGet(B,u){return B&&void 0!=u&&B[u]?B[u]:null}static Assign(B){if(B)for(let u=0;u<B.length;u++)B[u].index=u}}function P(B){if(B.min&&B.max){const u=B.min,F=B.max,Z=V.TmpVectors.Du[0].UR(u[0],u[1],u[2]),p=V.TmpVectors.Du[1].UR(F[0],F[1],F[2]);if(B.normalized&&5126!==B.componentType){let u=1;switch(B.componentType){case 5120:u=127;break;case 5121:u=255;break;case 5122:u=32767;break;case 5123:u=65535}const F=1/u;Z.scaleInPlace(F),p.scaleInPlace(F)}return new o.b(Z,p)}return null}class c{static RegisterExtension(B,u){E(B,!1,u)}static UnregisterExtension(B){return w(B)}get YR(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(B){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=B}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((B=>B.dispose&&B.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(B,u,F,Z,V,p){let G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=u,this._assetContainer=F,this._loadData(Z);let p=null;if(B){const u={};if(this._gltf.nodes)for(const B of this._gltf.nodes)B.name&&(u[B.name]=B.index);p=(B instanceof Array?B:[B]).map((B=>{const F=u[B];if(void 0===F)throw new Error(`Failed to find node '${B}'`);return F}))}return await this._loadAsync(V,G,p,(()=>({meshes:this._getMeshes(),xt:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=B,this._loadData(u),await this._loadAsync(F,V,null,(()=>{}))}async _loadAsync(B,u,F,Z){return await Promise.resolve().then((async()=>{this._rootUrl=B,this._uniqueRootUrl=!B.startsWith("file:")&&u?B:`${B}${Date.now()}/`,this._fileName=u,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const V=`${M.j[M.j.LOADING]} => ${M.j[M.j.READY]}`,p=`${M.j[M.j.LOADING]} => ${M.j[M.j.COMPLETE]}`;this._parent._startPerformanceCounter(V),this._parent._startPerformanceCounter(p),this._parent._setState(M.j.LOADING),this._extensionsOnLoading();const R=new Array;if(!this.parent.loadOnlyMaterials)if(F)R.push(this.loadSceneAsync("/nodes",{nodes:F,index:-1}));else if(void 0!=this._gltf.qu||this._gltf.scenes&&this._gltf.scenes[0]){const B=l.Get("/scene",this._gltf.scenes,this._gltf.qu||0);R.push(this.loadSceneAsync(`/scenes/${B.index}`,B))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let B=0;B<this._gltf.materials.length;++B){const u=this._gltf.materials[B],F="/materials/"+B,Z=X.c.TriangleFillMode;R.push(this._loadMaterialAsync(F,u,null,Z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&R.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&R.push(this._compileShadowGeneratorsAsync());const e=Promise.all(R).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.rR(!0);for(const B of this._babylonScene.materials){const u=B;void 0!==u.maxSimultaneousLights&&(u.maxSimultaneousLights=Math.max(u.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(M.j.READY),this._skipStartAnimationStep||this._startAnimations(),Z()}));return await e.then((B=>(this._parent._endPerformanceCounter(V),G.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(p),this._parent._setState(M.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(B=>{this._parent.onErrorObservable.notifyObservers(B),this._parent.onErrorObservable.clear(),this.dispose()}))})),B)))})).catch((B=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(B),this._parent.onErrorObservable.clear(),this.dispose()),B}))}_loadData(B){if(this._gltf=B.json,this._setupData(),B.bin){const u=this._gltf.buffers;if(u&&u[0]&&!u[0].uri){const F=u[0];(F.byteLength<B.bin.byteLength-3||F.byteLength>B.bin.byteLength)&&L.d.Warn(`Binary buffer length (${F.byteLength}) from JSON does not match chunk length (${B.bin.byteLength})`),this._bin=B.bin}else L.d.Warn("Unexpected BIN chunk")}}_setupData(){if(l.Assign(this._gltf.accessors),l.Assign(this._gltf.animations),l.Assign(this._gltf.buffers),l.Assign(this._gltf.bufferViews),l.Assign(this._gltf.cameras),l.Assign(this._gltf.images),l.Assign(this._gltf.materials),l.Assign(this._gltf.meshes),l.Assign(this._gltf.nodes),l.Assign(this._gltf.samplers),l.Assign(this._gltf.scenes),l.Assign(this._gltf.skins),l.Assign(this._gltf.textures),this._gltf.nodes){const B={};for(const F of this._gltf.nodes)if(F.children)for(const u of F.children)B[u]=F.index;const u=this._createRootNode();for(const F of this._gltf.nodes){const Z=B[F.index];F.parent=void 0===Z?u:this._gltf.nodes[Z]}}}async _loadExtensionsAsync(){const B=[];if(mB.forEach(((u,F)=>{var Z;!1===(null===(Z=this.parent.extensionOptions[F])||void 0===Z?void 0:Z.enabled)?u.isGLTFExtension&&this.isExtensionUsed(F)&&L.d.Warn(`Extension ${F} is used but has been explicitly disabled.`):u.isGLTFExtension&&!this.isExtensionUsed(F)||B.push((async()=>{const B=await u.factory(this);return B.name!==F&&L.d.Warn(`The name of the glTF loader extension instance does not match the registered name: ${B.name} !== ${F}`),this._parent.onExtensionLoadedObservable.notifyObservers(B),B})())})),this._extensions.push(...await Promise.all(B)),this._extensions.sort(((B,u)=>(B.order||Number.MAX_VALUE)-(u.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const F of this._gltf.extensionsRequired){if(!this._extensions.some((B=>B.name===F&&B.enabled))){var u;if(!1===(null===(u=this.parent.extensionOptions[F])||void 0===u?void 0:u.enabled))throw new Error(`Required extension ${F} is disabled`);throw new Error(`Required extension ${F} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new g.b("__root__",this._babylonScene);this._rootBabylonMesh=B,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.rR(!1);const u={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case M.g.AUTO:this._babylonScene.useRightHandedSystem||(u.rotation=[0,1,0,0],u.scale=[1,1,-1],c._LoadTransform(u,this._rootBabylonMesh));break;case M.g.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(B),u}loadSceneAsync(B,u){const F=this._extensionsLoadSceneAsync(B,u);if(F)return F;const Z=new Array;if(this.logOpen(`${B} ${u.name||""}`),u.nodes)for(const V of u.nodes){const u=l.Get(`${B}/nodes/${V}`,this._gltf.nodes,V);Z.push(this.loadNodeAsync(`/nodes/${u.index}`,u,(B=>{B.parent=this._rootBabylonMesh})))}for(const V of this._postSceneLoadActions)V();return Z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(Z).then((()=>{}))}_forEachPrimitive(B,u){if(B._primitiveBabylonMeshes)for(const F of B._primitiveBabylonMeshes)u(F)}_getGeometries(){const B=[],u=this._gltf.nodes;if(u)for(const F of u)this._forEachPrimitive(F,(u=>{const F=u.fR;F&&-1===B.indexOf(F)&&B.push(F)}));return B}_getMeshes(){const B=[];this._rootBabylonMesh instanceof O.e&&B.push(this._rootBabylonMesh);const u=this._gltf.nodes;if(u)for(const F of u)this._forEachPrimitive(F,(u=>{B.push(u)}));return B}_getTransformNodes(){const B=[],u=this._gltf.nodes;if(u)for(const F of u)F._babylonTransformNode&&"pe"===F._babylonTransformNode.getClassName()&&B.push(F._babylonTransformNode),F._babylonTransformNodeForSkin&&B.push(F._babylonTransformNodeForSkin);return B}_getSkeletons(){const B=[],u=this._gltf.skins;if(u)for(const F of u)F._data&&B.push(F._data.babylonSkeleton);return B}_getAnimationGroups(){const B=[],u=this._gltf.animations;if(u)for(const F of u)F._babylonAnimationGroup&&B.push(F._babylonAnimationGroup);return B}_startAnimations(){switch(this._parent.animationStartMode){case M.e.NONE:break;case M.e.FIRST:{const B=this._getAnimationGroups();0!==B.length&&B[0].start(!0);break}case M.e.ALL:{const B=this._getAnimationGroups();for(const u of B)u.start(!0);break}default:return void L.d.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadNodeAsync(B,u,F);if(Z)return Z;if(u._babylonTransformNode)throw new Error(`${B}: Invalid recursive node hierarchy`);const V=new Array;this.logOpen(`${B} ${u.name||""}`);const p=Z=>{if(c.AddPointerMetadata(Z,B),c._LoadTransform(u,Z),void 0!=u.camera){const F=l.Get(`${B}/camera`,this._gltf.cameras,u.camera);V.push(this.loadCameraAsync(`/cameras/${F.index}`,F,(B=>{B.parent=Z,this._babylonScene.useRightHandedSystem||(Z.yR.x=-1)})))}if(u.children)for(const F of u.children){const u=l.Get(`${B}/children/${F}`,this._gltf.nodes,F);V.push(this.loadNodeAsync(`/nodes/${u.index}`,u,(B=>{B.parent=Z})))}F(Z)},G=void 0!=u.mesh,R=this._parent.loadSkins&&void 0!=u.skin;if(!G||R){const B=u.name||`node${u.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new x.b(B,this._babylonScene);F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==u.mesh?u._babylonTransformNode=F:u._babylonTransformNodeForSkin=F,p(F)}if(G)if(R){const F=l.Get(`${B}/mesh`,this._gltf.meshes,u.mesh);V.push(this._loadMeshAsync(`/meshes/${F.index}`,u,F,(F=>{const Z=u._babylonTransformNodeForSkin;F.metadata=(0,n.d)(Z.metadata,F.metadata||{});const p=l.Get(`${B}/skin`,this._gltf.skins,u.skin);V.push(this._loadSkinAsync(`/skins/${p.index}`,u,p,(B=>{this._forEachPrimitive(u,(u=>{u.skeleton=B})),this._postSceneLoadActions.push((()=>{if(void 0!=p.skeleton){const B=l.Get(`/skins/${p.index}/skeleton`,this._gltf.nodes,p.skeleton).parent;u.index===B.index?F.parent=Z.parent:F.parent=B._babylonTransformNode}else F.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:Z,skinnedNode:F})}))})))})))}else{const F=l.Get(`${B}/mesh`,this._gltf.meshes,u.mesh);V.push(this._loadMeshAsync(`/meshes/${F.index}`,u,F,p))}return this.logClose(),Promise.all(V).then((()=>(this._forEachPrimitive(u,(B=>{const u=B;!u.isAnInstance&&u.fR&&u.fR.useBoundingInfoFromGeometry?B.oB():B.refreshBoundingInfo(!0,!0)})),u._babylonTransformNode)))}_loadMeshAsync(B,u,F,Z){const V=F.primitives;if(!V||!V.length)throw new Error(`${B}: Primitives are missing`);void 0==V[0].index&&l.Assign(V);const p=new Array;this.logOpen(`${B} ${F.name||""}`);const G=u.name||`node${u.index}`;if(1===V.length){const Z=F.primitives[0];p.push(this._loadMeshPrimitiveAsync(`${B}/primitives/${Z.index}`,G,u,F,Z,(B=>{u._babylonTransformNode=B,u._primitiveBabylonMeshes=[B]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,u._babylonTransformNode=new x.b(G,this._babylonScene),u._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._primitiveBabylonMeshes=[];for(const Z of V)p.push(this._loadMeshPrimitiveAsync(`${B}/primitives/${Z.index}`,`${G}_primitive${Z.index}`,u,F,Z,(B=>{B.parent=u._babylonTransformNode,u._primitiveBabylonMeshes.push(B)})))}return Z(u._babylonTransformNode),this.logClose(),Promise.all(p).then((()=>u._babylonTransformNode))}_loadMeshPrimitiveAsync(B,u,F,Z,V,p){const G=this._extensionsLoadMeshPrimitiveAsync(B,u,F,Z,V,p);if(G)return G;this.logOpen(`${B}`);const R=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==F.skin&&!Z.primitives[0].targets;let e,s;if(R&&V._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,e=V._instanceData.babylonSourceMesh.createInstance(u),e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s=V._instanceData.promise;else{const p=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new g.b(u,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,G.sideOrientation=this._babylonScene.useRightHandedSystem?X.c.CounterClockWiseSideOrientation:X.c.ClockWiseSideOrientation,this._createMorphTargets(B,F,Z,V,G),p.push(this._loadVertexDataAsync(B,V,G).then((async u=>await this._loadMorphTargetsAsync(B,V,G,u).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,u.MB(G),u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const Y=c._GetDrawMode(B,V.mode);if(void 0==V.material){let B=this._defaultBabylonMaterialData[Y];B||(B=this._createDefaultMaterial("__GLTFLoader._default",Y),this._parent.onMaterialLoadedObservable.notifyObservers(B),this._defaultBabylonMaterialData[Y]=B),G.material=B}else if(!this.parent.skipMaterials){const u=l.Get(`${B}/material`,this._gltf.materials,V.material);p.push(this._loadMaterialAsync(`/materials/${u.index}`,u,G,Y,(B=>{G.material=B})))}s=Promise.all(p),R&&(V._instanceData={babylonSourceMesh:G,promise:s}),e=G}return c.AddPointerMetadata(e,B),this._parent.onMeshLoadedObservable.notifyObservers(e),p(e),this.logClose(),s.then((()=>e))}_loadVertexDataAsync(B,u,F){const Z=this._extensionsLoadVertexDataAsync(B,u,F);if(Z)return Z;const V=u.attributes;if(!V)throw new Error(`${B}: Attributes are missing`);const p=new Array,G=new y.e(F.name,this._babylonScene);if(void 0==u.indices)F.isUnIndexed=!0;else{const F=l.Get(`${B}/indices`,this._gltf.accessors,u.indices);p.push(this._loadIndicesAccessorAsync(`/accessors/${F.index}`,F).then((B=>{G.setIndices(B)})))}const R=(u,Z,R)=>{if(void 0==V[u])return;F._delayInfo=F._delayInfo||[],-1===F._delayInfo.indexOf(Z)&&F._delayInfo.push(Z);const e=l.Get(`${B}/attributes/${u}`,this._gltf.accessors,V[u]);p.push(this._loadVertexAccessorAsync(`/accessors/${e.index}`,e,Z).then((B=>{if(B.getKind()===U.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!F.skeleton){const B=P(e);B&&(G._boundingInfo=B,G.useBoundingInfoFromGeometry=!0)}G.setVerticesBuffer(B,e.count)}))),Z==U.f.MatricesIndicesExtraKind&&(F.numBoneInfluencers=8),R&&R(e)};return R("POSITION",U.f.PositionKind),R("NORMAL",U.f.NormalKind),R("TANGENT",U.f.TangentKind),R("TEXCOORD_0",U.f.UVKind),R("TEXCOORD_1",U.f.UV2Kind),R("TEXCOORD_2",U.f.UV3Kind),R("TEXCOORD_3",U.f.UV4Kind),R("TEXCOORD_4",U.f.UV5Kind),R("TEXCOORD_5",U.f.UV6Kind),R("JOINTS_0",U.f.MatricesIndicesKind),R("WEIGHTS_0",U.f.MatricesWeightsKind),R("JOINTS_1",U.f.MatricesIndicesExtraKind),R("WEIGHTS_1",U.f.MatricesWeightsExtraKind),R("COLOR_0",U.f.ColorKind,(B=>{"VEC4"===B.type&&(F.hasVertexAlpha=!0)})),Promise.all(p).then((()=>G))}_createMorphTargets(B,u,F,Z,V){if(!Z.targets||!this._parent.loadMorphTargets)return;if(void 0==u._numMorphTargets)u._numMorphTargets=Z.targets.length;else if(Z.targets.length!==u._numMorphTargets)throw new Error(`${B}: Primitives do not have the same number of targets`);const p=F.extras?F.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,V.morphTargetManager=new z(this._babylonScene),V.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,V.morphTargetManager.areUpdatesFrozen=!0;for(let G=0;G<Z.targets.length;G++){const B=u.weights?u.weights[G]:F.weights?F.weights[G]:0,Z=p?p[G]:`morphTarget${G}`;V.morphTargetManager.addTarget(new J.c(Z,B,V.yB()))}}_loadMorphTargetsAsync(B,u,F,Z){if(!u.targets||!this._parent.loadMorphTargets)return Promise.resolve();const V=new Array,p=F.morphTargetManager;for(let G=0;G<p.numTargets;G++){const F=p.getTarget(G);V.push(this._loadMorphTargetVertexDataAsync(`${B}/targets/${G}`,Z,u.targets[G],F))}return Promise.all(V).then((()=>{p.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(B,u,F,Z){const V=new Array,p=(Z,p,G)=>{if(void 0==F[Z])return;const R=u.getVertexBuffer(p);if(!R)return;const e=l.Get(`${B}/${Z}`,this._gltf.accessors,F[Z]);V.push(this._loadFloatAccessorAsync(`/accessors/${e.index}`,e).then((B=>{G(R,B)})))};return p("POSITION",U.f.PositionKind,((B,u)=>{const F=new Float32Array(u.length);B.forEach(u.length,((B,Z)=>{F[Z]=u[Z]+B})),Z.setPositions(F)})),p("NORMAL",U.f.NormalKind,((B,u)=>{const F=new Float32Array(u.length);B.forEach(F.length,((B,Z)=>{F[Z]=u[Z]+B})),Z.setNormals(F)})),p("TANGENT",U.f.TangentKind,((B,u)=>{const F=new Float32Array(u.length/3*4);let V=0;B.forEach(u.length/3*4,((B,Z)=>{(Z+1)%4!==0&&(F[V]=u[V]+B,V++)})),Z.setTangents(F)})),p("TEXCOORD_0",U.f.UVKind,((B,u)=>{const F=new Float32Array(u.length);B.forEach(u.length,((B,Z)=>{F[Z]=u[Z]+B})),Z.setUVs(F)})),p("TEXCOORD_1",U.f.UV2Kind,((B,u)=>{const F=new Float32Array(u.length);B.forEach(u.length,((B,Z)=>{F[Z]=u[Z]+B})),Z.setUV2s(F)})),p("COLOR_0",U.f.ColorKind,((u,F)=>{let V=null;const p=u.getSize();if(3===p){V=new Float32Array(F.length/3*4),u.forEach(F.length,((B,u)=>{const Z=Math.floor(u/3),p=u%3;V[4*Z+p]=F[3*Z+p]+B}));for(let B=0;B<F.length/3;++B)V[4*B+3]=1}else{if(4!==p)throw new Error(`${B}: Invalid number of components (${p}) for COLOR_0 attribute`);V=new Float32Array(F.length),u.forEach(F.length,((B,u)=>{V[u]=F[u]+B}))}Z.setColors(V)})),await Promise.all(V).then((()=>{}))}static _LoadTransform(B,u){if(void 0!=B.skin)return;let F=V.Du.Zero(),Z=V.Quaternion.Identity(),p=V.Du.One();if(B.matrix){V.Matrix.fu(B.matrix).decompose(p,Z,F)}else B.translation&&(F=V.Du.fu(B.translation)),B.rotation&&(Z=V.Quaternion.fu(B.rotation)),B.scale&&(p=V.Du.fu(B.scale));u.position=F,u.rotationQuaternion=Z,u.yR=p}_loadSkinAsync(B,u,F,Z){if(!this._parent.loadSkins)return Promise.resolve();const V=this._extensionsLoadSkinAsync(B,u,F);if(V)return V;if(F._data)return Z(F._data.babylonSkeleton),F._data.promise;const p=`skeleton${F.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new W(F.name||p,p,this._babylonScene);G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(B,F,G);const R=this._loadSkinInverseBindMatricesDataAsync(B,F).then((B=>{this._updateBoneMatrices(G,B)}));return F._data={babylonSkeleton:G,promise:R},Z(G),R}_loadBones(B,u,F){if(void 0==u.skeleton||this._parent.alwaysComputeSkeletonRootNode){const F=this._findSkeletonRootNode(`${B}/joints`,u.joints);if(F)if(void 0===u.skeleton)u.skeleton=F.index;else{const Z=(B,u)=>{for(;u.parent;u=u.parent)if(u.parent===B)return!0;return!1},V=l.Get(`${B}/skeleton`,this._gltf.nodes,u.skeleton);V===F||Z(V,F)||(L.d.Warn(`${B}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),u.skeleton=F.index)}else L.d.Warn(`${B}: Failed to find common root`)}const Z={};for(const V of u.joints){const p=l.Get(`${B}/joints/${V}`,this._gltf.nodes,V);this._loadBone(p,u,F,Z)}}_findSkeletonRootNode(B,u){if(0===u.length)return null;const F={};for(const V of u){const u=[];let Z=l.Get(`${B}/${V}`,this._gltf.nodes,V);for(;-1!==Z.index;)u.unshift(Z),Z=Z.parent;F[V]=u}let Z=null;for(let V=0;;++V){let B=F[u[0]];if(V>=B.length)return Z;const p=B[V];for(let G=1;G<u.length;++G)if(B=F[u[G]],V>=B.length||p!==B[V])return Z;Z=p}}_loadBone(B,u,F,Z){B._isJoint=!0;let V=Z[B.index];if(V)return V;let p=null;B.index!==u.skeleton&&(B.parent&&-1!==B.parent.index?p=this._loadBone(B.parent,u,F,Z):void 0!==u.skeleton&&L.d.Warn(`/skins/${u.index}/skeleton: Skeleton node is not a common root`));const G=u.joints.indexOf(B.index);return V=new s.c(B.name||`joint${B.index}`,F,p,this._getNodeMatrix(B),null,null,G),Z[B.index]=V,this._postSceneLoadActions.push((()=>{V.linkTransformNode(B._babylonTransformNode)})),V}_loadSkinInverseBindMatricesDataAsync(B,u){if(void 0==u.inverseBindMatrices)return Promise.resolve(null);const F=l.Get(`${B}/inverseBindMatrices`,this._gltf.accessors,u.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${F.index}`,F)}_updateBoneMatrices(B,u){for(const F of B.bones){const B=V.Matrix.Identity(),Z=F._index;u&&-1!==Z&&(V.Matrix.FromArrayToRef(u,16*Z,B),B.invertToRef(B));const p=F.getParent();p&&B.multiplyToRef(p.getAbsoluteInverseBindMatrix(),B),F.WR(B,!1,!1),F._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(B){return B.matrix?V.Matrix.fu(B.matrix):V.Matrix.Compose(B.scale?V.Du.fu(B.scale):V.Du.One(),B.rotation?V.Quaternion.fu(B.rotation):V.Quaternion.Identity(),B.translation?V.Du.fu(B.translation):V.Du.Zero())}loadCameraAsync(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadCameraAsync(B,u,F);if(Z)return Z;const p=new Array;this.logOpen(`${B} ${u.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const G=new e.e(u.name||`camera${u.index}`,V.Du.Zero(),this._babylonScene,!1);switch(G._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonCamera=G,G.setTarget(new V.Du(0,0,-1)),u.type){case"perspective":{const F=u.perspective;if(!F)throw new Error(`${B}: Camera perspective properties are missing`);G.fov=F.yfov,G.qR=F.znear,G.maxZ=F.zfar||0;break}case"orthographic":if(!u.orthographic)throw new Error(`${B}: Camera orthographic properties are missing`);G.mode=R.d.ORTHOGRAPHIC_CAMERA,G.orthoLeft=-u.orthographic.xmag,G.orthoRight=u.orthographic.xmag,G.orthoBottom=-u.orthographic.ymag,G.orthoTop=u.orthographic.ymag,G.qR=u.orthographic.znear,G.maxZ=u.orthographic.zfar;break;default:throw new Error(`${B}: Invalid camera type (${u.type})`)}return c.AddPointerMetadata(G,B),this._parent.onCameraLoadedObservable.notifyObservers(G),F(G),this.logClose(),Promise.all(p).then((()=>G))}_loadAnimationsAsync(){const B=this._gltf.animations;if(!B)return Promise.resolve();const u=new Array;for(let F=0;F<B.length;F++){const Z=B[F];u.push(this.loadAnimationAsync(`/animations/${Z.index}`,Z).then((B=>{0===B.targetedAnimations.length&&B.dispose()})))}return Promise.all(u).then((()=>{}))}loadAnimationAsync(B,u){const Z=this._extensionsLoadAnimationAsync(B,u);return Z||F.e(78).then(F.bind(F,16178)).then((F=>{let{AnimationGroup:Z}=F;this._babylonScene._blockEntityCollection=!!this._assetContainer;const V=new Z(u.name||`animation${u.index}`,this._babylonScene);V._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,u._babylonAnimationGroup=V;const p=new Array;l.Assign(u.channels),l.Assign(u.samplers);for(const G of u.channels)p.push(this._loadAnimationChannelAsync(`${B}/channels/${G.index}`,B,u,G,((B,u)=>{B.animations=B.animations||[],B.animations.push(u),V.addTargetedAnimation(u,B)})));return Promise.all(p).then((()=>(V.normalize(0),V)))}))}async _loadAnimationChannelAsync(B,u,Z,V,p){const G=this._extensionsLoadAnimationChannelAsync(B,u,Z,V,p);if(G)return await G;if(void 0==V.target.node)return await Promise.resolve();const R=l.Get(`${B}/target/node`,this._gltf.nodes,V.target.node),e=V.target.path,s="weights"===e;if(s&&!R._numMorphTargets||!s&&!R._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!s&&!R._isJoint)return await Promise.resolve();let Y;switch(await Promise.resolve().then(F.bind(F,14656)),e){case"translation":var Q;Y=null===(Q=(0,H.f)("/nodes/{}/translation"))||void 0===Q?void 0:Q.interpolation;break;case"rotation":var t;Y=null===(t=(0,H.f)("/nodes/{}/rotation"))||void 0===t?void 0:t.interpolation;break;case"scale":var v;Y=null===(v=(0,H.f)("/nodes/{}/scale"))||void 0===v?void 0:v.interpolation;break;case"weights":var D;Y=null===(D=(0,H.f)("/nodes/{}/weights"))||void 0===D?void 0:D.interpolation;break;default:throw new Error(`${B}/target/path: Invalid value (${V.target.path})`)}if(!Y)throw new Error(`${B}/target/path: Could not find interpolation properties for target path (${V.target.path})`);const L={object:R,info:Y};return await this._loadAnimationChannelFromTargetInfoAsync(B,u,Z,V,L,p)}_loadAnimationChannelFromTargetInfoAsync(B,u,F,Z,V,p){const G=this.parent.targetFps,R=1/G,e=l.Get(`${B}/sampler`,F.samplers,Z.sampler);return this._loadAnimationSamplerAsync(`${u}/samplers/${Z.sampler}`,e).then((B=>{let u=0;const e=V.object,s=V.info;for(const V of s){const s=V.getStride(e),Y=B.input,Q=B.output,t=new Array(Y.length);let v=0;switch(B.interpolation){case"STEP":for(let B=0;B<Y.length;B++){const u=V.getValue(e,Q,v,1);v+=s,t[B]={frame:Y[B]*G,value:u,interpolation:1}}break;case"CUBICSPLINE":for(let B=0;B<Y.length;B++){const u=V.getValue(e,Q,v,R);v+=s;const F=V.getValue(e,Q,v,1);v+=s;const Z=V.getValue(e,Q,v,R);v+=s,t[B]={frame:Y[B]*G,inTangent:u,value:F,outTangent:Z}}break;case"LINEAR":for(let B=0;B<Y.length;B++){const u=V.getValue(e,Q,v,1);v+=s,t[B]={frame:Y[B]*G,value:u}}}if(v>0){const B=`${F.name||`animation${F.index}`}_channel${Z.index}_${u}`,R=V.buildAnimations(e,B,G,t);for(const F of R)u++,p(F.babylonAnimatable,F.babylonAnimation)}}}))}_loadAnimationSamplerAsync(B,u){if(u._data)return u._data;const F=u.interpolation||"LINEAR";switch(F){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${B}/interpolation: Invalid value (${u.interpolation})`)}const Z=l.Get(`${B}/input`,this._gltf.accessors,u.input),V=l.Get(`${B}/output`,this._gltf.accessors,u.output);return u._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${Z.index}`,Z),this._loadFloatAccessorAsync(`/accessors/${V.index}`,V)]).then((B=>{let[u,Z]=B;return{input:u,interpolation:F,output:Z}})),u._data}loadBufferAsync(B,u,F,Z){const V=this._extensionsLoadBufferAsync(B,u,F,Z);if(V)return V;if(!u._data)if(u.uri)u._data=this.loadUriAsync(`${B}/uri`,u,u.uri);else{if(!this._bin)throw new Error(`${B}: Uri is missing or the binary glTF is missing its binary chunk`);u._data=this._bin.readAsync(0,u.byteLength)}return u._data.then((u=>{try{return new Uint8Array(u.buffer,u.byteOffset+F,Z)}catch(V){throw new Error(`${B}: ${V.message}`)}}))}loadBufferViewAsync(B,u){const F=this._extensionsLoadBufferViewAsync(B,u);if(F)return F;if(u._data)return u._data;const Z=l.Get(`${B}/buffer`,this._gltf.buffers,u.buffer);return u._data=this.loadBufferAsync(`/buffers/${Z.index}`,Z,u.byteOffset||0,u.byteLength),u._data}_loadAccessorAsync(B,u,F){if(u._data)return u._data;const Z=c._GetNumComponents(B,u.type),V=Z*U.f.GetTypeByteLength(u.componentType),p=Z*u.count;if(void 0==u.bufferView)u._data=Promise.resolve(new F(p));else{const G=l.Get(`${B}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${G.index}`,G).then((R=>{if(5126!==u.componentType||u.normalized||G.byteStride&&G.byteStride!==V){const B=new F(p);return U.f.ForEach(R,u.byteOffset||0,G.byteStride||V,Z,u.componentType,B.length,u.normalized||!1,((u,F)=>{B[F]=u})),B}return c._GetTypedArray(B,u.componentType,R,u.byteOffset,p)}))}if(u.sparse){const p=u.sparse;u._data=u._data.then((G=>{const R=G,e=l.Get(`${B}/sparse/indices/bufferView`,this._gltf.bufferViews,p.indices.bufferView),s=l.Get(`${B}/sparse/values/bufferView`,this._gltf.bufferViews,p.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${e.index}`,e),this.loadBufferViewAsync(`/bufferViews/${s.index}`,s)]).then((G=>{let[e,s]=G;const Y=c._GetTypedArray(`${B}/sparse/indices`,p.indices.componentType,e,p.indices.byteOffset,p.count),Q=Z*p.count;let t;if(5126!==u.componentType||u.normalized){const G=c._GetTypedArray(`${B}/sparse/values`,u.componentType,s,p.values.byteOffset,Q);t=new F(Q),U.f.ForEach(G,0,V,Z,u.componentType,t.length,u.normalized||!1,((B,u)=>{t[u]=B}))}else t=c._GetTypedArray(`${B}/sparse/values`,u.componentType,s,p.values.byteOffset,Q);let v=0;for(let B=0;B<Y.length;B++){let u=Y[B]*Z;for(let B=0;B<Z;B++)R[u++]=t[v++]}return R}))}))}return u._data}_loadFloatAccessorAsync(B,u){return this._loadAccessorAsync(B,u,Float32Array)}_loadIndicesAccessorAsync(B,u){if("SCALAR"!==u.type)throw new Error(`${B}/type: Invalid value ${u.type}`);if(5121!==u.componentType&&5123!==u.componentType&&5125!==u.componentType)throw new Error(`${B}/componentType: Invalid value ${u.componentType}`);if(u._data)return u._data;if(u.sparse){const F=c._GetTypedArrayConstructor(`${B}/componentType`,u.componentType);u._data=this._loadAccessorAsync(B,u,F)}else{const F=l.Get(`${B}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F).then((F=>c._GetTypedArray(B,u.componentType,F,u.byteOffset,u.count)))}return u._data}_loadVertexBufferViewAsync(B){if(B._babylonBuffer)return B._babylonBuffer;const u=this._babylonScene.getEngine();return B._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((B=>new U.b(u,B,!1))),B._babylonBuffer}_loadVertexAccessorAsync(B,u,F){var Z;if(null!==(Z=u._babylonVertexBuffer)&&void 0!==Z&&Z[F])return u._babylonVertexBuffer[F];u._babylonVertexBuffer||(u._babylonVertexBuffer={});const V=this._babylonScene.getEngine();if(u.sparse||void 0==u.bufferView)u._babylonVertexBuffer[F]=this._loadFloatAccessorAsync(B,u).then((B=>new U.f(V,B,F,!1)));else{const Z=l.Get(`${B}/bufferView`,this._gltf.bufferViews,u.bufferView);u._babylonVertexBuffer[F]=this._loadVertexBufferViewAsync(Z).then((p=>{const G=c._GetNumComponents(B,u.type);return new U.f(V,p,F,!1,void 0,Z.byteStride,void 0,u.byteOffset,G,u.componentType,u.normalized,!0,void 0,!0)}))}return u._babylonVertexBuffer[F]}_loadMaterialMetallicRoughnessPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return u&&(u.baseColorFactor?(F.albedoColor=p.Xu.fu(u.baseColorFactor),F.alpha=u.baseColorFactor[3]):F.albedoColor=p.Xu.White(),F.metallic=void 0==u.metallicFactor?1:u.metallicFactor,F.roughness=void 0==u.roughnessFactor?1:u.roughnessFactor,u.baseColorTexture&&Z.push(this.loadTextureInfoAsync(`${B}/baseColorTexture`,u.baseColorTexture,(B=>{B.name=`${F.name} (Base Color)`,F.albedoTexture=B}))),u.metallicRoughnessTexture&&(u.metallicRoughnessTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${B}/metallicRoughnessTexture`,u.metallicRoughnessTexture,(B=>{B.name=`${F.name} (Metallic Roughness)`,F.metallicTexture=B}))),F.useMetallnessFromMetallicTextureBlue=!0,F.useRoughnessFromMetallicTextureGreen=!0,F.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(Z).then((()=>{}))}_loadMaterialAsync(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const p=this._extensionsLoadMaterialAsync(B,u,F,Z,V);if(p)return p;u._data=u._data||{};let G=u._data[Z];if(!G){this.logOpen(`${B} ${u.name||""}`);const F=this.createMaterial(B,u,Z);G={babylonMaterial:F,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(B,u,F)},u._data[Z]=G,c.AddPointerMetadata(F,B),this._parent.onMaterialLoadedObservable.notifyObservers(F),this.logClose()}return F&&(G.babylonMeshes.push(F),F.GR.addOnce((()=>{const B=G.babylonMeshes.indexOf(F);-1!==B&&G.babylonMeshes.splice(B,1)}))),V(G.babylonMaterial),G.promise.then((()=>G.babylonMaterial))}_createDefaultMaterial(B,u){this._babylonScene._blockEntityCollection=!!this._assetContainer;const F=new f.c(B,this._babylonScene);return F._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,F.fillMode=u,F.enableSpecularAntiAliasing=!0,F.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,F.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,F.transparencyMode=f.c.PBRMATERIAL_OPAQUE,F.metallic=1,F.roughness=1,F}createMaterial(B,u,F){const Z=this._extensionsCreateMaterial(B,u,F);if(Z)return Z;const V=u.name||`material${u.index}`;return this._createDefaultMaterial(V,F)}loadMaterialPropertiesAsync(B,u,F){const Z=this._extensionsLoadMaterialPropertiesAsync(B,u,F);if(Z)return Z;const V=new Array;return V.push(this.loadMaterialBasePropertiesAsync(B,u,F)),u.pbrMetallicRoughness&&V.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${B}/pbrMetallicRoughness`,u.pbrMetallicRoughness,F)),this.loadMaterialAlphaProperties(B,u,F),Promise.all(V).then((()=>{}))}loadMaterialBasePropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return F.emissiveColor=u.emissiveFactor?p.Xu.fu(u.emissiveFactor):new p.Xu(0,0,0),u.doubleSided&&(F.xR=!1,F.twoSidedLighting=!0),u.normalTexture&&(u.normalTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${B}/normalTexture`,u.normalTexture,(B=>{B.name=`${F.name} (Normal)`,F.bumpTexture=B}))),F.invertNormalMapX=!this._babylonScene.useRightHandedSystem,F.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=u.normalTexture.scale&&F.bumpTexture&&(F.bumpTexture.level=u.normalTexture.scale),F.forceIrradianceInFragment=!0),u.occlusionTexture&&(u.occlusionTexture.nonColorData=!0,Z.push(this.loadTextureInfoAsync(`${B}/occlusionTexture`,u.occlusionTexture,(B=>{B.name=`${F.name} (Occlusion)`,F.ambientTexture=B}))),F.useAmbientInGrayScale=!0,void 0!=u.occlusionTexture.strength&&(F.ambientTextureStrength=u.occlusionTexture.strength)),u.emissiveTexture&&Z.push(this.loadTextureInfoAsync(`${B}/emissiveTexture`,u.emissiveTexture,(B=>{B.name=`${F.name} (Emissive)`,F.emissiveTexture=B}))),Promise.all(Z).then((()=>{}))}loadMaterialAlphaProperties(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);switch(u.alphaMode||"OPAQUE"){case"OPAQUE":F.transparencyMode=f.c.PBRMATERIAL_OPAQUE,F.alpha=1;break;case"MASK":F.transparencyMode=f.c.PBRMATERIAL_ALPHATEST,F.alphaCutOff=void 0==u.alphaCutoff?.5:u.alphaCutoff,F.albedoTexture&&(F.albedoTexture.LR=!0);break;case"BLEND":F.transparencyMode=f.c.PBRMATERIAL_ALPHABLEND,F.albedoTexture&&(F.albedoTexture.LR=!0,F.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${B}/alphaMode: Invalid value (${u.alphaMode})`)}}loadTextureInfoAsync(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadTextureInfoAsync(B,u,F);if(Z)return Z;if(this.logOpen(`${B}`),u.texCoord>=6)throw new Error(`${B}/texCoord: Invalid value (${u.texCoord})`);const V=l.Get(`${B}/index`,this._gltf.textures,u.index);V._textureInfo=u;const p=this._loadTextureAsync(`/textures/${u.index}`,V,(Z=>{Z.coordinatesIndex=u.texCoord||0,c.AddPointerMetadata(Z,B),this._parent.onTextureLoadedObservable.notifyObservers(Z),F(Z)}));return this.logClose(),p}_loadTextureAsync(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const Z=this._extensionsLoadTextureAsync(B,u,F);if(Z)return Z;this.logOpen(`${B} ${u.name||""}`);const V=void 0==u.sampler?c.DefaultSampler:l.Get(`${B}/sampler`,this._gltf.samplers,u.sampler),p=l.Get(`${B}/source`,this._gltf.images,u.source),G=this._createTextureAsync(B,V,p,F,void 0,!u._textureInfo.nonColorData);return this.logClose(),G}_createTextureAsync(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},p=arguments.length>4?arguments[4]:void 0,G=arguments.length>5?arguments[5]:void 0;const R=this._loadSampler(`/samplers/${u.index}`,u),e=new Array,s=new Z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const Y={noMipmap:R.noMipMaps,invertY:!1,samplingMode:R.samplingMode,N:()=>{this._disposed||s.resolve()},onError:(u,F)=>{this._disposed||s.reject(new Error(`${B}: ${F&&F.message?F.message:u||"Failed to load texture"}`))},mimeType:F.mimeType??(0,j.e)(F.uri??""),loaderOptions:p,useSRGBBuffer:!!G&&this._parent.useSRGBBuffers},Q=new C.d(null,this._babylonScene,Y);return Q._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.push(s.promise),e.push(this.loadImageAsync(`/images/${F.index}`,F).then((B=>{const u=F.uri||`${this._fileName}#image${F.index}`,Z=`data:${this._uniqueRootUrl}${u}`;Q.updateURL(Z,B);const V=Q.getInternalTexture();V&&(V.label=F.name)}))),Q.wrapU=R.wrapU,Q.wrapV=R.wrapV,V(Q),this._parent.useGltfTextureNames&&(Q.name=F.name||F.uri||`image${F.index}`),Promise.all(e).then((()=>Q))}_loadSampler(B,u){return u._data||(u._data={noMipMaps:9728===u.minFilter||9729===u.minFilter,samplingMode:c._GetTextureSamplingMode(B,u),wrapU:c._GetTextureWrapMode(`${B}/wrapS`,u.wrapS),wrapV:c._GetTextureWrapMode(`${B}/wrapT`,u.wrapT)}),u._data}loadImageAsync(B,u){if(!u._data){if(this.logOpen(`${B} ${u.name||""}`),u.uri)u._data=this.loadUriAsync(`${B}/uri`,u,u.uri);else{const F=l.Get(`${B}/bufferView`,this._gltf.bufferViews,u.bufferView);u._data=this.loadBufferViewAsync(`/bufferViews/${F.index}`,F)}this.logClose()}return u._data}loadUriAsync(B,u,F){const Z=this._extensionsLoadUriAsync(B,u,F);if(Z)return Z;if(!c._ValidateUri(F))throw new Error(`${B}: '${F}' is invalid`);if((0,j.g)(F)){const u=new Uint8Array((0,j.c)(F));return this.log(`${B}: Decoded ${F.substring(0,64)}... (${u.length} bytes)`),Promise.resolve(u)}return this.log(`${B}: Loading ${F}`),this._parent.preprocessUrlAsync(this._rootUrl+F).then((u=>new Promise(((Z,V)=>{this._parent._loadFile(this._babylonScene,u,(u=>{this._disposed||(this.log(`${B}: Loaded ${F} (${u.byteLength} bytes)`),Z(new Uint8Array(u)))}),!0,(u=>{V(new j.i(`${B}: Failed to load '${F}'${u?": "+u.status+" "+u.statusText:""}`,u))}))}))))}static AddPointerMetadata(B,u){B.metadata=B.metadata||{};const F=B._internalMetadata=B._internalMetadata||{},Z=F.YR=F.YR||{};(Z.pointers=Z.pointers||[]).push(u)}static _GetTextureWrapMode(B,u){switch(u=void 0==u?10497:u){case 33071:return C.d.CLAMP_ADDRESSMODE;case 33648:return C.d.MIRROR_ADDRESSMODE;case 10497:return C.d.WRAP_ADDRESSMODE;default:return L.d.Warn(`${B}: Invalid value (${u})`),C.d.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(B,u){const F=void 0==u.magFilter?9729:u.magFilter,Z=void 0==u.minFilter?9987:u.minFilter;if(9729===F)switch(Z){case 9728:return C.d.LINEAR_NEAREST;case 9729:return C.d.LINEAR_LINEAR;case 9984:return C.d.LINEAR_NEAREST_MIPNEAREST;case 9985:return C.d.LINEAR_LINEAR_MIPNEAREST;case 9986:return C.d.LINEAR_NEAREST_MIPLINEAR;case 9987:return C.d.LINEAR_LINEAR_MIPLINEAR;default:return L.d.Warn(`${B}/minFilter: Invalid value (${Z})`),C.d.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==F&&L.d.Warn(`${B}/magFilter: Invalid value (${F})`),Z){case 9728:return C.d.NEAREST_NEAREST;case 9729:return C.d.NEAREST_LINEAR;case 9984:return C.d.NEAREST_NEAREST_MIPNEAREST;case 9985:return C.d.NEAREST_LINEAR_MIPNEAREST;case 9986:return C.d.NEAREST_NEAREST_MIPLINEAR;case 9987:return C.d.NEAREST_LINEAR_MIPLINEAR;default:return L.d.Warn(`${B}/minFilter: Invalid value (${Z})`),C.d.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(B,u){try{return(0,d.l)(u)}catch(F){throw new Error(`${B}: ${F.message}`)}}static _GetTypedArray(B,u,F,Z,V){const p=F.buffer;Z=F.byteOffset+(Z||0);const G=c._GetTypedArrayConstructor(`${B}/componentType`,u),R=U.f.GetTypeByteLength(u);return Z%R!==0?(L.d.Warn(`${B}: Copying buffer as byte offset (${Z}) is not a multiple of component type byte length (${R})`),new G(p.slice(Z,Z+V*R),0)):new G(p,Z,V)}static _GetNumComponents(B,u){switch(u){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${B}: Invalid type (${u})`)}static _ValidateUri(B){return G.Tools.IsBase64(B)||-1===B.indexOf("..")}static _GetDrawMode(B,u){switch(void 0==u&&(u=4),u){case 0:return X.c.PointListDrawMode;case 1:return X.c.LineListDrawMode;case 2:return X.c.LineLoopDrawMode;case 3:return X.c.LineStripDrawMode;case 4:return X.c.TriangleFillMode;case 5:return X.c.TriangleStripDrawMode;case 6:return X.c.TriangleFanDrawMode}throw new Error(`${B}: Invalid mesh primitive mode (${u})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const B=new Array;if(this._gltf.materials)for(const u of this._gltf.materials)if(u._data)for(const F in u._data){const Z=u._data[F];for(const u of Z.babylonMeshes){u.XR(!0);const F=Z.babylonMaterial;B.push(F.forceCompilationAsync(u)),B.push(F.forceCompilationAsync(u,{useInstances:!0})),this._parent.useClipPlane&&(B.push(F.forceCompilationAsync(u,{clipPlane:!0})),B.push(F.forceCompilationAsync(u,{clipPlane:!0,useInstances:!0})))}}return Promise.all(B).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const B=new Array,u=this._babylonScene.lights;for(const F of u){const u=F.getShadowGenerator();u&&B.push(u.forceCompilationAsync())}return Promise.all(B).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(B){for(const u of this._extensions)u.enabled&&B(u)}_applyExtensions(B,u,F){for(const Z of this._extensions)if(Z.enabled){const V=`${Z.name}.${u}`,p=B;p._activeLoaderExtensionFunctions=p._activeLoaderExtensionFunctions||{};const G=p._activeLoaderExtensionFunctions;if(!G[V]){G[V]=!0;try{const B=F(Z);if(B)return B}finally{delete G[V]}}}return null}_extensionsOnLoading(){this._forEachExtensions((B=>B.onLoading&&B.onLoading()))}_extensionsOnReady(){this._forEachExtensions((B=>B.onReady&&B.onReady()))}_extensionsLoadSceneAsync(B,u){return this._applyExtensions(u,"loadScene",(F=>F.loadSceneAsync&&F.loadSceneAsync(B,u)))}_extensionsLoadNodeAsync(B,u,F){return this._applyExtensions(u,"loadNode",(Z=>Z.loadNodeAsync&&Z.loadNodeAsync(B,u,F)))}_extensionsLoadCameraAsync(B,u,F){return this._applyExtensions(u,"loadCamera",(Z=>Z.loadCameraAsync&&Z.loadCameraAsync(B,u,F)))}_extensionsLoadVertexDataAsync(B,u,F){return this._applyExtensions(u,"loadVertexData",(Z=>Z._loadVertexDataAsync&&Z._loadVertexDataAsync(B,u,F)))}_extensionsLoadMeshPrimitiveAsync(B,u,F,Z,V,p){return this._applyExtensions(V,"loadMeshPrimitive",(G=>G._loadMeshPrimitiveAsync&&G._loadMeshPrimitiveAsync(B,u,F,Z,V,p)))}_extensionsLoadMaterialAsync(B,u,F,Z,V){return this._applyExtensions(u,"loadMaterial",(p=>p._loadMaterialAsync&&p._loadMaterialAsync(B,u,F,Z,V)))}_extensionsCreateMaterial(B,u,F){return this._applyExtensions(u,"createMaterial",(Z=>Z.createMaterial&&Z.createMaterial(B,u,F)))}_extensionsLoadMaterialPropertiesAsync(B,u,F){return this._applyExtensions(u,"loadMaterialProperties",(Z=>Z.loadMaterialPropertiesAsync&&Z.loadMaterialPropertiesAsync(B,u,F)))}_extensionsLoadTextureInfoAsync(B,u,F){return this._applyExtensions(u,"loadTextureInfo",(Z=>Z.loadTextureInfoAsync&&Z.loadTextureInfoAsync(B,u,F)))}_extensionsLoadTextureAsync(B,u,F){return this._applyExtensions(u,"loadTexture",(Z=>Z._loadTextureAsync&&Z._loadTextureAsync(B,u,F)))}_extensionsLoadAnimationAsync(B,u){return this._applyExtensions(u,"loadAnimation",(F=>F.loadAnimationAsync&&F.loadAnimationAsync(B,u)))}_extensionsLoadAnimationChannelAsync(B,u,F,Z,V){return this._applyExtensions(F,"loadAnimationChannel",(p=>p._loadAnimationChannelAsync&&p._loadAnimationChannelAsync(B,u,F,Z,V)))}_extensionsLoadSkinAsync(B,u,F){return this._applyExtensions(F,"loadSkin",(Z=>Z._loadSkinAsync&&Z._loadSkinAsync(B,u,F)))}_extensionsLoadUriAsync(B,u,F){return this._applyExtensions(u,"loadUri",(Z=>Z._loadUriAsync&&Z._loadUriAsync(B,u,F)))}_extensionsLoadBufferViewAsync(B,u){return this._applyExtensions(u,"loadBufferView",(F=>F.loadBufferViewAsync&&F.loadBufferViewAsync(B,u)))}_extensionsLoadBufferAsync(B,u,F,Z){return this._applyExtensions(u,"loadBuffer",(V=>V.loadBufferAsync&&V.loadBufferAsync(B,u,F,Z)))}static LoadExtensionAsync(B,u,F,Z){if(!u.extensions)return null;const V=u.extensions[F];return V?Z(`${B}/extensions/${F}`,V):null}static LoadExtraAsync(B,u,F,Z){if(!u.extras)return null;const V=u.extras[F];return V?Z(`${B}/extras/${F}`,V):null}isExtensionUsed(B){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(B)}logOpen(B){this._parent._logOpen(B)}logClose(){this._parent._logClose()}log(B){this._parent._log(B)}startPerformanceCounter(B){this._parent._startPerformanceCounter(B)}endPerformanceCounter(B){this._parent._endPerformanceCounter(B)}}c.DefaultSampler={index:-1},M.b._CreateGLTF2Loader=B=>new c(B);var h=F(14656),i=F(13172),r=F(13014),K=F(14660),N=F(14663);class A extends N.d{constructor(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]&&arguments[6],R=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",B),this._texture=B.getEngine().createRawCubeTexture(u,F,Z,V,p,G,R,e)}update(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,B,u,F,Z,V)}updateRGBDAsync(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,K.k)(this._texture,B,u,F,Z).then((()=>{}))}clone(){return r.c.Clone((()=>{const B=this.yB(),u=this._texture,F=new A(B,u._bufferViewArray,u.width,u.format,u.type,u.generateMipMaps,u.invertY,u.samplingMode,u._compression);return 13===u.source&&F.updateRGBDAsync(u._bufferViewArrayArray,u._sphericalPolynomial,u._lodGenerationScale,u._lodGenerationOffset),F}),this)}}const b="EXT_lights_image_based";class k{constructor(B){this.name=b,this._loader=B,this.enabled=this._loader.isExtensionUsed(b)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.YR.extensions;if(B&&B[this.name]){const u=B[this.name];this._lights=u.lights}}loadSceneAsync(B,u){return c.LoadExtensionAsync(B,u,this.name,(async(F,Z)=>{this._loader._allMaterialsDirtyRequired=!0;const V=new Array;V.push(this._loader.loadSceneAsync(B,u)),this._loader.logOpen(`${F}`);const p=l.Get(`${F}/light`,this._lights,Z.ip);return V.push(this._loadLightAsync(`/extensions/${this.name}/lights/${Z.ip}`,p).then((B=>{this._loader.babylonScene.environmentTexture=B}))),this._loader.logClose(),await Promise.all(V).then((()=>{}))}))}_loadLightAsync(B,u){if(!u._loaded){const F=new Array;this._loader.logOpen(`${B}`);const Z=new Array(u.specularImages.length);for(let V=0;V<u.specularImages.length;V++){const p=u.specularImages[V];Z[V]=new Array(p.length);for(let u=0;u<p.length;u++){const G=`${B}/specularImages/${V}/${u}`;this._loader.logOpen(`${G}`);const R=p[u],e=l.Get(G,this._loader.YR.images,R);F.push(this._loader.loadImageAsync(`/images/${R}`,e).then((B=>{Z[V][u]=B}))),this._loader.logClose()}}this._loader.logClose(),u._loaded=Promise.all(F).then((async()=>{const F=new A(this._loader.babylonScene,null,u.specularImageSize);if(F.name=u.name||"environment",u._babylonTexture=F,void 0!=u.TR&&(F.level=u.TR),u.rotation){let B=V.Quaternion.fu(u.rotation);this._loader.babylonScene.useRightHandedSystem||(B=V.Quaternion.Inverse(B)),V.Matrix.FromQuaternionToRef(B,F.getReflectionTextureMatrix())}if(!u.irradianceCoefficients)throw new Error(`${B}: Irradiance coefficients are missing`);const p=i.c.fu(u.irradianceCoefficients);p.scaleInPlace(u.TR),p.convertIrradianceToLambertianRadiance();const G=i.g.FromHarmonics(p),R=(Z.length-1)/Math.log2(u.specularImageSize);return await F.updateRGBDAsync(Z,G,R)}))}return u._loaded.then((()=>u._babylonTexture))}}w(b),E(b,!0,(B=>new k(B)));F(13528);const S="EXT_mesh_gpu_instancing";class BB{constructor(B){this.name=S,this._loader=B,this.enabled=this._loader.isExtensionUsed(S)}dispose(){this._loader=null}loadNodeAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(B,Z)=>{this._loader._disableInstancedMesh++;const p=this._loader.loadNodeAsync(`/nodes/${u.index}`,u,F);if(this._loader._disableInstancedMesh--,!u._primitiveBabylonMeshes)return await p;const G=new Array;let R=0;const e=u=>{if(void 0==Z.attributes[u])return void G.push(Promise.resolve(null));const F=l.Get(`${B}/attributes/${u}`,this._loader.YR.accessors,Z.attributes[u]);if(G.push(this._loader._loadFloatAccessorAsync(`/accessors/${F.bufferView}`,F)),0===R)R=F.count;else if(R!==F.count)throw new Error(`${B}/attributes: Instance buffer accessors do not have the same count.`)};return e("TRANSLATION"),e("ROTATION"),e("SCALE"),await p.then((async B=>{const[F,Z,p]=await Promise.all(G),e=new Float32Array(16*R);V.TmpVectors.Du[0].UR(0,0,0),V.TmpVectors.Quaternion[0].UR(0,0,0,1),V.TmpVectors.Du[1].UR(1,1,1);for(let u=0;u<R;++u)F&&V.Du.FromArrayToRef(F,3*u,V.TmpVectors.Du[0]),Z&&V.Quaternion.FromArrayToRef(Z,4*u,V.TmpVectors.Quaternion[0]),p&&V.Du.FromArrayToRef(p,3*u,V.TmpVectors.Du[1]),V.Matrix.ComposeToRef(V.TmpVectors.Du[1],V.TmpVectors.Quaternion[0],V.TmpVectors.Du[0],V.TmpVectors.Matrix[0]),V.TmpVectors.Matrix[0].copyToArray(e,16*u);for(const V of u._primitiveBabylonMeshes)V.lQ("matrix",e,16,!0);return B}))}))}}w(S),E(S,!0,(B=>new BB(B)));let uB=0,FB=null;class ZB{static get Default(){return ZB._Default||(ZB._Default=new ZB),ZB._Default}constructor(){const B=ZB.Configuration.decoder;this._decoderModulePromise=G.Tools.LoadBabylonScriptAsync(B.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(B,u,F,Z,V){await this._decoderModulePromise,0===uB&&(MeshoptDecoder.useWorkers(1),uB=1);const p=await MeshoptDecoder.decodeGltfBufferAsync(u,F,B,Z,V);return null!==FB&&clearTimeout(FB),FB=setTimeout((()=>{MeshoptDecoder.useWorkers(0),uB=0,FB=null}),1e3),p}}ZB.Configuration={decoder:{url:`${G.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},ZB._Default=null;const VB="EXT_meshopt_compression";class pB{constructor(B){this.name=VB,this.enabled=B.isExtensionUsed(VB),this._loader=B}dispose(){this._loader=null}loadBufferViewAsync(B,u){return c.LoadExtensionAsync(B,u,this.name,(async(F,Z)=>{const V=u;if(V._meshOptData)return await V._meshOptData;const p=l.Get(`${B}/buffer`,this._loader.YR.buffers,Z.buffer);return V._meshOptData=this._loader.loadBufferAsync(`/buffers/${p.index}`,p,Z.byteOffset||0,Z.byteLength).then((async B=>await ZB.Default.decodeGltfBufferAsync(B,Z.count,Z.byteStride,Z.mode,Z.filter))),await V._meshOptData}))}}w(VB),E(VB,!0,(B=>new pB(B)));const GB="EXT_texture_webp";class RB{constructor(B){this.name=GB,this._loader=B,this.enabled=B.isExtensionUsed(GB)}dispose(){this._loader=null}_loadTextureAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=void 0==u.sampler?c.DefaultSampler:l.Get(`${B}/sampler`,this._loader.YR.samplers,u.sampler),G=l.Get(`${Z}/source`,this._loader.YR.images,V.source);return await this._loader._createTextureAsync(B,p,G,(B=>{F(B)}),void 0,!u._textureInfo.nonColorData)}))}}w(GB),E(GB,!0,(B=>new RB(B)));const eB="EXT_texture_avif";class sB{constructor(B){this.name=eB,this._loader=B,this.enabled=B.isExtensionUsed(eB)}dispose(){this._loader=null}_loadTextureAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=void 0==u.sampler?c.DefaultSampler:l.Get(`${B}/sampler`,this._loader.YR.samplers,u.sampler),G=l.Get(`${Z}/source`,this._loader.YR.images,V.source);return await this._loader._createTextureAsync(B,p,G,(B=>{F(B)}),void 0,!u._textureInfo.nonColorData)}))}}w(eB),E(eB,!0,(B=>new sB(B)));var YB=F(14648),QB=F(13508);const tB="EXT_lights_ies";class vB{constructor(B){this.name=tB,this._loader=B,this.enabled=this._loader.isExtensionUsed(tB)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.YR.extensions;if(B&&B[this.name]){const u=B[this.name];this._lights=u.lights,l.Assign(this._lights)}}loadNodeAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,G)=>{let R,e;this._loader._allMaterialsDirtyRequired=!0;const s=await this._loader.loadNodeAsync(B,u,(B=>{e=l.Get(Z,this._lights,G.ip);const u=e.name||B.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,R=new YB.e(u,V.Du.Zero(),V.Du.Backward(),0,1,this._loader.babylonScene),R.angle=Math.PI/2,R.innerAngle=0,R._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=R,R.falloffType=QB.c.FALLOFF_GLTF,R.zR=G.color?p.Xu.fu(G.color):p.Xu.White(),R.TR=G.multiplier||1,R.range=Number.MAX_VALUE,R.parent=B,this._loader._babylonLights.push(R),c.AddPointerMetadata(R,Z),F(B)}));let Y;if(e.uri)Y=await this._loader.loadUriAsync(B,e,e.uri);else{const u=l.Get(`${B}/bufferView`,this._loader.YR.bufferViews,e.bufferView);Y=await this._loader.loadBufferViewAsync(`/bufferViews/${u.index}`,u)}return R.iesProfileTexture=new C.d(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,Y,!0,void 0,void 0,void 0,void 0,".ies"),s}))}}w(tB),E(tB,!0,(B=>new vB(B)));var DB=F(14670);const LB="KHR_draco_mesh_compression";class qB{constructor(B){this.name=LB,this.useNormalizedFlagFromAccessor=!0,this._loader=B,this.enabled=DB.e.DefaultAvailable&&this._loader.isExtensionUsed(LB)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{if(void 0!=u.mode&&4!==u.mode&&5!==u.mode)throw new Error(`${B}: Unsupported mode ${u.mode}`);const p={},G={},R=(B,Z)=>{const R=V.attributes[B];if(void 0!=R&&(F._delayInfo=F._delayInfo||[],-1===F._delayInfo.indexOf(Z)&&F._delayInfo.push(Z),p[Z]=R,this.useNormalizedFlagFromAccessor)){const F=l.TryGet(this._loader.YR.accessors,u.attributes[B]);F&&(G[Z]=F.normalized||!1)}};R("POSITION",U.f.PositionKind),R("NORMAL",U.f.NormalKind),R("TANGENT",U.f.TangentKind),R("TEXCOORD_0",U.f.UVKind),R("TEXCOORD_1",U.f.UV2Kind),R("TEXCOORD_2",U.f.UV3Kind),R("TEXCOORD_3",U.f.UV4Kind),R("TEXCOORD_4",U.f.UV5Kind),R("TEXCOORD_5",U.f.UV6Kind),R("JOINTS_0",U.f.MatricesIndicesKind),R("WEIGHTS_0",U.f.MatricesWeightsKind),R("COLOR_0",U.f.ColorKind);const e=l.Get(Z,this._loader.YR.bufferViews,V.bufferView);return e._dracoBabylonGeometry||(e._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((async Z=>{const V=this.dracoDecoder||DB.e.Default,R=l.TryGet(this._loader.YR.accessors,u.attributes.POSITION),e=this._loader.parent.alwaysComputeBoundingBox||F.skeleton||!R?null:P(R);return await V._decodeMeshToGeometryForGltfAsync(F.name,this._loader.babylonScene,Z,p,G,e).catch((u=>{throw new Error(`${B}: ${u.message}`)}))}))),await e._dracoBabylonGeometry}))}}w(LB),E(LB,!0,(B=>new qB(B)));var WB=F(14676),XB=F(12971),fB=F(12973),CB=F(13391),xB=F(13564),UB=F(12949);CB.b.AddNodeConstructor("Light_Type_0",((B,u)=>()=>new yB(B,V.Du.Zero(),u)));class yB extends xB.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(B){this._shadowAngle=B,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(B){const u=this.needCube();if(this._direction=B,this.needCube()!==u&&this._shadowGenerators){const B=this._shadowGenerators.values();for(let u=B.next();!0!==u.done;u=B.next()){u.value.recreateShadowMap()}}}constructor(B,u,F){super(B,F),this._shadowAngle=Math.PI/2,this.position=u}getClassName(){return"PointLight"}getTypeID(){return QB.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(B){if(this.direction)return super.getShadowDirection(B);switch(B){case 0:return new V.Du(1,0,0);case 1:return new V.Du(-1,0,0);case 2:return new V.Du(0,-1,0);case 3:return new V.Du(0,1,0);case 4:return new V.Du(0,0,1);case 5:return new V.Du(0,0,-1)}return V.Du.Zero()}_setDefaultShadowProjectionMatrix(B,u,F){const Z=this.yB().activeCamera;if(!Z)return;const p=void 0!==this.shadowMinZ?this.shadowMinZ:Z.qR,G=void 0!==this.shadowMaxZ?this.shadowMaxZ:Z.maxZ,R=this.yB().getEngine().o;V.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,R?G:p,R?p:G,B,!0,this._scene.getEngine().isNDCHalfZRange,void 0,R)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(B,u){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,u):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,u),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,u),this}transferToNodeMaterialEffect(B,u){return this.computeTransformedInformation()?B.setFloat3(u,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):B.setFloat3(u,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(B,u){B["POINTLIGHT"+u]=!0}}(0,XB.d)([(0,fB.L)()],yB.prototype,"shadowAngle",null),(0,UB.f)("BABYLON.PointLight",yB);const OB="KHR_lights_punctual";class gB{constructor(B){this.name=OB,this._loader=B,this.enabled=this._loader.isExtensionUsed(OB)}dispose(){this._loader=null,delete this._lights}onLoading(){const B=this._loader.YR.extensions;if(B&&B[this.name]){const u=B[this.name];this._lights=u.lights,l.Assign(this._lights)}}loadNodeAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,G)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(B,u,(B=>{let u;const R=l.Get(Z,this._lights,G.ip),e=R.name||B.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,R.type){case"directional":{const B=new WB.e(e,V.Du.Backward(),this._loader.babylonScene);B.position.OR(0),u=B;break}case"point":u=new yB(e,V.Du.Zero(),this._loader.babylonScene);break;case"spot":{const B=new YB.e(e,V.Du.Zero(),V.Du.Backward(),0,1,this._loader.babylonScene);B.angle=2*(R.spot&&R.spot.outerConeAngle||Math.PI/4),B.innerAngle=2*(R.spot&&R.spot.innerConeAngle||0),u=B;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${Z}: Invalid light type (${R.type})`)}u._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,R._babylonLight=u,u.falloffType=QB.c.FALLOFF_GLTF,u.zR=R.color?p.Xu.fu(R.color):p.Xu.White(),u.TR=void 0==R.TR?1:R.TR,u.range=void 0==R.range?Number.MAX_VALUE:R.range,u.parent=B,this._loader._babylonLights.push(u),c.AddPointerMetadata(u,Z),F(B)})))))}}w(OB),E(OB,!0,(B=>new gB(B)));const JB="KHR_materials_pbrSpecularGlossiness";class aB{constructor(B){this.name=JB,this.order=200,this._loader=B,this.enabled=this._loader.isExtensionUsed(JB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialBasePropertiesAsync(B,u,F)),p.push(this._loadSpecularGlossinessPropertiesAsync(Z,V,F)),this._loader.loadMaterialAlphaProperties(B,u,F),await Promise.all(p).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return F.metallic=null,F.roughness=null,u.diffuseFactor?(F.albedoColor=p.Xu.fu(u.diffuseFactor),F.alpha=u.diffuseFactor[3]):F.albedoColor=p.Xu.White(),F.reflectivityColor=u.specularFactor?p.Xu.fu(u.specularFactor):p.Xu.White(),F.microSurface=void 0==u.glossinessFactor?1:u.glossinessFactor,u.diffuseTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTexture`,u.diffuseTexture,(B=>{B.name=`${F.name} (Diffuse)`,F.albedoTexture=B}))),u.specularGlossinessTexture&&(Z.push(this._loader.loadTextureInfoAsync(`${B}/specularGlossinessTexture`,u.specularGlossinessTexture,(B=>{B.name=`${F.name} (Specular Glossiness)`,F.reflectivityTexture=B,F.reflectivityTexture.LR=!0}))),F.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(Z).then((()=>{}))}}w(JB),E(JB,!0,(B=>new aB(B)));const TB="KHR_materials_unlit";class zB{constructor(B){this.name=TB,this.order=210,this._loader=B,this.enabled=this._loader.isExtensionUsed(TB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async()=>await this._loadUnlitPropertiesAsync(B,u,F)))}_loadUnlitPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;F.unlit=!0;const V=u.pbrMetallicRoughness;return V&&(V.baseColorFactor?(F.albedoColor=p.Xu.fu(V.baseColorFactor),F.alpha=V.baseColorFactor[3]):F.albedoColor=p.Xu.White(),V.baseColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/baseColorTexture`,V.baseColorTexture,(B=>{B.name=`${F.name} (Base Color)`,F.albedoTexture=B})))),u.doubleSided&&(F.xR=!1,F.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(B,u,F),Promise.all(Z).then((()=>{}))}}w(TB),E(TB,!0,(B=>new zB(B)));const MB="KHR_materials_clearcoat";class jB{constructor(B){this.name=MB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(MB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadClearCoatPropertiesAsync(Z,V,F)),await Promise.all(p)}))}_loadClearCoatPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return F.clearCoat.isEnabled=!0,F.clearCoat.useRoughnessFromMainTexture=!1,F.clearCoat.remapF0OnInterfaceChange=!1,void 0!=u.clearcoatFactor?F.clearCoat.TR=u.clearcoatFactor:F.clearCoat.TR=0,u.clearcoatTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatTexture`,u.clearcoatTexture,(B=>{B.name=`${F.name} (ClearCoat)`,F.clearCoat.texture=B}))),void 0!=u.clearcoatRoughnessFactor?F.clearCoat.roughness=u.clearcoatRoughnessFactor:F.clearCoat.roughness=0,u.clearcoatRoughnessTexture&&(u.clearcoatRoughnessTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatRoughnessTexture`,u.clearcoatRoughnessTexture,(B=>{B.name=`${F.name} (ClearCoat Roughness)`,F.clearCoat.textureRoughness=B})))),u.clearcoatNormalTexture&&(u.clearcoatNormalTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${B}/clearcoatNormalTexture`,u.clearcoatNormalTexture,(B=>{B.name=`${F.name} (ClearCoat Normal)`,F.clearCoat.bumpTexture=B}))),F.invertNormalMapX=!F.yB().useRightHandedSystem,F.invertNormalMapY=F.yB().useRightHandedSystem,void 0!=u.clearcoatNormalTexture.scale&&(F.clearCoat.bumpTexture.level=u.clearcoatNormalTexture.scale)),Promise.all(Z).then((()=>{}))}}w(MB),E(MB,!0,(B=>new jB(B)));const oB="KHR_materials_iridescence";class IB{constructor(B){this.name=oB,this.order=195,this._loader=B,this.enabled=this._loader.isExtensionUsed(oB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadIridescencePropertiesAsync(Z,V,F)),await Promise.all(p).then((()=>{}))}))}_loadIridescencePropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return F.iridescence.isEnabled=!0,F.iridescence.TR=u.iridescenceFactor??0,F.iridescence.indexOfRefraction=u.iridescenceIor??u.iridescenceIOR??1.3,F.iridescence.minimumThickness=u.iridescenceThicknessMinimum??100,F.iridescence.maximumThickness=u.iridescenceThicknessMaximum??400,u.iridescenceTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/iridescenceTexture`,u.iridescenceTexture,(B=>{B.name=`${F.name} (Iridescence)`,F.iridescence.texture=B}))),u.iridescenceThicknessTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/iridescenceThicknessTexture`,u.iridescenceThicknessTexture,(B=>{B.name=`${F.name} (Iridescence Thickness)`,F.iridescence.thicknessTexture=B}))),Promise.all(Z).then((()=>{}))}}w(oB),E(oB,!0,(B=>new IB(B)));const mu="KHR_materials_anisotropy";class EB{constructor(B){this.name=mu,this.order=195,this._loader=B,this.enabled=this._loader.isExtensionUsed(mu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadIridescencePropertiesAsync(Z,V,F)),await Promise.all(p)}))}async _loadIridescencePropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;F.anisotropy.isEnabled=!0,F.anisotropy.TR=u.anisotropyStrength??0,F.anisotropy.angle=u.anisotropyRotation??0,u.anisotropyTexture&&(u.anisotropyTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${B}/anisotropyTexture`,u.anisotropyTexture,(B=>{B.name=`${F.name} (Anisotropy Intensity)`,F.anisotropy.texture=B})))),await Promise.all(Z)}}w(mu),E(mu,!0,(B=>new EB(B)));const wB="KHR_materials_emissive_strength";class HB{constructor(B){this.name=wB,this.order=170,this._loader=B,this.enabled=this._loader.isExtensionUsed(wB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>await this._loader.loadMaterialPropertiesAsync(B,u,F).then((()=>{this._loadEmissiveProperties(Z,V,F)}))))}_loadEmissiveProperties(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);void 0!==u.emissiveStrength&&(F.emissiveIntensity=u.emissiveStrength)}}w(wB),E(wB,!0,(B=>new HB(B)));const nB="KHR_materials_sheen";class dB{constructor(B){this.name=nB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(nB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadSheenPropertiesAsync(Z,V,F)),await Promise.all(p).then((()=>{}))}))}_loadSheenPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return F.sheen.isEnabled=!0,F.sheen.TR=1,void 0!=u.sheenColorFactor?F.sheen.color=p.Xu.fu(u.sheenColorFactor):F.sheen.color=p.Xu.Black(),u.sheenColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/sheenColorTexture`,u.sheenColorTexture,(B=>{B.name=`${F.name} (Sheen Color)`,F.sheen.texture=B}))),void 0!==u.sheenRoughnessFactor?F.sheen.roughness=u.sheenRoughnessFactor:F.sheen.roughness=0,u.sheenRoughnessTexture&&(u.sheenRoughnessTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${B}/sheenRoughnessTexture`,u.sheenRoughnessTexture,(B=>{B.name=`${F.name} (Sheen Roughness)`,F.sheen.textureRoughness=B})))),F.sheen.albedoScaling=!0,F.sheen.useRoughnessFromMainTexture=!1,Promise.all(Z).then((()=>{}))}}w(nB),E(nB,!0,(B=>new dB(B)));var lB=F(13446);const PB="KHR_materials_specular";class cB{constructor(B){this.name=PB,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(PB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;if(p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadSpecularPropertiesAsync(Z,V,F)),V.extensions&&V.extensions.EXT_materials_specular_edge_color&&F instanceof f.c){V.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(F.brdf.dielectricSpecularModel=lB.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,F.brdf.conductorSpecularModel=lB.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(p).then((()=>{}))}))}_loadSpecularPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return void 0!==u.specularFactor&&(F.metallicF0Factor=u.specularFactor),void 0!==u.specularColorFactor&&(F.metallicReflectanceColor=p.Xu.fu(u.specularColorFactor)),u.specularTexture&&(u.specularTexture.nonColorData=!0,Z.push(this._loader.loadTextureInfoAsync(`${B}/specularTexture`,u.specularTexture,(B=>{B.name=`${F.name} (Specular)`,F.metallicReflectanceTexture=B,F.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),u.specularColorTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/specularColorTexture`,u.specularColorTexture,(B=>{B.name=`${F.name} (Specular Color)`,F.reflectanceTexture=B}))),Promise.all(Z).then((()=>{}))}}w(PB),E(PB,!0,(B=>new cB(B)));const hB="KHR_materials_ior";class iB{constructor(B){this.name=hB,this.order=180,this._loader=B,this.enabled=this._loader.isExtensionUsed(hB)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadIorPropertiesAsync(Z,V,F)),await Promise.all(p).then((()=>{}))}))}_loadIorPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);return void 0!==u.ior?F.indexOfRefraction=u.ior:F.indexOfRefraction=iB._DEFAULT_IOR,Promise.resolve()}}iB._DEFAULT_IOR=1.5,w(hB),E(hB,!0,(B=>new iB(B)));const rB="KHR_materials_variants";class KB{constructor(B){this.name=rB,this._loader=B,this.enabled=this._loader.isExtensionUsed(rB)}dispose(){this._loader=null}static GetAvailableVariants(B){const u=this._GetExtensionMetadata(B);return u?Object.keys(u.variants):[]}getAvailableVariants(B){return KB.GetAvailableVariants(B)}static SelectVariant(B,u){const F=this._GetExtensionMetadata(B);if(!F)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${rB} extension`);const Z=B=>{const u=F.variants[B];if(u)for(const F of u)F.mesh.material=F.material};if(u instanceof Array)for(const V of u)Z(V);else Z(u);F.lastSelected=u}selectVariant(B,u){KB.SelectVariant(B,u)}static Reset(B){const u=this._GetExtensionMetadata(B);if(!u)throw new Error(`Cannot reset on a glTF mesh that does not have the ${rB} extension`);for(const F of u.original)F.mesh.material=F.material;u.lastSelected=null}reset(B){KB.Reset(B)}static GetLastSelectedVariant(B){const u=this._GetExtensionMetadata(B);if(!u)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${rB} extension`);return u.lastSelected}getLastSelectedVariant(B){return KB.GetLastSelectedVariant(B)}static _GetExtensionMetadata(B){var u,F;return(null===B||void 0===B||null===(u=B._internalMetadata)||void 0===u||null===(F=u.YR)||void 0===F?void 0:F[rB])||null}onLoading(){const B=this._loader.YR.extensions;if(B&&B[this.name]){const u=B[this.name];this._variants=u.variants}}onReady(){const B=this._loader.rootBabylonMesh;if(B){var u;const F=this._loader.parent.extensionOptions[rB];null!==F&&void 0!==F&&F.defaultVariant&&KB.SelectVariant(B,F.defaultVariant),null===F||void 0===F||null===(u=F.onLoaded)||void 0===u||u.call(F,{get variants(){return KB.GetAvailableVariants(B)},get selectedVariant(){const u=KB.GetLastSelectedVariant(B);return u?Array.isArray(u)?u[0]:u:KB.GetAvailableVariants(B)[0]},set selectedVariant(u){KB.SelectVariant(B,u)}})}}_loadMeshPrimitiveAsync(B,u,F,Z,V,p){return c.LoadExtensionAsync(B,V,this.name,(async(G,R)=>{const e=new Array;return e.push(this._loader._loadMeshPrimitiveAsync(B,u,F,Z,V,(u=>{if(p(u),u instanceof g.b){const F=c._GetDrawMode(B,V.mode),Z=this._loader.rootBabylonMesh,p=Z?Z._internalMetadata=Z._internalMetadata||{}:{},s=p.YR=p.YR||{},Y=s[rB]=s[rB]||{lastSelected:null,original:[],variants:{}};Y.original.push({mesh:u,material:u.material});for(let B=0;B<R.mappings.length;++B){const V=R.mappings[B],p=l.Get(`${G}/mappings/${B}/material`,this._loader.YR.materials,V.material);e.push(this._loader._loadMaterialAsync(`#/materials/${V.material}`,p,u,F,(B=>{for(let F=0;F<V.variants.length;++F){const p=V.variants[F],G=l.Get(`/extensions/${rB}/variants/${p}`,this._variants,p);Y.variants[G.name]=Y.variants[G.name]||[],Y.variants[G.name].push({mesh:u,material:B}),u.onClonedObservable.add((B=>{const F=B;let V=null,p=F;do{if(p=p.parent,!p)return;V=KB._GetExtensionMetadata(p)}while(null===V);if(Z&&V===KB._GetExtensionMetadata(Z)){p._internalMetadata={};for(const B in Z._internalMetadata)p._internalMetadata[B]=Z._internalMetadata[B];p._internalMetadata.YR=[];for(const B in Z._internalMetadata.YR)p._internalMetadata.YR[B]=Z._internalMetadata.YR[B];p._internalMetadata.YR[rB]={lastSelected:null,original:[],variants:{}};for(const B of V.original)p._internalMetadata.YR[rB].original.push({mesh:B.mesh,material:B.material});for(const B in V.variants)if(Object.prototype.hasOwnProperty.call(V.variants,B)){p._internalMetadata.YR[rB].variants[B]=[];for(const u of V.variants[B])p._internalMetadata.YR[rB].variants[B].push({mesh:u.mesh,material:u.material})}V=p._internalMetadata.YR[rB]}for(const Z of V.original)Z.mesh===u&&(Z.mesh=F);for(const Z of V.variants[G.name])Z.mesh===u&&(Z.mesh=F)}))}})))}}}))),await Promise.all(e).then((B=>{let[u]=B;return u}))}))}}w(rB),E(rB,!0,(B=>new KB(B)));var NB=F(13039);class AB{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:lB.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(B,u){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...AB._GetDefaultOptions(),...B},this._scene=u,this._scene._transmissionHelper=this,this.onErrorObservable=new Y.b,this._scene.GR.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(B){if(!Object.keys(B).filter((u=>this._options[u]!==B[u])).length)return;const u={...this._options,...B},F=this._options;this._options=u,u.renderSize===F.renderSize&&u.renderTargetTextureType===F.renderTargetTextureType&&u.generateMipmaps===F.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=u.samples,this._opaqueRenderTarget.lodGenerationScale=u.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=u.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(B){return!!B&&!!(B instanceof f.c&&B.subSurface.isRefractionEnabled)}_addMesh(B){this._materialObservers[B.uniqueId]=B.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),G.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(B.material)?(B.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(B)&&this._transparentMeshesCache.push(B)):-1===this._opaqueMeshesCache.indexOf(B)&&this._opaqueMeshesCache.push(B)}))}_removeMesh(B){B.onMaterialChangedObservable.remove(this._materialObservers[B.uniqueId]),delete this._materialObservers[B.uniqueId];let u=this._transparentMeshesCache.indexOf(B);-1!==u&&this._transparentMeshesCache.splice(u,1),u=this._opaqueMeshesCache.indexOf(B),-1!==u&&this._opaqueMeshesCache.splice(u,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(B){const u=this._transparentMeshesCache.indexOf(B),F=this._opaqueMeshesCache.indexOf(B);this._shouldRenderAsTransmission(B.material)?(B.material instanceof f.c&&(B.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==F?(this._opaqueMeshesCache.splice(F,1),this._transparentMeshesCache.push(B)):-1===u&&this._transparentMeshesCache.push(B)):-1!==u?(this._transparentMeshesCache.splice(u,1),this._opaqueMeshesCache.push(B)):-1===F&&this._opaqueMeshesCache.push(B)}_isRenderTargetValid(){var B;return null!==(null===(B=this._opaqueRenderTarget)||void 0===B?void 0:B.getInternalTexture())}_setupRenderTargets(){var B;let u;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new NB.c("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(B=this._options.clearColor)||void 0===B?void 0:B.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((B=>{u=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?B.clearColor.Z(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(B.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=u}));for(const F of this._transparentMeshesCache)this._shouldRenderAsTransmission(F.material)&&(F.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const bB="KHR_materials_transmission";class kB{constructor(B){this.name=bB,this.order=175,this._loader=B,this.enabled=this._loader.isExtensionUsed(bB),this.enabled&&(B.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadTransparentPropertiesAsync(Z,u,F,V)),await Promise.all(p).then((()=>{}))}))}_loadTransparentPropertiesAsync(B,u,F,Z){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const V=F;if(V.subSurface.isRefractionEnabled=!0,V.subSurface.volumeIndexOfRefraction=1,V.subSurface.useAlbedoToTintRefraction=!0,void 0===Z.transmissionFactor)return V.subSurface.refractionIntensity=0,V.subSurface.isRefractionEnabled=!1,Promise.resolve();{var p;V.subSurface.refractionIntensity=Z.transmissionFactor;const B=V.yB();if(V.subSurface.refractionIntensity&&!B._transmissionHelper)new AB({},V.yB());else if(V.subSurface.refractionIntensity&&(null===(p=B._transmissionHelper)||void 0===p||!p._isRenderTargetValid())){var G;null===(G=B._transmissionHelper)||void 0===G||G._setupRenderTargets()}}return V.subSurface.minimumThickness=0,V.subSurface.maximumThickness=0,Z.transmissionTexture?(Z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${B}/transmissionTexture`,Z.transmissionTexture,void 0).then((B=>{B.name=`${F.name} (Transmission)`,V.subSurface.refractionIntensityTexture=B,V.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(bB),E(bB,!0,(B=>new kB(B)));const SB="KHR_materials_diffuse_transmission";class Bu{constructor(B){this.name=SB,this.order=174,this._loader=B,this.enabled=this._loader.isExtensionUsed(SB),this.enabled&&(B.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadTranslucentPropertiesAsync(Z,u,F,V)),await Promise.all(p).then((()=>{}))}))}_loadTranslucentPropertiesAsync(B,u,F,Z){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const V=F;if(V.subSurface.isTranslucencyEnabled=!0,V.subSurface.volumeIndexOfRefraction=1,V.subSurface.minimumThickness=0,V.subSurface.maximumThickness=0,V.subSurface.useAlbedoToTintTranslucency=!1,void 0===Z.diffuseTransmissionFactor)return V.subSurface.translucencyIntensity=0,V.subSurface.isTranslucencyEnabled=!1,Promise.resolve();V.subSurface.translucencyIntensity=Z.diffuseTransmissionFactor;const G=new Array;return V.subSurface.useGltfStyleTextures=!0,Z.diffuseTransmissionTexture&&(Z.diffuseTransmissionTexture.nonColorData=!0,G.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTransmissionTexture`,Z.diffuseTransmissionTexture).then((B=>{B.name=`${F.name} (Diffuse Transmission)`,V.subSurface.translucencyIntensityTexture=B})))),void 0!==Z.diffuseTransmissionColorFactor?V.subSurface.translucencyColor=p.Xu.fu(Z.diffuseTransmissionColorFactor):V.subSurface.translucencyColor=p.Xu.White(),Z.diffuseTransmissionColorTexture&&G.push(this._loader.loadTextureInfoAsync(`${B}/diffuseTransmissionColorTexture`,Z.diffuseTransmissionColorTexture).then((B=>{B.name=`${F.name} (Diffuse Transmission Color)`,V.subSurface.translucencyColorTexture=B}))),Promise.all(G).then((()=>{}))}}w(SB),E(SB,!0,(B=>new Bu(B)));const uu="KHR_materials_volume";class Fu{constructor(B){this.name=uu,this.order=173,this._loader=B,this.enabled=this._loader.isExtensionUsed(uu),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadVolumePropertiesAsync(Z,u,F,V)),await Promise.all(p).then((()=>{}))}))}_loadVolumePropertiesAsync(B,u,F,Z){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);if(!F.subSurface.isRefractionEnabled&&!F.subSurface.isTranslucencyEnabled||!Z.thicknessFactor)return Promise.resolve();F.subSurface.volumeIndexOfRefraction=F.indexOfRefraction;const V=void 0!==Z.attenuationDistance?Z.attenuationDistance:Number.MAX_VALUE;return F.subSurface.tintColorAtDistance=V,void 0!==Z.attenuationColor&&3==Z.attenuationColor.length&&F.subSurface.tintColor.UR(Z.attenuationColor[0],Z.attenuationColor[1],Z.attenuationColor[2]),F.subSurface.minimumThickness=0,F.subSurface.maximumThickness=Z.thicknessFactor,F.subSurface.useThicknessAsDepth=!0,Z.thicknessTexture?(Z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${B}/thicknessTexture`,Z.thicknessTexture).then((B=>{B.name=`${F.name} (Thickness)`,F.subSurface.thicknessTexture=B,F.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}w(uu),E(uu,!0,(B=>new Fu(B)));const Zu="KHR_materials_dispersion";class Vu{constructor(B){this.name=Zu,this.order=174,this._loader=B,this.enabled=this._loader.isExtensionUsed(Zu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadDispersionPropertiesAsync(Z,u,F,V)),await Promise.all(p).then((()=>{}))}))}_loadDispersionPropertiesAsync(B,u,F,Z){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);return F.subSurface.isRefractionEnabled&&Z.dispersion?(F.subSurface.isDispersionEnabled=!0,F.subSurface.dispersion=Z.dispersion,Promise.resolve()):Promise.resolve()}}w(Zu),E(Zu,!0,(B=>new Vu(B)));const pu="EXT_materials_diffuse_roughness";class Gu{constructor(B){this.name=pu,this.order=190,this._loader=B,this.enabled=this._loader.isExtensionUsed(pu)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(B,u,F)),p.push(this._loadDiffuseRoughnessPropertiesAsync(Z,V,F)),await Promise.all(p).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(B,u,F){if(!(F instanceof f.c))throw new Error(`${B}: Material type not supported`);const Z=new Array;return F.brdf.baseDiffuseModel=lB.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=u.diffuseRoughnessFactor?F.baseDiffuseRoughness=u.diffuseRoughnessFactor:F.baseDiffuseRoughness=0,u.diffuseRoughnessTexture&&Z.push(this._loader.loadTextureInfoAsync(`${B}/diffuseRoughnessTexture`,u.diffuseRoughnessTexture,(B=>{B.name=`${F.name} (Diffuse Roughness)`,F.baseDiffuseRoughnessTexture=B}))),Promise.all(Z).then((()=>{}))}}w(pu),E(pu,!0,(B=>new Gu(B)));const Ru="KHR_mesh_quantization";class eu{constructor(B){this.name=Ru,this.enabled=B.isExtensionUsed(Ru)}dispose(){}}w(Ru),E(Ru,!0,(B=>new eu(B)));const su="KHR_texture_basisu";class Yu{constructor(B){this.name=su,this._loader=B,this.enabled=B.isExtensionUsed(su)}dispose(){this._loader=null}_loadTextureAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>{const p=void 0==u.sampler?c.DefaultSampler:l.Get(`${B}/sampler`,this._loader.YR.samplers,u.sampler),G=l.Get(`${Z}/source`,this._loader.YR.images,V.source);return await this._loader._createTextureAsync(B,p,G,(B=>{F(B)}),u._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!u._textureInfo.nonColorData)}))}}w(su),E(su,!0,(B=>new Yu(B)));const Qu="KHR_texture_transform";class tu{constructor(B){this.name=Qu,this._loader=B,this.enabled=this._loader.isExtensionUsed(Qu)}dispose(){this._loader=null}loadTextureInfoAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(Z,V)=>await this._loader.loadTextureInfoAsync(B,u,(B=>{if(!(B instanceof C.d))throw new Error(`${Z}: Texture type not supported`);V.offset&&(B.uOffset=V.offset[0],B.vOffset=V.offset[1]),B.uRotationCenter=0,B.vRotationCenter=0,V.rotation&&(B.wAng=-V.rotation),V.scale&&(B.uScale=V.scale[0],B.vScale=V.scale[1]),void 0!=V.texCoord&&(B.coordinatesIndex=V.texCoord),F(B)}))))}}w(Qu),E(Qu,!0,(B=>new tu(B)));const vu="KHR_xmp_json_ld";class Du{constructor(B){this.name=vu,this.order=100,this._loader=B,this.enabled=this._loader.isExtensionUsed(vu)}dispose(){this._loader=null}onLoading(){var B,u,F;if(null===this._loader.rootBabylonMesh)return;const Z=null===(B=this._loader.YR.extensions)||void 0===B?void 0:B.KHR_xmp_json_ld,V=null===(u=this._loader.YR.asset)||void 0===u||null===(F=u.extensions)||void 0===F?void 0:F.KHR_xmp_json_ld;if(Z&&V){const B=+V.packet;Z.packets&&B<Z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=Z.packets[B])}}}function Lu(B,u,F,Z){return p.Xu.fu(u,F).scale(Z)}function qu(B,u,F,Z){return u[F]*Z}function Wu(B,u,F,Z){return-u[F]*Z}function Xu(B,u,F,Z){return u[F+1]*Z}function fu(B,u,F,Z){return u[F]*Z*2}function Cu(B){return{scale:[new Uu(t.e.ANIMATIONTYPE_FLOAT,`${B}.uScale`,qu,(()=>2)),new Uu(t.e.ANIMATIONTYPE_FLOAT,`${B}.vScale`,Xu,(()=>2))],offset:[new Uu(t.e.ANIMATIONTYPE_FLOAT,`${B}.uOffset`,qu,(()=>2)),new Uu(t.e.ANIMATIONTYPE_FLOAT,`${B}.vOffset`,Xu,(()=>2))],rotation:[new Uu(t.e.ANIMATIONTYPE_FLOAT,`${B}.wAng`,Wu,(()=>1))]}}w(vu),E(vu,!0,(B=>new Du(B)));class xu extends h.AnimationPropertyInfo{buildAnimations(B,u,F,Z){return[{babylonAnimatable:B._babylonCamera,babylonAnimation:this._buildAnimation(u,F,Z)}]}}class Uu extends h.AnimationPropertyInfo{buildAnimations(B,u,F,Z){const V=[];for(const p in B._data)V.push({babylonAnimatable:B._data[p].babylonMaterial,babylonAnimation:this._buildAnimation(u,F,Z)});return V}}class yu extends h.AnimationPropertyInfo{buildAnimations(B,u,F,Z){return[{babylonAnimatable:B._babylonLight,babylonAnimation:this._buildAnimation(u,F,Z)}]}}(0,H.i)("/cameras/{}/orthographic/xmag",[new xu(t.e.ANIMATIONTYPE_FLOAT,"orthoLeft",Wu,(()=>1)),new xu(t.e.ANIMATIONTYPE_FLOAT,"orthoRight",Xu,(()=>1))]),(0,H.i)("/cameras/{}/orthographic/ymag",[new xu(t.e.ANIMATIONTYPE_FLOAT,"orthoBottom",Wu,(()=>1)),new xu(t.e.ANIMATIONTYPE_FLOAT,"orthoTop",Xu,(()=>1))]),(0,H.i)("/cameras/{}/orthographic/zfar",[new xu(t.e.ANIMATIONTYPE_FLOAT,"maxZ",qu,(()=>1))]),(0,H.i)("/cameras/{}/orthographic/znear",[new xu(t.e.ANIMATIONTYPE_FLOAT,"qR",qu,(()=>1))]),(0,H.i)("/cameras/{}/perspective/yfov",[new xu(t.e.ANIMATIONTYPE_FLOAT,"fov",qu,(()=>1))]),(0,H.i)("/cameras/{}/perspective/zfar",[new xu(t.e.ANIMATIONTYPE_FLOAT,"maxZ",qu,(()=>1))]),(0,H.i)("/cameras/{}/perspective/znear",[new xu(t.e.ANIMATIONTYPE_FLOAT,"qR",qu,(()=>1))]),(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Uu(t.e.ANIMATIONTYPE_COLOR3,"albedoColor",Lu,(()=>4)),new Uu(t.e.ANIMATIONTYPE_FLOAT,"alpha",(function(B,u,F,Z){return u[F+3]*Z}),(()=>4))]),(0,H.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"metallic",qu,(()=>1))]),(0,H.i)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"roughness",qu,(()=>1))]);const Ou=Cu("albedoTexture");(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Ou.scale),(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Ou.offset),(0,H.i)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Ou.rotation);const gu=Cu("metallicTexture");(0,H.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",gu.scale),(0,H.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",gu.offset),(0,H.i)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",gu.rotation),(0,H.i)("/materials/{}/emissiveFactor",[new Uu(t.e.ANIMATIONTYPE_COLOR3,"emissiveColor",Lu,(()=>3))]);const Ju=Cu("bumpTexture");(0,H.i)("/materials/{}/normalTexture/scale",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"bumpTexture.level",qu,(()=>1))]),(0,H.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Ju.scale),(0,H.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Ju.offset),(0,H.i)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Ju.rotation),(0,H.i)("/materials/{}/occlusionTexture/strength",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",qu,(()=>1))]);const au=Cu("ambientTexture");(0,H.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",au.scale),(0,H.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",au.offset),(0,H.i)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",au.rotation);const Tu=Cu("emissiveTexture");(0,H.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Tu.scale),(0,H.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Tu.offset),(0,H.i)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Tu.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"anisotropy.angle",qu,(()=>1))]);const zu=Cu("anisotropy.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",zu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",zu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",zu.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",qu,(()=>1))]);const Mu=Cu("clearCoat.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Mu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Mu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Mu.rotation);const ju=Cu("clearCoat.bumpTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",ju.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",ju.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",ju.rotation);const ou=Cu("clearCoat.textureRoughness");(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",ou.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",ou.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",ou.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"emissiveIntensity",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_ior/ior",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"indexOfRefraction",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"iridescence.intensity",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",qu,(()=>1))]);const Iu=Cu("iridescence.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Iu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Iu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Iu.rotation);const mF=Cu("iridescence.thicknessTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",mF.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",mF.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",mF.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Uu(t.e.ANIMATIONTYPE_COLOR3,"sheen.color",Lu,(()=>3))]),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"sheen.roughness",qu,(()=>1))]);const Eu=Cu("sheen.texture");(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Eu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Eu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Eu.rotation);const wu=Cu("sheen.textureRoughness");(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",wu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",wu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",wu.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"metallicF0Factor",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Uu(t.e.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Lu,(()=>3))]);const Hu=Cu("metallicReflectanceTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",Hu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",Hu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",Hu.rotation);const nu=Cu("reflectanceTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",nu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",nu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",nu.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",qu,(()=>1))]);const du=Cu("subSurface.refractionIntensityTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",du.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",du.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",du.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Uu(t.e.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Lu,(()=>3))]),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",qu,(()=>1))]),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",qu,(()=>1))]);const lu=Cu("subSurface.thicknessTexture");(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",lu.scale),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",lu.offset),(0,H.i)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",lu.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Uu(t.e.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",qu,(()=>1))]);const Pu=Cu("subSurface.translucencyIntensityTexture");(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",Pu.scale),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",Pu.offset),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",Pu.rotation),(0,H.i)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Uu(t.e.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Lu,(()=>3))]);const cu=Cu("subSurface.translucencyColorTexture");(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",cu.scale),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",cu.offset),(0,H.i)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",cu.rotation),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/color",[new yu(t.e.ANIMATIONTYPE_COLOR3,"diffuse",Lu,(()=>3))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new yu(t.e.ANIMATIONTYPE_FLOAT,"intensity",qu,(()=>1))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/range",[new yu(t.e.ANIMATIONTYPE_FLOAT,"range",qu,(()=>1))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new yu(t.e.ANIMATIONTYPE_FLOAT,"innerAngle",fu,(()=>1))]),(0,H.i)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new yu(t.e.ANIMATIONTYPE_FLOAT,"angle",fu,(()=>1))]),(0,H.i)("/nodes/{}/extensions/EXT_lights_ies/color",[new yu(t.e.ANIMATIONTYPE_COLOR3,"diffuse",Lu,(()=>3))]),(0,H.i)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new yu(t.e.ANIMATIONTYPE_FLOAT,"intensity",qu,(()=>1))]);const hu="KHR_animation_pointer";class iu{constructor(B){this.name=hu,this._loader=B,this._pathToObjectConverter=(0,H.h)(this._loader.YR)}get enabled(){return this._loader.isExtensionUsed(hu)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(B,u,F,Z,V){var p;const G=null===(p=Z.target.extensions)||void 0===p?void 0:p.KHR_animation_pointer;if(!G||!this._pathToObjectConverter)return null;"pointer"!==Z.target.path&&L.d.Warn(`${B}/target/path: Value (${Z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=Z.target.node&&L.d.Warn(`${B}/target/node: Value (${Z.target.node}) must not be present when using the ${this.name} extension`);const R=`${B}/extensions/${this.name}`,e=G.pointer;if(!e)throw new Error(`${R}: Pointer is missing`);try{const p=this._pathToObjectConverter.convert(e);if(!p.info.interpolation)throw new Error(`${R}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(B,u,F,Z,{object:p.object,info:p.info.interpolation},V)}catch(s){return L.d.Warn(`${R}/pointer: Invalid pointer (${e}) skipped`),null}}}w(hu),E(hu,!0,(B=>new iu(B)));class ru{constructor(B,u,F){this.frame=B,this.action=u,this.onlyOnce=F,this.isDone=!1}_clone(){return new ru(this.frame,this.action,this.onlyOnce)}}var Ku=F(12843),Nu=F(12888),Au=F(12882);class bu{get loop(){return this._loop}set loop(B){B!==this._loop&&(this._loop=B,this.updateOptions({loop:B}))}get currentTime(){var B;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.audioContext&&(this.isPlaying||this.isPaused)){const B=this.isPaused?0:Nu.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+B}return 0}get spatialSound(){return this._spatialSound}set spatialSound(B){if(B==this._spatialSound)return;const u=this.isPlaying;this.pause(),B?(this._spatialSound=B,this._updateSpatialParameters()):this._disableSpatialSound(),u&&this.play()}constructor(B,u,F){var Z;let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new Y.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=V.Du.Zero(),this._localDirection=new V.Du(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=B,F=F||D.b.LastCreatedScene)if(this._scene=F,bu._SceneComponentInitialization(F),this._readyToPlayCallback=p,this._customAttenuationFunction=(B,u,F,Z,V)=>u<F?B*(1-u/F):0,R&&(this.autoplay=R.autoplay||!1,this._loop=R.loop||!1,void 0!==R.volume&&(this._volume=R.volume),this._spatialSound=R.spatialSound??!1,this.maxDistance=R.maxDistance??100,this.useCustomAttenuation=R.useCustomAttenuation??!1,this.rolloffFactor=R.rolloffFactor||1,this.refDistance=R.refDistance||1,this.distanceModel=R.distanceModel||"linear",this._playbackRate=R.playbackRate||1,this._streaming=R.streaming??!1,this._length=R.length,this._offset=R.offset),null!==(Z=Nu.c.audioEngine)&&void 0!==Z&&Z.canUseWebAudio&&Nu.c.audioEngine.audioContext){this._soundGain=Nu.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let B=!0;if(u)try{"string"===typeof u?(this._urlType="String",this._url=u):u instanceof ArrayBuffer?this._urlType="ArrayBuffer":u instanceof HTMLMediaElement?this._urlType="MediaElement":u instanceof MediaStream?this._urlType="MediaStream":u instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(u)&&(this._urlType="Array");let F=[],Z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Nu.c.audioEngine.audioContext.createMediaElementSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Nu.c.audioEngine.audioContext.createMediaStreamSource(u),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":u.byteLength>0&&(Z=!0,this._soundLoaded(u));break;case"AudioBuffer":this._audioBufferLoaded(u);break;case"String":F.push(u);case"Array":0===F.length&&(F=u);for(let B=0;B<F.length;B++){const u=F[B];if(Z=R&&R.skipCodecCheck||-1!==u.indexOf(".mp3",u.length-4)&&Nu.c.audioEngine.isMP3supported||-1!==u.indexOf(".ogg",u.length-4)&&Nu.c.audioEngine.isOGGsupported||-1!==u.indexOf(".wav",u.length-4)||-1!==u.indexOf(".m4a",u.length-4)||-1!==u.indexOf(".mp4",u.length-4)||-1!==u.indexOf("blob:"),Z){this._streaming?(this._htmlAudioElement=new Audio(u),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,G.Tools.SetCorsBehavior(u,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(u,(B=>{this._soundLoaded(B)}),void 0,!0,!0,(B=>{B&&L.d.Error("XHR "+B.status+" error on: "+u+"."),L.d.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:B=!1}B?Z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):L.d.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(e){L.d.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Nu.c.audioEngine&&!Nu.c.audioEngine.WarnedWebAudioUnsupported&&(L.d.Error("Web Audio is not supported by your browser."),Nu.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var B;null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(B){var u;null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.audioContext&&(this._audioBuffer=B,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(B){var u;null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.audioContext&&Nu.c.audioEngine.audioContext.decodeAudioData(B,(B=>{this._audioBufferLoaded(B)}),(B=>{L.d.Error("Error while decoding audio data for: "+this.name+" / Error: "+B)}))}setAudioBuffer(B){var u;null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&(this._audioBuffer=B,this._isReadyToPlay=!0)}updateOptions(B){B&&(this.loop=B.loop??this.loop,this.maxDistance=B.maxDistance??this.maxDistance,this.useCustomAttenuation=B.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=B.rolloffFactor??this.rolloffFactor,this.refDistance=B.refDistance??this.refDistance,this.distanceModel=B.distanceModel??this.distanceModel,this._playbackRate=B.playbackRate??this._playbackRate,this._length=B.length??void 0,this.spatialSound=B.spatialSound??this._spatialSound,this._setOffset(B.offset??void 0),this.setVolume(B.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var B;null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.canUseWebAudio&&Nu.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Nu.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var B;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(B=this._soundPanner)||void 0===B||B.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var B;null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(B){var u;null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(B),this._isOutputConnected=!0)}setDirectionalCone(B,u,F){u<B?L.d.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=B,this._coneOuterAngle=u,this._coneOuterGain=F,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(B){if(B!=this._coneInnerAngle){var u;if(this._coneOuterAngle<B)return void L.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=B,null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(B){if(B!=this._coneOuterAngle){var u;if(B<this._coneInnerAngle)return void L.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=B,null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(B){var u;B.equals(this._position)||(this._position.Z(B),null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(B){var u;this._localDirection=B,null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const B=this._connectedTransformNode.getWorldMatrix(),u=V.Du.TransformNormal(this._localDirection,B);u.normalize(),this._soundPanner.orientationX.value=u.x,this._soundPanner.orientationY.value=u.y,this._soundPanner.orientationZ.value=u.z}updateDistanceFromListener(){var B;if(null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const B=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Lu(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,B,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(B){this._customAttenuationFunction=B}play(B,u,F){var Z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(Z=Nu.c.audioEngine)&&void 0!==Z&&Z.audioContext)try{var V,p;this._clearTimeoutsAndObservers();let Z=B?(null===(V=Nu.c.audioEngine)||void 0===V?void 0:V.audioContext.currentTime)+B:null===(p=Nu.c.audioEngine)||void 0===p?void 0:p.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Nu.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const B=()=>{var F;if(null!==(F=Nu.c.audioEngine)&&void 0!==F&&F.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=u??0;const F=this._htmlAudioElement.play();void 0!==F&&F.catch((()=>{var u,F;(null===(u=Nu.c.audioEngine)||void 0===u||u.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(F=Nu.c.audioEngine)||void 0===F?void 0:F.onAudioUnlockedObservable.addOnce((()=>{B()})))}))}else{var Z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(Z=Nu.c.audioEngine)||void 0===Z?void 0:Z.onAudioUnlockedObservable.addOnce((()=>{B()}))}};B()}}else{var G;const V=()=>{var V;if(null!==(V=Nu.c.audioEngine)&&void 0!==V&&V.audioContext){var p;if(F=F||this._length,void 0!==u&&this._setOffset(u),this._soundSource){const B=this._soundSource;B.onended=()=>{B.disconnect()}}if(this._soundSource=null===(p=Nu.c.audioEngine)||void 0===p?void 0:p.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var G;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==u&&(this._soundSource.loopStart=u),void 0!==F&&(this._soundSource.loopEnd=(0|u)+F),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},Z=B?(null===(G=Nu.c.audioEngine)||void 0===G?void 0:G.audioContext.currentTime)+B:Nu.c.audioEngine.audioContext.currentTime;const V=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(Z,V,this.loop?void 0:F)}}};"suspended"===(null===(G=Nu.c.audioEngine)||void 0===G?void 0:G.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var B;"suspended"===(null===(B=Nu.c.audioEngine)||void 0===B?void 0:B.audioContext.state)?(Nu.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Nu.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{V()})))):V()}),500):V()}this._startTime=Z,this.isPlaying=!0,this.isPaused=!1}catch(R){L.d.Error("Error while trying to play audio: "+this.name+", "+R.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(B){var u;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var F;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(F=this._streamingSource)||void 0===F||F.disconnect();this.isPlaying=!1}else if(null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.audioContext&&this._soundSource){const u=B?Nu.c.audioEngine.audioContext.currentTime+B:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(u)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var B;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var u;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(u=this._streamingSource)||void 0===u||u.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Nu.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(B,u){var F;null!==(F=Nu.c.audioEngine)&&void 0!==F&&F.canUseWebAudio&&this._soundGain&&(u&&Nu.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Nu.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Nu.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(B,Nu.c.audioEngine.audioContext.currentTime+u)):this._soundGain.gain.value=B),this._volume=B}setPlaybackRate(B){this._playbackRate=B,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(B){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=B,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=B=>this._onRegisterAfterWorldMatrixUpdate(B),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(B){var u;if(B.getBoundingInfo){const u=B.getBoundingInfo();this.setPosition(u.boundingSphere.centerWorld)}else this.setPosition(B.absolutePosition);null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const B=()=>{(0,Au.d)((()=>this._isReadyToPlay),(()=>{F._audioBuffer=this.getAudioBuffer(),F._isReadyToPlay=!0,F.autoplay&&F.play(0,this._offset,this._length)}),void 0,300)},u={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},F=new bu(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,u);return this.useCustomAttenuation&&F.setAttenuationFunction(this._customAttenuationFunction),F.setPosition(this._position),F.setPlaybackRate(this._playbackRate),B(),F}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const B={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(B.connectedMeshId=this._connectedTransformNode.id),B.position=this._position.DR(),B.refDistance=this.refDistance,B.distanceModel=this.distanceModel,B.isDirectional=this._isDirectional,B.localDirectionToMesh=this._localDirection.DR(),B.coneInnerAngle=this._coneInnerAngle,B.coneOuterAngle=this._coneOuterAngle,B.coneOuterGain=this._coneOuterGain),B}static Parse(B,u,F,Z){const p=B.name;let G;G=B.url?F+B.url:F+p;const R={autoplay:B.autoplay,loop:B.loop,volume:B.volume,spatialSound:B.spatialSound,maxDistance:B.maxDistance,rolloffFactor:B.rolloffFactor,refDistance:B.refDistance,distanceModel:B.distanceModel,playbackRate:B.playbackRate};let e;if(Z){const B=()=>{(0,Au.d)((()=>Z._isReadyToPlay),(()=>{e._audioBuffer=Z.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play(0,e._offset,e._length)}),void 0,300)};e=new bu(p,new ArrayBuffer(0),u,null,R),B()}else e=new bu(p,G,u,(()=>{u.removePendingData(e)}),R),u.addPendingData(e);if(B.position){const u=V.Du.fu(B.position);e.setPosition(u)}if(B.isDirectional&&(e.setDirectionalCone(B.coneInnerAngle||360,B.coneOuterAngle||360,B.coneOuterGain||0),B.localDirectionToMesh)){const u=V.Du.fu(B.localDirectionToMesh);e.setLocalDirectionToMesh(u)}if(B.connectedMeshId){const F=u.getMeshById(B.connectedMeshId);F&&e.attachToMesh(F)}return B.metadata&&(e.metadata=B.metadata),e}_setOffset(B){this._offset!==B&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=B)}_clearTimeoutsAndObservers(){var B;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(B=Nu.c.audioEngine)||void 0===B||B.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}bu._SceneComponentInitialization=B=>{throw(0,Ku.e)("AudioSceneComponent")},(0,UB.f)("BABYLON.Sound",bu);class ku{constructor(B,u,F){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],u.length!==F.length)throw new Error("Sounds length does not equal weights length");this.loop=B,this._weights=F;let Z=0;for(const p of F)Z+=p;const V=Z>0?1/Z:0;for(let p=0;p<this._weights.length;p++)this._weights[p]*=V;this._sounds=u;for(const p of this._sounds)p.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(B){if(B!==this._coneInnerAngle){if(this._coneOuterAngle<B)return void L.d.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=B;for(const u of this._sounds)u.directionalConeInnerAngle=B}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(B){if(B!==this._coneOuterAngle){if(B<this._coneInnerAngle)return void L.d.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=B;for(const u of this._sounds)u.directionalConeOuterAngle=B}}get volume(){return this._volume}set volume(B){if(B!==this._volume)for(const u of this._sounds)u.setVolume(B)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(B){if(!this.isPaused){this.stop();const B=Math.random();let u=0;for(let F=0;F<this._weights.length;F++)if(u+=this._weights[F],B<=u){this._currentIndex=F;break}}const u=this._sounds[this._currentIndex??0];u.isReady()?u.play(0,this.isPaused?void 0:B):u.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Su{constructor(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(B=B||D.b.LastCreatedScene)&&(this._scene=B,this.soundCollection=[],this._options=u,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var B;null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.canUseWebAudio&&Nu.c.audioEngine.audioContext&&(this._outputAudioNode=Nu.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Nu.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Nu.c.audioEngine&&Nu.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(B){var u;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&B.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==B.soundTrackId&&(-1===B.soundTrackId?this._scene.mainSoundTrack.removeSound(B):this._scene.soundTracks&&this._scene.soundTracks[B.soundTrackId].removeSound(B)),this.soundCollection.push(B),B.soundTrackId=this.id}removeSound(B){const u=this.soundCollection.indexOf(B);-1!==u&&this.soundCollection.splice(u,1)}setVolume(B){var u;null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=B)}switchPanningModelToHRTF(){var B;if(null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var B;if(null!==(B=Nu.c.audioEngine)&&void 0!==B&&B.canUseWebAudio)for(let u=0;u<this.soundCollection.length;u++)this.soundCollection[u].switchPanningModelToEqualPower()}connectToAnalyser(B){var u;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=B,null!==(u=Nu.c.audioEngine)&&void 0!==u&&u.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Nu.c.audioEngine.masterGain))}}var BF=F(13256),uF=F(13221),FF=F(12816);Nu.c.AudioEngineFactory=(B,u,F)=>new ZF(B,u,F);class ZF{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new Y.b,this.onAudioLockedObservable=new Y.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,FF.j)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const Z=document.createElement("audio");this._hostElement=B,this._audioContext=u,this._audioDestination=F;try{Z&&Z.canPlayType&&(Z.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||Z.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(V){}try{Z&&Z.canPlayType&&Z.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(V){}}lock(){this._triggerSuspendedState()}unlock(){var B,u;if("running"===(null===(B=this._audioContext)||void 0===B?void 0:B.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(u=this._audioContext)||void 0===u||u.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{L.d.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var B;null===(B=this._audioContext)||void 0===B||B.addEventListener("statechange",(()=>{var B;this.unlocked&&"running"!==(null===(B=this._audioContext)||void 0===B?void 0:B.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var B;return null!==(B=this._audioContext)&&void 0!==B&&B.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(B){this.canUseWebAudio=!1,L.d.Error("Web Audio: "+B.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(B){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const B=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",u=document.createElement("style");u.appendChild(document.createTextNode(B)),document.getElementsByTagName("head")[0].appendChild(u),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var B;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(B=this._audioContext)||void 0===B||B.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(B){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=B)}connectToAnalyser(B){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=B,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var VF=F(12834);(0,F(14332).h)(BF.d.NAME_AUDIO,((B,u,F,Z)=>{let V,p=[];if(F.Zv=F.Zv||[],void 0!==B.Zv&&null!==B.Zv)for(let R=0,e=B.Zv.length;R<e;R++){var G;const e=B.Zv[R];null!==(G=Nu.c.audioEngine)&&void 0!==G&&G.canUseWebAudio?(e.url||(e.url=e.name),p[e.url]?F.Zv.push(bu.Parse(e,u,Z,p[e.url])):(V=bu.Parse(e,u,Z),p[e.url]=V,F.Zv.push(V))):F.Zv.push(new bu(e.name,null,u))}p=[]})),Object.defineProperty(uF.e.prototype,"mainSoundTrack",{get:function(){let B=this._getComponent(BF.d.NAME_AUDIO);return B||(B=new pF(this),this.ZR(B)),this._mainSoundTrack||(this._mainSoundTrack=new Su(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),uF.e.prototype.getSoundByName=function(B){let u;for(u=0;u<this.mainSoundTrack.soundCollection.length;u++)if(this.mainSoundTrack.soundCollection[u].name===B)return this.mainSoundTrack.soundCollection[u];if(this.soundTracks)for(let F=0;F<this.soundTracks.length;F++)for(u=0;u<this.soundTracks[F].soundCollection.length;u++)if(this.soundTracks[F].soundCollection[u].name===B)return this.soundTracks[F].soundCollection[u];return null},Object.defineProperty(uF.e.prototype,"audioEnabled",{get:function(){let B=this._getComponent(BF.d.NAME_AUDIO);return B||(B=new pF(this),this.ZR(B)),B.audioEnabled},set:function(B){let u=this._getComponent(BF.d.NAME_AUDIO);u||(u=new pF(this),this.ZR(u)),B?u.enableAudio():u.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(uF.e.prototype,"headphone",{get:function(){let B=this._getComponent(BF.d.NAME_AUDIO);return B||(B=new pF(this),this.ZR(B)),B.headphone},set:function(B){let u=this._getComponent(BF.d.NAME_AUDIO);u||(u=new pF(this),this.ZR(u)),B?u.switchAudioModeForHeadphones():u.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(uF.e.prototype,"audioListenerPositionProvider",{get:function(){let B=this._getComponent(BF.d.NAME_AUDIO);return B||(B=new pF(this),this.ZR(B)),B.audioListenerPositionProvider},set:function(B){let u=this._getComponent(BF.d.NAME_AUDIO);if(u||(u=new pF(this),this.ZR(u)),B&&"function"!==typeof B)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");u.audioListenerPositionProvider=B},enumerable:!0,configurable:!0}),Object.defineProperty(uF.e.prototype,"audioListenerRotationProvider",{get:function(){let B=this._getComponent(BF.d.NAME_AUDIO);return B||(B=new pF(this),this.ZR(B)),B.audioListenerRotationProvider},set:function(B){let u=this._getComponent(BF.d.NAME_AUDIO);if(u||(u=new pF(this),this.ZR(u)),B&&"function"!==typeof B)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");u.audioListenerRotationProvider=B},enumerable:!0,configurable:!0}),Object.defineProperty(uF.e.prototype,"audioPositioningRefreshRate",{get:function(){let B=this._getComponent(BF.d.NAME_AUDIO);return B||(B=new pF(this),this.ZR(B)),B.audioPositioningRefreshRate},set:function(B){let u=this._getComponent(BF.d.NAME_AUDIO);u||(u=new pF(this),this.ZR(u)),u.audioPositioningRefreshRate=B},enumerable:!0,configurable:!0});class pF{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(B){this.name=BF.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new V.Du,this._cachedCameraPosition=new V.Du,this._lastCheck=0,this._invertMatrixTemp=new V.Matrix,this._cameraDirectionTemp=new V.Du,(B=B||D.b.LastCreatedScene)&&(this.qu=B,B.soundTracks=[],B.Zv=[])}register(){this.qu._afterRenderStage.registerStep(BF.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(B){if(B.Zv=[],this.qu.soundTracks)for(let u=0;u<this.qu.soundTracks.length;u++){const F=this.qu.soundTracks[u];for(let u=0;u<F.soundCollection.length;u++)B.Zv.push(F.soundCollection[u].serialize())}}addFromContainer(B){if(B.Zv)for(const u of B.Zv)u.play(),u.autoplay=!0,this.qu.mainSoundTrack.addSound(u)}removeFromContainer(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(B.Zv)for(const F of B.Zv)F.stop(),F.autoplay=!1,this.qu.mainSoundTrack.removeSound(F),u&&F.dispose()}dispose(){const B=this.qu;if(B._mainSoundTrack&&B.mainSoundTrack.dispose(),B.soundTracks)for(let u=0;u<B.soundTracks.length;u++)B.soundTracks[u].dispose()}disableAudio(){const B=this.qu;let u;for(this._audioEnabled=!1,Nu.c.audioEngine&&Nu.c.audioEngine.audioContext&&Nu.c.audioEngine.audioContext.suspend(),u=0;u<B.mainSoundTrack.soundCollection.length;u++)B.mainSoundTrack.soundCollection[u].pause();if(B.soundTracks)for(u=0;u<B.soundTracks.length;u++)for(let F=0;F<B.soundTracks[u].soundCollection.length;F++)B.soundTracks[u].soundCollection[F].pause()}enableAudio(){const B=this.qu;let u;for(this._audioEnabled=!0,Nu.c.audioEngine&&Nu.c.audioEngine.audioContext&&Nu.c.audioEngine.audioContext.resume(),u=0;u<B.mainSoundTrack.soundCollection.length;u++)B.mainSoundTrack.soundCollection[u].isPaused&&B.mainSoundTrack.soundCollection[u].play();if(B.soundTracks)for(u=0;u<B.soundTracks.length;u++)for(let F=0;F<B.soundTracks[u].soundCollection.length;F++)B.soundTracks[u].soundCollection[F].isPaused&&B.soundTracks[u].soundCollection[F].play()}switchAudioModeForHeadphones(){const B=this.qu;if(this._headphone=!0,B.mainSoundTrack.switchPanningModelToHRTF(),B.soundTracks)for(let u=0;u<B.soundTracks.length;u++)B.soundTracks[u].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const B=this.qu;if(this._headphone=!1,B.mainSoundTrack.switchPanningModelToEqualPower(),B.soundTracks)for(let u=0;u<B.soundTracks.length;u++)B.soundTracks[u].switchPanningModelToEqualPower()}_afterRender(){const B=VF.b.Now;if(this._lastCheck&&B-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=B;const u=this.qu;if(!this._audioEnabled||!u._mainSoundTrack||!u.soundTracks||0===u._mainSoundTrack.soundCollection.length&&1===u.soundTracks.length)return;const F=Nu.c.audioEngine;if(F&&F.audioContext){let B,Z=u.activeCamera;if(u.activeCameras&&u.activeCameras.length>0&&(Z=u.activeCameras[0]),this.audioListenerPositionProvider){const B=this.audioListenerPositionProvider();F.audioContext.listener.setPosition(B.x||0,B.y||0,B.z||0)}else Z?this._cachedCameraPosition.equals(Z.globalPosition)||(this._cachedCameraPosition.Z(Z.globalPosition),F.audioContext.listener.setPosition(Z.globalPosition.x,Z.globalPosition.y,Z.globalPosition.z)):F.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const B=this.audioListenerRotationProvider();F.audioContext.listener.setOrientation(B.x||0,B.y||0,B.z||0,0,1,0)}else Z?(Z.rigCameras&&Z.rigCameras.length>0&&(Z=Z.rigCameras[0]),Z.getViewMatrix().invertToRef(this._invertMatrixTemp),V.Du.TransformNormalToRef(pF._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.Z(this._cameraDirectionTemp),F.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):F.audioContext.listener.setOrientation(0,0,0,0,1,0);for(B=0;B<u.mainSoundTrack.soundCollection.length;B++){const F=u.mainSoundTrack.soundCollection[B];F.useCustomAttenuation&&F.updateDistanceFromListener()}if(u.soundTracks)for(B=0;B<u.soundTracks.length;B++)for(let F=0;F<u.soundTracks[B].soundCollection.length;F++){const Z=u.soundTracks[B].soundCollection[F];Z.useCustomAttenuation&&Z.updateDistanceFromListener()}}}}pF._CameraDirection=new V.Du(0,0,-1),bu._SceneComponentInitialization=B=>{let u=B._getComponent(BF.d.NAME_AUDIO);u||(u=new pF(B),B.ZR(u))};const GF="MSFT_audio_emitter";class RF{constructor(B){this.name=GF,this._loader=B,this.enabled=this._loader.isExtensionUsed(GF)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const B=this._loader.YR.extensions;if(B&&B[this.name]){const u=B[this.name];this._clips=u.clips,this._emitters=u.emitters,l.Assign(this._clips),l.Assign(this._emitters)}}loadSceneAsync(B,u){return c.LoadExtensionAsync(B,u,this.name,(async(F,Z)=>{const V=new Array;V.push(this._loader.loadSceneAsync(B,u));for(const B of Z.emitters){const u=l.Get(`${F}/emitters`,this._emitters,B);if(void 0!=u.refDistance||void 0!=u.maxDistance||void 0!=u.rolloffFactor||void 0!=u.distanceModel||void 0!=u.innerAngle||void 0!=u.outerAngle)throw new Error(`${F}: Direction or Distance properties are not allowed on emitters attached to a scene`);V.push(this._loadEmitterAsync(`${F}/emitters/${u.index}`,u))}await Promise.all(V)}))}loadNodeAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(B,Z)=>{const p=new Array,R=await this._loader.loadNodeAsync(B,u,(u=>{for(const F of Z.emitters){const Z=l.Get(`${B}/emitters`,this._emitters,F);p.push(this._loadEmitterAsync(`${B}/emitters/${Z.index}`,Z).then((()=>{for(const B of Z._babylonSounds)B.attachToMesh(u),void 0==Z.innerAngle&&void 0==Z.outerAngle||(B.setLocalDirectionToMesh(V.Du.Forward()),B.setDirectionalCone(2*G.Tools.ToDegrees(void 0==Z.innerAngle?Math.PI:Z.innerAngle),2*G.Tools.ToDegrees(void 0==Z.outerAngle?Math.PI:Z.outerAngle),0))})))}F(u)}));return await Promise.all(p),R}))}loadAnimationAsync(B,u){return c.LoadExtensionAsync(B,u,this.name,(async(F,Z)=>{const V=await this._loader.loadAnimationAsync(B,u),p=new Array;l.Assign(Z.events);for(const G of Z.events)p.push(this._loadAnimationEventAsync(`${F}/events/${G.index}`,B,u,G,V));return await Promise.all(p),V}))}_loadClipAsync(B,u){if(u._objectURL)return u._objectURL;let F;if(u.uri)F=this._loader.loadUriAsync(B,u,u.uri);else{const Z=l.Get(`${B}/bufferView`,this._loader.YR.bufferViews,u.bufferView);F=this._loader.loadBufferViewAsync(`/bufferViews/${Z.index}`,Z)}return u._objectURL=F.then((B=>URL.createObjectURL(new Blob([B],{type:u.mimeType})))),u._objectURL}_loadEmitterAsync(B,u){if(u._babylonSounds=u._babylonSounds||[],!u._babylonData){const B=new Array,F=u.name||`emitter${u.index}`,Z={loop:!1,autoplay:!1,volume:void 0==u.volume?1:u.volume};for(let p=0;p<u.clips.length;p++){const V=`/extensions/${this.name}/clips`,G=l.Get(V,this._clips,u.clips[p].clip);B.push(this._loadClipAsync(`${V}/${u.clips[p].clip}`,G).then((B=>{const V=u._babylonSounds[p]=new bu(F,B,this._loader.babylonScene,null,Z);V.refDistance=u.refDistance||1,V.maxDistance=u.maxDistance||256,V.rolloffFactor=u.rolloffFactor||1,V.distanceModel=u.distanceModel||"exponential"})))}const V=Promise.all(B).then((()=>{const B=u.clips.map((B=>B.weight||1)),F=new ku(u.loop||!1,u._babylonSounds,B);u.innerAngle&&(F.directionalConeInnerAngle=2*G.Tools.ToDegrees(u.innerAngle)),u.outerAngle&&(F.directionalConeOuterAngle=2*G.Tools.ToDegrees(u.outerAngle)),u.volume&&(F.volume=u.volume),u._babylonData.sound=F}));u._babylonData={loaded:V}}return u._babylonData.loaded}_getEventAction(B,u,F,Z,V){switch(F){case"play":return B=>{const F=(V||0)+(B-Z);u.play(F)};case"stop":return()=>{u.stop()};case"pause":return()=>{u.pause()};default:throw new Error(`${B}: Unsupported action ${F}`)}}_loadAnimationEventAsync(B,u,F,Z,V){if(0==V.targetedAnimations.length)return Promise.resolve();const p=V.targetedAnimations[0],G=Z.Zu,R=l.Get(`/extensions/${this.name}/emitters`,this._emitters,G);return this._loadEmitterAsync(B,R).then((()=>{const u=R._babylonData.sound;if(u){const F=new ru(Z.time,this._getEventAction(B,u,Z.action,Z.time,Z.startOffset));p.animation.addEvent(F),V.onAnimationGroupEndObservable.add((()=>{u.stop()})),V.onAnimationGroupPauseObservable.add((()=>{u.pause()}))}}))}}w(GF),E(GF,!0,(B=>new RF(B)));const eF="MSFT_lod";class sF{constructor(B){var u;this.name=eF,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new Y.b,this.onMaterialLODsLoadedObservable=new Y.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=B,this.maxLODsToLoad=(null===(u=this._loader.parent.extensionOptions[eF])||void 0===u?void 0:u.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(eF)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let B=0;B<this._nodePromiseLODs.length;B++){const u=Promise.all(this._nodePromiseLODs[B]).then((()=>{0!==B&&(this._loader.endPerformanceCounter(`Node LOD ${B}`),this._loader.log(`Loaded node LOD ${B}`)),this.onNodeLODsLoadedObservable.notifyObservers(B),B!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${B+1}`),this._loadBufferLOD(this._nodeBufferLODs,B+1),this._nodeSignalLODs[B]&&this._nodeSignalLODs[B].resolve())}));this._loader._completePromises.push(u)}for(let B=0;B<this._materialPromiseLODs.length;B++){const u=Promise.all(this._materialPromiseLODs[B]).then((()=>{0!==B&&(this._loader.endPerformanceCounter(`Material LOD ${B}`),this._loader.log(`Loaded material LOD ${B}`)),this.onMaterialLODsLoadedObservable.notifyObservers(B),B!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${B+1}`),this._loadBufferLOD(this._materialBufferLODs,B+1),this._materialSignalLODs[B]&&this._materialSignalLODs[B].resolve())}));this._loader._completePromises.push(u)}}loadSceneAsync(B,u){const F=this._loader.loadSceneAsync(B,u);return this._loadBufferLOD(this._bufferLODs,0),F}loadNodeAsync(B,u,F){return c.LoadExtensionAsync(B,u,this.name,(async(B,V)=>{let p;const G=this._getLODs(B,u,this._loader.YR.nodes,V.ids);this._loader.logOpen(`${B}`);for(let u=0;u<G.length;u++){const B=G[u];0!==u&&(this._nodeIndexLOD=u,this._nodeSignalLODs[u]=this._nodeSignalLODs[u]||new Z);const V=B=>{F(B),B.rR(!1)},R=this._loader.loadNodeAsync(`/nodes/${B.index}`,B,V).then((B=>{if(0!==u){const B=G[u-1];B._babylonTransformNode&&(this._disposeTransformNode(B._babylonTransformNode),delete B._babylonTransformNode)}return B.rR(!0),B}));this._nodePromiseLODs[u]=this._nodePromiseLODs[u]||[],0===u?p=R:(this._nodeIndexLOD=null,this._nodePromiseLODs[u].push(R))}return this._loader.logClose(),await p}))}_loadMaterialAsync(B,u,F,Z,V){return this._nodeIndexLOD?null:c.LoadExtensionAsync(B,u,this.name,(async(B,p)=>{let G;const R=this._getLODs(B,u,this._loader.YR.materials,p.ids);this._loader.logOpen(`${B}`);for(let u=0;u<R.length;u++){const B=R[u];0!==u&&(this._materialIndexLOD=u);const p=this._loader._loadMaterialAsync(`/materials/${B.index}`,B,F,Z,(B=>{0===u&&V(B)})).then((B=>{if(0!==u){V(B);const F=R[u-1]._data;F[Z]&&(this._disposeMaterials([F[Z].babylonMaterial]),delete F[Z])}return B}));this._materialPromiseLODs[u]=this._materialPromiseLODs[u]||[],0===u?G=p:(this._materialIndexLOD=null,this._materialPromiseLODs[u].push(p))}return this._loader.logClose(),await G}))}_loadUriAsync(B,u,F){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const V=this._nodeIndexLOD-1;return this._nodeSignalLODs[V]=this._nodeSignalLODs[V]||new Z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(B,u,F)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const V=this._materialIndexLOD-1;return this._materialSignalLODs[V]=this._materialSignalLODs[V]||new Z,this._materialSignalLODs[V].promise.then((async()=>await this._loader.loadUriAsync(B,u,F)))}return null}loadBufferAsync(B,u,F,V){if(this._loader.parent.useRangeRequests&&!u.uri){if(!this._loader.bin)throw new Error(`${B}: Uri is missing or the binary glTF is missing its binary chunk`);const u=async(B,u)=>{const p=F,G=p+V-1;let R=B[u];return R?(R.start=Math.min(R.start,p),R.end=Math.max(R.end,G)):(R={start:p,end:G,loaded:new Z},B[u]=R),await R.loaded.promise.then((B=>new Uint8Array(B.buffer,B.byteOffset+F-R.start,V)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?u(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?u(this._materialBufferLODs,this._materialIndexLOD):u(this._bufferLODs,0)}return null}_loadBufferLOD(B,u){const F=B[u];F&&(this._loader.log(`Loading buffer range [${F.start}-${F.end}]`),this._loader.bin.readAsync(F.start,F.end-F.start+1).then((B=>{F.loaded.resolve(B)}),(B=>{F.loaded.reject(B)})))}_getLODs(B,u,F,Z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const V=[];for(let p=Z.length-1;p>=0;p--)if(V.push(l.Get(`${B}/ids/${Z[p]}`,F,Z[p])),V.length===this.maxLODsToLoad)return V;return V.push(u),V}_disposeTransformNode(B){const u=[],F=B.material;F&&u.push(F);for(const V of B.getChildMeshes())V.material&&u.push(V.material);B.dispose();const Z=u.filter((B=>this._loader.babylonScene.meshes.every((u=>u.material!=B))));this._disposeMaterials(Z)}_disposeMaterials(B){const u={};for(const F of B){for(const B of F.getActiveTextures())u[B.uniqueId]=B;F.dispose()}for(const F in u)for(const B of this._loader.babylonScene.materials)B.hasTexture(u[F])&&delete u[F];for(const F in u)u[F].dispose()}}w(eF),E(eF,!0,(B=>new sF(B)));const YF="MSFT_minecraftMesh";class QF{constructor(B){this.name=YF,this._loader=B,this.enabled=this._loader.isExtensionUsed(YF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtraAsync(B,u,this.name,(async(Z,V)=>{if(V){if(!(F instanceof f.c))throw new Error(`${Z}: Material type not supported`);const V=this._loader.loadMaterialPropertiesAsync(B,u,F);return F.needAlphaBlending()&&(F.forceDepthWrite=!0,F.separateCullingPass=!0),F.xR=F.forceDepthWrite,F.twoSidedLighting=!0,await V}}))}}w(YF),E(YF,!0,(B=>new QF(B)));const tF="MSFT_sRGBFactors";class vF{constructor(B){this.name=tF,this._loader=B,this.enabled=this._loader.isExtensionUsed(tF)}dispose(){this._loader=null}loadMaterialPropertiesAsync(B,u,F){return c.LoadExtraAsync(B,u,this.name,(async(Z,V)=>{if(V){if(!(F instanceof f.c))throw new Error(`${Z}: Material type not supported`);const V=this._loader.loadMaterialPropertiesAsync(B,u,F),p=F.yB().getEngine().useExactSrgbConversions;return F.albedoTexture||F.albedoColor.toLinearSpaceToRef(F.albedoColor,p),F.reflectivityTexture||F.reflectivityColor.toLinearSpaceToRef(F.reflectivityColor,p),await V}}))}}w(tF),E(tF,!0,(B=>new vF(B)));var DF=F(14683);const LF={};var qF=F(14734),WF=F(14715),XF=F(14685),fF=F(14701);function CF(B,u){for(const F of B)for(const B of F.dataOutputs)if(B.uniqueId===u)return B;throw new Error("Could not find data out connection with unique id "+u)}function xF(B,u){for(const F of B)if(F instanceof WF.b)for(const B of F.signalInputs)if(B.uniqueId===u)return B;throw new Error("Could not find signal in connection with unique id "+u)}async function UF(B,u){const Z=await Promise.all(B.allBlocks.map((async B=>{const u=function(B){switch(B){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([F.e(78),F.e(79)]).then(F.bind(F,16185))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await F.e(80).then(F.bind(F,16189))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await F.e(81).then(F.bind(F,16195))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await F.e(82).then(F.bind(F,16200))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await F.e(83).then(F.bind(F,16202))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await F.e(84).then(F.bind(F,16208))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await F.e(85).then(F.bind(F,16211))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await F.e(86).then(F.bind(F,16218))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await F.e(87).then(F.bind(F,16223))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await F.e(90).then(F.bind(F,16270))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await F.e(90).then(F.bind(F,16270))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await F.e(90).then(F.bind(F,16270))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await F.e(90).then(F.bind(F,16270))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await F.e(95).then(F.bind(F,16276))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await F.e(96).then(F.bind(F,16282))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await F.e(97).then(F.bind(F,16285))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await F.e(98).then(F.bind(F,16294))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await F.e(99).then(F.bind(F,16299))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await F.e(100).then(F.bind(F,16308))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await F.e(101).then(F.bind(F,16312))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await F.e(102).then(F.bind(F,16318))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await F.e(103).then(F.bind(F,16326))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await F.e(104).then(F.bind(F,16334))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await F.e(105).then(F.bind(F,16342))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await F.e(106).then(F.bind(F,16344))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await F.e(107).then(F.bind(F,16350))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await F.e(108).then(F.bind(F,16358))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await F.e(109).then(F.bind(F,16364))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await F.e(110).then(F.bind(F,16368))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await F.e(111).then(F.bind(F,16372))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await F.e(112).then(F.bind(F,16375))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await F.e(113).then(F.bind(F,16379))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await F.e(92).then(F.bind(F,16387))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await F.e(114).then(F.bind(F,16390))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await F.e(115).then(F.bind(F,16394))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await F.e(116).then(F.bind(F,16403))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await F.e(93).then(F.bind(F,16405))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await F.e(88).then(F.bind(F,16232))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await F.e(94).then(F.bind(F,16409))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await F.e(89).then(F.bind(F,16263))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await F.e(90).then(F.bind(F,16270))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await F.e(90).then(F.bind(F,16270))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await F.e(91).then(F.bind(F,16415))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await F.e(91).then(F.bind(F,16415))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await F.e(91).then(F.bind(F,16415))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await F.e(91).then(F.bind(F,16415))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await F.e(91).then(F.bind(F,16415))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await F.e(91).then(F.bind(F,16415))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await F.e(117).then(F.bind(F,16417))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await F.e(118).then(F.bind(F,16426))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await F.e(119).then(F.bind(F,16431))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await F.e(120).then(F.bind(F,16435))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await F.e(121).then(F.bind(F,16443))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await F.e(122).then(F.bind(F,16452))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await F.e(123).then(F.bind(F,16454))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await F.e(124).then(F.bind(F,16460))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await F.e(125).then(F.bind(F,16463))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await F.e(126).then(F.bind(F,16471))).FlowGraphDataSwitchBlock;default:if(LF[B])return LF[B];throw new Error(`Unknown block name ${B}`)}}(B.className);return await u()})));return function(B,u,F){const Z=u.coordinator.createGraph(),V=[],p=u.valueParseFunction??XF.c;for(let G=0;G<B.allBlocks.length;G++){const R=OF(B.allBlocks[G],{qu:u.coordinator.config.qu,pathConverter:u.pathConverter,assetsContainer:u.coordinator.config.qu,valueParseFunction:p},F[G]);V.push(R),R instanceof qF.b&&Z.addEventBlock(R)}for(const G of V){for(const B of G.dataInputs)for(const u of B.connectedPointIds){const F=CF(V,u);B.connectTo(F)}if(G instanceof WF.b)for(const B of G.signalOutputs)for(const u of B.connectedPointIds){const F=xF(V,u);B.connectTo(F)}}for(const G of B.executionContexts)yF(G,{graph:Z,valueParseFunction:p},B.rightHanded);return Z}(B,u,Z)}function yF(B,u,F){const Z=u.graph.createContext();B.enableLogging&&(Z.enableLogging=!0),Z.treatDataAsRightHanded=F||!1;const V=u.valueParseFunction??XF.c;Z.uniqueId=B.uniqueId;const p=Z.yB();if(B._assetsContext){var G,R,e,s,Y,Q,t,v,D,L;const u=B._assetsContext,F={meshes:null===(G=u.meshes)||void 0===G?void 0:G.map((B=>p.getMeshById(B))),lights:null===(R=u.lights)||void 0===R?void 0:R.map((B=>p.getLightByName(B))),cameras:null===(e=u.cameras)||void 0===e?void 0:e.map((B=>p.getCameraByName(B))),materials:null===(s=u.materials)||void 0===s?void 0:s.map((B=>p.getMaterialById(B))),textures:null===(Y=u.textures)||void 0===Y?void 0:Y.map((B=>p.getTextureByName(B))),animations:null===(Q=u.animations)||void 0===Q?void 0:Q.map((B=>p.animations.find((u=>u.name===B)))),skeletons:null===(t=u.skeletons)||void 0===t?void 0:t.map((B=>p.getSkeletonByName(B))),xt:null===(v=u.xt)||void 0===v?void 0:v.map((B=>p.getParticleSystemById(B))),animationGroups:null===(D=u.animationGroups)||void 0===D?void 0:D.map((B=>p.getAnimationGroupByName(B))),transformNodes:null===(L=u.transformNodes)||void 0===L?void 0:L.map((B=>p.getTransformNodeById(B))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Zv:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};Z.assetsContext=F}for(const q in B._userVariables){const u=V(q,B._userVariables,Z.assetsContext,p);Z.userVariables[q]=u}for(const q in B._connectionValues){const u=V(q,B._connectionValues,Z.assetsContext,p);Z._setConnectionValueByKey(q,u)}return Z}function OF(B,u,F){const Z={},V=u.valueParseFunction??XF.c;if(B.config)for(const G in B.config)Z[G]=V(G,B.config,u.assetsContainer||u.qu,u.qu);if((0,XF.f)(B.className)){if(!u.pathConverter)throw new Error("Path converter is required for this block");Z.pathConverter=u.pathConverter}const p=new F(Z);p.uniqueId=B.uniqueId;for(let G=0;G<B.dataInputs.length;G++){const u=p.getDataInput(B.dataInputs[G].name);if(!u)throw new Error("Could not find data input with name "+B.dataInputs[G].name+" in block "+B.className);u.deserialize(B.dataInputs[G])}for(let G=0;G<B.dataOutputs.length;G++){const u=p.getDataOutput(B.dataOutputs[G].name);if(!u)throw new Error("Could not find data output with name "+B.dataOutputs[G].name+" in block "+B.className);u.deserialize(B.dataOutputs[G])}return p.metadata=B.metadata,p.deserialize&&p.deserialize(B),p}function gF(B){const[u,F]=B.split(":");return JF({op:u,extension:F})}function JF(B){var u;let F=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const Z=B.extension?null===(u=TF[B.extension])||void 0===u?void 0:u[B.op]:zF[B.op];if(!Z&&(L.d.Warn(`No mapping found for operation ${B.op} and extension ${B.extension||"KHR_interactivity"}`),F)){const u={},F={flows:{}};if(B.inputValueSockets){u.values={};for(const F in B.inputValueSockets)u.values[F]={name:F}}return B.outputValueSockets&&(F.values={},Object.keys(B.outputValueSockets).forEach((B=>{F.values[B]={name:B}}))),{HY:[],inputs:u,outputs:F}}return Z}function aF(B,u,F){TF[u]||(TF[u]={}),TF[u][B]=F}const TF={BABYLON:{"flow/log":{HY:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},zF={"event/onStart":{HY:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{HY:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{HY:["FlowGraphSendCustomEventBlock"],extraProcessor(B,u,F,Z,V){if("event/send"!==u.op||!B.configuration||1!==Object.keys(B.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const p=B.configuration.event.value[0];if("number"!==typeof p)throw new Error("Event id should be a number");const G=Z.arrays.events[p],R=V[0];return R.config||(R.config={}),R.config.eventId=G.eventId,R.config.eventData=G.eventData,V}},"event/receive":{HY:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(B,u){var F;if(!B.configuration)return L.d.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const Z=B.configuration.event;if(!Z)return L.d.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const V=Z.value[0];if("number"!==typeof V)return L.d.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(F=u.events)||void 0===F?void 0:F[V])?{valid:!0}:(L.d.Error(`Event with id ${V} not found`),{valid:!1,error:`Event with id ${V} not found`})},extraProcessor(B,u,F,Z,V){if("event/receive"!==u.op||!B.configuration||1!==Object.keys(B.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const p=B.configuration.event.value[0];if("number"!==typeof p)throw new Error("Event id should be a number");const G=Z.arrays.events[p],R=V[0];return R.config||(R.config={}),R.config.eventId=G.eventId,R.config.eventData=G.eventData,V}},"math/e":MF("FlowGraphEBlock"),"math/pi":MF("FlowGraphPIBlock"),"math/inf":MF("FlowGraphInfBlock"),"math/nan":MF("FlowGraphNaNBlock"),"math/abs":MF("FlowGraphAbsBlock"),"math/sign":MF("FlowGraphSignBlock"),"math/trunc":MF("FlowGraphTruncBlock"),"math/floor":MF("FlowGraphFloorBlock"),"math/ceil":MF("FlowGraphCeilBlock"),"math/round":{HY:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V){var p;return(p=V[0]).config||(p.config={}),V[0].config.roundHalfAwayFromZero=!0,V}},"math/fract":MF("FlowGraphFractBlock"),"math/neg":MF("FlowGraphNegationBlock"),"math/add":MF("FlowGraphAddBlock",["a","b"],!0),"math/sub":MF("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{HY:["FlowGraphMultiplyBlock"],extraProcessor(B,u,F,Z,V){var p;(p=V[0]).config||(p.config={}),V[0].config.useMatrixPerComponent=!0,V[0].config.preventIntegerFloatArithmetic=!0;let G=-1;return Object.keys(B.values||{}).find((u=>{var F;return void 0!==(null===(F=B.values)||void 0===F?void 0:F[u].type)&&(G=B.values[u].type,!0)})),-1!==G&&(V[0].config.type=Z.arrays.types[G].flowGraphType),V},validation:B=>B.values?jF(B):{valid:!0}},"math/div":MF("FlowGraphDivideBlock",["a","b"],!0),"math/rem":MF("FlowGraphModuloBlock",["a","b"]),"math/min":MF("FlowGraphMinBlock",["a","b"]),"math/max":MF("FlowGraphMaxBlock",["a","b"]),"math/clamp":MF("FlowGraphClampBlock",["a","b","c"]),"math/saturate":MF("FlowGraphSaturateBlock"),"math/mix":MF("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":MF("FlowGraphEqualityBlock",["a","b"]),"math/lt":MF("FlowGraphLessThanBlock",["a","b"]),"math/le":MF("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":MF("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":MF("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":MF("FlowGraphIsNaNBlock"),"math/isinf":MF("FlowGraphIsInfBlock"),"math/select":{HY:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{HY:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":MF("FlowGraphSinBlock"),"math/cos":MF("FlowGraphCosBlock"),"math/tan":MF("FlowGraphTanBlock"),"math/asin":MF("FlowGraphASinBlock"),"math/acos":MF("FlowGraphACosBlock"),"math/atan":MF("FlowGraphATanBlock"),"math/atan2":MF("FlowGraphATan2Block",["a","b"]),"math/sinh":MF("FlowGraphSinhBlock"),"math/cosh":MF("FlowGraphCoshBlock"),"math/tanh":MF("FlowGraphTanhBlock"),"math/asinh":MF("FlowGraphASinhBlock"),"math/acosh":MF("FlowGraphACoshBlock"),"math/atanh":MF("FlowGraphATanhBlock"),"math/exp":MF("FlowGraphExponentialBlock"),"math/log":MF("FlowGraphLogBlock"),"math/log2":MF("FlowGraphLog2Block"),"math/log10":MF("FlowGraphLog10Block"),"math/sqrt":MF("FlowGraphSquareRootBlock"),"math/cbrt":MF("FlowGraphCubeRootBlock"),"math/pow":MF("FlowGraphPowerBlock",["a","b"]),"math/length":MF("FlowGraphLengthBlock"),"math/normalize":MF("FlowGraphNormalizeBlock"),"math/dot":MF("FlowGraphDotBlock",["a","b"]),"math/cross":MF("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":MF("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":MF("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{HY:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{HY:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{HY:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{HY:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{HY:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{HY:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{HY:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":MF("FlowGraphTransposeBlock"),"math/determinant":MF("FlowGraphDeterminantBlock"),"math/inverse":MF("FlowGraphInvertMatrixBlock"),"math/matmul":MF("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{HY:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"yR",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V,p){const G=V[0].dataInputs.find((B=>"rotationQuaternion"===B.name));if(!G)throw new Error("Rotation quaternion input not found");return p._connectionValues[G.uniqueId]&&(p._connectionValues[G.uniqueId].type="Quaternion"),V}},"math/matDecompose":{HY:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"yR"}}}},"math/quatConjugate":MF("FlowGraphConjugateBlock",["a"]),"math/quatMul":{HY:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V){var p;return(p=V[0]).config||(p.config={}),V[0].config.type="Quaternion",V}},"math/quatAngleBetween":MF("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{HY:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":MF("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":MF("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{HY:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V){var p;return(p=V[0]).config||(p.config={}),V[0].config.inputIsColumnMajor=!0,V}},"math/extract2x2":{HY:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{HY:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V){var p;return(p=V[0]).config||(p.config={}),V[0].config.inputIsColumnMajor=!0,V}},"math/extract3x3":{HY:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{HY:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V){var p;return(p=V[0]).config||(p.config={}),V[0].config.inputIsColumnMajor=!0,V}},"math/extract4x4":{HY:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{HY:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V,p){var G,R;(R=V[0]).config||(R.config={});const e=V[0].dataInputs[0];return V[0].config.valueType=(null===(G=p._connectionValues[e.uniqueId])||void 0===G?void 0:G.type)??"FlowGraphInteger",V}},"math/and":{HY:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V,p){var G,R,e;(e=V[0]).config||(e.config={});const s=V[0].dataInputs[0],Y=V[0].dataInputs[1];return V[0].config.valueType=(null===(G=p._connectionValues[s.uniqueId])||void 0===G?void 0:G.type)??(null===(R=p._connectionValues[Y.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",V}},"math/or":{HY:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V,p){var G,R,e;(e=V[0]).config||(e.config={});const s=V[0].dataInputs[0],Y=V[0].dataInputs[1];return V[0].config.valueType=(null===(G=p._connectionValues[s.uniqueId])||void 0===G?void 0:G.type)??(null===(R=p._connectionValues[Y.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",V}},"math/xor":{HY:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(B,u,F,Z,V,p){var G,R,e;(e=V[0]).config||(e.config={});const s=V[0].dataInputs[0],Y=V[0].dataInputs[1];return V[0].config.valueType=(null===(G=p._connectionValues[s.uniqueId])||void 0===G?void 0:G.type)??(null===(R=p._connectionValues[Y.uniqueId])||void 0===R?void 0:R.type)??"FlowGraphInteger",V}},"math/asr":MF("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":MF("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":MF("FlowGraphLeadingZerosBlock"),"math/ctz":MF("FlowGraphTrailingZerosBlock"),"math/popcnt":MF("FlowGraphOneBitsCounterBlock"),"math/rad":MF("FlowGraphDegToRadBlock"),"math/deg":MF("FlowGraphRadToDegBlock"),"type/boolToInt":MF("FlowGraphBooleanToInt"),"type/boolToFloat":MF("FlowGraphBooleanToFloat"),"type/intToBool":MF("FlowGraphIntToBoolean"),"type/intToFloat":MF("FlowGraphIntToFloat"),"type/floatToInt":MF("FlowGraphFloatToInt"),"type/floatToBool":MF("FlowGraphFloatToBoolean"),"flow/sequence":{HY:["FlowGraphSequenceBlock"],extraProcessor(B,u,F,Z,V){const p=V[0];return p.config||(p.config={}),p.config.outputSignalCount=Object.keys(B.flows||[]).length,p.signalOutputs.forEach(((B,u)=>{B.name="out_"+u})),V}},"flow/branch":{HY:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{HY:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(B){if(B.configuration&&B.configuration.cases){const u=B.configuration.cases.value;if(!u.every((B=>"number"===typeof B&&/^-?\d+$/.test(B.toString()))))return L.d.Warn("Switch cases should be integers. Using empty array instead."),B.configuration.cases.value=[],{valid:!0};const F=new Set(u);B.configuration.cases.value=Array.from(F)}return{valid:!0}},extraProcessor(B,u,F,Z,V){if("flow/switch"!==u.op||!B.flows||0===Object.keys(B.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return V[0].signalOutputs.forEach((B=>{"default"!==B.name&&(B.name="out_"+B.name)})),V}},"flow/while":{HY:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{HY:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(B,u,F,Z,V){const p=V[0];return p.config||(p.config={}),p.config.incrementIndexWhenLoopDone=!0,V}},"flow/doN":{HY:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{HY:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(B,u,F,Z,V){if("flow/multiGate"!==u.op||!B.flows||0===Object.keys(B.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const p=V[0];return p.config||(p.config={}),p.config.outputSignalCount=Object.keys(B.flows).length,p.signalOutputs.forEach(((B,u)=>{B.name="out_"+u})),V}},"flow/waitAll":{HY:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(B){var u,F;return"number"!==typeof(null===(u=B.configuration)||void 0===u||null===(F=u.inputFlows)||void 0===F?void 0:F.value[0])&&(B.configuration=B.configuration||{inputFlows:{value:[0]}},B.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{HY:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{HY:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{HY:["FlowGraphCancelDelayBlock"]},"variable/get":{HY:["FlowGraphGetVariableBlock"],validation(B){var u,F;return null!==(u=B.configuration)&&void 0!==u&&null!==(F=u.variable)&&void 0!==F&&F.value?{valid:!0}:(L.d.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(B,u)=>[u.getVariableName(B[0])]}}},"variable/set":{HY:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(B,u)=>[u.getVariableName(B[0])]}}},"variable/setMultiple":{HY:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(B,u)=>[B[0].map((B=>u.getVariableName(B)))]}},extraProcessor:(B,u,F,Z,V)=>(V[0].dataInputs.forEach((B=>{B.name=Z.getVariableName(+B.name)})),V)},"variable/interpolate":{HY:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(B,u)=>[u.getVariableName(B[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:B=>!0===B[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xF:"FlowGraphPlayAnimationBlock"},out:{name:"out",xF:"FlowGraphPlayAnimationBlock"},done:{name:"done",xF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(B,u,F,Z,V){var p,G,R;const e=V[0],s=null===(p=B.configuration)||void 0===p?void 0:p.variable.value[0];if("number"!==typeof s)throw L.d.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const Y=Z.arrays.staticVariables[s];"undefined"===typeof e.config.animationType.value&&(Z.arrays.staticVariables,e.config.animationType.value=(0,fF.J)(Y.type));const Q=V[4];return Q.config||(Q.config={}),(G=Q.config).variable||(G.variable={}),Q.config.variable.value=Z.getVariableName(s),(R=V[3]).config||(R.config={}),V}},"pointer/get":{HY:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",xF:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,u,F,Z,V)=>(V.forEach((B=>{"FlowGraphJsonPointerParserBlock"===B.className&&(B.config||(B.config={}),B.config.outputValue=!0)})),V)},"pointer/set":{HY:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",xF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",xF:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,u,F,Z,V)=>(V.forEach((B=>{"FlowGraphJsonPointerParserBlock"===B.className&&(B.config||(B.config={}),B.config.outputValue=!0)})),V)},"pointer/interpolate":{HY:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",xF:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",xF:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",xF:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",xF:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",xF:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",xF:"FlowGraphPlayAnimationBlock"},out:{name:"out",xF:"FlowGraphPlayAnimationBlock"},done:{name:"done",xF:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(B,u,F,Z,V)=>(V.forEach((u=>{"FlowGraphJsonPointerParserBlock"===u.className?(u.config||(u.config={}),u.config.outputValue=!0):"FlowGraphInterpolationBlock"===u.className&&(u.config||(u.config={}),Object.keys(B.values||[]).forEach((F=>{var V;const p=null===(V=B.values)||void 0===V?void 0:V[F];if("value"===F&&p){const B=p.type;void 0!==B&&(u.config.animationType=Z.arrays.types[B].flowGraphType)}})))})),V)},"animation/start":{HY:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xF:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(B,u)=>[B[0]*u._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(B,u)=>[B[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,u,F,Z,V,p,G){const R=V[V.length-1];return R.config||(R.config={}),R.config.glTF=G,V}},"animation/stop":{HY:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",xF:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,u,F,Z,V,p,G){const R=V[V.length-1];return R.config||(R.config={}),R.config.glTF=G,V}},"animation/stopAt":{HY:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",xF:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(B,u)=>[B[0]*u._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(B,u,F,Z,V,p,G){const R=V[V.length-1];return R.config||(R.config={}),R.config.glTF=G,V}},"math/switch":{HY:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(B){if(B.configuration&&B.configuration.cases){const u=B.configuration.cases.value;if(!u.every((B=>"number"===typeof B&&/^-?\d+$/.test(B.toString()))))return L.d.Warn("Switch cases should be integers. Using empty array instead."),B.configuration.cases.value=[],{valid:!0};const F=new Set(u);B.configuration.cases.value=Array.from(F)}return{valid:!0}},extraProcessor(B,u,F,Z,V){const p=V[0];return p.dataInputs.forEach((B=>{"default"!==B.name&&"case"!==B.name&&(B.name="in_"+B.name)})),p.config||(p.config={}),p.config.treatCasesAsIntegers=!0,V}},"debug/log":{HY:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function MF(B){let u=arguments.length>2?arguments[2]:void 0;return{HY:[B],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((B,u)=>(B[u]={name:u},B)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(B,F,Z,V,p){var G;if(u){(G=p[0]).config||(G.config={}),p[0].config.preventIntegerFloatArithmetic=!0;let u=-1;Object.keys(B.values||{}).find((F=>{var Z;return void 0!==(null===(Z=B.values)||void 0===Z?void 0:Z[F].type)&&(u=B.values[F].type,!0)})),-1!==u&&(p[0].config.type=V.arrays.types[u].flowGraphType)}return p},validation:B=>u?jF(B):{valid:!0}}}function jF(B){if(B.values){const u=Object.keys(B.values).map((u=>B.values[u].type)).filter((B=>void 0!==B));if(!u.every((B=>B===u[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}zF["math/compose"]=zF["math/matCompose"],zF["math/decompose"]=zF["math/matDecompose"];var oF=F(12955);const IF={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Du",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class mZ{constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=B,this._gltf=u,this._animationTargetFps=F,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const B of this._interactivityGraph.types)this._types.push(IF[B.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const B of this._interactivityGraph.declarations){const u=JF(B);if(!u)throw L.d.Error(["No mapping found for declaration",B]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:u,fullOperationName:B.extension?B.op+":"+B.extension:B.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const B of this._interactivityGraph.variables){const u=this._parseVariable(B);this._staticVariables.push(u)}}_parseVariable(B,u){const F=this._types[B.type];if(!F)throw L.d.Error(["No type found for variable",B]),new Error("Error parsing variables");if(B.value&&B.value.length!==F.length)throw L.d.Error(["Invalid value length for variable",B,F]),new Error("Error parsing variables");const Z=B.value||[];if(!Z.length)switch(F.flowGraphType){case"boolean":Z.push(!1);break;case"FlowGraphInteger":Z.push(0);break;case"number":Z.push(NaN);break;case"Vector2":Z.push(NaN,NaN);break;case"Du":Z.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":Z.fill(NaN,0,4);break;case"Matrix":Z.fill(NaN,0,16);break;case"Matrix3D":Z.fill(NaN,0,9)}return"number"===F.elementType&&"string"===typeof Z[0]&&(Z[0]=parseFloat(Z[0])),{type:F.flowGraphType,value:u?u(Z,this):Z}}_parseEvents(){if(this._interactivityGraph.events)for(const B of this._interactivityGraph.events){const u={eventId:B.id||"internalEvent_"+this._internalEventsCounter++};B.values&&(u.eventData=Object.keys(B.values).map((u=>{var F;const Z=null===(F=B.values)||void 0===F?void 0:F[u];if(!Z)throw L.d.Error(["No value found for event key",u]),new Error("Error parsing events");const V=this._types[Z.type];if(!V)throw L.d.Error(["No type found for event value",Z]),new Error("Error parsing events");const p="undefined"!==typeof Z.value?this._parseVariable(Z):void 0;return{id:u,type:V.flowGraphType,eventData:!0,value:p}}))),this._events.push(u)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const u of this._interactivityGraph.nodes){if("number"!==typeof u.declaration)throw L.d.Error(["No declaration found for node",u]),new Error("Error parsing nodes");const F=this._mappings[u.declaration];if(!F)throw L.d.Error(["No mapping found for node",u]),new Error("Error parsing nodes");if(F.flowGraphMapping.validation){const Z=F.flowGraphMapping.validation(u,this._interactivityGraph,this._gltf);var B;if(!Z.valid)throw new Error(`Error validating interactivity node ${null===(B=this._interactivityGraph.declarations)||void 0===B?void 0:B[u.declaration].op} - ${Z.error}`)}const Z=[];for(const B of F.flowGraphMapping.HY){const V=this._getEmptyBlock(B,F.fullOperationName);this._parseNodeConfiguration(u,V,F.flowGraphMapping,B),Z.push(V)}this._nodes.push({HY:Z,fullOperationName:F.fullOperationName})}}_getEmptyBlock(B,u){return{uniqueId:(0,oF.d)(),className:B,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:u,metadata:{}}}_parseNodeConfiguration(B,u,F,Z){const V=u.config;if(B.configuration){const u=Object.keys(B.configuration);for(const R of u){var p,G;const u=null===(p=B.configuration)||void 0===p?void 0:p[R];if(!u)throw L.d.Error(["No value found for node configuration",R]),new Error("Error parsing node configuration");const e=null===(G=F.configuration)||void 0===G?void 0:G[R];if(e&&e.xF?e.xF===Z:0===F.HY.indexOf(Z)){const B=(null===e||void 0===e?void 0:e.name)||R;u&&"undefined"!==typeof u.value||"undefined"===typeof(null===e||void 0===e?void 0:e.defaultValue)?u.value.length>=0?V[B]={value:1===u.value.length?u.value[0]:u.value}:L.d.Warn(["Invalid value for node configuration",u]):V[B]={value:e.defaultValue},e&&e.dataTransformer&&(V[B].value=e.dataTransformer([V[B].value],this)[0])}}}}_parseNodeConnections(B){for(let U=0;U<this._nodes.length;U++){var u;const y=null===(u=this._interactivityGraph.nodes)||void 0===u?void 0:u[U];if(!y)throw L.d.Error(["No node found for interactivity node",this._nodes[U]]),new Error("Error parsing node connections");const O=this._nodes[U],g=this._mappings[y.declaration];if(!g)throw L.d.Error(["No mapping found for node",y]),new Error("Error parsing node connections");const J=y.flows||{},a=Object.keys(J).sort();for(const B of a){var F,Z,V,p;const u=J[B],s=null===(F=g.flowGraphMapping.outputs)||void 0===F||null===(Z=F.flows)||void 0===Z?void 0:Z[B],Y=(null===s||void 0===s?void 0:s.name)||B,Q=this._createNewSocketConnection(Y,!0);(s&&s.xF&&O.HY.find((B=>B.className===s.xF))||O.HY[0]).signalOutputs.push(Q);const t=u.node,v=this._nodes[t];if(!v)throw L.d.Error(["No node found for input node id",t]),new Error("Error parsing node connections");const D=gF(v.fullOperationName);if(!D)throw L.d.Error(["No mapping found for input node",v]),new Error("Error parsing node connections");let q=null===(V=D.inputs)||void 0===V||null===(p=V.flows)||void 0===p?void 0:p[u.socket||"in"],W=!1;if(!q)for(const B in null===(G=D.inputs)||void 0===G?void 0:G.flows){var G,R,e;if(B.startsWith("[")&&B.endsWith("]"))W=!0,q=null===(R=D.inputs)||void 0===R||null===(e=R.flows)||void 0===e?void 0:e[B]}const X=q?W?q.name.replace("$1",u.socket||""):q.name:u.socket||"in",f=q&&q.xF&&v.HY.find((B=>B.className===q.xF))||v.HY[0];let C=f.signalInputs.find((B=>B.name===X));C||(C=this._createNewSocketConnection(X),f.signalInputs.push(C)),C.connectedPointIds.push(Q.uniqueId),Q.connectedPointIds.push(C.uniqueId)}const T=y.values||{},z=Object.keys(T);for(const u of z){var s,Y;const F=T[u];let Z=null===(s=g.flowGraphMapping.inputs)||void 0===s||null===(Y=s.values)||void 0===Y?void 0:Y[u],V=!1;if(!Z)for(const B in null===(Q=g.flowGraphMapping.inputs)||void 0===Q?void 0:Q.values){var Q,t,v;if(B.startsWith("[")&&B.endsWith("]"))V=!0,Z=null===(t=g.flowGraphMapping.inputs)||void 0===t||null===(v=t.values)||void 0===v?void 0:v[B]}const p=Z?V?Z.name.replace("$1",u):Z.name:u,G=this._createNewSocketConnection(p);if((Z&&Z.xF&&O.HY.find((B=>B.className===Z.xF))||O.HY[0]).dataInputs.push(G),void 0!==F.value){const u=this._parseVariable(F,Z&&Z.dataTransformer);B._connectionValues[G.uniqueId]=u}else{if("undefined"===typeof F.node)throw L.d.Error(["Invalid value for value connection",F]),new Error("Error parsing node connections");{var D,q,W;const B=F.node,u=F.socket||"value",Z=this._nodes[B];if(!Z)throw L.d.Error(["No node found for output socket reference",F]),new Error("Error parsing node connections");const V=gF(Z.fullOperationName);if(!V)throw L.d.Error(["No mapping found for output socket reference",F]),new Error("Error parsing node connections");let p=null===(D=V.outputs)||void 0===D||null===(q=D.values)||void 0===q?void 0:q[u],R=!1;if(!p)for(const F in null===(X=V.outputs)||void 0===X?void 0:X.values){var X,f,C;if(F.startsWith("[")&&F.endsWith("]"))R=!0,p=null===(f=V.outputs)||void 0===f||null===(C=f.values)||void 0===C?void 0:C[F]}const e=p?R?p.name.replace("$1",u):null===(W=p)||void 0===W?void 0:W.name:u,s=p&&p.xF&&Z.HY.find((B=>B.className===p.xF))||Z.HY[0];let Y=s.dataOutputs.find((B=>B.name===e));Y||(Y=this._createNewSocketConnection(e,!0),s.dataOutputs.push(Y)),G.connectedPointIds.push(Y.uniqueId),Y.connectedPointIds.push(G.uniqueId)}}}if(g.flowGraphMapping.interBlockConnectors)for(const B of g.flowGraphMapping.interBlockConnectors){const u=B.input,F=B.output,Z=B.isVariable;this._connectFlowGraphNodes(u,F,O.HY[B.inputBlockIndex],O.HY[B.outputBlockIndex],Z)}if(g.flowGraphMapping.extraProcessor){var x;const u=null===(x=this._interactivityGraph.declarations)||void 0===x?void 0:x[y.declaration];if(!u)throw L.d.Error(["No declaration found for extra processor",y]),new Error("Error parsing node connections");O.HY=g.flowGraphMapping.extraProcessor(y,u,g.flowGraphMapping,this,O.HY,B,this._gltf)}}}_createNewSocketConnection(B,u){return{uniqueId:(0,oF.d)(),name:B,_connectionType:u?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(B,u,F,Z,V){const p=V?F.dataInputs:F.signalInputs,G=V?Z.dataOutputs:Z.signalOutputs,R=p.find((u=>u.name===B))||this._createNewSocketConnection(B),e=G.find((B=>B.name===u))||this._createNewSocketConnection(u,!0);p.find((u=>u.name===B))||p.push(R),G.find((B=>B.name===u))||G.push(e),R.connectedPointIds.push(e.uniqueId),e.connectedPointIds.push(R.uniqueId)}getVariableName(B){return"staticVariable_"+B}serializeToFlowGraph(){const B={uniqueId:(0,oF.d)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(B);for(let u=0;u<this._staticVariables.length;u++){const F=this._staticVariables[u];B._userVariables[this.getVariableName(u)]=F}return{rightHanded:!0,allBlocks:this._nodes.reduce(((B,u)=>B.concat(u.HY)),[]),executionContexts:[B]}}}const EF="KHR_interactivity";class wF{constructor(B){this._loader=B,this.name=EF,this.enabled=this._loader.isExtensionUsed(EF),this._pathConverter=(0,H.h)(this._loader.YR),B._skipStartAnimationStep=!0;const u=B.babylonScene;u&&function(B){(0,H.b)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!B.activeCamera)return new V.Quaternion(NaN,NaN,NaN,NaN);const u=V.Quaternion.FromRotationMatrix(B.activeCamera.getWorldMatrix()).normalize();return B.useRightHandedSystem||(u.w*=-1,u.x*=-1),u},type:"Quaternion",getTarget:()=>B.activeCamera}),(0,H.b)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!B.activeCamera)return new V.Du(NaN,NaN,NaN);const u=B.activeCamera.getWorldMatrix().getTranslation();return B.useRightHandedSystem||(u.x*=-1),u},type:"Du",getTarget:()=>B.activeCamera}),(0,H.b)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:B=>{var u;return(null===(u=B._babylonAnimationGroup)||void 0===u?void 0:u.isPlaying)??!1},type:"boolean",getTarget:B=>B._babylonAnimationGroup}),(0,H.b)("/animations/{}/extensions/KHR_interactivity/minTime",{get:B=>{var u;return((null===(u=B._babylonAnimationGroup)||void 0===u?void 0:u.from)??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,H.b)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:B=>{var u;return((null===(u=B._babylonAnimationGroup)||void 0===u?void 0:u.to)??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,H.b)("/animations/{}/extensions/KHR_interactivity/playhead",{get:B=>{var u;return((null===(u=B._babylonAnimationGroup)||void 0===u?void 0:u.getCurrentFrame())??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup}),(0,H.b)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:B=>{var u;return((null===(u=B._babylonAnimationGroup)||void 0===u?void 0:u.getCurrentFrame())??0)/60},type:"number",getTarget:B=>B._babylonAnimationGroup})}(u)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var B;if(!this._loader.babylonScene||!this._pathConverter)return;const u=this._loader.babylonScene,F=null===(B=this._loader.YR.extensions)||void 0===B?void 0:B.KHR_interactivity;if(!F)return;const Z=new DF.e({qu:u});Z.dispatchEventsSynchronously=!1;const V=F.graphs.map((B=>new mZ(B,this._loader.YR,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(V.map((async B=>await UF(B,{coordinator:Z,pathConverter:this._pathConverter})))),Z.start()}}var HF;HF=async()=>(await Promise.resolve().then(F.bind(F,14743))).FlowGraphGLTFDataProvider,LF[`${EF}/${"FlowGraphGLTFDataProvider"}`]=HF,w(EF),E(EF,!0,(B=>new wF(B)));const nF="KHR_node_visibility";(0,H.b)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:B=>{const u=B._babylonTransformNode;return!u||void 0===u.isVisible||u.isVisible},set:(B,u)=>{var F,Z;null===(F=u._primitiveBabylonMeshes)||void 0===F||F.forEach((B=>{B.inheritVisibility=!0})),u._babylonTransformNode&&(u._babylonTransformNode.isVisible=B),null===(Z=u._primitiveBabylonMeshes)||void 0===Z||Z.forEach((u=>{u.isVisible=B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class dF{constructor(B){this.name=nF,this._loader=B,this.enabled=B.isExtensionUsed(nF)}async onReady(){var B;null===(B=this._loader.YR.nodes)||void 0===B||B.forEach((B=>{var u,F,Z,V;(null===(u=B._primitiveBabylonMeshes)||void 0===u||u.forEach((B=>{B.inheritVisibility=!0})),null!==(F=B.extensions)&&void 0!==F&&F.KHR_node_visibility)&&(!1===(null===(Z=B.extensions)||void 0===Z?void 0:Z.KHR_node_visibility.visible)&&(B._babylonTransformNode&&(B._babylonTransformNode.isVisible=!1),null===(V=B._primitiveBabylonMeshes)||void 0===V||V.forEach((B=>{B.isVisible=!1}))))}))}dispose(){this._loader=null}}w(nF),E(nF,!0,(B=>new dF(B)));const lF="KHR_node_selectability";aF("event/onSelect",lF,{HY:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xF:"FlowGraphGetVariableBlock",dataTransformer:B=>["pickedMesh_"+B[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",xF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,u,F,Z,V,p,G){var R,e,s,Y,Q,t;const v=V[V.length-1];v.config=v.config||{},v.config.glTF=G;const D=null===(R=B.configuration)||void 0===R||null===(e=R.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const L="pickedMesh_"+D;return V[1].config.variable=L,p._userVariables[L]={className:"Mesh",id:null===G||void 0===G||null===(s=G.nodes)||void 0===s||null===(Y=s[D]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===G||void 0===G||null===(Q=G.nodes)||void 0===Q||null===(t=Q[D]._babylonTransformNode)||void 0===t?void 0:t.uniqueId},V}}),(0,H.b)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:B=>{const u=B._babylonTransformNode;return!u||void 0===u.Rs||u.Rs},set:(B,u)=>{var F;null===(F=u._primitiveBabylonMeshes)||void 0===F||F.forEach((u=>{u.Rs=B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"Rs"],type:"boolean"});class PF{constructor(B){this.name=lF,this._loader=B,this.enabled=B.isExtensionUsed(lF)}async onReady(){var B;null===(B=this._loader.YR.nodes)||void 0===B||B.forEach((B=>{var u,F,Z;null!==(u=B.extensions)&&void 0!==u&&u.KHR_node_selectability&&!1===(null===(F=B.extensions)||void 0===F?void 0:F.KHR_node_selectability.selectable)&&(null===(Z=B._babylonTransformNode)||void 0===Z||Z.getChildMeshes().forEach((B=>{B.Rs=!1})))}))}dispose(){this._loader=null}}w(lF),E(lF,!0,(B=>new PF(B)));const cF="KHR_node_hoverability",hF="targetMeshPointerOver_";aF("event/onHoverIn",cF,{HY:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xF:"FlowGraphGetVariableBlock",dataTransformer:B=>[hF+B[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,u,F,Z,V,p,G){var R,e,s,Y,Q,t;const v=V[V.length-1];v.config=v.config||{},v.config.glTF=G;const D=null===(R=B.configuration)||void 0===R||null===(e=R.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const L=hF+D;return V[1].config.variable=L,p._userVariables[L]={className:"Mesh",id:null===G||void 0===G||null===(s=G.nodes)||void 0===s||null===(Y=s[D]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===G||void 0===G||null===(Q=G.nodes)||void 0===Q||null===(t=Q[D]._babylonTransformNode)||void 0===t?void 0:t.uniqueId},V}});const iF="targetMeshPointerOut_";aF("event/onHoverOut",cF,{HY:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",xF:"FlowGraphGetVariableBlock",dataTransformer:B=>[iF+B[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",xF:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(B,u,F,Z,V,p,G){var R,e,s,Y,Q,t;const v=V[V.length-1];v.config=v.config||{},v.config.glTF=G;const D=null===(R=B.configuration)||void 0===R||null===(e=R.nodeIndex)||void 0===e?void 0:e.value[0];if(void 0===D||"number"!==typeof D)throw new Error("nodeIndex not found in configuration");const L=iF+D;return V[1].config.variable=L,p._userVariables[L]={className:"Mesh",id:null===G||void 0===G||null===(s=G.nodes)||void 0===s||null===(Y=s[D]._babylonTransformNode)||void 0===Y?void 0:Y.id,uniqueId:null===G||void 0===G||null===(Q=G.nodes)||void 0===Q||null===(t=Q[D]._babylonTransformNode)||void 0===t?void 0:t.uniqueId},V}}),(0,H.b)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:B=>{const u=B._babylonTransformNode;return!u||void 0===u.pointerOverDisableMeshTesting||u.pointerOverDisableMeshTesting},set:(B,u)=>{var F;null===(F=u._primitiveBabylonMeshes)||void 0===F||F.forEach((u=>{u.pointerOverDisableMeshTesting=!B}))},getTarget:B=>B._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class rF{constructor(B){this.name=cF,this._loader=B,this.enabled=B.isExtensionUsed(cF)}async onReady(){var B;null===(B=this._loader.YR.nodes)||void 0===B||B.forEach((B=>{var u,F,Z;null!==(u=B.extensions)&&void 0!==u&&u.KHR_node_hoverability&&!1===(null===(F=B.extensions)||void 0===F?void 0:F.KHR_node_hoverability.hoverable)&&(null===(Z=B._babylonTransformNode)||void 0===Z||Z.getChildMeshes().forEach((B=>{B.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}w(cF),E(cF,!0,(B=>new rF(B)));const KF="ExtrasAsMetadata";class NF{_assignExtras(B,u){if(u.extras&&Object.keys(u.extras).length>0){const F=B.metadata=B.metadata||{};(F.YR=F.YR||{}).extras=u.extras}}constructor(B){this.name=KF,this.enabled=!0,this._loader=B}dispose(){this._loader=null}loadNodeAsync(B,u,F){return this._loader.loadNodeAsync(B,u,(B=>{this._assignExtras(B,u),F(B)}))}loadCameraAsync(B,u,F){return this._loader.loadCameraAsync(B,u,(B=>{this._assignExtras(B,u),F(B)}))}createMaterial(B,u,F){const Z=this._loader.createMaterial(B,u,F);return this._assignExtras(Z,u),Z}}w(KF),E(KF,!1,(B=>new NF(B)));F(14743)},14633:(B,u,F)=>{"use strict";F.d(u,{b:()=>j,e:()=>g,g:()=>O,j:()=>J});var Z=F(12807),V=F(12802),p=F(14235),G=F(13409),R=F(13389),e=F(13396),s=F(12822),Y=F(12855),Q=F(13406),t=F(13508),v=F(13414),D=F(13016);class L{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.xt=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Zv=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(B){this._environmentTexture=B}getNodes(){let B=[];B=B.concat(this.meshes),B=B.concat(this.lights),B=B.concat(this.cameras),B=B.concat(this.transformNodes);for(const u of this.skeletons)B=B.concat(u.bones);return B}}class q extends L{}class W{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const B=this.rootNodes;for(const Z of B)Z.dispose();B.length=0;const u=this.skeletons;for(const Z of u)Z.dispose();u.length=0;const F=this.animationGroups;for(const Z of F)Z.dispose();F.length=0}}class X extends L{constructor(B){super(),this._wasAddedToScene=!1,(B=B||Y.b.LastCreatedScene)&&(this.qu=B,this.proceduralTextures=[],B.GR.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=B.getEngine().onContextRestoredObservable.add((()=>{for(const B of this.geometries)B._rebuild();for(const B of this.meshes)B._rebuild();for(const B of this.xt)B.rebuild();for(const B of this.textures)B._rebuild()})))}_topologicalSort(B){const u=new Map;for(const G of B)u.set(G.uniqueId,G);const F={dependsOn:new Map,dependedBy:new Map};for(const G of B){const B=G.uniqueId;F.dependsOn.set(B,new Set),F.dependedBy.set(B,new Set)}for(const G of B){const B=G.uniqueId,Z=F.dependsOn.get(B);if(G instanceof Q.d){const V=G.sourceMesh;u.has(V.uniqueId)&&(Z.add(V.uniqueId),F.dependedBy.get(V.uniqueId).add(B))}const V=F.dependedBy.get(B);for(const p of G.getDescendants()){const Z=p.uniqueId;if(u.has(Z)){V.add(Z);F.dependsOn.get(Z).add(B)}}}const Z=[],V=[];for(const G of B){const B=G.uniqueId;0===F.dependsOn.get(B).size&&(V.push(G),u.delete(B))}const p=V;for(;p.length>0;){const B=p.shift();Z.push(B);const V=F.dependedBy.get(B.uniqueId);for(const Z of Array.from(V.values())){const V=F.dependsOn.get(Z);V.delete(B.uniqueId),0===V.size&&u.get(Z)&&(p.push(u.get(Z)),u.delete(Z))}}return u.size>0&&(s.d.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),u.forEach((B=>{s.d.Error(B.name)}))),Z}_addNodeAndDescendantsToList(B,u,F,Z){if(F&&(!Z||Z(F))&&!u.has(F.uniqueId)){B.push(F),u.add(F.uniqueId);for(const V of F.getDescendants(!0))this._addNodeAndDescendantsToList(B,u,V,Z)}}_isNodeInContainer(B){return B instanceof e.e&&-1!==this.meshes.indexOf(B)||(B instanceof R.b&&-1!==this.transformNodes.indexOf(B)||(B instanceof t.c&&-1!==this.lights.indexOf(B)||B instanceof v.d&&-1!==this.cameras.indexOf(B)))}_isValidHierarchy(){for(const B of this.meshes)if(B.parent&&!this._isNodeInContainer(B.parent))return s.d.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.transformNodes)if(B.parent&&!this._isNodeInContainer(B.parent))return s.d.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.lights)if(B.parent&&!this._isNodeInContainer(B.parent))return s.d.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;for(const B of this.cameras)if(B.parent&&!this._isNodeInContainer(B.parent))return s.d.Warn(`Node ${B.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||V.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const Z={},p={},R=new W,e=[],s=[],Y={doNotInstantiate:!0,...F},Q=[],t=new Set;for(const V of this.transformNodes)null===V.parent&&this._addNodeAndDescendantsToList(Q,t,V,Y.predicate);for(const V of this.meshes)null===V.parent&&this._addNodeAndDescendantsToList(Q,t,V,Y.predicate);const v=this._topologicalSort(Q),D=(F,V)=>{if(((u,F)=>{if(Z[u.uniqueId]=F.uniqueId,p[F.uniqueId]=F,B&&(F.name=B(u.name)),F instanceof G.b){const B=F;if(B.morphTargetManager){const F=u.morphTargetManager;B.morphTargetManager=F.clone();for(let u=0;u<F.numTargets;u++){const V=F.getTarget(u),G=B.morphTargetManager.getTarget(u);Z[V.uniqueId]=G.uniqueId,p[G.uniqueId]=G}}}})(F,V),F.parent){const B=Z[F.parent.uniqueId],u=p[B];V.parent=u||F.parent}if(V.position&&F.position&&V.position.Z(F.position),V.rotationQuaternion&&F.rotationQuaternion&&V.rotationQuaternion.Z(F.rotationQuaternion),V.rotation&&F.rotation&&V.rotation.Z(F.rotation),V.yR&&F.yR&&V.yR.Z(F.yR),V.material){const G=V;if(G.material)if(u){const u=F.material;if(-1===s.indexOf(u)){let F=u.clone(B?B(u.name):"Clone of "+u.name);if(s.push(u),Z[u.uniqueId]=F.uniqueId,p[F.uniqueId]=F,"MultiMaterial"===u.getClassName()){const V=u;for(const u of V.JR)u&&(F=u.clone(B?B(u.name):"Clone of "+u.name),s.push(u),Z[u.uniqueId]=F.uniqueId,p[F.uniqueId]=F);V.JR=V.JR.map((B=>B&&p[Z[B.uniqueId]]))}}"InstancedMesh"!==G.getClassName()&&(G.material=p[Z[u.uniqueId]])}else"MultiMaterial"===G.material.getClassName()?-1===this.qu.multiMaterials.indexOf(G.material)&&this.qu.addMultiMaterial(G.material):-1===this.qu.materials.indexOf(G.material)&&this.qu.addMaterial(G.material)}null===V.parent&&R.rootNodes.push(V)};for(const V of v)if("InstancedMesh"===V.getClassName()){const B=V,u=B.sourceMesh,F=Z[u.uniqueId];D(B,("number"===typeof F?p[F]:u).createInstance(B.name))}else{let B=!0;"pe"===V.getClassName()||"Node"===V.getClassName()||V.skeleton||!V.getTotalVertices||0===V.getTotalVertices()?B=!1:Y.doNotInstantiate&&(B="function"===typeof Y.doNotInstantiate?!Y.doNotInstantiate(V):!Y.doNotInstantiate);const u=B?V.createInstance(`instance of ${V.name}`):V.clone(`Clone of ${V.name}`,null,!0);if(!u)throw new Error(`Could not clone or instantiate node on Asset Container ${V.name}`);D(V,u)}for(const V of this.skeletons){if(Y.predicate&&!Y.predicate(V))continue;const u=V.clone(B?B(V.name):"Clone of "+V.name);for(const B of this.meshes)if(B.skeleton===V&&!B.isAnInstance){const F=p[Z[B.uniqueId]];if(!F||F.isAnInstance)continue;if(F.skeleton=u,-1!==e.indexOf(u))continue;e.push(u);for(const B of u.bones)B._linkedTransformNode&&(B._linkedTransformNode=p[Z[B._linkedTransformNode.uniqueId]])}R.skeletons.push(u)}for(const V of this.animationGroups){if(Y.predicate&&!Y.predicate(V))continue;const u=V.clone(B?B(V.name):"Clone of "+V.name,(B=>p[Z[B.uniqueId]]||B));R.animationGroups.push(u)}return R}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||V.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.qu.environmentTexture=this.environmentTexture);for(const B of this.qu._serializableComponents)B.addFromContainer(this);this.qu.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const u=[];for(const F of this.cameras)B&&!B(F)||(this.qu.addCamera(F),u.push(F));for(const F of this.lights)B&&!B(F)||(this.qu.addLight(F),u.push(F));for(const F of this.meshes)B&&!B(F)||(this.qu.gY(F),u.push(F));for(const F of this.skeletons)B&&!B(F)||this.qu.addSkeleton(F);for(const F of this.animations)B&&!B(F)||this.qu.addAnimation(F);for(const F of this.animationGroups)B&&!B(F)||this.qu.addAnimationGroup(F);for(const F of this.multiMaterials)B&&!B(F)||this.qu.addMultiMaterial(F);for(const F of this.materials)B&&!B(F)||this.qu.addMaterial(F);for(const F of this.morphTargetManagers)B&&!B(F)||this.qu.addMorphTargetManager(F);for(const F of this.geometries)B&&!B(F)||this.qu.addGeometry(F);for(const F of this.transformNodes)B&&!B(F)||(this.qu.addTransformNode(F),u.push(F));for(const F of this.actionManagers)B&&!B(F)||this.qu.addActionManager(F);for(const F of this.textures)B&&!B(F)||this.qu.addTexture(F);for(const F of this.reflectionProbes)B&&!B(F)||this.qu.addReflectionProbe(F);for(const F of u)F.parent&&-1===this.qu.getNodes().indexOf(F.parent)&&(F.setParent?F.setParent(null):F.parent=null)}removeAllFromScene(){this._isValidHierarchy()||V.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.qu.environmentTexture&&(this.qu.environmentTexture=null);for(const B of this.qu._serializableComponents)B.removeFromContainer(this)}removeFromScene(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const u of this.cameras)B&&!B(u)||this.qu.removeCamera(u);for(const u of this.lights)B&&!B(u)||this.qu.removeLight(u);for(const u of this.meshes)B&&!B(u)||this.qu.OY(u,!0);for(const u of this.skeletons)B&&!B(u)||this.qu.removeSkeleton(u);for(const u of this.animations)B&&!B(u)||this.qu.removeAnimation(u);for(const u of this.animationGroups)B&&!B(u)||this.qu.removeAnimationGroup(u);for(const u of this.multiMaterials)B&&!B(u)||this.qu.removeMultiMaterial(u);for(const u of this.materials)B&&!B(u)||this.qu.removeMaterial(u);for(const u of this.morphTargetManagers)B&&!B(u)||this.qu.removeMorphTargetManager(u);for(const u of this.geometries)B&&!B(u)||this.qu.removeGeometry(u);for(const u of this.transformNodes)B&&!B(u)||this.qu.removeTransformNode(u);for(const u of this.actionManagers)B&&!B(u)||this.qu.removeActionManager(u);for(const u of this.textures)B&&!B(u)||this.qu.removeTexture(u);for(const u of this.reflectionProbes)B&&!B(u)||this.qu.removeReflectionProbe(u)}dispose(){const B=this.cameras.slice(0);for(const v of B)v.dispose();this.cameras.length=0;const u=this.lights.slice(0);for(const v of u)v.dispose();this.lights.length=0;const F=this.meshes.slice(0);for(const v of F)v.dispose();this.meshes.length=0;const Z=this.skeletons.slice(0);for(const v of Z)v.dispose();this.skeletons.length=0;const V=this.animationGroups.slice(0);for(const v of V)v.dispose();this.animationGroups.length=0;const p=this.multiMaterials.slice(0);for(const v of p)v.dispose();this.multiMaterials.length=0;const G=this.materials.slice(0);for(const v of G)v.dispose();this.materials.length=0;const R=this.geometries.slice(0);for(const v of R)v.dispose();this.geometries.length=0;const e=this.transformNodes.slice(0);for(const v of e)v.dispose();this.transformNodes.length=0;const s=this.actionManagers.slice(0);for(const v of s)v.dispose();this.actionManagers.length=0;const Y=this.textures.slice(0);for(const v of Y)v.dispose();this.textures.length=0;const Q=this.reflectionProbes.slice(0);for(const v of Q)v.dispose();this.reflectionProbes.length=0;const t=this.morphTargetManagers.slice(0);for(const v of t)v.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const v of this.qu._serializableComponents)v.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.qu.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(B,u,F){if(B&&u)for(const Z of B){let B=!0;if(F)for(const u of F)if(Z===u){B=!1;break}B&&(u.push(Z),Z._parentContainer=this)}}moveAllFromScene(B){this._wasAddedToScene=!1,void 0===B&&(B=new q);for(const u in this)Object.prototype.hasOwnProperty.call(this,u)&&(this[u]=this[u]||("_environmentTexture"===u?null:[]),this._moveAssets(this.qu[u],this[u],B[u]));this.environmentTexture=this.qu.environmentTexture,this.removeAllFromScene()}createRootMesh(){const B=new G.b("assetContainerRootMesh",this.qu);for(const u of this.meshes)u.parent||B.addChild(u);return this.meshes.unshift(B),B}mergeAnimationsTo(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.b.LastCreatedScene,u=arguments.length>1?arguments[1]:void 0,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!B)return s.d.Error("No scene available to merge animations to"),[];const Z=F||(u=>{let F=null;const Z=u.animations.length?u.animations[0].targetProperty:"",V=u.name.split(".").join("").split("_primitive")[0];switch(Z){case"position":case"rotationQuaternion":F=B.getTransformNodeByName(u.name)||B.getTransformNodeByName(V);break;case"influence":F=B.getMorphTargetByName(u.name)||B.getMorphTargetByName(V);break;default:F=B.getNodeByName(u.name)||B.getNodeByName(V)}return F}),V=this.getNodes();for(const R of V){const B=Z(R);if(null!==B){for(const u of R.animations){const F=B.animations.filter((B=>B.targetProperty===u.targetProperty));for(const u of F){const F=B.animations.indexOf(u,0);F>-1&&B.animations.splice(F,1)}}B.animations=B.animations.concat(R.animations)}}const p=[],G=this.animationGroups.slice();for(const R of G){p.push(R.clone(R.name,Z));for(const B of R.animatables)B.stop()}for(const R of u){const u=Z(R.target);u&&(B.beginAnimation(u,R.fromFrame,R.toFrame,R.loopAnimation,R.speedRatio,R.onAnimationEnd?R.onAnimationEnd:void 0,void 0,!0,void 0,R.onAnimationLoop?R.onAnimationLoop:void 0),B.stopAnimation(R.target))}return p}populateRootNodes(){this.rootNodes.length=0;for(const B of this.meshes)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.transformNodes)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.lights)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B);for(const B of this.cameras)B.parent||-1!==this.rootNodes.indexOf(B)||this.rootNodes.push(B)}addAllAssetsToContainer(B){if(!B)return;const u=[],F=new Set;for(u.push(B);u.length>0;){const B=u.pop();if(B instanceof G.b?(B.fR&&-1===this.geometries.indexOf(B.fR)&&this.geometries.push(B.fR),this.meshes.push(B)):B instanceof Q.d?this.meshes.push(B):B instanceof R.b?this.transformNodes.push(B):B instanceof t.c?this.lights.push(B):B instanceof v.d&&this.cameras.push(B),B instanceof e.e){if(B.material&&-1===this.materials.indexOf(B.material)){this.materials.push(B.material);for(const u of B.material.getActiveTextures())-1===this.textures.indexOf(u)&&this.textures.push(u)}B.skeleton&&-1===this.skeletons.indexOf(B.skeleton)&&this.skeletons.push(B.skeleton),B.morphTargetManager&&-1===this.morphTargetManagers.indexOf(B.morphTargetManager)&&this.morphTargetManagers.push(B.morphTargetManager)}for(const Z of B.getChildren())F.has(Z)||u.push(Z);F.add(B)}this.populateRootNodes()}_getByTags(B,u,F){if(void 0===u)return B;const Z=[];for(const V in B){const p=B[V];D.c&&D.c.MatchesQuery(p,u)&&(!F||F(p))&&Z.push(p)}return Z}getMeshesByTags(B,u){return this._getByTags(this.meshes,B,u)}getCamerasByTags(B,u){return this._getByTags(this.cameras,B,u)}getLightsByTags(B,u){return this._getByTags(this.lights,B,u)}getMaterialsByTags(B,u){return this._getByTags(this.materials,B,u).concat(this._getByTags(this.multiMaterials,B,u))}getTransformNodesByTags(B,u){return this._getByTags(this.transformNodes,B,u)}}var f=F(12867);class C{constructor(B){this.byteOffset=0,this.buffer=B}async loadAsync(B){const u=await this.buffer.readAsync(this.byteOffset,B);this._dataView=new DataView(u.buffer,u.byteOffset,u.byteLength),this._dataByteOffset=0}readUint32(){const B=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,B}readUint8Array(B){const u=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,B);return this._dataByteOffset+=B,this.byteOffset+=B,u}readString(B){return(0,f.h)(this.readUint8Array(B))}skipBytes(B){this._dataByteOffset+=B,this.byteOffset+=B}}var x=F(14639);const U="Z2xURg",y={name:"YR",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:B=>-1!==B.indexOf("asset")&&-1!==B.indexOf("version")||B.startsWith("data:base64,"+U)||B.startsWith("data:;base64,"+U)||B.startsWith("data:application/octet-stream;base64,"+U)||B.startsWith("data:model/gltf-binary;base64,"+U)};var O,g,J,a=F(12861),T=F(12864);function z(B,u,F){try{return Promise.resolve(new Uint8Array(B,u,F))}catch(Z){return Promise.reject(Z)}}!function(B){B[B.AUTO=0]="AUTO",B[B.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(O||(O={})),function(B){B[B.NONE=0]="NONE",B[B.FIRST=1]="FIRST",B[B.ALL=2]="ALL"}(g||(g={})),function(B){B[B.LOADING=0]="LOADING",B[B.READY=1]="READY",B[B.COMPLETE=2]="COMPLETE"}(J||(J={}));class M{constructor(){this.coordinateSystemMode=O.AUTO,this.animationStartMode=g.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=B=>Promise.resolve(B),this.extensionOptions={}}Z(B){B&&(this.onParsed=B.onParsed,this.coordinateSystemMode=B.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=B.animationStartMode??this.animationStartMode,this.loadNodeAnimations=B.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=B.loadSkins??this.loadSkins,this.loadMorphTargets=B.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=B.compileMaterials??this.compileMaterials,this.useClipPlane=B.useClipPlane??this.useClipPlane,this.compileShadowGenerators=B.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=B.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=B.useRangeRequests??this.useRangeRequests,this.createInstances=B.createInstances??this.createInstances,this.alwaysComputeBoundingBox=B.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=B.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=B.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=B.skipMaterials??this.skipMaterials,this.useSRGBBuffers=B.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=B.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=B.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=B.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=B.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=B.customRootNode,this.onMeshLoaded=B.onMeshLoaded,this.onSkinLoaded=B.onSkinLoaded,this.onTextureLoaded=B.onTextureLoaded,this.onMaterialLoaded=B.onMaterialLoaded,this.onCameraLoaded=B.onCameraLoaded,this.extensionOptions=B.extensionOptions??this.extensionOptions)}}class j extends M{constructor(B){super(),this.onParsedObservable=new Z.b,this.onMeshLoadedObservable=new Z.b,this.onSkinLoadedObservable=new Z.b,this.onTextureLoadedObservable=new Z.b,this.onMaterialLoadedObservable=new Z.b,this.onCameraLoadedObservable=new Z.b,this.onCompleteObservable=new Z.b,this.onErrorObservable=new Z.b,this.GR=new Z.b,this.onExtensionLoadedObservable=new Z.b,this.validate=!1,this.onValidatedObservable=new Z.b,this._loader=null,this._state=null,this._requests=new Array,this.name=y.name,this.extensions=y.extensions,this.onLoaderStateChangedObservable=new Z.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.Z(B)}set onParsed(B){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),B&&(this._onParsedObserver=this.onParsedObservable.add(B))}set onMeshLoaded(B){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),B&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(B))}set onSkinLoaded(B){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),B&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((u=>B(u.node,u.skinnedNode))))}set onTextureLoaded(B){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),B&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(B))}set onMaterialLoaded(B){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),B&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(B))}set onCameraLoaded(B){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),B&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(B))}set onComplete(B){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(B)}set onError(B){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(B)}set onDispose(B){this._onDisposeObserver&&this.GR.remove(this._onDisposeObserver),this._onDisposeObserver=this.GR.add(B)}set onExtensionLoaded(B){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(B)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(B){this._loggingEnabled!==B&&(this._loggingEnabled=B,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(B){this._capturePerformanceCounters!==B&&(this._capturePerformanceCounters=B,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(B){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(B)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const B of this._requests)B.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=B=>Promise.resolve(B),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.GR.notifyObservers(void 0),this.GR.clear()}loadFile(B,u,F,p,G,R,e,Y){if(ArrayBuffer.isView(u))return this._loadBinary(B,u,F,p,e,Y),null;this._progressCallback=G;const Q=u.name||V.Tools.GetFilename(u);if(R){if(this.useRangeRequests){this.validate&&s.d.Warn("glTF validation is not supported when range requests are enabled");const F={abort:()=>{},onCompleteObservable:new Z.b},V={readAsync:(F,Z)=>new Promise(((V,p)=>{this._loadFile(B,u,(B=>{V(new Uint8Array(B))}),!0,(B=>{p(B)}),(B=>{B.setRequestHeader("Range",`bytes=${F}-${F+Z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new C(V)).then((B=>{F.onCompleteObservable.notifyObservers(F),p(B)}),e?B=>e(void 0,B):void 0),F}return this._loadFile(B,u,(u=>{this._validate(B,new Uint8Array(u,0,u.byteLength),F,Q),this._unpackBinaryAsync(new C({readAsync:(B,F)=>z(u,B,F),byteLength:u.byteLength})).then((B=>{p(B)}),e?B=>e(void 0,B):void 0)}),!0,e)}return this._loadFile(B,u,(u=>{try{this._validate(B,u,F,Q),p({json:this._parseJson(u)})}catch{e&&e()}}),!1,e)}_loadBinary(B,u,F,Z,V,p){this._validate(B,new Uint8Array(u.buffer,u.byteOffset,u.byteLength),F,p),this._unpackBinaryAsync(new C({readAsync:(B,F)=>function(B,u,F){try{if(u<0||u>=B.byteLength)throw new RangeError("Offset is out of range.");if(u+F>B.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(B.buffer,B.byteOffset+u,F))}catch(Z){return Promise.reject(Z)}}(u,B,F),byteLength:u.byteLength})).then((B=>{Z(B)}),V?B=>V(void 0,B):void 0)}importMeshAsync(B,u,F,Z,V,p){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(F),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(F),this._loader.importMeshAsync(B,u,null,F,Z,V,p))))}loadAsync(B,u,F,Z,V){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log(`Loading ${V||""}`),this._loader=this._getLoader(u),this._loader.loadAsync(B,u,F,Z,V))))}loadAssetContainerAsync(B,u,F,Z,V){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(u),this.onParsedObservable.clear(),this._log(`Loading ${V||""}`),this._loader=this._getLoader(u);const p=new X(B),G=[];this.onMaterialLoadedObservable.add((B=>{G.push(B)}));const R=[];this.onTextureLoadedObservable.add((B=>{R.push(B)}));const e=[];this.onCameraLoadedObservable.add((B=>{e.push(B)}));const s=[];return this.onMeshLoadedObservable.add((B=>{B.morphTargetManager&&s.push(B.morphTargetManager)})),this._loader.importMeshAsync(null,B,p,u,F,Z,V).then((B=>(Array.prototype.push.apply(p.geometries,B.geometries),Array.prototype.push.apply(p.meshes,B.meshes),Array.prototype.push.apply(p.xt,B.xt),Array.prototype.push.apply(p.skeletons,B.skeletons),Array.prototype.push.apply(p.animationGroups,B.animationGroups),Array.prototype.push.apply(p.materials,G),Array.prototype.push.apply(p.textures,R),Array.prototype.push.apply(p.lights,B.lights),Array.prototype.push.apply(p.transformNodes,B.transformNodes),Array.prototype.push.apply(p.cameras,e),Array.prototype.push.apply(p.morphTargetManagers,s),p)))}))}canDirectLoad(B){return y.canDirectLoad(B)}directLoad(B,u){if(u.startsWith("base64,"+U)||u.startsWith(";base64,"+U)||u.startsWith("application/octet-stream;base64,"+U)||u.startsWith("model/gltf-binary;base64,"+U)){const F=(0,a.c)(u);return this._validate(B,new Uint8Array(F,0,F.byteLength)),this._unpackBinaryAsync(new C({readAsync:(B,u)=>z(F,B,u),byteLength:F.byteLength}))}return this._validate(B,u),Promise.resolve({json:this._parseJson(u)})}createPlugin(B){return new j(B[y.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((B,u)=>{this.onCompleteObservable.addOnce((()=>{B()})),this.onErrorObservable.addOnce((B=>{u(B)}))}))}_setState(B){this._state!==B&&(this._state=B,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(J[this._state]))}_loadFile(B,u,F,Z,V,p){const G=B._loadFile(u,F,(B=>{this._onProgress(B,G)}),!0,Z,V,p);return G.onCompleteObservable.add((()=>{G._lengthComputable=!0,G._total=G._loaded})),this._requests.push(G),G}_onProgress(B,u){if(!this._progressCallback)return;u._lengthComputable=B.lengthComputable,u._loaded=B.loaded,u._total=B.total;let F=!0,Z=0,V=0;for(const p of this._requests){if(void 0===p._lengthComputable||void 0===p._loaded||void 0===p._total)return;F=F&&p._lengthComputable,Z+=p._loaded,V+=p._total}this._progressCallback({lengthComputable:F,loaded:Z,total:F?V:0})}_validate(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),x.c.ValidateAsync(u,F,Z,(u=>this.preprocessUrlAsync(F+u).then((u=>B._loadFileAsync(u,void 0,!0,!0).then((B=>new Uint8Array(B,0,B.byteLength))))))).then((B=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(B),this.onValidatedObservable.clear()}),(B=>{this._endPerformanceCounter("Validate JSON"),V.Tools.Warn(`Failed to validate: ${B.message}`),this.onValidatedObservable.clear()})))}_getLoader(B){const u=B.json.asset||{};this._log(`Asset version: ${u.version}`),u.minVersion&&this._log(`Asset minimum version: ${u.minVersion}`),u.generator&&this._log(`Asset generator: ${u.generator}`);const F=j._parseVersion(u.version);if(!F)throw new Error("Invalid version: "+u.version);if(void 0!==u.minVersion){const B=j._parseVersion(u.minVersion);if(!B)throw new Error("Invalid minimum version: "+u.minVersion);if(j._compareVersion(B,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+u.minVersion)}const Z={1:j._CreateGLTF1Loader,2:j._CreateGLTF2Loader}[F.major];if(!Z)throw new Error("Unsupported version: "+u.version);return Z(this)}_parseJson(B){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${B.length}`);const u=JSON.parse(B);return this._endPerformanceCounter("Parse JSON"),u}_unpackBinaryAsync(B){return this._startPerformanceCounter("Unpack Binary"),B.loadAsync(20).then((()=>{const u=B.readUint32();if(1179937895!==u)throw new T.j("Unexpected magic: "+u,T.i.GLTFLoaderUnexpectedMagicError);const F=B.readUint32();this.loggingEnabled&&this._log(`Binary version: ${F}`);const Z=B.readUint32();let V;switch(this.useRangeRequests||Z===B.buffer.byteLength||s.d.Warn(`Length in header does not match actual data length: ${Z} != ${B.buffer.byteLength}`),F){case 1:V=this._unpackBinaryV1Async(B,Z);break;case 2:V=this._unpackBinaryV2Async(B,Z);break;default:throw new Error("Unsupported version: "+F)}return this._endPerformanceCounter("Unpack Binary"),V}))}_unpackBinaryV1Async(B,u){const F=B.readUint32(),Z=B.readUint32();if(0!==Z)throw new Error(`Unexpected content format: ${Z}`);const V=u-B.byteOffset,p={json:this._parseJson(B.readString(F)),bin:null};if(0!==V){const u=B.byteOffset;p.bin={readAsync:(F,Z)=>B.buffer.readAsync(u+F,Z),byteLength:V}}return Promise.resolve(p)}_unpackBinaryV2Async(B,u){const F=1313821514,Z=5130562,V=B.readUint32();if(B.readUint32()!==F)throw new Error("First chunk format is not JSON");return B.byteOffset+V===u?B.loadAsync(V).then((()=>({json:this._parseJson(B.readString(V)),bin:null}))):B.loadAsync(V+8).then((()=>{const p={json:this._parseJson(B.readString(V)),bin:null},G=()=>{const V=B.readUint32();switch(B.readUint32()){case F:throw new Error("Unexpected JSON chunk");case Z:{const u=B.byteOffset;p.bin={readAsync:(F,Z)=>B.buffer.readAsync(u+F,Z),byteLength:V},B.skipBytes(V);break}default:B.skipBytes(V)}return B.byteOffset!==u?B.loadAsync(8).then(G):Promise.resolve(p)};return G()}))}static _parseVersion(B){if("1.0"===B||"1.0.1"===B)return{major:1,minor:0};const u=(B+"").match(/^(\d+)\.(\d+)/);return u?{major:parseInt(u[1]),minor:parseInt(u[2])}:null}static _compareVersion(B,u){return B.major>u.major?1:B.major<u.major?-1:B.minor>u.minor?1:B.minor<u.minor?-1:0}_logOpen(B){this._log(B),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(B){const u=j._logSpaces.substring(0,2*this._logIndentLevel);s.d.Log(`${u}${B}`)}_logDisabled(B){}_startPerformanceCounterEnabled(B){V.Tools.StartPerformanceCounter(B)}_startPerformanceCounterDisabled(B){}_endPerformanceCounterEnabled(B){V.Tools.EndPerformanceCounter(B)}_endPerformanceCounterDisabled(B){}}j.IncrementalLoading=!0,j.HomogeneousCoordinates=!1,j._logSpaces="                                ",(0,p.d)(new j)},14639:(B,u,F)=>{"use strict";F.d(u,{c:()=>G});var Z=F(12802);function V(B,u,F,Z){const V={externalResourceFunction:Z};return F&&(V.uri="file:"===u?F:u+F),ArrayBuffer.isView(B)?GLTFValidator.validateBytes(B,V):GLTFValidator.validateString(B,V)}function p(){const B=[];onmessage=u=>{const F=u.data;switch(F.id){case"init":importScripts(F.url);break;case"validate":V(F.data,F.rootUrl,F.fileName,(u=>new Promise(((F,Z)=>{const V=B.length;B.push({resolve:F,reject:Z}),postMessage({id:"getExternalResource",index:V,uri:u})})))).then((B=>{postMessage({id:"validate.resolve",value:B})}),(B=>{postMessage({id:"validate.reject",reason:B})}));break;case"getExternalResource.resolve":B[F.index].resolve(F.value);break;case"getExternalResource.reject":B[F.index].reject(F.reason)}}}class G{static ValidateAsync(B,u,F,G){return"function"===typeof Worker?new Promise(((R,e)=>{const s=`${V}(${p})()`,Y=URL.createObjectURL(new Blob([s],{type:"application/javascript"})),Q=new Worker(Y),t=B=>{Q.removeEventListener("error",t),Q.removeEventListener("message",v),e(B)},v=B=>{const u=B.data;switch(u.id){case"getExternalResource":G(u.uri).then((B=>{Q.postMessage({id:"getExternalResource.resolve",index:u.index,value:B},[B.buffer])}),(B=>{Q.postMessage({id:"getExternalResource.reject",index:u.index,reason:B})}));break;case"validate.resolve":Q.removeEventListener("error",t),Q.removeEventListener("message",v),R(u.value),Q.terminate();break;case"validate.reject":Q.removeEventListener("error",t),Q.removeEventListener("message",v),e(u.reason),Q.terminate()}};if(Q.addEventListener("error",t),Q.addEventListener("message",v),Q.postMessage({id:"init",url:Z.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(B)){const Z=B.slice();Q.postMessage({id:"validate",data:Z,rootUrl:u,fileName:F},[Z.buffer])}else Q.postMessage({id:"validate",data:B,rootUrl:u,fileName:F})})):(this._LoadScriptPromise||(this._LoadScriptPromise=Z.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>V(B,u,F,G))))}}G.Configuration={url:`${Z.Tools._DefaultCdnUrl}/gltf_validator.js`}},15186:(B,u,F)=>{"use strict";F.d(u,{e:()=>y});var Z=F(12971),V=F(12973),p=F(13014),G=F(12979),R=F(13364),e=F(13296),s=F(13047),Y=F(13221),Q=F(12949),t=F(12897);F(14365),F(14265),F(14282),F(14271),F(14287),F(14294),F(14299);const v="imageProcessingCompatibility",D="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";t.c.IncludesShadersStore[v]||(t.c.IncludesShadersStore[v]=D);const L="skyPixelShader",q="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";t.c.ShadersStore[L]||(t.c.ShadersStore[L]=q);F(14374),F(14305),F(14313),F(14323),F(14321);const W="skyVertexShader",X="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";t.c.ShadersStore[W]||(t.c.ShadersStore[W]=X);var f=F(13291),C=F(13352),x=F(13349);class U extends R.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class y extends e.e{constructor(B,u){super(B,u),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new G.Du(0,100,0),this.useSunPosition=!1,this.cameraOffset=G.Du.Zero(),this.up=G.Du.Up(),this.dithering=!1,this._cameraPosition=G.Du.Zero(),this._skyOrientation=new G.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(B,u){const F=u._drawWrapper;if(this.isFrozen&&F.effect&&F._wasPreviouslyReady)return!0;u.materialDefines||(u.materialDefines=new U);const Z=u.materialDefines,V=this.yB();if(this._isReadyForSubMesh(u))return!0;if((0,x.O)(B,V,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,Z),(0,x.F)(B,Z,!0,!1),Z.IMAGEPROCESSINGPOSTPROCESS!==V.imageProcessingConfiguration.applyByPostProcess&&Z.markAsMiscDirty(),Z.DITHER!==this.dithering&&Z.markAsMiscDirty(),Z.isDirty){Z.markAsProcessed(),V.resetCachedMaterial();const B=new f.c;Z.FOG&&B.addFallback(1,"FOG"),Z.IMAGEPROCESSINGPOSTPROCESS=V.imageProcessingConfiguration.applyByPostProcess,Z.DITHER=this.dithering;const F=[s.f.PositionKind];Z.VERTEXCOLOR&&F.push(s.f.ColorKind);const p="sky",G=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,C.c)(G);const R=Z.toString();u.setEffect(V.getEngine().createEffect(p,F,G,[],R,B,this.onCompiled,this.onError),Z,this._materialContext)}return!(!u.effect||!u.effect.isReady())&&(Z._renderId=V.getRenderId(),F._wasPreviouslyReady=!0,!0)}bindForSubMesh(B,u,F){const Z=this.yB(),V=F.materialDefines;if(!V)return;const p=F.effect;if(!p)return;this._activeEffect=p,this.bindOnlyWorldMatrix(B),this._activeEffect.setMatrix("viewProjection",Z.getTransformMatrix()),this._mustRebind(Z,p,F)&&((0,C.g)(p,this,Z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,x.h)(V,p,Z)),Z.fogEnabled&&u.applyFog&&Z.fogMode!==Y.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",Z.getViewMatrix()),(0,x.d)(Z,u,this._activeEffect);const R=Z.activeCamera;if(R){const B=R.getWorldMatrix();this._cameraPosition.x=B.m[12],this._cameraPosition.y=B.m[13],this._cameraPosition.z=B.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const B=Math.PI*(this.inclination-.5),u=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(u)*Math.cos(B),this.sunPosition.y=this.distance*Math.sin(-B),this.sunPosition.z=this.distance*Math.sin(u)*Math.cos(B),G.Quaternion.FromUnitVectorsToRef(G.Du.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(u,this._activeEffect,F)}getAnimatables(){return[]}dispose(B){super.dispose(B)}clone(B){return p.c.Clone((()=>new y(B,this.yB())),this)}serialize(){const B=super.serialize();return B.customType="BABYLON.SkyMaterial",B}getClassName(){return"SkyMaterial"}static Parse(B,u,F){return p.c.Parse((()=>new y(B.name,u)),B,u,F)}}(0,Z.d)([(0,V.L)()],y.prototype,"luminance",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"turbidity",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"rayleigh",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"mieCoefficient",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"mieDirectionalG",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"distance",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"inclination",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"azimuth",void 0),(0,Z.d)([(0,V.H)()],y.prototype,"sunPosition",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"useSunPosition",void 0),(0,Z.d)([(0,V.H)()],y.prototype,"cameraOffset",void 0),(0,Z.d)([(0,V.H)()],y.prototype,"up",void 0),(0,Z.d)([(0,V.L)()],y.prototype,"dithering",void 0),(0,Q.f)("BABYLON.SkyMaterial",y)},13655:(B,u,F)=>{"use strict";function Z(B,u){u.headers=B.headers||{},u.statusMessage=B.statusText,u.statusCode=B.status,u.data=B.response}function V(B,u,F){return new Promise((function(V,p){F=F||{};var G,R,e,s=new XMLHttpRequest,Y=F.body,Q=F.headers||{};for(G in F.timeout&&(s.timeout=F.timeout),s.ontimeout=s.onerror=function(B){B.timeout="timeout"==B.type,p(B)},s.open(B,u.href||u),s.onload=function(){for(e=s.getAllResponseHeaders().trim().split(/[\r\n]+/),Z(s,s);R=e.shift();)R=R.split(": "),s.headers[R.shift().toLowerCase()]=R.join(": ");if((R=s.headers["content-type"])&&~R.indexOf("application/json"))try{s.data=JSON.parse(s.data,F.reviver)}catch(B){return Z(s,B),p(B)}(s.status>=400?p:V)(s)},typeof FormData<"u"&&Y instanceof FormData||Y&&"object"==typeof Y&&(Q["content-type"]="application/json",Y=JSON.stringify(Y)),s.withCredentials=!!F.withCredentials,Q)s.setRequestHeader(G,Q[G]);s.send(Y)}))}F.r(u),F.d(u,{del:()=>e,get:()=>p,patch:()=>R,post:()=>G,put:()=>s,send:()=>V});var p=V.bind(V,"GET"),G=V.bind(V,"POST"),R=V.bind(V,"PATCH"),e=V.bind(V,"DELETE"),s=V.bind(V,"PUT")},15289:(B,u,F)=>{"use strict";F.d(u,{d:()=>Q});const Z=.5*(Math.sqrt(3)-1),V=(3-Math.sqrt(3))/6,p=1/3,G=1/6,R=(Math.sqrt(5)-1)/4,e=(5-Math.sqrt(5))/20,s=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),Y=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const Q=class{constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const u="function"==typeof B?B:function(B){let u=0,F=0,Z=0,V=1;const p=function(){let B=4022871197;return function(u){u=u.toString();for(let F=0;F<u.length;F++){B+=u.charCodeAt(F);let Z=.02519603282416938*B;B=Z>>>0,Z-=B,Z*=B,B=Z>>>0,Z-=B,B+=4294967296*Z}return 2.3283064365386963e-10*(B>>>0)}}();u=p(" "),F=p(" "),Z=p(" "),u-=p(B),u<0&&(u+=1);F-=p(B),F<0&&(F+=1);Z-=p(B),Z<0&&(Z+=1);return function(){const B=2091639*u+2.3283064365386963e-10*V;return u=F,F=Z,Z=B-(V=0|B)}}(B);this.p=function(B){const u=new Uint8Array(256);for(let F=0;F<256;F++)u[F]=F;for(let F=0;F<255;F++){const Z=F+~~(B()*(256-F)),V=u[F];u[F]=u[Z],u[Z]=V}return u}(u),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let F=0;F<512;F++)this.perm[F]=this.p[255&F],this.permMod12[F]=this.perm[F]%12}noise2D(B,u){const F=this.permMod12,p=this.perm;let G=0,R=0,e=0;const Y=(B+u)*Z,Q=Math.floor(B+Y),t=Math.floor(u+Y),v=(Q+t)*V,D=B-(Q-v),L=u-(t-v);let q,W;D>L?(q=1,W=0):(q=0,W=1);const X=D-q+V,f=L-W+V,C=D-1+2*V,x=L-1+2*V,U=255&Q,y=255&t;let O=.5-D*D-L*L;if(O>=0){const B=3*F[U+p[y]];O*=O,G=O*O*(s[B]*D+s[B+1]*L)}let g=.5-X*X-f*f;if(g>=0){const B=3*F[U+q+p[y+W]];g*=g,R=g*g*(s[B]*X+s[B+1]*f)}let J=.5-C*C-x*x;if(J>=0){const B=3*F[U+1+p[y+1]];J*=J,e=J*J*(s[B]*C+s[B+1]*x)}return 70*(G+R+e)}noise3D(B,u,F){const Z=this.permMod12,V=this.perm;let R,e,Y,Q;const t=(B+u+F)*p,v=Math.floor(B+t),D=Math.floor(u+t),L=Math.floor(F+t),q=(v+D+L)*G,W=B-(v-q),X=u-(D-q),f=F-(L-q);let C,x,U,y,O,g;W>=X?X>=f?(C=1,x=0,U=0,y=1,O=1,g=0):W>=f?(C=1,x=0,U=0,y=1,O=0,g=1):(C=0,x=0,U=1,y=1,O=0,g=1):X<f?(C=0,x=0,U=1,y=0,O=1,g=1):W<f?(C=0,x=1,U=0,y=0,O=1,g=1):(C=0,x=1,U=0,y=1,O=1,g=0);const J=W-C+G,a=X-x+G,T=f-U+G,z=W-y+2*G,M=X-O+2*G,j=f-g+2*G,o=W-1+.5,I=X-1+.5,mB=f-1+.5,E=255&v,w=255&D,H=255&L;let n=.6-W*W-X*X-f*f;if(n<0)R=0;else{const B=3*Z[E+V[w+V[H]]];n*=n,R=n*n*(s[B]*W+s[B+1]*X+s[B+2]*f)}let d=.6-J*J-a*a-T*T;if(d<0)e=0;else{const B=3*Z[E+C+V[w+x+V[H+U]]];d*=d,e=d*d*(s[B]*J+s[B+1]*a+s[B+2]*T)}let l=.6-z*z-M*M-j*j;if(l<0)Y=0;else{const B=3*Z[E+y+V[w+O+V[H+g]]];l*=l,Y=l*l*(s[B]*z+s[B+1]*M+s[B+2]*j)}let P=.6-o*o-I*I-mB*mB;if(P<0)Q=0;else{const B=3*Z[E+1+V[w+1+V[H+1]]];P*=P,Q=P*P*(s[B]*o+s[B+1]*I+s[B+2]*mB)}return 32*(R+e+Y+Q)}noise4D(B,u,F,Z){const V=this.perm;let p,G,s,Q,t;const v=(B+u+F+Z)*R,D=Math.floor(B+v),L=Math.floor(u+v),q=Math.floor(F+v),W=Math.floor(Z+v),X=(D+L+q+W)*e,f=B-(D-X),C=u-(L-X),x=F-(q-X),U=Z-(W-X);let y=0,O=0,g=0,J=0;f>C?y++:O++,f>x?y++:g++,f>U?y++:J++,C>x?O++:g++,C>U?O++:J++,x>U?g++:J++;const a=y>=3?1:0,T=O>=3?1:0,z=g>=3?1:0,M=J>=3?1:0,j=y>=2?1:0,o=O>=2?1:0,I=g>=2?1:0,mB=J>=2?1:0,E=y>=1?1:0,w=O>=1?1:0,H=g>=1?1:0,n=J>=1?1:0,d=f-a+e,l=C-T+e,P=x-z+e,c=U-M+e,h=f-j+2*e,i=C-o+2*e,r=x-I+2*e,K=U-mB+2*e,N=f-E+3*e,A=C-w+3*e,b=x-H+3*e,k=U-n+3*e,S=f-1+4*e,BB=C-1+4*e,uB=x-1+4*e,FB=U-1+4*e,ZB=255&D,VB=255&L,pB=255&q,GB=255&W;let RB=.6-f*f-C*C-x*x-U*U;if(RB<0)p=0;else{const B=V[ZB+V[VB+V[pB+V[GB]]]]%32*4;RB*=RB,p=RB*RB*(Y[B]*f+Y[B+1]*C+Y[B+2]*x+Y[B+3]*U)}let eB=.6-d*d-l*l-P*P-c*c;if(eB<0)G=0;else{const B=V[ZB+a+V[VB+T+V[pB+z+V[GB+M]]]]%32*4;eB*=eB,G=eB*eB*(Y[B]*d+Y[B+1]*l+Y[B+2]*P+Y[B+3]*c)}let sB=.6-h*h-i*i-r*r-K*K;if(sB<0)s=0;else{const B=V[ZB+j+V[VB+o+V[pB+I+V[GB+mB]]]]%32*4;sB*=sB,s=sB*sB*(Y[B]*h+Y[B+1]*i+Y[B+2]*r+Y[B+3]*K)}let YB=.6-N*N-A*A-b*b-k*k;if(YB<0)Q=0;else{const B=V[ZB+E+V[VB+w+V[pB+H+V[GB+n]]]]%32*4;YB*=YB,Q=YB*YB*(Y[B]*N+Y[B+1]*A+Y[B+2]*b+Y[B+3]*k)}let QB=.6-S*S-BB*BB-uB*uB-FB*FB;if(QB<0)t=0;else{const B=V[ZB+1+V[VB+1+V[pB+1+V[GB+1]]]]%32*4;QB*=QB,t=QB*QB*(Y[B]*S+Y[B+1]*BB+Y[B+2]*uB+Y[B+3]*FB)}return 27*(p+G+s+Q+t)}}}}]);