/*! For license information please see ekapur.32.7d853bfb.chunk.js.LICENSE.txt */
(self.g111kvdsqxc=self.g111kvdsqxc||[]).push([[32],{13287:(K,H,M)=>{"use strict";var q=M(13296),w=M(13304),u=M(13309);M.g.__TYPEDARRAY_POOL||(M.g.__TYPEDARRAY_POOL={UINT8:w([32,0]),UINT16:w([32,0]),UINT32:w([32,0]),INT8:w([32,0]),INT16:w([32,0]),INT32:w([32,0]),FLOAT:w([32,0]),DOUBLE:w([32,0]),DATA:w([32,0]),UINT8C:w([32,0]),BUFFER:w([32,0])});var y="undefined"!==typeof Uint8ClampedArray,h=M.g.__TYPEDARRAY_POOL;h.UINT8C||(h.UINT8C=w([32,0])),h.BUFFER||(h.BUFFER=w([32,0]));var W=h.DATA,I=h.BUFFER;function f(K){if(K){var H=K.length||K.byteLength,M=q.log2(H);W[M].push(K)}}function z(K){K=q.nextPow2(K);var H=q.log2(K),M=W[H];return M.length>0?M.pop():new ArrayBuffer(K)}function G(K){return new Uint8Array(z(K),0,K)}function a(K){return new Uint16Array(z(2*K),0,K)}function v(K){return new Uint32Array(z(4*K),0,K)}function O(K){return new Int8Array(z(K),0,K)}function L(K){return new Int16Array(z(2*K),0,K)}function S(K){return new Int32Array(z(4*K),0,K)}function B(K){return new Float32Array(z(4*K),0,K)}function C(K){return new Float64Array(z(8*K),0,K)}function i(K){return y?new Uint8ClampedArray(z(K),0,K):G(K)}function Z(K){return new DataView(z(K),0,K)}H.free=function(K){if(u(K))I[q.log2(K.length)].push(K);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(K)&&(K=K.buffer),!K)return;var H=K.length||K.byteLength,M=0|q.log2(H);W[M].push(K)}},H.freeUint8=H.freeUint16=H.freeUint32=H.freeInt8=H.freeInt16=H.freeInt32=H.freeFloat32=H.freeFloat=H.freeFloat64=H.freeDouble=H.freeUint8Clamped=H.freeDataView=function(K){f(K.buffer)},H.freeArrayBuffer=f,H.freeBuffer=function(K){I[q.log2(K.length)].push(K)},H.malloc=function(K,H){if(void 0===H||"arraybuffer"===H)return z(K);switch(H){case"uint8":return G(K);case"uint16":return a(K);case"uint32":return v(K);case"int8":return O(K);case"int16":return L(K);case"int32":return S(K);case"float":case"float32":return B(K);case"double":case"float64":return C(K);case"uint8_clamped":return i(K);case"buffer":throw"Buffer not supported";case"data":case"dataview":return Z(K);default:return null}return null},H.mallocArrayBuffer=z,H.mallocUint8=G,H.mallocUint16=a,H.mallocUint32=v,H.mallocInt8=O,H.mallocInt16=L,H.mallocInt32=S,H.mallocFloat32=H.mallocFloat=B,H.mallocFloat64=H.mallocDouble=C,H.mallocUint8Clamped=i,H.mallocDataView=Z,H.clearCache=function(){for(var K=0;K<32;++K)h.UINT8[K].length=0,h.UINT16[K].length=0,h.UINT32[K].length=0,h.INT8[K].length=0,h.INT16[K].length=0,h.INT32[K].length=0,h.FLOAT[K].length=0,h.DOUBLE[K].length=0,h.UINT8C[K].length=0,W[K].length=0,I[K].length=0}},13374:(K,H,M)=>{K.exports=w;var q=M(12114);function w(K,H){if(!(this instanceof w))return new w(K,H);var M=q.create();q.add(M,K,H),this.base=q.min(q.create(),K,M),this.Mf=q.clone(H),this.max=q.max(q.create(),K,M),this.mag=q.length(this.Mf)}var u=w.prototype;u.width=function(){return this.Mf[0]},u.height=function(){return this.Mf[1]},u.depth=function(){return this.Mf[2]},u.x0=function(){return this.base[0]},u.y0=function(){return this.base[1]},u.z0=function(){return this.base[2]},u.x1=function(){return this.max[0]},u.y1=function(){return this.max[1]},u.z1=function(){return this.max[2]},u.translate=function(K){return q.add(this.max,this.max,K),q.add(this.base,this.base,K),this},u.setPosition=function(K){return q.add(this.max,K,this.Mf),q.j(this.base,K),this},u.expand=function(K){var H=q.create(),M=q.create();return q.max(H,K.max,this.max),q.min(M,K.base,this.base),q.LH(H,H,M),new w(M,H)},u.intersects=function(K){return!(K.base[0]>this.max[0])&&(!(K.base[1]>this.max[1])&&(!(K.base[2]>this.max[2])&&(!(K.max[0]<this.base[0])&&(!(K.max[1]<this.base[1])&&!(K.max[2]<this.base[2])))))},u.touches=function(K){var H=this.union(K);return null!==H&&(0==H.width()||0==H.height()||0==H.depth())},u.union=function(K){if(!this.intersects(K))return null;var H=Math.max(K.base[0],this.base[0]),M=Math.max(K.base[1],this.base[1]),q=Math.max(K.base[2],this.base[2]);return new w([H,M,q],[Math.min(K.max[0],this.max[0])-H,Math.min(K.max[1],this.max[1])-M,Math.min(K.max[2],this.max[2])-q])}},13296:(K,H)=>{"use strict";function M(K){var H=32;return(K&=-K)&&H--,65535&K&&(H-=16),16711935&K&&(H-=8),252645135&K&&(H-=4),858993459&K&&(H-=2),1431655765&K&&(H-=1),H}H.INT_BITS=32,H.INT_MAX=2147483647,H.INT_MIN=-1<<31,H.sign=function(K){return(K>0)-(K<0)},H.abs=function(K){var H=K>>31;return(K^H)-H},H.min=function(K,H){return H^(K^H)&-(K<H)},H.max=function(K,H){return K^(K^H)&-(K<H)},H.isPow2=function(K){return!(K&K-1)&&!!K},H.log2=function(K){var H,M;return H=(K>65535)<<4,H|=M=((K>>>=H)>255)<<3,H|=M=((K>>>=M)>15)<<2,(H|=M=((K>>>=M)>3)<<1)|(K>>>=M)>>1},H.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},H.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},H.countTrailingZeros=M,H.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},H.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},H.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var q=new Array(256);!function(K){for(var H=0;H<256;++H){var M=H,q=H,w=7;for(M>>>=1;M;M>>>=1)q<<=1,q|=1&M,--w;K[H]=q<<w&255}}(q),H.reverse=function(K){return q[255&K]<<24|q[K>>>8&255]<<16|q[K>>>16&255]<<8|q[K>>>24&255]},H.interleave2=function(K,H){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))<<1},H.deinterleave2=function(K,H){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>H&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},H.interleave3=function(K,H,M){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<1)|(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<2},H.deinterleave3=function(K,H){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>H&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},H.nextCombination=function(K){var H=K|K-1;return H+1|(~H&-~H)-1>>>M(K)+1}},13278:(K,H,M)=>{"use strict";K.exports=function(K,H,M){switch(arguments.length){case 1:return q=[],I(w=K,w,f,!0),q;case 2:return"function"===typeof H?I(K,K,H,!0):function(K,H){return q=[],I(K,H,f,!1),q}(K,H);case 3:return I(K,H,M,!1);default:throw new Error("box-intersect: Invalid arguments")}var w};var q,w=M(13287),u=M(13314),y=M(13319);function h(K,H){for(var M=0;M<K;++M)if(!(H[M]<=H[M+K]))return!0;return!1}function W(K,H,M,q){for(var w=0,u=0,y=0,W=K.length;y<W;++y){var I=K[y];if(!h(H,I)){for(var f=0;f<2*H;++f)M[w++]=I[f];q[u++]=y}}return u}function I(K,H,M,q){var h=K.length,I=H.length;if(!(h<=0||I<=0)){var f=K[0].length>>>1;if(!(f<=0)){var z,G=w.mallocDouble(2*f*h),a=w.mallocInt32(h);if((h=W(K,f,G,a))>0){if(1===f&&q)u.init(h),z=u.sweepComplete(f,M,0,h,G,a,0,h,G,a);else{var v=w.mallocDouble(2*f*I),O=w.mallocInt32(I);(I=W(H,f,v,O))>0&&(u.init(h+I),z=1===f?u.sweepBipartite(f,M,0,h,G,a,0,I,v,O):y(f,M,q,h,G,a,I,v,O),w.free(v),w.free(O))}w.free(G),w.free(a)}return z}}}function f(K,H){q.push([K,H])}},13323:(K,H)=>{"use strict";var M="d",q="ax",w="fp",u="es",y="rs",h="re",W="rb",I="bs",f="be",z="bb",G=[M,q,"vv",y,h,W,"ri",I,f,z,"bi"];function a(K){var H="bruteForce"+(K?"Full":"Partial"),q=[],y=G.slice();K||y.splice(3,0,w);var h=["function "+H+"("+y.join()+"){"];function W(H,w){var y=function(K,H,q){var w="bruteForce"+(K?"Red":"Blue")+(H?"Flip":"")+(q?"Full":""),y=["function ",w,"(",G.join(),"){","var ",u,"=2*",M,";"],h="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",W="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(q?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return K?y.push(h,"Q",":",W):y.push(W,"Q",":",h),q?y.push("if(y1<x0||x1<y0)continue;"):H?y.push("if(y0<=x0||x1<y0)continue;"):y.push("if(y0<x0||x1<y0)continue;"),y.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),H?y.push("yi,xi"):y.push("xi,yi"),y.push(");if(rv!==void 0)return rv;}}}"),{name:w,code:y.join("")}}(H,w,K);q.push(y.code),h.push("return "+y.name+"("+G.join()+");")}h.push("if(re-rs>be-bs){"),K?(W(!0,!1),h.push("}else{"),W(!1,!1)):(h.push("if(fp){"),W(!0,!0),h.push("}else{"),W(!0,!1),h.push("}}else{if(fp){"),W(!1,!0),h.push("}else{"),W(!1,!1),h.push("}")),h.push("}}return "+H);var I=q.join("")+h.join("");return new Function(I)()}H.partial=a(!1),H.full=a(!0)},13319:(K,H,M)=>{"use strict";K.exports=function(K,H,M,u,f,n,c,k,T){!function(K,H){var M=8*w.log2(H+1)*(K+1)|0,u=w.nextPow2(i*M);E.length<u&&(q.free(E),E=q.mallocInt32(u));var y=w.nextPow2(Z*M);l.length<y&&(q.free(l),l=q.mallocDouble(y))}(K,u+c);var d,x=0,Q=2*K;s(x++,0,0,u,0,c,M?16:0,-1/0,1/0),M||s(x++,0,0,c,0,u,1,-1/0,1/0);for(;x>0;){var J=(x-=1)*i,N=E[J],p=E[J+1],o=E[J+2],R=E[J+3],t=E[J+4],U=E[J+5],j=x*Z,m=l[j],F=l[j+1],Y=1&U,r=!!(16&U),e=f,b=n,P=k,g=T;if(Y&&(e=k,b=T,P=f,g=n),!(2&U&&p>=(o=L(K,N,p,o,e,b,F)))&&!(4&U&&(p=S(K,N,p,o,e,b,m))>=o)){var X=o-p,A=t-R;if(r){if(K*X*(X+A)<a){if(void 0!==(d=W.scanComplete(K,N,H,p,o,e,b,R,t,P,g)))return d;continue}}else{if(K*Math.min(X,A)<z){if(void 0!==(d=y(K,N,H,Y,p,o,e,b,R,t,P,g)))return d;continue}if(K*X*A<G){if(void 0!==(d=W.scanBipartite(K,N,H,Y,p,o,e,b,R,t,P,g)))return d;continue}}var KK=v(K,N,p,o,e,b,m,F);if(p<KK)if(K*(KK-p)<z){if(void 0!==(d=h(K,N+1,H,p,KK,e,b,R,t,P,g)))return d}else if(N===K-2){if(void 0!==(d=Y?W.sweepBipartite(K,H,R,t,P,g,p,KK,e,b):W.sweepBipartite(K,H,p,KK,e,b,R,t,P,g)))return d}else s(x++,N+1,p,KK,R,t,Y,-1/0,1/0),s(x++,N+1,R,t,p,KK,1^Y,-1/0,1/0);if(KK<o){var HK=I(K,N,R,t,P,g),MK=P[Q*HK+N],qK=O(K,N,HK,t,P,g,MK);if(qK<t&&s(x++,N,KK,o,qK,t,(4|Y)+(r?16:0),MK,F),R<HK&&s(x++,N,KK,o,R,HK,(2|Y)+(r?16:0),m,MK),HK+1===qK){if(void 0!==(d=r?V(K,N,H,KK,o,e,b,HK,P,g[HK]):D(K,N,H,Y,KK,o,e,b,HK,P,g[HK])))return d}else if(HK<qK){var wK;if(r){if(KK<(wK=B(K,N,KK,o,e,b,MK))){var uK=O(K,N,KK,wK,e,b,MK);if(N===K-2){if(KK<uK&&void 0!==(d=W.sweepComplete(K,H,KK,uK,e,b,HK,qK,P,g)))return d;if(uK<wK&&void 0!==(d=W.sweepBipartite(K,H,uK,wK,e,b,HK,qK,P,g)))return d}else KK<uK&&s(x++,N+1,KK,uK,HK,qK,16,-1/0,1/0),uK<wK&&(s(x++,N+1,uK,wK,HK,qK,0,-1/0,1/0),s(x++,N+1,HK,qK,uK,wK,1,-1/0,1/0))}}else KK<(wK=Y?C(K,N,KK,o,e,b,MK):B(K,N,KK,o,e,b,MK))&&(N===K-2?d=Y?W.sweepBipartite(K,H,HK,qK,P,g,KK,wK,e,b):W.sweepBipartite(K,H,KK,wK,e,b,HK,qK,P,g):(s(x++,N+1,KK,wK,HK,qK,Y,-1/0,1/0),s(x++,N+1,HK,qK,KK,wK,1^Y,-1/0,1/0)))}}}}};var q=M(13287),w=M(13296),u=M(13323),y=u.partial,h=u.full,W=M(13314),I=M(13325),f=M(13328),z=128,G=1<<22,a=1<<22,v=f("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),O=f("lo===p0",["p0"]),L=f("lo<p0",["p0"]),S=f("hi<=p0",["p0"]),B=f("lo<=p0&&p0<=hi",["p0"]),C=f("lo<p0&&p0<=hi",["p0"]),i=6,Z=2,E=q.mallocInt32(1024),l=q.mallocDouble(1024);function s(K,H,M,q,w,u,y,h,W){var I=i*K;E[I]=H,E[I+1]=M,E[I+2]=q,E[I+3]=w,E[I+4]=u,E[I+5]=y;var f=Z*K;l[f]=h,l[f+1]=W}function D(K,H,M,q,w,u,y,h,W,I,f){var z=2*K,G=W*z,a=I[G+H];K:for(var v=w,O=w*z;v<u;++v,O+=z){var L=y[O+H],S=y[O+H+K];if(!(a<L||S<a)&&(!q||a!==L)){for(var B,C=h[v],i=H+1;i<K;++i){L=y[O+i],S=y[O+i+K];var Z=I[G+i],E=I[G+i+K];if(S<Z||E<L)continue K}if(void 0!==(B=q?M(f,C):M(C,f)))return B}}}function V(K,H,M,q,w,u,y,h,W,I){var f=2*K,z=h*f,G=W[z+H];K:for(var a=q,v=q*f;a<w;++a,v+=f){var O=y[a];if(O!==I){var L=u[v+H],S=u[v+H+K];if(!(G<L||S<G)){for(var B=H+1;B<K;++B){L=u[v+B],S=u[v+B+K];var C=W[z+B],i=W[z+B+K];if(S<C||i<L)continue K}var Z=M(O,I);if(void 0!==Z)return Z}}}}},13325:(K,H,M)=>{"use strict";K.exports=function(K,H,M,y,h,W){if(y<=M+1)return M;var I=M,f=y,z=y+M>>>1,G=2*K,a=z,v=h[G*z+H];for(;I<f;){if(f-I<w){u(K,H,I,f,h,W),v=h[G*z+H];break}var O=f-I,L=Math.random()*O+I|0,S=h[G*L+H],B=Math.random()*O+I|0,C=h[G*B+H],i=Math.random()*O+I|0,Z=h[G*i+H];S<=C?Z>=C?(a=B,v=C):S>=Z?(a=L,v=S):(a=i,v=Z):C>=Z?(a=B,v=C):Z>=S?(a=L,v=S):(a=i,v=Z);for(var E=G*(f-1),l=G*a,s=0;s<G;++s,++E,++l){var D=h[E];h[E]=h[l],h[l]=D}var V=W[f-1];W[f-1]=W[a],W[a]=V;for(E=G*(f-1),l=G*(a=q(K,H,I,f-1,h,W,v)),s=0;s<G;++s,++E,++l){D=h[E];h[E]=h[l],h[l]=D}V=W[f-1];if(W[f-1]=W[a],W[a]=V,z<a){for(f=a-1;I<f&&h[G*(f-1)+H]===v;)f-=1;f+=1}else{if(!(a<z))break;for(I=a+1;I<f&&h[G*I+H]===v;)I+=1}}return q(K,H,M,z,h,W,h[G*z+H])};var q=M(13328)("lo<p0",["p0"]),w=8;function u(K,H,M,q,w,u){for(var y=2*K,h=y*(M+1)+H,W=M+1;W<q;++W,h+=y)for(var I=w[h],f=W,z=y*(W-1);f>M&&w[z+H]>I;--f,z-=y){for(var G=z,a=z+y,v=0;v<y;++v,++G,++a){var O=w[G];w[G]=w[a],w[a]=O}var L=u[f];u[f]=u[f-1],u[f-1]=L}}},13328:K=>{"use strict";K.exports=function(K,M){var q="abcdef".split("").concat(M),w=[];K.indexOf("lo")>=0&&w.push("lo=e[k+n]");K.indexOf("hi")>=0&&w.push("hi=e[k+o]");return q.push(H.replace("_",w.join()).replace("$",K)),Function.apply(void 0,q)};var H="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},13317:K=>{"use strict";K.exports=function(K,q){q<=4*H?M(0,q-1,K):I(0,q-1,K)};var H=32;function M(K,H,M){for(var q=2*(K+1),w=K+1;w<=H;++w){for(var u=M[q++],y=M[q++],h=w,W=q-2;h-- >K;){var I=M[W-2],f=M[W-1];if(I<u)break;if(I===u&&f<y)break;M[W]=I,M[W+1]=f,W-=2}M[W]=u,M[W+1]=y}}function q(K,H,M){H*=2;var q=M[K*=2],w=M[K+1];M[K]=M[H],M[K+1]=M[H+1],M[H]=q,M[H+1]=w}function w(K,H,M){H*=2,M[K*=2]=M[H],M[K+1]=M[H+1]}function u(K,H,M,q){H*=2,M*=2;var w=q[K*=2],u=q[K+1];q[K]=q[H],q[K+1]=q[H+1],q[H]=q[M],q[H+1]=q[M+1],q[M]=w,q[M+1]=u}function y(K,H,M,q,w){H*=2,w[K*=2]=w[H],w[H]=M,w[K+1]=w[H+1],w[H+1]=q}function h(K,H,M){H*=2;var q=M[K*=2],w=M[H];return!(q<w)&&(q!==w||M[K+1]>M[H+1])}function W(K,H,M,q){var w=q[K*=2];return w<H||w===H&&q[K+1]<M}function I(K,f,z){var G=(f-K+1)/6|0,a=K+G,v=f-G,O=K+f>>1,L=O-G,S=O+G,B=a,C=L,i=O,Z=S,E=v,l=K+1,s=f-1,D=0;h(B,C,z)&&(D=B,B=C,C=D),h(Z,E,z)&&(D=Z,Z=E,E=D),h(B,i,z)&&(D=B,B=i,i=D),h(C,i,z)&&(D=C,C=i,i=D),h(B,Z,z)&&(D=B,B=Z,Z=D),h(i,Z,z)&&(D=i,i=Z,Z=D),h(C,E,z)&&(D=C,C=E,E=D),h(C,i,z)&&(D=C,C=i,i=D),h(Z,E,z)&&(D=Z,Z=E,E=D);for(var V=z[2*C],n=z[2*C+1],c=z[2*Z],k=z[2*Z+1],T=2*B,d=2*i,x=2*E,Q=2*a,J=2*O,N=2*v,p=0;p<2;++p){var o=z[T+p],R=z[d+p],t=z[x+p];z[Q+p]=o,z[J+p]=R,z[N+p]=t}w(L,K,z),w(S,f,z);for(var U=l;U<=s;++U)if(W(U,V,n,z))U!==l&&q(U,l,z),++l;else if(!W(U,c,k,z))for(;;){if(W(s,c,k,z)){W(s,V,n,z)?(u(U,l,s,z),++l,--s):(q(U,s,z),--s);break}if(--s<U)break}y(K,l-1,V,n,z),y(f,s+1,c,k,z),l-2-K<=H?M(K,l-2,z):I(K,l-2,z),f-(s+2)<=H?M(s+2,f,z):I(s+2,f,z),s-l<=H?M(l,s,z):I(l,s,z)}},13314:(K,H,M)=>{"use strict";K.exports={init:function(K){var H=w.nextPow2(K);W.length<H&&(q.free(W),W=q.mallocInt32(H));I.length<H&&(q.free(I),I=q.mallocInt32(H));f.length<H&&(q.free(f),f=q.mallocInt32(H));z.length<H&&(q.free(z),z=q.mallocInt32(H));G.length<H&&(q.free(G),G=q.mallocInt32(H));a.length<H&&(q.free(a),a=q.mallocInt32(H));var M=8*H;v.length<M&&(q.free(v),v=q.mallocDouble(M))},sweepBipartite:function(K,H,M,q,w,h,G,a,S,B){for(var C=0,i=2*K,Z=K-1,E=i-1,l=M;l<q;++l){var s=h[l],D=i*l;v[C++]=w[D+Z],v[C++]=-(s+1),v[C++]=w[D+E],v[C++]=s}for(l=G;l<a;++l){s=B[l]+y;var V=i*l;v[C++]=S[V+Z],v[C++]=-s,v[C++]=S[V+E],v[C++]=s}var n=C>>>1;u(v,n);var c=0,k=0;for(l=0;l<n;++l){var T=0|v[2*l+1];if(T>=y)O(f,z,k--,T=T-y|0);else if(T>=0)O(W,I,c--,T);else if(T<=-y){T=-T-y|0;for(var d=0;d<c;++d){if(void 0!==(x=H(W[d],T)))return x}L(f,z,k++,T)}else{T=-T-1|0;for(d=0;d<k;++d){var x;if(void 0!==(x=H(T,f[d])))return x}L(W,I,c++,T)}}},sweepComplete:function(K,H,M,q,w,y,h,S,B,C){for(var i=0,Z=2*K,E=K-1,l=Z-1,s=M;s<q;++s){var D=y[s]+1<<1,V=Z*s;v[i++]=w[V+E],v[i++]=-D,v[i++]=w[V+l],v[i++]=D}for(s=h;s<S;++s){D=C[s]+1<<1;var n=Z*s;v[i++]=B[n+E],v[i++]=1|-D,v[i++]=B[n+l],v[i++]=1|D}var c=i>>>1;u(v,c);var k=0,T=0,d=0;for(s=0;s<c;++s){var x=0|v[2*s+1],Q=1&x;if(s<c-1&&x>>1===v[2*s+3]>>1&&(Q=2,s+=1),x<0){for(var J=-(x>>1)-1,N=0;N<d;++N){if(void 0!==(p=H(G[N],J)))return p}if(0!==Q)for(N=0;N<k;++N){if(void 0!==(p=H(W[N],J)))return p}if(1!==Q)for(N=0;N<T;++N){var p;if(void 0!==(p=H(f[N],J)))return p}0===Q?L(W,I,k++,J):1===Q?L(f,z,T++,J):2===Q&&L(G,a,d++,J)}else{J=(x>>1)-1;0===Q?O(W,I,k--,J):1===Q?O(f,z,T--,J):2===Q&&O(G,a,d--,J)}}},scanBipartite:function(K,H,M,q,w,h,f,z,G,a,S,B){var C=0,i=2*K,Z=H,E=H+K,l=1,s=1;q?s=y:l=y;for(var D=w;D<h;++D){var V=D+l,n=i*D;v[C++]=f[n+Z],v[C++]=-V,v[C++]=f[n+E],v[C++]=V}for(D=G;D<a;++D){V=D+s;var c=i*D;v[C++]=S[c+Z],v[C++]=-V}var k=C>>>1;u(v,k);var T=0;for(D=0;D<k;++D){var d=0|v[2*D+1];if(d<0){var x=!1;if((V=-d)>=y?(x=!q,V-=y):(x=!!q,V-=1),x)L(W,I,T++,V);else{var Q=B[V],J=i*V,N=S[J+H+1],p=S[J+H+1+K];K:for(var o=0;o<T;++o){var R=W[o],t=i*R;if(!(p<f[t+H+1]||f[t+H+1+K]<N)){for(var U=H+2;U<K;++U)if(S[J+U+K]<f[t+U]||f[t+U+K]<S[J+U])continue K;var j,m=z[R];if(void 0!==(j=q?M(Q,m):M(m,Q)))return j}}}}else O(W,I,T--,d-l)}},scanComplete:function(K,H,M,q,w,h,I,f,z,G,a){for(var O=0,L=2*K,S=H,B=H+K,C=q;C<w;++C){var i=C+y,Z=L*C;v[O++]=h[Z+S],v[O++]=-i,v[O++]=h[Z+B],v[O++]=i}for(C=f;C<z;++C){i=C+1;var E=L*C;v[O++]=G[E+S],v[O++]=-i}var l=O>>>1;u(v,l);var s=0;for(C=0;C<l;++C){var D=0|v[2*C+1];if(D<0){if((i=-D)>=y)W[s++]=i-y;else{var V=a[i-=1],n=L*i,c=G[n+H+1],k=G[n+H+1+K];K:for(var T=0;T<s;++T){var d=W[T],x=I[d];if(x===V)break;var Q=L*d;if(!(k<h[Q+H+1]||h[Q+H+1+K]<c)){for(var J=H+2;J<K;++J)if(G[n+J+K]<h[Q+J]||h[Q+J+K]<G[n+J])continue K;var N=M(x,V);if(void 0!==N)return N}}}}else{for(i=D-y,T=s-1;T>=0;--T)if(W[T]===i){for(J=T+1;J<s;++J)W[J-1]=W[J];break}--s}}}};var q=M(13287),w=M(13296),u=M(13317),y=1<<28,h=1024,W=q.mallocInt32(h),I=q.mallocInt32(h),f=q.mallocInt32(h),z=q.mallocInt32(h),G=q.mallocInt32(h),a=q.mallocInt32(h),v=q.mallocDouble(8192);function O(K,H,M,q){var w=H[q],u=K[M-1];K[w]=u,H[u]=w}function L(K,H,M,q){K[M]=q,H[q]=M}},13304:K=>{"use strict";function H(K,M,q){var w=0|K[q];if(w<=0)return[];var u,y=new Array(w);if(q===K.length-1)for(u=0;u<w;++u)y[u]=M;else for(u=0;u<w;++u)y[u]=H(K,M,q+1);return y}K.exports=function(K,M){switch("undefined"===typeof M&&(M=0),typeof K){case"number":if(K>0)return function(K,H){var M,q;for(M=new Array(K),q=0;q<K;++q)M[q]=H;return M}(0|K,M);break;case"object":if("number"===typeof K.length)return H(K,M,0)}return[]}},13247:(K,H,M)=>{K.exports=function(){var K=this;this.components={},this.comps=this.components;var H=this.components,M=1,w={},u=[],y=[],h={timeout:!1,removals:[],multiComps:[]};function W(K,M){var q=H[M],u=w[M],y=u.hash[K];y&&(u.remove(K),q.CM&&(q.multi?(y.forEach((H=>{H&&q.CM(K,H)})),y.length=0):q.CM(K,y)),h.removals.push(u),I())}function I(){h.timeout||(h.timeout=!0,setTimeout(f,1))}function f(){h.timeout=!1,z()}function z(){h.multiComps.length&&function(K){for(var H=0;H<K.length;H++){var{entID:M,data:q}=K[H],w=q.hash[M];if(w){for(var u=0;u<w.length;u++)w[u]||(w.splice(u,1),u--);0===w.length&&(q.remove(M),h.removals.push(q))}}K.length=0}(h.multiComps),h.removals.length&&function(K){for(var H=0;H<K.length;H++){K[H].flush()}K.length=0}(h.removals)}this.Jz=w,this._systems=u,this._renderSystems=y,this.If=function(H){var q=M++;return Array.isArray(H)&&H.forEach((H=>K.UW(q,H))),q},this.deleteEntity=function(H){return Object.keys(w).forEach((K=>{w[K].hash[H]&&W(H,K)})),K},this.Tf=function(K){if(!K)throw new Error("Missing component definition");var M=K.name;if(!M)throw new Error("Component definition must have a name property.");if("string"!==typeof M)throw new Error("Component name must be a string.");if(""===M)throw new Error("Component name must be a non-empty string.");if(w[M])throw new Error(`Component ${M} already exists.`);var h={};return h.name=M,h.multi=!!K.multi,h.order=isNaN(K.order)?99:K.order,h.stateConstructor=K.stateConstructor||null,h.state=K.state||{},h.Qh=K.Qh||null,h.CM=K.CM||null,h.system=K.system||null,h.th=K.th||null,H[M]=h,w[M]=new q,w[M]._pendingMultiCleanup=!1,w[M]._multiCleanupIDs=h.multi?[]:null,h.system&&(u.push(M),u.sort(((K,M)=>H[K].order-H[M].order))),h.th&&(y.push(M),y.sort(((K,M)=>H[K].order-H[M].order))),M},this.overwriteComponent=function(K,M){var q=H[K];if(!q)throw new Error(`Unknown component: ${K}`);if(!M)throw new Error("Missing component definition");if(q.name!==M.name)throw new Error("Overwriting component must use the same name property.");var h={};h.name=K,h.multi=!!M.multi,h.order=isNaN(M.order)?99:M.order,h.state=M.state||{},h.Qh=M.Qh||null,h.CM=M.CM||null,h.system=M.system||null,h.th=M.th||null,H[K]=h,w[K]._pendingMultiCleanup=!1,w[K]._multiCleanupIDs=h.multi?[]:null;var W=u.indexOf(K);h.system&&W<0&&u.push(K),!h.system&&W>=0&&u.splice(W,1),u.sort(((K,M)=>H[K].order-H[M].order));var I=y.indexOf(K);h.th&&I<0&&y.push(K),!h.th&&I>=0&&y.splice(I,1),y.sort(((K,M)=>H[K].order-H[M].order));var f=h.state;return this.RI(K).forEach((K=>{for(var H in f)H in K||(K[H]=f[H]);h.Qh&&h.Qh(K.oh,K)})),K},this.deleteComponent=function(M){var q=w[M];if(!q)throw new Error(`Unknown component: ${M}`);q.flush(),q.list.forEach((K=>{K&&W(K.oh||K[0].oh,M)}));var h=u.indexOf(M),I=y.indexOf(M);return h>-1&&u.splice(h,1),I>-1&&y.splice(I,1),w[M].dispose(),delete w[M],delete H[M],K},this.UW=function(K,M,q){var u,y=H[M],h=w[M];if(!h)throw new Error(`Unknown component: ${M}.`);if(h.hash[K]&&!y.multi)throw new Error(`Entity ${K} already has component: ${M}.`);if(y.stateConstructor){if(!(u=new y.stateConstructor).hasOwnProperty("oh"))throw new Error(`Component ${y.name} stateConstructor type does not have property __id`)}else u=Object.assign({},{oh:K},y.state,q);if(u.oh=K,y.multi){var W=h.hash[K];W||(W=[],h.add(K,W)),W.push(u)}else h.add(K,u);return y.Qh&&y.Qh(K,u),this},this.XW=function(K,H){var M=w[H];if(!M)throw new Error(`Unknown component: ${H}.`);return!!M.hash[K]},this.YW=function(H,M){if(!w[M])throw new Error(`Unknown component: ${M}.`);return W(H,M),K},this.getState=function(K,H){var M=w[H];if(!M)throw new Error(`Unknown component: ${H}.`);return M.hash[K]},this.RI=function(K){var H=w[K];if(!H)throw new Error(`Unknown component: ${K}.`);return z(),H.list},this.Da=function(K){if(!w[K])throw new Error(`Unknown component: ${K}.`);var H=w[K].hash;return K=>H[K]},this.ca=function(K){if(!w[K])throw new Error(`Unknown component: ${K}.`);var H=w[K].hash;return K=>!!H[K]},this.Ay=function(M){z();for(var q=0;q<u.length;q++){var y=u[q],h=H[y],W=w[y];h.system(M,W.list),z()}return K},this.render=function(M){z();for(var q=0;q<y.length;q++){var u=y[q],h=H[u],W=w[u];h.th(M,W.list),z()}return K},this.removeMultiComponent=function(M,q,u){var y=H[q],W=w[q];if(!W)throw new Error(`Unknown component: ${q}.`);if(!y.multi)throw new Error("removeMultiComponent called on non-multi component");return function(K,H,M,q){var w=M.hash[K];if(w){var u=w[q];u&&(w[q]=null,H.CM&&H.CM(K,u),h.multiComps.push({entID:K,data:M}),I())}}(M,y,W,u),K}};var q=M(13252)},13252:K=>{function H(K,H){var M=K._map[H];if(delete K.hash[H],delete K._map[H],M===K.list.length-1)K.list.pop();else{var q=K.list.pop();if(K.list[M]=q,null===q||null===q[0]){var w=K.list.length;for(var u in K._map)if(K._map[u]===w)return void(K._map[u]=M)}else{var y=q.oh||q[0].oh;K._map[y]=M}}}K.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(K,H){if("number"===typeof this._map[K]){var M=this._map[K];this.hash[K]=H,this.list[M]=H}else this._map[K]=this.list.length,this.hash[K]=H,this.list.push(H)}remove(K){var H=this._map[K];this.hash[K]=null,this.list[H]=null,this._pendingRemovals.push(K)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var K=0;K<this._pendingRemovals.length;K++){var M=this._pendingRemovals[K];null===this.hash[M]&&H(this,M)}this._pendingRemovals.length=0}}},13208:K=>{"use strict";var H,M="object"===typeof Reflect?Reflect:null,q=function(K,H,M){return Function.prototype.apply.call(K,H,M)};H=M&&"function"===typeof M.ownKeys?M.ownKeys:Object.getOwnPropertySymbols?function(K){return Object.getOwnPropertyNames(K).concat(Object.getOwnPropertySymbols(K))}:function(K){return Object.getOwnPropertyNames(K)};var w=Number.isNaN||function(K){return K!==K};function u(){u.init.call(this)}K.exports=u,K.exports.once=function(K,H){return new Promise((function(M,q){function w(M){K.removeListener(H,u),q(M)}function u(){"function"===typeof K.removeListener&&K.removeListener("error",w),M([].slice.call(arguments))}O(K,H,u,{once:!0}),"error"!==H&&function(K,H,M){"function"===typeof K.on&&O(K,"error",H,M)}(K,w,{once:!0})}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var y=10;function h(K){if("function"!==typeof K)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof K)}function W(K){return void 0===K._maxListeners?u.defaultMaxListeners:K._maxListeners}function I(K,H,M,q){var w,u,y,I;if(h(M),void 0===(u=K._events)?(u=K._events=Object.create(null),K._eventsCount=0):(void 0!==u.newListener&&(K.emit("newListener",H,M.listener?M.listener:M),u=K._events),y=u[H]),void 0===y)y=u[H]=M,++K._eventsCount;else if("function"===typeof y?y=u[H]=q?[M,y]:[y,M]:q?y.unshift(M):y.push(M),(w=W(K))>0&&y.length>w&&!y.warned){y.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+y.length+" "+String(H)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.wH=K,f.type=H,f.count=y.length,I=f,console&&console.warn&&console.warn(I)}return K}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function z(K,H,M){var q={fired:!1,wrapFn:void 0,target:K,type:H,listener:M},w=f.bind(q);return w.listener=M,q.wrapFn=w,w}function G(K,H,M){var q=K._events;if(void 0===q)return[];var w=q[H];return void 0===w?[]:"function"===typeof w?M?[w.listener||w]:[w]:M?function(K){for(var H=new Array(K.length),M=0;M<H.length;++M)H[M]=K[M].listener||K[M];return H}(w):v(w,w.length)}function a(K){var H=this._events;if(void 0!==H){var M=H[K];if("function"===typeof M)return 1;if(void 0!==M)return M.length}return 0}function v(K,H){for(var M=new Array(H),q=0;q<H;++q)M[q]=K[q];return M}function O(K,H,M,q){if("function"===typeof K.on)q.once?K.once(H,M):K.on(H,M);else{if("function"!==typeof K.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof K);K.addEventListener(H,(function w(u){q.once&&K.removeEventListener(H,w),M(u)}))}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(K){if("number"!==typeof K||K<0||w(K))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+K+".");y=K}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(K){if("number"!==typeof K||K<0||w(K))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+K+".");return this._maxListeners=K,this},u.prototype.getMaxListeners=function(){return W(this)},u.prototype.emit=function(K){for(var H=[],M=1;M<arguments.length;M++)H.push(arguments[M]);var w="error"===K,u=this._events;if(void 0!==u)w=w&&void 0===u.error;else if(!w)return!1;if(w){var y;if(H.length>0&&(y=H[0]),y instanceof Error)throw y;var h=new Error("Unhandled error."+(y?" ("+y.message+")":""));throw h.context=y,h}var W=u[K];if(void 0===W)return!1;if("function"===typeof W)q(W,this,H);else{var I=W.length,f=v(W,I);for(M=0;M<I;++M)q(f[M],this,H)}return!0},u.prototype.addListener=function(K,H){return I(this,K,H,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(K,H){return I(this,K,H,!0)},u.prototype.once=function(K,H){return h(H),this.on(K,z(this,K,H)),this},u.prototype.prependOnceListener=function(K,H){return h(H),this.prependListener(K,z(this,K,H)),this},u.prototype.removeListener=function(K,H){var M,q,w,u,y;if(h(H),void 0===(q=this._events))return this;if(void 0===(M=q[K]))return this;if(M===H||M.listener===H)0===--this._eventsCount?this._events=Object.create(null):(delete q[K],q.removeListener&&this.emit("removeListener",K,M.listener||H));else if("function"!==typeof M){for(w=-1,u=M.length-1;u>=0;u--)if(M[u]===H||M[u].listener===H){y=M[u].listener,w=u;break}if(w<0)return this;0===w?M.shift():function(K,H){for(;H+1<K.length;H++)K[H]=K[H+1];K.pop()}(M,w),1===M.length&&(q[K]=M[0]),void 0!==q.removeListener&&this.emit("removeListener",K,y||H)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.uH=function(K){var H,M,q;if(void 0===(M=this._events))return this;if(void 0===M.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==M[K]&&(0===--this._eventsCount?this._events=Object.create(null):delete M[K]),this;if(0===arguments.length){var w,u=Object.keys(M);for(q=0;q<u.length;++q)"removeListener"!==(w=u[q])&&this.uH(w);return this.uH("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(H=M[K]))this.removeListener(K,H);else if(void 0!==H)for(q=H.length-1;q>=0;q--)this.removeListener(K,H[q]);return this},u.prototype.listeners=function(K){return G(this,K,!0)},u.prototype.rawListeners=function(K){return G(this,K,!1)},u.listenerCount=function(K,H){return"function"===typeof K.listenerCount?K.listenerCount(H):a.call(K,H)},u.prototype.listenerCount=a,u.prototype.eventNames=function(){return this._eventsCount>0?H(this._events):[]}},13496:K=>{"use strict";K.exports=function(K,H,M,q,w,u){var y=+H[0],h=+H[1],W=+H[2],I=+M[0],f=+M[1],z=+M[2],G=Math.sqrt(I*I+f*f+z*z);if(0===G)throw new Error("Can't raycast along a zero vector");return function(K,H,M,q,w,u,y,h,W,I){for(var f=0,z=Math.floor,G=0|z(H),a=0|z(M),v=0|z(q),O=w>0?1:-1,L=u>0?1:-1,S=y>0?1:-1,B=Math.abs(1/w),C=Math.abs(1/u),i=Math.abs(1/y),Z=B<1/0?B*(O>0?G+1-H:H-G):1/0,E=C<1/0?C*(L>0?a+1-M:M-a):1/0,l=i<1/0?i*(S>0?v+1-q:q-v):1/0,s=-1;f<=h;){var D=K(G,a,v);if(D)return W&&(W[0]=H+f*w,W[1]=M+f*u,W[2]=q+f*y),I&&(I[0]=I[1]=I[2]=0,0===s&&(I[0]=-O),1===s&&(I[1]=-L),2===s&&(I[2]=-S)),D;Z<E?Z<l?(G+=O,f=Z,Z+=B,s=0):(v+=S,f=l,l+=i,s=2):E<l?(a+=L,f=E,E+=C,s=1):(v+=S,f=l,l+=i,s=2)}return W&&(W[0]=H+f*w,W[1]=M+f*u,W[2]=q+f*y),I&&(I[0]=I[1]=I[2]=0),0}(K,y,h,W,I/=G,f/=G,z/=G,q="undefined"===typeof q?64:+q,w,u)}},13527:(K,H,M)=>{"use strict";M.d(H,{b:()=>u});var q=M(13208);function w(){this.sG=!1,this.stopPropagation=!1,this.DG=!1,this.disabled=!1}class u{constructor(K,H){this.version="0.7.0";var M=Object.assign({},new w,H||{});this.element=K||document,this.sG=!!M.sG,this.stopPropagation=!!M.stopPropagation,this.DG=!!M.DG,this.disabled=!!M.disabled,this.filterEvents=(K,H)=>!0,this.down=new q.EventEmitter,this.up=new q.EventEmitter,this.state={},this.xI={dx:0,dy:0,La:0,dI:0,Sa:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?h(this):document.addEventListener("DOMContentLoaded",(K=>{h(this)}),{once:!0})}bind(K){for(var H=arguments.length,M=new Array(H>1?H-1:0),q=1;q<H;q++)M[q-1]=arguments[q];M.forEach((H=>{var M=this._keyBindmap[H]||[];M.includes(K)||(M.push(K),this._keyBindmap[H]=M)})),this.state[K]=!!this.state[K],this.pressCount[K]=this.pressCount[K]||0,this.releaseCount[K]=this.releaseCount[K]||0}unbind(K){for(var H in this._keyBindmap){var M=this._keyBindmap[H],q=M.indexOf(K);q>-1&&M.splice(q,1)}}getBindings(){var K={};for(var H in this._keyBindmap){this._keyBindmap[H].forEach((M=>{K[M]=K[M]||[],K[M].push(H)}))}return K}Ay(){y(this.xI),y(this.pressCount),y(this.releaseCount)}}function y(K){for(var H in K)K[H]=0}function h(K){window.addEventListener("keydown",v.bind(null,K,!0),!1),window.addEventListener("keyup",v.bind(null,K,!1),!1);var H={passive:!0};K.element.addEventListener("touchstart",z.bind(void 0,K),{passive:!1}),K.element.addEventListener("touchend",a.bind(void 0,K),H),K.element.addEventListener("mousedown",O.bind(null,K,!0),H),window.document.addEventListener("mouseup",O.bind(null,K,!1),H),K.element.addEventListener("touchmove",L.bind(null,K),H),K.element.addEventListener("mousemove",L.bind(null,K),H),window.PointerEvent,K.element.addEventListener("wheel",S.bind(null,K),H),K.element.addEventListener("contextmenu",B.bind(null,K),!1),window.addEventListener("blur",C.bind(null,K),!1)}var W=0,I=0,f=null;function z(K,H){H.preventDefault(),G(H)}function G(K){let H=!1;for(let M=0;M<K.touches.length;++M)if(K.touches[M].identifier===f){H=!0;break}if(!H){const H=K.changedTouches[0];W=H.clientX,I=H.clientY,f=H.identifier}}function a(K,H){for(var M=H.changedTouches,q=0;q<M.length;++q)M[q].identifier===f&&(f=null)}function v(K,H,M){i(M.code,H,K,M)}function O(K,H,M){if("pointerId"in M)if(H){if(null!==K._touches.currID)return;K._touches.currID=M.pointerId}else{if(K._touches.currID!==M.pointerId)return;K._touches.currID=null}return i("Mouse"+("button"in M?M.button+1:1),H,K,M),!1}function L(K,H){var M=H.movementX||H.mozMovementX||0,q=H.movementY||H.mozMovementY||0;if(H.touches&&0===(M|q)){var w=function(K){G(K);for(let H=0;H<K.changedTouches.length;++H)if(K.changedTouches[H].identifier==f){const M=K.changedTouches[H],q=[M.clientX-W,M.clientY-I];return W=M.clientX,I=M.clientY,q}return console.error(`Did not find touch id ${f}`),[0,0]}(H);M=w[0],q=w[1]}K.xI.dx+=M,K.xI.dy+=q}function S(K,H){var M=1;switch(H.deltaMode){case 0:M=1;break;case 1:M=12;break;case 2:M=K.element.clientHeight||window.innerHeight}K.xI.La+=(H.deltaX||0)*M,K.xI.dI+=(H.deltaY||0)*M,K.xI.Sa+=(H.deltaZ||0)*M}function B(K,H){if(!K.DG)return H.preventDefault(),!1}function C(K){for(var H in K._keyStates)K._keyStates[H]&&(/^Mouse\d/.test(H)||i(H,!1,K,{code:H,note:"itm804gbbcs",preventDefault:()=>{},stopPropagation:()=>{}}))}function i(K,H,M,q){var w=M._keyBindmap[K];w&&(Z(M._keyStates[K],H)&&(M._keyStates[K]=H,w.forEach((K=>{(!M.filterEvents||M.filterEvents(q,K))&&function(K,H,M,q){var w=H?M.pressCount:M.releaseCount;w[K]=(w[K]||0)+1;var u=M._bindPressCount[K]||0;(u+=H?1:-1)<0&&(u=0);M._bindPressCount[K]=u;var y=M.state[K];if(Z(y,u)){M.state[K]=u>0;var h=H?M.down:M.up;M.disabled||h.emit(K,q)}}(K,H,M,q)}))),"button"in q||(M.sG&&!q.defaultPrevented&&q.preventDefault(),M.stopPropagation&&q.stopPropagation()))}function Z(K,H){return K?!H:H}},12197:K=>{K.exports=function(K,H,M){return K[0]=H[0]+M[0],K[1]=H[1]+M[1],K[2]=H[2]+M[2],K}},12145:(K,H,M)=>{K.exports=function(K,H){var M=q(K[0],K[1],K[2]),y=q(H[0],H[1],H[2]);w(M,M),w(y,y);var h=u(M,y);return h>1?0:Math.acos(h)};var q=M(12150),w=M(12155),u=M(12164)},12250:K=>{K.exports=function(K,H){return K[0]=Math.ceil(H[0]),K[1]=Math.ceil(H[1]),K[2]=Math.ceil(H[2]),K}},12140:K=>{K.exports=function(K){var H=new Float32Array(3);return H[0]=K[0],H[1]=K[1],H[2]=K[2],H}},12172:K=>{K.exports=function(K,H){return K[0]=H[0],K[1]=H[1],K[2]=H[2],K}},12132:K=>{K.exports=function(){var K=new Float32Array(3);return K[0]=0,K[1]=0,K[2]=0,K}},12336:K=>{K.exports=function(K,H,M){var q=H[0],w=H[1],u=H[2],y=M[0],h=M[1],W=M[2];return K[0]=w*W-u*h,K[1]=u*y-q*W,K[2]=q*h-w*y,K}},12279:(K,H,M)=>{K.exports=M(12274)},12274:K=>{K.exports=function(K,H){var M=H[0]-K[0],q=H[1]-K[1],w=H[2]-K[2];return Math.sqrt(M*M+q*q+w*w)}},12236:(K,H,M)=>{K.exports=M(12229)},12229:K=>{K.exports=function(K,H,M){return K[0]=H[0]/M[0],K[1]=H[1]/M[1],K[2]=H[2]/M[2],K}},12164:K=>{K.exports=function(K,H){return K[0]*H[0]+K[1]*H[1]+K[2]*H[2]}},12123:K=>{K.exports=1e-6},12183:(K,H,M)=>{K.exports=function(K,H){var M=K[0],w=K[1],u=K[2],y=H[0],h=H[1],W=H[2];return Math.abs(M-y)<=q*Math.max(1,Math.abs(M),Math.abs(y))&&Math.abs(w-h)<=q*Math.max(1,Math.abs(w),Math.abs(h))&&Math.abs(u-W)<=q*Math.max(1,Math.abs(u),Math.abs(W))};var q=M(12123)},12189:K=>{K.exports=function(K,H){return K[0]===H[0]&&K[1]===H[1]&&K[2]===H[2]}},12248:K=>{K.exports=function(K,H){return K[0]=Math.floor(H[0]),K[1]=Math.floor(H[1]),K[2]=Math.floor(H[2]),K}},12375:(K,H,M)=>{K.exports=function(K,H,M,w,u,y){var h,W;H||(H=3);M||(M=0);W=w?Math.min(w*H+M,K.length):K.length;for(h=M;h<W;h+=H)q[0]=K[h],q[1]=K[h+1],q[2]=K[h+2],u(q,q,y),K[h]=q[0],K[h+1]=q[1],K[h+2]=q[2];return K};var q=M(12132)()},12150:K=>{K.exports=function(K,H,M){var q=new Float32Array(3);return q[0]=K,q[1]=H,q[2]=M,q}},12114:(K,H,M)=>{K.exports={EPSILON:M(12123),create:M(12132),clone:M(12140),angle:M(12145),jy:M(12150),j:M(12172),set:M(12180),equals:M(12183),exactEquals:M(12189),add:M(12197),LH:M(12200),sub:M(12209),multiply:M(12215),mul:M(12221),divide:M(12229),div:M(12236),min:M(12240),max:M(12245),floor:M(12248),ceil:M(12250),round:M(12254),scale:M(12260),my:M(12265),distance:M(12274),i:M(12279),squaredDistance:M(12288),sqrDist:M(12295),length:M(12301),len:M(12308),squaredLength:M(12317),Fy:M(12324),negate:M(12326),inverse:M(12328),normalize:M(12155),dot:M(12164),cross:M(12336),Ry:M(12341),random:M(12346),transformMat4:M(12348),transformMat3:M(12352),transformQuat:M(12354),Yy:M(12360),ey:M(12364),by:M(12366),forEach:M(12375)}},12328:K=>{K.exports=function(K,H){return K[0]=1/H[0],K[1]=1/H[1],K[2]=1/H[2],K}},12308:(K,H,M)=>{K.exports=M(12301)},12301:K=>{K.exports=function(K){var H=K[0],M=K[1],q=K[2];return Math.sqrt(H*H+M*M+q*q)}},12341:K=>{K.exports=function(K,H,M,q){var w=H[0],u=H[1],y=H[2];return K[0]=w+q*(M[0]-w),K[1]=u+q*(M[1]-u),K[2]=y+q*(M[2]-y),K}},12245:K=>{K.exports=function(K,H,M){return K[0]=Math.max(H[0],M[0]),K[1]=Math.max(H[1],M[1]),K[2]=Math.max(H[2],M[2]),K}},12240:K=>{K.exports=function(K,H,M){return K[0]=Math.min(H[0],M[0]),K[1]=Math.min(H[1],M[1]),K[2]=Math.min(H[2],M[2]),K}},12221:(K,H,M)=>{K.exports=M(12215)},12215:K=>{K.exports=function(K,H,M){return K[0]=H[0]*M[0],K[1]=H[1]*M[1],K[2]=H[2]*M[2],K}},12326:K=>{K.exports=function(K,H){return K[0]=-H[0],K[1]=-H[1],K[2]=-H[2],K}},12155:K=>{K.exports=function(K,H){var M=H[0],q=H[1],w=H[2],u=M*M+q*q+w*w;u>0&&(u=1/Math.sqrt(u),K[0]=H[0]*u,K[1]=H[1]*u,K[2]=H[2]*u);return K}},12346:K=>{K.exports=function(K,H){H=H||1;var M=2*Math.random()*Math.PI,q=2*Math.random()-1,w=Math.sqrt(1-q*q)*H;return K[0]=Math.cos(M)*w,K[1]=Math.sin(M)*w,K[2]=q*H,K}},12360:K=>{K.exports=function(K,H,M,q){var w=M[1],u=M[2],y=H[1]-w,h=H[2]-u,W=Math.sin(q),I=Math.cos(q);return K[0]=H[0],K[1]=w+y*I-h*W,K[2]=u+y*W+h*I,K}},12364:K=>{K.exports=function(K,H,M,q){var w=M[0],u=M[2],y=H[0]-w,h=H[2]-u,W=Math.sin(q),I=Math.cos(q);return K[0]=w+h*W+y*I,K[1]=H[1],K[2]=u+h*I-y*W,K}},12366:K=>{K.exports=function(K,H,M,q){var w=M[0],u=M[1],y=H[0]-w,h=H[1]-u,W=Math.sin(q),I=Math.cos(q);return K[0]=w+y*I-h*W,K[1]=u+y*W+h*I,K[2]=H[2],K}},12254:K=>{K.exports=function(K,H){return K[0]=Math.round(H[0]),K[1]=Math.round(H[1]),K[2]=Math.round(H[2]),K}},12260:K=>{K.exports=function(K,H,M){return K[0]=H[0]*M,K[1]=H[1]*M,K[2]=H[2]*M,K}},12265:K=>{K.exports=function(K,H,M,q){return K[0]=H[0]+M[0]*q,K[1]=H[1]+M[1]*q,K[2]=H[2]+M[2]*q,K}},12180:K=>{K.exports=function(K,H,M,q){return K[0]=H,K[1]=M,K[2]=q,K}},12295:(K,H,M)=>{K.exports=M(12288)},12324:(K,H,M)=>{K.exports=M(12317)},12288:K=>{K.exports=function(K,H){var M=H[0]-K[0],q=H[1]-K[1],w=H[2]-K[2];return M*M+q*q+w*w}},12317:K=>{K.exports=function(K){var H=K[0],M=K[1],q=K[2];return H*H+M*M+q*q}},12209:(K,H,M)=>{K.exports=M(12200)},12200:K=>{K.exports=function(K,H,M){return K[0]=H[0]-M[0],K[1]=H[1]-M[1],K[2]=H[2]-M[2],K}},12352:K=>{K.exports=function(K,H,M){var q=H[0],w=H[1],u=H[2];return K[0]=q*M[0]+w*M[3]+u*M[6],K[1]=q*M[1]+w*M[4]+u*M[7],K[2]=q*M[2]+w*M[5]+u*M[8],K}},12348:K=>{K.exports=function(K,H,M){var q=H[0],w=H[1],u=H[2],y=M[3]*q+M[7]*w+M[11]*u+M[15];return y=y||1,K[0]=(M[0]*q+M[4]*w+M[8]*u+M[12])/y,K[1]=(M[1]*q+M[5]*w+M[9]*u+M[13])/y,K[2]=(M[2]*q+M[6]*w+M[10]*u+M[14])/y,K}},12354:K=>{K.exports=function(K,H,M){var q=H[0],w=H[1],u=H[2],y=M[0],h=M[1],W=M[2],I=M[3],f=I*q+h*u-W*w,z=I*w+W*q-y*u,G=I*u+y*w-h*q,a=-y*q-h*w-W*u;return K[0]=f*I+a*-y+z*-W-G*-h,K[1]=z*I+a*-h+G*-y-f*-W,K[2]=G*I+a*-W+f*-h-z*-y,K}},13228:K=>{"use strict";K.exports=function(K){for(var H=new Array(K),M=0;M<K;++M)H[M]=M;return H}},13309:K=>{K.exports=function(K){return null!=K&&null!=K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}},13503:(K,H,M)=>{"use strict";M.d(H,{c:()=>q});class q{constructor(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.uz=!1,this.yz=!1,this.qz=30,this.wz=0,this.vz=!1,this.fullscreen=!1,this.Wz=function(K){},this.Iz=function(){},this.Gz=function(){},this.DM=function(){},this.fz=function(K){},this.onFullscreenChanged=function(K){},I((()=>{!function(K,H){K._nowObject=performance||Date,K._lastTick=0,K._renderAccum=0,K._rt=0,K._frameCB=h.bind(null,K),requestAnimationFrame(K._frameCB),H>0&&(K._intervalCB=y.bind(null,K),K._interval=setInterval(K._intervalCB,Math.max(H,1e3/K.qz/2)))}(this,H),function(K,H){if(!H)return;var M=!1,q=!1;document.addEventListener("pointerlockchange",(q=>{M=document.pointerLockElement===H,K.fz(M)})),document.addEventListener("fullscreenchange",(M=>{q=document.fullscreenElement===H,K.onFullscreenChanged(q)})),Object.defineProperty(K,"vz",{get:()=>M,set:K=>{K&&!M?W(H):M&&!K&&function(K){K.exitPointerLock&&K.exitPointerLock()}(document)}}),Object.defineProperty(K,"fullscreen",{get:()=>q,set:K=>{K&&!q?H.requestFullscreen():q&&!K&&document.exitFullscreen()}}),H.addEventListener("click",(w=>{K.uz&&!M&&W(H),K.yz&&!q&&H.requestFullscreen()}));var w=()=>K.DM();if(window.ResizeObserver){new ResizeObserver(w).observe(H)}else window.addEventListener("resize",w)}(this,K),this.Gz()}))}}var w=3,u=20;function y(K){for(var H=1e3/K.qz,M=K._nowObject.now()+u,q=0;K._nowObject.now()>=K._lastTick+H&&K._nowObject.now()<M&&++q<=w;)K.Wz(H),K._lastTick+=H;var y=5*(H+5),h=K._nowObject.now();if(h-K._lastTick>y)for(;h>=K._lastTick+H;)K._lastTick+=H}function h(K){requestAnimationFrame(K._frameCB),y(K);var H=K._nowObject.now(),M=H-K._rt;if(K._rt=H,K.wz>0){K._renderAccum+=M;var q=1e3/K.wz;if(K._renderAccum<q)return;K._renderAccum=Math.min(K._renderAccum-q,q)}var w=1e3/K.qz,u=(H-K._lastTick)/w;K.Iz(M,u,w)}function W(K){K.requestPointerLock&&K.requestPointerLock()}var I=K=>{if("loading"===document.readyState){var H=()=>{document.removeEventListener("readystatechange",H),K()};document.addEventListener("readystatechange",H)}else setTimeout(K,1)}},13222:(K,H,M)=>{var q=M(13228),w=M(13235),u="undefined"!==typeof Float64Array;function y(K,H){return K[0]-H[0]}function h(){var K,H=this.stride,M=new Array(H.length);for(K=0;K<M.length;++K)M[K]=[Math.abs(H[K]),K];M.sort(y);var q=new Array(M.length);for(K=0;K<q.length;++K)q[K]=M[K][1];return q}function W(K,H){var M=["View",H,"d",K].join("");H<0&&(M="View_Nil"+K);var w="generic"===K;if(-1===H){var u="function "+M+"(a){this.data=a;};var proto="+M+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+M+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+M+"(a){return new "+M+"(a);}";return new Function(u)()}if(0===H){u="function "+M+"(a,d) {this.data = a;this.offset = d};var proto="+M+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+M+"_copy() {return new "+M+"(this.data,this.offset)};proto.pick=function "+M+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+M+"_get(){return "+(w?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+M+"_set(v){return "+(w?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+M+"(a,b,c,d){return new "+M+"(a,d)}";return new Function("TrivialArray",u)(I[K][0])}u=["'use strict'"];var y=q(H),W=y.map((function(K){return"i"+K})),f="this.offset+"+y.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),z=y.map((function(K){return"b"+K})).join(","),G=y.map((function(K){return"c"+K})).join(",");u.push("function "+M+"(a,"+z+","+G+",d){this.data=a","this.shape=["+z+"]","this.stride=["+G+"]","this.offset=d|0}","var proto="+M+".prototype","proto.dtype='"+K+"'","proto.dimension="+H),u.push("Object.defineProperty(proto,'size',{get:function "+M+"_size(){return "+y.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===H?u.push("proto.order=[0]"):(u.push("Object.defineProperty(proto,'order',{get:"),H<4?(u.push("function "+M+"_order(){"),2===H?u.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===H&&u.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):u.push("ORDER})")),u.push("proto.set=function "+M+"_set("+W.join(",")+",v){"),w?u.push("return this.data.set("+f+",v)}"):u.push("return this.data["+f+"]=v}"),u.push("proto.get=function "+M+"_get("+W.join(",")+"){"),w?u.push("return this.data.get("+f+")}"):u.push("return this.data["+f+"]}"),u.push("proto.index=function "+M+"_index(",W.join(),"){return "+f+"}"),u.push("proto.hi=function "+M+"_hi("+W.join(",")+"){return new "+M+"(this.data,"+y.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+y.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var a=y.map((function(K){return"a"+K+"=this.shape["+K+"]"})),v=y.map((function(K){return"c"+K+"=this.stride["+K+"]"}));u.push("proto.lo=function "+M+"_lo("+W.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+v.join(","));for(var O=0;O<H;++O)u.push("if(typeof i"+O+"==='number'&&i"+O+">=0){d=i"+O+"|0;b+=c"+O+"*d;a"+O+"-=d}");u.push("return new "+M+"(this.data,"+y.map((function(K){return"a"+K})).join(",")+","+y.map((function(K){return"c"+K})).join(",")+",b)}"),u.push("proto.step=function "+M+"_step("+W.join(",")+"){var "+y.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+y.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(O=0;O<H;++O)u.push("if(typeof i"+O+"==='number'){d=i"+O+"|0;if(d<0){c+=b"+O+"*(a"+O+"-1);a"+O+"=ceil(-a"+O+"/d)}else{a"+O+"=ceil(a"+O+"/d)}b"+O+"*=d}");u.push("return new "+M+"(this.data,"+y.map((function(K){return"a"+K})).join(",")+","+y.map((function(K){return"b"+K})).join(",")+",c)}");var L=new Array(H),S=new Array(H);for(O=0;O<H;++O)L[O]="a[i"+O+"]",S[O]="b[i"+O+"]";u.push("proto.transpose=function "+M+"_transpose("+W+"){"+W.map((function(K,H){return K+"=("+K+"===undefined?"+H+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+M+"(this.data,"+L.join(",")+","+S.join(",")+",this.offset)}"),u.push("proto.pick=function "+M+"_pick("+W+"){var a=[],b=[],c=this.offset");for(O=0;O<H;++O)u.push("if(typeof i"+O+"==='number'&&i"+O+">=0){c=(c+this.stride["+O+"]*i"+O+")|0}else{a.push(this.shape["+O+"]);b.push(this.stride["+O+"])}");return u.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),u.push("return function construct_"+M+"(data,shape,stride,offset){return new "+M+"(data,"+y.map((function(K){return"shape["+K+"]"})).join(",")+","+y.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",u.join("\n"))(I[K],h)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,H,M,q){if(void 0===K)return(0,I.array[0])([]);"number"===typeof K&&(K=[K]),void 0===H&&(H=[K.length]);var y=H.length;if(void 0===M){M=new Array(y);for(var h=y-1,f=1;h>=0;--h)M[h]=f,f*=H[h]}if(void 0===q){q=0;for(h=0;h<y;++h)M[h]<0&&(q-=(H[h]-1)*M[h])}for(var z=function(K){if(w(K))return"buffer";if(u)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),G=I[z];G.length<=y+1;)G.push(W(z,G.length-1));return(0,G[y+1])(K,H,M,q)}},13235:K=>{function H(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(H(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&H(K.slice(0,0))}(K)||!!K._isBuffer)}},13377:K=>{"use strict";var H=[],M=[],q=[],w=[],u=[],y=[],h=[],W=[],I=[],f=[],z=[],G=[];K.exports=function(K,a,v,O,L,S){for(var B=h,C=I,i=f,Z=G,E=0;E<3;E++)B[E]=+v[E],i[E]=+a.max[E],C[E]=+a.base[E];S||(S=1e-10);var l=function(K,h,I,f,G,a){var v=H,O=M,L=q,S=w,B=u,C=y,i=W,Z=Math.floor,E=0,l=0,s=0,D=0,V=0;if(n(),0===s)return 0;for(D=T();l<=s;){if(c(D)&&k())return E;D=T()}for(E+=s,V=0;V<3;V++)f[V]+=I[V],G[V]+=I[V];return E;function n(){if(l=0,0!==(s=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2])))for(var K=0;K<3;K++){var H=I[K]>=0;S[K]=H?1:-1;var M=H?G[K]:f[K];v[K]=H?f[K]:G[K],O[K]=d(M,S[K]),L[K]=x(v[K],S[K]),i[K]=I[K]/s,B[K]=Math.abs(1/i[K]);var q=H?O[K]+1-M:M-O[K];C[K]=B[K]<1/0?B[K]*q:1/0}}function c(H){for(var M=S[0],q=0===H?O[0]:L[0],w=O[0]+M,u=S[1],y=1===H?O[1]:L[1],h=O[1]+u,W=S[2],I=2===H?O[2]:L[2],f=O[2]+W,z=q;z!=w;z+=M)for(var G=y;G!=h;G+=u)for(var a=I;a!=f;a+=W)if(K(z,G,a))return!0;return!1}function k(){E+=l;var K=S[D],H=l/s,M=z;for(V=0;V<3;V++){var q=I[V]*H;f[V]+=q,G[V]+=q,M[V]=I[V]-q}if(K>0?G[D]=Math.round(G[D]):f[D]=Math.round(f[D]),h(E,D,K,M))return!0;for(V=0;V<3;V++)I[V]=M[V];return n(),0===s}function T(){var K=C[0]<C[1]?C[0]<C[2]?0:2:C[1]<C[2]?1:2,H=C[K]-l;for(l=C[K],O[K]+=S[K],C[K]+=B[K],V=0;V<3;V++)v[V]+=H*i[V],L[V]=x(v[V],S[V]);return K}function d(K,H){return Z(K-H*a)}function x(K,H){return Z(K+H*a)}}(K,O,B,C,i,S);if(!L){for(E=0;E<3;E++)Z[E]=v[E]>0?i[E]-a.max[E]:C[E]-a.base[E];a.translate(Z)}return l}},13530:(K,H,M)=>{"use strict";M.d(H,{e:()=>z});var q=M(13374),w=M(12114);class u{constructor(K,H,M,u,y,h,W){this.oI=new q(K.base,K.Mf),this.sq=H,this.friction=M,this.restitution=u,this.ky=y,this.pa=h,this.Ty=!!W,this.Hf=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.lv=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.aI=w.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=w.create(),this._impulses=w.create(),this._sleepFrameCount=10}loadFromCopy(K){w.j(this.oI.base,K.oI.base),w.j(this.oI.Mf,K.oI.Mf),w.j(this.oI.max,K.oI.max),this.oI.mag=K.oI.mag,this.sq=K.sq,this.friction=K.friction,this.restitution=K.restitution,this.ky=K.ky,this.pa=K.pa,this.Ty=K.Ty,this.Hf=K.Hf,this.fluidDrag=K.fluidDrag,this.lv=K.lv,this.preventFallOffEdge=K.preventFallOffEdge,this.rolledBackLastTick=K.rolledBackLastTick,w.j(this.aI,K.aI),w.j(this.resting,K.resting),this.inFluid=K.inFluid,this._ratioInFluid=K._ratioInFluid,w.j(this._forces,K._forces),w.j(this._impulses,K._impulses),this._sleepFrameCount=K._sleepFrameCount}setPosition(K){y(K),w.LH(K,K,this.oI.base),this.oI.translate(K),this.LI()}qq(){return w.clone(this.oI.base)}applyForce(K){y(K),w.add(this._forces,this._forces,K),this.LI()}applyImpulse(K){y(K),w.add(this._impulses,this._impulses,K),this.LI()}LI(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var y=K=>{};var h=M(13374),W=M(12114),I=M(13377);function f(){this.Hf=.1,this.fluidDrag=.4,this.oy=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function z(K,H,M){K=Object.assign(new f,K),this.gravity=K.gravity||[0,-10,0],this.Hf=K.Hf||.1,this.oy=K.oy||2,this.fluidDrag=K.fluidDrag||.4,this.minBounceImpulse=K.minBounceImpulse,this.bodies=[],this.ya=K.ya,this.testSolid=H,this.testFluid=M}z.prototype.Fa=function(K,H,M,q,w,y){K=K||new h([0,0,0],[1,1,1]),"undefined"==typeof H&&(H=1),"undefined"==typeof M&&(M=1),"undefined"==typeof q&&(q=0),"undefined"==typeof w&&(w=1);var W=new u(K,H,M,q,w,y);return this.bodies.push(W),W},z.prototype.Ya=function(K){var H=this.bodies.indexOf(K);H<0||(this.bodies.splice(H,1),K.oI=K.pa=null)};var G=W.create(),a=W.create(),v=W.create(),O=W.create(),L=W.create(),S=W.create(),B=W.create(),C=new h([0,0,0],[1,1,1]),i=new u(C,1,1,0,1,(()=>{}),!1);function Z(K,H,M){return H=M,H*=1-(1-K.ratioInFluid)**2}z.prototype.Ay=function(K){K/=1e3;var H=o(0,W.squaredLength(this.gravity));this.bodies.forEach((M=>function(K,H,M,q){W.j(L,H.resting),K.ya&&i.loadFromCopy(H);if(H.sq<=0)return W.set(H.aI,0,0,0),W.set(H._forces,0,0,0),void W.set(H._impulses,0,0,0);var w=q||0===H.ky;if(function(K,H,M,q){if(H._sleepFrameCount>0)return!1;if(q)return!0;var w=!1,u=.5*M*M*H.ky;return W.scale(p,K.gravity,u),I(K.testSolid,H.oI,p,(function(){return w=!0,!0}),!0),w}(K,H,M,w))return;H._sleepFrameCount--,function(K,H){var M=H.oI,q=Math.floor(M.base[0]),w=Math.floor(M.base[2]),u=Math.floor(M.base[1]),y=Math.floor(M.max[1]);if(!K.testFluid(q,u,w))return H.inFluid=!1,void(H.ratioInFluid=0);var h=1,I=u+1;for(;I<=y&&K.testFluid(q,I,w);)h++,I++;var f=(u+h-M.base[1])/M.Mf[1];f>1&&(f=1);var z=M.Mf[0]*M.Mf[1]*M.Mf[2]*f,G=l;W.scale(G,K.gravity,-K.oy*z*H.ky),H.applyForce(G),H.inFluid=!0,H.ratioInFluid=f}(K,H),t(H._forces),t(H._impulses),t(H.aI),t(H.resting),W.scale(G,H._forces,1/H.sq),W.my(G,G,K.gravity,H.ky),W.scale(a,H._impulses,1/H.sq),W.my(a,a,G,M),W.add(H.aI,H.aI,a),H.friction&&(s(K,0,H,a,M),s(K,1,H,a,M),s(K,2,H,a,M));var u=H.fluidDrag>=0?H.fluidDrag:K.fluidDrag,y=H.Hf>=0?H.Hf:K.Hf,h=y,f=y;H.inFluid&&(h=Z(H,h,H.fluidDragHoriz>=0?H.fluidDragHoriz:u),f=Z(H,f,H.fluidDragVert>=0?H.fluidDragVert:u));h=Math.max(1-h*M/H.sq,0),f=Math.max(1-f*M/H.sq,0),W.set(E,h,f,h),W.multiply(H.aI,H.aI,E),W.scale(v,H.aI,M),W.set(H._forces,0,0,0),W.set(H._impulses,0,0,0),H.Ty&&R(n,H.oI);W.j(S,v),W.set(B,0,0,0),H.preventFallOffEdge&&function(K,H,M,q){if(!H.resting[1]||M[1]>0)return;var w=Q;R(w,H.oI);for(var u=0;u<3;u+=2){W.set(x,0,0,0),x[u]=M[u];var y=!0;(y=(y=(y=(y=y&&!N(K,w.base[0]+x[0]+1e-5,w.base[1],w.base[2]+x[2]+1e-5))&&!N(K,w.max[0]+x[0]-1e-5,w.base[1],w.base[2]+x[2]+1e-5))&&!N(K,w.base[0]+x[0]+1e-5,w.base[1],w.max[2]+x[2]-1e-5))&&!N(K,w.max[0]+x[0]-1e-5,w.base[1],w.max[2]+x[2]-1e-5))?(q[u]=M[u]>0?1:-1,M[u]=0):0===u&&(W.set(J,M[0],0,0),V(K,w,J,q,H.slideOnCollision))}}(K,H,v,B);V(K,H.oI,v,H.resting,H.slideOnCollision),H.Ty&&function(K,H,M,q){if(H.resting[1]>=0&&!H.inFluid)return;var w=0!==H.resting[0],u=0!==H.resting[2];if(!w&&!u)return;var y=Math.abs(q[0]/q[2]),h=4;if(!w&&y>h)return;if(!u&&y<1/h)return;W.add(k,M.base,q);var f=K.testSolid;I(f,M,q,(function(K,H,M,q){if(1!==H)return!0;q[H]=0}));var z=M.base[1],G=H.inFluid?1.951:1.001,a=Math.floor(z+G)-z;W.set(T,0,a,0);var v=!1;if(I(f,M,T,(function(K,H,M,q){return v=!0,!0})),v)return;W.LH(d,k,M.base),d[1]=0,V(K,M,d,c,!0);var O=o(M.base[0],k[0]),L=o(M.base[2],k[2]);if(w&&!O&&(!L||!u))return;if(u&&(!O||!w)&&!L)return;var S=!0;if(S=S&&!N(K,M.base[0]+1e-5,M.base[1],M.base[2]+1e-5),S=S&&!N(K,M.max[0]-1e-5,M.base[1],M.base[2]+1e-5),S=S&&!N(K,M.base[0]+1e-5,M.base[1],M.max[2]-1e-5),S=S&&!N(K,M.max[0]-1e-5,M.base[1],M.max[2]-1e-5),S)return;R(H.oI,M),H.resting[0]=c[0],H.resting[2]=c[2],H.lv&&H.lv()}(K,H,n,S);for(var z=0;z<3;++z)H.resting[z]=H.resting[z]||B[z],O[z]=0,H.resting[z]&&(L[z]||(O[z]=-H.aI[z]),H.aI[z]=0);var C=W.length(O);C>.001&&(W.scale(O,O,H.sq),H.pa&&H.pa(O),H.restitution>0&&C>K.minBounceImpulse&&(W.scale(O,O,H.restitution),H.applyImpulse(O)));var D=W.squaredLength(H.aI);D>1e-5&&H.LI();K.ya&&K.ya(H)?(H.loadFromCopy(i),H.rolledBackLastTick=!0):H.rolledBackLastTick=!1}(this,M,K,H)))};var E=W.create([0,0,0]);var l=W.create();function s(K,H,M,q,w){var u=M.resting[H],y=q[H];if(!M.alwaysApplyHorizFriction||1!==H){if(0===u)return;if(u*y<=0)return}W.j(D,M.aI),D[H]=0;var h=W.length(D);if(!o(h,0)){var I=Math.abs(M.friction*K.gravity[H]*w),f=h>I?(h-I)/h:0;M.aI[(H+1)%3]*=f,M.aI[(H+2)%3]*=f}}var D=W.create();function V(K,H,M,q,w){return W.set(q,0,0,0),I(K.testSolid,H,M,(function(K,H,M,u){q[H]=M,u[H]=0,w||(u[0]=0,u[1]=0,u[2]=0)}))}var n=new h([],[]),c=W.create(),k=W.create(),T=W.create(),d=W.create();var x=W.create(),Q=new h([],[]),J=W.create();function N(K,H,M,q){return K.testSolid(Math.floor(H),Math.floor(M-1),Math.floor(q))}var p=W.create();function o(K,H){return Math.abs(K-H)<1e-5}function R(K,H){for(var M=0;M<3;M++)K.base[M]=H.base[M],K.max[M]=H.max[M],K.Mf[M]=H.Mf[M]}var t=function(K){}},11977:function(K,H){!function(K){"use strict";var H=function(K,M){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,H){K.__proto__=H}||function(K,H){for(var M in H)Object.prototype.hasOwnProperty.call(H,M)&&(K[M]=H[M])},H(K,M)};function M(K,M){if("function"!==typeof M&&null!==M)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function q(){this.constructor=K}H(K,M),K.prototype=null===M?Object.create(M):(q.prototype=M.prototype,new q)}function q(K,H,M,q){var w,u=arguments.length,y=u<3?H:null===q?q=Object.getOwnPropertyDescriptor(H,M):q;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)y=Reflect.decorate(K,H,M,q);else for(var h=K.length-1;h>=0;h--)(w=K[h])&&(y=(u<3?w(y):u>3?w(H,M,y):w(H,M))||y);return u>3&&y&&Object.defineProperty(H,M,y),y}function w(K,H,M){if(M||2===arguments.length)for(var q,w=0,u=H.length;w<u;w++)!q&&w in H||(q||(q=Array.prototype.slice.call(H,0,w)),q[w]=H[w]);return K.concat(q||Array.prototype.slice.call(H))}var u,y=255,h=213;K.OPERATION=void 0,(u=K.OPERATION||(K.OPERATION={}))[u.ADD=128]="ADD",u[u.REPLACE=0]="REPLACE",u[u.DELETE=64]="DELETE",u[u.DELETE_AND_ADD=192]="DELETE_AND_ADD",u[u.TOUCH=1]="TOUCH",u[u.CLEAR=10]="CLEAR";var W=function(){function H(K,H,M){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=K,this.setParent(H,M)}return H.prototype.setParent=function(K,H,M){var q=this;if(this.indexes||(this.indexes=this.ref instanceof dK?this.ref._definition.indexes:{}),this.parent=K,this.parentIndex=M,H)if(this.root=H,this.ref instanceof dK){var w=this.ref._definition;for(var u in w.schema){var y=this.ref[u];if(y&&y.$changes){var h=w.indexes[u];y.$changes.setParent(this.ref,H,h)}}}else"object"===typeof this.ref&&this.ref.forEach((function(K,H){if(K instanceof dK){var M=K.$changes,w=q.ref.$changes.indexes[H];M.setParent(q.ref,q.root,w)}}))},H.prototype.operation=function(K){this.changes.set(--this.currentCustomOperation,K)},H.prototype.change=function(H,M){void 0===M&&(M=K.OPERATION.ADD);var q="number"===typeof H?H:this.indexes[H];this.assertValidIndex(q,H);var w=this.changes.get(q);w&&w.op!==K.OPERATION.DELETE&&w.op!==K.OPERATION.TOUCH||this.changes.set(q,{op:w&&w.op===K.OPERATION.DELETE?K.OPERATION.DELETE_AND_ADD:M,index:q}),this.allChanges.add(q),this.changed=!0,this.touchParents()},H.prototype.touch=function(H){var M="number"===typeof H?H:this.indexes[H];this.assertValidIndex(M,H),this.changes.has(M)||this.changes.set(M,{op:K.OPERATION.TOUCH,index:M}),this.allChanges.add(M),this.touchParents()},H.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},H.prototype.getType=function(K){if(this.ref._definition)return(H=this.ref._definition).schema[H.fieldsByIndex[K]];var H,M=(H=this.parent._definition).schema[H.fieldsByIndex[this.parentIndex]];return Object.values(M)[0]},H.prototype.getChildrenFilter=function(){var K=this.parent._definition.childFilters;return K&&K[this.parentIndex]},H.prototype.getValue=function(K){return this.ref.getByIndex(K)},H.prototype.delete=function(H){var M="number"===typeof H?H:this.indexes[H];if(void 0!==M){var q=this.getValue(M);this.changes.set(M,{op:K.OPERATION.DELETE,index:M}),this.allChanges.delete(M),delete this.caches[M],q&&q.$changes&&(q.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(H," (").concat(M,")"))},H.prototype.discard=function(H,M){var q=this;void 0===H&&(H=!1),void 0===M&&(M=!1),this.ref instanceof dK||this.changes.forEach((function(H){if(H.op===K.OPERATION.DELETE){var M=q.ref.getIndex(H.index);delete q.indexes[M]}})),this.changes.clear(),this.changed=H,M&&this.allChanges.clear(),this.currentCustomOperation=0},H.prototype.discardAll=function(){var K=this;this.changes.forEach((function(H){var M=K.getValue(H.index);M&&M.$changes&&M.$changes.discardAll()})),this.discard()},H.prototype.cache=function(K,H){this.caches[K]=H},H.prototype.clone=function(){return new H(this.ref,this.parent,this.root)},H.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},H.prototype.assertValidIndex=function(K,H){if(void 0===K)throw new Error('ChangeTree: missing index for field "'.concat(H,'"'))},H}();function I(K,H,M,q){return K[H]||(K[H]=[]),K[H].push(M),null===q||void 0===q||q.forEach((function(K,H){return M(K,H)})),function(){return z(K[H],K[H].indexOf(M))}}function f(H){var M=this,q="string"!==typeof this.$changes.getType();this.$items.forEach((function(w,u){H.push({refId:M.$changes.refId,op:K.OPERATION.DELETE,field:u,value:void 0,previousValue:w}),q&&M.$changes.root.removeRef(w.$changes.refId)}))}function z(K,H){if(-1===H||H>=K.length)return!1;for(var M=K.length-1,q=H;q<M;q++)K[q]=K[q+1];return K.length=M,!0}var G=function(K,H){var M=K.toString(),q=H.toString();return M<q?-1:M>q?1:0};function a(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,H){return"symbol"===typeof H||isNaN(H)?K[H]:K.at(H)},set:function(K,H,M){if("symbol"===typeof H||isNaN(H))K[H]=M;else{var q=Array.from(K.$items.keys()),w=parseInt(q[H]||H);void 0===M||null===M?K.deleteAt(w):K.setAt(w,M)}return!0},deleteProperty:function(K,H){return"number"===typeof H?K.deleteAt(H):delete K[H],!0}})}var v=function(){function H(){for(var K=[],H=0;H<arguments.length;H++)K[H]=arguments[H];this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,K)}return H.prototype.Qh=function(H,M){return void 0===M&&(M=!0),I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,H,M?this.$items:void 0)},H.prototype.CM=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,H)},H.is=function(K){return Array.isArray(K)||void 0!==K.array},Object.defineProperty(H.prototype,"length",{get:function(){return this.$items.size},set:function(K){0===K?this.clear():this.splice(K,this.length-K)},enumerable:!1,configurable:!0}),H.prototype.push=function(){for(var K,H=this,M=[],q=0;q<arguments.length;q++)M[q]=arguments[q];return M.forEach((function(M){K=H.$refId++,H.setAt(K,M)})),K},H.prototype.pop=function(){var K=Array.from(this.$indexes.values()).pop();if(void 0!==K){this.$changes.delete(K),this.$indexes.delete(K);var H=this.$items.get(K);return this.$items.delete(K),H}},H.prototype.at=function(K){var H=Array.from(this.$items.keys())[K];return this.$items.get(H)},H.prototype.setAt=function(H,M){var q,w;if(void 0!==M&&null!==M){if(this.$items.get(H)!==M){void 0!==M.$changes&&M.$changes.setParent(this,this.$changes.root,H);var u=null!==(w=null===(q=this.$changes.indexes[H])||void 0===q?void 0:q.op)&&void 0!==w?w:K.OPERATION.ADD;this.$changes.indexes[H]=H,this.$indexes.set(H,H),this.$items.set(H,M),this.$changes.change(H,u)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},H.prototype.deleteAt=function(K){var H=Array.from(this.$items.keys())[K];return void 0!==H&&this.$deleteAt(H)},H.prototype.$deleteAt=function(K){return this.$changes.delete(K),this.$indexes.delete(K),this.$items.delete(K)},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&f.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.concat=function(){for(var K,M=[],q=0;q<arguments.length;q++)M[q]=arguments[q];return new(H.bind.apply(H,w([void 0],(K=Array.from(this.$items.values())).concat.apply(K,M),!1)))},H.prototype.join=function(K){return Array.from(this.$items.values()).join(K)},H.prototype.reverse=function(){var K=this,H=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(M,q){K.setAt(H[q],M)})),this},H.prototype.shift=function(){var K=Array.from(this.$items.keys()).shift();if(void 0!==K){var H=this.$items.get(K);return this.$deleteAt(K),H}},H.prototype.slice=function(K,M){var q=new H;return q.push.apply(q,Array.from(this.$items.values()).slice(K,M)),q},H.prototype.sort=function(K){var H=this;void 0===K&&(K=G);var M=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(K).forEach((function(K,q){H.setAt(M[q],K)})),this},H.prototype.splice=function(K,H){void 0===H&&(H=this.length-K);for(var M=Array.from(this.$items.keys()),q=[],w=K;w<K+H;w++)q.push(this.$items.get(M[w])),this.$deleteAt(M[w]);return q},H.prototype.unshift=function(){for(var K=this,H=[],M=0;M<arguments.length;M++)H[M]=arguments[M];var q=this.length,w=H.length,u=Array.from(this.$items.values());return H.forEach((function(H,M){K.setAt(M,H)})),u.forEach((function(H,M){K.setAt(w+M,H)})),q+w},H.prototype.indexOf=function(K,H){return Array.from(this.$items.values()).indexOf(K,H)},H.prototype.lastIndexOf=function(K,H){return void 0===H&&(H=this.length-1),Array.from(this.$items.values()).lastIndexOf(K,H)},H.prototype.every=function(K,H){return Array.from(this.$items.values()).every(K,H)},H.prototype.some=function(K,H){return Array.from(this.$items.values()).some(K,H)},H.prototype.forEach=function(K,H){Array.from(this.$items.values()).forEach(K,H)},H.prototype.map=function(K,H){return Array.from(this.$items.values()).map(K,H)},H.prototype.filter=function(K,H){return Array.from(this.$items.values()).filter(K,H)},H.prototype.reduce=function(K,H){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},H.prototype.reduceRight=function(K,H){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},H.prototype.find=function(K,H){return Array.from(this.$items.values()).find(K,H)},H.prototype.findIndex=function(K,H){return Array.from(this.$items.values()).findIndex(K,H)},H.prototype.fill=function(K,H,M){throw new Error("ArraySchema#fill() not implemented")},H.prototype.copyWithin=function(K,H,M){throw new Error("ArraySchema#copyWithin() not implemented")},H.prototype.toString=function(){return this.$items.toString()},H.prototype.toLocaleString=function(){return this.$items.toLocaleString()},H.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(H,Symbol.species,{get:function(){return H},enumerable:!1,configurable:!0}),H.prototype.entries=function(){return this.$items.entries()},H.prototype.keys=function(){return this.$items.keys()},H.prototype.values=function(){return this.$items.values()},H.prototype.includes=function(K,H){return Array.from(this.$items.values()).includes(K,H)},H.prototype.flatMap=function(K,H){throw new Error("ArraySchema#flatMap() is not supported.")},H.prototype.flat=function(K){throw new Error("ArraySchema#flat() is not supported.")},H.prototype.findLast=function(){var K=Array.from(this.$items.values());return K.findLast.apply(K,arguments)},H.prototype.findLastIndex=function(){var K=Array.from(this.$items.values());return K.findLastIndex.apply(K,arguments)},H.prototype.setIndex=function(K,H){this.$indexes.set(K,H)},H.prototype.getIndex=function(K){return this.$indexes.get(K)},H.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},H.prototype.deleteByIndex=function(K){var H=this.$indexes.get(K);this.$items.delete(H),this.$indexes.delete(K)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){return this.toArray().map((function(K){return"function"===typeof K.toJSON?K.toJSON():K}))},H.prototype.clone=function(K){return K?new(H.bind.apply(H,w([void 0],Array.from(this.$items.values()),!1))):new(H.bind.apply(H,w([void 0],this.map((function(K){return K.$changes?K.clone():K})),!1)))},H}();function O(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,H){return"symbol"!==typeof H&&"undefined"===typeof K[H]?K.get(H):K[H]},set:function(K,H,M){return"symbol"!==typeof H&&-1===H.indexOf("$")&&"Qh"!==H&&"CM"!==H&&"onChange"!==H?K.set(H,M):K[H]=M,!0},deleteProperty:function(K,H){return K.delete(H),!0}})}var L=function(){function H(K){var M=this;if(this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K)if(K instanceof Map||K instanceof H)K.forEach((function(K,H){return M.set(H,K)}));else for(var q in K)this.set(q,K[q])}return H.prototype.Qh=function(H,M){return void 0===M&&(M=!0),I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,H,M?this.$items:void 0)},H.prototype.CM=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,H)},H.is=function(K){return void 0!==K.map},H.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(H.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(H,Symbol.species,{get:function(){return H},enumerable:!1,configurable:!0}),H.prototype.set=function(H,M){if(void 0===M||null===M)throw new Error("MapSchema#set('".concat(H,"', ").concat(M,"): trying to set ").concat(M," value on '").concat(H,"'."));H=H.toString();var q="undefined"!==typeof this.$changes.indexes[H],w=q?this.$changes.indexes[H]:this.$refId++,u=q?K.OPERATION.REPLACE:K.OPERATION.ADD,y=void 0!==M.$changes;if(y&&M.$changes.setParent(this,this.$changes.root,w),q){if(!y&&this.$items.get(H)===M)return;y&&this.$items.get(H)!==M&&(u=K.OPERATION.ADD)}else this.$changes.indexes[H]=w,this.$indexes.set(w,H);return this.$items.set(H,M),this.$changes.change(H,u),this},H.prototype.get=function(K){return this.$items.get(K)},H.prototype.delete=function(K){return this.$changes.delete(K),this.$items.delete(K)},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&f.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(K){return this.$items.has(K)},H.prototype.forEach=function(K){this.$items.forEach(K)},H.prototype.entries=function(){return this.$items.entries()},H.prototype.keys=function(){return this.$items.keys()},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(K,H){this.$indexes.set(K,H)},H.prototype.getIndex=function(K){return this.$indexes.get(K)},H.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},H.prototype.deleteByIndex=function(K){var H=this.$indexes.get(K);this.$items.delete(H),this.$indexes.delete(K)},H.prototype.toJSON=function(){var K={};return this.forEach((function(H,M){K[M]="function"===typeof H.toJSON?H.toJSON():H})),K},H.prototype.clone=function(K){var M;return K?M=Object.assign(new H,this):(M=new H,this.forEach((function(K,H){K.$changes?M.set(H,K.clone()):M.set(H,K)}))),M},H}(),S={};function B(K,H){S[K]=H}function C(K){return S[K]}var i=function(){function K(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return K.create=function(H){var M=new K;return M.schema=Object.assign({},H&&H.schema||{}),M.indexes=Object.assign({},H&&H.indexes||{}),M.fieldsByIndex=Object.assign({},H&&H.fieldsByIndex||{}),M.descriptors=Object.assign({},H&&H.descriptors||{}),M.deprecated=Object.assign({},H&&H.deprecated||{}),M},K.prototype.addField=function(K,H){var M=this.getNextFieldIndex();this.fieldsByIndex[M]=K,this.indexes[K]=M,this.schema[K]=Array.isArray(H)?{array:H[0]}:H},K.prototype.hasField=function(K){return void 0!==this.indexes[K]},K.prototype.addFilter=function(K,H){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[K]]=H,this.indexesWithFilters.push(this.indexes[K]),!0},K.prototype.addChildrenFilter=function(K,H){var M=this.indexes[K],q=this.schema[K];if(C(Object.keys(q)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[M]=H,!0;console.warn("@filterChildren: field '".concat(K,"' can't have children. Ignoring filter."))},K.prototype.getChildrenFilter=function(K){return this.childFilters&&this.childFilters[this.indexes[K]]},K.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},K}();function Z(K){return K._context&&K._context.useFilters}var E=function(){function K(){this.types={},this.schemas=new Map,this.useFilters=!1}return K.prototype.has=function(K){return this.schemas.has(K)},K.prototype.get=function(K){return this.types[K]},K.prototype.add=function(K,H){void 0===H&&(H=this.schemas.size),K._definition=i.create(K._definition),K._typeid=H,this.types[H]=K,this.schemas.set(K,H)},K.create=function(H){return void 0===H&&(H={}),function(M){return H.context||(H.context=new K),s(M,H)}},K}(),l=new E;function s(K,H){return void 0===H&&(H={}),function(M,q){var u=H.context||l,y=M.constructor;if(y._context=u,!K)throw new Error("".concat(y.name,': @type() reference provided for "').concat(q,"\" is undefined. Make sure you don't have any circular dependencies."));u.has(y)||u.add(y);var h=y._definition;if(h.addField(q,K),h.descriptors[q]){if(h.deprecated[q])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(q,"' definition on '").concat(y.name,"'.\nCheck @type() annotation"))}catch(S){var W=S.stack.split("\n")[4].trim();throw new Error("".concat(S.message," ").concat(W))}}var I=v.is(K),f=!I&&L.is(K);if("string"!==typeof K&&!dK.is(K)){var z=Object.values(K)[0];"string"===typeof z||u.has(z)||u.add(z)}if(H.manual)h.descriptors[q]={enumerable:!0,configurable:!0,writable:!0};else{var G="_".concat(q);h.descriptors[G]={enumerable:!1,configurable:!1,writable:!0},h.descriptors[q]={get:function(){return this[G]},set:function(K){K!==this[G]&&(void 0!==K&&null!==K?(!I||K instanceof v||(K=new(v.bind.apply(v,w([void 0],K,!1)))),!f||K instanceof L||(K=new L(K)),void 0===K.$proxy&&(f?K=O(K):I&&(K=a(K))),this.$changes.change(q),K.$changes&&K.$changes.setParent(this,this.$changes.root,this._definition.indexes[q])):this[G]&&this.$changes.delete(q),this[G]=K)},enumerable:!0,configurable:!0}}}}function D(K){return function(H,M){var q=H.constructor;q._definition.addFilter(M,K)&&(q._context.useFilters=!0)}}function V(K){return function(H,M){var q=H.constructor;q._definition.addChildrenFilter(M,K)&&(q._context.useFilters=!0)}}function n(K){return void 0===K&&(K=!0),function(H,M){var q=H.constructor._definition;q.deprecated[M]=!0,K&&(q.descriptors[M]={get:function(){throw new Error("".concat(M," is deprecated."))},set:function(K){},enumerable:!1,configurable:!0})}}function c(K,H,M){for(var q in void 0===M&&(M={}),M.context||(M.context=K._context||M.context||l),H)s(H[q],M)(K.prototype,q);return K}function k(K){for(var H=0,M=0,q=0,w=K.length;q<w;q++)(H=K.charCodeAt(q))<128?M+=1:H<2048?M+=2:H<55296||H>=57344?M+=3:(q++,M+=4);return M}function T(K,H,M){for(var q=0,w=0,u=M.length;w<u;w++)(q=M.charCodeAt(w))<128?K[H++]=q:q<2048?(K[H++]=192|q>>6,K[H++]=128|63&q):q<55296||q>=57344?(K[H++]=224|q>>12,K[H++]=128|q>>6&63,K[H++]=128|63&q):(w++,q=65536+((1023&q)<<10|1023&M.charCodeAt(w)),K[H++]=240|q>>18,K[H++]=128|q>>12&63,K[H++]=128|q>>6&63,K[H++]=128|63&q)}function d(K,H){K.push(255&H)}function x(K,H){K.push(255&H)}function Q(K,H){K.push(255&H),K.push(H>>8&255)}function J(K,H){K.push(255&H),K.push(H>>8&255)}function N(K,H){K.push(255&H),K.push(H>>8&255),K.push(H>>16&255),K.push(H>>24&255)}function p(K,H){var M=H>>24,q=H>>16,w=H>>8,u=H;K.push(255&u),K.push(255&w),K.push(255&q),K.push(255&M)}function o(K,H){var M=Math.floor(H/Math.pow(2,32));p(K,H>>>0),p(K,M)}function R(K,H){var M=H/Math.pow(2,32)|0;p(K,H>>>0),p(K,M)}function t(K,H){Y(K,H)}function U(K,H){r(K,H)}var j=new Int32Array(2),m=new Float32Array(j.buffer),F=new Float64Array(j.buffer);function Y(K,H){m[0]=H,N(K,j[0])}function r(K,H){F[0]=H,N(K,j[0]),N(K,j[1])}function e(K,H){return x(K,H?1:0)}function b(K,H){H||(H="");var M=k(H),q=0;if(M<32)K.push(160|M),q=1;else if(M<256)K.push(217),x(K,M),q=2;else if(M<65536)K.push(218),J(K,M),q=3;else{if(!(M<4294967296))throw new Error("String too long");K.push(219),p(K,M),q=5}return T(K,K.length,H),q+M}function P(K,H){return isNaN(H)?P(K,0):isFinite(H)?H!==(0|H)?(K.push(203),r(K,H),9):H>=0?H<128?(x(K,H),1):H<256?(K.push(204),x(K,H),2):H<65536?(K.push(205),J(K,H),3):H<4294967296?(K.push(206),p(K,H),5):(K.push(207),R(K,H),9):H>=-32?(K.push(224|H+32),1):H>=-128?(K.push(208),d(K,H),2):H>=-32768?(K.push(209),Q(K,H),3):H>=-2147483648?(K.push(210),N(K,H),5):(K.push(211),o(K,H),9):P(K,H>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var g=Object.freeze({__proto__:null,utf8Write:T,int8:d,uint8:x,int16:Q,uint16:J,int32:N,uint32:p,int64:o,uint64:R,float32:t,float64:U,writeFloat32:Y,writeFloat64:r,boolean:e,string:b,number:P});function X(K,H,M){for(var q="",w=0,u=H,y=H+M;u<y;u++){var h=K[u];0!==(128&h)?192!==(224&h)?224!==(240&h)?240!==(248&h)?console.error("Invalid byte "+h.toString(16)):(w=(7&h)<<18|(63&K[++u])<<12|(63&K[++u])<<6|63&K[++u])>=65536?(w-=65536,q+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):q+=String.fromCharCode(w):q+=String.fromCharCode((15&h)<<12|(63&K[++u])<<6|63&K[++u]):q+=String.fromCharCode((31&h)<<6|63&K[++u]):q+=String.fromCharCode(h)}return q}function A(K,H){return KK(K,H)<<24>>24}function KK(K,H){return K[H.offset++]}function HK(K,H){return MK(K,H)<<16>>16}function MK(K,H){return K[H.offset++]|K[H.offset++]<<8}function qK(K,H){return K[H.offset++]|K[H.offset++]<<8|K[H.offset++]<<16|K[H.offset++]<<24}function wK(K,H){return qK(K,H)>>>0}function uK(K,H){return GK(K,H)}function yK(K,H){return aK(K,H)}function hK(K,H){var M=wK(K,H);return qK(K,H)*Math.pow(2,32)+M}function WK(K,H){var M=wK(K,H);return wK(K,H)*Math.pow(2,32)+M}var IK=new Int32Array(2),fK=new Float32Array(IK.buffer),zK=new Float64Array(IK.buffer);function GK(K,H){return IK[0]=qK(K,H),fK[0]}function aK(K,H){return IK[0]=qK(K,H),IK[1]=qK(K,H),zK[0]}function vK(K,H){return KK(K,H)>0}function OK(K,H){var M,q=K[H.offset++];q<192?M=31&q:217===q?M=KK(K,H):218===q?M=MK(K,H):219===q&&(M=wK(K,H));var w=X(K,H.offset,M);return H.offset+=M,w}function LK(K,H){var M=K[H.offset];return M<192&&M>160||217===M||218===M||219===M}function SK(K,H){var M=K[H.offset++];return M<128?M:202===M?GK(K,H):203===M?aK(K,H):204===M?KK(K,H):205===M?MK(K,H):206===M?wK(K,H):207===M?WK(K,H):208===M?A(K,H):209===M?HK(K,H):210===M?qK(K,H):211===M?hK(K,H):M>223?-1*(255-M+1):void 0}function BK(K,H){var M=K[H.offset];return M<128||M>=202&&M<=211}function CK(K,H){return K[H.offset]<160}function iK(K,H){return K[H.offset-1]===y&&(K[H.offset]<128||K[H.offset]>=202&&K[H.offset]<=211)}var ZK=Object.freeze({__proto__:null,int8:A,uint8:KK,int16:HK,uint16:MK,int32:qK,uint32:wK,float32:uK,float64:yK,int64:hK,uint64:WK,readFloat32:GK,readFloat64:aK,boolean:vK,string:OK,stringCheck:LK,number:SK,numberCheck:BK,arrayCheck:CK,switchStructureCheck:iK}),EK=function(){function H(K){var H=this;this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return H.add(K)}))}return H.prototype.Qh=function(H,M){return void 0===M&&(M=!0),I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,H,M?this.$items:void 0)},H.prototype.CM=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,H)},H.is=function(K){return void 0!==K.collection},H.prototype.add=function(K){var H=this.$refId++;return void 0!==K.$changes&&K.$changes.setParent(this,this.$changes.root,H),this.$changes.indexes[H]=H,this.$indexes.set(H,H),this.$items.set(H,K),this.$changes.change(H),H},H.prototype.at=function(K){var H=Array.from(this.$items.keys())[K];return this.$items.get(H)},H.prototype.entries=function(){return this.$items.entries()},H.prototype.delete=function(K){for(var H,M,q=this.$items.entries();(M=q.next())&&!M.done;)if(K===M.value[1]){H=M.value[0];break}return void 0!==H&&(this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H))},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&f.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(K){return Array.from(this.$items.values()).some((function(H){return H===K}))},H.prototype.forEach=function(K){var H=this;this.$items.forEach((function(M,q,w){return K(M,q,H)}))},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(K,H){this.$indexes.set(K,H)},H.prototype.getIndex=function(K){return this.$indexes.get(K)},H.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},H.prototype.deleteByIndex=function(K){var H=this.$indexes.get(K);this.$items.delete(H),this.$indexes.delete(K)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){var K=[];return this.forEach((function(H,M){K.push("function"===typeof H.toJSON?H.toJSON():H)})),K},H.prototype.clone=function(K){var M;return K?M=Object.assign(new H,this):(M=new H,this.forEach((function(K){K.$changes?M.add(K.clone()):M.add(K)}))),M},H}(),lK=function(){function H(K){var H=this;this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return H.add(K)}))}return H.prototype.Qh=function(H,M){return void 0===M&&(M=!0),I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,H,M?this.$items:void 0)},H.prototype.CM=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,H)},H.prototype.onChange=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,H)},H.is=function(K){return void 0!==K.set},H.prototype.add=function(H){var M,q;if(this.has(H))return!1;var w=this.$refId++;void 0!==H.$changes&&H.$changes.setParent(this,this.$changes.root,w);var u=null!==(q=null===(M=this.$changes.indexes[w])||void 0===M?void 0:M.op)&&void 0!==q?q:K.OPERATION.ADD;return this.$changes.indexes[w]=w,this.$indexes.set(w,w),this.$items.set(w,H),this.$changes.change(w,u),w},H.prototype.entries=function(){return this.$items.entries()},H.prototype.delete=function(K){for(var H,M,q=this.$items.entries();(M=q.next())&&!M.done;)if(K===M.value[1]){H=M.value[0];break}return void 0!==H&&(this.$changes.delete(H),this.$indexes.delete(H),this.$items.delete(H))},H.prototype.clear=function(H){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),H&&f.call(this,H),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},H.prototype.has=function(K){for(var H,M=this.$items.values(),q=!1;(H=M.next())&&!H.done;)if(K===H.value){q=!0;break}return q},H.prototype.forEach=function(K){var H=this;this.$items.forEach((function(M,q,w){return K(M,q,H)}))},H.prototype.values=function(){return this.$items.values()},Object.defineProperty(H.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),H.prototype.setIndex=function(K,H){this.$indexes.set(K,H)},H.prototype.getIndex=function(K){return this.$indexes.get(K)},H.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},H.prototype.deleteByIndex=function(K){var H=this.$indexes.get(K);this.$items.delete(H),this.$indexes.delete(K)},H.prototype.toArray=function(){return Array.from(this.$items.values())},H.prototype.toJSON=function(){var K=[];return this.forEach((function(H,M){K.push("function"===typeof H.toJSON?H.toJSON():H)})),K},H.prototype.clone=function(K){var M;return K?M=Object.assign(new H,this):(M=new H,this.forEach((function(K){K.$changes?M.add(K.clone()):M.add(K)}))),M},H}(),sK=function(){function K(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return K.prototype.addRefId=function(K){this.refIds.has(K)||(this.refIds.add(K),this.containerIndexes.set(K,new Set))},K.get=function(H){return void 0===H.$filterState&&(H.$filterState=new K),H.$filterState},K}(),DK=function(){function K(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return K.prototype.getNextUniqueId=function(){return this.nextUniqueId++},K.prototype.addRef=function(K,H,M){void 0===M&&(M=!0),this.refs.set(K,H),M&&(this.refCounts[K]=(this.refCounts[K]||0)+1)},K.prototype.removeRef=function(K){this.refCounts[K]=this.refCounts[K]-1,this.deletedRefs.add(K)},K.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},K.prototype.garbageCollectDeletedRefs=function(){var K=this;this.deletedRefs.forEach((function(H){if(!(K.refCounts[H]>0)){var M=K.refs.get(H);if(M instanceof dK)for(var q in M._definition.schema)"string"!==typeof M._definition.schema[q]&&M[q]&&M[q].$changes&&K.removeRef(M[q].$changes.refId);else{var w=M.$changes.parent._definition,u=w.schema[w.fieldsByIndex[M.$changes.parentIndex]];"function"===typeof Object.values(u)[0]&&Array.from(M.values()).forEach((function(H){return K.removeRef(H.$changes.refId)}))}K.refs.delete(H),delete K.refCounts[H]}})),this.deletedRefs.clear()},K}(),VK=function(K){function H(){return null!==K&&K.apply(this,arguments)||this}return M(H,K),H}(Error);function nK(K,H,M,q){var w,u=!1;switch(H){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":w="number",isNaN(K)&&console.log('trying to encode "NaN" in '.concat(M.constructor.name,"#").concat(q));break;case"string":w="string",u=!0;break;case"boolean":return}if(typeof K!==w&&(!u||u&&null!==K)){var y="'".concat(JSON.stringify(K),"'").concat(K&&K.constructor&&" (".concat(K.constructor.name,")")||"");throw new VK("a '".concat(w,"' was expected, but ").concat(y," was provided in ").concat(M.constructor.name,"#").concat(q))}}function cK(K,H,M,q){if(!(K instanceof H))throw new VK("a '".concat(H.name,"' was expected, but '").concat(K.constructor.name,"' was provided in ").concat(M.constructor.name,"#").concat(q))}function kK(K,H,M,q,w){nK(M,K,q,w);var u=g[K];if(!u)throw new VK("a '".concat(K,"' was expected, but ").concat(M," was provided in ").concat(q.constructor.name,"#").concat(w));u(H,M)}function TK(K,H,M){return ZK[K](H,M)}var dK=function(){function H(){for(var K=[],H=0;H<arguments.length;H++)K[H]=arguments[H];Object.defineProperties(this,{$changes:{value:new W(this,void 0,new DK),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var M=this._definition.descriptors;M&&Object.defineProperties(this,M),K[0]&&this.assign(K[0])}return H.onError=function(K){console.error(K)},H.is=function(K){return K._definition&&void 0!==K._definition.schema},H.prototype.onChange=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,H)},H.prototype.CM=function(H){return I(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,H)},H.prototype.assign=function(K){return Object.assign(this,K),this},Object.defineProperty(H.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),H.prototype.setDirty=function(K,H){this.$changes.change(K,H)},H.prototype.listen=function(K,H,M){var q=this;return void 0===M&&(M=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[K]||(this.$callbacks[K]=[]),this.$callbacks[K].push(H),M&&void 0!==this[K]&&H(this[K],void 0),function(){return z(q.$callbacks[K],q.$callbacks[K].indexOf(H))}},H.prototype.decode=function(M,q,w){var u;void 0===q&&(q={offset:0}),void 0===w&&(w=this);var h=[],W=this.$changes.root,I=M.length,f=0;for(W.refs.set(f,this);q.offset<I;){var z=M[q.offset++];if(z!=y){var G=w.$changes,a=void 0!==w._definition,O=a?z>>6<<6:z;if(O!==K.OPERATION.CLEAR){var S=a?z%(O||255):SK(M,q),B=a?w._definition.fieldsByIndex[S]:"",i=G.getType(S),Z=void 0,E=void 0,l=void 0;if(a?E=w["_".concat(B)]:(E=w.getByIndex(S),(O&K.OPERATION.ADD)===K.OPERATION.ADD?(l=w instanceof L?OK(M,q):S,w.setIndex(S,l)):l=w.getIndex(S)),(O&K.OPERATION.DELETE)===K.OPERATION.DELETE&&(O!==K.OPERATION.DELETE_AND_ADD&&w.deleteByIndex(S),E&&E.$changes&&W.removeRef(E.$changes.refId),Z=null),void 0!==B){if(O===K.OPERATION.DELETE);else if(H.is(i)){var s=SK(M,q);if(Z=W.refs.get(s),O!==K.OPERATION.REPLACE){var D=this.getSchemaType(M,q,i);Z||((Z=this.createTypeInstance(D)).$changes.refId=s,E&&(Z.$callbacks=E.$callbacks,E.$changes.refId&&s!==E.$changes.refId&&W.removeRef(E.$changes.refId))),W.addRef(s,Z,Z!==E)}}else if("string"===typeof i)Z=TK(i,M,q);else{var V=C(Object.keys(i)[0]),n=SK(M,q),c=W.refs.has(n)?E||W.refs.get(n):new V.constructor;if((Z=c.clone(!0)).$changes.refId=n,E&&(Z.$callbacks=E.$callbacks,E.$changes.refId&&n!==E.$changes.refId)){W.removeRef(E.$changes.refId);for(var k=E.entries(),T=void 0;(T=k.next())&&!T.done;){var d=(u=T.value)[0],x=u[1];h.push({refId:n,op:K.OPERATION.DELETE,field:d,value:void 0,previousValue:x})}}W.addRef(n,Z,c!==E)}if(null!==Z&&void 0!==Z)if(Z.$changes&&Z.$changes.setParent(G.ref,G.root,S),w instanceof H)w[B]=Z;else if(w instanceof L)d=l,w.$items.set(d,Z),w.$changes.allChanges.add(S);else if(w instanceof v)w.setAt(S,Z);else if(w instanceof EK){var Q=w.add(Z);w.setIndex(S,Q)}else w instanceof lK&&!1!==(Q=w.add(Z))&&w.setIndex(S,Q);E!==Z&&h.push({refId:f,op:O,field:B,dynamicIndex:l,value:Z,previousValue:E})}else{console.warn("@colyseus/schema: definition mismatch");for(var J={offset:q.offset};q.offset<I&&(!iK(M,q)||(J.offset=q.offset+1,!W.refs.has(SK(M,J))));)q.offset++}}else w.clear(h)}else{f=SK(M,q);var N=W.refs.get(f);if(!N)throw new Error('"refId" not found: '.concat(f));w=N}}return this._triggerChanges(h),W.garbageCollectDeletedRefs(),h},H.prototype.encode=function(M,q,w){void 0===M&&(M=!1),void 0===q&&(q=[]),void 0===w&&(w=!1);for(var u=this.$changes,h=new WeakSet,W=[u],I=1,f=0;f<I;f++){var z=W[f],G=z.ref,a=G instanceof H;z.ensureRefId(),h.add(z),z!==u&&(z.changed||M)&&(x(q,y),P(q,z.refId));for(var v=M?Array.from(z.allChanges):Array.from(z.changes.values()),O=0,S=v.length;O<S;O++){var B=M?{op:K.OPERATION.ADD,index:v[O]}:v[O],i=B.index,Z=a?G._definition.fieldsByIndex&&G._definition.fieldsByIndex[i]:i,E=q.length;if(B.op!==K.OPERATION.TOUCH)if(a)x(q,i|B.op);else{if(x(q,B.op),B.op===K.OPERATION.CLEAR)continue;P(q,i)}if(a||(B.op&K.OPERATION.ADD)!=K.OPERATION.ADD||G instanceof L&&b(q,z.ref.$indexes.get(i)),B.op!==K.OPERATION.DELETE){var l=z.getType(i),s=z.getValue(i);if(s&&s.$changes&&!h.has(s.$changes)&&(W.push(s.$changes),s.$changes.ensureRefId(),I++),B.op!==K.OPERATION.TOUCH){if(H.is(l))cK(s,l,G,Z),P(q,s.$changes.refId),(B.op&K.OPERATION.ADD)===K.OPERATION.ADD&&this.tryEncodeTypeId(q,l,s.constructor);else if("string"===typeof l)kK(l,q,s,G,Z);else{var D=C(Object.keys(l)[0]);cK(G["_".concat(Z)],D.constructor,G,Z),P(q,s.$changes.refId)}w&&z.cache(i,q.slice(E))}}}M||w||z.discard()}return q},H.prototype.encodeAll=function(K){return this.encode(!0,[],K)},H.prototype.applyFilters=function(M,q){var w,u;void 0===q&&(q=!1);for(var h=this,W=new Set,I=sK.get(M),f=[this.$changes],z=1,G=[],a=function(a){var v=f[a];if(W.has(v.refId))return"continue";var O=v.ref,S=O instanceof H;x(G,y),P(G,v.refId);var B=I.refIds.has(v),C=q||!B;I.addRefId(v);var i=I.containerIndexes.get(v),Z=C?Array.from(v.allChanges):Array.from(v.changes.values());!q&&S&&O._definition.indexesWithFilters&&O._definition.indexesWithFilters.forEach((function(H){!i.has(H)&&v.allChanges.has(H)&&(C?Z.push(H):Z.push({op:K.OPERATION.ADD,index:H}))}));for(var E=0,l=Z.length;E<l;E++){var s=C?{op:K.OPERATION.ADD,index:Z[E]}:Z[E];if(s.op!==K.OPERATION.CLEAR){var D=s.index;if(s.op!==K.OPERATION.DELETE){var V=v.getValue(D),n=v.getType(D);if(S){if((c=O._definition.filters&&O._definition.filters[D])&&!c.call(O,M,V,h)){V&&V.$changes&&W.add(V.$changes.refId);continue}}else{var c,k=v.parent;if((c=v.getChildrenFilter())&&!c.call(k,M,O.$indexes.get(D),V,h)){V&&V.$changes&&W.add(V.$changes.refId);continue}}if(V.$changes&&(f.push(V.$changes),z++),s.op!==K.OPERATION.TOUCH)if(s.op===K.OPERATION.ADD||S)G.push.apply(G,null!==(w=v.caches[D])&&void 0!==w?w:[]),i.add(D);else if(i.has(D))G.push.apply(G,null!==(u=v.caches[D])&&void 0!==u?u:[]);else{if(i.add(D),x(G,K.OPERATION.ADD),P(G,D),O instanceof L){var T=v.ref.$indexes.get(D);b(G,T)}V.$changes?P(G,V.$changes.refId):g[n](G,V)}else V.$changes&&!S&&(x(G,K.OPERATION.ADD),P(G,D),O instanceof L&&(T=v.ref.$indexes.get(D),b(G,T)),P(G,V.$changes.refId))}else S?x(G,s.op|D):(x(G,s.op),P(G,D))}else x(G,s.op)}},v=0;v<z;v++)a(v);return G},H.prototype.clone=function(){var K,H=new this.constructor,M=this._definition.schema;for(var q in M)"object"===typeof this[q]&&"function"===typeof(null===(K=this[q])||void 0===K?void 0:K.clone)?H[q]=this[q].clone():H[q]=this[q];return H},H.prototype.toJSON=function(){var K=this._definition.schema,H=this._definition.deprecated,M={};for(var q in K)H[q]||null===this[q]||"undefined"===typeof this[q]||(M[q]="function"===typeof this[q].toJSON?this[q].toJSON():this["_".concat(q)]);return M},H.prototype.discardAllChanges=function(){this.$changes.discardAll()},H.prototype.getByIndex=function(K){return this[this._definition.fieldsByIndex[K]]},H.prototype.deleteByIndex=function(K){this[this._definition.fieldsByIndex[K]]=void 0},H.prototype.tryEncodeTypeId=function(K,H,M){H._typeid!==M._typeid&&(x(K,h),P(K,M._typeid))},H.prototype.getSchemaType=function(K,H,M){var q;return K[H.offset]===h&&(H.offset++,q=this.constructor._context.get(SK(K,H))),q||M},H.prototype.createTypeInstance=function(K){var H=new K;return H.$changes.root=this.$changes.root,H},H.prototype._triggerChanges=function(M){for(var q,w,u,y,h,W,I,f,z,G=new Set,a=this.$changes.root.refs,v=function(v){var O=M[v],L=O.refId,S=a.get(L),B=S.$callbacks;if((O.op&K.OPERATION.DELETE)===K.OPERATION.DELETE&&O.previousValue instanceof H&&(null===(w=null===(q=O.previousValue.$callbacks)||void 0===q?void 0:q[K.OPERATION.DELETE])||void 0===w||w.forEach((function(K){return K()}))),!B)return"continue";if(S instanceof H){if(!G.has(L))try{null===(u=null===B||void 0===B?void 0:B[K.OPERATION.REPLACE])||void 0===u||u.forEach((function(K){return K()}))}catch(C){H.onError(C)}try{B.hasOwnProperty(O.field)&&(null===(y=B[O.field])||void 0===y||y.forEach((function(K){return K(O.value,O.previousValue)})))}catch(C){H.onError(C)}}else O.op===K.OPERATION.ADD&&void 0===O.previousValue?null===(h=B[K.OPERATION.ADD])||void 0===h||h.forEach((function(K){var H;return K(O.value,null!==(H=O.dynamicIndex)&&void 0!==H?H:O.field)})):O.op===K.OPERATION.DELETE?void 0!==O.previousValue&&(null===(W=B[K.OPERATION.DELETE])||void 0===W||W.forEach((function(K){var H;return K(O.previousValue,null!==(H=O.dynamicIndex)&&void 0!==H?H:O.field)}))):O.op===K.OPERATION.DELETE_AND_ADD&&(void 0!==O.previousValue&&(null===(I=B[K.OPERATION.DELETE])||void 0===I||I.forEach((function(K){var H;return K(O.previousValue,null!==(H=O.dynamicIndex)&&void 0!==H?H:O.field)}))),null===(f=B[K.OPERATION.ADD])||void 0===f||f.forEach((function(K){var H;return K(O.value,null!==(H=O.dynamicIndex)&&void 0!==H?H:O.field)}))),O.value!==O.previousValue&&(null===(z=B[K.OPERATION.REPLACE])||void 0===z||z.forEach((function(K){var H;return K(O.value,null!==(H=O.dynamicIndex)&&void 0!==H?H:O.field)})));G.add(L)},O=0;O<M.length;O++)v(O)},H._definition=i.create(),H}();function xK(K){for(var H=[K.$changes],M=1,q={},w=q,u=function(K){var M=H[K];M.changes.forEach((function(K){var H=M.ref,q=K.index,u=H._definition?H._definition.fieldsByIndex[q]:H.$indexes.get(q);w[u]=M.getValue(q)}))},y=0;y<M;y++)u(y);return q}var QK={context:new E},JK=function(K){function H(){return null!==K&&K.apply(this,arguments)||this}return M(H,K),q([s("string",QK)],H.prototype,"name",void 0),q([s("string",QK)],H.prototype,"type",void 0),q([s("number",QK)],H.prototype,"referencedType",void 0),H}(dK),NK=function(K){function H(){var H=null!==K&&K.apply(this,arguments)||this;return H.fields=new v,H}return M(H,K),q([s("number",QK)],H.prototype,"id",void 0),q([s([JK],QK)],H.prototype,"fields",void 0),H}(dK),pK=function(K){function H(){var H=null!==K&&K.apply(this,arguments)||this;return H.types=new v,H}return M(H,K),H.encode=function(K){var M=K.constructor,q=new H;q.rootType=M._typeid;var w=function(K,H){for(var M in H){var w=new JK;w.name=M;var u=void 0;if("string"===typeof H[M])u=H[M];else{var y=H[M],h=void 0;dK.is(y)?(u="ref",h=H[M]):"string"===typeof y[u=Object.keys(y)[0]]?u+=":"+y[u]:h=y[u],w.referencedType=h?h._typeid:-1}w.type=u,K.fields.push(w)}q.types.push(K)},u=M._context.types;for(var y in u){var h=new NK;h.id=Number(y),w(h,u[y]._definition.schema)}return q.encodeAll()},H.decode=function(K,q){var w=new E,u=new H;u.decode(K,q);var y=u.types.reduce((function(K,H){var q=function(K){function H(){return null!==K&&K.apply(this,arguments)||this}return M(H,K),H}(dK),u=H.id;return K[u]=q,w.add(q,u),K}),{});u.types.forEach((function(K){var H=y[K.id];K.fields.forEach((function(K){var M;if(void 0!==K.referencedType){var q=K.type,u=y[K.referencedType];if(!u){var h=K.type.split(":");q=h[0],u=h[1]}"ref"===q?s(u,{context:w})(H.prototype,K.name):s(((M={})[q]=u,M),{context:w})(H.prototype,K.name)}else s(K.type,{context:w})(H.prototype,K.name)}))}));var h=y[u.rootType],W=new h;for(var I in h._definition.schema){var f=h._definition.schema[I];"string"!==typeof f&&(W[I]="function"===typeof f?new f:new(C(Object.keys(f)[0]).constructor))}return W},q([s([NK],QK)],H.prototype,"types",void 0),q([s("number",QK)],H.prototype,"rootType",void 0),H}(dK);B("map",{constructor:L}),B("array",{constructor:v}),B("set",{constructor:lK}),B("collection",{constructor:EK}),K.ArraySchema=v,K.CollectionSchema=EK,K.Context=E,K.MapSchema=L,K.Reflection=pK,K.ReflectionField=JK,K.ReflectionType=NK,K.Schema=dK,K.SchemaDefinition=i,K.SetSchema=lK,K.decode=ZK,K.defineTypes=c,K.deprecated=n,K.dumpChanges=xK,K.encode=g,K.filter=D,K.filterChildren=V,K.hasFilter=Z,K.registerType=B,K.type=s,Object.defineProperty(K,"__esModule",{value:!0})}(H)},13410:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},13407:(K,H,M)=>{var q=M(13410),w=M(13418),u=Object.hasOwnProperty,y=Object.create(null);for(var h in q)u.call(q,h)&&(y[q[h]]=h);var W=K.exports={to:{},get:{}};function I(K,H,M){return Math.min(Math.max(H,K),M)}function f(K){var H=Math.round(K).toString(16).toUpperCase();return H.length<2?"0"+H:H}W.get=function(K){var H,M;switch(K.substring(0,3).toLowerCase()){case"hsl":H=W.get.hsl(K),M="hsl";break;case"hwb":H=W.get.hwb(K),M="hwb";break;default:H=W.get.rgb(K),M="rgb"}return H?{model:M,value:H}:null},W.get.rgb=function(K){if(!K)return null;var H,M,w,y=[0,0,0,1];if(H=K.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(w=H[2],H=H[1],M=0;M<3;M++){var h=2*M;y[M]=parseInt(H.slice(h,h+2),16)}w&&(y[3]=parseInt(w,16)/255)}else if(H=K.match(/^#([a-f0-9]{3,4})$/i)){for(w=(H=H[1])[3],M=0;M<3;M++)y[M]=parseInt(H[M]+H[M],16);w&&(y[3]=parseInt(w+w,16)/255)}else if(H=K.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(M=0;M<3;M++)y[M]=parseInt(H[M+1],0);H[4]&&(H[5]?y[3]=.01*parseFloat(H[4]):y[3]=parseFloat(H[4]))}else{if(!(H=K.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(H=K.match(/^(\w+)$/))?"transparent"===H[1]?[0,0,0,0]:u.call(q,H[1])?((y=q[H[1]])[3]=1,y):null:null;for(M=0;M<3;M++)y[M]=Math.round(2.55*parseFloat(H[M+1]));H[4]&&(H[5]?y[3]=.01*parseFloat(H[4]):y[3]=parseFloat(H[4]))}for(M=0;M<3;M++)y[M]=I(y[M],0,255);return y[3]=I(y[3],0,1),y},W.get.hsl=function(K){if(!K)return null;var H=K.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(H){var M=parseFloat(H[4]);return[(parseFloat(H[1])%360+360)%360,I(parseFloat(H[2]),0,100),I(parseFloat(H[3]),0,100),I(isNaN(M)?1:M,0,1)]}return null},W.get.hwb=function(K){if(!K)return null;var H=K.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(H){var M=parseFloat(H[4]);return[(parseFloat(H[1])%360+360)%360,I(parseFloat(H[2]),0,100),I(parseFloat(H[3]),0,100),I(isNaN(M)?1:M,0,1)]}return null},W.to.hex=function(){var K=w(arguments);return"#"+f(K[0])+f(K[1])+f(K[2])+(K[3]<1?f(Math.round(255*K[3])):"")},W.to.rgb=function(){var K=w(arguments);return K.length<4||1===K[3]?"rgb("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+")":"rgba("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+", "+K[3]+")"},W.to.rgb.percent=function(){var K=w(arguments),H=Math.round(K[0]/255*100),M=Math.round(K[1]/255*100),q=Math.round(K[2]/255*100);return K.length<4||1===K[3]?"rgb("+H+"%, "+M+"%, "+q+"%)":"rgba("+H+"%, "+M+"%, "+q+"%, "+K[3]+")"},W.to.hsl=function(){var K=w(arguments);return K.length<4||1===K[3]?"hsl("+K[0]+", "+K[1]+"%, "+K[2]+"%)":"hsla("+K[0]+", "+K[1]+"%, "+K[2]+"%, "+K[3]+")"},W.to.hwb=function(){var K=w(arguments),H="";return K.length>=4&&1!==K[3]&&(H=", "+K[3]),"hwb("+K[0]+", "+K[1]+"%, "+K[2]+"%"+H+")"},W.to.keyword=function(K){return y[K.slice(0,3)]}},13402:(K,H,M)=>{const q=M(13407),w=M(13428),u=["keyword","gray","hex"],y={};for(const a of Object.keys(w))y[[...w[a].labels].sort().join("")]=a;const h={};function W(K,H){if(!(this instanceof W))return new W(K,H);if(H&&H in u&&(H=null),H&&!(H in w))throw new Error("Unknown model: "+H);let M,I;if(null==K)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(K instanceof W)this.model=K.model,this.color=[...K.color],this.valpha=K.valpha;else if("string"===typeof K){const H=q.get(K);if(null===H)throw new Error("Unable to parse color from string: "+K);this.model=H.model,I=w[this.model].channels,this.color=H.value.slice(0,I),this.valpha="number"===typeof H.value[I]?H.value[I]:1}else if(K.length>0){this.model=H||"rgb",I=w[this.model].channels;const M=Array.prototype.slice.call(K,0,I);this.color=G(M,I),this.valpha="number"===typeof K[I]?K[I]:1}else if("number"===typeof K)this.model="rgb",this.color=[K>>16&255,K>>8&255,255&K],this.valpha=1;else{this.valpha=1;const H=Object.keys(K);"alpha"in K&&(H.splice(H.indexOf("alpha"),1),this.valpha="number"===typeof K.alpha?K.alpha:0);const q=H.sort().join("");if(!(q in y))throw new Error("Unable to parse color from object: "+JSON.stringify(K));this.model=y[q];const{labels:u}=w[this.model],h=[];for(M=0;M<u.length;M++)h.push(K[u[M]]);this.color=G(h)}if(h[this.model])for(I=w[this.model].channels,M=0;M<I;M++){const K=h[this.model][M];K&&(this.color[M]=K(this.color[M]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}W.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(K){let H=this.model in q.to?this:this.rgb();H=H.round("number"===typeof K?K:1);const M=1===H.valpha?H.color:[...H.color,this.valpha];return q.to[H.model](M)},percentString(K){const H=this.rgb().round("number"===typeof K?K:1),M=1===H.valpha?H.color:[...H.color,this.valpha];return q.to.rgb.percent(M)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const K={},{channels:H}=w[this.model],{labels:M}=w[this.model];for(let q=0;q<H;q++)K[M[q]]=this.color[q];return 1!==this.valpha&&(K.alpha=this.valpha),K},unitArray(){const K=this.rgb().color;return K[0]/=255,K[1]/=255,K[2]/=255,1!==this.valpha&&K.push(this.valpha),K},unitObject(){const K=this.rgb().object();return K.r/=255,K.g/=255,K.b/=255,1!==this.valpha&&(K.alpha=this.valpha),K},round(K){return K=Math.max(K||0,0),new W([...this.color.map(I(K)),this.valpha],this.model)},alpha(K){return void 0!==K?new W([...this.color,Math.max(0,Math.min(1,K))],this.model):this.valpha},red:f("rgb",0,z(255)),green:f("rgb",1,z(255)),blue:f("rgb",2,z(255)),hue:f(["hsl","hsv","hsl","hwb","hcg"],0,(K=>(K%360+360)%360)),saturationl:f("hsl",1,z(100)),lightness:f("hsl",2,z(100)),saturationv:f("hsv",1,z(100)),value:f("hsv",2,z(100)),chroma:f("hcg",1,z(100)),gray:f("hcg",2,z(100)),white:f("hwb",1,z(100)),wblack:f("hwb",2,z(100)),cyan:f("cmyk",0,z(100)),magenta:f("cmyk",1,z(100)),yellow:f("cmyk",2,z(100)),black:f("cmyk",3,z(100)),x:f("xyz",0,z(95.047)),y:f("xyz",1,z(100)),z:f("xyz",2,z(108.833)),l:f("lab",0,z(100)),a:f("lab",1),b:f("lab",2),keyword(K){return void 0!==K?new W(K):w[this.model].keyword(this.color)},hex(K){return void 0!==K?new W(K):q.to.hex(this.rgb().round().color)},hexa(K){if(void 0!==K)return new W(K);const H=this.rgb().round().color;let M=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===M.length&&(M="0"+M),q.to.hex(H)+M},rgbNumber(){const K=this.rgb().color;return(255&K[0])<<16|(255&K[1])<<8|255&K[2]},luminosity(){const K=this.rgb().color,H=[];for(const[M,q]of K.entries()){const K=q/255;H[M]=K<=.04045?K/12.92:((K+.055)/1.055)**2.4}return.2126*H[0]+.7152*H[1]+.0722*H[2]},contrast(K){const H=this.luminosity(),M=K.luminosity();return H>M?(H+.05)/(M+.05):(M+.05)/(H+.05)},level(K){const H=this.contrast(K);return H>=7?"AAA":H>=4.5?"AA":""},isDark(){const K=this.rgb().color;return(2126*K[0]+7152*K[1]+722*K[2])/1e4<128},isLight(){return!this.isDark()},negate(){const K=this.rgb();for(let H=0;H<3;H++)K.color[H]=255-K.color[H];return K},lighten(K){const H=this.hsl();return H.color[2]+=H.color[2]*K,H},darken(K){const H=this.hsl();return H.color[2]-=H.color[2]*K,H},saturate(K){const H=this.hsl();return H.color[1]+=H.color[1]*K,H},desaturate(K){const H=this.hsl();return H.color[1]-=H.color[1]*K,H},whiten(K){const H=this.hwb();return H.color[1]+=H.color[1]*K,H},blacken(K){const H=this.hwb();return H.color[2]+=H.color[2]*K,H},grayscale(){const K=this.rgb().color,H=.3*K[0]+.59*K[1]+.11*K[2];return W.rgb(H,H,H)},fade(K){return this.alpha(this.valpha-this.valpha*K)},opaquer(K){return this.alpha(this.valpha+this.valpha*K)},rotate(K){const H=this.hsl();let M=H.color[0];return M=(M+K)%360,M=M<0?360+M:M,H.color[0]=M,H},mix(K,H){if(!K||!K.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof K);const M=K.rgb(),q=this.rgb(),w=void 0===H?.5:H,u=2*w-1,y=M.alpha()-q.alpha(),h=((u*y===-1?u:(u+y)/(1+u*y))+1)/2,I=1-h;return W.rgb(h*M.red()+I*q.red(),h*M.green()+I*q.green(),h*M.blue()+I*q.blue(),M.alpha()*w+q.alpha()*(1-w))}};for(const a of Object.keys(w)){if(u.includes(a))continue;const{channels:K}=w[a];W.prototype[a]=function(){if(this.model===a)return new W(this);for(var K=arguments.length,H=new Array(K),M=0;M<K;M++)H[M]=arguments[M];return H.length>0?new W(H,a):new W([...(q=w[this.model][a].raw(this.color),Array.isArray(q)?q:[q]),this.valpha],a);var q},W[a]=function(){for(var H=arguments.length,M=new Array(H),q=0;q<H;q++)M[q]=arguments[q];let w=M[0];return"number"===typeof w&&(w=G(M,K)),new W(w,a)}}function I(K){return function(H){return function(K,H){return Number(K.toFixed(H))}(H,K)}}function f(K,H,M){K=Array.isArray(K)?K:[K];for(const q of K)(h[q]||(h[q]=[]))[H]=M;return K=K[0],function(q){let w;return void 0!==q?(M&&(q=M(q)),w=this[K](),w.color[H]=q,w):(w=this[K]().color[H],M&&(w=M(w)),w)}}function z(K){return function(H){return Math.max(0,Math.min(K,H))}}function G(K,H){for(let M=0;M<H;M++)"number"!==typeof K[M]&&(K[M]=0);return K}K.exports=W},13434:(K,H,M)=>{const q=M(13436),w={};for(const y of Object.keys(q))w[q[y]]=y;const u={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};K.exports=u;for(const y of Object.keys(u)){if(!("channels"in u[y]))throw new Error("missing channels property: "+y);if(!("labels"in u[y]))throw new Error("missing channel labels property: "+y);if(u[y].labels.length!==u[y].channels)throw new Error("channel and label counts mismatch: "+y);const{channels:K,labels:H}=u[y];delete u[y].channels,delete u[y].labels,Object.defineProperty(u[y],"channels",{value:K}),Object.defineProperty(u[y],"labels",{value:H})}u.rgb.hsl=function(K){const H=K[0]/255,M=K[1]/255,q=K[2]/255,w=Math.min(H,M,q),u=Math.max(H,M,q),y=u-w;let h,W;u===w?h=0:H===u?h=(M-q)/y:M===u?h=2+(q-H)/y:q===u&&(h=4+(H-M)/y),h=Math.min(60*h,360),h<0&&(h+=360);const I=(w+u)/2;return W=u===w?0:I<=.5?y/(u+w):y/(2-u-w),[h,100*W,100*I]},u.rgb.hsv=function(K){let H,M,q,w,u;const y=K[0]/255,h=K[1]/255,W=K[2]/255,I=Math.max(y,h,W),f=I-Math.min(y,h,W),z=function(K){return(I-K)/6/f+.5};return 0===f?(w=0,u=0):(u=f/I,H=z(y),M=z(h),q=z(W),y===I?w=q-M:h===I?w=1/3+H-q:W===I&&(w=2/3+M-H),w<0?w+=1:w>1&&(w-=1)),[360*w,100*u,100*I]},u.rgb.hwb=function(K){const H=K[0],M=K[1];let q=K[2];const w=u.rgb.hsl(K)[0],y=1/255*Math.min(H,Math.min(M,q));return q=1-1/255*Math.max(H,Math.max(M,q)),[w,100*y,100*q]},u.rgb.cmyk=function(K){const H=K[0]/255,M=K[1]/255,q=K[2]/255,w=Math.min(1-H,1-M,1-q);return[100*((1-H-w)/(1-w)||0),100*((1-M-w)/(1-w)||0),100*((1-q-w)/(1-w)||0),100*w]},u.rgb.keyword=function(K){const H=w[K];if(H)return H;let M,u=1/0;for(const w of Object.keys(q)){const H=q[w],W=(h=H,((y=K)[0]-h[0])**2+(y[1]-h[1])**2+(y[2]-h[2])**2);W<u&&(u=W,M=w)}var y,h;return M},u.keyword.rgb=function(K){return q[K]},u.rgb.xyz=function(K){let H=K[0]/255,M=K[1]/255,q=K[2]/255;H=H>.04045?((H+.055)/1.055)**2.4:H/12.92,M=M>.04045?((M+.055)/1.055)**2.4:M/12.92,q=q>.04045?((q+.055)/1.055)**2.4:q/12.92;return[100*(.4124*H+.3576*M+.1805*q),100*(.2126*H+.7152*M+.0722*q),100*(.0193*H+.1192*M+.9505*q)]},u.rgb.lab=function(K){const H=u.rgb.xyz(K);let M=H[0],q=H[1],w=H[2];M/=95.047,q/=100,w/=108.883,M=M>.008856?M**(1/3):7.787*M+16/116,q=q>.008856?q**(1/3):7.787*q+16/116,w=w>.008856?w**(1/3):7.787*w+16/116;return[116*q-16,500*(M-q),200*(q-w)]},u.hsl.rgb=function(K){const H=K[0]/360,M=K[1]/100,q=K[2]/100;let w,u,y;if(0===M)return y=255*q,[y,y,y];w=q<.5?q*(1+M):q+M-q*M;const h=2*q-w,W=[0,0,0];for(let I=0;I<3;I++)u=H+1/3*-(I-1),u<0&&u++,u>1&&u--,y=6*u<1?h+6*(w-h)*u:2*u<1?w:3*u<2?h+(w-h)*(2/3-u)*6:h,W[I]=255*y;return W},u.hsl.hsv=function(K){const H=K[0];let M=K[1]/100,q=K[2]/100,w=M;const u=Math.max(q,.01);q*=2,M*=q<=1?q:2-q,w*=u<=1?u:2-u;return[H,100*(0===q?2*w/(u+w):2*M/(q+M)),100*((q+M)/2)]},u.hsv.rgb=function(K){const H=K[0]/60,M=K[1]/100;let q=K[2]/100;const w=Math.floor(H)%6,u=H-Math.floor(H),y=255*q*(1-M),h=255*q*(1-M*u),W=255*q*(1-M*(1-u));switch(q*=255,w){case 0:return[q,W,y];case 1:return[h,q,y];case 2:return[y,q,W];case 3:return[y,h,q];case 4:return[W,y,q];case 5:return[q,y,h]}},u.hsv.hsl=function(K){const H=K[0],M=K[1]/100,q=K[2]/100,w=Math.max(q,.01);let u,y;y=(2-M)*q;const h=(2-M)*w;return u=M*w,u/=h<=1?h:2-h,u=u||0,y/=2,[H,100*u,100*y]},u.hwb.rgb=function(K){const H=K[0]/360;let M=K[1]/100,q=K[2]/100;const w=M+q;let u;w>1&&(M/=w,q/=w);const y=Math.floor(6*H),h=1-q;u=6*H-y,0!==(1&y)&&(u=1-u);const W=M+u*(h-M);let I,f,z;switch(y){default:case 6:case 0:I=h,f=W,z=M;break;case 1:I=W,f=h,z=M;break;case 2:I=M,f=h,z=W;break;case 3:I=M,f=W,z=h;break;case 4:I=W,f=M,z=h;break;case 5:I=h,f=M,z=W}return[255*I,255*f,255*z]},u.cmyk.rgb=function(K){const H=K[0]/100,M=K[1]/100,q=K[2]/100,w=K[3]/100;return[255*(1-Math.min(1,H*(1-w)+w)),255*(1-Math.min(1,M*(1-w)+w)),255*(1-Math.min(1,q*(1-w)+w))]},u.xyz.rgb=function(K){const H=K[0]/100,M=K[1]/100,q=K[2]/100;let w,u,y;return w=3.2406*H+-1.5372*M+-.4986*q,u=-.9689*H+1.8758*M+.0415*q,y=.0557*H+-.204*M+1.057*q,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,u=u>.0031308?1.055*u**(1/2.4)-.055:12.92*u,y=y>.0031308?1.055*y**(1/2.4)-.055:12.92*y,w=Math.min(Math.max(0,w),1),u=Math.min(Math.max(0,u),1),y=Math.min(Math.max(0,y),1),[255*w,255*u,255*y]},u.xyz.lab=function(K){let H=K[0],M=K[1],q=K[2];H/=95.047,M/=100,q/=108.883,H=H>.008856?H**(1/3):7.787*H+16/116,M=M>.008856?M**(1/3):7.787*M+16/116,q=q>.008856?q**(1/3):7.787*q+16/116;return[116*M-16,500*(H-M),200*(M-q)]},u.lab.xyz=function(K){let H,M,q;M=(K[0]+16)/116,H=K[1]/500+M,q=M-K[2]/200;const w=M**3,u=H**3,y=q**3;return M=w>.008856?w:(M-16/116)/7.787,H=u>.008856?u:(H-16/116)/7.787,q=y>.008856?y:(q-16/116)/7.787,H*=95.047,M*=100,q*=108.883,[H,M,q]},u.lab.lch=function(K){const H=K[0],M=K[1],q=K[2];let w;w=360*Math.atan2(q,M)/2/Math.PI,w<0&&(w+=360);return[H,Math.sqrt(M*M+q*q),w]},u.lch.lab=function(K){const H=K[0],M=K[1],q=K[2]/360*2*Math.PI;return[H,M*Math.cos(q),M*Math.sin(q)]},u.rgb.ansi16=function(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[M,q,w]=K;let y=null===H?u.rgb.hsv(K)[2]:H;if(y=Math.round(y/50),0===y)return 30;let h=30+(Math.round(w/255)<<2|Math.round(q/255)<<1|Math.round(M/255));return 2===y&&(h+=60),h},u.hsv.ansi16=function(K){return u.rgb.ansi16(u.hsv.rgb(K),K[2])},u.rgb.ansi256=function(K){const H=K[0],M=K[1],q=K[2];if(H===M&&M===q)return H<8?16:H>248?231:Math.round((H-8)/247*24)+232;return 16+36*Math.round(H/255*5)+6*Math.round(M/255*5)+Math.round(q/255*5)},u.ansi16.rgb=function(K){let H=K%10;if(0===H||7===H)return K>50&&(H+=3.5),H=H/10.5*255,[H,H,H];const M=.5*(1+~~(K>50));return[(1&H)*M*255,(H>>1&1)*M*255,(H>>2&1)*M*255]},u.ansi256.rgb=function(K){if(K>=232){const H=10*(K-232)+8;return[H,H,H]}let H;K-=16;return[Math.floor(K/36)/5*255,Math.floor((H=K%36)/6)/5*255,H%6/5*255]},u.rgb.hex=function(K){const H=(((255&Math.round(K[0]))<<16)+((255&Math.round(K[1]))<<8)+(255&Math.round(K[2]))).toString(16).toUpperCase();return"000000".substring(H.length)+H},u.hex.rgb=function(K){const H=K.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!H)return[0,0,0];let M=H[0];3===H[0].length&&(M=M.split("").map((K=>K+K)).join(""));const q=parseInt(M,16);return[q>>16&255,q>>8&255,255&q]},u.rgb.hcg=function(K){const H=K[0]/255,M=K[1]/255,q=K[2]/255,w=Math.max(Math.max(H,M),q),u=Math.min(Math.min(H,M),q),y=w-u;let h,W;return h=y<1?u/(1-y):0,W=y<=0?0:w===H?(M-q)/y%6:w===M?2+(q-H)/y:4+(H-M)/y,W/=6,W%=1,[360*W,100*y,100*h]},u.hsl.hcg=function(K){const H=K[1]/100,M=K[2]/100,q=M<.5?2*H*M:2*H*(1-M);let w=0;return q<1&&(w=(M-.5*q)/(1-q)),[K[0],100*q,100*w]},u.hsv.hcg=function(K){const H=K[1]/100,M=K[2]/100,q=H*M;let w=0;return q<1&&(w=(M-q)/(1-q)),[K[0],100*q,100*w]},u.hcg.rgb=function(K){const H=K[0]/360,M=K[1]/100,q=K[2]/100;if(0===M)return[255*q,255*q,255*q];const w=[0,0,0],u=H%1*6,y=u%1,h=1-y;let W=0;switch(Math.floor(u)){case 0:w[0]=1,w[1]=y,w[2]=0;break;case 1:w[0]=h,w[1]=1,w[2]=0;break;case 2:w[0]=0,w[1]=1,w[2]=y;break;case 3:w[0]=0,w[1]=h,w[2]=1;break;case 4:w[0]=y,w[1]=0,w[2]=1;break;default:w[0]=1,w[1]=0,w[2]=h}return W=(1-M)*q,[255*(M*w[0]+W),255*(M*w[1]+W),255*(M*w[2]+W)]},u.hcg.hsv=function(K){const H=K[1]/100,M=H+K[2]/100*(1-H);let q=0;return M>0&&(q=H/M),[K[0],100*q,100*M]},u.hcg.hsl=function(K){const H=K[1]/100,M=K[2]/100*(1-H)+.5*H;let q=0;return M>0&&M<.5?q=H/(2*M):M>=.5&&M<1&&(q=H/(2*(1-M))),[K[0],100*q,100*M]},u.hcg.hwb=function(K){const H=K[1]/100,M=H+K[2]/100*(1-H);return[K[0],100*(M-H),100*(1-M)]},u.hwb.hcg=function(K){const H=K[1]/100,M=1-K[2]/100,q=M-H;let w=0;return q<1&&(w=(M-q)/(1-q)),[K[0],100*q,100*w]},u.apple.rgb=function(K){return[K[0]/65535*255,K[1]/65535*255,K[2]/65535*255]},u.rgb.apple=function(K){return[K[0]/255*65535,K[1]/255*65535,K[2]/255*65535]},u.gray.rgb=function(K){return[K[0]/100*255,K[0]/100*255,K[0]/100*255]},u.gray.hsl=function(K){return[0,0,K[0]]},u.gray.hsv=u.gray.hsl,u.gray.hwb=function(K){return[0,100,K[0]]},u.gray.cmyk=function(K){return[0,0,0,K[0]]},u.gray.lab=function(K){return[K[0],0,0]},u.gray.hex=function(K){const H=255&Math.round(K[0]/100*255),M=((H<<16)+(H<<8)+H).toString(16).toUpperCase();return"000000".substring(M.length)+M},u.rgb.gray=function(K){return[(K[0]+K[1]+K[2])/3/255*100]}},13428:(K,H,M)=>{const q=M(13434),w=M(13442),u={};Object.keys(q).forEach((K=>{u[K]={},Object.defineProperty(u[K],"channels",{value:q[K].channels}),Object.defineProperty(u[K],"labels",{value:q[K].labels});const H=w(K);Object.keys(H).forEach((M=>{const q=H[M];u[K][M]=function(K){const H=function(){for(var H=arguments.length,M=new Array(H),q=0;q<H;q++)M[q]=arguments[q];const w=M[0];if(void 0===w||null===w)return w;w.length>1&&(M=w);const u=K(M);if("object"===typeof u)for(let K=u.length,y=0;y<K;y++)u[y]=Math.round(u[y]);return u};return"conversion"in K&&(H.conversion=K.conversion),H}(q),u[K][M].raw=function(K){const H=function(){for(var H=arguments.length,M=new Array(H),q=0;q<H;q++)M[q]=arguments[q];const w=M[0];return void 0===w||null===w?w:(w.length>1&&(M=w),K(M))};return"conversion"in K&&(H.conversion=K.conversion),H}(q)}))})),K.exports=u},13442:(K,H,M)=>{const q=M(13434);function w(K){const H=function(){const K={},H=Object.keys(q);for(let M=H.length,q=0;q<M;q++)K[H[q]]={distance:-1,parent:null};return K}(),M=[K];for(H[K].distance=0;M.length;){const K=M.pop(),w=Object.keys(q[K]);for(let q=w.length,u=0;u<q;u++){const q=w[u],y=H[q];-1===y.distance&&(y.distance=H[K].distance+1,y.parent=K,M.unshift(q))}}return H}function u(K,H){return function(M){return H(K(M))}}function y(K,H){const M=[H[K].parent,K];let w=q[H[K].parent][K],y=H[K].parent;for(;H[y].parent;)M.unshift(H[y].parent),w=u(q[H[y].parent][y],w),y=H[y].parent;return w.conversion=M,w}K.exports=function(K){const H=w(K),M={},q=Object.keys(H);for(let w=q.length,u=0;u<w;u++){const K=q[u];null!==H[K].parent&&(M[K]=y(K,H))}return M}},13436:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12009:(K,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.discordURLBuilder=void 0,H.discordURLBuilder=function(K){var H;const M=(null===(H=null===window||void 0===window?void 0:window.location)||void 0===H?void 0:H.hostname)||"localhost",q=K.hostname.split("."),w=!K.hostname.includes("trycloudflare.com")&&!K.hostname.includes("discordsays.com")&&q.length>2?`/${q[0]}`:"";return K.pathname.startsWith("/.proxy")?`${K.protocol}//${M}${w}${K.pathname}${K.search}`:`${K.protocol}//${M}/.proxy/colyseus${w}${K.pathname}${K.search}`}},11996:function(K,H,M){"use strict";var q,w,u,y,h=this&&this.__awaiter||function(K,H,M,q){return new(M||(M=Promise))((function(w,u){function y(K){try{W(q.next(K))}catch(H){u(H)}}function h(K){try{W(q.throw(K))}catch(H){u(H)}}function W(K){var H;K.done?w(K.value):(H=K.value,H instanceof M?H:new M((function(K){K(H)}))).then(y,h)}W((q=q.apply(K,H||[])).next())}))},W=this&&this.__classPrivateFieldGet||function(K,H,M,q){if("a"===M&&!q)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof H?K!==H||!q:!H.has(K))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===M?q:"a"===M?q.call(K):q?q.value:H.get(K)},I=this&&this.__classPrivateFieldSet||function(K,H,M,q,w){if("m"===q)throw new TypeError("Private method is not writable");if("a"===q&&!w)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof H?K!==H||!w:!H.has(K))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===q?w.call(K,M):w?w.value=M:H.set(K,M),M};Object.defineProperty(H,"__esModule",{value:!0}),H.Auth=void 0;const f=M(12005),z=M(11970);H.Auth=class{constructor(K){this.http=K,this.settings={path:"/auth",key:"colyseus-auth-token"},q.set(this,!1),w.set(this,void 0),u.set(this,void 0),y.set(this,(0,z.createNanoEvents)()),(0,f.getItem)(this.settings.key,(K=>this.token=K))}set token(K){this.http.authToken=K}get token(){return this.http.authToken}onChange(K){const H=W(this,y,"f").on("change",K);return W(this,q,"f")||I(this,w,new Promise(((K,H)=>{this.getUserData().then((K=>{this.emitChange(Object.assign(Object.assign({},K),{token:this.token}))})).catch((K=>{this.emitChange({user:null,token:void 0})})).finally((()=>{K()}))})),"f"),I(this,q,!0,"f"),H}getUserData(){return h(this,void 0,void 0,(function*(){if(this.token)return(yield this.http.get(`${this.settings.path}/userdata`)).data;throw new Error("missing auth.token")}))}registerWithEmailAndPassword(K,H,M){return h(this,void 0,void 0,(function*(){const q=(yield this.http.post(`${this.settings.path}/register`,{body:{email:K,password:H,options:M}})).data;return this.emitChange(q),q}))}signInWithEmailAndPassword(K,H){return h(this,void 0,void 0,(function*(){const M=(yield this.http.post(`${this.settings.path}/login`,{body:{email:K,password:H}})).data;return this.emitChange(M),M}))}signInAnonymously(K){return h(this,void 0,void 0,(function*(){const H=(yield this.http.post(`${this.settings.path}/anonymous`,{body:{options:K}})).data;return this.emitChange(H),H}))}sendPasswordResetEmail(K){return h(this,void 0,void 0,(function*(){return(yield this.http.post(`${this.settings.path}/forgot-password`,{body:{email:K}})).data}))}signInWithProvider(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,void 0,void 0,(function*(){return new Promise(((M,q)=>{const w=H.width||480,y=H.height||768,h=this.token?`?token=${this.token}`:"",f=`Login with ${K[0].toUpperCase()+K.substring(1)}`,z=this.http.client.getHttpEndpoint(`${H.prefix||`${this.settings.path}/provider`}/${K}${h}`),G=screen.width/2-w/2,a=screen.height/2-y/2;I(this,u,window.open(z,f,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+w+", height="+y+", top="+a+", left="+G),"f");const v=K=>{void 0===K.data.user&&void 0===K.data.token||(clearInterval(O),W(this,u,"f").close(),I(this,u,void 0,"f"),window.removeEventListener("message",v),void 0!==K.data.error?q(K.data.error):(M(K.data),this.emitChange(K.data)))},O=setInterval((()=>{W(this,u,"f")&&!W(this,u,"f").closed||(I(this,u,void 0,"f"),q("mw"),window.removeEventListener("message",v))}),200);window.addEventListener("message",v)}))}))}signOut(){return h(this,void 0,void 0,(function*(){this.emitChange({user:null,token:null})}))}emitChange(K){void 0!==K.token&&(this.token=K.token,null===K.token?(0,f.removeItem)(this.settings.key):(0,f.setItem)(this.settings.key,K.token)),W(this,y,"f").emit("change",K)}},q=new WeakMap,w=new WeakMap,u=new WeakMap,y=new WeakMap},11923:function(K,H,M){"use strict";var q,w=this&&this.__awaiter||function(K,H,M,q){return new(M||(M=Promise))((function(w,u){function y(K){try{W(q.next(K))}catch(H){u(H)}}function h(K){try{W(q.throw(K))}catch(H){u(H)}}function W(K){var H;K.done?w(K.value):(H=K.value,H instanceof M?H:new M((function(K){K(H)}))).then(y,h)}W((q=q.apply(K,H||[])).next())}))};Object.defineProperty(H,"__esModule",{value:!0}),H.Client=H.MatchMakeError=void 0;const u=M(11925),y=M(11927),h=M(11982),W=M(11996),I=M(12009);class f extends Error{constructor(K,H){super(K),this.code=H,Object.setPrototypeOf(this,f.prototype)}}H.MatchMakeError=f;const z="undefined"!==typeof window&&"undefined"!==typeof(null===(q=null===window||void 0===window?void 0:window.location)||void 0===q?void 0:q.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";H.Client=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,H=arguments.length>1?arguments[1]:void 0;var M,q;if("string"===typeof K){const H=K.startsWith("/")?new URL(K,z):new URL(K),M="https:"===H.protocol||"wss:"===H.protocol,q=Number(H.port||(M?443:80));this.settings={hostname:H.hostname,pathname:H.pathname,port:q,secure:M}}else void 0===K.port&&(K.port=K.secure?443:80),void 0===K.pathname&&(K.pathname=""),this.settings=K;this.settings.pathname.endsWith("/")&&(this.settings.pathname=this.settings.pathname.slice(0,-1)),this.http=new h.HTTP(this,(null===H||void 0===H?void 0:H.headers)||{}),this.auth=new W.Auth(this.http),this.urlBuilder=null===H||void 0===H?void 0:H.urlBuilder,!this.urlBuilder&&"undefined"!==typeof window&&(null===(q=null===(M=null===window||void 0===window?void 0:window.location)||void 0===M?void 0:M.hostname)||void 0===q?void 0:q.includes("discordsays.com"))&&(this.urlBuilder=I.discordURLBuilder,console.log("Colyseus SDK: Discord Embedded SDK detected. Using custom URL builder."))}joinOrCreate(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",K,H,M)}))}create(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",K,H,M)}))}join(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",K,H,M)}))}joinById(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;return w(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",K,H,M)}))}reconnect(K,H){return w(this,void 0,void 0,(function*(){if("string"===typeof K&&"string"===typeof H)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[M,q]=K.split(":");if(!M||!q)throw new Error("Invalid reconnection token format.\nThe format should be roomId:reconnectionToken");return yield this.createMatchMakeRequest("reconnect",M,{reconnectionToken:q},H)}))}getAvailableRooms(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return w(this,void 0,void 0,(function*(){return(yield this.http.get(`matchmake/${K}`,{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(K,H,M){return w(this,void 0,void 0,(function*(){const q=this.createRoom(K.room.name,H);q.roomId=K.room.roomId,q.sessionId=K.sessionId;const y={sessionId:q.sessionId};K.reconnectionToken&&(y.reconnectionToken=K.reconnectionToken);const h=M||q;return q.connect(this.buildEndpoint(K.room,y),K.devMode&&(()=>w(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${q.roomId}'...`);let M=0;const u=()=>w(this,void 0,void 0,(function*(){M++;try{yield this.consumeSeatReservation(K,H,h),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${q.roomId}'`)}catch(w){M<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${M} out of 8)`),setTimeout(u,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(u,2e3)}))),h,this.http.headers),new Promise(((K,H)=>{const M=(K,M)=>H(new u.ServerError(K,M));h.onError.once(M),h.onJoin.once((()=>{h.onError.remove(M),setTimeout((()=>{try{h.oW(128,new Uint8Array([9,1,83,47,203,149,126,18,105,62,217,254,188,215,74,253,91,227,231,142]))}catch{}}),3e3),K(h)}))}))}))}createMatchMakeRequest(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},q=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return w(this,void 0,void 0,(function*(){const w=(yield this.http.post(`matchmake/${K}/${H}`,{headers:{"X-Requested-With":"XMLHtttpRequest",Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(M)})).data;if(w.error)throw new f(w.error,w.code);return"reconnect"===K&&(w.reconnectionToken=M.reconnectionToken),yield this.consumeSeatReservation(w,q,u)}))}createRoom(K,H){return new y.Room(K,H)}buildEndpoint(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const M=[];for(const u in H)H.hasOwnProperty(u)&&M.push(`${u}=${H[u]}`);let q=this.settings.secure?"wss://":"ws://";K.publicAddress?q+=`${K.publicAddress}`:q+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`;const w=`${q}/${K.processId}/${K.roomId}?${M.join("&")}`;return this.urlBuilder?this.urlBuilder(new URL(w)):w}getHttpEndpoint(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const H=K.startsWith("/")?K:`/${K}`,M=`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}${H}`;return this.urlBuilder?this.urlBuilder(new URL(M)):M}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},11937:(K,H,M)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.Connection=void 0;const q=M(11946);H.Connection=class{constructor(){this.events={},this.transport=new q.WebSocketTransport(this.events)}send(K){this.transport.send(K)}connect(K,H){this.transport.connect(K,H)}close(K,H){this.transport.close(K,H)}get isOpen(){return this.transport.isOpen}}},11982:function(K,H,M){"use strict";var q=this&&this.__createBinding||(Object.create?function(K,H,M,q){void 0===q&&(q=M);var w=Object.getOwnPropertyDescriptor(H,M);w&&!("get"in w?!H.__esModule:w.writable||w.configurable)||(w={enumerable:!0,get:function(){return H[M]}}),Object.defineProperty(K,q,w)}:function(K,H,M,q){void 0===q&&(q=M),K[q]=H[M]}),w=this&&this.__setModuleDefault||(Object.create?function(K,H){Object.defineProperty(K,"default",{enumerable:!0,value:H})}:function(K,H){K.default=H}),u=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var H={};if(null!=K)for(var M in K)"default"!==M&&Object.prototype.hasOwnProperty.call(K,M)&&q(H,K,M);return w(H,K),H};Object.defineProperty(H,"__esModule",{value:!0}),H.HTTP=void 0;const y=M(11925),h=u(M(11990));H.HTTP=class{constructor(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.client=K,this.headers=H}get(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("get",K,H)}post(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("post",K,H)}del(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("del",K,H)}put(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("put",K,H)}request(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return h[K](this.client.getHttpEndpoint(H),this.getOptions(M)).catch((K=>{var H;const M=K.statusCode,q=(null===(H=K.data)||void 0===H?void 0:H.error)||K.statusMessage||K.message;if(!M&&!q)throw K;throw new y.ServerError(M,q)}))}getOptions(K){return K.headers=Object.assign({},this.headers,K.headers),this.authToken&&(K.headers.Authorization=`Bearer ${this.authToken}`),"undefined"!==typeof cc&&cc.sys&&cc.sys.isNative||(K.withCredentials=!0),K}}},11954:(K,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.utf8Length=H.utf8Read=H.ErrorCode=H.Protocol=void 0,function(K){K[K.HANDSHAKE=9]="HANDSHAKE",K[K.JOIN_ROOM=10]="JOIN_ROOM",K[K.ERROR=11]="ERROR",K[K.LEAVE_ROOM=12]="LEAVE_ROOM",K[K.ROOM_DATA=13]="ROOM_DATA",K[K.ROOM_STATE=14]="ROOM_STATE",K[K.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",K[K.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",K[K.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(H.Protocol||(H.Protocol={})),function(K){K[K.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",K[K.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",K[K.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",K[K.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",K[K.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",K[K.AUTH_FAILED=4215]="AUTH_FAILED",K[K.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(H.ErrorCode||(H.ErrorCode={})),H.utf8Read=function(K,H){const M=K[H++];for(var q="",w=0,u=H,y=H+M;u<y;u++){var h=K[u];if(0!==(128&h))if(192!==(224&h))if(224!==(240&h)){if(240!==(248&h))throw new Error("Invalid byte "+h.toString(16));(w=(7&h)<<18|(63&K[++u])<<12|(63&K[++u])<<6|63&K[++u])>=65536?(w-=65536,q+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):q+=String.fromCharCode(w)}else q+=String.fromCharCode((15&h)<<12|(63&K[++u])<<6|63&K[++u]);else q+=String.fromCharCode((31&h)<<6|63&K[++u]);else q+=String.fromCharCode(h)}return q},H.utf8Length=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",H=0,M=0;for(let q=0,w=K.length;q<w;q++)H=K.charCodeAt(q),H<128?M+=1:H<2048?M+=2:H<55296||H>=57344?M+=3:(q++,M+=4);return M+1}},11927:function(K,H,M){"use strict";var q=this&&this.__createBinding||(Object.create?function(K,H,M,q){void 0===q&&(q=M);var w=Object.getOwnPropertyDescriptor(H,M);w&&!("get"in w?!H.__esModule:w.writable||w.configurable)||(w={enumerable:!0,get:function(){return H[M]}}),Object.defineProperty(K,q,w)}:function(K,H,M,q){void 0===q&&(q=M),K[q]=H[M]}),w=this&&this.__setModuleDefault||(Object.create?function(K,H){Object.defineProperty(K,"default",{enumerable:!0,value:H})}:function(K,H){K.default=H}),u=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var H={};if(null!=K)for(var M in K)"default"!==M&&Object.prototype.hasOwnProperty.call(K,M)&&q(H,K,M);return w(H,K),H};Object.defineProperty(H,"__esModule",{value:!0}),H.Room=void 0;const y=u(M(11932)),h=M(11937),W=M(11954),I=M(11963),f=M(11970),z=M(11975),G=M(11977),a=M(11925);class v{constructor(K,H){this.onStateChange=(0,z.createSignal)(),this.onError=(0,z.createSignal)(),this.onLeave=(0,z.createSignal)(),this.onJoin=(0,z.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,f.createNanoEvents)(),this.roomId=null,this.name=K,H&&(this.serializer=new((0,I.getSerializer)("schema")),this.rootSchema=H,this.serializer.state=new H),this.onError(((K,H)=>{var M;return null===(M=console.warn)||void 0===M?void 0:M.call(console,`colyseus.js - onError => (${K}) ${H}`)})),this.onLeave((()=>this.uH()))}get id(){return this.roomId}connect(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,q=arguments.length>3?arguments[3]:void 0;const w=new h.Connection;M.connection=w,w.events.onmessage=v.prototype.onMessageCallback.bind(M),w.events.onclose=function(K){var q;if(!M.hasJoined)return null===(q=console.warn)||void 0===q||q.call(console,`Room connection was closed unexpectedly (${K.code}): ${K.reason}`),void M.onError.invoke(K.code,K.reason);K.code===a.CloseCode.DEVMODE_RESTART&&H?H():(M.onLeave.invoke(K.code,K.reason),M.destroy())},w.events.onerror=function(K){var H;null===(H=console.warn)||void 0===H||H.call(console,`Room, onError (${K.code}): ${K.reason}`),M.onError.invoke(K.code,K.reason)},w.connect(K,q)}gy(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((H=>{this.onLeave((K=>H(K))),this.connection?K?this.connection.send([W.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(a.CloseCode.CONSENTED)}))}QH(K,H){return this.onMessageHandlers.on(this.getMessageHandlerKey(K),H)}send(K,H){const M=[W.Protocol.ROOM_DATA];let q;if("string"===typeof K?G.encode.string(M,K):G.encode.number(M,K),void 0!==H){const K=y.encode(H);q=new Uint8Array(M.length+K.byteLength),q.set(new Uint8Array(M),0),q.set(new Uint8Array(K),M.length)}else q=new Uint8Array(M);this.connection.send(q.buffer)}oW(K,H){const M=[W.Protocol.ROOM_DATA_BYTES];let q;"string"===typeof K?G.encode.string(M,K):G.encode.number(M,K),q=new Uint8Array(M.length+(H.byteLength||H.length)),q.set(new Uint8Array(M),0),q.set(new Uint8Array(H),M.length),this.connection.send(q.buffer)}get state(){return this.serializer.getState()}uH(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(K){const H=Array.from(new Uint8Array(K.data)),M=H[0];if(M===W.Protocol.JOIN_ROOM){let K=1;const M=(0,W.utf8Read)(H,K);if(K+=(0,W.utf8Length)(M),this.serializerId=(0,W.utf8Read)(H,K),K+=(0,W.utf8Length)(this.serializerId),!this.serializer){const K=(0,I.getSerializer)(this.serializerId);this.serializer=new K}H.length>K&&this.serializer.handshake&&this.serializer.handshake(H,{offset:K}),this.reconnectionToken=`${this.roomId}:${M}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([W.Protocol.JOIN_ROOM])}else if(M===W.Protocol.ERROR){const K={offset:1},M=G.decode.number(H,K),q=G.decode.string(H,K);this.onError.invoke(M,q)}else if(M===W.Protocol.LEAVE_ROOM)this.gy();else if(M===W.Protocol.ROOM_DATA_SCHEMA){const K={offset:1},M=this.serializer.getState().constructor._context.get(G.decode.number(H,K)),q=new M;q.decode(H,K),this.dispatchMessage(M,q)}else if(M===W.Protocol.ROOM_STATE)H.shift(),this.setState(H);else if(M===W.Protocol.ROOM_STATE_PATCH)H.shift(),this.patch(H);else if(M===W.Protocol.ROOM_DATA){const M={offset:1},q=G.decode.stringCheck(H,M)?G.decode.string(H,M):G.decode.number(H,M),w=H.length>M.offset?y.decode(K.data,M.offset):void 0;this.dispatchMessage(q,w)}else if(M===W.Protocol.ROOM_DATA_BYTES){const K={offset:1},M=G.decode.stringCheck(H,K)?G.decode.string(H,K):G.decode.number(H,K);this.dispatchMessage(M,new Uint8Array(H.slice(K.offset)))}}setState(K){this.serializer.setState(K),this.onStateChange.invoke(this.serializer.getState())}patch(K){this.serializer.patch(K),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(K,H){var M;const q=this.getMessageHandlerKey(K);this.onMessageHandlers.events[q]?this.onMessageHandlers.emit(q,H):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",K,H):null===(M=console.warn)||void 0===M||M.call(console,`colyseus.js: onMessage() not registered for type '${K}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(K){switch(typeof K){case"function":return`$${K._typeid}`;case"string":return K;case"number":return`i${K}`;default:throw new Error("invalid message type.")}}}H.Room=v},12005:(K,H)=>{"use strict";let M;function q(){if(!M)try{M="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:window.localStorage}catch(K){}return M||(M={cache:{},setItem:function(K,H){this.cache[K]=H},getItem:function(K){this.cache[K]},removeItem:function(K){delete this.cache[K]}}),M}Object.defineProperty(H,"__esModule",{value:!0}),H.getItem=H.removeItem=H.setItem=void 0,H.setItem=function(K,H){q().setItem(K,H)},H.removeItem=function(K){q().removeItem(K)},H.getItem=function(K,H){const M=q().getItem(K);"undefined"!==typeof Promise&&M instanceof Promise?M.then((K=>H(K))):H(M)}},11970:(K,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.createNanoEvents=void 0;H.createNanoEvents=()=>({emit(K){let H=this.events[K]||[];for(var M=arguments.length,q=new Array(M>1?M-1:0),w=1;w<M;w++)q[w-1]=arguments[w];for(let u=0,y=H.length;u<y;u++)H[u](...q)},events:{},on(K,H){var M;return(null===(M=this.events[K])||void 0===M?void 0:M.push(H))||(this.events[K]=[H]),()=>{var M;this.events[K]=null===(M=this.events[K])||void 0===M?void 0:M.filter((K=>H!==K))}}})},11975:(K,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.createSignal=H.EventEmitter=void 0;class M{constructor(){this.handlers=[]}register(K){return this.handlers.push(K),this}invoke(){for(var K=arguments.length,H=new Array(K),M=0;M<K;M++)H[M]=arguments[M];this.handlers.forEach((K=>K.apply(this,H)))}invokeAsync(){for(var K=arguments.length,H=new Array(K),M=0;M<K;M++)H[M]=arguments[M];return Promise.all(this.handlers.map((K=>K.apply(this,H))))}remove(K){const H=this.handlers.indexOf(K);this.handlers[H]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}H.EventEmitter=M,H.createSignal=function(){const K=new M;function H(H){return K.register(H,null===this)}return H.once=H=>{const M=function(){for(var q=arguments.length,w=new Array(q),u=0;u<q;u++)w[u]=arguments[u];H.apply(this,w),K.remove(M)};K.register(M)},H.remove=H=>K.remove(H),H.invoke=function(){return K.invoke(...arguments)},H.invokeAsync=function(){return K.invokeAsync(...arguments)},H.clear=()=>K.clear(),H}},11925:(K,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.ServerError=H.CloseCode=void 0,function(K){K[K.CONSENTED=4e3]="CONSENTED",K[K.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(H.CloseCode||(H.CloseCode={}));class M extends Error{constructor(K,H){super(H),this.name="ServerError",this.code=K}}H.ServerError=M},11910:(K,H,M)=>{"use strict";H.c=void 0,M(11917);var q=M(11923);Object.defineProperty(H,"c",{enumerable:!0,get:function(){return q.Client}});var w=M(11954);var u=M(11927);var y=M(11996);const h=M(12016);const W=M(12024),I=M(11963);(0,I.registerSerializer)("schema",h.SchemaSerializer),(0,I.registerSerializer)("none",W.NoneSerializer)},11917:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=K=>null!==K&&"object"===typeof K&&K.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},11932:(K,H)=>{"use strict";function M(K,H){if(this._offset=H,K instanceof ArrayBuffer)this._buffer=K,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(K))throw new Error("Invalid argument");this._buffer=K.buffer,this._view=new DataView(this._buffer,K.byteOffset,K.byteLength)}}Object.defineProperty(H,"__esModule",{value:!0}),H.decode=H.encode=void 0,M.prototype._array=function(K){for(var H=new Array(K),M=0;M<K;M++)H[M]=this._parse();return H},M.prototype._map=function(K){for(var H={},M=0;M<K;M++)H[this._parse()]=this._parse();return H},M.prototype._str=function(K){var H=function(K,H,M){for(var q="",w=0,u=H,y=H+M;u<y;u++){var h=K.getUint8(u);if(0!==(128&h))if(192!==(224&h))if(224!==(240&h)){if(240!==(248&h))throw new Error("Invalid byte "+h.toString(16));(w=(7&h)<<18|(63&K.getUint8(++u))<<12|(63&K.getUint8(++u))<<6|63&K.getUint8(++u))>=65536?(w-=65536,q+=String.fromCharCode(55296+(w>>>10),56320+(1023&w))):q+=String.fromCharCode(w)}else q+=String.fromCharCode((15&h)<<12|(63&K.getUint8(++u))<<6|63&K.getUint8(++u));else q+=String.fromCharCode((31&h)<<6|63&K.getUint8(++u));else q+=String.fromCharCode(h)}return q}(this._view,this._offset,K);return this._offset+=K,H},M.prototype._bin=function(K){var H=this._buffer.slice(this._offset,this._offset+K);return this._offset+=K,H},M.prototype._parse=function(){var K,H=this._view.getUint8(this._offset++),M=0,q=0,w=0,u=0;if(H<192)return H<128?H:H<144?this._map(15&H):H<160?this._array(15&H):this._str(31&H);if(H>223)return-1*(255-H+1);switch(H){case 192:return null;case 194:return!1;case 195:return!0;case 196:return M=this._view.getUint8(this._offset),this._offset+=1,this._bin(M);case 197:return M=this._view.getUint16(this._offset),this._offset+=2,this._bin(M);case 198:return M=this._view.getUint32(this._offset),this._offset+=4,this._bin(M);case 199:if(M=this._view.getUint8(this._offset),q=this._view.getInt8(this._offset+1),this._offset+=2,-1===q){var y=this._view.getUint32(this._offset);return w=this._view.getInt32(this._offset+4),u=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*w+u)+y/1e6)}return[q,this._bin(M)];case 200:return M=this._view.getUint16(this._offset),q=this._view.getInt8(this._offset+2),this._offset+=3,[q,this._bin(M)];case 201:return M=this._view.getUint32(this._offset),q=this._view.getInt8(this._offset+4),this._offset+=5,[q,this._bin(M)];case 202:return K=this._view.getFloat32(this._offset),this._offset+=4,K;case 203:return K=this._view.getFloat64(this._offset),this._offset+=8,K;case 204:return K=this._view.getUint8(this._offset),this._offset+=1,K;case 205:return K=this._view.getUint16(this._offset),this._offset+=2,K;case 206:return K=this._view.getUint32(this._offset),this._offset+=4,K;case 207:return w=this._view.getUint32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,w+u;case 208:return K=this._view.getInt8(this._offset),this._offset+=1,K;case 209:return K=this._view.getInt16(this._offset),this._offset+=2,K;case 210:return K=this._view.getInt32(this._offset),this._offset+=4,K;case 211:return w=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,w+u;case 212:return q=this._view.getInt8(this._offset),this._offset+=1,0===q?void(this._offset+=1):[q,this._bin(1)];case 213:return q=this._view.getInt8(this._offset),this._offset+=1,[q,this._bin(2)];case 214:return q=this._view.getInt8(this._offset),this._offset+=1,-1===q?(K=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*K)):[q,this._bin(4)];case 215:return q=this._view.getInt8(this._offset),this._offset+=1,0===q?(w=this._view.getInt32(this._offset)*Math.pow(2,32),u=this._view.getUint32(this._offset+4),this._offset+=8,new Date(w+u)):-1===q?(w=this._view.getUint32(this._offset),u=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&w)+u)+(w>>>2)/1e6)):[q,this._bin(8)];case 216:return q=this._view.getInt8(this._offset),this._offset+=1,[q,this._bin(16)];case 217:return M=this._view.getUint8(this._offset),this._offset+=1,this._str(M);case 218:return M=this._view.getUint16(this._offset),this._offset+=2,this._str(M);case 219:return M=this._view.getUint32(this._offset),this._offset+=4,this._str(M);case 220:return M=this._view.getUint16(this._offset),this._offset+=2,this._array(M);case 221:return M=this._view.getUint32(this._offset),this._offset+=4,this._array(M);case 222:return M=this._view.getUint16(this._offset),this._offset+=2,this._map(M);case 223:return M=this._view.getUint32(this._offset),this._offset+=4,this._map(M)}throw new Error("Could not parse")},H.decode=function(K){var H=new M(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),q=H._parse();if(H._offset!==K.byteLength)throw new Error(K.byteLength-H._offset+" trailing bytes");return q};function q(K,H,M){for(var q=0,w=0,u=M.length;w<u;w++)(q=M.charCodeAt(w))<128?K.setUint8(H++,q):q<2048?(K.setUint8(H++,192|q>>6),K.setUint8(H++,128|63&q)):q<55296||q>=57344?(K.setUint8(H++,224|q>>12),K.setUint8(H++,128|q>>6&63),K.setUint8(H++,128|63&q)):(w++,q=65536+((1023&q)<<10|1023&M.charCodeAt(w)),K.setUint8(H++,240|q>>18),K.setUint8(H++,128|q>>12&63),K.setUint8(H++,128|q>>6&63),K.setUint8(H++,128|63&q))}function w(K,H,M){var q=typeof M,u=0,y=0,h=0,W=0,I=0,f=0;if("string"===q){if(I=function(K){for(var H=0,M=0,q=0,w=K.length;q<w;q++)(H=K.charCodeAt(q))<128?M+=1:H<2048?M+=2:H<55296||H>=57344?M+=3:(q++,M+=4);return M}(M),I<32)K.push(160|I),f=1;else if(I<256)K.push(217,I),f=2;else if(I<65536)K.push(218,I>>8,I),f=3;else{if(!(I<4294967296))throw new Error("String too long");K.push(219,I>>24,I>>16,I>>8,I),f=5}return H.push({_str:M,_length:I,_offset:K.length}),f+I}if("number"===q)return Math.floor(M)===M&&isFinite(M)?M>=0?M<128?(K.push(M),1):M<256?(K.push(204,M),2):M<65536?(K.push(205,M>>8,M),3):M<4294967296?(K.push(206,M>>24,M>>16,M>>8,M),5):(h=M/Math.pow(2,32)|0,W=M>>>0,K.push(207,h>>24,h>>16,h>>8,h,W>>24,W>>16,W>>8,W),9):M>=-32?(K.push(M),1):M>=-128?(K.push(208,M),2):M>=-32768?(K.push(209,M>>8,M),3):M>=-2147483648?(K.push(210,M>>24,M>>16,M>>8,M),5):(h=Math.floor(M/Math.pow(2,32)),W=M>>>0,K.push(211,h>>24,h>>16,h>>8,h,W>>24,W>>16,W>>8,W),9):(K.push(203),H.push({_float:M,_length:8,_offset:K.length}),9);if("object"===q){if(null===M)return K.push(192),1;if(Array.isArray(M)){if((I=M.length)<16)K.push(144|I),f=1;else if(I<65536)K.push(220,I>>8,I),f=3;else{if(!(I<4294967296))throw new Error("Array too large");K.push(221,I>>24,I>>16,I>>8,I),f=5}for(u=0;u<I;u++)f+=w(K,H,M[u]);return f}if(M instanceof Date){var z=M.getTime(),G=Math.floor(z/1e3),a=1e6*(z-1e3*G);return G>=0&&a>=0&&G<=17179869183?0===a&&G<=4294967295?(K.push(214,255,G>>24,G>>16,G>>8,G),6):(h=G/4294967296,W=4294967295&G,K.push(215,255,a>>22,a>>14,a>>6,h,W>>24,W>>16,W>>8,W),10):(h=Math.floor(G/4294967296),W=G>>>0,K.push(199,12,255,a>>24,a>>16,a>>8,a,h>>24,h>>16,h>>8,h,W>>24,W>>16,W>>8,W),15)}if(M instanceof ArrayBuffer){if((I=M.byteLength)<256)K.push(196,I),f=2;else if(I<65536)K.push(197,I>>8,I),f=3;else{if(!(I<4294967296))throw new Error("Buffer too large");K.push(198,I>>24,I>>16,I>>8,I),f=5}return H.push({_bin:M,_length:I,_offset:K.length}),f+I}if("function"===typeof M.toJSON)return w(K,H,M.toJSON());var v=[],O="",L=Object.keys(M);for(u=0,y=L.length;u<y;u++)void 0!==M[O=L[u]]&&"function"!==typeof M[O]&&v.push(O);if((I=v.length)<16)K.push(128|I),f=1;else if(I<65536)K.push(222,I>>8,I),f=3;else{if(!(I<4294967296))throw new Error("Object too large");K.push(223,I>>24,I>>16,I>>8,I),f=5}for(u=0;u<I;u++)f+=w(K,H,O=v[u]),f+=w(K,H,M[O]);return f}if("boolean"===q)return K.push(M?195:194),1;if("undefined"===q)return K.push(192),1;if("function"===typeof M.toJSON)return w(K,H,M.toJSON());throw new Error("Could not encode")}H.encode=function(K){var H=[],M=[],u=w(H,M,K),y=new ArrayBuffer(u),h=new DataView(y),W=0,I=0,f=-1;M.length>0&&(f=M[0]._offset);for(var z,G=0,a=0,v=0,O=H.length;v<O;v++)if(h.setUint8(I+v,H[v]),v+1===f){if(G=(z=M[W])._length,a=I+f,z._bin)for(var L=new Uint8Array(z._bin),S=0;S<G;S++)h.setUint8(a+S,L[S]);else z._str?q(h,a,z._str):void 0!==z._float&&h.setFloat64(a,z._float);I+=G,M[++W]&&(f=M[W]._offset)}return y}},12024:(K,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.NoneSerializer=void 0;H.NoneSerializer=class{setState(K){}getState(){return null}patch(K){}teardown(){}handshake(K){}}},12016:(K,H,M)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.SchemaSerializer=void 0;const q=M(11977);H.SchemaSerializer=class{setState(K){return this.state.decode(K)}getState(){return this.state}patch(K){return this.state.decode(K)}teardown(){var K,H;null===(H=null===(K=this.state)||void 0===K?void 0:K.$changes)||void 0===H||H.root.clearRefs()}handshake(K,H){if(this.state){(new q.Reflection).decode(K,H)}else this.state=q.Reflection.decode(K,H)}}},11963:(K,H)=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0}),H.getSerializer=H.registerSerializer=void 0;const M={};H.registerSerializer=function(K,H){M[K]=H},H.getSerializer=function(K){const H=M[K];if(!H)throw new Error("missing serializer: "+K);return H}},11946:function(K,H,M){"use strict";var q=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(H,"__esModule",{value:!0}),H.WebSocketTransport=void 0;const w=q(M(11949)),u=globalThis.WebSocket||w.default;H.WebSocketTransport=class{constructor(K){this.events=K}send(K){K instanceof ArrayBuffer?this.ws.send(K):Array.isArray(K)&&this.ws.send(new Uint8Array(K).buffer)}connect(K,H){try{this.ws=new u(K,{headers:H,protocols:this.protocols})}catch(M){this.ws=new u(K,this.protocols)}this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(K,H){this.ws.close(K,H)}get isOpen(){return this.ws.readyState===u.OPEN}}},11949:K=>{"use strict";K.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12406:K=>{"use strict";K.exports=function(K){for(var H=new Array(K),M=0;M<K;++M)H[M]=M;return H}},12408:K=>{function H(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(H(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&H(K.slice(0,0))}(K)||!!K._isBuffer)}},12402:(K,H,M)=>{var q=M(12406),w=M(12408),u="undefined"!==typeof Float64Array;function y(K,H){return K[0]-H[0]}function h(){var K,H=this.stride,M=new Array(H.length);for(K=0;K<M.length;++K)M[K]=[Math.abs(H[K]),K];M.sort(y);var q=new Array(M.length);for(K=0;K<q.length;++K)q[K]=M[K][1];return q}function W(K,H){var M=["View",H,"d",K].join("");H<0&&(M="View_Nil"+K);var w="generic"===K;if(-1===H){var u="function "+M+"(a){this.data=a;};var proto="+M+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+M+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+M+"(a){return new "+M+"(a);}";return new Function(u)()}if(0===H){u="function "+M+"(a,d) {this.data = a;this.offset = d};var proto="+M+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+M+"_copy() {return new "+M+"(this.data,this.offset)};proto.pick=function "+M+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+M+"_get(){return "+(w?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+M+"_set(v){return "+(w?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+M+"(a,b,c,d){return new "+M+"(a,d)}";return new Function("TrivialArray",u)(I[K][0])}u=["'use strict'"];var y=q(H),W=y.map((function(K){return"i"+K})),f="this.offset+"+y.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),z=y.map((function(K){return"b"+K})).join(","),G=y.map((function(K){return"c"+K})).join(",");u.push("function "+M+"(a,"+z+","+G+",d){this.data=a","this.shape=["+z+"]","this.stride=["+G+"]","this.offset=d|0}","var proto="+M+".prototype","proto.dtype='"+K+"'","proto.dimension="+H),u.push("Object.defineProperty(proto,'size',{get:function "+M+"_size(){return "+y.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===H?u.push("proto.order=[0]"):(u.push("Object.defineProperty(proto,'order',{get:"),H<4?(u.push("function "+M+"_order(){"),2===H?u.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===H&&u.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):u.push("ORDER})")),u.push("proto.set=function "+M+"_set("+W.join(",")+",v){"),w?u.push("return this.data.set("+f+",v)}"):u.push("return this.data["+f+"]=v}"),u.push("proto.get=function "+M+"_get("+W.join(",")+"){"),w?u.push("return this.data.get("+f+")}"):u.push("return this.data["+f+"]}"),u.push("proto.index=function "+M+"_index(",W.join(),"){return "+f+"}"),u.push("proto.hi=function "+M+"_hi("+W.join(",")+"){return new "+M+"(this.data,"+y.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+y.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var a=y.map((function(K){return"a"+K+"=this.shape["+K+"]"})),v=y.map((function(K){return"c"+K+"=this.stride["+K+"]"}));u.push("proto.lo=function "+M+"_lo("+W.join(",")+"){var b=this.offset,d=0,"+a.join(",")+","+v.join(","));for(var O=0;O<H;++O)u.push("if(typeof i"+O+"==='number'&&i"+O+">=0){d=i"+O+"|0;b+=c"+O+"*d;a"+O+"-=d}");u.push("return new "+M+"(this.data,"+y.map((function(K){return"a"+K})).join(",")+","+y.map((function(K){return"c"+K})).join(",")+",b)}"),u.push("proto.step=function "+M+"_step("+W.join(",")+"){var "+y.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+y.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(O=0;O<H;++O)u.push("if(typeof i"+O+"==='number'){d=i"+O+"|0;if(d<0){c+=b"+O+"*(a"+O+"-1);a"+O+"=ceil(-a"+O+"/d)}else{a"+O+"=ceil(a"+O+"/d)}b"+O+"*=d}");u.push("return new "+M+"(this.data,"+y.map((function(K){return"a"+K})).join(",")+","+y.map((function(K){return"b"+K})).join(",")+",c)}");var L=new Array(H),S=new Array(H);for(O=0;O<H;++O)L[O]="a[i"+O+"]",S[O]="b[i"+O+"]";u.push("proto.transpose=function "+M+"_transpose("+W+"){"+W.map((function(K,H){return K+"=("+K+"===undefined?"+H+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+M+"(this.data,"+L.join(",")+","+S.join(",")+",this.offset)}"),u.push("proto.pick=function "+M+"_pick("+W+"){var a=[],b=[],c=this.offset");for(O=0;O<H;++O)u.push("if(typeof i"+O+"==='number'&&i"+O+">=0){c=(c+this.stride["+O+"]*i"+O+")|0}else{a.push(this.shape["+O+"]);b.push(this.stride["+O+"])}");return u.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),u.push("return function construct_"+M+"(data,shape,stride,offset){return new "+M+"(data,"+y.map((function(K){return"shape["+K+"]"})).join(",")+","+y.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",u.join("\n"))(I[K],h)}var I={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,H,M,q){if(void 0===K)return(0,I.array[0])([]);"number"===typeof K&&(K=[K]),void 0===H&&(H=[K.length]);var y=H.length;if(void 0===M){M=new Array(y);for(var h=y-1,f=1;h>=0;--h)M[h]=f,f*=H[h]}if(void 0===q){q=0;for(h=0;h<y;++h)M[h]<0&&(q-=(H[h]-1)*M[h])}for(var z=function(K){if(w(K))return"buffer";if(u)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),G=I[z];G.length<=y+1;)G.push(W(z,G.length-1));return(0,G[y+1])(K,H,M,q)}},13388:K=>{var H;self,H=()=>(()=>{"use strict";var K={d:(H,M)=>{for(var q in M)K.o(M,q)&&!K.o(H,q)&&Object.defineProperty(H,q,{enumerable:!0,get:M[q]})},o:(K,H)=>Object.prototype.hasOwnProperty.call(K,H)},H={};K.d(H,{default:()=>x});var M,q=function(K,H){var M=H.x-K.x,q=H.y-K.y;return Math.sqrt(M*M+q*q)},w=function(K){return K*(Math.PI/180)},u=new Map,y=function(K){u.has(K)&&clearTimeout(u.get(K)),u.set(K,setTimeout(K,100))},h=function(K,H,M){for(var q,w=H.split(/[ ,]+/g),u=0;u<w.length;u+=1)q=w[u],K.addEventListener?K.addEventListener(q,M,!1):K.attachEvent&&K.attachEvent(q,M)},W=function(K,H,M){for(var q,w=H.split(/[ ,]+/g),u=0;u<w.length;u+=1)q=w[u],K.removeEventListener?K.removeEventListener(q,M):K.detachEvent&&K.detachEvent(q,M)},I=function(K){return K.preventDefault(),K.type.match(/^touch/)?K.changedTouches:K},f=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},z=function(K,H){H.top||H.right||H.bottom||H.left?(K.style.top=H.top,K.style.right=H.right,K.style.bottom=H.bottom,K.style.left=H.left):(K.style.left=H.x+"px",K.style.top=H.y+"px")},G=function(K,H,M){var q=a(K);for(var w in q)if(q.hasOwnProperty(w))if("string"==typeof H)q[w]=H+" "+M;else{for(var u="",y=0,h=H.length;y<h;y+=1)u+=H[y]+" "+M+", ";q[w]=u.slice(0,-2)}return q},a=function(K){var H={};return H[K]="",["webkit","Moz","o"].forEach((function(M){H[M+K.charAt(0).toUpperCase()+K.slice(1)]=""})),H},v=function(K,H){for(var M in H)H.hasOwnProperty(M)&&(K[M]=H[M]);return K},O=function(K,H){if(K.length)for(var M=0,q=K.length;M<q;M+=1)H(K[M]);else H(K)},L="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,S=window.matchMedia("(any-hover: none)").matches,B=!!("ontouchstart"in window),C=!!window.PointerEvent,i=!!window.MSPointerEvent,Z={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},E={start:"mousedown",move:"mousemove",end:"mouseup"},l={};function s(){}L&&!S?M=Z:C?M={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:i?M={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:B?(M=Z,l=E):M=E,s.prototype.on=function(K,H){var M,q=this,w=K.split(/[ ,]+/g);q._handlers_=q._handlers_||{};for(var u=0;u<w.length;u+=1)M=w[u],q._handlers_[M]=q._handlers_[M]||[],q._handlers_[M].push(H);return q},s.prototype.off=function(K,H){var M=this;return M._handlers_=M._handlers_||{},void 0===K?M._handlers_={}:void 0===H?M._handlers_[K]=null:M._handlers_[K]&&M._handlers_[K].indexOf(H)>=0&&M._handlers_[K].splice(M._handlers_[K].indexOf(H),1),M},s.prototype.trigger=function(K,H){var M,q=this,w=K.split(/[ ,]+/g);q._handlers_=q._handlers_||{};for(var u=0;u<w.length;u+=1)M=w[u],q._handlers_[M]&&q._handlers_[M].length&&q._handlers_[M].forEach((function(K){K.call(q,{type:M,target:q},H)}))},s.prototype.config=function(K){var H=this;H.options=H.defaults||{},K&&(H.options=function(K,H){var M={};for(var q in K)K.hasOwnProperty(q)&&H.hasOwnProperty(q)?M[q]=H[q]:K.hasOwnProperty(q)&&(M[q]=K[q]);return M}(H.options,K))},s.prototype.bindEvt=function(K,H){var q=this;return q._domHandlers_=q._domHandlers_||{},q._domHandlers_[H]=function(){"function"==typeof q["on"+H]?q["on"+H].apply(q,arguments):console.warn('[WARNING] : Missing "on'+H+'" handler.')},h(K,M[H],q._domHandlers_[H]),l[H]&&h(K,l[H],q._domHandlers_[H]),q},s.prototype.unbindEvt=function(K,H){var q=this;return q._domHandlers_=q._domHandlers_||{},W(K,M[H],q._domHandlers_[H]),l[H]&&W(K,l[H],q._domHandlers_[H]),delete q._domHandlers_[H],this};const D=s;function V(K,H){return this.identifier=H.identifier,this.position=H.position,this.frontPosition=H.frontPosition,this.collection=K,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(H),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=V.id,V.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}V.prototype=new D,V.constructor=V,V.id=0,V.prototype.buildEl=function(K){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},V.prototype.stylize=function(){if(this.options.dataOnly)return this;var K=this.options.fadeTime+"ms",H=function(){var K=a("borderRadius");for(var H in K)K.hasOwnProperty(H)&&(K[H]="50%");return K}(),M=G("transition","opacity",K),q={};return q.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},q.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},q.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},v(q.el,M),"circle"===this.options.shape&&v(q.back,H),v(q.front,H),this.applyStyles(q),this},V.prototype.applyStyles=function(K){for(var H in this.ui)if(this.ui.hasOwnProperty(H))for(var M in K[H])this.ui[H].style[M]=K[H][M];return this},V.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},V.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},V.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},V.prototype.show=function(K){var H=this;return H.options.dataOnly||(clearTimeout(H.removeTimeout),clearTimeout(H.showTimeout),clearTimeout(H.restTimeout),H.addToDom(),H.restCallback(),setTimeout((function(){H.ui.el.style.opacity=1}),0),H.showTimeout=setTimeout((function(){H.trigger("shown",H.instance),"function"==typeof K&&K.call(this)}),H.options.fadeTime)),H},V.prototype.hide=function(K){var H=this;if(H.options.dataOnly)return H;if(H.ui.el.style.opacity=H.options.restOpacity,clearTimeout(H.removeTimeout),clearTimeout(H.showTimeout),clearTimeout(H.restTimeout),H.removeTimeout=setTimeout((function(){var M="dynamic"===H.options.mode?"none":"block";H.ui.el.style.display=M,"function"==typeof K&&K.call(H),H.trigger("hidden",H.instance)}),H.options.fadeTime),H.options.restJoystick){var M=H.options.restJoystick,q={};q.x=!0===M||!1!==M.x?0:H.instance.frontPosition.x,q.y=!0===M||!1!==M.y?0:H.instance.frontPosition.y,H.setPosition(K,q)}return H},V.prototype.setPosition=function(K,H){var M=this;M.frontPosition={x:H.x,y:H.y};var q=M.options.fadeTime+"ms",w={};w.front=G("transition",["transform"],q);var u={front:{}};u.front={transform:"translate("+M.frontPosition.x+"px,"+M.frontPosition.y+"px)"},M.applyStyles(w),M.applyStyles(u),M.restTimeout=setTimeout((function(){"function"==typeof K&&K.call(M),M.restCallback()}),M.options.fadeTime)},V.prototype.restCallback=function(){var K=this,H={};H.front=G("transition","none",""),K.applyStyles(H),K.trigger("rested",K.instance)},V.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},V.prototype.computeDirection=function(K){var H,M,q,w=K.angle.radian,u=Math.PI/4,y=Math.PI/2;if(w>u&&w<3*u&&!K.lockX?H="up":w>-u&&w<=u&&!K.lockY?H="left":w>3*-u&&w<=-u&&!K.lockX?H="down":K.lockY||(H="right"),K.lockY||(M=w>-y&&w<y?"left":"right"),K.lockX||(q=w>0?"up":"down"),K.force>this.options.threshold){var h,W={};for(h in this.direction)this.direction.hasOwnProperty(h)&&(W[h]=this.direction[h]);var I={};for(h in this.direction={x:M,y:q,angle:H},K.direction=this.direction,W)W[h]===this.direction[h]&&(I[h]=!0);if(I.x&&I.y&&I.angle)return K;I.x&&I.y||this.trigger("plain",K),I.x||this.trigger("plain:"+M,K),I.y||this.trigger("plain:"+q,K),I.angle||this.trigger("dir dir:"+H,K)}else this.resetDirection();return K};const n=V;function c(K,H){var M=this;M.nipples=[],M.idles=[],M.actives=[],M.ids=[],M.pressureIntervals={},M.manager=K,M.id=c.id,c.id+=1,M.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},M.config(H),"static"!==M.options.mode&&"semi"!==M.options.mode||(M.options.multitouch=!1),M.options.multitouch||(M.options.maxNumberOfNipples=1);var q=getComputedStyle(M.options.zone.parentElement);return q&&"flex"===q.display&&(M.parentIsFlex=!0),M.updateBox(),M.prepareNipples(),M.VG(),M.begin(),M.nipples}c.prototype=new D,c.constructor=c,c.id=0,c.prototype.prepareNipples=function(){var K=this,H=K.nipples;H.on=K.on.bind(K),H.off=K.off.bind(K),H.options=K.options,H.destroy=K.destroy.bind(K),H.ids=K.ids,H.id=K.id,H.processOnMove=K.processOnMove.bind(K),H.processOnEnd=K.processOnEnd.bind(K),H.get=function(K){if(void 0===K)return H[0];for(var M=0,q=H.length;M<q;M+=1)if(H[M].identifier===K)return H[M];return!1}},c.prototype.VG=function(){var K=this;K.bindEvt(K.options.zone,"start"),K.options.zone.style.touchAction="none",K.options.zone.style.msTouchAction="none"},c.prototype.begin=function(){var K=this,H=K.options;if("static"===H.mode){var M=K.createNipple(H.position,K.manager.getIdentifier());M.add(),K.idles.push(M)}},c.prototype.createNipple=function(K,H){var M=this,q=M.manager.scroll,w={},u=M.options,y=M.parentIsFlex?q.x:q.x+M.box.left,h=M.parentIsFlex?q.y:q.y+M.box.top;if(K.x&&K.y)w={x:K.x-y,y:K.y-h};else if(K.top||K.right||K.bottom||K.left){var W=document.createElement("DIV");W.style.display="hidden",W.style.top=K.top,W.style.right=K.right,W.style.bottom=K.bottom,W.style.left=K.left,W.style.position="absolute",u.zone.appendChild(W);var I=W.getBoundingClientRect();u.zone.removeChild(W),w=K,K={x:I.left+q.x,y:I.top+q.y}}var f=new n(M,{color:u.color,size:u.size,threshold:u.threshold,fadeTime:u.fadeTime,dataOnly:u.dataOnly,restJoystick:u.restJoystick,restOpacity:u.restOpacity,mode:u.mode,identifier:H,position:K,zone:u.zone,frontPosition:{x:0,y:0},shape:u.shape});return u.dataOnly||(z(f.ui.el,w),z(f.ui.front,f.frontPosition)),M.nipples.push(f),M.trigger("added "+f.identifier+":added",f),M.manager.trigger("added "+f.identifier+":added",f),M.bindNipple(f),f},c.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},c.prototype.bindNipple=function(K){var H,M=this,q=function(K,q){H=K.type+" "+q.id+":"+K.type,M.trigger(H,q)};K.on("destroyed",M.onDestroyed.bind(M)),K.on("shown hidden rested dir plain",q),K.on("dir:up dir:right dir:down dir:left",q),K.on("plain:up plain:right plain:down plain:left",q)},c.prototype.pressureFn=function(K,H,M){var q=this,w=0;clearInterval(q.pressureIntervals[M]),q.pressureIntervals[M]=setInterval(function(){var M=K.force||K.pressure||K.webkitForce||0;M!==w&&(H.trigger("pressure",M),q.trigger("pressure "+H.identifier+":pressure",M),w=M)}.bind(q),100)},c.prototype.onstart=function(K){var H=this,M=H.options,q=K;return K=I(K),H.updateBox(),O(K,(function(w){H.actives.length<M.maxNumberOfNipples?H.processOnStart(w):q.type.match(/^touch/)&&(Object.keys(H.manager.ids).forEach((function(M){if(Object.values(q.touches).findIndex((function(K){return K.identifier===M}))<0){var w=[K[0]];w.identifier=M,H.processOnEnd(w)}})),H.actives.length<M.maxNumberOfNipples&&H.processOnStart(w))})),H.manager.bindDocument(),!1},c.prototype.processOnStart=function(K){var H,M=this,w=M.options,u=M.manager.getIdentifier(K),y=K.force||K.pressure||K.webkitForce||0,h={x:K.pageX,y:K.pageY},W=M.getOrCreate(u,h);W.identifier!==u&&M.manager.removeIdentifier(W.identifier),W.identifier=u;var I=function(H){H.trigger("start",H),M.trigger("start "+H.id+":start",H),H.show(),y>0&&M.pressureFn(K,H,H.identifier),M.processOnMove(K)};if((H=M.idles.indexOf(W))>=0&&M.idles.splice(H,1),M.actives.push(W),M.ids.push(W.identifier),"semi"!==w.mode)I(W);else{if(!(q(h,W.position)<=w.catchDistance))return W.destroy(),void M.processOnStart(K);I(W)}return W},c.prototype.getOrCreate=function(K,H){var M,q=this,w=q.options;return/(semi|static)/.test(w.mode)?(M=q.idles[0])?(q.idles.splice(0,1),M):"semi"===w.mode?q.createNipple(H,K):(console.warn("Coudln't find the needed nipple."),!1):M=q.createNipple(H,K)},c.prototype.processOnMove=function(K){var H=this,M=H.options,u=H.manager.getIdentifier(K),y=H.nipples.get(u),h=H.manager.scroll;if(function(K){return isNaN(K.buttons)?0!==K.pressure:0!==K.buttons}(K)){if(!y)return console.error("Found zombie joystick with ID "+u),void H.manager.removeIdentifier(u);if(M.dynamicPage){var W=y.el.getBoundingClientRect();y.position={x:h.x+W.left,y:h.y+W.top}}y.identifier=u;var I=y.options.size/2,f={x:K.pageX,y:K.pageY};M.lockX&&(f.y=y.position.y),M.lockY&&(f.x=y.position.x);var z,G,a,v,O,L,S,B,C,i,Z=q(f,y.position),E=(z=f,a=(G=y.position).x-z.x,v=G.y-z.y,function(K){return K*(180/Math.PI)}(Math.atan2(v,a))),l=w(E),s=Z/I,D={distance:Z,position:f};if("circle"===y.options.shape?(O=Math.min(Z,I),S=y.position,B=O,i={x:0,y:0},C=w(C=E),i.x=S.x-B*Math.cos(C),i.y=S.y-B*Math.sin(C),L=i):(L=function(K,H,M){return{x:Math.min(Math.max(K.x,H.x-M),H.x+M),y:Math.min(Math.max(K.y,H.y-M),H.y+M)}}(f,y.position,I),O=q(L,y.position)),M.follow){if(Z>I){var V=f.x-L.x,n=f.y-L.y;y.position.x+=V,y.position.y+=n,y.el.style.top=y.position.y-(H.box.top+h.y)+"px",y.el.style.left=y.position.x-(H.box.left+h.x)+"px",Z=q(f,y.position)}}else f=L,Z=O;var c=f.x-y.position.x,k=f.y-y.position.y;y.frontPosition={x:c,y:k},M.dataOnly||(y.ui.front.style.transform="translate("+c+"px,"+k+"px)");var T={identifier:y.identifier,position:f,force:s,pressure:K.force||K.pressure||K.webkitForce||0,distance:Z,angle:{radian:l,degree:E},vector:{x:c/I,y:-k/I},raw:D,instance:y,lockX:M.lockX,lockY:M.lockY};(T=y.computeDirection(T)).angle={radian:w(180-E),degree:180-E},y.trigger("move",T),H.trigger("move "+y.id+":move",T)}else this.processOnEnd(K)},c.prototype.processOnEnd=function(K){var H=this,M=H.options,q=H.manager.getIdentifier(K),w=H.nipples.get(q),u=H.manager.removeIdentifier(w.identifier);w&&(M.dataOnly||w.hide((function(){"dynamic"===M.mode&&(w.trigger("removed",w),H.trigger("removed "+w.id+":removed",w),H.manager.trigger("removed "+w.id+":removed",w),w.destroy())})),clearInterval(H.pressureIntervals[w.identifier]),w.resetDirection(),w.trigger("end",w),H.trigger("end "+w.id+":end",w),H.ids.indexOf(w.identifier)>=0&&H.ids.splice(H.ids.indexOf(w.identifier),1),H.actives.indexOf(w)>=0&&H.actives.splice(H.actives.indexOf(w),1),/(semi|static)/.test(M.mode)?H.idles.push(w):H.nipples.indexOf(w)>=0&&H.nipples.splice(H.nipples.indexOf(w),1),H.manager.unbindDocument(),/(semi|static)/.test(M.mode)&&(H.manager.ids[u.id]=u.identifier))},c.prototype.onDestroyed=function(K,H){var M=this;M.nipples.indexOf(H)>=0&&M.nipples.splice(M.nipples.indexOf(H),1),M.actives.indexOf(H)>=0&&M.actives.splice(M.actives.indexOf(H),1),M.idles.indexOf(H)>=0&&M.idles.splice(M.idles.indexOf(H),1),M.ids.indexOf(H.identifier)>=0&&M.ids.splice(M.ids.indexOf(H.identifier),1),M.manager.removeIdentifier(H.identifier),M.manager.unbindDocument()},c.prototype.destroy=function(){var K=this;for(var H in K.unbindEvt(K.options.zone,"start"),K.nipples.forEach((function(K){K.destroy()})),K.pressureIntervals)K.pressureIntervals.hasOwnProperty(H)&&clearInterval(K.pressureIntervals[H]);K.trigger("destroyed",K.nipples),K.manager.unbindDocument(),K.off()};const k=c;function T(K){var H=this;H.ids={},H.index=0,H.collections=[],H.scroll=f(),H.config(K),H.prepareCollections();var M=function(){var K;H.collections.forEach((function(M){M.forEach((function(M){K=M.el.getBoundingClientRect(),M.position={x:H.scroll.x+K.left,y:H.scroll.y+K.top}}))}))};h(window,"resize",(function(){y(M)}));var q=function(){H.scroll=f()};return h(window,"scroll",(function(){y(q)})),H.collections}T.prototype=new D,T.constructor=T,T.prototype.prepareCollections=function(){var K=this;K.collections.create=K.create.bind(K),K.collections.on=K.on.bind(K),K.collections.off=K.off.bind(K),K.collections.destroy=K.destroy.bind(K),K.collections.get=function(H){var M;return K.collections.every((function(K){return!(M=K.get(H))})),M}},T.prototype.create=function(K){return this.createCollection(K)},T.prototype.createCollection=function(K){var H=this,M=new k(H,K);return H.bindCollection(M),H.collections.push(M),M},T.prototype.bindCollection=function(K){var H,M=this,q=function(K,q){H=K.type+" "+q.id+":"+K.type,M.trigger(H,q)};K.on("destroyed",M.onDestroyed.bind(M)),K.on("shown hidden rested dir plain",q),K.on("dir:up dir:right dir:down dir:left",q),K.on("plain:up plain:right plain:down plain:left",q)},T.prototype.bindDocument=function(){var K=this;K.binded||(K.bindEvt(document,"move").bindEvt(document,"end"),K.binded=!0)},T.prototype.unbindDocument=function(K){var H=this;Object.keys(H.ids).length&&!0!==K||(H.unbindEvt(document,"move").unbindEvt(document,"end"),H.binded=!1)},T.prototype.getIdentifier=function(K){var H;return K?void 0===(H=void 0===K.identifier?K.pointerId:K.identifier)&&(H=this.latest||0):H=this.index,void 0===this.ids[H]&&(this.ids[H]=this.index,this.index+=1),this.latest=H,this.ids[H]},T.prototype.removeIdentifier=function(K){var H={};for(var M in this.ids)if(this.ids[M]===K){H.id=M,H.identifier=this.ids[M],delete this.ids[M];break}return H},T.prototype.onmove=function(K){return this.onAny("move",K),!1},T.prototype.onend=function(K){return this.onAny("end",K),!1},T.prototype.oncancel=function(K){return this.onAny("end",K),!1},T.prototype.onAny=function(K,H){var M,q=this,w="processOn"+K.charAt(0).toUpperCase()+K.slice(1);H=I(H);var u=function(K,H,M){M.ids.indexOf(H)>=0&&(M[w](K),K._found_=!0)};return O(H,(function(K){M=q.getIdentifier(K),O(q.collections,u.bind(null,K,M)),K._found_||q.removeIdentifier(M)})),!1},T.prototype.destroy=function(){var K=this;K.unbindDocument(!0),K.ids={},K.index=0,K.collections.forEach((function(K){K.destroy()})),K.off()},T.prototype.onDestroyed=function(K,H){var M=this;if(M.collections.indexOf(H)<0)return!1;M.collections.splice(M.collections.indexOf(H),1)};var d=new T;const x={create:function(K){return d.create(K)},factory:d};return H.default})(),K.exports=H()},12417:(K,H,M)=>{"use strict";const{Deflate:q,deflate:w,deflateRaw:u,gzip:y}=M(12421),{Inflate:h,inflate:W,inflateRaw:I,ungzip:f}=M(12477),z=M(12450);K.exports.Deflate=q,K.exports.deflate=w,K.exports.deflateRaw=u,K.exports.gzip=y,K.exports.Inflate=h,K.exports.inflate=W,K.exports.inflateRaw=I,K.exports.ungzip=f,K.exports.constants=z},12421:(K,H,M)=>{"use strict";const q=M(12429),w=M(12458),u=M(12460),y=M(12448),h=M(12469),W=Object.prototype.toString,{Z_NO_FLUSH:I,Z_SYNC_FLUSH:f,Z_FULL_FLUSH:z,Z_FINISH:G,Z_OK:a,Z_STREAM_END:v,Z_DEFAULT_COMPRESSION:O,Z_DEFAULT_STRATEGY:L,Z_DEFLATED:S}=M(12450);function B(K){this.options=w.assign({level:O,method:S,RK:16384,windowBits:15,memLevel:8,strategy:L},K||{});let H=this.options;H.raw&&H.windowBits>0?H.windowBits=-H.windowBits:H.gzip&&H.windowBits>0&&H.windowBits<16&&(H.windowBits+=16),this.err=0,this.fH="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;let M=q.deflateInit2(this.strm,H.level,H.method,H.windowBits,H.memLevel,H.strategy);if(M!==a)throw new Error(y[M]);if(H.header&&q.deflateSetHeader(this.strm,H.header),H.dictionary){let K;if(K="string"===typeof H.dictionary?u.string2buf(H.dictionary):"[object ArrayBuffer]"===W.call(H.dictionary)?new Uint8Array(H.dictionary):H.dictionary,M=q.deflateSetDictionary(this.strm,K),M!==a)throw new Error(y[M]);this._dict_set=!0}}function C(K,H){const M=new B(H);if(M.push(K,!0),M.err)throw M.fH||y[M.err];return M.result}B.prototype.push=function(K,H){const M=this.strm,w=this.options.RK;let y,h;if(this.ended)return!1;for(h=H===~~H?H:!0===H?G:I,"string"===typeof K?M.input=u.string2buf(K):"[object ArrayBuffer]"===W.call(K)?M.input=new Uint8Array(K):M.input=K,M.next_in=0,M.avail_in=M.input.length;;)if(0===M.avail_out&&(M.output=new Uint8Array(w),M.next_out=0,M.avail_out=w),(h===f||h===z)&&M.avail_out<=6)this.onData(M.output.subarray(0,M.next_out)),M.avail_out=0;else{if(y=q.deflate(M,h),y===v)return M.next_out>0&&this.onData(M.output.subarray(0,M.next_out)),y=q.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===a;if(0!==M.avail_out){if(h>0&&M.next_out>0)this.onData(M.output.subarray(0,M.next_out)),M.avail_out=0;else if(0===M.avail_in)break}else this.onData(M.output)}return!0},B.prototype.onData=function(K){this.chunks.push(K)},B.prototype.onEnd=function(K){K===a&&(this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.fH=this.strm.fH},K.exports.Deflate=B,K.exports.deflate=C,K.exports.deflateRaw=function(K,H){return(H=H||{}).raw=!0,C(K,H)},K.exports.gzip=function(K,H){return(H=H||{}).gzip=!0,C(K,H)},K.exports.constants=M(12450)},12477:(K,H,M)=>{"use strict";const q=M(12486),w=M(12458),u=M(12460),y=M(12448),h=M(12469),W=M(12506),I=Object.prototype.toString,{Z_NO_FLUSH:f,Z_FINISH:z,Z_OK:G,Z_STREAM_END:a,Z_NEED_DICT:v,Z_STREAM_ERROR:O,Z_DATA_ERROR:L,Z_MEM_ERROR:S}=M(12450);function B(K){this.options=w.assign({RK:65536,windowBits:15,to:""},K||{});const H=this.options;H.raw&&H.windowBits>=0&&H.windowBits<16&&(H.windowBits=-H.windowBits,0===H.windowBits&&(H.windowBits=-15)),!(H.windowBits>=0&&H.windowBits<16)||K&&K.windowBits||(H.windowBits+=32),H.windowBits>15&&H.windowBits<48&&0===(15&H.windowBits)&&(H.windowBits|=15),this.err=0,this.fH="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;let M=q.inflateInit2(this.strm,H.windowBits);if(M!==G)throw new Error(y[M]);if(this.header=new W,q.inflateGetHeader(this.strm,this.header),H.dictionary&&("string"===typeof H.dictionary?H.dictionary=u.string2buf(H.dictionary):"[object ArrayBuffer]"===I.call(H.dictionary)&&(H.dictionary=new Uint8Array(H.dictionary)),H.raw&&(M=q.inflateSetDictionary(this.strm,H.dictionary),M!==G)))throw new Error(y[M])}function C(K,H){const M=new B(H);if(M.push(K),M.err)throw M.fH||y[M.err];return M.result}B.prototype.push=function(K,H){const M=this.strm,w=this.options.RK,y=this.options.dictionary;let h,W,B;if(this.ended)return!1;for(W=H===~~H?H:!0===H?z:f,"[object ArrayBuffer]"===I.call(K)?M.input=new Uint8Array(K):M.input=K,M.next_in=0,M.avail_in=M.input.length;;){for(0===M.avail_out&&(M.output=new Uint8Array(w),M.next_out=0,M.avail_out=w),h=q.inflate(M,W),h===v&&y&&(h=q.inflateSetDictionary(M,y),h===G?h=q.inflate(M,W):h===L&&(h=v));M.avail_in>0&&h===a&&M.state.wrap>0&&0!==K[M.next_in];)q.inflateReset(M),h=q.inflate(M,W);switch(h){case O:case L:case v:case S:return this.onEnd(h),this.ended=!0,!1}if(B=M.avail_out,M.next_out&&(0===M.avail_out||h===a))if("string"===this.options.to){let K=u.utf8border(M.output,M.next_out),H=M.next_out-K,q=u.buf2string(M.output,K);M.next_out=H,M.avail_out=w-H,H&&M.output.set(M.output.subarray(K,K+H),0),this.onData(q)}else this.onData(M.output.length===M.next_out?M.output:M.output.subarray(0,M.next_out));if(h!==G||0!==B){if(h===a)return h=q.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,!0;if(0===M.avail_in)break}}return!0},B.prototype.onData=function(K){this.chunks.push(K)},B.prototype.onEnd=function(K){K===G&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=w.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.fH=this.strm.fH},K.exports.Inflate=B,K.exports.inflate=C,K.exports.inflateRaw=function(K,H){return(H=H||{}).raw=!0,C(K,H)},K.exports.ungzip=C,K.exports.constants=M(12450)},12458:K=>{"use strict";const H=(K,H)=>Object.prototype.hasOwnProperty.call(K,H);K.exports.assign=function(K){const M=Array.prototype.slice.call(arguments,1);for(;M.length;){const q=M.shift();if(q){if("object"!==typeof q)throw new TypeError(q+"must be non-object");for(const M in q)H(q,M)&&(K[M]=q[M])}}return K},K.exports.flattenChunks=K=>{let H=0;for(let q=0,w=K.length;q<w;q++)H+=K[q].length;const M=new Uint8Array(H);for(let q=0,w=0,u=K.length;q<u;q++){let H=K[q];M.set(H,w),w+=H.length}return M}},12460:K=>{"use strict";let H=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(q){H=!1}const M=new Uint8Array(256);for(let w=0;w<256;w++)M[w]=w>=252?6:w>=248?5:w>=240?4:w>=224?3:w>=192?2:1;M[254]=M[254]=1,K.exports.string2buf=K=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(K);let H,M,q,w,u,y=K.length,h=0;for(w=0;w<y;w++)M=K.charCodeAt(w),55296===(64512&M)&&w+1<y&&(q=K.charCodeAt(w+1),56320===(64512&q)&&(M=65536+(M-55296<<10)+(q-56320),w++)),h+=M<128?1:M<2048?2:M<65536?3:4;for(H=new Uint8Array(h),u=0,w=0;u<h;w++)M=K.charCodeAt(w),55296===(64512&M)&&w+1<y&&(q=K.charCodeAt(w+1),56320===(64512&q)&&(M=65536+(M-55296<<10)+(q-56320),w++)),M<128?H[u++]=M:M<2048?(H[u++]=192|M>>>6,H[u++]=128|63&M):M<65536?(H[u++]=224|M>>>12,H[u++]=128|M>>>6&63,H[u++]=128|63&M):(H[u++]=240|M>>>18,H[u++]=128|M>>>12&63,H[u++]=128|M>>>6&63,H[u++]=128|63&M);return H};K.exports.buf2string=(K,q)=>{const w=q||K.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(K.subarray(0,q));let u,y;const h=new Array(2*w);for(y=0,u=0;u<w;){let H=K[u++];if(H<128){h[y++]=H;continue}let q=M[H];if(q>4)h[y++]=65533,u+=q-1;else{for(H&=2===q?31:3===q?15:7;q>1&&u<w;)H=H<<6|63&K[u++],q--;q>1?h[y++]=65533:H<65536?h[y++]=H:(H-=65536,h[y++]=55296|H>>10&1023,h[y++]=56320|1023&H)}}return((K,M)=>{if(M<65534&&K.subarray&&H)return String.fromCharCode.apply(null,K.length===M?K:K.subarray(0,M));let q="";for(let H=0;H<M;H++)q+=String.fromCharCode(K[H]);return q})(h,y)},K.exports.utf8border=(K,H)=>{(H=H||K.length)>K.length&&(H=K.length);let q=H-1;for(;q>=0&&128===(192&K[q]);)q--;return q<0||0===q?H:q+M[K[q]]>H?q:H}},12438:K=>{"use strict";K.exports=(K,H,M,q)=>{let w=65535&K,u=K>>>16&65535,y=0;for(;0!==M;){y=M>2e3?2e3:M,M-=y;do{w=w+H[q++]|0,u=u+w|0}while(--y);w%=65521,u%=65521}return w|u<<16}},12450:K=>{"use strict";K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},12441:K=>{"use strict";const H=new Uint32Array((()=>{let K,H=[];for(var M=0;M<256;M++){K=M;for(var q=0;q<8;q++)K=1&K?3988292384^K>>>1:K>>>1;H[M]=K}return H})());K.exports=(K,M,q,w)=>{const u=H,y=w+q;K^=-1;for(let H=w;H<y;H++)K=K>>>8^u[255&(K^M[H])];return~K}},12429:(K,H,M)=>{"use strict";const{_tr_init:q,_tr_stored_block:w,_tr_flush_block:u,_tr_tally:y,_tr_align:h}=M(12433),W=M(12438),I=M(12441),f=M(12448),{Z_NO_FLUSH:z,Z_PARTIAL_FLUSH:G,Z_FULL_FLUSH:a,Z_FINISH:v,Z_BLOCK:O,Z_OK:L,Z_STREAM_END:S,Z_STREAM_ERROR:B,Z_DATA_ERROR:C,Z_BUF_ERROR:i,Z_DEFAULT_COMPRESSION:Z,Z_FILTERED:E,Z_HUFFMAN_ONLY:l,Z_RLE:s,Z_FIXED:D,Z_DEFAULT_STRATEGY:V,Z_UNKNOWN:n,Z_DEFLATED:c}=M(12450),k=258,T=262,d=103,x=113,Q=666,J=(K,H)=>(K.fH=f[H],H),N=K=>(K<<1)-(K>4?9:0),p=K=>{let H=K.length;for(;--H>=0;)K[H]=0};let o=(K,H,M)=>(H<<K.hash_shift^M)&K.hash_mask;const R=K=>{const H=K.state;let M=H.pending;M>K.avail_out&&(M=K.avail_out),0!==M&&(K.output.set(H.pending_buf.subarray(H.pending_out,H.pending_out+M),K.next_out),K.next_out+=M,H.pending_out+=M,K.total_out+=M,K.avail_out-=M,H.pending-=M,0===H.pending&&(H.pending_out=0))},t=(K,H)=>{u(K,K.block_start>=0?K.block_start:-1,K.strstart-K.block_start,H),K.block_start=K.strstart,R(K.strm)},U=(K,H)=>{K.pending_buf[K.pending++]=H},j=(K,H)=>{K.pending_buf[K.pending++]=H>>>8&255,K.pending_buf[K.pending++]=255&H},m=(K,H,M,q)=>{let w=K.avail_in;return w>q&&(w=q),0===w?0:(K.avail_in-=w,H.set(K.input.subarray(K.next_in,K.next_in+w),M),1===K.state.wrap?K.adler=W(K.adler,H,w,M):2===K.state.wrap&&(K.adler=I(K.adler,H,w,M)),K.next_in+=w,K.total_in+=w,w)},F=(K,H)=>{let M,q,w=K.max_chain_length,u=K.strstart,y=K.prev_length,h=K.nice_match;const W=K.strstart>K.w_size-T?K.strstart-(K.w_size-T):0,I=K.window,f=K.w_mask,z=K.prev,G=K.strstart+k;let a=I[u+y-1],v=I[u+y];K.prev_length>=K.good_match&&(w>>=2),h>K.lookahead&&(h=K.lookahead);do{if(M=H,I[M+y]===v&&I[M+y-1]===a&&I[M]===I[u]&&I[++M]===I[u+1]){u+=2,M++;do{}while(I[++u]===I[++M]&&I[++u]===I[++M]&&I[++u]===I[++M]&&I[++u]===I[++M]&&I[++u]===I[++M]&&I[++u]===I[++M]&&I[++u]===I[++M]&&I[++u]===I[++M]&&u<G);if(q=k-(G-u),u=G-k,q>y){if(K.match_start=H,y=q,q>=h)break;a=I[u+y-1],v=I[u+y]}}}while((H=z[H&f])>W&&0!==--w);return y<=K.lookahead?y:K.lookahead},Y=K=>{const H=K.w_size;let M,q,w,u,y;do{if(u=K.window_size-K.lookahead-K.strstart,K.strstart>=H+(H-T)){K.window.set(K.window.subarray(H,H+H),0),K.match_start-=H,K.strstart-=H,K.block_start-=H,q=K.hash_size,M=q;do{w=K.head[--M],K.head[M]=w>=H?w-H:0}while(--q);q=H,M=q;do{w=K.prev[--M],K.prev[M]=w>=H?w-H:0}while(--q);u+=H}if(0===K.strm.avail_in)break;if(q=m(K.strm,K.window,K.strstart+K.lookahead,u),K.lookahead+=q,K.lookahead+K.insert>=3)for(y=K.strstart-K.insert,K.ins_h=K.window[y],K.ins_h=o(K,K.ins_h,K.window[y+1]);K.insert&&(K.ins_h=o(K,K.ins_h,K.window[y+3-1]),K.prev[y&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=y,y++,K.insert--,!(K.lookahead+K.insert<3)););}while(K.lookahead<T&&0!==K.strm.avail_in)},r=(K,H)=>{let M,q;for(;;){if(K.lookahead<T){if(Y(K),K.lookahead<T&&H===z)return 1;if(0===K.lookahead)break}if(M=0,K.lookahead>=3&&(K.ins_h=o(K,K.ins_h,K.window[K.strstart+3-1]),M=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),0!==M&&K.strstart-M<=K.w_size-T&&(K.match_length=F(K,M)),K.match_length>=3)if(q=y(K,K.strstart-K.match_start,K.match_length-3),K.lookahead-=K.match_length,K.match_length<=K.max_lazy_match&&K.lookahead>=3){K.match_length--;do{K.strstart++,K.ins_h=o(K,K.ins_h,K.window[K.strstart+3-1]),M=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart}while(0!==--K.match_length);K.strstart++}else K.strstart+=K.match_length,K.match_length=0,K.ins_h=K.window[K.strstart],K.ins_h=o(K,K.ins_h,K.window[K.strstart+1]);else q=y(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++;if(q&&(t(K,!1),0===K.strm.avail_out))return 1}return K.insert=K.strstart<2?K.strstart:2,H===v?(t(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(t(K,!1),0===K.strm.avail_out)?1:2},e=(K,H)=>{let M,q,w;for(;;){if(K.lookahead<T){if(Y(K),K.lookahead<T&&H===z)return 1;if(0===K.lookahead)break}if(M=0,K.lookahead>=3&&(K.ins_h=o(K,K.ins_h,K.window[K.strstart+3-1]),M=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),K.prev_length=K.match_length,K.prev_match=K.match_start,K.match_length=2,0!==M&&K.prev_length<K.max_lazy_match&&K.strstart-M<=K.w_size-T&&(K.match_length=F(K,M),K.match_length<=5&&(K.strategy===E||3===K.match_length&&K.strstart-K.match_start>4096)&&(K.match_length=2)),K.prev_length>=3&&K.match_length<=K.prev_length){w=K.strstart+K.lookahead-3,q=y(K,K.strstart-1-K.prev_match,K.prev_length-3),K.lookahead-=K.prev_length-1,K.prev_length-=2;do{++K.strstart<=w&&(K.ins_h=o(K,K.ins_h,K.window[K.strstart+3-1]),M=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart)}while(0!==--K.prev_length);if(K.match_available=0,K.match_length=2,K.strstart++,q&&(t(K,!1),0===K.strm.avail_out))return 1}else if(K.match_available){if(q=y(K,0,K.window[K.strstart-1]),q&&t(K,!1),K.strstart++,K.lookahead--,0===K.strm.avail_out)return 1}else K.match_available=1,K.strstart++,K.lookahead--}return K.match_available&&(q=y(K,0,K.window[K.strstart-1]),K.match_available=0),K.insert=K.strstart<2?K.strstart:2,H===v?(t(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(t(K,!1),0===K.strm.avail_out)?1:2};function b(K,H,M,q,w){this.good_length=K,this.max_lazy=H,this.nice_length=M,this.max_chain=q,this.func=w}const P=[new b(0,0,0,0,((K,H)=>{let M=65535;for(M>K.pending_buf_size-5&&(M=K.pending_buf_size-5);;){if(K.lookahead<=1){if(Y(K),0===K.lookahead&&H===z)return 1;if(0===K.lookahead)break}K.strstart+=K.lookahead,K.lookahead=0;const q=K.block_start+M;if((0===K.strstart||K.strstart>=q)&&(K.lookahead=K.strstart-q,K.strstart=q,t(K,!1),0===K.strm.avail_out))return 1;if(K.strstart-K.block_start>=K.w_size-T&&(t(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,H===v?(t(K,!0),0===K.strm.avail_out?3:4):(K.strstart>K.block_start&&(t(K,!1),K.strm.avail_out),1)})),new b(4,4,8,4,r),new b(4,5,16,8,r),new b(4,6,32,32,r),new b(4,4,16,16,e),new b(8,16,32,32,e),new b(8,16,128,128,e),new b(8,32,128,256,e),new b(32,128,258,1024,e),new b(32,258,258,4096,e)];function g(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=c,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),p(this.dyn_ltree),p(this.dyn_dtree),p(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),p(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),p(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const X=K=>{if(!K||!K.state)return J(K,B);K.total_in=K.total_out=0,K.data_type=n;const H=K.state;return H.pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?42:x,K.adler=2===H.wrap?0:1,H.last_flush=z,q(H),L},A=K=>{const H=X(K);var M;return H===L&&((M=K.state).window_size=2*M.w_size,p(M.head),M.max_lazy_match=P[M.level].max_lazy,M.good_match=P[M.level].good_length,M.nice_match=P[M.level].nice_length,M.max_chain_length=P[M.level].max_chain,M.strstart=0,M.block_start=0,M.lookahead=0,M.insert=0,M.match_length=M.prev_length=2,M.match_available=0,M.ins_h=0),H},KK=(K,H,M,q,w,u)=>{if(!K)return B;let y=1;if(H===Z&&(H=6),q<0?(y=0,q=-q):q>15&&(y=2,q-=16),w<1||w>9||M!==c||q<8||q>15||H<0||H>9||u<0||u>D)return J(K,B);8===q&&(q=9);const h=new g;return K.state=h,h.strm=K,h.wrap=y,h.gzhead=null,h.w_bits=q,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=w+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<w+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=H,h.strategy=u,h.method=M,A(K)};K.exports.deflateInit=(K,H)=>KK(K,H,c,15,8,V),K.exports.deflateInit2=KK,K.exports.deflateReset=A,K.exports.deflateResetKeep=X,K.exports.deflateSetHeader=(K,H)=>K&&K.state?2!==K.state.wrap?B:(K.state.gzhead=H,L):B,K.exports.deflate=(K,H)=>{let M,q;if(!K||!K.state||H>O||H<0)return K?J(K,B):B;const u=K.state;if(!K.output||!K.input&&0!==K.avail_in||u.status===Q&&H!==v)return J(K,0===K.avail_out?i:B);u.strm=K;const W=u.last_flush;if(u.last_flush=H,42===u.status)if(2===u.wrap)K.adler=0,U(u,31),U(u,139),U(u,8),u.gzhead?(U(u,(u.gzhead.text?1:0)+(u.gzhead.hcrc?2:0)+(u.gzhead.extra?4:0)+(u.gzhead.name?8:0)+(u.gzhead.comment?16:0)),U(u,255&u.gzhead.time),U(u,u.gzhead.time>>8&255),U(u,u.gzhead.time>>16&255),U(u,u.gzhead.time>>24&255),U(u,9===u.level?2:u.strategy>=l||u.level<2?4:0),U(u,255&u.gzhead.os),u.gzhead.extra&&u.gzhead.extra.length&&(U(u,255&u.gzhead.extra.length),U(u,u.gzhead.extra.length>>8&255)),u.gzhead.hcrc&&(K.adler=I(K.adler,u.pending_buf,u.pending,0)),u.gzindex=0,u.status=69):(U(u,0),U(u,0),U(u,0),U(u,0),U(u,0),U(u,9===u.level?2:u.strategy>=l||u.level<2?4:0),U(u,3),u.status=x);else{let H=c+(u.w_bits-8<<4)<<8,M=-1;M=u.strategy>=l||u.level<2?0:u.level<6?1:6===u.level?2:3,H|=M<<6,0!==u.strstart&&(H|=32),H+=31-H%31,u.status=x,j(u,H),0!==u.strstart&&(j(u,K.adler>>>16),j(u,65535&K.adler)),K.adler=1}if(69===u.status)if(u.gzhead.extra){for(M=u.pending;u.gzindex<(65535&u.gzhead.extra.length)&&(u.pending!==u.pending_buf_size||(u.gzhead.hcrc&&u.pending>M&&(K.adler=I(K.adler,u.pending_buf,u.pending-M,M)),R(K),M=u.pending,u.pending!==u.pending_buf_size));)U(u,255&u.gzhead.extra[u.gzindex]),u.gzindex++;u.gzhead.hcrc&&u.pending>M&&(K.adler=I(K.adler,u.pending_buf,u.pending-M,M)),u.gzindex===u.gzhead.extra.length&&(u.gzindex=0,u.status=73)}else u.status=73;if(73===u.status)if(u.gzhead.name){M=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>M&&(K.adler=I(K.adler,u.pending_buf,u.pending-M,M)),R(K),M=u.pending,u.pending===u.pending_buf_size)){q=1;break}q=u.gzindex<u.gzhead.name.length?255&u.gzhead.name.charCodeAt(u.gzindex++):0,U(u,q)}while(0!==q);u.gzhead.hcrc&&u.pending>M&&(K.adler=I(K.adler,u.pending_buf,u.pending-M,M)),0===q&&(u.gzindex=0,u.status=91)}else u.status=91;if(91===u.status)if(u.gzhead.comment){M=u.pending;do{if(u.pending===u.pending_buf_size&&(u.gzhead.hcrc&&u.pending>M&&(K.adler=I(K.adler,u.pending_buf,u.pending-M,M)),R(K),M=u.pending,u.pending===u.pending_buf_size)){q=1;break}q=u.gzindex<u.gzhead.comment.length?255&u.gzhead.comment.charCodeAt(u.gzindex++):0,U(u,q)}while(0!==q);u.gzhead.hcrc&&u.pending>M&&(K.adler=I(K.adler,u.pending_buf,u.pending-M,M)),0===q&&(u.status=d)}else u.status=d;if(u.status===d&&(u.gzhead.hcrc?(u.pending+2>u.pending_buf_size&&R(K),u.pending+2<=u.pending_buf_size&&(U(u,255&K.adler),U(u,K.adler>>8&255),K.adler=0,u.status=x)):u.status=x),0!==u.pending){if(R(K),0===K.avail_out)return u.last_flush=-1,L}else if(0===K.avail_in&&N(H)<=N(W)&&H!==v)return J(K,i);if(u.status===Q&&0!==K.avail_in)return J(K,i);if(0!==K.avail_in||0!==u.lookahead||H!==z&&u.status!==Q){let M=u.strategy===l?((K,H)=>{let M;for(;;){if(0===K.lookahead&&(Y(K),0===K.lookahead)){if(H===z)return 1;break}if(K.match_length=0,M=y(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,M&&(t(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,H===v?(t(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(t(K,!1),0===K.strm.avail_out)?1:2})(u,H):u.strategy===s?((K,H)=>{let M,q,w,u;const h=K.window;for(;;){if(K.lookahead<=k){if(Y(K),K.lookahead<=k&&H===z)return 1;if(0===K.lookahead)break}if(K.match_length=0,K.lookahead>=3&&K.strstart>0&&(w=K.strstart-1,q=h[w],q===h[++w]&&q===h[++w]&&q===h[++w])){u=K.strstart+k;do{}while(q===h[++w]&&q===h[++w]&&q===h[++w]&&q===h[++w]&&q===h[++w]&&q===h[++w]&&q===h[++w]&&q===h[++w]&&w<u);K.match_length=k-(u-w),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=3?(M=y(K,1,K.match_length-3),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(M=y(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),M&&(t(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,H===v?(t(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(t(K,!1),0===K.strm.avail_out)?1:2})(u,H):P[u.level].func(u,H);if(3!==M&&4!==M||(u.status=Q),1===M||3===M)return 0===K.avail_out&&(u.last_flush=-1),L;if(2===M&&(H===G?h(u):H!==O&&(w(u,0,0,!1),H===a&&(p(u.head),0===u.lookahead&&(u.strstart=0,u.block_start=0,u.insert=0))),R(K),0===K.avail_out))return u.last_flush=-1,L}return H!==v?L:u.wrap<=0?S:(2===u.wrap?(U(u,255&K.adler),U(u,K.adler>>8&255),U(u,K.adler>>16&255),U(u,K.adler>>24&255),U(u,255&K.total_in),U(u,K.total_in>>8&255),U(u,K.total_in>>16&255),U(u,K.total_in>>24&255)):(j(u,K.adler>>>16),j(u,65535&K.adler)),R(K),u.wrap>0&&(u.wrap=-u.wrap),0!==u.pending?L:S)},K.exports.deflateEnd=K=>{if(!K||!K.state)return B;const H=K.state.status;return 42!==H&&69!==H&&73!==H&&91!==H&&H!==d&&H!==x&&H!==Q?J(K,B):(K.state=null,H===x?J(K,C):L)},K.exports.deflateSetDictionary=(K,H)=>{let M=H.length;if(!K||!K.state)return B;const q=K.state,w=q.wrap;if(2===w||1===w&&42!==q.status||q.lookahead)return B;if(1===w&&(K.adler=W(K.adler,H,M,0)),q.wrap=0,M>=q.w_size){0===w&&(p(q.head),q.strstart=0,q.block_start=0,q.insert=0);let K=new Uint8Array(q.w_size);K.set(H.subarray(M-q.w_size,M),0),H=K,M=q.w_size}const u=K.avail_in,y=K.next_in,h=K.input;for(K.avail_in=M,K.next_in=0,K.input=H,Y(q);q.lookahead>=3;){let K=q.strstart,H=q.lookahead-2;do{q.ins_h=o(q,q.ins_h,q.window[K+3-1]),q.prev[K&q.w_mask]=q.head[q.ins_h],q.head[q.ins_h]=K,K++}while(--H);q.strstart=K,q.lookahead=2,Y(q)}return q.strstart+=q.lookahead,q.block_start=q.strstart,q.insert=q.lookahead,q.lookahead=0,q.match_length=q.prev_length=2,q.match_available=0,K.next_in=y,K.input=h,K.avail_in=u,q.wrap=w,L},K.exports.deflateInfo="pako deflate (from Nodeca project)"},12506:K=>{"use strict";K.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},12493:K=>{"use strict";K.exports=function(K,H){let M,q,w,u,y,h,W,I,f,z,G,a,v,O,L,S,B,C,i,Z,E,l,s,D;const V=K.state;M=K.next_in,s=K.input,q=M+(K.avail_in-5),w=K.next_out,D=K.output,u=w-(H-K.avail_out),y=w+(K.avail_out-257),h=V.dmax,W=V.wsize,I=V.whave,f=V.wnext,z=V.window,G=V.hold,a=V.bits,v=V.lencode,O=V.distcode,L=(1<<V.lenbits)-1,S=(1<<V.distbits)-1;K:do{a<15&&(G+=s[M++]<<a,a+=8,G+=s[M++]<<a,a+=8),B=v[G&L];H:for(;;){if(C=B>>>24,G>>>=C,a-=C,C=B>>>16&255,0===C)D[w++]=65535&B;else{if(!(16&C)){if(0===(64&C)){B=v[(65535&B)+(G&(1<<C)-1)];continue H}if(32&C){V.mode=12;break K}K.fH="invalid literal/length code",V.mode=30;break K}i=65535&B,C&=15,C&&(a<C&&(G+=s[M++]<<a,a+=8),i+=G&(1<<C)-1,G>>>=C,a-=C),a<15&&(G+=s[M++]<<a,a+=8,G+=s[M++]<<a,a+=8),B=O[G&S];M:for(;;){if(C=B>>>24,G>>>=C,a-=C,C=B>>>16&255,!(16&C)){if(0===(64&C)){B=O[(65535&B)+(G&(1<<C)-1)];continue M}K.fH="invalid distance code",V.mode=30;break K}if(Z=65535&B,C&=15,a<C&&(G+=s[M++]<<a,a+=8,a<C&&(G+=s[M++]<<a,a+=8)),Z+=G&(1<<C)-1,Z>h){K.fH="invalid distance too far back",V.mode=30;break K}if(G>>>=C,a-=C,C=w-u,Z>C){if(C=Z-C,C>I&&V.sane){K.fH="invalid distance too far back",V.mode=30;break K}if(E=0,l=z,0===f){if(E+=W-C,C<i){i-=C;do{D[w++]=z[E++]}while(--C);E=w-Z,l=D}}else if(f<C){if(E+=W+f-C,C-=f,C<i){i-=C;do{D[w++]=z[E++]}while(--C);if(E=0,f<i){C=f,i-=C;do{D[w++]=z[E++]}while(--C);E=w-Z,l=D}}}else if(E+=f-C,C<i){i-=C;do{D[w++]=z[E++]}while(--C);E=w-Z,l=D}for(;i>2;)D[w++]=l[E++],D[w++]=l[E++],D[w++]=l[E++],i-=3;i&&(D[w++]=l[E++],i>1&&(D[w++]=l[E++]))}else{E=w-Z;do{D[w++]=D[E++],D[w++]=D[E++],D[w++]=D[E++],i-=3}while(i>2);i&&(D[w++]=D[E++],i>1&&(D[w++]=D[E++]))}break}}break}}while(M<q&&w<y);i=a>>3,M-=i,a-=i<<3,G&=(1<<a)-1,K.next_in=M,K.next_out=w,K.avail_in=M<q?q-M+5:5-(M-q),K.avail_out=w<y?y-w+257:257-(w-y),V.hold=G,V.bits=a}},12486:(K,H,M)=>{"use strict";const q=M(12438),w=M(12441),u=M(12493),y=M(12498),{Z_FINISH:h,Z_BLOCK:W,Z_TREES:I,Z_OK:f,Z_STREAM_END:z,Z_NEED_DICT:G,Z_STREAM_ERROR:a,Z_DATA_ERROR:v,Z_MEM_ERROR:O,Z_BUF_ERROR:L,Z_DEFLATED:S}=M(12450),B=12,C=30,i=K=>(K>>>24&255)+(K>>>8&65280)+((65280&K)<<8)+((255&K)<<24);function Z(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const E=K=>{if(!K||!K.state)return a;const H=K.state;return K.total_in=K.total_out=H.total=0,K.fH="",H.wrap&&(K.adler=1&H.wrap),H.mode=1,H.last=0,H.havedict=0,H.dmax=32768,H.head=null,H.hold=0,H.bits=0,H.lencode=H.lendyn=new Int32Array(852),H.distcode=H.distdyn=new Int32Array(592),H.sane=1,H.back=-1,f},l=K=>{if(!K||!K.state)return a;const H=K.state;return H.wsize=0,H.whave=0,H.wnext=0,E(K)},s=(K,H)=>{let M;if(!K||!K.state)return a;const q=K.state;return H<0?(M=0,H=-H):(M=1+(H>>4),H<48&&(H&=15)),H&&(H<8||H>15)?a:(null!==q.window&&q.wbits!==H&&(q.window=null),q.wrap=M,q.wbits=H,l(K))},D=(K,H)=>{if(!K)return a;const M=new Z;K.state=M,M.window=null;const q=s(K,H);return q!==f&&(K.state=null),q};let V,n,c=!0;const k=K=>{if(c){V=new Int32Array(512),n=new Int32Array(32);let H=0;for(;H<144;)K.lens[H++]=8;for(;H<256;)K.lens[H++]=9;for(;H<280;)K.lens[H++]=7;for(;H<288;)K.lens[H++]=8;for(y(1,K.lens,0,288,V,0,K.work,{bits:9}),H=0;H<32;)K.lens[H++]=5;y(2,K.lens,0,32,n,0,K.work,{bits:5}),c=!1}K.lencode=V,K.lenbits=9,K.distcode=n,K.distbits=5},T=(K,H,M,q)=>{let w;const u=K.state;return null===u.window&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),q>=u.wsize?(u.window.set(H.subarray(M-u.wsize,M),0),u.wnext=0,u.whave=u.wsize):(w=u.wsize-u.wnext,w>q&&(w=q),u.window.set(H.subarray(M-q,M-q+w),u.wnext),(q-=w)?(u.window.set(H.subarray(M-q,M),0),u.wnext=q,u.whave=u.wsize):(u.wnext+=w,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=w))),0};K.exports.inflateReset=l,K.exports.inflateReset2=s,K.exports.inflateResetKeep=E,K.exports.inflateInit=K=>D(K,15),K.exports.inflateInit2=D,K.exports.inflate=(K,H)=>{let M,Z,E,l,s,D,V,n,c,d,x,Q,J,N,p,o,R,t,U,j,m,F,Y=0;const r=new Uint8Array(4);let e,b;const P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!K||!K.state||!K.output||!K.input&&0!==K.avail_in)return a;M=K.state,M.mode===B&&(M.mode=13),s=K.next_out,E=K.output,V=K.avail_out,l=K.next_in,Z=K.input,D=K.avail_in,n=M.hold,c=M.bits,d=D,x=V,F=f;K:for(;;)switch(M.mode){case 1:if(0===M.wrap){M.mode=13;break}for(;c<16;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(2&M.wrap&&35615===n){M.check=0,r[0]=255&n,r[1]=n>>>8&255,M.check=w(M.check,r,2,0),n=0,c=0,M.mode=2;break}if(M.flags=0,M.head&&(M.head.done=!1),!(1&M.wrap)||(((255&n)<<8)+(n>>8))%31){K.fH="incorrect header check",M.mode=C;break}if((15&n)!==S){K.fH="unknown compression method",M.mode=C;break}if(n>>>=4,c-=4,m=8+(15&n),0===M.wbits)M.wbits=m;else if(m>M.wbits){K.fH="invalid window size",M.mode=C;break}M.dmax=1<<M.wbits,K.adler=M.check=1,M.mode=512&n?10:B,n=0,c=0;break;case 2:for(;c<16;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(M.flags=n,(255&M.flags)!==S){K.fH="unknown compression method",M.mode=C;break}if(57344&M.flags){K.fH="unknown header flags set",M.mode=C;break}M.head&&(M.head.text=n>>8&1),512&M.flags&&(r[0]=255&n,r[1]=n>>>8&255,M.check=w(M.check,r,2,0)),n=0,c=0,M.mode=3;case 3:for(;c<32;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}M.head&&(M.head.time=n),512&M.flags&&(r[0]=255&n,r[1]=n>>>8&255,r[2]=n>>>16&255,r[3]=n>>>24&255,M.check=w(M.check,r,4,0)),n=0,c=0,M.mode=4;case 4:for(;c<16;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}M.head&&(M.head.xflags=255&n,M.head.os=n>>8),512&M.flags&&(r[0]=255&n,r[1]=n>>>8&255,M.check=w(M.check,r,2,0)),n=0,c=0,M.mode=5;case 5:if(1024&M.flags){for(;c<16;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}M.length=n,M.head&&(M.head.extra_len=n),512&M.flags&&(r[0]=255&n,r[1]=n>>>8&255,M.check=w(M.check,r,2,0)),n=0,c=0}else M.head&&(M.head.extra=null);M.mode=6;case 6:if(1024&M.flags&&(Q=M.length,Q>D&&(Q=D),Q&&(M.head&&(m=M.head.extra_len-M.length,M.head.extra||(M.head.extra=new Uint8Array(M.head.extra_len)),M.head.extra.set(Z.subarray(l,l+Q),m)),512&M.flags&&(M.check=w(M.check,Z,Q,l)),D-=Q,l+=Q,M.length-=Q),M.length))break K;M.length=0,M.mode=7;case 7:if(2048&M.flags){if(0===D)break K;Q=0;do{m=Z[l+Q++],M.head&&m&&M.length<65536&&(M.head.name+=String.fromCharCode(m))}while(m&&Q<D);if(512&M.flags&&(M.check=w(M.check,Z,Q,l)),D-=Q,l+=Q,m)break K}else M.head&&(M.head.name=null);M.length=0,M.mode=8;case 8:if(4096&M.flags){if(0===D)break K;Q=0;do{m=Z[l+Q++],M.head&&m&&M.length<65536&&(M.head.comment+=String.fromCharCode(m))}while(m&&Q<D);if(512&M.flags&&(M.check=w(M.check,Z,Q,l)),D-=Q,l+=Q,m)break K}else M.head&&(M.head.comment=null);M.mode=9;case 9:if(512&M.flags){for(;c<16;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(n!==(65535&M.check)){K.fH="header crc mismatch",M.mode=C;break}n=0,c=0}M.head&&(M.head.hcrc=M.flags>>9&1,M.head.done=!0),K.adler=M.check=0,M.mode=B;break;case 10:for(;c<32;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}K.adler=M.check=i(n),n=0,c=0,M.mode=11;case 11:if(0===M.havedict)return K.next_out=s,K.avail_out=V,K.next_in=l,K.avail_in=D,M.hold=n,M.bits=c,G;K.adler=M.check=1,M.mode=B;case B:if(H===W||H===I)break K;case 13:if(M.last){n>>>=7&c,c-=7&c,M.mode=27;break}for(;c<3;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}switch(M.last=1&n,n>>>=1,c-=1,3&n){case 0:M.mode=14;break;case 1:if(k(M),M.mode=20,H===I){n>>>=2,c-=2;break K}break;case 2:M.mode=17;break;case 3:K.fH="invalid block type",M.mode=C}n>>>=2,c-=2;break;case 14:for(n>>>=7&c,c-=7&c;c<32;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if((65535&n)!==(n>>>16^65535)){K.fH="invalid stored block lengths",M.mode=C;break}if(M.length=65535&n,n=0,c=0,M.mode=15,H===I)break K;case 15:M.mode=16;case 16:if(Q=M.length,Q){if(Q>D&&(Q=D),Q>V&&(Q=V),0===Q)break K;E.set(Z.subarray(l,l+Q),s),D-=Q,l+=Q,V-=Q,s+=Q,M.length-=Q;break}M.mode=B;break;case 17:for(;c<14;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(M.nlen=257+(31&n),n>>>=5,c-=5,M.ndist=1+(31&n),n>>>=5,c-=5,M.ncode=4+(15&n),n>>>=4,c-=4,M.nlen>286||M.ndist>30){K.fH="too many length or distance symbols",M.mode=C;break}M.have=0,M.mode=18;case 18:for(;M.have<M.ncode;){for(;c<3;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}M.lens[P[M.have++]]=7&n,n>>>=3,c-=3}for(;M.have<19;)M.lens[P[M.have++]]=0;if(M.lencode=M.lendyn,M.lenbits=7,e={bits:M.lenbits},F=y(0,M.lens,0,19,M.lencode,0,M.work,e),M.lenbits=e.bits,F){K.fH="invalid code lengths set",M.mode=C;break}M.have=0,M.mode=19;case 19:for(;M.have<M.nlen+M.ndist;){for(;Y=M.lencode[n&(1<<M.lenbits)-1],p=Y>>>24,o=Y>>>16&255,R=65535&Y,!(p<=c);){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(R<16)n>>>=p,c-=p,M.lens[M.have++]=R;else{if(16===R){for(b=p+2;c<b;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(n>>>=p,c-=p,0===M.have){K.fH="invalid bit length repeat",M.mode=C;break}m=M.lens[M.have-1],Q=3+(3&n),n>>>=2,c-=2}else if(17===R){for(b=p+3;c<b;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}n>>>=p,c-=p,m=0,Q=3+(7&n),n>>>=3,c-=3}else{for(b=p+7;c<b;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}n>>>=p,c-=p,m=0,Q=11+(127&n),n>>>=7,c-=7}if(M.have+Q>M.nlen+M.ndist){K.fH="invalid bit length repeat",M.mode=C;break}for(;Q--;)M.lens[M.have++]=m}}if(M.mode===C)break;if(0===M.lens[256]){K.fH="invalid code -- missing end-of-block",M.mode=C;break}if(M.lenbits=9,e={bits:M.lenbits},F=y(1,M.lens,0,M.nlen,M.lencode,0,M.work,e),M.lenbits=e.bits,F){K.fH="invalid literal/lengths set",M.mode=C;break}if(M.distbits=6,M.distcode=M.distdyn,e={bits:M.distbits},F=y(2,M.lens,M.nlen,M.ndist,M.distcode,0,M.work,e),M.distbits=e.bits,F){K.fH="invalid distances set",M.mode=C;break}if(M.mode=20,H===I)break K;case 20:M.mode=21;case 21:if(D>=6&&V>=258){K.next_out=s,K.avail_out=V,K.next_in=l,K.avail_in=D,M.hold=n,M.bits=c,u(K,x),s=K.next_out,E=K.output,V=K.avail_out,l=K.next_in,Z=K.input,D=K.avail_in,n=M.hold,c=M.bits,M.mode===B&&(M.back=-1);break}for(M.back=0;Y=M.lencode[n&(1<<M.lenbits)-1],p=Y>>>24,o=Y>>>16&255,R=65535&Y,!(p<=c);){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(o&&0===(240&o)){for(t=p,U=o,j=R;Y=M.lencode[j+((n&(1<<t+U)-1)>>t)],p=Y>>>24,o=Y>>>16&255,R=65535&Y,!(t+p<=c);){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}n>>>=t,c-=t,M.back+=t}if(n>>>=p,c-=p,M.back+=p,M.length=R,0===o){M.mode=26;break}if(32&o){M.back=-1,M.mode=B;break}if(64&o){K.fH="invalid literal/length code",M.mode=C;break}M.extra=15&o,M.mode=22;case 22:if(M.extra){for(b=M.extra;c<b;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}M.length+=n&(1<<M.extra)-1,n>>>=M.extra,c-=M.extra,M.back+=M.extra}M.was=M.length,M.mode=23;case 23:for(;Y=M.distcode[n&(1<<M.distbits)-1],p=Y>>>24,o=Y>>>16&255,R=65535&Y,!(p<=c);){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(0===(240&o)){for(t=p,U=o,j=R;Y=M.distcode[j+((n&(1<<t+U)-1)>>t)],p=Y>>>24,o=Y>>>16&255,R=65535&Y,!(t+p<=c);){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}n>>>=t,c-=t,M.back+=t}if(n>>>=p,c-=p,M.back+=p,64&o){K.fH="invalid distance code",M.mode=C;break}M.offset=R,M.extra=15&o,M.mode=24;case 24:if(M.extra){for(b=M.extra;c<b;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}M.offset+=n&(1<<M.extra)-1,n>>>=M.extra,c-=M.extra,M.back+=M.extra}if(M.offset>M.dmax){K.fH="invalid distance too far back",M.mode=C;break}M.mode=25;case 25:if(0===V)break K;if(Q=x-V,M.offset>Q){if(Q=M.offset-Q,Q>M.whave&&M.sane){K.fH="invalid distance too far back",M.mode=C;break}Q>M.wnext?(Q-=M.wnext,J=M.wsize-Q):J=M.wnext-Q,Q>M.length&&(Q=M.length),N=M.window}else N=E,J=s-M.offset,Q=M.length;Q>V&&(Q=V),V-=Q,M.length-=Q;do{E[s++]=N[J++]}while(--Q);0===M.length&&(M.mode=21);break;case 26:if(0===V)break K;E[s++]=M.length,V--,M.mode=21;break;case 27:if(M.wrap){for(;c<32;){if(0===D)break K;D--,n|=Z[l++]<<c,c+=8}if(x-=V,K.total_out+=x,M.total+=x,x&&(K.adler=M.check=M.flags?w(M.check,E,x,s-x):q(M.check,E,x,s-x)),x=V,(M.flags?n:i(n))!==M.check){K.fH="incorrect data check",M.mode=C;break}n=0,c=0}M.mode=28;case 28:if(M.wrap&&M.flags){for(;c<32;){if(0===D)break K;D--,n+=Z[l++]<<c,c+=8}if(n!==(4294967295&M.total)){K.fH="incorrect length check",M.mode=C;break}n=0,c=0}M.mode=29;case 29:F=z;break K;case C:F=v;break K;case 31:return O;default:return a}return K.next_out=s,K.avail_out=V,K.next_in=l,K.avail_in=D,M.hold=n,M.bits=c,(M.wsize||x!==K.avail_out&&M.mode<C&&(M.mode<27||H!==h))&&T(K,K.output,K.next_out,x-K.avail_out)?(M.mode=31,O):(d-=K.avail_in,x-=K.avail_out,K.total_in+=d,K.total_out+=x,M.total+=x,M.wrap&&x&&(K.adler=M.check=M.flags?w(M.check,E,x,K.next_out-x):q(M.check,E,x,K.next_out-x)),K.data_type=M.bits+(M.last?64:0)+(M.mode===B?128:0)+(20===M.mode||15===M.mode?256:0),(0===d&&0===x||H===h)&&F===f&&(F=L),F)},K.exports.inflateEnd=K=>{if(!K||!K.state)return a;let H=K.state;return H.window&&(H.window=null),K.state=null,f},K.exports.inflateGetHeader=(K,H)=>{if(!K||!K.state)return a;const M=K.state;return 0===(2&M.wrap)?a:(M.head=H,H.done=!1,f)},K.exports.inflateSetDictionary=(K,H)=>{const M=H.length;let w,u,y;return K&&K.state?(w=K.state,0!==w.wrap&&11!==w.mode?a:11===w.mode&&(u=1,u=q(u,H,M,0),u!==w.check)?v:(y=T(K,H,M,M),y?(w.mode=31,O):(w.havedict=1,f))):a},K.exports.inflateInfo="pako inflate (from Nodeca project)"},12498:K=>{"use strict";const H=15,M=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),q=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),w=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),u=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);K.exports=(K,y,h,W,I,f,z,G)=>{const a=G.bits;let v,O,L,S,B,C,i=0,Z=0,E=0,l=0,s=0,D=0,V=0,n=0,c=0,k=0,T=null,d=0;const x=new Uint16Array(16),Q=new Uint16Array(16);let J,N,p,o=null,R=0;for(i=0;i<=H;i++)x[i]=0;for(Z=0;Z<W;Z++)x[y[h+Z]]++;for(s=a,l=H;l>=1&&0===x[l];l--);if(s>l&&(s=l),0===l)return I[f++]=20971520,I[f++]=20971520,G.bits=1,0;for(E=1;E<l&&0===x[E];E++);for(s<E&&(s=E),n=1,i=1;i<=H;i++)if(n<<=1,n-=x[i],n<0)return-1;if(n>0&&(0===K||1!==l))return-1;for(Q[1]=0,i=1;i<H;i++)Q[i+1]=Q[i]+x[i];for(Z=0;Z<W;Z++)0!==y[h+Z]&&(z[Q[y[h+Z]]++]=Z);if(0===K?(T=o=z,C=19):1===K?(T=M,d-=257,o=q,R-=257,C=256):(T=w,o=u,C=-1),k=0,Z=0,i=E,B=f,D=s,V=0,L=-1,c=1<<s,S=c-1,1===K&&c>852||2===K&&c>592)return 1;for(;;){J=i-V,z[Z]<C?(N=0,p=z[Z]):z[Z]>C?(N=o[R+z[Z]],p=T[d+z[Z]]):(N=96,p=0),v=1<<i-V,O=1<<D,E=O;do{O-=v,I[B+(k>>V)+O]=J<<24|N<<16|p}while(0!==O);for(v=1<<i-1;k&v;)v>>=1;if(0!==v?(k&=v-1,k+=v):k=0,Z++,0===--x[i]){if(i===l)break;i=y[h+z[Z]]}if(i>s&&(k&S)!==L){for(0===V&&(V=s),B+=E,D=i-V,n=1<<D;D+V<l&&(n-=x[D+V],!(n<=0));)D++,n<<=1;if(c+=1<<D,1===K&&c>852||2===K&&c>592)return 1;L=k&S,I[L]=s<<24|D<<16|B-f}}return 0!==k&&(I[B+k]=i-V<<24|64<<16),G.bits=s,0}},12448:K=>{"use strict";K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},12433:K=>{"use strict";function H(K){let H=K.length;for(;--H>=0;)K[H]=0}const M=256,q=286,w=30,u=15,y=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),h=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),W=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=new Array(576);H(f);const z=new Array(60);H(z);const G=new Array(512);H(G);const a=new Array(256);H(a);const v=new Array(29);H(v);const O=new Array(w);function L(K,H,M,q,w){this.static_tree=K,this.extra_bits=H,this.extra_base=M,this.elems=q,this.max_length=w,this.has_stree=K&&K.length}let S,B,C;function i(K,H){this.dyn_tree=K,this.max_code=0,this.stat_desc=H}H(O);const Z=K=>K<256?G[K]:G[256+(K>>>7)],E=(K,H)=>{K.pending_buf[K.pending++]=255&H,K.pending_buf[K.pending++]=H>>>8&255},l=(K,H,M)=>{K.bi_valid>16-M?(K.bi_buf|=H<<K.bi_valid&65535,E(K,K.bi_buf),K.bi_buf=H>>16-K.bi_valid,K.bi_valid+=M-16):(K.bi_buf|=H<<K.bi_valid&65535,K.bi_valid+=M)},s=(K,H,M)=>{l(K,M[2*H],M[2*H+1])},D=(K,H)=>{let M=0;do{M|=1&K,K>>>=1,M<<=1}while(--H>0);return M>>>1},V=(K,H,M)=>{const q=new Array(16);let w,y,h=0;for(w=1;w<=u;w++)q[w]=h=h+M[w-1]<<1;for(y=0;y<=H;y++){let H=K[2*y+1];0!==H&&(K[2*y]=D(q[H]++,H))}},n=K=>{let H;for(H=0;H<q;H++)K.dyn_ltree[2*H]=0;for(H=0;H<w;H++)K.dyn_dtree[2*H]=0;for(H=0;H<19;H++)K.bl_tree[2*H]=0;K.dyn_ltree[512]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0},c=K=>{K.bi_valid>8?E(K,K.bi_buf):K.bi_valid>0&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0},k=(K,H,M,q)=>{const w=2*H,u=2*M;return K[w]<K[u]||K[w]===K[u]&&q[H]<=q[M]},T=(K,H,M)=>{const q=K.heap[M];let w=M<<1;for(;w<=K.heap_len&&(w<K.heap_len&&k(H,K.heap[w+1],K.heap[w],K.depth)&&w++,!k(H,q,K.heap[w],K.depth));)K.heap[M]=K.heap[w],M=w,w<<=1;K.heap[M]=q},d=(K,H,q)=>{let w,u,W,I,f=0;if(0!==K.last_lit)do{w=K.pending_buf[K.d_buf+2*f]<<8|K.pending_buf[K.d_buf+2*f+1],u=K.pending_buf[K.l_buf+f],f++,0===w?s(K,u,H):(W=a[u],s(K,W+M+1,H),I=y[W],0!==I&&(u-=v[W],l(K,u,I)),w--,W=Z(w),s(K,W,q),I=h[W],0!==I&&(w-=O[W],l(K,w,I)))}while(f<K.last_lit);s(K,256,H)},x=(K,H)=>{const M=H.dyn_tree,q=H.stat_desc.static_tree,w=H.stat_desc.has_stree,y=H.stat_desc.elems;let h,W,I,f=-1;for(K.heap_len=0,K.heap_max=573,h=0;h<y;h++)0!==M[2*h]?(K.heap[++K.heap_len]=f=h,K.depth[h]=0):M[2*h+1]=0;for(;K.heap_len<2;)I=K.heap[++K.heap_len]=f<2?++f:0,M[2*I]=1,K.depth[I]=0,K.opt_len--,w&&(K.static_len-=q[2*I+1]);for(H.max_code=f,h=K.heap_len>>1;h>=1;h--)T(K,M,h);I=y;do{h=K.heap[1],K.heap[1]=K.heap[K.heap_len--],T(K,M,1),W=K.heap[1],K.heap[--K.heap_max]=h,K.heap[--K.heap_max]=W,M[2*I]=M[2*h]+M[2*W],K.depth[I]=(K.depth[h]>=K.depth[W]?K.depth[h]:K.depth[W])+1,M[2*h+1]=M[2*W+1]=I,K.heap[1]=I++,T(K,M,1)}while(K.heap_len>=2);K.heap[--K.heap_max]=K.heap[1],((K,H)=>{const M=H.dyn_tree,q=H.max_code,w=H.stat_desc.static_tree,y=H.stat_desc.has_stree,h=H.stat_desc.extra_bits,W=H.stat_desc.extra_base,I=H.stat_desc.max_length;let f,z,G,a,v,O,L=0;for(a=0;a<=u;a++)K.bl_count[a]=0;for(M[2*K.heap[K.heap_max]+1]=0,f=K.heap_max+1;f<573;f++)z=K.heap[f],a=M[2*M[2*z+1]+1]+1,a>I&&(a=I,L++),M[2*z+1]=a,z>q||(K.bl_count[a]++,v=0,z>=W&&(v=h[z-W]),O=M[2*z],K.opt_len+=O*(a+v),y&&(K.static_len+=O*(w[2*z+1]+v)));if(0!==L){do{for(a=I-1;0===K.bl_count[a];)a--;K.bl_count[a]--,K.bl_count[a+1]+=2,K.bl_count[I]--,L-=2}while(L>0);for(a=I;0!==a;a--)for(z=K.bl_count[a];0!==z;)G=K.heap[--f],G>q||(M[2*G+1]!==a&&(K.opt_len+=(a-M[2*G+1])*M[2*G],M[2*G+1]=a),z--)}})(K,H),V(M,f,K.bl_count)},Q=(K,H,M)=>{let q,w,u=-1,y=H[1],h=0,W=7,I=4;for(0===y&&(W=138,I=3),H[2*(M+1)+1]=65535,q=0;q<=M;q++)w=y,y=H[2*(q+1)+1],++h<W&&w===y||(h<I?K.bl_tree[2*w]+=h:0!==w?(w!==u&&K.bl_tree[2*w]++,K.bl_tree[32]++):h<=10?K.bl_tree[34]++:K.bl_tree[36]++,h=0,u=w,0===y?(W=138,I=3):w===y?(W=6,I=3):(W=7,I=4))},J=(K,H,M)=>{let q,w,u=-1,y=H[1],h=0,W=7,I=4;for(0===y&&(W=138,I=3),q=0;q<=M;q++)if(w=y,y=H[2*(q+1)+1],!(++h<W&&w===y)){if(h<I)do{s(K,w,K.bl_tree)}while(0!==--h);else 0!==w?(w!==u&&(s(K,w,K.bl_tree),h--),s(K,16,K.bl_tree),l(K,h-3,2)):h<=10?(s(K,17,K.bl_tree),l(K,h-3,3)):(s(K,18,K.bl_tree),l(K,h-11,7));h=0,u=w,0===y?(W=138,I=3):w===y?(W=6,I=3):(W=7,I=4)}};let N=!1;const p=(K,H,M,q)=>{l(K,0+(q?1:0),3),((K,H,M,q)=>{c(K),q&&(E(K,M),E(K,~M)),K.pending_buf.set(K.window.subarray(H,H+M),K.pending),K.pending+=M})(K,H,M,!0)};K.exports._tr_init=K=>{N||((()=>{let K,H,M,I,i;const Z=new Array(16);for(M=0,I=0;I<28;I++)for(v[I]=M,K=0;K<1<<y[I];K++)a[M++]=I;for(a[M-1]=I,i=0,I=0;I<16;I++)for(O[I]=i,K=0;K<1<<h[I];K++)G[i++]=I;for(i>>=7;I<w;I++)for(O[I]=i<<7,K=0;K<1<<h[I]-7;K++)G[256+i++]=I;for(H=0;H<=u;H++)Z[H]=0;for(K=0;K<=143;)f[2*K+1]=8,K++,Z[8]++;for(;K<=255;)f[2*K+1]=9,K++,Z[9]++;for(;K<=279;)f[2*K+1]=7,K++,Z[7]++;for(;K<=287;)f[2*K+1]=8,K++,Z[8]++;for(V(f,287,Z),K=0;K<w;K++)z[2*K+1]=5,z[2*K]=D(K,5);S=new L(f,y,257,q,u),B=new L(z,h,0,w,u),C=new L(new Array(0),W,0,19,7)})(),N=!0),K.l_desc=new i(K.dyn_ltree,S),K.d_desc=new i(K.dyn_dtree,B),K.bl_desc=new i(K.bl_tree,C),K.bi_buf=0,K.bi_valid=0,n(K)},K.exports._tr_stored_block=p,K.exports._tr_flush_block=(K,H,q,w)=>{let u,y,h=0;K.level>0?(2===K.strm.data_type&&(K.strm.data_type=(K=>{let H,q=4093624447;for(H=0;H<=31;H++,q>>>=1)if(1&q&&0!==K.dyn_ltree[2*H])return 0;if(0!==K.dyn_ltree[18]||0!==K.dyn_ltree[20]||0!==K.dyn_ltree[26])return 1;for(H=32;H<M;H++)if(0!==K.dyn_ltree[2*H])return 1;return 0})(K)),x(K,K.l_desc),x(K,K.d_desc),h=(K=>{let H;for(Q(K,K.dyn_ltree,K.l_desc.max_code),Q(K,K.dyn_dtree,K.d_desc.max_code),x(K,K.bl_desc),H=18;H>=3&&0===K.bl_tree[2*I[H]+1];H--);return K.opt_len+=3*(H+1)+5+5+4,H})(K),u=K.opt_len+3+7>>>3,y=K.static_len+3+7>>>3,y<=u&&(u=y)):u=y=q+5,q+4<=u&&-1!==H?p(K,H,q,w):4===K.strategy||y===u?(l(K,2+(w?1:0),3),d(K,f,z)):(l(K,4+(w?1:0),3),((K,H,M,q)=>{let w;for(l(K,H-257,5),l(K,M-1,5),l(K,q-4,4),w=0;w<q;w++)l(K,K.bl_tree[2*I[w]+1],3);J(K,K.dyn_ltree,H-1),J(K,K.dyn_dtree,M-1)})(K,K.l_desc.max_code+1,K.d_desc.max_code+1,h+1),d(K,K.dyn_ltree,K.dyn_dtree)),n(K),w&&c(K)},K.exports._tr_tally=(K,H,q)=>(K.pending_buf[K.d_buf+2*K.last_lit]=H>>>8&255,K.pending_buf[K.d_buf+2*K.last_lit+1]=255&H,K.pending_buf[K.l_buf+K.last_lit]=255&q,K.last_lit++,0===H?K.dyn_ltree[2*q]++:(K.matches++,H--,K.dyn_ltree[2*(a[q]+M+1)]++,K.dyn_dtree[2*Z(H)]++),K.last_lit===K.lit_bufsize-1),K.exports._tr_align=K=>{l(K,2,3),s(K,256,f),(K=>{16===K.bi_valid?(E(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):K.bi_valid>=8&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)})(K)}},12469:K=>{"use strict";K.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.fH="",this.state=null,this.data_type=2,this.adler=0}},12099:K=>{function H(K,H,M){for(var q=K.length,w=-1/0,u=1/0,y=0;y<q;y++){var h=(M[0][y]-K[y])/H[y],W=(M[1][y]-K[y])/H[y];if(h>W){var I=h;h=W,W=I}if(W<w||h>u)return 1/0;h>w&&(w=h),W<u&&(u=W)}return w>u?1/0:w}K.exports=function(K,M,q,w){var u=H(M,q,w);if(u===1/0)K=null;else{K=K||[];for(var y=0;y<M.length;y++)K[y]=M[y]+q[y]*u}return K},K.exports.distance=H},13464:(K,H,M)=>{"use strict";M.d(H,{e:()=>y});var q=M(30);const w=q.useLayoutEffect;const u=function(K){var H=(0,q.useRef)(K);return w((function(){H.current=K})),H};var y=function(K){var H=u(K);(0,q.hH)((function(){var K=function(K){var M;if(null!=H.current&&(M=H.current(K)),K.defaultPrevented&&(K.returnValue=""),"string"===typeof M)return K.returnValue=M,M};return window.addEventListener("beforeunload",K),function(){window.removeEventListener("beforeunload",K)}}),[])}},13418:(K,H,M)=>{"use strict";var q=M(13420),w=Array.prototype.concat,u=Array.prototype.slice,y=K.exports=function(K){for(var H=[],M=0,y=K.length;M<y;M++){var h=K[M];q(h)?H=w.call(H,u.call(h)):H.push(h)}return H};y.wrap=function(K){return function(){return K(y(arguments))}}},13420:K=>{K.exports=function(K){return!(!K||"string"===typeof K)&&(K instanceof Array||Array.isArray(K)||K.length>=0&&(K.splice instanceof Function||Object.getOwnPropertyDescriptor(K,K.length-1)&&"String"!==K.constructor.name))}},12389:(K,H,M)=>{var q=M(12397);function w(K){for(var H,M,w=0,u=K.length,y=0;y<K.length;){for(H=K[y],M=0;y<u&&K[y]===H;)++y,++M;w+=q.log2(M)/7|0,w+=q.log2(H>>>0)/7|0,w+=2}return w}H.size=w,H.encode=function(K,H){H||(H=new Uint8Array(w(K)));for(var M,q,u=0,y=H.length,h=0;h<K.length;){for(M=K[h],q=0;h<K.length&&K[h]===M;)++h,++q;for(;u<y&&q>=128;)H[u++]=128+(127&q),q>>>=7;if(u>=y)throw new Error("RLE buffer overflow");for(H[u++]=q,M>>>=0;u<y&&M>=128;)H[u++]=128+(127&M),M>>>=7;if(u>=y)throw new Error("RLE buffer overflow");H[u++]=M}return H},H.decode=function(K,H){for(var M,q,w,u,y=H.length,h=K.length,W=0,I=0;I<h;){for(M=0,q=0;I<h&&K[I]>=128;)M+=(127&K[I++])<<q,q+=7;if(M+=K[I++]<<q,I>=h)throw new Error("RLE buffer underrun");if(W+M>y)throw new Error("Chunk buffer overflow");for(w=0,q=0;I<h&&K[I]>=128;)w+=(127&K[I++])<<q,q+=7;if(I>=h)throw new Error("RLE buffer underrun");for(w+=K[I++]<<q,u=0;u<M;++u)H[W++]=w}return H}},12397:(K,H)=>{"use strict";function M(K){var H=32;return(K&=-K)&&H--,65535&K&&(H-=16),16711935&K&&(H-=8),252645135&K&&(H-=4),858993459&K&&(H-=2),1431655765&K&&(H-=1),H}H.INT_BITS=32,H.INT_MAX=2147483647,H.INT_MIN=-1<<31,H.sign=function(K){return(K>0)-(K<0)},H.abs=function(K){var H=K>>31;return(K^H)-H},H.min=function(K,H){return H^(K^H)&-(K<H)},H.max=function(K,H){return K^(K^H)&-(K<H)},H.isPow2=function(K){return!(K&K-1)&&!!K},H.log2=function(K){var H,M;return H=(K>65535)<<4,H|=M=((K>>>=H)>255)<<3,H|=M=((K>>>=M)>15)<<2,(H|=M=((K>>>=M)>3)<<1)|(K>>>=M)>>1},H.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},H.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},H.countTrailingZeros=M,H.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},H.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},H.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var q=new Array(256);!function(K){for(var H=0;H<256;++H){var M=H,q=H,w=7;for(M>>>=1;M;M>>>=1)q<<=1,q|=1&M,--w;K[H]=q<<w&255}}(q),H.reverse=function(K){return q[255&K]<<24|q[K>>>8&255]<<16|q[K>>>16&255]<<8|q[K>>>24&255]},H.interleave2=function(K,H){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(H=1431655765&((H=858993459&((H=252645135&((H=16711935&((H&=65535)|H<<8))|H<<4))|H<<2))|H<<1))<<1},H.deinterleave2=function(K,H){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>H&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},H.interleave3=function(K,H,M){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(H=1227133513&((H=3272356035&((H=251719695&((H=4278190335&((H&=1023)|H<<16))|H<<8))|H<<4))|H<<2))<<1)|(M=1227133513&((M=3272356035&((M=251719695&((M=4278190335&((M&=1023)|M<<16))|M<<8))|M<<4))|M<<2))<<2},H.deinterleave3=function(K,H){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>H&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},H.nextCombination=function(K){var H=K|K-1;return H+1|(~H&-~H)-1>>>M(K)+1}},12415:K=>{"use strict";K.exports=function(K,H,M,q){var w=self||window;try{try{var u;try{u=new w.Blob([K])}catch(I){(u=new(w.BlobBuilder||w.WebKitBlobBuilder||w.MozBlobBuilder||w.MSBlobBuilder)).append(K),u=u.getBlob()}var y=w.URL||w.webkitURL,h=y.createObjectURL(u),W=new w[H](h,M);return y.revokeObjectURL(h),W}catch(I){return new w[H]("data:application/javascript,".concat(encodeURIComponent(K)),M)}}catch(I){if(!q)throw Error("Inline worker is not supported");return new w[H](q,M)}}},12087:(K,H,M)=>{"use strict";function q(K,H,M,q,w){var u={};return Object.keys(q).forEach((function(K){u[K]=q[K]})),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=M.slice().reverse().reduce((function(M,q){return q(K,H,M)||M}),u),w&&void 0!==u.initializer&&(u.value=u.initializer?u.initializer.call(w):void 0,u.initializer=void 0),void 0===u.initializer&&(Object.defineProperty(K,H,u),u=null),u}M.d(H,{d:()=>q})},12081:(K,H,M)=>{"use strict";function q(K,H,M,q){M&&Object.defineProperty(K,H,{enumerable:M.enumerable,configurable:M.configurable,writable:M.writable,value:M.initializer?M.initializer.call(q):void 0})}M.d(H,{d:()=>q})},13458:(K,H,M)=>{"use strict";M.d(H,{c:()=>y,e:()=>z,h:()=>h,j:()=>u,k:()=>W,o:()=>w,p:()=>I,t:()=>f});var q=M(11496);class w{constructor(){this._easingMode=w.EASINGMODE_EASEIN}setEasingMode(K){const H=Math.min(Math.max(K,0),2);this._easingMode=H}getEasingMode(){return this._easingMode}easeInCore(K){throw new Error("You must implement this method")}ease(K){switch(this._easingMode){case w.EASINGMODE_EASEIN:return this.easeInCore(K);case w.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-K)}return K>=.5?.5*(1-this.easeInCore(2*(1-K)))+.5:.5*this.easeInCore(2*K)}}w.EASINGMODE_EASEIN=0,w.EASINGMODE_EASEOUT=1,w.EASINGMODE_EASEINOUT=2;class u extends w{easeInCore(K){return K=Math.max(0,Math.min(1,K)),1-Math.sqrt(1-K*K)}}class y extends w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=K}easeInCore(K){const H=Math.max(0,this.amplitude);return Math.pow(K,3)-K*H*Math.sin(3.141592653589793*K)}}class h extends w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;super(),this.bounces=K,this.bounciness=H}easeInCore(K){const H=Math.max(0,this.bounces);let M=this.bounciness;M<=1&&(M=1.001);const q=Math.pow(M,H),w=1-M,u=(1-q)/w+.5*q,y=K*u,h=Math.log(-y*(1-M)+1)/Math.log(M),W=Math.floor(h),I=W+1,f=(1-Math.pow(M,W))/(w*u),z=.5*(f+(1-Math.pow(M,I))/(w*u)),G=K-z,a=z-f;return-Math.pow(1/M,H-W)/(a*a)*(G-a)*(G+a)}}class W extends w{easeInCore(K){return K*K*K}}class I extends w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;super(),this.oscillations=K,this.springiness=H}easeInCore(K){let H;const M=Math.max(0,this.oscillations),q=Math.max(0,this.springiness);return H=0==q?K:(Math.exp(q*K)-1)/(Math.exp(q)-1),H*Math.sin((6.283185307179586*M+1.5707963267948966)*K)}}class f extends w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=K}easeInCore(K){return this.exponent<=0?K:(Math.exp(this.exponent*K)-1)/(Math.exp(this.exponent)-1)}}class z extends w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.x1=K,this.y1=H,this.x2=M,this.y2=q}easeInCore(K){return q.e.Interpolate(K,this.x1,this.y1,this.x2,this.y2)}}},12920:(K,H,M)=>{"use strict";M.d(H,{e:()=>y});var q=M(11290),w=M(11301),u=M(11704);class y extends u.d{get _matrix(){return this._compose(),this.mG}set _matrix(K){(K.updateFlag!==this.mG.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.mG.q(K),this._markAsDirtyAndDecompose())}constructor(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(K,H.sK(),!1),this.name=K,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=H,this.mG=(null===w||void 0===w?void 0:w.clone())??q.Matrix.Identity(),this._restMatrix=u??this.mG.clone(),this._bindMatrix=y??this.mG.clone(),this._index=h,this._absoluteMatrix=new q.Matrix,this._absoluteBindMatrix=new q.Matrix,this._absoluteInverseBindMatrix=new q.Matrix,this._finalMatrix=new q.Matrix,H.bones.push(this),this.setParent(M,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(K){this.setParent(K)}setParent(K){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==K){if(this.parent){const K=this.parent.children.indexOf(this);-1!==K&&this.parent.children.splice(K,1)}this._parentNode=K,this.parent&&this.parent.children.push(this),H&&this._updateAbsoluteBindMatrices(),this.rI()}}getLocalMatrix(){return this._compose(),this.mG}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(K){this._restMatrix.q(K)}setRestPose(K){this.setRestMatrix(K)}getBindPose(){return this.getBindMatrix()}setBindMatrix(K){this.fh(K)}setBindPose(K){this.setBindMatrix(K)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const K=q.TmpVectors.OH[0],H=q.TmpVectors.Quaternion[0],M=q.TmpVectors.OH[1];this.getRestMatrix().decompose(K,H,M),this._linkedTransformNode.position.q(M),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??q.Quaternion.Identity(),this._linkedTransformNode.rotationQuaternion.q(H),this._linkedTransformNode.Sh.q(K)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(K){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=K,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Ph}set position(K){this._decompose(),this.Ph.q(K),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(K){this.setRotation(K)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(K){this.setRotationQuaternion(K)}get Sh(){return this.getScale()}set Sh(K){this.setScale(K)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=q.OH.Zero(),this._localRotation=q.Quaternion.Zero(),this.Ph=q.OH.Zero()),this.mG.decompose(this._localScaling,this._localRotation,this.Ph))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,q.Matrix.ComposeToRef(this._localScaling,this._localRotation,this.Ph,this.mG)):this._needToCompose=!1)}fh(K){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.q(K),H&&this._updateAbsoluteBindMatrices(),M?this._matrix=K:this.rI()}_updateAbsoluteBindMatrices(K){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K||(K=this._bindMatrix),this.parent?K.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.q(K),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),H)for(let M=0;M<this.children.length;M++)this.children[M]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}rI(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.rI(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.rI(),this._needToDecompose=!0}_updatePosition(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const u=this.getLocalMatrix();if(0==H)w?(u.addAtIndex(12,K.x),u.addAtIndex(13,K.y),u.addAtIndex(14,K.z)):u.setTranslationFromFloats(K.x,K.y,K.z);else{let H=null;M&&(H=M.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const h=y._TmpMats[0],W=y._TmpVecs[0];this.parent?M&&H?(h.q(this.parent.getAbsoluteMatrix()),h.multiplyToRef(H,h)):h.q(this.parent.getAbsoluteMatrix()):q.Matrix.IdentityToRef(h),w&&h.setTranslationFromFloats(0,0,0),h.invert(),q.OH.TransformCoordinatesToRef(K,h,W),w?(u.addAtIndex(12,W.x),u.addAtIndex(13,W.y),u.addAtIndex(14,W.z)):u.setTranslationFromFloats(W.x,W.y,W.z)}this._markAsDirtyAndDecompose()}translate(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,H,M,!0)}setPosition(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,H,M,!1)}setAbsolutePosition(K,H){this.setPosition(K,1,H)}scale(K,H,M){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const u=this.getLocalMatrix(),h=y._TmpMats[0];q.Matrix.ScalingToRef(K,H,M,h),h.multiplyToRef(u,u),h.invert();for(const q of this.children){const w=q.getLocalMatrix();w.multiplyToRef(h,w),w.multiplyAtIndex(12,K),w.multiplyAtIndex(13,H),w.multiplyAtIndex(14,M),q._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),w)for(const q of this.children)q.scale(K,H,M,w)}setScale(K){this._decompose(),this._localScaling.q(K),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(K){this._decompose(),K.q(this._localScaling)}setYawPitchRoll(K,H,M){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4?arguments[4]:void 0;if(0===w){const h=y._TmpQuat;return q.Quaternion.RotationYawPitchRollToRef(K,H,M,h),void this.setRotationQuaternion(h,w,u)}const h=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(h,u))return;const W=y._TmpMats[1];q.Matrix.RotationYawPitchRollToRef(K,H,M,W),h.multiplyToRef(W,W),this._rotateWithMatrix(W,w,u)}rotate(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3?arguments[3]:void 0;const u=y._TmpMats[0];u.setTranslationFromFloats(0,0,0),q.Matrix.RotationAxisToRef(K,H,u),this._rotateWithMatrix(u,M,w)}setAxisAngle(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3?arguments[3]:void 0;if(0===M){const u=y._TmpQuat;return q.Quaternion.RotationAxisToRef(K,H,u),void this.setRotationQuaternion(u,M,w)}const u=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(u,w))return;const h=y._TmpMats[1];q.Matrix.RotationAxisToRef(K,H,h),u.multiplyToRef(h,h),this._rotateWithMatrix(h,M,w)}setRotation(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(K.y,K.x,K.z,H,M)}setRotationQuaternion(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;if(0===H)return this._decompose(),this._localRotation.q(K),void this._markAsDirtyAndCompose();const w=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,M))return;const u=y._TmpMats[1];q.Matrix.FromQuaternionToRef(K,u),w.multiplyToRef(u,u),this._rotateWithMatrix(u,H,M)}setRotationMatrix(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;if(0===H){const w=y._TmpQuat;return q.Quaternion.FromRotationMatrixToRef(K,w),void this.setRotationQuaternion(w,H,M)}const w=y._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(w,M))return;const u=y._TmpMats[1];u.q(K),w.multiplyToRef(K,u),this._rotateWithMatrix(u,H,M)}_rotateWithMatrix(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;const q=this.getLocalMatrix(),w=q.m[12],u=q.m[13],h=q.m[14],W=this.getParent(),I=y._TmpMats[3],f=y._TmpMats[4];W&&1==H?(M?(I.q(M.getWorldMatrix()),W.getAbsoluteMatrix().multiplyToRef(I,I)):I.q(W.getAbsoluteMatrix()),f.q(I),f.invert(),q.multiplyToRef(I,q),q.multiplyToRef(K,q),q.multiplyToRef(f,q)):1==H&&M?(I.q(M.getWorldMatrix()),f.q(I),f.invert(),q.multiplyToRef(I,q),q.multiplyToRef(K,q),q.multiplyToRef(f,q)):q.multiplyToRef(K,q),q.setTranslationFromFloats(w,u,h),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(K,H){const M=y._TmpMats[2];return K.q(this.getAbsoluteMatrix()),H?(K.multiplyToRef(H.getWorldMatrix(),K),q.Matrix.ScalingToRef(H.Sh.x,H.Sh.y,H.Sh.z,M)):q.Matrix.IdentityToRef(M),K.invert(),!isNaN(K.m[0])&&(M.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyToRef(M,K),!0)}qq(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=q.OH.Zero();return this.getPositionToRef(K,H,M),M}getPositionToRef(){let K=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const K=this.getLocalMatrix();H.x=K.m[12],H.y=K.m[13],H.z=K.m[14]}else{let M=null;K&&(M=K.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let q=y._TmpMats[0];K&&M?(q.q(this.getAbsoluteMatrix()),q.multiplyToRef(M,q)):q=this.getAbsoluteMatrix(),H.x=q.m[12],H.y=q.m[13],H.z=q.m[14]}}getAbsolutePosition(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const H=q.OH.Zero();return this.getPositionToRef(1,K,H),H}getAbsolutePositionToRef(K,H){this.getPositionToRef(1,K,H)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.mG.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.q(this.mG);const K=this._skeleton.getPoseMatrix();K&&this._absoluteMatrix.multiplyToRef(K,this._absoluteMatrix)}const K=this.children,H=K.length;for(let M=0;M<H;M++)K[M].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}DW(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=q.OH.Zero();return this.getDirectionToRef(K,H,M),M}getDirectionToRef(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,w=null;H&&(w=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=y._TmpMats[0];u.q(this.getAbsoluteMatrix()),H&&w&&u.multiplyToRef(w,u),q.OH.TransformNormalToRef(K,u,M),M.normalize()}getRotation(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=q.OH.Zero();return this.getRotationToRef(K,H,M),M}getRotationToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0;const q=y._TmpQuat;this.getRotationQuaternionToRef(K,H,q),q.toEulerAnglesToRef(M)}getRotationQuaternion(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=q.Quaternion.Identity();return this.getRotationQuaternionToRef(K,H,M),M}getRotationQuaternionToRef(){let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),H.q(this._localRotation);else{const M=y._TmpMats[0],q=this.getAbsoluteMatrix();K?q.multiplyToRef(K.getWorldMatrix(),M):M.q(q),M.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyAtIndex(1,this._scalingDeterminant),M.multiplyAtIndex(2,this._scalingDeterminant),M.decompose(void 0,H,void 0)}}getRotationMatrix(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1?arguments[1]:void 0;const M=q.Matrix.Identity();return this.getRotationMatrixToRef(K,H,M),M}getRotationMatrixToRef(){let K=arguments.length>1?arguments[1]:void 0,H=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(H);else{const M=y._TmpMats[0],q=this.getAbsoluteMatrix();K?q.multiplyToRef(K.getWorldMatrix(),M):M.q(q),M.multiplyAtIndex(0,this._scalingDeterminant),M.multiplyAtIndex(1,this._scalingDeterminant),M.multiplyAtIndex(2,this._scalingDeterminant),M.getRotationMatrixToRef(H)}}getAbsolutePositionFromLocal(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=q.OH.Zero();return this.getAbsolutePositionFromLocalToRef(K,H,M),M}getAbsolutePositionFromLocalToRef(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,w=null;H&&(w=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=y._TmpMats[0];u.q(this.getAbsoluteMatrix()),H&&w&&u.multiplyToRef(w,u),q.OH.TransformCoordinatesToRef(K,u,M)}getLocalPositionFromAbsolute(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=q.OH.Zero();return this.getLocalPositionFromAbsoluteToRef(K,H,M),M}getLocalPositionFromAbsoluteToRef(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2?arguments[2]:void 0,w=null;H&&(w=H.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const u=y._TmpMats[0];u.q(this.getAbsoluteMatrix()),H&&w&&u.multiplyToRef(w,u),u.invert(),q.OH.TransformCoordinatesToRef(K,u,M)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}dispose(){this._linkedTransformNode=null;const K=this._skeleton.bones.indexOf(this);if(-1!==K&&this._skeleton.bones.splice(K,1),this._parentNode&&this._parentNode.children){const K=this._parentNode.children,H=K.indexOf(this);-1!==H&&K.splice(H,1)}super.dispose()}}y._TmpVecs=(0,w.d)(2,q.OH.Zero),y._TmpQuat=q.Quaternion.Identity(),y._TmpMats=(0,w.d)(5,q.Matrix.Identity)},13451:(K,H,M)=>{"use strict";M.d(H,{c:()=>x});var q=M(11274),w=M(11280),u=M(11102),y=M(11290),h=M(11307),W=M(11704),I=M(11726),f=M(11561),z=M(11125),G=M(11297);class a{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(K){this._idleRotationSpeed=K}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(K){this._idleRotationWaitTime=K}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(K){this._idleRotationSpinupTime=K}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(K){this._attachedCamera=K;const H=this._attachedCamera.sK();this._onPrePointerObservableObserver=H.onPrePointerObservable.add((K=>{K.type!==f.c.POINTERDOWN?K.type===f.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const K=z.d.Now;let H=0;null!=this._lastFrameTime&&(H=K-this._lastFrameTime),this._lastFrameTime=K,this._applyUserInteraction();const M=K-this._lastInteractionTime-this._idleRotationWaitTime,q=Math.max(Math.min(M/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*q,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(H/1e3))}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.sK();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(K){this._lastInteractionTime=K??z.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<G.d}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let K=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(K=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?K:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=z.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}var v=M(13458),O=M(11811);class L{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(K){if(this._autoTransitionRange===K)return;this._autoTransitionRange=K;const H=this._attachedCamera;H&&(K?this._onMeshTargetChangedObserver=H.onMeshTargetChangedObservable.add((K=>{if(K&&(K.zh(!0),K.getBoundingInfo)){const H=K.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*H,this.upperRadiusTransitionRange=.05*H}})):this._onMeshTargetChangedObserver&&H.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(K){this._attachedCamera=K,this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(K){return!!this._attachedCamera&&(this._attachedCamera.radius===K&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(K){if(!this._attachedCamera)return;this._radiusBounceTransition||(L.EasingFunction.setEasingMode(L.EasingMode),this._radiusBounceTransition=O.d.CreateAnimation("radius",O.d.ANIMATIONTYPE_FLOAT,60,L.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const H=O.d.TransitionTo("radius",this._attachedCamera.radius+K,this._attachedCamera,this._attachedCamera.sK(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));H&&this._animatables.push(H)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}L.EasingFunction=new v.c(.3),L.EasingMode=v.o.EASINGMODE_EASEOUT;class S{constructor(){this.onTargetFramingAnimationEndObservable=new u.d,this._mode=S.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(K){this._mode=K}get mode(){return this._mode}set radiusScale(K){this._radiusScale=K}get radiusScale(){return this._radiusScale}set positionScale(K){this._positionScale=K}get positionScale(){return this._positionScale}set defaultElevation(K){this._defaultElevation=K}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(K){this._elevationReturnTime=K}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(K){this._elevationReturnWaitTime=K}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(K){this._framingTime=K}get framingTime(){return this._framingTime}init(){}attach(K){this._attachedCamera=K;const H=this._attachedCamera.sK();S.EasingFunction.setEasingMode(S.EasingMode),this._onPrePointerObservableObserver=H.onPrePointerObservable.add((K=>{K.type!==f.c.POINTERDOWN?K.type===f.c.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=K.onMeshTargetChangedObservable.add((K=>{K&&K.getBoundingInfo&&this.zoomOnMesh(K,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.sK();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.zh(!0);const q=K.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(q.minimumWorld,q.maximumWorld,H,M)}zoomOnMeshHierarchy(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.zh(!0);const q=K.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(q.min,q.max,H,M)}zoomOnMeshesHierarchy(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new y.OH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),w=new y.OH(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let u=0;u<K.length;u++){const H=K[u].getHierarchyBoundingVectors(!0);y.OH.CheckExtends(H.min,q,w),y.OH.CheckExtends(H.max,q,w)}this.zoomOnBoundingInfo(q,w,H,M)}zoomOnBoundingInfo(K,H){let M,q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const u=K.y,h=u+(H.y-u)*this._positionScale,W=H.LH(K).scale(.5);if(!isFinite(h))return!1;if(q)M=new y.OH(0,h,0);else{const H=K.add(W);M=new y.OH(H.x,h,H.z)}this._vectorTransition||(this._vectorTransition=O.d.CreateAnimation("target",O.d.ANIMATIONTYPE_VECTOR3,60,S.EasingFunction)),this._betaIsAnimating=!0;let I=O.d.TransitionTo("target",M,this._attachedCamera,this._attachedCamera.sK(),60,this._vectorTransition,this._framingTime);I&&this._animatables.push(I);let f=0;if(this._mode===S.FitFrustumSidesMode){const M=this._calculateLowerRadiusFromModelBoundingSphere(K,H);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=W.length()+this._attachedCamera.Ih),f=M}else this._mode===S.IgnoreBoundsSizeMode&&(f=this._calculateLowerRadiusFromModelBoundingSphere(K,H),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ih));if(this.autoCorrectCameraLimitsAndSensibility){const M=H.LH(K).length();this._attachedCamera.panningSensibility=5e3/M,this._attachedCamera.wheelPrecision=100/f}return this._radiusTransition||(this._radiusTransition=O.d.CreateAnimation("radius",O.d.ANIMATIONTYPE_FLOAT,60,S.EasingFunction)),I=O.d.TransitionTo("radius",f,this._attachedCamera,this._attachedCamera.sK(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),w&&w(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),I&&this._animatables.push(I),!0}_calculateLowerRadiusFromModelBoundingSphere(K,H){const M=this._attachedCamera;if(!M)return 0;let q=M._calculateLowerRadiusFromModelBoundingSphere(K,H,this._radiusScale);return M.lowerRadiusLimit&&this._mode===S.IgnoreBoundsSizeMode&&(q=q<M.lowerRadiusLimit?M.lowerRadiusLimit:q),M.upperRadiusLimit&&(q=q>M.upperRadiusLimit?M.upperRadiusLimit:q),q}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const K=z.d.Now-this._lastInteractionTime,H=.5*Math.PI-this._defaultElevation,M=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>M&&K>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=O.d.CreateAnimation("beta",O.d.ANIMATIONTYPE_FLOAT,60,S.EasingFunction));const K=O.d.TransitionTo("beta",H,this._attachedCamera,this._attachedCamera.sK(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));K&&this._animatables.push(K)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=z.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}S.EasingFunction=new v.t,S.EasingMode=v.o.EASINGMODE_EASEINOUT,S.IgnoreBoundsSizeMode=0,S.FitFrustumSidesMode=1;var B=M(11733),C=M(11774),i=M(12917),Z=M(11100);class E{constructor(){this._currentMousePointerIdDown=-1,this.buttons=[0,1,2]}attachControl(K){K=Z.Tools.BackCompatCameraNoPreventDefault(arguments);const H=this.camera.getEngine(),M=H.getInputElement();let q=0,w=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=u=>{var y,h;const W=u.event,I="touch"===W.pointerType;if(u.type!==f.c.POINTERMOVE&&-1===this.buttons.indexOf(W.button))return;const z=W.target;if(this._altKey=W.altKey,this._ctrlKey=W.ctrlKey,this._metaKey=W.metaKey,this._shiftKey=W.shiftKey,this._buttonsPressed=W.buttons,H.isPointerLock){const K=W.movementX,H=W.movementY;this.onTouch(null,K,H),this._pointA=null,this._pointB=null}else{if(u.type!==f.c.POINTERDOWN&&u.type!==f.c.POINTERDOUBLETAP&&I&&(null===(y=this._pointA)||void 0===y?void 0:y.pointerId)!==W.pointerId&&(null===(h=this._pointB)||void 0===h?void 0:h.pointerId)!==W.pointerId)return;if(u.type!==f.c.POINTERDOWN||-1!==this._currentMousePointerIdDown&&!I)if(u.type===f.c.POINTERDOUBLETAP)this.onDoubleTap(W.pointerType);else if(u.type!==f.c.POINTERUP||this._currentMousePointerIdDown!==W.pointerId&&!I){if(u.type===f.c.POINTERMOVE)if(K||W.preventDefault(),this._pointA&&null===this._pointB){const K=W.clientX-this._pointA.x,H=W.clientY-this._pointA.y;this._pointA.x=W.clientX,this._pointA.y=W.clientY,this.onTouch(this._pointA,K,H)}else if(this._pointA&&this._pointB){const K=this._pointA.pointerId===W.pointerId?this._pointA:this._pointB;K.x=W.clientX,K.y=W.clientY;const H=this._pointA.x-this._pointB.x,M=this._pointA.y-this._pointB.y,y=H*H+M*M,h={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:W.pointerId,type:u.type};this.onMultiTouch(this._pointA,this._pointB,q,y,w,h),w=h,q=y}}else{try{null===z||void 0===z||z.releasePointerCapture(W.pointerId)}catch(G){}I||(this._pointB=null),H._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==W.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==W.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==q||w)&&(this.onMultiTouch(this._pointA,this._pointB,q,0,w,null),q=0,w=null),this._currentMousePointerIdDown=-1,this.onButtonUp(W),K||W.preventDefault()}else{try{null===z||void 0===z||z.setPointerCapture(W.pointerId)}catch(G){}if(null===this._pointA)this._pointA={x:W.clientX,y:W.clientY,pointerId:W.pointerId,type:W.pointerType};else{if(null!==this._pointB)return;this._pointB={x:W.clientX,y:W.clientY,pointerId:W.pointerId,type:W.pointerType}}-1!==this._currentMousePointerIdDown||I||(this._currentMousePointerIdDown=W.pointerId),this.onButtonDown(W),K||(W.preventDefault(),M&&M.focus())}}},this._observer=this.camera.sK()._inputManager._addCameraPointerObserver(this._pointerInput,f.c.POINTERDOWN|f.c.POINTERUP|f.c.POINTERMOVE|f.c.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,q=0,w=null,this.onLostFocus()},this._contextMenuBind=K=>this.onContextMenu(K),M&&M.addEventListener("contextmenu",this._contextMenuBind,!1);const u=this.camera.sK().getEngine().getHostWindow();u&&Z.Tools.RegisterTopRootEvents(u,[{name:"blur",handler:this._onLostFocus}])}KG(){if(this._onLostFocus){const K=this.camera.sK().getEngine().getHostWindow();K&&Z.Tools.UnregisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.sK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const K=this.camera.sK().getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentMousePointerIdDown=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(K){}onTouch(K,H,M){}onMultiTouch(K,H,M,q,w,u){}onContextMenu(K){K.preventDefault()}onButtonDown(K){}onButtonUp(K){}onLostFocus(){}}(0,q.e)([(0,w.J)()],E.prototype,"buttons",void 0);class l extends E{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(K,H){if(0!==this.panningSensibility&&K&&H){const M=H.x-K.x,q=H.y-K.y;this.camera.inertialPanningX+=-M/this.panningSensibility,this.camera.inertialPanningY+=q/this.panningSensibility}}_computePinchZoom(K,H){const M=this.camera.radius||l.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=M*Math.sqrt(K)/Math.sqrt(H):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(H-K)*M*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(H-K)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(K,H,M){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-H/this.panningSensibility,this.camera.inertialPanningY+=M/this.panningSensibility):(this.camera.inertialAlphaOffset-=H/this.angularSensibilityX,this.camera.inertialBetaOffset-=M/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(K,H,M,q,w,u){0===M&&null===w||0===q&&null===u||(this.multiTouchPanAndZoom?(this._computePinchZoom(M,q),this._computeMultiTouchPanning(w,u)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(q)-Math.sqrt(M))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(M,q),this._isPinching=!0):this._computeMultiTouchPanning(w,u)):this.multiTouchPanning?this._computeMultiTouchPanning(w,u):this.pinchZoom&&this._computePinchZoom(M,q))}onButtonDown(K){this._isPanClick=K.button===this.camera._panningMouseButton}onButtonUp(K){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}l.MinimumRadiusForPinch=.001,(0,q.e)([(0,w.J)()],l.prototype,"buttons",void 0),(0,q.e)([(0,w.J)()],l.prototype,"angularSensibilityX",void 0),(0,q.e)([(0,w.J)()],l.prototype,"angularSensibilityY",void 0),(0,q.e)([(0,w.J)()],l.prototype,"pinchPrecision",void 0),(0,q.e)([(0,w.J)()],l.prototype,"pinchDeltaPercentage",void 0),(0,q.e)([(0,w.J)()],l.prototype,"useNaturalPinchZoom",void 0),(0,q.e)([(0,w.J)()],l.prototype,"pinchZoom",void 0),(0,q.e)([(0,w.J)()],l.prototype,"panningSensibility",void 0),(0,q.e)([(0,w.J)()],l.prototype,"multiTouchPanning",void 0),(0,q.e)([(0,w.J)()],l.prototype,"multiTouchPanAndZoom",void 0),i.b.ArcRotateCameraPointersInput=l;var s=M(11567);class D{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(K){K=Z.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sK(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((H=>{const M=H.event;if(!M.metaKey)if(H.type===s.d.KEYDOWN){if(this._ctrlPressed=M.ctrlKey,this._altPressed=M.altKey,-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysReset.indexOf(M.keyCode)){-1===this._keys.indexOf(M.keyCode)&&this._keys.push(M.keyCode),M.preventDefault&&(K||M.preventDefault())}}else if(-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysReset.indexOf(M.keyCode)){const H=this._keys.indexOf(M.keyCode);H>=0&&this._keys.splice(H,1),M.preventDefault&&(K||M.preventDefault())}})))}KG(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let H=0;H<this._keys.length;H++){const M=this._keys[H];-1!==this.keysLeft.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX-=1/this.panningSensibility:K.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset+=1/this.zoomingSensibility:K.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX+=1/this.panningSensibility:K.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(M)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset-=1/this.zoomingSensibility:K.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(M)&&K.useInputToRestoreState&&K.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,q.e)([(0,w.J)()],D.prototype,"keysUp",void 0),(0,q.e)([(0,w.J)()],D.prototype,"keysDown",void 0),(0,q.e)([(0,w.J)()],D.prototype,"keysLeft",void 0),(0,q.e)([(0,w.J)()],D.prototype,"keysRight",void 0),(0,q.e)([(0,w.J)()],D.prototype,"keysReset",void 0),(0,q.e)([(0,w.J)()],D.prototype,"panningSensibility",void 0),(0,q.e)([(0,w.J)()],D.prototype,"zoomingSensibility",void 0),(0,q.e)([(0,w.J)()],D.prototype,"useAltToZoom",void 0),(0,q.e)([(0,w.J)()],D.prototype,"angularSpeed",void 0),i.b.ArcRotateCameraKeyboardMoveInput=D;var V=M(11334),n=M(11573);class c{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new y.OH(0,0,0),this._globalOffset=new y.OH(0,0,0),this._inertialPanning=y.OH.Zero()}_computeDeltaFromMouseWheelLegacyEvent(K,H){let M=0;const q=.01*K*this.wheelDeltaPercentage*H;return M=K>0?q/(1+this.wheelDeltaPercentage):q*(1+this.wheelDeltaPercentage),M}attachControl(K){K=Z.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=H=>{if(H.type!==f.c.POINTERWHEEL)return;const M=H.event;let q=0;const w=M.deltaMode===n.b.DOM_DELTA_LINE?40:1,u=-M.deltaY*w;if(this.customComputeDeltaFromMouseWheel)q=this.customComputeDeltaFromMouseWheel(u,this,M);else if(this.wheelDeltaPercentage){if(q=this._computeDeltaFromMouseWheelLegacyEvent(u,this.camera.radius),q>0){let K=this.camera.radius,H=this.camera.inertialRadiusOffset+q;for(let M=0;M<20&&!(K<=H)&&!(Math.abs(H*this.camera.inertia)<.001);M++)K-=H,H*=this.camera.inertia;K=(0,h.Clamp)(K,0,Number.MAX_VALUE),q=this._computeDeltaFromMouseWheelLegacyEvent(u,K)}}else q=u/(40*this.wheelPrecision);q&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(q)):this.camera.inertialRadiusOffset+=q),M.preventDefault&&(K||M.preventDefault())},this._observer=this.camera.sK()._inputManager._addCameraPointerObserver(this._wheel,f.c.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Bh(0)}KG(){this._observer&&(this.camera.sK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const K=this.camera;0+K.inertialAlphaOffset+K.inertialBetaOffset+K.inertialRadiusOffset&&(this._updateHitPlane(),K.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(K.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const K=this.camera,H=K.target.LH(K.position);this._hitPlane=V.e.FromPositionAndNormal(K.target,H)}_getPosition(){const K=this.camera,H=K.sK(),M=H.createPickingRay(H.pointerX,H.pointerY,y.Matrix.Identity(),K,!1);0===K.targetScreenOffset.x&&0===K.targetScreenOffset.y||(this._viewOffset.set(K.targetScreenOffset.x,K.targetScreenOffset.y,0),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),this._globalOffset=y.OH.TransformNormal(this._viewOffset,K._cameraTransformMatrix),M.origin.addInPlace(this._globalOffset));let q=0;return this._hitPlane&&(q=M.intersectsPlane(this._hitPlane)??0),M.origin.addInPlace(M.direction.scaleInPlace(q))}_zoomToMouse(K){const H=this.camera,M=1-H.inertia;if(H.lowerRadiusLimit){const q=H.lowerRadiusLimit??0;H.radius-(H.inertialRadiusOffset+K)/M<q&&(K=(H.radius-q)*M-H.inertialRadiusOffset)}if(H.upperRadiusLimit){const q=H.upperRadiusLimit??0;H.radius-(H.inertialRadiusOffset+K)/M>q&&(K=(H.radius-q)*M-H.inertialRadiusOffset)}const q=K/M/H.radius,w=this._getPosition(),u=y.TmpVectors.OH[6];w.subtractToRef(H.target,u),u.scaleInPlace(q),u.scaleInPlace(M),this._inertialPanning.addInPlace(u),H.inertialRadiusOffset+=K}_zeroIfClose(K){Math.abs(K.x)<G.d&&(K.x=0),Math.abs(K.y)<G.d&&(K.y=0),Math.abs(K.z)<G.d&&(K.z=0)}}(0,q.e)([(0,w.J)()],c.prototype,"wheelPrecision",void 0),(0,q.e)([(0,w.J)()],c.prototype,"zoomToMouseLocation",void 0),(0,q.e)([(0,w.J)()],c.prototype,"wheelDeltaPercentage",void 0),i.b.ArcRotateCameraMouseWheelInput=c;class k extends i.f{constructor(K){super(K)}addMouseWheel(){return this.add(new c),this}addPointers(){return this.add(new l),this}addKeyboard(){return this.add(new D),this}}var T=M(11242);function d(K,H){return isNaN(K)?H:K}W.d.AddNodeConstructor("ArcRotateCamera",((K,H)=>()=>new x(K,0,0,1,y.OH.Zero(),H)));class x extends C.e{get target(){return this._target}set target(K){this.setTarget(K)}get targetHost(){return this._targetHost}set targetHost(K){K&&this.setTarget(K)}getTarget(){return this.target}get position(){return this._position}set position(K){this.setPosition(K)}set upVector(K){this._upToYMatrix||(this._yToUpMatrix=new y.Matrix,this._upToYMatrix=new y.Matrix,this._upVector=y.OH.Zero()),K.normalize(),this._upVector.q(K),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){y.Matrix.RotationAlignToRef(y.OH.UpReadOnly,this._upVector,this._yToUpMatrix),y.Matrix.RotationAlignToRef(this._upVector,y.OH.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityX:0}set angularSensibilityX(K){const H=this.inputs.attached.pointers;H&&(H.angularSensibilityX=K)}get angularSensibilityY(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityY:0}set angularSensibilityY(K){const H=this.inputs.attached.pointers;H&&(H.angularSensibilityY=K)}get pinchPrecision(){const K=this.inputs.attached.pointers;return K?K.pinchPrecision:0}set pinchPrecision(K){const H=this.inputs.attached.pointers;H&&(H.pinchPrecision=K)}get pinchDeltaPercentage(){const K=this.inputs.attached.pointers;return K?K.pinchDeltaPercentage:0}set pinchDeltaPercentage(K){const H=this.inputs.attached.pointers;H&&(H.pinchDeltaPercentage=K)}get useNaturalPinchZoom(){const K=this.inputs.attached.pointers;return!!K&&K.useNaturalPinchZoom}set useNaturalPinchZoom(K){const H=this.inputs.attached.pointers;H&&(H.useNaturalPinchZoom=K)}get panningSensibility(){const K=this.inputs.attached.pointers;return K?K.panningSensibility:0}set panningSensibility(K){const H=this.inputs.attached.pointers;H&&(H.panningSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const H=this.inputs.attached.keyboard;H&&(H.keysUp=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const H=this.inputs.attached.keyboard;H&&(H.keysDown=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const H=this.inputs.attached.keyboard;H&&(H.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const H=this.inputs.attached.keyboard;H&&(H.keysRight=K)}get wheelPrecision(){const K=this.inputs.attached.mousewheel;return K?K.wheelPrecision:0}set wheelPrecision(K){const H=this.inputs.attached.mousewheel;H&&(H.wheelPrecision=K)}get zoomToMouseLocation(){const K=this.inputs.attached.mousewheel;return!!K&&K.zoomToMouseLocation}set zoomToMouseLocation(K){const H=this.inputs.attached.mousewheel;H&&(H.zoomToMouseLocation=K)}get wheelDeltaPercentage(){const K=this.inputs.attached.mousewheel;return K?K.wheelDeltaPercentage:0}set wheelDeltaPercentage(K){const H=this.inputs.attached.mousewheel;H&&(H.wheelDeltaPercentage=K)}get isInterpolating(){return this._isInterpolating}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(K){K!==this.useBouncingBehavior&&(K?(this._bouncingBehavior=new L,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(K){K!==this.useFramingBehavior&&(K?(this._framingBehavior=new S,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(K){K!==this.useAutoRotationBehavior&&(K?(this._autoRotationBehavior=new a,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(K,H,M,q,w,h){var W;let I=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(K,y.OH.Zero(),h,I),W=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.lowerTargetYLimit=-1/0,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=y.OH.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=y.Vector2.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._currentInterpolationFactor=0,this._viewMatrix=new y.Matrix,this.panningAxis=new y.OH(1,1,0),this._transformedDirection=new y.OH,this.mapPanning=!1,this._isInterpolating=!1,this.onMeshTargetChangedObservable=new u.d,this.checkCollisions=!1,this.collisionRadius=new y.OH(.5,.5,.5),this._previousPosition=y.OH.Zero(),this._collisionVelocity=y.OH.Zero(),this._newPosition=y.OH.Zero(),this._computationVector=y.OH.Zero(),this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget=new y.OH(NaN,NaN,NaN),this._goalTargetScreenOffset=new y.Vector2(NaN,NaN),this._onCollisionPositionChange=function(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M?(W.setPosition(H),W.pa&&W.pa(M)):W._previousPosition.q(W._position);const q=Math.cos(W.alpha),w=Math.sin(W.alpha),u=Math.cos(W.beta);let y=Math.sin(W.beta);0===y&&(y=1e-4);const h=W._getTargetPosition();W._computationVector.Lh(W.radius*q*y,W.radius*u,W.radius*w*y),h.addToRef(W._computationVector,W._newPosition),W._position.q(W._newPosition);let I=W.upVector;W.allowUpsideDown&&W.beta<0&&(I=I.clone(),I=I.negate()),W._computeViewMatrix(W._position,h,I),W._viewMatrix.addAtIndex(12,W.targetScreenOffset.x),W._viewMatrix.addAtIndex(13,W.targetScreenOffset.y),W._collisionTriggered=!1},this._target=y.OH.Zero(),w&&this.setTarget(w),this.alpha=H,this.beta=M,this.radius=q,this.getViewMatrix(),this.inputs=new k(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new y.OH(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=y.Vector2.Zero()}_updateCache(K){K||super._updateCache(),this._cache._target.q(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.q(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const K=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?K.addToRef(this._targetBoundingCenter,this._target):this._target.q(K)}const K=this._getLockedTargetPosition();return K||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>G.d&&this.restoreStateInterpolationFactor<1?(this.interpolateTo(this._storedAlpha,this._storedBeta,this._storedRadius,this._storedTarget,this._storedTargetScreenOffset,this.restoreStateInterpolationFactor),!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}stopInterpolation(){this._goalAlpha=NaN,this._goalBeta=NaN,this._goalRadius=NaN,this._goalTarget.set(NaN,NaN,NaN),this._goalTargetScreenOffset.set(NaN,NaN)}interpolateTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.alpha,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.beta,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.radius,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.target,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.targetScreenOffset,u=arguments.length>5?arguments[5]:void 0;this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,null!=u?this._currentInterpolationFactor=u:0!==this.restoreStateInterpolationFactor?this._currentInterpolationFactor=this.restoreStateInterpolationFactor:this._currentInterpolationFactor=.1,this._goalAlpha=d(K,this._goalAlpha),this._goalBeta=d(H,this._goalBeta),this._goalRadius=d(M,this._goalRadius),this._goalTarget.set(d(q.x,this._goalTarget.x),d(q.y,this._goalTarget.y),d(q.z,this._goalTarget.z)),this._goalTargetScreenOffset.set(d(w.x,this._goalTargetScreenOffset.x),d(w.y,this._goalTargetScreenOffset.y)),this._goalAlpha=(0,h.Clamp)(this._goalAlpha,this.lowerAlphaLimit??-1/0,this.upperAlphaLimit??1/0),this._goalBeta=(0,h.Clamp)(this._goalBeta,this.lowerBetaLimit??-1/0,this.upperBetaLimit??1/0),this._goalRadius=(0,h.Clamp)(this._goalRadius,this.lowerRadiusLimit??-1/0,this.upperRadiusLimit??1/0),this._goalTarget.y=(0,h.Clamp)(this._goalTarget.y,this.lowerTargetYLimit??-1/0,1/0),this._isInterpolating=!0}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(K,H){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const w=arguments;H=Z.Tools.BackCompatCameraNoPreventDefault(w),this._useCtrlForPanning=M,this._panningMouseButton=q,"boolean"===typeof w[0]&&(w.length>1&&(this._useCtrlForPanning=w[1]),w.length>2&&(this._panningMouseButton=w[2])),this.inputs.attachElement(H),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}KG(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(this._collisionTriggered)return;this.inputs.checkInputs();let K=!1;if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){K=!0;const H=this.invertRotation?-1:1,M=this._calculateHandednessMultiplier();let q=this.inertialAlphaOffset*M;this.beta<0&&(q*=-1),this.alpha+=q*H,this.beta+=this.inertialBetaOffset*H,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<G.d&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<G.d&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*G.d&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){K=!0;const H=new y.OH(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),H.multiplyInPlace(this.panningAxis),y.OH.TransformNormalToRef(H,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const K=this.upVector,H=y.OH.CrossToRef(this._transformedDirection,K,this._transformedDirection);y.OH.CrossToRef(K,H,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);y.OH.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.q(this._transformedDirection)}else{if(this.parent){const K=y.TmpVectors.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(K),K.transposeToRef(K),y.OH.TransformCoordinatesToRef(this._transformedDirection,K,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*G.d&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*G.d&&(this.inertialPanningY=0)}if(K)this.stopInterpolation();else if(this._isInterpolating){let K=!1;const H=this._scene.getEngine().getDeltaTime()/1e3,M=1-Math.pow(2,-H/this._currentInterpolationFactor),q=d(this._goalRadius,this.radius);if(!isNaN(this._goalTarget.x)||!isNaN(this._goalTarget.y)||!isNaN(this._goalTarget.z)){const H=y.TmpVectors.OH[0].set(d(this._goalTarget.x,this._target.x),d(this._goalTarget.y,this._target.y),d(this._goalTarget.z,this._target.z));y.OH.LerpToRef(this.target,H,M,this._target),10*y.OH.Distance(this.target,H)/q<G.d?(this._goalTarget.set(NaN,NaN,NaN),this.target.q(H),this.setTarget(this.target,!1,!0,!0)):K=!0}if(!isNaN(this._goalAlpha)||!isNaN(this._goalBeta)){const H=y.Quaternion.RotationAlphaBetaGammaToRef(d(this._goalAlpha,this.alpha),d(this._goalBeta,this.beta),0,y.TmpVectors.Quaternion[0]),q=y.Quaternion.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,y.TmpVectors.Quaternion[1]),w=y.Quaternion.SlerpToRef(q,H,M,y.TmpVectors.Quaternion[2]);w.normalize();const u=w.toAlphaBetaGammaToRef(y.TmpVectors.OH[0]);if(this.alpha=u.x,this.beta=u.y,w.isApprox(H,G.d/5)){this._goalAlpha=NaN,this._goalBeta=NaN;const K=H.toAlphaBetaGammaToRef(y.TmpVectors.OH[0]);this.alpha=K.x,this.beta=K.y}else K=!0}if(isNaN(this._goalRadius)||(this.radius+=(q-this.radius)*M,Math.abs(q/this.radius-1)<G.d?(this._goalRadius=NaN,this.radius=q):K=!0),!isNaN(this._goalTargetScreenOffset.x)||!isNaN(this._goalTargetScreenOffset.y)){const H=y.TmpVectors.Vector2[0].set(d(this._goalTargetScreenOffset.x,this.targetScreenOffset.x),d(this._goalTargetScreenOffset.y,this.targetScreenOffset.y));y.Vector2.LerpToRef(this.targetScreenOffset,H,M,this.targetScreenOffset),y.Vector2.Distance(this.targetScreenOffset,H)<G.d?(this._goalTargetScreenOffset.set(NaN,NaN),this.targetScreenOffset.q(H)):K=!0}this._isInterpolating=K}this._checkLimits(),super._checkInputs()}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0),this.target.y=Math.max(this.target.y,this.lowerTargetYLimit)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.OH.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const K=this.alpha;var H,M;this.alpha=function(K){let H=Math.PI/2;return 0===K.x&&0===K.z||(H=Math.acos(K.x/Math.sqrt(Math.pow(K.x,2)+Math.pow(K.z,2)))),K.z<0&&(H=2*Math.PI-H),H}(this._computationVector),this.beta=(H=this._computationVector.y,M=this.radius,Math.acos(H/M));const q=Math.round((K-this.alpha)/(2*Math.PI));this.alpha+=2*q*Math.PI,this._checkLimits()}setPosition(K){this._position.equals(K)||(this._position.q(K),this.rebuildAnglesAndRadius())}setTarget(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(q=this.overrideCloneAlphaBetaRadius??q,K.zh)H&&K.getBoundingInfo?this._targetBoundingCenter=K.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,K.zh(),this._targetHost=K,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const H=K,q=this._getTargetPosition();if(q&&!M&&q.equals(H))return;this._targetHost=null,this._target=H,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}q||this.rebuildAnglesAndRadius()}_getViewMatrix(){const K=Math.cos(this.alpha),H=Math.sin(this.alpha),M=Math.cos(this.beta);let q=Math.sin(this.beta);0===q&&(q=1e-4),0===this.radius&&(this.radius=1e-4);const w=this._getTargetPosition();if(this._computationVector.Lh(this.radius*K*q,this.radius*M,this.radius*H*q),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||y.OH.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),w.addToRef(this._computationVector,this._newPosition),this.sK().collisionsEnabled&&this.checkCollisions){const K=this.sK().collisionCoordinator;this._collider||(this._collider=K.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,K.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.q(this._newPosition);let K=this.upVector;this.allowUpsideDown&&q<0&&(K=K.negate()),this._computeViewMatrix(this._position,w,K),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget.q(w),this._viewMatrix}zoomOn(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K||this.sK().meshes;const M=I.b.MinMax(K);let q=this._calculateLowerRadiusFromModelBoundingSphere(M.min,M.max);if(q=Math.max(Math.min(q,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=q*this.zoomOnFactor,this.mode===B.b.ORTHOGRAPHIC_CAMERA){const K=this.sK().getEngine().getAspectRatio(this),H=q*this.zoomOnFactor/2;this.orthoLeft=-H*K,this.orthoRight=H*K,this.orthoBottom=-H,this.orthoTop=H}this.focusOn({min:M.min,max:M.max,distance:q},H)}focusOn(K){let H,M,q=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===K.min){const q=K||this.sK().meshes;H=I.b.MinMax(q),M=y.OH.Distance(H.min,H.max)}else{H=K,M=K.distance}this._target=I.b.Center(H),q||(this.maxZ=2*M)}createRigCamera(K,H){let M=0;switch(this.cameraRigMode){case B.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.b.RIG_MODE_VR:M=this._cameraRigParams.stereoHalfAngle*(0===H?1:-1);break;case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:M=this._cameraRigParams.stereoHalfAngle*(0===H?-1:1)}const q=new x(K,this.alpha+M,this.beta,this.radius,this._target,this.sK());return q._cameraRigParams={},q.isRigCamera=!0,q.rigParent=this,q.upVector=this.upVector,q.mode=this.mode,q.orthoLeft=this.orthoLeft,q.orthoRight=this.orthoRight,q.orthoBottom=this.orthoBottom,q.orthoTop=this.orthoTop,q}_updateRigCameras(){const K=this._rigCameras[0],H=this._rigCameras[1];switch(K.beta=H.beta=this.beta,this.cameraRigMode){case B.b.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case B.b.RIG_MODE_STEREOSCOPIC_OVERUNDER:case B.b.RIG_MODE_STEREOSCOPIC_INTERLACED:case B.b.RIG_MODE_VR:K.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,H.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case B.b.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,H.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const q=y.OH.Distance(K,H),w=this.sK().getEngine().getAspectRatio(this),u=Math.tan(this.fov/2),h=u*w,W=.5*q*M,I=W*Math.sqrt(1+1/(h*h)),f=W*Math.sqrt(1+1/(u*u));return Math.max(I,f)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,q.e)([(0,w.J)()],x.prototype,"alpha",void 0),(0,q.e)([(0,w.J)()],x.prototype,"beta",void 0),(0,q.e)([(0,w.J)()],x.prototype,"radius",void 0),(0,q.e)([(0,w.J)()],x.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,q.e)([(0,w.G)("target")],x.prototype,"_target",void 0),(0,q.e)([(0,w.w)("targetHost")],x.prototype,"_targetHost",void 0),(0,q.e)([(0,w.J)()],x.prototype,"inertialAlphaOffset",void 0),(0,q.e)([(0,w.J)()],x.prototype,"inertialBetaOffset",void 0),(0,q.e)([(0,w.J)()],x.prototype,"inertialRadiusOffset",void 0),(0,q.e)([(0,w.J)()],x.prototype,"lowerAlphaLimit",void 0),(0,q.e)([(0,w.J)()],x.prototype,"upperAlphaLimit",void 0),(0,q.e)([(0,w.J)()],x.prototype,"lowerBetaLimit",void 0),(0,q.e)([(0,w.J)()],x.prototype,"upperBetaLimit",void 0),(0,q.e)([(0,w.J)()],x.prototype,"lowerRadiusLimit",void 0),(0,q.e)([(0,w.J)()],x.prototype,"upperRadiusLimit",void 0),(0,q.e)([(0,w.J)()],x.prototype,"lowerTargetYLimit",void 0),(0,q.e)([(0,w.J)()],x.prototype,"inertialPanningX",void 0),(0,q.e)([(0,w.J)()],x.prototype,"inertialPanningY",void 0),(0,q.e)([(0,w.J)()],x.prototype,"pinchToPanMaxDistance",void 0),(0,q.e)([(0,w.J)()],x.prototype,"panningDistanceLimit",void 0),(0,q.e)([(0,w.G)()],x.prototype,"panningOriginTarget",void 0),(0,q.e)([(0,w.J)()],x.prototype,"panningInertia",void 0),(0,q.e)([(0,w.J)()],x.prototype,"zoomToMouseLocation",null),(0,q.e)([(0,w.J)()],x.prototype,"zoomOnFactor",void 0),(0,q.e)([(0,w.D)()],x.prototype,"targetScreenOffset",void 0),(0,q.e)([(0,w.J)()],x.prototype,"allowUpsideDown",void 0),(0,q.e)([(0,w.J)()],x.prototype,"useInputToRestoreState",void 0),(0,q.e)([(0,w.J)()],x.prototype,"restoreStateInterpolationFactor",void 0),(0,T.f)("BABYLON.ArcRotateCamera",x)},12917:(K,H,M)=>{"use strict";M.d(H,{b:()=>y,f:()=>h});var q=M(11112),w=M(11325),u=M(11733),y={};class h{constructor(K){this.attachedToElement=!1,this.attached={},this.camera=K,this.checkInputs=()=>{}}add(K){const H=K.getSimpleName();this.attached[H]?q.e.Warn("camera input of type "+H+" already exists on camera"):(this.attached[H]=K,K.camera=this.camera,K.checkInputs&&(this.checkInputs=this._addCheckInputs(K.checkInputs.bind(K))),this.attachedToElement&&K.attachControl(this.noPreventDefault))}remove(K){for(const H in this.attached){const M=this.attached[H];if(M===K)return M.KG(),M.camera=null,delete this.attached[H],void this.rebuildInputCheck()}}removeByType(K){for(const H in this.attached){const M=this.attached[H];M.getClassName()===K&&(M.KG(),M.camera=null,delete this.attached[H],this.rebuildInputCheck())}}_addCheckInputs(K){const H=this.checkInputs;return()=>{H(),K()}}attachInput(K){this.attachedToElement&&K.attachControl(this.noPreventDefault)}attachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){K=!u.b.ForceAttachControlToAlwaysPreventDefault&&K,this.attachedToElement=!0,this.noPreventDefault=K;for(const H in this.attached)this.attached[H].attachControl(K)}}detachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const H in this.attached)this.attached[H].KG(),K&&(this.attached[H].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const K in this.attached){const H=this.attached[K];H.checkInputs&&(this.checkInputs=this._addCheckInputs(H.checkInputs.bind(H)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(K){const H={};for(const M in this.attached){const K=this.attached[M],q=w.c.Serialize(K);H[K.getClassName()]=q}K.inputsmgr=H}parse(K){const H=K.inputsmgr;if(H){this.clear();for(const K in H){const M=y[K];if(M){const q=H[K],u=w.c.Parse((()=>new M),q,null);this.add(u)}}}else for(const M in this.attached){const H=y[this.attached[M].getClassName()];if(H){const q=w.c.Parse((()=>new H),K,null);this.remove(this.attached[M]),this.add(q)}}}}},12915:(K,H,M)=>{"use strict";M.d(H,{d:()=>E});var q=M(11274),w=M(11280),u=M(11290),y=M(11774),h=M(12917),W=M(11567),I=M(11100);class f{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(K){K=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.sK(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((H=>{const M=H.event;if(!M.metaKey)if(H.type===W.d.KEYDOWN){if(-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysUpward.indexOf(M.keyCode)||-1!==this.keysDownward.indexOf(M.keyCode)||-1!==this.keysRotateLeft.indexOf(M.keyCode)||-1!==this.keysRotateRight.indexOf(M.keyCode)||-1!==this.keysRotateUp.indexOf(M.keyCode)||-1!==this.keysRotateDown.indexOf(M.keyCode)){-1===this._keys.indexOf(M.keyCode)&&this._keys.push(M.keyCode),K||M.preventDefault()}}else if(-1!==this.keysUp.indexOf(M.keyCode)||-1!==this.keysDown.indexOf(M.keyCode)||-1!==this.keysLeft.indexOf(M.keyCode)||-1!==this.keysRight.indexOf(M.keyCode)||-1!==this.keysUpward.indexOf(M.keyCode)||-1!==this.keysDownward.indexOf(M.keyCode)||-1!==this.keysRotateLeft.indexOf(M.keyCode)||-1!==this.keysRotateRight.indexOf(M.keyCode)||-1!==this.keysRotateUp.indexOf(M.keyCode)||-1!==this.keysRotateDown.indexOf(M.keyCode)){const H=this._keys.indexOf(M.keyCode);H>=0&&this._keys.splice(H,1),K||M.preventDefault()}})))}KG(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let H=0;H<this._keys.length;H++){const M=this._keys[H],q=K._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(M)?K._localDirection.Lh(-q,0,0):-1!==this.keysUp.indexOf(M)?K._localDirection.Lh(0,0,q):-1!==this.keysRight.indexOf(M)?K._localDirection.Lh(q,0,0):-1!==this.keysDown.indexOf(M)?K._localDirection.Lh(0,0,-q):-1!==this.keysUpward.indexOf(M)?K._localDirection.Lh(0,q,0):-1!==this.keysDownward.indexOf(M)?K._localDirection.Lh(0,-q,0):-1!==this.keysRotateLeft.indexOf(M)?(K._localDirection.Lh(0,0,0),K.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(M)?(K._localDirection.Lh(0,0,0),K.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(M)?(K._localDirection.Lh(0,0,0),K.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(M)&&(K._localDirection.Lh(0,0,0),K.cameraRotation.x+=this._getLocalRotation()),K.sK().useRightHandedSystem&&(K._localDirection.z*=-1),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),u.OH.TransformNormalToRef(K._localDirection,K._cameraTransformMatrix,K._transformedDirection),K.cameraDirection.addInPlace(K._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const K=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*K}}(0,q.e)([(0,w.J)()],f.prototype,"keysUp",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysUpward",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysDown",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysDownward",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysLeft",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysRight",void 0),(0,q.e)([(0,w.J)()],f.prototype,"rotationSpeed",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysRotateLeft",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysRotateRight",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysRotateUp",void 0),(0,q.e)([(0,w.J)()],f.prototype,"keysRotateDown",void 0),h.b.FreeCameraKeyboardMoveInput=f;var z=M(11102),G=M(11561);class a{constructor(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=K,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new z.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(K){K=I.Tools.BackCompatCameraNoPreventDefault(arguments);const H=this.camera.getEngine(),M=H.getInputElement();this._pointerInput||(this._pointerInput=q=>{const w=q.event,u="touch"===w.pointerType;if(!this.touchEnabled&&u)return;if(q.type!==G.c.POINTERMOVE&&-1===this.buttons.indexOf(w.button))return;const y=w.target;if(q.type===G.c.POINTERDOWN){if(u&&-1!==this._activePointerId||!u&&-1!==this._currentActiveButton)return;this._activePointerId=w.pointerId;try{null===y||void 0===y||y.setPointerCapture(w.pointerId)}catch(h){}-1===this._currentActiveButton&&(this._currentActiveButton=w.button),this._previousPosition={x:w.clientX,y:w.clientY},K||(w.preventDefault(),M&&M.focus()),H.isPointerLock&&this._onMouseMove&&this._onMouseMove(q.event)}else if(q.type===G.c.POINTERUP){if(u&&this._activePointerId!==w.pointerId||!u&&this._currentActiveButton!==w.button)return;try{null===y||void 0===y||y.releasePointerCapture(w.pointerId)}catch(h){}this._currentActiveButton=-1,this._previousPosition=null,K||w.preventDefault(),this._activePointerId=-1}else if(q.type===G.c.POINTERMOVE&&(this._activePointerId===w.pointerId||!u))if(H.isPointerLock&&this._onMouseMove)this._onMouseMove(q.event);else if(this._previousPosition){const H=this.camera._calculateHandednessMultiplier(),M=(w.clientX-this._previousPosition.x)*H,q=w.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=M/this.angularSensibility,this.camera.cameraRotation.x+=q/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:M,offsetY:q}),this._previousPosition={x:w.clientX,y:w.clientY},K||w.preventDefault()}}),this._onMouseMove=M=>{if(!H.isPointerLock)return;const q=this.camera._calculateHandednessMultiplier(),w=M.movementX*q;this.camera.cameraRotation.y+=w/this.angularSensibility;const u=M.movementY;this.camera.cameraRotation.x+=u/this.angularSensibility,this._previousPosition=null,K||M.preventDefault()},this._observer=this.camera.sK()._inputManager._addCameraPointerObserver(this._pointerInput,G.c.POINTERDOWN|G.c.POINTERUP|G.c.POINTERMOVE),M&&(this._contextMenuBind=K=>this.onContextMenu(K),M.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(K){K.preventDefault()}KG(){if(this._observer){if(this.camera.sK()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,q.e)([(0,w.J)()],a.prototype,"buttons",void 0),(0,q.e)([(0,w.J)()],a.prototype,"angularSensibility",void 0),h.b.FreeCameraMouseInput=a;var v,O=M(11573);class L{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new z.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(K){K=I.Tools.BackCompatCameraNoPreventDefault(arguments),this._wheel=H=>{if(H.type!==G.c.POINTERWHEEL)return;const M=H.event,q=M.deltaMode===O.b.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*q*M.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*q*M.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*q*M.deltaZ/this._normalize,M.preventDefault&&(K||M.preventDefault())},this._observer=this.camera.sK()._inputManager._addCameraPointerObserver(this._wheel,G.c.POINTERWHEEL)}KG(){this._observer&&(this.camera.sK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,q.e)([(0,w.J)()],L.prototype,"wheelPrecisionX",void 0),(0,q.e)([(0,w.J)()],L.prototype,"wheelPrecisionY",void 0),(0,q.e)([(0,w.J)()],L.prototype,"wheelPrecisionZ",void 0),function(K){K[K.MoveRelative=0]="MoveRelative",K[K.RotateRelative=1]="RotateRelative",K[K.MoveScene=2]="MoveScene"}(v||(v={}));class S extends L{constructor(){super(...arguments),this._moveRelative=u.OH.Zero(),this._rotateRelative=u.OH.Zero(),this._moveScene=u.OH.Zero(),this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(K){null===K&&this._wheelXAction!==v.MoveRelative||(this._wheelXAction=v.MoveRelative,this._wheelXActionCoordinate=K)}get wheelXMoveRelative(){return this._wheelXAction!==v.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(K){null===K&&this._wheelYAction!==v.MoveRelative||(this._wheelYAction=v.MoveRelative,this._wheelYActionCoordinate=K)}get wheelYMoveRelative(){return this._wheelYAction!==v.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(K){null===K&&this._wheelZAction!==v.MoveRelative||(this._wheelZAction=v.MoveRelative,this._wheelZActionCoordinate=K)}get wheelZMoveRelative(){return this._wheelZAction!==v.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(K){null===K&&this._wheelXAction!==v.RotateRelative||(this._wheelXAction=v.RotateRelative,this._wheelXActionCoordinate=K)}get wheelXRotateRelative(){return this._wheelXAction!==v.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(K){null===K&&this._wheelYAction!==v.RotateRelative||(this._wheelYAction=v.RotateRelative,this._wheelYActionCoordinate=K)}get wheelYRotateRelative(){return this._wheelYAction!==v.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(K){null===K&&this._wheelZAction!==v.RotateRelative||(this._wheelZAction=v.RotateRelative,this._wheelZActionCoordinate=K)}get wheelZRotateRelative(){return this._wheelZAction!==v.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(K){null===K&&this._wheelXAction!==v.MoveScene||(this._wheelXAction=v.MoveScene,this._wheelXActionCoordinate=K)}get wheelXMoveScene(){return this._wheelXAction!==v.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(K){null===K&&this._wheelYAction!==v.MoveScene||(this._wheelYAction=v.MoveScene,this._wheelYActionCoordinate=K)}get wheelYMoveScene(){return this._wheelYAction!==v.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(K){null===K&&this._wheelZAction!==v.MoveScene||(this._wheelZAction=v.MoveScene,this._wheelZActionCoordinate=K)}get wheelZMoveScene(){return this._wheelZAction!==v.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Bh(0),this._rotateRelative.Bh(0),this._moveScene.Bh(0),this._updateCamera(),this.camera.sK().useRightHandedSystem&&(this._moveRelative.z*=-1);const K=u.Matrix.Zero();this.camera.getViewMatrix().invertToRef(K);const H=u.OH.Zero();u.OH.TransformNormalToRef(this._moveRelative,K,H),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(H),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(K,H,M){if(0===K)return;if(null===H||null===M)return;let q=null;switch(H){case v.MoveRelative:q=this._moveRelative;break;case v.RotateRelative:q=this._rotateRelative;break;case v.MoveScene:q=this._moveScene}switch(M){case 0:q.set(K,0,0);break;case 1:q.set(0,K,0);break;case 2:q.set(0,0,K)}}}(0,q.e)([(0,w.J)()],S.prototype,"wheelXMoveRelative",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelYMoveRelative",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelZMoveRelative",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelXRotateRelative",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelYRotateRelative",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelZRotateRelative",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelXMoveScene",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelYMoveScene",null),(0,q.e)([(0,w.J)()],S.prototype,"wheelZMoveScene",null),h.b.FreeCameraMouseWheelInput=S;class B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=K,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=I.Tools.IsSafari()}attachControl(K){K=I.Tools.BackCompatCameraNoPreventDefault(arguments);let H=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=M=>{const q=M.event,w="mouse"===q.pointerType||this._isSafari&&"undefined"===typeof q.pointerType;if(this.allowMouse||!w)if(M.type===G.c.POINTERDOWN){if(K||q.preventDefault(),this._pointerPressed.push(q.pointerId),1!==this._pointerPressed.length)return;H={x:q.clientX,y:q.clientY}}else if(M.type===G.c.POINTERUP){K||q.preventDefault();const M=this._pointerPressed.indexOf(q.pointerId);if(-1===M)return;if(this._pointerPressed.splice(M,1),0!=M)return;H=null,this._offsetX=null,this._offsetY=null}else if(M.type===G.c.POINTERMOVE){if(K||q.preventDefault(),!H)return;if(0!=this._pointerPressed.indexOf(q.pointerId))return;this._offsetX=q.clientX-H.x,this._offsetY=-(q.clientY-H.y)}}),this._observer=this.camera.sK()._inputManager._addCameraPointerObserver(this._pointerInput,G.c.POINTERDOWN|G.c.POINTERUP|G.c.POINTERMOVE),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.addEventListener("blur",this._onLostFocus)}}KG(){if(this._pointerInput){if(this._observer&&(this.camera.sK()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const K=this.camera,H=K._calculateHandednessMultiplier();K.cameraRotation.y=H*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)K.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const H=K._computeLocalCameraSpeed(),M=new u.OH(0,0,0!==this.touchMoveSensibility?H*this._offsetY/this.touchMoveSensibility:0);u.Matrix.RotationYawPitchRollToRef(K.rotation.y,K.rotation.x,0,K._cameraRotationMatrix),K.cameraDirection.addInPlace(u.OH.TransformCoordinates(M,K._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,q.e)([(0,w.J)()],B.prototype,"touchAngularSensibility",void 0),(0,q.e)([(0,w.J)()],B.prototype,"touchMoveSensibility",void 0),h.b.FreeCameraTouchInput=B;class C extends h.f{constructor(K){super(K),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new f),this}addMouse(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new a(K),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new S,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new B),this}clear(){super.clear(),this._mouseInput=null}}var i=M(11242),Z=M(11180);class E extends y.e{get angularSensibility(){const K=this.inputs.attached.mouse;return K?K.angularSensibility:0}set angularSensibility(K){const H=this.inputs.attached.mouse;H&&(H.angularSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const H=this.inputs.attached.keyboard;H&&(H.keysUp=K)}get keysUpward(){const K=this.inputs.attached.keyboard;return K?K.keysUpward:[]}set keysUpward(K){const H=this.inputs.attached.keyboard;H&&(H.keysUpward=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const H=this.inputs.attached.keyboard;H&&(H.keysDown=K)}get keysDownward(){const K=this.inputs.attached.keyboard;return K?K.keysDownward:[]}set keysDownward(K){const H=this.inputs.attached.keyboard;H&&(H.keysDownward=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const H=this.inputs.attached.keyboard;H&&(H.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const H=this.inputs.attached.keyboard;H&&(H.keysRight=K)}get keysRotateLeft(){const K=this.inputs.attached.keyboard;return K?K.keysRotateLeft:[]}set keysRotateLeft(K){const H=this.inputs.attached.keyboard;H&&(H.keysRotateLeft=K)}get keysRotateRight(){const K=this.inputs.attached.keyboard;return K?K.keysRotateRight:[]}set keysRotateRight(K){const H=this.inputs.attached.keyboard;H&&(H.keysRotateRight=K)}get keysRotateUp(){const K=this.inputs.attached.keyboard;return K?K.keysRotateUp:[]}set keysRotateUp(K){const H=this.inputs.attached.keyboard;H&&(H.keysRotateUp=K)}get keysRotateDown(){const K=this.inputs.attached.keyboard;return K?K.keysRotateDown:[]}set keysRotateDown(K){const H=this.inputs.attached.keyboard;H&&(H.keysRotateDown=K)}constructor(K,H,M){var q;super(K,H,M,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),q=this,this.ellipsoid=new u.OH(.5,1,.5),this.ellipsoidOffset=new u.OH(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=u.OH.Zero(),this._diffPosition=u.OH.Zero(),this._newPosition=u.OH.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q._newPosition.q(H),q._newPosition.subtractToRef(q._oldPosition,q._diffPosition),q._diffPosition.length()>Z.b.CollisionsEpsilon&&(q.position.addToRef(q._diffPosition,q._deferredPositionUpdate),q._deferOnly?q._deferredUpdated=!0:q.position.q(q._deferredPositionUpdate),q.pa&&M&&q.pa(M))},this.inputs=new C(this),this.inputs.addKeyboard().addMouse()}attachControl(K,H){H=I.Tools.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(H)}KG(){this.inputs.detachElement(),this.cameraDirection=new u.OH(0,0,0),this.cameraRotation=new u.Vector2(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(K){this._collisionMask=isNaN(K)?-1:K}_collideWithWorld(K){let H;H=this.parent?u.OH.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,H.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const M=this.sK().collisionCoordinator;this._collider||(this._collider=M.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let q=K;this.applyGravity&&(q=K.add(this.sK().gravity)),M.getNewPosition(this._oldPosition,q,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=u.OH.Zero(),this._transformedDirection=u.OH.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(K){this._needMoveForGravity=K}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.sK().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"bh"}}(0,q.e)([(0,w.G)()],E.prototype,"ellipsoid",void 0),(0,q.e)([(0,w.G)()],E.prototype,"ellipsoidOffset",void 0),(0,q.e)([(0,w.J)()],E.prototype,"checkCollisions",void 0),(0,q.e)([(0,w.J)()],E.prototype,"applyGravity",void 0),(0,i.f)("BABYLON.FreeCamera",E)},13508:(K,H,M)=>{"use strict";M.d(H,{c:()=>u});var q=M(11388),w=M(13514);class u{constructor(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=M,this.Sz=[],this._maxBlockCapacity=H||64,this._selectionContent=new q.b(1024),this._creationFunc=K}update(K,H,M){w.d._CreateBlocks(K,H,M,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}af(K){for(let H=0;H<this.kf.length;H++){this.kf[H].addEntry(K)}}zf(K){for(let H=0;H<this.kf.length;H++){this.kf[H].removeEntry(K)}}select(K,H){this._selectionContent.reset();for(let M=0;M<this.kf.length;M++){this.kf[M].select(K,this._selectionContent,H)}return H?this._selectionContent.concat(this.Sz):this._selectionContent.concatWithNoDuplicate(this.Sz),this._selectionContent}intersects(K,H,M){this._selectionContent.reset();for(let q=0;q<this.kf.length;q++){this.kf[q].intersects(K,H,this._selectionContent,M)}return M?this._selectionContent.concat(this.Sz):this._selectionContent.concatWithNoDuplicate(this.Sz),this._selectionContent}intersectsRay(K){this._selectionContent.reset();for(let H=0;H<this.kf.length;H++){this.kf[H].intersectsRay(K,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Sz),this._selectionContent}}u.CreationFuncForMeshes=(K,H)=>{const M=K.getBoundingInfo();!K.isBlocked&&M.boundingBox.intersectsMinMax(H.Ez,H.lz)&&H.entries.push(K)},u.CreationFuncForSubMeshes=(K,H)=>{K.getBoundingInfo().boundingBox.intersectsMinMax(H.Ez,H.lz)&&H.entries.push(K)}},13514:(K,H,M)=>{"use strict";M.d(H,{d:()=>u});var q=M(11290),w=M(11635);class u{constructor(K,H,M,q,w,u){this.entries=[],this.sz=new Array,this._capacity=M,this._depth=q,this._maxDepth=w,this._creationFunc=u,this._minPoint=K,this._maxPoint=H,this.sz.push(K.clone()),this.sz.push(H.clone()),this.sz.push(K.clone()),this.sz[2].x=H.x,this.sz.push(K.clone()),this.sz[3].y=H.y,this.sz.push(K.clone()),this.sz[4].z=H.z,this.sz.push(H.clone()),this.sz[5].z=K.z,this.sz.push(H.clone()),this.sz[6].x=K.x,this.sz.push(H.clone()),this.sz[7].y=K.y}get kh(){return this._capacity}get Ez(){return this._minPoint}get lz(){return this._maxPoint}addEntry(K){if(this.kf)for(let H=0;H<this.kf.length;H++){this.kf[H].addEntry(K)}else this._creationFunc(K,this),this.entries.length>this.kh&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(K){if(this.kf){for(let H=0;H<this.kf.length;H++){this.kf[H].removeEntry(K)}return}const H=this.entries.indexOf(K);H>-1&&this.entries.splice(H,1)}addEntries(K){for(let H=0;H<K.length;H++){const M=K[H];this.addEntry(M)}}select(K,H,M){if(w.b.IsInFrustum(this.sz,K)){if(this.kf){for(let q=0;q<this.kf.length;q++){this.kf[q].select(K,H,M)}return}M?H.concat(this.entries):H.concatWithNoDuplicate(this.entries)}}intersects(K,H,M,q){if(w.b.IntersectsSphere(this._minPoint,this._maxPoint,K,H)){if(this.kf){for(let w=0;w<this.kf.length;w++){this.kf[w].intersects(K,H,M,q)}return}q?M.concat(this.entries):M.concatWithNoDuplicate(this.entries)}}intersectsRay(K,H){if(K.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.kf){for(let M=0;M<this.kf.length;M++){this.kf[M].intersectsRay(K,H)}return}H.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){u._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(K,H,M,w,y,h,W,I){W.kf=new Array;const f=new q.OH((H.x-K.x)/2,(H.y-K.y)/2,(H.z-K.z)/2);for(let q=0;q<2;q++)for(let H=0;H<2;H++)for(let z=0;z<2;z++){const G=K.add(f.multiplyByFloats(q,H,z)),a=K.add(f.multiplyByFloats(q+1,H+1,z+1)),v=new u(G,a,w,y+1,h,I);v.addEntries(M),W.kf.push(v)}}}},13516:(K,H,M)=>{"use strict";M.d(H,{e:()=>f});var q=M(11522),w=M(11290),u=M(11712),y=M(12687),h=M(11555),W=M(13508),I=M(11143);q.b.prototype.createOrUpdateSelectionOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,M=this._getComponent(h.d.NAME_OCTREE);M||(M=new f(this),this.ny(M)),this.Oz||(this.Oz=new W.c(W.c.CreationFuncForMeshes,K,H));const q=this.getWorldExtends();return this.Oz.update(q.min,q.max,this.meshes),this.Oz},Object.defineProperty(q.b.prototype,"selectionOctree",{get:function(){return this.Oz},enumerable:!0,configurable:!0}),u.c.prototype.createOrUpdateSubmeshesOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const M=this.sK();let q=M._getComponent(h.d.NAME_OCTREE);q||(q=new f(M),M.ny(q)),this._submeshesOctree||(this._submeshesOctree=new W.c(W.c.CreationFuncForSubMeshes,K,H)),this.zh(!0);const w=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(w.minimumWorld,w.maximumWorld,this.yh),this._submeshesOctree};class f{constructor(K){this.name=h.d.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new y.b(w.OH.Zero(),new w.OH(1,1,1)),(K=K||I.b.LastCreatedScene)&&(this.SH=K,this.SH.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.SH.getActiveSubMeshCandidates=K=>this.getActiveSubMeshCandidates(K),this.SH.getCollidingSubMeshCandidates=(K,H)=>this.getCollidingSubMeshCandidates(K,H),this.SH.getIntersectingSubMeshCandidates=(K,H)=>this.getIntersectingSubMeshCandidates(K,H))}register(){this.SH.onMeshRemovedObservable.add((K=>{const H=this.SH.selectionOctree;if(void 0!==H&&null!==H){const M=H.Sz.indexOf(K);-1!==M&&H.Sz.splice(M,1)}})),this.SH.onMeshImportedObservable.add((K=>{const H=this.SH.selectionOctree;void 0!==H&&null!==H&&H.af(K)}))}getActiveMeshCandidates(){var K;return(null===(K=this.SH.Oz)||void 0===K?void 0:K.select(this.SH.frustumPlanes))||this.SH._getDefaultMeshCandidates()}getActiveSubMeshCandidates(K){if(K._submeshesOctree&&K.useOctreeForRenderingSelection){return K._submeshesOctree.select(this.SH.frustumPlanes)}return this.SH._getDefaultSubMeshCandidates(K)}getIntersectingSubMeshCandidates(K,H){if(K._submeshesOctree&&K.useOctreeForPicking){y.b.TransformToRef(H,K.getWorldMatrix(),this._tempRay);return K._submeshesOctree.intersectsRay(this._tempRay)}return this.SH._getDefaultSubMeshCandidates(K)}getCollidingSubMeshCandidates(K,H){if(K._submeshesOctree&&K.useOctreeForCollisions){const M=H._velocityWorldLength+Math.max(H._radius.x,H._radius.y,H._radius.z);return K._submeshesOctree.intersects(H._basePointWorld,M)}return this.SH._getDefaultSubMeshCandidates(K)}rebuild(){}dispose(){}}},12687:(K,H,M)=>{"use strict";M.d(H,{b:()=>a});var q=M(11522),w=M(11733),u=M(11297),y=M(11290),h=M(11301),W=M(11621),I=M(11553),f=M(11143),z=M(11575);const G={internalPickerForMesh:void 0};class a{constructor(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.d;this.origin=K,this.direction=H,this.length=M,this.epsilon=q}clone(){return new a(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const q=a._TmpVector3[0].Lh(K.x-M,K.y-M,K.z-M),w=a._TmpVector3[1].Lh(H.x+M,H.y+M,H.z+M);let u,y,h,W,I=0,f=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<q.x||this.origin.x>w.x)return!1}else if(u=1/this.direction.x,y=(q.x-this.origin.x)*u,h=(w.x-this.origin.x)*u,h===-1/0&&(h=1/0),y>h&&(W=y,y=h,h=W),I=Math.max(y,I),f=Math.min(h,f),I>f)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<q.y||this.origin.y>w.y)return!1}else if(u=1/this.direction.y,y=(q.y-this.origin.y)*u,h=(w.y-this.origin.y)*u,h===-1/0&&(h=1/0),y>h&&(W=y,y=h,h=W),I=Math.max(y,I),f=Math.min(h,f),I>f)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<q.z||this.origin.z>w.z)return!1}else if(u=1/this.direction.z,y=(q.z-this.origin.z)*u,h=(w.z-this.origin.z)*u,h===-1/0&&(h=1/0),y>h&&(W=y,y=h,h=W),I=Math.max(y,I),f=Math.min(h,f),I>f)return!1;return!0}intersectsBox(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(K.minimum,K.maximum,H)}intersectsSphere(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const M=K.center.x-this.origin.x,q=K.center.y-this.origin.y,w=K.center.z-this.origin.z,u=M*M+q*q+w*w,y=K.radius+H,h=y*y;if(u<=h)return!0;const W=M*this.direction.x+q*this.direction.y+w*this.direction.z;if(W<0)return!1;return u-W*W<=h}intersectsTriangle(K,H,M){const q=a._TmpVector3[0],w=a._TmpVector3[1],u=a._TmpVector3[2],h=a._TmpVector3[3],I=a._TmpVector3[4];H.subtractToRef(K,q),M.subtractToRef(K,w),y.OH.CrossToRef(this.direction,w,u);const f=y.OH.Dot(q,u);if(0===f)return null;const z=1/f;this.origin.subtractToRef(K,h);const G=y.OH.Dot(h,u)*z;if(G<-this.epsilon||G>1+this.epsilon)return null;y.OH.CrossToRef(h,q,I);const v=y.OH.Dot(this.direction,I)*z;if(v<-this.epsilon||G+v>1+this.epsilon)return null;const O=y.OH.Dot(w,I)*z;return O>this.length?null:new W.d(1-G-v,G,O)}intersectsPlane(K){let H;const M=y.OH.Dot(K.normal,this.direction);if(Math.abs(M)<9.99999997475243e-7)return null;{const q=y.OH.Dot(K.normal,this.origin);return H=(-K.d-q)/M,H<0?H<-9.99999997475243e-7?null:0:H}}intersectsAxis(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(K){case"y":{const K=(this.origin.y-H)/this.direction.y;return K>0?null:new y.OH(this.origin.x+this.direction.x*-K,H,this.origin.z+this.direction.z*-K)}case"x":{const K=(this.origin.x-H)/this.direction.x;return K>0?null:new y.OH(H,this.origin.y+this.direction.y*-K,this.origin.z+this.direction.z*-K)}case"z":{const K=(this.origin.z-H)/this.direction.z;return K>0?null:new y.OH(this.origin.x+this.direction.x*-K,this.origin.y+this.direction.y*-K,H)}default:return null}}intersectsMesh(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const h=y.TmpVectors.Matrix[0];return K.getWorldMatrix().invertToRef(h),this._tmpRay?a.TransformToRef(this,h,this._tmpRay):this._tmpRay=a.Transform(this,h),K.intersects(this._tmpRay,H,M,q,w,u)}intersectsMeshes(K,H,M){M?M.length=0:M=[];for(let q=0;q<K.length;q++){const w=this.intersectsMesh(K[q],H);w.hit&&M.push(w)}return M.sort(this._comparePickingInfo),M}_comparePickingInfo(K,H){return K.distance<H.distance?-1:K.distance>H.distance?1:0}intersectionSegment(K,H,M){const q=this.origin,w=y.TmpVectors.OH[0],u=y.TmpVectors.OH[1],h=y.TmpVectors.OH[2],W=y.TmpVectors.OH[3];H.subtractToRef(K,w),this.direction.scaleToRef(a._Rayl,h),q.addToRef(h,u),K.subtractToRef(q,W);const I=y.OH.Dot(w,w),f=y.OH.Dot(w,h),z=y.OH.Dot(h,h),G=y.OH.Dot(w,W),v=y.OH.Dot(h,W),O=I*z-f*f;let L,S,B=O,C=O;O<a._Smallnum?(L=0,B=1,S=v,C=z):(L=f*v-z*G,S=I*v-f*G,L<0?(L=0,S=v,C=z):L>B&&(L=B,S=v+f,C=z)),S<0?(S=0,-G<0?L=0:-G>I?L=B:(L=-G,B=I)):S>C&&(S=C,-G+f<0?L=0:-G+f>I?L=B:(L=-G+f,B=I));const i=Math.abs(L)<a._Smallnum?0:L/B,Z=Math.abs(S)<a._Smallnum?0:S/C,E=y.TmpVectors.OH[4];h.scaleToRef(Z,E);const l=y.TmpVectors.OH[5];w.scaleToRef(i,l),l.addInPlace(W);const s=y.TmpVectors.OH[6];l.subtractToRef(E,s);return Z>0&&Z<=this.length&&s.lengthSquared()<M*M?l.length():-1}update(K,H,M,q,w,u,h){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){a._RayDistant||(a._RayDistant=a.Zero()),a._RayDistant.unprojectRayToRef(K,H,M,q,y.Matrix.IdentityReadOnly,u,h);const W=y.TmpVectors.Matrix[0];w.invertToRef(W),a.TransformToRef(a._RayDistant,W,this)}else this.unprojectRayToRef(K,H,M,q,w,u,h);return this}static Zero(){return new a(y.OH.Zero(),y.OH.Zero())}static CreateNew(K,H,M,q,w,u,y){return a.Zero().update(K,H,M,q,w,u,y)}static CreateNewFromTo(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:y.Matrix.IdentityReadOnly;const q=new a(new y.OH(0,0,0),new y.OH(0,0,0));return a.CreateFromToToRef(K,H,q,M)}static CreateFromToToRef(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:y.Matrix.IdentityReadOnly;M.origin.q(K);const w=H.subtractToRef(K,M.direction),u=Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z);return M.length=u,M.direction.normalize(),a.TransformToRef(M,q,M)}static Transform(K,H){const M=new a(new y.OH(0,0,0),new y.OH(0,0,0));return a.TransformToRef(K,H,M),M}static TransformToRef(K,H,M){y.OH.TransformCoordinatesToRef(K.origin,H,M.origin),y.OH.TransformNormalToRef(K.direction,H,M.direction),M.length=K.length,M.epsilon=K.epsilon;const q=M.direction,w=q.length();if(0!==w&&1!==w){const K=1/w;q.x*=K,q.y*=K,q.z*=K,M.length*=w}return M}unprojectRayToRef(K,H,M,q,w,u,h){const W=y.TmpVectors.Matrix[0];w.multiplyToRef(u,W),W.multiplyToRef(h,W),W.invert();const I=f.b.LastCreatedEngine,z=y.TmpVectors.OH[0];z.x=K/M*2-1,z.y=-(H/q*2-1),z.z=null!==I&&void 0!==I&&I.useReverseDepthBuffer?1:null!==I&&void 0!==I&&I.isNDCHalfZRange?0:-1;const G=y.TmpVectors.OH[1].Lh(z.x,z.y,1-1e-8),a=y.TmpVectors.OH[2],v=y.TmpVectors.OH[3];y.OH._UnprojectFromInvertedMatrixToRef(z,W,a),y.OH._UnprojectFromInvertedMatrixToRef(G,W,v),this.origin.q(a),v.subtractToRef(a,this.direction),this.direction.normalize()}}function v(K,H,M,q,w){let u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=a.Zero();return O(K,H,M,q,y,w,u),y}function O(K,H,M,q,w,u){let h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const I=K.getEngine();if(!u&&!(u=K.activeCamera))return K;const f=u.viewport,z=I.getRenderHeight(),{x:G,y:a,width:v,height:O}=f.toGlobal(I.getRenderWidth(),z),L=1/I.getHardwareScalingLevel();return H=H*L-G,M=M*L-(z-a-O),w.update(H,M,v,O,q||y.Matrix.IdentityReadOnly,h?y.Matrix.IdentityReadOnly:u.getViewMatrix(),u.getProjectionMatrix(),W),K}function L(K,H,M,q,w){if(!I.d)return K;const u=K.getEngine();if(!w&&!(w=K.activeCamera))throw new Error("Active camera not set");const h=w.viewport,W=u.getRenderHeight(),{x:f,y:z,width:G,height:a}=h.toGlobal(u.getRenderWidth(),W),v=y.Matrix.Identity(),O=1/u.getHardwareScalingLevel();return H=H*O-f,M=M*O-(W-z-a),q.update(H,M,G,a,v,v,w.getProjectionMatrix()),K}function S(K,H,M,q,w,u,y,h){const W=H(q,M.enableDistantPicking),I=M.intersects(W,w,y,u,q,h);return I&&I.hit?!w&&null!=K&&I.distance>=K.distance?null:I:null}function B(K,H,M,q,w,u){let h=null;const W=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),f=K.cameraToUseForPointers||K.activeCamera,z=G.internalPickerForMesh||S;for(let I=0;I<K.meshes.length;I++){const G=K.meshes[I];if(M){if(!M(G,-1))continue}else if(!G.isEnabled()||!G.isVisible||!G.mW)continue;const a=W&&G.isWorldMatrixCameraDependent(),v=G.zh(a,f);if(G.hasThinInstances&&G.EI){const K=z(h,H,G,v,!0,!0,u);if(K){if(w)return K;const W=y.TmpVectors.Matrix[1],I=G.thinInstanceGetWorldMatrices();for(let K=0;K<I.length;K++){if(M&&!M(G,K))continue;I[K].multiplyToRef(v,W);const y=z(h,H,G,W,q,w,u,!0);if(y&&(h=y,h.thinInstanceIndex=K,q))return h}}}else{const K=z(h,H,G,v,q,w,u);if(K&&(h=K,q))return h}}return h||new I.d}function C(K,H,M,q){if(!I.d)return null;const w=[],u=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),h=K.cameraToUseForPointers||K.activeCamera,W=G.internalPickerForMesh||S;for(let I=0;I<K.meshes.length;I++){const f=K.meshes[I];if(M){if(!M(f,-1))continue}else if(!f.isEnabled()||!f.isVisible||!f.mW)continue;const z=u&&f.isWorldMatrixCameraDependent(),G=f.zh(z,h);if(f.hasThinInstances&&f.EI){if(W(null,H,f,G,!0,!0,q)){const K=y.TmpVectors.Matrix[1],u=f.thinInstanceGetWorldMatrices();for(let y=0;y<u.length;y++){if(M&&!M(f,y))continue;u[y].multiplyToRef(G,K);const h=W(null,H,f,K,!1,!1,q,!0);h&&(h.thinInstanceIndex=y,w.push(h))}}}else{const K=W(null,H,f,G,!1,!1,q);K&&w.push(K)}}return w}function i(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,q=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0;q||(q=K.getWorldMatrix()),H.length=M,w?H.origin.q(w):H.origin.q(K.position);const u=y.TmpVectors.OH[2];u.set(0,0,K._scene.useRightHandedSystem?-1:1);const h=y.TmpVectors.OH[3];return y.OH.TransformNormalToRef(u,q,h),y.OH.NormalizeToRef(h,H.direction),H}var Z,E;a._TmpVector3=(0,h.d)(6,y.OH.Zero),a._RayDistant=a.Zero(),a._Smallnum=1e-8,a._Rayl=1e9,Z=q.b,(E=w.b)&&(E.prototype.getForwardRay=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,H=arguments.length>1?arguments[1]:void 0,M=arguments.length>2?arguments[2]:void 0;return i(this,new a(y.OH.Zero(),y.OH.Zero(),K),K,H,M)},E.prototype.getForwardRayToRef=function(K){return i(this,K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),Z&&(z.e._IsPickingAvailable=!0,Z.prototype.createPickingRay=function(K,H,M,q){return v(this,K,H,M,q,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),q.b.prototype.createPickingRayToRef=function(K,H,M,q,w){return O(this,K,H,M,q,w,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},q.b.prototype.createPickingRayInCameraSpace=function(K,H,M){return function(K,H,M,q){const w=a.Zero();return L(K,H,M,w,q),w}(this,K,H,M)},q.b.prototype.createPickingRayInCameraSpaceToRef=function(K,H,M,q){return L(this,K,H,M,q)},q.b.prototype.pickWithBoundingInfo=function(K,H,M,q,w){return function(K,H,M,q,w,u){if(!I.d)return null;const h=B(K,(q=>(K._tempPickingRay||(K._tempPickingRay=a.Zero()),O(K,H,M,q,K._tempPickingRay,u||null),K._tempPickingRay)),q,w,!0);return h&&(h.ray=v(K,H,M,y.Matrix.Identity(),u||null)),h}(this,K,H,M,q,w)},q.b.prototype.GM=function(K,H,M,q,w,u){return function(K,H,M,q,w,u,h){const W=B(K,((q,w)=>(K._tempPickingRay||(K._tempPickingRay=a.Zero()),O(K,H,M,q,K._tempPickingRay,u||null,!1,w),K._tempPickingRay)),q,w,!1,h);return W&&(W.ray=v(K,H,M,y.Matrix.Identity(),u||null)),W}(this,K,H,M,q,w,u)},q.b.prototype.pickWithRay=function(K,H,M,q){return function(K,H,M,q,w){const u=B(K,(M=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=y.Matrix.Identity()),M.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=a.Zero()),a.TransformToRef(H,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),M,q,!1,w);return u&&(u.ray=H),u}(this,K,H,M,q)},q.b.prototype.multiPick=function(K,H,M,q,w){return function(K,H,M,q,w,u){return C(K,(q=>v(K,H,M,q,w||null)),q,u)}(this,K,H,M,q,w)},q.b.prototype.multiPickWithRay=function(K,H,M){return function(K,H,M,q){return C(K,(M=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=y.Matrix.Identity()),M.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=a.Zero()),a.TransformToRef(H,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),M,q)}(this,K,H,M)}},12967:(K,H,M)=>{"use strict";var q=M(11216),w=M(11112),u=M(11152),y=M(11250),h=M(11180),W=M(11228);h.b.prototype._partialLoadFile=function(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(K,(K=>{M[H]=K,M._internalCount++,6===M._internalCount&&q(M)}),void 0,void 0,!0,((K,H)=>{w&&K&&w(K.status+" "+K.statusText,H)}))},h.b.prototype._cascadeLoadFiles=function(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const w=[];w._internalCount=0;for(let u=0;u<6;u++)this._partialLoadFile(M[u],u,w,H,q)},h.b.prototype._cascadeLoadImgs=function(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5?arguments[5]:void 0;const y=[];y._internalCount=0;for(let h=0;h<6;h++)this._partialLoadImg(q[h],h,y,K,H,M,w,u)},h.b.prototype._partialLoadImg=function(K,H,M,q,w,h){let W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7?arguments[7]:void 0;const f=(0,y.c)();(0,u.p)(K,(K=>{M[H]=K,M._internalCount++,q&&q.removePendingData(f),6===M._internalCount&&h&&h(w,M)}),((K,H)=>{q&&q.removePendingData(f),W&&W(K,H)}),q?q.offlineProvider:null,I),q&&q.addPendingData(f)},h.b.prototype.createCubeTextureBase=function(K,H,M,u){let y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6?arguments[6]:void 0,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,z=arguments.length>8&&void 0!==arguments[8]&&arguments[8],G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,a=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,O=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,L=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,S=arguments.length>14&&void 0!==arguments[14]&&arguments[14],B=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const C=v||new q.d(this,7);C.isCube=!0,C.url=K,C.generateMipMaps=!u,C._lodGenerationScale=G,C._lodGenerationOffset=a,C._useSRGBBuffer=!!S&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!u),C!==v&&(C.label=K.substring(0,60)),this._doNotHandleContextLost||(C._extension=f,C._files=M,C._buffer=B);const i=K;this._transformTextureUrl&&!v&&(K=this._transformTextureUrl(K));const Z=f??function(K){const H=K.split("?")[0],M=H.lastIndexOf(".");return M>-1?H.substring(M).toLowerCase():""}(K),E=(0,W.c)(Z),l=(K,H)=>{C.dispose(),h?h(K,H):K&&w.e.Warn(K)},s=(q,h)=>{K===i?q&&l(q.status+" "+q.statusText,h):(w.e.Warn(`Failed to load ${K}, falling back to the ${i}`),this.createCubeTextureBase(i,H,M,!!u,y,l,I,f,z,G,a,C,O,L,S,B))};if(E)E.then((q=>{const w=K=>{O&&O(C,K),q.loadCubeData(K,C,z,y,((K,H)=>{l(K,H)}))};B?w(B):M&&6===M.length?q.supportCascades?this._cascadeLoadFiles(H,(K=>w(K.map((K=>new Uint8Array(K))))),M,l):l("Textures type does not support cascades."):this._loadFile(K,(K=>w(new Uint8Array(K))),void 0,void 0,!0,s)}));else{if(!M||0===M.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(H,C,((K,H)=>{L&&L(K,H)}),M,l)}return this._internalTexturesCache.push(C),C}},13525:(K,H,M)=>{"use strict";M(11112);var q=M(11412);M(11216),M(11372),M(11212),M(11457),M(11420);q.c},12996:(K,H,M)=>{"use strict";M.d(H,{e:()=>w});var q=M(11242);class w{constructor(K){this.value=this._toInt(K)}_toInt(K){return 0|K}add(K){return new w(this.value+K.value)}LH(K){return new w(this.value-K.value)}multiply(K){return new w(Math.imul(this.value,K.value))}divide(K){return new w(this.value/K.value)}getClassName(){return w.ClassName}equals(K){return this.value===K.value}static FromValue(K){return new w(K)}toString(){return this.value.toString()}}w.ClassName="FlowGraphInteger",(0,q.f)("FlowGraphInteger",w)},13012:(K,H,M)=>{"use strict";M.d(H,{c:()=>w,d:()=>u});var q=M(11290);class w{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,1];this.Mh=K}get m(){return this.Mh}transformVector(K){return this.transformVectorToRef(K,new q.Vector2)}transformVectorToRef(K,H){return H.x=K.x*this.Mh[0]+K.y*this.Mh[1],H.y=K.x*this.Mh[2]+K.y*this.Mh[3],H}hh(){return this.toArray()}toArray(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let H=0;H<4;H++)K[H]=this.Mh[H];return K}aM(K){for(let H=0;H<4;H++)this.Mh[H]=K[H];return this}multiplyToRef(K,H){const M=K.Mh,q=this.Mh,w=H.Mh;return w[0]=M[0]*q[0]+M[1]*q[2],w[1]=M[0]*q[1]+M[1]*q[3],w[2]=M[2]*q[0]+M[3]*q[2],w[3]=M[2]*q[1]+M[3]*q[3],H}multiply(K){return this.multiplyToRef(K,new w)}divideToRef(K,H){const M=this.Mh,q=K.Mh,w=H.Mh;return w[0]=M[0]/q[0],w[1]=M[1]/q[1],w[2]=M[2]/q[2],w[3]=M[3]/q[3],H}divide(K){return this.divideToRef(K,new w)}addToRef(K,H){const M=this.Mh,q=K.m,w=H.m;return w[0]=M[0]+q[0],w[1]=M[1]+q[1],w[2]=M[2]+q[2],w[3]=M[3]+q[3],H}add(K){return this.addToRef(K,new w)}subtractToRef(K,H){const M=this.Mh,q=K.m,w=H.m;return w[0]=M[0]-q[0],w[1]=M[1]-q[1],w[2]=M[2]-q[2],w[3]=M[3]-q[3],H}LH(K){return this.subtractToRef(K,new w)}transpose(){const K=this.Mh;return new w([K[0],K[2],K[1],K[3]])}determinant(){const K=this.Mh;return K[0]*K[3]-K[1]*K[2]}inverse(){const K=this.determinant();if(0===K)throw new Error("Matrix is not invertible");const H=this.Mh,M=1/K;return new w([H[3]*M,-H[1]*M,-H[2]*M,H[0]*M])}equals(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const M=this.Mh,q=K.m;return 0===H?M[0]===q[0]&&M[1]===q[1]&&M[2]===q[2]&&M[3]===q[3]:Math.abs(M[0]-q[0])<H&&Math.abs(M[1]-q[1])<H&&Math.abs(M[2]-q[2])<H&&Math.abs(M[3]-q[3])<H}getClassName(){return"FlowGraphMatrix2D"}toString(){return`FlowGraphMatrix2D(${this.Mh.join(", ")})`}}class u{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,0,0,0,1,0,0,0,1];this.Mh=K}get m(){return this.Mh}transformVector(K){return this.transformVectorToRef(K,new q.OH)}transformVectorToRef(K,H){const M=this.Mh;return H.x=K.x*M[0]+K.y*M[1]+K.z*M[2],H.y=K.x*M[3]+K.y*M[4]+K.z*M[5],H.z=K.x*M[6]+K.y*M[7]+K.z*M[8],H}multiplyToRef(K,H){const M=K.Mh,q=this.Mh,w=H.m;return w[0]=M[0]*q[0]+M[1]*q[3]+M[2]*q[6],w[1]=M[0]*q[1]+M[1]*q[4]+M[2]*q[7],w[2]=M[0]*q[2]+M[1]*q[5]+M[2]*q[8],w[3]=M[3]*q[0]+M[4]*q[3]+M[5]*q[6],w[4]=M[3]*q[1]+M[4]*q[4]+M[5]*q[7],w[5]=M[3]*q[2]+M[4]*q[5]+M[5]*q[8],w[6]=M[6]*q[0]+M[7]*q[3]+M[8]*q[6],w[7]=M[6]*q[1]+M[7]*q[4]+M[8]*q[7],w[8]=M[6]*q[2]+M[7]*q[5]+M[8]*q[8],H}multiply(K){return this.multiplyToRef(K,new u)}divideToRef(K,H){const M=this.Mh,q=K.m,w=H.m;return w[0]=M[0]/q[0],w[1]=M[1]/q[1],w[2]=M[2]/q[2],w[3]=M[3]/q[3],w[4]=M[4]/q[4],w[5]=M[5]/q[5],w[6]=M[6]/q[6],w[7]=M[7]/q[7],w[8]=M[8]/q[8],H}divide(K){return this.divideToRef(K,new u)}addToRef(K,H){const M=this.Mh,q=K.m,w=H.m;return w[0]=M[0]+q[0],w[1]=M[1]+q[1],w[2]=M[2]+q[2],w[3]=M[3]+q[3],w[4]=M[4]+q[4],w[5]=M[5]+q[5],w[6]=M[6]+q[6],w[7]=M[7]+q[7],w[8]=M[8]+q[8],H}add(K){return this.addToRef(K,new u)}subtractToRef(K,H){const M=this.Mh,q=K.m,w=H.m;return w[0]=M[0]-q[0],w[1]=M[1]-q[1],w[2]=M[2]-q[2],w[3]=M[3]-q[3],w[4]=M[4]-q[4],w[5]=M[5]-q[5],w[6]=M[6]-q[6],w[7]=M[7]-q[7],w[8]=M[8]-q[8],H}LH(K){return this.subtractToRef(K,new u)}toArray(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let H=0;H<9;H++)K[H]=this.Mh[H];return K}hh(){return this.toArray()}aM(K){for(let H=0;H<9;H++)this.Mh[H]=K[H];return this}transpose(){const K=this.Mh;return new u([K[0],K[3],K[6],K[1],K[4],K[7],K[2],K[5],K[8]])}determinant(){const K=this.Mh;return K[0]*(K[4]*K[8]-K[5]*K[7])-K[1]*(K[3]*K[8]-K[5]*K[6])+K[2]*(K[3]*K[7]-K[4]*K[6])}inverse(){const K=this.determinant();if(0===K)throw new Error("Matrix is not invertible");const H=this.Mh,M=1/K;return new u([(H[4]*H[8]-H[5]*H[7])*M,(H[2]*H[7]-H[1]*H[8])*M,(H[1]*H[5]-H[2]*H[4])*M,(H[5]*H[6]-H[3]*H[8])*M,(H[0]*H[8]-H[2]*H[6])*M,(H[2]*H[3]-H[0]*H[5])*M,(H[3]*H[7]-H[4]*H[6])*M,(H[1]*H[6]-H[0]*H[7])*M,(H[0]*H[4]-H[1]*H[3])*M])}equals(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const M=this.Mh,q=K.m;return 0===H?M[0]===q[0]&&M[1]===q[1]&&M[2]===q[2]&&M[3]===q[3]&&M[4]===q[4]&&M[5]===q[5]&&M[6]===q[6]&&M[7]===q[7]&&M[8]===q[8]:Math.abs(M[0]-q[0])<H&&Math.abs(M[1]-q[1])<H&&Math.abs(M[2]-q[2])<H&&Math.abs(M[3]-q[3])<H&&Math.abs(M[4]-q[4])<H&&Math.abs(M[5]-q[5])<H&&Math.abs(M[6]-q[6])<H&&Math.abs(M[7]-q[7])<H&&Math.abs(M[8]-q[8])<H}getClassName(){return"FlowGraphMatrix3D"}toString(){return`FlowGraphMatrix3D(${this.Mh.join(", ")})`}}},13016:(K,H,M)=>{"use strict";var q;function w(K,H,M,q){switch(H){case"Animation":return q?K.animations.find((K=>K.uniqueId===M))??null:K.animations[M]??null;case"AnimationGroup":return q?K.animationGroups.find((K=>K.uniqueId===M))??null:K.animationGroups[M]??null;case"Mesh":return q?K.meshes.find((K=>K.uniqueId===M))??null:K.meshes[M]??null;case"Material":return q?K.materials.find((K=>K.uniqueId===M))??null:K.materials[M]??null;case"Df":return q?K.cameras.find((K=>K.uniqueId===M))??null:K.cameras[M]??null;case"Light":return q?K.lights.find((K=>K.uniqueId===M))??null:K.lights[M]??null;default:return null}}M.d(H,{d:()=>w}),function(K){K.Animation="Animation",K.AnimationGroup="AnimationGroup",K.Mesh="Mesh",K.Material="Material",K.Df="Df",K.Light="Light"}(q||(q={}))},13045:(K,H,M)=>{"use strict";M.d(H,{c:()=>w});var q=M(13054);class w extends q.e{constructor(K,H){if(super(K),this._eventsSignalOutputs={},this.done=this._registerSignalOutput("done"),H)for(const M of H)this._eventsSignalOutputs[M]=this._registerSignalOutput(M+"Event")}_executeOnTick(K){}_startPendingTasks(K){K._getExecutionVariable(this,"_initialized",!1)&&(this._cancelPendingTasks(K),this._resetAfterCanceled(K)),this._preparePendingTasks(K),K._addPendingBlock(this),this.out._activateSignal(K),K._setExecutionVariable(this,"_initialized",!0)}_resetAfterCanceled(K){K._deleteExecutionVariable(this,"_initialized"),K._removePendingBlock(this)}}},13021:(K,H,M)=>{"use strict";M.d(H,{b:()=>I});var q=M(11250),w=M(11242),u=M(13027),y=M(11102),h=M(12988);class W extends u.d{constructor(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q.defaultValue,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(K,H,M),this.richType=q,this._defaultValue=w,this._optional=u,this._isDisabled=!1,this._lastValue=null,this.dataTransformer=null,this.onValueChangedObservable=new y.d}get optional(){return this._optional}get isDisabled(){return this._isDisabled}set isDisabled(K){this._isDisabled!==K&&(this._isDisabled=K,this._isDisabled&&this.disconnectFromAll())}_isSingularConnection(){return 0===this.connectionType}setValue(K,H){H._getConnectionValue(this)!==K&&(H._setConnectionValue(this,K),this.onValueChangedObservable.notifyObservers(K))}resetToDefaultValue(K){K._setConnectionValue(this,this._defaultValue)}connectTo(K){this._isDisabled||super.connectTo(K)}_getValueOrDefault(K){const H=K._getConnectionValue(this)??this._defaultValue;return this.dataTransformer?this.dataTransformer(H):H}getValue(K){if(1===this.connectionType){K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(K);const H=this._getValueOrDefault(K);return this._lastValue=H,this.richType.typeTransformer?this.richType.typeTransformer(H):H}const H=this.isConnected()?this._connectedPoint[0].getValue(K):this._getValueOrDefault(K);return this._lastValue=H,this.richType.typeTransformer?this.richType.typeTransformer(H):H}_getLastValue(){return this._lastValue}getClassName(){return"FlowGraphDataConnection"}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.richType={},this.richType.serialize(K.richType),K.optional=this._optional,(0,h.g)("defaultValue",this._defaultValue,K)}}(0,w.f)("FlowGraphDataConnection",W);class I{constructor(K){var H;this.config=K,this.uniqueId=(0,q.c)(),this.name=(null===(H=this.config)||void 0===H?void 0:H.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(K){}registerDataInput(K,H,M){const q=new W(K,0,this,H,M);return this.dataInputs.push(q),q}registerDataOutput(K,H,M){const q=new W(K,1,this,H,M);return this.dataOutputs.push(q),q}getDataInput(K){return this.dataInputs.find((H=>H.name===K))}getDataOutput(K){return this.dataOutputs.find((H=>H.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.g;if(K.uniqueId=this.uniqueId,K.config={},this.config){const M=this.config,q=Object.keys(M);for(const w of q)H(w,M[w],K.config)}K.dataInputs=[],K.dataOutputs=[],K.className=this.getClassName();for(const M of this.dataInputs){const H={};M.serialize(H),K.dataInputs.push(H)}for(const M of this.dataOutputs){const H={};M.serialize(H),K.dataOutputs.push(H)}}deserialize(K){}_log(K,H,M){var q;null===(q=K.logger)||void 0===q||q.addLogItem({action:H,vM:M,className:this.getClassName(),uniqueId:this.uniqueId})}getClassName(){return"FlowGraphBlock"}}},13027:(K,H,M)=>{"use strict";M.d(H,{d:()=>u});var q,w=M(11250);!function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(q||(q={}));class u{constructor(K,H,M){this._ownerBlock=M,this._connectedPoint=[],this.uniqueId=(0,w.c)(),this.connectedPointIds=[],this.name=K,this._connectionType=H}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(K){if(this._connectionType===K._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||K._isSingularConnection()&&K._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(K),K._connectedPoint.push(this)}disconnectFrom(K){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const M=this._connectedPoint.indexOf(K),q=K._connectedPoint.indexOf(this);-1!==M&&-1!==q&&(H&&this._connectedPoint.splice(M,1),K._connectedPoint.splice(q,1))}disconnectFromAll(){for(const K of this._connectedPoint)this.disconnectFrom(K,!1);this._connectedPoint.length=0}dispose(){for(const K of this._connectedPoint)this.disconnectFrom(K)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.uniqueId=this.uniqueId,K.name=this.name,K._connectionType=this._connectionType,K.connectedPointIds=[],K.className=this.getClassName();for(const H of this._connectedPoint)K.connectedPointIds.push(H.uniqueId)}getClassName(){return"FGConnection"}deserialize(K){this.uniqueId=K.uniqueId,this.name=K.name,this._connectionType=K._connectionType,this.connectedPointIds=K.connectedPointIds}}},12981:(K,H,M)=>{"use strict";M.d(H,{d:()=>C});var q,w=M(11102),u=M(11274),y=M(11280),h=M(11250),W=M(12988),I=M(13016),f=M(11112);!function(K){K.ExecuteBlock="ExecuteBlock",K.ExecuteEvent="ExecuteEvent",K.TriggerConnection="TriggerConnection",K.ContextVariableSet="ContextVariableSet",K.GlobalVariableSet="GlobalVariableSet",K.GlobalVariableDelete="GlobalVariableDelete",K.GlobalVariableGet="GlobalVariableGet",K.AddConnection="AddConnection",K.GetConnectionValue="GetConnectionValue",K.SetConnectionValue="SetConnectionValue",K.ActivateSignal="ActivateSignal",K.ContextVariableGet="ContextVariableGet"}(q||(q={}));class z{constructor(){this.logToConsole=!1,this.log=[]}addLogItem(K){if(K.time||(K.time=Date.now()),this.log.push(K),this.logToConsole){var H;const M=null===(H=K.vM)||void 0===H?void 0:H.value;"object"===typeof M&&M.getClassName?f.e.Log(`[FGLog] ${K.className}:${K.uniqueId.split("-")[0]} ${K.action} - ${JSON.stringify(M.getClassName())}: ${M.toString()}`):f.e.Log(`[FGLog] ${K.className}:${K.uniqueId.split("-")[0]} ${K.action} - ${JSON.stringify(K.vM)}`)}}getItemsOfType(K){return this.log.filter((H=>H.action===K))}}class G{get enableLogging(){return this._enableLogging}set enableLogging(K){this._enableLogging!==K&&(this._enableLogging=K,this._enableLogging?(this.logger=new z,this.logger.logToConsole=!0):this.logger=null)}constructor(K){this.uniqueId=(0,h.c)(),this._userVariables={},this._executionVariables={},this._globalContextVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new w.d,this.treatDataAsRightHanded=!1,this._enableLogging=!1,this._configuration=K,this.assetsContext=K.assetsContext??K.SH}hasVariable(K){return K in this._userVariables}setVariable(K,H){var M;this._userVariables[K]=H,null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableSet",vM:{name:K,value:H}})}getAsset(K,H){return(0,I.d)(this.assetsContext,K,H)}getVariable(K){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"ContextVariableGet",vM:{name:K,value:this._userVariables[K]}}),this._userVariables[K]}get userVariables(){return this._userVariables}sK(){return this._configuration.SH}_getUniqueIdPrefixedName(K,H){return`${K.uniqueId}_${H}`}_getGlobalContextVariable(K,H){var M;return null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableGet",vM:{name:K,defaultValue:H,possibleValue:this._globalContextVariables[K]}}),this._hasGlobalContextVariable(K)?this._globalContextVariables[K]:H}_setGlobalContextVariable(K,H){var M;null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableSet",vM:{name:K,value:H}}),this._globalContextVariables[K]=H}_deleteGlobalContextVariable(K){var H;null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GlobalVariableDelete",vM:{name:K}}),delete this._globalContextVariables[K]}_hasGlobalContextVariable(K){return K in this._globalContextVariables}_setExecutionVariable(K,H,M){this._executionVariables[this._getUniqueIdPrefixedName(K,H)]=M}_getExecutionVariable(K,H,M){return this._hasExecutionVariable(K,H)?this._executionVariables[this._getUniqueIdPrefixedName(K,H)]:M}_deleteExecutionVariable(K,H){delete this._executionVariables[this._getUniqueIdPrefixedName(K,H)]}_hasExecutionVariable(K,H){return this._getUniqueIdPrefixedName(K,H)in this._executionVariables}_hasConnectionValue(K){return K.uniqueId in this._connectionValues}_setConnectionValue(K,H){var M;this._connectionValues[K.uniqueId]=H,null===(M=this.logger)||void 0===M||M.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"SetConnectionValue",vM:{connectionPointId:K.uniqueId,value:H}})}_setConnectionValueByKey(K,H){this._connectionValues[K]=H}_getConnectionValue(K){var H;return null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:this.getClassName(),uniqueId:this.uniqueId,action:"GetConnectionValue",vM:{connectionPointId:K.uniqueId,value:this._connectionValues[K.uniqueId]}}),this._connectionValues[K.uniqueId]}get configuration(){return this._configuration}get hasPendingBlocks(){return this._pendingBlocks.length>0}_addPendingBlock(K){this._pendingBlocks.includes(K)||(this._pendingBlocks.push(K),this._pendingBlocks.sort(((K,H)=>K.priority-H.priority)))}_removePendingBlock(K){const H=this._pendingBlocks.indexOf(K);-1!==H&&this._pendingBlocks.splice(H,1)}_clearPendingBlocks(){for(const K of this._pendingBlocks)K._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(K){var H;this.onNodeExecutedObservable.notifyObservers(K),null===(H=this.logger)||void 0===H||H.addLogItem({time:Date.now(),className:K.getClassName(),uniqueId:K.uniqueId,action:"ExecuteBlock"})}_notifyOnTick(K){this._setGlobalContextVariable("timeSinceStart",K.timeSinceStart),this._setGlobalContextVariable("deltaTime",K.deltaTime);for(const M of this._pendingBlocks){var H;null===(H=M._executeOnTick)||void 0===H||H.call(M,this)}}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.g;K.uniqueId=this.uniqueId,K._userVariables={};for(const q in this._userVariables)H(q,this._userVariables[q],K._userVariables);K._connectionValues={};for(const q in this._connectionValues)H(q,this._connectionValues[q],K._connectionValues);var M;this.assetsContext!==this.sK()&&(K._assetsContext={meshes:this.assetsContext.meshes.map((K=>K.id)),materials:this.assetsContext.materials.map((K=>K.id)),textures:this.assetsContext.textures.map((K=>K.name)),animations:this.assetsContext.animations.map((K=>K.name)),lights:this.assetsContext.lights.map((K=>K.id)),cameras:this.assetsContext.cameras.map((K=>K.id)),Ha:null===(M=this.assetsContext.Ha)||void 0===M?void 0:M.map((K=>K.name)),skeletons:this.assetsContext.skeletons.map((K=>K.id)),CG:this.assetsContext.CG.map((K=>K.name)),geometries:this.assetsContext.geometries.map((K=>K.id)),multiMaterials:this.assetsContext.multiMaterials.map((K=>K.id)),transformNodes:this.assetsContext.transformNodes.map((K=>K.id))})}getClassName(){return"FlowGraphContext"}}(0,u.e)([(0,y.J)()],G.prototype,"uniqueId",void 0);var a=M(13019),v=M(11561);class O{constructor(K){this.onEventTriggeredObservable=new w.d,this.sceneReadyTriggered=!1,this._pointerUnderMeshState={},this._startingTime=0,this._scene=K,this._initialize()}_initialize(){this._sceneReadyObserver=this._scene.onReadyObservable.add((()=>{this.sceneReadyTriggered||(this.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}),this.sceneReadyTriggered=!0)})),this._sceneDisposeObserver=this._scene.Hh.add((()=>{this.onEventTriggeredObservable.notifyObservers({type:"SceneDispose"})})),this._sceneOnBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((()=>{const K=this._scene.getEngine().getDeltaTime()/1e3;this.onEventTriggeredObservable.notifyObservers({type:"SceneBeforeRender",vM:{timeSinceStart:this._startingTime,deltaTime:K}}),this._startingTime+=K})),this._meshPickedObserver=this._scene.onPointerObservable.add((K=>{this.onEventTriggeredObservable.notifyObservers({type:"MeshPick",vM:K})}),v.c.POINTERPICK),this._meshUnderPointerObserver=this._scene.onMeshUnderPointerUpdatedObservable.add((K=>{const H=K.pointerId,M=K.mesh,q=this._pointerUnderMeshState[H];!q&&M?this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",vM:{pointerId:H,mesh:M}}):q&&!M?this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",vM:{pointerId:H,mesh:q}}):q&&M&&q!==M&&(this.onEventTriggeredObservable.notifyObservers({type:"PointerOut",vM:{pointerId:H,mesh:q,over:M}}),this.onEventTriggeredObservable.notifyObservers({type:"PointerOver",vM:{pointerId:H,mesh:M,out:q}})),this._pointerUnderMeshState[H]=M}),v.c.POINTERMOVE)}dispose(){var K,H,M,q,w;null===(K=this._sceneDisposeObserver)||void 0===K||K.remove(),null===(H=this._sceneReadyObserver)||void 0===H||H.remove(),null===(M=this._sceneOnBeforeRenderObserver)||void 0===M||M.remove(),null===(q=this._meshPickedObserver)||void 0===q||q.remove(),null===(w=this._meshUnderPointerObserver)||void 0===w||w.remove(),this.onEventTriggeredObservable.clear()}}var L,S=M(13030);!function(K){K[K.Stopped=0]="Stopped",K[K.Started=1]="Started"}(L||(L={}));class B{get state(){return this._state}set state(K){this._state=K,this.onStateChangedObservable.notifyObservers(K)}constructor(K){this.onStateChangedObservable=new w.d,this._eventBlocks={SceneReady:[],SceneDispose:[],SceneBeforeRender:[],MeshPick:[],PointerDown:[],PointerUp:[],PointerMove:[],PointerOver:[],PointerOut:[],SceneAfterRender:[],NoTrigger:[]},this._executionContexts=[],this._state=0,this._scene=K.SH,this._sceneEventCoordinator=new O(this._scene),this._coordinator=K.coordinator,this._eventObserver=this._sceneEventCoordinator.onEventTriggeredObservable.add((K=>{for(const H of this._executionContexts){const M=this._getContextualOrder(K.type,H);for(const q of M)if(!q._executeEvent(H,K.vM))break}switch(K.type){case"SceneReady":this._sceneEventCoordinator.sceneReadyTriggered=!0;break;case"SceneBeforeRender":for(const H of this._executionContexts)H._notifyOnTick(K.vM);break;case"SceneDispose":this.dispose()}}))}createContext(){const K=new G({SH:this._scene,coordinator:this._coordinator});return this._executionContexts.push(K),K}getContext(K){return this._executionContexts[K]}addEventBlock(K){if("PointerOver"!==K.type&&"PointerOut"!==K.type||(this._scene.constantlyUpdateMeshUnderPointer=!0),"NoTrigger"!==K.type&&this._eventBlocks[K.type].push(K),1===this.state)for(const H of this._executionContexts)K._startPendingTasks(H);else this.onStateChangedObservable.addOnce((H=>{if(1===H)for(const M of this._executionContexts)K._startPendingTasks(M)}))}start(){1!==this.state&&(0===this._executionContexts.length&&this.createContext(),this.onStateChangedObservable.add((K=>{1===K&&(this._startPendingEvents(),this._scene.isReady(!0)&&this._sceneEventCoordinator.onEventTriggeredObservable.notifyObservers({type:"SceneReady"}))})),this.state=1)}_startPendingEvents(){for(const K of this._executionContexts)for(const H in this._eventBlocks){const M=this._getContextualOrder(H,K);for(const H of M)H._startPendingTasks(K)}}_getContextualOrder(K,H){const M=this._eventBlocks[K].sort(((K,H)=>H.initPriority-K.initPriority));if("MeshPick"===K){const K=[];for(const q of M){const w=q.asset.getValue(H);let u=0;for(;u<M.length;u++){const K=M[u].asset.getValue(H);if(w&&K&&(0,S.q)(w,K))break}K.splice(u,0,q)}return K}return M}dispose(){var K;if(0!==this.state){this.state=0;for(const K of this._executionContexts)K._clearPendingBlocks();this._executionContexts.length=0;for(const K in this._eventBlocks)this._eventBlocks[K].length=0;null===(K=this._eventObserver)||void 0===K||K.remove(),this._sceneEventCoordinator.dispose()}}visitAllBlocks(K){const H=[],M=new Set;for(const q in this._eventBlocks)for(const K of this._eventBlocks[q])H.push(K),M.add(K.uniqueId);for(;H.length>0;){const q=H.pop();K(q);for(const K of q.dataInputs)for(const q of K._connectedPoint)M.has(q._ownerBlock.uniqueId)||(H.push(q._ownerBlock),M.add(q._ownerBlock.uniqueId));if(q instanceof a.d)for(const K of q.signalOutputs)for(const q of K._connectedPoint)M.has(q._ownerBlock.uniqueId)||(H.push(q._ownerBlock),M.add(q._ownerBlock.uniqueId))}}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},H=arguments.length>1?arguments[1]:void 0;K.allBlocks=[],this.visitAllBlocks((H=>{const M={};H.serialize(M),K.allBlocks.push(M)})),K.executionContexts=[];for(const M of this._executionContexts){const q={};M.serialize(q,H),K.executionContexts.push(q)}}}class C{constructor(K){this.config=K,this.dispatchEventsSynchronously=!0,this._flowGraphs=[],this._customEventsMap=new Map,this._eventExecutionCounter=new Map,this._executeOnNextFrame=[],this._eventUniqueId=0,this._disposeObserver=this.config.SH.Hh.add((()=>{this.dispose()})),this._onBeforeRenderObserver=this.config.SH.onBeforeRenderObservable.add((()=>{this._eventExecutionCounter.clear();const K=this._executeOnNextFrame.slice(0);if(K.length)for(const H of K){this.notifyCustomEvent(H.id,H.data,!1);const K=this._executeOnNextFrame.findIndex((K=>K.uniqueId===H.uniqueId));-1!==K&&this._executeOnNextFrame.splice(K,1)}}));(C.SceneCoordinators.get(this.config.SH)??[]).push(this)}createGraph(){const K=new B({SH:this.config.SH,coordinator:this});return this._flowGraphs.push(K),K}removeGraph(K){const H=this._flowGraphs.indexOf(K);-1!==H&&(K.dispose(),this._flowGraphs.splice(H,1))}start(){for(const K of this._flowGraphs)K.start()}dispose(){var K,H;for(const w of this._flowGraphs)w.dispose();this._flowGraphs.length=0,null===(K=this._disposeObserver)||void 0===K||K.remove(),null===(H=this._onBeforeRenderObserver)||void 0===H||H.remove();const M=C.SceneCoordinators.get(this.config.SH)??[],q=M.indexOf(this);-1!==q&&M.splice(q,1)}serialize(K,H){K._flowGraphs=[];for(const M of this._flowGraphs){const q={};M.serialize(q,H),K._flowGraphs.push(q)}K.dispatchEventsSynchronously=this.dispatchEventsSynchronously}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(K){let H=this._customEventsMap.get(K);return H||(H=new w.d,this._customEventsMap.set(K,H)),H}notifyCustomEvent(K,H){if(arguments.length>2&&void 0!==arguments[2]?arguments[2]:!this.dispatchEventsSynchronously)return void this._executeOnNextFrame.push({id:K,data:H,uniqueId:this._eventUniqueId++});if(this._eventExecutionCounter.has(K)){const H=this._eventExecutionCounter.get(K);if(this._eventExecutionCounter.set(K,H+1),H>=C.MaxEventTypeExecutionPerFrame)return void(H===C.MaxEventTypeExecutionPerFrame&&f.e.Warn(`FlowGraphCoordinator: Too many executions of event "${K}".`))}else this._eventExecutionCounter.set(K,1);const M=this._customEventsMap.get(K);M&&M.notifyObservers(H)}}C.MaxEventsPerType=30,C.MaxEventTypeExecutionPerFrame=30,C.SceneCoordinators=new Map},13036:(K,H,M)=>{"use strict";M.d(H,{d:()=>w});var q=M(13045);class w extends q.c{constructor(){super(...arguments),this.initPriority=0,this.type="NoTrigger"}_execute(K){K._notifyExecuteNode(this),this.done._activateSignal(K)}}},13019:(K,H,M)=>{"use strict";M.d(H,{d:()=>h});var q=M(13021),w=M(13027),u=M(11242);class y extends w.d{constructor(){super(...arguments),this.priority=0}_isSingularConnection(){return!1}connectTo(K){super.connectTo(K),this._connectedPoint.sort(((K,H)=>H.priority-K.priority))}_activateSignal(K){var H;if(null===(H=K.logger)||void 0===H||H.addLogItem({action:"ActivateSignal",className:this._ownerBlock.getClassName(),uniqueId:this._ownerBlock.uniqueId,vM:{connectionType:this.connectionType,name:this.name}}),0===this.connectionType)K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(K,this),K._increaseExecutionId();else for(const M of this._connectedPoint)M._activateSignal(K)}}(0,u.f)("FlowGraphSignalConnection",y);class h extends q.b{constructor(K){super(K),this.priority=0,this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in"),this.error=this._registerSignalOutput("error")}_registerSignalInput(K){const H=new y(K,0,this);return this.signalInputs.push(H),H}_registerSignalOutput(K){const H=new y(K,1,this);return this.signalOutputs.push(H),H}_unregisterSignalInput(K){const H=this.signalInputs.findIndex((H=>H.name===K));-1!==H&&(this.signalInputs[H].dispose(),this.signalInputs.splice(H,1))}_unregisterSignalOutput(K){const H=this.signalOutputs.findIndex((H=>H.name===K));-1!==H&&(this.signalOutputs[H].dispose(),this.signalOutputs.splice(H,1))}_reportError(K,H){this.error.vM="string"===typeof H?new Error(H):H,this.error._activateSignal(K)}getSignalInput(K){return this.signalInputs.find((H=>H.name===K))}getSignalOutput(K){return this.signalOutputs.find((H=>H.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.signalInputs=[],K.signalOutputs=[];for(const H of this.signalInputs){const M={};H.serialize(M),K.signalInputs.push(M)}for(const H of this.signalOutputs){const M={};H.serialize(M),K.signalOutputs.push(M)}}deserialize(K){for(let H=0;H<K.signalInputs.length;H++){const M=this.getSignalInput(K.signalInputs[H].name);if(!M)throw new Error("Could not find signal input with name "+K.signalInputs[H].name+" in block "+K.className);M.deserialize(K.signalInputs[H])}for(let H=0;H<K.signalOutputs.length;H++){const M=this.getSignalOutput(K.signalOutputs[H].name);if(!M)throw new Error("Could not find signal output with name "+K.signalOutputs[H].name+" in block "+K.className);M.deserialize(K.signalOutputs[H])}}getClassName(){return"FlowGraphExecutionBlock"}}},13054:(K,H,M)=>{"use strict";M.d(H,{e:()=>w});var q=M(13019);class w extends q.d{constructor(K){super(K),this.out=this._registerSignalOutput("out")}}},13004:(K,H,M)=>{"use strict";M.d(H,{B:()=>f,E:()=>a,F:()=>v,G:()=>O,J:()=>D,K:()=>V,L:()=>s,P:()=>l,d:()=>I,h:()=>G,l:()=>E,o:()=>L,r:()=>S,v:()=>B,x:()=>z,y:()=>Z});var q,w=M(11290),u=M(11329),y=M(12996),h=M(13012);!function(K){K.Any="any",K.String="string",K.Number="number",K.Boolean="boolean",K.Object="object",K.Integer="FlowGraphInteger",K.Vector2="Vector2",K.OH="OH",K.Vector4="Vector4",K.Quaternion="Quaternion",K.Matrix="Matrix",K.Matrix2D="Matrix2D",K.Matrix3D="Matrix3D",K.CH="CH",K.Ch="Ch"}(q||(q={}));class W{constructor(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;this.typeName=K,this.defaultValue=H,this.animationType=M}serialize(K){K.typeName=this.typeName,K.defaultValue=this.defaultValue}}const I=new W("any",void 0),f=new W("string",""),z=new W("number",0,0),G=new W("boolean",!1),a=new W("Vector2",w.Vector2.Zero(),5),v=new W("OH",w.OH.Zero(),1),O=new W("Vector4",w.Vector4.Zero()),L=new W("Matrix",w.Matrix.Identity(),3),S=new W("Matrix2D",new h.c),B=new W("Matrix3D",new h.d),C=new W("CH",u.CH.Black(),4),i=new W("Ch",new u.Ch(0,0,0,0),7),Z=new W("Quaternion",w.Quaternion.Identity(),2);Z.typeTransformer=K=>{if(K.getClassName){if("Vector4"===K.getClassName())return w.Quaternion.iH(K.hh());if("OH"===K.getClassName())return w.Quaternion.FromEulerVector(K);if("Matrix"===K.getClassName())return w.Quaternion.FromRotationMatrix(K)}return K};const E=new W("FlowGraphInteger",new y.e(0),0);function l(K){const H=K;switch(typeof K){case"string":return f;case"number":return z;case"boolean":return G;case"object":if(H.getClassName)switch(H.getClassName()){case"Vector2":return a;case"OH":return v;case"Vector4":return O;case"Matrix":return L;case"CH":return C;case"Ch":return i;case"Quaternion":return Z;case"FlowGraphInteger":return E;case"Matrix2D":return S;case"Matrix3D":return B}return I;default:return I}}function s(K){switch(K){case"string":return f;case"number":return z;case"boolean":return G;case"Vector2":return a;case"OH":return v;case"Vector4":return O;case"Matrix":return L;case"CH":return C;case"Ch":return i;case"Quaternion":return Z;case"FlowGraphInteger":return E;case"Matrix2D":return S;case"Matrix3D":return B;default:return I}}function D(K){switch(K){case"number":default:return 0;case"Vector2":return 5;case"OH":return 1;case"Matrix":return 3;case"CH":return 4;case"Ch":return 7;case"Quaternion":return 2}}function V(K){switch(K){case 0:return z;case 5:return a;case 1:return v;case 3:return L;case 4:return C;case 7:return i;case 2:return Z;default:return I}}},12988:(K,H,M)=>{"use strict";M.d(H,{d:()=>f,g:()=>I,k:()=>z});var q=M(11329),w=M(11290),u=M(12996),y=M(13004),h=M(13012);function W(K){return"Vector2"===K||"OH"===K||"Vector4"===K||"Quaternion"===K||"CH"===K||"Ch"===K}function I(K,H,M){var q;const w=(null===H||void 0===H||null===(q=H.getClassName)||void 0===q?void 0:q.call(H))??"";if(W(w)||function(K){return"Matrix"===K||"Matrix2D"===K||"Matrix3D"===K}(w))M[K]={value:H.hh(),className:w};else if("FlowGraphInteger"===w)M[K]={value:H.value,className:w};else if(w&&(H.id||H.name))M[K]={id:H.id,name:H.name,className:w};else{if("object"===typeof H)throw new Error(`Could not serialize value ${H}`);M[K]=H}}function f(K,H,M,I){const z=H[K];let G;const a=(null===z||void 0===z?void 0:z.type)??(null===z||void 0===z?void 0:z.className);if(function(K){return"Mesh"===K||"AbstractMesh"===K||"GroundMesh"===K||"InstanceMesh"===K||"LinesMesh"===K||"GoldbergMesh"===K||"GreasedLineMesh"===K||"TrailMesh"===K}(a)){let K=I.meshes.filter((K=>z.id?K.id===z.id:K.name===z.name));0===K.length&&(K=I.transformNodes.filter((K=>z.id?K.id===z.id:K.name===z.name))),G=z.uniqueId?K.find((K=>K.uniqueId===z.uniqueId)):K[0]}else if(W(a))G=function(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("Vector2"===K)return w.Vector2.iH(H);if("OH"===K)return M&&(H[2]*=-1),w.OH.iH(H);if("Vector4"===K)return w.Vector4.iH(H);if("Quaternion"===K)return M&&(H[2]*=-1,H[3]*=-1),w.Quaternion.iH(H);if("CH"===K)return new q.CH(H[0],H[1],H[2]);if("Ch"===K)return new q.Ch(H[0],H[1],H[2],H[3]);throw new Error(`Unknown vector class name ${K}`)}(a,z.value);else if(function(K){return"AnimationGroup"===K}(a)){const K=I.animationGroups.filter((K=>K.name===z.name));G=1===K.length?K[0]:K.find((K=>K.uniqueId===z.uniqueId))}else G="Matrix"===a?w.Matrix.iH(z.value):"Matrix2D"===a?new h.c(z.value):"Matrix3D"===a?new h.d(z.value):"FlowGraphInteger"===a?u.e.FromValue(z.value):"number"===a||"string"===a||"boolean"===a?z.value[0]:z&&void 0!==z.value?z.value:Array.isArray(z)?z.reduce(((K,H)=>H.eventData?(K[H.id]={type:(0,y.L)(H.type)},"undefined"!==typeof H.value&&(K[H.id].value=f("value",H,M,I)),K):K),{}):z;return G}function z(K){return"FlowGraphJsonPointerParserBlock"===K}},13030:(K,H,M)=>{"use strict";function q(K,H){return!(!K.parent||K.parent!==H&&!q(K.parent,H))}function w(K){if(K.getClassName)return K.getClassName()}function u(K,H){return K===H&&("Vector2"===K||"OH"===K||"Vector4"===K||"Quaternion"===K)}function y(K,H){return K===H&&("Matrix"===K||"Matrix2D"===K||"Matrix3D"===K)}function h(K,H){return"FlowGraphInteger"===K&&"FlowGraphInteger"===H}function W(K,H){const M="number"===typeof K||"number"===typeof(null===K||void 0===K?void 0:K.value);return M&&!H?!isNaN(I(K)):M}function I(K){return"number"===typeof K?K:K.value}M.d(H,{b:()=>h,f:()=>y,j:()=>u,m:()=>w,q:()=>q,r:()=>I,t:()=>W})},12412:(K,H,M)=>{"use strict";M.r(H),M.d(H,{SceneInstrumentation:()=>u});var q=M(11100),w=M(11498);class u{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(K){K!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=K,K?(this._onBeforeActiveMeshesEvaluationObserver=this.SH.onBeforeActiveMeshesEvaluationObservable.add((()=>{q.Tools.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.SH.onAfterActiveMeshesEvaluationObservable.add((()=>{q.Tools.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.SH.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.SH.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(K){K!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=K,K?(this._onBeforeRenderTargetsRenderObserver=this.SH.onBeforeRenderTargetsRenderObservable.add((()=>{q.Tools.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.SH.onAfterRenderTargetsRenderObservable.add((()=>{q.Tools.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.SH.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.SH.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(K){K!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=K,K?(this._onBeforeParticlesRenderingObserver=this.SH.onBeforeParticlesRenderingObservable.add((()=>{q.Tools.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.SH.onAfterParticlesRenderingObservable.add((()=>{q.Tools.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.SH.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.SH.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(K){K!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=K,this.SH.spriteManagers&&(K?(this._onBeforeSpritesRenderingObserver=this.SH.onBeforeSpritesRenderingObservable.add((()=>{q.Tools.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.SH.onAfterSpritesRenderingObservable.add((()=>{q.Tools.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.SH.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.SH.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(K){K!==this._capturePhysicsTime&&this.SH.onBeforePhysicsObservable&&(this._capturePhysicsTime=K,K?(this._onBeforePhysicsObserver=this.SH.onBeforePhysicsObservable.add((()=>{q.Tools.StartPerformanceCounter("Ah"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.SH.onAfterPhysicsObservable.add((()=>{q.Tools.EndPerformanceCounter("Ah"),this._physicsTime.endMonitoring()}))):(this.SH.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.SH.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(K){K!==this._captureAnimationsTime&&(this._captureAnimationsTime=K,K?this._onAfterAnimationsObserver=this.SH.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.SH.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(K){this._captureFrameTime=K}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(K){this._captureInterFrameTime=K}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(K){K!==this._captureRenderTime&&(this._captureRenderTime=K,K?(this._onBeforeDrawPhaseObserver=this.SH.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),q.Tools.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.SH.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),q.Tools.EndPerformanceCounter("Main render")}))):(this.SH.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.SH.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(K){K!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=K,K?(this._onBeforeCameraRenderObserver=this.SH.onBeforeCameraRenderObservable.add((K=>{this._cameraRenderTime.beginMonitoring(),q.Tools.StartPerformanceCounter(`Rendering camera ${K.name}`)})),this._onAfterCameraRenderObserver=this.SH.onAfterCameraRenderObservable.add((K=>{this._cameraRenderTime.endMonitoring(!1),q.Tools.EndPerformanceCounter(`Rendering camera ${K.name}`)}))):(this.SH.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.SH.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.SH.getEngine()._drawCalls}constructor(K){this.SH=K,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new w.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new w.d,this._captureFrameTime=!1,this._frameTime=new w.d,this._captureRenderTime=!1,this._renderTime=new w.d,this._captureInterFrameTime=!1,this._interFrameTime=new w.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new w.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new w.d,this._capturePhysicsTime=!1,this._physicsTime=new w.d,this._captureAnimationsTime=!1,this._animationsTime=new w.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new w.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._disposed=!1,this._onBeforeAnimationsObserver=K.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(q.Tools.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.SH.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=K.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(q.Tools.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Kh(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Kh(),this._captureParticlesRenderTime&&this._particlesRenderTime.Kh(),this._captureSpritesRenderTime&&this._spritesRenderTime.Kh(),this._captureRenderTime&&this._renderTime.Kh(),this._captureCameraRenderTime&&this._cameraRenderTime.Kh()}))}dispose(){this._disposed||(this.SH.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.SH.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.SH.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.SH.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.SH.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.SH.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.SH.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.SH.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.SH.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.SH.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.SH.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.SH.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.SH.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.SH.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.SH.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.SH.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.SH.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.SH=null,this._disposed=!0)}}},12979:(K,H,M)=>{"use strict";M.d(H,{b:()=>f});var q=M(11274),w=M(11280),u=M(11290),y=M(11704),h=M(11824),W=M(11898),I=M(11242);y.d.AddNodeConstructor("Light_Type_1",((K,H)=>()=>new f(K,u.OH.Zero(),H)));class f extends W.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(K){this._shadowFrustumSize=K,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(K){this._shadowOrthoScale=K,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(K){this._orthoLeft=K}get orthoRight(){return this._orthoRight}set orthoRight(K){this._orthoRight=K}get orthoTop(){return this._orthoTop}set orthoTop(K){this._orthoTop=K}get orthoBottom(){return this._orthoBottom}set orthoBottom(K){this._orthoBottom=K}constructor(K,H,M){super(K,M),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=H.scale(-1),this.direction=H}getClassName(){return"qf"}getTypeID(){return h.e.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(K,H,M){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(K):this._setDefaultAutoExtendShadowProjectionMatrix(K,H,M)}_setDefaultFixedFrustumShadowProjectionMatrix(K){const H=this.sK().activeCamera;H&&u.Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:H.Ih,void 0!==this.shadowMaxZ?this.shadowMaxZ:H.maxZ,K,this.sK().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(K,H,M){const q=this.sK().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const K=u.OH.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let q=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let y=0;y<M.length;y++){const h=M[y];if(!h)continue;const W=h.getBoundingInfo().boundingBox;for(let M=0;M<W.vectorsWorld.length;M++)u.OH.TransformCoordinatesToRef(W.vectorsWorld[M],H,K),K.x<this._orthoLeft&&(this._orthoLeft=K.x),K.y<this._orthoBottom&&(this._orthoBottom=K.y),K.x>this._orthoRight&&(this._orthoRight=K.x),K.y>this._orthoTop&&(this._orthoTop=K.y),this.autoCalcShadowZBounds&&(K.z<q&&(q=K.z),K.z>w&&(w=K.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=q,this._shadowMaxZ=w)}const w=this._orthoRight-this._orthoLeft,y=this._orthoTop-this._orthoBottom,h=void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.Ih)||0,W=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)||1e4,I=this.sK().getEngine().useReverseDepthBuffer;u.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-w*this.shadowOrthoScale,this._orthoRight+w*this.shadowOrthoScale,this._orthoBottom-y*this.shadowOrthoScale,this._orthoTop+y*this.shadowOrthoScale,I?W:h,I?h:W,K,this.sK().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,H){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,H),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,H),this)}transferToNodeMaterialEffect(K,H){return this.computeTransformedInformation()?(K.setFloat3(H,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(K.setFloat3(H,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(K){const H=this._scene.getEngine();return!H.useReverseDepthBuffer&&H.isNDCHalfZRange?0:1}getDepthMaxZ(K){const H=this._scene.getEngine();return H.useReverseDepthBuffer&&H.isNDCHalfZRange?0:1}prepareLightSpecificDefines(K,H){K["DIRLIGHT"+H]=!0}}(0,q.e)([(0,w.J)()],f.prototype,"shadowFrustumSize",null),(0,q.e)([(0,w.J)()],f.prototype,"shadowOrthoScale",null),(0,q.e)([(0,w.J)()],f.prototype,"autoUpdateExtends",void 0),(0,q.e)([(0,w.J)()],f.prototype,"autoCalcShadowZBounds",void 0),(0,q.e)([(0,w.J)("orthoLeft")],f.prototype,"_orthoLeft",void 0),(0,q.e)([(0,w.J)("orthoRight")],f.prototype,"_orthoRight",void 0),(0,q.e)([(0,w.J)("orthoTop")],f.prototype,"_orthoTop",void 0),(0,q.e)([(0,w.J)("orthoBottom")],f.prototype,"_orthoBottom",void 0),(0,I.f)("BABYLON.DirectionalLight",f)},13461:(K,H,M)=>{"use strict";M.d(H,{c:()=>f});var q=M(11274),w=M(11280),u=M(11290),y=M(11329),h=M(11704),W=M(11824),I=M(11242);h.d.AddNodeConstructor("Light_Type_3",((K,H)=>()=>new f(K,u.OH.Zero(),H)));class f extends W.e{constructor(K,H,M){super(K,M),this.groundColor=new y.CH(0,0,0),this.direction=H||u.OH.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"wf"}setDirectionToTarget(K){return this.direction=u.OH.Normalize(K.LH(u.OH.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(K,H){const M=u.OH.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",M.x,M.y,M.z,0,H),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Eh),H),this}transferToNodeMaterialEffect(K,H){const M=u.OH.Normalize(this.direction);return K.setFloat3(H,M.x,M.y,M.z),this}zh(){return this._worldMatrix||(this._worldMatrix=u.Matrix.Identity()),this._worldMatrix}getTypeID(){return W.e.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(K,H){K["HEMILIGHT"+H]=!0}}(0,q.e)([(0,w.j)()],f.prototype,"groundColor",void 0),(0,q.e)([(0,w.G)()],f.prototype,"direction",void 0),(0,I.f)("BABYLON.HemisphericLight",f)},12937:(K,H,M)=>{"use strict";M.d(H,{d:()=>z});var q=M(11274),w=M(11280),u=M(11290),y=M(11704),h=M(11824),W=M(11898),I=M(11267),f=M(11242);y.d.AddNodeConstructor("Light_Type_2",((K,H)=>()=>new z(K,u.OH.Zero(),u.OH.Zero(),0,0,H)));class z extends W.b{get iesProfileTexture(){return this._iesProfileTexture}set iesProfileTexture(K){this._iesProfileTexture!==K&&(this._iesProfileTexture=K,this._iesProfileTexture&&z._IsTexture(this._iesProfileTexture)&&this._iesProfileTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()})))}get angle(){return this._angle}set angle(K){this._angle=K,this._cosHalfAngle=Math.cos(.5*K),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(K){this._innerAngle=K,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(K){this._shadowAngleScale=K,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(K){this._projectionTextureLightNear=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(K){this._projectionTextureLightFar=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(K){this._projectionTextureUpDirection=K,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(K){this._projectionTexture!==K&&(this._projectionTexture=K,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(z._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):z._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(K){return void 0!==K.onGeneratedObservable}static _IsTexture(K){return void 0!==K.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(K){this._projectionTextureProjectionLightMatrix=K,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(K,H,M,q,w,y){super(K,y),this._innerAngle=0,this._iesProfileTexture=null,this._projectionTextureMatrix=u.Matrix.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=u.OH.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=u.OH.Zero(),this._projectionTextureViewLightMatrix=u.Matrix.Zero(),this._projectionTextureProjectionLightMatrix=u.Matrix.Zero(),this._projectionTextureScalingMatrix=u.Matrix.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=H,this.direction=M,this.angle=q,this.exponent=w}getClassName(){return"SpotLight"}getTypeID(){return h.e.LIGHTTYPEID_SPOTLIGHT}_setDirection(K){super._setDirection(K),this._projectionTextureViewLightDirty=!0}_setPosition(K){super._setPosition(K),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(K,H,M){const q=this.sK().activeCamera;if(!q)return;this._shadowAngleScale=this._shadowAngleScale||1;const w=this._shadowAngleScale*this._angle,y=void 0!==this.shadowMinZ?this.shadowMinZ:q.Ih,h=void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,W=this.sK().getEngine().useReverseDepthBuffer;u.Matrix.PerspectiveFovLHToRef(w,1,W?h:y,W?y:h,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,W)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),u.Matrix.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const K=this.projectionTextureLightFar,H=this.projectionTextureLightNear,M=K/(K-H),q=-M*H,w=1/Math.tan(this._angle/2);u.Matrix.FromValuesToRef(w/1,0,0,0,0,w,0,0,0,0,M,1,0,0,q,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof I.b){const K=this._projectionTexture.uScale/2,H=this._projectionTexture.vScale/2;u.Matrix.FromValuesToRef(K,0,0,0,0,H,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(K,H){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),K.setMatrix("textureProjectionMatrix"+H,this._projectionTextureMatrix),K.setTexture("projectionLightTexture"+H,this.projectionTexture)),this._iesProfileTexture&&this._iesProfileTexture.isReady()&&K.setTexture("iesLightTexture"+H,this._iesProfileTexture),this}transferToEffect(K,H){let M;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,H),M=u.OH.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,H),M=u.OH.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",M.x,M.y,M.z,this._cosHalfAngle,H),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,H),this}transferToNodeMaterialEffect(K,H){let M;return M=this.computeTransformedInformation()?u.OH.Normalize(this.transformedDirection):u.OH.Normalize(this.direction),this.sK().useRightHandedSystem?K.setFloat3(H,-M.x,-M.y,-M.z):K.setFloat3(H,M.x,M.y,M.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose(),this._iesProfileTexture&&(this._iesProfileTexture.dispose(),this._iesProfileTexture=null)}getDepthMinZ(K){const H=this._scene.getEngine(),M=void 0!==this.shadowMinZ?this.shadowMinZ:(null===K||void 0===K?void 0:K.Ih)??0;return H.useReverseDepthBuffer&&H.isNDCHalfZRange?M:this._scene.getEngine().isNDCHalfZRange?0:M}getDepthMaxZ(K){const H=this._scene.getEngine(),M=void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===K||void 0===K?void 0:K.maxZ)??1e4;return H.useReverseDepthBuffer&&H.isNDCHalfZRange?0:M}prepareLightSpecificDefines(K,H){K["SPOTLIGHT"+H]=!0,K["PROJECTEDLIGHTTEXTURE"+H]=!(!this.projectionTexture||!this.projectionTexture.isReady()),K["IESLIGHTTEXTURE"+H]=!(!this._iesProfileTexture||!this._iesProfileTexture.isReady())}}(0,q.e)([(0,w.J)()],z.prototype,"angle",null),(0,q.e)([(0,w.J)()],z.prototype,"innerAngle",null),(0,q.e)([(0,w.J)()],z.prototype,"shadowAngleScale",null),(0,q.e)([(0,w.J)()],z.prototype,"exponent",void 0),(0,q.e)([(0,w.J)()],z.prototype,"projectionTextureLightNear",null),(0,q.e)([(0,w.J)()],z.prototype,"projectionTextureLightFar",null),(0,q.e)([(0,w.J)()],z.prototype,"projectionTextureUpDirection",null),(0,q.e)([(0,w.z)("projectedLightTexture")],z.prototype,"_projectionTexture",void 0),(0,f.f)("BABYLON.SpotLight",z)},12678:(K,H,M)=>{"use strict";M.d(H,{e:()=>y,f:()=>u,h:()=>h});const q={},w={};function u(K,H){q[K]=H}function y(K,H){w[K]=H}function h(K){return w[K]?w[K]:null}},12587:(K,H,M)=>{"use strict";M.d(H,{d:()=>l,f:()=>J});var q,w=M(11100),u=M(11102),y=M(11522),h=M(11143),W=M(11112),I=M(11746),f=M(11152),z=M(11159),G=M(11250),a=M(11180),v=M(11135);!function(K){K[K.Clean=0]="Clean",K[K.Stop=1]="Stop",K[K.Sync=2]="Sync",K[K.NoSync=3]="NoSync"}(q||(q={}));const O=new u.d,L={};let S=!1;function B(){return L[".babylon"]}function C(K,H){const M=L[K];return M||(W.e.Warn("Unable to find a plugin to load "+K+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),H?B():void 0)}function i(K,H,M){let q="Unable to load from "+(K.rawData?"binary data":K.url);return H?q+=`: ${H}`:M&&(q+=`: ${M}`),q}async function Z(K,H,M,q,w,u,y,h,W){var I;const z="data:"===(G=K.url).substring(0,5)?G.substring(5):null;var G;if(K.rawData&&!y)throw"When using ArrayBufferView to load data the file extension must be provided.";const S=z||y?"":function(K){const H=K.indexOf("?");-1!==H&&(K=K.substring(0,H));const M=K.lastIndexOf(".");return K.substring(M,K.length).toLowerCase()}(K.url);let i=y?C(y,!0):z?function(K){for(const H in L){const M=L[H].plugin;if(M.canDirectLoad&&M.canDirectLoad(K))return L[H]}return B()}(K.url):C(S,!1);if(!i&&S){if(K.url&&!K.url.startsWith("blob:")){const H=await async function(K,H){const M=H.method||"GET";return await new Promise(((q,w)=>{const u=new v.c;u.addEventListener("readystatechange",(()=>{if(4==u.readyState)if(200==u.status){const K={};if(H.responseHeaders)for(const M of H.responseHeaders)K[M]=u.getResponseHeader(M)||"";q({response:u.response,headerValues:K})}else w(`Unable to fetch data from ${K}. Error code: ${u.status}`)})),u.open(M,K),u.send()}))}(K.url,{method:"HEAD",responseHeaders:["Content-Type"]}),M=H.headerValues?H.headerValues["Content-Type"]:"";M&&(i=function(K){for(const H in L){const M=L[H];if(M.mimeType===K)return M}}(M))}i||(i=B())}if(!i)throw new Error(`No plugin or fallback for ${y??K.url}`);if(!1===(null===W||void 0===W||null===(I=W[i.plugin.name])||void 0===I?void 0:I.enabled))throw new Error(`The '${i.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(K.rawData&&!i.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(K=>{if(i.plugin.createPlugin){const H=i.plugin.createPlugin(W??{});return H instanceof Promise?(H.then(K).catch((K=>{w("Error instantiating plugin.",K)})),null):(K(H),H)}return K(i.plugin),i.plugin})((W=>{var I;if(!W)throw`The loader plugin corresponding to the '${y}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(O.notifyObservers(W),z&&(W.canDirectLoad&&W.canDirectLoad(K.url)||!(0,f.j)(K.url))){if(W.directLoad){const K=W.directLoad(H,z);K instanceof Promise?K.then((K=>{M(W,K)})).catch((K=>{w("Error in directLoad of _loadData: "+K,K)})):M(W,K)}else M(W,z);return}const G=i.isBinary,v=(K,q)=>{H.W?w("Scene has been disposed"):M(W,K,q)};let L=null,S=!1;null===(I=W.Hh)||void 0===I||I.add((()=>{S=!0,L&&(L.abort(),L=null),u()}));const B=()=>{if(S)return;const M=(K,H)=>{w(null===K||void 0===K?void 0:K.statusText,H)};if(!W.loadFile&&K.rawData)throw"Plugin does not support loading ArrayBufferView.";L=W.loadFile?W.loadFile(H,K.rawData||K.file||K.url,K.rootUrl,v,q,G,M,h):H._loadFile(K.file||K.url,v,q,!0,G,M)},C=H.getEngine();let Z=C.enableOfflineSupport;if(Z){let M=!1;for(const q of H.disableOfflineSupportExceptionRules)if(q.test(K.url)){M=!0;break}Z=!M}Z&&a.b.OfflineProviderFactory?H.offlineProvider=a.b.OfflineProviderFactory(K.url,B,C.disableManifestCheck):B()}))}function E(K,H){let M,q,u=null,y=null;if(H)if(H.name)M=`file:${H.name}`,q=H.name,u=H;else if(ArrayBuffer.isView(H))M="",q=(0,G.c)(),y=H;else if(H.startsWith("data:"))M=H,q="";else if(K){const u=H;if("/"===u.substring(0,1))return w.Tools.Error("Wrong sceneFilename parameter"),null;M=K+u,q=u}else M=H,q=w.Tools.GetFilename(H),K=w.Tools.GetFolderPath(H);else M=K,q=w.Tools.GetFilename(K),K=w.Tools.GetFolderPath(K);return{url:M,rootUrl:K,name:q,file:u,rawData:y}}function l(K){if("string"===typeof K.extensions){const H=K.extensions;L[H.toLowerCase()]={plugin:K,isBinary:!1}}else{const H=K.extensions,M=Object.keys(H);for(const q of M)L[q.toLowerCase()]={plugin:K,isBinary:H[q].isBinary,mimeType:H[q].mimeType}}}async function s(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h.b.LastCreatedScene,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",G=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!q)return W.e.Error("No scene available to import mesh to"),null;const a=E(H,M);if(!a)return null;const v={};q.addPendingData(v);const O=()=>{q.removePendingData(v)},L=(K,H)=>{const M=i(a,K,H);y?y(q,M,new z.e(M,z.c.SceneLoaderError,H)):W.e.Error(M),O()},S=u?K=>{try{u(K)}catch(H){L("Error in onProgress callback: "+H,H)}}:void 0,B=(K,H,M,u,y,h,W,I)=>{if(q.importedMeshesFiles.push(a.url),w)try{w(K,H,M,u,y,h,W,I)}catch(f){L("Error in onSuccess callback: "+f,f)}q.removePendingData(v)};return await Z(a,q,((H,M,w)=>{if(H.rewriteRootURL&&(a.rootUrl=H.rewriteRootURL(a.rootUrl,w)),H.importMesh){const w=[],u=[],y=[];if(!H.importMesh(K,q,M,a.rootUrl,w,u,y,L))return;q.loadingPluginName=H.name,B(w,u,y,[],[],[],[],[])}else{H.importMeshAsync(K,q,M,a.rootUrl,S,a.name).then((K=>{q.loadingPluginName=H.name,B(K.meshes,K.CG,K.skeletons,K.animationGroups,K.transformNodes,K.geometries,K.lights,K.spriteManagers)})).catch((K=>{L(K.message,K)}))}}),S,L,O,I,f,G)}async function D(K,H,M,q,w,u,y,h){return await new Promise(((W,I)=>{try{s(K,H,M,q,((K,H,M,q,w,u,y,h)=>{W({meshes:K,CG:H,skeletons:M,animationGroups:q,transformNodes:w,geometries:u,lights:y,spriteManagers:h})}),w,((K,H,M)=>{I(M||new Error(H))}),u,y,h).catch(I)}catch(z){I(z)}}))}async function V(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.b.LastCreatedEngine,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};M?await c(K,H,new y.b(M),q,u,W,I,f,z):w.Tools.Error("No engine available")}async function n(K,H,M,q,w,u,y){return await new Promise(((h,W)=>{V(K,H,M,(K=>{h(K)}),q,((K,H,M)=>{W(M||new Error(H))}),w,u,y)}))}async function c(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.b.LastCreatedScene,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",G=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!M)return W.e.Error("No scene available to append to"),null;const a=E(K,H);if(!a)return null;const v={};M.addPendingData(v);const O=()=>{M.removePendingData(v)};I.e.ShowLoadingScreen&&!S&&(S=!0,M.getEngine().displayLoadingUI(),M.executeWhenReady((()=>{M.getEngine().hideLoadingUI(),S=!1})));const L=(K,H)=>{const q=i(a,K,H);u?u(M,q,new z.e(q,z.c.SceneLoaderError,H)):W.e.Error(q),O()},B=w?K=>{try{w(K)}catch(H){L("Error in onProgress callback",H)}}:void 0,C=()=>{if(q)try{q(M)}catch(K){L("Error in onSuccess callback",K)}M.removePendingData(v)};return await Z(a,M,((K,H)=>{if(K.load){if(!K.load(M,H,a.rootUrl,L))return;M.loadingPluginName=K.name,C()}else{K.loadAsync(M,H,a.rootUrl,B,a.name).then((()=>{M.loadingPluginName=K.name,C()})).catch((K=>{L(K.message,K)}))}}),B,L,O,y,f,G)}async function k(K,H,M,q,w,u,y){return await new Promise(((h,W)=>{try{c(K,H,M,(K=>{h(K)}),q,((K,H,M)=>{W(M||new Error(H))}),w,u,y).catch(W)}catch(z){W(z)}}))}async function T(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.b.LastCreatedScene,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!M)return W.e.Error("No scene available to load asset container to"),null;const G=E(K,H);if(!G)return null;const a={};M.addPendingData(a);const v=()=>{M.removePendingData(a)},O=(K,H)=>{const q=i(G,K,H);u?u(M,q,new z.e(q,z.c.SceneLoaderError,H)):W.e.Error(q),v()},L=w?K=>{try{w(K)}catch(H){O("Error in onProgress callback",H)}}:void 0,S=K=>{if(q)try{q(K)}catch(H){O("Error in onSuccess callback",H)}M.removePendingData(a)};return await Z(G,M,((K,H)=>{if(K.loadAssetContainer){const q=K.loadAssetContainer(M,H,G.rootUrl,O);if(!q)return;q.populateRootNodes(),M.loadingPluginName=K.name,S(q)}else if(K.loadAssetContainerAsync){K.loadAssetContainerAsync(M,H,G.rootUrl,L,G.name).then((H=>{H.populateRootNodes(),M.loadingPluginName=K.name,S(H)})).catch((K=>{O(K.message,K)}))}else O("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),L,O,v,y,I,f)}async function d(K,H,M,q,w,u,y){return await new Promise(((h,W)=>{try{T(K,H,M,(K=>{h(K)}),q,((K,H,M)=>{W(M||new Error(H))}),w,u,y).catch(W)}catch(z){W(z)}}))}async function x(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.b.LastCreatedScene,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,I=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,z=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,G=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!M)return void W.e.Error("No scene available to load animations to");if(q){for(const q of M.animatables)q.reset();M.stopAllAnimations();const K=M.animationGroups.slice();for(const M of K)M.dispose();const H=M.getNodes();for(const M of H)M.animations&&(M.animations=[])}else switch(w){case 0:const K=M.animationGroups.slice();for(const H of K)H.dispose();break;case 1:for(const H of M.animationGroups)H.stop();break;case 2:for(const H of M.animationGroups)H.reset(),H.restart();break;case 3:break;default:return void W.e.Error("Unknown animation group loading mode value '"+w+"'")}const v=M.animatables.length;await T(K,H,M,(K=>{K.mergeAnimationsTo(M,M.animatables.slice(v),u),K.dispose(),M.onAnimationFileImportedObservable.notifyObservers(M),y&&y(M)}),I,f,z,G,a)}async function Q(K,H,M,q,w,u,y,h,W,I){return await new Promise(((f,G)=>{try{x(K,H,M,q,w,u,(K=>{f(K)}),y,((K,H,M)=>{G(M||new Error(H))}),h,W,I).catch(G)}catch(z){G(z)}}))}class J{static get ForceFullSceneLoadingForIncremental(){return I.e.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(K){I.e.ForceFullSceneLoadingForIncremental=K}static get ShowLoadingScreen(){return I.e.ShowLoadingScreen}static set ShowLoadingScreen(K){I.e.ShowLoadingScreen=K}static get loggingLevel(){return I.e.loggingLevel}static set loggingLevel(K){I.e.loggingLevel=K}static get CleanBoneMatrixWeights(){return I.e.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(K){I.e.CleanBoneMatrixWeights=K}static GetDefaultPlugin(){return B()}static GetPluginForExtension(K){var H;return null===(H=C(K,!0))||void 0===H?void 0:H.plugin}static IsPluginForExtensionAvailable(K){return function(K){return!!L[K]}(K)}static RegisterPlugin(K){l(K)}static ImportMesh(K,H,M,q,w,u,y,W,I){s(K,H,M,q,w,u,y,W,I).catch((K=>null===y||void 0===y?void 0:y(h.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async ImportMeshAsync(K,H,M,q,w,u,y){return await D(K,H,M,q,w,u,y)}static Load(K,H,M,q,w,u,y,W){V(K,H,M,q,w,u,y,W).catch((K=>null===u||void 0===u?void 0:u(h.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async LoadAsync(K,H,M,q,w,u){return await n(K,H,M,q,w,u)}static Append(K,H,M,q,w,u,y,W){c(K,H,M,q,w,u,y,W).catch((K=>null===u||void 0===u?void 0:u(M??h.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async AppendAsync(K,H,M,q,w,u){return await k(K,H,M,q,w,u)}static LoadAssetContainer(K,H,M,q,w,u,y,W){T(K,H,M,q,w,u,y,W).catch((K=>null===u||void 0===u?void 0:u(M??h.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async LoadAssetContainerAsync(K,H,M,q,w,u){return await d(K,H,M,q,w,u)}static ImportAnimations(K,H,M,q,w,u,y,W,I,f,z){x(K,H,M,q,w,u,y,W,I,f,z).catch((K=>null===I||void 0===I?void 0:I(M??h.b.LastCreatedScene,null===K||void 0===K?void 0:K.message,K)))}static async ImportAnimationsAsync(K,H,M,q,w,u,y,h,W,I,f){return await Q(K,H,M,q,w,u,h,I,f)}}J.NO_LOGGING=0,J.MINIMAL_LOGGING=1,J.SUMMARY_LOGGING=2,J.DETAILED_LOGGING=3,J.OnPluginActivatedObservable=O},12958:(K,H,M)=>{"use strict";M.d(H,{b:()=>G});var q=M(11274),w=M(11280),u=M(11100),y=M(11290),h=M(11309),W=M(11267),I=M(11242),f=M(11102),z=M(11325);M(12967);class G extends h.b{set boundingBoxSize(K){if(this._boundingBoxSize&&this._boundingBoxSize.equals(K))return;this._boundingBoxSize=K;const H=this.sK();H&&H.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(K){this._rotationY=K,this.setReflectionTextureMatrix(y.Matrix.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(K,H,M){let q="";for(const w of K)q+=w;return new G(q,H,null,M,K)}static CreateFromPrefilteredData(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const w=H.useDelayedTextureLoading;H.useDelayedTextureLoading=!1;const u=new G(K,H,null,!1,null,null,null,void 0,!0,M,q);return H.useDelayedTextureLoading=w,u}constructor(K,H){var M;let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,I=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,G=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,v=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,L=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,S=arguments.length>13?arguments[13]:void 0,B=arguments.length>14?arguments[14]:void 0;super(H),this.onLoadObservable=new f.d,this.boundingBoxPosition=y.OH.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new y.Matrix,this._buffer=null,this.name=K,this.url=K,this._noMipmap=w,this.Wh=!1,this.isCube=!0,this._textureMatrix=y.Matrix.Identity(),this.coordinatesMode=W.b.CUBIC_MODE;let C=null,i=null;null===q||Array.isArray(q)?(this._noMipmap=w,this._format=z,this._createPolynomials=v,C=q,this._loaderOptions=S,this._useSRGBBuffer=B,this._lodScale=O,this._lodOffset=L):(C=q.extensions??null,this._noMipmap=q.noMipmap??!1,u=q.files??null,i=q.buffer??null,this._format=q.format??5,G=q.prefiltered??!1,a=q.forcedExtension??null,this._createPolynomials=q.createPolynomials??!1,this._lodScale=q.lodScale??.8,this._lodOffset=q.lodOffset??0,this._loaderOptions=q.loaderOptions,this._useSRGBBuffer=q.useSRGBBuffer,h=q.P??null,I=q.onError??null),(K||u)&&this.updateURL(K,a,h,G,I,C,null===(M=this.sK())||void 0===M?void 0:M.useDelayedTextureLoading,u,i)}getClassName(){return"CubeTexture"}updateURL(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=K),this.url=K,H&&(this._forcedExtension=H);const I=K.lastIndexOf("."),f=H||(I>-1?K.substring(I).toLowerCase():""),z=0===f.indexOf(".dds"),G=0===f.indexOf(".env"),a=0===f.indexOf(".basis");if(G?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=q,q&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),h)this._files=h;else if(a||G||z||u||(u=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,u){for(let H=0;H<u.length;H++)this._files.push(K+u[H]);this._extensions=u}this._buffer=W,y?(this.delayLoadState=4,this._delayedOnLoad=M,this._delayedOnError=w):this._loadTexture(M,w)}delayLoad(K){4===this.delayLoadState&&(K&&(this._forcedExtension=K),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(K){var H,M;if(K.updateFlag===this._textureMatrix.updateFlag)return;K.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(M=this.sK())||void 0===M||M.markAllMaterialsAsDirty(1,(K=>-1!==K.getActiveTextures().indexOf(this))));if(this._textureMatrix=K,null===(H=this.sK())||void 0===H||!H.useRightHandedSystem)return;const q=y.TmpVectors.OH[0],w=y.TmpVectors.Quaternion[0],u=y.TmpVectors.OH[1];this._textureMatrix.decompose(q,w,u),w.z*=-1,w.w*=-1,y.Matrix.ComposeToRef(q,w,u,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var K;return null!==(K=this.sK())&&void 0!==K&&K.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=this.sK(),q=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const w=()=>{var H;(this.onLoadObservable.notifyObservers(this),q)&&(q.dispose(),null===(H=this.sK())||void 0===H||H.markAllMaterialsAsDirty(1));K&&K()},y=(K,M)=>{this._loadingError=!0,this._errorObject={message:K,exception:M},H&&H(K,M),W.b.OnTextureLoadErrorObservable.notifyObservers(this)};var h;this._texture?this._texture.isReady?u.Tools.SetImmediate((()=>w())):this._texture.onLoadedObservable.add((()=>w())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,M,this._lodScale,this._lodOffset,K,y,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,M,this._files,this._noMipmap,K,y,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(h=this._texture)||void 0===h||h.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(K,H,M){const q=z.c.Parse((()=>{let q=!1;return K.prefiltered&&(q=K.prefiltered),new G(M+(K.url??K.name),H,K.extensions,!1,K.files||null,null,null,void 0,q,K.forcedExtension)}),K,H);if(K.boundingBoxPosition&&(q.boundingBoxPosition=y.OH.iH(K.boundingBoxPosition)),K.boundingBoxSize&&(q.boundingBoxSize=y.OH.iH(K.boundingBoxSize)),K.animations)for(let w=0;w<K.animations.length;w++){const H=K.animations[w],M=(0,I.b)("BABYLON.Animation");M&&q.animations.push(M.Parse(H))}return q}clone(){let K=0;const H=z.c.Clone((()=>{const H=new G(this.url,this.sK()||this._getEngine(),this._extensions,this._noMipmap,this._files);return K=H.uniqueId,H}),this);return H.uniqueId=K,H}}(0,q.e)([(0,w.J)()],G.prototype,"url",void 0),(0,q.e)([(0,w.G)()],G.prototype,"boundingBoxPosition",void 0),(0,q.e)([(0,w.G)()],G.prototype,"boundingBoxSize",null),(0,q.e)([(0,w.J)("rotationY")],G.prototype,"rotationY",null),(0,q.e)([(0,w.J)("files")],G.prototype,"_files",void 0),(0,q.e)([(0,w.J)("forcedExtension")],G.prototype,"_forcedExtension",void 0),(0,q.e)([(0,w.J)("extensions")],G.prototype,"_extensions",void 0),(0,q.e)([(0,w.v)("textureMatrix")],G.prototype,"_textureMatrix",void 0),(0,q.e)([(0,w.v)("textureMatrixRefraction")],G.prototype,"_textureMatrixRefraction",void 0),W.b._CubeTextureParser=G.Parse,(0,I.f)("BABYLON.CubeTexture",G)},13469:(K,H,M)=>{"use strict";M.d(H,{e:()=>W});var q=M(11112),w=M(11267),u=M(11257),y=M(11415),h=M(11216);y.ThinEngine.prototype.createDynamicTexture=function(K,H,M,q){const w=new h.d(this,4);return w.baseWidth=K,w.baseHeight=H,M&&(K=this.needPOTTextures?(0,u.e)(K,this._caps.maxTextureSize):K,H=this.needPOTTextures?(0,u.e)(H,this._caps.maxTextureSize):H),w.width=K,w.height=H,w.isReady=!1,w.generateMipMaps=M,w.samplingMode=q,this.updateTextureSamplingMode(q,w),this._internalTexturesCache.push(w),w},y.ThinEngine.prototype.updateDynamicTexture=function(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!K)return;const y=this._gl,h=y.TEXTURE_2D,W=this._bindTextureDirectly(h,K,!0,u);this._unpackFlipY(void 0===M?K.invertY:M),q&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const I=this._getWebGLTextureType(K.type),f=this._getInternalFormat(w||K.format),z=this._getRGBABufferInternalSizedFormat(K.type,f);y.texImage2D(h,0,z,f,I,H),K.generateMipMaps&&y.generateMipmap(h),W||this._bindTextureDirectly(h,null),q&&y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),w&&(K.format=w),K._dynamicTextureSource=H,K._premulAlpha=q,K.invertY=M||!1,K.isReady=!0};class W extends w.b{constructor(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,h=arguments.length>6?arguments[6]:void 0;const W=!M||M._isScene;super(null,W?M:null===M||void 0===M?void 0:M.SH,W?!q:M,h,u,void 0,void 0,void 0,void 0,y),this.name=K,this.wrapU=w.b.CLAMP_ADDRESSMODE,this.wrapV=w.b.CLAMP_ADDRESSMODE,this._generateMipMaps=q;const I=this._getEngine();if(!I)return;if(H.getContext)this._canvas=H,this._ownCanvas=!1,this._texture=I.createDynamicTexture(this._canvas.width,this._canvas.height,q,u);else{this._canvas=I.createCanvas(1,1),this._ownCanvas=!0;const K=H;K.width||0===K.width?this._texture=I.createDynamicTexture(K.width,K.height,q,u):this._texture=I.createDynamicTexture(H,H,q,u)}const f=this.getSize();this._canvas.width!==f.width&&(this._canvas.width=f.width),this._canvas.height!==f.height&&(this._canvas.height=f.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(K){this._canvas.width=K.width,this._canvas.height=K.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(K.width,K.height,this._generateMipMaps,this.samplingMode)}scale(K){const H=this.getSize();H.width*=K,H.height*=K,this._recreate(H)}scaleTo(K,H){const M=this.getSize();M.width=K,M.height=H,this._recreate(M)}getContext(){return this._context}clear(K){const H=this.getSize();K&&(this._context.fillStyle=K),this._context.clearRect(0,0,H.width,H.height)}update(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._texture&&this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===K||K,H,this._format||void 0,void 0,M)}drawText(K,H,M,q,w,u,y){let h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const W=this.getSize();if(u&&(this._context.fillStyle=u,this._context.fillRect(0,0,W.width,W.height)),this._context.font=q,null===H||void 0===H){const M=this._context.measureText(K);H=(W.width-M.width)/2}if(null===M||void 0===M){const K=parseInt(q.replace(/\D/g,""));M=W.height/2+K/3.65}this._context.fillStyle=w||"",this._context.fillText(K,H,M),h&&this.update(y)}dispose(){var K,H;(super.dispose(),this._ownCanvas)&&(null===(K=this._canvas)||void 0===K||null===(H=K.remove)||void 0===H||H.call(K));this._canvas=null,this._context=null}clone(){const K=this.sK();if(!K)return this;const H=this.getSize(),M=new W(this.name,H,K,this._generateMipMaps);return M.Wh=this.Wh,M.level=this.level,M.wrapU=this.wrapU,M.wrapV=this.wrapV,M}serialize(){const K=this.sK();K&&!K.isReady()&&q.e.Warn("The scene must be ready before serializing the dynamic texture");const H=super.serialize();return W._IsCanvasElement(this._canvas)&&(H.base64String=this._canvas.toDataURL()),H.invertY=this._invertY,H.samplingMode=this.samplingMode,H}static _IsCanvasElement(K){return void 0!==K.toDataURL}_rebuild(){this.update()}}},12874:(K,H,M)=>{"use strict";M.d(H,{c:()=>w});var q=M(11267);class w extends q.b{get depth(){return this._depth}constructor(K,H,M,w,u,y){let h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7],I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:q.b.TRILINEAR_SAMPLINGMODE,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,z=arguments.length>10?arguments[10]:void 0;super(null,y,!h,W),this.format=u,this._texture=y.getEngine().createRawTexture2DArray(K,H,M,w,u,h,W,I,null,f,z),this._depth=w,this.is2DArray=!0}update(K){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,K,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(K,H,M,q,u){return new w(K,H,M,q,5,u,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},12693:(K,H,M)=>{"use strict";M.d(H,{e:()=>h,h:()=>W,k:()=>u,l:()=>y});var q=M(11307),w=M(11290);function u(K,H){return`{X: ${K.x.toFixed(H)} Y: ${K.y.toFixed(H)}}`}function y(K,H){return`{X: ${K._x.toFixed(H)} Y: ${K._y.toFixed(H)} Z: ${K._z.toFixed(H)}}`}function h(K,H){return 2*Math.acos((0,q.Clamp)(w.Quaternion.Dot(K,H)))}function W(K,H){const M=new w.Quaternion;return function(K,H,M){const u=w.OH.Cross(K,H),y=Math.acos((0,q.Clamp)(w.OH.Dot(K,H),-1,1));w.Quaternion.RotationAxisToRef(u,y,M)}(K,H,M),M}},12533:(K,H,M)=>{"use strict";M.d(H,{e:()=>I});var q=M(11290),w=M(11329),u=M(11726),y=M(11714),h=M(11340);M(12538);function W(K){let H=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const M=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],u=[];let W=[];const I=K.width||K.size||1,f=K.height||K.size||1,z=K.depth||K.size||1,G=K.wrap||!1;let a=void 0===K.topBaseAt?1:K.topBaseAt,v=void 0===K.bottomBaseAt?0:K.bottomBaseAt;a=(a+4)%4,v=(v+4)%4;let O=[2,0,3,1][a],L=[2,0,1,3][v],S=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(G){H=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],S=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let K=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],M=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const q=[17,18,19,16],w=[22,23,20,21];for(;O>0;)K.unshift(K.pop()),q.unshift(q.pop()),O--;for(;L>0;)M.unshift(M.pop()),w.unshift(w.pop()),L--;K=K.flat(),M=M.flat(),S=S.concat(K).concat(M),H.push(q[0],q[2],q[3],q[0],q[1],q[2]),H.push(w[0],w[2],w[3],w[0],w[1],w[2])}const B=[I/2,f/2,z/2];W=S.reduce(((K,H,M)=>K.concat(H*B[M%3])),[]);const C=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE,i=K.faceUV||new Array(6),Z=K.faceColors,E=[];for(let y=0;y<6;y++)void 0===i[y]&&(i[y]=new q.Vector4(0,0,1,1)),Z&&void 0===Z[y]&&(Z[y]=new w.Ch(1,1,1,1));for(let q=0;q<6;q++)if(u.push(i[q].z,h.b?1-i[q].w:i[q].w),u.push(i[q].x,h.b?1-i[q].w:i[q].w),u.push(i[q].x,h.b?1-i[q].y:i[q].y),u.push(i[q].z,h.b?1-i[q].y:i[q].y),Z)for(let K=0;K<4;K++)E.push(Z[q].r,Z[q].g,Z[q].b,Z[q].a);y.d._ComputeSides(C,W,H,M,u,K.frontUVs,K.backUVs);const l=new y.d;if(l.indices=H,l.VK=W,l.nK=M,l.kK=u,Z){const K=C===y.d.DOUBLESIDE?E.concat(E):E;l.cK=K}return l}function I(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new u.b(K,M);H.sideOrientation=u.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return W(H).dK(q,H.updatable),q}y.d.CreateBox=W,u.b.CreateBox=function(K,H){return I(K,{size:H,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},12681:(K,H,M)=>{"use strict";M.d(H,{e:()=>h});var q=M(11726),w=M(11714),u=M(11340);function y(K){const H=[],M=[],q=[],y=[],h=K.radius||.5,W=K.tessellation||64,I=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,f=0===K.sideOrientation?0:K.sideOrientation||w.d.DEFAULTSIDE;H.push(0,0,0),y.push(.5,.5);const z=2*Math.PI*I,G=1===I?z/W:z/(W-1);let a=0;for(let w=0;w<W;w++){const K=Math.cos(a),M=Math.sin(a),q=(K+1)/2,w=(1-M)/2;H.push(h*K,h*M,0),y.push(q,u.b?1-w:w),a+=G}1===I&&(H.push(H[3],H[4],H[5]),y.push(y[2],u.b?1-y[3]:y[3]));const v=H.length/3;for(let w=1;w<v-1;w++)M.push(w+1,0,w);w.d.ComputeNormals(H,M,q),w.d._ComputeSides(f,H,M,q,y,K.frontUVs,K.backUVs);const O=new w.d;return O.indices=M,O.VK=H,O.nK=q,O.kK=y,O}function h(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new q.b(K,M);H.sideOrientation=q.b._GetDefaultSideOrientation(H.sideOrientation),w._originalBuilderSideOrientation=H.sideOrientation;return y(H).dK(w,H.updatable),w}w.d.CreateDisc=y,q.b.CreateDisc=function(K,H,M){return h(K,{radius:H,tessellation:M,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},12538:(K,H,M)=>{"use strict";M.d(H,{e:()=>L,c:()=>B,i:()=>S});var q=M(11290),w=M(11329),u=M(11726),y=M(11714),h=M(11366);u.b._GroundMeshParser=(K,H)=>W.Parse(K,H);class W extends u.b{constructor(K,H){super(K,H),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=K,this._subdivisionsY=K,this.subdivide(K);const M=this;M.createOrUpdateSubmeshesOctree&&M.createOrUpdateSubmeshesOctree(H)}getHeightAtCoordinates(K,H){const M=this.getWorldMatrix(),w=q.TmpVectors.Matrix[5];M.invertToRef(w);const u=q.TmpVectors.OH[8];if(q.OH.TransformCoordinatesFromFloatsToRef(K,0,H,w,u),K=u.x,H=u.z,K<this._minX||K>=this._maxX||H<=this._minZ||H>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const y=this._getFacetAt(K,H),h=-(y.x*K+y.z*H+y.w)/y.y;return q.OH.TransformCoordinatesFromFloatsToRef(0,h,0,M,u),u.y}getNormalAtCoordinates(K,H){const M=new q.OH(0,1,0);return this.getNormalAtCoordinatesToRef(K,H,M),M}getNormalAtCoordinatesToRef(K,H,M){const w=this.getWorldMatrix(),u=q.TmpVectors.Matrix[5];w.invertToRef(u);const y=q.TmpVectors.OH[8];if(q.OH.TransformCoordinatesFromFloatsToRef(K,0,H,u,y),K=y.x,H=y.z,K<this._minX||K>this._maxX||H<this._minZ||H>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const h=this._getFacetAt(K,H);return q.OH.TransformNormalFromFloatsToRef(h.x,h.y,h.z,w,M),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(K,H){const M=Math.floor((K+this._maxX)*this._subdivisionsX/this._width),q=Math.floor(-(H+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),w=this._heightQuads[q*this._subdivisionsX+M];let u;return u=H<w.slope.x*K+w.slope.y?w.facet1:w.facet2,u}_initHeightQuads(){const K=this._subdivisionsX,H=this._subdivisionsY;this._heightQuads=[];for(let M=0;M<H;M++)for(let H=0;H<K;H++){const w={slope:q.Vector2.Zero(),facet1:new q.Vector4(0,0,0,0),facet2:new q.Vector4(0,0,0,0)};this._heightQuads[M*K+H]=w}return this}_computeHeightQuads(){const K=this.getVerticesData(h.d.PositionKind);if(!K)return this;const H=q.TmpVectors.OH[3],M=q.TmpVectors.OH[2],w=q.TmpVectors.OH[1],u=q.TmpVectors.OH[0],y=q.TmpVectors.OH[4],W=q.TmpVectors.OH[5],I=q.TmpVectors.OH[6],f=q.TmpVectors.OH[7],z=q.TmpVectors.OH[8];let G=0,a=0,v=0,O=0,L=0,S=0,B=0;const C=this._subdivisionsX,i=this._subdivisionsY;for(let h=0;h<i;h++)for(let i=0;i<C;i++){G=3*i,a=h*(C+1)*3,v=(h+1)*(C+1)*3,H.x=K[a+G],H.y=K[a+G+1],H.z=K[a+G+2],M.x=K[a+G+3],M.y=K[a+G+4],M.z=K[a+G+5],w.x=K[v+G],w.y=K[v+G+1],w.z=K[v+G+2],u.x=K[v+G+3],u.y=K[v+G+4],u.z=K[v+G+5],O=(u.z-H.z)/(u.x-H.x),L=H.z-O*H.x,M.subtractToRef(H,y),w.subtractToRef(H,W),u.subtractToRef(H,I),q.OH.CrossToRef(I,W,f),q.OH.CrossToRef(y,I,z),f.normalize(),z.normalize(),S=-(f.x*H.x+f.y*H.y+f.z*H.z),B=-(z.x*M.x+z.y*M.y+z.z*M.z);const Z=this._heightQuads[h*C+i];Z.slope.Lh(O,L),Z.facet1.Lh(f.x,f.y,f.z,S),Z.facet2.Lh(z.x,z.y,z.z,B)}return this}serialize(K){super.serialize(K),K.subdivisionsX=this._subdivisionsX,K.subdivisionsY=this._subdivisionsY,K.minX=this._minX,K.maxX=this._maxX,K.Ih=this._minZ,K.maxZ=this._maxZ,K.width=this._width,K.height=this._height}static Parse(K,H){const M=new W(K.name,H);return M._subdivisionsX=K.subdivisionsX||1,M._subdivisionsY=K.subdivisionsY||1,M._minX=K.minX,M._maxX=K.maxX,M._minZ=K.Ih,M._maxZ=K.maxZ,M._width=K.width,M._height=K.height,M}}var I=M(11100),f=M(11143),z=M(11297),G=M(11340);function a(K){const H=[],M=[],w=[],u=[];let h,W;const I=K.width||K.size||1,f=K.height||K.size||1,z=0|(K.subdivisionsX||K.subdivisions||1),a=0|(K.subdivisionsY||K.subdivisions||1);for(h=0;h<=a;h++)for(W=0;W<=z;W++){const K=new q.OH(W*I/z-I/2,0,(a-h)*f/a-f/2),H=new q.OH(0,1,0);M.push(K.x,K.y,K.z),w.push(H.x,H.y,H.z),u.push(W/z,G.b?h/a:1-h/a)}for(h=0;h<a;h++)for(W=0;W<z;W++)H.push(W+1+(h+1)*(z+1)),H.push(W+1+h*(z+1)),H.push(W+h*(z+1)),H.push(W+(h+1)*(z+1)),H.push(W+1+(h+1)*(z+1)),H.push(W+h*(z+1));const v=new y.d;return v.indices=H,v.VK=M,v.nK=w,v.kK=u,v}function v(K){const H=void 0!==K.xmin&&null!==K.xmin?K.xmin:-1,M=void 0!==K.zmin&&null!==K.zmin?K.zmin:-1,w=void 0!==K.xmax&&null!==K.xmax?K.xmax:1,u=void 0!==K.zmax&&null!==K.zmax?K.zmax:1,h=K.subdivisions||{w:1,h:1},W=K.precision||{w:1,h:1},I=[],f=[],z=[],G=[];let a,v,O,L;h.h=h.h<1?1:h.h,h.w=h.w<1?1:h.w,W.w=W.w<1?1:W.w,W.h=W.h<1?1:W.h;const S=(w-H)/h.w,B=(u-M)/h.h;function C(K,H,M,w){const u=f.length/3,y=W.w+1;for(a=0;a<W.h;a++)for(v=0;v<W.w;v++){const K=[u+v+a*y,u+(v+1)+a*y,u+(v+1)+(a+1)*y,u+v+(a+1)*y];I.push(K[1]),I.push(K[2]),I.push(K[3]),I.push(K[0]),I.push(K[1]),I.push(K[3])}const h=q.OH.Zero(),O=new q.OH(0,1,0);for(a=0;a<=W.h;a++)for(h.z=a*(w-H)/W.h+H,v=0;v<=W.w;v++)h.x=v*(M-K)/W.w+K,h.y=0,f.push(h.x,h.y,h.z),z.push(O.x,O.y,O.z),G.push(v/W.w,a/W.h)}for(O=0;O<h.h;O++)for(L=0;L<h.w;L++)C(H+L*S,M+O*B,H+(L+1)*S,M+(O+1)*B);const i=new y.d;return i.indices=I,i.VK=f,i.nK=z,i.kK=G,i}function O(K){const H=[],M=[],u=[],h=[];let W,I;const f=K.colorFilter||new w.CH(.3,.59,.11),G=K.alphaFilter||0;let a=!1;if(K.minHeight>K.maxHeight){a=!0;const H=K.maxHeight;K.maxHeight=K.minHeight,K.minHeight=H}for(W=0;W<=K.subdivisions;W++)for(I=0;I<=K.subdivisions;I++){const H=new q.OH(I*K.width/K.subdivisions-K.width/2,0,(K.subdivisions-W)*K.height/K.subdivisions-K.height/2),w=4*(((H.x+K.width/2)/K.width*(K.bufferWidth-1)|0)+((1-(H.z+K.height/2)/K.height)*(K.bufferHeight-1)|0)*K.bufferWidth);let y=K.buffer[w]/255,v=K.buffer[w+1]/255,O=K.buffer[w+2]/255;const L=K.buffer[w+3]/255;a&&(y=1-y,v=1-v,O=1-O);const S=y*f.r+v*f.g+O*f.b;H.y=L>=G?K.minHeight+(K.maxHeight-K.minHeight)*S:K.minHeight-z.d,K.heightBuffer&&(K.heightBuffer[W*(K.subdivisions+1)+I]=H.y),M.push(H.x,H.y,H.z),u.push(0,0,0),h.push(I/K.subdivisions,1-W/K.subdivisions)}for(W=0;W<K.subdivisions;W++)for(I=0;I<K.subdivisions;I++){const q=I+1+(W+1)*(K.subdivisions+1),w=I+1+W*(K.subdivisions+1),u=I+W*(K.subdivisions+1),y=I+(W+1)*(K.subdivisions+1),h=M[3*q+1]>=K.minHeight,f=M[3*w+1]>=K.minHeight,z=M[3*u+1]>=K.minHeight;h&&f&&z&&(H.push(q),H.push(w),H.push(u));M[3*y+1]>=K.minHeight&&h&&z&&(H.push(y),H.push(q),H.push(u))}y.d.ComputeNormals(M,H,u);const v=new y.d;return v.indices=H,v.VK=M,v.nK=u,v.kK=h,v}function L(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const M=new W(K,arguments.length>2?arguments[2]:void 0);M._setReady(!1),M._subdivisionsX=H.subdivisionsX||H.subdivisions||1,M._subdivisionsY=H.subdivisionsY||H.subdivisions||1,M._width=H.width||1,M._height=H.height||1,M._maxX=M._width/2,M._maxZ=M._height/2,M._minX=-M._maxX,M._minZ=-M._maxZ;return a(H).dK(M,H.updatable),M._setReady(!0),M}function S(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new u.b(K,M);return v(H).dK(q,H.updatable),q}function B(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const u=M.width||10,y=M.height||10,h=M.subdivisions||1,z=M.minHeight||0,G=M.maxHeight||1,a=M.colorFilter||new w.CH(.3,.59,.11),v=M.alphaFilter||0,L=M.updatable,S=M.onReady;q=q||f.b.LastCreatedScene;const B=new W(K,q);let C;B._subdivisionsX=h,B._subdivisionsY=h,B._width=u,B._height=y,B._maxX=B._width/2,B._maxZ=B._height/2,B._minX=-B._maxX,B._minZ=-B._maxZ,B._setReady(!1),M.passHeightBufferInCallback&&(C=new Float32Array((h+1)*(h+1)));const i=(K,H,M)=>{O({width:u,height:y,subdivisions:h,minHeight:z,maxHeight:G,colorFilter:a,buffer:K,bufferWidth:H,bufferHeight:M,alphaFilter:v,heightBuffer:C}).dK(B,L),S&&S(B,C),B._setReady(!0)};if("string"===typeof H){const K=K=>{var H;const M=K.width,w=K.height;if(q.W)return;const u=null===(H=q)||void 0===H?void 0:H.getEngine().resizeImageBitmap(K,M,w);i(u,M,w)};I.Tools.LoadImage(H,K,M.onError?M.onError:()=>{},q.offlineProvider)}else i(H.data,H.width,H.height);return B}y.d.CreateGround=a,y.d.CreateTiledGround=v,y.d.CreateGroundFromHeightMap=O,u.b.CreateGround=(K,H,M,q,w,u)=>L(K,{width:H,height:M,subdivisions:q,updatable:u},w),u.b.CreateTiledGround=(K,H,M,q,w,u,y,h,W)=>S(K,{xmin:H,zmin:M,xmax:q,zmax:w,subdivisions:u,precision:y,updatable:W},h),u.b.CreateGroundFromHeightMap=(K,H,M,q,w,u,y,h,W,I,f)=>B(K,H,{width:M,height:q,subdivisions:w,minHeight:u,maxHeight:y,updatable:W,onReady:I,alphaFilter:f},h)},13185:(K,H,M)=>{"use strict";M.d(H,{d:()=>a,h:()=>z,j:()=>G});var q=M(11290),w=M(11726),u=M(11714),y=M(11831),h=M(11366),W=M(11112);function I(K){const H=[],M=[],q=K.lines,w=K.cK,y=[];let h=0;for(let u=0;u<q.length;u++){const K=q[u];for(let q=0;q<K.length;q++){const{x:W,y:I,z:f}=K[q];if(M.push(W,I,f),w){const K=w[u],{r:H,g:M,b:h,a:W}=K[q];y.push(H,M,h,W)}q>0&&(H.push(h-1),H.push(h)),h++}}const W=new u.d;return W.indices=H,W.VK=M,w&&(W.cK=y),W}function f(K){const H=K.dashSize||3,M=K.gapSize||1,w=K.dashNb||200,y=K.points,h=[],W=[],I=q.OH.Zero();let f=0,z=0,G=0,a=0,v=0,O=0,L=0;for(L=0;L<y.length-1;L++)y[L+1].subtractToRef(y[L],I),f+=I.length();for(G=f/w,a=H*G/(H+M),L=0;L<y.length-1;L++){y[L+1].subtractToRef(y[L],I),z=Math.floor(I.length()/G),I.normalize();for(let K=0;K<z;K++)v=G*K,h.push(y[L].x+v*I.x,y[L].y+v*I.y,y[L].z+v*I.z),h.push(y[L].x+(v+a)*I.x,y[L].y+(v+a)*I.y,y[L].z+(v+a)*I.z),W.push(O,O+1),O+=2}const S=new u.d;return S.VK=h,S.indices=W,S}function z(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=H.instance,w=H.lines,u=H.cK;if(q){const K=q.getVerticesData(h.d.PositionKind);let H,M;u&&(H=q.getVerticesData(h.d.ColorKind));let y=0,W=0;for(let q=0;q<w.length;q++){const h=w[q];for(let w=0;w<h.length;w++)K[y]=h[w].x,K[y+1]=h[w].y,K[y+2]=h[w].z,u&&H&&(M=u[q],H[W]=M[w].r,H[W+1]=M[w].g,H[W+2]=M[w].b,H[W+3]=M[w].a,W+=4),y+=3}return q.updateVerticesData(h.d.PositionKind,K,!1,!1),u&&H&&q.updateVerticesData(h.d.ColorKind,H,!1,!1),q.refreshBoundingInfo(),q}const W=!!u,f=new y.b(K,M,null,void 0,void 0,W,H.useVertexAlpha,H.material);return I(H).dK(f,H.updatable),f}function G(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=H.cK?[H.cK]:null;return z(K,{lines:[H.points],updatable:H.updatable,instance:H.instance,cK:q,useVertexAlpha:H.useVertexAlpha,material:H.material},M)}function a(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=H.points,h=H.instance,I=H.gapSize||1,z=H.dashSize||3;if(h){const K=K=>{const H=q.OH.Zero(),M=K.length/6;let w=0,y=0,W=0,I=0,f=0,z=0,G=0,a=0;for(G=0;G<u.length-1;G++)u[G+1].subtractToRef(u[G],H),w+=H.length();W=w/M;const v=h._creationDataStorage.dashSize;for(I=v*W/(v+h._creationDataStorage.gapSize),G=0;G<u.length-1;G++)for(u[G+1].subtractToRef(u[G],H),y=Math.floor(H.length()/W),H.normalize(),a=0;a<y&&z<K.length;)f=W*a,K[z]=u[G].x+f*H.x,K[z+1]=u[G].y+f*H.y,K[z+2]=u[G].z+f*H.z,K[z+3]=u[G].x+(f+I)*H.x,K[z+4]=u[G].y+(f+I)*H.y,K[z+5]=u[G].z+(f+I)*H.z,z+=6,a++;for(;z<K.length;)K[z]=u[G].x,K[z+1]=u[G].y,K[z+2]=u[G].z,z+=3};return(H.dashNb||H.dashSize||H.gapSize||H.useVertexAlpha||H.material)&&W.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),h.updateMeshPositions(K,!1),h}const G=new y.b(K,M,null,void 0,void 0,void 0,H.useVertexAlpha,H.material);return f(H).dK(G,H.updatable),G._creationDataStorage=new w.c,G._creationDataStorage.dashSize=z,G._creationDataStorage.gapSize=I,G}u.d.CreateLineSystem=I,u.d.CreateDashedLines=f,w.b.ZI=function(K,H){return G(K,{points:H,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},w.b.CreateDashedLines=function(K,H,M,q,w){return a(K,{points:H,dashSize:M,gapSize:q,dashNb:w,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},12589:(K,H,M)=>{"use strict";M.d(H,{c:()=>h,d:()=>W});var q=M(11726),w=M(11714),u=M(11340);function y(K){const H=[],M=[],q=[],y=[],h=void 0!==K.width?K.width:void 0!==K.size?K.size:1,W=void 0!==K.height?K.height:void 0!==K.size?K.size:1,I=0===K.sideOrientation?0:K.sideOrientation||w.d.DEFAULTSIDE,f=h/2,z=W/2;M.push(-f,-z,0),q.push(0,0,-1),y.push(0,u.b?1:0),M.push(f,-z,0),q.push(0,0,-1),y.push(1,u.b?1:0),M.push(f,z,0),q.push(0,0,-1),y.push(1,u.b?0:1),M.push(-f,z,0),q.push(0,0,-1),y.push(0,u.b?0:1),H.push(0),H.push(1),H.push(2),H.push(0),H.push(2),H.push(3),w.d._ComputeSides(I,M,H,q,y,K.frontUVs,K.backUVs);const G=new w.d;return G.indices=H,G.VK=M,G.nK=q,G.kK=y,G}function h(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new q.b(K,M);H.sideOrientation=q.b._GetDefaultSideOrientation(H.sideOrientation),w._originalBuilderSideOrientation=H.sideOrientation;return y(H).dK(w,H.updatable),H.sourcePlane&&(w.translate(H.sourcePlane.normal,-H.sourcePlane.d),w.setDirection(H.sourcePlane.normal.scale(-1))),w}const W={sI:h};w.d.sI=y,q.b.sI=(K,H,M,q,w)=>h(K,{size:H,width:H,height:H,sideOrientation:w,updatable:q},M)},12670:(K,H,M)=>{"use strict";M.d(H,{d:()=>W});var q=M(11290),w=M(11726),u=M(11714),y=M(11340);function h(K){const H=0|(K.segments||32),M=K.diameterX||K.diameter||1,w=K.diameterY||K.diameter||1,h=K.diameterZ||K.diameter||1,W=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,I=K.slice&&K.slice<=0?1:K.slice||1,f=0===K.sideOrientation?0:K.sideOrientation||u.d.DEFAULTSIDE,z=!!K.dedupTopBottomIndices,G=new q.OH(M/2,w/2,h/2),a=2+H,v=2*a,O=[],L=[],S=[],B=[];for(let u=0;u<=a;u++){const K=u/a,H=K*Math.PI*I;for(let M=0;M<=v;M++){const w=M/v,u=w*Math.PI*2*W,h=q.Matrix.RotationZ(-H),I=q.Matrix.RotationY(u),f=q.OH.TransformCoordinates(q.OH.Up(),h),z=q.OH.TransformCoordinates(f,I),a=z.multiply(G),O=z.divide(G).normalize();L.push(a.x,a.y,a.z),S.push(O.x,O.y,O.z),B.push(w,y.b?1-K:K)}if(u>0){const K=L.length/3;for(let H=K-2*(v+1);H+v+2<K;H++)z?(u>1&&(O.push(H),O.push(H+1),O.push(H+v+1)),(u<a||I<1)&&(O.push(H+v+1),O.push(H+1),O.push(H+v+2))):(O.push(H),O.push(H+1),O.push(H+v+1),O.push(H+v+1),O.push(H+1),O.push(H+v+2))}}u.d._ComputeSides(f,L,O,S,B,K.frontUVs,K.backUVs);const C=new u.d;return C.indices=O,C.VK=L,C.nK=S,C.kK=B,C}function W(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return h(H).dK(q,H.updatable),q}u.d.CreateSphere=h,w.b.CreateSphere=(K,H,M,q,w,u)=>W(K,{segments:H,diameterX:M,diameterY:M,diameterZ:M,sideOrientation:u,updatable:w},q)},13480:(K,H,M)=>{"use strict";M.d(H,{c:()=>h});var q=M(11863),w=M(12972),u=M(11886),y=M(11714);class h{static get Configuration(){return{get decoder(){return w.e.DefaultConfiguration},set decoder(K){w.e.DefaultConfiguration=K}}}static set Configuration(K){w.e.DefaultConfiguration=K.decoder}static get DecoderAvailable(){return(0,q.k)(w.e.DefaultConfiguration)}static get Default(){return h._Default??(h._Default=new h),h._Default}static ResetDefault(K){h._Default&&(K||h._Default.dispose(),h._Default=null)}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.DefaultNumWorkers;const H="number"===typeof K?{...w.e.DefaultConfiguration,numWorkers:K}:{...w.e.DefaultConfiguration,...K};this._decoder=new w.e(H)}dispose(){this._decoder.dispose()}async whenReadyAsync(){return await this._decoder.whenReadyAsync()}decodeMeshToMeshDataAsync(K,H,M){return this._decoder.decodeMeshToMeshDataAsync(K,H,M)}async decodeMeshToGeometryAsync(K,H,M,q){return await this._decoder.decodeMeshToGeometryAsync(K,H,M,q)}async _decodeMeshToGeometryForGltfAsync(K,H,M,q,w,u){return await this._decoder._decodeMeshToGeometryForGltfAsync(K,H,M,q,w,u)}async decodeMeshAsync(K,H){const M=await this._decoder.decodeMeshToMeshDataAsync(K,H),q=new y.d;M.indices&&(q.indices=M.indices);for(const w of M.attributes){const K=u.e.GetFloatData(w.data,w.size,u.e.GetDataType(w.data),w.byteOffset,w.byteStride,w.normalized,M.totalVertices);q.set(K,w.kind)}return q}}h.DefaultNumWorkers=(0,q.g)(),h._Default=null},12972:(K,H,M)=>{"use strict";M.d(H,{e:()=>I});var q=M(11863),w=M(11100),u=M(11738),y=M(11886),h=M(11112),W=M(11877);class I extends q.e{static get DefaultAvailable(){return(0,q.k)(I.DefaultConfiguration)}static get Default(){return I._Default??(I._Default=new I),I._Default}static ResetDefault(K){I._Default&&(K||I._Default.dispose(),I._Default=null)}_isModuleAvailable(){return"undefined"!==typeof DracoDecoderModule}async _createModuleAsync(K,H){return{module:await(H||DracoDecoderModule)({wasmBinary:K})}}_getWorkerContent(){return`${W.d}(${W.h})()`}constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.DefaultConfiguration)}decodeMeshToMeshDataAsync(K,H,M){const q=K instanceof ArrayBuffer?new Int8Array(K):new Int8Array(K.buffer,K.byteOffset,K.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((async K=>await new Promise(((w,u)=>{K.push(((K,y)=>{let W=null;const I=[],f=H=>{K.removeEventListener("error",f),K.removeEventListener("message",z),u(H),y()},z=H=>{const q=H.data;switch(q.id){case"indices":W=q.data;break;case"attribute":I.push({kind:q.kind,data:q.data,size:q.size,byteOffset:q.byteOffset,byteStride:q.byteStride,normalized:(u=q.kind,G=q.normalized,M&&void 0!==M[u]?(G!==M[u]&&h.e.Warn(`Normalized flag from Draco data (${G}) does not match normalized flag from glTF accessor (${M[u]}). Using flag from glTF accessor.`),M[u]):G)});break;case"decodeMeshDone":K.removeEventListener("error",f),K.removeEventListener("message",z),w({indices:W,attributes:I,totalVertices:q.totalVertices}),y()}var u,G};K.addEventListener("error",f),K.addEventListener("message",z);const G=q.slice();K.postMessage({id:"decodeMesh",dataView:G,attributes:H},[G.buffer])}))}))));if(this._modulePromise)return this._modulePromise.then((K=>{let M=null;const w=[],u=(0,W.d)(K.module,q,H,(K=>{M=K}),((K,H,M,q,u,y)=>{w.push({kind:K,data:H,size:M,byteOffset:q,byteStride:u,normalized:y})}));return{indices:M,attributes:w,totalVertices:u}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(K,H,M,q){const w=await this.decodeMeshToMeshDataAsync(M,q),h=new u.c(K,H);w.indices&&h.setIndices(w.indices);for(const u of w.attributes)h.setVerticesBuffer(new y.e(H.getEngine(),u.data,u.kind,!1,void 0,u.byteStride,void 0,u.byteOffset,u.size,void 0,u.normalized,!0),w.totalVertices);return h}async _decodeMeshToGeometryForGltfAsync(K,H,M,q,w,h){const W=await this.decodeMeshToMeshDataAsync(M,q,w),I=new u.c(K,H);h&&(I._boundingInfo=h,I.useBoundingInfoFromGeometry=!0),W.indices&&I.setIndices(W.indices);for(const u of W.attributes)I.setVerticesBuffer(new y.e(H.getEngine(),u.data,u.kind,!1,void 0,u.byteStride,void 0,u.byteOffset,u.size,void 0,u.normalized,!0),W.totalVertices);return I}}I.DefaultConfiguration={wasmUrl:`${w.Tools._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${w.Tools._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${w.Tools._DefaultCdnUrl}/draco_decoder_gltf.js`},I._Default=null},13183:(K,H,M)=>{"use strict";M.d(H,{e:()=>hK});var q=M(11290),w=M(11726),u=M(11366),y=M(11714),h=M(11340);function W(K){let H=K.pathArray;const M=K.closeArray||!1,q=K.closePath||!1,w=K.invertUV||!1,W=Math.floor(H[0].length/2);let I=K.offset||W;I=I>W?W:Math.floor(I);const f=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE,z=K.kK,G=K.cK,a=[],v=[],O=[],L=[],S=[],B=[],C=[],i=[];let Z;const E=[],l=[];let s,D,V;if(H.length<2){const K=[],M=[];for(D=0;D<H[0].length-I;D++)K.push(H[0][D]),M.push(H[0][D+I]);H=[K,M]}let n=0;const c=q?1:0,k=M?1:0;let T,d,x,Q,J,N;for(Z=H[0].length,s=0;s<H.length+k;s++){for(C[s]=0,S[s]=[0],T=s===H.length?H[0]:H[s],d=T.length,Z=Z<d?Z:d,V=0;V<d;)a.push(T[V].x,T[V].y,T[V].z),V>0&&(x=T[V].LH(T[V-1]).length(),Q=x+C[s],S[s].push(Q),C[s]=Q),V++;q&&(V--,a.push(T[0].x,T[0].y,T[0].z),x=T[V].LH(T[0]).length(),Q=x+C[s],S[s].push(Q),C[s]=Q),E[s]=d+c,l[s]=n,n+=d+c}let p,o,R=null,t=null;for(D=0;D<Z+c;D++)for(i[D]=0,B[D]=[0],s=0;s<H.length-1+k;s++)J=H[s],N=s===H.length-1?H[0]:H[s+1],D===Z?(R=J[0],t=N[0]):(R=J[D],t=N[D]),x=t.LH(R).length(),Q=x+i[D],B[D].push(Q),i[D]=Q;if(z)for(s=0;s<z.length;s++)L.push(z[s].x,h.b?1-z[s].y:z[s].y);else for(s=0;s<H.length+k;s++)for(D=0;D<Z+c;D++)p=0!=C[s]?S[s][D]/C[s]:0,o=0!=i[D]?B[D][s]/i[D]:0,w?L.push(o,p):L.push(p,h.b?1-o:o);s=0;let U=0,j=E[s]-1,m=E[s+1]-1,F=j<m?j:m,Y=l[1]-l[0];const r=E.length-1;for(;U<=F&&s<r;)v.push(U,U+Y,U+1),v.push(U+Y+1,U+1,U+Y),U+=1,U===F&&(s++,Y=l[s+1]-l[s],j=E[s]-1,m=E[s+1]-1,U=l[s],F=j<m?j+U:m+U);if(y.d.ComputeNormals(a,v,O),q){let K=0,M=0;for(s=0;s<H.length;s++){K=3*l[s],M=s+1<H.length?3*(l[s+1]-1):O.length-3,O[K]=.5*(O[K]+O[M]),O[K+1]=.5*(O[K+1]+O[M+1]),O[K+2]=.5*(O[K+2]+O[M+2]);const q=Math.sqrt(O[K]*O[K]+O[K+1]*O[K+1]+O[K+2]*O[K+2]);O[K]/=q,O[K+1]/=q,O[K+2]/=q,O[M]=O[K],O[M+1]=O[K+1],O[M+2]=O[K+2]}}if(M){let K=3*l[0],M=3*l[H.length];for(D=0;D<Z+c;D++){O[K]=.5*(O[K]+O[M]),O[K+1]=.5*(O[K+1]+O[M+1]),O[K+2]=.5*(O[K+2]+O[M+2]);const H=Math.sqrt(O[K]*O[K]+O[K+1]*O[K+1]+O[K+2]*O[K+2]);O[K]/=H,O[K+1]/=H,O[K+2]/=H,O[M]=O[K],O[M+1]=O[K+1],O[M+2]=O[K+2],K+=3,M+=3}}y.d._ComputeSides(f,a,v,O,L,K.frontUVs,K.backUVs);let e=null;if(G){e=new Float32Array(4*G.length);for(let K=0;K<G.length;K++)e[4*K]=G[K].r,e[4*K+1]=G[K].g,e[4*K+2]=G[K].b,e[4*K+3]=G[K].a}const b=new y.d,P=new Float32Array(a),g=new Float32Array(O),X=new Float32Array(L);return b.indices=v,b.VK=P,b.nK=g,b.kK=X,e&&b.set(e,u.d.ColorKind),q&&(b._idx=l),b}function I(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const I=H.pathArray,f=H.closeArray,z=H.closePath,G=w.b._GetDefaultSideOrientation(H.sideOrientation),a=H.instance,v=H.updatable;if(a){const K=q.TmpVectors.OH[0].Bh(Number.MAX_VALUE),M=q.TmpVectors.OH[1].Bh(-Number.MAX_VALUE),W=H=>{let q=I[0].length;const u=a;let y=0;const h=u._originalBuilderSideOrientation===w.b.DOUBLESIDE?2:1;for(let w=1;w<=h;++w)for(let h=0;h<I.length;++h){const w=I[h],W=w.length;q=q<W?q:W;for(let u=0;u<q;++u){const q=w[u];H[y]=q.x,H[y+1]=q.y,H[y+2]=q.z,K.minimizeInPlaceFromFloats(q.x,q.y,q.z),M.maximizeInPlaceFromFloats(q.x,q.y,q.z),y+=3}if(u._creationDataStorage&&u._creationDataStorage.closePath){const K=w[0];H[y]=K.x,H[y+1]=K.y,H[y+2]=K.z,y+=3}}},f=a.getVerticesData(u.d.PositionKind);if(W(f),a.hasBoundingInfo?a.getBoundingInfo().reConstruct(K,M,a._worldMatrix):a.buildBoundingInfo(K,M,a._worldMatrix),a.updateVerticesData(u.d.PositionKind,f,!1,!1),H.cK){const K=a.getVerticesData(u.d.ColorKind);for(let M=0,q=0;M<H.cK.length;M++,q+=4){const w=H.cK[M];K[q]=w.r,K[q+1]=w.g,K[q+2]=w.b,K[q+3]=w.a}a.updateVerticesData(u.d.ColorKind,K,!1,!1)}if(H.kK){const K=a.getVerticesData(u.d.UVKind);for(let M=0;M<H.kK.length;M++)K[2*M]=H.kK[M].x,K[2*M+1]=h.b?1-H.kK[M].y:H.kK[M].y;a.updateVerticesData(u.d.UVKind,K,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){const K=a.ah(),H=a.getVerticesData(u.d.NormalKind),M=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(y.d.ComputeNormals(f,K,H,M),a._creationDataStorage&&a._creationDataStorage.closePath){let K=0,M=0;for(let q=0;q<I.length;q++)K=3*a._creationDataStorage.idx[q],M=q+1<I.length?3*(a._creationDataStorage.idx[q+1]-1):H.length-3,H[K]=.5*(H[K]+H[M]),H[K+1]=.5*(H[K+1]+H[M+1]),H[K+2]=.5*(H[K+2]+H[M+2]),H[M]=H[K],H[M+1]=H[K+1],H[M+2]=H[K+2]}a.areNormalsFrozen||a.updateVerticesData(u.d.NormalKind,H,!1,!1)}return a}{const q=new w.b(K,M);q._originalBuilderSideOrientation=G,q._creationDataStorage=new w.c;const u=W(H);return z&&(q._creationDataStorage.idx=u._idx),q._creationDataStorage.closePath=z,q._creationDataStorage.closeArray=f,u.dK(q,v),q}}y.d.CreateRibbon=W,w.b.CreateRibbon=function(K,H){return I(K,{pathArray:H,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var f=M(12681),z=M(12533),G=M(11329);function a(K){const H=K.pattern||w.b.NO_FLIP,M=K.tileWidth||K.tileSize||1,q=K.tileHeight||K.tileSize||1,u=K.alignHorizontal||0,h=K.alignVertical||0,W=K.width||K.size||1,I=Math.floor(W/M);let f=W-I*M;const z=K.height||K.size||1,G=Math.floor(z/q);let a=z-G*q;const v=M*I/2,O=q*G/2;let L=0,S=0,B=0,C=0,i=0,Z=0;if(f>0||a>0){switch(B=-v,C=-O,i=v,Z=O,u){case w.b.CENTER:f/=2,B-=f,i+=f;break;case w.b.LEFT:i+=f,L=-f/2;break;case w.b.RIGHT:B-=f,L=f/2}switch(h){case w.b.CENTER:a/=2,C-=a,Z+=a;break;case w.b.BOTTOM:Z+=a,S=-a/2;break;case w.b.TOP:C-=a,S=a/2}}const E=[],l=[],s=[];s[0]=[0,0,1,0,1,1,0,1],s[1]=[0,0,1,0,1,1,0,1],H!==w.b.ROTATE_TILE&&H!==w.b.ROTATE_ROW||(s[1]=[1,1,0,1,0,0,1,0]),H!==w.b.FLIP_TILE&&H!==w.b.FLIP_ROW||(s[1]=[1,0,0,0,0,1,1,1]),H!==w.b.FLIP_N_ROTATE_TILE&&H!==w.b.FLIP_N_ROTATE_ROW||(s[1]=[0,1,1,1,1,0,0,0]);let D=[];const V=[],n=[];let c=0;for(let y=0;y<G;y++)for(let K=0;K<I;K++)E.push(K*M-v+L,y*q-O+S,0),E.push((K+1)*M-v+L,y*q-O+S,0),E.push((K+1)*M-v+L,(y+1)*q-O+S,0),E.push(K*M-v+L,(y+1)*q-O+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),D=H===w.b.FLIP_TILE||H===w.b.ROTATE_TILE||H===w.b.FLIP_N_ROTATE_TILE?D.concat(s[(K%2+y%2)%2]):H===w.b.FLIP_ROW||H===w.b.ROTATE_ROW||H===w.b.FLIP_N_ROTATE_ROW?D.concat(s[y%2]):D.concat(s[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),c+=4;if(f>0||a>0){const K=a>0&&(h===w.b.CENTER||h===w.b.TOP),y=a>0&&(h===w.b.CENTER||h===w.b.BOTTOM),W=f>0&&(u===w.b.CENTER||u===w.b.RIGHT),z=f>0&&(u===w.b.CENTER||u===w.b.LEFT);let s,k,T,d,x=[];if(K&&W&&(E.push(B+L,C+S,0),E.push(-v+L,C+S,0),E.push(-v+L,C+a+S,0),E.push(B+L,C+a+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=1-f/M,k=1-a/q,T=1,d=1,x=[s,k,T,k,T,d,s,d],H===w.b.ROTATE_ROW&&(x=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),H===w.b.FLIP_ROW&&(x=[1-s,k,1-T,k,1-T,d,1-s,d]),H===w.b.FLIP_N_ROTATE_ROW&&(x=[s,1-k,T,1-k,T,1-d,s,1-d]),D=D.concat(x),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&z&&(E.push(v+L,C+S,0),E.push(i+L,C+S,0),E.push(i+L,C+a+S,0),E.push(v+L,C+a+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=0,k=1-a/q,T=f/M,d=1,x=[s,k,T,k,T,d,s,d],(H===w.b.ROTATE_ROW||H===w.b.ROTATE_TILE&&I%2===0)&&(x=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),(H===w.b.FLIP_ROW||H===w.b.FLIP_TILE&&I%2===0)&&(x=[1-s,k,1-T,k,1-T,d,1-s,d]),(H===w.b.FLIP_N_ROTATE_ROW||H===w.b.FLIP_N_ROTATE_TILE&&I%2===0)&&(x=[s,1-k,T,1-k,T,1-d,s,1-d]),D=D.concat(x),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&W&&(E.push(B+L,O+S,0),E.push(-v+L,O+S,0),E.push(-v+L,Z+S,0),E.push(B+L,Z+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=1-f/M,k=0,T=1,d=a/q,x=[s,k,T,k,T,d,s,d],(H===w.b.ROTATE_ROW&&G%2===1||H===w.b.ROTATE_TILE&&G%1===0)&&(x=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),(H===w.b.FLIP_ROW&&G%2===1||H===w.b.FLIP_TILE&&G%2===0)&&(x=[1-s,k,1-T,k,1-T,d,1-s,d]),(H===w.b.FLIP_N_ROTATE_ROW&&G%2===1||H===w.b.FLIP_N_ROTATE_TILE&&G%2===0)&&(x=[s,1-k,T,1-k,T,1-d,s,1-d]),D=D.concat(x),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),y&&z&&(E.push(v+L,O+S,0),E.push(i+L,O+S,0),E.push(i+L,Z+S,0),E.push(v+L,Z+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,s=0,k=0,T=f/M,d=a/q,x=[s,k,T,k,T,d,s,d],(H===w.b.ROTATE_ROW&&G%2===1||H===w.b.ROTATE_TILE&&(G+I)%2===1)&&(x=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),(H===w.b.FLIP_ROW&&G%2===1||H===w.b.FLIP_TILE&&(G+I)%2===1)&&(x=[1-s,k,1-T,k,1-T,d,1-s,d]),(H===w.b.FLIP_N_ROTATE_ROW&&G%2===1||H===w.b.FLIP_N_ROTATE_TILE&&(G+I)%2===1)&&(x=[s,1-k,T,1-k,T,1-d,s,1-d]),D=D.concat(x),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K){const K=[];s=0,k=1-a/q,T=1,d=1,K[0]=[s,k,T,k,T,d,s,d],K[1]=[s,k,T,k,T,d,s,d],H!==w.b.ROTATE_TILE&&H!==w.b.ROTATE_ROW||(K[1]=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),H!==w.b.FLIP_TILE&&H!==w.b.FLIP_ROW||(K[1]=[1-s,k,1-T,k,1-T,d,1-s,d]),H!==w.b.FLIP_N_ROTATE_TILE&&H!==w.b.FLIP_N_ROTATE_ROW||(K[1]=[s,1-k,T,1-k,T,1-d,s,1-d]);for(let q=0;q<I;q++)E.push(q*M-v+L,C+S,0),E.push((q+1)*M-v+L,C+S,0),E.push((q+1)*M-v+L,C+a+S,0),E.push(q*M-v+L,C+a+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,D=H===w.b.FLIP_TILE||H===w.b.ROTATE_TILE||H===w.b.FLIP_N_ROTATE_TILE?D.concat(K[(q+1)%2]):H===w.b.FLIP_ROW||H===w.b.ROTATE_ROW||H===w.b.FLIP_N_ROTATE_ROW?D.concat(K[1]):D.concat(K[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(y){const K=[];s=0,k=0,T=1,d=a/q,K[0]=[s,k,T,k,T,d,s,d],K[1]=[s,k,T,k,T,d,s,d],H!==w.b.ROTATE_TILE&&H!==w.b.ROTATE_ROW||(K[1]=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),H!==w.b.FLIP_TILE&&H!==w.b.FLIP_ROW||(K[1]=[1-s,k,1-T,k,1-T,d,1-s,d]),H!==w.b.FLIP_N_ROTATE_TILE&&H!==w.b.FLIP_N_ROTATE_ROW||(K[1]=[s,1-k,T,1-k,T,1-d,s,1-d]);for(let q=0;q<I;q++)E.push(q*M-v+L,Z-a+S,0),E.push((q+1)*M-v+L,Z-a+S,0),E.push((q+1)*M-v+L,Z+S,0),E.push(q*M-v+L,Z+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,D=H===w.b.FLIP_TILE||H===w.b.ROTATE_TILE||H===w.b.FLIP_N_ROTATE_TILE?D.concat(K[(q+G)%2]):H===w.b.FLIP_ROW||H===w.b.ROTATE_ROW||H===w.b.FLIP_N_ROTATE_ROW?D.concat(K[G%2]):D.concat(K[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(W){const K=[];s=1-f/M,k=0,T=1,d=1,K[0]=[s,k,T,k,T,d,s,d],K[1]=[s,k,T,k,T,d,s,d],H!==w.b.ROTATE_TILE&&H!==w.b.ROTATE_ROW||(K[1]=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),H!==w.b.FLIP_TILE&&H!==w.b.FLIP_ROW||(K[1]=[1-s,k,1-T,k,1-T,d,1-s,d]),H!==w.b.FLIP_N_ROTATE_TILE&&H!==w.b.FLIP_N_ROTATE_ROW||(K[1]=[s,1-k,T,1-k,T,1-d,s,1-d]);for(let M=0;M<G;M++)E.push(B+L,M*q-O+S,0),E.push(B+f+L,M*q-O+S,0),E.push(B+f+L,(M+1)*q-O+S,0),E.push(B+L,(M+1)*q-O+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,D=H===w.b.FLIP_TILE||H===w.b.ROTATE_TILE||H===w.b.FLIP_N_ROTATE_TILE?D.concat(K[(M+1)%2]):H===w.b.FLIP_ROW||H===w.b.ROTATE_ROW||H===w.b.FLIP_N_ROTATE_ROW?D.concat(K[M%2]):D.concat(K[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(z){const K=[];s=0,k=0,T=f/q,d=1,K[0]=[s,k,T,k,T,d,s,d],K[1]=[s,k,T,k,T,d,s,d],H!==w.b.ROTATE_TILE&&H!==w.b.ROTATE_ROW||(K[1]=[1-s,1-k,1-T,1-k,1-T,1-d,1-s,1-d]),H!==w.b.FLIP_TILE&&H!==w.b.FLIP_ROW||(K[1]=[1-s,k,1-T,k,1-T,d,1-s,d]),H!==w.b.FLIP_N_ROTATE_TILE&&H!==w.b.FLIP_N_ROTATE_ROW||(K[1]=[s,1-k,T,1-k,T,1-d,s,1-d]);for(let M=0;M<G;M++)E.push(i-f+L,M*q-O+S,0),E.push(i+L,M*q-O+S,0),E.push(i+L,(M+1)*q-O+S,0),E.push(i-f+L,(M+1)*q-O+S,0),n.push(c,c+1,c+3,c+1,c+2,c+3),c+=4,D=H===w.b.FLIP_TILE||H===w.b.ROTATE_TILE||H===w.b.FLIP_N_ROTATE_TILE?D.concat(K[(M+I)%2]):H===w.b.FLIP_ROW||H===w.b.ROTATE_ROW||H===w.b.FLIP_N_ROTATE_ROW?D.concat(K[M%2]):D.concat(K[0]),V.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),l.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const k=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE;y.d._ComputeSides(k,E,n,l,D,K.frontUVs,K.backUVs);const T=new y.d;T.indices=n,T.VK=E,T.nK=l,T.kK=D;const d=k===y.d.DOUBLESIDE?V.concat(V):V;return T.cK=d,T}function v(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return a(H).dK(q,H.updatable),q}function O(K){const H=K.faceUV||new Array(6),M=K.faceColors,u=K.pattern||w.b.NO_FLIP,W=K.width||K.size||1,I=K.height||K.size||1,f=K.depth||K.size||1,z=K.tileWidth||K.tileSize||1,v=K.tileHeight||K.tileSize||1,O=K.alignHorizontal||0,L=K.alignVertical||0,S=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE;for(let w=0;w<6;w++)void 0===H[w]&&(H[w]=new q.Vector4(0,0,1,1)),M&&void 0===M[w]&&(M[w]=new G.Ch(1,1,1,1));const B=W/2,C=I/2,i=f/2,Z=[];for(let q=0;q<2;q++)Z[q]=a({pattern:u,tileWidth:z,tileHeight:v,width:W,height:I,alignVertical:L,alignHorizontal:O,sideOrientation:S});for(let q=2;q<4;q++)Z[q]=a({pattern:u,tileWidth:z,tileHeight:v,width:f,height:I,alignVertical:L,alignHorizontal:O,sideOrientation:S});let E=L;L===w.b.BOTTOM?E=w.b.TOP:L===w.b.TOP&&(E=w.b.BOTTOM);for(let q=4;q<6;q++)Z[q]=a({pattern:u,tileWidth:z,tileHeight:v,width:W,height:f,alignVertical:E,alignHorizontal:O,sideOrientation:S});let l=[],s=[],D=[],V=[];const n=[],c=[],k=[],T=[];let d=0,x=0;for(let w=0;w<6;w++){const K=Z[w].VK.length;c[w]=[],k[w]=[];for(let H=0;H<K/3;H++)c[w].push(new q.OH(Z[w].VK[3*H],Z[w].VK[3*H+1],Z[w].VK[3*H+2])),k[w].push(new q.OH(Z[w].nK[3*H],Z[w].nK[3*H+1],Z[w].nK[3*H+2]));d=Z[w].kK.length,T[w]=[];for(let M=0;M<d;M+=2)T[w][M]=H[w].x+(H[w].z-H[w].x)*Z[w].kK[M],T[w][M+1]=H[w].y+(H[w].w-H[w].y)*Z[w].kK[M+1],h.b&&(T[w][M+1]=1-T[w][M+1]);if(D=D.concat(T[w]),V=V.concat(Z[w].indices.map((K=>K+x))),x+=c[w].length,M)for(let H=0;H<4;H++)n.push(M[w].r,M[w].g,M[w].b,M[w].a)}const Q=new q.OH(0,0,i),J=q.Matrix.RotationY(Math.PI);l=c[0].map((K=>q.OH.TransformNormal(K,J).add(Q))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[]),s=k[0].map((K=>q.OH.TransformNormal(K,J))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[]),l=l.concat(c[1].map((K=>K.LH(Q))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[])),s=s.concat(k[1].map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[]));const N=new q.OH(B,0,0),p=q.Matrix.RotationY(-Math.PI/2);l=l.concat(c[2].map((K=>q.OH.TransformNormal(K,p).add(N))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[])),s=s.concat(k[2].map((K=>q.OH.TransformNormal(K,p))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[]));const o=q.Matrix.RotationY(Math.PI/2);l=l.concat(c[3].map((K=>q.OH.TransformNormal(K,o).LH(N))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[])),s=s.concat(k[3].map((K=>q.OH.TransformNormal(K,o))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[]));const R=new q.OH(0,C,0),t=q.Matrix.RotationX(Math.PI/2);l=l.concat(c[4].map((K=>q.OH.TransformNormal(K,t).add(R))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[])),s=s.concat(k[4].map((K=>q.OH.TransformNormal(K,t))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[]));const U=q.Matrix.RotationX(-Math.PI/2);l=l.concat(c[5].map((K=>q.OH.TransformNormal(K,U).LH(R))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[])),s=s.concat(k[5].map((K=>q.OH.TransformNormal(K,U))).map((K=>[K.x,K.y,K.z])).reduce(((K,H)=>K.concat(H)),[])),y.d._ComputeSides(S,l,V,s,D);const j=new y.d;if(j.indices=V,j.VK=l,j.nK=s,j.kK=D,M){const K=S===y.d.DOUBLESIDE?n.concat(n):n;j.cK=K}return j}function L(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return O(H).dK(q,H.updatable),q}y.d.CreateTiledPlane=a;y.d.CreateTiledBox=O;var S=M(12670),B=M(11522),C=M(11485);function i(K){const H=K.height||2;let M=0===K.diameterTop?0:K.diameterTop||K.diameter||1,u=0===K.diameterBottom?0:K.diameterBottom||K.diameter||1;M=M||1e-5,u=u||1e-5;const W=0|(K.tessellation||24),I=0|(K.subdivisions||1),f=!!K.hasRings,z=!!K.enclose,a=0===K.cap?0:K.cap||w.b.CAP_ALL,v=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,O=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE,L=K.faceUV||new Array(3),S=K.faceColors,B=2+(1+(1!==v&&z?2:0))*(f?I:1);let i;for(i=0;i<B;i++)S&&void 0===S[i]&&(S[i]=new G.Ch(1,1,1,1));for(i=0;i<B;i++)L&&void 0===L[i]&&(L[i]=new q.Vector4(0,0,1,1));const Z=[],E=[],l=[],s=[],D=[],V=2*Math.PI*v/W;let n,c,k;const T=(u-M)/2/H,d=q.OH.Zero(),x=q.OH.Zero(),Q=q.OH.Zero(),J=q.OH.Zero(),N=q.OH.Zero(),p=C.d.Y;let o,R,t,U=1,j=1,m=0,F=0;for(o=0;o<=I;o++)for(c=o/I,k=(c*(M-u)+u)/2,U=f&&0!==o&&o!==I?2:1,t=0;t<U;t++){for(f&&(j+=t),z&&(j+=2*t),R=0;R<=W;R++)n=R*V,d.x=Math.cos(-n)*k,d.y=-H/2+c*H,d.z=Math.sin(-n)*k,0===M&&o===I?(x.x=l[l.length-3*(W+1)],x.y=l[l.length-3*(W+1)+1],x.z=l[l.length-3*(W+1)+2]):(x.x=d.x,x.z=d.z,x.y=Math.sqrt(x.x*x.x+x.z*x.z)*T,x.normalize()),0===R&&(Q.q(d),J.q(x)),E.push(d.x,d.y,d.z),l.push(x.x,x.y,x.z),F=f?m!==j?L[j].y:L[j].w:L[j].y+(L[j].w-L[j].y)*c,s.push(L[j].x+(L[j].z-L[j].x)*R/W,h.b?1-F:F),S&&D.push(S[j].r,S[j].g,S[j].b,S[j].a);1!==v&&z&&(E.push(d.x,d.y,d.z),E.push(0,d.y,0),E.push(0,d.y,0),E.push(Q.x,Q.y,Q.z),q.OH.CrossToRef(p,x,N),N.normalize(),l.push(N.x,N.y,N.z,N.x,N.y,N.z),q.OH.CrossToRef(J,p,N),N.normalize(),l.push(N.x,N.y,N.z,N.x,N.y,N.z),F=f?m!==j?L[j+1].y:L[j+1].w:L[j+1].y+(L[j+1].w-L[j+1].y)*c,s.push(L[j+1].x,h.b?1-F:F),s.push(L[j+1].z,h.b?1-F:F),F=f?m!==j?L[j+2].y:L[j+2].w:L[j+2].y+(L[j+2].w-L[j+2].y)*c,s.push(L[j+2].x,h.b?1-F:F),s.push(L[j+2].z,h.b?1-F:F),S&&(D.push(S[j+1].r,S[j+1].g,S[j+1].b,S[j+1].a),D.push(S[j+1].r,S[j+1].g,S[j+1].b,S[j+1].a),D.push(S[j+2].r,S[j+2].g,S[j+2].b,S[j+2].a),D.push(S[j+2].r,S[j+2].g,S[j+2].b,S[j+2].a))),m!==j&&(m=j)}const Y=1!==v&&z?W+4:W;for(o=0,j=0;j<I;j++){let K=0,H=0,M=0,q=0;for(R=0;R<W;R++)K=o*(Y+1)+R,H=(o+1)*(Y+1)+R,M=o*(Y+1)+(R+1),q=(o+1)*(Y+1)+(R+1),Z.push(K,H,M),Z.push(q,M,H);1!==v&&z&&(Z.push(K+2,H+2,M+2),Z.push(q+2,M+2,H+2),Z.push(K+4,H+4,M+4),Z.push(q+4,M+4,H+4)),o=f?o+2:o+1}const r=K=>{const w=K?M/2:u/2;if(0===w)return;let y,I,f;const z=K?L[B-1]:L[0];let G=null;S&&(G=K?S[B-1]:S[0]);const a=E.length/3,O=K?H/2:-H/2,C=new q.OH(0,O,0);E.push(C.x,C.y,C.z),l.push(0,K?1:-1,0);const i=z.y+.5*(z.w-z.y);s.push(z.x+.5*(z.z-z.x),h.b?1-i:i),G&&D.push(G.r,G.g,G.b,G.a);const V=new q.Vector2(.5,.5);for(f=0;f<=W;f++){y=2*Math.PI*f*v/W;const H=Math.cos(-y),M=Math.sin(-y);I=new q.OH(H*w,O,M*w);const u=new q.Vector2(H*V.x+.5,M*V.y+.5);E.push(I.x,I.y,I.z),l.push(0,K?1:-1,0);const a=z.y+(z.w-z.y)*u.y;s.push(z.x+(z.z-z.x)*u.x,h.b?1-a:a),G&&D.push(G.r,G.g,G.b,G.a)}for(f=0;f<W;f++)K?(Z.push(a),Z.push(a+(f+2)),Z.push(a+(f+1))):(Z.push(a),Z.push(a+(f+1)),Z.push(a+(f+2)))};a!==w.b.CAP_START&&a!==w.b.CAP_ALL||r(!1),a!==w.b.CAP_END&&a!==w.b.CAP_ALL||r(!0),y.d._ComputeSides(O,E,Z,l,s,K.frontUVs,K.backUVs);const e=new y.d;return e.indices=Z,e.VK=E,e.nK=l,e.kK=s,S&&(e.cK=D),e}function Z(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return i(H).dK(q,H.updatable),q}function E(K){const H=[],M=[],w=[],u=[],W=K.diameter||1,I=K.thickness||.5,f=0|(K.tessellation||16),z=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE,G=f+1;for(let y=0;y<=f;y++){const K=y/f,z=y*Math.PI*2/f-Math.PI/2,a=q.Matrix.Translation(W/2,0,0).multiply(q.Matrix.RotationY(z));for(let W=0;W<=f;W++){const z=1-W/f,v=W*Math.PI*2/f+Math.PI,O=Math.cos(v),L=Math.sin(v);let S=new q.OH(O,L,0),B=S.scale(I/2);const C=new q.Vector2(K,z);B=q.OH.TransformCoordinates(B,a),S=q.OH.TransformNormal(S,a),M.push(B.x,B.y,B.z),w.push(S.x,S.y,S.z),u.push(C.x,h.b?1-C.y:C.y);const i=(y+1)%G,Z=(W+1)%G;H.push(y*G+W),H.push(y*G+Z),H.push(i*G+W),H.push(y*G+Z),H.push(i*G+Z),H.push(i*G+W)}}y.d._ComputeSides(z,M,H,w,u,K.frontUVs,K.backUVs);const a=new y.d;return a.indices=H,a.VK=M,a.nK=w,a.kK=u,a}function l(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return E(H).dK(q,H.updatable),q}y.d.CreateCylinder=i,w.b.CreateCylinder=(K,H,M,q,u,y,h,W,I)=>{void 0!==h&&h instanceof B.b||(void 0!==h&&(I=W||w.b.DEFAULTSIDE,W=h),h=y,y=1);return Z(K,{height:H,diameterTop:M,diameterBottom:q,tessellation:u,subdivisions:y,sideOrientation:I,updatable:W},h)};function s(K){const H=[],M=[],w=[],u=[],W=K.radius||2,I=K.tube||.5,f=K.radialSegments||32,z=K.tubularSegments||32,G=K.p||2,a=K.q||3,v=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE,O=K=>{const H=Math.cos(K),M=Math.sin(K),w=a/G*K,u=Math.cos(w),y=W*(2+u)*.5*H,h=W*(2+u)*M*.5,I=W*Math.sin(w)*.5;return new q.OH(y,h,I)};let L,S;for(L=0;L<=f;L++){const K=L%f/f*2*G*Math.PI,H=O(K),w=O(K+.01),y=w.LH(H);let W=w.add(H);const a=q.OH.Cross(y,W);for(W=q.OH.Cross(a,y),a.normalize(),W.normalize(),S=0;S<z;S++){const K=S%z/z*2*Math.PI,q=-I*Math.cos(K),w=I*Math.sin(K);M.push(H.x+q*W.x+w*a.x),M.push(H.y+q*W.y+w*a.y),M.push(H.z+q*W.z+w*a.z),u.push(L/f),u.push(h.b?1-S/z:S/z)}}for(L=0;L<f;L++)for(S=0;S<z;S++){const K=(S+1)%z,M=L*z+S,q=(L+1)*z+S,w=(L+1)*z+K,u=L*z+K;H.push(u),H.push(q),H.push(M),H.push(u),H.push(w),H.push(q)}y.d.ComputeNormals(M,H,w),y.d._ComputeSides(v,M,H,w,u,K.frontUVs,K.backUVs);const B=new y.d;return B.indices=H,B.VK=M,B.nK=w,B.kK=u,B}function D(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return s(H).dK(q,H.updatable),q}y.d.CreateTorus=E,w.b.CreateTorus=(K,H,M,q,w,u,y)=>l(K,{diameter:H,thickness:M,tessellation:q,sideOrientation:y,updatable:u},w);y.d.CreateTorusKnot=s,w.b.CreateTorusKnot=(K,H,M,q,w,u,y,h,W,I)=>D(K,{radius:H,tube:M,radialSegments:q,tubularSegments:w,p:u,q:y,sideOrientation:I,updatable:W},h);var V=M(13185),n=M(11846),c=M(11496);function k(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=H.path,u=H.shape,y=H.scale||1,h=H.rotation||0,W=0===H.cap?0:H.cap||w.b.NO_CAP,I=H.updatable,f=w.b._GetDefaultSideOrientation(H.sideOrientation),z=H.instance||null,G=H.invertUV||!1,a=H.closeShape||!1,v=H.closePath||!1,O=H.capFunction||null;return d(K,u,q,y,h,null,null,v,a,W,!1,M,!!I,f,z,G,H.frontUVs||null,H.backUVs||null,H.firstNormal||null,!!H.adjustFrame,O)}function T(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=H.path,u=H.shape,y=H.scaleFunction||(()=>1),h=H.rotationFunction||(()=>0),W=H.closePath||H.ribbonCloseArray||!1,I=H.closeShape||H.ribbonClosePath||!1,f=0===H.cap?0:H.cap||w.b.NO_CAP,z=H.updatable,G=H.firstNormal||null,a=H.adjustFrame||!1,v=w.b._GetDefaultSideOrientation(H.sideOrientation),O=H.instance,L=H.invertUV||!1,S=H.capFunction||null;return d(K,u,q,null,null,y,h,W,I,f,!0,M,!!z,v,O||null,L,H.frontUVs||null,H.backUVs||null,G,a,S||null)}function d(K,H,M,u,y,h,W,f,z,G,a,v,O,L,S,B,C,i,Z,E,l){const s=(K,H,M,u,y,h,W,I,f,z,G)=>{const a=M.getTangents(),v=M.getNormals(),O=M.getBinormals(),L=M.getDistances();if(G)for(let w=0;w<a.length;w++)if(0==a[w].x&&0==a[w].y&&0==a[w].z&&a[w].q(a[w-1]),0==v[w].x&&0==v[w].y&&0==v[w].z&&v[w].q(v[w-1]),0==O[w].x&&0==O[w].y&&0==O[w].z&&O[w].q(O[w-1]),w>0){let K=a[w-1];q.OH.Dot(K,a[w])<0&&a[w].scaleInPlace(-1),K=v[w-1],q.OH.Dot(K,v[w])<0&&v[w].scaleInPlace(-1),K=O[w-1],q.OH.Dot(K,O[w])<0&&O[w].scaleInPlace(-1)}let S=0;const B=z&&I?I:()=>null!==h?h:0,C=z&&W?W:()=>null!==y?y:1;let i=f===w.b.NO_CAP||f===w.b.CAP_END?0:2;const Z=q.TmpVectors.Matrix[0];for(let w=0;w<H.length;w++){const M=[],y=B(w,L[w]),h=C(w,L[w]);q.Matrix.RotationAxisToRef(a[w],S,Z);for(let u=0;u<K.length;u++){const y=a[w].scale(K[u].z).add(v[w].scale(K[u].x)).add(O[w].scale(K[u].y)),W=q.OH.Zero();q.OH.TransformCoordinatesToRef(y,Z,W),W.scaleInPlace(h).addInPlace(H[w]),M[u]=W}u[i]=M,S+=y,i++}const E=l||(K=>{const H=Array(),M=q.OH.Zero();let w;for(w=0;w<K.length;w++)M.addInPlace(K[w]);for(M.scaleInPlace(1/K.length),w=0;w<K.length;w++)H.push(M);return H});switch(f){case w.b.NO_CAP:break;case w.b.CAP_START:u[0]=E(u[2]),u[1]=u[2];break;case w.b.CAP_END:u[i]=u[i-1],u[i+1]=E(u[i-1]);break;case w.b.CAP_ALL:u[0]=E(u[2]),u[1]=u[2],u[i]=u[i-1],u[i+1]=E(u[i-1])}return u};let D,V;if(S){const K=S._creationDataStorage;return D=Z?K.path3D.update(M,Z):K.path3D.update(M),V=s(H,M,K.path3D,K.pathArray,u,y,h,W,K.cap,a,E),S=I("",{pathArray:V,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:S},v||void 0)}D=Z?new c.m(M,Z):new c.m(M);V=s(H,M,D,new Array,u,y,h,W,G=G<0||G>3?0:G,a,E);const n=I(K,{pathArray:V,closeArray:f,closePath:z,updatable:O,sideOrientation:L,invertUV:B,frontUVs:C||void 0,backUVs:i||void 0},v);return n._creationDataStorage.pathArray=V,n._creationDataStorage.path3D=D,n._creationDataStorage.cap=G,n}function x(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=H.arc?H.arc<=0||H.arc>1?1:H.arc:1,y=void 0===H.closed||H.closed,h=H.shape,W=H.radius||1,f=H.tessellation||64,z=H.clip||0,G=H.updatable,a=w.b._GetDefaultSideOrientation(H.sideOrientation),v=H.cap||w.b.NO_CAP,O=2*Math.PI,L=[],S=H.invertUV||!1;let B=0,C=0;const i=O/f*u;let Z,E;for(B=0;B<=f-z;B++){for(E=[],v!=w.b.CAP_START&&v!=w.b.CAP_ALL||(E.push(new q.OH(0,h[0].y,0)),E.push(new q.OH(Math.cos(B*i)*h[0].x*W,h[0].y,Math.sin(B*i)*h[0].x*W))),C=0;C<h.length;C++)Z=new q.OH(Math.cos(B*i)*h[C].x*W,h[C].y,Math.sin(B*i)*h[C].x*W),E.push(Z);v!=w.b.CAP_END&&v!=w.b.CAP_ALL||(E.push(new q.OH(Math.cos(B*i)*h[h.length-1].x*W,h[h.length-1].y,Math.sin(B*i)*h[h.length-1].x*W)),E.push(new q.OH(0,h[h.length-1].y,0))),L.push(E)}return I(K,{pathArray:L,closeArray:y,sideOrientation:a,updatable:G,invertUV:S,frontUVs:H.frontUVs,backUVs:H.backUVs},M)}w.b.ExtrudeShape=function(K,H,M,q,u,y){let h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0,f=arguments.length>9?arguments[9]:void 0;return k(K,{shape:H,path:M,scale:q,rotation:u,cap:0===y?0:y||w.b.NO_CAP,sideOrientation:I,instance:f,updatable:W},h)},w.b.ExtrudeShapeCustom=(K,H,M,q,u,y,h,W,I,f,z,G)=>T(K,{shape:H,path:M,scaleFunction:q,rotationFunction:u,ribbonCloseArray:y,ribbonClosePath:h,cap:0===W?0:W||w.b.NO_CAP,sideOrientation:z,instance:G,updatable:f},I);w.b.CreateLathe=(K,H,M,q,w,u,y)=>x(K,{shape:H,radius:M,tessellation:q,sideOrientation:y,updatable:u},w);var Q=M(12589),J=M(12538);function N(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=H.path;let y=H.instance,h=1;void 0!==H.radius?h=H.radius:y&&(h=y._creationDataStorage.radius);const W=H.tessellation||64,f=H.radiusFunction||null;let z=H.cap||w.b.NO_CAP;const G=H.invertUV||!1,a=H.updatable,v=w.b._GetDefaultSideOrientation(H.sideOrientation);H.arc=H.arc&&(H.arc<=0||H.arc>1)?1:H.arc||1;const O=(K,H,M,u,y,h,W,I)=>{const f=H.getTangents(),z=H.getNormals(),G=H.getDistances(),a=2*Math.PI/y*I,v=h||(()=>u);let O,L,S,B;const C=q.TmpVectors.Matrix[0];let i=W===w.b.NO_CAP||W===w.b.CAP_END?0:2;for(let w=0;w<K.length;w++){L=v(w,G[w]),O=Array(),S=z[w];for(let H=0;H<y;H++)q.Matrix.RotationAxisToRef(f[w],a*H,C),B=O[H]?O[H]:q.OH.Zero(),q.OH.TransformCoordinatesToRef(S,C,B),B.scaleInPlace(L).addInPlace(K[w]),O[H]=B;M[i]=O,i++}const Z=(H,M)=>{const q=Array();for(let w=0;w<H;w++)q.push(K[M]);return q};switch(W){case w.b.NO_CAP:break;case w.b.CAP_START:M[0]=Z(y,0),M[1]=M[2].slice(0);break;case w.b.CAP_END:M[i]=M[i-1].slice(0),M[i+1]=Z(y,K.length-1);break;case w.b.CAP_ALL:M[0]=Z(y,0),M[1]=M[2].slice(0),M[i]=M[i-1].slice(0),M[i+1]=Z(y,K.length-1)}return M};let L,S;if(y){const K=y._creationDataStorage,M=H.arc||K.arc;return L=K.path3D.update(u),S=O(u,L,K.pathArray,h,K.tessellation,f,K.cap,M),y=I("",{pathArray:S,instance:y}),K.path3D=L,K.pathArray=S,K.arc=M,K.radius=h,y}L=new c.m(u);z=z<0||z>3?0:z,S=O(u,L,new Array,h,W,f,z,H.arc);const B=I(K,{pathArray:S,closePath:!0,closeArray:!1,updatable:a,sideOrientation:v,invertUV:G,frontUVs:H.frontUVs,backUVs:H.backUVs},M);return B._creationDataStorage.pathArray=S,B._creationDataStorage.path3D=L,B._creationDataStorage.tessellation=W,B._creationDataStorage.cap=z,B._creationDataStorage.arc=H.arc,B._creationDataStorage.radius=h,B}function p(K){const H=[];H[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},H[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},H[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},H[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},H[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},H[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},H[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},H[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},H[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},H[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},H[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},H[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},H[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},H[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},H[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const M=K.type&&(K.type<0||K.type>=H.length)?0:K.type||0,w=K.size,u=K.sizeX||w||1,W=K.sizeY||w||1,I=K.sizeZ||w||1,f=K.custom||H[M],z=f.face.length,a=K.faceUV||new Array(z),v=K.faceColors,O=void 0===K.flat||K.flat,L=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE,S=[],B=[],C=[],i=[],Z=[];let E=0,l=0;const s=[];let D,V,n,c,k,T,d=0,x=0;if(O)for(x=0;x<z;x++)v&&void 0===v[x]&&(v[x]=new G.Ch(1,1,1,1)),a&&void 0===a[x]&&(a[x]=new q.Vector4(0,0,1,1));if(O)for(x=0;x<z;x++){const K=f.face[x].length;for(n=2*Math.PI/K,c=.5*Math.tan(n/2),k=.5,d=0;d<K;d++)S.push(f.vertex[f.face[x][d]][0]*u,f.vertex[f.face[x][d]][1]*W,f.vertex[f.face[x][d]][2]*I),s.push(E),E++,D=a[x].x+(a[x].z-a[x].x)*(.5+c),V=a[x].y+(a[x].w-a[x].y)*(k-.5),i.push(D,h.b?1-V:V),T=c*Math.cos(n)-k*Math.sin(n),k=c*Math.sin(n)+k*Math.cos(n),c=T,v&&Z.push(v[x].r,v[x].g,v[x].b,v[x].a);for(d=0;d<K-2;d++)B.push(s[0+l],s[d+2+l],s[d+1+l]);l+=K}else{for(d=0;d<f.vertex.length;d++)S.push(f.vertex[d][0]*u,f.vertex[d][1]*W,f.vertex[d][2]*I),i.push(0,h.b?1:0);for(x=0;x<z;x++)for(d=0;d<f.face[x].length-2;d++)B.push(f.face[x][0],f.face[x][d+2],f.face[x][d+1])}y.d.ComputeNormals(S,B,C),y.d._ComputeSides(L,S,B,C,i,K.frontUVs,K.backUVs);const Q=new y.d;return Q.VK=S,Q.indices=B,Q.nK=C,Q.kK=i,v&&O&&(Q.cK=Z),Q}function o(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return p(H).dK(q,H.updatable),q}w.b.CreateTube=(K,H,M,q,w,u,y,h,W,I)=>N(K,{path:H,radius:M,tessellation:q,radiusFunction:w,arc:1,cap:u,updatable:h,sideOrientation:W,instance:I},y);function R(K){const H=K.sideOrientation||y.d.DEFAULTSIDE,M=K.radius||1,w=void 0===K.flat||K.flat,u=0|(K.subdivisions||4),W=K.radiusX||M,I=K.radiusY||M,f=K.radiusZ||M,z=(1+Math.sqrt(5))/2,G=[-1,z,-0,1,z,0,-1,-z,0,1,-z,0,0,-1,-z,0,1,-z,0,-1,z,0,1,z,z,0,1,z,0,-1,-z,0,1,-z,0,-1],a=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],v=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],O=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],L=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],S=[],B=[],C=[],i=[];let Z=0;const E=new Array(3),l=new Array(3);let s;for(s=0;s<3;s++)E[s]=q.OH.Zero(),l[s]=q.Vector2.Zero();for(let y=0;y<20;y++){for(s=0;s<3;s++){const K=a[3*y+s];E[s].Lh(G[3*v[K]],G[3*v[K]+1],G[3*v[K]+2]),E[s].normalize(),l[s].Lh(.134765625*O[2*K]+.05859375+-.0390625*L[y],.2333984375*O[2*K+1]+.025390625+.01953125*L[y])}const K=(K,H,M,y)=>{const z=q.OH.Lerp(E[0],E[2],H/u),G=q.OH.Lerp(E[1],E[2],H/u),a=u===H?E[2]:q.OH.Lerp(z,G,K/(u-H));let v;if(a.normalize(),w){const K=q.OH.Lerp(E[0],E[2],y/u),H=q.OH.Lerp(E[1],E[2],y/u);v=q.OH.Lerp(K,H,M/(u-y))}else v=new q.OH(a.x,a.y,a.z);v.x/=W,v.y/=I,v.z/=f,v.normalize();const O=q.Vector2.Lerp(l[0],l[2],H/u),L=q.Vector2.Lerp(l[1],l[2],H/u),s=u===H?l[2]:q.Vector2.Lerp(O,L,K/(u-H));B.push(a.x*W,a.y*I,a.z*f),C.push(v.x,v.y,v.z),i.push(s.x,h.b?1-s.y:s.y),S.push(Z),Z++};for(let H=0;H<u;H++)for(let M=0;M+H<u;M++)K(M,H,M+1/3,H+1/3),K(M+1,H,M+1/3,H+1/3),K(M,H+1,M+1/3,H+1/3),M+H+1<u&&(K(M+1,H,M+2/3,H+2/3),K(M+1,H+1,M+2/3,H+2/3),K(M,H+1,M+2/3,H+2/3))}y.d._ComputeSides(H,B,S,C,i,K.frontUVs,K.backUVs);const D=new y.d;return D.indices=S,D.VK=B,D.nK=C,D.kK=i,D}function t(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const q=new w.b(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),q._originalBuilderSideOrientation=H.sideOrientation;return R(H).dK(q,H.updatable),q}y.d.CreatePolyhedron=p,w.b.CreatePolyhedron=(K,H,M)=>o(K,H,M);y.d.CreateIcoSphere=R,w.b.CreateIcoSphere=(K,H,M)=>t(K,H,M);var U=M(11307);const j=new q.OH(1,0,0),m=new q.OH(-1,0,0),F=new q.OH(0,1,0),Y=new q.OH(0,-1,0),r=new q.OH(0,0,1),e=new q.OH(0,0,-1);class b{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.OH.Zero(),H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.OH.Up(),M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.Vector2.Zero(),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=K,this.normal=H,this.uv=M,this.vertexIdx=w,this.vertexIdxForBones=u,this.localPositionOverride=y,this.localNormalOverride=h,this.matrixIndicesOverride=W,this.matrixWeightsOverride=I}clone(){var K,H,M,q;return new b(this.position.clone(),this.normal.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(K=this.localPositionOverride)||void 0===K?void 0:K.slice(),null===(H=this.localNormalOverride)||void 0===H?void 0:H.slice(),null===(M=this.matrixIndicesOverride)||void 0===M?void 0:M.slice(),null===(q=this.matrixWeightsOverride)||void 0===q?void 0:q.slice())}}function P(K,H,M){var W,I,f,z,G;const a=!!H.skeleton,v=!(null===(W=H.morphTargetManager)||void 0===W||!W.numTargets),O=M.localMode||a,L=H.ah(),S=a||v?H.Nh(!0,!0):H.getVerticesData(u.d.PositionKind),B=a||v?H.getNormalsData(!0,!0):H.getVerticesData(u.d.NormalKind),C=O?a?H.getVerticesData(u.d.PositionKind):S:null,i=O?a?H.getVerticesData(u.d.NormalKind):B:null,Z=H.getVerticesData(u.d.UVKind),E=a?H.getVerticesData(u.d.MatricesIndicesKind):null,l=a?H.getVerticesData(u.d.MatricesWeightsKind):null,s=a?H.getVerticesData(u.d.MatricesIndicesExtraKind):null,D=a?H.getVerticesData(u.d.MatricesWeightsExtraKind):null,V=M.position||q.OH.Zero();let n=M.normal||q.OH.Up();const c=M.size||q.OH.One(),k=M.angle||0;if(!n){const K=new q.OH(0,0,1),M=H.sK().activeCamera,w=q.OH.TransformCoordinates(K,M.getWorldMatrix());n=M.globalPosition.LH(w)}const T=-Math.atan2(n.z,n.x)-Math.PI/2,d=Math.sqrt(n.x*n.x+n.z*n.z),x=Math.atan2(n.y,d),Q=new y.d;Q.indices=[],Q.VK=[],Q.nK=[],Q.kK=[],Q.matricesIndices=a?[]:null,Q.matricesWeights=a?[]:null,Q.matricesIndicesExtra=s?[]:null,Q.matricesWeightsExtra=D?[]:null;let J=0;const N=(K,H)=>{const w=new b;if(!L||!S||!B)return w;const u=L[K];if(w.vertexIdx=3*u,w.vertexIdxForBones=4*u,w.position=new q.OH(S[3*u],S[3*u+1],S[3*u+2]),q.OH.TransformCoordinatesToRef(w.position,H,w.position),w.normal=new q.OH(B[3*u],B[3*u+1],B[3*u+2]),q.OH.TransformNormalToRef(w.normal,H,w.normal),M.captureUVS&&Z){const K=Z[2*u+1];w.uv=new q.Vector2(Z[2*u],h.b?1-K:K)}return w},p=[0,0,0,0],o=(K,H)=>{if(0===K.length)return K;const M=.5*Math.abs(q.OH.Dot(c,H)),w=(K,H,M,q)=>{for(let w=0;w<q;++w)if(K[M+w]===H)return M+w;return-1},u=(K,u)=>{const y=q.OH.GetClipFactor(K.position,u.position,H,M);let h=p,W=p;if(E&&l){const H=K.matrixIndicesOverride?0:K.vertexIdxForBones,M=K.matrixIndicesOverride??E,q=K.matrixWeightsOverride??l,I=u.matrixIndicesOverride?0:u.vertexIdxForBones,f=u.matrixIndicesOverride??E,z=u.matrixWeightsOverride??l;h=[0,0,0,0],W=[0,0,0,0];let G=0;for(let K=0;K<4;++K)if(q[H+K]>0){const u=w(f,M[H+K],I,4);h[G]=M[H+K],W[G]=(0,U.Lerp)(q[H+K],u>=0?z[u]:0,y),G++}for(let K=0;K<4&&G<4;++K){const q=f[I+K];-1===w(M,q,H,4)&&(h[G]=q,W[G]=(0,U.Lerp)(0,z[I+K],y),G++)}const a=W[0]+W[1]+W[2]+W[3];W[0]/=a,W[1]/=a,W[2]/=a,W[3]/=a}const I=K.localPositionOverride?K.localPositionOverride[0]:(null===C||void 0===C?void 0:C[K.vertexIdx])??0,f=K.localPositionOverride?K.localPositionOverride[1]:(null===C||void 0===C?void 0:C[K.vertexIdx+1])??0,z=K.localPositionOverride?K.localPositionOverride[2]:(null===C||void 0===C?void 0:C[K.vertexIdx+2])??0,G=u.localPositionOverride?u.localPositionOverride[0]:(null===C||void 0===C?void 0:C[u.vertexIdx])??0,a=u.localPositionOverride?u.localPositionOverride[1]:(null===C||void 0===C?void 0:C[u.vertexIdx+1])??0,v=u.localPositionOverride?u.localPositionOverride[2]:(null===C||void 0===C?void 0:C[u.vertexIdx+2])??0,O=K.localNormalOverride?K.localNormalOverride[0]:(null===i||void 0===i?void 0:i[K.vertexIdx])??0,L=K.localNormalOverride?K.localNormalOverride[1]:(null===i||void 0===i?void 0:i[K.vertexIdx+1])??0,S=K.localNormalOverride?K.localNormalOverride[2]:(null===i||void 0===i?void 0:i[K.vertexIdx+2])??0,B=O+((u.localNormalOverride?u.localNormalOverride[0]:(null===i||void 0===i?void 0:i[u.vertexIdx])??0)-O)*y,Z=L+((u.localNormalOverride?u.localNormalOverride[1]:(null===i||void 0===i?void 0:i[u.vertexIdx+1])??0)-L)*y,s=S+((u.localNormalOverride?u.localNormalOverride[2]:(null===i||void 0===i?void 0:i[u.vertexIdx+2])??0)-S)*y,D=Math.sqrt(B*B+Z*Z+s*s);return new b(q.OH.Lerp(K.position,u.position,y),q.OH.Lerp(K.normal,u.normal,y).normalize(),q.Vector2.Lerp(K.uv,u.uv,y),-1,-1,C?[I+(G-I)*y,f+(a-f)*y,z+(v-z)*y]:null,i?[B/D,Z/D,s/D]:null,h,W)};let y=null;K.length>3&&(y=[]);for(let h=0;h<K.length;h+=3){let w=0,W=null,I=null,f=null,z=null;const G=q.OH.Dot(K[h].position,H)-M>0,a=q.OH.Dot(K[h+1].position,H)-M>0,v=q.OH.Dot(K[h+2].position,H)-M>0;switch(w=(G?1:0)+(a?1:0)+(v?1:0),w){case 0:K.length>3?(y.push(K[h]),y.push(K[h+1]),y.push(K[h+2])):y=K;break;case 1:if(y=y??new Array,G&&(W=K[h+1],I=K[h+2],f=u(K[h],W),z=u(K[h],I)),a){W=K[h],I=K[h+2],f=u(K[h+1],W),z=u(K[h+1],I),y.push(f),y.push(I.clone()),y.push(W.clone()),y.push(I.clone()),y.push(f.clone()),y.push(z);break}v&&(W=K[h],I=K[h+1],f=u(K[h+2],W),z=u(K[h+2],I)),W&&I&&f&&z&&(y.push(W.clone()),y.push(I.clone()),y.push(f),y.push(z),y.push(f.clone()),y.push(I.clone()));break;case 2:y=y??new Array,G||(W=K[h].clone(),I=u(W,K[h+1]),f=u(W,K[h+2]),y.push(W),y.push(I),y.push(f)),a||(W=K[h+1].clone(),I=u(W,K[h+2]),f=u(W,K[h]),y.push(W),y.push(I),y.push(f)),v||(W=K[h+2].clone(),I=u(W,K[h]),f=u(W,K[h+1]),y.push(W),y.push(I),y.push(f))}}return y},R=H instanceof w.b?H:null,t=null===R||void 0===R?void 0:R._thinInstanceDataStorage.matrixData,P=(null===R||void 0===R?void 0:R.Zh)||1,g=q.TmpVectors.Matrix[0];g.q(q.Matrix.IdentityReadOnly);for(let w=0;w<P;++w){if(null!==R&&void 0!==R&&R.hasThinInstances&&t){const K=16*w;g.setRowFromFloats(0,t[K+0],t[K+1],t[K+2],t[K+3]),g.setRowFromFloats(1,t[K+4],t[K+5],t[K+6],t[K+7]),g.setRowFromFloats(2,t[K+8],t[K+9],t[K+10],t[K+11]),g.setRowFromFloats(3,t[K+12],t[K+13],t[K+14],t[K+15])}const K=q.Matrix.RotationYawPitchRoll(T,x,k).multiply(q.Matrix.Translation(V.x,V.y,V.z)),u=q.Matrix.Invert(K),y=H.getWorldMatrix(),W=g.multiply(y).multiply(u),I=new Array(3);for(let H=0;H<L.length;H+=3){let K=I;if(K[0]=N(H,W),K[1]=N(H+1,W),K[2]=N(H+2,W),!(M.cullBackFaces&&-K[0].normal.z<=0&&-K[1].normal.z<=0&&-K[2].normal.z<=0)&&(K=o(K,j),K&&(K=o(K,m),K&&(K=o(K,F),K&&(K=o(K,Y),K&&(K=o(K,r),K&&(K=o(K,e),K)))))))for(let H=0;H<K.length;H++){const q=K[H];if(Q.indices.push(J),O?(q.localPositionOverride?(Q.VK[3*J]=q.localPositionOverride[0],Q.VK[3*J+1]=q.localPositionOverride[1],Q.VK[3*J+2]=q.localPositionOverride[2]):C&&(Q.VK[3*J]=C[q.vertexIdx],Q.VK[3*J+1]=C[q.vertexIdx+1],Q.VK[3*J+2]=C[q.vertexIdx+2]),q.localNormalOverride?(Q.nK[3*J]=q.localNormalOverride[0],Q.nK[3*J+1]=q.localNormalOverride[1],Q.nK[3*J+2]=q.localNormalOverride[2]):i&&(Q.nK[3*J]=i[q.vertexIdx],Q.nK[3*J+1]=i[q.vertexIdx+1],Q.nK[3*J+2]=i[q.vertexIdx+2])):(q.position.toArray(Q.VK,3*J),q.normal.toArray(Q.nK,3*J)),Q.matricesIndices&&Q.matricesWeights&&(q.matrixIndicesOverride?(Q.matricesIndices[4*J]=q.matrixIndicesOverride[0],Q.matricesIndices[4*J+1]=q.matrixIndicesOverride[1],Q.matricesIndices[4*J+2]=q.matrixIndicesOverride[2],Q.matricesIndices[4*J+3]=q.matrixIndicesOverride[3]):(E&&(Q.matricesIndices[4*J]=E[q.vertexIdxForBones],Q.matricesIndices[4*J+1]=E[q.vertexIdxForBones+1],Q.matricesIndices[4*J+2]=E[q.vertexIdxForBones+2],Q.matricesIndices[4*J+3]=E[q.vertexIdxForBones+3]),s&&Q.matricesIndicesExtra&&(Q.matricesIndicesExtra[4*J]=s[q.vertexIdxForBones],Q.matricesIndicesExtra[4*J+1]=s[q.vertexIdxForBones+1],Q.matricesIndicesExtra[4*J+2]=s[q.vertexIdxForBones+2],Q.matricesIndicesExtra[4*J+3]=s[q.vertexIdxForBones+3])),q.matrixWeightsOverride?(Q.matricesWeights[4*J]=q.matrixWeightsOverride[0],Q.matricesWeights[4*J+1]=q.matrixWeightsOverride[1],Q.matricesWeights[4*J+2]=q.matrixWeightsOverride[2],Q.matricesWeights[4*J+3]=q.matrixWeightsOverride[3]):(l&&(Q.matricesWeights[4*J]=l[q.vertexIdxForBones],Q.matricesWeights[4*J+1]=l[q.vertexIdxForBones+1],Q.matricesWeights[4*J+2]=l[q.vertexIdxForBones+2],Q.matricesWeights[4*J+3]=l[q.vertexIdxForBones+3]),D&&Q.matricesWeightsExtra&&(Q.matricesWeightsExtra[4*J]=D[q.vertexIdxForBones],Q.matricesWeightsExtra[4*J+1]=D[q.vertexIdxForBones+1],Q.matricesWeightsExtra[4*J+2]=D[q.vertexIdxForBones+2],Q.matricesWeightsExtra[4*J+3]=D[q.vertexIdxForBones+3]))),M.captureUVS)q.uv.toArray(Q.kK,2*J);else{Q.kK.push(.5+q.position.x/c.x);const K=.5+q.position.y/c.y;Q.kK.push(h.b?1-K:K)}J++}}}0===Q.indices.length&&(Q.indices=null),0===Q.VK.length&&(Q.VK=null),0===Q.nK.length&&(Q.nK=null),0===Q.kK.length&&(Q.kK=null),0===(null===(I=Q.matricesIndices)||void 0===I?void 0:I.length)&&(Q.matricesIndices=null),0===(null===(f=Q.matricesWeights)||void 0===f?void 0:f.length)&&(Q.matricesWeights=null),0===(null===(z=Q.matricesIndicesExtra)||void 0===z?void 0:z.length)&&(Q.matricesIndicesExtra=null),0===(null===(G=Q.matricesWeightsExtra)||void 0===G?void 0:G.length)&&(Q.matricesWeightsExtra=null);const X=new w.b(K,H.sK());return Q.dK(X),O?(X.skeleton=H.skeleton,X.parent=H):(X.position=V.clone(),X.rotation=new q.OH(x,T,k)),X.zh(!0),X.refreshBoundingInfo(!0,!0),X}function g(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const H=0|Math.max(K.subdivisions?K.subdivisions:2,1),M=0|Math.max(K.tessellation?K.tessellation:16,3),w=Math.max(K.height?K.height:1,0),u=Math.max(K.radius?K.radius:.25,0),W=0|Math.max(K.capSubdivisions?K.capSubdivisions:6,1),I=M,f=H,z=Math.max(K.radiusTop?K.radiusTop:u,0),G=Math.max(K.radiusBottom?K.radiusBottom:u,0),a=w-(z+G),v=2*Math.PI,O=Math.max(K.topCapSubdivisions?K.topCapSubdivisions:W,1),L=Math.max(K.bottomCapSubdivisions?K.bottomCapSubdivisions:W,1),S=Math.acos((G-z)/w);let B=[];const C=[],i=[],Z=[];let E=0;const l=[],s=.5*a,D=.5*Math.PI;let V,n;const c=q.OH.Zero(),k=q.OH.Zero(),T=Math.cos(S),d=Math.sin(S),x=new q.Vector2(z*d,s+z*T).LH(new q.Vector2(G*d,G*T-s)).length(),Q=z*S+x+G*(D-S);let J=0;for(n=0;n<=O;n++){const K=[],H=D-S*(n/O);J+=z*S/O;const M=Math.cos(H),q=Math.sin(H),w=M*z;for(V=0;V<=I;V++){const H=V/I,u=H*v+0,y=Math.sin(u),W=Math.cos(u);k.x=w*y,k.y=s+q*z,k.z=w*W,C.push(k.x,k.y,k.z),c.set(M*y,q,M*W),i.push(c.x,c.y,c.z),Z.push(H,h.b?J/Q:1-J/Q),K.push(E),E++}l.push(K)}const N=w-z-G+T*z-T*G,p=d*(G-z)/N;for(n=1;n<=f;n++){const K=[];J+=x/f;const H=d*(n*(G-z)/f+z);for(V=0;V<=I;V++){const M=V/I,q=M*v+0,w=Math.sin(q),u=Math.cos(q);k.x=H*w,k.y=s+T*z-n*N/f,k.z=H*u,C.push(k.x,k.y,k.z),c.set(w,p,u).normalize(),i.push(c.x,c.y,c.z),Z.push(M,h.b?J/Q:1-J/Q),K.push(E),E++}l.push(K)}for(n=1;n<=L;n++){const K=[],H=D-S-(Math.PI-S)*(n/L);J+=G*S/L;const M=Math.cos(H),q=Math.sin(H),w=M*G;for(V=0;V<=I;V++){const H=V/I,u=H*v+0,y=Math.sin(u),W=Math.cos(u);k.x=w*y,k.y=q*G-s,k.z=w*W,C.push(k.x,k.y,k.z),c.set(M*y,q,M*W),i.push(c.x,c.y,c.z),Z.push(H,h.b?J/Q:1-J/Q),K.push(E),E++}l.push(K)}for(V=0;V<I;V++)for(n=0;n<O+f+L;n++){const K=l[n][V],H=l[n+1][V],M=l[n+1][V+1],q=l[n][V+1];B.push(K),B.push(H),B.push(q),B.push(H),B.push(M),B.push(q)}if(B=B.reverse(),K.orientation&&!K.orientation.equals(q.OH.Up())){const H=new q.Matrix;K.orientation.clone().scale(.5*Math.PI).cross(q.OH.Up()).toQuaternion().toRotationMatrix(H);const M=q.OH.Zero();for(let K=0;K<C.length;K+=3)M.set(C[K],C[K+1],C[K+2]),q.OH.TransformCoordinatesToRef(M.clone(),H,M),C[K]=M.x,C[K+1]=M.y,C[K+2]=M.z}const o=new y.d;return o.VK=C,o.nK=i,o.kK=Z,o.indices=B,o}function X(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:q.OH.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=new w.b(K,M);return g(H).dK(u,H.updatable),u}w.b.CreateDecal=(K,H,M,q,w,u)=>P(K,H,{position:M,normal:q,size:w,angle:u});w.b.CreateCapsule=(K,H,M)=>X(K,H,M),y.d.CreateCapsule=g;var A=M(11112),KK=M(11297);class HK{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=K,this.y=H,K!==Math.floor(K)&&(K=Math.floor(K),A.e.Warn("x is not an integer, floor(x) used")),H!==Math.floor(H)&&(H=Math.floor(H),A.e.Warn("y is not an integer, floor(y) used"))}clone(){return new HK(this.x,this.y)}rotate60About(K){const H=this.x;return this.x=K.x+K.y-this.y,this.y=H+this.y-K.x,this}rotateNeg60About(K){const H=this.x;return this.x=H+this.y-K.y,this.y=K.x+K.y-H,this}rotate120(K,H){K!==Math.floor(K)&&(K=Math.floor(K),A.e.Warn("m not an integer only floor(m) used")),H!==Math.floor(H)&&(H=Math.floor(H),A.e.Warn("n not an integer only floor(n) used"));const M=this.x;return this.x=K-M-this.y,this.y=H+M,this}rotateNeg120(K,H){K!==Math.floor(K)&&(K=Math.floor(K),A.e.Warn("m is not an integer, floor(m) used")),H!==Math.floor(H)&&(H=Math.floor(H),A.e.Warn("n is not an integer,   floor(n) used"));const M=this.x;return this.x=this.y-H,this.y=K+H-M-this.y,this}toCartesianOrigin(K,H){const M=q.OH.Zero();return M.x=K.x+2*this.x*H+this.y*H,M.y=K.y+Math.sqrt(3)*this.y*H,M}static Zero(){return new HK(0,0)}}class MK{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new qK("icosahedron","Regular",[[0,KK.e,-1],[-KK.e,1,0],[-1,0,-KK.e],[1,0,-KK.e],[KK.e,1,0],[0,KK.e,1],[-1,0,KK.e],[-KK.e,-1,0],[0,-KK.e,-1],[KK.e,-1,0],[1,0,KK.e],[0,-KK.e,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let K=12;const H={},M=this.m,q=this.n;let w,u,y,h,W,I=M,f=1,z=0;0!==q&&(I=(0,U.HighestCommonFactor)(M,q)),f=M/I,z=q/I;const G=HK.Zero(),a=new HK(M,q),v=new HK(-q,M+q),O=HK.Zero(),L=HK.Zero(),S=HK.Zero();let B,C,i,Z,E=[];const l=[],s=this.vertByDist,D=(M,q,w,u)=>{B=M+"|"+w,C=q+"|"+u,B in H||C in H?B in H&&!(C in H)?H[C]=H[B]:C in H&&!(B in H)&&(H[B]=H[C]):(H[B]=K,H[C]=K,K++),s[w][0]>2?l[H[B]]=[-s[w][0],s[w][1],H[B]]:l[H[B]]=[E[s[w][0]],s[w][1],H[B]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let V=0;V<20;V++){if(E=this.IDATA.face[V],y=E[2],h=E[1],W=E[0],i=G.x+"|"+G.y,B=V+"|"+i,B in H||(H[B]=y,l[y]=[E[s[i][0]],s[i][1]]),i=a.x+"|"+a.y,B=V+"|"+i,B in H||(H[B]=h,l[h]=[E[s[i][0]],s[i][1]]),i=v.x+"|"+v.y,B=V+"|"+i,B in H||(H[B]=W,l[W]=[E[s[i][0]],s[i][1]]),w=this.IDATA.edgematch[V][0],u=this.IDATA.edgematch[V][1],"B"===u)for(let K=1;K<I;K++)L.x=M-K*(f+z),L.y=q+K*f,S.x=-K*z,S.y=K*(f+z),i=L.x+"|"+L.y,Z=S.x+"|"+S.y,D(V,w,i,Z);if("O"===u)for(let K=1;K<I;K++)S.x=-K*z,S.y=K*(f+z),O.x=K*f,O.y=K*z,i=S.x+"|"+S.y,Z=O.x+"|"+O.y,D(V,w,i,Z);if(w=this.IDATA.edgematch[V][2],u=this.IDATA.edgematch[V][3],u&&"A"===u)for(let K=1;K<I;K++)O.x=K*f,O.y=K*z,L.x=M-(I-K)*(f+z),L.y=q+(I-K)*f,i=O.x+"|"+O.y,Z=L.x+"|"+L.y,D(V,w,i,Z);for(let M=0;M<this.vertices.length;M++)i=this.vertices[M].x+"|"+this.vertices[M].y,B=V+"|"+i,B in H||(H[B]=K++,s[i][0]>2?l[H[B]]=[-s[i][0],s[i][1],H[B]]:l[H[B]]=[E[s[i][0]],s[i][1],H[B]])}this.closestTo=l,this.vecToidx=H}calcCoeffs(){const K=this.m,H=this.n,M=Math.sqrt(3)/3,q=K*K+H*H+K*H;this.coau=(K+H)/q,this.cobu=-H/q,this.coav=-M*(K-H)/q,this.cobv=M*(2*K+H)/q}createInnerFacets(){const K=this.m,H=this.n;for(let M=0;M<H+K+1;M++)for(let K=this.min[M];K<this.max[M]+1;K++)K<this.max[M]&&K<this.max[M+1]+1&&this.innerFacets.push(["|"+K+"|"+M,"|"+K+"|"+(M+1),"|"+(K+1)+"|"+M]),M>0&&K<this.max[M-1]&&K+1<this.max[M]+1&&this.innerFacets.push(["|"+K+"|"+M,"|"+(K+1)+"|"+M,"|"+(K+1)+"|"+(M-1)])}edgeVecsABOB(){const K=this.m,H=this.n,M=new HK(-H,K+H);for(let q=1;q<K+H;q++){const K=new HK(this.min[q],q),H=new HK(this.min[q-1],q-1),w=new HK(this.min[q+1],q+1),u=K.clone(),y=H.clone(),h=w.clone();u.rotate60About(M),y.rotate60About(M),h.rotate60About(M);const W=new HK(this.max[u.y],u.y),I=new HK(this.max[u.y-1],u.y-1),f=new HK(this.max[u.y-1]-1,u.y-1);u.x===W.x&&u.y===W.y||(u.x!==I.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,I,f]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,f,W])):u.y===h.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,H,I]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([K,I,w])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,H,I]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,I,W])))}}mapABOBtoOBOA(){const K=new HK(0,0);for(let H=0;H<this.isoVecsABOB.length;H++){const M=[];for(let q=0;q<3;q++)K.x=this.isoVecsABOB[H][q].x,K.y=this.isoVecsABOB[H][q].y,0===this.vertexTypes[H][q]&&K.rotateNeg120(this.m,this.n),M.push(K.clone());this.isoVecsOBOA.push(M)}}mapABOBtoBAOA(){const K=new HK(0,0);for(let H=0;H<this.isoVecsABOB.length;H++){const M=[];for(let q=0;q<3;q++)K.x=this.isoVecsABOB[H][q].x,K.y=this.isoVecsABOB[H][q].y,1===this.vertexTypes[H][q]&&K.rotate120(this.m,this.n),M.push(K.clone());this.isoVecsBAOA.push(M)}}MapToFace(K,H){const M=this.IDATA.face[K],w=M[2],u=M[1],y=M[0],h=q.OH.iH(this.IDATA.vertex[w]),W=q.OH.iH(this.IDATA.vertex[u]),I=q.OH.iH(this.IDATA.vertex[y]),f=W.LH(h),z=I.LH(h),G=f.scale(this.coau).add(z.scale(this.cobu)),a=f.scale(this.coav).add(z.scale(this.cobv)),v=[];let O,L=q.TmpVectors.OH[0];for(let q=0;q<this.cartesian.length;q++)L=G.scale(this.cartesian[q].x).add(a.scale(this.cartesian[q].y)).add(h),v[q]=[L.x,L.y,L.z],O=K+"|"+this.vertices[q].x+"|"+this.vertices[q].y,H.vertex[this.vecToidx[O]]=[L.x,L.y,L.z]}build(K,H){const M=[],q=HK.Zero(),w=new HK(K,H),u=new HK(-H,K+H);M.push(q,w,u);for(let i=H;i<K+1;i++)for(let H=0;H<K+1-i;H++)M.push(new HK(H,i));if(H>0){const q=(0,U.HighestCommonFactor)(K,H),w=K/q,u=H/q;for(let h=1;h<q;h++)M.push(new HK(h*w,h*u)),M.push(new HK(-h*u,h*(w+u))),M.push(new HK(K-h*(w+u),H+h*w));const y=K/H;for(let h=1;h<H;h++)for(let q=0;q<h*y;q++)M.push(new HK(q,h)),M.push(new HK(q,h).rotate120(K,H)),M.push(new HK(q,h).rotateNeg120(K,H))}M.sort(((K,H)=>K.x-H.x)),M.sort(((K,H)=>K.y-H.y));const y=new Array(K+H+1),h=new Array(K+H+1);for(let i=0;i<y.length;i++)y[i]=1/0,h[i]=-1/0;let W=0,I=0;const f=M.length;for(let i=0;i<f;i++)I=M[i].x,W=M[i].y,y[W]=Math.min(I,y[W]),h[W]=Math.max(I,h[W]);const z=(M,q)=>{const w=M.clone();return"A"===q&&w.rotateNeg120(K,H),"B"===q&&w.rotate120(K,H),w.x<0?w.y:w.x+w.y},G=[],a=[],v=[],O=[],L={},S=[];let B=-1,C=-1;for(let i=0;i<f;i++)G[i]=M[i].toCartesianOrigin(new HK(0,0),.5),a[i]=z(M[i],"O"),v[i]=z(M[i],"A"),O[i]=z(M[i],"B"),a[i]===v[i]&&v[i]===O[i]?(B=3,C=a[i]):a[i]===v[i]?(B=4,C=a[i]):v[i]===O[i]?(B=5,C=v[i]):O[i]===a[i]&&(B=6,C=a[i]),a[i]<v[i]&&a[i]<O[i]&&(B=2,C=a[i]),v[i]<a[i]&&v[i]<O[i]&&(B=1,C=v[i]),O[i]<v[i]&&O[i]<a[i]&&(B=0,C=O[i]),S.push([B,C,M[i].x,M[i].y]);S.sort(((K,H)=>K[2]-H[2])),S.sort(((K,H)=>K[3]-H[3])),S.sort(((K,H)=>K[1]-H[1])),S.sort(((K,H)=>K[0]-H[0]));for(let i=0;i<S.length;i++)L[S[i][2]+"|"+S[i][3]]=[S[i][0],S[i][1],i];return this.m=K,this.n=H,this.vertices=M,this.vertByDist=L,this.cartesian=G,this.min=y,this.max=h,this}}class qK{constructor(K,H,M,q){this.name=K,this.category=H,this.vertex=M,this.face=q}}class wK extends qK{innerToData(K,H){for(let M=0;M<H.innerFacets.length;M++)this.face.push(H.innerFacets[M].map((M=>H.vecToidx[K+M])))}mapABOBtoDATA(K,H){const M=H.IDATA.edgematch[K][0];for(let q=0;q<H.isoVecsABOB.length;q++){const w=[];for(let u=0;u<3;u++)0===H.vertexTypes[q][u]?w.push(K+"|"+H.isoVecsABOB[q][u].x+"|"+H.isoVecsABOB[q][u].y):w.push(M+"|"+H.isoVecsABOB[q][u].x+"|"+H.isoVecsABOB[q][u].y);this.face.push([H.vecToidx[w[0]],H.vecToidx[w[1]],H.vecToidx[w[2]]])}}mapOBOAtoDATA(K,H){const M=H.IDATA.edgematch[K][0];for(let q=0;q<H.isoVecsOBOA.length;q++){const w=[];for(let u=0;u<3;u++)1===H.vertexTypes[q][u]?w.push(K+"|"+H.isoVecsOBOA[q][u].x+"|"+H.isoVecsOBOA[q][u].y):w.push(M+"|"+H.isoVecsOBOA[q][u].x+"|"+H.isoVecsOBOA[q][u].y);this.face.push([H.vecToidx[w[0]],H.vecToidx[w[1]],H.vecToidx[w[2]]])}}mapBAOAtoDATA(K,H){const M=H.IDATA.edgematch[K][2];for(let q=0;q<H.isoVecsBAOA.length;q++){const w=[];for(let u=0;u<3;u++)1===H.vertexTypes[q][u]?w.push(K+"|"+H.isoVecsBAOA[q][u].x+"|"+H.isoVecsBAOA[q][u].y):w.push(M+"|"+H.isoVecsBAOA[q][u].x+"|"+H.isoVecsBAOA[q][u].y);this.face.push([H.vecToidx[w[0]],H.vecToidx[w[1]],H.vecToidx[w[2]]])}}orderData(K){const H=[];for(let u=0;u<13;u++)H[u]=[];const M=K.closestTo;for(let u=0;u<M.length;u++)M[u][0]>-1?M[u][1]>0&&H[M[u][0]].push([u,M[u][1]]):H[12].push([u,M[u][0]]);const q=[];for(let u=0;u<12;u++)q[u]=u;let w=12;for(let u=0;u<12;u++){H[u].sort(((K,H)=>K[1]-H[1]));for(let K=0;K<H[u].length;K++)q[H[u][K][0]]=w++}for(let u=0;u<H[12].length;u++)q[H[12][u][0]]=w++;for(let u=0;u<this.vertex.length;u++)this.vertex[u].push(q[u]);this.vertex.sort(((K,H)=>K[3]-H[3]));for(let u=0;u<this.vertex.length;u++)this.vertex[u].pop();for(let u=0;u<this.face.length;u++)for(let K=0;K<this.face[u].length;K++)this.face[u][K]=q[this.face[u][K]];this.sharedNodes=H[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(K,H){const M=[],q=[];let w=H.pop();q.push(w);let u=this.face[w].indexOf(K);u=(u+2)%3;let y=this.face[w][u];M.push(y);let h=0;for(;H.length>0;)w=H[h],this.face[w].indexOf(y)>-1?(u=(this.face[w].indexOf(y)+1)%3,y=this.face[w][u],M.push(y),q.push(w),H.splice(h,1),h=0):h++;return this.adjacentFaces.push(M),q}toGoldbergPolyhedronData(){const K=new qK("GeoDual","Goldberg",[],[]);K.name="GD dual";const H=this.vertex.length,M=new Array(H);for(let W=0;W<H;W++)M[W]=[];for(let W=0;W<this.face.length;W++)for(let K=0;K<3;K++)M[this.face[W][K]].push(W);let q=0,w=0,u=0,y=[],h=[];this.adjacentFaces=[];for(let W=0;W<M.length;W++){K.face[W]=this.setOrder(W,M[W].concat([]));for(const H of M[W]){q=0,w=0,u=0,y=this.face[H];for(let K=0;K<3;K++)h=this.vertex[y[K]],q+=h[0],w+=h[1],u+=h[2];K.vertex[H]=[q/3,w/3,u/3]}}return K}static BuildGeodesicData(K){const H=new wK("Geodesic-m-n","Geodesic",[[0,KK.e,-1],[-KK.e,1,0],[-1,0,-KK.e],[1,0,-KK.e],[KK.e,1,0],[0,KK.e,1],[-1,0,KK.e],[-KK.e,-1,0],[0,-KK.e,-1],[KK.e,-1,0],[1,0,KK.e],[0,-KK.e,1]],[]);K.setIndices(),K.calcCoeffs(),K.createInnerFacets(),K.edgeVecsABOB(),K.mapABOBtoOBOA(),K.mapABOBtoBAOA();for(let M=0;M<K.IDATA.face.length;M++)K.MapToFace(M,H),H.innerToData(M,K),"B"===K.IDATA.edgematch[M][1]&&H.mapABOBtoDATA(M,K),"O"===K.IDATA.edgematch[M][1]&&H.mapOBOAtoDATA(M,K),"A"===K.IDATA.edgematch[M][3]&&H.mapBAOAtoDATA(M,K);H.orderData(K);return H.vertex=H.vertex.map((function(K){const H=K[0],M=K[1],q=K[2],w=Math.sqrt(H*H+M*M+q*q);return K[0]*=1/w,K[1]*=1/w,K[2]*=1/w,K})),H}}w.b._GoldbergMeshParser=(K,H)=>uK.Parse(K,H);class uK extends w.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(K,H){return void 0===H?(K>this.goldbergData.nbUnsharedFaces-1&&(A.e.Warn("Maximum number of unshared faces used"),K=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+K):(K>11&&(A.e.Warn("Last pole used"),K=11),H>this.goldbergData.nbFacesAtPole-1&&(A.e.Warn("Maximum number of faces at a pole used"),H=this.goldbergData.nbFacesAtPole-1),12+K*this.goldbergData.nbFacesAtPole+H)}_changeGoldbergFaceColors(K){for(let M=0;M<K.length;M++){const H=K[M][0],q=K[M][1],w=K[M][2];for(let K=H;K<q+1;K++)this.goldbergData.faceColors[K]=w}const H=[];for(let M=0;M<12;M++)for(let K=0;K<5;K++)H.push(this.goldbergData.faceColors[M].r,this.goldbergData.faceColors[M].g,this.goldbergData.faceColors[M].b,this.goldbergData.faceColors[M].a);for(let M=12;M<this.goldbergData.faceColors.length;M++)for(let K=0;K<6;K++)H.push(this.goldbergData.faceColors[M].r,this.goldbergData.faceColors[M].g,this.goldbergData.faceColors[M].b,this.goldbergData.faceColors[M].a);return H}setGoldbergFaceColors(K){const H=this._changeGoldbergFaceColors(K);this.NK(u.d.ColorKind,H)}updateGoldbergFaceColors(K){const H=this._changeGoldbergFaceColors(K);this.updateVerticesData(u.d.ColorKind,H)}_changeGoldbergFaceUVs(K){const H=this.getVerticesData(u.d.UVKind);for(let M=0;M<K.length;M++){const q=K[M][0],w=K[M][1],u=K[M][2],y=K[M][3],h=K[M][4],W=[],I=[];let f,z;for(let K=0;K<5;K++)f=u.x+y*Math.cos(h+K*Math.PI/2.5),z=u.y+y*Math.sin(h+K*Math.PI/2.5),f<0&&(f=0),f>1&&(f=1),W.push(f,z);for(let K=0;K<6;K++)f=u.x+y*Math.cos(h+K*Math.PI/3),z=u.y+y*Math.sin(h+K*Math.PI/3),f<0&&(f=0),f>1&&(f=1),I.push(f,z);for(let K=q;K<Math.min(12,w+1);K++)for(let M=0;M<5;M++)H[10*K+2*M]=W[2*M],H[10*K+2*M+1]=W[2*M+1];for(let K=Math.max(12,q);K<w+1;K++)for(let M=0;M<6;M++)H[12*K-24+2*M]=I[2*M],H[12*K-23+2*M]=I[2*M+1]}return H}setGoldbergFaceUVs(K){const H=this._changeGoldbergFaceUVs(K);this.NK(u.d.UVKind,H)}updateGoldbergFaceUVs(K){const H=this._changeGoldbergFaceUVs(K);this.updateVerticesData(u.d.UVKind,H)}placeOnGoldbergFaceAt(K,H,M){const w=q.OH.RotationFromAxis(this.goldbergData.faceXaxis[H],this.goldbergData.faceYaxis[H],this.goldbergData.faceZaxis[H]);K.rotation=w,K.position=this.goldbergData.faceCenters[H].add(this.goldbergData.faceXaxis[H].scale(M.x)).add(this.goldbergData.faceYaxis[H].scale(M.y)).add(this.goldbergData.faceZaxis[H].scale(M.z))}serialize(K){super.serialize(K),K.type="GoldbergMesh";const H={};if(H.adjacentFaces=this.goldbergData.adjacentFaces,H.nbSharedFaces=this.goldbergData.nbSharedFaces,H.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,H.nbFaces=this.goldbergData.nbFaces,H.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){H.faceColors=[];for(const K of this.goldbergData.faceColors)H.faceColors.push(K.hh())}if(this.goldbergData.faceCenters){H.faceCenters=[];for(const K of this.goldbergData.faceCenters)H.faceCenters.push(K.hh())}if(this.goldbergData.faceZaxis){H.faceZaxis=[];for(const K of this.goldbergData.faceZaxis)H.faceZaxis.push(K.hh())}if(this.goldbergData.faceYaxis){H.faceYaxis=[];for(const K of this.goldbergData.faceYaxis)H.faceYaxis.push(K.hh())}if(this.goldbergData.faceXaxis){H.faceXaxis=[];for(const K of this.goldbergData.faceXaxis)H.faceXaxis.push(K.hh())}K.goldbergData=H}static Parse(K,H){const M=K.goldbergData;M.faceColors=M.faceColors.map((K=>G.Ch.iH(K))),M.faceCenters=M.faceCenters.map((K=>q.OH.iH(K))),M.faceZaxis=M.faceZaxis.map((K=>q.OH.iH(K))),M.faceXaxis=M.faceXaxis.map((K=>q.OH.iH(K))),M.faceYaxis=M.faceYaxis.map((K=>q.OH.iH(K)));const w=new uK(K.name,H);return w.goldbergData=M,w}}var yK=M(11837);const hK={CreateBox:z.e,CreateTiledBox:L,CreateSphere:S.d,CreateDisc:f.e,CreateIcoSphere:t,CreateRibbon:I,CreateCylinder:Z,CreateTorus:l,CreateTorusKnot:D,CreateLineSystem:V.h,ZI:V.j,CreateDashedLines:V.d,ExtrudeShape:k,ExtrudeShapeCustom:T,CreateLathe:x,CreateTiledPlane:v,sI:Q.c,CreateGround:J.e,CreateTiledGround:J.i,CreateGroundFromHeightMap:J.c,CreatePolygon:n.b,ExtrudePolygon:n.e,CreateTube:N,CreatePolyhedron:o,CreateGeodesic:function(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=H.m||1;q!==Math.floor(q)&&(q=Math.floor(q),A.e.Warn("m not an integer only floor(m) used"));let w=H.n||0;if(w!==Math.floor(w)&&(w=Math.floor(w),A.e.Warn("n not an integer only floor(n) used")),w>q){const K=w;w=q,q=K,A.e.Warn("n > m therefore m and n swapped")}const u=new MK;return u.build(q,w),o(K,{custom:wK.BuildGeodesicData(u),size:H.size,sizeX:H.sizeX,sizeY:H.sizeY,sizeZ:H.sizeZ,faceUV:H.faceUV,faceColors:H.faceColors,flat:H.flat,updatable:H.updatable,sideOrientation:H.sideOrientation,frontUVs:H.frontUVs,backUVs:H.backUVs},M)},CreateGoldberg:function(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const u=H.size,W=H.sizeX||u||1,I=H.sizeY||u||1,f=H.sizeZ||u||1;let z=H.m||1;z!==Math.floor(z)&&(z=Math.floor(z),A.e.Warn("m not an integer only floor(m) used"));let a=H.n||0;if(a!==Math.floor(a)&&(a=Math.floor(a),A.e.Warn("n not an integer only floor(n) used")),a>z){const K=a;a=z,z=K,A.e.Warn("n > m therefore m and n swapped")}const v=new MK;v.build(z,a);const O=wK.BuildGeodesicData(v),L=O.toGoldbergPolyhedronData(),S=new uK(K,M);H.sideOrientation=w.b._GetDefaultSideOrientation(H.sideOrientation),S._originalBuilderSideOrientation=H.sideOrientation;(function(K,H){const M=K.size,w=K.sizeX||M||1,u=K.sizeY||M||1,W=K.sizeZ||M||1,I=0===K.sideOrientation?0:K.sideOrientation||y.d.DEFAULTSIDE,f=[],z=[],G=[],a=[];let v=1/0,O=-1/0,L=1/0,S=-1/0;for(let q=0;q<H.vertex.length;q++)v=Math.min(v,H.vertex[q][0]*w),O=Math.max(O,H.vertex[q][0]*w),L=Math.min(L,H.vertex[q][1]*u),S=Math.max(S,H.vertex[q][1]*u);let B=0;for(let y=0;y<H.face.length;y++){const K=H.face[y],M=q.OH.iH(H.vertex[K[0]]),I=q.OH.iH(H.vertex[K[2]]),C=q.OH.iH(H.vertex[K[1]]),i=I.LH(M),Z=C.LH(M),E=q.OH.Cross(Z,i).normalize();for(let q=0;q<K.length;q++){G.push(E.x,E.y,E.z);const M=H.vertex[K[q]];f.push(M[0]*w,M[1]*u,M[2]*W);const y=(M[1]*u-L)/(S-L);a.push((M[0]*w-v)/(O-v),h.b?1-y:y)}for(let H=0;H<K.length-2;H++)z.push(B,B+H+2,B+H+1);B+=K.length}y.d._ComputeSides(I,f,z,G,a);const C=new y.d;return C.VK=f,C.indices=z,C.nK=G,C.kK=a,C})(H,L).dK(S,H.updatable),S.goldbergData.nbSharedFaces=O.sharedNodes,S.goldbergData.nbUnsharedFaces=O.poleNodes,S.goldbergData.adjacentFaces=O.adjacentFaces,S.goldbergData.nbFaces=S.goldbergData.nbSharedFaces+S.goldbergData.nbUnsharedFaces,S.goldbergData.nbFacesAtPole=(S.goldbergData.nbUnsharedFaces-12)/12;for(let w=0;w<O.vertex.length;w++)S.goldbergData.faceCenters.push(q.OH.iH(O.vertex[w])),S.goldbergData.faceCenters[w].x*=W,S.goldbergData.faceCenters[w].y*=I,S.goldbergData.faceCenters[w].z*=f,S.goldbergData.faceColors.push(new G.Ch(1,1,1,1));for(let w=0;w<L.face.length;w++){const K=L.face[w],H=q.OH.iH(L.vertex[K[0]]),M=q.OH.iH(L.vertex[K[2]]),u=q.OH.iH(L.vertex[K[1]]),y=M.LH(H),h=u.LH(H),W=q.OH.Cross(h,y).normalize(),I=q.OH.Cross(h,W).normalize();S.goldbergData.faceXaxis.push(h.normalize()),S.goldbergData.faceYaxis.push(W),S.goldbergData.faceZaxis.push(I)}return S},CreateDecal:P,CreateCapsule:X,CreateText:yK.f}},12601:(K,H,M)=>{"use strict";M.d(H,{c:()=>hH});var q=M(11290),w=M(11673);class u extends w.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var y=M(11329),h=(M(11446),M(11242));class W{get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(K){this._targetStopDuration!==K&&(this._targetStopDuration=K)}get isNodeGenerated(){return!1}get noiseTexture(){return this._noiseTexture}set noiseTexture(K){this._noiseTexture!==K&&(this._noiseTexture=K,this._reset())}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(K){this._animationSheetEnabled!==K&&(this._animationSheetEnabled=K)}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(K){this._isAnimationSheetEnabled!=K&&(this._isAnimationSheetEnabled=K,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){this._useLogarithmicDepth=K&&this.sK().getEngine().getCaps().fragmentDepthSupported}sK(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}_setEngineBasedOnBlendMode(K){switch(K){case W.BLENDMODE_MULTIPLYADD:return;case W.BLENDMODE_ADD:K=1;break;case W.BLENDMODE_ONEONE:K=6;break;case W.BLENDMODE_STANDARD:K=2;break;case W.BLENDMODE_MULTIPLY:K=4;break;case W.BLENDMODE_SUBTRACT:K=3}this._engine.setAlphaMode(K)}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:q.OH.Zero()}set direction1(K){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=K)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:q.OH.Zero()}set direction2(K){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=K)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:q.OH.Zero()}set minEmitBox(K){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=K)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:q.OH.Zero()}set maxEmitBox(K){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=K)}get billboardMode(){return this._billboardMode}set billboardMode(K){this._billboardMode!==K&&(this._billboardMode=K,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(K){this._isBillboardBased!==K&&(this._isBillboardBased=K,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K)}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(!K&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=K)}_reset(){}_removeGradientAndTexture(K,H,M){if(!H)return this;let q=0;for(const w of H){if(w.gradient===K){H.splice(q,1);break}q++}return M&&M.dispose(),this}constructor(K){this.animations=[],this.renderingGroupId=0,this.wH=q.OH.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this._targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new q.OH(10,10,10),this.onAnimationEnd=null,this.blendMode=W.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new q.Vector2(0,0),this._animationSheetEnabled=!1,this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.BI=new q.OH(0,0,0),this._useLogarithmicDepth=!1,this.gravity=q.OH.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new y.Ch(1,1,1,1),this.color2=new y.Ch(1,1,1,1),this.colorDead=new y.Ch(0,0,0,1),this.textureMask=new y.Ch(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new u,this.id=K,this.name=K}createPointEmitter(K,H){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new q.OH(0,1,0),arguments.length>2&&void 0!==arguments[2]||new q.OH(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new q.OH(0,1,0),arguments.length>4&&void 0!==arguments[4]||new q.OH(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new q.OH(0,1,0),arguments.length>3&&void 0!==arguments[3]||new q.OH(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(K,H,M,q){throw new Error("Method not implemented.")}}W.BLENDMODE_ONEONE=0,W.BLENDMODE_STANDARD=1,W.BLENDMODE_ADD=2,W.BLENDMODE_MULTIPLY=3,W.BLENDMODE_MULTIPLYADD=4,W.BLENDMODE_SUBTRACT=-1,(0,h.f)("BABYLON.BaseParticleSystem",W);var I=M(11307),f=M(11118);class z{constructor(){this.direction1=new q.OH(0,1,0),this.direction2=new q.OH(0,1,0),this.minEmitBox=new q.OH(-.5,-.5,-.5),this.maxEmitBox=new q.OH(.5,.5,.5)}startDirectionFunction(K,H,M,w){const u=(0,I.RandomRange)(this.direction1.x,this.direction2.x),y=(0,I.RandomRange)(this.direction1.y,this.direction2.y),h=(0,I.RandomRange)(this.direction1.z,this.direction2.z);if(w)return H.x=u,H.y=y,void(H.z=h);q.OH.TransformNormalFromFloatsToRef(u,y,h,K,H)}startPositionFunction(K,H,M,w){const u=(0,I.RandomRange)(this.minEmitBox.x,this.maxEmitBox.x),y=(0,I.RandomRange)(this.minEmitBox.y,this.maxEmitBox.y),h=(0,I.RandomRange)(this.minEmitBox.z,this.maxEmitBox.z);if(w)return H.x=u,H.y=y,void(H.z=h);q.OH.TransformCoordinatesFromFloatsToRef(u,y,h,K,H)}clone(){const K=new z;return f.b.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2),K.setVector3("minEmitBox",this.minEmitBox),K.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3),K.addUniform("minEmitBox",3),K.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.hh(),K.direction2=this.direction2.hh(),K.minEmitBox=this.minEmitBox.hh(),K.maxEmitBox=this.maxEmitBox.hh(),K}parse(K){q.OH.FromArrayToRef(K.direction1,0,this.direction1),q.OH.FromArrayToRef(K.direction2,0,this.direction2),q.OH.FromArrayToRef(K.minEmitBox,0,this.minEmitBox),q.OH.FromArrayToRef(K.maxEmitBox,0,this.maxEmitBox)}}class G{get radius(){return this._radius}set radius(K){this._radius=K,this._buildHeight()}get angle(){return this._angle}set angle(K){this._angle=K,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=M,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=H,this.radius=K}startDirectionFunction(K,H,M,w){w?q.TmpVectors.OH[0].q(M.Ph).normalize():M.position.subtractToRef(K.getTranslation(),q.TmpVectors.OH[0]).normalize();const u=(0,I.RandomRange)(0,this.directionRandomizer),y=(0,I.RandomRange)(0,this.directionRandomizer),h=(0,I.RandomRange)(0,this.directionRandomizer);H.x=q.TmpVectors.OH[0].x+u,H.y=q.TmpVectors.OH[0].y+y,H.z=q.TmpVectors.OH[0].z+h,H.normalize()}startPositionFunction(K,H,M,w){const u=(0,I.RandomRange)(0,2*Math.PI);let y;this.emitFromSpawnPointOnly?y=1e-4:(y=(0,I.RandomRange)(0,this.heightRange),y=1-y*y);let h=this._radius-(0,I.RandomRange)(0,this._radius*this.radiusRange);h*=y;const W=h*Math.sin(u),f=h*Math.cos(u),z=y*this._height;if(w)return H.x=W,H.y=z,void(H.z=f);q.OH.TransformCoordinatesFromFloatsToRef(W,z,f,K,H)}clone(){const K=new G(this._radius,this._angle,this.directionRandomizer);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setFloat2("radius",this._radius,this.radiusRange),K.setFloat("coneAngle",this._angle),K.setFloat2("height",this._height,this.heightRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",2),K.addUniform("coneAngle",1),K.addUniform("height",2),K.addUniform("directionRandomizer",1)}getEffectDefines(){let K="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(K+="\n#define CONEEMITTERSPAWNPOINT"),K}getClassName(){return"ConeParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this._radius,K.angle=this._angle,K.directionRandomizer=this.directionRandomizer,K.radiusRange=this.radiusRange,K.heightRange=this.heightRange,K.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,K}parse(K){this.radius=K.radius,this.angle=K.angle,this.directionRandomizer=K.directionRandomizer,this.radiusRange=void 0!==K.radiusRange?K.radiusRange:1,this.heightRange=void 0!==K.radiusRange?K.heightRange:1,this.emitFromSpawnPointOnly=void 0!==K.emitFromSpawnPointOnly&&K.emitFromSpawnPointOnly}}class a extends G{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0);super(K,H),this.direction1=M,this.direction2=w}startDirectionFunction(K,H){const M=(0,I.RandomRange)(this.direction1.x,this.direction2.x),w=(0,I.RandomRange)(this.direction1.y,this.direction2.y),u=(0,I.RandomRange)(this.direction1.z,this.direction2.z);q.OH.TransformNormalFromFloatsToRef(M,w,u,K,H)}clone(){const K=new a(this.radius,this.angle,this.direction1,this.direction2);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.hh(),K.direction2=this.direction2.hh(),K}parse(K){super.parse(K),this.direction1.q(K.direction1),this.direction2.q(K.direction2)}}class v{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=K,this.height=H,this.radiusRange=M,this.directionRandomizer=w,this._tempVector=q.OH.Zero()}startDirectionFunction(K,H,M,w,u){M.position.subtractToRef(K.getTranslation(),this._tempVector),this._tempVector.normalize(),q.OH.TransformNormalToRef(this._tempVector,u,this._tempVector);const y=(0,I.RandomRange)(-this.directionRandomizer/2,this.directionRandomizer/2);let h=Math.atan2(this._tempVector.x,this._tempVector.z);h+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=y,this._tempVector.x=Math.sin(h),this._tempVector.z=Math.cos(h),this._tempVector.normalize(),w?H.q(this._tempVector):q.OH.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K,H)}startPositionFunction(K,H,M,w){const u=(0,I.RandomRange)(-this.height/2,this.height/2),y=(0,I.RandomRange)(0,2*Math.PI),h=(0,I.RandomRange)((1-this.radiusRange)*(1-this.radiusRange),1),W=Math.sqrt(h)*this.radius,f=W*Math.cos(y),z=W*Math.sin(y);w?H.Lh(f,u,z):q.OH.TransformCoordinatesFromFloatsToRef(f,u,z,K,H)}clone(){const K=new v(this.radius,this.directionRandomizer);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.height=this.height,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.height=K.height,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class O extends v{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0),u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.OH(0,1,0);super(K,H,M),this.direction1=w,this.direction2=u}startDirectionFunction(K,H,M,w){const u=(0,I.RandomRange)(this.direction1.x,this.direction2.x),y=(0,I.RandomRange)(this.direction1.y,this.direction2.y),h=(0,I.RandomRange)(this.direction1.z,this.direction2.z);w?H.Lh(u,y,h):q.OH.TransformNormalFromFloatsToRef(u,y,h,K,H)}clone(){const K=new O(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.hh(),K.direction2=this.direction2.hh(),K}parse(K){super.parse(K),q.OH.FromArrayToRef(K.direction1,0,this.direction1),q.OH.FromArrayToRef(K.direction2,0,this.direction2)}}class L{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=H,this.directionRandomizer=M}startDirectionFunction(K,H,M,w){const u=M.position.LH(K.getTranslation()).normalize(),y=(0,I.RandomRange)(0,this.directionRandomizer),h=(0,I.RandomRange)(0,this.directionRandomizer),W=(0,I.RandomRange)(0,this.directionRandomizer);u.x+=y,u.y+=h,u.z+=W,u.normalize(),w?H.q(u):q.OH.TransformNormalFromFloatsToRef(u.x,u.y,u.z,K,H)}startPositionFunction(K,H,M,w){const u=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),y=(0,I.RandomRange)(0,1),h=(0,I.RandomRange)(0,2*Math.PI),W=Math.acos(2*y-1),f=u*Math.cos(h)*Math.sin(W),z=u*Math.cos(W),G=u*Math.sin(h)*Math.sin(W);w?H.Lh(f,Math.abs(z),G):q.OH.TransformCoordinatesFromFloatsToRef(f,Math.abs(z),G,K,H)}clone(){const K=new L(this.radius,this.directionRandomizer);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class S{constructor(){this.direction1=new q.OH(0,1,0),this.direction2=new q.OH(0,1,0)}startDirectionFunction(K,H,M,w){const u=(0,I.RandomRange)(this.direction1.x,this.direction2.x),y=(0,I.RandomRange)(this.direction1.y,this.direction2.y),h=(0,I.RandomRange)(this.direction1.z,this.direction2.z);w?H.Lh(u,y,h):q.OH.TransformNormalFromFloatsToRef(u,y,h,K,H)}startPositionFunction(K,H,M,w){w?H.Lh(0,0,0):q.OH.TransformCoordinatesFromFloatsToRef(0,0,0,K,H)}clone(){const K=new S;return f.b.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.hh(),K.direction2=this.direction2.hh(),K}parse(K){q.OH.FromArrayToRef(K.direction1,0,this.direction1),q.OH.FromArrayToRef(K.direction2,0,this.direction2)}}class B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=H,this.directionRandomizer=M}startDirectionFunction(K,H,M,w){const u=M.position.LH(K.getTranslation()).normalize(),y=(0,I.RandomRange)(0,this.directionRandomizer),h=(0,I.RandomRange)(0,this.directionRandomizer),W=(0,I.RandomRange)(0,this.directionRandomizer);u.x+=y,u.y+=h,u.z+=W,u.normalize(),w?H.q(u):q.OH.TransformNormalFromFloatsToRef(u.x,u.y,u.z,K,H)}startPositionFunction(K,H,M,w){const u=this.radius-(0,I.RandomRange)(0,this.radius*this.radiusRange),y=(0,I.RandomRange)(0,1),h=(0,I.RandomRange)(0,2*Math.PI),W=Math.acos(2*y-1),f=u*Math.cos(h)*Math.sin(W),z=u*Math.cos(W),G=u*Math.sin(h)*Math.sin(W);w?H.Lh(f,z,G):q.OH.TransformCoordinatesFromFloatsToRef(f,z,G,K,H)}clone(){const K=new B(this.radius,this.directionRandomizer);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class C extends B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.OH(0,1,0),M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0);super(K),this.direction1=H,this.direction2=M}startDirectionFunction(K,H){const M=(0,I.RandomRange)(this.direction1.x,this.direction2.x),w=(0,I.RandomRange)(this.direction1.y,this.direction2.y),u=(0,I.RandomRange)(this.direction1.z,this.direction2.z);q.OH.TransformNormalFromFloatsToRef(M,w,u,K,H)}clone(){const K=new C(this.radius,this.direction1,this.direction2);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.hh(),K.direction2=this.direction2.hh(),K}parse(K){super.parse(K),this.direction1.q(K.direction1),this.direction2.q(K.direction2)}}class i{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{},this.particleDirectionGenerator=()=>{}}startDirectionFunction(K,H,M,w){const u=q.TmpVectors.OH[0];if(this.particleDirectionGenerator)this.particleDirectionGenerator(-1,M,u);else if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,M,u);const K=q.TmpVectors.OH[1];u.subtractToRef(M.position,K),K.scaleToRef(1/M.lifeTime,u)}else u.set(0,0,0);w?H.q(u):q.OH.TransformNormalToRef(u,K,H)}startPositionFunction(K,H,M,w){const u=q.TmpVectors.OH[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,M,u):u.set(0,0,0),w?H.q(u):q.OH.TransformCoordinatesToRef(u,K,H)}clone(){const K=new i;return f.b.DeepCopy(this,K),K}applyToShader(K){}buildUniformLayout(K){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.particlePositionGenerator=this.particlePositionGenerator,K.particleDestinationGenerator=this.particleDestinationGenerator,K}parse(K){K.particlePositionGenerator&&(this.particlePositionGenerator=K.particlePositionGenerator),K.particleDestinationGenerator&&(this.particleDestinationGenerator=K.particleDestinationGenerator)}}var Z=M(11366);class E{get mesh(){return this._mesh}set mesh(K){this._mesh!==K&&(this._mesh=K,K?(this._indices=K.ah(),this._positions=K.getVerticesData(Z.d.PositionKind),this._normals=K.getVerticesData(Z.d.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=q.OH.Zero(),this._mesh=null,this.direction1=new q.OH(0,1,0),this.direction2=new q.OH(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=K}startDirectionFunction(K,H,M,w){if(this.useMeshNormalsForDirection&&this._normals)return void q.OH.TransformNormalToRef(this._storedNormal,K,H);const u=(0,I.RandomRange)(this.direction1.x,this.direction2.x),y=(0,I.RandomRange)(this.direction1.y,this.direction2.y),h=(0,I.RandomRange)(this.direction1.z,this.direction2.z);w?H.Lh(u,y,h):q.OH.TransformNormalFromFloatsToRef(u,y,h,K,H)}startPositionFunction(K,H,M,w){if(!this._indices||!this._positions)return;const u=3*(Math.random()*(this._indices.length/3)|0),y=Math.random(),h=Math.random()*(1-y),W=1-y-h,I=this._indices[u],f=this._indices[u+1],z=this._indices[u+2],G=q.TmpVectors.OH[0],a=q.TmpVectors.OH[1],v=q.TmpVectors.OH[2],O=q.TmpVectors.OH[3];q.OH.FromArrayToRef(this._positions,3*I,G),q.OH.FromArrayToRef(this._positions,3*f,a),q.OH.FromArrayToRef(this._positions,3*z,v),O.x=y*G.x+h*a.x+W*v.x,O.y=y*G.y+h*a.y+W*v.y,O.z=y*G.z+h*a.z+W*v.z,w?H.Lh(O.x,O.y,O.z):q.OH.TransformCoordinatesFromFloatsToRef(O.x,O.y,O.z,K,H),this.useMeshNormalsForDirection&&this._normals&&(q.OH.FromArrayToRef(this._normals,3*I,G),q.OH.FromArrayToRef(this._normals,3*f,a),q.OH.FromArrayToRef(this._normals,3*z,v),this._storedNormal.x=y*G.x+h*a.x+W*v.x,this._storedNormal.y=y*G.y+h*a.y+W*v.y,this._storedNormal.z=y*G.z+h*a.z+W*v.z)}clone(){const K=new E(this.mesh);return f.b.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var K;const H={};return H.type=this.getClassName(),H.direction1=this.direction1.hh(),H.direction2=this.direction2.hh(),H.meshId=null===(K=this.mesh)||void 0===K?void 0:K.id,H.useMeshNormalsForDirection=this.useMeshNormalsForDirection,H}parse(K,H){q.OH.FromArrayToRef(K.direction1,0,this.direction1),q.OH.FromArrayToRef(K.direction2,0,this.direction2),K.meshId&&H&&(this.mesh=H.getLastMeshById(K.meshId)),this.useMeshNormalsForDirection=K.useMeshNormalsForDirection}}class l{_isUbo(K){return void 0!==K.addUniform}constructor(K){this._isUbo(K)?(this.setMatrix3x3=K.updateMatrix3x3.bind(K),this.setMatrix2x2=K.updateMatrix2x2.bind(K),this.setFloat=K.updateFloat.bind(K),this.setFloat2=K.updateFloat2.bind(K),this.setFloat3=K.updateFloat3.bind(K),this.setFloat4=K.updateFloat4.bind(K),this.setFloatArray=K.updateFloatArray.bind(K),this.setArray=K.updateArray.bind(K),this.setIntArray=K.updateIntArray.bind(K),this.setMatrix=K.fh.bind(K),this.setMatrices=K.updateMatrices.bind(K),this.setVector3=K.updateVector3.bind(K),this.setVector4=K.updateVector4.bind(K),this.setColor3=K.updateColor3.bind(K),this.setColor4=K.updateColor4.bind(K),this.setDirectColor4=K.updateDirectColor4.bind(K),this.setInt=K.updateInt.bind(K),this.setInt2=K.updateInt2.bind(K),this.setInt3=K.updateInt3.bind(K),this.setInt4=K.updateInt4.bind(K)):(this.setMatrix3x3=K.setMatrix3x3.bind(K),this.setMatrix2x2=K.setMatrix2x2.bind(K),this.setFloat=K.setFloat.bind(K),this.setFloat2=K.setFloat2.bind(K),this.setFloat3=K.setFloat3.bind(K),this.setFloat4=K.setFloat4.bind(K),this.setFloatArray=K.setFloatArray.bind(K),this.setArray=K.setArray.bind(K),this.setIntArray=K.setIntArray.bind(K),this.setMatrix=K.setMatrix.bind(K),this.setMatrices=K.setMatrices.bind(K),this.setVector3=K.setVector3.bind(K),this.setVector4=K.setVector4.bind(K),this.setColor3=K.setColor3.bind(K),this.setColor4=K.setColor4.bind(K),this.setDirectColor4=K.setDirectColor4.bind(K),this.setInt=K.setInt.bind(K),this.setInt2=K.setInt2.bind(K),this.setInt3=K.setInt3.bind(K),this.setInt4=K.setInt4.bind(K))}}var s=M(11193);const D="gpuUpdateParticlesPixelShader",V="#version 300 es\nvoid main() {discard;}\n";s.d.ShadersStore[D]||(s.d.ShadersStore[D]=V);const n="gpuUpdateParticlesVertexShader",c="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifdef FLOWMAP\nuniform mat4 flowMapProjection;uniform float flowMapStrength;uniform sampler2D flowMapSampler;\n#endif\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef FLOWMAP\nvec4 clipSpace=(flowMapProjection*vec4(position,1.));vec3 ndcSpace=clipSpace.xyz/clipSpace.w;vec2 flowMapUV=ndcSpace.xy*0.5+0.5;vec4 flowMapValue=texture(flowMapSampler,flowMapUV);vec3 flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";s.d.ShadersStore[n]||(s.d.ShadersStore[n]=c);(0,h.f)("BABYLON.WebGL2ParticleSystem",class{constructor(K,H){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=K,this._engine=H,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping","flowMapProjection","flowMapStrength"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler","flowMapSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var K;return(null===(K=this._updateEffect)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof i&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=K,this._updateEffect=this._engine.createEffect("gpuUpdateParticles",this._updateEffectOptions,this._engine),new l(this._updateEffect)}createVertexBuffers(K,H){this._updateVAO.push(this._createUpdateVAO(K)),this._renderVAO.push(this._engine.recordVertexArrayObject(H,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=H}createParticleBuffer(K){return K}bindDrawBuffers(K,H,M){M?this._engine.bindBuffers(this._renderVertexBuffers,M,H):this._engine.bindVertexArrayObject(this._renderVAO[K],null)}preUpdateParticleBuffer(){const K=this._engine;if(this._engine.enableEffect(this._updateEffect),!K.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(K,H,M){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._flowMap&&this._updateEffect.setTexture("flowMapSampler",this._parent._flowMap),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[K],null);const q=this._engine;q.bindTransformFeedbackBuffer(H.getBuffer()),q.setRasterizerState(!1),q.beginTransformFeedback(!0),q.drawArraysType(3,0,M),q.endTransformFeedback(),q.setRasterizerState(!0),q.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let K=0;K<this._updateVAO.length;K++)this._engine.releaseVertexArrayObject(this._updateVAO[K]);this._updateVAO.length=0;for(let K=0;K<this._renderVAO.length;K++)this._engine.releaseVertexArrayObject(this._renderVAO[K]);this._renderVAO.length=0}_createUpdateVAO(K){const H={};H.position=K.createVertexBuffer("position",0,3);let M=3;H.age=K.createVertexBuffer("age",M,1),M+=1,H.size=K.createVertexBuffer("size",M,3),M+=3,H.life=K.createVertexBuffer("life",M,1),M+=1,H.seed=K.createVertexBuffer("seed",M,4),M+=4,H.direction=K.createVertexBuffer("direction",M,3),M+=3,this._parent.particleEmitterType instanceof i&&(H.initialPosition=K.createVertexBuffer("initialPosition",M,3),M+=3),this._parent._colorGradientsTexture||(H.color=K.createVertexBuffer("color",M,4),M+=4),this._parent._isBillboardBased||(H.initialDirection=K.createVertexBuffer("initialDirection",M,3),M+=3),this._parent.noiseTexture&&(H.noiseCoordinates1=K.createVertexBuffer("noiseCoordinates1",M,3),M+=3,H.noiseCoordinates2=K.createVertexBuffer("noiseCoordinates2",M,3),M+=3),this._parent._angularSpeedGradientsTexture?(H.angle=K.createVertexBuffer("angle",M,1),M+=1):(H.angle=K.createVertexBuffer("angle",M,2),M+=2),this._parent._isAnimationSheetEnabled&&(H.cellIndex=K.createVertexBuffer("cellIndex",M,1),M+=1,this._parent.spriteRandomStartCell&&(H.cellStartOffset=K.createVertexBuffer("cellStartOffset",M,1),M+=1));const q=this._engine.recordVertexArrayObject(H,null,this._updateEffect);return this._engine.bindArrayBuffer(null),q}});class k{constructor(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,q=arguments.length>3?arguments[3]:void 0;this._engine=K,this._label=q,this._engine._storageBuffers.push(this),this._create(H,M)}_create(K,H){this._bufferSize=K,this._creationFlags=H,this._buffer=this._engine.createStorageBuffer(K,H,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(K,H,M){this._buffer&&this._engine.updateStorageBuffer(this._buffer,K,H,M)}async read(K,H,M,q){return await this._engine.readFromStorageBuffer(this._buffer,K,H,M,q)}dispose(){const K=this._engine._storageBuffers,H=K.indexOf(this);-1!==H&&(K[H]=K[K.length-1],K.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var T=M(11274),d=M(11280),x=M(11325),Q=M(11267),J=M(11580),N=M(11112),p=M(11223),o=M(11498);class R{constructor(){this._gpuTimeInFrameId=-1,this.counter=new o.d}_addDuration(K,H){K<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==K?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(H,!1),this._gpuTimeInFrameId=K):this.counter.addCount(H,!1))}}var t=M(11176);class U{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=K,this._engine=H,this.uniqueId=J.e.UniqueId,H.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new R),this._engine.getCaps().supportComputeShaders?q.bindingsMapping?(this._context=H.createComputeContext(),this._shaderPath=M,this._options={bindingsMapping:{},defines:[],...q}):N.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):N.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(K,H){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const q=this._bindings[K];this._bindings[K]={type:M?0:4,object:H,indexInGroupEntries:null===q||void 0===q?void 0:q.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!q||q.object!==H||q.type!==this._bindings[K].type)}setStorageTexture(K,H){const M=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==H),this._bindings[K]={type:1,object:H,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setExternalTexture(K,H){const M=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==H),this._bindings[K]={type:6,object:H,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setVideoTexture(K,H){return!!H.externalTexture&&(this.setExternalTexture(K,H.externalTexture),!0)}setUniformBuffer(K,H){const M=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==H),this._bindings[K]={type:U._BufferIsDataBuffer(H)?7:2,object:H,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setStorageBuffer(K,H){const M=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!M||M.object!==H),this._bindings[K]={type:U._BufferIsDataBuffer(H)?7:3,object:H,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}setTextureSampler(K,H){const M=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!M||!H.compareSampler(M.object)),this._bindings[K]={type:5,object:H,indexInGroupEntries:null===M||void 0===M?void 0:M.indexInGroupEntries}}isReady(){let K=this._effect;for(const w in this._bindings){const K=this._bindings[w],H=K.type,M=K.object;switch(H){case 0:case 4:case 1:if(!M.isReady())return!1;break;case 6:if(!M.isReady())return!1;break}}const H=[],M=this._shaderPath;if(this._options.defines)for(let w=0;w<this._options.defines.length;w++)H.push(this._options.defines[w]);const q=H.join("\n");return this._cachedDefines!==q&&(this._cachedDefines=q,K=this._engine.createComputeEffect(M,{defines:q,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=K),!!K.isReady()}dispatch(K,H,M){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,K,H,M,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const M=U._BufferIsDataBuffer(K)?K:K.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,M,H,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const H in this._bindings){const M=this._bindings[H];if(!this._options.bindingsMapping[H])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+H+"'");switch(M.type){case 0:{const q=this._samplers[H],w=M.object;var K;if(!q||!w._texture||!q.compareSampler(w._texture))this._samplers[H]=(new p.c).setParameters(w.wrapU,w.wrapV,w.wrapR,w.anisotropicFilteringLevel,w._texture.samplingMode,null===(K=w._texture)||void 0===K?void 0:K._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const K=M.object;K.getBuffer()!==M.buffer&&(M.buffer=K.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}async dispatchWhenReady(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return await new Promise((w=>{(0,t.e)((()=>this.dispatch(K,H,M)),w,void 0,q)}))}serialize(){const K=x.c.Serialize(this);K.options=this._options,K.shaderPath=this._shaderPath,K.VG={},K.textures={};for(const H in this._bindings){const M=this._bindings[H],q=M.object;switch(M.type){case 0:case 4:case 1:{const w=q.serialize();w&&(K.textures[H]=w,K.VG[H]={type:M.type});break}}}return K}static Parse(K,H,M){const q=x.c.Parse((()=>new U(K.name,H.getEngine(),K.shaderPath,K.options)),K,H,M);for(const w in K.textures){const u=K.VG[w],y=Q.b.Parse(K.textures[w],H,M);0===u.type?q.setTexture(w,y):4===u.type?q.setTexture(w,y,!1):q.setStorageTexture(w,y)}return q}static _BufferIsDataBuffer(K){return void 0!==K.underlyingResource}}(0,T.e)([(0,d.J)()],U.prototype,"name",void 0),(0,T.e)([(0,d.J)()],U.prototype,"fastMode",void 0),(0,h.f)("BABYLON.ComputeShader",U);var j=M(11546);const m="gpuUpdateParticlesComputeShader",F="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifdef FLOWMAP\nflowMapProjection : mat4x4<f32>,\nflowMapStrength : f32,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\n#ifdef FLOWMAP\n@binding(12) @group(1) var flowMapSampler : sampler;@binding(13) @group(1) var flowMapTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef FLOWMAP\nvar clipSpace=(params.flowMapProjection*vec4f(position,1.));var ndcSpace=clipSpace.xyz/clipSpace.w;var flowMapUV=ndcSpace.xy*0.5+0.5;var flowMapValue=textureSampleLevel(flowMapTexture,flowMapSampler,flowMapUV,0.);var flowMapDirection=(flowMapValue.xyz*2.0-1.0)*flowMapValue.w;updatedDirection+=flowMapDirection*timeDelta*params.flowMapStrength;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";s.d.ShadersStoreWGSL[m]||(s.d.ShadersStoreWGSL[m]=F);(0,h.f)("BABYLON.ComputeShaderParticleSystem",class{constructor(K,H){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=K,this._engine=H}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var K;return(null===(K=this._updateComputeShader)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){var H;const M={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(M.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(M.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(M.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(M.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(M.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(M.noiseTexture={group:1,binding:11}),this._parent.flowMap&&(M.flowMapTexture={group:1,binding:13}),this._updateComputeShader=new U("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:M,defines:K.split("\n")}),null===(H=this._simParamsComputeShader)||void 0===H||H.dispose(),this._simParamsComputeShader=new j.c(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.flowMap&&(this._simParamsComputeShader.addUniform("flowMapProjection",16),this._simParamsComputeShader.addUniform("flowMapStrength",1)),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new l(this._simParamsComputeShader)}createVertexBuffers(K,H){this._renderVertexBuffers.push(H)}createParticleBuffer(K){const H=new k(this._engine,4*K.length,11,"ComputeShaderParticleSystemBuffer");return H.update(K),this._bufferComputeShader.push(H),H.getBuffer()}bindDrawBuffers(K,H,M){this._engine.bindBuffers(this._renderVertexBuffers[K],M,H)}preUpdateParticleBuffer(){}updateParticleBuffer(K,H,M){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._parent.flowMap&&this._updateComputeShader.setTexture("flowMapTexture",this._parent.flowMap),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[K]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^K]),this._updateComputeShader.dispatch(Math.ceil(M/64))}releaseBuffers(){var K;for(let H=0;H<this._bufferComputeShader.length;++H)this._bufferComputeShader[H].dispose();this._bufferComputeShader.length=0,null===(K=this._simParamsComputeShader)||void 0===K||K.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class Y{constructor(K,H,M){this.gradient=K,this.color1=H,this.color2=M}getColorToRef(K){this.color2?y.Ch.LerpToRef(this.color1,this.color2,Math.random(),K):K.q(this.color1)}}class r{constructor(K,H){this.gradient=K,this.color=H}}class e{constructor(K,H,M){this.gradient=K,this.factor1=H,this.factor2=M}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class b{static GetCurrentGradient(K,H,M){if(H[0].gradient>K)return void M(H[0],H[0],1);for(let w=0;w<H.length-1;w++){const q=H[w],u=H[w+1];if(K>=q.gradient&&K<=u.gradient){return void M(q,u,(K-q.gradient)/(u.gradient-q.gradient))}}const q=H.length-1;M(H[q],H[q],1)}}var P=M(11102),g=M(11758),X=M(11143);class A{constructor(K){this.particleSystem=K,this.position=q.OH.Zero(),this.direction=q.OH.Zero(),this.color=new y.Ch(0,0,0,0),this.colorStep=new y.Ch(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new q.Vector2(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new y.Ch(0,0,0,0),this._currentColor2=new y.Ch(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=A._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let K=this.age,H=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===H?(H=1,K=this._randomCellOffset):K+=this._randomCellOffset);const M=this._initialEndSpriteCellId-this._initialStartSpriteCellId+1;let q;q=this._initialSpriteCellLoop?(0,I.Clamp)(K*H%this.lifeTime/this.lifeTime):(0,I.Clamp)(K*H/this.lifeTime),this.cellIndex=this._initialStartSpriteCellId+q*M|0}_inheritParticleInfoToSubEmitter(K){if(K.particleSystem.wH.position){const H=K.particleSystem.wH;if(H.position.q(this.position),K.inheritDirection){const K=q.TmpVectors.OH[0];this.direction.normalizeToRef(K),H.setDirection(K,0,Math.PI/2)}}else{K.particleSystem.wH.q(this.position)}this.direction.scaleToRef(K.inheritedVelocityAmount/2,q.TmpVectors.OH[0]),K.particleSystem._inheritedVelocityOffset.q(q.TmpVectors.OH[0])}_inheritParticleInfoToSubEmitters(){if(this._attachedSubEmitters&&this._attachedSubEmitters.length>0)for(const K of this._attachedSubEmitters)this._inheritParticleInfoToSubEmitter(K)}_reset(){this.age=0,this.id=A._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(K){K.position.q(this.position),this._initialDirection?K._initialDirection?K._initialDirection.q(this._initialDirection):K._initialDirection=this._initialDirection.clone():K._initialDirection=null,K.direction.q(this.direction),this.Ph&&(K.Ph?K.Ph.q(this.Ph):K.Ph=this.Ph.clone()),K.color.q(this.color),K.colorStep.q(this.colorStep),K.lifeTime=this.lifeTime,K.age=this.age,K._randomCellOffset=this._randomCellOffset,K.size=this.size,K.scale.q(this.scale),K.angle=this.angle,K.angularSpeed=this.angularSpeed,K.particleSystem=this.particleSystem,K.cellIndex=this.cellIndex,K.id=this.id,K._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(K._currentColorGradient=this._currentColorGradient,K._currentColor1.q(this._currentColor1),K._currentColor2.q(this._currentColor2)),this._currentSizeGradient&&(K._currentSizeGradient=this._currentSizeGradient,K._currentSize1=this._currentSize1,K._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(K._currentAngularSpeedGradient=this._currentAngularSpeedGradient,K._currentAngularSpeed1=this._currentAngularSpeed1,K._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(K._currentVelocityGradient=this._currentVelocityGradient,K._currentVelocity1=this._currentVelocity1,K._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(K._currentLimitVelocityGradient=this._currentLimitVelocityGradient,K._currentLimitVelocity1=this._currentLimitVelocity1,K._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(K._currentDragGradient=this._currentDragGradient,K._currentDrag1=this._currentDrag1,K._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(K._initialStartSpriteCellId=this._initialStartSpriteCellId,K._initialEndSpriteCellId=this._initialEndSpriteCellId,K._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(K.remapData&&this.remapData?K.remapData.q(this.remapData):K.remapData=new q.Vector4(0,0,0,0)),this._randomNoiseCoordinates1&&(K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.q(this._randomNoiseCoordinates1),K._randomNoiseCoordinates2.q(this._randomNoiseCoordinates2)):(K._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),K._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}A._Count=0;var KK=M(11403),HK=(M(11440),M(11656)),MK=M(11651),qK=M(11541);function wK(K,H){const M=(0,I.RandomRange)(0,1);y.Ch.LerpToRef(H.color1,H.color2,M,K.color),H.colorDead.subtractToRef(K.color,H._colorDiff),H._colorDiff.scaleToRef(1/K.lifeTime,K.colorStep)}function uK(K,H){K._currentColorGradient=H._colorGradients[0],K._currentColorGradient.getColorToRef(K.color),K._currentColor1.q(K.color),H._colorGradients.length>1?H._colorGradients[1].getColorToRef(K._currentColor2):K._currentColor2.q(K.color)}function yK(K,H){const M=H._colorGradients;b.GetCurrentGradient(H._ratio,M,((H,M,q)=>{H!==K._currentColorGradient&&(K._currentColor1.q(K._currentColor2),M.getColorToRef(K._currentColor2),K._currentColorGradient=H),y.Ch.LerpToRef(K._currentColor1,K._currentColor2,q,K.color)}))}function hK(K,H){K.colorStep.scaleToRef(H._scaledUpdateSpeed,H._scaledColorStep),K.color.addInPlace(H._scaledColorStep),K.color.a<0&&(K.color.a=0)}function WK(K,H){b.GetCurrentGradient(H._ratio,H._angularSpeedGradients,((H,M,q)=>{H!==K._currentAngularSpeedGradient&&(K._currentAngularSpeed1=K._currentAngularSpeed2,K._currentAngularSpeed2=M.getFactor(),K._currentAngularSpeedGradient=H),K.angularSpeed=(0,I.Lerp)(K._currentAngularSpeed1,K._currentAngularSpeed2,q)}))}function IK(K,H){K.angle+=K.angularSpeed*H._scaledUpdateSpeed}function fK(K,H){H.particleEmitterType.startDirectionFunction(H._emitterWorldMatrix,K.direction,K,H.isLocal,H._emitterInverseWorldMatrix)}function zK(K,H){H.startDirectionFunction(H._emitterWorldMatrix,K.direction,K,H.isLocal)}function GK(K,H){K._currentVelocityGradient=H._velocityGradients[0],K._currentVelocity1=K._currentVelocityGradient.getFactor(),H._velocityGradients.length>1?K._currentVelocity2=H._velocityGradients[1].getFactor():K._currentVelocity2=K._currentVelocity1}function aK(K,H){K._currentLimitVelocityGradient=H._limitVelocityGradients[0],K._currentLimitVelocity1=K._currentLimitVelocityGradient.getFactor(),H._limitVelocityGradients.length>1?K._currentLimitVelocity2=H._limitVelocityGradients[1].getFactor():K._currentLimitVelocity2=K._currentLimitVelocity1}function vK(K,H){b.GetCurrentGradient(H._ratio,H._velocityGradients,((M,q,w)=>{M!==K._currentVelocityGradient&&(K._currentVelocity1=K._currentVelocity2,K._currentVelocity2=q.getFactor(),K._currentVelocityGradient=M),H._directionScale*=(0,I.Lerp)(K._currentVelocity1,K._currentVelocity2,w)}))}function OK(K,H){b.GetCurrentGradient(H._ratio,H._limitVelocityGradients,((M,q,w)=>{M!==K._currentLimitVelocityGradient&&(K._currentLimitVelocity1=K._currentLimitVelocity2,K._currentLimitVelocity2=q.getFactor(),K._currentLimitVelocityGradient=M);const u=(0,I.Lerp)(K._currentLimitVelocity1,K._currentLimitVelocity2,w);K.direction.length()>u&&K.direction.scaleInPlace(H.limitVelocityDamping)}))}function LK(K,H){K.direction.scaleToRef(H._directionScale,H._scaledDirection)}function SK(K,H){H.particleEmitterType.startPositionFunction(H._emitterWorldMatrix,K.position,K,H.isLocal)}function BK(K,H){H.startPositionFunction(H._emitterWorldMatrix,K.position,K,H.isLocal)}function CK(K,H){K.Ph?K.Ph.q(K.position):K.Ph=K.position.clone(),q.OH.TransformCoordinatesToRef(K.Ph,H._emitterWorldMatrix,K.position)}function iK(K,H){H.isLocal&&K.Ph?(K.Ph.addInPlace(H._scaledDirection),q.OH.TransformCoordinatesToRef(K.Ph,H._emitterWorldMatrix,K.position)):K.position.addInPlace(H._scaledDirection)}function ZK(K,H){K._currentDragGradient=H._dragGradients[0],K._currentDrag1=K._currentDragGradient.getFactor(),H._dragGradients.length>1?K._currentDrag2=H._dragGradients[1].getFactor():K._currentDrag2=K._currentDrag1}function EK(K,H){b.GetCurrentGradient(H._ratio,H._dragGradients,((M,q,w)=>{M!==K._currentDragGradient&&(K._currentDrag1=K._currentDrag2,K._currentDrag2=q.getFactor(),K._currentDragGradient=M);const u=(0,I.Lerp)(K._currentDrag1,K._currentDrag2,w);H._scaledDirection.scaleInPlace(1-u)}))}function lK(K,H){K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.Lh(Math.random(),Math.random(),Math.random()),K._randomNoiseCoordinates2.Lh(Math.random(),Math.random(),Math.random())):(K._randomNoiseCoordinates1=new q.OH(Math.random(),Math.random(),Math.random()),K._randomNoiseCoordinates2=new q.OH(Math.random(),Math.random(),Math.random()))}function sK(K,H){const M=H._noiseTextureData,w=H._noiseTextureSize;if(M&&w&&K._randomNoiseCoordinates1){const u=H._fetchR(K._randomNoiseCoordinates1.x,K._randomNoiseCoordinates1.y,w.width,w.height,M),y=H._fetchR(K._randomNoiseCoordinates1.z,K._randomNoiseCoordinates2.x,w.width,w.height,M),h=H._fetchR(K._randomNoiseCoordinates2.y,K._randomNoiseCoordinates2.z,w.width,w.height,M),W=q.TmpVectors.OH[0],I=q.TmpVectors.OH[1];W.Lh((2*u-1)*H.noiseStrength.x,(2*y-1)*H.noiseStrength.y,(2*h-1)*H.noiseStrength.z),W.scaleToRef(H._tempScaledUpdateSpeed,I),K.direction.addInPlace(I)}}function DK(K,H){H.gravity.scaleToRef(H._tempScaledUpdateSpeed,H._scaledGravity),K.direction.addInPlace(H._scaledGravity)}function VK(K,H){K.size=(0,I.RandomRange)(H.minSize,H.maxSize),K.scale.Lh((0,I.RandomRange)(H.minScaleX,H.maxScaleX),(0,I.RandomRange)(H.minScaleY,H.maxScaleY))}function nK(K,H){K._currentSizeGradient=H._sizeGradients[0],K._currentSize1=K._currentSizeGradient.getFactor(),K.size=K._currentSize1,H._sizeGradients.length>1?K._currentSize2=H._sizeGradients[1].getFactor():K._currentSize2=K._currentSize1,K.scale.Lh((0,I.RandomRange)(H.minScaleX,H.maxScaleX),(0,I.RandomRange)(H.minScaleY,H.maxScaleY))}function cK(K,H){const M=H._actualFrame/H.targetStopDuration;b.GetCurrentGradient(M,H._startSizeGradients,((M,q,w)=>{M!==H._currentStartSizeGradient&&(H._currentStartSize1=H._currentStartSize2,H._currentStartSize2=q.getFactor(),H._currentStartSizeGradient=M);const u=(0,I.Lerp)(H._currentStartSize1,H._currentStartSize2,w);K.scale.scaleInPlace(u)}))}function kK(K,H){b.GetCurrentGradient(H._ratio,H._sizeGradients,((H,M,q)=>{H!==K._currentSizeGradient&&(K._currentSize1=K._currentSize2,K._currentSize2=M.getFactor(),K._currentSizeGradient=H),K.size=(0,I.Lerp)(K._currentSize1,K._currentSize2,q)}))}function TK(K,H){K.remapData=new q.Vector4(0,1,0,1)}function dK(K,H){H._colorRemapGradients&&H._colorRemapGradients.length>0&&b.GetCurrentGradient(H._ratio,H._colorRemapGradients,((H,M,q)=>{const w=(0,I.Lerp)(H.factor1,M.factor1,q),u=(0,I.Lerp)(H.factor2,M.factor2,q);K.remapData.x=w,K.remapData.y=u-w})),H._alphaRemapGradients&&H._alphaRemapGradients.length>0&&b.GetCurrentGradient(H._ratio,H._alphaRemapGradients,((H,M,q)=>{const w=(0,I.Lerp)(H.factor1,M.factor1,q),u=(0,I.Lerp)(H.factor2,M.factor2,q);K.remapData.z=w,K.remapData.w=u-w}))}function xK(K,H){const M=(0,I.Clamp)(H._actualFrame/H.targetStopDuration);b.GetCurrentGradient(M,H._lifeTimeGradients,((H,q)=>{const w=H,u=q,y=w.getFactor(),h=u.getFactor(),W=(M-w.gradient)/(u.gradient-w.gradient);K.lifeTime=(0,I.Lerp)(y,h,W)})),H._emitPower=(0,I.RandomRange)(H.minEmitPower,H.maxEmitPower)}function QK(K,H){K.lifeTime=(0,I.RandomRange)(H.minLifeTime,H.maxLifeTime),H._emitPower=(0,I.RandomRange)(H.minEmitPower,H.maxEmitPower)}function JK(K,H){0===H._emitPower?(K._initialDirection?K._initialDirection.q(K.direction):K._initialDirection=K.direction.clone(),K.direction.set(0,0,0)):(K._initialDirection=null,K.direction.scaleInPlace(H._emitPower)),K.direction.addInPlace(H._inheritedVelocityOffset)}function NK(K,H){K.angularSpeed=(0,I.RandomRange)(H.minAngularSpeed,H.maxAngularSpeed),K.angle=(0,I.RandomRange)(H.minInitialRotation,H.maxInitialRotation)}function pK(K,H){K._currentAngularSpeedGradient=H._angularSpeedGradients[0],K.angularSpeed=K._currentAngularSpeedGradient.getFactor(),K._currentAngularSpeed1=K.angularSpeed,H._angularSpeedGradients.length>1?K._currentAngularSpeed2=H._angularSpeedGradients[1].getFactor():K._currentAngularSpeed2=K._currentAngularSpeed1,K.angle=(0,I.RandomRange)(H.minInitialRotation,H.maxInitialRotation)}function oK(K,H){K._initialStartSpriteCellId=H.startSpriteCellID,K._initialEndSpriteCellId=H.endSpriteCellID,K._initialSpriteCellLoop=H.spriteCellLoop}function RK(K,H){K.previousItem=H.previousItem,K.nextItem=H,H.previousItem&&(H.previousItem.nextItem=K),H.previousItem=K}function tK(K,H){K.previousItem=H,K.nextItem=H.nextItem,H.nextItem&&(H.nextItem.previousItem=K),H.nextItem=K}function UK(K,H){let M=H;for(;M.nextItem;)M=M.nextItem;K.previousItem=M,K.nextItem=M.nextItem,M.nextItem=K}function jK(K){K.previousItem&&(K.previousItem.nextItem=K.nextItem),K.nextItem&&(K.nextItem.previousItem=K.previousItem)}class mK extends W{get startDirectionFunction(){return this._startDirectionFunction}set startDirectionFunction(K){this._startDirectionFunction!==K&&(this._startDirectionFunction=K,this._directionProcessing.process=K?zK:fK)}get startPositionFunction(){return this._startPositionFunction}set startPositionFunction(K){this._startPositionFunction!==K&&(this._startPositionFunction=K,this._positionCreation.process=K?BK:SK)}set onDispose(K){this._onDisposeObserver&&this.Hh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Hh.add(K)}get W(){return this._isDisposed}get useRampGradients(){return this._useRampGradients}set useRampGradients(K){this._useRampGradients!==K&&(this._useRampGradients=K,this._resetEffect(),K?(this._rampCreation={process:TK,previousItem:null,nextItem:null},tK(this._rampCreation,this._colorCreation),this._remapGradientProcessing={process:dK,previousItem:null,nextItem:null},tK(this._remapGradientProcessing,this._gravityProcessing)):(jK(this._rampCreation),jK(this._remapGradientProcessing)))}get isLocal(){return this._isLocal}set isLocal(K){this._isLocal!==K&&(this._isLocal=K,K?(this._isLocalCreation={process:CK,previousItem:null,nextItem:null},tK(this._isLocalCreation,this._positionCreation)):jK(this._isLocalCreation))}get particles(){return this.ZG}get shaderLanguage(){return this._shaderLanguage}get _isAnimationSheetEnabled(){return this._animationSheetEnabled}set _isAnimationSheetEnabled(K){this._animationSheetEnabled!==K&&(this._animationSheetEnabled=K,K?(this._sheetCreation={process:oK,previousItem:null,nextItem:null},tK(this._sheetCreation,this._colorCreation)):jK(this._sheetCreation),this._reset())}getActiveCount(){return this.ZG.length}getClassName(){return"xh"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var K;let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[H])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[H]=new KK.c(this._engine),this._customWrappers[H].effect=K,this._customWrappers[H].drawContext&&(this._customWrappers[H].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new P.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}get noiseTexture(){return this._noiseTexture}set noiseTexture(K){if(this.noiseTexture!==K){if(this._noiseTexture=K,!K)return jK(this._noiseCreation),void jK(this._noiseProcessing);this._noiseCreation={process:lK,previousItem:null,nextItem:null},tK(this._noiseCreation,this._colorCreation),this._noiseProcessing={process:sK,previousItem:null,nextItem:null},tK(this._noiseProcessing,this._positionProcessing)}}constructor(K,H,M){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01,W=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(K),this._emitterInverseWorldMatrix=q.Matrix.Identity(),this._startDirectionFunction=null,this._startPositionFunction=null,this._inheritedVelocityOffset=new q.OH,this.Hh=new P.d,this.onStoppedObservable=new P.d,this.onStartedObservable=new P.d,this._noiseTextureSize=null,this._noiseTextureData=null,this.ZG=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new y.Ch(0,0,0,0),this._colorDiff=new y.Ch(0,0,0,0),this._scaledDirection=q.OH.Zero(),this._scaledGravity=q.OH.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._isDisposed=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this._updateQueueStart=null,this._startSizeCreation=null,this._createQueueStart=null,this._isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=K=>{},this.recycleParticle=K=>{const H=this.ZG.pop();H!==K&&H.copyTo(K),this._stockParticles.push(H)},this._createParticle=()=>{let K;return 0!==this._stockParticles.length?(K=this._stockParticles.pop(),K._reset()):K=new A(this),this._prepareParticle(K),K},this.paused=!1,this._shadersLoaded=!1,this._capacity=H,this._epsilon=h,M&&"Scene"!==M.getClassName()?(this._engine=M,this.defaultProjectionMatrix=q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=M||X.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.CG.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._lifeTimeCreation={process:QK,previousItem:null,nextItem:null},this._positionCreation={process:SK,previousItem:null,nextItem:null},tK(this._positionCreation,this._lifeTimeCreation),this._directionCreation={process:fK,previousItem:null,nextItem:null},tK(this._directionCreation,this._positionCreation),this._emitPowerCreation={process:JK,previousItem:null,nextItem:null},tK(this._emitPowerCreation,this._directionCreation),this._sizeCreation={process:VK,previousItem:null,nextItem:null},tK(this._sizeCreation,this._emitPowerCreation),this._angleCreation={process:NK,previousItem:null,nextItem:null},tK(this._angleCreation,this._sizeCreation),this._colorCreation={process:wK,previousItem:null,nextItem:null},tK(this._colorCreation,this._angleCreation),this._createQueueStart=this._lifeTimeCreation,W||(this._colorProcessing={process:hK,previousItem:null,nextItem:null},this._angularSpeedProcessing={process:IK,previousItem:null,nextItem:null},tK(this._angularSpeedProcessing,this._colorProcessing),this._directionProcessing={process:LK,previousItem:null,nextItem:null},tK(this._directionProcessing,this._angularSpeedProcessing),this._positionProcessing={process:iK,previousItem:null,nextItem:null},tK(this._positionProcessing,this._directionProcessing),this._gravityProcessing={process:DK,previousItem:null,nextItem:null},tK(this._gravityProcessing,this._positionProcessing),this._updateQueueStart=this._colorProcessing),this._isAnimationSheetEnabled=u,this._attachImageProcessingConfiguration(null),this._customWrappers={0:new KK.c(this._engine)},this._customWrappers[0].effect=w,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new z,this.updateFunction=K=>{var H;this.noiseTexture&&(this._noiseTextureSize=this.noiseTexture.getSize(),null===(H=this.noiseTexture.getContent())||void 0===H||H.then((K=>{this._noiseTextureData=K})));const M=K===this.ZG;for(let q=0;q<K.length;q++){const H=K[q];this._tempScaledUpdateSpeed=this._scaledUpdateSpeed;const w=H.age;if(H.age+=this._tempScaledUpdateSpeed,H.age>H.lifeTime){const K=H.age-w,M=H.lifeTime-w;this._tempScaledUpdateSpeed=M*this._tempScaledUpdateSpeed/K,H.age=H.lifeTime}this._ratio=H.age/H.lifeTime,this._directionScale=this._tempScaledUpdateSpeed;let u=this._updateQueueStart;for(;u;)u.process(H,this),u=u.nextItem;if(this._isAnimationSheetEnabled&&!W&&H.updateCellIndex(),H._inheritParticleInfoToSubEmitters(),H.age>=H.lifeTime){if(this._emitFromParticle(H),H._attachedSubEmitters){for(const K of H._attachedSubEmitters)K.particleSystem.disposeOnStop=!0,K.particleSystem.stop();H._attachedSubEmitters=null}this.recycleParticle(H),M&&q--}else;}}}serialize(K){throw new Error("Method not implemented.")}clone(K,H){throw new Error("Method not implemented.")}_addFactorGradient(K,H,M,q){const w=new e(H,M,q);K.push(w),K.sort(((K,H)=>K.gradient<H.gradient?-1:K.gradient>H.gradient?1:0))}_removeFactorGradient(K,H){if(!K)return;let M=0;for(const q of K){if(q.gradient===H){K.splice(M,1);break}M++}}_syncLifeTimeCreation(){this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0?this._lifeTimeCreation.process=xK:this._lifeTimeCreation.process=QK}_syncStartSizeCreation(){this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration?this._startSizeCreation||(this._startSizeCreation={process:cK,previousItem:null,nextItem:null},tK(this._startSizeCreation,this._sizeCreation)):this._startSizeCreation&&(jK(this._startSizeCreation),this._startSizeCreation=null)}get targetStopDuration(){return this._targetStopDuration}set targetStopDuration(K){this.targetStopDuration!==K&&(this._targetStopDuration=K,this._syncLifeTimeCreation(),this._syncStartSizeCreation())}addLifeTimeGradient(K,H,M){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,K,H,M),this._syncLifeTimeCreation(),this}removeLifeTimeGradient(K){return this._removeFactorGradient(this._lifeTimeGradients,K),this._syncLifeTimeCreation(),this}addSizeGradient(K,H,M){return this._sizeGradients||(this._sizeGradients=[]),0===this._sizeGradients.length&&(this._sizeCreation.process=nK,this._sizeGradientProcessing={process:kK,previousItem:null,nextItem:null},RK(this._sizeGradientProcessing,this._gravityProcessing)),this._addFactorGradient(this._sizeGradients,K,H,M),this}removeSizeGradient(K){var H;return this._removeFactorGradient(this._sizeGradients,K),0===(null===(H=this._sizeGradients)||void 0===H?void 0:H.length)&&(jK(this._sizeGradientProcessing),this._sizeCreation.process=VK),this}addColorRemapGradient(K,H,M){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,K,H,M),this}removeColorRemapGradient(K){return this._removeFactorGradient(this._colorRemapGradients,K),this}addAlphaRemapGradient(K,H,M){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,K,H,M),this}removeAlphaRemapGradient(K){return this._removeFactorGradient(this._alphaRemapGradients,K),this}addAngularSpeedGradient(K,H,M){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),0===this._angularSpeedGradients.length&&(this._angleCreation.process=pK,this._angularSpeedGradientProcessing={process:WK,previousItem:null,nextItem:null},RK(this._angularSpeedGradientProcessing,this._angularSpeedProcessing)),this._addFactorGradient(this._angularSpeedGradients,K,H,M),this}removeAngularSpeedGradient(K){var H;return this._removeFactorGradient(this._angularSpeedGradients,K),0===(null===(H=this._angularSpeedGradients)||void 0===H?void 0:H.length)&&(this._angleCreation.process=NK,jK(this._angularSpeedGradientProcessing)),this}addVelocityGradient(K,H,M){return this._velocityGradients||(this._velocityGradients=[]),0===this._velocityGradients.length&&(this._velocityCreation={process:GK,previousItem:null,nextItem:null},tK(this._velocityCreation,this._angleCreation),this._velocityGradientProcessing={process:vK,previousItem:null,nextItem:null},RK(this._velocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._velocityGradients,K,H,M),this}removeVelocityGradient(K){var H;return this._removeFactorGradient(this._velocityGradients,K),0===(null===(H=this._velocityGradients)||void 0===H?void 0:H.length)&&(jK(this._velocityCreation),jK(this._velocityGradientProcessing)),this}addLimitVelocityGradient(K,H,M){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),0===this._limitVelocityGradients.length&&(this._limitVelocityCreation={process:aK,previousItem:null,nextItem:null},tK(this._limitVelocityCreation,this._angleCreation),this._limitVelocityGradientProcessing={process:OK,previousItem:null,nextItem:null},tK(this._limitVelocityGradientProcessing,this._directionProcessing)),this._addFactorGradient(this._limitVelocityGradients,K,H,M),this}removeLimitVelocityGradient(K){var H;return this._removeFactorGradient(this._limitVelocityGradients,K),0===(null===(H=this._limitVelocityGradients)||void 0===H?void 0:H.length)&&(jK(this._limitVelocityCreation),jK(this._limitVelocityGradientProcessing)),this}addDragGradient(K,H,M){return this._dragGradients||(this._dragGradients=[]),0===this._dragGradients.length&&(this._dragCreation={process:ZK,previousItem:null,nextItem:null},RK(this._dragCreation,this._colorCreation),this._dragGradientProcessing={process:EK,previousItem:null,nextItem:null},RK(this._dragGradientProcessing,this._positionProcessing)),this._addFactorGradient(this._dragGradients,K,H,M),this}removeDragGradient(K){var H;return this._removeFactorGradient(this._dragGradients,K),0===(null===(H=this._dragGradients)||void 0===H?void 0:H.length)&&(jK(this._dragCreation),jK(this._dragGradientProcessing)),this}addEmitRateGradient(K,H,M){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,K,H,M),this}removeEmitRateGradient(K){return this._removeFactorGradient(this._emitRateGradients,K),this}addStartSizeGradient(K,H,M){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,K,H,M),this._syncStartSizeCreation(),this}removeStartSizeGradient(K){return this._removeFactorGradient(this._startSizeGradients,K),this._syncStartSizeCreation(),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const K=new Uint8Array(4*this._rawTextureWidth),H=y.TmpColors.CH[0];for(let M=0;M<this._rawTextureWidth;M++){const q=M/this._rawTextureWidth;b.GetCurrentGradient(q,this._rampGradients,((q,w,u)=>{y.CH.LerpToRef(q.color,w.color,u,H),K[4*M]=255*H.r,K[4*M+1]=255*H.g,K[4*M+2]=255*H.b,K[4*M+3]=255}))}this._rampGradientsTexture=g.d.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((K,H)=>K.gradient<H.gradient?-1:K.gradient>H.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(K,H){this._rampGradients||(this._rampGradients=[]);const M=new r(K,H);return this._rampGradients.push(M),this._syncRampGradientTexture(),this}removeRampGradient(K){return this._removeGradientAndTexture(K,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(K,H,M){this._colorGradients||(this._colorGradients=[]),0===this._colorGradients.length&&(this._colorCreation.process=uK,this._colorProcessing.process=yK);const q=new Y(K,H,M);return this._colorGradients.push(q),this._colorGradients.sort(((K,H)=>K.gradient<H.gradient?-1:K.gradient>H.gradient?1:0)),this}removeColorGradient(K){if(!this._colorGradients)return this;let H=0;for(const M of this._colorGradients){if(M.gradient===K){this._colorGradients.splice(H,1);break}H++}return 0===this._colorGradients.length&&(this._colorCreation.process=wK,this._colorProcessing.process=hK),this}resetDrawCache(){if(this._drawWrappers){for(const K of this._drawWrappers)if(K)for(const H of K)null===H||void 0===H||H.dispose();this._drawWrappers=[]}}_fetchR(K,H,M,q,w){return w[4*(((K=.5*Math.abs(K)+.5)*M%M|0)+((H=.5*Math.abs(H)+.5)*q%q|0)*M)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const K=this._engine,H=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*H),this._vertexBuffer=new Z.c(K,this._vertexData,!0,H);let M=0;const q=this._vertexBuffer.createVertexBuffer(Z.d.PositionKind,M,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.d.PositionKind]=q,M+=3;const w=this._vertexBuffer.createVertexBuffer(Z.d.ColorKind,M,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[Z.d.ColorKind]=w,M+=4;const u=this._vertexBuffer.createVertexBuffer("angle",M,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=u,M+=1;const y=this._vertexBuffer.createVertexBuffer("size",M,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=y,M+=2,this._isAnimationSheetEnabled){const K=this._vertexBuffer.createVertexBuffer("cellIndex",M,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=K,M+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const K=this._vertexBuffer.createVertexBuffer("direction",M,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=K,M+=3}if(this._useRampGradients){const K=this._vertexBuffer.createVertexBuffer("remapData",M,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=K,M+=4}let h;if(this._useInstancing){const H=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new Z.c(K,H,!1,2),h=this._spriteBuffer.createVertexBuffer("offset",0,2)}else h=this._vertexBuffer.createVertexBuffer("offset",M,2,this._vertexBufferSize,this._useInstancing),M+=2;this._vertexBuffers.offset=h,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const K=[],H=[];let M=0;for(let q=0;q<this._capacity;q++)K.push(M),K.push(M+1),K.push(M+2),K.push(M),K.push(M+2),K.push(M+3),H.push(M,M+1,M+1,M+2,M+2,M+3,M+3,M,M,M+3),M+=4;this._indexBuffer=this._engine.createIndexBuffer(K),this._linesIndexBuffer=this._engine.createIndexBuffer(H)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(K)setTimeout((()=>{this.start(0)}),K);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var H;-1!==(null===(H=this.wH)||void 0===H?void 0:H.getClassName().indexOf("Mesh"))&&this.wH.zh(!0);const K=this.noiseTexture;if(K&&K.onGeneratedObservable)K.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let H=0;H<this.preWarmCycles;H++)this.animate(!0),K.render()}))}));else for(let H=0;H<this.preWarmCycles;H++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop),this.onStartedObservable.notifyObservers(this)}}stop(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(K))}_postStop(K){}reset(){this._stockParticles.length=0,this.ZG.length=0}_appendParticleVertex(K,H,M,w){let u=K*this._vertexBufferSize;if(this._vertexData[u++]=H.position.x+this.BI.x,this._vertexData[u++]=H.position.y+this.BI.y,this._vertexData[u++]=H.position.z+this.BI.z,this._vertexData[u++]=H.color.r,this._vertexData[u++]=H.color.g,this._vertexData[u++]=H.color.b,this._vertexData[u++]=H.color.a,this._vertexData[u++]=H.angle,this._vertexData[u++]=H.scale.x*H.size,this._vertexData[u++]=H.scale.y*H.size,this._isAnimationSheetEnabled&&(this._vertexData[u++]=H.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[u++]=H.direction.x,this._vertexData[u++]=H.direction.y,this._vertexData[u++]=H.direction.z);else if(H._initialDirection){let K=H._initialDirection;this.isLocal&&(q.OH.TransformNormalToRef(K,this._emitterWorldMatrix,q.TmpVectors.OH[0]),K=q.TmpVectors.OH[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[u++]=K.x,this._vertexData[u++]=K.y,this._vertexData[u++]=K.z}else{let K=H.direction;this.isLocal&&(q.OH.TransformNormalToRef(K,this._emitterWorldMatrix,q.TmpVectors.OH[0]),K=q.TmpVectors.OH[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[u++]=K.x,this._vertexData[u++]=K.y,this._vertexData[u++]=K.z}this._useRampGradients&&H.remapData&&(this._vertexData[u++]=H.remapData.x,this._vertexData[u++]=H.remapData.y,this._vertexData[u++]=H.remapData.z,this._vertexData[u++]=H.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===M?M=this._epsilon:1===M&&(M=1-this._epsilon),0===w?w=this._epsilon:1===w&&(w=1-this._epsilon)),this._vertexData[u++]=M,this._vertexData[u++]=w)}_prepareParticle(K){}_createNewOnes(K){let H;for(let M=0;M<K&&this.ZG.length!==this._capacity;M++){H=this._createParticle(),this.ZG.push(H);let K=this._createQueueStart;for(;K;)K.process(H,this),K=K.nextItem;H._inheritParticleInfoToSubEmitters()}}_update(K){if(this._alive=this.ZG.length>0,this.wH.position){const K=this.wH;this._emitterWorldMatrix=K.getWorldMatrix()}else{const K=this.wH;this._emitterWorldMatrix=q.Matrix.Translation(K.x,K.y,K.z)}this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.ZG),this._createNewOnes(K)}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=[Z.d.PositionKind,Z.d.ColorKind,"angle","offset","size"];return K&&q.push("cellIndex"),H||q.push("direction"),M&&q.push("remapData"),q}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,HK.e)(q),K&&q.push("particlesInfos"),H&&q.push("logarithmicDepthConstant"),M&&(q.push("vFogInfos"),q.push("vFogColor")),q}fillDefines(K,H){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,HK.l)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&K.push("#define FOG")),this._isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),H===W.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&K.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case 2:K.push("#define BILLBOARDY");break;case 8:case 9:K.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&K.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:K.push("#define BILLBOARDMODE_ALL")}M&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,H,M){H.push(...mK._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),K.push(...mK._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),M.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,qK.g)(K,this._imageProcessingConfigurationDefines),(0,qK.e)(M,this._imageProcessingConfigurationDefines))}_getWrapper(K){const H=this._getCustomDrawWrapper(K);if(null!==H&&void 0!==H&&H.effect)return H;const M=[];this.fillDefines(M,K);const q=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let w=this._drawWrappers[q];w||(w=this._drawWrappers[q]=[]);let u=w[K];u||(u=new KK.c(this._engine),u.drawContext&&(u.drawContext.useInstancing=this._useInstancing),w[K]=u);const y=M.join("\n");if(u.defines!==y){const K=[],H=[],M=[];this.fillUniformsAttributesAndSamplerNames(H,K,M),u.setEffect(this._engine.createEffect("particles",K,H,M,y,void 0,void 0,void 0,void 0,this._shaderLanguage),y)}return u}animate(){var K;let H,M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started&&!this.paused){if(!M&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(M?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this.manualEmitCount>-1)H=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let K=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const H=this._actualFrame/this.targetStopDuration;b.GetCurrentGradient(H,this._emitRateGradients,((H,M,q)=>{H!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=M.getFactor(),this._currentEmitRateGradient=H),K=(0,I.Lerp)(this._currentEmitRate1,this._currentEmitRate2,q)}))}H=K*this._scaledUpdateSpeed|0,this._newPartsExcess+=K*this._scaledUpdateSpeed-H}if(this._newPartsExcess>1&&(H+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?H=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(H),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!M){let K=0;for(let H=0;H<this.ZG.length;H++){const M=this.ZG[H];this._appendParticleVertices(K,M),K+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.ZG.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(K,H){this._appendParticleVertex(K++,H,0,0),this._useInstancing||(this._appendParticleVertex(K++,H,1,0),this._appendParticleVertex(K++,H,1,1),this._appendParticleVertex(K++,H,0,1))}rebuild(){var K;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(K=this._spriteBuffer)||void 0===K||K._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!mK.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(M.bind(M,12761)),Promise.resolve().then(M.bind(M,12714))])):await Promise.all([Promise.resolve().then(M.bind(M,12707)),Promise.resolve().then(M.bind(M,12695))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.wH||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==W.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(W.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(W.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(K){const H=this._getWrapper(K),M=H.effect,w=this._engine;w.enableEffect(H);const u=this.defaultViewMatrix??this._scene.getViewMatrix();if(M.setTexture("diffuseSampler",this.particleTexture),M.setMatrix("view",u),M.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();M.setFloat3("particlesInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,this.spriteCellWidth/K.width)}if(M.setVector2("translationPivot",this.translationPivot),M.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;M.setVector3("eyePosition",K.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),M.setTexture("rampSampler",this._rampGradientsTexture));const y=M.defines;var h,W,I,f,z,G;(this._scene&&((0,HK.g)(M,this,this._scene),this.applyFog&&(0,MK.g)(this._scene,void 0,M)),y.indexOf("#define BILLBOARDMODE_ALL")>=0&&(u.invertToRef(q.TmpVectors.Matrix[0]),M.setMatrix("invView",q.TmpVectors.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(h=this._scene)&&void 0!==h&&h.forceWireframe?w.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,M):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,M)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(W=this._scene)&&void 0!==W&&W.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?w.bindBuffers(this._vertexBuffers,null!==(I=this._scene)&&void 0!==I&&I.forceWireframe?this._linesIndexBuffer:this._indexBuffer,M):w.bindBuffers(this._vertexBuffers,null!==(f=this._scene)&&void 0!==f&&f.forceWireframe?this._linesIndexBufferUseInstancing:null,M);(this.useLogarithmicDepth&&this._scene&&(0,MK.l)(y,M,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(M),this._setEngineBasedOnBlendMode(K),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(M),this._useInstancing)?null!==(z=this._scene)&&void 0!==z&&z.forceWireframe?w.drawElementsType(6,0,10,this.ZG.length):w.drawArraysType(7,0,4,this.ZG.length):null!==(G=this._scene)&&void 0!==G&&G.forceWireframe?w.drawElementsType(1,0,10*this.ZG.length):w.drawElementsType(0,0,6*this.ZG.length);return this.ZG.length}render(){if(!this.isReady()||!this.ZG.length)return 0;const K=this._engine;K.setState&&(K.setState(!1),this.forceDepthWrite&&K.setDepthWrite(!0));let H=0;return H=this.blendMode===W.BLENDMODE_MULTIPLYADD?this._render(W.BLENDMODE_MULTIPLY)+this._render(W.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),H}_onDispose(){}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(H,M),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const K=this._scene.CG.indexOf(this);K>-1&&this._scene.CG.splice(K,1),this._scene._activeParticleSystems.dispose()}this.Hh.notifyObservers(this),this.Hh.clear(),this.onStoppedObservable.clear(),this.onStartedObservable.clear(),this.reset(),this._isDisposed=!0}}mK.ForceGLSL=!1;var FK,YK=M(11132);!function(K){K[K.ATTACHED=0]="ATTACHED",K[K.END=1]="END"}(FK||(FK={}));class rK{constructor(K){if(this.particleSystem=K,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!K.wH||!K.wH.dispose){const H=(0,h.b)("BABYLON.AbstractMesh");K.wH=new H("SubemitterSystemEmitter",K.sK()),K._disposeEmitterOnDispose=!0}}clone(){let K=this.particleSystem.wH;if(K){if(K instanceof q.OH)K=K.clone();else if(-1!==K.getClassName().indexOf("Mesh")){K=new((0,h.b)("BABYLON.Mesh"))("",K.sK()),K.isVisible=!1}}else K=new q.OH;const H=new rK(this.particleSystem.clone(this.particleSystem.name,K));return H.particleSystem.name+="Clone",H.type=this.type,H.inheritDirection=this.inheritDirection,H.inheritedVelocityAmount=this.inheritedVelocityAmount,H.particleSystem._disposeEmitterOnDispose=!0,H.particleSystem.disposeOnStop=!0,H}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};return H.type=this.type,H.inheritDirection=this.inheritDirection,H.inheritedVelocityAmount=this.inheritedVelocityAmount,H.particleSystem=this.particleSystem.serialize(K),H}static _ParseParticleSystem(K,H,M){throw(0,YK.c)("ParseParticle")}static Parse(K,H,M){const q=K.particleSystem,w=new rK(rK._ParseParticleSystem(q,H,M,!0));return w.type=K.type,w.inheritDirection=K.inheritDirection,w.inheritedVelocityAmount=K.inheritedVelocityAmount,w.particleSystem._isSubEmitter=!0,w}dispose(){this.particleSystem.dispose()}}var eK=M(11180);function bK(K,H){const M=new S;return M.direction1=K,M.direction2=H,M}function PK(){return new L(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function gK(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function XK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.OH(0,1,0),M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0);return new C(K,H,M)}function AK(){return new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function KH(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0),u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.OH(0,1,0);return new O(K,H,M,w,u)}function HH(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new G(K,H)}function MH(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0),w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0);return new a(K,H,M,w)}const qH=q.OH.Zero(),wH=q.OH.Zero(),uH=q.OH.Zero();class yH{constructor(){this.strength=0,this.position=q.OH.Zero()}_processParticle(K,H){this.position.subtractToRef(K.position,qH);const M=qH.lengthSquared()+1;qH.normalize().scaleToRef(this.strength/M,wH),wH.scaleToRef(H._tempScaledUpdateSpeed,uH),K.direction.addInPlace(uH)}serialize(){return{position:this.position.hh(),strength:this.strength}}}class hH extends mK{constructor(){super(...arguments),this._nodeGenerated=!1,this._disposeEmitterOnDispose=!1,this.canStart=()=>!0,this._flowMap=null,this._flowMapUpdate=null,this.flowMapStrength=1,this._attractors=[],this._attractorUpdate=null,this._emitFromParticle=K=>{if(!this._subEmitters||0===this._subEmitters.length)return;const H=Math.floor(Math.random()*this._subEmitters.length);for(const M of this._subEmitters[H])if(1===M.type){const H=M.clone();K._inheritParticleInfoToSubEmitter(H),H.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(H.particleSystem),H.particleSystem.start()}}}get isNodeGenerated(){return this._nodeGenerated}createPointEmitter(K,H){const M=bK(K,H);return this.particleEmitterType=M,M}get flowMap(){return this._flowMap}set flowMap(K){this._flowMap!==K&&(this._flowMap=K,this._flowMapUpdate&&(jK(this._flowMapUpdate),this._flowMapUpdate=null),K&&(this._flowMapUpdate={process:K=>{var H;const M=null===(H=this.sK())||void 0===H?void 0:H.getTransformMatrix();this._flowMap._processParticle(K,this.flowMapStrength*this._tempScaledUpdateSpeed,M)},previousItem:null,nextItem:null},tK(this._flowMapUpdate,this._directionProcessing)))}get attractors(){return this._attractors.slice(0)}addAttractor(K){this._attractors.push(K),1===this._attractors.length&&(this._attractorUpdate={process:K=>{for(const H of this._attractors)H._processParticle(K,this)},previousItem:null,nextItem:null},tK(this._attractorUpdate,this._directionProcessing))}removeAttractor(K){const H=this._attractors.indexOf(K);-1!==H&&this._attractors.splice(H,1),0===this._attractors.length&&jK(this._attractorUpdate)}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;this.canStart()&&super.start(K)}createHemisphericEmitter(){const K=PK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=gK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=XK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.OH(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=AK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=KH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.OH(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=HH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=MH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,H,M,q){const w=new z;return this.particleEmitterType=w,this.direction1=K,this.direction2=H,this.minEmitBox=M,this.maxEmitBox=q,w}_prepareSubEmitterInternalArray(){if(this._subEmitters=new Array,this.subEmitters)for(const K of this.subEmitters)K instanceof hH?this._subEmitters.push([new rK(K)]):K instanceof rK?this._subEmitters.push([K]):K instanceof Array&&this._subEmitters.push(K)}_stopSubEmitters(){if(this.activeSubSystems){for(const K of this.activeSubSystems)K.stop(!0);this.activeSubSystems=[]}}_removeFromRoot(){if(!this._rootParticleSystem)return;const K=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==K&&this._rootParticleSystem.activeSubSystems.splice(K,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(K){K&&this._stopSubEmitters()}_prepareParticle(K){if(this._subEmitters&&this._subEmitters.length>0){const H=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];K._attachedSubEmitters=[];for(const M of H)if(0===M.type){const H=M.clone();K._attachedSubEmitters.push(H),H.particleSystem.start()}}}_onDispose(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),K&&this.particles)for(const M of this.particles)if(M._attachedSubEmitters)for(let K=M._attachedSubEmitters.length-1;K>=0;K-=1)M._attachedSubEmitters[K].dispose();if(H&&this.activeSubSystems)for(let M=this.activeSubSystems.length-1;M>=0;M-=1)this.activeSubSystems[M].dispose();if(this._subEmitters&&this._subEmitters.length){for(let K=0;K<this._subEmitters.length;K++)for(const H of this._subEmitters[K])H.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.wH&&this.wH.dispose&&this.wH.dispose(!0)}static _Parse(K,H,M,w){let u;u=M instanceof eK.b?null:M;const W=(0,h.b)("BABYLON.Texture");if(W&&u&&(K.texture?H.particleTexture=W.Parse(K.texture,u,w):K.textureName&&(H.particleTexture=new W(w+K.textureName,u,!1,void 0===K.invertY||K.invertY),H.particleTexture.name=K.textureName)),K.emitterId||0===K.emitterId||void 0!==K.wH?K.emitterId&&u?H.wH=u.getLastMeshById(K.emitterId):H.wH=q.OH.iH(K.wH):H.wH=q.OH.Zero(),H.isLocal=!!K.isLocal,void 0!==K.renderingGroupId&&(H.renderingGroupId=K.renderingGroupId),void 0!==K.isBillboardBased&&(H.isBillboardBased=K.isBillboardBased),void 0!==K.billboardMode&&(H.billboardMode=K.billboardMode),void 0!==K.useLogarithmicDepth&&(H.useLogarithmicDepth=K.useLogarithmicDepth),K.animations){for(let M=0;M<K.animations.length;M++){const q=K.animations[M],w=(0,h.b)("BABYLON.Animation");w&&H.animations.push(w.Parse(q))}H.beginAnimationOnStart=K.beginAnimationOnStart,H.beginAnimationFrom=K.beginAnimationFrom,H.beginAnimationTo=K.beginAnimationTo,H.beginAnimationLoop=K.beginAnimationLoop}if(K.autoAnimate&&u&&u.beginAnimation(H,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),H.startDelay=0|K.startDelay,H.minAngularSpeed=K.minAngularSpeed,H.maxAngularSpeed=K.maxAngularSpeed,H.minSize=K.minSize,H.maxSize=K.maxSize,K.minScaleX&&(H.minScaleX=K.minScaleX,H.maxScaleX=K.maxScaleX,H.minScaleY=K.minScaleY,H.maxScaleY=K.maxScaleY),void 0!==K.preWarmCycles&&(H.preWarmCycles=K.preWarmCycles,H.preWarmStepOffset=K.preWarmStepOffset),void 0!==K.minInitialRotation&&(H.minInitialRotation=K.minInitialRotation,H.maxInitialRotation=K.maxInitialRotation),H.minLifeTime=K.minLifeTime,H.maxLifeTime=K.maxLifeTime,H.minEmitPower=K.minEmitPower,H.maxEmitPower=K.maxEmitPower,H.emitRate=K.emitRate,H.gravity=q.OH.iH(K.gravity),K.noiseStrength&&(H.noiseStrength=q.OH.iH(K.noiseStrength)),H.color1=y.Ch.iH(K.color1),H.color2=y.Ch.iH(K.color2),H.colorDead=y.Ch.iH(K.colorDead),H.updateSpeed=K.updateSpeed,H.targetStopDuration=K.targetStopDuration,H.blendMode=K.blendMode,K.colorGradients)for(const q of K.colorGradients)H.addColorGradient(q.gradient,y.Ch.iH(q.color1),q.color2?y.Ch.iH(q.color2):void 0);if(K.rampGradients){for(const M of K.rampGradients)H.addRampGradient(M.gradient,y.CH.iH(M.color));H.useRampGradients=K.useRampGradients}if(K.colorRemapGradients)for(const q of K.colorRemapGradients)H.addColorRemapGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.alphaRemapGradients)for(const q of K.alphaRemapGradients)H.addAlphaRemapGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.sizeGradients)for(const q of K.sizeGradients)H.addSizeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.angularSpeedGradients)for(const q of K.angularSpeedGradients)H.addAngularSpeedGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.velocityGradients)for(const q of K.velocityGradients)H.addVelocityGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.dragGradients)for(const q of K.dragGradients)H.addDragGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.emitRateGradients)for(const q of K.emitRateGradients)H.addEmitRateGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.startSizeGradients)for(const q of K.startSizeGradients)H.addStartSizeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.lifeTimeGradients)for(const q of K.lifeTimeGradients)H.addLifeTimeGradient(q.gradient,void 0!==q.factor1?q.factor1:q.factor,q.factor2);if(K.limitVelocityGradients){for(const M of K.limitVelocityGradients)H.addLimitVelocityGradient(M.gradient,void 0!==M.factor1?M.factor1:M.factor,M.factor2);H.limitVelocityDamping=K.limitVelocityDamping}if(K.noiseTexture&&u){const M=(0,h.b)("BABYLON.ProceduralTexture");H.noiseTexture=M.Parse(K.noiseTexture,u,w)}let I;if(K.particleEmitterType){switch(K.particleEmitterType.type){case"SphereParticleEmitter":I=new B;break;case"SphereDirectedParticleEmitter":I=new C;break;case"ConeEmitter":case"ConeParticleEmitter":I=new G;break;case"ConeDirectedParticleEmitter":I=new a;break;case"CylinderParticleEmitter":I=new v;break;case"CylinderDirectedParticleEmitter":I=new O;break;case"HemisphericParticleEmitter":I=new L;break;case"PointParticleEmitter":I=new S;break;case"MeshParticleEmitter":I=new E;break;case"CustomParticleEmitter":I=new i;break;default:I=new z}I.parse(K.particleEmitterType,u)}else I=new z,I.parse(K,u);H.particleEmitterType=I,H.startSpriteCellID=K.startSpriteCellID,H.endSpriteCellID=K.endSpriteCellID,H.spriteCellLoop=K.spriteCellLoop??!0,H.spriteCellWidth=K.spriteCellWidth,H.spriteCellHeight=K.spriteCellHeight,H.spriteCellChangeSpeed=K.spriteCellChangeSpeed,H.spriteRandomStartCell=K.spriteRandomStartCell,H.disposeOnStop=K.disposeOnStop??!1,H.manualEmitCount=K.manualEmitCount??-1}static Parse(K,H,M){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4?arguments[4]:void 0;const h=K.name;let W,I,f=null,z=null;if(H instanceof eK.b?W=H:(I=H,W=I.getEngine()),K.customShader&&W.createEffectForParticles){z=K.customShader;const H=z.shaderOptions.defines.length>0?z.shaderOptions.defines.join("\n"):"";f=W.createEffectForParticles(z.shaderPath.fragmentElement,z.shaderOptions.uniforms,z.shaderOptions.samplers,H)}const G=new hH(h,u||K.kh,H,f,K.isAnimationSheetEnabled);if(G.customShader=z,G._rootUrl=M,K.id&&(G.id=K.id),K.subEmitters){G.subEmitters=[];for(const q of K.subEmitters){const K=[];for(const w of q)K.push(rK.Parse(w,H,M));G.subEmitters.push(K)}}if(K.attractors)for(const y of K.attractors){const K=new yH;K.position=q.OH.iH(y.position),K.strength=y.strength,G.addAttractor(K)}return hH._Parse(K,G,H,M),K.textureMask&&(G.textureMask=y.Ch.iH(K.textureMask)),K.BI&&(G.BI=q.OH.iH(K.BI)),K.preventAutoStart&&(G.preventAutoStart=K.preventAutoStart),w||G.preventAutoStart||G.start(),G}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};if(hH._Serialize(H,this,K),H.textureMask=this.textureMask.hh(),H.customShader=this.customShader,H.preventAutoStart=this.preventAutoStart,H.BI=this.BI.hh(),this.subEmitters){H.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const M of this._subEmitters){const q=[];for(const H of M)q.push(H.serialize(K));H.subEmitters.push(q)}}if(this._attractors&&this._attractors.length){H.attractors=[];for(const K of this._attractors)H.attractors.push(K.serialize())}return H}static _Serialize(K,H,M){if(K.name=H.name,K.id=H.id,K.kh=H.getCapacity(),K.disposeOnStop=H.disposeOnStop,K.manualEmitCount=H.manualEmitCount,H.wH.position){const M=H.wH;K.emitterId=M.id}else{const M=H.wH;K.wH=M.hh()}H.particleEmitterType&&(K.particleEmitterType=H.particleEmitterType.serialize()),H.particleTexture&&(M?K.texture=H.particleTexture.serialize():(K.textureName=H.particleTexture.name,K.invertY=!!H.particleTexture._invertY)),K.isLocal=H.isLocal,x.c.AppendSerializedAnimations(H,K),K.beginAnimationOnStart=H.beginAnimationOnStart,K.beginAnimationFrom=H.beginAnimationFrom,K.beginAnimationTo=H.beginAnimationTo,K.beginAnimationLoop=H.beginAnimationLoop,K.startDelay=H.startDelay,K.renderingGroupId=H.renderingGroupId,K.isBillboardBased=H.isBillboardBased,K.billboardMode=H.billboardMode,K.minAngularSpeed=H.minAngularSpeed,K.maxAngularSpeed=H.maxAngularSpeed,K.minSize=H.minSize,K.maxSize=H.maxSize,K.minScaleX=H.minScaleX,K.maxScaleX=H.maxScaleX,K.minScaleY=H.minScaleY,K.maxScaleY=H.maxScaleY,K.minEmitPower=H.minEmitPower,K.maxEmitPower=H.maxEmitPower,K.minLifeTime=H.minLifeTime,K.maxLifeTime=H.maxLifeTime,K.emitRate=H.emitRate,K.gravity=H.gravity.hh(),K.noiseStrength=H.noiseStrength.hh(),K.color1=H.color1.hh(),K.color2=H.color2.hh(),K.colorDead=H.colorDead.hh(),K.updateSpeed=H.updateSpeed,K.targetStopDuration=H.targetStopDuration,K.blendMode=H.blendMode,K.preWarmCycles=H.preWarmCycles,K.preWarmStepOffset=H.preWarmStepOffset,K.minInitialRotation=H.minInitialRotation,K.maxInitialRotation=H.maxInitialRotation,K.startSpriteCellID=H.startSpriteCellID,K.spriteCellLoop=H.spriteCellLoop,K.endSpriteCellID=H.endSpriteCellID,K.spriteCellChangeSpeed=H.spriteCellChangeSpeed,K.spriteCellWidth=H.spriteCellWidth,K.spriteCellHeight=H.spriteCellHeight,K.spriteRandomStartCell=H.spriteRandomStartCell,K.isAnimationSheetEnabled=H.isAnimationSheetEnabled,K.useLogarithmicDepth=H.useLogarithmicDepth;const q=H.getColorGradients();if(q){K.colorGradients=[];for(const H of q){const M={gradient:H.gradient,color1:H.color1.hh()};H.color2?M.color2=H.color2.hh():M.color2=H.color1.hh(),K.colorGradients.push(M)}}const w=H.getRampGradients();if(w){K.rampGradients=[];for(const H of w){const M={gradient:H.gradient,color:H.color.hh()};K.rampGradients.push(M)}K.useRampGradients=H.useRampGradients}const u=H.getColorRemapGradients();if(u){K.colorRemapGradients=[];for(const H of u){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.colorRemapGradients.push(M)}}const y=H.getAlphaRemapGradients();if(y){K.alphaRemapGradients=[];for(const H of y){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.alphaRemapGradients.push(M)}}const h=H.getSizeGradients();if(h){K.sizeGradients=[];for(const H of h){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.sizeGradients.push(M)}}const W=H.getAngularSpeedGradients();if(W){K.angularSpeedGradients=[];for(const H of W){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.angularSpeedGradients.push(M)}}const I=H.getVelocityGradients();if(I){K.velocityGradients=[];for(const H of I){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.velocityGradients.push(M)}}const f=H.getDragGradients();if(f){K.dragGradients=[];for(const H of f){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.dragGradients.push(M)}}const z=H.getEmitRateGradients();if(z){K.emitRateGradients=[];for(const H of z){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.emitRateGradients.push(M)}}const G=H.getStartSizeGradients();if(G){K.startSizeGradients=[];for(const H of G){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.startSizeGradients.push(M)}}const a=H.getLifeTimeGradients();if(a){K.lifeTimeGradients=[];for(const H of a){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.lifeTimeGradients.push(M)}}const v=H.getLimitVelocityGradients();if(v){K.limitVelocityGradients=[];for(const H of v){const M={gradient:H.gradient,factor1:H.factor1};void 0!==H.factor2?M.factor2=H.factor2:M.factor2=H.factor1,K.limitVelocityGradients.push(M)}K.limitVelocityDamping=H.limitVelocityDamping}H.noiseTexture&&(K.noiseTexture=H.noiseTexture.serialize())}clone(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q={...this._customWrappers};let w=null;const u=this._engine;if(u.createEffectForParticles&&null!=this.customShader){w=this.customShader;const K=w.shaderOptions.defines.length>0?w.shaderOptions.defines.join("\n"):"",H=u.createEffectForParticles(w.shaderPath.fragmentElement,w.shaderOptions.uniforms,w.shaderOptions.samplers,K);q[0]?q[0].effect=H:this.setCustomEffect(H,0)}const y=this.serialize(M),h=hH.Parse(y,this._scene||this._engine,this._rootUrl);return h.name=K,h.customShader=w,h._customWrappers=q,void 0===H&&(H=this.wH),this.noiseTexture&&(h.noiseTexture=this.noiseTexture.clone()),h.wH=H,this.preventAutoStart||h.start(),h}}hH.BILLBOARDMODE_Y=2,hH.BILLBOARDMODE_ALL=7,hH.BILLBOARDMODE_STRETCHED=8,hH.BILLBOARDMODE_STRETCHED_LOCAL=9,rK._ParseParticleSystem=hH.Parse;var WH=M(11531),IH=M(11522),fH=M(11412);fH.c.prototype.createTransformFeedback=function(){const K=this._gl.createTransformFeedback();if(!K)throw new Error("Unable to create Transform Feedback");return K},fH.c.prototype.deleteTransformFeedback=function(K){this._gl.deleteTransformFeedback(K)},fH.c.prototype.bindTransformFeedback=function(K){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,K)},fH.c.prototype.beginTransformFeedback=function(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(K?this._gl.POINTS:this._gl.TRIANGLES)},fH.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},fH.c.prototype.setTranformFeedbackVaryings=function(K,H){this._gl.transformFeedbackVaryings(K,H,this._gl.INTERLEAVED_ATTRIBS)},fH.c.prototype.bindTransformFeedbackBuffer=function(K){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K?K.underlyingResource:null)},fH.c.prototype.readTransformFeedbackBuffer=function(K){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K)};const zH="clipPlaneFragmentDeclaration2",GH="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";s.d.IncludesShadersStore[zH]||(s.d.IncludesShadersStore[zH]=GH);M(12603),M(12608),M(12617),M(12626),M(12633),M(12636),M(12643),M(12651);const aH="gpuRenderParticlesPixelShader",vH="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";s.d.ShadersStore[aH]||(s.d.ShadersStore[aH]=vH);const OH="clipPlaneVertexDeclaration2",LH="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";s.d.IncludesShadersStore[OH]||(s.d.IncludesShadersStore[OH]=LH);M(12653),M(12658),M(12664),M(12668);const SH="gpuRenderParticlesVertexShader",BH="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";s.d.ShadersStore[SH]||(s.d.ShadersStore[SH]=BH);class CH extends W{static get IsSupported(){if(!X.b.LastCreatedEngine)return!1;const K=X.b.LastCreatedEngine.getCaps();return K.supportTransformFeedbacks||K.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(K){this._maxActiveParticleCount=Math.min(K,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(K){this.maxActiveParticleCount=K}createPointEmitter(K,H){const M=bK(K,H);return this.particleEmitterType=M,M}createHemisphericEmitter(){const K=PK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=gK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=XK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new q.OH(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=AK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=KH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new q.OH(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=HH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=MH(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.OH(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new q.OH(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,H,M,q){const w=new z;return this.particleEmitterType=w,this.direction1=K,this.direction2=H,this.minEmitBox=M,this.maxEmitBox=q,w}get flowMap(){return this._flowMap}set flowMap(K){this._flowMap!==K&&(this._flowMap=K)}isReady(){if(!this.wH||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||this._flowMap&&!this._flowMap.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==hH.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(hH.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(hH.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";K?setTimeout((()=>{this.start(0)}),K):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var K;let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[H])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[H]=new KK.c(this._engine),this._customWrappers[H].effect=K}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new P.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(K,H,M){return super._removeGradientAndTexture(K,H,M),this._releaseBuffers(),this}addColorGradient(K,H){this._colorGradients||(this._colorGradients=[]);const M=new Y(K,H);return this._colorGradients.push(M),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(K&&this._colorGradients.sort(((K,H)=>K.gradient<H.gradient?-1:K.gradient>H.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(K){return this._removeGradientAndTexture(K,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const H in this._drawWrappers){var K;null===(K=this._drawWrappers[H].drawContext)||void 0===K||K.reset()}}_addFactorGradient(K,H,M){const q=new e(H,M);K.push(q),this._releaseBuffers()}addSizeGradient(K,H){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,K,H),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(K){return this._removeGradientAndTexture(K,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(K,H){if(!K)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&K.sort(((K,H)=>K.gradient<H.gradient?-1:K.gradient>H.gradient?1:0));const M=this;M[H]&&(M[H].dispose(),M[H]=null)}addAngularSpeedGradient(K,H){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,K,H),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(K){return this._removeGradientAndTexture(K,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(K,H){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,K,H),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(K){return this._removeGradientAndTexture(K,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(K,H){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,K,H),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(K){return this._removeGradientAndTexture(K,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(K,H){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,K,H),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(K){return this._removeGradientAndTexture(K,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(K){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(K,H,M){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(K),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Hh=new P.d,this.onStoppedObservable=new P.d,this.onStartedObservable=new P.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._flowMap=null,this.flowMapStrength=1,this._onBeforeDrawParticlesObservable=null,M&&"Scene"!==M.getClassName()?(this._engine=M,this.defaultProjectionMatrix=q.Matrix.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=M||X.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.CG.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,h.b)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,h.b)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,h.b)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,h.b)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new KK.c(this._engine)},this._customWrappers[0].effect=w,this._drawWrappers={0:new KK.c(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(H=H??{}).randomTextureSize||delete H.randomTextureSize;const y={kh:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...H},W=H;isFinite(W)&&(y.kh=W),this._capacity=y.kh,this._maxActiveParticleCount=y.kh,this._currentActiveCount=0,this._isAnimationSheetEnabled=u,this.particleEmitterType=new z;const I=Math.min(this._engine.getCaps().maxTextureSize,y.randomTextureSize);let f=[];for(let q=0;q<I;++q)f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),f.push(Math.random());this._randomTexture=new g.d(new Float32Array(f),I,1,5,M,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,f=[];for(let q=0;q<I;++q)f.push(Math.random()),f.push(Math.random()),f.push(Math.random()),f.push(Math.random());this._randomTexture2=new g.d(new Float32Array(f),I,1,5,M,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=I}_reset(){this._releaseBuffers()}_createVertexBuffers(K,H,M){const q={};q.position=H.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let w=3;q.age=H.createVertexBuffer("age",w,1,this._attributesStrideSize,!0),w+=1,q.size=H.createVertexBuffer("size",w,3,this._attributesStrideSize,!0),w+=3,q.life=H.createVertexBuffer("life",w,1,this._attributesStrideSize,!0),w+=1,w+=4,this.billboardMode===hH.BILLBOARDMODE_STRETCHED&&(q.direction=H.createVertexBuffer("direction",w,3,this._attributesStrideSize,!0)),w+=3,this._platform.alignDataInBuffer&&(w+=1),this.particleEmitterType instanceof i&&(w+=3,this._platform.alignDataInBuffer&&(w+=1)),this._colorGradientsTexture||(q.color=H.createVertexBuffer("color",w,4,this._attributesStrideSize,!0),w+=4),this._isBillboardBased||(q.initialDirection=H.createVertexBuffer("initialDirection",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1)),this.noiseTexture&&(q.noiseCoordinates1=H.createVertexBuffer("noiseCoordinates1",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1),q.noiseCoordinates2=H.createVertexBuffer("noiseCoordinates2",w,3,this._attributesStrideSize,!0),w+=3,this._platform.alignDataInBuffer&&(w+=1)),q.angle=H.createVertexBuffer("angle",w,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?w++:w+=2,this._isAnimationSheetEnabled&&(q.cellIndex=H.createVertexBuffer("cellIndex",w,1,this._attributesStrideSize,!0),w+=1,this.spriteRandomStartCell&&(q.cellStartOffset=H.createVertexBuffer("cellStartOffset",w,1,this._attributesStrideSize,!0),w+=1)),q.offset=M.createVertexBuffer("offset",0,2),q.uv=M.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(q),this._platform.createVertexBuffers(K,q),this.resetDrawCache()}_initialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!K)return;const H=this._engine,M=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof i&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const w=this.particleEmitterType instanceof i,u=q.TmpVectors.OH[0];let y=0;for(let q=0;q<this._capacity;q++)if(M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(0),M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),w?(this.particleEmitterType.particleDestinationGenerator(q,null,u),M.push(u.x),M.push(u.y),M.push(u.z)):(M.push(0),M.push(0),M.push(0)),this._platform.alignDataInBuffer&&M.push(0),y+=16,w&&(this.particleEmitterType.particlePositionGenerator(q,null,u),M.push(u.x),M.push(u.y),M.push(u.z),this._platform.alignDataInBuffer&&M.push(0),y+=4),this._colorGradientsTexture||(M.push(0),M.push(0),M.push(0),M.push(0),y+=4),this.isBillboardBased||(M.push(0),M.push(0),M.push(0),this._platform.alignDataInBuffer&&M.push(0),y+=4),this.noiseTexture&&(M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),this._platform.alignDataInBuffer&&M.push(0),M.push(Math.random()),M.push(Math.random()),M.push(Math.random()),this._platform.alignDataInBuffer&&M.push(0),y+=8),M.push(0),y+=1,this._angularSpeedGradientsTexture||(M.push(0),y+=1),this._isAnimationSheetEnabled&&(M.push(0),y+=1,this.spriteRandomStartCell&&(M.push(0),y+=1)),this._platform.alignDataInBuffer){let K=3-(y+3&3);for(y+=K;K-- >0;)M.push(0)}const h=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),W=this._platform.createParticleBuffer(M),I=this._platform.createParticleBuffer(M);this._buffer0=new Z.c(H,W,!1,this._attributesStrideSize),this._buffer1=new Z.c(H,I,!1,this._attributesStrideSize),this._spriteBuffer=new Z.c(H,h,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let K=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(K+="\n#define BILLBOARD"),this._colorGradientsTexture&&(K+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(K+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(K+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(K+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(K+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(K+="\n#define DRAGGRADIENTS"),this._flowMap&&(K+="\n#define FLOWMAP"),this.isAnimationSheetEnabled&&(K+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(K+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(K+="\n#define NOISE"),this.isLocal&&(K+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===K||(this._cachedUpdateDefines=K,this._updateBuffer=this._platform.createUpdateBuffer(K)),this._platform.isUpdateBufferReady()}_getWrapper(K){const H=this._getCustomDrawWrapper(K);if(null!==H&&void 0!==H&&H.effect)return H;const M=[];this.fillDefines(M,K);let q=this._drawWrappers[K];q||(q=new KK.c(this._engine),q.drawContext&&(q.drawContext.useInstancing=!0),this._drawWrappers[K]=q);const w=M.join("\n");if(q.defines!==w){const K=[],H=[],M=[];this.fillUniformsAttributesAndSamplerNames(H,K,M),q.setEffect(this._engine.createEffect("gpuRenderParticles",K,H,M,w),w)}return q}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const w=[Z.d.PositionKind,"age","life","size","angle"];return K||w.push(Z.d.ColorKind),H&&w.push("cellIndex"),M||w.push("initialDirection"),q&&w.push("direction"),w.push("offset",Z.d.UVKind),w}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q=["emitterWM","BI","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,HK.e)(q),K&&q.push("sheetInfos"),H&&q.push("logarithmicDepthConstant"),M&&(q.push("vFogInfos"),q.push("vFogColor")),q}fillDefines(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,HK.l)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==IH.b.FOGMODE_NONE&&K.push("#define FOG")),H===hH.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this.isLocal&&K.push("#define LOCAL"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case hH.BILLBOARDMODE_Y:K.push("#define BILLBOARDY");break;case hH.BILLBOARDMODE_STRETCHED:K.push("#define BILLBOARDSTRETCHED");break;case hH.BILLBOARDMODE_ALL:K.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&K.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),M&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,H,M){H.push(...CH._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===hH.BILLBOARDMODE_STRETCHED)),K.push(...CH._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),M.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(WH.b.PrepareUniforms(K,this._imageProcessingConfigurationDefines),WH.b.PrepareSamplers(M,this._imageProcessingConfigurationDefines))}animate(){var K;let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(H?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(K,H){const M=this[H];if(!K||!K.length||M)return;const q=new Float32Array(this._rawTextureWidth);for(let w=0;w<this._rawTextureWidth;w++){const H=w/this._rawTextureWidth;b.GetCurrentGradient(H,K,((K,H,M)=>{q[w]=(0,I.Lerp)(K.factor1,H.factor1,M)}))}this[H]=g.d.CreateRTexture(q,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[H].name=H.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const K=new Uint8Array(4*this._rawTextureWidth),H=y.TmpColors.Ch[0];for(let M=0;M<this._rawTextureWidth;M++){const q=M/this._rawTextureWidth;b.GetCurrentGradient(q,this._colorGradients,((q,w,u)=>{y.Ch.LerpToRef(q.color1,w.color1,u,H),K[4*M]=255*H.r,K[4*M+1]=255*H.g,K[4*M+2]=255*H.b,K[4*M+3]=255*H.a}))}this._colorGradientsTexture=g.d.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(K,H){var M,w,u,y;const h=this._getWrapper(K),W=h.effect;this._engine.enableEffect(h);const I=(null===(M=this._scene)||void 0===M?void 0:M.getViewMatrix())||q.Matrix.IdentityReadOnly;if(W.setMatrix("view",I),W.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),W.setTexture("diffuseSampler",this.particleTexture),W.setVector2("translationPivot",this.translationPivot),W.setVector3("BI",this.BI),this.isLocal&&W.setMatrix("emitterWM",H),this._colorGradientsTexture?W.setTexture("colorGradientSampler",this._colorGradientsTexture):W.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();W.setFloat3("sheetInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,K.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;W.setVector3("eyePosition",K.globalPosition)}const f=W.defines;if(this._scene&&((0,HK.g)(W,this,this._scene),this.applyFog&&(0,MK.g)(this._scene,void 0,W)),f.indexOf("#define BILLBOARDMODE_ALL")>=0){const K=I.clone();K.invert(),W.setMatrix("invView",K)}return this.useLogarithmicDepth&&this._scene&&(0,MK.l)(f,W,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(W),this._setEngineBasedOnBlendMode(K),this._platform.bindDrawBuffers(this._targetIndex,W,null!==(w=this._scene)&&void 0!==w&&w.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(W),null!==(u=this._scene)&&void 0!==u&&u.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(y=this._scene)&&void 0!==y&&y.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(K){if(!this.wH||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!K)if(this.wH.position){K=this.wH.getWorldMatrix()}else{const H=this.wH;K=q.TmpVectors.Matrix[0],q.Matrix.TranslationToRef(H.x,H.y,H.z,K)}const H=this._engine,M=H.getDepthWrite();if(H.setDepthWrite(!1),this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this._flowMap){const K=this.sK();this._updateBuffer.setFloat("flowMapStrength",this.flowMapStrength),this._updateBuffer.setMatrix("flowMapProjection",K.getTransformMatrix())}this.isLocal||this._updateBuffer.setMatrix("emitterWM",K),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const w=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=w,H.setDepthWrite(M)}render(){let K,H=arguments.length>0&&void 0!==arguments[0]&&arguments[0],M=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!H&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let K=0;K<this.preWarmCycles;K++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this.manualEmitCount>-1?(this._accumulatedCount+=this.manualEmitCount,this.manualEmitCount=0):this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>=1){const K=0|this._accumulatedCount;this._accumulatedCount-=K,this._currentActiveCount+=K}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.wH.position){K=this.wH.getWorldMatrix()}else{const H=this.wH;K=q.TmpVectors.Matrix[0],q.Matrix.TranslationToRef(H.x,H.y,H.z,K)}const w=this._engine;this.updateInAnimate||this._update(K);let u=0;return H||M||(w.setState(!1),this.forceDepthWrite&&w.setDepthWrite(!0),u=this.blendMode===hH.BLENDMODE_MULTIPLYADD?this._render(hH.BLENDMODE_MULTIPLY,K)+this._render(hH.BLENDMODE_ADD,K):this._render(this.blendMode,K),this._engine.setAlphaMode(0)),u}rebuild(){const K=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(K,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,K()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const H in this._drawWrappers){this._drawWrappers[H].dispose()}if(this._drawWrappers={},this._scene){const K=this._scene.CG.indexOf(this);K>-1&&this._scene.CG.splice(K,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let H=0;H<this._renderVertexBuffers.length;++H){const K=this._renderVertexBuffers[H];for(const H in K)K[H].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Hh.notifyObservers(this),this.Hh.clear()}clone(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const q={...this._customWrappers};let w=null;const u=this._engine;if(u.createEffectForParticles&&null!=this.customShader){w=this.customShader;const K=w.shaderOptions.defines.length>0?w.shaderOptions.defines.join("\n"):"";q[0]=u.createEffectForParticles(w.shaderPath.fragmentElement,w.shaderOptions.uniforms,w.shaderOptions.samplers,K,void 0,void 0,void 0,this)}const y=this.serialize(M),h=CH.Parse(y,this._scene||this._engine,this._rootUrl);return h.name=K,h.customShader=w,h._customWrappers=q,void 0===H&&(H=this.wH),this.noiseTexture&&(h.noiseTexture=this.noiseTexture.clone()),h.wH=H,h}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={};return hH._Serialize(H,this,K),H.activeParticleCount=this.activeParticleCount,H.randomTextureSize=this._randomTextureSize,H.customShader=this.customShader,H}static Parse(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4?arguments[4]:void 0;const u=K.name;let y,h;H instanceof eK.b?y=H:(h=H,y=h.getEngine());const W=new CH(u,{kh:w||K.kh,randomTextureSize:K.randomTextureSize},H,null,K.isAnimationSheetEnabled);if(W._rootUrl=M,K.customShader&&y.createEffectForParticles){const H=K.customShader,M=H.shaderOptions.defines.length>0?H.shaderOptions.defines.join("\n"):"",q=y.createEffectForParticles(H.shaderPath.fragmentElement,H.shaderOptions.uniforms,H.shaderOptions.samplers,M,void 0,void 0,void 0,W);W.setCustomEffect(q,0),W.customShader=H}return K.id&&(W.id=K.id),K.activeParticleCount&&(W.activeParticleCount=K.activeParticleCount),hH._Parse(K,W,H,M),K.preventAutoStart&&(W.preventAutoStart=K.preventAutoStart),q||W.preventAutoStart||W.start(),W}}var iH=M(11100),ZH=M(12670),EH=M(11659);class lH{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(K){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const H of this.systems)H.wH=K;this._emitterNode=K}setEmitterAsSphere(K,H,M){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:K,renderingGroupId:H};const q=(0,ZH.d)("emitterSphere",{diameter:K.diameter,segments:K.segments},M);q.renderingGroupId=H;const w=new EH.BH("emitterSphereMaterial",M);w.emissiveColor=K.color,q.material=w;for(const u of this.systems)u.wH=q;this._emitterNode=q}start(K){for(const H of this.systems)K&&(H.wH=K),H.start()}dispose(){for(const K of this.systems)K.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H={systems:[]};for(const M of this.systems)H.systems.push(M.serialize(K));return this._emitterNode&&(H.wH=this._emitterCreationOptions),H}static Parse(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0;const w=new lH,u=this.BaseAssetsUrl+"/textures/";H=H||X.b.LastCreatedScene;for(const y of K.systems)w.systems.push(M?CH.Parse(y,H,u,!0,q):hH.Parse(y,H,u,!0,q));if(K.wH){const M=K.wH.options;if("Sphere"===K.wH.kind)w.setEmitterAsSphere({diameter:M.diameter,segments:M.segments,color:y.CH.iH(M.color)},K.wH.renderingGroupId,H)}return w}}lH.BaseAssetsUrl="https://assets.babylonjs.com/particles";var sH=M(11135);class DH{static CreateDefault(K){let H,M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,q=arguments.length>2?arguments[2]:void 0;H=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new CH("default system",{kh:M},q):new hH("default system",M,q),H.wH=K;const w=iH.Tools.GetAssetUrl("https://assets.babylonjs.com/core/textures/flare.png");return H.particleTexture=new Q.b(w,H.sK()),H.createConeEmitter(.1,Math.PI/4),H.color1=new y.Ch(1,1,1,1),H.color2=new y.Ch(1,1,1,1),H.colorDead=new y.Ch(1,1,1,0),H.minSize=.1,H.maxSize=.1,H.minEmitPower=2,H.maxEmitPower=2,H.updateSpeed=1/60,H.emitRate=30,H}static CreateAsync(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0;H||(H=X.b.LastCreatedScene);const w={};return H.addPendingData(w),new Promise(((u,y)=>{if(M&&!CH.IsSupported)return H.removePendingData(w),y("Particle system with GPU is not supported.");iH.Tools.LoadFile(`${DH.BaseAssetsUrl}/systems/${K}.json`,(K=>{H.removePendingData(w);const y=JSON.parse(K.toString());return u(lH.Parse(y,H,M,q))}),void 0,void 0,void 0,(()=>(H.removePendingData(w),y(`An error occurred with the creation of your particle system. Check if your type '${K}' exists.`))))}))}static ExportSet(K){const H=new lH;for(const M of K)H.systems.push(M);return H}static ParseFromFileAsync(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",u=arguments.length>5?arguments[5]:void 0;return new Promise(((y,h)=>{const W=new sH.c;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const H=JSON.parse(W.responseText);let h;h=q?CH.Parse(H,M,w,!1,u):hH.Parse(H,M,w,!1,u),K&&(h.name=K),y(h)}else h("Unable to load the particle system")})),W.open("GET",H),W.send()}))}static ParseFromSnippetAsync(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",w=arguments.length>4?arguments[4]:void 0;if("_BLANK"===K){const K=this.CreateDefault(null);return K.start(),Promise.resolve(K)}return new Promise(((u,y)=>{const h=new sH.c;h.addEventListener("readystatechange",(()=>{if(4==h.readyState)if(200==h.status){const y=JSON.parse(JSON.parse(h.responseText).jsonPayload),W=JSON.parse(y.particleSystem);let I;I=M?CH.Parse(W,H,q,!1,w):hH.Parse(W,H,q,!1,w),I.snippetId=K,u(I)}else y("Unable to load the snippet "+K)})),h.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),h.send()}))}}DH.BaseAssetsUrl=lH.BaseAssetsUrl,DH.SnippetUrl="https://snippet.babylonjs.com",DH.CreateFromSnippetAsync=DH.ParseFromSnippetAsync;var VH=M(11726),nH=M(11555),cH=M(12678);(0,cH.f)(nH.d.NAME_PARTICLESYSTEM,((K,H,M,q)=>{const w=(0,cH.h)(nH.d.NAME_PARTICLESYSTEM);if(w&&void 0!==K.CG&&null!==K.CG)for(let u=0,y=K.CG.length;u<y;u++){const y=K.CG[u];M.CG.push(w(y,H,q))}})),(0,cH.e)(nH.d.NAME_PARTICLESYSTEM,((K,H,M)=>{if(K.activeParticleCount){return CH.Parse(K,H,M)}return hH.Parse(K,H,M)})),eK.b.prototype.createEffectForParticles=function(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",u=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0,h=arguments.length>6?arguments[6]:void 0,W=arguments.length>7?arguments[7]:void 0,I=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,f=arguments.length>9?arguments[9]:void 0,z=[],G=[];const a=[];return W?W.fillUniformsAttributesAndSamplerNames(G,z,a):(z=hH._GetAttributeNamesOrOptions(),G=hH._GetEffectCreationOptions()),-1===w.indexOf(" BILLBOARD")&&(w+="\n#define BILLBOARD\n"),null!==W&&void 0!==W&&W.isAnimationSheetEnabled&&-1===w.indexOf(" ANIMATESHEET")&&(w+="\n#define ANIMATESHEET\n"),-1===q.indexOf("diffuseSampler")&&q.push("diffuseSampler"),this.createEffect({vertex:f??(null===W||void 0===W?void 0:W.vertexShaderName)??"particles",fragmentElement:K},z,G.concat(H),a.concat(q),w,u,y,h,void 0,I,(async()=>{0===I?await Promise.resolve().then(M.bind(M,12707)):await Promise.resolve().then(M.bind(M,12761))}))},VH.b.prototype.getEmittedParticleSystems=function(){const K=[];for(let H=0;H<this.sK().CG.length;H++){const M=this.sK().CG[H];M.wH===this&&K.push(M)}return K},VH.b.prototype.getHierarchyEmittedParticleSystems=function(){const K=[],H=this.getDescendants();H.push(this);for(let M=0;M<this.sK().CG.length;M++){const q=this.sK().CG[M],w=q.wH;w.position&&-1!==H.indexOf(w)&&K.push(q)}return K};M(11629),M(11639),M(11712);M(11714),M(12681),M(11485),M(11612),M(11754);M(11476);var kH;M(12687),M(11309);!function(K){K[K.Color=2]="Color",K[K.UV=1]="UV",K[K.Random=0]="Random",K[K.Stated=3]="Stated"}(kH||(kH={}));var TH=M(11507);const dH=new q.OH(0,0,0),xH=new q.OH(0,0,0),QH=new q.OH(0,0,0);class JH{constructor(K,H,M){this.width=K,this.height=H,this.data=M}processFlowable(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2?arguments[2]:void 0;if(!M)return;M instanceof q.Matrix?q.OH.TransformCoordinatesToRef(K.position,M,QH):(QH.x=M.x,QH.y=M.y,QH.z=M.z);const w=.5*QH.x+.5,u=1-(.5*QH.y+.5),y=Math.floor(w*this.width),h=Math.floor(u*this.height);if(y<0||y>=this.width||h<0||h>=this.height)return;const W=4*(h*this.width+y),I=this.data[W]/255*2-1,f=this.data[W+1]/255*2-1,z=this.data[W+2]/255*2-1,G=this.data[W+3]/255;dH.set(I,f,z),dH.scaleToRef(H*G,xH),K.direction.addInPlace(xH)}_processParticle(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,M=arguments.length>2?arguments[2]:void 0;this.processFlowable(K,H,M)}static async FromUrlAsync(K){return await new Promise(((H,M)=>{const q=document.createElement("canvas"),w=q.getContext("2d");let u=null;const y=new Image;y.crossOrigin="anonymous",y.src=K,y.onerror=H=>{M(new Error(`Failed to load image: ${K} : ${H}`))},y.onload=()=>{q.width=y.width,q.height=y.height,w.drawImage(y,0,0),u=w.getImageData(0,0,q.width,q.height),H(new JH(q.width,q.height,u.data))}}))}static async ExtractFromTextureAsync(K){return await new Promise(((H,M)=>{if(!K.isReady())return void K.onLoadObservable.addOnce((async()=>{try{const M=await this.ExtractFromTextureAsync(K);H(M)}catch(q){M(q)}}));const q=K.getSize();TH.l.GetTextureDataAsync(K,q.width,q.height).then((K=>{H(new JH(q.width,q.height,new Uint8ClampedArray(K)))})).catch(M)}))}}var NH,pH,oH,RH,tH,UH,jH,mH,FH;!function(K){K[K.Int=1]="Int",K[K.Float=2]="Float",K[K.Vector2=4]="Vector2",K[K.OH=8]="OH",K[K.Matrix=16]="Matrix",K[K.Particle=32]="Particle",K[K.Texture=64]="Texture",K[K.Ch=128]="Ch",K[K.FloatGradient=256]="FloatGradient",K[K.Vector2Gradient=512]="Vector2Gradient",K[K.Vector3Gradient=1024]="Vector3Gradient",K[K.Color4Gradient=2048]="Color4Gradient",K[K.System=4096]="System",K[K.AutoDetect=8192]="AutoDetect",K[K.BasedOnInput=16384]="BasedOnInput",K[K.Undefined=32768]="Undefined",K[K.All=65535]="All"}(NH||(NH={})),function(K){K[K.Compatible=0]="Compatible",K[K.TypeIncompatible=1]="TypeIncompatible",K[K.HierarchyIssue=2]="HierarchyIssue"}(pH||(pH={})),function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(oH||(oH={}));class YH{get direction(){return this._direction}get type(){if(this._type===NH.AutoDetect){if(this._ownerBlock.isInput)return this._ownerBlock.type;if(this._connectedPoint)return this._connectedPoint.type;if(this._linkedConnectionSource){if(this._linkedConnectionSource.isConnected)return this._linkedConnectionSource.type;if(this._linkedConnectionSource._defaultConnectionPointType)return this._linkedConnectionSource._defaultConnectionPointType}if(this._defaultConnectionPointType)return this._defaultConnectionPointType}if(this._type===NH.BasedOnInput){if(this._typeConnectionSource)return!this._typeConnectionSource.isConnected&&this._defaultConnectionPointType?this._defaultConnectionPointType:this._typeConnectionSourceTranslation?this._typeConnectionSourceTranslation(this._typeConnectionSource.type):this._typeConnectionSource.type;if(this._defaultConnectionPointType)return this._defaultConnectionPointType}return this._type}set type(K){this._type=K}get isConnected(){return null!==this.connectedPoint||this.hasEndpoints}get connectedPoint(){return this._connectedPoint}get ownerBlock(){return this._ownerBlock}get sourceBlock(){return this._connectedPoint?this._connectedPoint.ownerBlock:null}get connectedBlocks(){return 0===this._endpoints.length?[]:this._endpoints.map((K=>K.ownerBlock))}get endpoints(){return this._endpoints}get hasEndpoints(){return this._endpoints&&this._endpoints.length>0}get innerType(){return this._linkedConnectionSource&&!this._isMainLinkSource&&this._linkedConnectionSource.isConnected?this.type:this._type}constructor(K,H,M){this._connectedPoint=null,this._storedValue=null,this._storedFunction=null,this._acceptedConnectionPointType=null,this._endpoints=new Array,this._type=NH.Particle,this._linkedConnectionSource=null,this._typeConnectionSource=null,this._typeConnectionSourceTranslation=null,this._defaultConnectionPointType=null,this._isMainLinkSource=!1,this.acceptedConnectionPointTypes=[],this.excludedConnectionPointTypes=[],this.onConnectionObservable=new P.d,this.onDisconnectionObservable=new P.d,this.isExposedOnFrame=!1,this.exposedPortPosition=-1,this.defaultValue=null,this.value=null,this.valueMin=null,this.valueMax=null,this._ownerBlock=H,this.name=K,this._direction=M}getClassName(){return"NodeParticleConnectionPoint"}getConnectedValue(K){var H;return this.isConnected?null!==(H=this._connectedPoint)&&void 0!==H&&H._storedFunction?this._connectedPoint._storedFunction(K):this._connectedPoint._storedValue:this.value}canConnectTo(K){return 0===this.checkCompatibilityState(K)}checkCompatibilityState(K){const H=this._ownerBlock,M=K.ownerBlock;if(this.type!==K.type&&K.innerType!==NH.AutoDetect)return K.acceptedConnectionPointTypes&&-1!==K.acceptedConnectionPointTypes.indexOf(this.type)?0:1;if(K.excludedConnectionPointTypes&&-1!==K.excludedConnectionPointTypes.indexOf(this.type))return 1;let q=M,w=H;return 0===this.direction&&(q=H,w=M),q.isAnAncestorOf(w)?2:0}connectTo(K){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.canConnectTo(K))throw`Cannot connect these two connectors. source: "${this.ownerBlock.name}".${this.name}, target: "${K.ownerBlock.name}".${K.name}`;return this._endpoints.push(K),K._connectedPoint=this,this.onConnectionObservable.notifyObservers(K),K.onConnectionObservable.notifyObservers(this),this}disconnectFrom(K){const H=this._endpoints.indexOf(K);return-1===H||(this._endpoints.splice(H,1),K._connectedPoint=null,this.onDisconnectionObservable.notifyObservers(K),K.onDisconnectionObservable.notifyObservers(this)),this}addExcludedConnectionPointFromAllowedTypes(K){let H=1;for(;H<NH.All;)K&H||this.excludedConnectionPointTypes.push(H),H<<=1}serialize(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const H={};return H.name=this.name,H.displayName=this.displayName,void 0!==this.value&&null!==this.value&&(this.value.hh?(H.valueType="BABYLON."+this.value.getClassName(),H.value=this.value.hh()):(H.valueType="number",H.value=this.value)),K&&this.connectedPoint&&(H.inputName=this.name,H.targetBlockId=this.connectedPoint.ownerBlock.uniqueId,H.targetConnectionName=this.connectedPoint.name,H.isExposedOnFrame=!0,H.exposedPortPosition=this.exposedPortPosition),(this.isExposedOnFrame||this.exposedPortPosition>=0)&&(H.isExposedOnFrame=!0,H.exposedPortPosition=this.exposedPortPosition),H}dispose(){this.onConnectionObservable.clear(),this.onDisconnectionObservable.clear()}}class rH{get isTeleportOut(){return this._isTeleportOut}get isTeleportIn(){return this._isTeleportIn}get isSystem(){return this._isSystem}get isInput(){return this._isInput}get isDebug(){return this._isDebug}get name(){return this._name}set name(K){this._name=K}getClassName(){return"NodeParticleBlock"}get inputs(){return this._inputs}get outputs(){return this._outputs}constructor(K){this._name="",this._isInput=!1,this._isSystem=!1,this._isDebug=!1,this._isTeleportOut=!1,this._isTeleportIn=!1,this._inputs=new Array,this._outputs=new Array,this.onBuildObservable=new P.d,this.Hh=new P.d,this.onInputChangedObservable=new P.d,this.visibleOnFrame=!1,this._name=K,this.uniqueId=J.e.UniqueId}_inputRename(K){return K}_outputRename(K){return K}isAnAncestorOf(K){for(const H of this._outputs)if(H.hasEndpoints)for(const M of H.endpoints){if(M.ownerBlock===K)return!0;if(M.ownerBlock.isAnAncestorOf(K))return!0}return!1}isAnAncestorOfType(K){if(this.getClassName()===K)return!0;for(const H of this._outputs)if(H.hasEndpoints)for(const M of H.endpoints)if(M.ownerBlock.isAnAncestorOfType(K))return!0;return!1}getInputByName(K){const H=this._inputs.filter((H=>H.name===K));return H.length?H[0]:null}_linkConnectionTypes(K,H){arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this._inputs[H]._acceptedConnectionPointType=this._inputs[K]:(this._inputs[K]._linkedConnectionSource=this._inputs[H],this._inputs[K]._isMainLinkSource=!0),this._inputs[H]._linkedConnectionSource=this._inputs[K]}registerInput(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0,w=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0;const y=new YH(K,this,0);return y.type=H,y.isOptional=M,y.defaultValue=q,y.value=q,y.valueMin=w,y.valueMax=u,this._inputs.push(y),this.onInputChangedObservable.notifyObservers(y),this}registerOutput(K,H,M){return(M=M??new YH(K,this,1)).type=H,this._outputs.push(M),this}_build(K){}_customBuildStep(K){}build(K){if(this._buildId===K.buildId)return!0;if(this._outputs.length>0&&!this._outputs.some((K=>K.hasEndpoints))&&!this.isDebug&&!this.isSystem)return!1;this._buildId=K.buildId;for(const H of this._inputs){if(!H.connectedPoint){H.isOptional||K.notConnectedNonOptionalInputs.push(H);continue}const M=H.connectedPoint.ownerBlock;M&&M!==this&&!M.isSystem&&M.build(K)}return this._customBuildStep(K),K.verbose&&N.e.Log(`Building ${this.name} [${this.getClassName()}]`),this._build(K),this.onBuildObservable.notifyObservers(this),!1}serialize(){const K={};K.customType="BABYLON."+this.getClassName(),K.id=this.uniqueId,K.name=this.name,K.visibleOnFrame=this.visibleOnFrame,K.inputs=[],K.outputs=[];for(const H of this.inputs)K.inputs.push(H.serialize());for(const H of this.outputs)K.outputs.push(H.serialize(!1));return K}_deserialize(K){this._name=K.name,this.comments=K.comments,this.visibleOnFrame=!!K.visibleOnFrame,this._deserializePortDisplayNamesAndExposedOnFrame(K)}_deserializePortDisplayNamesAndExposedOnFrame(K){const H=K.inputs,M=K.outputs;if(H)for(const q of H){const K=this.inputs.find((K=>K.name===q.name));if(!K)return;if(q.displayName&&(K.displayName=q.displayName),q.isExposedOnFrame&&(K.isExposedOnFrame=q.isExposedOnFrame,K.exposedPortPosition=q.exposedPortPosition),void 0!==q.value&&null!==q.value)if("number"===q.valueType)K.value=q.value;else{const H=(0,h.b)(q.valueType);H&&(K.value=H.iH(q.value))}}if(M)for(let q=0;q<M.length;q++){const K=M[q];K.displayName&&(this.outputs[q].displayName=K.displayName),K.isExposedOnFrame&&(this.outputs[q].isExposedOnFrame=K.isExposedOnFrame,this.outputs[q].exposedPortPosition=K.exposedPortPosition)}}clone(){const K=this.serialize(),H=(0,h.b)(K.customType);if(H){const M=new H;return M._deserialize(K),M}return null}dispose(){this.Hh.notifyObservers(this),this.Hh.clear();for(const K of this.inputs)K.dispose();for(const K of this.outputs)K.dispose();this.onBuildObservable.clear(),this.onInputChangedObservable.clear()}}function eH(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"PROPERTIES",q=arguments.length>3?arguments[3]:void 0;return(w,u)=>{let y=w._propStore;y||(y=[],w._propStore=y),y.push({propertyName:u,displayName:K,type:H,groupName:M,options:q??{},className:w.getClassName()})}}(0,T.e)([(0,d.J)("comment")],rH.prototype,"comments",void 0),function(K){K[K.Boolean=0]="Boolean",K[K.Float=1]="Float",K[K.Int=2]="Int",K[K.Vector2=3]="Vector2",K[K.List=4]="List",K[K.Ch=5]="Ch",K[K.SamplingMode=6]="SamplingMode",K[K.TextureFormat=7]="TextureFormat",K[K.TextureType=8]="TextureType"}(RH||(RH={})),function(K){K[K.None=0]="None",K[K.Position=1]="Position",K[K.Direction=2]="Direction",K[K.Age=3]="Age",K[K.Lifetime=4]="Lifetime",K[K.Color=5]="Color",K[K.ScaledDirection=6]="ScaledDirection",K[K.Scale=7]="Scale",K[K.AgeGradient=8]="AgeGradient",K[K.Angle=9]="Angle",K[K.SpriteCellIndex=16]="SpriteCellIndex",K[K.SpriteCellStart=17]="SpriteCellStart",K[K.SpriteCellEnd=18]="SpriteCellEnd"}(tH||(tH={})),function(K){K[K.None=0]="None",K[K.Time=1]="Time",K[K.Delta=2]="Delta",K[K.Emitter=3]="Emitter"}(UH||(UH={}));class bH{constructor(){this.notConnectedNonOptionalInputs=[],this.particleContext=null,this.systemContext=null,this.gradientIndex=0,this.nextGradientIndex=0}emitErrors(){let K="";for(const H of this.notConnectedNonOptionalInputs)K+=`input ${H.name} from block ${H.ownerBlock.name}[${H.ownerBlock.getClassName()}] is not connected and is not optional.\n`;if(K)throw"Build of Node Particle System Set failed:\n"+K}adapt(K,H){const M=K.getConnectedValue(this)||0;if(K.type===H)return M;switch(H){case NH.Vector2:return new q.Vector2(M,M);case NH.OH:return new q.OH(M,M,M);case NH.Ch:return new y.Ch(M,M,M,M)}return null}getContextualValue(K){if(!this.particleContext||!this.systemContext)return null;switch(K){case tH.Position:return this.particleContext.position;case tH.Direction:return this.particleContext.direction;case tH.ScaledDirection:return this.particleContext.direction.scaleToRef(this.systemContext._directionScale,this.systemContext._scaledDirection),this.systemContext._scaledDirection;case tH.Color:return this.particleContext.color;case tH.Age:return this.particleContext.age;case tH.Lifetime:return this.particleContext.lifeTime;case tH.Angle:return this.particleContext.angle;case tH.Scale:return this.particleContext.scale;case tH.AgeGradient:return this.particleContext.age/this.particleContext.lifeTime;case tH.SpriteCellEnd:return this.systemContext.endSpriteCellID;case tH.SpriteCellIndex:return this.particleContext.cellIndex;case tH.SpriteCellStart:return this.systemContext.startSpriteCellID}return null}get isEmitterTransformNode(){return!!this.systemContext&&!!this.systemContext.wH.position}get emitterWorldMatrix(){return this.systemContext?this.systemContext._emitterWorldMatrix:null}get emitterInverseWorldMatrix(){return this.systemContext?this.systemContext._emitterInverseWorldMatrix:null}get emitterPosition(){return this.systemContext?this.isEmitterTransformNode?this.systemContext.wH.absolutePosition:this.systemContext.wH:null}getSystemValue(K){if(!this.particleContext||!this.systemContext)return null;switch(K){case UH.Time:return this.systemContext._actualFrame;case UH.Delta:return this.systemContext._scaledUpdateSpeed;case UH.Emitter:if(this.isEmitterTransformNode){return this.systemContext.wH.absolutePosition}return this.systemContext.wH}return null}}function PH(K,H,M){const q=new bH;q.SH=H;const w=K.createSystem(q);return w.canStart=()=>!0,w.wH=M.clone(),w.disposeOnStop=!0,w.start(),w}class gH extends rH{constructor(K){super(K),this.blendMode=W.BLENDMODE_ONEONE,this.kh=1e3,this.emitRate=10,this.targetStopDuration=0,this.startDelay=0,this.doNoStart=!1,this._isSystem=!0,this.registerInput("particle",NH.Particle),this.registerInput("texture",NH.Texture),this.registerInput("onStart",NH.System,!0),this.registerInput("onEnd",NH.System,!0),this.registerOutput("system",NH.System)}getClassName(){return"SystemBlock"}get particle(){return this._inputs[0]}get texture(){return this._inputs[1]}get onStart(){return this._inputs[2]}get onEnd(){return this._inputs[3]}get system(){return this._outputs[0]}createSystem(K){K.kh=this.kh,K.buildId=this._buildId++,this.build(K);const H=this.particle.getConnectedValue(K);return H.particleTexture=this.texture.getConnectedValue(K),H.emitRate=this.emitRate,H.blendMode=this.blendMode,H.name=this.name,H._nodeGenerated=!0,H._targetStopDuration=this.targetStopDuration,H.startDelay=this.startDelay,this.system._storedValue=this,H.canStart=()=>!this.doNoStart,H.onStartedObservable.add((M=>{const q=this.onStart.getConnectedValue(K);q&&M.onStartedObservable.addOnce((()=>{K.systemContext=H;const M=PH(q,K.SH,K.emitterPosition);this.Hh.addOnce((()=>{M.dispose()}))}));const w=this.onEnd.getConnectedValue(K);w&&M.onStoppedObservable.addOnce((()=>{K.systemContext=H;const M=PH(w,K.SH,K.emitterPosition);this.Hh.addOnce((()=>{M.dispose()}))}))})),this.Hh.addOnce((()=>{H.dispose()})),H}serialize(){const K=super.serialize();return K.kh=this.kh,K.emitRate=this.emitRate,K.blendMode=this.blendMode,K.doNoStart=this.doNoStart,K.targetStopDuration=this.targetStopDuration,K.startDelay=this.startDelay,K}_deserialize(K){super._deserialize(K),this.kh=K.kh,this.emitRate=K.emitRate,this.doNoStart=!!K.doNoStart,void 0!==K.blendMode&&(this.blendMode=K.blendMode),void 0!==K.targetStopDuration&&(this.targetStopDuration=K.targetStopDuration),void 0!==K.startDelay&&(this.startDelay=K.startDelay)}}(0,T.e)([eH("Blend mode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"OneOne",value:W.BLENDMODE_ONEONE},{label:"Standard",value:W.BLENDMODE_STANDARD},{label:"Add",value:W.BLENDMODE_ADD},{label:"Multiply",value:W.BLENDMODE_MULTIPLY},{label:"MultiplyAdd",value:W.BLENDMODE_MULTIPLYADD}]})],gH.prototype,"blendMode",void 0),(0,T.e)([eH("Capacity",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1e4})],gH.prototype,"kh",void 0),(0,T.e)([eH("Emit rate",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gH.prototype,"emitRate",void 0),(0,T.e)([eH("Target duration",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gH.prototype,"targetStopDuration",void 0),(0,T.e)([eH("Delay start(ms)",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],gH.prototype,"startDelay",void 0),(0,T.e)([eH("Do no start",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],gH.prototype,"doNoStart",void 0),(0,h.f)("BABYLON.SystemBlock",gH);class XH extends rH{get type(){if(this._type===NH.AutoDetect&&null!=this.value){if(!isNaN(this.value))return this._type=NH.Float,this._type;switch(this.value.getClassName()){case"Vector2":return this._type=NH.Vector2,this._type;case"OH":return this._type=NH.OH,this._type;case"Ch":return this._type=NH.Ch,this._type;case"Matrix":return this._type=NH.Matrix,this._type}}return this._type}get isSystemSource(){return this._contextualSource===tH.None&&this._systemSource!==UH.None}get systemSource(){return this._systemSource}set systemSource(K){if(this._systemSource=K,K!==UH.None){switch(this._contextualSource=tH.None,this._type=NH.Float,K){case UH.Time:case UH.Delta:this._type=NH.Float;break;case UH.Emitter:this._type=NH.OH}this.output&&(this.output.type=this._type)}}get isContextual(){return this._contextualSource!==tH.None}get contextualValue(){return this._contextualSource}set contextualValue(K){if(this._contextualSource=K,K!==tH.None){switch(this._systemSource=UH.None,K){case tH.Scale:this._type=NH.Vector2;break;case tH.Position:case tH.Direction:case tH.ScaledDirection:this._type=NH.OH;break;case tH.Color:this._type=NH.Ch;break;case tH.Age:case tH.Lifetime:case tH.Angle:case tH.AgeGradient:this._type=NH.Float;break;case tH.SpriteCellEnd:case tH.SpriteCellStart:case tH.SpriteCellIndex:this._type=NH.Int}this.output&&(this.output.type=this._type)}}constructor(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NH.AutoDetect;super(K),this._type=NH.Undefined,this.min=0,this.max=0,this.groupInInspector="",this.displayInInspector=!0,this.onValueChangedObservable=new P.d,this._systemSource=UH.None,this._contextualSource=tH.None,this._type=H,this._isInput=!0,this._storedValue=null,this.setDefaultValue(),this.registerOutput("output",H)}get value(){return this._storedValue}set value(K){this.type===NH.Float&&this.min!==this.max&&(K=Math.max(this.min,K),K=Math.min(this.max,K)),this._storedValue=K,this.onValueChangedObservable.notifyObservers(this)}get valueCallback(){return this._valueCallback}set valueCallback(K){this._valueCallback=K}getClassName(){return"ParticleInputBlock"}get output(){return this._outputs[0]}setDefaultValue(){switch(this.type){case NH.Int:case NH.Float:this.value=0;break;case NH.Vector2:this.value=q.Vector2.Zero();break;case NH.OH:this.value=q.OH.Zero();break;case NH.Ch:this.value=new y.Ch(1,1,1,1);break;case NH.Matrix:this.value=q.Matrix.Identity()}}_build(K){super._build(K),this.isSystemSource?(this.output._storedValue=null,this.output._storedFunction=K=>K.getSystemValue(this._systemSource)):this.isContextual?(this.output._storedValue=null,this.output._storedFunction=K=>K.getContextualValue(this._contextualSource)):(this.output._storedFunction=null,this.output._storedValue=this.value)}dispose(){this.onValueChangedObservable.clear(),super.dispose()}serialize(){const K=super.serialize();return K.type=this.type,K.contextualValue=this.contextualValue,K.systemSource=this.systemSource,K.min=this.min,K.max=this.max,K.groupInInspector=this.groupInInspector,K.displayInInspector=this.displayInInspector,null===this._storedValue||this.isContextual||this.isSystemSource||(this._storedValue.hh?(K.valueType="BABYLON."+this._storedValue.getClassName(),K.value=this._storedValue.hh()):(K.valueType="number",K.value=this._storedValue)),K}_deserialize(K){if(super._deserialize(K),this._type=K.type,this.contextualValue=K.contextualValue,this.systemSource=K.systemSource||UH.None,this.min=K.min||0,this.max=K.max||0,this.groupInInspector=K.groupInInspector||"",void 0!==K.displayInInspector&&(this.displayInInspector=K.displayInInspector),K.valueType)if("number"===K.valueType)this._storedValue=K.value;else{const H=(0,h.b)(K.valueType);H&&(this._storedValue=H.iH(K.value))}}}(0,h.f)("BABYLON.ParticleInputBlock",XH);class AH extends rH{get url(){return this._url}set url(K){this._url!==K&&(this._cachedData=null,this._url=K,this._textureDataUrl="",this._sourceTexture=null)}get textureDataUrl(){return this._textureDataUrl}set textureDataUrl(K){this._textureDataUrl!==K&&(this._cachedData=null,this._textureDataUrl=K,this._url="",this._sourceTexture=null)}set sourceTexture(K){this._sourceTexture!==K&&(this._cachedData=null,this._sourceTexture=K,this._url="",this._textureDataUrl="")}constructor(K){super(K),this._url="",this._textureDataUrl="",this._sourceTexture=null,this._cachedData=null,this.serializedCachedData=!1,this.registerOutput("texture",NH.Texture)}getClassName(){return"ParticleTextureSourceBlock"}get texture(){return this._outputs[0]}async extractTextureContentAsync(){if(!this.texture._storedValue)return null;if(this._cachedData)return this._cachedData;const K=this.texture._storedValue;return await new Promise(((H,M)=>{if(!K.isReady())return void K.onLoadObservable.addOnce((async()=>{try{this._cachedData=await this.extractTextureContentAsync(),H(this._cachedData)}catch(K){M(K)}}));const q=K.getSize();TH.l.GetTextureDataAsync(K,q.width,q.height).then((M=>{this._cachedData={width:q.width,height:q.height,data:new Uint8ClampedArray(M)},K.dispose(),H(this._cachedData)})).catch(M)}))}_build(K){this._sourceTexture?this.texture._storedValue=this._sourceTexture:this._textureDataUrl||this._url?this._textureDataUrl?this.texture._storedValue=new Q.b(this._textureDataUrl,K.SH):this.texture._storedValue=new Q.b(this._url,K.SH):this.texture._storedValue=null}serialize(){const K=super.serialize();return K.url=this.url,K.serializedCachedData=this.serializedCachedData,this.serializedCachedData&&(K.textureDataUrl=this.textureDataUrl),K}_deserialize(K){super._deserialize(K),this.url=K.url,this.serializedCachedData=!!K.serializedCachedData,K.textureDataUrl&&(this.textureDataUrl=K.textureDataUrl)}dispose(){this._sourceTexture||this.texture._storedValue&&(this.texture._storedValue.dispose(),this.texture._storedValue=null),super.dispose()}}(0,h.f)("BABYLON.ParticleTextureSourceBlock",AH);class KM extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("position",NH.OH),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdatePositionBlock"}_build(K){const H=this.particle.getConnectedValue(K);if(this.output._storedValue=H,!this.position.isConnected)return;const M={process:M=>{K.particleContext=M,K.systemContext=H,M.position.q(this.position.getConnectedValue(K))},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M}}(0,h.f)("BABYLON.UpdatePositionBlock",KM),function(K){K[K.Add=0]="Add",K[K.Subtract=1]="Subtract",K[K.Multiply=2]="Multiply",K[K.Divide=3]="Divide",K[K.Max=4]="Max",K[K.Min=5]="Min"}(jH||(jH={}));class HM extends rH{constructor(K){super(K),this.operation=jH.Add,this.registerInput("left",NH.AutoDetect),this.registerInput("right",NH.AutoDetect),this.registerOutput("output",NH.BasedOnInput),this.output._typeConnectionSource=this.left;const H=[NH.Matrix,NH.Particle,NH.Texture,NH.System,NH.FloatGradient,NH.Color4Gradient,NH.Vector2Gradient,NH.Vector3Gradient];this.left.excludedConnectionPointTypes.push(...H),this.right.excludedConnectionPointTypes.push(...H),this._linkConnectionTypes(0,1),this._connectionObservers=[this.left.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.left.onDisconnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onConnectionObservable.add((()=>this._updateInputOutputTypes())),this.right.onDisconnectionObservable.add((()=>this._updateInputOutputTypes()))]}getClassName(){return"ParticleMathBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get output(){return this._outputs[0]}_build(K){let H;const M=this.left,w=this.right;if(!M.isConnected||!w.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const u=M.type===NH.Float||M.type===NH.Int,h=w.type===NH.Float||w.type===NH.Int,W=u&&h;switch(this.operation){case jH.Add:H=W?K=>M.getConnectedValue(K)+w.getConnectedValue(K):u?K=>K.adapt(M,w.type).add(w.getConnectedValue(K)):K=>M.getConnectedValue(K).add(K.adapt(w,M.type));break;case jH.Subtract:H=W?K=>M.getConnectedValue(K)-w.getConnectedValue(K):u?K=>K.adapt(M,w.type).LH(w.getConnectedValue(K)):K=>M.getConnectedValue(K).LH(K.adapt(w,M.type));break;case jH.Multiply:H=W?K=>M.getConnectedValue(K)*w.getConnectedValue(K):u?K=>K.adapt(M,w.type).multiply(w.getConnectedValue(K)):K=>M.getConnectedValue(K).multiply(K.adapt(w,M.type));break;case jH.Divide:H=W?K=>M.getConnectedValue(K)/w.getConnectedValue(K):u?K=>K.adapt(M,w.type).divide(w.getConnectedValue(K)):K=>M.getConnectedValue(K).divide(K.adapt(w,M.type));break;case jH.Min:if(W)H=K=>Math.min(M.getConnectedValue(K),w.getConnectedValue(K));else{const[K,h]=u?[w,M]:[M,w];switch(K.type){case NH.Vector2:H=H=>q.Vector2.Minimize(K.getConnectedValue(H),H.adapt(h,K.type));break;case NH.OH:H=H=>q.OH.Minimize(K.getConnectedValue(H),H.adapt(h,K.type));break;case NH.Ch:H=H=>{const M=K.getConnectedValue(H),{r:q,g:w,b:u,a:W}=H.adapt(h,K.type);return new y.Ch(Math.min(M.r,q),Math.min(M.g,w),Math.min(M.b,u),Math.min(M.a,W))}}}break;case jH.Max:if(!W){const[K,h]=u?[w,M]:[M,w];switch(K.type){case NH.Vector2:H=H=>q.Vector2.Maximize(K.getConnectedValue(H),H.adapt(h,K.type));break;case NH.OH:H=H=>q.OH.Maximize(K.getConnectedValue(H),H.adapt(h,K.type));break;case NH.Ch:H=H=>{const M=K.getConnectedValue(H),{r:q,g:w,b:u,a:W}=H.adapt(h,K.type);return new y.Ch(Math.max(M.r,q),Math.min(M.g,w),Math.min(M.b,u),Math.min(M.a,W))}}break}H=K=>Math.max(M.getConnectedValue(K),w.getConnectedValue(K))}this.output._storedFunction=K=>M.type===NH.Int?0|H(K):H(K)}_updateInputOutputTypes(){if(this.output._typeConnectionSource=this.left,this.left.isConnected&&this.right.isConnected?(this.left.type===NH.Int||this.left.type===NH.Float&&this.right.type!==NH.Int)&&(this.output._typeConnectionSource=this.right):this.left.isConnected!==this.right.isConnected&&(this.output._typeConnectionSource=this.left.isConnected?this.left:this.right),this.left.isConnected||this.right.isConnected)for(const[K,H]of[[this.left,this.right],[this.right,this.left]])K.acceptedConnectionPointTypes=[NH.Int,NH.Float],H.isConnected&&(K.acceptedConnectionPointTypes.push(H.type),H.type!==NH.Int&&H.type!==NH.Float||K.acceptedConnectionPointTypes.push(NH.Vector2,NH.OH,NH.Ch))}dispose(){super.dispose();for(const K of this._connectionObservers)K.remove();this._connectionObservers.length=0}serialize(){const K=super.serialize();return K.operation=this.operation,K}_deserialize(K){super._deserialize(K),this.operation=K.operation}}(0,T.e)([eH("Operation",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Add",value:jH.Add},{label:"Subtract",value:jH.Subtract},{label:"Multiply",value:jH.Multiply},{label:"Divide",value:jH.Divide},{label:"Max",value:jH.Max},{label:"Min",value:jH.Min}]})],HM.prototype,"operation",void 0),(0,h.f)("BABYLON.ParticleMathBlock",HM);class MM extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("direction1",NH.OH,!0,new q.OH(0,1,0)),this.registerInput("direction2",NH.OH,!0,new q.OH(0,1,0)),this.registerInput("minEmitBox",NH.OH,!0,new q.OH(-.5,-.5,-.5)),this.registerInput("maxEmitBox",NH.OH,!0,new q.OH(.5,.5,.5)),this.registerOutput("output",NH.Particle)}getClassName(){return"BoxShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get minEmitBox(){return this._inputs[3]}get maxEmitBox(){return this._inputs[4]}get output(){return this._outputs[0]}_build(K){const H=this.particle.getConnectedValue(K);H._directionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.direction1.getConnectedValue(K),u=this.direction2.getConnectedValue(K),y=(0,I.RandomRange)(w.x,u.x),h=(0,I.RandomRange)(w.y,u.y),W=(0,I.RandomRange)(w.z,u.z);K.isEmitterTransformNode?q.OH.TransformNormalFromFloatsToRef(y,h,W,K.emitterWorldMatrix,M.direction):M.direction.Lh(y,h,W)},H._positionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.minEmitBox.getConnectedValue(K),u=this.maxEmitBox.getConnectedValue(K),y=(0,I.RandomRange)(w.x,u.x),h=(0,I.RandomRange)(w.y,u.y),W=(0,I.RandomRange)(w.z,u.z);K.isEmitterTransformNode?q.OH.TransformCoordinatesFromFloatsToRef(y,h,W,K.emitterWorldMatrix,M.position):(M.position.Lh(y,h,W),M.position.addInPlace(K.emitterPosition))},this.output._storedValue=H}}(0,h.f)("BABYLON.BoxShapeBlock",MM);class qM extends rH{constructor(K){super(K),this.registerInput("emitPower",NH.Float,!0,1),this.registerInput("lifeTime",NH.Float,!0,1),this.registerInput("color",NH.Ch,!0,new y.Ch(1,1,1,1)),this.registerInput("scale",NH.Vector2,!0,new q.Vector2(1,1)),this.registerInput("angle",NH.Float,!0,0),this.registerOutput("particle",NH.Particle)}getClassName(){return"CreateParticleBlock"}get emitPower(){return this._inputs[0]}get lifeTime(){return this._inputs[1]}get color(){return this._inputs[2]}get scale(){return this._inputs[3]}get angle(){return this._inputs[4]}get particle(){return this._outputs[0]}_build(K){const H=new hH(this.name,K.kh,K.SH,null,!1,void 0,!0);H.particleEmitterType=new S,H._lifeTimeCreation.process=(H,M)=>{K.particleContext=H,H.lifeTime=this.lifeTime.getConnectedValue(K),M._emitPower=this.emitPower.getConnectedValue(K)},H._colorCreation.process=H=>{K.particleContext=H,H.color.q(this.color.getConnectedValue(K))},H._sizeCreation.process=H=>{K.particleContext=H,H.size=1,H.scale.q(this.scale.getConnectedValue(K))},H._angleCreation.process=H=>{K.particleContext=H,H.angle=this.angle.getConnectedValue(K)},this.particle._storedValue=H}}(0,h.f)("BABYLON.CreateParticleBlock",qM);class wM{get systemBlocks(){return this._systemBlocks}get inputBlocks(){const K=[];for(const H of this.attachedBlocks)H.isInput&&K.push(H);return K}constructor(K){this._systemBlocks=[],this._buildId=0,this.attachedBlocks=[],this.editorData=null,this.onBuildObservable=new P.d,this.name=K}getClassName(){return"NodeParticleSystemSet"}_initializeBlock(K){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];-1===this.attachedBlocks.indexOf(K)&&this.attachedBlocks.push(K);for(const M of K.inputs){const q=M.connectedPoint;if(q){const M=q.ownerBlock;M!==K&&this._initializeBlock(M,H)}}}async buildAsync(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await new Promise((M=>{const q=new lH;for(const K of this._systemBlocks)this._initializeBlock(K);for(const w of this.systemBlocks){const M=new bH;M.buildId=this._buildId++,M.SH=K,M.verbose=H;const u=w.createSystem(M);M.emitErrors(),q.systems.push(u)}this.onBuildObservable.notifyObservers(this),M(q)}))}clear(){this.attachedBlocks.length=0,this._systemBlocks.length=0}setToDefault(){this.clear(),this.editorData=null;const K=new gH("Particle system"),H=new KM("Update position");H.output.connectTo(K.particle);const M=new XH("Position");M.contextualValue=tH.Position;const q=new XH("Scaled direction");q.contextualValue=tH.ScaledDirection;const w=new HM("Add");w.operation=jH.Add,M.output.connectTo(w.left),q.output.connectTo(w.right),w.output.connectTo(H.position);const u=new qM("Create particle"),y=new MM("Box shape");u.particle.connectTo(y.particle),y.output.connectTo(H.particle);const h=new AH("Texture");h.texture.connectTo(K.texture),h.url="https://assets.babylonjs.com/textures/flare.png",this._systemBlocks.push(K)}removeBlock(K){const H=this.attachedBlocks.indexOf(K);if(H>-1&&this.attachedBlocks.splice(H,1),K.isSystem){const H=this._systemBlocks.indexOf(K);H>-1&&this._systemBlocks.splice(H,1)}}parseSerializedObject(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];H||this.clear();const M={};for(const q of K.kf){const K=(0,h.b)(q.customType);if(K){const H=new K;H._deserialize(q),M[q.id]=H,this.attachedBlocks.push(H),H.isSystem&&this._systemBlocks.push(H)}}for(const q of this.attachedBlocks)if(q.isTeleportOut){const K=q,H=K._tempEntryPointUniqueId;if(H){const q=M[H];q&&q.attachToEndpoint(K)}}for(let q=0;q<K.kf.length;q++){const w=K.kf[q],u=M[w.id];u&&(u.inputs.length&&w.inputs.some((K=>K.targetConnectionName))&&!H||this._restoreConnections(u,K,M))}if(K.locations||K.editorData&&K.editorData.locations){const q=K.locations||K.editorData.locations;for(const K of q)M[K.cw]&&(K.cw=M[K.cw].uniqueId);H&&this.editorData&&this.editorData.locations&&q.concat(this.editorData.locations),K.locations?this.editorData={locations:q}:(this.editorData=K.editorData,this.editorData.locations=q);const w=[];for(const K in M)w[K]=M[K].uniqueId;this.editorData.map=w}this.comment=K.comment}_restoreConnections(K,H,M){for(const q of K.outputs)for(const w of H.kf){const u=M[w.id];if(u)for(const y of w.inputs)if(M[y.targetBlockId]!==K||y.targetConnectionName!==q.name);else{const K=u.getInputByName(y.inputName);if(!K||K.isConnected)continue;q.connectTo(K,!0),this._restoreConnections(u,H,M)}}}serialize(K){const H=K?{}:x.c.Serialize(this);H.editorData=JSON.parse(JSON.stringify(this.editorData));let M=[];K?M=K:H.customType="BABYLON.NodeParticleSystemSet",H.kf=[];for(const q of M)H.kf.push(q.serialize());if(!K)for(const q of this.attachedBlocks)-1===M.indexOf(q)&&H.kf.push(q.serialize());return H}dispose(){for(const K of this.attachedBlocks)K.dispose();this.attachedBlocks.length=0,this.onBuildObservable.clear()}static CreateDefault(K){const H=new wM(K);return H.setToDefault(),H}static Parse(K){const H=x.c.Parse((()=>new wM(K.name)),K,null);return H.parseSerializedObject(K),H}static ParseFromSnippetAsync(K,H){return"_BLANK"===K?Promise.resolve(wM.CreateDefault("blank")):new Promise(((M,q)=>{const w=new sH.c;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const y=JSON.parse(JSON.parse(w.responseText).jsonPayload),h=JSON.parse(y.nodeParticle);H||(H=x.c.Parse((()=>new wM(K)),h,null)),H.parseSerializedObject(h),H.snippetId=K;try{M(H)}catch(u){q(u)}}else q("Unable to load the snippet "+K)})),w.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),w.send()}))}}wM.EditorURL=`${iH.Tools._DefaultCdnUrl}/v${eK.b.Version}/nodeParticleEditor/babylon.nodeParticleEditor.js`,wM.SnippetUrl="https://snippet.babylonjs.com",(0,T.e)([(0,d.J)()],wM.prototype,"name",void 0),(0,T.e)([(0,d.J)("comment")],wM.prototype,"comment",void 0),function(K){K[K.None=0]="None",K[K.PerParticle=1]="PerParticle",K[K.PerSystem=2]="PerSystem"}(mH||(mH={}));class uM extends rH{constructor(K){super(K),this._currentLockId=-2,this.lockMode=mH.PerParticle,this.registerInput("min",NH.AutoDetect,!0,0),this.registerInput("max",NH.AutoDetect,!0,1),this.registerOutput("output",NH.BasedOnInput),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NH.Float|NH.Int|NH.Vector2|NH.OH|NH.Ch),this._inputs[1].addExcludedConnectionPointFromAllowedTypes(NH.Float|NH.Int|NH.Vector2|NH.OH|NH.Ch),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._defaultConnectionPointType=NH.Float,this._linkConnectionTypes(0,1)}getClassName(){return"ParticleRandomBlock"}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}_build(){let K=null;switch(this._currentLockId=-2,this.min.type){case NH.AutoDetect:case NH.Int:case NH.Float:K=K=>{const H=this.min.getConnectedValue(K)||0,M=this.max.getConnectedValue(K)||1;return H+Math.random()*(M-H)};break;case NH.Vector2:K=K=>{const H=this.min.getConnectedValue(K)||q.Vector2.Zero(),M=this.max.getConnectedValue(K)||q.Vector2.One();return new q.Vector2(H.x+Math.random()*(M.x-H.x),H.y+Math.random()*(M.y-H.y))};break;case NH.OH:K=K=>{const H=this.min.getConnectedValue(K)||q.OH.Zero(),M=this.max.getConnectedValue(K)||q.OH.One();return new q.OH(H.x+Math.random()*(M.x-H.x),H.y+Math.random()*(M.y-H.y),H.z+Math.random()*(M.z-H.z))};break;case NH.Ch:K=K=>{const H=this.min.getConnectedValue(K)||new y.Ch(0,0,0,0),M=this.max.getConnectedValue(K)||new y.Ch(1,1,1,1);return new y.Ch(H.x+Math.random()*(M.x-H.x),H.y+Math.random()*(M.y-H.y),H.z+Math.random()*(M.z-H.z),H.w+Math.random()*(M.w-H.w))}}this.output._storedFunction=H=>{var M;let q=0;switch(this.lockMode){case mH.PerParticle:q=(null===(M=H.particleContext)||void 0===M?void 0:M.id)||-1;break;case mH.PerSystem:q=H.buildId||0}return this._currentLockId!==q&&(this.lockMode!==mH.None&&(this._currentLockId=q),this.output._storedValue=K(H)),this.output._storedValue}}serialize(){const K=super.serialize();return K.lockMode=this.lockMode,K}_deserialize(K){super._deserialize(K),this.lockMode=K.lockMode}}(0,T.e)([eH("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:mH.None},{label:"Per particle",value:mH.PerParticle},{label:"Per system",value:mH.PerSystem}]})],uM.prototype,"lockMode",void 0),(0,h.f)("BABYLON.ParticleRandomBlock",uM);class yM extends rH{constructor(K){super(K),this._currentLockId=-2,this.lockMode=mH.PerParticle,this.registerInput("min",NH.AutoDetect),this.registerInput("max",NH.AutoDetect),this.registerOutput("output",NH.BasedOnInput),this.output._typeConnectionSource=this.min,this._linkConnectionTypes(0,1);const H=[NH.Matrix,NH.Particle,NH.Texture,NH.System,NH.FloatGradient,NH.Color4Gradient,NH.Vector2Gradient,NH.Vector3Gradient];this.min.excludedConnectionPointTypes.push(...H),this.max.excludedConnectionPointTypes.push(...H)}get min(){return this._inputs[0]}get max(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"RandomRangeBlock"}_build(){let K=null;switch(this._currentLockId=-2,this.min.type){case NH.Float:case NH.Int:K=K=>{const H=this.min.getConnectedValue(K),M=this.max.getConnectedValue(K);return Math.random()*(M-H)+H};break;case NH.Vector2:K=K=>{const H=this.min.getConnectedValue(K),M=this.max.getConnectedValue(K);return new q.Vector2(Math.random()*(M.x-H.x)+H.x,Math.random()*(M.y-H.y)+H.y)};break;case NH.OH:K=K=>{const H=this.min.getConnectedValue(K),M=this.max.getConnectedValue(K);return new q.OH(Math.random()*(M.x-H.x)+H.x,Math.random()*(M.y-H.y)+H.y,Math.random()*(M.z-H.z)+H.z)};break;case NH.Ch:K=K=>{const H=this.min.getConnectedValue(K),M=this.max.getConnectedValue(K);return new y.Ch(Math.random()*(M.r-H.r)+H.r,Math.random()*(M.g-H.g)+H.g,Math.random()*(M.b-H.b)+H.b,Math.random()*(M.a-H.a)+H.a)}}this.output._storedFunction=H=>{var M;let q=0;switch(this.lockMode){case mH.PerParticle:q=(null===(M=H.particleContext)||void 0===M?void 0:M.id)||-1;break;case mH.PerSystem:q=H.buildId||0}return this._currentLockId!==q&&(this.lockMode!==mH.None&&(this._currentLockId=q),this.output._storedValue=K(H)),this.output._storedValue}}serialize(){const K=super.serialize();return K.lockMode=this.lockMode,K}_deserialize(K){super._deserialize(K),void 0!==K.lockMode&&(this.lockMode=K.lockMode)}}(0,T.e)([eH("LockMode",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"None",value:mH.None},{label:"Per particle",value:mH.PerParticle},{label:"Per system",value:mH.PerSystem}]})],yM.prototype,"lockMode",void 0),(0,h.f)("BABYLON.RandomRangeBlock",yM);(0,h.f)("BABYLON.ParticleLerpBlock",class extends rH{constructor(K){super(K),this.registerInput("left",NH.AutoDetect),this.registerInput("right",NH.AutoDetect),this.registerInput("gradient",NH.Float,!0,0,0,1),this.registerOutput("output",NH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._linkConnectionTypes(0,1),this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NH.Float|NH.Int|NH.Vector2|NH.OH|NH.Ch)}getClassName(){return"ParticleLerpBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get gradient(){return this._inputs[2]}get output(){return this._outputs[0]}_build(){if(!this.left.isConnected||!this.right.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);const K=(K,H,M)=>(1-K)*H+K*M;this.output._storedFunction=H=>{const M=this.left.getConnectedValue(H),w=this.right.getConnectedValue(H),u=this.gradient.getConnectedValue(H);switch(this.left.type){case NH.Int:case NH.Float:return K(u,M,w);case NH.Vector2:return new q.Vector2(K(u,M.x,w.x),K(u,M.y,w.y));case NH.OH:return new q.OH(K(u,M.x,w.x),K(u,M.y,w.y),K(u,M.z,w.z));case NH.Ch:return new y.Ch(K(u,M.r,w.r),K(u,M.g,w.g),K(u,M.b,w.b),K(u,M.a,w.a))}return 0}}});(0,h.f)("BABYLON.UpdateDirectionBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("direction",NH.OH),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get direction(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateDirectionBlock"}_build(K){const H=this.particle.getConnectedValue(K);if(this.output._storedValue=H,!this.direction.isConnected)return;const M={process:M=>{K.particleContext=M,K.systemContext=H,M.direction.q(this.direction.getConnectedValue(K))},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M}});(0,h.f)("BABYLON.UpdateColorBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("color",NH.Ch),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get color(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateColorBlock"}_build(K){const H=this.particle.getConnectedValue(K);if(this.output._storedValue=H,!this.color.isConnected)return;const M={process:M=>{K.particleContext=M,K.systemContext=H,M.color.q(this.color.getConnectedValue(K))},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M}});(0,h.f)("BABYLON.UpdateScaleBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("scale",NH.Vector2),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get scale(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateScaleBlock"}_build(K){const H=this.particle.getConnectedValue(K);if(this.output._storedValue=H,!this.scale.isConnected)return;const M={process:M=>{K.particleContext=M,K.systemContext=H,M.scale.q(this.scale.getConnectedValue(K))},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M}});(0,h.f)("BABYLON.UpdateAngleBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("angle",NH.Float),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get angle(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateAngleBlock"}_build(K){const H=this.particle.getConnectedValue(K);if(this.output._storedValue=H,!this.angle.isConnected)return;const M={process:M=>{K.particleContext=M,K.systemContext=H,M.angle=this.angle.getConnectedValue(K)},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M}});(0,h.f)("BABYLON.BasicPositionUpdateBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicPositionUpdateBlock"}_build(K){const H=this.particle.getConnectedValue(K),M={process:M=>{K.particleContext=M,K.systemContext=H,M.direction.scaleToRef(H._directionScale,H._scaledDirection),M.position.addInPlace(H._scaledDirection)},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M,this.output._storedValue=H}});(0,h.f)("BABYLON.BasicSpriteUpdateBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}getClassName(){return"BasicSpriteUpdateBlock"}_build(K){const H=this.particle.getConnectedValue(K),M={process:M=>{K.particleContext=M,K.systemContext=H,M.updateCellIndex()},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M,this.output._storedValue=H}});(0,h.f)("BABYLON.UpdateSpriteCellIndexBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("cellIndex",NH.Int),this.registerOutput("output",NH.Particle),this.cellIndex.acceptedConnectionPointTypes=[NH.Float]}get particle(){return this._inputs[0]}get cellIndex(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateSpriteCellIndexBlock"}_build(K){const H=this.particle.getConnectedValue(K);if(this.output._storedValue=H,!this.cellIndex.isConnected)return;const M={process:M=>{K.particleContext=M,K.systemContext=H,M.cellIndex=Math.floor(this.cellIndex.getConnectedValue(K))},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M}});class hM extends rH{constructor(K){super(K),this.strength=1,this.registerInput("particle",NH.Particle),this.registerInput("flowMap",NH.Texture),this.registerOutput("output",NH.Particle)}get particle(){return this._inputs[0]}get flowMap(){return this._inputs[1]}get output(){return this._outputs[0]}getClassName(){return"UpdateFlowMapBlock"}_build(K){var H;const M=this.particle.getConnectedValue(K),q=K.SH;let w;(null===(H=this.flowMap.connectedPoint)||void 0===H?void 0:H.ownerBlock).extractTextureContentAsync().then((K=>{K&&(w=new JH(K.width,K.height,K.data))}));const u={process:K=>{const H=q.getTransformMatrix();w&&w._processParticle(K,this.strength*M._tempScaledUpdateSpeed,H)},previousItem:null,nextItem:null};M._updateQueueStart?UK(u,M._updateQueueStart):M._updateQueueStart=u,this.output._storedValue=M}serialize(){const K=super.serialize();return K.strength=this.strength,K}_deserialize(K){super._deserialize(K),this.strength=K.strength}}(0,T.e)([eH("strength",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],hM.prototype,"strength",void 0),(0,h.f)("BABYLON.UpdateFlowMapBlock",hM);(0,h.f)("BABYLON.SphereShapeBlock",class extends rH{constructor(K){super(K),this.registerInput("input",NH.Particle),this.registerInput("radius",NH.Float,!0,1),this.registerInput("radiusRange",NH.Float,!0,1,0,1),this.registerInput("directionRandomizer",NH.Float,!0,0,0,1),this.registerOutput("output",NH.Particle)}getClassName(){return"SphereShapeBlock"}get input(){return this._inputs[0]}get radius(){return this._inputs[1]}get radiusRange(){return this._inputs[2]}get directionRandomizer(){return this._inputs[3]}get output(){return this._outputs[0]}_build(K){const H=this.input.getConnectedValue(K);H._directionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.directionRandomizer.getConnectedValue(K),u=M.position.LH(K.emitterPosition).normalize(),y=(0,I.RandomRange)(0,w),h=(0,I.RandomRange)(0,w),W=(0,I.RandomRange)(0,w);u.x+=y,u.y+=h,u.z+=W,u.normalize(),K.isEmitterTransformNode?q.OH.TransformNormalFromFloatsToRef(y,h,W,K.emitterWorldMatrix,M.direction):M.direction.Lh(y,h,W)},H._positionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.radius.getConnectedValue(K),u=this.radiusRange.getConnectedValue(K),y=w-(0,I.RandomRange)(0,w*u),h=(0,I.RandomRange)(0,1),W=(0,I.RandomRange)(0,2*Math.PI),f=Math.acos(2*h-1),z=y*Math.cos(W)*Math.sin(f),G=y*Math.cos(f),a=y*Math.sin(W)*Math.sin(f);K.isEmitterTransformNode?q.OH.TransformCoordinatesFromFloatsToRef(z,G,a,K.emitterWorldMatrix,M.position):(M.position.Lh(z,G,a),M.position.addInPlace(K.emitterPosition))},this.output._storedValue=H}});(0,h.f)("BABYLON.PointShapeBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("direction1",NH.OH,!0,new q.OH(0,1,0)),this.registerInput("direction2",NH.OH,!0,new q.OH(0,1,0)),this.registerOutput("output",NH.Particle)}getClassName(){return"PointShapeBlock"}get particle(){return this._inputs[0]}get direction1(){return this._inputs[1]}get direction2(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){const H=this.particle.getConnectedValue(K);H._directionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.direction1.getConnectedValue(K),u=this.direction2.getConnectedValue(K),y=(0,I.RandomRange)(w.x,u.x),h=(0,I.RandomRange)(w.y,u.y),W=(0,I.RandomRange)(w.z,u.z);K.isEmitterTransformNode?q.OH.TransformNormalFromFloatsToRef(y,h,W,K.emitterWorldMatrix,M.direction):M.direction.Lh(y,h,W)},H._positionCreation.process=M=>{K.systemContext=H,K.isEmitterTransformNode?q.OH.TransformCoordinatesFromFloatsToRef(0,0,0,K.emitterWorldMatrix,M.position):M.position.q(K.emitterPosition)},this.output._storedValue=H}});(0,h.f)("BABYLON.CustomShapeBlock",class extends rH{constructor(K){super(K),this.registerInput("particle",NH.Particle),this.registerInput("position",NH.OH,!0,new q.OH(0,0,0)),this.registerInput("direction",NH.OH,!0,new q.OH(0,1,0)),this.registerOutput("output",NH.Particle)}getClassName(){return"CustomShapeBlock"}get particle(){return this._inputs[0]}get position(){return this._inputs[1]}get direction(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){const H=this.particle.getConnectedValue(K);H._directionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.direction.getConnectedValue(K);K.isEmitterTransformNode?q.OH.TransformNormalToRef(w,K.emitterWorldMatrix,M.direction):M.direction.q(w)},H._positionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.position.getConnectedValue(K);K.isEmitterTransformNode?q.OH.TransformCoordinatesToRef(w,K.emitterWorldMatrix,M.position):(M.position.q(w),M.position.addInPlace(K.emitterPosition))},this.output._storedValue=H}});(0,h.f)("BABYLON.CylinderShapeBlock",class extends rH{constructor(K){super(K),this._tempVector=q.OH.Zero(),this.registerInput("particle",NH.Particle),this.registerInput("radius",NH.Float,!0,1),this.registerInput("height",NH.Float,!0,1,0),this.registerInput("radiusRange",NH.Float,!0,1,0,1),this.registerInput("directionRandomizer",NH.Float,!0,0,0,1),this.registerOutput("output",NH.Particle)}getClassName(){return"CylinderShapeBlock"}get particle(){return this._inputs[0]}get radius(){return this._inputs[1]}get height(){return this._inputs[2]}get radiusRange(){return this._inputs[3]}get directionRandomizer(){return this._inputs[4]}get output(){return this._outputs[0]}_build(K){const H=this.particle.getConnectedValue(K);H._directionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.directionRandomizer.getConnectedValue(K);M.position.subtractToRef(K.emitterPosition,this._tempVector),this._tempVector.normalize(),K.isEmitterTransformNode&&q.OH.TransformNormalToRef(this._tempVector,K.emitterInverseWorldMatrix,this._tempVector);const u=(0,I.RandomRange)(-w/2,w/2);let y=Math.atan2(this._tempVector.x,this._tempVector.z);y+=(0,I.RandomRange)(-Math.PI/2,Math.PI/2)*w,this._tempVector.y=u,this._tempVector.x=Math.sin(y),this._tempVector.z=Math.cos(y),this._tempVector.normalize(),K.isEmitterTransformNode?q.OH.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K.emitterWorldMatrix,M.direction):M.direction.q(this._tempVector)},H._positionCreation.process=M=>{K.particleContext=M,K.systemContext=H;const w=this.height.getConnectedValue(K),u=this.radiusRange.getConnectedValue(K),y=this.radius.getConnectedValue(K),h=(0,I.RandomRange)(-w/2,w/2),W=(0,I.RandomRange)(0,2*Math.PI),f=(0,I.RandomRange)((1-u)*(1-u),1),z=Math.sqrt(f)*y,G=z*Math.cos(W),a=z*Math.sin(W);K.isEmitterTransformNode?q.OH.TransformCoordinatesFromFloatsToRef(G,h,a,K.emitterWorldMatrix,M.position):(M.position.Lh(G,h,a),M.position.addInPlace(K.emitterPosition))},this.output._storedValue=H}});class WM extends rH{constructor(K){super(K),this.start=0,this.end=8,this.width=64,this.height=64,this.loop=!1,this.randomStartCell=!1,this.registerInput("particle",NH.Particle),this.registerOutput("output",NH.Particle),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"SetupSpriteSheetBlock"}get particle(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);const H=this.particle.getConnectedValue(K);H._isAnimationSheetEnabled=!0,H.spriteCellWidth=this.width,H.spriteCellHeight=this.height,H.startSpriteCellID=this.start,H.endSpriteCellID=this.end,H.spriteRandomStartCell=this.randomStartCell,this.output._storedValue=H}serialize(){const K=super.serialize();return K.width=this.width,K.height=this.height,K.start=this.start,K.end=this.end,K.randomStartCell=this.randomStartCell,K}_deserialize(K){super._deserialize(K),this.width=K.width,this.height=K.height,this.start=K.start,this.end=K.end,this.randomStartCell=K.randomStartCell}}(0,T.e)([eH("Start",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WM.prototype,"start",void 0),(0,T.e)([eH("End",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WM.prototype,"end",void 0),(0,T.e)([eH("Width",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WM.prototype,"width",void 0),(0,T.e)([eH("Height",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],WM.prototype,"height",void 0),(0,T.e)([eH("Loop",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WM.prototype,"loop",void 0),(0,T.e)([eH("Random start cell",0,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],WM.prototype,"randomStartCell",void 0),(0,h.f)("BABYLON.SetupSpriteSheetBlock",WM);class IM extends rH{constructor(K){super(K),this.reference=0,this.registerInput("value",NH.AutoDetect),this.registerOutput("output",NH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._outputs[0]._typeConnectionSourceTranslation=K=>{switch(K){case NH.Float:return NH.FloatGradient;case NH.Vector2:return NH.Vector2Gradient;case NH.OH:return NH.Vector3Gradient;case NH.Ch:return NH.Color4Gradient}return K},this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NH.Float|NH.Vector2|NH.OH|NH.Ch)}getClassName(){return"ParticleGradientValueBlock"}get value(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){this.output._storedFunction=K=>null}serialize(){const K=super.serialize();return K.reference=this.reference,K}_deserialize(K){super._deserialize(K),this.reference=K.reference}}(0,T.e)([eH("Reference",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0,max:1})],IM.prototype,"reference",void 0),(0,h.f)("BABYLON.ParticleGradientValueBlock",IM);(0,h.f)("BABYLON.ParticleGradientBlock",class extends rH{constructor(K){super(K),this._entryCount=1,this.registerInput("gradient",NH.Float,!0,1,0,1),this.registerInput("value0",NH.AutoDetect),this.registerOutput("output",NH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[1],this._outputs[0]._typeConnectionSourceTranslation=K=>{switch(K){case NH.FloatGradient:return NH.Float;case NH.Vector2Gradient:return NH.Vector2;case NH.Vector3Gradient:return NH.OH;case NH.Color4Gradient:return NH.Ch}return K},this._inputs[1].addExcludedConnectionPointFromAllowedTypes(NH.FloatGradient|NH.Vector2Gradient|NH.Vector3Gradient|NH.Color4Gradient),this._manageExtendedInputs(1)}_manageExtendedInputs(K){this._inputs[K].onConnectionObservable.add((()=>{this._entryCount>K||(this._entryCount++,this.registerInput("value"+(this._entryCount-1),NH.AutoDetect,!0),this._linkConnectionTypes(1,this._entryCount),this._manageExtendedInputs(this._entryCount))}))}getClassName(){return"ParticleGradientBlock"}get gradient(){return this._inputs[0]}get output(){return this._outputs[0]}_build(){const K=[];for(let M=1;M<this._inputs.length;M++){var H;if(this._inputs[M].isConnected)K.push(null===(H=this._inputs[M].connectedPoint)||void 0===H?void 0:H.ownerBlock)}K.sort(((K,H)=>K.reference-H.reference)),this.output._storedFunction=H=>{const M=this.gradient.getConnectedValue(H);if(1===K.length)return K[0].value.getConnectedValue(H);let w=null;for(let u=K.length-1;u>=0;u--){const h=K[u];if(h.reference<=M){const K=h.value.getConnectedValue(H);if(w){const u=w.value.getConnectedValue(H),W=w.reference,f=h.reference,z=Math.max(0,Math.min(1,(M-f)/(W-f)));switch(this.output.type){case NH.Float:return(0,I.Lerp)(K,u,z);case NH.Vector2:return q.Vector2.Lerp(K,u,z);case NH.OH:return q.OH.Lerp(K,u,z);case NH.Ch:return y.Ch.Lerp(K,u,z)}}return K}w=h}return 0}}});(0,h.f)("BABYLON.ParticleConverterBlock",class extends rH{constructor(K){super(K),this.registerInput("color ",NH.Ch,!0),this.registerInput("xyz ",NH.OH,!0),this.registerInput("xy ",NH.Vector2,!0),this.registerInput("zw ",NH.Vector2,!0),this.registerInput("x ",NH.Float,!0),this.registerInput("y ",NH.Float,!0),this.registerInput("z ",NH.Float,!0),this.registerInput("w ",NH.Float,!0),this.registerOutput("color",NH.Ch),this.registerOutput("xyz",NH.OH),this.registerOutput("xy",NH.Vector2),this.registerOutput("zw",NH.Vector2),this.registerOutput("x",NH.Float),this.registerOutput("y",NH.Float),this.registerOutput("z",NH.Float),this.registerOutput("w",NH.Float)}getClassName(){return"ParticleConverterBlock"}get colorIn(){return this._inputs[0]}get xyzIn(){return this._inputs[1]}get xyIn(){return this._inputs[2]}get zwIn(){return this._inputs[3]}get xIn(){return this._inputs[4]}get yIn(){return this._inputs[5]}get zIn(){return this._inputs[6]}get wIn(){return this._inputs[7]}get colorOut(){return this._outputs[0]}get xyzOut(){return this._outputs[1]}get xyOut(){return this._outputs[2]}get zwOut(){return this._outputs[3]}get xOut(){return this._outputs[4]}get yOut(){return this._outputs[5]}get zOut(){return this._outputs[6]}get wOut(){return this._outputs[7]}_inputRename(K){return"color "===K?"colorIn":"xyz "===K?"xyzIn":"xy "===K?"xyIn":"zw "===K?"zwIn":"x "===K?"xIn":"y "===K?"yIn":"z "===K?"zIn":"w "===K?"wIn":K}_outputRename(K){switch(K){case"x":return"xOut";case"y":return"yOut";case"z":return"zOut";case"w":return"wOut";case"xy":return"xyOut";case"zw":return"zwOut";case"xyz":return"xyzOut";case"color":return"colorOut";default:return K}}_build(K){super._build(K);const H=this.xIn,M=this.yIn,w=this.zIn,u=this.wIn,h=this.xyIn,W=this.zwIn,I=this.xyzIn,f=this.colorIn,z=this.colorOut,G=this.xyzOut,a=this.xyOut,v=this.zwOut,O=this.xOut,L=this.yOut,S=this.zOut,B=this.wOut,C=K=>{if(f.isConnected)return f.getConnectedValue(K);let q=0,z=0,G=0,a=0;if(H.isConnected&&(q=H.getConnectedValue(K)),M.isConnected&&(z=M.getConnectedValue(K)),w.isConnected&&(G=w.getConnectedValue(K)),u.isConnected&&(a=u.getConnectedValue(K)),h.isConnected){const H=h.getConnectedValue(K);H&&(q=H.x,z=H.y)}if(W.isConnected){const H=W.getConnectedValue(K);H&&(G=H.x,a=H.y)}if(I.isConnected){const H=I.getConnectedValue(K);H&&(q=H.x,z=H.y,G=H.z)}return new y.Ch(q,z,G,a)};z._storedFunction=K=>C(K),G._storedFunction=K=>{const H=C(K);return new q.OH(H.r,H.g,H.b)},a._storedFunction=K=>{const H=C(K);return new q.Vector2(H.r,H.g)},v._storedFunction=K=>{const H=C(K);return new q.Vector2(H.b,H.a)},O._storedFunction=K=>C(K).r,L._storedFunction=K=>C(K).g,S._storedFunction=K=>C(K).b,B._storedFunction=K=>C(K).a}}),function(K){K[K.Cos=0]="Cos",K[K.Sin=1]="Sin",K[K.Abs=2]="Abs",K[K.Exp=3]="Exp",K[K.Exp2=4]="Exp2",K[K.Round=5]="Round",K[K.Floor=6]="Floor",K[K.Ceiling=7]="Ceiling",K[K.Sqrt=8]="Sqrt",K[K.Log=9]="Log",K[K.Tan=10]="Tan",K[K.ArcTan=11]="ArcTan",K[K.ArcCos=12]="ArcCos",K[K.ArcSin=13]="ArcSin",K[K.Sign=14]="Sign",K[K.Negate=15]="Negate",K[K.OneMinus=16]="OneMinus",K[K.Reciprocal=17]="Reciprocal",K[K.ToDegrees=18]="ToDegrees",K[K.ToRadians=19]="ToRadians",K[K.Fract=20]="Fract"}(FH||(FH={}));class fM extends rH{constructor(K){super(K),this.operation=FH.Cos,this.registerInput("input",NH.AutoDetect),this.registerOutput("output",NH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].addExcludedConnectionPointFromAllowedTypes(NH.Float|NH.Int|NH.Vector2|NH.OH|NH.Ch)}getClassName(){return"ParticleTrigonometryBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);let H=null;switch(this.operation){case FH.Cos:H=K=>Math.cos(K);break;case FH.Sin:H=K=>Math.sin(K);break;case FH.Abs:H=K=>Math.abs(K);break;case FH.Exp:H=K=>Math.exp(K);break;case FH.Exp2:H=K=>Math.pow(2,K);break;case FH.Round:H=K=>Math.round(K);break;case FH.Floor:H=K=>Math.floor(K);break;case FH.Ceiling:H=K=>Math.ceil(K);break;case FH.Sqrt:H=K=>Math.sqrt(K);break;case FH.Log:H=K=>Math.log(K);break;case FH.Tan:H=K=>Math.tan(K);break;case FH.ArcTan:H=K=>Math.atan(K);break;case FH.ArcCos:H=K=>Math.acos(K);break;case FH.ArcSin:H=K=>Math.asin(K);break;case FH.Sign:H=K=>Math.sign(K);break;case FH.Negate:H=K=>-K;break;case FH.OneMinus:H=K=>1-K;break;case FH.Reciprocal:H=K=>1/K;break;case FH.ToRadians:H=K=>K*Math.PI/180;break;case FH.ToDegrees:H=K=>180*K/Math.PI;break;case FH.Fract:H=K=>K>=0?K-Math.floor(K):K-Math.ceil(K)}if(!H)return this.output._storedFunction=null,void(this.output._storedValue=null);switch(this.input.type){case NH.Int:case NH.Float:this.output._storedFunction=K=>{const M=this.input.getConnectedValue(K);return H(M)};break;case NH.Vector2:this.output._storedFunction=K=>{const M=this.input.getConnectedValue(K);return new q.Vector2(H(M.x),H(M.y))};break;case NH.OH:this.output._storedFunction=K=>{const M=this.input.getConnectedValue(K);return new q.OH(H(M.x),H(M.y),H(M.z))};break;case NH.Ch:this.output._storedFunction=K=>{const M=this.input.getConnectedValue(K);return new y.Ch(H(M.r),H(M.g),H(M.b),H(M.a))}}return this}serialize(){const K=super.serialize();return K.operation=this.operation,K}_deserialize(K){super._deserialize(K),this.operation=K.operation}}(0,T.e)([eH("Operation",4,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},options:[{label:"Cos",value:FH.Cos},{label:"Sin",value:FH.Sin},{label:"Abs",value:FH.Abs},{label:"Exp",value:FH.Exp},{label:"Exp2",value:FH.Exp2},{label:"Round",value:FH.Round},{label:"Floor",value:FH.Floor},{label:"Ceiling",value:FH.Ceiling},{label:"Sqrt",value:FH.Sqrt},{label:"Log",value:FH.Log},{label:"Tan",value:FH.Tan},{label:"ArcTan",value:FH.ArcTan},{label:"ArcCos",value:FH.ArcCos},{label:"ArcSin",value:FH.ArcSin},{label:"Sign",value:FH.Sign},{label:"Negate",value:FH.Negate},{label:"OneMinus",value:FH.OneMinus},{label:"Reciprocal",value:FH.Reciprocal},{label:"ToDegrees",value:FH.ToDegrees},{label:"ToRadians",value:FH.ToRadians},{label:"Fract",value:FH.Fract}]})],fM.prototype,"operation",void 0),(0,h.f)("BABYLON.ParticleTrigonometryBlock",fM);var zM,GM=M(12693);class aM extends rH{constructor(K){super(K),this.log=[],this.stackSize=10,this._isDebug=!0,this.registerInput("input",NH.AutoDetect),this.registerOutput("output",NH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0],this._inputs[0].excludedConnectionPointTypes.push(NH.FloatGradient),this._inputs[0].excludedConnectionPointTypes.push(NH.Vector2Gradient),this._inputs[0].excludedConnectionPointTypes.push(NH.Vector3Gradient),this._inputs[0].excludedConnectionPointTypes.push(NH.Color4Gradient),this._inputs[0].excludedConnectionPointTypes.push(NH.System),this._inputs[0].excludedConnectionPointTypes.push(NH.Particle),this._inputs[0].excludedConnectionPointTypes.push(NH.Texture)}getClassName(){return"ParticleDebugBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){if(!this.input.isConnected)return this.output._storedFunction=null,void(this.output._storedValue=null);this.log=[];const H=K=>{const H=this.input.getConnectedValue(K);if(this.log.length>=this.stackSize)return H;if(null===H||void 0===H)return this.log.push(["null",""]),H;switch(this.input.type){case NH.Vector2:this.log.push([(0,GM.k)(H,4),H.toString()]);break;case NH.OH:this.log.push([(0,GM.l)(H,4),H.toString()]);break;case NH.Ch:this.log.push([`{R: ${H.r.toFixed(4)} G: ${H.g.toFixed(4)} B: ${H.b.toFixed(4)} A: ${H.a.toFixed(4)}}`,H.toString()]);break;default:this.log.push([H.toString(),H.toString()])}return H};this.output.isConnected?this.output._storedFunction=H:this.output._storedValue=H(K)}serialize(){const K=super.serialize();return K.stackSize=this.stackSize,K}_deserialize(K){super._deserialize(K),this.stackSize=K.stackSize}}(0,T.e)([eH("Reference",2,"ADVANCED",{embedded:!1,notifiers:{rebuild:!0},min:1,max:100})],aM.prototype,"stackSize",void 0),(0,h.f)("BABYLON.ParticleDebugBlock",aM);(0,h.f)("BABYLON.ParticleElbowBlock",class extends rH{constructor(K){super(K),this.registerInput("input",NH.AutoDetect),this.registerOutput("output",NH.BasedOnInput),this._outputs[0]._typeConnectionSource=this._inputs[0]}getClassName(){return"ParticleElbowBlock"}get input(){return this._inputs[0]}get output(){return this._outputs[0]}_build(K){super._build(K);const H=this._outputs[0],M=this._inputs[0];H._storedFunction=K=>M.getConnectedValue(K)}});(0,h.f)("BABYLON.ParticleTeleportInBlock",class extends rH{get endpoints(){return this._endpoints}constructor(K){super(K),this._endpoints=[],this._isTeleportIn=!0,this.registerInput("input",NH.AutoDetect)}getClassName(){return"ParticleTeleportInBlock"}get input(){return this._inputs[0]}isAnAncestorOfType(K){if(this.getClassName()===K)return!0;for(const H of this.endpoints)if(H.isAnAncestorOfType(K))return!0;return!1}isAnAncestorOf(K){for(const H of this.endpoints){if(H===K)return!0;if(H.isAnAncestorOf(K))return!0}return!1}attachToEndpoint(K){K.detach(),this._endpoints.push(K),K._entryPoint=this,K._outputs[0]._typeConnectionSource=this._inputs[0],K._tempEntryPointUniqueId=null,K.name="> "+this.name}detachFromEndpoint(K){const H=this._endpoints.indexOf(K);-1!==H&&(this._endpoints.splice(H,1),K._outputs[0]._typeConnectionSource=null,K._entryPoint=null)}_build(){for(const K of this._endpoints)K.output._storedFunction=K=>this.input.getConnectedValue(K)}});(0,h.f)("BABYLON.ParticleTeleportOutBlock",class extends rH{constructor(K){super(K),this._entryPoint=null,this._tempEntryPointUniqueId=null,this._isTeleportOut=!0,this.registerOutput("output",NH.BasedOnInput)}get entryPoint(){return this._entryPoint}getClassName(){return"ParticleTeleportOutBlock"}get output(){return this._outputs[0]}detach(){this._entryPoint&&this._entryPoint.detachFromEndpoint(this)}_build(){}_customBuildStep(K){this.entryPoint&&this.entryPoint.build(K)}clone(){const K=super.clone();return this.entryPoint&&this.entryPoint.attachToEndpoint(K),K}serialize(){var K;const H=super.serialize();return H.entryPoint=(null===(K=this.entryPoint)||void 0===K?void 0:K.uniqueId)??"",H}_deserialize(K){super._deserialize(K),this._tempEntryPointUniqueId=K.entryPoint}}),function(K){K[K.Equal=0]="Equal",K[K.NotEqual=1]="NotEqual",K[K.LessThan=2]="LessThan",K[K.GreaterThan=3]="GreaterThan",K[K.LessOrEqual=4]="LessOrEqual",K[K.GreaterOrEqual=5]="GreaterOrEqual",K[K.Xor=6]="Xor",K[K.Or=7]="Or",K[K.And=8]="And"}(zM||(zM={}));class vM extends rH{constructor(K){super(K),this.test=zM.Equal,this.epsilon=0,this.registerInput("left",NH.Float),this.registerInput("right",NH.Float,!0,0),this.registerInput("ifTrue",NH.AutoDetect,!0,1),this.registerInput("ifFalse",NH.AutoDetect,!0,0),this.registerOutput("output",NH.BasedOnInput),this.output._typeConnectionSource=this._inputs[2],this.output._defaultConnectionPointType=NH.Float,this._inputs[0].acceptedConnectionPointTypes.push(NH.Int),this._inputs[1].acceptedConnectionPointTypes.push(NH.Int),this._linkConnectionTypes(2,3)}getClassName(){return"ParticleConditionBlock"}get left(){return this._inputs[0]}get right(){return this._inputs[1]}get ifTrue(){return this._inputs[2]}get ifFalse(){return this._inputs[3]}get output(){return this._outputs[0]}_build(){const K=K=>{const H=this.left.getConnectedValue(K),M=this.right.getConnectedValue(K);let q=!1;switch(this.test){case zM.Equal:q=(0,I.WithinEpsilon)(H,M,this.epsilon);break;case zM.NotEqual:q=!(0,I.WithinEpsilon)(H,M,this.epsilon);break;case zM.LessThan:q=H<M+this.epsilon;break;case zM.GreaterThan:q=H>M-this.epsilon;break;case zM.LessOrEqual:q=H<=M+this.epsilon;break;case zM.GreaterOrEqual:q=H>=M-this.epsilon;break;case zM.Xor:q=!!H&&!M||!H&&!!M;break;case zM.Or:q=!!H||!!M;break;case zM.And:q=!!H&&!!M}return q};this.output._storedFunction=H=>K(H)?this.ifTrue.getConnectedValue(H):this.ifFalse.getConnectedValue(H)}serialize(){const K=super.serialize();return K.test=this.test,K.epsilon=this.epsilon,K}_deserialize(K){super._deserialize(K),this.test=K.test,void 0!==K.epsilon&&(this.epsilon=K.epsilon)}}(0,T.e)([eH("Test",4,"ADVANCED",{notifiers:{rebuild:!0},embedded:!0,options:[{label:"Equal",value:zM.Equal},{label:"NotEqual",value:zM.NotEqual},{label:"LessThan",value:zM.LessThan},{label:"GreaterThan",value:zM.GreaterThan},{label:"LessOrEqual",value:zM.LessOrEqual},{label:"GreaterOrEqual",value:zM.GreaterOrEqual},{label:"Xor",value:zM.Xor},{label:"Or",value:zM.Or},{label:"And",value:zM.And}]})],vM.prototype,"test",void 0),(0,T.e)([eH("Epsilon",1,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0}})],vM.prototype,"epsilon",void 0),(0,h.f)("BABYLON.ParticleConditionBlock",vM);class OM extends rH{constructor(K){super(K),this._triggerCount=0,this.limit=5,this.delay=250,this._previousOne=null,this.registerInput("input",NH.Particle),this.registerInput("condition",NH.Float,!0,0),this.registerInput("system",NH.System),this.registerOutput("output",NH.Particle)}getClassName(){return"ParticleTriggerBlock"}get input(){return this._inputs[0]}get condition(){return this._inputs[1]}get system(){return this._inputs[2]}get output(){return this._outputs[0]}_build(K){this._triggerCount=0;const H=this.input.getConnectedValue(K),M={process:M=>{if(K.particleContext=M,K.systemContext=H,0!==this.condition.getConnectedValue(K)&&(0===this.limit||this._triggerCount<this.limit)){const q=(new Date).getTime();if(this._previousOne&&q-this._previousOne<this.delay)return;this._triggerCount++,this._previousOne=q;const w=this.system.getConnectedValue(K);if(w){const q=PH(w,K.SH,M.position);q.Hh.addOnce((()=>{this._triggerCount--})),H.Hh.addOnce((()=>{q.dispose()}))}}},previousItem:null,nextItem:null};H._updateQueueStart?UK(M,H._updateQueueStart):H._updateQueueStart=M,this.output._storedValue=H}serialize(){const K=super.serialize();return K.limit=this.limit,K.delay=this.delay,K}_deserialize(K){super._deserialize(K),void 0!==K.limit&&(this.limit=K.limit),void 0!==K.delay&&(this.delay=K.delay)}dispose(){super.dispose(),this._triggerCount=0}}(0,T.e)([eH("Max simultaneous",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OM.prototype,"limit",void 0),(0,T.e)([eH("Delay between calls (ms)",2,"ADVANCED",{embedded:!0,notifiers:{rebuild:!0},min:0})],OM.prototype,"delay",void 0),(0,h.f)("BABYLON.ParticleTriggerBlock",OM);M(12695),M(12707),M(12714),M(12761)},12754:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneFragment",u="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12719:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneFragmentDeclaration",u="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12783:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneVertex",u="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12769:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneVertexDeclaration",u="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12758:(K,H,M)=>{"use strict";var q=M(11193);const w="fogFragment",u="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12746:(K,H,M)=>{"use strict";var q=M(11193);const w="fogFragmentDeclaration",u="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12785:(K,H,M)=>{"use strict";var q=M(11193);const w="fogVertex",u="#ifdef FOG\n#ifdef SCENE_UBO\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#else\nvertexOutputs.vFogDistance=(uniforms.view*worldPos).xyz;\n#endif\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12775:(K,H,M)=>{"use strict";var q=M(11193);const w="fogVertexDeclaration",u="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12729:(K,H,M)=>{"use strict";var q=M(11193);const w="helperFunctions",u="const PI: f32=3.1415926535897932384626433832795;const TWO_PI: f32=6.283185307179586;const HALF_PI: f32=1.5707963267948966;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const RECIPROCAL_PI4: f32=0.07957747154594767;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3f=vec3f(0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);}\nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3f=inMatrix[0];let i1: vec3f=inMatrix[1];let i2: vec3f=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=0.0773993808*color;let remainingSection: vec3f=pow(0.947867299*(color+vec3f(0.055)),vec3f(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.04045)));}\nfn toGammaSpaceExact(color: vec3f)->vec3f\n{let nearZeroSection: vec3f=12.92*color;let remainingSection: vec3f=1.055*pow(color,vec3f(0.41666))-vec3f(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3f(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3f(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3f(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3f)->vec3f\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3f(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3f)->vec3f\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3f)->f32\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3f)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3f =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(saturateVec3(rgb),D);}\nfn fromRGBD(rgbd: vec4<f32>)->vec3f {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3f,origVec: vec3f,cubeSize: vec3f,cubePos: vec3f)->vec3f {let invOrigVec: vec3f=vec3f(1.)/origVec;let halfSize: vec3f=cubeSize*0.5;let intersecAtMaxPlane: vec3f=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3f=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3f=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3f=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nfn equirectangularToCubemapDirection(uv : vec2f)->vec3f {var longitude : f32=uv.x*TWO_PI-PI;var latitude : f32=HALF_PI-uv.y*PI;var direction : vec3f;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfn sqrtClamped(value: f32)->f32 {return sqrt(max(value,0.));}\nfn avg(value: vec3f)->f32 {return dot(value,vec3f(0.333333333));}\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12723:(K,H,M)=>{"use strict";var q=M(11193);const w="imageProcessingDeclaration",u="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12738:(K,H,M)=>{"use strict";var q=M(11193);const w="imageProcessingFunctions",u="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12726:(K,H,M)=>{"use strict";var q=M(11193);const w="logDepthDeclaration",u="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12756:(K,H,M)=>{"use strict";var q=M(11193);const w="logDepthFragment",u="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12793:(K,H,M)=>{"use strict";var q=M(11193);const w="logDepthVertex",u="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";q.d.IncludesShadersStoreWGSL[w]||(q.d.IncludesShadersStoreWGSL[w]=u)},12714:(K,H,M)=>{"use strict";M.r(H),M.d(H,{particlesPixelShaderWGSL:()=>y});var q=M(11193);M(12719),M(12723),M(12726),M(12729),M(12738),M(12746),M(12754),M(12756),M(12758);const w="particlesPixelShader",u="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";q.d.ShadersStoreWGSL[w]||(q.d.ShadersStoreWGSL[w]=u);const y={name:w,shader:u}},12761:(K,H,M)=>{"use strict";M.r(H),M.d(H,{particlesVertexShaderWGSL:()=>y});var q=M(11193);M(12769),M(12775),M(12726),M(12783),M(12785),M(12793);const w="particlesVertexShader",u="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";q.d.ShadersStoreWGSL[w]||(q.d.ShadersStoreWGSL[w]=u);const y={name:w,shader:u}},12636:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneFragment",u="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12700:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneFragmentDeclaration",u="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12658:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneVertex",u="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12710:(K,H,M)=>{"use strict";var q=M(11193);const w="clipPlaneVertexDeclaration",u="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12651:(K,H,M)=>{"use strict";var q=M(11193);const w="fogFragment",u="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12633:(K,H,M)=>{"use strict";var q=M(11193);const w="fogFragmentDeclaration",u="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12664:(K,H,M)=>{"use strict";var q=M(11193);const w="fogVertex",u="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12653:(K,H,M)=>{"use strict";var q=M(11193);const w="fogVertexDeclaration",u="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12617:(K,H,M)=>{"use strict";var q=M(11193);const w="helperFunctions",u="const float PI=3.1415926535897932384626433832795;const float TWO_PI=6.283185307179586;const float HALF_PI=1.5707963267948966;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float RECIPROCAL_PI4=0.07957747154594767;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return saturate(dot(color,LuminanceEncodeApprox));}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =saturate(floor(D)/255.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(saturate(rgb),D);}\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\nvec3 equirectangularToCubemapDirection(vec2 uv) {float longitude=uv.x*TWO_PI-PI;float latitude=HALF_PI-uv.y*PI;vec3 direction;direction.x=cos(latitude)*sin(longitude);direction.y=sin(latitude);direction.z=cos(latitude)*cos(longitude);return direction;}\nfloat sqrtClamped(float value) {return sqrt(max(value,0.));}\nfloat avg(vec3 value) {return dot(value,vec3(0.333333333));}";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12603:(K,H,M)=>{"use strict";var q=M(11193);const w="imageProcessingDeclaration",u="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12626:(K,H,M)=>{"use strict";var q=M(11193);const w="imageProcessingFunctions",u="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12608:(K,H,M)=>{"use strict";var q=M(11193);const w="logDepthDeclaration",u="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12643:(K,H,M)=>{"use strict";var q=M(11193);const w="logDepthFragment",u="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12668:(K,H,M)=>{"use strict";var q=M(11193);const w="logDepthVertex",u="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";q.d.IncludesShadersStore[w]||(q.d.IncludesShadersStore[w]=u)},12695:(K,H,M)=>{"use strict";M.r(H),M.d(H,{particlesPixelShader:()=>y});var q=M(11193);M(12700),M(12603),M(12608),M(12617),M(12626),M(12633),M(12636),M(12643),M(12651);const w="particlesPixelShader",u="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";q.d.ShadersStore[w]||(q.d.ShadersStore[w]=u);const y={name:w,shader:u}},12707:(K,H,M)=>{"use strict";M.r(H),M.d(H,{particlesVertexShader:()=>y});var q=M(11193);M(12710),M(12653),M(12608),M(12658),M(12664),M(12668);const w="particlesVertexShader",u="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";q.d.ShadersStore[w]||(q.d.ShadersStore[w]=u);const y={name:w,shader:u}},13058:(K,H,M)=>{"use strict";M.r(H),M.d(H,{FlowGraphGLTFDataProvider:()=>u});var q=M(13021),w=M(13004);class u extends q.b{constructor(K){var H,M;super();const q=K.glTF,u=(null===(H=q.animations)||void 0===H?void 0:H.map((K=>K._babylonAnimationGroup)))||[];this.animationGroups=this.registerDataOutput("animationGroups",w.d,u);const y=(null===(M=q.nodes)||void 0===M?void 0:M.map((K=>K._babylonTransformNode)))||[];this.nodes=this.registerDataOutput("nodes",w.d,y)}getClassName(){return"FlowGraphGLTFDataProvider"}}},12935:(K,H,M)=>{"use strict";M.d(H,{c:()=>L,g:()=>v,i:()=>a,m:()=>O});var q=M(11290),w=M(11765),u=M(11329),y=M(12937);const h=[{regex:new RegExp("^/nodes/\\d+/extensions/")}];class W{constructor(K,H){this._gltf=K,this._infoTree=H}convert(K){let H,M=this._gltf,q=this._infoTree;if(!K.startsWith("/"))throw new Error("Path must start with a /");const w=K.split("/");if(w.shift(),w[w.length-1].includes(".length")){const K=w[w.length-1].split(".");w.pop(),w.push(...K)}let u=!1;for(const W of w){const w="length"===W;if(w&&!q.__array__)throw new Error(`Path ${K} is invalid`);if(q.__ignoreObjectTree__&&(u=!0),q.__array__&&!w)q=q.__array__;else if(q=q[W],!q)throw new Error(`Path ${K} is invalid`);if(!u)if(void 0===M){if(!h.find((H=>H.regex.test(K))))throw new Error(`Path ${K} is invalid`)}else if(!w){var y;M=null===(y=M)||void 0===y?void 0:y[W]}(q.__target__||w)&&(H=M)}return{object:H,info:q}}}function I(K,H,M,q){const w=f(K,H);return q?w[M][q]:w[M]}function f(K,H,M){var q,u;return null===(q=K._data)||void 0===q||null===(u=q[(null===M||void 0===M?void 0:M.fillMode)??w.d.MATERIAL_TriangleFillMode])||void 0===u?void 0:u.babylonMaterial}function z(K,H){return{offset:{componentsCount:2,type:"Vector2",get:(M,w,u)=>{const y=I(M,u,K,H);return new q.Vector2(null===y||void 0===y?void 0:y.uOffset,null===y||void 0===y?void 0:y.vOffset)},getTarget:f,set:(M,q,w,u)=>{const y=I(q,u,K,H);y.uOffset=M.x,y.vOffset=M.y},getPropertyName:[()=>`${K}${H?"."+H:""}.uOffset`,()=>`${K}${H?"."+H:""}.vOffset`]},rotation:{type:"number",get:(M,q,w)=>{var u;return null===(u=I(M,w,K,H))||void 0===u?void 0:u.wAng},getTarget:f,set:(M,q,w,u)=>I(q,u,K,H).wAng=M,getPropertyName:[()=>`${K}${H?"."+H:""}.wAng`]},scale:{componentsCount:2,type:"Vector2",get:(M,w,u)=>{const y=I(M,u,K,H);return new q.Vector2(null===y||void 0===y?void 0:y.uScale,null===y||void 0===y?void 0:y.vScale)},getTarget:f,set:(M,q,w,u)=>{const y=I(q,u,K,H);y.uScale=M.x,y.vScale=M.y},getPropertyName:[()=>`${K}${H?"."+H:""}.uScale`,()=>`${K}${H?"."+H:""}.vScale`]}}}const G={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:K=>{var H,M;return new q.Vector2((null===(H=K._babylonCamera)||void 0===H?void 0:H.orthoLeft)??0,(null===(M=K._babylonCamera)||void 0===M?void 0:M.orthoRight)??0)},set:(K,H)=>{H._babylonCamera&&(H._babylonCamera.orthoLeft=K.x,H._babylonCamera.orthoRight=K.y)},getTarget:K=>K,getPropertyName:[()=>"orthoLeft",()=>"orthoRight"]},ymag:{componentsCount:2,type:"Vector2",get:K=>{var H,M;return new q.Vector2((null===(H=K._babylonCamera)||void 0===H?void 0:H.orthoBottom)??0,(null===(M=K._babylonCamera)||void 0===M?void 0:M.orthoTop)??0)},set:(K,H)=>{H._babylonCamera&&(H._babylonCamera.orthoBottom=K.x,H._babylonCamera.orthoTop=K.y)},getTarget:K=>K,getPropertyName:[()=>"orthoBottom",()=>"orthoTop"]},zfar:{type:"number",get:K=>{var H;return null===(H=K._babylonCamera)||void 0===H?void 0:H.maxZ},set:(K,H)=>{H._babylonCamera&&(H._babylonCamera.maxZ=K)},getTarget:K=>K,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:K=>{var H;return null===(H=K._babylonCamera)||void 0===H?void 0:H.Ih},set:(K,H)=>{H._babylonCamera&&(H._babylonCamera.Ih=K)},getTarget:K=>K,getPropertyName:[()=>"Ih"]}},perspective:{aspectRatio:{type:"number",get:K=>{var H;return null===(H=K._babylonCamera)||void 0===H?void 0:H.getEngine().getAspectRatio(K._babylonCamera)},getTarget:K=>K,getPropertyName:[()=>"aspectRatio"],isReadOnly:!0},yfov:{type:"number",get:K=>{var H;return null===(H=K._babylonCamera)||void 0===H?void 0:H.fov},set:(K,H)=>{H._babylonCamera&&(H._babylonCamera.fov=K)},getTarget:K=>K,getPropertyName:[()=>"fov"]},zfar:{type:"number",get:K=>{var H;return null===(H=K._babylonCamera)||void 0===H?void 0:H.maxZ},set:(K,H)=>{H._babylonCamera&&(H._babylonCamera.maxZ=K)},getTarget:K=>K,getPropertyName:[()=>"maxZ"]},znear:{type:"number",get:K=>{var H;return null===(H=K._babylonCamera)||void 0===H?void 0:H.Ih},set:(K,H)=>{H._babylonCamera&&(H._babylonCamera.Ih=K)},getTarget:K=>K,getPropertyName:[()=>"Ih"]}}}},nodes:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonTransformNode)),getPropertyName:[()=>"length"]},__array__:{__target__:!0,translation:{type:"OH",get:K=>{var H;return null===(H=K._babylonTransformNode)||void 0===H?void 0:H.position},set:(K,H)=>{var M;return null===(M=H._babylonTransformNode)||void 0===M?void 0:M.position.q(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"position"]},rotation:{type:"Quaternion",get:K=>{var H;return null===(H=K._babylonTransformNode)||void 0===H?void 0:H.rotationQuaternion},set:(K,H)=>{var M,q;return null===(M=H._babylonTransformNode)||void 0===M||null===(q=M.rotationQuaternion)||void 0===q?void 0:q.q(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"rotationQuaternion"]},scale:{type:"OH",get:K=>{var H;return null===(H=K._babylonTransformNode)||void 0===H?void 0:H.Sh},set:(K,H)=>{var M;return null===(M=H._babylonTransformNode)||void 0===M?void 0:M.Sh.q(K)},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"Sh"]},weights:{length:{type:"number",get:K=>K._numMorphTargets,getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},__array__:{__target__:!0,type:"number",get:(K,H)=>{var M,q;return void 0!==H?null===(M=K._primitiveBabylonMeshes)||void 0===M||null===(q=M[0].morphTargetManager)||void 0===q?void 0:q.getTarget(H).influence:void 0},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},type:"number[]",get:(K,H)=>[0],getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"influence"]},matrix:{type:"Matrix",get:K=>{var H,M,w;return q.Matrix.Compose(null===(H=K._babylonTransformNode)||void 0===H?void 0:H.Sh,null===(M=K._babylonTransformNode)||void 0===M?void 0:M.rotationQuaternion,null===(w=K._babylonTransformNode)||void 0===w?void 0:w.position)},getTarget:K=>K._babylonTransformNode,isReadOnly:!0},globalMatrix:{type:"Matrix",get:K=>{var H,M,w,u;const y=q.Matrix.Identity();let h=K.parent;for(;h&&h.parent;)h=h.parent;const W=(null===(H=K._babylonTransformNode)||void 0===H?void 0:H.position._isDirty)||(null===(M=K._babylonTransformNode)||void 0===M||null===(w=M.rotationQuaternion)||void 0===w?void 0:w._isDirty)||(null===(u=K._babylonTransformNode)||void 0===u?void 0:u.Sh._isDirty);if(h){var I;const H=null===(I=h._babylonTransformNode)||void 0===I?void 0:I.zh(!0).invert();var f,z;if(H)null===(f=K._babylonTransformNode)||void 0===f||null===(z=f.zh(W))||void 0===z||z.multiplyToRef(H,y)}else K._babylonTransformNode&&y.q(K._babylonTransformNode.zh(W));return y},getTarget:K=>K._babylonTransformNode,isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:K=>{var H,M;return null===(H=K._babylonTransformNode)||void 0===H||null===(M=H.getChildren((K=>K instanceof y.d),!0)[0])||void 0===M?void 0:M.Eh},getTarget:K=>{var H;return null===(H=K._babylonTransformNode)||void 0===H?void 0:H.getChildren((K=>K instanceof y.d),!0)[0]},set:(K,H)=>{if(H._babylonTransformNode){const M=H._babylonTransformNode.getChildren((K=>K instanceof y.d),!0)[0];M&&(M.Eh=K)}}},color:{type:"CH",get:K=>{var H,M;return null===(H=K._babylonTransformNode)||void 0===H||null===(M=H.getChildren((K=>K instanceof y.d),!0)[0])||void 0===M?void 0:M.sh},getTarget:K=>{var H;return null===(H=K._babylonTransformNode)||void 0===H?void 0:H.getChildren((K=>K instanceof y.d),!0)[0]},set:(K,H)=>{if(H._babylonTransformNode){const M=H._babylonTransformNode.getChildren((K=>K instanceof y.d),!0)[0];M&&(M.sh=K)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"CH",get:(K,H,M)=>f(K,H,M).emissiveColor,set:(K,H,M,q)=>f(H,M,q).emissiveColor.q(K),getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"emissiveColor"]},emissiveTexture:{extensions:{KHR_texture_transform:z("emissiveTexture")}},normalTexture:{scale:{type:"number",get:(K,H,M)=>{var q;return null===(q=I(K,M,"bumpTexture"))||void 0===q?void 0:q.level},set:(K,H,M,q)=>{const w=I(H,q,"bumpTexture");w&&(w.level=K)},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"level"]},extensions:{KHR_texture_transform:z("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:(K,H,M)=>f(K,H,M).ambientTextureStrength,set:(K,H,M,q)=>{const w=f(H,M,q);w&&(w.ambientTextureStrength=K)},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"ambientTextureStrength"]},extensions:{KHR_texture_transform:z("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Ch",get:(K,H,M)=>{const q=f(K,H,M);return u.Ch.FromColor3(q.albedoColor,q.alpha)},set:(K,H,M,q)=>{const w=f(H,M,q);w.albedoColor.set(K.r,K.g,K.b),w.alpha=K.a},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"albedoColor",()=>"alpha"]},baseColorTexture:{extensions:{KHR_texture_transform:z("albedoTexture")}},metallicFactor:{type:"number",get:(K,H,M)=>f(K,H,M).metallic,set:(K,H,M,q)=>{const w=f(H,M,q);w&&(w.metallic=K)},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"metallic"]},roughnessFactor:{type:"number",get:(K,H,M)=>f(K,H,M).roughness,set:(K,H,M,q)=>{const w=f(H,M,q);w&&(w.roughness=K)},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"roughness"]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:z("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:(K,H,M)=>f(K,H,M).anisotropy.Eh,set:(K,H,M,q)=>{f(H,M,q).anisotropy.Eh=K},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"anisotropy.intensity"]},anisotropyRotation:{type:"number",get:(K,H,M)=>f(K,H,M).anisotropy.angle,set:(K,H,M,q)=>{f(H,M,q).anisotropy.angle=K},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"anisotropy.angle"]},anisotropyTexture:{extensions:{KHR_texture_transform:z("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:(K,H,M)=>f(K,H,M).clearCoat.Eh,set:(K,H,M,q)=>{f(H,M,q).clearCoat.Eh=K},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"clearCoat.intensity"]},clearcoatRoughnessFactor:{type:"number",get:(K,H,M)=>f(K,H,M).clearCoat.roughness,set:(K,H,M,q)=>{f(H,M,q).clearCoat.roughness=K},getTarget:(K,H,M)=>f(K,H,M),getPropertyName:[()=>"clearCoat.roughness"]},clearcoatTexture:{extensions:{KHR_texture_transform:z("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:(K,H,M)=>{var q;return null===(q=f(K,H,M).clearCoat.bumpTexture)||void 0===q?void 0:q.level},getTarget:f,set:(K,H,M,q)=>f(H,M,q).clearCoat.bumpTexture.level=K},extensions:{KHR_texture_transform:z("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:z("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:(K,H,M)=>f(K,H,M).subSurface.dispersion,getTarget:f,set:(K,H,M,q)=>f(H,M,q).subSurface.dispersion=K}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:(K,H,M)=>f(K,H,M).emissiveIntensity,getTarget:f,set:(K,H,M,q)=>f(H,M,q).emissiveIntensity=K}},KHR_materials_ior:{ior:{type:"number",get:(K,H,M)=>f(K,H,M).indexOfRefraction,getTarget:f,set:(K,H,M,q)=>f(H,M,q).indexOfRefraction=K}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:(K,H,M)=>f(K,H,M).iridescence.Eh,getTarget:f,set:(K,H,M,q)=>f(H,M,q).iridescence.Eh=K},iridescenceIor:{type:"number",get:(K,H,M)=>f(K,H,M).iridescence.indexOfRefraction,getTarget:f,set:(K,H,M,q)=>f(H,M,q).iridescence.indexOfRefraction=K},iridescenceTexture:{extensions:{KHR_texture_transform:z("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:(K,H,M)=>f(K,H,M).iridescence.maximumThickness,getTarget:f,set:(K,H,M,q)=>f(H,M,q).iridescence.maximumThickness=K},iridescenceThicknessMinimum:{type:"number",get:(K,H,M)=>f(K,H,M).iridescence.minimumThickness,getTarget:f,set:(K,H,M,q)=>f(H,M,q).iridescence.minimumThickness=K},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:z("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"CH",get:(K,H,M)=>f(K,H,M).sheen.color,getTarget:f,set:(K,H,M,q)=>f(H,M,q).sheen.color.q(K)},sheenColorTexture:{extensions:{KHR_texture_transform:z("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:(K,H,M)=>f(K,H,M).sheen.Eh,getTarget:f,set:(K,H,M,q)=>f(H,M,q).sheen.Eh=K},sheenRoughnessTexture:{extensions:{KHR_texture_transform:z("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:(K,H,M)=>f(K,H,M).metallicF0Factor,getTarget:f,set:(K,H,M,q)=>f(H,M,q).metallicF0Factor=K,getPropertyName:[()=>"metallicF0Factor"]},specularColorFactor:{type:"CH",get:(K,H,M)=>f(K,H,M).metallicReflectanceColor,getTarget:f,set:(K,H,M,q)=>f(H,M,q).metallicReflectanceColor.q(K),getPropertyName:[()=>"metallicReflectanceColor"]},specularTexture:{extensions:{KHR_texture_transform:z("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:z("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:(K,H,M)=>f(K,H,M).subSurface.refractionIntensity,getTarget:f,set:(K,H,M,q)=>f(H,M,q).subSurface.refractionIntensity=K,getPropertyName:[()=>"subSurface.refractionIntensity"]},transmissionTexture:{extensions:{KHR_texture_transform:z("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:(K,H,M)=>f(K,H,M).subSurface.translucencyIntensity,getTarget:f,set:(K,H,M,q)=>f(H,M,q).subSurface.translucencyIntensity=K},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:z("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"CH",get:(K,H,M)=>f(K,H,M).subSurface.translucencyColor,getTarget:f,set:(K,H,M,q)=>{var w;return K&&(null===(w=f(H,M,q).subSurface.translucencyColor)||void 0===w?void 0:w.q(K))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:z("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"CH",get:(K,H,M)=>f(K,H,M).subSurface.tintColor,getTarget:f,set:(K,H,M,q)=>f(H,M,q).subSurface.tintColor.q(K)},attenuationDistance:{type:"number",get:(K,H,M)=>f(K,H,M).subSurface.tintColorAtDistance,getTarget:f,set:(K,H,M,q)=>f(H,M,q).subSurface.tintColorAtDistance=K},thicknessFactor:{type:"number",get:(K,H,M)=>f(K,H,M).subSurface.maximumThickness,getTarget:f,set:(K,H,M,q)=>f(H,M,q).subSurface.maximumThickness=K},thicknessTexture:{extensions:{KHR_texture_transform:z("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonLight)),getPropertyName:[K=>"length"]},__array__:{__target__:!0,color:{type:"CH",get:K=>{var H;return null===(H=K._babylonLight)||void 0===H?void 0:H.sh},set:(K,H)=>{var M;return null===(M=H._babylonLight)||void 0===M?void 0:M.sh.q(K)},getTarget:K=>K._babylonLight,getPropertyName:[K=>"diffuse"]},Eh:{type:"number",get:K=>{var H;return null===(H=K._babylonLight)||void 0===H?void 0:H.Eh},set:(K,H)=>H._babylonLight?H._babylonLight.Eh=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"intensity"]},range:{type:"number",get:K=>{var H;return null===(H=K._babylonLight)||void 0===H?void 0:H.range},set:(K,H)=>H._babylonLight?H._babylonLight.range=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"range"]},spot:{innerConeAngle:{type:"number",get:K=>{var H;return null===(H=K._babylonLight)||void 0===H?void 0:H.innerAngle},set:(K,H)=>H._babylonLight?H._babylonLight.innerAngle=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"innerConeAngle"]},outerConeAngle:{type:"number",get:K=>{var H;return null===(H=K._babylonLight)||void 0===H?void 0:H.angle},set:(K,H)=>H._babylonLight?H._babylonLight.angle=K:void 0,getTarget:K=>K._babylonLight,getPropertyName:[K=>"outerConeAngle"]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonLight)),getPropertyName:[K=>"length"]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonTexture)),getPropertyName:[K=>"length"]},__array__:{__target__:!0,Eh:{type:"number",get:K=>{var H;return null===(H=K._babylonTexture)||void 0===H?void 0:H.level},set:(K,H)=>{H._babylonTexture&&(H._babylonTexture.level=K)},getTarget:K=>K._babylonTexture},rotation:{type:"Quaternion",get:K=>{var H;return K._babylonTexture&&q.Quaternion.FromRotationMatrix(null===(H=K._babylonTexture)||void 0===H?void 0:H.getReflectionTextureMatrix())},set:(K,H)=>{var M;H._babylonTexture&&(null!==(M=H._babylonTexture.sK())&&void 0!==M&&M.useRightHandedSystem||(K=q.Quaternion.Inverse(K)),q.Matrix.FromQuaternionToRef(K,H._babylonTexture.getReflectionTextureMatrix()))},getTarget:K=>K._babylonTexture}}}}},animations:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>K._babylonAnimationGroup)),getPropertyName:[()=>"length"]},__array__:{}},meshes:{length:{type:"number",get:K=>K.length,getTarget:K=>K.map((K=>{var H;return null===(H=K.primitives[0]._instanceData)||void 0===H?void 0:H.babylonSourceMesh})),getPropertyName:[()=>"length"]},__array__:{}}};function a(K){return new W(K,G)}function v(K){const H=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let M=G;for(const q of H)q&&(M=M[q]);if(M&&M.type&&M.get)return M}function O(K,H){const M=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let q=G;for(const w of M)w&&(q=q[w]);q&&q.type&&q.get&&(q.interpolation=H)}function L(K,H){const M=K.split("/").map((K=>K.replace(/{}/g,"__array__")));let q=G;for(const w of M)if(w){if(!q[w]){if("?"===w){q.__ignoreObjectTree__=!0;continue}q[w]={},"__array__"===w&&(q[w].__target__=!0)}q=q[w]}Object.assign(q,H)}},12942:(K,H,M)=>{"use strict";M.r(H),M.d(H,{AnimationPropertyInfo:()=>I,TransformNodeAnimationPropertyInfo:()=>f,WeightAnimationPropertyInfo:()=>z,getQuaternion:()=>h,getVector3:()=>y,getWeights:()=>W});var q=M(11811),w=M(11290),u=M(12935);function y(K,H,M,q){return w.OH.iH(H,M).scaleInPlace(q)}function h(K,H,M,q){return w.Quaternion.iH(H,M).scaleInPlace(q)}function W(K,H,M,q){const w=new Array(K._numMorphTargets);for(let u=0;u<w.length;u++)w[u]=H[M++]*q;return w}class I{constructor(K,H,M,q){this.type=K,this.name=H,this.getValue=M,this.getStride=q}_buildAnimation(K,H,M){const w=new q.d(K,this.name,H,this.type);return w.setKeys(M),w}}class f extends I{buildAnimations(K,H,M,q){const w=[];return w.push({babylonAnimatable:K._babylonTransformNode,babylonAnimation:this._buildAnimation(H,M,q)}),w}}class z extends I{buildAnimations(K,H,M,w){const u=[];if(K._numMorphTargets)for(let y=0;y<K._numMorphTargets;y++){const h=new q.d(`${H}_${y}`,this.name,M,this.type);if(h.setKeys(w.map((K=>({frame:K.frame,inTangent:K.inTangent?K.inTangent[y]:void 0,value:K.value[y],outTangent:K.outTangent?K.outTangent[y]:void 0,interpolation:K.interpolation})))),K._primitiveBabylonMeshes)for(const H of K._primitiveBabylonMeshes)if(H.morphTargetManager){const K=H.morphTargetManager.getTarget(y),M=h.clone();K.animations.push(M),u.push({babylonAnimatable:K,babylonAnimation:M})}}return u}}(0,u.m)("/nodes/{}/translation",[new f(q.d.ANIMATIONTYPE_VECTOR3,"position",y,(()=>3))]),(0,u.m)("/nodes/{}/rotation",[new f(q.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",h,(()=>4))]),(0,u.m)("/nodes/{}/scale",[new f(q.d.ANIMATIONTYPE_VECTOR3,"Sh",y,(()=>3))]),(0,u.m)("/nodes/{}/weights",[new z(q.d.ANIMATIONTYPE_FLOAT,"influence",W,(K=>K._numMorphTargets))])},12910:(K,H,M)=>{"use strict";class q{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((K,H)=>{this._resolve=K,this._reject=H}))}}var w=M(11290),u=M(11329),y=M(11100),h=M(11733),W=M(12915),I=M(12920),f=M(11102),z=M(11758),G=M(11811),a=M(11818),v=M(11143),O=M(11112),L=M(11118);class S{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(K){this._useTextureToStoreBoneMatrices=K,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(K,H,M){this.name=K,this.id=H,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=w.Matrix.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new f.d,this.bones=[],this._scene=M||v.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const q=this._scene.getEngine().getCaps();this._canUseTextureForBones=q.textureFloat&&q.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((K=>!K.getParent()))}getTransformMatrices(K){if(this.needInitialSkinMatrix){if(!K)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return K._bonesTransformMatrices||this.prepare(!0),K._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(K){return this.needInitialSkinMatrix&&K._transformMatrixTexture?K._transformMatrixTexture:this._transformMatrixTexture}sK(){return this._scene}toString(K){let H=`Name: ${this.name}, nBones: ${this.bones.length}`;if(H+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,K){H+=", Ranges: {";let K=!0;for(const M in this._ranges)K&&(H+=", ",K=!1),H+=M;H+="}"}return H}getBoneIndexByName(K){for(let H=0,M=this.bones.length;H<M;H++)if(this.bones[H].name===K)return H;return-1}createAnimationRange(K,H,M){if(!this._ranges[K]){this._ranges[K]=new a.b(K,H,M);for(let q=0,w=this.bones.length;q<w;q++)this.bones[q].animations[0]&&this.bones[q].animations[0].createRange(K,H,M)}}deleteAnimationRange(K){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let M=0,q=this.bones.length;M<q;M++)this.bones[M].animations[0]&&this.bones[M].animations[0].deleteRange(K,H);this._ranges[K]=null}getAnimationRange(K){return this._ranges[K]||null}getAnimationRanges(){const K=[];let H;for(H in this._ranges)K.push(this._ranges[H]);return K}copyAnimationRange(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[H]||!K.getAnimationRange(H))return!1;let q=!0;const w=this._getHighestAnimationFrame()+1,u={},y=K.bones;let h,W;for(W=0,h=y.length;W<h;W++)u[y[W].name]=y[W];this.bones.length!==y.length&&(O.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${y.length}`),q=!1);const I=M&&this.dimensionsAtRest&&K.dimensionsAtRest?this.dimensionsAtRest.divide(K.dimensionsAtRest):null;for(W=0,h=this.bones.length;W<h;W++){const K=this.bones[W].name,y=u[K];y?q=q&&this.bones[W].copyAnimationRange(y,H,w,M,I):(O.e.Warn("copyAnimationRange: not same rig, missing source bone "+K),q=!1)}const f=K.getAnimationRange(H);return f&&(this._ranges[H]=new a.b(H,f.from+w,f.to+w)),q}returnToRest(){for(const K of this.bones)-1!==K._index&&K.returnToRest()}_getHighestAnimationFrame(){let K=0;for(let H=0,M=this.bones.length;H<M;H++)if(this.bones[H].animations[0]){const M=this.bones[H].animations[0].getHighestFrame();K<M&&(K=M)}return K}beginAnimation(K,H,M,q){const w=this.getAnimationRange(K);return w?this._scene.beginAnimation(this,w.from,w.to,H,M,q):null}static MakeAnimationAdditive(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,M=arguments.length>2?arguments[2]:void 0;const q=K.getAnimationRange(M);if(!q)return null;const w=K._scene.getAllAnimatablesByTarget(K);let u=null;for(let h=0;h<w.length;h++){const K=w[h];if(K.fromFrame===(null===q||void 0===q?void 0:q.from)&&K.toFrame===(null===q||void 0===q?void 0:q.to)){u=K;break}}const y=K.getAnimatables();for(let h=0;h<y.length;h++){const K=y[h].animations;if(K)for(let q=0;q<K.length;q++)G.d.MakeAnimationAdditive(K[q],H,M)}return u&&(u.isAdditive=!0),K}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(K){this._meshesWithPoseMatrix.push(K)}_unregisterMeshWithPoseMatrix(K){const H=this._meshesWithPoseMatrix.indexOf(K);H>-1&&this._meshesWithPoseMatrix.splice(H,1)}_computeTransformMatrices(K,H){this.onBeforeComputeObservable.notifyObservers(this);for(let M=0;M<this.bones.length;M++){const q=this.bones[M];q._childUpdateId++;const w=q.getParent();if(w?q.getLocalMatrix().multiplyToRef(w.getFinalMatrix(),q.getFinalMatrix()):H?q.getLocalMatrix().multiplyToRef(H,q.getFinalMatrix()):q.getFinalMatrix().q(q.getLocalMatrix()),-1!==q._index){const H=null===q._index?M:q._index;q.getAbsoluteInverseBindMatrix().multiplyToArray(q.getFinalMatrix(),K,16*H)}}this._identity.copyToArray(K,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const K=this.sK().getRenderId();if(this._currentRenderId===K)return;this._currentRenderId=K}if(this._numBonesWithLinkedTransformNode>0)for(const K of this.bones)if(K._linkedTransformNode){const H=K._linkedTransformNode;K.position=H.position,H.rotationQuaternion?K.rotationQuaternion=H.rotationQuaternion:K.rotation=H.rotation,K.Sh=H.Sh}if(this.needInitialSkinMatrix)for(const K of this._meshesWithPoseMatrix){const H=K.getPoseMatrix();let M=this._isDirty;if(K._bonesTransformMatrices&&K._bonesTransformMatrices.length===16*(this.bones.length+1)||(K._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),M=!0),M){if(this._synchronizedWithMesh!==K){this._synchronizedWithMesh=K;for(const K of this.bones)if(!K.getParent()){K.getBindMatrix().multiplyToRef(H,w.TmpVectors.Matrix[1]),K._updateAbsoluteBindMatrices(w.TmpVectors.Matrix[1])}if(this.isUsingTextureForMatrices){const H=4*(this.bones.length+1);K._transformMatrixTexture&&K._transformMatrixTexture.getSize().width===H||(K._transformMatrixTexture&&K._transformMatrixTexture.dispose(),K._transformMatrixTexture=z.d.CreateRGBATexture(K._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(K._bonesTransformMatrices,H),this.isUsingTextureForMatrices&&K._transformMatrixTexture&&K._transformMatrixTexture.update(K._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=z.d.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let K=0;K<this.bones.length;K++)this._animatables.push(this.bones[K])}return this._animatables}clone(K,H){const M=new S(K,H||K,this._scene);M.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let q=0;q<this.bones.length;q++){const K=this.bones[q];let H=null;const w=K.getParent();if(w){const K=this.bones.indexOf(w);H=M.bones[K]}const u=new I.e(K.name,M,H,K.getBindMatrix().clone(),K.getRestMatrix().clone());u._index=K._index,K._linkedTransformNode&&u.linkTransformNode(K._linkedTransformNode),L.b.DeepCopy(K.animations,u.animations)}if(this._ranges){M._ranges={};for(const K in this._ranges){const H=this._ranges[K];H&&(M._ranges[K]=H.clone())}}return this._isDirty=!0,M.prepare(!0),M}enableBlending(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;for(const H of this.bones)for(const M of H.animations)M.enableBlending=!0,M.blendingSpeed=K}dispose(){if(this._meshesWithPoseMatrix.length=0,this.sK().stopAnimation(this),this.sK().removeSkeleton(this),this._parentContainer){const K=this._parentContainer.skeletons.indexOf(this);K>-1&&this._parentContainer.skeletons.splice(K,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const K={};K.name=this.name,K.id=this.id,this.dimensionsAtRest&&(K.dimensionsAtRest=this.dimensionsAtRest.hh()),K.bones=[],K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let M=0;M<this.bones.length;M++){var H;const q=this.bones[M],w=q.getParent(),u={parentBoneIndex:w?this.bones.indexOf(w):-1,index:q.getIndex(),name:q.name,id:q.id,matrix:q.getBindMatrix().hh(),rest:q.getRestMatrix().hh(),linkedTransformNodeId:null===(H=q.getTransformNode())||void 0===H?void 0:H.id};K.bones.push(u),q.length&&(u.length=q.length),q.metadata&&(u.metadata=q.metadata),q.animations&&q.animations.length>0&&(u.animation=q.animations[0].serialize()),K.ranges=[];for(const H in this._ranges){const M=this._ranges[H];if(!M)continue;const q={};q.name=H,q.from=M.from,q.to=M.to,K.ranges.push(q)}}return K}static Parse(K,H){const M=new S(K.name,K.id,H);let q;for(K.dimensionsAtRest&&(M.dimensionsAtRest=w.OH.iH(K.dimensionsAtRest)),M.needInitialSkinMatrix=K.needInitialSkinMatrix,q=0;q<K.bones.length;q++){const H=K.bones[q],u=K.bones[q].index;let y=null;H.parentBoneIndex>-1&&(y=M.bones[H.parentBoneIndex]);const h=H.rest?w.Matrix.iH(H.rest):null,W=new I.e(H.name,M,y,w.Matrix.iH(H.matrix),h,null,u);void 0!==H.id&&null!==H.id&&(W.id=H.id),H.length&&(W.length=H.length),H.metadata&&(W.metadata=H.metadata),H.animation&&W.animations.push(G.d.Parse(H.animation)),void 0!==H.linkedTransformNodeId&&null!==H.linkedTransformNodeId&&(M._hasWaitingData=!0,W._waitingTransformNodeId=H.linkedTransformNodeId)}if(K.ranges)for(q=0;q<K.ranges.length;q++){const H=K.ranges[q];M.createAnimationRange(H.name,H.from,H.to)}return M}computeAbsoluteMatrices(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||K)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(K)}getPoseMatrix(){let K=null;return this._meshesWithPoseMatrix.length>0&&(K=this._meshesWithPoseMatrix[0].getPoseMatrix()),K}sortBones(){const K=[],H=new Array(this.bones.length);for(let M=0;M<this.bones.length;M++)this._sortBones(M,K,H);this.bones=K}_sortBones(K,H,M){if(M[K])return;M[K]=!0;const q=this.bones[K];if(!q)return;void 0===q._index&&(q._index=K);const w=q.getParent();w&&this._sortBones(this.bones.indexOf(w),H,M),H.push(q)}setCurrentPoseAsRest(){for(const K of this.bones)K.setCurrentPoseAsRest()}}var B=M(11605),C=M(11779),i=M(11267),Z=M(11697),E=M(11366),l=M(11738),s=M(11712),D=M(11726),V=M(11822),n=M(11388),c=M(12874);class k{set areUpdatesFrozen(K){K?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(this._forceUpdateWhenUnfrozen),this._forceUpdateWhenUnfrozen=!1))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new n.e(16),this._supportsPositions=!1,this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._supportsUV2s=!1,this._supportsColors=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._mustSynchronize=!0,this._forceUpdateWhenUnfrozen=!1,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enablePositionMorphing=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this.enableUV2Morphing=!0,this.enableColorMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,K||(K=v.b.LastCreatedScene),this._scene=K,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const K=this._scene.getEngine().getCaps();this._canUseTextureForTargets=K.canUseGLVertexID&&K.textureFloat&&K.maxVertexTextureImageUnits>0&&K.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return k.ConstantTargetCountForTextureMode>0&&this.isUsingTextureForTargets?k.ConstantTargetCountForTextureMode:this._numMaxInfluencers}set numMaxInfluencers(K){this._numMaxInfluencers!==K&&(this._numMaxInfluencers=K,this._mustSynchronize=!0,this._syncActiveTargets())}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsPositions(){return this._supportsPositions&&this.enablePositionMorphing}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get supportsUV2s(){return this._supportsUV2s&&this.enableUV2Morphing}get supportsColors(){return this._supportsColors&&this.enableColorMorphing}get hasPositions(){return this._supportsPositions}get hasNormals(){return this._supportsNormals}get hasTangents(){return this._supportsTangents}get hasUVs(){return this._supportsUVs}get hasUV2s(){return this._supportsUV2s}get hasColors(){return this._supportsColors}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(K){this._useTextureToStoreTargets!==K&&(this._useTextureToStoreTargets=K,this._mustSynchronize=!0,this._syncActiveTargets())}get isUsingTextureForTargets(){var K;return k.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(K=this._scene)&&void 0!==K&&K.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(K){return this._activeTargets.data[K]}getTarget(K){return this._targets[K]}getTargetByName(K){for(const H of this._targets)if(H.name===K)return H;return null}addTarget(K){this._targets.push(K),this._targetInfluenceChangedObservers.push(K.onInfluenceChanged.add((K=>{this.areUpdatesFrozen&&K&&(this._forceUpdateWhenUnfrozen=!0),this._syncActiveTargets(K)}))),this._targetDataLayoutChangedObservers.push(K._onDataLayoutChanged.add((()=>{this._mustSynchronize=!0,this._syncActiveTargets()}))),this._mustSynchronize=!0,this._syncActiveTargets()}removeTarget(K){const H=this._targets.indexOf(K);H>=0&&(this._targets.splice(H,1),K.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(H,1)[0]),K._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(H,1)[0]),this._mustSynchronize=!0,this._syncActiveTargets()),this._scene&&this._scene.stopAnimation(K)}_bind(K){K.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),K.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),K.setTexture("morphTargets",this._targetStoreTexture),K.setInt("morphTargetCount",this.numInfluencers)}clone(){const K=new k(this._scene);for(const H of this._targets)K.addTarget(H.clone());return K.enablePositionMorphing=this.enablePositionMorphing,K.enableNormalMorphing=this.enableNormalMorphing,K.enableTangentMorphing=this.enableTangentMorphing,K.enableUVMorphing=this.enableUVMorphing,K.enableUV2Morphing=this.enableUV2Morphing,K.enableColorMorphing=this.enableColorMorphing,K}serialize(){const K={};K.id=this.uniqueId,K.targets=[];for(const H of this._targets)K.targets.push(H.serialize());return K}_syncActiveTargets(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.areUpdatesFrozen)return;const H=!!this._targetStoreTexture,M=this.isUsingTextureForTargets;(this._mustSynchronize||H!==M)&&(this._mustSynchronize=!1,this.synchronize());let q=0;this._activeTargets.reset(),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let w=-1;for(const u of this._targets)if(w++,0!==u.influence||!this.optimizeInfluencers){if(this._activeTargets.length>=k.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(u),this._morphTargetTextureIndices[q]=w,this._tempInfluences[q++]=u.influence}this._morphTargetTextureIndices.length!==q&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,q)),this._influences&&this._influences.length===q||(this._influences=new Float32Array(q));for(let u=0;u<q;u++)this._influences[u]=this._tempInfluences[u];if(K&&this._scene)for(const u of this._scene.meshes)u.morphTargetManager===this&&(M?u._markSubMeshesAsAttributesDirty():u._syncGeometryWithMorphTargetManager())}synchronize(){var K;if(!this._scene||this.areUpdatesFrozen)return;const H=this._scene.getEngine();this._supportsPositions=!0,this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._supportsUV2s=!0,this._supportsColors=!0,this._vertexCount=0,null===(K=this._targetStoreTexture)||void 0===K||K.dispose(),this._targetStoreTexture=null,this.isUsingTextureForTargets&&this._targets.length>H.getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1);for(const M of this._targets){this._supportsPositions=this._supportsPositions&&M.hasPositions,this._supportsNormals=this._supportsNormals&&M.hasNormals,this._supportsTangents=this._supportsTangents&&M.hasTangents,this._supportsUVs=this._supportsUVs&&M.hasUVs,this._supportsUV2s=this._supportsUV2s&&M.hasUV2s,this._supportsColors=this._supportsColors&&M.hasColors;const K=M.vertexCount;if(0===this._vertexCount)this._vertexCount=K;else if(this._vertexCount!==K)return void O.e.Error(`Incompatible target. Targets must all have the same vertices count. Current vertex count: ${this._vertexCount}, vertex count for target "${M.name}": ${K}`)}if(this.isUsingTextureForTargets){this._textureVertexStride=0,this._supportsPositions&&this._textureVertexStride++,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._supportsUV2s&&this._textureVertexStride++,this._supportsColors&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const K=H.getCaps().maxTextureSize;this._textureWidth>K&&(this._textureHeight=Math.ceil(this._textureWidth/K),this._textureWidth=K);const M=this._targets.length,q=new Float32Array(M*this._textureWidth*this._textureHeight*4);let w=0;for(let H=0;H<M;H++){const K=this._targets[H],M=K.getPositions(),u=K.getNormals(),y=K.getUVs(),h=K.getTangents(),W=K.getUV2s(),I=K.getColors();w=H*this._textureWidth*this._textureHeight*4;for(let H=0;H<this._vertexCount;H++)this._supportsPositions&&M&&(q[w]=M[3*H],q[w+1]=M[3*H+1],q[w+2]=M[3*H+2],w+=4),this._supportsNormals&&u&&(q[w]=u[3*H],q[w+1]=u[3*H+1],q[w+2]=u[3*H+2],w+=4),this._supportsUVs&&y&&(q[w]=y[2*H],q[w+1]=y[2*H+1],w+=4),this._supportsTangents&&h&&(q[w]=h[3*H],q[w+1]=h[3*H+1],q[w+2]=h[3*H+2],w+=4),this._supportsUV2s&&W&&(q[w]=W[2*H],q[w+1]=W[2*H+1],w+=4),this._supportsColors&&I&&(q[w]=I[4*H],q[w+1]=I[4*H+1],q[w+2]=I[4*H+2],q[w+3]=I[4*H+3],w+=4)}this._targetStoreTexture=c.c.CreateRGBATexture(q,this._textureWidth,this._textureHeight,M,this._scene,!1,!1,1,1),this._targetStoreTexture.name=`Morph texture_${this.uniqueId}`}for(const M of this._scene.meshes)M.morphTargetManager===this&&M._syncGeometryWithMorphTargetManager()}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const K=this._parentContainer.morphTargetManagers.indexOf(this);K>-1&&this._parentContainer.morphTargetManagers.splice(K,1),this._parentContainer=null}for(const K of this._targets)this._scene.stopAnimation(K)}}static Parse(K,H){const M=new k(H);for(const q of K.targets)M.addTarget(V.e.Parse(q,H));return M}}k.EnableTextureStorage=!0,k.MaxActiveMorphTargetsInVertexAttributeMode=8,k.ConstantTargetCountForTextureMode=0;var T=M(12923),d=M(11152),x=M(11629);const Q=new Map,J=Q;function N(K,H,M){p(K)&&O.e.Warn(`Extension with the name '${K}' already exists`),Q.set(K,{isGLTFExtension:H,factory:M})}function p(K){return Q.delete(K)}var o=M(12935),R=M(11893),t=M(11376);class U{static Get(K,H,M){if(!H||void 0==M||!H[M])throw new Error(`${K}: Failed to find index (${M})`);return H[M]}static TryGet(K,H){return K&&void 0!=H&&K[H]?K[H]:null}static Assign(K){if(K)for(let H=0;H<K.length;H++)K[H].index=H}}function j(K){if(K.min&&K.max){const H=K.min,M=K.max,q=w.TmpVectors.OH[0].Lh(H[0],H[1],H[2]),u=w.TmpVectors.OH[1].Lh(M[0],M[1],M[2]);if(K.normalized&&5126!==K.componentType){let H=1;switch(K.componentType){case 5120:H=127;break;case 5121:H=255;break;case 5122:H=32767;break;case 5123:H=65535}const M=1/H;q.scaleInPlace(M),u.scaleInPlace(M)}return new x.d(q,u)}return null}class m{static RegisterExtension(K,H){N(K,!1,H)}static UnregisterExtension(K){return p(K)}get wh(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(K){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=K}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((K=>K.dispose&&K.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}async importMeshAsync(K,H,M,q,w,u){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return await Promise.resolve().then((async()=>{this._babylonScene=H,this._assetContainer=M,this._loadData(q);let u=null;if(K){const H={};if(this._gltf.nodes)for(const K of this._gltf.nodes)K.name&&(H[K.name]=K.index);u=(K instanceof Array?K:[K]).map((K=>{const M=H[K];if(void 0===M)throw new Error(`Failed to find node '${K}'`);return M}))}return await this._loadAsync(w,y,u,(()=>({meshes:this._getMeshes(),CG:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}async loadAsync(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return this._babylonScene=K,this._loadData(H),await this._loadAsync(M,w,null,(()=>{}))}async _loadAsync(K,H,M,q){return await Promise.resolve().then((async()=>{this._rootUrl=K,this._uniqueRootUrl=!K.startsWith("file:")&&H?K:`${K}${Date.now()}/`,this._fileName=H,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const w=`${T.n[T.n.LOADING]} => ${T.n[T.n.READY]}`,u=`${T.n[T.n.LOADING]} => ${T.n[T.n.COMPLETE]}`;this._parent._startPerformanceCounter(w),this._parent._startPerformanceCounter(u),this._parent._setState(T.n.LOADING),this._extensionsOnLoading();const h=new Array;if(!this.parent.loadOnlyMaterials)if(M)h.push(this.loadSceneAsync("/nodes",{nodes:M,index:-1}));else if(void 0!=this._gltf.SH||this._gltf.scenes&&this._gltf.scenes[0]){const K=U.Get("/scene",this._gltf.scenes,this._gltf.SH||0);h.push(this.loadSceneAsync(`/scenes/${K.index}`,K))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let K=0;K<this._gltf.materials.length;++K){const H=this._gltf.materials[K],M="/materials/"+K,q=B.c.TriangleFillMode;h.push(this._loadMaterialAsync(M,H,null,q,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&h.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&h.push(this._compileShadowGeneratorsAsync());const W=Promise.all(h).then((()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.rh(!0);for(const K of this._babylonScene.materials){const H=K;void 0!==H.maxSimultaneousLights&&(H.maxSimultaneousLights=Math.max(H.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(T.n.READY),this._skipStartAnimationStep||this._startAnimations(),q()}));return await W.then((K=>(this._parent._endPerformanceCounter(w),y.Tools.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(u),this._parent._setState(T.n.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(K=>{this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()}))})),K)))})).catch((K=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()),K}))}_loadData(K){if(this._gltf=K.json,this._setupData(),K.bin){const H=this._gltf.buffers;if(H&&H[0]&&!H[0].uri){const M=H[0];(M.byteLength<K.bin.byteLength-3||M.byteLength>K.bin.byteLength)&&O.e.Warn(`Binary buffer length (${M.byteLength}) from JSON does not match chunk length (${K.bin.byteLength})`),this._bin=K.bin}else O.e.Warn("Unexpected BIN chunk")}}_setupData(){if(U.Assign(this._gltf.accessors),U.Assign(this._gltf.animations),U.Assign(this._gltf.buffers),U.Assign(this._gltf.bufferViews),U.Assign(this._gltf.cameras),U.Assign(this._gltf.images),U.Assign(this._gltf.materials),U.Assign(this._gltf.meshes),U.Assign(this._gltf.nodes),U.Assign(this._gltf.samplers),U.Assign(this._gltf.scenes),U.Assign(this._gltf.skins),U.Assign(this._gltf.textures),this._gltf.nodes){const K={};for(const M of this._gltf.nodes)if(M.children)for(const H of M.children)K[H]=M.index;const H=this._createRootNode();for(const M of this._gltf.nodes){const q=K[M.index];M.parent=void 0===q?H:this._gltf.nodes[q]}}}async _loadExtensionsAsync(){const K=[];if(J.forEach(((H,M)=>{var q;!1===(null===(q=this.parent.extensionOptions[M])||void 0===q?void 0:q.enabled)?H.isGLTFExtension&&this.isExtensionUsed(M)&&O.e.Warn(`Extension ${M} is used but has been explicitly disabled.`):H.isGLTFExtension&&!this.isExtensionUsed(M)||K.push((async()=>{const K=await H.factory(this);return K.name!==M&&O.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${K.name} !== ${M}`),this._parent.onExtensionLoadedObservable.notifyObservers(K),K})())})),this._extensions.push(...await Promise.all(K)),this._extensions.sort(((K,H)=>(K.order||Number.MAX_VALUE)-(H.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const M of this._gltf.extensionsRequired){if(!this._extensions.some((K=>K.name===M&&K.enabled))){var H;if(!1===(null===(H=this.parent.extensionOptions[M])||void 0===H?void 0:H.enabled))throw new Error(`Required extension ${M} is disabled`);throw new Error(`Required extension ${M} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new D.b("__root__",this._babylonScene);this._rootBabylonMesh=K,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.rh(!1);const H={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case T.j.AUTO:this._babylonScene.useRightHandedSystem||(H.rotation=[0,1,0,0],H.scale=[1,1,-1],m._LoadTransform(H,this._rootBabylonMesh));break;case T.j.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(K),H}loadSceneAsync(K,H){const M=this._extensionsLoadSceneAsync(K,H);if(M)return M;const q=new Array;if(this.logOpen(`${K} ${H.name||""}`),H.nodes)for(const w of H.nodes){const H=U.Get(`${K}/nodes/${w}`,this._gltf.nodes,w);q.push(this.loadNodeAsync(`/nodes/${H.index}`,H,(K=>{K.parent=this._rootBabylonMesh})))}for(const w of this._postSceneLoadActions)w();return q.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(q).then((()=>{}))}_forEachPrimitive(K,H){if(K._primitiveBabylonMeshes)for(const M of K._primitiveBabylonMeshes)H(M)}_getGeometries(){const K=[],H=this._gltf.nodes;if(H)for(const M of H)this._forEachPrimitive(M,(H=>{const M=H.Gh;M&&-1===K.indexOf(M)&&K.push(M)}));return K}_getMeshes(){const K=[];this._rootBabylonMesh instanceof s.c&&K.push(this._rootBabylonMesh);const H=this._gltf.nodes;if(H)for(const M of H)this._forEachPrimitive(M,(H=>{K.push(H)}));return K}_getTransformNodes(){const K=[],H=this._gltf.nodes;if(H)for(const M of H)M._babylonTransformNode&&"mh"===M._babylonTransformNode.getClassName()&&K.push(M._babylonTransformNode),M._babylonTransformNodeForSkin&&K.push(M._babylonTransformNodeForSkin);return K}_getSkeletons(){const K=[],H=this._gltf.skins;if(H)for(const M of H)M._data&&K.push(M._data.babylonSkeleton);return K}_getAnimationGroups(){const K=[],H=this._gltf.animations;if(H)for(const M of H)M._babylonAnimationGroup&&K.push(M._babylonAnimationGroup);return K}_startAnimations(){switch(this._parent.animationStartMode){case T.g.NONE:break;case T.g.FIRST:{const K=this._getAnimationGroups();0!==K.length&&K[0].start(!0);break}case T.g.ALL:{const K=this._getAnimationGroups();for(const H of K)H.start(!0);break}default:return void O.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadNodeAsync(K,H,M);if(q)return q;if(H._babylonTransformNode)throw new Error(`${K}: Invalid recursive node hierarchy`);const w=new Array;this.logOpen(`${K} ${H.name||""}`);const u=q=>{if(m.AddPointerMetadata(q,K),m._LoadTransform(H,q),void 0!=H.camera){const M=U.Get(`${K}/camera`,this._gltf.cameras,H.camera);w.push(this.loadCameraAsync(`/cameras/${M.index}`,M,(K=>{K.parent=q,this._babylonScene.useRightHandedSystem||(q.Sh.x=-1)})))}if(H.children)for(const M of H.children){const H=U.Get(`${K}/children/${M}`,this._gltf.nodes,M);w.push(this.loadNodeAsync(`/nodes/${H.index}`,H,(K=>{K.parent=q})))}M(q)},y=void 0!=H.mesh,h=this._parent.loadSkins&&void 0!=H.skin;if(!y||h){const K=H.name||`node${H.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new Z.e(K,this._babylonScene);M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==H.mesh?H._babylonTransformNode=M:H._babylonTransformNodeForSkin=M,u(M)}if(y)if(h){const M=U.Get(`${K}/mesh`,this._gltf.meshes,H.mesh);w.push(this._loadMeshAsync(`/meshes/${M.index}`,H,M,(M=>{const q=H._babylonTransformNodeForSkin;M.metadata=(0,R.c)(q.metadata,M.metadata||{});const u=U.Get(`${K}/skin`,this._gltf.skins,H.skin);w.push(this._loadSkinAsync(`/skins/${u.index}`,H,u,(K=>{this._forEachPrimitive(H,(H=>{H.skeleton=K})),this._postSceneLoadActions.push((()=>{if(void 0!=u.skeleton){const K=U.Get(`/skins/${u.index}/skeleton`,this._gltf.nodes,u.skeleton).parent;H.index===K.index?M.parent=q.parent:M.parent=K._babylonTransformNode}else M.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:q,skinnedNode:M})}))})))})))}else{const M=U.Get(`${K}/mesh`,this._gltf.meshes,H.mesh);w.push(this._loadMeshAsync(`/meshes/${M.index}`,H,M,u))}return this.logClose(),Promise.all(w).then((()=>(this._forEachPrimitive(H,(K=>{const H=K;!H.isAnInstance&&H.Gh&&H.Gh.useBoundingInfoFromGeometry?K.QK():K.refreshBoundingInfo(!0,!0)})),H._babylonTransformNode)))}_loadMeshAsync(K,H,M,q){const w=M.primitives;if(!w||!w.length)throw new Error(`${K}: Primitives are missing`);void 0==w[0].index&&U.Assign(w);const u=new Array;this.logOpen(`${K} ${M.name||""}`);const y=H.name||`node${H.index}`;if(1===w.length){const q=M.primitives[0];u.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${q.index}`,y,H,M,q,(K=>{H._babylonTransformNode=K,H._primitiveBabylonMeshes=[K]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,H._babylonTransformNode=new Z.e(y,this._babylonScene),H._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._primitiveBabylonMeshes=[];for(const q of w)u.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${q.index}`,`${y}_primitive${q.index}`,H,M,q,(K=>{K.parent=H._babylonTransformNode,H._primitiveBabylonMeshes.push(K)})))}return q(H._babylonTransformNode),this.logClose(),Promise.all(u).then((()=>H._babylonTransformNode))}_loadMeshPrimitiveAsync(K,H,M,q,w,u){const y=this._extensionsLoadMeshPrimitiveAsync(K,H,M,q,w,u);if(y)return y;this.logOpen(`${K}`);const h=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==M.skin&&!q.primitives[0].targets;let W,I;if(h&&w._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,W=w._instanceData.babylonSourceMesh.createInstance(H),W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,I=w._instanceData.promise;else{const u=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new D.b(H,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.sideOrientation=this._babylonScene.useRightHandedSystem?B.c.CounterClockWiseSideOrientation:B.c.ClockWiseSideOrientation,this._createMorphTargets(K,M,q,w,y),u.push(this._loadVertexDataAsync(K,w,y).then((async H=>await this._loadMorphTargetsAsync(K,w,y,H).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,H.dK(y),H._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const f=m._GetDrawMode(K,w.mode);if(void 0==w.material){let K=this._defaultBabylonMaterialData[f];K||(K=this._createDefaultMaterial("__GLTFLoader._default",f),this._parent.onMaterialLoadedObservable.notifyObservers(K),this._defaultBabylonMaterialData[f]=K),y.material=K}else if(!this.parent.skipMaterials){const H=U.Get(`${K}/material`,this._gltf.materials,w.material);u.push(this._loadMaterialAsync(`/materials/${H.index}`,H,y,f,(K=>{y.material=K})))}I=Promise.all(u),h&&(w._instanceData={babylonSourceMesh:y,promise:I}),W=y}return m.AddPointerMetadata(W,K),this._parent.onMeshLoadedObservable.notifyObservers(W),u(W),this.logClose(),I.then((()=>W))}_loadVertexDataAsync(K,H,M){const q=this._extensionsLoadVertexDataAsync(K,H,M);if(q)return q;const w=H.attributes;if(!w)throw new Error(`${K}: Attributes are missing`);const u=new Array,y=new l.c(M.name,this._babylonScene);if(void 0==H.indices)M.isUnIndexed=!0;else{const M=U.Get(`${K}/indices`,this._gltf.accessors,H.indices);u.push(this._loadIndicesAccessorAsync(`/accessors/${M.index}`,M).then((K=>{y.setIndices(K)})))}const h=(H,q,h)=>{if(void 0==w[H])return;M._delayInfo=M._delayInfo||[],-1===M._delayInfo.indexOf(q)&&M._delayInfo.push(q);const W=U.Get(`${K}/attributes/${H}`,this._gltf.accessors,w[H]);u.push(this._loadVertexAccessorAsync(`/accessors/${W.index}`,W,q).then((K=>{if(K.getKind()===E.d.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!M.skeleton){const K=j(W);K&&(y._boundingInfo=K,y.useBoundingInfoFromGeometry=!0)}y.setVerticesBuffer(K,W.count)}))),q==E.d.MatricesIndicesExtraKind&&(M.numBoneInfluencers=8),h&&h(W)};return h("POSITION",E.d.PositionKind),h("NORMAL",E.d.NormalKind),h("TANGENT",E.d.TangentKind),h("TEXCOORD_0",E.d.UVKind),h("TEXCOORD_1",E.d.UV2Kind),h("TEXCOORD_2",E.d.UV3Kind),h("TEXCOORD_3",E.d.UV4Kind),h("TEXCOORD_4",E.d.UV5Kind),h("TEXCOORD_5",E.d.UV6Kind),h("JOINTS_0",E.d.MatricesIndicesKind),h("WEIGHTS_0",E.d.MatricesWeightsKind),h("JOINTS_1",E.d.MatricesIndicesExtraKind),h("WEIGHTS_1",E.d.MatricesWeightsExtraKind),h("COLOR_0",E.d.ColorKind,(K=>{"VEC4"===K.type&&(M.hasVertexAlpha=!0)})),Promise.all(u).then((()=>y))}_createMorphTargets(K,H,M,q,w){if(!q.targets||!this._parent.loadMorphTargets)return;if(void 0==H._numMorphTargets)H._numMorphTargets=q.targets.length;else if(q.targets.length!==H._numMorphTargets)throw new Error(`${K}: Primitives do not have the same number of targets`);const u=M.extras?M.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,w.morphTargetManager=new k(this._babylonScene),w.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,w.morphTargetManager.areUpdatesFrozen=!0;for(let y=0;y<q.targets.length;y++){const K=H.weights?H.weights[y]:M.weights?M.weights[y]:0,q=u?u[y]:`morphTarget${y}`;w.morphTargetManager.addTarget(new V.e(q,K,w.sK()))}}_loadMorphTargetsAsync(K,H,M,q){if(!H.targets||!this._parent.loadMorphTargets)return Promise.resolve();const w=new Array,u=M.morphTargetManager;for(let y=0;y<u.numTargets;y++){const M=u.getTarget(y);w.push(this._loadMorphTargetVertexDataAsync(`${K}/targets/${y}`,q,H.targets[y],M))}return Promise.all(w).then((()=>{u.areUpdatesFrozen=!1}))}async _loadMorphTargetVertexDataAsync(K,H,M,q){const w=new Array,u=(q,u,y)=>{if(void 0==M[q])return;const h=H.getVertexBuffer(u);if(!h)return;const W=U.Get(`${K}/${q}`,this._gltf.accessors,M[q]);w.push(this._loadFloatAccessorAsync(`/accessors/${W.index}`,W).then((K=>{y(h,K)})))};return u("POSITION",E.d.PositionKind,((K,H)=>{const M=new Float32Array(H.length);K.forEach(H.length,((K,q)=>{M[q]=H[q]+K})),q.setPositions(M)})),u("NORMAL",E.d.NormalKind,((K,H)=>{const M=new Float32Array(H.length);K.forEach(M.length,((K,q)=>{M[q]=H[q]+K})),q.setNormals(M)})),u("TANGENT",E.d.TangentKind,((K,H)=>{const M=new Float32Array(H.length/3*4);let w=0;K.forEach(H.length/3*4,((K,q)=>{(q+1)%4!==0&&(M[w]=H[w]+K,w++)})),q.setTangents(M)})),u("TEXCOORD_0",E.d.UVKind,((K,H)=>{const M=new Float32Array(H.length);K.forEach(H.length,((K,q)=>{M[q]=H[q]+K})),q.setUVs(M)})),u("TEXCOORD_1",E.d.UV2Kind,((K,H)=>{const M=new Float32Array(H.length);K.forEach(H.length,((K,q)=>{M[q]=H[q]+K})),q.setUV2s(M)})),u("COLOR_0",E.d.ColorKind,((H,M)=>{let w=null;const u=H.getSize();if(3===u){w=new Float32Array(M.length/3*4),H.forEach(M.length,((K,H)=>{const q=Math.floor(H/3),u=H%3;w[4*q+u]=M[3*q+u]+K}));for(let K=0;K<M.length/3;++K)w[4*K+3]=1}else{if(4!==u)throw new Error(`${K}: Invalid number of components (${u}) for COLOR_0 attribute`);w=new Float32Array(M.length),H.forEach(M.length,((K,H)=>{w[H]=M[H]+K}))}q.setColors(w)})),await Promise.all(w).then((()=>{}))}static _LoadTransform(K,H){if(void 0!=K.skin)return;let M=w.OH.Zero(),q=w.Quaternion.Identity(),u=w.OH.One();if(K.matrix){w.Matrix.iH(K.matrix).decompose(u,q,M)}else K.translation&&(M=w.OH.iH(K.translation)),K.rotation&&(q=w.Quaternion.iH(K.rotation)),K.scale&&(u=w.OH.iH(K.scale));H.position=M,H.rotationQuaternion=q,H.Sh=u}_loadSkinAsync(K,H,M,q){if(!this._parent.loadSkins)return Promise.resolve();const w=this._extensionsLoadSkinAsync(K,H,M);if(w)return w;if(M._data)return q(M._data.babylonSkeleton),M._data.promise;const u=`skeleton${M.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new S(M.name||u,u,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(K,M,y);const h=this._loadSkinInverseBindMatricesDataAsync(K,M).then((K=>{this._updateBoneMatrices(y,K)}));return M._data={babylonSkeleton:y,promise:h},q(y),h}_loadBones(K,H,M){if(void 0==H.skeleton||this._parent.alwaysComputeSkeletonRootNode){const M=this._findSkeletonRootNode(`${K}/joints`,H.joints);if(M)if(void 0===H.skeleton)H.skeleton=M.index;else{const q=(K,H)=>{for(;H.parent;H=H.parent)if(H.parent===K)return!0;return!1},w=U.Get(`${K}/skeleton`,this._gltf.nodes,H.skeleton);w===M||q(w,M)||(O.e.Warn(`${K}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),H.skeleton=M.index)}else O.e.Warn(`${K}: Failed to find common root`)}const q={};for(const w of H.joints){const u=U.Get(`${K}/joints/${w}`,this._gltf.nodes,w);this._loadBone(u,H,M,q)}}_findSkeletonRootNode(K,H){if(0===H.length)return null;const M={};for(const w of H){const H=[];let q=U.Get(`${K}/${w}`,this._gltf.nodes,w);for(;-1!==q.index;)H.unshift(q),q=q.parent;M[w]=H}let q=null;for(let w=0;;++w){let K=M[H[0]];if(w>=K.length)return q;const u=K[w];for(let y=1;y<H.length;++y)if(K=M[H[y]],w>=K.length||u!==K[w])return q;q=u}}_loadBone(K,H,M,q){K._isJoint=!0;let w=q[K.index];if(w)return w;let u=null;K.index!==H.skeleton&&(K.parent&&-1!==K.parent.index?u=this._loadBone(K.parent,H,M,q):void 0!==H.skeleton&&O.e.Warn(`/skins/${H.index}/skeleton: Skeleton node is not a common root`));const y=H.joints.indexOf(K.index);return w=new I.e(K.name||`joint${K.index}`,M,u,this._getNodeMatrix(K),null,null,y),q[K.index]=w,this._postSceneLoadActions.push((()=>{w.linkTransformNode(K._babylonTransformNode)})),w}_loadSkinInverseBindMatricesDataAsync(K,H){if(void 0==H.inverseBindMatrices)return Promise.resolve(null);const M=U.Get(`${K}/inverseBindMatrices`,this._gltf.accessors,H.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${M.index}`,M)}_updateBoneMatrices(K,H){for(const M of K.bones){const K=w.Matrix.Identity(),q=M._index;H&&-1!==q&&(w.Matrix.FromArrayToRef(H,16*q,K),K.invertToRef(K));const u=M.getParent();u&&K.multiplyToRef(u.getAbsoluteInverseBindMatrix(),K),M.fh(K,!1,!1),M._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(K){return K.matrix?w.Matrix.iH(K.matrix):w.Matrix.Compose(K.scale?w.OH.iH(K.scale):w.OH.One(),K.rotation?w.Quaternion.iH(K.rotation):w.Quaternion.Identity(),K.translation?w.OH.iH(K.translation):w.OH.Zero())}loadCameraAsync(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadCameraAsync(K,H,M);if(q)return q;const u=new Array;this.logOpen(`${K} ${H.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const y=new W.d(H.name||`camera${H.index}`,w.OH.Zero(),this._babylonScene,!1);switch(y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._babylonCamera=y,y.setTarget(new w.OH(0,0,-1)),H.type){case"perspective":{const M=H.perspective;if(!M)throw new Error(`${K}: Camera perspective properties are missing`);y.fov=M.yfov,y.Ih=M.znear,y.maxZ=M.zfar||0;break}case"orthographic":if(!H.orthographic)throw new Error(`${K}: Camera orthographic properties are missing`);y.mode=h.b.ORTHOGRAPHIC_CAMERA,y.orthoLeft=-H.orthographic.xmag,y.orthoRight=H.orthographic.xmag,y.orthoBottom=-H.orthographic.ymag,y.orthoTop=H.orthographic.ymag,y.Ih=H.orthographic.znear,y.maxZ=H.orthographic.zfar;break;default:throw new Error(`${K}: Invalid camera type (${H.type})`)}return m.AddPointerMetadata(y,K),this._parent.onCameraLoadedObservable.notifyObservers(y),M(y),this.logClose(),Promise.all(u).then((()=>y))}_loadAnimationsAsync(){const K=this._gltf.animations;if(!K)return Promise.resolve();const H=new Array;for(let M=0;M<K.length;M++){const q=K[M];H.push(this.loadAnimationAsync(`/animations/${q.index}`,q).then((K=>{0===K.targetedAnimations.length&&K.dispose()})))}return Promise.all(H).then((()=>{}))}loadAnimationAsync(K,H){const q=this._extensionsLoadAnimationAsync(K,H);return q||M.e(78).then(M.bind(M,14419)).then((M=>{let{AnimationGroup:q}=M;this._babylonScene._blockEntityCollection=!!this._assetContainer;const w=new q(H.name||`animation${H.index}`,this._babylonScene);w._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,H._babylonAnimationGroup=w;const u=new Array;U.Assign(H.channels),U.Assign(H.samplers);for(const y of H.channels)u.push(this._loadAnimationChannelAsync(`${K}/channels/${y.index}`,K,H,y,((K,H)=>{K.animations=K.animations||[],K.animations.push(H),w.addTargetedAnimation(H,K)})));return Promise.all(u).then((()=>(w.normalize(0),w)))}))}async _loadAnimationChannelAsync(K,H,q,w,u){const y=this._extensionsLoadAnimationChannelAsync(K,H,q,w,u);if(y)return await y;if(void 0==w.target.node)return await Promise.resolve();const h=U.Get(`${K}/target/node`,this._gltf.nodes,w.target.node),W=w.target.path,I="weights"===W;if(I&&!h._numMorphTargets||!I&&!h._babylonTransformNode)return await Promise.resolve();if(!this._parent.loadNodeAnimations&&!I&&!h._isJoint)return await Promise.resolve();let f;switch(await Promise.resolve().then(M.bind(M,12942)),W){case"translation":var z;f=null===(z=(0,o.g)("/nodes/{}/translation"))||void 0===z?void 0:z.interpolation;break;case"rotation":var G;f=null===(G=(0,o.g)("/nodes/{}/rotation"))||void 0===G?void 0:G.interpolation;break;case"scale":var a;f=null===(a=(0,o.g)("/nodes/{}/scale"))||void 0===a?void 0:a.interpolation;break;case"weights":var v;f=null===(v=(0,o.g)("/nodes/{}/weights"))||void 0===v?void 0:v.interpolation;break;default:throw new Error(`${K}/target/path: Invalid value (${w.target.path})`)}if(!f)throw new Error(`${K}/target/path: Could not find interpolation properties for target path (${w.target.path})`);const O={object:h,info:f};return await this._loadAnimationChannelFromTargetInfoAsync(K,H,q,w,O,u)}_loadAnimationChannelFromTargetInfoAsync(K,H,M,q,w,u){const y=this.parent.targetFps,h=1/y,W=U.Get(`${K}/sampler`,M.samplers,q.sampler);return this._loadAnimationSamplerAsync(`${H}/samplers/${q.sampler}`,W).then((K=>{let H=0;const W=w.object,I=w.info;for(const w of I){const I=w.getStride(W),f=K.input,z=K.output,G=new Array(f.length);let a=0;switch(K.interpolation){case"STEP":for(let K=0;K<f.length;K++){const H=w.getValue(W,z,a,1);a+=I,G[K]={frame:f[K]*y,value:H,interpolation:1}}break;case"CUBICSPLINE":for(let K=0;K<f.length;K++){const H=w.getValue(W,z,a,h);a+=I;const M=w.getValue(W,z,a,1);a+=I;const q=w.getValue(W,z,a,h);a+=I,G[K]={frame:f[K]*y,inTangent:H,value:M,outTangent:q}}break;case"LINEAR":for(let K=0;K<f.length;K++){const H=w.getValue(W,z,a,1);a+=I,G[K]={frame:f[K]*y,value:H}}}if(a>0){const K=`${M.name||`animation${M.index}`}_channel${q.index}_${H}`,h=w.buildAnimations(W,K,y,G);for(const M of h)H++,u(M.babylonAnimatable,M.babylonAnimation)}}}))}_loadAnimationSamplerAsync(K,H){if(H._data)return H._data;const M=H.interpolation||"LINEAR";switch(M){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${K}/interpolation: Invalid value (${H.interpolation})`)}const q=U.Get(`${K}/input`,this._gltf.accessors,H.input),w=U.Get(`${K}/output`,this._gltf.accessors,H.output);return H._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${q.index}`,q),this._loadFloatAccessorAsync(`/accessors/${w.index}`,w)]).then((K=>{let[H,q]=K;return{input:H,interpolation:M,output:q}})),H._data}loadBufferAsync(K,H,M,q){const w=this._extensionsLoadBufferAsync(K,H,M,q);if(w)return w;if(!H._data)if(H.uri)H._data=this.loadUriAsync(`${K}/uri`,H,H.uri);else{if(!this._bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);H._data=this._bin.readAsync(0,H.byteLength)}return H._data.then((H=>{try{return new Uint8Array(H.buffer,H.byteOffset+M,q)}catch(w){throw new Error(`${K}: ${w.message}`)}}))}loadBufferViewAsync(K,H){const M=this._extensionsLoadBufferViewAsync(K,H);if(M)return M;if(H._data)return H._data;const q=U.Get(`${K}/buffer`,this._gltf.buffers,H.buffer);return H._data=this.loadBufferAsync(`/buffers/${q.index}`,q,H.byteOffset||0,H.byteLength),H._data}_loadAccessorAsync(K,H,M){if(H._data)return H._data;const q=m._GetNumComponents(K,H.type),w=q*E.d.GetTypeByteLength(H.componentType),u=q*H.count;if(void 0==H.bufferView)H._data=Promise.resolve(new M(u));else{const y=U.Get(`${K}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${y.index}`,y).then((h=>{if(5126!==H.componentType||H.normalized||y.byteStride&&y.byteStride!==w){const K=new M(u);return E.d.ForEach(h,H.byteOffset||0,y.byteStride||w,q,H.componentType,K.length,H.normalized||!1,((H,M)=>{K[M]=H})),K}return m._GetTypedArray(K,H.componentType,h,H.byteOffset,u)}))}if(H.sparse){const u=H.sparse;H._data=H._data.then((y=>{const h=y,W=U.Get(`${K}/sparse/indices/bufferView`,this._gltf.bufferViews,u.indices.bufferView),I=U.Get(`${K}/sparse/values/bufferView`,this._gltf.bufferViews,u.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${W.index}`,W),this.loadBufferViewAsync(`/bufferViews/${I.index}`,I)]).then((y=>{let[W,I]=y;const f=m._GetTypedArray(`${K}/sparse/indices`,u.indices.componentType,W,u.indices.byteOffset,u.count),z=q*u.count;let G;if(5126!==H.componentType||H.normalized){const y=m._GetTypedArray(`${K}/sparse/values`,H.componentType,I,u.values.byteOffset,z);G=new M(z),E.d.ForEach(y,0,w,q,H.componentType,G.length,H.normalized||!1,((K,H)=>{G[H]=K}))}else G=m._GetTypedArray(`${K}/sparse/values`,H.componentType,I,u.values.byteOffset,z);let a=0;for(let K=0;K<f.length;K++){let H=f[K]*q;for(let K=0;K<q;K++)h[H++]=G[a++]}return h}))}))}return H._data}_loadFloatAccessorAsync(K,H){return this._loadAccessorAsync(K,H,Float32Array)}_loadIndicesAccessorAsync(K,H){if("SCALAR"!==H.type)throw new Error(`${K}/type: Invalid value ${H.type}`);if(5121!==H.componentType&&5123!==H.componentType&&5125!==H.componentType)throw new Error(`${K}/componentType: Invalid value ${H.componentType}`);if(H._data)return H._data;if(H.sparse){const M=m._GetTypedArrayConstructor(`${K}/componentType`,H.componentType);H._data=this._loadAccessorAsync(K,H,M)}else{const M=U.Get(`${K}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M).then((M=>m._GetTypedArray(K,H.componentType,M,H.byteOffset,H.count)))}return H._data}_loadVertexBufferViewAsync(K){if(K._babylonBuffer)return K._babylonBuffer;const H=this._babylonScene.getEngine();return K._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((K=>new E.c(H,K,!1))),K._babylonBuffer}_loadVertexAccessorAsync(K,H,M){var q;if(null!==(q=H._babylonVertexBuffer)&&void 0!==q&&q[M])return H._babylonVertexBuffer[M];H._babylonVertexBuffer||(H._babylonVertexBuffer={});const w=this._babylonScene.getEngine();if(H.sparse||void 0==H.bufferView)H._babylonVertexBuffer[M]=this._loadFloatAccessorAsync(K,H).then((K=>new E.d(w,K,M,!1)));else{const q=U.Get(`${K}/bufferView`,this._gltf.bufferViews,H.bufferView);H._babylonVertexBuffer[M]=this._loadVertexBufferViewAsync(q).then((u=>{const y=m._GetNumComponents(K,H.type);return new E.d(w,u,M,!1,void 0,q.byteStride,void 0,H.byteOffset,y,H.componentType,H.normalized,!0,void 0,!0)}))}return H._babylonVertexBuffer[M]}_loadMaterialMetallicRoughnessPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return H&&(H.baseColorFactor?(M.albedoColor=u.CH.iH(H.baseColorFactor),M.alpha=H.baseColorFactor[3]):M.albedoColor=u.CH.White(),M.metallic=void 0==H.metallicFactor?1:H.metallicFactor,M.roughness=void 0==H.roughnessFactor?1:H.roughnessFactor,H.baseColorTexture&&q.push(this.loadTextureInfoAsync(`${K}/baseColorTexture`,H.baseColorTexture,(K=>{K.name=`${M.name} (Base Color)`,M.albedoTexture=K}))),H.metallicRoughnessTexture&&(H.metallicRoughnessTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${K}/metallicRoughnessTexture`,H.metallicRoughnessTexture,(K=>{K.name=`${M.name} (Metallic Roughness)`,M.metallicTexture=K}))),M.useMetallnessFromMetallicTextureBlue=!0,M.useRoughnessFromMetallicTextureGreen=!0,M.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(q).then((()=>{}))}_loadMaterialAsync(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const u=this._extensionsLoadMaterialAsync(K,H,M,q,w);if(u)return u;H._data=H._data||{};let y=H._data[q];if(!y){this.logOpen(`${K} ${H.name||""}`);const M=this.createMaterial(K,H,q);y={babylonMaterial:M,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(K,H,M)},H._data[q]=y,m.AddPointerMetadata(M,K),this._parent.onMaterialLoadedObservable.notifyObservers(M),this.logClose()}return M&&(y.babylonMeshes.push(M),M.Hh.addOnce((()=>{const K=y.babylonMeshes.indexOf(M);-1!==K&&y.babylonMeshes.splice(K,1)}))),w(y.babylonMaterial),y.promise.then((()=>y.babylonMaterial))}_createDefaultMaterial(K,H){this._babylonScene._blockEntityCollection=!!this._assetContainer;const M=new C.b(K,this._babylonScene);return M._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,M.fillMode=H,M.enableSpecularAntiAliasing=!0,M.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,M.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,M.transparencyMode=C.b.PBRMATERIAL_OPAQUE,M.metallic=1,M.roughness=1,M}createMaterial(K,H,M){const q=this._extensionsCreateMaterial(K,H,M);if(q)return q;const w=H.name||`material${H.index}`;return this._createDefaultMaterial(w,M)}loadMaterialPropertiesAsync(K,H,M){const q=this._extensionsLoadMaterialPropertiesAsync(K,H,M);if(q)return q;const w=new Array;return w.push(this.loadMaterialBasePropertiesAsync(K,H,M)),H.pbrMetallicRoughness&&w.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${K}/pbrMetallicRoughness`,H.pbrMetallicRoughness,M)),this.loadMaterialAlphaProperties(K,H,M),Promise.all(w).then((()=>{}))}loadMaterialBasePropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return M.emissiveColor=H.emissiveFactor?u.CH.iH(H.emissiveFactor):new u.CH(0,0,0),H.doubleSided&&(M.Oh=!1,M.twoSidedLighting=!0),H.normalTexture&&(H.normalTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${K}/normalTexture`,H.normalTexture,(K=>{K.name=`${M.name} (Normal)`,M.bumpTexture=K}))),M.invertNormalMapX=!this._babylonScene.useRightHandedSystem,M.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=H.normalTexture.scale&&M.bumpTexture&&(M.bumpTexture.level=H.normalTexture.scale),M.forceIrradianceInFragment=!0),H.occlusionTexture&&(H.occlusionTexture.nonColorData=!0,q.push(this.loadTextureInfoAsync(`${K}/occlusionTexture`,H.occlusionTexture,(K=>{K.name=`${M.name} (Occlusion)`,M.ambientTexture=K}))),M.useAmbientInGrayScale=!0,void 0!=H.occlusionTexture.strength&&(M.ambientTextureStrength=H.occlusionTexture.strength)),H.emissiveTexture&&q.push(this.loadTextureInfoAsync(`${K}/emissiveTexture`,H.emissiveTexture,(K=>{K.name=`${M.name} (Emissive)`,M.emissiveTexture=K}))),Promise.all(q).then((()=>{}))}loadMaterialAlphaProperties(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);switch(H.alphaMode||"OPAQUE"){case"OPAQUE":M.transparencyMode=C.b.PBRMATERIAL_OPAQUE,M.alpha=1;break;case"MASK":M.transparencyMode=C.b.PBRMATERIAL_ALPHATEST,M.alphaCutOff=void 0==H.alphaCutoff?.5:H.alphaCutoff,M.albedoTexture&&(M.albedoTexture.Wh=!0);break;case"BLEND":M.transparencyMode=C.b.PBRMATERIAL_ALPHABLEND,M.albedoTexture&&(M.albedoTexture.Wh=!0,M.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${K}/alphaMode: Invalid value (${H.alphaMode})`)}}loadTextureInfoAsync(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadTextureInfoAsync(K,H,M);if(q)return q;if(this.logOpen(`${K}`),H.texCoord>=6)throw new Error(`${K}/texCoord: Invalid value (${H.texCoord})`);const w=U.Get(`${K}/index`,this._gltf.textures,H.index);w._textureInfo=H;const u=this._loadTextureAsync(`/textures/${H.index}`,w,(q=>{q.coordinatesIndex=H.texCoord||0,m.AddPointerMetadata(q,K),this._parent.onTextureLoadedObservable.notifyObservers(q),M(q)}));return this.logClose(),u}_loadTextureAsync(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const q=this._extensionsLoadTextureAsync(K,H,M);if(q)return q;this.logOpen(`${K} ${H.name||""}`);const w=void 0==H.sampler?m.DefaultSampler:U.Get(`${K}/sampler`,this._gltf.samplers,H.sampler),u=U.Get(`${K}/source`,this._gltf.images,H.source),y=this._createTextureAsync(K,w,u,M,void 0,!H._textureInfo.nonColorData);return this.logClose(),y}_createTextureAsync(K,H,M){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},u=arguments.length>4?arguments[4]:void 0,y=arguments.length>5?arguments[5]:void 0;const h=this._loadSampler(`/samplers/${H.index}`,H),W=new Array,I=new q;this._babylonScene._blockEntityCollection=!!this._assetContainer;const f={noMipmap:h.noMipMaps,invertY:!1,samplingMode:h.samplingMode,P:()=>{this._disposed||I.resolve()},onError:(H,M)=>{this._disposed||I.reject(new Error(`${K}: ${M&&M.message?M.message:H||"Failed to load texture"}`))},mimeType:M.mimeType??(0,d.i)(M.uri??""),loaderOptions:u,useSRGBBuffer:!!y&&this._parent.useSRGBBuffers},z=new i.b(null,this._babylonScene,f);return z._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.push(I.promise),W.push(this.loadImageAsync(`/images/${M.index}`,M).then((K=>{const H=M.uri||`${this._fileName}#image${M.index}`,q=`data:${this._uniqueRootUrl}${H}`;z.updateURL(q,K);const w=z.getInternalTexture();w&&(w.label=M.name)}))),z.wrapU=h.wrapU,z.wrapV=h.wrapV,w(z),this._parent.useGltfTextureNames&&(z.name=M.name||M.uri||`image${M.index}`),Promise.all(W).then((()=>z))}_loadSampler(K,H){return H._data||(H._data={noMipMaps:9728===H.minFilter||9729===H.minFilter,samplingMode:m._GetTextureSamplingMode(K,H),wrapU:m._GetTextureWrapMode(`${K}/wrapS`,H.wrapS),wrapV:m._GetTextureWrapMode(`${K}/wrapT`,H.wrapT)}),H._data}loadImageAsync(K,H){if(!H._data){if(this.logOpen(`${K} ${H.name||""}`),H.uri)H._data=this.loadUriAsync(`${K}/uri`,H,H.uri);else{const M=U.Get(`${K}/bufferView`,this._gltf.bufferViews,H.bufferView);H._data=this.loadBufferViewAsync(`/bufferViews/${M.index}`,M)}this.logClose()}return H._data}loadUriAsync(K,H,M){const q=this._extensionsLoadUriAsync(K,H,M);if(q)return q;if(!m._ValidateUri(M))throw new Error(`${K}: '${M}' is invalid`);if((0,d.j)(M)){const H=new Uint8Array((0,d.d)(M));return this.log(`${K}: Decoded ${M.substring(0,64)}... (${H.length} bytes)`),Promise.resolve(H)}return this.log(`${K}: Loading ${M}`),this._parent.preprocessUrlAsync(this._rootUrl+M).then((H=>new Promise(((q,w)=>{this._parent._loadFile(this._babylonScene,H,(H=>{this._disposed||(this.log(`${K}: Loaded ${M} (${H.byteLength} bytes)`),q(new Uint8Array(H)))}),!0,(H=>{w(new d.l(`${K}: Failed to load '${M}'${H?": "+H.status+" "+H.statusText:""}`,H))}))}))))}static AddPointerMetadata(K,H){K.metadata=K.metadata||{};const M=K._internalMetadata=K._internalMetadata||{},q=M.wh=M.wh||{};(q.pointers=q.pointers||[]).push(H)}static _GetTextureWrapMode(K,H){switch(H=void 0==H?10497:H){case 33071:return i.b.CLAMP_ADDRESSMODE;case 33648:return i.b.MIRROR_ADDRESSMODE;case 10497:return i.b.WRAP_ADDRESSMODE;default:return O.e.Warn(`${K}: Invalid value (${H})`),i.b.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(K,H){const M=void 0==H.magFilter?9729:H.magFilter,q=void 0==H.minFilter?9987:H.minFilter;if(9729===M)switch(q){case 9728:return i.b.LINEAR_NEAREST;case 9729:return i.b.LINEAR_LINEAR;case 9984:return i.b.LINEAR_NEAREST_MIPNEAREST;case 9985:return i.b.LINEAR_LINEAR_MIPNEAREST;case 9986:return i.b.LINEAR_NEAREST_MIPLINEAR;case 9987:return i.b.LINEAR_LINEAR_MIPLINEAR;default:return O.e.Warn(`${K}/minFilter: Invalid value (${q})`),i.b.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==M&&O.e.Warn(`${K}/magFilter: Invalid value (${M})`),q){case 9728:return i.b.NEAREST_NEAREST;case 9729:return i.b.NEAREST_LINEAR;case 9984:return i.b.NEAREST_NEAREST_MIPNEAREST;case 9985:return i.b.NEAREST_LINEAR_MIPNEAREST;case 9986:return i.b.NEAREST_NEAREST_MIPLINEAR;case 9987:return i.b.NEAREST_LINEAR_MIPLINEAR;default:return O.e.Warn(`${K}/minFilter: Invalid value (${q})`),i.b.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(K,H){try{return(0,t.m)(H)}catch(M){throw new Error(`${K}: ${M.message}`)}}static _GetTypedArray(K,H,M,q,w){const u=M.buffer;q=M.byteOffset+(q||0);const y=m._GetTypedArrayConstructor(`${K}/componentType`,H),h=E.d.GetTypeByteLength(H);return q%h!==0?(O.e.Warn(`${K}: Copying buffer as byte offset (${q}) is not a multiple of component type byte length (${h})`),new y(u.slice(q,q+w*h),0)):new y(u,q,w)}static _GetNumComponents(K,H){switch(H){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${K}: Invalid type (${H})`)}static _ValidateUri(K){return y.Tools.IsBase64(K)||-1===K.indexOf("..")}static _GetDrawMode(K,H){switch(void 0==H&&(H=4),H){case 0:return B.c.PointListDrawMode;case 1:return B.c.LineListDrawMode;case 2:return B.c.LineLoopDrawMode;case 3:return B.c.LineStripDrawMode;case 4:return B.c.TriangleFillMode;case 5:return B.c.TriangleStripDrawMode;case 6:return B.c.TriangleFanDrawMode}throw new Error(`${K}: Invalid mesh primitive mode (${H})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const K=new Array;if(this._gltf.materials)for(const H of this._gltf.materials)if(H._data)for(const M in H._data){const q=H._data[M];for(const H of q.babylonMeshes){H.zh(!0);const M=q.babylonMaterial;K.push(M.forceCompilationAsync(H)),K.push(M.forceCompilationAsync(H,{useInstances:!0})),this._parent.useClipPlane&&(K.push(M.forceCompilationAsync(H,{clipPlane:!0})),K.push(M.forceCompilationAsync(H,{clipPlane:!0,useInstances:!0})))}}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const K=new Array,H=this._babylonScene.lights;for(const M of H){const H=M.getShadowGenerator();H&&K.push(H.forceCompilationAsync())}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(K){for(const H of this._extensions)H.enabled&&K(H)}_applyExtensions(K,H,M){for(const q of this._extensions)if(q.enabled){const w=`${q.name}.${H}`,u=K;u._activeLoaderExtensionFunctions=u._activeLoaderExtensionFunctions||{};const y=u._activeLoaderExtensionFunctions;if(!y[w]){y[w]=!0;try{const K=M(q);if(K)return K}finally{delete y[w]}}}return null}_extensionsOnLoading(){this._forEachExtensions((K=>K.onLoading&&K.onLoading()))}_extensionsOnReady(){this._forEachExtensions((K=>K.onReady&&K.onReady()))}_extensionsLoadSceneAsync(K,H){return this._applyExtensions(H,"loadScene",(M=>M.loadSceneAsync&&M.loadSceneAsync(K,H)))}_extensionsLoadNodeAsync(K,H,M){return this._applyExtensions(H,"loadNode",(q=>q.loadNodeAsync&&q.loadNodeAsync(K,H,M)))}_extensionsLoadCameraAsync(K,H,M){return this._applyExtensions(H,"loadCamera",(q=>q.loadCameraAsync&&q.loadCameraAsync(K,H,M)))}_extensionsLoadVertexDataAsync(K,H,M){return this._applyExtensions(H,"loadVertexData",(q=>q._loadVertexDataAsync&&q._loadVertexDataAsync(K,H,M)))}_extensionsLoadMeshPrimitiveAsync(K,H,M,q,w,u){return this._applyExtensions(w,"loadMeshPrimitive",(y=>y._loadMeshPrimitiveAsync&&y._loadMeshPrimitiveAsync(K,H,M,q,w,u)))}_extensionsLoadMaterialAsync(K,H,M,q,w){return this._applyExtensions(H,"loadMaterial",(u=>u._loadMaterialAsync&&u._loadMaterialAsync(K,H,M,q,w)))}_extensionsCreateMaterial(K,H,M){return this._applyExtensions(H,"createMaterial",(q=>q.createMaterial&&q.createMaterial(K,H,M)))}_extensionsLoadMaterialPropertiesAsync(K,H,M){return this._applyExtensions(H,"loadMaterialProperties",(q=>q.loadMaterialPropertiesAsync&&q.loadMaterialPropertiesAsync(K,H,M)))}_extensionsLoadTextureInfoAsync(K,H,M){return this._applyExtensions(H,"loadTextureInfo",(q=>q.loadTextureInfoAsync&&q.loadTextureInfoAsync(K,H,M)))}_extensionsLoadTextureAsync(K,H,M){return this._applyExtensions(H,"loadTexture",(q=>q._loadTextureAsync&&q._loadTextureAsync(K,H,M)))}_extensionsLoadAnimationAsync(K,H){return this._applyExtensions(H,"loadAnimation",(M=>M.loadAnimationAsync&&M.loadAnimationAsync(K,H)))}_extensionsLoadAnimationChannelAsync(K,H,M,q,w){return this._applyExtensions(M,"loadAnimationChannel",(u=>u._loadAnimationChannelAsync&&u._loadAnimationChannelAsync(K,H,M,q,w)))}_extensionsLoadSkinAsync(K,H,M){return this._applyExtensions(M,"loadSkin",(q=>q._loadSkinAsync&&q._loadSkinAsync(K,H,M)))}_extensionsLoadUriAsync(K,H,M){return this._applyExtensions(H,"loadUri",(q=>q._loadUriAsync&&q._loadUriAsync(K,H,M)))}_extensionsLoadBufferViewAsync(K,H){return this._applyExtensions(H,"loadBufferView",(M=>M.loadBufferViewAsync&&M.loadBufferViewAsync(K,H)))}_extensionsLoadBufferAsync(K,H,M,q){return this._applyExtensions(H,"loadBuffer",(w=>w.loadBufferAsync&&w.loadBufferAsync(K,H,M,q)))}static LoadExtensionAsync(K,H,M,q){if(!H.extensions)return null;const w=H.extensions[M];return w?q(`${K}/extensions/${M}`,w):null}static LoadExtraAsync(K,H,M,q){if(!H.extras)return null;const w=H.extras[M];return w?q(`${K}/extras/${M}`,w):null}isExtensionUsed(K){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(K)}logOpen(K){this._parent._logOpen(K)}logClose(){this._parent._logClose()}log(K){this._parent._log(K)}startPerformanceCounter(K){this._parent._startPerformanceCounter(K)}endPerformanceCounter(K){this._parent._endPerformanceCounter(K)}}m.DefaultSampler={index:-1},T.c._CreateGLTF2Loader=K=>new m(K);var F=M(12942),Y=M(11472),r=M(11325),e=M(12949),b=M(12958);class P extends b.b{constructor(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",K),this._texture=K.getEngine().createRawCubeTexture(H,M,q,w,u,y,h,W)}update(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,K,H,M,q,w)}updateRGBDAsync(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,e.k)(this._texture,K,H,M,q).then((()=>{}))}clone(){return r.c.Clone((()=>{const K=this.sK(),H=this._texture,M=new P(K,H._bufferViewArray,H.width,H.format,H.type,H.generateMipMaps,H.invertY,H.samplingMode,H._compression);return 13===H.source&&M.updateRGBDAsync(H._bufferViewArrayArray,H._sphericalPolynomial,H._lodGenerationScale,H._lodGenerationOffset),M}),this)}}const g="EXT_lights_image_based";class X{constructor(K){this.name=g,this._loader=K,this.enabled=this._loader.isExtensionUsed(g)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.wh.extensions;if(K&&K[this.name]){const H=K[this.name];this._lights=H.lights}}loadSceneAsync(K,H){return m.LoadExtensionAsync(K,H,this.name,(async(M,q)=>{this._loader._allMaterialsDirtyRequired=!0;const w=new Array;w.push(this._loader.loadSceneAsync(K,H)),this._loader.logOpen(`${M}`);const u=U.Get(`${M}/light`,this._lights,q.eq);return w.push(this._loadLightAsync(`/extensions/${this.name}/lights/${q.eq}`,u).then((K=>{this._loader.babylonScene.environmentTexture=K}))),this._loader.logClose(),await Promise.all(w).then((()=>{}))}))}_loadLightAsync(K,H){if(!H._loaded){const M=new Array;this._loader.logOpen(`${K}`);const q=new Array(H.specularImages.length);for(let w=0;w<H.specularImages.length;w++){const u=H.specularImages[w];q[w]=new Array(u.length);for(let H=0;H<u.length;H++){const y=`${K}/specularImages/${w}/${H}`;this._loader.logOpen(`${y}`);const h=u[H],W=U.Get(y,this._loader.wh.images,h);M.push(this._loader.loadImageAsync(`/images/${h}`,W).then((K=>{q[w][H]=K}))),this._loader.logClose()}}this._loader.logClose(),H._loaded=Promise.all(M).then((async()=>{const M=new P(this._loader.babylonScene,null,H.specularImageSize);if(M.name=H.name||"environment",H._babylonTexture=M,void 0!=H.Eh&&(M.level=H.Eh),H.rotation){let K=w.Quaternion.iH(H.rotation);this._loader.babylonScene.useRightHandedSystem||(K=w.Quaternion.Inverse(K)),w.Matrix.FromQuaternionToRef(K,M.getReflectionTextureMatrix())}if(!H.irradianceCoefficients)throw new Error(`${K}: Irradiance coefficients are missing`);const u=Y.d.iH(H.irradianceCoefficients);u.scaleInPlace(H.Eh),u.convertIrradianceToLambertianRadiance();const y=Y.e.FromHarmonics(u),h=(q.length-1)/Math.log2(H.specularImageSize);return await M.updateRGBDAsync(q,y,h)}))}return H._loaded.then((()=>H._babylonTexture))}}p(g),N(g,!0,(K=>new X(K)));M(11855);const A="EXT_mesh_gpu_instancing";class KK{constructor(K){this.name=A,this._loader=K,this.enabled=this._loader.isExtensionUsed(A)}dispose(){this._loader=null}loadNodeAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(K,q)=>{this._loader._disableInstancedMesh++;const u=this._loader.loadNodeAsync(`/nodes/${H.index}`,H,M);if(this._loader._disableInstancedMesh--,!H._primitiveBabylonMeshes)return await u;const y=new Array;let h=0;const W=H=>{if(void 0==q.attributes[H])return void y.push(Promise.resolve(null));const M=U.Get(`${K}/attributes/${H}`,this._loader.wh.accessors,q.attributes[H]);if(y.push(this._loader._loadFloatAccessorAsync(`/accessors/${M.bufferView}`,M)),0===h)h=M.count;else if(h!==M.count)throw new Error(`${K}/attributes: Instance buffer accessors do not have the same count.`)};return W("TRANSLATION"),W("ROTATION"),W("SCALE"),await u.then((async K=>{const[M,q,u]=await Promise.all(y),W=new Float32Array(16*h);w.TmpVectors.OH[0].Lh(0,0,0),w.TmpVectors.Quaternion[0].Lh(0,0,0,1),w.TmpVectors.OH[1].Lh(1,1,1);for(let H=0;H<h;++H)M&&w.OH.FromArrayToRef(M,3*H,w.TmpVectors.OH[0]),q&&w.Quaternion.FromArrayToRef(q,4*H,w.TmpVectors.Quaternion[0]),u&&w.OH.FromArrayToRef(u,3*H,w.TmpVectors.OH[1]),w.Matrix.ComposeToRef(w.TmpVectors.OH[1],w.TmpVectors.Quaternion[0],w.TmpVectors.OH[0],w.TmpVectors.Matrix[0]),w.TmpVectors.Matrix[0].copyToArray(W,16*H);for(const w of H._primitiveBabylonMeshes)w.tz("matrix",W,16,!0);return K}))}))}}p(A),N(A,!0,(K=>new KK(K)));let HK=0,MK=null;class qK{static get Default(){return qK._Default||(qK._Default=new qK),qK._Default}constructor(){const K=qK.Configuration.decoder;this._decoderModulePromise=y.Tools.LoadBabylonScriptAsync(K.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}async decodeGltfBufferAsync(K,H,M,q,w){await this._decoderModulePromise,0===HK&&(MeshoptDecoder.useWorkers(1),HK=1);const u=await MeshoptDecoder.decodeGltfBufferAsync(H,M,K,q,w);return null!==MK&&clearTimeout(MK),MK=setTimeout((()=>{MeshoptDecoder.useWorkers(0),HK=0,MK=null}),1e3),u}}qK.Configuration={decoder:{url:`${y.Tools._DefaultCdnUrl}/meshopt_decoder.js`}},qK._Default=null;const wK="EXT_meshopt_compression";class uK{constructor(K){this.name=wK,this.enabled=K.isExtensionUsed(wK),this._loader=K}dispose(){this._loader=null}loadBufferViewAsync(K,H){return m.LoadExtensionAsync(K,H,this.name,(async(M,q)=>{const w=H;if(w._meshOptData)return await w._meshOptData;const u=U.Get(`${K}/buffer`,this._loader.wh.buffers,q.buffer);return w._meshOptData=this._loader.loadBufferAsync(`/buffers/${u.index}`,u,q.byteOffset||0,q.byteLength).then((async K=>await qK.Default.decodeGltfBufferAsync(K,q.count,q.byteStride,q.mode,q.filter))),await w._meshOptData}))}}p(wK),N(wK,!0,(K=>new uK(K)));const yK="EXT_texture_webp";class hK{constructor(K){this.name=yK,this._loader=K,this.enabled=K.isExtensionUsed(yK)}dispose(){this._loader=null}_loadTextureAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=void 0==H.sampler?m.DefaultSampler:U.Get(`${K}/sampler`,this._loader.wh.samplers,H.sampler),y=U.Get(`${q}/source`,this._loader.wh.images,w.source);return await this._loader._createTextureAsync(K,u,y,(K=>{M(K)}),void 0,!H._textureInfo.nonColorData)}))}}p(yK),N(yK,!0,(K=>new hK(K)));const WK="EXT_texture_avif";class IK{constructor(K){this.name=WK,this._loader=K,this.enabled=K.isExtensionUsed(WK)}dispose(){this._loader=null}_loadTextureAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=void 0==H.sampler?m.DefaultSampler:U.Get(`${K}/sampler`,this._loader.wh.samplers,H.sampler),y=U.Get(`${q}/source`,this._loader.wh.images,w.source);return await this._loader._createTextureAsync(K,u,y,(K=>{M(K)}),void 0,!H._textureInfo.nonColorData)}))}}p(WK),N(WK,!0,(K=>new IK(K)));var fK=M(12937),zK=M(11824);const GK="EXT_lights_ies";class aK{constructor(K){this.name=GK,this._loader=K,this.enabled=this._loader.isExtensionUsed(GK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.wh.extensions;if(K&&K[this.name]){const H=K[this.name];this._lights=H.lights,U.Assign(this._lights)}}loadNodeAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,y)=>{let h,W;this._loader._allMaterialsDirtyRequired=!0;const I=await this._loader.loadNodeAsync(K,H,(K=>{W=U.Get(q,this._lights,y.eq);const H=W.name||K.name;this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,h=new fK.d(H,w.OH.Zero(),w.OH.Backward(),0,1,this._loader.babylonScene),h.angle=Math.PI/2,h.innerAngle=0,h._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,W._babylonLight=h,h.falloffType=zK.e.FALLOFF_GLTF,h.sh=y.color?u.CH.iH(y.color):u.CH.White(),h.Eh=y.multiplier||1,h.range=Number.MAX_VALUE,h.parent=K,this._loader._babylonLights.push(h),m.AddPointerMetadata(h,q),M(K)}));let f;if(W.uri)f=await this._loader.loadUriAsync(K,W,W.uri);else{const H=U.Get(`${K}/bufferView`,this._loader.wh.bufferViews,W.bufferView);f=await this._loader.loadBufferViewAsync(`/bufferViews/${H.index}`,H)}return h.iesProfileTexture=new i.b(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,f,!0,void 0,void 0,void 0,void 0,".ies"),I}))}}p(GK),N(GK,!0,(K=>new aK(K)));var vK=M(12972);const OK="KHR_draco_mesh_compression";class LK{constructor(K){this.name=OK,this.useNormalizedFlagFromAccessor=!0,this._loader=K,this.enabled=vK.e.DefaultAvailable&&this._loader.isExtensionUsed(OK)}dispose(){delete this.dracoDecoder,this._loader=null}_loadVertexDataAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{if(void 0!=H.mode&&4!==H.mode&&5!==H.mode)throw new Error(`${K}: Unsupported mode ${H.mode}`);const u={},y={},h=(K,q)=>{const h=w.attributes[K];if(void 0!=h&&(M._delayInfo=M._delayInfo||[],-1===M._delayInfo.indexOf(q)&&M._delayInfo.push(q),u[q]=h,this.useNormalizedFlagFromAccessor)){const M=U.TryGet(this._loader.wh.accessors,H.attributes[K]);M&&(y[q]=M.normalized||!1)}};h("POSITION",E.d.PositionKind),h("NORMAL",E.d.NormalKind),h("TANGENT",E.d.TangentKind),h("TEXCOORD_0",E.d.UVKind),h("TEXCOORD_1",E.d.UV2Kind),h("TEXCOORD_2",E.d.UV3Kind),h("TEXCOORD_3",E.d.UV4Kind),h("TEXCOORD_4",E.d.UV5Kind),h("TEXCOORD_5",E.d.UV6Kind),h("JOINTS_0",E.d.MatricesIndicesKind),h("WEIGHTS_0",E.d.MatricesWeightsKind),h("COLOR_0",E.d.ColorKind);const W=U.Get(q,this._loader.wh.bufferViews,w.bufferView);return W._dracoBabylonGeometry||(W._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((async q=>{const w=this.dracoDecoder||vK.e.Default,h=U.TryGet(this._loader.wh.accessors,H.attributes.POSITION),W=this._loader.parent.alwaysComputeBoundingBox||M.skeleton||!h?null:j(h);return await w._decodeMeshToGeometryForGltfAsync(M.name,this._loader.babylonScene,q,u,y,W).catch((H=>{throw new Error(`${K}: ${H.message}`)}))}))),await W._dracoBabylonGeometry}))}}p(OK),N(OK,!0,(K=>new LK(K)));var SK=M(12979),BK=M(11274),CK=M(11280),iK=M(11704),ZK=M(11898),EK=M(11242);iK.d.AddNodeConstructor("Light_Type_0",((K,H)=>()=>new lK(K,w.OH.Zero(),H)));class lK extends ZK.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(K){this._shadowAngle=K,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(K){const H=this.needCube();if(this._direction=K,this.needCube()!==H&&this._shadowGenerators){const K=this._shadowGenerators.values();for(let H=K.next();!0!==H.done;H=K.next()){H.value.recreateShadowMap()}}}constructor(K,H,M){super(K,M),this._shadowAngle=Math.PI/2,this.position=H}getClassName(){return"PointLight"}getTypeID(){return zK.e.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(K){if(this.direction)return super.getShadowDirection(K);switch(K){case 0:return new w.OH(1,0,0);case 1:return new w.OH(-1,0,0);case 2:return new w.OH(0,-1,0);case 3:return new w.OH(0,1,0);case 4:return new w.OH(0,0,1);case 5:return new w.OH(0,0,-1)}return w.OH.Zero()}_setDefaultShadowProjectionMatrix(K,H,M){const q=this.sK().activeCamera;if(!q)return;const u=void 0!==this.shadowMinZ?this.shadowMinZ:q.Ih,y=void 0!==this.shadowMaxZ?this.shadowMaxZ:q.maxZ,h=this.sK().getEngine().useReverseDepthBuffer;w.Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,h?y:u,h?u:y,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,h)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,H){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,H):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,H),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,H),this}transferToNodeMaterialEffect(K,H){return this.computeTransformedInformation()?K.setFloat3(H,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):K.setFloat3(H,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(K,H){K["POINTLIGHT"+H]=!0}}(0,BK.e)([(0,CK.J)()],lK.prototype,"shadowAngle",null),(0,EK.f)("BABYLON.PointLight",lK);const sK="KHR_lights_punctual";class DK{constructor(K){this.name=sK,this._loader=K,this.enabled=this._loader.isExtensionUsed(sK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.wh.extensions;if(K&&K[this.name]){const H=K[this.name];this._lights=H.lights,U.Assign(this._lights)}}loadNodeAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,y)=>(this._loader._allMaterialsDirtyRequired=!0,await this._loader.loadNodeAsync(K,H,(K=>{let H;const h=U.Get(q,this._lights,y.eq),W=h.name||K.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,h.type){case"directional":{const K=new SK.b(W,w.OH.Backward(),this._loader.babylonScene);K.position.Bh(0),H=K;break}case"point":H=new lK(W,w.OH.Zero(),this._loader.babylonScene);break;case"spot":{const K=new fK.d(W,w.OH.Zero(),w.OH.Backward(),0,1,this._loader.babylonScene);K.angle=2*(h.spot&&h.spot.outerConeAngle||Math.PI/4),K.innerAngle=2*(h.spot&&h.spot.innerConeAngle||0),H=K;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${q}: Invalid light type (${h.type})`)}H._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,h._babylonLight=H,H.falloffType=zK.e.FALLOFF_GLTF,H.sh=h.color?u.CH.iH(h.color):u.CH.White(),H.Eh=void 0==h.Eh?1:h.Eh,H.range=void 0==h.range?Number.MAX_VALUE:h.range,H.parent=K,this._loader._babylonLights.push(H),m.AddPointerMetadata(H,q),M(K)})))))}}p(sK),N(sK,!0,(K=>new DK(K)));const VK="KHR_materials_pbrSpecularGlossiness";class nK{constructor(K){this.name=VK,this.order=200,this._loader=K,this.enabled=this._loader.isExtensionUsed(VK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialBasePropertiesAsync(K,H,M)),u.push(this._loadSpecularGlossinessPropertiesAsync(q,w,M)),this._loader.loadMaterialAlphaProperties(K,H,M),await Promise.all(u).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return M.metallic=null,M.roughness=null,H.diffuseFactor?(M.albedoColor=u.CH.iH(H.diffuseFactor),M.alpha=H.diffuseFactor[3]):M.albedoColor=u.CH.White(),M.reflectivityColor=H.specularFactor?u.CH.iH(H.specularFactor):u.CH.White(),M.microSurface=void 0==H.glossinessFactor?1:H.glossinessFactor,H.diffuseTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTexture`,H.diffuseTexture,(K=>{K.name=`${M.name} (Diffuse)`,M.albedoTexture=K}))),H.specularGlossinessTexture&&(q.push(this._loader.loadTextureInfoAsync(`${K}/specularGlossinessTexture`,H.specularGlossinessTexture,(K=>{K.name=`${M.name} (Specular Glossiness)`,M.reflectivityTexture=K,M.reflectivityTexture.Wh=!0}))),M.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(q).then((()=>{}))}}p(VK),N(VK,!0,(K=>new nK(K)));const cK="KHR_materials_unlit";class kK{constructor(K){this.name=cK,this.order=210,this._loader=K,this.enabled=this._loader.isExtensionUsed(cK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async()=>await this._loadUnlitPropertiesAsync(K,H,M)))}_loadUnlitPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;M.unlit=!0;const w=H.pbrMetallicRoughness;return w&&(w.baseColorFactor?(M.albedoColor=u.CH.iH(w.baseColorFactor),M.alpha=w.baseColorFactor[3]):M.albedoColor=u.CH.White(),w.baseColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/baseColorTexture`,w.baseColorTexture,(K=>{K.name=`${M.name} (Base Color)`,M.albedoTexture=K})))),H.doubleSided&&(M.Oh=!1,M.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(K,H,M),Promise.all(q).then((()=>{}))}}p(cK),N(cK,!0,(K=>new kK(K)));const TK="KHR_materials_clearcoat";class dK{constructor(K){this.name=TK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(TK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadClearCoatPropertiesAsync(q,w,M)),await Promise.all(u)}))}_loadClearCoatPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return M.clearCoat.isEnabled=!0,M.clearCoat.useRoughnessFromMainTexture=!1,M.clearCoat.remapF0OnInterfaceChange=!1,void 0!=H.clearcoatFactor?M.clearCoat.Eh=H.clearcoatFactor:M.clearCoat.Eh=0,H.clearcoatTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatTexture`,H.clearcoatTexture,(K=>{K.name=`${M.name} (ClearCoat)`,M.clearCoat.texture=K}))),void 0!=H.clearcoatRoughnessFactor?M.clearCoat.roughness=H.clearcoatRoughnessFactor:M.clearCoat.roughness=0,H.clearcoatRoughnessTexture&&(H.clearcoatRoughnessTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatRoughnessTexture`,H.clearcoatRoughnessTexture,(K=>{K.name=`${M.name} (ClearCoat Roughness)`,M.clearCoat.textureRoughness=K})))),H.clearcoatNormalTexture&&(H.clearcoatNormalTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatNormalTexture`,H.clearcoatNormalTexture,(K=>{K.name=`${M.name} (ClearCoat Normal)`,M.clearCoat.bumpTexture=K}))),M.invertNormalMapX=!M.sK().useRightHandedSystem,M.invertNormalMapY=M.sK().useRightHandedSystem,void 0!=H.clearcoatNormalTexture.scale&&(M.clearCoat.bumpTexture.level=H.clearcoatNormalTexture.scale)),Promise.all(q).then((()=>{}))}}p(TK),N(TK,!0,(K=>new dK(K)));const xK="KHR_materials_iridescence";class QK{constructor(K){this.name=xK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(xK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadIridescencePropertiesAsync(q,w,M)),await Promise.all(u).then((()=>{}))}))}_loadIridescencePropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return M.iridescence.isEnabled=!0,M.iridescence.Eh=H.iridescenceFactor??0,M.iridescence.indexOfRefraction=H.iridescenceIor??H.iridescenceIOR??1.3,M.iridescence.minimumThickness=H.iridescenceThicknessMinimum??100,M.iridescence.maximumThickness=H.iridescenceThicknessMaximum??400,H.iridescenceTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceTexture`,H.iridescenceTexture,(K=>{K.name=`${M.name} (Iridescence)`,M.iridescence.texture=K}))),H.iridescenceThicknessTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceThicknessTexture`,H.iridescenceThicknessTexture,(K=>{K.name=`${M.name} (Iridescence Thickness)`,M.iridescence.thicknessTexture=K}))),Promise.all(q).then((()=>{}))}}p(xK),N(xK,!0,(K=>new QK(K)));const JK="KHR_materials_anisotropy";class NK{constructor(K){this.name=JK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(JK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadIridescencePropertiesAsync(q,w,M)),await Promise.all(u)}))}async _loadIridescencePropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;M.anisotropy.isEnabled=!0,M.anisotropy.Eh=H.anisotropyStrength??0,M.anisotropy.angle=H.anisotropyRotation??0,H.anisotropyTexture&&(H.anisotropyTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${K}/anisotropyTexture`,H.anisotropyTexture,(K=>{K.name=`${M.name} (Anisotropy Intensity)`,M.anisotropy.texture=K})))),await Promise.all(q)}}p(JK),N(JK,!0,(K=>new NK(K)));const pK="KHR_materials_emissive_strength";class oK{constructor(K){this.name=pK,this.order=170,this._loader=K,this.enabled=this._loader.isExtensionUsed(pK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>await this._loader.loadMaterialPropertiesAsync(K,H,M).then((()=>{this._loadEmissiveProperties(q,w,M)}))))}_loadEmissiveProperties(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);void 0!==H.emissiveStrength&&(M.emissiveIntensity=H.emissiveStrength)}}p(pK),N(pK,!0,(K=>new oK(K)));const RK="KHR_materials_sheen";class tK{constructor(K){this.name=RK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(RK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadSheenPropertiesAsync(q,w,M)),await Promise.all(u).then((()=>{}))}))}_loadSheenPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return M.sheen.isEnabled=!0,M.sheen.Eh=1,void 0!=H.sheenColorFactor?M.sheen.color=u.CH.iH(H.sheenColorFactor):M.sheen.color=u.CH.Black(),H.sheenColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/sheenColorTexture`,H.sheenColorTexture,(K=>{K.name=`${M.name} (Sheen Color)`,M.sheen.texture=K}))),void 0!==H.sheenRoughnessFactor?M.sheen.roughness=H.sheenRoughnessFactor:M.sheen.roughness=0,H.sheenRoughnessTexture&&(H.sheenRoughnessTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${K}/sheenRoughnessTexture`,H.sheenRoughnessTexture,(K=>{K.name=`${M.name} (Sheen Roughness)`,M.sheen.textureRoughness=K})))),M.sheen.albedoScaling=!0,M.sheen.useRoughnessFromMainTexture=!1,Promise.all(q).then((()=>{}))}}p(RK),N(RK,!0,(K=>new tK(K)));var UK=M(11765);const jK="KHR_materials_specular";class mK{constructor(K){this.name=jK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(jK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;if(u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadSpecularPropertiesAsync(q,w,M)),w.extensions&&w.extensions.EXT_materials_specular_edge_color&&M instanceof C.b){w.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(M.brdf.dielectricSpecularModel=UK.d.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,M.brdf.conductorSpecularModel=UK.d.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR)}return await Promise.all(u).then((()=>{}))}))}_loadSpecularPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return void 0!==H.specularFactor&&(M.metallicF0Factor=H.specularFactor),void 0!==H.specularColorFactor&&(M.metallicReflectanceColor=u.CH.iH(H.specularColorFactor)),H.specularTexture&&(H.specularTexture.nonColorData=!0,q.push(this._loader.loadTextureInfoAsync(`${K}/specularTexture`,H.specularTexture,(K=>{K.name=`${M.name} (Specular)`,M.metallicReflectanceTexture=K,M.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),H.specularColorTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/specularColorTexture`,H.specularColorTexture,(K=>{K.name=`${M.name} (Specular Color)`,M.reflectanceTexture=K}))),Promise.all(q).then((()=>{}))}}p(jK),N(jK,!0,(K=>new mK(K)));const FK="KHR_materials_ior";class YK{constructor(K){this.name=FK,this.order=180,this._loader=K,this.enabled=this._loader.isExtensionUsed(FK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadIorPropertiesAsync(q,w,M)),await Promise.all(u).then((()=>{}))}))}_loadIorPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);return void 0!==H.ior?M.indexOfRefraction=H.ior:M.indexOfRefraction=YK._DEFAULT_IOR,Promise.resolve()}}YK._DEFAULT_IOR=1.5,p(FK),N(FK,!0,(K=>new YK(K)));const rK="KHR_materials_variants";class eK{constructor(K){this.name=rK,this._loader=K,this.enabled=this._loader.isExtensionUsed(rK)}dispose(){this._loader=null}static GetAvailableVariants(K){const H=this._GetExtensionMetadata(K);return H?Object.keys(H.variants):[]}getAvailableVariants(K){return eK.GetAvailableVariants(K)}static SelectVariant(K,H){const M=this._GetExtensionMetadata(K);if(!M)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${rK} extension`);const q=K=>{const H=M.variants[K];if(H)for(const M of H)M.mesh.material=M.material};if(H instanceof Array)for(const w of H)q(w);else q(H);M.lastSelected=H}selectVariant(K,H){eK.SelectVariant(K,H)}static Reset(K){const H=this._GetExtensionMetadata(K);if(!H)throw new Error(`Cannot reset on a glTF mesh that does not have the ${rK} extension`);for(const M of H.original)M.mesh.material=M.material;H.lastSelected=null}reset(K){eK.Reset(K)}static GetLastSelectedVariant(K){const H=this._GetExtensionMetadata(K);if(!H)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${rK} extension`);return H.lastSelected}getLastSelectedVariant(K){return eK.GetLastSelectedVariant(K)}static _GetExtensionMetadata(K){var H,M;return(null===K||void 0===K||null===(H=K._internalMetadata)||void 0===H||null===(M=H.wh)||void 0===M?void 0:M[rK])||null}onLoading(){const K=this._loader.wh.extensions;if(K&&K[this.name]){const H=K[this.name];this._variants=H.variants}}onReady(){const K=this._loader.rootBabylonMesh;if(K){var H;const M=this._loader.parent.extensionOptions[rK];null!==M&&void 0!==M&&M.defaultVariant&&eK.SelectVariant(K,M.defaultVariant),null===M||void 0===M||null===(H=M.onLoaded)||void 0===H||H.call(M,{get variants(){return eK.GetAvailableVariants(K)},get selectedVariant(){const H=eK.GetLastSelectedVariant(K);return H?Array.isArray(H)?H[0]:H:eK.GetAvailableVariants(K)[0]},set selectedVariant(H){eK.SelectVariant(K,H)}})}}_loadMeshPrimitiveAsync(K,H,M,q,w,u){return m.LoadExtensionAsync(K,w,this.name,(async(y,h)=>{const W=new Array;return W.push(this._loader._loadMeshPrimitiveAsync(K,H,M,q,w,(H=>{if(u(H),H instanceof D.b){const M=m._GetDrawMode(K,w.mode),q=this._loader.rootBabylonMesh,u=q?q._internalMetadata=q._internalMetadata||{}:{},I=u.wh=u.wh||{},f=I[rK]=I[rK]||{lastSelected:null,original:[],variants:{}};f.original.push({mesh:H,material:H.material});for(let K=0;K<h.mappings.length;++K){const w=h.mappings[K],u=U.Get(`${y}/mappings/${K}/material`,this._loader.wh.materials,w.material);W.push(this._loader._loadMaterialAsync(`#/materials/${w.material}`,u,H,M,(K=>{for(let M=0;M<w.variants.length;++M){const u=w.variants[M],y=U.Get(`/extensions/${rK}/variants/${u}`,this._variants,u);f.variants[y.name]=f.variants[y.name]||[],f.variants[y.name].push({mesh:H,material:K}),H.onClonedObservable.add((K=>{const M=K;let w=null,u=M;do{if(u=u.parent,!u)return;w=eK._GetExtensionMetadata(u)}while(null===w);if(q&&w===eK._GetExtensionMetadata(q)){u._internalMetadata={};for(const K in q._internalMetadata)u._internalMetadata[K]=q._internalMetadata[K];u._internalMetadata.wh=[];for(const K in q._internalMetadata.wh)u._internalMetadata.wh[K]=q._internalMetadata.wh[K];u._internalMetadata.wh[rK]={lastSelected:null,original:[],variants:{}};for(const K of w.original)u._internalMetadata.wh[rK].original.push({mesh:K.mesh,material:K.material});for(const K in w.variants)if(Object.prototype.hasOwnProperty.call(w.variants,K)){u._internalMetadata.wh[rK].variants[K]=[];for(const H of w.variants[K])u._internalMetadata.wh[rK].variants[K].push({mesh:H.mesh,material:H.material})}w=u._internalMetadata.wh[rK]}for(const q of w.original)q.mesh===H&&(q.mesh=M);for(const q of w.variants[y.name])q.mesh===H&&(q.mesh=M)}))}})))}}}))),await Promise.all(W).then((K=>{let[H]=K;return H}))}))}}p(rK),N(rK,!0,(K=>new eK(K)));var bK=M(11349);class PK{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:UK.d.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(K,H){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...PK._GetDefaultOptions(),...K},this._scene=H,this._scene._transmissionHelper=this,this.onErrorObservable=new f.d,this._scene.Hh.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(K){if(!Object.keys(K).filter((H=>this._options[H]!==K[H])).length)return;const H={...this._options,...K},M=this._options;this._options=H,H.renderSize===M.renderSize&&H.renderTargetTextureType===M.renderTargetTextureType&&H.generateMipmaps===M.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=H.samples,this._opaqueRenderTarget.lodGenerationScale=H.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=H.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(K){return!!K&&!!(K instanceof C.b&&K.subSurface.isRefractionEnabled)}_addMesh(K){this._materialObservers[K.uniqueId]=K.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),y.Tools.SetImmediate((()=>{this._shouldRenderAsTransmission(K.material)?(K.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(K)&&this._transparentMeshesCache.push(K)):-1===this._opaqueMeshesCache.indexOf(K)&&this._opaqueMeshesCache.push(K)}))}_removeMesh(K){K.onMaterialChangedObservable.remove(this._materialObservers[K.uniqueId]),delete this._materialObservers[K.uniqueId];let H=this._transparentMeshesCache.indexOf(K);-1!==H&&this._transparentMeshesCache.splice(H,1),H=this._opaqueMeshesCache.indexOf(K),-1!==H&&this._opaqueMeshesCache.splice(H,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(K){const H=this._transparentMeshesCache.indexOf(K),M=this._opaqueMeshesCache.indexOf(K);this._shouldRenderAsTransmission(K.material)?(K.material instanceof C.b&&(K.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==M?(this._opaqueMeshesCache.splice(M,1),this._transparentMeshesCache.push(K)):-1===H&&this._transparentMeshesCache.push(K)):-1!==H?(this._transparentMeshesCache.splice(H,1),this._opaqueMeshesCache.push(K)):-1===M&&this._opaqueMeshesCache.push(K)}_isRenderTargetValid(){var K;return null!==(null===(K=this._opaqueRenderTarget)||void 0===K?void 0:K.getInternalTexture())}_setupRenderTargets(){var K;let H;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new bK.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(K=this._options.clearColor)||void 0===K?void 0:K.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((K=>{H=this._scene.environmentIntensity,this._scene.environmentIntensity=1,this._options.clearColor?K.clearColor.q(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(K.clearColor,this._scene.getEngine().useExactSrgbConversions)})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=H}));for(const M of this._transparentMeshesCache)this._shouldRenderAsTransmission(M.material)&&(M.material.refractionTexture=this._opaqueRenderTarget)}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const gK="KHR_materials_transmission";class XK{constructor(K){this.name=gK,this.order=175,this._loader=K,this.enabled=this._loader.isExtensionUsed(gK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadTransparentPropertiesAsync(q,H,M,w)),await Promise.all(u).then((()=>{}))}))}_loadTransparentPropertiesAsync(K,H,M,q){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const w=M;if(w.subSurface.isRefractionEnabled=!0,w.subSurface.volumeIndexOfRefraction=1,w.subSurface.useAlbedoToTintRefraction=!0,void 0===q.transmissionFactor)return w.subSurface.refractionIntensity=0,w.subSurface.isRefractionEnabled=!1,Promise.resolve();{var u;w.subSurface.refractionIntensity=q.transmissionFactor;const K=w.sK();if(w.subSurface.refractionIntensity&&!K._transmissionHelper)new PK({},w.sK());else if(w.subSurface.refractionIntensity&&(null===(u=K._transmissionHelper)||void 0===u||!u._isRenderTargetValid())){var y;null===(y=K._transmissionHelper)||void 0===y||y._setupRenderTargets()}}return w.subSurface.minimumThickness=0,w.subSurface.maximumThickness=0,q.transmissionTexture?(q.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/transmissionTexture`,q.transmissionTexture,void 0).then((K=>{K.name=`${M.name} (Transmission)`,w.subSurface.refractionIntensityTexture=K,w.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}p(gK),N(gK,!0,(K=>new XK(K)));const AK="KHR_materials_diffuse_transmission";class KH{constructor(K){this.name=AK,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(AK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadTranslucentPropertiesAsync(q,H,M,w)),await Promise.all(u).then((()=>{}))}))}_loadTranslucentPropertiesAsync(K,H,M,q){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const w=M;if(w.subSurface.isTranslucencyEnabled=!0,w.subSurface.volumeIndexOfRefraction=1,w.subSurface.minimumThickness=0,w.subSurface.maximumThickness=0,w.subSurface.useAlbedoToTintTranslucency=!1,void 0===q.diffuseTransmissionFactor)return w.subSurface.translucencyIntensity=0,w.subSurface.isTranslucencyEnabled=!1,Promise.resolve();w.subSurface.translucencyIntensity=q.diffuseTransmissionFactor;const y=new Array;return w.subSurface.useGltfStyleTextures=!0,q.diffuseTransmissionTexture&&(q.diffuseTransmissionTexture.nonColorData=!0,y.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionTexture`,q.diffuseTransmissionTexture).then((K=>{K.name=`${M.name} (Diffuse Transmission)`,w.subSurface.translucencyIntensityTexture=K})))),void 0!==q.diffuseTransmissionColorFactor?w.subSurface.translucencyColor=u.CH.iH(q.diffuseTransmissionColorFactor):w.subSurface.translucencyColor=u.CH.White(),q.diffuseTransmissionColorTexture&&y.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionColorTexture`,q.diffuseTransmissionColorTexture).then((K=>{K.name=`${M.name} (Diffuse Transmission Color)`,w.subSurface.translucencyColorTexture=K}))),Promise.all(y).then((()=>{}))}}p(AK),N(AK,!0,(K=>new KH(K)));const HH="KHR_materials_volume";class MH{constructor(K){this.name=HH,this.order=173,this._loader=K,this.enabled=this._loader.isExtensionUsed(HH),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadVolumePropertiesAsync(q,H,M,w)),await Promise.all(u).then((()=>{}))}))}_loadVolumePropertiesAsync(K,H,M,q){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);if(!M.subSurface.isRefractionEnabled&&!M.subSurface.isTranslucencyEnabled||!q.thicknessFactor)return Promise.resolve();M.subSurface.volumeIndexOfRefraction=M.indexOfRefraction;const w=void 0!==q.attenuationDistance?q.attenuationDistance:Number.MAX_VALUE;return M.subSurface.tintColorAtDistance=w,void 0!==q.attenuationColor&&3==q.attenuationColor.length&&M.subSurface.tintColor.Lh(q.attenuationColor[0],q.attenuationColor[1],q.attenuationColor[2]),M.subSurface.minimumThickness=0,M.subSurface.maximumThickness=q.thicknessFactor,M.subSurface.useThicknessAsDepth=!0,q.thicknessTexture?(q.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/thicknessTexture`,q.thicknessTexture).then((K=>{K.name=`${M.name} (Thickness)`,M.subSurface.thicknessTexture=K,M.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}p(HH),N(HH,!0,(K=>new MH(K)));const qH="KHR_materials_dispersion";class wH{constructor(K){this.name=qH,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(qH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadDispersionPropertiesAsync(q,H,M,w)),await Promise.all(u).then((()=>{}))}))}_loadDispersionPropertiesAsync(K,H,M,q){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);return M.subSurface.isRefractionEnabled&&q.dispersion?(M.subSurface.isDispersionEnabled=!0,M.subSurface.dispersion=q.dispersion,Promise.resolve()):Promise.resolve()}}p(qH),N(qH,!0,(K=>new wH(K)));const uH="EXT_materials_diffuse_roughness";class yH{constructor(K){this.name=uH,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(uH)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=new Array;return u.push(this._loader.loadMaterialPropertiesAsync(K,H,M)),u.push(this._loadDiffuseRoughnessPropertiesAsync(q,w,M)),await Promise.all(u).then((()=>{}))}))}_loadDiffuseRoughnessPropertiesAsync(K,H,M){if(!(M instanceof C.b))throw new Error(`${K}: Material type not supported`);const q=new Array;return M.brdf.baseDiffuseModel=UK.d.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,void 0!=H.diffuseRoughnessFactor?M.baseDiffuseRoughness=H.diffuseRoughnessFactor:M.baseDiffuseRoughness=0,H.diffuseRoughnessTexture&&q.push(this._loader.loadTextureInfoAsync(`${K}/diffuseRoughnessTexture`,H.diffuseRoughnessTexture,(K=>{K.name=`${M.name} (Diffuse Roughness)`,M.baseDiffuseRoughnessTexture=K}))),Promise.all(q).then((()=>{}))}}p(uH),N(uH,!0,(K=>new yH(K)));const hH="KHR_mesh_quantization";class WH{constructor(K){this.name=hH,this.enabled=K.isExtensionUsed(hH)}dispose(){}}p(hH),N(hH,!0,(K=>new WH(K)));const IH="KHR_texture_basisu";class fH{constructor(K){this.name=IH,this._loader=K,this.enabled=K.isExtensionUsed(IH)}dispose(){this._loader=null}_loadTextureAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>{const u=void 0==H.sampler?m.DefaultSampler:U.Get(`${K}/sampler`,this._loader.wh.samplers,H.sampler),y=U.Get(`${q}/source`,this._loader.wh.images,w.source);return await this._loader._createTextureAsync(K,u,y,(K=>{M(K)}),H._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!H._textureInfo.nonColorData)}))}}p(IH),N(IH,!0,(K=>new fH(K)));const zH="KHR_texture_transform";class GH{constructor(K){this.name=zH,this._loader=K,this.enabled=this._loader.isExtensionUsed(zH)}dispose(){this._loader=null}loadTextureInfoAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(q,w)=>await this._loader.loadTextureInfoAsync(K,H,(K=>{if(!(K instanceof i.b))throw new Error(`${q}: Texture type not supported`);w.offset&&(K.uOffset=w.offset[0],K.vOffset=w.offset[1]),K.uRotationCenter=0,K.vRotationCenter=0,w.rotation&&(K.wAng=-w.rotation),w.scale&&(K.uScale=w.scale[0],K.vScale=w.scale[1]),void 0!=w.texCoord&&(K.coordinatesIndex=w.texCoord),M(K)}))))}}p(zH),N(zH,!0,(K=>new GH(K)));const aH="KHR_xmp_json_ld";class vH{constructor(K){this.name=aH,this.order=100,this._loader=K,this.enabled=this._loader.isExtensionUsed(aH)}dispose(){this._loader=null}onLoading(){var K,H,M;if(null===this._loader.rootBabylonMesh)return;const q=null===(K=this._loader.wh.extensions)||void 0===K?void 0:K.KHR_xmp_json_ld,w=null===(H=this._loader.wh.asset)||void 0===H||null===(M=H.extensions)||void 0===M?void 0:M.KHR_xmp_json_ld;if(q&&w){const K=+w.packet;q.packets&&K<q.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=q.packets[K])}}}function OH(K,H,M,q){return u.CH.iH(H,M).scale(q)}function LH(K,H,M,q){return H[M]*q}function SH(K,H,M,q){return-H[M]*q}function BH(K,H,M,q){return H[M+1]*q}function CH(K,H,M,q){return H[M]*q*2}function iH(K){return{scale:[new EH(G.d.ANIMATIONTYPE_FLOAT,`${K}.uScale`,LH,(()=>2)),new EH(G.d.ANIMATIONTYPE_FLOAT,`${K}.vScale`,BH,(()=>2))],offset:[new EH(G.d.ANIMATIONTYPE_FLOAT,`${K}.uOffset`,LH,(()=>2)),new EH(G.d.ANIMATIONTYPE_FLOAT,`${K}.vOffset`,BH,(()=>2))],rotation:[new EH(G.d.ANIMATIONTYPE_FLOAT,`${K}.wAng`,SH,(()=>1))]}}p(aH),N(aH,!0,(K=>new vH(K)));class ZH extends F.AnimationPropertyInfo{buildAnimations(K,H,M,q){return[{babylonAnimatable:K._babylonCamera,babylonAnimation:this._buildAnimation(H,M,q)}]}}class EH extends F.AnimationPropertyInfo{buildAnimations(K,H,M,q){const w=[];for(const u in K._data)w.push({babylonAnimatable:K._data[u].babylonMaterial,babylonAnimation:this._buildAnimation(H,M,q)});return w}}class lH extends F.AnimationPropertyInfo{buildAnimations(K,H,M,q){return[{babylonAnimatable:K._babylonLight,babylonAnimation:this._buildAnimation(H,M,q)}]}}(0,o.m)("/cameras/{}/orthographic/xmag",[new ZH(G.d.ANIMATIONTYPE_FLOAT,"orthoLeft",SH,(()=>1)),new ZH(G.d.ANIMATIONTYPE_FLOAT,"orthoRight",BH,(()=>1))]),(0,o.m)("/cameras/{}/orthographic/ymag",[new ZH(G.d.ANIMATIONTYPE_FLOAT,"orthoBottom",SH,(()=>1)),new ZH(G.d.ANIMATIONTYPE_FLOAT,"orthoTop",BH,(()=>1))]),(0,o.m)("/cameras/{}/orthographic/zfar",[new ZH(G.d.ANIMATIONTYPE_FLOAT,"maxZ",LH,(()=>1))]),(0,o.m)("/cameras/{}/orthographic/znear",[new ZH(G.d.ANIMATIONTYPE_FLOAT,"Ih",LH,(()=>1))]),(0,o.m)("/cameras/{}/perspective/yfov",[new ZH(G.d.ANIMATIONTYPE_FLOAT,"fov",LH,(()=>1))]),(0,o.m)("/cameras/{}/perspective/zfar",[new ZH(G.d.ANIMATIONTYPE_FLOAT,"maxZ",LH,(()=>1))]),(0,o.m)("/cameras/{}/perspective/znear",[new ZH(G.d.ANIMATIONTYPE_FLOAT,"Ih",LH,(()=>1))]),(0,o.m)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new EH(G.d.ANIMATIONTYPE_COLOR3,"albedoColor",OH,(()=>4)),new EH(G.d.ANIMATIONTYPE_FLOAT,"alpha",(function(K,H,M,q){return H[M+3]*q}),(()=>4))]),(0,o.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"metallic",LH,(()=>1))]),(0,o.m)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"roughness",LH,(()=>1))]);const sH=iH("albedoTexture");(0,o.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",sH.scale),(0,o.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",sH.offset),(0,o.m)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",sH.rotation);const DH=iH("metallicTexture");(0,o.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",DH.scale),(0,o.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",DH.offset),(0,o.m)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",DH.rotation),(0,o.m)("/materials/{}/emissiveFactor",[new EH(G.d.ANIMATIONTYPE_COLOR3,"emissiveColor",OH,(()=>3))]);const VH=iH("bumpTexture");(0,o.m)("/materials/{}/normalTexture/scale",[new EH(G.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",LH,(()=>1))]),(0,o.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",VH.scale),(0,o.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",VH.offset),(0,o.m)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",VH.rotation),(0,o.m)("/materials/{}/occlusionTexture/strength",[new EH(G.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",LH,(()=>1))]);const nH=iH("ambientTexture");(0,o.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",nH.scale),(0,o.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",nH.offset),(0,o.m)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",nH.rotation);const cH=iH("emissiveTexture");(0,o.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",cH.scale),(0,o.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",cH.offset),(0,o.m)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",cH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new EH(G.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new EH(G.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",LH,(()=>1))]);const kH=iH("anisotropy.texture");(0,o.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",kH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",kH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",kH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",LH,(()=>1))]);const TH=iH("clearCoat.texture");(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",TH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",TH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",TH.rotation);const dH=iH("clearCoat.bumpTexture");(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new EH(G.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",dH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",dH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",dH.rotation);const xH=iH("clearCoat.textureRoughness");(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",xH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",xH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",xH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new EH(G.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_ior/ior",[new EH(G.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new EH(G.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new EH(G.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",LH,(()=>1))]);const QH=iH("iridescence.texture");(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",QH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",QH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",QH.rotation);const JH=iH("iridescence.thicknessTexture");(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",JH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",JH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",JH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new EH(G.d.ANIMATIONTYPE_COLOR3,"sheen.color",OH,(()=>3))]),(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",LH,(()=>1))]);const NH=iH("sheen.texture");(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",NH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",NH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",NH.rotation);const pH=iH("sheen.textureRoughness");(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",pH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",pH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",pH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new EH(G.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",OH,(()=>3))]);const oH=iH("metallicReflectanceTexture");(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",oH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",oH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",oH.rotation);const RH=iH("reflectanceTexture");(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",RH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",RH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",RH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",LH,(()=>1))]);const tH=iH("subSurface.refractionIntensityTexture");(0,o.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",tH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",tH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",tH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new EH(G.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",OH,(()=>3))]),(0,o.m)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new EH(G.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",LH,(()=>1))]),(0,o.m)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",LH,(()=>1))]);const UH=iH("subSurface.thicknessTexture");(0,o.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",UH.scale),(0,o.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",UH.offset),(0,o.m)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",UH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new EH(G.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",LH,(()=>1))]);const jH=iH("subSurface.translucencyIntensityTexture");(0,o.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",jH.scale),(0,o.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",jH.offset),(0,o.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",jH.rotation),(0,o.m)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new EH(G.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",OH,(()=>3))]);const mH=iH("subSurface.translucencyColorTexture");(0,o.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",mH.scale),(0,o.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",mH.offset),(0,o.m)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",mH.rotation),(0,o.m)("/extensions/KHR_lights_punctual/lights/{}/color",[new lH(G.d.ANIMATIONTYPE_COLOR3,"diffuse",OH,(()=>3))]),(0,o.m)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new lH(G.d.ANIMATIONTYPE_FLOAT,"intensity",LH,(()=>1))]),(0,o.m)("/extensions/KHR_lights_punctual/lights/{}/range",[new lH(G.d.ANIMATIONTYPE_FLOAT,"range",LH,(()=>1))]),(0,o.m)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new lH(G.d.ANIMATIONTYPE_FLOAT,"innerAngle",CH,(()=>1))]),(0,o.m)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new lH(G.d.ANIMATIONTYPE_FLOAT,"angle",CH,(()=>1))]),(0,o.m)("/nodes/{}/extensions/EXT_lights_ies/color",[new lH(G.d.ANIMATIONTYPE_COLOR3,"diffuse",OH,(()=>3))]),(0,o.m)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new lH(G.d.ANIMATIONTYPE_FLOAT,"intensity",LH,(()=>1))]);const FH="KHR_animation_pointer";class YH{constructor(K){this.name=FH,this._loader=K,this._pathToObjectConverter=(0,o.i)(this._loader.wh)}get enabled(){return this._loader.isExtensionUsed(FH)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(K,H,M,q,w){var u;const y=null===(u=q.target.extensions)||void 0===u?void 0:u.KHR_animation_pointer;if(!y||!this._pathToObjectConverter)return null;"pointer"!==q.target.path&&O.e.Warn(`${K}/target/path: Value (${q.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=q.target.node&&O.e.Warn(`${K}/target/node: Value (${q.target.node}) must not be present when using the ${this.name} extension`);const h=`${K}/extensions/${this.name}`,W=y.pointer;if(!W)throw new Error(`${h}: Pointer is missing`);try{const u=this._pathToObjectConverter.convert(W);if(!u.info.interpolation)throw new Error(`${h}/pointer: Interpolation is missing`);return this._loader._loadAnimationChannelFromTargetInfoAsync(K,H,M,q,{object:u.object,info:u.info.interpolation},w)}catch(I){return O.e.Warn(`${h}/pointer: Invalid pointer (${W}) skipped`),null}}}p(FH),N(FH,!0,(K=>new YH(K)));class rH{constructor(K,H,M){this.frame=K,this.action=H,this.onlyOnce=M,this.isDone=!1}_clone(){return new rH(this.frame,this.action,this.onlyOnce)}}var eH=M(11132),bH=M(11180),PH=M(11176);class gH{get loop(){return this._loop}set loop(K){K!==this._loop&&(this._loop=K,this.updateOptions({loop:K}))}get currentTime(){var K;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(K=bH.b.audioEngine)&&void 0!==K&&K.audioContext&&(this.isPlaying||this.isPaused)){const K=this.isPaused?0:bH.b.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+K}return 0}get spatialSound(){return this._spatialSound}set spatialSound(K){if(K==this._spatialSound)return;const H=this.isPlaying;this.pause(),K?(this._spatialSound=K,this._updateSpatialParameters()):this._disableSpatialSound(),H&&this.play()}constructor(K,H,M){var q;let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new f.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=w.OH.Zero(),this._localDirection=new w.OH(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=K,M=M||v.b.LastCreatedScene)if(this._scene=M,gH._SceneComponentInitialization(M),this._readyToPlayCallback=u,this._customAttenuationFunction=(K,H,M,q,w)=>H<M?K*(1-H/M):0,h&&(this.autoplay=h.autoplay||!1,this._loop=h.loop||!1,void 0!==h.volume&&(this._volume=h.volume),this._spatialSound=h.spatialSound??!1,this.maxDistance=h.maxDistance??100,this.useCustomAttenuation=h.useCustomAttenuation??!1,this.rolloffFactor=h.rolloffFactor||1,this.refDistance=h.refDistance||1,this.distanceModel=h.distanceModel||"linear",this._playbackRate=h.playbackRate||1,this._streaming=h.streaming??!1,this._length=h.length,this._offset=h.offset),null!==(q=bH.b.audioEngine)&&void 0!==q&&q.canUseWebAudio&&bH.b.audioEngine.audioContext){this._soundGain=bH.b.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let K=!0;if(H)try{"string"===typeof H?(this._urlType="String",this._url=H):H instanceof ArrayBuffer?this._urlType="ArrayBuffer":H instanceof HTMLMediaElement?this._urlType="MediaElement":H instanceof MediaStream?this._urlType="MediaStream":H instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(H)&&(this._urlType="Array");let M=[],q=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=bH.b.audioEngine.audioContext.createMediaElementSource(H),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=bH.b.audioEngine.audioContext.createMediaStreamSource(H),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":H.byteLength>0&&(q=!0,this._soundLoaded(H));break;case"AudioBuffer":this._audioBufferLoaded(H);break;case"String":M.push(H);case"Array":0===M.length&&(M=H);for(let K=0;K<M.length;K++){const H=M[K];if(q=h&&h.skipCodecCheck||-1!==H.indexOf(".mp3",H.length-4)&&bH.b.audioEngine.isMP3supported||-1!==H.indexOf(".ogg",H.length-4)&&bH.b.audioEngine.isOGGsupported||-1!==H.indexOf(".wav",H.length-4)||-1!==H.indexOf(".m4a",H.length-4)||-1!==H.indexOf(".mp4",H.length-4)||-1!==H.indexOf("blob:"),q){this._streaming?(this._htmlAudioElement=new Audio(H),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,y.Tools.SetCorsBehavior(H,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(H,(K=>{this._soundLoaded(K)}),void 0,!0,!0,(K=>{K&&O.e.Error("XHR "+K.status+" error on: "+H+"."),O.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:K=!1}K?q||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):O.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(W){O.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),bH.b.audioEngine&&!bH.b.audioEngine.WarnedWebAudioUnsupported&&(O.e.Error("Web Audio is not supported by your browser."),bH.b.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var K;null!==(K=bH.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(K){var H;null!==(H=bH.b.audioEngine)&&void 0!==H&&H.audioContext&&(this._audioBuffer=K,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(K){var H;null!==(H=bH.b.audioEngine)&&void 0!==H&&H.audioContext&&bH.b.audioEngine.audioContext.decodeAudioData(K,(K=>{this._audioBufferLoaded(K)}),(K=>{O.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+K)}))}setAudioBuffer(K){var H;null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&(this._audioBuffer=K,this._isReadyToPlay=!0)}updateOptions(K){K&&(this.loop=K.loop??this.loop,this.maxDistance=K.maxDistance??this.maxDistance,this.useCustomAttenuation=K.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=K.rolloffFactor??this.rolloffFactor,this.refDistance=K.refDistance??this.refDistance,this.distanceModel=K.distanceModel??this.distanceModel,this._playbackRate=K.playbackRate??this._playbackRate,this._length=K.length??void 0,this.spatialSound=K.spatialSound??this._spatialSound,this._setOffset(K.offset??void 0),this.setVolume(K.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var K;null!==(K=bH.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&bH.b.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??bH.b.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var K;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(K=this._soundPanner)||void 0===K||K.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var K;null!==(K=bH.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(K){var H;null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(K),this._isOutputConnected=!0)}setDirectionalCone(K,H,M){H<K?O.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=K,this._coneOuterAngle=H,this._coneOuterGain=M,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!=this._coneInnerAngle){var H;if(this._coneOuterAngle<K)return void O.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K,null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!=this._coneOuterAngle){var H;if(K<this._coneInnerAngle)return void O.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K,null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(K){var H;K.equals(this._position)||(this._position.q(K),null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(K){var H;this._localDirection=K,null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const K=this._connectedTransformNode.getWorldMatrix(),H=w.OH.TransformNormal(this._localDirection,K);H.normalize(),this._soundPanner.orientationX.value=H.x,this._soundPanner.orientationY.value=H.y,this._soundPanner.orientationZ.value=H.z}updateDistanceFromListener(){var K;if(null!==(K=bH.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const K=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.LH(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,K,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(K){this._customAttenuationFunction=K}play(K,H,M){var q;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(q=bH.b.audioEngine)&&void 0!==q&&q.audioContext)try{var w,u;this._clearTimeoutsAndObservers();let q=K?(null===(w=bH.b.audioEngine)||void 0===w?void 0:w.audioContext.currentTime)+K:null===(u=bH.b.audioEngine)||void 0===u?void 0:u.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=bH.b.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const K=()=>{var M;if(null!==(M=bH.b.audioEngine)&&void 0!==M&&M.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=H??0;const M=this._htmlAudioElement.play();void 0!==M&&M.catch((()=>{var H,M;(null===(H=bH.b.audioEngine)||void 0===H||H.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(M=bH.b.audioEngine)||void 0===M?void 0:M.onAudioUnlockedObservable.addOnce((()=>{K()})))}))}else{var q;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(q=bH.b.audioEngine)||void 0===q?void 0:q.onAudioUnlockedObservable.addOnce((()=>{K()}))}};K()}}else{var y;const w=()=>{var w;if(null!==(w=bH.b.audioEngine)&&void 0!==w&&w.audioContext){var u;if(M=M||this._length,void 0!==H&&this._setOffset(H),this._soundSource){const K=this._soundSource;K.onended=()=>{K.disconnect()}}if(this._soundSource=null===(u=bH.b.audioEngine)||void 0===u?void 0:u.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var y;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==H&&(this._soundSource.loopStart=H),void 0!==M&&(this._soundSource.loopEnd=(0|H)+M),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},q=K?(null===(y=bH.b.audioEngine)||void 0===y?void 0:y.audioContext.currentTime)+K:bH.b.audioEngine.audioContext.currentTime;const w=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(q,w,this.loop?void 0:M)}}};"suspended"===(null===(y=bH.b.audioEngine)||void 0===y?void 0:y.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var K;"suspended"===(null===(K=bH.b.audioEngine)||void 0===K?void 0:K.audioContext.state)?(bH.b.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=bH.b.audioEngine.onAudioUnlockedObservable.addOnce((()=>{w()})))):w()}),500):w()}this._startTime=q,this.isPlaying=!0,this.isPaused=!1}catch(h){O.e.Error("Error while trying to play audio: "+this.name+", "+h.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(K){var H;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var M;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(M=this._streamingSource)||void 0===M||M.disconnect();this.isPlaying=!1}else if(null!==(H=bH.b.audioEngine)&&void 0!==H&&H.audioContext&&this._soundSource){const H=K?bH.b.audioEngine.audioContext.currentTime+K:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(H)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var K;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var H;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(H=this._streamingSource)||void 0===H||H.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(K=bH.b.audioEngine)&&void 0!==K&&K.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=bH.b.audioEngine.audioContext.currentTime-this._startTime)}setVolume(K,H){var M;null!==(M=bH.b.audioEngine)&&void 0!==M&&M.canUseWebAudio&&this._soundGain&&(H&&bH.b.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(bH.b.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,bH.b.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(K,bH.b.audioEngine.audioContext.currentTime+H)):this._soundGain.gain.value=K),this._volume=K}setPlaybackRate(K){this._playbackRate=K,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(K){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=K,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=K=>this._onRegisterAfterWorldMatrixUpdate(K),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(K){var H;if(K.getBoundingInfo){const H=K.getBoundingInfo();this.setPosition(H.boundingSphere.centerWorld)}else this.setPosition(K.absolutePosition);null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const K=()=>{(0,PH.e)((()=>this._isReadyToPlay),(()=>{M._audioBuffer=this.getAudioBuffer(),M._isReadyToPlay=!0,M.autoplay&&M.play(0,this._offset,this._length)}),void 0,300)},H={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},M=new gH(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,H);return this.useCustomAttenuation&&M.setAttenuationFunction(this._customAttenuationFunction),M.setPosition(this._position),M.setPlaybackRate(this._playbackRate),K(),M}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const K={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(K.connectedMeshId=this._connectedTransformNode.id),K.position=this._position.hh(),K.refDistance=this.refDistance,K.distanceModel=this.distanceModel,K.isDirectional=this._isDirectional,K.localDirectionToMesh=this._localDirection.hh(),K.coneInnerAngle=this._coneInnerAngle,K.coneOuterAngle=this._coneOuterAngle,K.coneOuterGain=this._coneOuterGain),K}static Parse(K,H,M,q){const u=K.name;let y;y=K.url?M+K.url:M+u;const h={autoplay:K.autoplay,loop:K.loop,volume:K.volume,spatialSound:K.spatialSound,maxDistance:K.maxDistance,rolloffFactor:K.rolloffFactor,refDistance:K.refDistance,distanceModel:K.distanceModel,playbackRate:K.playbackRate};let W;if(q){const K=()=>{(0,PH.e)((()=>q._isReadyToPlay),(()=>{W._audioBuffer=q.getAudioBuffer(),W._isReadyToPlay=!0,W.autoplay&&W.play(0,W._offset,W._length)}),void 0,300)};W=new gH(u,new ArrayBuffer(0),H,null,h),K()}else W=new gH(u,y,H,(()=>{H.removePendingData(W)}),h),H.addPendingData(W);if(K.position){const H=w.OH.iH(K.position);W.setPosition(H)}if(K.isDirectional&&(W.setDirectionalCone(K.coneInnerAngle||360,K.coneOuterAngle||360,K.coneOuterGain||0),K.localDirectionToMesh)){const H=w.OH.iH(K.localDirectionToMesh);W.setLocalDirectionToMesh(H)}if(K.connectedMeshId){const M=H.getMeshById(K.connectedMeshId);M&&W.attachToMesh(M)}return K.metadata&&(W.metadata=K.metadata),W}_setOffset(K){this._offset!==K&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=K)}_clearTimeoutsAndObservers(){var K;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(K=bH.b.audioEngine)||void 0===K||K.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}gH._SceneComponentInitialization=K=>{throw(0,eH.c)("AudioSceneComponent")},(0,EK.f)("BABYLON.Sound",gH);class XH{constructor(K,H,M){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],H.length!==M.length)throw new Error("Sounds length does not equal weights length");this.loop=K,this._weights=M;let q=0;for(const u of M)q+=u;const w=q>0?1/q:0;for(let u=0;u<this._weights.length;u++)this._weights[u]*=w;this._sounds=H;for(const u of this._sounds)u.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!==this._coneInnerAngle){if(this._coneOuterAngle<K)return void O.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K;for(const H of this._sounds)H.directionalConeInnerAngle=K}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!==this._coneOuterAngle){if(K<this._coneInnerAngle)return void O.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K;for(const H of this._sounds)H.directionalConeOuterAngle=K}}get volume(){return this._volume}set volume(K){if(K!==this._volume)for(const H of this._sounds)H.setVolume(K)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(K){if(!this.isPaused){this.stop();const K=Math.random();let H=0;for(let M=0;M<this._weights.length;M++)if(H+=this._weights[M],K<=H){this._currentIndex=M;break}}const H=this._sounds[this._currentIndex??0];H.isReady()?H.play(0,this.isPaused?void 0:K):H.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class AH{constructor(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(K=K||v.b.LastCreatedScene)&&(this._scene=K,this.soundCollection=[],this._options=H,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var K;null!==(K=bH.b.audioEngine)&&void 0!==K&&K.canUseWebAudio&&bH.b.audioEngine.audioContext&&(this._outputAudioNode=bH.b.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(bH.b.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(bH.b.audioEngine&&bH.b.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(K){var H;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&K.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==K.soundTrackId&&(-1===K.soundTrackId?this._scene.mainSoundTrack.removeSound(K):this._scene.soundTracks&&this._scene.soundTracks[K.soundTrackId].removeSound(K)),this.soundCollection.push(K),K.soundTrackId=this.id}removeSound(K){const H=this.soundCollection.indexOf(K);-1!==H&&this.soundCollection.splice(H,1)}setVolume(K){var H;null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=K)}switchPanningModelToHRTF(){var K;if(null!==(K=bH.b.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let H=0;H<this.soundCollection.length;H++)this.soundCollection[H].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var K;if(null!==(K=bH.b.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let H=0;H<this.soundCollection.length;H++)this.soundCollection[H].switchPanningModelToEqualPower()}connectToAnalyser(K){var H;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=K,null!==(H=bH.b.audioEngine)&&void 0!==H&&H.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,bH.b.audioEngine.masterGain))}}var KM=M(11555),HM=M(11522),MM=M(11105);bH.b.AudioEngineFactory=(K,H,M)=>new qM(K,H,M);class qM{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new f.d,this.onAudioLockedObservable=new f.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,MM.i)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const q=document.createElement("audio");this._hostElement=K,this._audioContext=H,this._audioDestination=M;try{q&&q.canPlayType&&(q.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||q.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(w){}try{q&&q.canPlayType&&q.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(w){}}lock(){this._triggerSuspendedState()}unlock(){var K,H;if("running"===(null===(K=this._audioContext)||void 0===K?void 0:K.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(H=this._audioContext)||void 0===H||H.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningStateAsync()}),(()=>{O.e.Error("Failed to suspend audio context.")})):this._triggerRunningStateAsync()}_resumeAudioContextOnStateChange(){var K;null===(K=this._audioContext)||void 0===K||K.addEventListener("statechange",(()=>{var K;this.unlocked&&"running"!==(null===(K=this._audioContext)||void 0===K?void 0:K.state)&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){var K;return null!==(K=this._audioContext)&&void 0!==K&&K.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningStateAsync())}catch(K){this.canUseWebAudio=!1,O.e.Error("Web Audio: "+K.message)}}async _triggerRunningStateAsync(){if(!this._tryToRun){this._tryToRun=!0;try{await this._resumeAudioContextAsync(),this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)}catch(K){this._tryToRun=!1,this.unlocked=!1}}}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const K=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",H=document.createElement("style");H.appendChild(document.createTextNode(K)),document.getElementsByTagName("head")[0].appendChild(H),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningStateAsync()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){var K;this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear(),null===(K=this._audioContext)||void 0===K||K.close(),this._audioContext=null}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(K){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=K)}connectToAnalyser(K){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=K,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}var wM=M(11125);(0,M(12678).f)(KM.d.NAME_AUDIO,((K,H,M,q)=>{let w,u=[];if(M.Ha=M.Ha||[],void 0!==K.Ha&&null!==K.Ha)for(let h=0,W=K.Ha.length;h<W;h++){var y;const W=K.Ha[h];null!==(y=bH.b.audioEngine)&&void 0!==y&&y.canUseWebAudio?(W.url||(W.url=W.name),u[W.url]?M.Ha.push(gH.Parse(W,H,q,u[W.url])):(w=gH.Parse(W,H,q),u[W.url]=w,M.Ha.push(w))):M.Ha.push(new gH(W.name,null,H))}u=[]})),Object.defineProperty(HM.b.prototype,"mainSoundTrack",{get:function(){let K=this._getComponent(KM.d.NAME_AUDIO);return K||(K=new uM(this),this.ny(K)),this._mainSoundTrack||(this._mainSoundTrack=new AH(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),HM.b.prototype.getSoundByName=function(K){let H;for(H=0;H<this.mainSoundTrack.soundCollection.length;H++)if(this.mainSoundTrack.soundCollection[H].name===K)return this.mainSoundTrack.soundCollection[H];if(this.soundTracks)for(let M=0;M<this.soundTracks.length;M++)for(H=0;H<this.soundTracks[M].soundCollection.length;H++)if(this.soundTracks[M].soundCollection[H].name===K)return this.soundTracks[M].soundCollection[H];return null},Object.defineProperty(HM.b.prototype,"audioEnabled",{get:function(){let K=this._getComponent(KM.d.NAME_AUDIO);return K||(K=new uM(this),this.ny(K)),K.audioEnabled},set:function(K){let H=this._getComponent(KM.d.NAME_AUDIO);H||(H=new uM(this),this.ny(H)),K?H.enableAudio():H.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(HM.b.prototype,"headphone",{get:function(){let K=this._getComponent(KM.d.NAME_AUDIO);return K||(K=new uM(this),this.ny(K)),K.headphone},set:function(K){let H=this._getComponent(KM.d.NAME_AUDIO);H||(H=new uM(this),this.ny(H)),K?H.switchAudioModeForHeadphones():H.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(HM.b.prototype,"audioListenerPositionProvider",{get:function(){let K=this._getComponent(KM.d.NAME_AUDIO);return K||(K=new uM(this),this.ny(K)),K.audioListenerPositionProvider},set:function(K){let H=this._getComponent(KM.d.NAME_AUDIO);if(H||(H=new uM(this),this.ny(H)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");H.audioListenerPositionProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(HM.b.prototype,"audioListenerRotationProvider",{get:function(){let K=this._getComponent(KM.d.NAME_AUDIO);return K||(K=new uM(this),this.ny(K)),K.audioListenerRotationProvider},set:function(K){let H=this._getComponent(KM.d.NAME_AUDIO);if(H||(H=new uM(this),this.ny(H)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");H.audioListenerRotationProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(HM.b.prototype,"audioPositioningRefreshRate",{get:function(){let K=this._getComponent(KM.d.NAME_AUDIO);return K||(K=new uM(this),this.ny(K)),K.audioPositioningRefreshRate},set:function(K){let H=this._getComponent(KM.d.NAME_AUDIO);H||(H=new uM(this),this.ny(H)),H.audioPositioningRefreshRate=K},enumerable:!0,configurable:!0});class uM{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(K){this.name=KM.d.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new w.OH,this._cachedCameraPosition=new w.OH,this._lastCheck=0,this._invertMatrixTemp=new w.Matrix,this._cameraDirectionTemp=new w.OH,(K=K||v.b.LastCreatedScene)&&(this.SH=K,K.soundTracks=[],K.Ha=[])}register(){this.SH._afterRenderStage.registerStep(KM.d.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(K){if(K.Ha=[],this.SH.soundTracks)for(let H=0;H<this.SH.soundTracks.length;H++){const M=this.SH.soundTracks[H];for(let H=0;H<M.soundCollection.length;H++)K.Ha.push(M.soundCollection[H].serialize())}}addFromContainer(K){if(K.Ha)for(const H of K.Ha)H.play(),H.autoplay=!0,this.SH.mainSoundTrack.addSound(H)}removeFromContainer(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(K.Ha)for(const M of K.Ha)M.stop(),M.autoplay=!1,this.SH.mainSoundTrack.removeSound(M),H&&M.dispose()}dispose(){const K=this.SH;if(K._mainSoundTrack&&K.mainSoundTrack.dispose(),K.soundTracks)for(let H=0;H<K.soundTracks.length;H++)K.soundTracks[H].dispose()}disableAudio(){const K=this.SH;let H;for(this._audioEnabled=!1,bH.b.audioEngine&&bH.b.audioEngine.audioContext&&bH.b.audioEngine.audioContext.suspend(),H=0;H<K.mainSoundTrack.soundCollection.length;H++)K.mainSoundTrack.soundCollection[H].pause();if(K.soundTracks)for(H=0;H<K.soundTracks.length;H++)for(let M=0;M<K.soundTracks[H].soundCollection.length;M++)K.soundTracks[H].soundCollection[M].pause()}enableAudio(){const K=this.SH;let H;for(this._audioEnabled=!0,bH.b.audioEngine&&bH.b.audioEngine.audioContext&&bH.b.audioEngine.audioContext.resume(),H=0;H<K.mainSoundTrack.soundCollection.length;H++)K.mainSoundTrack.soundCollection[H].isPaused&&K.mainSoundTrack.soundCollection[H].play();if(K.soundTracks)for(H=0;H<K.soundTracks.length;H++)for(let M=0;M<K.soundTracks[H].soundCollection.length;M++)K.soundTracks[H].soundCollection[M].isPaused&&K.soundTracks[H].soundCollection[M].play()}switchAudioModeForHeadphones(){const K=this.SH;if(this._headphone=!0,K.mainSoundTrack.switchPanningModelToHRTF(),K.soundTracks)for(let H=0;H<K.soundTracks.length;H++)K.soundTracks[H].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const K=this.SH;if(this._headphone=!1,K.mainSoundTrack.switchPanningModelToEqualPower(),K.soundTracks)for(let H=0;H<K.soundTracks.length;H++)K.soundTracks[H].switchPanningModelToEqualPower()}_afterRender(){const K=wM.d.Now;if(this._lastCheck&&K-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=K;const H=this.SH;if(!this._audioEnabled||!H._mainSoundTrack||!H.soundTracks||0===H._mainSoundTrack.soundCollection.length&&1===H.soundTracks.length)return;const M=bH.b.audioEngine;if(M&&M.audioContext){let K,q=H.activeCamera;if(H.activeCameras&&H.activeCameras.length>0&&(q=H.activeCameras[0]),this.audioListenerPositionProvider){const K=this.audioListenerPositionProvider();M.audioContext.listener.setPosition(K.x||0,K.y||0,K.z||0)}else q?this._cachedCameraPosition.equals(q.globalPosition)||(this._cachedCameraPosition.q(q.globalPosition),M.audioContext.listener.setPosition(q.globalPosition.x,q.globalPosition.y,q.globalPosition.z)):M.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const K=this.audioListenerRotationProvider();M.audioContext.listener.setOrientation(K.x||0,K.y||0,K.z||0,0,1,0)}else q?(q.rigCameras&&q.rigCameras.length>0&&(q=q.rigCameras[0]),q.getViewMatrix().invertToRef(this._invertMatrixTemp),w.OH.TransformNormalToRef(uM._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.q(this._cameraDirectionTemp),M.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):M.audioContext.listener.setOrientation(0,0,0,0,1,0);for(K=0;K<H.mainSoundTrack.soundCollection.length;K++){const M=H.mainSoundTrack.soundCollection[K];M.useCustomAttenuation&&M.updateDistanceFromListener()}if(H.soundTracks)for(K=0;K<H.soundTracks.length;K++)for(let M=0;M<H.soundTracks[K].soundCollection.length;M++){const q=H.soundTracks[K].soundCollection[M];q.useCustomAttenuation&&q.updateDistanceFromListener()}}}}uM._CameraDirection=new w.OH(0,0,-1),gH._SceneComponentInitialization=K=>{let H=K._getComponent(KM.d.NAME_AUDIO);H||(H=new uM(K),K.ny(H))};const yM="MSFT_audio_emitter";class hM{constructor(K){this.name=yM,this._loader=K,this.enabled=this._loader.isExtensionUsed(yM)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const K=this._loader.wh.extensions;if(K&&K[this.name]){const H=K[this.name];this._clips=H.clips,this._emitters=H.emitters,U.Assign(this._clips),U.Assign(this._emitters)}}loadSceneAsync(K,H){return m.LoadExtensionAsync(K,H,this.name,(async(M,q)=>{const w=new Array;w.push(this._loader.loadSceneAsync(K,H));for(const K of q.emitters){const H=U.Get(`${M}/emitters`,this._emitters,K);if(void 0!=H.refDistance||void 0!=H.maxDistance||void 0!=H.rolloffFactor||void 0!=H.distanceModel||void 0!=H.innerAngle||void 0!=H.outerAngle)throw new Error(`${M}: Direction or Distance properties are not allowed on emitters attached to a scene`);w.push(this._loadEmitterAsync(`${M}/emitters/${H.index}`,H))}await Promise.all(w)}))}loadNodeAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(K,q)=>{const u=new Array,h=await this._loader.loadNodeAsync(K,H,(H=>{for(const M of q.emitters){const q=U.Get(`${K}/emitters`,this._emitters,M);u.push(this._loadEmitterAsync(`${K}/emitters/${q.index}`,q).then((()=>{for(const K of q._babylonSounds)K.attachToMesh(H),void 0==q.innerAngle&&void 0==q.outerAngle||(K.setLocalDirectionToMesh(w.OH.Forward()),K.setDirectionalCone(2*y.Tools.ToDegrees(void 0==q.innerAngle?Math.PI:q.innerAngle),2*y.Tools.ToDegrees(void 0==q.outerAngle?Math.PI:q.outerAngle),0))})))}M(H)}));return await Promise.all(u),h}))}loadAnimationAsync(K,H){return m.LoadExtensionAsync(K,H,this.name,(async(M,q)=>{const w=await this._loader.loadAnimationAsync(K,H),u=new Array;U.Assign(q.events);for(const y of q.events)u.push(this._loadAnimationEventAsync(`${M}/events/${y.index}`,K,H,y,w));return await Promise.all(u),w}))}_loadClipAsync(K,H){if(H._objectURL)return H._objectURL;let M;if(H.uri)M=this._loader.loadUriAsync(K,H,H.uri);else{const q=U.Get(`${K}/bufferView`,this._loader.wh.bufferViews,H.bufferView);M=this._loader.loadBufferViewAsync(`/bufferViews/${q.index}`,q)}return H._objectURL=M.then((K=>URL.createObjectURL(new Blob([K],{type:H.mimeType})))),H._objectURL}_loadEmitterAsync(K,H){if(H._babylonSounds=H._babylonSounds||[],!H._babylonData){const K=new Array,M=H.name||`emitter${H.index}`,q={loop:!1,autoplay:!1,volume:void 0==H.volume?1:H.volume};for(let u=0;u<H.clips.length;u++){const w=`/extensions/${this.name}/clips`,y=U.Get(w,this._clips,H.clips[u].clip);K.push(this._loadClipAsync(`${w}/${H.clips[u].clip}`,y).then((K=>{const w=H._babylonSounds[u]=new gH(M,K,this._loader.babylonScene,null,q);w.refDistance=H.refDistance||1,w.maxDistance=H.maxDistance||256,w.rolloffFactor=H.rolloffFactor||1,w.distanceModel=H.distanceModel||"exponential"})))}const w=Promise.all(K).then((()=>{const K=H.clips.map((K=>K.weight||1)),M=new XH(H.loop||!1,H._babylonSounds,K);H.innerAngle&&(M.directionalConeInnerAngle=2*y.Tools.ToDegrees(H.innerAngle)),H.outerAngle&&(M.directionalConeOuterAngle=2*y.Tools.ToDegrees(H.outerAngle)),H.volume&&(M.volume=H.volume),H._babylonData.sound=M}));H._babylonData={loaded:w}}return H._babylonData.loaded}_getEventAction(K,H,M,q,w){switch(M){case"play":return K=>{const M=(w||0)+(K-q);H.play(M)};case"stop":return()=>{H.stop()};case"pause":return()=>{H.pause()};default:throw new Error(`${K}: Unsupported action ${M}`)}}_loadAnimationEventAsync(K,H,M,q,w){if(0==w.targetedAnimations.length)return Promise.resolve();const u=w.targetedAnimations[0],y=q.wH,h=U.Get(`/extensions/${this.name}/emitters`,this._emitters,y);return this._loadEmitterAsync(K,h).then((()=>{const H=h._babylonData.sound;if(H){const M=new rH(q.time,this._getEventAction(K,H,q.action,q.time,q.startOffset));u.animation.addEvent(M),w.onAnimationGroupEndObservable.add((()=>{H.stop()})),w.onAnimationGroupPauseObservable.add((()=>{H.pause()}))}}))}}p(yM),N(yM,!0,(K=>new hM(K)));const WM="MSFT_lod";class IM{constructor(K){var H;this.name=WM,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new f.d,this.onMaterialLODsLoadedObservable=new f.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=K,this.maxLODsToLoad=(null===(H=this._loader.parent.extensionOptions[WM])||void 0===H?void 0:H.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(WM)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let K=0;K<this._nodePromiseLODs.length;K++){const H=Promise.all(this._nodePromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Node LOD ${K}`),this._loader.log(`Loaded node LOD ${K}`)),this.onNodeLODsLoadedObservable.notifyObservers(K),K!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${K+1}`),this._loadBufferLOD(this._nodeBufferLODs,K+1),this._nodeSignalLODs[K]&&this._nodeSignalLODs[K].resolve())}));this._loader._completePromises.push(H)}for(let K=0;K<this._materialPromiseLODs.length;K++){const H=Promise.all(this._materialPromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Material LOD ${K}`),this._loader.log(`Loaded material LOD ${K}`)),this.onMaterialLODsLoadedObservable.notifyObservers(K),K!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${K+1}`),this._loadBufferLOD(this._materialBufferLODs,K+1),this._materialSignalLODs[K]&&this._materialSignalLODs[K].resolve())}));this._loader._completePromises.push(H)}}loadSceneAsync(K,H){const M=this._loader.loadSceneAsync(K,H);return this._loadBufferLOD(this._bufferLODs,0),M}loadNodeAsync(K,H,M){return m.LoadExtensionAsync(K,H,this.name,(async(K,w)=>{let u;const y=this._getLODs(K,H,this._loader.wh.nodes,w.ids);this._loader.logOpen(`${K}`);for(let H=0;H<y.length;H++){const K=y[H];0!==H&&(this._nodeIndexLOD=H,this._nodeSignalLODs[H]=this._nodeSignalLODs[H]||new q);const w=K=>{M(K),K.rh(!1)},h=this._loader.loadNodeAsync(`/nodes/${K.index}`,K,w).then((K=>{if(0!==H){const K=y[H-1];K._babylonTransformNode&&(this._disposeTransformNode(K._babylonTransformNode),delete K._babylonTransformNode)}return K.rh(!0),K}));this._nodePromiseLODs[H]=this._nodePromiseLODs[H]||[],0===H?u=h:(this._nodeIndexLOD=null,this._nodePromiseLODs[H].push(h))}return this._loader.logClose(),await u}))}_loadMaterialAsync(K,H,M,q,w){return this._nodeIndexLOD?null:m.LoadExtensionAsync(K,H,this.name,(async(K,u)=>{let y;const h=this._getLODs(K,H,this._loader.wh.materials,u.ids);this._loader.logOpen(`${K}`);for(let H=0;H<h.length;H++){const K=h[H];0!==H&&(this._materialIndexLOD=H);const u=this._loader._loadMaterialAsync(`/materials/${K.index}`,K,M,q,(K=>{0===H&&w(K)})).then((K=>{if(0!==H){w(K);const M=h[H-1]._data;M[q]&&(this._disposeMaterials([M[q].babylonMaterial]),delete M[q])}return K}));this._materialPromiseLODs[H]=this._materialPromiseLODs[H]||[],0===H?y=u:(this._materialIndexLOD=null,this._materialPromiseLODs[H].push(u))}return this._loader.logClose(),await y}))}_loadUriAsync(K,H,M){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const w=this._nodeIndexLOD-1;return this._nodeSignalLODs[w]=this._nodeSignalLODs[w]||new q,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((async()=>await this._loader.loadUriAsync(K,H,M)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const w=this._materialIndexLOD-1;return this._materialSignalLODs[w]=this._materialSignalLODs[w]||new q,this._materialSignalLODs[w].promise.then((async()=>await this._loader.loadUriAsync(K,H,M)))}return null}loadBufferAsync(K,H,M,w){if(this._loader.parent.useRangeRequests&&!H.uri){if(!this._loader.bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);const H=async(K,H)=>{const u=M,y=u+w-1;let h=K[H];return h?(h.start=Math.min(h.start,u),h.end=Math.max(h.end,y)):(h={start:u,end:y,loaded:new q},K[H]=h),await h.loaded.promise.then((K=>new Uint8Array(K.buffer,K.byteOffset+M-h.start,w)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?H(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?H(this._materialBufferLODs,this._materialIndexLOD):H(this._bufferLODs,0)}return null}_loadBufferLOD(K,H){const M=K[H];M&&(this._loader.log(`Loading buffer range [${M.start}-${M.end}]`),this._loader.bin.readAsync(M.start,M.end-M.start+1).then((K=>{M.loaded.resolve(K)}),(K=>{M.loaded.reject(K)})))}_getLODs(K,H,M,q){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const w=[];for(let u=q.length-1;u>=0;u--)if(w.push(U.Get(`${K}/ids/${q[u]}`,M,q[u])),w.length===this.maxLODsToLoad)return w;return w.push(H),w}_disposeTransformNode(K){const H=[],M=K.material;M&&H.push(M);for(const w of K.getChildMeshes())w.material&&H.push(w.material);K.dispose();const q=H.filter((K=>this._loader.babylonScene.meshes.every((H=>H.material!=K))));this._disposeMaterials(q)}_disposeMaterials(K){const H={};for(const M of K){for(const K of M.getActiveTextures())H[K.uniqueId]=K;M.dispose()}for(const M in H)for(const K of this._loader.babylonScene.materials)K.hasTexture(H[M])&&delete H[M];for(const M in H)H[M].dispose()}}p(WM),N(WM,!0,(K=>new IM(K)));const fM="MSFT_minecraftMesh";class zM{constructor(K){this.name=fM,this._loader=K,this.enabled=this._loader.isExtensionUsed(fM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtraAsync(K,H,this.name,(async(q,w)=>{if(w){if(!(M instanceof C.b))throw new Error(`${q}: Material type not supported`);const w=this._loader.loadMaterialPropertiesAsync(K,H,M);return M.needAlphaBlending()&&(M.forceDepthWrite=!0,M.separateCullingPass=!0),M.Oh=M.forceDepthWrite,M.twoSidedLighting=!0,await w}}))}}p(fM),N(fM,!0,(K=>new zM(K)));const GM="MSFT_sRGBFactors";class aM{constructor(K){this.name=GM,this._loader=K,this.enabled=this._loader.isExtensionUsed(GM)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,H,M){return m.LoadExtraAsync(K,H,this.name,(async(q,w)=>{if(w){if(!(M instanceof C.b))throw new Error(`${q}: Material type not supported`);const w=this._loader.loadMaterialPropertiesAsync(K,H,M),u=M.sK().getEngine().useExactSrgbConversions;return M.albedoTexture||M.albedoColor.toLinearSpaceToRef(M.albedoColor,u),M.reflectivityTexture||M.reflectivityColor.toLinearSpaceToRef(M.reflectivityColor,u),await w}}))}}p(GM),N(GM,!0,(K=>new aM(K)));var vM=M(12981);const OM={};var LM=M(13036),SM=M(13019),BM=M(12988),CM=M(13004);function iM(K,H){for(const M of K)for(const K of M.dataOutputs)if(K.uniqueId===H)return K;throw new Error("Could not find data out connection with unique id "+H)}function ZM(K,H){for(const M of K)if(M instanceof SM.d)for(const K of M.signalInputs)if(K.uniqueId===H)return K;throw new Error("Could not find signal in connection with unique id "+H)}async function EM(K,H){const q=await Promise.all(K.allBlocks.map((async K=>{const H=function(K){switch(K){case"FlowGraphPlayAnimationBlock":return async()=>(await Promise.all([M.e(78),M.e(79)]).then(M.bind(M,14428))).FlowGraphPlayAnimationBlock;case"FlowGraphStopAnimationBlock":return async()=>(await M.e(80).then(M.bind(M,14433))).FlowGraphStopAnimationBlock;case"FlowGraphPauseAnimationBlock":return async()=>(await M.e(81).then(M.bind(M,14442))).FlowGraphPauseAnimationBlock;case"FlowGraphInterpolationBlock":return async()=>(await M.e(82).then(M.bind(M,14447))).FlowGraphInterpolationBlock;case"FlowGraphSceneReadyEventBlock":return async()=>(await M.e(83).then(M.bind(M,14455))).FlowGraphSceneReadyEventBlock;case"FlowGraphSceneTickEventBlock":return async()=>(await M.e(84).then(M.bind(M,14458))).FlowGraphSceneTickEventBlock;case"FlowGraphSendCustomEventBlock":return async()=>(await M.e(85).then(M.bind(M,14460))).FlowGraphSendCustomEventBlock;case"FlowGraphReceiveCustomEventBlock":return async()=>(await M.e(86).then(M.bind(M,14463))).FlowGraphReceiveCustomEventBlock;case"FlowGraphMeshPickEventBlock":return async()=>(await M.e(87).then(M.bind(M,14466))).FlowGraphMeshPickEventBlock;case"FlowGraphEBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphEBlock;case"FlowGraphPIBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphPiBlock;case"FlowGraphInfBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphInfBlock;case"FlowGraphNaNBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphNaNBlock;case"FlowGraphRandomBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphRandomBlock;case"FlowGraphAddBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAddBlock;case"FlowGraphSubtractBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphSubtractBlock;case"FlowGraphMultiplyBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphMultiplyBlock;case"FlowGraphDivideBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphDivideBlock;case"FlowGraphAbsBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAbsBlock;case"FlowGraphSignBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphSignBlock;case"FlowGraphTruncBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphTruncBlock;case"FlowGraphFloorBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphFloorBlock;case"FlowGraphCeilBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphCeilBlock;case"FlowGraphRoundBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphRoundBlock;case"FlowGraphFractBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphFractionBlock;case"FlowGraphNegationBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphNegationBlock;case"FlowGraphModuloBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphModuloBlock;case"FlowGraphMinBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphMinBlock;case"FlowGraphMaxBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphMaxBlock;case"FlowGraphClampBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphClampBlock;case"FlowGraphSaturateBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphSaturateBlock;case"FlowGraphMathInterpolationBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphMathInterpolationBlock;case"FlowGraphEqualityBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphEqualityBlock;case"FlowGraphLessThanBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphLessThanBlock;case"FlowGraphLessThanOrEqualBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphLessThanOrEqualBlock;case"FlowGraphGreaterThanBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphGreaterThanBlock;case"FlowGraphGreaterThanOrEqualBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphGreaterThanOrEqualBlock;case"FlowGraphIsNaNBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphIsNanBlock;case"FlowGraphIsInfBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphIsInfinityBlock;case"FlowGraphDegToRadBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphDegToRadBlock;case"FlowGraphRadToDegBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphRadToDegBlock;case"FlowGraphSinBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphSinBlock;case"FlowGraphCosBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphCosBlock;case"FlowGraphTanBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphTanBlock;case"FlowGraphASinBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAsinBlock;case"FlowGraphACosBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAcosBlock;case"FlowGraphATanBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAtanBlock;case"FlowGraphATan2Block":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAtan2Block;case"FlowGraphSinhBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphSinhBlock;case"FlowGraphCoshBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphCoshBlock;case"FlowGraphTanhBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphTanhBlock;case"FlowGraphASinhBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAsinhBlock;case"FlowGraphACoshBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAcoshBlock;case"FlowGraphATanhBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphAtanhBlock;case"FlowGraphExponentialBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphExpBlock;case"FlowGraphLogBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphLogBlock;case"FlowGraphLog2Block":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphLog2Block;case"FlowGraphLog10Block":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphLog10Block;case"FlowGraphSquareRootBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphSquareRootBlock;case"FlowGraphPowerBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphPowerBlock;case"FlowGraphCubeRootBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphCubeRootBlock;case"FlowGraphBitwiseAndBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphBitwiseAndBlock;case"FlowGraphBitwiseOrBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphBitwiseOrBlock;case"FlowGraphBitwiseNotBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphBitwiseNotBlock;case"FlowGraphBitwiseXorBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphBitwiseXorBlock;case"FlowGraphBitwiseLeftShiftBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphBitwiseLeftShiftBlock;case"FlowGraphBitwiseRightShiftBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphBitwiseRightShiftBlock;case"FlowGraphLengthBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphLengthBlock;case"FlowGraphNormalizeBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphNormalizeBlock;case"FlowGraphDotBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphDotBlock;case"FlowGraphCrossBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphCrossBlock;case"FlowGraphRotate2DBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphRotate2DBlock;case"FlowGraphRotate3DBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphRotate3DBlock;case"FlowGraphTransposeBlock":return async()=>(await M.e(90).then(M.bind(M,14503))).FlowGraphTransposeBlock;case"FlowGraphDeterminantBlock":return async()=>(await M.e(90).then(M.bind(M,14503))).FlowGraphDeterminantBlock;case"FlowGraphInvertMatrixBlock":return async()=>(await M.e(90).then(M.bind(M,14503))).FlowGraphInvertMatrixBlock;case"FlowGraphMatrixMultiplicationBlock":return async()=>(await M.e(90).then(M.bind(M,14503))).FlowGraphMatrixMultiplicationBlock;case"FlowGraphBranchBlock":return async()=>(await M.e(95).then(M.bind(M,14506))).FlowGraphBranchBlock;case"FlowGraphSetDelayBlock":return async()=>(await M.e(96).then(M.bind(M,14511))).FlowGraphSetDelayBlock;case"FlowGraphCancelDelayBlock":return async()=>(await M.e(97).then(M.bind(M,14519))).FlowGraphCancelDelayBlock;case"FlowGraphCallCounterBlock":return async()=>(await M.e(98).then(M.bind(M,14525))).FlowGraphCallCounterBlock;case"FlowGraphDebounceBlock":return async()=>(await M.e(99).then(M.bind(M,14530))).FlowGraphDebounceBlock;case"FlowGraphThrottleBlock":return async()=>(await M.e(100).then(M.bind(M,14539))).FlowGraphThrottleBlock;case"FlowGraphDoNBlock":return async()=>(await M.e(101).then(M.bind(M,14543))).FlowGraphDoNBlock;case"FlowGraphFlipFlopBlock":return async()=>(await M.e(102).then(M.bind(M,14552))).FlowGraphFlipFlopBlock;case"FlowGraphForLoopBlock":return async()=>(await M.e(103).then(M.bind(M,14555))).FlowGraphForLoopBlock;case"FlowGraphMultiGateBlock":return async()=>(await M.e(104).then(M.bind(M,14559))).FlowGraphMultiGateBlock;case"FlowGraphSequenceBlock":return async()=>(await M.e(105).then(M.bind(M,14562))).FlowGraphSequenceBlock;case"FlowGraphSwitchBlock":return async()=>(await M.e(106).then(M.bind(M,14566))).FlowGraphSwitchBlock;case"FlowGraphWaitAllBlock":return async()=>(await M.e(107).then(M.bind(M,14571))).FlowGraphWaitAllBlock;case"FlowGraphWhileLoopBlock":return async()=>(await M.e(108).then(M.bind(M,14580))).FlowGraphWhileLoopBlock;case"FlowGraphConsoleLogBlock":return async()=>(await M.e(109).then(M.bind(M,14589))).FlowGraphConsoleLogBlock;case"FlowGraphConditionalBlock":return async()=>(await M.e(110).then(M.bind(M,14594))).FlowGraphConditionalDataBlock;case"FlowGraphConstantBlock":return async()=>(await M.e(111).then(M.bind(M,14598))).FlowGraphConstantBlock;case"FlowGraphTransformCoordinatesSystemBlock":return async()=>(await M.e(112).then(M.bind(M,14600))).FlowGraphTransformCoordinatesSystemBlock;case"FlowGraphGetAssetBlock":return async()=>(await M.e(113).then(M.bind(M,14605))).FlowGraphGetAssetBlock;case"FlowGraphGetPropertyBlock":return async()=>(await M.e(92).then(M.bind(M,14614))).FlowGraphGetPropertyBlock;case"FlowGraphSetPropertyBlock":return async()=>(await M.e(114).then(M.bind(M,14623))).FlowGraphSetPropertyBlock;case"FlowGraphGetVariableBlock":return async()=>(await M.e(115).then(M.bind(M,14630))).FlowGraphGetVariableBlock;case"FlowGraphSetVariableBlock":return async()=>(await M.e(116).then(M.bind(M,14632))).FlowGraphSetVariableBlock;case"FlowGraphJsonPointerParserBlock":return async()=>(await M.e(93).then(M.bind(M,14641))).FlowGraphJsonPointerParserBlock;case"FlowGraphLeadingZerosBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphLeadingZerosBlock;case"FlowGraphTrailingZerosBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphTrailingZerosBlock;case"FlowGraphOneBitsCounterBlock":return async()=>(await M.e(88).then(M.bind(M,14474))).FlowGraphOneBitsCounterBlock;case"FlowGraphCombineVector2Block":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphCombineVector2Block;case"FlowGraphCombineVector3Block":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphCombineVector3Block;case"FlowGraphCombineVector4Block":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphCombineVector4Block;case"FlowGraphCombineMatrixBlock":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphCombineMatrixBlock;case"FlowGraphExtractVector2Block":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphExtractVector2Block;case"FlowGraphExtractVector3Block":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphExtractVector3Block;case"FlowGraphExtractVector4Block":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphExtractVector4Block;case"FlowGraphExtractMatrixBlock":return async()=>(await M.e(94).then(M.bind(M,14650))).FlowGraphExtractMatrixBlock;case"FlowGraphTransformVectorBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphTransformBlock;case"FlowGraphTransformCoordinatesBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphTransformCoordinatesBlock;case"FlowGraphConjugateBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphConjugateBlock;case"FlowGraphAngleBetweenBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphAngleBetweenBlock;case"FlowGraphQuaternionFromAxisAngleBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphQuaternionFromAxisAngleBlock;case"FlowGraphAxisAngleFromQuaternionBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphAxisAngleFromQuaternionBlock;case"FlowGraphQuaternionFromDirectionsBlock":return async()=>(await M.e(89).then(M.bind(M,14499))).FlowGraphQuaternionFromDirectionsBlock;case"FlowGraphMatrixDecompose":return async()=>(await M.e(90).then(M.bind(M,14503))).FlowGraphMatrixDecomposeBlock;case"FlowGraphMatrixCompose":return async()=>(await M.e(90).then(M.bind(M,14503))).FlowGraphMatrixComposeBlock;case"FlowGraphBooleanToFloat":return async()=>(await M.e(91).then(M.bind(M,14657))).FlowGraphBooleanToFloat;case"FlowGraphBooleanToInt":return async()=>(await M.e(91).then(M.bind(M,14657))).FlowGraphBooleanToInt;case"FlowGraphFloatToBoolean":return async()=>(await M.e(91).then(M.bind(M,14657))).FlowGraphFloatToBoolean;case"FlowGraphIntToBoolean":return async()=>(await M.e(91).then(M.bind(M,14657))).FlowGraphIntToBoolean;case"FlowGraphIntToFloat":return async()=>(await M.e(91).then(M.bind(M,14657))).FlowGraphIntToFloat;case"FlowGraphFloatToInt":return async()=>(await M.e(91).then(M.bind(M,14657))).FlowGraphFloatToInt;case"FlowGraphEasingBlock":return async()=>(await M.e(117).then(M.bind(M,14666))).FlowGraphEasingBlock;case"FlowGraphBezierCurveEasing":return async()=>(await M.e(118).then(M.bind(M,14668))).FlowGraphBezierCurveEasingBlock;case"FlowGraphPointerOverEventBlock":return async()=>(await M.e(119).then(M.bind(M,14673))).FlowGraphPointerOverEventBlock;case"FlowGraphPointerOutEventBlock":return async()=>(await M.e(120).then(M.bind(M,14678))).FlowGraphPointerOutEventBlock;case"FlowGraphContextBlock":return async()=>(await M.e(121).then(M.bind(M,14682))).FlowGraphContextBlock;case"FlowGraphArrayIndexBlock":return async()=>(await M.e(122).then(M.bind(M,14685))).FlowGraphArrayIndexBlock;case"FlowGraphCodeExecutionBlock":return async()=>(await M.e(123).then(M.bind(M,14693))).FlowGraphCodeExecutionBlock;case"FlowGraphIndexOfBlock":return async()=>(await M.e(124).then(M.bind(M,14702))).FlowGraphIndexOfBlock;case"FlowGraphFunctionReference":return async()=>(await M.e(125).then(M.bind(M,14704))).FlowGraphFunctionReferenceBlock;case"FlowGraphDataSwitchBlock":return async()=>(await M.e(126).then(M.bind(M,14711))).FlowGraphDataSwitchBlock;default:if(OM[K])return OM[K];throw new Error(`Unknown block name ${K}`)}}(K.className);return await H()})));return function(K,H,M){const q=H.coordinator.createGraph(),w=[],u=H.valueParseFunction??BM.d;for(let y=0;y<K.allBlocks.length;y++){const h=sM(K.allBlocks[y],{SH:H.coordinator.config.SH,pathConverter:H.pathConverter,assetsContainer:H.coordinator.config.SH,valueParseFunction:u},M[y]);w.push(h),h instanceof LM.d&&q.addEventBlock(h)}for(const y of w){for(const K of y.dataInputs)for(const H of K.connectedPointIds){const M=iM(w,H);K.connectTo(M)}if(y instanceof SM.d)for(const K of y.signalOutputs)for(const H of K.connectedPointIds){const M=ZM(w,H);K.connectTo(M)}}for(const y of K.executionContexts)lM(y,{graph:q,valueParseFunction:u},K.rightHanded);return q}(K,H,q)}function lM(K,H,M){const q=H.graph.createContext();K.enableLogging&&(q.enableLogging=!0),q.treatDataAsRightHanded=M||!1;const w=H.valueParseFunction??BM.d;q.uniqueId=K.uniqueId;const u=q.sK();if(K._assetsContext){var y,h,W,I,f,z,G,a,v,O;const H=K._assetsContext,M={meshes:null===(y=H.meshes)||void 0===y?void 0:y.map((K=>u.getMeshById(K))),lights:null===(h=H.lights)||void 0===h?void 0:h.map((K=>u.getLightByName(K))),cameras:null===(W=H.cameras)||void 0===W?void 0:W.map((K=>u.getCameraByName(K))),materials:null===(I=H.materials)||void 0===I?void 0:I.map((K=>u.getMaterialById(K))),textures:null===(f=H.textures)||void 0===f?void 0:f.map((K=>u.getTextureByName(K))),animations:null===(z=H.animations)||void 0===z?void 0:z.map((K=>u.animations.find((H=>H.name===K)))),skeletons:null===(G=H.skeletons)||void 0===G?void 0:G.map((K=>u.getSkeletonByName(K))),CG:null===(a=H.CG)||void 0===a?void 0:a.map((K=>u.getParticleSystemById(K))),animationGroups:null===(v=H.animationGroups)||void 0===v?void 0:v.map((K=>u.getAnimationGroupByName(K))),transformNodes:null===(O=H.transformNodes)||void 0===O?void 0:O.map((K=>u.getTransformNodeById(K))),rootNodes:[],multiMaterials:[],morphTargetManagers:[],geometries:[],actionManagers:[],environmentTexture:null,postProcesses:[],Ha:null,effectLayers:[],layers:[],reflectionProbes:[],lensFlareSystems:[],proceduralTextures:[],getNodes:function(){throw new Error("Function not implemented.")}};q.assetsContext=M}for(const L in K._userVariables){const H=w(L,K._userVariables,q.assetsContext,u);q.userVariables[L]=H}for(const L in K._connectionValues){const H=w(L,K._connectionValues,q.assetsContext,u);q._setConnectionValueByKey(L,H)}return q}function sM(K,H,M){const q={},w=H.valueParseFunction??BM.d;if(K.config)for(const y in K.config)q[y]=w(y,K.config,H.assetsContainer||H.SH,H.SH);if((0,BM.k)(K.className)){if(!H.pathConverter)throw new Error("Path converter is required for this block");q.pathConverter=H.pathConverter}const u=new M(q);u.uniqueId=K.uniqueId;for(let y=0;y<K.dataInputs.length;y++){const H=u.getDataInput(K.dataInputs[y].name);if(!H)throw new Error("Could not find data input with name "+K.dataInputs[y].name+" in block "+K.className);H.deserialize(K.dataInputs[y])}for(let y=0;y<K.dataOutputs.length;y++){const H=u.getDataOutput(K.dataOutputs[y].name);if(!H)throw new Error("Could not find data output with name "+K.dataOutputs[y].name+" in block "+K.className);H.deserialize(K.dataOutputs[y])}return u.metadata=K.metadata,u.deserialize&&u.deserialize(K),u}function DM(K){const[H,M]=K.split(":");return VM({op:H,extension:M})}function VM(K){var H;let M=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const q=K.extension?null===(H=cM[K.extension])||void 0===H?void 0:H[K.op]:kM[K.op];if(!q&&(O.e.Warn(`No mapping found for operation ${K.op} and extension ${K.extension||"KHR_interactivity"}`),M)){const H={},M={flows:{}};if(K.inputValueSockets){H.values={};for(const M in K.inputValueSockets)H.values[M]={name:M}}return K.outputValueSockets&&(M.values={},Object.keys(K.outputValueSockets).forEach((K=>{M.values[K]={name:K}}))),{kf:[],inputs:H,outputs:M}}return q}function nM(K,H,M){cM[H]||(cM[H]={}),cM[H][K]=M}const cM={BABYLON:{"flow/log":{kf:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},kM={"event/onStart":{kf:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{kf:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{kf:["FlowGraphSendCustomEventBlock"],extraProcessor(K,H,M,q,w){if("event/send"!==H.op||!K.configuration||1!==Object.keys(K.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const u=K.configuration.event.value[0];if("number"!==typeof u)throw new Error("Event id should be a number");const y=q.arrays.events[u],h=w[0];return h.config||(h.config={}),h.config.eventId=y.eventId,h.config.eventData=y.eventData,w}},"event/receive":{kf:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation(K,H){var M;if(!K.configuration)return O.e.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};const q=K.configuration.event;if(!q)return O.e.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};const w=q.value[0];if("number"!==typeof w)return O.e.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"};return(null===(M=H.events)||void 0===M?void 0:M[w])?{valid:!0}:(O.e.Error(`Event with id ${w} not found`),{valid:!1,error:`Event with id ${w} not found`})},extraProcessor(K,H,M,q,w){if("event/receive"!==H.op||!K.configuration||1!==Object.keys(K.configuration).length)throw new Error("Receive event should have a single configuration object, the event itself");const u=K.configuration.event.value[0];if("number"!==typeof u)throw new Error("Event id should be a number");const y=q.arrays.events[u],h=w[0];return h.config||(h.config={}),h.config.eventId=y.eventId,h.config.eventData=y.eventData,w}},"math/e":TM("FlowGraphEBlock"),"math/pi":TM("FlowGraphPIBlock"),"math/inf":TM("FlowGraphInfBlock"),"math/nan":TM("FlowGraphNaNBlock"),"math/abs":TM("FlowGraphAbsBlock"),"math/sign":TM("FlowGraphSignBlock"),"math/trunc":TM("FlowGraphTruncBlock"),"math/floor":TM("FlowGraphFloorBlock"),"math/ceil":TM("FlowGraphCeilBlock"),"math/round":{kf:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w){var u;return(u=w[0]).config||(u.config={}),w[0].config.roundHalfAwayFromZero=!0,w}},"math/fract":TM("FlowGraphFractBlock"),"math/neg":TM("FlowGraphNegationBlock"),"math/add":TM("FlowGraphAddBlock",["a","b"],!0),"math/sub":TM("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{kf:["FlowGraphMultiplyBlock"],extraProcessor(K,H,M,q,w){var u;(u=w[0]).config||(u.config={}),w[0].config.useMatrixPerComponent=!0,w[0].config.preventIntegerFloatArithmetic=!0;let y=-1;return Object.keys(K.values||{}).find((H=>{var M;return void 0!==(null===(M=K.values)||void 0===M?void 0:M[H].type)&&(y=K.values[H].type,!0)})),-1!==y&&(w[0].config.type=q.arrays.types[y].flowGraphType),w},validation:K=>K.values?dM(K):{valid:!0}},"math/div":TM("FlowGraphDivideBlock",["a","b"],!0),"math/rem":TM("FlowGraphModuloBlock",["a","b"]),"math/min":TM("FlowGraphMinBlock",["a","b"]),"math/max":TM("FlowGraphMaxBlock",["a","b"]),"math/clamp":TM("FlowGraphClampBlock",["a","b","c"]),"math/saturate":TM("FlowGraphSaturateBlock"),"math/mix":TM("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":TM("FlowGraphEqualityBlock",["a","b"]),"math/lt":TM("FlowGraphLessThanBlock",["a","b"]),"math/le":TM("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":TM("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":TM("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":TM("FlowGraphIsNaNBlock"),"math/isinf":TM("FlowGraphIsInfBlock"),"math/select":{kf:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{kf:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":TM("FlowGraphSinBlock"),"math/cos":TM("FlowGraphCosBlock"),"math/tan":TM("FlowGraphTanBlock"),"math/asin":TM("FlowGraphASinBlock"),"math/acos":TM("FlowGraphACosBlock"),"math/atan":TM("FlowGraphATanBlock"),"math/atan2":TM("FlowGraphATan2Block",["a","b"]),"math/sinh":TM("FlowGraphSinhBlock"),"math/cosh":TM("FlowGraphCoshBlock"),"math/tanh":TM("FlowGraphTanhBlock"),"math/asinh":TM("FlowGraphASinhBlock"),"math/acosh":TM("FlowGraphACoshBlock"),"math/atanh":TM("FlowGraphATanhBlock"),"math/exp":TM("FlowGraphExponentialBlock"),"math/log":TM("FlowGraphLogBlock"),"math/log2":TM("FlowGraphLog2Block"),"math/log10":TM("FlowGraphLog10Block"),"math/sqrt":TM("FlowGraphSquareRootBlock"),"math/cbrt":TM("FlowGraphCubeRootBlock"),"math/pow":TM("FlowGraphPowerBlock",["a","b"]),"math/length":TM("FlowGraphLengthBlock"),"math/normalize":TM("FlowGraphNormalizeBlock"),"math/dot":TM("FlowGraphDotBlock",["a","b"]),"math/cross":TM("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":TM("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":TM("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{kf:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{kf:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{kf:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{kf:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{kf:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{kf:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{kf:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":TM("FlowGraphTransposeBlock"),"math/determinant":TM("FlowGraphDeterminantBlock"),"math/inverse":TM("FlowGraphInvertMatrixBlock"),"math/matmul":TM("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{kf:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"Sh",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w,u){const y=w[0].dataInputs.find((K=>"rotationQuaternion"===K.name));if(!y)throw new Error("Rotation quaternion input not found");return u._connectionValues[y.uniqueId]&&(u._connectionValues[y.uniqueId].type="Quaternion"),w}},"math/matDecompose":{kf:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"Sh"}}}},"math/quatConjugate":TM("FlowGraphConjugateBlock",["a"]),"math/quatMul":{kf:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w){var u;return(u=w[0]).config||(u.config={}),w[0].config.type="Quaternion",w}},"math/quatAngleBetween":TM("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{kf:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":TM("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":TM("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{kf:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w){var u;return(u=w[0]).config||(u.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract2x2":{kf:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{kf:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w){var u;return(u=w[0]).config||(u.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract3x3":{kf:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{kf:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w){var u;return(u=w[0]).config||(u.config={}),w[0].config.inputIsColumnMajor=!0,w}},"math/extract4x4":{kf:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{kf:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w,u){var y,h;(h=w[0]).config||(h.config={});const W=w[0].dataInputs[0];return w[0].config.valueType=(null===(y=u._connectionValues[W.uniqueId])||void 0===y?void 0:y.type)??"FlowGraphInteger",w}},"math/and":{kf:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w,u){var y,h,W;(W=w[0]).config||(W.config={});const I=w[0].dataInputs[0],f=w[0].dataInputs[1];return w[0].config.valueType=(null===(y=u._connectionValues[I.uniqueId])||void 0===y?void 0:y.type)??(null===(h=u._connectionValues[f.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",w}},"math/or":{kf:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w,u){var y,h,W;(W=w[0]).config||(W.config={});const I=w[0].dataInputs[0],f=w[0].dataInputs[1];return w[0].config.valueType=(null===(y=u._connectionValues[I.uniqueId])||void 0===y?void 0:y.type)??(null===(h=u._connectionValues[f.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",w}},"math/xor":{kf:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor(K,H,M,q,w,u){var y,h,W;(W=w[0]).config||(W.config={});const I=w[0].dataInputs[0],f=w[0].dataInputs[1];return w[0].config.valueType=(null===(y=u._connectionValues[I.uniqueId])||void 0===y?void 0:y.type)??(null===(h=u._connectionValues[f.uniqueId])||void 0===h?void 0:h.type)??"FlowGraphInteger",w}},"math/asr":TM("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":TM("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":TM("FlowGraphLeadingZerosBlock"),"math/ctz":TM("FlowGraphTrailingZerosBlock"),"math/popcnt":TM("FlowGraphOneBitsCounterBlock"),"math/rad":TM("FlowGraphDegToRadBlock"),"math/deg":TM("FlowGraphRadToDegBlock"),"type/boolToInt":TM("FlowGraphBooleanToInt"),"type/boolToFloat":TM("FlowGraphBooleanToFloat"),"type/intToBool":TM("FlowGraphIntToBoolean"),"type/intToFloat":TM("FlowGraphIntToFloat"),"type/floatToInt":TM("FlowGraphFloatToInt"),"type/floatToBool":TM("FlowGraphFloatToBoolean"),"flow/sequence":{kf:["FlowGraphSequenceBlock"],extraProcessor(K,H,M,q,w){const u=w[0];return u.config||(u.config={}),u.config.outputSignalCount=Object.keys(K.flows||[]).length,u.signalOutputs.forEach(((K,H)=>{K.name="out_"+H})),w}},"flow/branch":{kf:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{kf:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation(K){if(K.configuration&&K.configuration.cases){const H=K.configuration.cases.value;if(!H.every((K=>"number"===typeof K&&/^-?\d+$/.test(K.toString()))))return O.e.Warn("Switch cases should be integers. Using empty array instead."),K.configuration.cases.value=[],{valid:!0};const M=new Set(H);K.configuration.cases.value=Array.from(M)}return{valid:!0}},extraProcessor(K,H,M,q,w){if("flow/switch"!==H.op||!K.flows||0===Object.keys(K.flows).length)throw new Error("Switch should have a single configuration object, the cases array");return w[0].signalOutputs.forEach((K=>{"default"!==K.name&&(K.name="out_"+K.name)})),w}},"flow/while":{kf:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{kf:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor(K,H,M,q,w){const u=w[0];return u.config||(u.config={}),u.config.incrementIndexWhenLoopDone=!0,w}},"flow/doN":{kf:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{kf:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor(K,H,M,q,w){if("flow/multiGate"!==H.op||!K.flows||0===Object.keys(K.flows).length)throw new Error("MultiGate should have a single configuration object, the number of output flows");const u=w[0];return u.config||(u.config={}),u.config.outputSignalCount=Object.keys(K.flows).length,u.signalOutputs.forEach(((K,H)=>{K.name="out_"+H})),w}},"flow/waitAll":{kf:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation(K){var H,M;return"number"!==typeof(null===(H=K.configuration)||void 0===H||null===(M=H.inputFlows)||void 0===M?void 0:M.value[0])&&(K.configuration=K.configuration||{inputFlows:{value:[0]}},K.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{kf:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{kf:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{kf:["FlowGraphCancelDelayBlock"]},"variable/get":{kf:["FlowGraphGetVariableBlock"],validation(K){var H,M;return null!==(H=K.configuration)&&void 0!==H&&null!==(M=H.variable)&&void 0!==M&&M.value?{valid:!0}:(O.e.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(K,H)=>[H.getVariableName(K[0])]}}},"variable/set":{kf:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:(K,H)=>[H.getVariableName(K[0])]}}},"variable/setMultiple":{kf:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:(K,H)=>[K[0].map((K=>H.getVariableName(K)))]}},extraProcessor:(K,H,M,q,w)=>(w[0].dataInputs.forEach((K=>{K.name=q.getVariableName(+K.name)})),w)},"variable/interpolate":{kf:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:(K,H)=>[H.getVariableName(K[0])]},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:K=>!0===K[0]?["Quaternion"]:[void 0]}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",LM:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",LM:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",LM:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",LM:"FlowGraphPlayAnimationBlock"},out:{name:"out",LM:"FlowGraphPlayAnimationBlock"},done:{name:"done",LM:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor(K,H,M,q,w){var u,y,h;const W=w[0],I=null===(u=K.configuration)||void 0===u?void 0:u.variable.value[0];if("number"!==typeof I)throw O.e.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");const f=q.arrays.staticVariables[I];"undefined"===typeof W.config.animationType.value&&(q.arrays.staticVariables,W.config.animationType.value=(0,CM.J)(f.type));const z=w[4];return z.config||(z.config={}),(y=z.config).variable||(y.variable={}),z.config.variable.value=q.getVariableName(I),(h=w[3]).config||(h.config={}),w}},"pointer/get":{kf:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",LM:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",LM:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,H,M,q,w)=>(w.forEach((K=>{"FlowGraphJsonPointerParserBlock"===K.className&&(K.config||(K.config={}),K.config.outputValue=!0)})),w)},"pointer/set":{kf:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",LM:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",LM:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,H,M,q,w)=>(w.forEach((K=>{"FlowGraphJsonPointerParserBlock"===K.className&&(K.config||(K.config={}),K.config.outputValue=!0)})),w)},"pointer/interpolate":{kf:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",LM:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",LM:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",LM:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",LM:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",LM:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",LM:"FlowGraphPlayAnimationBlock"},out:{name:"out",LM:"FlowGraphPlayAnimationBlock"},done:{name:"done",LM:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:(K,H,M,q,w)=>(w.forEach((H=>{"FlowGraphJsonPointerParserBlock"===H.className?(H.config||(H.config={}),H.config.outputValue=!0):"FlowGraphInterpolationBlock"===H.className&&(H.config||(H.config={}),Object.keys(K.values||[]).forEach((M=>{var w;const u=null===(w=K.values)||void 0===w?void 0:w[M];if("value"===M&&u){const K=u.type;void 0!==K&&(H.config.animationType=q.arrays.types[K].flowGraphType)}})))})),w)},"animation/start":{kf:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",LM:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:(K,H)=>[K[0]*H._animationTargetFps]},endTime:{name:"to",gltfType:"number",dataTransformer:(K,H)=>[K[0]*H._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,H,M,q,w,u,y){const h=w[w.length-1];return h.config||(h.config={}),h.config.glTF=y,w}},"animation/stop":{kf:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",LM:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,H,M,q,w,u,y){const h=w[w.length-1];return h.config||(h.config={}),h.config.glTF=y,w}},"animation/stopAt":{kf:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",LM:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:(K,H)=>[K[0]*H._animationTargetFps]}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor(K,H,M,q,w,u,y){const h=w[w.length-1];return h.config||(h.config={}),h.config.glTF=y,w}},"math/switch":{kf:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation(K){if(K.configuration&&K.configuration.cases){const H=K.configuration.cases.value;if(!H.every((K=>"number"===typeof K&&/^-?\d+$/.test(K.toString()))))return O.e.Warn("Switch cases should be integers. Using empty array instead."),K.configuration.cases.value=[],{valid:!0};const M=new Set(H);K.configuration.cases.value=Array.from(M)}return{valid:!0}},extraProcessor(K,H,M,q,w){const u=w[0];return u.dataInputs.forEach((K=>{"default"!==K.name&&"case"!==K.name&&(K.name="in_"+K.name)})),u.config||(u.config={}),u.config.treatCasesAsIntegers=!0,w}},"debug/log":{kf:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function TM(K){let H=arguments.length>2?arguments[2]:void 0;return{kf:[K],inputs:{values:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:["a"]).reduce(((K,H)=>(K[H]={name:H},K)),{})},outputs:{values:{value:{name:"value"}}},extraProcessor(K,M,q,w,u){var y;if(H){(y=u[0]).config||(y.config={}),u[0].config.preventIntegerFloatArithmetic=!0;let H=-1;Object.keys(K.values||{}).find((M=>{var q;return void 0!==(null===(q=K.values)||void 0===q?void 0:q[M].type)&&(H=K.values[M].type,!0)})),-1!==H&&(u[0].config.type=w.arrays.types[H].flowGraphType)}return u},validation:K=>H?dM(K):{valid:!0}}}function dM(K){if(K.values){const H=Object.keys(K.values).map((H=>K.values[H].type)).filter((K=>void 0!==K));if(!H.every((K=>K===H[0])))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}kM["math/compose"]=kM["math/matCompose"],kM["math/decompose"]=kM["math/matDecompose"];var xM=M(11250);const QM={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"OH",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}};class JM{constructor(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;this._interactivityGraph=K,this._gltf=H,this._animationTargetFps=M,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}get arrays(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}}_parseTypes(){if(this._interactivityGraph.types)for(const K of this._interactivityGraph.types)this._types.push(QM[K.signature])}_parseDeclarations(){if(this._interactivityGraph.declarations)for(const K of this._interactivityGraph.declarations){const H=VM(K);if(!H)throw O.e.Error(["No mapping found for declaration",K]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:H,fullOperationName:K.extension?K.op+":"+K.extension:K.op})}}_parseVariables(){if(this._interactivityGraph.variables)for(const K of this._interactivityGraph.variables){const H=this._parseVariable(K);this._staticVariables.push(H)}}_parseVariable(K,H){const M=this._types[K.type];if(!M)throw O.e.Error(["No type found for variable",K]),new Error("Error parsing variables");if(K.value&&K.value.length!==M.length)throw O.e.Error(["Invalid value length for variable",K,M]),new Error("Error parsing variables");const q=K.value||[];if(!q.length)switch(M.flowGraphType){case"boolean":q.push(!1);break;case"FlowGraphInteger":q.push(0);break;case"number":q.push(NaN);break;case"Vector2":q.push(NaN,NaN);break;case"OH":q.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":q.fill(NaN,0,4);break;case"Matrix":q.fill(NaN,0,16);break;case"Matrix3D":q.fill(NaN,0,9)}return"number"===M.elementType&&"string"===typeof q[0]&&(q[0]=parseFloat(q[0])),{type:M.flowGraphType,value:H?H(q,this):q}}_parseEvents(){if(this._interactivityGraph.events)for(const K of this._interactivityGraph.events){const H={eventId:K.id||"internalEvent_"+this._internalEventsCounter++};K.values&&(H.eventData=Object.keys(K.values).map((H=>{var M;const q=null===(M=K.values)||void 0===M?void 0:M[H];if(!q)throw O.e.Error(["No value found for event key",H]),new Error("Error parsing events");const w=this._types[q.type];if(!w)throw O.e.Error(["No type found for event value",q]),new Error("Error parsing events");const u="undefined"!==typeof q.value?this._parseVariable(q):void 0;return{id:H,type:w.flowGraphType,eventData:!0,value:u}}))),this._events.push(H)}}_parseNodes(){if(this._interactivityGraph.nodes)for(const H of this._interactivityGraph.nodes){if("number"!==typeof H.declaration)throw O.e.Error(["No declaration found for node",H]),new Error("Error parsing nodes");const M=this._mappings[H.declaration];if(!M)throw O.e.Error(["No mapping found for node",H]),new Error("Error parsing nodes");if(M.flowGraphMapping.validation){const q=M.flowGraphMapping.validation(H,this._interactivityGraph,this._gltf);var K;if(!q.valid)throw new Error(`Error validating interactivity node ${null===(K=this._interactivityGraph.declarations)||void 0===K?void 0:K[H.declaration].op} - ${q.error}`)}const q=[];for(const K of M.flowGraphMapping.kf){const w=this._getEmptyBlock(K,M.fullOperationName);this._parseNodeConfiguration(H,w,M.flowGraphMapping,K),q.push(w)}this._nodes.push({kf:q,fullOperationName:M.fullOperationName})}}_getEmptyBlock(K,H){return{uniqueId:(0,xM.c)(),className:K,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:H,metadata:{}}}_parseNodeConfiguration(K,H,M,q){const w=H.config;if(K.configuration){const H=Object.keys(K.configuration);for(const h of H){var u,y;const H=null===(u=K.configuration)||void 0===u?void 0:u[h];if(!H)throw O.e.Error(["No value found for node configuration",h]),new Error("Error parsing node configuration");const W=null===(y=M.configuration)||void 0===y?void 0:y[h];if(W&&W.LM?W.LM===q:0===M.kf.indexOf(q)){const K=(null===W||void 0===W?void 0:W.name)||h;H&&"undefined"!==typeof H.value||"undefined"===typeof(null===W||void 0===W?void 0:W.defaultValue)?H.value.length>=0?w[K]={value:1===H.value.length?H.value[0]:H.value}:O.e.Warn(["Invalid value for node configuration",H]):w[K]={value:W.defaultValue},W&&W.dataTransformer&&(w[K].value=W.dataTransformer([w[K].value],this)[0])}}}}_parseNodeConnections(K){for(let E=0;E<this._nodes.length;E++){var H;const l=null===(H=this._interactivityGraph.nodes)||void 0===H?void 0:H[E];if(!l)throw O.e.Error(["No node found for interactivity node",this._nodes[E]]),new Error("Error parsing node connections");const s=this._nodes[E],D=this._mappings[l.declaration];if(!D)throw O.e.Error(["No mapping found for node",l]),new Error("Error parsing node connections");const V=l.flows||{},n=Object.keys(V).sort();for(const K of n){var M,q,w,u;const H=V[K],I=null===(M=D.flowGraphMapping.outputs)||void 0===M||null===(q=M.flows)||void 0===q?void 0:q[K],f=(null===I||void 0===I?void 0:I.name)||K,z=this._createNewSocketConnection(f,!0);(I&&I.LM&&s.kf.find((K=>K.className===I.LM))||s.kf[0]).signalOutputs.push(z);const G=H.node,a=this._nodes[G];if(!a)throw O.e.Error(["No node found for input node id",G]),new Error("Error parsing node connections");const v=DM(a.fullOperationName);if(!v)throw O.e.Error(["No mapping found for input node",a]),new Error("Error parsing node connections");let L=null===(w=v.inputs)||void 0===w||null===(u=w.flows)||void 0===u?void 0:u[H.socket||"in"],S=!1;if(!L)for(const K in null===(y=v.inputs)||void 0===y?void 0:y.flows){var y,h,W;if(K.startsWith("[")&&K.endsWith("]"))S=!0,L=null===(h=v.inputs)||void 0===h||null===(W=h.flows)||void 0===W?void 0:W[K]}const B=L?S?L.name.replace("$1",H.socket||""):L.name:H.socket||"in",C=L&&L.LM&&a.kf.find((K=>K.className===L.LM))||a.kf[0];let i=C.signalInputs.find((K=>K.name===B));i||(i=this._createNewSocketConnection(B),C.signalInputs.push(i)),i.connectedPointIds.push(z.uniqueId),z.connectedPointIds.push(i.uniqueId)}const c=l.values||{},k=Object.keys(c);for(const H of k){var I,f;const M=c[H];let q=null===(I=D.flowGraphMapping.inputs)||void 0===I||null===(f=I.values)||void 0===f?void 0:f[H],w=!1;if(!q)for(const K in null===(z=D.flowGraphMapping.inputs)||void 0===z?void 0:z.values){var z,G,a;if(K.startsWith("[")&&K.endsWith("]"))w=!0,q=null===(G=D.flowGraphMapping.inputs)||void 0===G||null===(a=G.values)||void 0===a?void 0:a[K]}const u=q?w?q.name.replace("$1",H):q.name:H,y=this._createNewSocketConnection(u);if((q&&q.LM&&s.kf.find((K=>K.className===q.LM))||s.kf[0]).dataInputs.push(y),void 0!==M.value){const H=this._parseVariable(M,q&&q.dataTransformer);K._connectionValues[y.uniqueId]=H}else{if("undefined"===typeof M.node)throw O.e.Error(["Invalid value for value connection",M]),new Error("Error parsing node connections");{var v,L,S;const K=M.node,H=M.socket||"value",q=this._nodes[K];if(!q)throw O.e.Error(["No node found for output socket reference",M]),new Error("Error parsing node connections");const w=DM(q.fullOperationName);if(!w)throw O.e.Error(["No mapping found for output socket reference",M]),new Error("Error parsing node connections");let u=null===(v=w.outputs)||void 0===v||null===(L=v.values)||void 0===L?void 0:L[H],h=!1;if(!u)for(const M in null===(B=w.outputs)||void 0===B?void 0:B.values){var B,C,i;if(M.startsWith("[")&&M.endsWith("]"))h=!0,u=null===(C=w.outputs)||void 0===C||null===(i=C.values)||void 0===i?void 0:i[M]}const W=u?h?u.name.replace("$1",H):null===(S=u)||void 0===S?void 0:S.name:H,I=u&&u.LM&&q.kf.find((K=>K.className===u.LM))||q.kf[0];let f=I.dataOutputs.find((K=>K.name===W));f||(f=this._createNewSocketConnection(W,!0),I.dataOutputs.push(f)),y.connectedPointIds.push(f.uniqueId),f.connectedPointIds.push(y.uniqueId)}}}if(D.flowGraphMapping.interBlockConnectors)for(const K of D.flowGraphMapping.interBlockConnectors){const H=K.input,M=K.output,q=K.isVariable;this._connectFlowGraphNodes(H,M,s.kf[K.inputBlockIndex],s.kf[K.outputBlockIndex],q)}if(D.flowGraphMapping.extraProcessor){var Z;const H=null===(Z=this._interactivityGraph.declarations)||void 0===Z?void 0:Z[l.declaration];if(!H)throw O.e.Error(["No declaration found for extra processor",l]),new Error("Error parsing node connections");s.kf=D.flowGraphMapping.extraProcessor(l,H,D.flowGraphMapping,this,s.kf,K,this._gltf)}}}_createNewSocketConnection(K,H){return{uniqueId:(0,xM.c)(),name:K,_connectionType:H?1:0,connectedPointIds:[]}}_connectFlowGraphNodes(K,H,M,q,w){const u=w?M.dataInputs:M.signalInputs,y=w?q.dataOutputs:q.signalOutputs,h=u.find((H=>H.name===K))||this._createNewSocketConnection(K),W=y.find((K=>K.name===H))||this._createNewSocketConnection(H,!0);u.find((H=>H.name===K))||u.push(h),y.find((K=>K.name===H))||y.push(W),h.connectedPointIds.push(W.uniqueId),W.connectedPointIds.push(h.uniqueId)}getVariableName(K){return"staticVariable_"+K}serializeToFlowGraph(){const K={uniqueId:(0,xM.c)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(K);for(let H=0;H<this._staticVariables.length;H++){const M=this._staticVariables[H];K._userVariables[this.getVariableName(H)]=M}return{rightHanded:!0,allBlocks:this._nodes.reduce(((K,H)=>K.concat(H.kf)),[]),executionContexts:[K]}}}const NM="KHR_interactivity";class pM{constructor(K){this._loader=K,this.name=NM,this.enabled=this._loader.isExtensionUsed(NM),this._pathConverter=(0,o.i)(this._loader.wh),K._skipStartAnimationStep=!0;const H=K.babylonScene;H&&function(K){(0,o.c)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:()=>{if(!K.activeCamera)return new w.Quaternion(NaN,NaN,NaN,NaN);const H=w.Quaternion.FromRotationMatrix(K.activeCamera.getWorldMatrix()).normalize();return K.useRightHandedSystem||(H.w*=-1,H.x*=-1),H},type:"Quaternion",getTarget:()=>K.activeCamera}),(0,o.c)("/extensions/KHR_interactivity/?/activeCamera/position",{get:()=>{if(!K.activeCamera)return new w.OH(NaN,NaN,NaN);const H=K.activeCamera.getWorldMatrix().getTranslation();return K.useRightHandedSystem||(H.x*=-1),H},type:"OH",getTarget:()=>K.activeCamera}),(0,o.c)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:K=>{var H;return(null===(H=K._babylonAnimationGroup)||void 0===H?void 0:H.isPlaying)??!1},type:"boolean",getTarget:K=>K._babylonAnimationGroup}),(0,o.c)("/animations/{}/extensions/KHR_interactivity/minTime",{get:K=>{var H;return((null===(H=K._babylonAnimationGroup)||void 0===H?void 0:H.from)??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,o.c)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:K=>{var H;return((null===(H=K._babylonAnimationGroup)||void 0===H?void 0:H.to)??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,o.c)("/animations/{}/extensions/KHR_interactivity/playhead",{get:K=>{var H;return((null===(H=K._babylonAnimationGroup)||void 0===H?void 0:H.getCurrentFrame())??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup}),(0,o.c)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:K=>{var H;return((null===(H=K._babylonAnimationGroup)||void 0===H?void 0:H.getCurrentFrame())??0)/60},type:"number",getTarget:K=>K._babylonAnimationGroup})}(H)}dispose(){this._loader=null,delete this._pathConverter}async onReady(){var K;if(!this._loader.babylonScene||!this._pathConverter)return;const H=this._loader.babylonScene,M=null===(K=this._loader.wh.extensions)||void 0===K?void 0:K.KHR_interactivity;if(!M)return;const q=new vM.d({SH:H});q.dispatchEventsSynchronously=!1;const w=M.graphs.map((K=>new JM(K,this._loader.wh,this._loader.parent.targetFps).serializeToFlowGraph()));await Promise.all(w.map((async K=>await EM(K,{coordinator:q,pathConverter:this._pathConverter})))),q.start()}}var oM;oM=async()=>(await Promise.resolve().then(M.bind(M,13058))).FlowGraphGLTFDataProvider,OM[`${NM}/${"FlowGraphGLTFDataProvider"}`]=oM,p(NM),N(NM,!0,(K=>new pM(K)));const RM="KHR_node_visibility";(0,o.c)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:K=>{const H=K._babylonTransformNode;return!H||void 0===H.isVisible||H.isVisible},set:(K,H)=>{var M,q;null===(M=H._primitiveBabylonMeshes)||void 0===M||M.forEach((K=>{K.inheritVisibility=!0})),H._babylonTransformNode&&(H._babylonTransformNode.isVisible=K),null===(q=H._primitiveBabylonMeshes)||void 0===q||q.forEach((H=>{H.isVisible=K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"isVisible"],type:"boolean"});class tM{constructor(K){this.name=RM,this._loader=K,this.enabled=K.isExtensionUsed(RM)}async onReady(){var K;null===(K=this._loader.wh.nodes)||void 0===K||K.forEach((K=>{var H,M,q,w;(null===(H=K._primitiveBabylonMeshes)||void 0===H||H.forEach((K=>{K.inheritVisibility=!0})),null!==(M=K.extensions)&&void 0!==M&&M.KHR_node_visibility)&&(!1===(null===(q=K.extensions)||void 0===q?void 0:q.KHR_node_visibility.visible)&&(K._babylonTransformNode&&(K._babylonTransformNode.isVisible=!1),null===(w=K._primitiveBabylonMeshes)||void 0===w||w.forEach((K=>{K.isVisible=!1}))))}))}dispose(){this._loader=null}}p(RM),N(RM,!0,(K=>new tM(K)));const UM="KHR_node_selectability";nM("event/onSelect",UM,{kf:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",LM:"FlowGraphGetVariableBlock",dataTransformer:K=>["pickedMesh_"+K[0]]}},outputs:{values:{selectedNodeIndex:{name:"index",LM:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,H,M,q,w,u,y){var h,W,I,f,z,G;const a=w[w.length-1];a.config=a.config||{},a.config.glTF=y;const v=null===(h=K.configuration)||void 0===h||null===(W=h.nodeIndex)||void 0===W?void 0:W.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const O="pickedMesh_"+v;return w[1].config.variable=O,u._userVariables[O]={className:"Mesh",id:null===y||void 0===y||null===(I=y.nodes)||void 0===I||null===(f=I[v]._babylonTransformNode)||void 0===f?void 0:f.id,uniqueId:null===y||void 0===y||null===(z=y.nodes)||void 0===z||null===(G=z[v]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},w}}),(0,o.c)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:K=>{const H=K._babylonTransformNode;return!H||void 0===H.mW||H.mW},set:(K,H)=>{var M;null===(M=H._primitiveBabylonMeshes)||void 0===M||M.forEach((H=>{H.mW=K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"mW"],type:"boolean"});class jM{constructor(K){this.name=UM,this._loader=K,this.enabled=K.isExtensionUsed(UM)}async onReady(){var K;null===(K=this._loader.wh.nodes)||void 0===K||K.forEach((K=>{var H,M,q;null!==(H=K.extensions)&&void 0!==H&&H.KHR_node_selectability&&!1===(null===(M=K.extensions)||void 0===M?void 0:M.KHR_node_selectability.selectable)&&(null===(q=K._babylonTransformNode)||void 0===q||q.getChildMeshes().forEach((K=>{K.mW=!1})))}))}dispose(){this._loader=null}}p(UM),N(UM,!0,(K=>new jM(K)));const mM="KHR_node_hoverability",FM="targetMeshPointerOver_";nM("event/onHoverIn",mM,{kf:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",LM:"FlowGraphGetVariableBlock",dataTransformer:K=>[FM+K[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",LM:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,H,M,q,w,u,y){var h,W,I,f,z,G;const a=w[w.length-1];a.config=a.config||{},a.config.glTF=y;const v=null===(h=K.configuration)||void 0===h||null===(W=h.nodeIndex)||void 0===W?void 0:W.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const O=FM+v;return w[1].config.variable=O,u._userVariables[O]={className:"Mesh",id:null===y||void 0===y||null===(I=y.nodes)||void 0===I||null===(f=I[v]._babylonTransformNode)||void 0===f?void 0:f.id,uniqueId:null===y||void 0===y||null===(z=y.nodes)||void 0===z||null===(G=z[v]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},w}});const YM="targetMeshPointerOut_";nM("event/onHoverOut",mM,{kf:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",LM:"FlowGraphGetVariableBlock",dataTransformer:K=>[YM+K[0]]}},outputs:{values:{hoverNodeIndex:{name:"index",LM:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor(K,H,M,q,w,u,y){var h,W,I,f,z,G;const a=w[w.length-1];a.config=a.config||{},a.config.glTF=y;const v=null===(h=K.configuration)||void 0===h||null===(W=h.nodeIndex)||void 0===W?void 0:W.value[0];if(void 0===v||"number"!==typeof v)throw new Error("nodeIndex not found in configuration");const O=YM+v;return w[1].config.variable=O,u._userVariables[O]={className:"Mesh",id:null===y||void 0===y||null===(I=y.nodes)||void 0===I||null===(f=I[v]._babylonTransformNode)||void 0===f?void 0:f.id,uniqueId:null===y||void 0===y||null===(z=y.nodes)||void 0===z||null===(G=z[v]._babylonTransformNode)||void 0===G?void 0:G.uniqueId},w}}),(0,o.c)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:K=>{const H=K._babylonTransformNode;return!H||void 0===H.pointerOverDisableMeshTesting||H.pointerOverDisableMeshTesting},set:(K,H)=>{var M;null===(M=H._primitiveBabylonMeshes)||void 0===M||M.forEach((H=>{H.pointerOverDisableMeshTesting=!K}))},getTarget:K=>K._babylonTransformNode,getPropertyName:[()=>"pointerOverDisableMeshTesting"],type:"boolean"});class rM{constructor(K){this.name=mM,this._loader=K,this.enabled=K.isExtensionUsed(mM)}async onReady(){var K;null===(K=this._loader.wh.nodes)||void 0===K||K.forEach((K=>{var H,M,q;null!==(H=K.extensions)&&void 0!==H&&H.KHR_node_hoverability&&!1===(null===(M=K.extensions)||void 0===M?void 0:M.KHR_node_hoverability.hoverable)&&(null===(q=K._babylonTransformNode)||void 0===q||q.getChildMeshes().forEach((K=>{K.pointerOverDisableMeshTesting=!0})))}))}dispose(){this._loader=null}}p(mM),N(mM,!0,(K=>new rM(K)));const eM="ExtrasAsMetadata";class bM{_assignExtras(K,H){if(H.extras&&Object.keys(H.extras).length>0){const M=K.metadata=K.metadata||{};(M.wh=M.wh||{}).extras=H.extras}}constructor(K){this.name=eM,this.enabled=!0,this._loader=K}dispose(){this._loader=null}loadNodeAsync(K,H,M){return this._loader.loadNodeAsync(K,H,(K=>{this._assignExtras(K,H),M(K)}))}loadCameraAsync(K,H,M){return this._loader.loadCameraAsync(K,H,(K=>{this._assignExtras(K,H),M(K)}))}createMaterial(K,H,M){const q=this._loader.createMaterial(K,H,M);return this._assignExtras(q,H),q}}p(eM),N(eM,!1,(K=>new bM(K)));M(13058)},12923:(K,H,M)=>{"use strict";M.d(H,{c:()=>d,g:()=>D,j:()=>s,n:()=>V});var q=M(11102),w=M(11100),u=M(12587),y=M(11726),h=M(11697),W=M(11712),I=M(11112),f=M(11143),z=M(11722),G=M(11824),a=M(11733),v=M(11327);class O{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.CG=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Ha=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(K){this._environmentTexture=K}getNodes(){let K=[];K=K.concat(this.meshes),K=K.concat(this.lights),K=K.concat(this.cameras),K=K.concat(this.transformNodes);for(const H of this.skeletons)K=K.concat(H.bones);return K}}class L extends O{}class S{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){const K=this.rootNodes;for(const q of K)q.dispose();K.length=0;const H=this.skeletons;for(const q of H)q.dispose();H.length=0;const M=this.animationGroups;for(const q of M)q.dispose();M.length=0}}class B extends O{constructor(K){super(),this._wasAddedToScene=!1,(K=K||f.b.LastCreatedScene)&&(this.SH=K,this.proceduralTextures=[],K.Hh.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=K.getEngine().onContextRestoredObservable.add((()=>{for(const K of this.geometries)K._rebuild();for(const K of this.meshes)K._rebuild();for(const K of this.CG)K.rebuild();for(const K of this.textures)K._rebuild()})))}_topologicalSort(K){const H=new Map;for(const y of K)H.set(y.uniqueId,y);const M={dependsOn:new Map,dependedBy:new Map};for(const y of K){const K=y.uniqueId;M.dependsOn.set(K,new Set),M.dependedBy.set(K,new Set)}for(const y of K){const K=y.uniqueId,q=M.dependsOn.get(K);if(y instanceof z.b){const w=y.sourceMesh;H.has(w.uniqueId)&&(q.add(w.uniqueId),M.dependedBy.get(w.uniqueId).add(K))}const w=M.dependedBy.get(K);for(const u of y.getDescendants()){const q=u.uniqueId;if(H.has(q)){w.add(q);M.dependsOn.get(q).add(K)}}}const q=[],w=[];for(const y of K){const K=y.uniqueId;0===M.dependsOn.get(K).size&&(w.push(y),H.delete(K))}const u=w;for(;u.length>0;){const K=u.shift();q.push(K);const w=M.dependedBy.get(K.uniqueId);for(const q of Array.from(w.values())){const w=M.dependsOn.get(q);w.delete(K.uniqueId),0===w.size&&H.get(q)&&(u.push(H.get(q)),H.delete(q))}}return H.size>0&&(I.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),H.forEach((K=>{I.e.Error(K.name)}))),q}_addNodeAndDescendantsToList(K,H,M,q){if(M&&(!q||q(M))&&!H.has(M.uniqueId)){K.push(M),H.add(M.uniqueId);for(const w of M.getDescendants(!0))this._addNodeAndDescendantsToList(K,H,w,q)}}_isNodeInContainer(K){return K instanceof W.c&&-1!==this.meshes.indexOf(K)||(K instanceof h.e&&-1!==this.transformNodes.indexOf(K)||(K instanceof G.e&&-1!==this.lights.indexOf(K)||K instanceof a.b&&-1!==this.cameras.indexOf(K)))}_isValidHierarchy(){for(const K of this.meshes)if(K.parent&&!this._isNodeInContainer(K.parent))return I.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.transformNodes)if(K.parent&&!this._isNodeInContainer(K.parent))return I.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.lights)if(K.parent&&!this._isNodeInContainer(K.parent))return I.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.cameras)if(K.parent&&!this._isNodeInContainer(K.parent))return I.e.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(K){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],M=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const q={},u={},h=new S,W=[],I=[],f={doNotInstantiate:!0,...M},z=[],G=new Set;for(const w of this.transformNodes)null===w.parent&&this._addNodeAndDescendantsToList(z,G,w,f.predicate);for(const w of this.meshes)null===w.parent&&this._addNodeAndDescendantsToList(z,G,w,f.predicate);const a=this._topologicalSort(z),v=(M,w)=>{if(((H,M)=>{if(q[H.uniqueId]=M.uniqueId,u[M.uniqueId]=M,K&&(M.name=K(H.name)),M instanceof y.b){const K=M;if(K.morphTargetManager){const M=H.morphTargetManager;K.morphTargetManager=M.clone();for(let H=0;H<M.numTargets;H++){const w=M.getTarget(H),y=K.morphTargetManager.getTarget(H);q[w.uniqueId]=y.uniqueId,u[y.uniqueId]=y}}}})(M,w),M.parent){const K=q[M.parent.uniqueId],H=u[K];w.parent=H||M.parent}if(w.position&&M.position&&w.position.q(M.position),w.rotationQuaternion&&M.rotationQuaternion&&w.rotationQuaternion.q(M.rotationQuaternion),w.rotation&&M.rotation&&w.rotation.q(M.rotation),w.Sh&&M.Sh&&w.Sh.q(M.Sh),w.material){const y=w;if(y.material)if(H){const H=M.material;if(-1===I.indexOf(H)){let M=H.clone(K?K(H.name):"Clone of "+H.name);if(I.push(H),q[H.uniqueId]=M.uniqueId,u[M.uniqueId]=M,"MultiMaterial"===H.getClassName()){const w=H;for(const H of w.ih)H&&(M=H.clone(K?K(H.name):"Clone of "+H.name),I.push(H),q[H.uniqueId]=M.uniqueId,u[M.uniqueId]=M);w.ih=w.ih.map((K=>K&&u[q[K.uniqueId]]))}}"InstancedMesh"!==y.getClassName()&&(y.material=u[q[H.uniqueId]])}else"MultiMaterial"===y.material.getClassName()?-1===this.SH.multiMaterials.indexOf(y.material)&&this.SH.addMultiMaterial(y.material):-1===this.SH.materials.indexOf(y.material)&&this.SH.addMaterial(y.material)}null===w.parent&&h.rootNodes.push(w)};for(const w of a)if("InstancedMesh"===w.getClassName()){const K=w,H=K.sourceMesh,M=q[H.uniqueId];v(K,("number"===typeof M?u[M]:H).createInstance(K.name))}else{let K=!0;"mh"===w.getClassName()||"Node"===w.getClassName()||w.skeleton||!w.getTotalVertices||0===w.getTotalVertices()?K=!1:f.doNotInstantiate&&(K="function"===typeof f.doNotInstantiate?!f.doNotInstantiate(w):!f.doNotInstantiate);const H=K?w.createInstance(`instance of ${w.name}`):w.clone(`Clone of ${w.name}`,null,!0);if(!H)throw new Error(`Could not clone or instantiate node on Asset Container ${w.name}`);v(w,H)}for(const w of this.skeletons){if(f.predicate&&!f.predicate(w))continue;const H=w.clone(K?K(w.name):"Clone of "+w.name);for(const K of this.meshes)if(K.skeleton===w&&!K.isAnInstance){const M=u[q[K.uniqueId]];if(!M||M.isAnInstance)continue;if(M.skeleton=H,-1!==W.indexOf(H))continue;W.push(H);for(const K of H.bones)K._linkedTransformNode&&(K._linkedTransformNode=u[q[K._linkedTransformNode.uniqueId]])}h.skeletons.push(H)}for(const w of this.animationGroups){if(f.predicate&&!f.predicate(w))continue;const H=w.clone(K?K(w.name):"Clone of "+w.name,(K=>u[q[K.uniqueId]]||K));h.animationGroups.push(H)}return h}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.SH.environmentTexture=this.environmentTexture);for(const K of this.SH._serializableComponents)K.addFromContainer(this);this.SH.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const H=[];for(const M of this.cameras)K&&!K(M)||(this.SH.addCamera(M),H.push(M));for(const M of this.lights)K&&!K(M)||(this.SH.addLight(M),H.push(M));for(const M of this.meshes)K&&!K(M)||(this.SH.af(M),H.push(M));for(const M of this.skeletons)K&&!K(M)||this.SH.addSkeleton(M);for(const M of this.animations)K&&!K(M)||this.SH.addAnimation(M);for(const M of this.animationGroups)K&&!K(M)||this.SH.addAnimationGroup(M);for(const M of this.multiMaterials)K&&!K(M)||this.SH.addMultiMaterial(M);for(const M of this.materials)K&&!K(M)||this.SH.addMaterial(M);for(const M of this.morphTargetManagers)K&&!K(M)||this.SH.addMorphTargetManager(M);for(const M of this.geometries)K&&!K(M)||this.SH.addGeometry(M);for(const M of this.transformNodes)K&&!K(M)||(this.SH.addTransformNode(M),H.push(M));for(const M of this.actionManagers)K&&!K(M)||this.SH.addActionManager(M);for(const M of this.textures)K&&!K(M)||this.SH.addTexture(M);for(const M of this.reflectionProbes)K&&!K(M)||this.SH.addReflectionProbe(M);for(const M of H)M.parent&&-1===this.SH.getNodes().indexOf(M.parent)&&(M.setParent?M.setParent(null):M.parent=null)}removeAllFromScene(){this._isValidHierarchy()||w.Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.SH.environmentTexture&&(this.SH.environmentTexture=null);for(const K of this.SH._serializableComponents)K.removeFromContainer(this)}removeFromScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;for(const H of this.cameras)K&&!K(H)||this.SH.removeCamera(H);for(const H of this.lights)K&&!K(H)||this.SH.removeLight(H);for(const H of this.meshes)K&&!K(H)||this.SH.zf(H,!0);for(const H of this.skeletons)K&&!K(H)||this.SH.removeSkeleton(H);for(const H of this.animations)K&&!K(H)||this.SH.removeAnimation(H);for(const H of this.animationGroups)K&&!K(H)||this.SH.removeAnimationGroup(H);for(const H of this.multiMaterials)K&&!K(H)||this.SH.removeMultiMaterial(H);for(const H of this.materials)K&&!K(H)||this.SH.removeMaterial(H);for(const H of this.morphTargetManagers)K&&!K(H)||this.SH.removeMorphTargetManager(H);for(const H of this.geometries)K&&!K(H)||this.SH.removeGeometry(H);for(const H of this.transformNodes)K&&!K(H)||this.SH.removeTransformNode(H);for(const H of this.actionManagers)K&&!K(H)||this.SH.removeActionManager(H);for(const H of this.textures)K&&!K(H)||this.SH.removeTexture(H);for(const H of this.reflectionProbes)K&&!K(H)||this.SH.removeReflectionProbe(H)}dispose(){const K=this.cameras.slice(0);for(const a of K)a.dispose();this.cameras.length=0;const H=this.lights.slice(0);for(const a of H)a.dispose();this.lights.length=0;const M=this.meshes.slice(0);for(const a of M)a.dispose();this.meshes.length=0;const q=this.skeletons.slice(0);for(const a of q)a.dispose();this.skeletons.length=0;const w=this.animationGroups.slice(0);for(const a of w)a.dispose();this.animationGroups.length=0;const u=this.multiMaterials.slice(0);for(const a of u)a.dispose();this.multiMaterials.length=0;const y=this.materials.slice(0);for(const a of y)a.dispose();this.materials.length=0;const h=this.geometries.slice(0);for(const a of h)a.dispose();this.geometries.length=0;const W=this.transformNodes.slice(0);for(const a of W)a.dispose();this.transformNodes.length=0;const I=this.actionManagers.slice(0);for(const a of I)a.dispose();this.actionManagers.length=0;const f=this.textures.slice(0);for(const a of f)a.dispose();this.textures.length=0;const z=this.reflectionProbes.slice(0);for(const a of z)a.dispose();this.reflectionProbes.length=0;const G=this.morphTargetManagers.slice(0);for(const a of G)a.dispose();this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const a of this.SH._serializableComponents)a.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.SH.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(K,H,M){if(K&&H)for(const q of K){let K=!0;if(M)for(const H of M)if(q===H){K=!1;break}K&&(H.push(q),q._parentContainer=this)}}moveAllFromScene(K){this._wasAddedToScene=!1,void 0===K&&(K=new L);for(const H in this)Object.prototype.hasOwnProperty.call(this,H)&&(this[H]=this[H]||("_environmentTexture"===H?null:[]),this._moveAssets(this.SH[H],this[H],K[H]));this.environmentTexture=this.SH.environmentTexture,this.removeAllFromScene()}createRootMesh(){const K=new y.b("assetContainerRootMesh",this.SH);for(const H of this.meshes)H.parent||K.addChild(H);return this.meshes.unshift(K),K}mergeAnimationsTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.b.LastCreatedScene,H=arguments.length>1?arguments[1]:void 0,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!K)return I.e.Error("No scene available to merge animations to"),[];const q=M||(H=>{let M=null;const q=H.animations.length?H.animations[0].targetProperty:"",w=H.name.split(".").join("").split("_primitive")[0];switch(q){case"position":case"rotationQuaternion":M=K.getTransformNodeByName(H.name)||K.getTransformNodeByName(w);break;case"influence":M=K.getMorphTargetByName(H.name)||K.getMorphTargetByName(w);break;default:M=K.getNodeByName(H.name)||K.getNodeByName(w)}return M}),w=this.getNodes();for(const h of w){const K=q(h);if(null!==K){for(const H of h.animations){const M=K.animations.filter((K=>K.targetProperty===H.targetProperty));for(const H of M){const M=K.animations.indexOf(H,0);M>-1&&K.animations.splice(M,1)}}K.animations=K.animations.concat(h.animations)}}const u=[],y=this.animationGroups.slice();for(const h of y){u.push(h.clone(h.name,q));for(const K of h.animatables)K.stop()}for(const h of H){const H=q(h.target);H&&(K.beginAnimation(H,h.fromFrame,h.toFrame,h.loopAnimation,h.speedRatio,h.onAnimationEnd?h.onAnimationEnd:void 0,void 0,!0,void 0,h.onAnimationLoop?h.onAnimationLoop:void 0),K.stopAnimation(h.target))}return u}populateRootNodes(){this.rootNodes.length=0;for(const K of this.meshes)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.transformNodes)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.lights)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K);for(const K of this.cameras)K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)}addAllAssetsToContainer(K){if(!K)return;const H=[],M=new Set;for(H.push(K);H.length>0;){const K=H.pop();if(K instanceof y.b?(K.Gh&&-1===this.geometries.indexOf(K.Gh)&&this.geometries.push(K.Gh),this.meshes.push(K)):K instanceof z.b?this.meshes.push(K):K instanceof h.e?this.transformNodes.push(K):K instanceof G.e?this.lights.push(K):K instanceof a.b&&this.cameras.push(K),K instanceof W.c){if(K.material&&-1===this.materials.indexOf(K.material)){this.materials.push(K.material);for(const H of K.material.getActiveTextures())-1===this.textures.indexOf(H)&&this.textures.push(H)}K.skeleton&&-1===this.skeletons.indexOf(K.skeleton)&&this.skeletons.push(K.skeleton),K.morphTargetManager&&-1===this.morphTargetManagers.indexOf(K.morphTargetManager)&&this.morphTargetManagers.push(K.morphTargetManager)}for(const q of K.getChildren())M.has(q)||H.push(q);M.add(K)}this.populateRootNodes()}_getByTags(K,H,M){if(void 0===H)return K;const q=[];for(const w in K){const u=K[w];v.d&&v.d.MatchesQuery(u,H)&&(!M||M(u))&&q.push(u)}return q}getMeshesByTags(K,H){return this._getByTags(this.meshes,K,H)}getCamerasByTags(K,H){return this._getByTags(this.cameras,K,H)}getLightsByTags(K,H){return this._getByTags(this.lights,K,H)}getMaterialsByTags(K,H){return this._getByTags(this.materials,K,H).concat(this._getByTags(this.multiMaterials,K,H))}getTransformNodesByTags(K,H){return this._getByTags(this.transformNodes,K,H)}}var C=M(11164);class i{constructor(K){this.byteOffset=0,this.buffer=K}async loadAsync(K){const H=await this.buffer.readAsync(this.byteOffset,K);this._dataView=new DataView(H.buffer,H.byteOffset,H.byteLength),this._dataByteOffset=0}readUint32(){const K=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,K}readUint8Array(K){const H=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,K);return this._dataByteOffset+=K,this.byteOffset+=K,H}readString(K){return(0,C.k)(this.readUint8Array(K))}skipBytes(K){this._dataByteOffset+=K,this.byteOffset+=K}}var Z=M(12931);const E="Z2xURg",l={name:"wh",extensions:{".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}},canDirectLoad:K=>-1!==K.indexOf("asset")&&-1!==K.indexOf("version")||K.startsWith("data:base64,"+E)||K.startsWith("data:;base64,"+E)||K.startsWith("data:application/octet-stream;base64,"+E)||K.startsWith("data:model/gltf-binary;base64,"+E)};var s,D,V,n=M(11152),c=M(11159);function k(K,H,M){try{return Promise.resolve(new Uint8Array(K,H,M))}catch(q){return Promise.reject(q)}}!function(K){K[K.AUTO=0]="AUTO",K[K.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(s||(s={})),function(K){K[K.NONE=0]="NONE",K[K.FIRST=1]="FIRST",K[K.ALL=2]="ALL"}(D||(D={})),function(K){K[K.LOADING=0]="LOADING",K[K.READY=1]="READY",K[K.COMPLETE=2]="COMPLETE"}(V||(V={}));class T{constructor(){this.coordinateSystemMode=s.AUTO,this.animationStartMode=D.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=K=>Promise.resolve(K),this.extensionOptions={}}q(K){K&&(this.onParsed=K.onParsed,this.coordinateSystemMode=K.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=K.animationStartMode??this.animationStartMode,this.loadNodeAnimations=K.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=K.loadSkins??this.loadSkins,this.loadMorphTargets=K.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=K.compileMaterials??this.compileMaterials,this.useClipPlane=K.useClipPlane??this.useClipPlane,this.compileShadowGenerators=K.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=K.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=K.useRangeRequests??this.useRangeRequests,this.createInstances=K.createInstances??this.createInstances,this.alwaysComputeBoundingBox=K.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=K.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=K.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=K.skipMaterials??this.skipMaterials,this.useSRGBBuffers=K.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=K.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=K.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=K.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=K.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=K.customRootNode,this.onMeshLoaded=K.onMeshLoaded,this.onSkinLoaded=K.onSkinLoaded,this.onTextureLoaded=K.onTextureLoaded,this.onMaterialLoaded=K.onMaterialLoaded,this.onCameraLoaded=K.onCameraLoaded,this.extensionOptions=K.extensionOptions??this.extensionOptions)}}class d extends T{constructor(K){super(),this.onParsedObservable=new q.d,this.onMeshLoadedObservable=new q.d,this.onSkinLoadedObservable=new q.d,this.onTextureLoadedObservable=new q.d,this.onMaterialLoadedObservable=new q.d,this.onCameraLoadedObservable=new q.d,this.onCompleteObservable=new q.d,this.onErrorObservable=new q.d,this.Hh=new q.d,this.onExtensionLoadedObservable=new q.d,this.validate=!1,this.onValidatedObservable=new q.d,this._loader=null,this._state=null,this._requests=new Array,this.name=l.name,this.extensions=l.extensions,this.onLoaderStateChangedObservable=new q.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.q(K)}set onParsed(K){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),K&&(this._onParsedObserver=this.onParsedObservable.add(K))}set onMeshLoaded(K){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),K&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(K))}set onSkinLoaded(K){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),K&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((H=>K(H.node,H.skinnedNode))))}set onTextureLoaded(K){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),K&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(K))}set onMaterialLoaded(K){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),K&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(K))}set onCameraLoaded(K){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),K&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(K))}set onComplete(K){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(K)}set onError(K){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(K)}set onDispose(K){this._onDisposeObserver&&this.Hh.remove(this._onDisposeObserver),this._onDisposeObserver=this.Hh.add(K)}set onExtensionLoaded(K){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(K)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(K){this._loggingEnabled!==K&&(this._loggingEnabled=K,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(K){this._capturePerformanceCounters!==K&&(this._capturePerformanceCounters=K,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(K){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(K)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const K of this._requests)K.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=K=>Promise.resolve(K),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Hh.notifyObservers(void 0),this.Hh.clear()}loadFile(K,H,M,u,y,h,W,f){if(ArrayBuffer.isView(H))return this._loadBinary(K,H,M,u,W,f),null;this._progressCallback=y;const z=H.name||w.Tools.GetFilename(H);if(h){if(this.useRangeRequests){this.validate&&I.e.Warn("glTF validation is not supported when range requests are enabled");const M={abort:()=>{},onCompleteObservable:new q.d},w={readAsync:(M,q)=>new Promise(((w,u)=>{this._loadFile(K,H,(K=>{w(new Uint8Array(K))}),!0,(K=>{u(K)}),(K=>{K.setRequestHeader("Range",`bytes=${M}-${M+q-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new i(w)).then((K=>{M.onCompleteObservable.notifyObservers(M),u(K)}),W?K=>W(void 0,K):void 0),M}return this._loadFile(K,H,(H=>{this._validate(K,new Uint8Array(H,0,H.byteLength),M,z),this._unpackBinaryAsync(new i({readAsync:(K,M)=>k(H,K,M),byteLength:H.byteLength})).then((K=>{u(K)}),W?K=>W(void 0,K):void 0)}),!0,W)}return this._loadFile(K,H,(H=>{try{this._validate(K,H,M,z),u({json:this._parseJson(H)})}catch{W&&W()}}),!1,W)}_loadBinary(K,H,M,q,w,u){this._validate(K,new Uint8Array(H.buffer,H.byteOffset,H.byteLength),M,u),this._unpackBinaryAsync(new i({readAsync:(K,M)=>function(K,H,M){try{if(H<0||H>=K.byteLength)throw new RangeError("Offset is out of range.");if(H+M>K.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(K.buffer,K.byteOffset+H,M))}catch(q){return Promise.reject(q)}}(H,K,M),byteLength:H.byteLength})).then((K=>{q(K)}),w?K=>w(void 0,K):void 0)}importMeshAsync(K,H,M,q,w,u){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(M),this.onParsedObservable.clear(),this._log(`Loading ${u||""}`),this._loader=this._getLoader(M),this._loader.importMeshAsync(K,H,null,M,q,w,u))))}loadAsync(K,H,M,q,w){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(H),this._loader.loadAsync(K,H,M,q,w))))}loadAssetContainerAsync(K,H,M,q,w){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(H),this.onParsedObservable.clear(),this._log(`Loading ${w||""}`),this._loader=this._getLoader(H);const u=new B(K),y=[];this.onMaterialLoadedObservable.add((K=>{y.push(K)}));const h=[];this.onTextureLoadedObservable.add((K=>{h.push(K)}));const W=[];this.onCameraLoadedObservable.add((K=>{W.push(K)}));const I=[];return this.onMeshLoadedObservable.add((K=>{K.morphTargetManager&&I.push(K.morphTargetManager)})),this._loader.importMeshAsync(null,K,u,H,M,q,w).then((K=>(Array.prototype.push.apply(u.geometries,K.geometries),Array.prototype.push.apply(u.meshes,K.meshes),Array.prototype.push.apply(u.CG,K.CG),Array.prototype.push.apply(u.skeletons,K.skeletons),Array.prototype.push.apply(u.animationGroups,K.animationGroups),Array.prototype.push.apply(u.materials,y),Array.prototype.push.apply(u.textures,h),Array.prototype.push.apply(u.lights,K.lights),Array.prototype.push.apply(u.transformNodes,K.transformNodes),Array.prototype.push.apply(u.cameras,W),Array.prototype.push.apply(u.morphTargetManagers,I),u)))}))}canDirectLoad(K){return l.canDirectLoad(K)}directLoad(K,H){if(H.startsWith("base64,"+E)||H.startsWith(";base64,"+E)||H.startsWith("application/octet-stream;base64,"+E)||H.startsWith("model/gltf-binary;base64,"+E)){const M=(0,n.d)(H);return this._validate(K,new Uint8Array(M,0,M.byteLength)),this._unpackBinaryAsync(new i({readAsync:(K,H)=>k(M,K,H),byteLength:M.byteLength}))}return this._validate(K,H),Promise.resolve({json:this._parseJson(H)})}createPlugin(K){return new d(K[l.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((K,H)=>{this.onCompleteObservable.addOnce((()=>{K()})),this.onErrorObservable.addOnce((K=>{H(K)}))}))}_setState(K){this._state!==K&&(this._state=K,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(V[this._state]))}_loadFile(K,H,M,q,w,u){const y=K._loadFile(H,M,(K=>{this._onProgress(K,y)}),!0,q,w,u);return y.onCompleteObservable.add((()=>{y._lengthComputable=!0,y._total=y._loaded})),this._requests.push(y),y}_onProgress(K,H){if(!this._progressCallback)return;H._lengthComputable=K.lengthComputable,H._loaded=K.loaded,H._total=K.total;let M=!0,q=0,w=0;for(const u of this._requests){if(void 0===u._lengthComputable||void 0===u._loaded||void 0===u._total)return;M=M&&u._lengthComputable,q+=u._loaded,w+=u._total}this._progressCallback({lengthComputable:M,loaded:q,total:M?w:0})}_validate(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),Z.d.ValidateAsync(H,M,q,(H=>this.preprocessUrlAsync(M+H).then((H=>K._loadFileAsync(H,void 0,!0,!0).then((K=>new Uint8Array(K,0,K.byteLength))))))).then((K=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(K),this.onValidatedObservable.clear()}),(K=>{this._endPerformanceCounter("Validate JSON"),w.Tools.Warn(`Failed to validate: ${K.message}`),this.onValidatedObservable.clear()})))}_getLoader(K){const H=K.json.asset||{};this._log(`Asset version: ${H.version}`),H.minVersion&&this._log(`Asset minimum version: ${H.minVersion}`),H.generator&&this._log(`Asset generator: ${H.generator}`);const M=d._parseVersion(H.version);if(!M)throw new Error("Invalid version: "+H.version);if(void 0!==H.minVersion){const K=d._parseVersion(H.minVersion);if(!K)throw new Error("Invalid minimum version: "+H.minVersion);if(d._compareVersion(K,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+H.minVersion)}const q={1:d._CreateGLTF1Loader,2:d._CreateGLTF2Loader}[M.major];if(!q)throw new Error("Unsupported version: "+H.version);return q(this)}_parseJson(K){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${K.length}`);const H=JSON.parse(K);return this._endPerformanceCounter("Parse JSON"),H}_unpackBinaryAsync(K){return this._startPerformanceCounter("Unpack Binary"),K.loadAsync(20).then((()=>{const H=K.readUint32();if(1179937895!==H)throw new c.e("Unexpected magic: "+H,c.c.GLTFLoaderUnexpectedMagicError);const M=K.readUint32();this.loggingEnabled&&this._log(`Binary version: ${M}`);const q=K.readUint32();let w;switch(this.useRangeRequests||q===K.buffer.byteLength||I.e.Warn(`Length in header does not match actual data length: ${q} != ${K.buffer.byteLength}`),M){case 1:w=this._unpackBinaryV1Async(K,q);break;case 2:w=this._unpackBinaryV2Async(K,q);break;default:throw new Error("Unsupported version: "+M)}return this._endPerformanceCounter("Unpack Binary"),w}))}_unpackBinaryV1Async(K,H){const M=K.readUint32(),q=K.readUint32();if(0!==q)throw new Error(`Unexpected content format: ${q}`);const w=H-K.byteOffset,u={json:this._parseJson(K.readString(M)),bin:null};if(0!==w){const H=K.byteOffset;u.bin={readAsync:(M,q)=>K.buffer.readAsync(H+M,q),byteLength:w}}return Promise.resolve(u)}_unpackBinaryV2Async(K,H){const M=1313821514,q=5130562,w=K.readUint32();if(K.readUint32()!==M)throw new Error("First chunk format is not JSON");return K.byteOffset+w===H?K.loadAsync(w).then((()=>({json:this._parseJson(K.readString(w)),bin:null}))):K.loadAsync(w+8).then((()=>{const u={json:this._parseJson(K.readString(w)),bin:null},y=()=>{const w=K.readUint32();switch(K.readUint32()){case M:throw new Error("Unexpected JSON chunk");case q:{const H=K.byteOffset;u.bin={readAsync:(M,q)=>K.buffer.readAsync(H+M,q),byteLength:w},K.skipBytes(w);break}default:K.skipBytes(w)}return K.byteOffset!==H?K.loadAsync(8).then(y):Promise.resolve(u)};return y()}))}static _parseVersion(K){if("1.0"===K||"1.0.1"===K)return{major:1,minor:0};const H=(K+"").match(/^(\d+)\.(\d+)/);return H?{major:parseInt(H[1]),minor:parseInt(H[2])}:null}static _compareVersion(K,H){return K.major>H.major?1:K.major<H.major?-1:K.minor>H.minor?1:K.minor<H.minor?-1:0}_logOpen(K){this._log(K),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(K){const H=d._logSpaces.substring(0,2*this._logIndentLevel);I.e.Log(`${H}${K}`)}_logDisabled(K){}_startPerformanceCounterEnabled(K){w.Tools.StartPerformanceCounter(K)}_startPerformanceCounterDisabled(K){}_endPerformanceCounterEnabled(K){w.Tools.EndPerformanceCounter(K)}_endPerformanceCounterDisabled(K){}}d.IncrementalLoading=!0,d.HomogeneousCoordinates=!1,d._logSpaces="                                ",(0,u.d)(new d)},12931:(K,H,M)=>{"use strict";M.d(H,{d:()=>y});var q=M(11100);function w(K,H,M,q){const w={externalResourceFunction:q};return M&&(w.uri="file:"===H?M:H+M),ArrayBuffer.isView(K)?GLTFValidator.validateBytes(K,w):GLTFValidator.validateString(K,w)}function u(){const K=[];onmessage=H=>{const M=H.data;switch(M.id){case"init":importScripts(M.url);break;case"validate":w(M.data,M.rootUrl,M.fileName,(H=>new Promise(((M,q)=>{const w=K.length;K.push({resolve:M,reject:q}),postMessage({id:"getExternalResource",index:w,uri:H})})))).then((K=>{postMessage({id:"validate.resolve",value:K})}),(K=>{postMessage({id:"validate.reject",reason:K})}));break;case"getExternalResource.resolve":K[M.index].resolve(M.value);break;case"getExternalResource.reject":K[M.index].reject(M.reason)}}}class y{static ValidateAsync(K,H,M,y){return"function"===typeof Worker?new Promise(((h,W)=>{const I=`${w}(${u})()`,f=URL.createObjectURL(new Blob([I],{type:"application/javascript"})),z=new Worker(f),G=K=>{z.removeEventListener("error",G),z.removeEventListener("message",a),W(K)},a=K=>{const H=K.data;switch(H.id){case"getExternalResource":y(H.uri).then((K=>{z.postMessage({id:"getExternalResource.resolve",index:H.index,value:K},[K.buffer])}),(K=>{z.postMessage({id:"getExternalResource.reject",index:H.index,reason:K})}));break;case"validate.resolve":z.removeEventListener("error",G),z.removeEventListener("message",a),h(H.value),z.terminate();break;case"validate.reject":z.removeEventListener("error",G),z.removeEventListener("message",a),W(H.reason),z.terminate()}};if(z.addEventListener("error",G),z.addEventListener("message",a),z.postMessage({id:"init",url:q.Tools.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(K)){const q=K.slice();z.postMessage({id:"validate",data:q,rootUrl:H,fileName:M},[q.buffer])}else z.postMessage({id:"validate",data:K,rootUrl:H,fileName:M})})):(this._LoadScriptPromise||(this._LoadScriptPromise=q.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>w(K,H,M,y))))}}y.Configuration={url:`${q.Tools._DefaultCdnUrl}/gltf_validator.js`}},13477:(K,H,M)=>{"use strict";M.d(H,{e:()=>l});var q=M(11274),w=M(11280),u=M(11325),y=M(11290),h=M(11673),W=M(11597),I=M(11366),f=M(11522),z=M(11242),G=M(11193);M(12700),M(12608),M(12633),M(12617),M(12636),M(12643),M(12651);const a="imageProcessingCompatibility",v="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";G.d.IncludesShadersStore[a]||(G.d.IncludesShadersStore[a]=v);const O="skyPixelShader",L="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";G.d.ShadersStore[O]||(G.d.ShadersStore[O]=L);M(12710),M(12653),M(12658),M(12668),M(12664);const S="skyVertexShader",B="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";G.d.ShadersStore[S]||(G.d.ShadersStore[S]=B);var C=M(11589),i=M(11656),Z=M(11651);class E extends h.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class l extends W.c{constructor(K,H){super(K,H),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new y.OH(0,100,0),this.useSunPosition=!1,this.cameraOffset=y.OH.Zero(),this.up=y.OH.Up(),this.dithering=!1,this._cameraPosition=y.OH.Zero(),this._skyOrientation=new y.Quaternion}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(K,H){const M=H._drawWrapper;if(this.isFrozen&&M.effect&&M._wasPreviouslyReady)return!0;H.materialDefines||(H.materialDefines=new E);const q=H.materialDefines,w=this.sK();if(this._isReadyForSubMesh(H))return!0;if((0,Z.P)(K,w,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,q),(0,Z.H)(K,q,!0,!1),q.IMAGEPROCESSINGPOSTPROCESS!==w.imageProcessingConfiguration.applyByPostProcess&&q.markAsMiscDirty(),q.DITHER!==this.dithering&&q.markAsMiscDirty(),q.isDirty){q.markAsProcessed(),w.resetCachedMaterial();const K=new C.e;q.FOG&&K.addFallback(1,"FOG"),q.IMAGEPROCESSINGPOSTPROCESS=w.imageProcessingConfiguration.applyByPostProcess,q.DITHER=this.dithering;const M=[I.d.PositionKind];q.VERTEXCOLOR&&M.push(I.d.ColorKind);const u="sky",y=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,i.e)(y);const h=q.toString();H.setEffect(w.getEngine().createEffect(u,M,y,[],h,K,this.onCompiled,this.onError),q,this._materialContext)}return!(!H.effect||!H.effect.isReady())&&(q._renderId=w.getRenderId(),M._wasPreviouslyReady=!0,!0)}bindForSubMesh(K,H,M){const q=this.sK(),w=M.materialDefines;if(!w)return;const u=M.effect;if(!u)return;this._activeEffect=u,this.bindOnlyWorldMatrix(K),this._activeEffect.setMatrix("viewProjection",q.getTransformMatrix()),this._mustRebind(q,u,M)&&((0,i.g)(u,this,q),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,Z.l)(w,u,q)),q.fogEnabled&&H.applyFog&&q.fogMode!==f.b.FOGMODE_NONE&&this._activeEffect.setMatrix("view",q.getViewMatrix()),(0,Z.g)(q,H,this._activeEffect);const h=q.activeCamera;if(h){const K=h.getWorldMatrix();this._cameraPosition.x=K.m[12],this._cameraPosition.y=K.m[13],this._cameraPosition.z=K.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const K=Math.PI*(this.inclination-.5),H=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(H)*Math.cos(K),this.sunPosition.y=this.distance*Math.sin(-K),this.sunPosition.z=this.distance*Math.sin(H)*Math.cos(K),y.Quaternion.FromUnitVectorsToRef(y.OH.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(H,this._activeEffect,M)}getAnimatables(){return[]}dispose(K){super.dispose(K)}clone(K){return u.c.Clone((()=>new l(K,this.sK())),this)}serialize(){const K=super.serialize();return K.customType="BABYLON.SkyMaterial",K}getClassName(){return"SkyMaterial"}static Parse(K,H,M){return u.c.Parse((()=>new l(K.name,H)),K,H,M)}}(0,q.e)([(0,w.J)()],l.prototype,"luminance",void 0),(0,q.e)([(0,w.J)()],l.prototype,"turbidity",void 0),(0,q.e)([(0,w.J)()],l.prototype,"rayleigh",void 0),(0,q.e)([(0,w.J)()],l.prototype,"mieCoefficient",void 0),(0,q.e)([(0,w.J)()],l.prototype,"mieDirectionalG",void 0),(0,q.e)([(0,w.J)()],l.prototype,"distance",void 0),(0,q.e)([(0,w.J)()],l.prototype,"inclination",void 0),(0,q.e)([(0,w.J)()],l.prototype,"azimuth",void 0),(0,q.e)([(0,w.G)()],l.prototype,"sunPosition",void 0),(0,q.e)([(0,w.J)()],l.prototype,"useSunPosition",void 0),(0,q.e)([(0,w.G)()],l.prototype,"cameraOffset",void 0),(0,q.e)([(0,w.G)()],l.prototype,"up",void 0),(0,q.e)([(0,w.J)()],l.prototype,"dithering",void 0),(0,z.f)("BABYLON.SkyMaterial",l)},11990:(K,H,M)=>{"use strict";function q(K,H){H.headers=K.headers||{},H.statusMessage=K.statusText,H.statusCode=K.status,H.data=K.response}function w(K,H,M){return new Promise((function(w,u){M=M||{};var y,h,W,I=new XMLHttpRequest,f=M.body,z=M.headers||{};for(y in M.timeout&&(I.timeout=M.timeout),I.ontimeout=I.onerror=function(K){K.timeout="timeout"==K.type,u(K)},I.open(K,H.href||H),I.onload=function(){for(W=I.getAllResponseHeaders().trim().split(/[\r\n]+/),q(I,I);h=W.shift();)h=h.split(": "),I.headers[h.shift().toLowerCase()]=h.join(": ");if((h=I.headers["content-type"])&&~h.indexOf("application/json"))try{I.data=JSON.parse(I.data,M.reviver)}catch(K){return q(I,K),u(K)}(I.status>=400?u:w)(I)},typeof FormData<"u"&&f instanceof FormData||f&&"object"==typeof f&&(z["content-type"]="application/json",f=JSON.stringify(f)),I.withCredentials=!!M.withCredentials,z)I.setRequestHeader(y,z[y]);I.send(f)}))}M.r(H),M.d(H,{del:()=>W,get:()=>u,patch:()=>h,post:()=>y,put:()=>I,send:()=>w});var u=w.bind(w,"GET"),y=w.bind(w,"POST"),h=w.bind(w,"PATCH"),W=w.bind(w,"DELETE"),I=w.bind(w,"PUT")},13584:(K,H,M)=>{"use strict";M.d(H,{c:()=>z});const q=.5*(Math.sqrt(3)-1),w=(3-Math.sqrt(3))/6,u=1/3,y=1/6,h=(Math.sqrt(5)-1)/4,W=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),f=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const z=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const H="function"==typeof K?K:function(K){let H=0,M=0,q=0,w=1;const u=function(){let K=4022871197;return function(H){H=H.toString();for(let M=0;M<H.length;M++){K+=H.charCodeAt(M);let q=.02519603282416938*K;K=q>>>0,q-=K,q*=K,K=q>>>0,q-=K,K+=4294967296*q}return 2.3283064365386963e-10*(K>>>0)}}();H=u(" "),M=u(" "),q=u(" "),H-=u(K),H<0&&(H+=1);M-=u(K),M<0&&(M+=1);q-=u(K),q<0&&(q+=1);return function(){const K=2091639*H+2.3283064365386963e-10*w;return H=M,M=q,q=K-(w=0|K)}}(K);this.p=function(K){const H=new Uint8Array(256);for(let M=0;M<256;M++)H[M]=M;for(let M=0;M<255;M++){const q=M+~~(K()*(256-M)),w=H[M];H[M]=H[q],H[q]=w}return H}(H),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let M=0;M<512;M++)this.perm[M]=this.p[255&M],this.permMod12[M]=this.perm[M]%12}noise2D(K,H){const M=this.permMod12,u=this.perm;let y=0,h=0,W=0;const f=(K+H)*q,z=Math.floor(K+f),G=Math.floor(H+f),a=(z+G)*w,v=K-(z-a),O=H-(G-a);let L,S;v>O?(L=1,S=0):(L=0,S=1);const B=v-L+w,C=O-S+w,i=v-1+2*w,Z=O-1+2*w,E=255&z,l=255&G;let s=.5-v*v-O*O;if(s>=0){const K=3*M[E+u[l]];s*=s,y=s*s*(I[K]*v+I[K+1]*O)}let D=.5-B*B-C*C;if(D>=0){const K=3*M[E+L+u[l+S]];D*=D,h=D*D*(I[K]*B+I[K+1]*C)}let V=.5-i*i-Z*Z;if(V>=0){const K=3*M[E+1+u[l+1]];V*=V,W=V*V*(I[K]*i+I[K+1]*Z)}return 70*(y+h+W)}noise3D(K,H,M){const q=this.permMod12,w=this.perm;let h,W,f,z;const G=(K+H+M)*u,a=Math.floor(K+G),v=Math.floor(H+G),O=Math.floor(M+G),L=(a+v+O)*y,S=K-(a-L),B=H-(v-L),C=M-(O-L);let i,Z,E,l,s,D;S>=B?B>=C?(i=1,Z=0,E=0,l=1,s=1,D=0):S>=C?(i=1,Z=0,E=0,l=1,s=0,D=1):(i=0,Z=0,E=1,l=1,s=0,D=1):B<C?(i=0,Z=0,E=1,l=0,s=1,D=1):S<C?(i=0,Z=1,E=0,l=0,s=1,D=1):(i=0,Z=1,E=0,l=1,s=1,D=0);const V=S-i+y,n=B-Z+y,c=C-E+y,k=S-l+2*y,T=B-s+2*y,d=C-D+2*y,x=S-1+.5,Q=B-1+.5,J=C-1+.5,N=255&a,p=255&v,o=255&O;let R=.6-S*S-B*B-C*C;if(R<0)h=0;else{const K=3*q[N+w[p+w[o]]];R*=R,h=R*R*(I[K]*S+I[K+1]*B+I[K+2]*C)}let t=.6-V*V-n*n-c*c;if(t<0)W=0;else{const K=3*q[N+i+w[p+Z+w[o+E]]];t*=t,W=t*t*(I[K]*V+I[K+1]*n+I[K+2]*c)}let U=.6-k*k-T*T-d*d;if(U<0)f=0;else{const K=3*q[N+l+w[p+s+w[o+D]]];U*=U,f=U*U*(I[K]*k+I[K+1]*T+I[K+2]*d)}let j=.6-x*x-Q*Q-J*J;if(j<0)z=0;else{const K=3*q[N+1+w[p+1+w[o+1]]];j*=j,z=j*j*(I[K]*x+I[K+1]*Q+I[K+2]*J)}return 32*(h+W+f+z)}noise4D(K,H,M,q){const w=this.perm;let u,y,I,z,G;const a=(K+H+M+q)*h,v=Math.floor(K+a),O=Math.floor(H+a),L=Math.floor(M+a),S=Math.floor(q+a),B=(v+O+L+S)*W,C=K-(v-B),i=H-(O-B),Z=M-(L-B),E=q-(S-B);let l=0,s=0,D=0,V=0;C>i?l++:s++,C>Z?l++:D++,C>E?l++:V++,i>Z?s++:D++,i>E?s++:V++,Z>E?D++:V++;const n=l>=3?1:0,c=s>=3?1:0,k=D>=3?1:0,T=V>=3?1:0,d=l>=2?1:0,x=s>=2?1:0,Q=D>=2?1:0,J=V>=2?1:0,N=l>=1?1:0,p=s>=1?1:0,o=D>=1?1:0,R=V>=1?1:0,t=C-n+W,U=i-c+W,j=Z-k+W,m=E-T+W,F=C-d+2*W,Y=i-x+2*W,r=Z-Q+2*W,e=E-J+2*W,b=C-N+3*W,P=i-p+3*W,g=Z-o+3*W,X=E-R+3*W,A=C-1+4*W,KK=i-1+4*W,HK=Z-1+4*W,MK=E-1+4*W,qK=255&v,wK=255&O,uK=255&L,yK=255&S;let hK=.6-C*C-i*i-Z*Z-E*E;if(hK<0)u=0;else{const K=w[qK+w[wK+w[uK+w[yK]]]]%32*4;hK*=hK,u=hK*hK*(f[K]*C+f[K+1]*i+f[K+2]*Z+f[K+3]*E)}let WK=.6-t*t-U*U-j*j-m*m;if(WK<0)y=0;else{const K=w[qK+n+w[wK+c+w[uK+k+w[yK+T]]]]%32*4;WK*=WK,y=WK*WK*(f[K]*t+f[K+1]*U+f[K+2]*j+f[K+3]*m)}let IK=.6-F*F-Y*Y-r*r-e*e;if(IK<0)I=0;else{const K=w[qK+d+w[wK+x+w[uK+Q+w[yK+J]]]]%32*4;IK*=IK,I=IK*IK*(f[K]*F+f[K+1]*Y+f[K+2]*r+f[K+3]*e)}let fK=.6-b*b-P*P-g*g-X*X;if(fK<0)z=0;else{const K=w[qK+N+w[wK+p+w[uK+o+w[yK+R]]]]%32*4;fK*=fK,z=fK*fK*(f[K]*b+f[K+1]*P+f[K+2]*g+f[K+3]*X)}let zK=.6-A*A-KK*KK-HK*HK-MK*MK;if(zK<0)G=0;else{const K=w[qK+1+w[wK+1+w[uK+1+w[yK+1]]]]%32*4;zK*=zK,G=zK*zK*(f[K]*A+f[K+1]*KK+f[K+2]*HK+f[K+3]*MK)}return 27*(u+y+I+z+G)}}}}]);